<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html" class="current">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5524961">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5525016">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5525070">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5525121">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="5525174">package</span>&nbsp;<span class="ident" id="5525182">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5525191">import</span>&nbsp;<span class="op" id="5525198">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5525201">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5525208">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5525218">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5525230">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5525236">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5525242">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5525253">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5525264">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5525282">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5525292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5525295">const</span>&nbsp;<span class="op" id="5525301">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525304">maxNewlines</span>&nbsp;<span class="op" id="5525316">=</span>&nbsp;<span class="num" id="5525318">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5525324">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525372">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5525384">=</span>&nbsp;<span class="builtintype" id="5525386">false</span>&nbsp;<span class="comment" id="5525392">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525417">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5525429">=</span>&nbsp;<span class="num" id="5525431">1</span>&nbsp;<span class="op" id="5525433">&lt;&lt;</span>&nbsp;<span class="num" id="5525436">30</span><br>
<span class="lineno"></span><span class="op" id="5525439">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5525442">type</span>&nbsp;<span class="ident" id="5525447">whiteSpace</span>&nbsp;<span class="builtintype" id="5525458">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5525464">const</span>&nbsp;<span class="op" id="5525470">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525473">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5525482">=</span>&nbsp;<span class="ident" id="5525484">whiteSpace</span><span class="op" id="5525494">(</span><span class="num" id="5525495">0</span><span class="op" id="5525496">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525499">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5525508">=</span>&nbsp;<span class="ident" id="5525510">whiteSpace</span><span class="op" id="5525520">(</span><span class="string" id="5525521">&#39;&nbsp;&#39;</span><span class="op" id="5525524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525527">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5525536">=</span>&nbsp;<span class="ident" id="5525538">whiteSpace</span><span class="op" id="5525548">(</span><span class="string" id="5525549">&#39;\v&#39;</span><span class="op" id="5525553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525556">newline</span>&nbsp;&nbsp;<span class="op" id="5525565">=</span>&nbsp;<span class="ident" id="5525567">whiteSpace</span><span class="op" id="5525577">(</span><span class="string" id="5525578">&#39;\n&#39;</span><span class="op" id="5525582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525585">formfeed</span>&nbsp;<span class="op" id="5525594">=</span>&nbsp;<span class="ident" id="5525596">whiteSpace</span><span class="op" id="5525606">(</span><span class="string" id="5525607">&#39;\f&#39;</span><span class="op" id="5525611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525614">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5525623">=</span>&nbsp;<span class="ident" id="5525625">whiteSpace</span><span class="op" id="5525635">(</span><span class="string" id="5525636">&#39;&gt;&#39;</span><span class="op" id="5525639">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525642">unindent</span>&nbsp;<span class="op" id="5525651">=</span>&nbsp;<span class="ident" id="5525653">whiteSpace</span><span class="op" id="5525663">(</span><span class="string" id="5525664">&#39;&lt;&#39;</span><span class="op" id="5525667">)</span><br>
<span class="lineno"></span><span class="op" id="5525669">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5525672">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="5525726">type</span>&nbsp;<span class="ident" id="5525731">pmode</span>&nbsp;<span class="builtintype" id="5525737">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5525742">const</span>&nbsp;<span class="op" id="5525748">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525751">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525768">pmode</span>&nbsp;<span class="op" id="5525774">=</span>&nbsp;<span class="num" id="5525776">1</span>&nbsp;<span class="op" id="5525778">&lt;&lt;</span>&nbsp;<span class="ident" id="5525781">iota</span>&nbsp;<span class="comment" id="5525786">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525834">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5525869">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="5525921">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5525924">type</span>&nbsp;<span class="ident" id="5525929">commentInfo</span>&nbsp;<span class="keyword" id="5525941">struct</span>&nbsp;<span class="op" id="5525948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5525951">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5525966">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5525984">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526010">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5526025">*</span><span class="ident" id="5526026">ast</span><span class="op" id="5526029">.</span><span class="ident" id="5526030">CommentGroup</span>&nbsp;<span class="comment" id="5526043">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526082">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="5526097">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5526115">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526196">commentNewline</span>&nbsp;<span class="builtintype" id="5526211">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5526229">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="5526276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5526279">type</span>&nbsp;<span class="ident" id="5526284">printer</span>&nbsp;<span class="keyword" id="5526292">struct</span>&nbsp;<span class="op" id="5526299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5526302">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526359">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526367">fset</span>&nbsp;<span class="op" id="5526372">*</span><span class="ident" id="5526373">token</span><span class="op" id="5526378">.</span><span class="ident" id="5526379">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5526389">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526407">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5526419">[</span><span class="op" id="5526420">]</span><span class="builtintype" id="5526421">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5526432">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526455">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5526467">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5526480">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526504">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526516">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5526529">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526554">impliedSemi</span>&nbsp;<span class="builtintype" id="5526566">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5526579">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526623">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526635">token</span><span class="op" id="5526640">.</span><span class="ident" id="5526641">Token</span>&nbsp;&nbsp;<span class="comment" id="5526648">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526706">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526718">token</span><span class="op" id="5526723">.</span><span class="ident" id="5526724">Token</span>&nbsp;&nbsp;<span class="comment" id="5526731">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5526790">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5526802">[</span><span class="op" id="5526803">]</span><span class="ident" id="5526804">whiteSpace</span>&nbsp;<span class="comment" id="5526815">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5526840">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5526854">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5526921">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5526989">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527055">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527121">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527165">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527173">token</span><span class="op" id="5527178">.</span><span class="ident" id="5527179">Position</span>&nbsp;<span class="comment" id="5527188">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527231">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527239">token</span><span class="op" id="5527244">.</span><span class="ident" id="5527245">Position</span>&nbsp;<span class="comment" id="5527254">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527291">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527299">token</span><span class="op" id="5527304">.</span><span class="ident" id="5527305">Position</span>&nbsp;<span class="comment" id="5527314">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527357">linePtr</span>&nbsp;<span class="op" id="5527365">*</span><span class="builtintype" id="5527366">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527380">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527440">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527501">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5527517">[</span><span class="op" id="5527518">]</span><span class="op" id="5527519">*</span><span class="ident" id="5527520">ast</span><span class="op" id="5527523">.</span><span class="ident" id="5527524">CommentGroup</span>&nbsp;<span class="comment" id="5527537">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527552">useNodeComments</span>&nbsp;<span class="builtintype" id="5527568">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527588">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527644">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527711">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527725">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527767">nodeSizes</span>&nbsp;<span class="keyword" id="5527777">map</span><span class="op" id="5527780">[</span><span class="ident" id="5527781">ast</span><span class="op" id="5527784">.</span><span class="ident" id="5527785">Node</span><span class="op" id="5527789">]</span><span class="builtintype" id="5527790">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527796">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527847">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="5527858">token</span><span class="op" id="5527863">.</span><span class="ident" id="5527864">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527869">cachedLine</span>&nbsp;<span class="builtintype" id="5527880">int</span>&nbsp;<span class="comment" id="5527884">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="5527919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5527922">func</span>&nbsp;<span class="op" id="5527927">(</span><span class="ident" id="5527928">p</span>&nbsp;<span class="op" id="5527930">*</span><span class="ident" id="5527931">printer</span><span class="op" id="5527938">)</span>&nbsp;<span class="ident" id="5527940">init</span><span class="op" id="5527944">(</span><span class="ident" id="5527945">cfg</span>&nbsp;<span class="op" id="5527949">*</span><span class="ident" id="5527950">Config</span><span class="op" id="5527956">,</span>&nbsp;<span class="ident" id="5527958">fset</span>&nbsp;<span class="op" id="5527963">*</span><span class="ident" id="5527964">token</span><span class="op" id="5527969">.</span><span class="ident" id="5527970">FileSet</span><span class="op" id="5527977">,</span>&nbsp;<span class="ident" id="5527979">nodeSizes</span>&nbsp;<span class="keyword" id="5527989">map</span><span class="op" id="5527992">[</span><span class="ident" id="5527993">ast</span><span class="op" id="5527996">.</span><span class="ident" id="5527997">Node</span><span class="op" id="5528001">]</span><span class="builtintype" id="5528002">int</span><span class="op" id="5528005">)</span>&nbsp;<span class="op" id="5528007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528010">p</span><span class="op" id="5528011">.</span><span class="ident" id="5528012">Config</span>&nbsp;<span class="op" id="5528019">=</span>&nbsp;<span class="op" id="5528021">*</span><span class="ident" id="5528022">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528027">p</span><span class="op" id="5528028">.</span><span class="ident" id="5528029">fset</span>&nbsp;<span class="op" id="5528034">=</span>&nbsp;<span class="ident" id="5528036">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528042">p</span><span class="op" id="5528043">.</span><span class="ident" id="5528044">pos</span>&nbsp;<span class="op" id="5528048">=</span>&nbsp;<span class="ident" id="5528050">token</span><span class="op" id="5528055">.</span><span class="ident" id="5528056">Position</span><span class="op" id="5528064">{</span><span class="ident" id="5528065">Line</span><span class="op" id="5528069">:</span>&nbsp;<span class="num" id="5528071">1</span><span class="op" id="5528072">,</span>&nbsp;<span class="ident" id="5528074">Column</span><span class="op" id="5528080">:</span>&nbsp;<span class="num" id="5528082">1</span><span class="op" id="5528083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528086">p</span><span class="op" id="5528087">.</span><span class="ident" id="5528088">out</span>&nbsp;<span class="op" id="5528092">=</span>&nbsp;<span class="ident" id="5528094">token</span><span class="op" id="5528099">.</span><span class="ident" id="5528100">Position</span><span class="op" id="5528108">{</span><span class="ident" id="5528109">Line</span><span class="op" id="5528113">:</span>&nbsp;<span class="num" id="5528115">1</span><span class="op" id="5528116">,</span>&nbsp;<span class="ident" id="5528118">Column</span><span class="op" id="5528124">:</span>&nbsp;<span class="num" id="5528126">1</span><span class="op" id="5528127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528130">p</span><span class="op" id="5528131">.</span><span class="ident" id="5528132">wsbuf</span>&nbsp;<span class="op" id="5528138">=</span>&nbsp;<span class="builtinfunc" id="5528140">make</span><span class="op" id="5528144">(</span><span class="op" id="5528145">[</span><span class="op" id="5528146">]</span><span class="ident" id="5528147">whiteSpace</span><span class="op" id="5528157">,</span>&nbsp;<span class="num" id="5528159">0</span><span class="op" id="5528160">,</span>&nbsp;<span class="num" id="5528162">16</span><span class="op" id="5528164">)</span>&nbsp;<span class="comment" id="5528166">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528201">p</span><span class="op" id="5528202">.</span><span class="ident" id="5528203">nodeSizes</span>&nbsp;<span class="op" id="5528213">=</span>&nbsp;<span class="ident" id="5528215">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528226">p</span><span class="op" id="5528227">.</span><span class="ident" id="5528228">cachedPos</span>&nbsp;<span class="op" id="5528238">=</span>&nbsp;<span class="op" id="5528240">-</span><span class="num" id="5528241">1</span><br>
<span class="lineno"></span><span class="op" id="5528243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5528246">func</span>&nbsp;<span class="op" id="5528251">(</span><span class="ident" id="5528252">p</span>&nbsp;<span class="op" id="5528254">*</span><span class="ident" id="5528255">printer</span><span class="op" id="5528262">)</span>&nbsp;<span class="ident" id="5528264">internalError</span><span class="op" id="5528277">(</span><span class="ident" id="5528278">msg</span>&nbsp;<span class="op" id="5528282">...</span><span class="keyword" id="5528285">interface</span><span class="op" id="5528294">{</span><span class="op" id="5528295">}</span><span class="op" id="5528296">)</span>&nbsp;<span class="op" id="5528298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5528301">if</span>&nbsp;<span class="ident" id="5528304">debug</span>&nbsp;<span class="op" id="5528310">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528314">fmt</span><span class="op" id="5528317">.</span><span class="ident" id="5528318">Print</span><span class="op" id="5528323">(</span><span class="ident" id="5528324">p</span><span class="op" id="5528325">.</span><span class="ident" id="5528326">pos</span><span class="op" id="5528329">.</span><span class="ident" id="5528330">String</span><span class="op" id="5528336">(</span><span class="op" id="5528337">)</span>&nbsp;<span class="op" id="5528339">+</span>&nbsp;<span class="string" id="5528341">&#34;:&nbsp;&#34;</span><span class="op" id="5528345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528349">fmt</span><span class="op" id="5528352">.</span><span class="ident" id="5528353">Println</span><span class="op" id="5528360">(</span><span class="ident" id="5528361">msg</span><span class="op" id="5528364">...</span><span class="op" id="5528367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5528371">panic</span><span class="op" id="5528376">(</span><span class="string" id="5528377">&#34;go/printer&#34;</span><span class="op" id="5528389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5528392">}</span><br>
<span class="lineno"></span><span class="op" id="5528394">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5528397">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5528468">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5528544">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5528617">func</span>&nbsp;<span class="op" id="5528622">(</span><span class="ident" id="5528623">p</span>&nbsp;<span class="op" id="5528625">*</span><span class="ident" id="5528626">printer</span><span class="op" id="5528633">)</span>&nbsp;<span class="ident" id="5528635">commentsHaveNewline</span><span class="op" id="5528654">(</span><span class="ident" id="5528655">list</span>&nbsp;<span class="op" id="5528660">[</span><span class="op" id="5528661">]</span><span class="op" id="5528662">*</span><span class="ident" id="5528663">ast</span><span class="op" id="5528666">.</span><span class="ident" id="5528667">Comment</span><span class="op" id="5528674">)</span>&nbsp;<span class="builtintype" id="5528676">bool</span>&nbsp;<span class="op" id="5528681">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5528684">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528702">line</span>&nbsp;<span class="op" id="5528707">:=</span>&nbsp;<span class="ident" id="5528710">p</span><span class="op" id="5528711">.</span><span class="ident" id="5528712">lineFor</span><span class="op" id="5528719">(</span><span class="ident" id="5528720">list</span><span class="op" id="5528724">[</span><span class="num" id="5528725">0</span><span class="op" id="5528726">]</span><span class="op" id="5528727">.</span><span class="ident" id="5528728">Pos</span><span class="op" id="5528731">(</span><span class="op" id="5528732">)</span><span class="op" id="5528733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5528736">for</span>&nbsp;<span class="ident" id="5528740">i</span><span class="op" id="5528741">,</span>&nbsp;<span class="ident" id="5528743">c</span>&nbsp;<span class="op" id="5528745">:=</span>&nbsp;<span class="keyword" id="5528748">range</span>&nbsp;<span class="ident" id="5528754">list</span>&nbsp;<span class="op" id="5528759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5528763">if</span>&nbsp;<span class="ident" id="5528766">i</span>&nbsp;<span class="op" id="5528768">&gt;</span>&nbsp;<span class="num" id="5528770">0</span>&nbsp;<span class="op" id="5528772">&amp;&amp;</span>&nbsp;<span class="ident" id="5528775">p</span><span class="op" id="5528776">.</span><span class="ident" id="5528777">lineFor</span><span class="op" id="5528784">(</span><span class="ident" id="5528785">list</span><span class="op" id="5528789">[</span><span class="ident" id="5528790">i</span><span class="op" id="5528791">]</span><span class="op" id="5528792">.</span><span class="ident" id="5528793">Pos</span><span class="op" id="5528796">(</span><span class="op" id="5528797">)</span><span class="op" id="5528798">)</span>&nbsp;<span class="op" id="5528800">!=</span>&nbsp;<span class="ident" id="5528803">line</span>&nbsp;<span class="op" id="5528808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5528813">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5528853">return</span>&nbsp;<span class="builtintype" id="5528860">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5528867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5528871">if</span>&nbsp;<span class="ident" id="5528874">t</span>&nbsp;<span class="op" id="5528876">:=</span>&nbsp;<span class="ident" id="5528879">c</span><span class="op" id="5528880">.</span><span class="ident" id="5528881">Text</span><span class="op" id="5528885">;</span>&nbsp;<span class="builtinfunc" id="5528887">len</span><span class="op" id="5528890">(</span><span class="ident" id="5528891">t</span><span class="op" id="5528892">)</span>&nbsp;<span class="op" id="5528894">&gt;=</span>&nbsp;<span class="num" id="5528897">2</span>&nbsp;<span class="op" id="5528899">&amp;&amp;</span>&nbsp;<span class="op" id="5528902">(</span><span class="ident" id="5528903">t</span><span class="op" id="5528904">[</span><span class="num" id="5528905">1</span><span class="op" id="5528906">]</span>&nbsp;<span class="op" id="5528908">==</span>&nbsp;<span class="string" id="5528911">&#39;/&#39;</span>&nbsp;<span class="op" id="5528915">||</span>&nbsp;<span class="ident" id="5528918">strings</span><span class="op" id="5528925">.</span><span class="ident" id="5528926">Contains</span><span class="op" id="5528934">(</span><span class="ident" id="5528935">t</span><span class="op" id="5528936">,</span>&nbsp;<span class="string" id="5528938">&#34;\n&#34;</span><span class="op" id="5528942">)</span><span class="op" id="5528943">)</span>&nbsp;<span class="op" id="5528945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5528950">return</span>&nbsp;<span class="builtintype" id="5528957">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5528964">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5528967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528970">_</span>&nbsp;<span class="op" id="5528972">=</span>&nbsp;<span class="ident" id="5528974">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5528980">return</span>&nbsp;<span class="builtintype" id="5528987">false</span><br>
<span class="lineno"></span><span class="op" id="5528993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5528996">func</span>&nbsp;<span class="op" id="5529001">(</span><span class="ident" id="5529002">p</span>&nbsp;<span class="op" id="5529004">*</span><span class="ident" id="5529005">printer</span><span class="op" id="5529012">)</span>&nbsp;<span class="ident" id="5529014">nextComment</span><span class="op" id="5529025">(</span><span class="op" id="5529026">)</span>&nbsp;<span class="op" id="5529028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529031">for</span>&nbsp;<span class="ident" id="5529035">p</span><span class="op" id="5529036">.</span><span class="ident" id="5529037">cindex</span>&nbsp;<span class="op" id="5529044">&lt;</span>&nbsp;<span class="builtinfunc" id="5529046">len</span><span class="op" id="5529049">(</span><span class="ident" id="5529050">p</span><span class="op" id="5529051">.</span><span class="ident" id="5529052">comments</span><span class="op" id="5529060">)</span>&nbsp;<span class="op" id="5529062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529066">c</span>&nbsp;<span class="op" id="5529068">:=</span>&nbsp;<span class="ident" id="5529071">p</span><span class="op" id="5529072">.</span><span class="ident" id="5529073">comments</span><span class="op" id="5529081">[</span><span class="ident" id="5529082">p</span><span class="op" id="5529083">.</span><span class="ident" id="5529084">cindex</span><span class="op" id="5529090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529094">p</span><span class="op" id="5529095">.</span><span class="ident" id="5529096">cindex</span><span class="op" id="5529102">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529107">if</span>&nbsp;<span class="ident" id="5529110">list</span>&nbsp;<span class="op" id="5529115">:=</span>&nbsp;<span class="ident" id="5529118">c</span><span class="op" id="5529119">.</span><span class="ident" id="5529120">List</span><span class="op" id="5529124">;</span>&nbsp;<span class="builtinfunc" id="5529126">len</span><span class="op" id="5529129">(</span><span class="ident" id="5529130">list</span><span class="op" id="5529134">)</span>&nbsp;<span class="op" id="5529136">&gt;</span>&nbsp;<span class="num" id="5529138">0</span>&nbsp;<span class="op" id="5529140">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529145">p</span><span class="op" id="5529146">.</span><span class="ident" id="5529147">comment</span>&nbsp;<span class="op" id="5529155">=</span>&nbsp;<span class="ident" id="5529157">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529162">p</span><span class="op" id="5529163">.</span><span class="ident" id="5529164">commentOffset</span>&nbsp;<span class="op" id="5529178">=</span>&nbsp;<span class="ident" id="5529180">p</span><span class="op" id="5529181">.</span><span class="ident" id="5529182">posFor</span><span class="op" id="5529188">(</span><span class="ident" id="5529189">list</span><span class="op" id="5529193">[</span><span class="num" id="5529194">0</span><span class="op" id="5529195">]</span><span class="op" id="5529196">.</span><span class="ident" id="5529197">Pos</span><span class="op" id="5529200">(</span><span class="op" id="5529201">)</span><span class="op" id="5529202">)</span><span class="op" id="5529203">.</span><span class="ident" id="5529204">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529214">p</span><span class="op" id="5529215">.</span><span class="ident" id="5529216">commentNewline</span>&nbsp;<span class="op" id="5529231">=</span>&nbsp;<span class="ident" id="5529233">p</span><span class="op" id="5529234">.</span><span class="ident" id="5529235">commentsHaveNewline</span><span class="op" id="5529254">(</span><span class="ident" id="5529255">list</span><span class="op" id="5529259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529264">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5529273">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5529277">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5529338">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5529401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5529404">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529425">p</span><span class="op" id="5529426">.</span><span class="ident" id="5529427">commentOffset</span>&nbsp;<span class="op" id="5529441">=</span>&nbsp;<span class="ident" id="5529443">infinity</span><br>
<span class="lineno">145</span><span class="op" id="5529452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5529455">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="5529522">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="5529590">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="5529628">//</span><br>
<span class="lineno"></span><span class="keyword" id="5529631">func</span>&nbsp;<span class="op" id="5529636">(</span><span class="ident" id="5529637">p</span>&nbsp;<span class="op" id="5529639">*</span><span class="ident" id="5529640">printer</span><span class="op" id="5529647">)</span>&nbsp;<span class="ident" id="5529649">commentBefore</span><span class="op" id="5529662">(</span><span class="ident" id="5529663">next</span>&nbsp;<span class="ident" id="5529668">token</span><span class="op" id="5529673">.</span><span class="ident" id="5529674">Position</span><span class="op" id="5529682">)</span>&nbsp;<span class="builtintype" id="5529684">bool</span>&nbsp;<span class="op" id="5529689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529692">return</span>&nbsp;<span class="ident" id="5529699">p</span><span class="op" id="5529700">.</span><span class="ident" id="5529701">commentOffset</span>&nbsp;<span class="op" id="5529715">&lt;</span>&nbsp;<span class="ident" id="5529717">next</span><span class="op" id="5529721">.</span><span class="ident" id="5529722">Offset</span>&nbsp;<span class="op" id="5529729">&amp;&amp;</span>&nbsp;<span class="op" id="5529732">(</span><span class="op" id="5529733">!</span><span class="ident" id="5529734">p</span><span class="op" id="5529735">.</span><span class="ident" id="5529736">impliedSemi</span>&nbsp;<span class="op" id="5529748">||</span>&nbsp;<span class="op" id="5529751">!</span><span class="ident" id="5529752">p</span><span class="op" id="5529753">.</span><span class="ident" id="5529754">commentNewline</span><span class="op" id="5529768">)</span><br>
<span class="lineno"></span><span class="op" id="5529770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="5529773">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5529828">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5529883">//</span><br>
<span class="lineno"></span><span class="keyword" id="5529886">func</span>&nbsp;<span class="op" id="5529891">(</span><span class="ident" id="5529892">p</span>&nbsp;<span class="op" id="5529894">*</span><span class="ident" id="5529895">printer</span><span class="op" id="5529902">)</span>&nbsp;<span class="ident" id="5529904">commentSizeBefore</span><span class="op" id="5529921">(</span><span class="ident" id="5529922">next</span>&nbsp;<span class="ident" id="5529927">token</span><span class="op" id="5529932">.</span><span class="ident" id="5529933">Position</span><span class="op" id="5529941">)</span>&nbsp;<span class="builtintype" id="5529943">int</span>&nbsp;<span class="op" id="5529947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5529950">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530019">defer</span>&nbsp;<span class="keyword" id="5530025">func</span><span class="op" id="5530029">(</span><span class="ident" id="5530030">info</span>&nbsp;<span class="ident" id="5530035">commentInfo</span><span class="op" id="5530046">)</span>&nbsp;<span class="op" id="5530048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530052">p</span><span class="op" id="5530053">.</span><span class="ident" id="5530054">commentInfo</span>&nbsp;<span class="op" id="5530066">=</span>&nbsp;<span class="ident" id="5530068">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5530074">}</span><span class="op" id="5530075">(</span><span class="ident" id="5530076">p</span><span class="op" id="5530077">.</span><span class="ident" id="5530078">commentInfo</span><span class="op" id="5530089">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530093">size</span>&nbsp;<span class="op" id="5530098">:=</span>&nbsp;<span class="num" id="5530101">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530104">for</span>&nbsp;<span class="ident" id="5530108">p</span><span class="op" id="5530109">.</span><span class="ident" id="5530110">commentBefore</span><span class="op" id="5530123">(</span><span class="ident" id="5530124">next</span><span class="op" id="5530128">)</span>&nbsp;<span class="op" id="5530130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530134">for</span>&nbsp;<span class="ident" id="5530138">_</span><span class="op" id="5530139">,</span>&nbsp;<span class="ident" id="5530141">c</span>&nbsp;<span class="op" id="5530143">:=</span>&nbsp;<span class="keyword" id="5530146">range</span>&nbsp;<span class="ident" id="5530152">p</span><span class="op" id="5530153">.</span><span class="ident" id="5530154">comment</span><span class="op" id="5530161">.</span><span class="ident" id="5530162">List</span>&nbsp;<span class="op" id="5530167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530172">size</span>&nbsp;<span class="op" id="5530177">+=</span>&nbsp;<span class="builtinfunc" id="5530180">len</span><span class="op" id="5530183">(</span><span class="ident" id="5530184">c</span><span class="op" id="5530185">.</span><span class="ident" id="5530186">Text</span><span class="op" id="5530190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5530194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530198">p</span><span class="op" id="5530199">.</span><span class="ident" id="5530200">nextComment</span><span class="op" id="5530211">(</span><span class="op" id="5530212">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5530215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530218">return</span>&nbsp;<span class="ident" id="5530225">size</span><br>
<span class="lineno"></span><span class="op" id="5530230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5530233">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="5530306">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5530380">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5530456">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5530472">//</span><br>
<span class="lineno"></span><span class="keyword" id="5530475">func</span>&nbsp;<span class="op" id="5530480">(</span><span class="ident" id="5530481">p</span>&nbsp;<span class="op" id="5530483">*</span><span class="ident" id="5530484">printer</span><span class="op" id="5530491">)</span>&nbsp;<span class="ident" id="5530493">recordLine</span><span class="op" id="5530503">(</span><span class="ident" id="5530504">linePtr</span>&nbsp;<span class="op" id="5530512">*</span><span class="builtintype" id="5530513">int</span><span class="op" id="5530516">)</span>&nbsp;<span class="op" id="5530518">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530521">p</span><span class="op" id="5530522">.</span><span class="ident" id="5530523">linePtr</span>&nbsp;<span class="op" id="5530531">=</span>&nbsp;<span class="ident" id="5530533">linePtr</span><br>
<span class="lineno"></span><span class="op" id="5530541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5530544">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="5530612">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="5530680">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="5530750">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="5530806">//</span><br>
<span class="lineno"></span><span class="keyword" id="5530809">func</span>&nbsp;<span class="op" id="5530814">(</span><span class="ident" id="5530815">p</span>&nbsp;<span class="op" id="5530817">*</span><span class="ident" id="5530818">printer</span><span class="op" id="5530825">)</span>&nbsp;<span class="ident" id="5530827">linesFrom</span><span class="op" id="5530836">(</span><span class="ident" id="5530837">line</span>&nbsp;<span class="builtintype" id="5530842">int</span><span class="op" id="5530845">)</span>&nbsp;<span class="builtintype" id="5530847">int</span>&nbsp;<span class="op" id="5530851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530854">return</span>&nbsp;<span class="ident" id="5530861">p</span><span class="op" id="5530862">.</span><span class="ident" id="5530863">out</span><span class="op" id="5530866">.</span><span class="ident" id="5530867">Line</span>&nbsp;<span class="op" id="5530872">-</span>&nbsp;<span class="ident" id="5530874">line</span><br>
<span class="lineno">190</span><span class="op" id="5530879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5530882">func</span>&nbsp;<span class="op" id="5530887">(</span><span class="ident" id="5530888">p</span>&nbsp;<span class="op" id="5530890">*</span><span class="ident" id="5530891">printer</span><span class="op" id="5530898">)</span>&nbsp;<span class="ident" id="5530900">posFor</span><span class="op" id="5530906">(</span><span class="ident" id="5530907">pos</span>&nbsp;<span class="ident" id="5530911">token</span><span class="op" id="5530916">.</span><span class="ident" id="5530917">Pos</span><span class="op" id="5530920">)</span>&nbsp;<span class="ident" id="5530922">token</span><span class="op" id="5530927">.</span><span class="ident" id="5530928">Position</span>&nbsp;<span class="op" id="5530937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5530940">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531002">return</span>&nbsp;<span class="ident" id="5531009">p</span><span class="op" id="5531010">.</span><span class="ident" id="5531011">fset</span><span class="op" id="5531015">.</span><span class="ident" id="5531016">Position</span><span class="op" id="5531024">(</span><span class="ident" id="5531025">pos</span><span class="op" id="5531028">)</span><br>
<span class="lineno">195</span><span class="op" id="5531030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5531033">func</span>&nbsp;<span class="op" id="5531038">(</span><span class="ident" id="5531039">p</span>&nbsp;<span class="op" id="5531041">*</span><span class="ident" id="5531042">printer</span><span class="op" id="5531049">)</span>&nbsp;<span class="ident" id="5531051">lineFor</span><span class="op" id="5531058">(</span><span class="ident" id="5531059">pos</span>&nbsp;<span class="ident" id="5531063">token</span><span class="op" id="5531068">.</span><span class="ident" id="5531069">Pos</span><span class="op" id="5531072">)</span>&nbsp;<span class="builtintype" id="5531074">int</span>&nbsp;<span class="op" id="5531078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531081">if</span>&nbsp;<span class="ident" id="5531084">pos</span>&nbsp;<span class="op" id="5531088">!=</span>&nbsp;<span class="ident" id="5531091">p</span><span class="op" id="5531092">.</span><span class="ident" id="5531093">cachedPos</span>&nbsp;<span class="op" id="5531103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531107">p</span><span class="op" id="5531108">.</span><span class="ident" id="5531109">cachedPos</span>&nbsp;<span class="op" id="5531119">=</span>&nbsp;<span class="ident" id="5531121">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531127">p</span><span class="op" id="5531128">.</span><span class="ident" id="5531129">cachedLine</span>&nbsp;<span class="op" id="5531140">=</span>&nbsp;<span class="ident" id="5531142">p</span><span class="op" id="5531143">.</span><span class="ident" id="5531144">fset</span><span class="op" id="5531148">.</span><span class="ident" id="5531149">Position</span><span class="op" id="5531157">(</span><span class="ident" id="5531158">pos</span><span class="op" id="5531161">)</span><span class="op" id="5531162">.</span><span class="ident" id="5531163">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531172">return</span>&nbsp;<span class="ident" id="5531179">p</span><span class="op" id="5531180">.</span><span class="ident" id="5531181">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="5531192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5531195">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="5531270">func</span>&nbsp;<span class="op" id="5531275">(</span><span class="ident" id="5531276">p</span>&nbsp;<span class="op" id="5531278">*</span><span class="ident" id="5531279">printer</span><span class="op" id="5531286">)</span>&nbsp;<span class="ident" id="5531288">atLineBegin</span><span class="op" id="5531299">(</span><span class="ident" id="5531300">pos</span>&nbsp;<span class="ident" id="5531304">token</span><span class="op" id="5531309">.</span><span class="ident" id="5531310">Position</span><span class="op" id="5531318">)</span>&nbsp;<span class="op" id="5531320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5531323">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531363">if</span>&nbsp;<span class="ident" id="5531366">p</span><span class="op" id="5531367">.</span><span class="ident" id="5531368">Config</span><span class="op" id="5531374">.</span><span class="ident" id="5531375">Mode</span><span class="op" id="5531379">&amp;</span><span class="ident" id="5531380">SourcePos</span>&nbsp;<span class="op" id="5531390">!=</span>&nbsp;<span class="num" id="5531393">0</span>&nbsp;<span class="op" id="5531395">&amp;&amp;</span>&nbsp;<span class="ident" id="5531398">pos</span><span class="op" id="5531401">.</span><span class="ident" id="5531402">IsValid</span><span class="op" id="5531409">(</span><span class="op" id="5531410">)</span>&nbsp;<span class="op" id="5531412">&amp;&amp;</span>&nbsp;<span class="op" id="5531415">(</span><span class="ident" id="5531416">p</span><span class="op" id="5531417">.</span><span class="ident" id="5531418">out</span><span class="op" id="5531421">.</span><span class="ident" id="5531422">Line</span>&nbsp;<span class="op" id="5531427">!=</span>&nbsp;<span class="ident" id="5531430">pos</span><span class="op" id="5531433">.</span><span class="ident" id="5531434">Line</span>&nbsp;<span class="op" id="5531439">||</span>&nbsp;<span class="ident" id="5531442">p</span><span class="op" id="5531443">.</span><span class="ident" id="5531444">out</span><span class="op" id="5531447">.</span><span class="ident" id="5531448">Filename</span>&nbsp;<span class="op" id="5531457">!=</span>&nbsp;<span class="ident" id="5531460">pos</span><span class="op" id="5531463">.</span><span class="ident" id="5531464">Filename</span><span class="op" id="5531472">)</span>&nbsp;<span class="op" id="5531474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531478">p</span><span class="op" id="5531479">.</span><span class="ident" id="5531480">output</span>&nbsp;<span class="op" id="5531487">=</span>&nbsp;<span class="builtinfunc" id="5531489">append</span><span class="op" id="5531495">(</span><span class="ident" id="5531496">p</span><span class="op" id="5531497">.</span><span class="ident" id="5531498">output</span><span class="op" id="5531504">,</span>&nbsp;<span class="ident" id="5531506">tabwriter</span><span class="op" id="5531515">.</span><span class="ident" id="5531516">Escape</span><span class="op" id="5531522">)</span>&nbsp;<span class="comment" id="5531524">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531582">p</span><span class="op" id="5531583">.</span><span class="ident" id="5531584">output</span>&nbsp;<span class="op" id="5531591">=</span>&nbsp;<span class="builtinfunc" id="5531593">append</span><span class="op" id="5531599">(</span><span class="ident" id="5531600">p</span><span class="op" id="5531601">.</span><span class="ident" id="5531602">output</span><span class="op" id="5531608">,</span>&nbsp;<span class="ident" id="5531610">fmt</span><span class="op" id="5531613">.</span><span class="ident" id="5531614">Sprintf</span><span class="op" id="5531621">(</span><span class="string" id="5531622">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="5531638">,</span>&nbsp;<span class="ident" id="5531640">pos</span><span class="op" id="5531643">.</span><span class="ident" id="5531644">Filename</span><span class="op" id="5531652">,</span>&nbsp;<span class="ident" id="5531654">pos</span><span class="op" id="5531657">.</span><span class="ident" id="5531658">Line</span><span class="op" id="5531662">)</span><span class="op" id="5531663">...</span><span class="op" id="5531666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531670">p</span><span class="op" id="5531671">.</span><span class="ident" id="5531672">output</span>&nbsp;<span class="op" id="5531679">=</span>&nbsp;<span class="builtinfunc" id="5531681">append</span><span class="op" id="5531687">(</span><span class="ident" id="5531688">p</span><span class="op" id="5531689">.</span><span class="ident" id="5531690">output</span><span class="op" id="5531696">,</span>&nbsp;<span class="ident" id="5531698">tabwriter</span><span class="op" id="5531707">.</span><span class="ident" id="5531708">Escape</span><span class="op" id="5531714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5531718">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531759">p</span><span class="op" id="5531760">.</span><span class="ident" id="5531761">out</span><span class="op" id="5531764">.</span><span class="ident" id="5531765">Filename</span>&nbsp;<span class="op" id="5531774">=</span>&nbsp;<span class="ident" id="5531776">pos</span><span class="op" id="5531779">.</span><span class="ident" id="5531780">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531791">p</span><span class="op" id="5531792">.</span><span class="ident" id="5531793">out</span><span class="op" id="5531796">.</span><span class="ident" id="5531797">Line</span>&nbsp;<span class="op" id="5531802">=</span>&nbsp;<span class="ident" id="5531804">pos</span><span class="op" id="5531807">.</span><span class="ident" id="5531808">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5531818">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5531840">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5531883">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531926">n</span>&nbsp;<span class="op" id="5531928">:=</span>&nbsp;<span class="ident" id="5531931">p</span><span class="op" id="5531932">.</span><span class="ident" id="5531933">Config</span><span class="op" id="5531939">.</span><span class="ident" id="5531940">Indent</span>&nbsp;<span class="op" id="5531947">+</span>&nbsp;<span class="ident" id="5531949">p</span><span class="op" id="5531950">.</span><span class="ident" id="5531951">indent</span>&nbsp;<span class="comment" id="5531958">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531987">for</span>&nbsp;<span class="ident" id="5531991">i</span>&nbsp;<span class="op" id="5531993">:=</span>&nbsp;<span class="num" id="5531996">0</span><span class="op" id="5531997">;</span>&nbsp;<span class="ident" id="5531999">i</span>&nbsp;<span class="op" id="5532001">&lt;</span>&nbsp;<span class="ident" id="5532003">n</span><span class="op" id="5532004">;</span>&nbsp;<span class="ident" id="5532006">i</span><span class="op" id="5532007">++</span>&nbsp;<span class="op" id="5532010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532014">p</span><span class="op" id="5532015">.</span><span class="ident" id="5532016">output</span>&nbsp;<span class="op" id="5532023">=</span>&nbsp;<span class="builtinfunc" id="5532025">append</span><span class="op" id="5532031">(</span><span class="ident" id="5532032">p</span><span class="op" id="5532033">.</span><span class="ident" id="5532034">output</span><span class="op" id="5532040">,</span>&nbsp;<span class="string" id="5532042">&#39;\t&#39;</span><span class="op" id="5532046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5532049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5532053">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532074">p</span><span class="op" id="5532075">.</span><span class="ident" id="5532076">pos</span><span class="op" id="5532079">.</span><span class="ident" id="5532080">Offset</span>&nbsp;<span class="op" id="5532087">+=</span>&nbsp;<span class="ident" id="5532090">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532093">p</span><span class="op" id="5532094">.</span><span class="ident" id="5532095">pos</span><span class="op" id="5532098">.</span><span class="ident" id="5532099">Column</span>&nbsp;<span class="op" id="5532106">+=</span>&nbsp;<span class="ident" id="5532109">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532112">p</span><span class="op" id="5532113">.</span><span class="ident" id="5532114">out</span><span class="op" id="5532117">.</span><span class="ident" id="5532118">Column</span>&nbsp;<span class="op" id="5532125">+=</span>&nbsp;<span class="ident" id="5532128">n</span><br>
<span class="lineno"></span><span class="op" id="5532130">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5532133">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="5532195">func</span>&nbsp;<span class="op" id="5532200">(</span><span class="ident" id="5532201">p</span>&nbsp;<span class="op" id="5532203">*</span><span class="ident" id="5532204">printer</span><span class="op" id="5532211">)</span>&nbsp;<span class="ident" id="5532213">writeByte</span><span class="op" id="5532222">(</span><span class="ident" id="5532223">ch</span>&nbsp;<span class="builtintype" id="5532226">byte</span><span class="op" id="5532230">,</span>&nbsp;<span class="ident" id="5532232">n</span>&nbsp;<span class="builtintype" id="5532234">int</span><span class="op" id="5532237">)</span>&nbsp;<span class="op" id="5532239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532242">if</span>&nbsp;<span class="ident" id="5532245">p</span><span class="op" id="5532246">.</span><span class="ident" id="5532247">out</span><span class="op" id="5532250">.</span><span class="ident" id="5532251">Column</span>&nbsp;<span class="op" id="5532258">==</span>&nbsp;<span class="num" id="5532261">1</span>&nbsp;<span class="op" id="5532263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532267">p</span><span class="op" id="5532268">.</span><span class="ident" id="5532269">atLineBegin</span><span class="op" id="5532280">(</span><span class="ident" id="5532281">p</span><span class="op" id="5532282">.</span><span class="ident" id="5532283">pos</span><span class="op" id="5532286">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5532289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532293">for</span>&nbsp;<span class="ident" id="5532297">i</span>&nbsp;<span class="op" id="5532299">:=</span>&nbsp;<span class="num" id="5532302">0</span><span class="op" id="5532303">;</span>&nbsp;<span class="ident" id="5532305">i</span>&nbsp;<span class="op" id="5532307">&lt;</span>&nbsp;<span class="ident" id="5532309">n</span><span class="op" id="5532310">;</span>&nbsp;<span class="ident" id="5532312">i</span><span class="op" id="5532313">++</span>&nbsp;<span class="op" id="5532316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532320">p</span><span class="op" id="5532321">.</span><span class="ident" id="5532322">output</span>&nbsp;<span class="op" id="5532329">=</span>&nbsp;<span class="builtinfunc" id="5532331">append</span><span class="op" id="5532337">(</span><span class="ident" id="5532338">p</span><span class="op" id="5532339">.</span><span class="ident" id="5532340">output</span><span class="op" id="5532346">,</span>&nbsp;<span class="ident" id="5532348">ch</span><span class="op" id="5532350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5532353">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5532357">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532378">p</span><span class="op" id="5532379">.</span><span class="ident" id="5532380">pos</span><span class="op" id="5532383">.</span><span class="ident" id="5532384">Offset</span>&nbsp;<span class="op" id="5532391">+=</span>&nbsp;<span class="ident" id="5532394">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532397">if</span>&nbsp;<span class="ident" id="5532400">ch</span>&nbsp;<span class="op" id="5532403">==</span>&nbsp;<span class="string" id="5532406">&#39;\n&#39;</span>&nbsp;<span class="op" id="5532411">||</span>&nbsp;<span class="ident" id="5532414">ch</span>&nbsp;<span class="op" id="5532417">==</span>&nbsp;<span class="string" id="5532420">&#39;\f&#39;</span>&nbsp;<span class="op" id="5532425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532429">p</span><span class="op" id="5532430">.</span><span class="ident" id="5532431">pos</span><span class="op" id="5532434">.</span><span class="ident" id="5532435">Line</span>&nbsp;<span class="op" id="5532440">+=</span>&nbsp;<span class="ident" id="5532443">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532447">p</span><span class="op" id="5532448">.</span><span class="ident" id="5532449">out</span><span class="op" id="5532452">.</span><span class="ident" id="5532453">Line</span>&nbsp;<span class="op" id="5532458">+=</span>&nbsp;<span class="ident" id="5532461">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532465">p</span><span class="op" id="5532466">.</span><span class="ident" id="5532467">pos</span><span class="op" id="5532470">.</span><span class="ident" id="5532471">Column</span>&nbsp;<span class="op" id="5532478">=</span>&nbsp;<span class="num" id="5532480">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532484">p</span><span class="op" id="5532485">.</span><span class="ident" id="5532486">out</span><span class="op" id="5532489">.</span><span class="ident" id="5532490">Column</span>&nbsp;<span class="op" id="5532497">=</span>&nbsp;<span class="num" id="5532499">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532503">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5532511">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532514">p</span><span class="op" id="5532515">.</span><span class="ident" id="5532516">pos</span><span class="op" id="5532519">.</span><span class="ident" id="5532520">Column</span>&nbsp;<span class="op" id="5532527">+=</span>&nbsp;<span class="ident" id="5532530">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532533">p</span><span class="op" id="5532534">.</span><span class="ident" id="5532535">out</span><span class="op" id="5532538">.</span><span class="ident" id="5532539">Column</span>&nbsp;<span class="op" id="5532546">+=</span>&nbsp;<span class="ident" id="5532549">n</span><br>
<span class="lineno"></span><span class="op" id="5532551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5532554">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="5532627">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="5532703">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="5532760">//</span><br>
<span class="lineno"></span><span class="comment" id="5532763">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5532831">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="5532904">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5532976">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="5533052">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5533125">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="5533160">//</span><br>
<span class="lineno">265</span><span class="keyword" id="5533163">func</span>&nbsp;<span class="op" id="5533168">(</span><span class="ident" id="5533169">p</span>&nbsp;<span class="op" id="5533171">*</span><span class="ident" id="5533172">printer</span><span class="op" id="5533179">)</span>&nbsp;<span class="ident" id="5533181">writeString</span><span class="op" id="5533192">(</span><span class="ident" id="5533193">pos</span>&nbsp;<span class="ident" id="5533197">token</span><span class="op" id="5533202">.</span><span class="ident" id="5533203">Position</span><span class="op" id="5533211">,</span>&nbsp;<span class="ident" id="5533213">s</span>&nbsp;<span class="builtintype" id="5533215">string</span><span class="op" id="5533221">,</span>&nbsp;<span class="ident" id="5533223">isLit</span>&nbsp;<span class="builtintype" id="5533229">bool</span><span class="op" id="5533233">)</span>&nbsp;<span class="op" id="5533235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533238">if</span>&nbsp;<span class="ident" id="5533241">p</span><span class="op" id="5533242">.</span><span class="ident" id="5533243">out</span><span class="op" id="5533246">.</span><span class="ident" id="5533247">Column</span>&nbsp;<span class="op" id="5533254">==</span>&nbsp;<span class="num" id="5533257">1</span>&nbsp;<span class="op" id="5533259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533263">p</span><span class="op" id="5533264">.</span><span class="ident" id="5533265">atLineBegin</span><span class="op" id="5533276">(</span><span class="ident" id="5533277">pos</span><span class="op" id="5533280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533287">if</span>&nbsp;<span class="ident" id="5533290">pos</span><span class="op" id="5533293">.</span><span class="ident" id="5533294">IsValid</span><span class="op" id="5533301">(</span><span class="op" id="5533302">)</span>&nbsp;<span class="op" id="5533304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5533308">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5533376">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5533439">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5533504">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533531">p</span><span class="op" id="5533532">.</span><span class="ident" id="5533533">pos</span>&nbsp;<span class="op" id="5533537">=</span>&nbsp;<span class="ident" id="5533539">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533548">if</span>&nbsp;<span class="ident" id="5533551">isLit</span>&nbsp;<span class="op" id="5533557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5533561">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5533618">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5533677">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5533739">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533761">p</span><span class="op" id="5533762">.</span><span class="ident" id="5533763">output</span>&nbsp;<span class="op" id="5533770">=</span>&nbsp;<span class="builtinfunc" id="5533772">append</span><span class="op" id="5533778">(</span><span class="ident" id="5533779">p</span><span class="op" id="5533780">.</span><span class="ident" id="5533781">output</span><span class="op" id="5533787">,</span>&nbsp;<span class="ident" id="5533789">tabwriter</span><span class="op" id="5533798">.</span><span class="ident" id="5533799">Escape</span><span class="op" id="5533805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533808">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533812">if</span>&nbsp;<span class="ident" id="5533815">debug</span>&nbsp;<span class="op" id="5533821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533825">p</span><span class="op" id="5533826">.</span><span class="ident" id="5533827">output</span>&nbsp;<span class="op" id="5533834">=</span>&nbsp;<span class="builtinfunc" id="5533836">append</span><span class="op" id="5533842">(</span><span class="ident" id="5533843">p</span><span class="op" id="5533844">.</span><span class="ident" id="5533845">output</span><span class="op" id="5533851">,</span>&nbsp;<span class="ident" id="5533853">fmt</span><span class="op" id="5533856">.</span><span class="ident" id="5533857">Sprintf</span><span class="op" id="5533864">(</span><span class="string" id="5533865">&#34;/*%s*/&#34;</span><span class="op" id="5533873">,</span>&nbsp;<span class="ident" id="5533875">pos</span><span class="op" id="5533878">)</span><span class="op" id="5533879">...</span><span class="op" id="5533882">)</span>&nbsp;<span class="comment" id="5533884">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533912">p</span><span class="op" id="5533913">.</span><span class="ident" id="5533914">output</span>&nbsp;<span class="op" id="5533921">=</span>&nbsp;<span class="builtinfunc" id="5533923">append</span><span class="op" id="5533929">(</span><span class="ident" id="5533930">p</span><span class="op" id="5533931">.</span><span class="ident" id="5533932">output</span><span class="op" id="5533938">,</span>&nbsp;<span class="ident" id="5533940">s</span><span class="op" id="5533941">...</span><span class="op" id="5533944">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5533948">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533969">nlines</span>&nbsp;<span class="op" id="5533976">:=</span>&nbsp;<span class="num" id="5533979">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533982">var</span>&nbsp;<span class="ident" id="5533986">li</span>&nbsp;<span class="builtintype" id="5533989">int</span>&nbsp;<span class="comment" id="5533993">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5534040">for</span>&nbsp;<span class="ident" id="5534044">i</span>&nbsp;<span class="op" id="5534046">:=</span>&nbsp;<span class="num" id="5534049">0</span><span class="op" id="5534050">;</span>&nbsp;<span class="ident" id="5534052">i</span>&nbsp;<span class="op" id="5534054">&lt;</span>&nbsp;<span class="builtinfunc" id="5534056">len</span><span class="op" id="5534059">(</span><span class="ident" id="5534060">s</span><span class="op" id="5534061">)</span><span class="op" id="5534062">;</span>&nbsp;<span class="ident" id="5534064">i</span><span class="op" id="5534065">++</span>&nbsp;<span class="op" id="5534068">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5534072">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5534132">if</span>&nbsp;<span class="ident" id="5534135">s</span><span class="op" id="5534136">[</span><span class="ident" id="5534137">i</span><span class="op" id="5534138">]</span>&nbsp;<span class="op" id="5534140">==</span>&nbsp;<span class="string" id="5534143">&#39;\n&#39;</span>&nbsp;<span class="op" id="5534148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534153">nlines</span><span class="op" id="5534159">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534165">li</span>&nbsp;<span class="op" id="5534168">=</span>&nbsp;<span class="ident" id="5534170">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5534174">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5534177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534180">p</span><span class="op" id="5534181">.</span><span class="ident" id="5534182">pos</span><span class="op" id="5534185">.</span><span class="ident" id="5534186">Offset</span>&nbsp;<span class="op" id="5534193">+=</span>&nbsp;<span class="builtinfunc" id="5534196">len</span><span class="op" id="5534199">(</span><span class="ident" id="5534200">s</span><span class="op" id="5534201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5534204">if</span>&nbsp;<span class="ident" id="5534207">nlines</span>&nbsp;<span class="op" id="5534214">&gt;</span>&nbsp;<span class="num" id="5534216">0</span>&nbsp;<span class="op" id="5534218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534222">p</span><span class="op" id="5534223">.</span><span class="ident" id="5534224">pos</span><span class="op" id="5534227">.</span><span class="ident" id="5534228">Line</span>&nbsp;<span class="op" id="5534233">+=</span>&nbsp;<span class="ident" id="5534236">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534245">p</span><span class="op" id="5534246">.</span><span class="ident" id="5534247">out</span><span class="op" id="5534250">.</span><span class="ident" id="5534251">Line</span>&nbsp;<span class="op" id="5534256">+=</span>&nbsp;<span class="ident" id="5534259">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534268">c</span>&nbsp;<span class="op" id="5534270">:=</span>&nbsp;<span class="builtinfunc" id="5534273">len</span><span class="op" id="5534276">(</span><span class="ident" id="5534277">s</span><span class="op" id="5534278">)</span>&nbsp;<span class="op" id="5534280">-</span>&nbsp;<span class="ident" id="5534282">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534287">p</span><span class="op" id="5534288">.</span><span class="ident" id="5534289">pos</span><span class="op" id="5534292">.</span><span class="ident" id="5534293">Column</span>&nbsp;<span class="op" id="5534300">=</span>&nbsp;<span class="ident" id="5534302">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534306">p</span><span class="op" id="5534307">.</span><span class="ident" id="5534308">out</span><span class="op" id="5534311">.</span><span class="ident" id="5534312">Column</span>&nbsp;<span class="op" id="5534319">=</span>&nbsp;<span class="ident" id="5534321">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5534324">}</span>&nbsp;<span class="keyword" id="5534326">else</span>&nbsp;<span class="op" id="5534331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534335">p</span><span class="op" id="5534336">.</span><span class="ident" id="5534337">pos</span><span class="op" id="5534340">.</span><span class="ident" id="5534341">Column</span>&nbsp;<span class="op" id="5534348">+=</span>&nbsp;<span class="builtinfunc" id="5534351">len</span><span class="op" id="5534354">(</span><span class="ident" id="5534355">s</span><span class="op" id="5534356">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534360">p</span><span class="op" id="5534361">.</span><span class="ident" id="5534362">out</span><span class="op" id="5534365">.</span><span class="ident" id="5534366">Column</span>&nbsp;<span class="op" id="5534373">+=</span>&nbsp;<span class="builtinfunc" id="5534376">len</span><span class="op" id="5534379">(</span><span class="ident" id="5534380">s</span><span class="op" id="5534381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5534384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5534388">if</span>&nbsp;<span class="ident" id="5534391">isLit</span>&nbsp;<span class="op" id="5534397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534401">p</span><span class="op" id="5534402">.</span><span class="ident" id="5534403">output</span>&nbsp;<span class="op" id="5534410">=</span>&nbsp;<span class="builtinfunc" id="5534412">append</span><span class="op" id="5534418">(</span><span class="ident" id="5534419">p</span><span class="op" id="5534420">.</span><span class="ident" id="5534421">output</span><span class="op" id="5534427">,</span>&nbsp;<span class="ident" id="5534429">tabwriter</span><span class="op" id="5534438">.</span><span class="ident" id="5534439">Escape</span><span class="op" id="5534445">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5534448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534452">p</span><span class="op" id="5534453">.</span><span class="ident" id="5534454">last</span>&nbsp;<span class="op" id="5534459">=</span>&nbsp;<span class="ident" id="5534461">p</span><span class="op" id="5534462">.</span><span class="ident" id="5534463">pos</span><br>
<span class="lineno"></span><span class="op" id="5534467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="5534470">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5534532">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5534594">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="5534650">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="5534712">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="5534775">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5534835">//</span><br>
<span class="lineno"></span><span class="keyword" id="5534838">func</span>&nbsp;<span class="op" id="5534843">(</span><span class="ident" id="5534844">p</span>&nbsp;<span class="op" id="5534846">*</span><span class="ident" id="5534847">printer</span><span class="op" id="5534854">)</span>&nbsp;<span class="ident" id="5534856">writeCommentPrefix</span><span class="op" id="5534874">(</span><span class="ident" id="5534875">pos</span><span class="op" id="5534878">,</span>&nbsp;<span class="ident" id="5534880">next</span>&nbsp;<span class="ident" id="5534885">token</span><span class="op" id="5534890">.</span><span class="ident" id="5534891">Position</span><span class="op" id="5534899">,</span>&nbsp;<span class="ident" id="5534901">prev</span><span class="op" id="5534905">,</span>&nbsp;<span class="ident" id="5534907">comment</span>&nbsp;<span class="op" id="5534915">*</span><span class="ident" id="5534916">ast</span><span class="op" id="5534919">.</span><span class="ident" id="5534920">Comment</span><span class="op" id="5534927">,</span>&nbsp;<span class="ident" id="5534929">tok</span>&nbsp;<span class="ident" id="5534933">token</span><span class="op" id="5534938">.</span><span class="ident" id="5534939">Token</span><span class="op" id="5534944">)</span>&nbsp;<span class="op" id="5534946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5534949">if</span>&nbsp;<span class="builtinfunc" id="5534952">len</span><span class="op" id="5534955">(</span><span class="ident" id="5534956">p</span><span class="op" id="5534957">.</span><span class="ident" id="5534958">output</span><span class="op" id="5534964">)</span>&nbsp;<span class="op" id="5534966">==</span>&nbsp;<span class="num" id="5534969">0</span>&nbsp;<span class="op" id="5534971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5534975">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535053">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5535061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535065">if</span>&nbsp;<span class="ident" id="5535068">pos</span><span class="op" id="5535071">.</span><span class="ident" id="5535072">IsValid</span><span class="op" id="5535079">(</span><span class="op" id="5535080">)</span>&nbsp;<span class="op" id="5535082">&amp;&amp;</span>&nbsp;<span class="ident" id="5535085">pos</span><span class="op" id="5535088">.</span><span class="ident" id="5535089">Filename</span>&nbsp;<span class="op" id="5535098">!=</span>&nbsp;<span class="ident" id="5535101">p</span><span class="op" id="5535102">.</span><span class="ident" id="5535103">last</span><span class="op" id="5535107">.</span><span class="ident" id="5535108">Filename</span>&nbsp;<span class="op" id="5535117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535121">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535179">p</span><span class="op" id="5535180">.</span><span class="ident" id="5535181">writeByte</span><span class="op" id="5535190">(</span><span class="string" id="5535191">&#39;\f&#39;</span><span class="op" id="5535195">,</span>&nbsp;<span class="ident" id="5535197">maxNewlines</span><span class="op" id="5535208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535212">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5535220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535224">if</span>&nbsp;<span class="ident" id="5535227">pos</span><span class="op" id="5535230">.</span><span class="ident" id="5535231">Line</span>&nbsp;<span class="op" id="5535236">==</span>&nbsp;<span class="ident" id="5535239">p</span><span class="op" id="5535240">.</span><span class="ident" id="5535241">last</span><span class="op" id="5535245">.</span><span class="ident" id="5535246">Line</span>&nbsp;<span class="op" id="5535251">&amp;&amp;</span>&nbsp;<span class="op" id="5535254">(</span><span class="ident" id="5535255">prev</span>&nbsp;<span class="op" id="5535260">==</span>&nbsp;<span class="builtintype" id="5535263">nil</span>&nbsp;<span class="op" id="5535267">||</span>&nbsp;<span class="ident" id="5535270">prev</span><span class="op" id="5535274">.</span><span class="ident" id="5535275">Text</span><span class="op" id="5535279">[</span><span class="num" id="5535280">1</span><span class="op" id="5535281">]</span>&nbsp;<span class="op" id="5535283">!=</span>&nbsp;<span class="string" id="5535286">&#39;/&#39;</span><span class="op" id="5535289">)</span>&nbsp;<span class="op" id="5535291">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535295">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535339">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535381">hasSep</span>&nbsp;<span class="op" id="5535388">:=</span>&nbsp;<span class="builtintype" id="5535391">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535399">if</span>&nbsp;<span class="ident" id="5535402">prev</span>&nbsp;<span class="op" id="5535407">==</span>&nbsp;<span class="builtintype" id="5535410">nil</span>&nbsp;<span class="op" id="5535414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535419">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535458">j</span>&nbsp;<span class="op" id="5535460">:=</span>&nbsp;<span class="num" id="5535463">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535468">for</span>&nbsp;<span class="ident" id="5535472">i</span><span class="op" id="5535473">,</span>&nbsp;<span class="ident" id="5535475">ch</span>&nbsp;<span class="op" id="5535478">:=</span>&nbsp;<span class="keyword" id="5535481">range</span>&nbsp;<span class="ident" id="5535487">p</span><span class="op" id="5535488">.</span><span class="ident" id="5535489">wsbuf</span>&nbsp;<span class="op" id="5535495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535501">switch</span>&nbsp;<span class="ident" id="5535508">ch</span>&nbsp;<span class="op" id="5535511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535517">case</span>&nbsp;<span class="ident" id="5535522">blank</span><span class="op" id="5535527">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535534">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535577">p</span><span class="op" id="5535578">.</span><span class="ident" id="5535579">wsbuf</span><span class="op" id="5535584">[</span><span class="ident" id="5535585">i</span><span class="op" id="5535586">]</span>&nbsp;<span class="op" id="5535588">=</span>&nbsp;<span class="ident" id="5535590">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535602">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535615">case</span>&nbsp;<span class="ident" id="5535620">vtab</span><span class="op" id="5535624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535631">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535673">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535724">hasSep</span>&nbsp;<span class="op" id="5535731">=</span>&nbsp;<span class="builtintype" id="5535733">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535743">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535756">case</span>&nbsp;<span class="ident" id="5535761">indent</span><span class="op" id="5535767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535774">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535808">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5535821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535827">j</span>&nbsp;<span class="op" id="5535829">=</span>&nbsp;<span class="ident" id="5535831">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535837">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5535846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535851">p</span><span class="op" id="5535852">.</span><span class="ident" id="5535853">writeWhitespace</span><span class="op" id="5535868">(</span><span class="ident" id="5535869">j</span><span class="op" id="5535870">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5535874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535878">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535925">if</span>&nbsp;<span class="op" id="5535928">!</span><span class="ident" id="5535929">hasSep</span>&nbsp;<span class="op" id="5535936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535941">sep</span>&nbsp;<span class="op" id="5535945">:=</span>&nbsp;<span class="builtintype" id="5535948">byte</span><span class="op" id="5535952">(</span><span class="string" id="5535953">&#39;\t&#39;</span><span class="op" id="5535957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535962">if</span>&nbsp;<span class="ident" id="5535965">pos</span><span class="op" id="5535968">.</span><span class="ident" id="5535969">Line</span>&nbsp;<span class="op" id="5535974">==</span>&nbsp;<span class="ident" id="5535977">next</span><span class="op" id="5535981">.</span><span class="ident" id="5535982">Line</span>&nbsp;<span class="op" id="5535987">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535993">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536045">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536097">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5536134">sep</span>&nbsp;<span class="op" id="5536138">=</span>&nbsp;<span class="string" id="5536140">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5536147">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5536152">p</span><span class="op" id="5536153">.</span><span class="ident" id="5536154">writeByte</span><span class="op" id="5536163">(</span><span class="ident" id="5536164">sep</span><span class="op" id="5536167">,</span>&nbsp;<span class="num" id="5536169">1</span><span class="op" id="5536170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5536174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5536178">}</span>&nbsp;<span class="keyword" id="5536180">else</span>&nbsp;<span class="op" id="5536185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536189">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536223">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5536266">droppedLinebreak</span>&nbsp;<span class="op" id="5536283">:=</span>&nbsp;<span class="builtintype" id="5536286">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5536294">j</span>&nbsp;<span class="op" id="5536296">:=</span>&nbsp;<span class="num" id="5536299">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5536303">for</span>&nbsp;<span class="ident" id="5536307">i</span><span class="op" id="5536308">,</span>&nbsp;<span class="ident" id="5536310">ch</span>&nbsp;<span class="op" id="5536313">:=</span>&nbsp;<span class="keyword" id="5536316">range</span>&nbsp;<span class="ident" id="5536322">p</span><span class="op" id="5536323">.</span><span class="ident" id="5536324">wsbuf</span>&nbsp;<span class="op" id="5536330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5536335">switch</span>&nbsp;<span class="ident" id="5536342">ch</span>&nbsp;<span class="op" id="5536345">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5536350">case</span>&nbsp;<span class="ident" id="5536355">blank</span><span class="op" id="5536360">,</span>&nbsp;<span class="ident" id="5536362">vtab</span><span class="op" id="5536366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536372">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5536431">p</span><span class="op" id="5536432">.</span><span class="ident" id="5536433">wsbuf</span><span class="op" id="5536438">[</span><span class="ident" id="5536439">i</span><span class="op" id="5536440">]</span>&nbsp;<span class="op" id="5536442">=</span>&nbsp;<span class="ident" id="5536444">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5536455">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5536467">case</span>&nbsp;<span class="ident" id="5536472">indent</span><span class="op" id="5536478">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536484">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5536517">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5536529">case</span>&nbsp;<span class="ident" id="5536534">unindent</span><span class="op" id="5536542">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536548">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536598">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536645">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536699">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5536741">if</span>&nbsp;<span class="ident" id="5536744">i</span><span class="op" id="5536745">+</span><span class="num" id="5536746">1</span>&nbsp;<span class="op" id="5536748">&lt;</span>&nbsp;<span class="builtinfunc" id="5536750">len</span><span class="op" id="5536753">(</span><span class="ident" id="5536754">p</span><span class="op" id="5536755">.</span><span class="ident" id="5536756">wsbuf</span><span class="op" id="5536761">)</span>&nbsp;<span class="op" id="5536763">&amp;&amp;</span>&nbsp;<span class="ident" id="5536766">p</span><span class="op" id="5536767">.</span><span class="ident" id="5536768">wsbuf</span><span class="op" id="5536773">[</span><span class="ident" id="5536774">i</span><span class="op" id="5536775">+</span><span class="num" id="5536776">1</span><span class="op" id="5536777">]</span>&nbsp;<span class="op" id="5536779">==</span>&nbsp;<span class="ident" id="5536782">unindent</span>&nbsp;<span class="op" id="5536791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5536798">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5536811">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536817">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536881">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536939">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5536996">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5537054">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5537109">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5537167">if</span>&nbsp;<span class="ident" id="5537170">tok</span>&nbsp;<span class="op" id="5537174">!=</span>&nbsp;<span class="ident" id="5537177">token</span><span class="op" id="5537182">.</span><span class="ident" id="5537183">RBRACE</span>&nbsp;<span class="op" id="5537190">&amp;&amp;</span>&nbsp;<span class="ident" id="5537193">pos</span><span class="op" id="5537196">.</span><span class="ident" id="5537197">Column</span>&nbsp;<span class="op" id="5537204">==</span>&nbsp;<span class="ident" id="5537207">next</span><span class="op" id="5537211">.</span><span class="ident" id="5537212">Column</span>&nbsp;<span class="op" id="5537219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5537226">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5537239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5537244">case</span>&nbsp;<span class="ident" id="5537249">newline</span><span class="op" id="5537256">,</span>&nbsp;<span class="ident" id="5537258">formfeed</span><span class="op" id="5537266">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5537272">p</span><span class="op" id="5537273">.</span><span class="ident" id="5537274">wsbuf</span><span class="op" id="5537279">[</span><span class="ident" id="5537280">i</span><span class="op" id="5537281">]</span>&nbsp;<span class="op" id="5537283">=</span>&nbsp;<span class="ident" id="5537285">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5537296">droppedLinebreak</span>&nbsp;<span class="op" id="5537313">=</span>&nbsp;<span class="ident" id="5537315">prev</span>&nbsp;<span class="op" id="5537320">==</span>&nbsp;<span class="builtintype" id="5537323">nil</span>&nbsp;<span class="comment" id="5537327">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5537373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5537378">j</span>&nbsp;<span class="op" id="5537380">=</span>&nbsp;<span class="ident" id="5537382">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5537387">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5537395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5537399">p</span><span class="op" id="5537400">.</span><span class="ident" id="5537401">writeWhitespace</span><span class="op" id="5537416">(</span><span class="ident" id="5537417">j</span><span class="op" id="5537418">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5537423">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5537478">n</span>&nbsp;<span class="op" id="5537480">:=</span>&nbsp;<span class="num" id="5537483">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5537487">if</span>&nbsp;<span class="ident" id="5537490">pos</span><span class="op" id="5537493">.</span><span class="ident" id="5537494">IsValid</span><span class="op" id="5537501">(</span><span class="op" id="5537502">)</span>&nbsp;<span class="op" id="5537504">&amp;&amp;</span>&nbsp;<span class="ident" id="5537507">p</span><span class="op" id="5537508">.</span><span class="ident" id="5537509">last</span><span class="op" id="5537513">.</span><span class="ident" id="5537514">IsValid</span><span class="op" id="5537521">(</span><span class="op" id="5537522">)</span>&nbsp;<span class="op" id="5537524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5537529">n</span>&nbsp;<span class="op" id="5537531">=</span>&nbsp;<span class="ident" id="5537533">pos</span><span class="op" id="5537536">.</span><span class="ident" id="5537537">Line</span>&nbsp;<span class="op" id="5537542">-</span>&nbsp;<span class="ident" id="5537544">p</span><span class="op" id="5537545">.</span><span class="ident" id="5537546">last</span><span class="op" id="5537550">.</span><span class="ident" id="5537551">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5537559">if</span>&nbsp;<span class="ident" id="5537562">n</span>&nbsp;<span class="op" id="5537564">&lt;</span>&nbsp;<span class="num" id="5537566">0</span>&nbsp;<span class="op" id="5537568">{</span>&nbsp;<span class="comment" id="5537570">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5537597">n</span>&nbsp;<span class="op" id="5537599">=</span>&nbsp;<span class="num" id="5537601">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5537606">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5537610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5537615">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5537669">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5537721">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5537775">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5537829">if</span>&nbsp;<span class="ident" id="5537832">p</span><span class="op" id="5537833">.</span><span class="ident" id="5537834">indent</span>&nbsp;<span class="op" id="5537841">==</span>&nbsp;<span class="num" id="5537844">0</span>&nbsp;<span class="op" id="5537846">&amp;&amp;</span>&nbsp;<span class="ident" id="5537849">droppedLinebreak</span>&nbsp;<span class="op" id="5537866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5537871">n</span><span class="op" id="5537872">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5537877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5537882">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5537930">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5537978">if</span>&nbsp;<span class="ident" id="5537981">n</span>&nbsp;<span class="op" id="5537983">==</span>&nbsp;<span class="num" id="5537986">0</span>&nbsp;<span class="op" id="5537988">&amp;&amp;</span>&nbsp;<span class="ident" id="5537991">prev</span>&nbsp;<span class="op" id="5537996">!=</span>&nbsp;<span class="builtintype" id="5537999">nil</span>&nbsp;<span class="op" id="5538003">&amp;&amp;</span>&nbsp;<span class="ident" id="5538006">prev</span><span class="op" id="5538010">.</span><span class="ident" id="5538011">Text</span><span class="op" id="5538015">[</span><span class="num" id="5538016">1</span><span class="op" id="5538017">]</span>&nbsp;<span class="op" id="5538019">==</span>&nbsp;<span class="string" id="5538022">&#39;/&#39;</span>&nbsp;<span class="op" id="5538026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5538031">n</span>&nbsp;<span class="op" id="5538033">=</span>&nbsp;<span class="num" id="5538035">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5538039">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5538044">if</span>&nbsp;<span class="ident" id="5538047">n</span>&nbsp;<span class="op" id="5538049">&gt;</span>&nbsp;<span class="num" id="5538051">0</span>&nbsp;<span class="op" id="5538053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5538058">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5538113">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5538168">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5538212">p</span><span class="op" id="5538213">.</span><span class="ident" id="5538214">writeByte</span><span class="op" id="5538223">(</span><span class="string" id="5538224">&#39;\f&#39;</span><span class="op" id="5538228">,</span>&nbsp;<span class="ident" id="5538230">nlimit</span><span class="op" id="5538236">(</span><span class="ident" id="5538237">n</span><span class="op" id="5538238">)</span><span class="op" id="5538239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5538243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5538246">}</span><br>
<span class="lineno"></span><span class="op" id="5538248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="5538251">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="5538298">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="5538361">//</span><br>
<span class="lineno"></span><span class="keyword" id="5538364">func</span>&nbsp;<span class="ident" id="5538369">isBlank</span><span class="op" id="5538376">(</span><span class="ident" id="5538377">s</span>&nbsp;<span class="builtintype" id="5538379">string</span><span class="op" id="5538385">)</span>&nbsp;<span class="builtintype" id="5538387">bool</span>&nbsp;<span class="op" id="5538392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5538395">for</span>&nbsp;<span class="ident" id="5538399">i</span>&nbsp;<span class="op" id="5538401">:=</span>&nbsp;<span class="num" id="5538404">0</span><span class="op" id="5538405">;</span>&nbsp;<span class="ident" id="5538407">i</span>&nbsp;<span class="op" id="5538409">&lt;</span>&nbsp;<span class="builtinfunc" id="5538411">len</span><span class="op" id="5538414">(</span><span class="ident" id="5538415">s</span><span class="op" id="5538416">)</span><span class="op" id="5538417">;</span>&nbsp;<span class="ident" id="5538419">i</span><span class="op" id="5538420">++</span>&nbsp;<span class="op" id="5538423">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5538427">if</span>&nbsp;<span class="ident" id="5538430">s</span><span class="op" id="5538431">[</span><span class="ident" id="5538432">i</span><span class="op" id="5538433">]</span>&nbsp;<span class="op" id="5538435">&gt;</span>&nbsp;<span class="string" id="5538437">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5538441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5538446">return</span>&nbsp;<span class="builtintype" id="5538453">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5538461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5538464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5538467">return</span>&nbsp;<span class="builtintype" id="5538474">true</span><br>
<span class="lineno">460</span><span class="op" id="5538479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5538482">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5538536">func</span>&nbsp;<span class="ident" id="5538541">commonPrefix</span><span class="op" id="5538553">(</span><span class="ident" id="5538554">a</span><span class="op" id="5538555">,</span>&nbsp;<span class="ident" id="5538557">b</span>&nbsp;<span class="builtintype" id="5538559">string</span><span class="op" id="5538565">)</span>&nbsp;<span class="builtintype" id="5538567">string</span>&nbsp;<span class="op" id="5538574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5538577">i</span>&nbsp;<span class="op" id="5538579">:=</span>&nbsp;<span class="num" id="5538582">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5538585">for</span>&nbsp;<span class="ident" id="5538589">i</span>&nbsp;<span class="op" id="5538591">&lt;</span>&nbsp;<span class="builtinfunc" id="5538593">len</span><span class="op" id="5538596">(</span><span class="ident" id="5538597">a</span><span class="op" id="5538598">)</span>&nbsp;<span class="op" id="5538600">&amp;&amp;</span>&nbsp;<span class="ident" id="5538603">i</span>&nbsp;<span class="op" id="5538605">&lt;</span>&nbsp;<span class="builtinfunc" id="5538607">len</span><span class="op" id="5538610">(</span><span class="ident" id="5538611">b</span><span class="op" id="5538612">)</span>&nbsp;<span class="op" id="5538614">&amp;&amp;</span>&nbsp;<span class="ident" id="5538617">a</span><span class="op" id="5538618">[</span><span class="ident" id="5538619">i</span><span class="op" id="5538620">]</span>&nbsp;<span class="op" id="5538622">==</span>&nbsp;<span class="ident" id="5538625">b</span><span class="op" id="5538626">[</span><span class="ident" id="5538627">i</span><span class="op" id="5538628">]</span>&nbsp;<span class="op" id="5538630">&amp;&amp;</span>&nbsp;<span class="op" id="5538633">(</span><span class="ident" id="5538634">a</span><span class="op" id="5538635">[</span><span class="ident" id="5538636">i</span><span class="op" id="5538637">]</span>&nbsp;<span class="op" id="5538639">&lt;=</span>&nbsp;<span class="string" id="5538642">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5538646">||</span>&nbsp;<span class="ident" id="5538649">a</span><span class="op" id="5538650">[</span><span class="ident" id="5538651">i</span><span class="op" id="5538652">]</span>&nbsp;<span class="op" id="5538654">==</span>&nbsp;<span class="string" id="5538657">&#39;*&#39;</span><span class="op" id="5538660">)</span>&nbsp;<span class="op" id="5538662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5538666">i</span><span class="op" id="5538667">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5538671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5538674">return</span>&nbsp;<span class="ident" id="5538681">a</span><span class="op" id="5538682">[</span><span class="num" id="5538683">0</span><span class="op" id="5538684">:</span><span class="ident" id="5538685">i</span><span class="op" id="5538686">]</span><br>
<span class="lineno"></span><span class="op" id="5538688">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="5538691">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="5538748">func</span>&nbsp;<span class="ident" id="5538753">trimRight</span><span class="op" id="5538762">(</span><span class="ident" id="5538763">s</span>&nbsp;<span class="builtintype" id="5538765">string</span><span class="op" id="5538771">)</span>&nbsp;<span class="builtintype" id="5538773">string</span>&nbsp;<span class="op" id="5538780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5538783">return</span>&nbsp;<span class="ident" id="5538790">strings</span><span class="op" id="5538797">.</span><span class="ident" id="5538798">TrimRightFunc</span><span class="op" id="5538811">(</span><span class="ident" id="5538812">s</span><span class="op" id="5538813">,</span>&nbsp;<span class="ident" id="5538815">unicode</span><span class="op" id="5538822">.</span><span class="ident" id="5538823">IsSpace</span><span class="op" id="5538830">)</span><br>
<span class="lineno"></span><span class="op" id="5538832">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="5538835">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5538919">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="5539004">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5539084">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="5539164">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="5539188">//</span><br>
<span class="lineno"></span><span class="keyword" id="5539191">func</span>&nbsp;<span class="ident" id="5539196">stripCommonPrefix</span><span class="op" id="5539213">(</span><span class="ident" id="5539214">lines</span>&nbsp;<span class="op" id="5539220">[</span><span class="op" id="5539221">]</span><span class="builtintype" id="5539222">string</span><span class="op" id="5539228">)</span>&nbsp;<span class="op" id="5539230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5539233">if</span>&nbsp;<span class="builtinfunc" id="5539236">len</span><span class="op" id="5539239">(</span><span class="ident" id="5539240">lines</span><span class="op" id="5539245">)</span>&nbsp;<span class="op" id="5539247">&lt;=</span>&nbsp;<span class="num" id="5539250">1</span>&nbsp;<span class="op" id="5539252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5539256">return</span>&nbsp;<span class="comment" id="5539263">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5539300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539303">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539323">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539380">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539437">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539491">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539549">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539607">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539665">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539706">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539768">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539830">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539891">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5539952">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5540012">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5540026">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5540030">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5540090">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5540150">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5540204">var</span>&nbsp;<span class="ident" id="5540208">prefix</span>&nbsp;<span class="builtintype" id="5540215">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5540223">if</span>&nbsp;<span class="builtinfunc" id="5540226">len</span><span class="op" id="5540229">(</span><span class="ident" id="5540230">lines</span><span class="op" id="5540235">)</span>&nbsp;<span class="op" id="5540237">&gt;</span>&nbsp;<span class="num" id="5540239">2</span>&nbsp;<span class="op" id="5540241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5540245">first</span>&nbsp;<span class="op" id="5540251">:=</span>&nbsp;<span class="builtintype" id="5540254">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5540261">for</span>&nbsp;<span class="ident" id="5540265">i</span><span class="op" id="5540266">,</span>&nbsp;<span class="ident" id="5540268">line</span>&nbsp;<span class="op" id="5540273">:=</span>&nbsp;<span class="keyword" id="5540276">range</span>&nbsp;<span class="ident" id="5540282">lines</span><span class="op" id="5540287">[</span><span class="num" id="5540288">1</span>&nbsp;<span class="op" id="5540290">:</span>&nbsp;<span class="builtinfunc" id="5540292">len</span><span class="op" id="5540295">(</span><span class="ident" id="5540296">lines</span><span class="op" id="5540301">)</span><span class="op" id="5540302">-</span><span class="num" id="5540303">1</span><span class="op" id="5540304">]</span>&nbsp;<span class="op" id="5540306">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5540311">switch</span>&nbsp;<span class="op" id="5540318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5540323">case</span>&nbsp;<span class="ident" id="5540328">isBlank</span><span class="op" id="5540335">(</span><span class="ident" id="5540336">line</span><span class="op" id="5540340">)</span><span class="op" id="5540341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5540347">lines</span><span class="op" id="5540352">[</span><span class="num" id="5540353">1</span><span class="op" id="5540354">+</span><span class="ident" id="5540355">i</span><span class="op" id="5540356">]</span>&nbsp;<span class="op" id="5540358">=</span>&nbsp;<span class="string" id="5540360">&#34;&#34;</span>&nbsp;<span class="comment" id="5540363">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5540396">case</span>&nbsp;<span class="ident" id="5540401">first</span><span class="op" id="5540406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5540412">prefix</span>&nbsp;<span class="op" id="5540419">=</span>&nbsp;<span class="ident" id="5540421">commonPrefix</span><span class="op" id="5540433">(</span><span class="ident" id="5540434">line</span><span class="op" id="5540438">,</span>&nbsp;<span class="ident" id="5540440">line</span><span class="op" id="5540444">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5540450">first</span>&nbsp;<span class="op" id="5540456">=</span>&nbsp;<span class="builtintype" id="5540458">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5540467">default</span><span class="op" id="5540474">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5540480">prefix</span>&nbsp;<span class="op" id="5540487">=</span>&nbsp;<span class="ident" id="5540489">commonPrefix</span><span class="op" id="5540501">(</span><span class="ident" id="5540502">prefix</span><span class="op" id="5540508">,</span>&nbsp;<span class="ident" id="5540510">line</span><span class="op" id="5540514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5540519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5540523">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5540526">}</span>&nbsp;<span class="keyword" id="5540528">else</span>&nbsp;<span class="op" id="5540533">{</span>&nbsp;<span class="comment" id="5540535">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5540599">line</span>&nbsp;<span class="op" id="5540604">:=</span>&nbsp;<span class="ident" id="5540607">lines</span><span class="op" id="5540612">[</span><span class="num" id="5540613">1</span><span class="op" id="5540614">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5540618">prefix</span>&nbsp;<span class="op" id="5540625">=</span>&nbsp;<span class="ident" id="5540627">commonPrefix</span><span class="op" id="5540639">(</span><span class="ident" id="5540640">line</span><span class="op" id="5540644">,</span>&nbsp;<span class="ident" id="5540646">line</span><span class="op" id="5540650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5540653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5540657">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5540737">lineOfStars</span>&nbsp;<span class="op" id="5540749">:=</span>&nbsp;<span class="builtintype" id="5540752">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5540759">if</span>&nbsp;<span class="ident" id="5540762">i</span>&nbsp;<span class="op" id="5540764">:=</span>&nbsp;<span class="ident" id="5540767">strings</span><span class="op" id="5540774">.</span><span class="ident" id="5540775">Index</span><span class="op" id="5540780">(</span><span class="ident" id="5540781">prefix</span><span class="op" id="5540787">,</span>&nbsp;<span class="string" id="5540789">&#34;*&#34;</span><span class="op" id="5540792">)</span><span class="op" id="5540793">;</span>&nbsp;<span class="ident" id="5540795">i</span>&nbsp;<span class="op" id="5540797">&gt;=</span>&nbsp;<span class="num" id="5540800">0</span>&nbsp;<span class="op" id="5540802">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5540806">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5540834">if</span>&nbsp;<span class="ident" id="5540837">i</span>&nbsp;<span class="op" id="5540839">&gt;</span>&nbsp;<span class="num" id="5540841">0</span>&nbsp;<span class="op" id="5540843">&amp;&amp;</span>&nbsp;<span class="ident" id="5540846">prefix</span><span class="op" id="5540852">[</span><span class="ident" id="5540853">i</span><span class="op" id="5540854">-</span><span class="num" id="5540855">1</span><span class="op" id="5540856">]</span>&nbsp;<span class="op" id="5540858">==</span>&nbsp;<span class="string" id="5540861">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5540865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5540870">i</span><span class="op" id="5540871">--</span>&nbsp;<span class="comment" id="5540874">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5540937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5540941">prefix</span>&nbsp;<span class="op" id="5540948">=</span>&nbsp;<span class="ident" id="5540950">prefix</span><span class="op" id="5540956">[</span><span class="num" id="5540957">0</span><span class="op" id="5540958">:</span><span class="ident" id="5540959">i</span><span class="op" id="5540960">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5540964">lineOfStars</span>&nbsp;<span class="op" id="5540976">=</span>&nbsp;<span class="builtintype" id="5540978">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5540984">}</span>&nbsp;<span class="keyword" id="5540986">else</span>&nbsp;<span class="op" id="5540991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5540995">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5541026">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5541088">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5541150">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5541213">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5541274">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5541336">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5541397">first</span>&nbsp;<span class="op" id="5541403">:=</span>&nbsp;<span class="ident" id="5541406">lines</span><span class="op" id="5541411">[</span><span class="num" id="5541412">0</span><span class="op" id="5541413">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5541417">if</span>&nbsp;<span class="ident" id="5541420">isBlank</span><span class="op" id="5541427">(</span><span class="ident" id="5541428">first</span><span class="op" id="5541433">[</span><span class="num" id="5541434">2</span><span class="op" id="5541435">:</span><span class="op" id="5541436">]</span><span class="op" id="5541437">)</span>&nbsp;<span class="op" id="5541439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5541444">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5541485">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5541532">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5541584">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5541637">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5541662">i</span>&nbsp;<span class="op" id="5541664">:=</span>&nbsp;<span class="builtinfunc" id="5541667">len</span><span class="op" id="5541670">(</span><span class="ident" id="5541671">prefix</span><span class="op" id="5541677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5541682">for</span>&nbsp;<span class="ident" id="5541686">n</span>&nbsp;<span class="op" id="5541688">:=</span>&nbsp;<span class="num" id="5541691">0</span><span class="op" id="5541692">;</span>&nbsp;<span class="ident" id="5541694">n</span>&nbsp;<span class="op" id="5541696">&lt;</span>&nbsp;<span class="num" id="5541698">3</span>&nbsp;<span class="op" id="5541700">&amp;&amp;</span>&nbsp;<span class="ident" id="5541703">i</span>&nbsp;<span class="op" id="5541705">&gt;</span>&nbsp;<span class="num" id="5541707">0</span>&nbsp;<span class="op" id="5541709">&amp;&amp;</span>&nbsp;<span class="ident" id="5541712">prefix</span><span class="op" id="5541718">[</span><span class="ident" id="5541719">i</span><span class="op" id="5541720">-</span><span class="num" id="5541721">1</span><span class="op" id="5541722">]</span>&nbsp;<span class="op" id="5541724">==</span>&nbsp;<span class="string" id="5541727">&#39;&nbsp;&#39;</span><span class="op" id="5541730">;</span>&nbsp;<span class="ident" id="5541732">n</span><span class="op" id="5541733">++</span>&nbsp;<span class="op" id="5541736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5541742">i</span><span class="op" id="5541743">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5541749">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5541754">if</span>&nbsp;<span class="ident" id="5541757">i</span>&nbsp;<span class="op" id="5541759">==</span>&nbsp;<span class="builtinfunc" id="5541762">len</span><span class="op" id="5541765">(</span><span class="ident" id="5541766">prefix</span><span class="op" id="5541772">)</span>&nbsp;<span class="op" id="5541774">&amp;&amp;</span>&nbsp;<span class="ident" id="5541777">i</span>&nbsp;<span class="op" id="5541779">&gt;</span>&nbsp;<span class="num" id="5541781">0</span>&nbsp;<span class="op" id="5541783">&amp;&amp;</span>&nbsp;<span class="ident" id="5541786">prefix</span><span class="op" id="5541792">[</span><span class="ident" id="5541793">i</span><span class="op" id="5541794">-</span><span class="num" id="5541795">1</span><span class="op" id="5541796">]</span>&nbsp;<span class="op" id="5541798">==</span>&nbsp;<span class="string" id="5541801">&#39;\t&#39;</span>&nbsp;<span class="op" id="5541806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5541812">i</span><span class="op" id="5541813">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5541819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5541824">prefix</span>&nbsp;<span class="op" id="5541831">=</span>&nbsp;<span class="ident" id="5541833">prefix</span><span class="op" id="5541839">[</span><span class="num" id="5541840">0</span><span class="op" id="5541841">:</span><span class="ident" id="5541842">i</span><span class="op" id="5541843">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5541847">}</span>&nbsp;<span class="keyword" id="5541849">else</span>&nbsp;<span class="op" id="5541854">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5541859">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5541896">suffix</span>&nbsp;<span class="op" id="5541903">:=</span>&nbsp;<span class="builtinfunc" id="5541906">make</span><span class="op" id="5541910">(</span><span class="op" id="5541911">[</span><span class="op" id="5541912">]</span><span class="builtintype" id="5541913">byte</span><span class="op" id="5541917">,</span>&nbsp;<span class="builtinfunc" id="5541919">len</span><span class="op" id="5541922">(</span><span class="ident" id="5541923">first</span><span class="op" id="5541928">)</span><span class="op" id="5541929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5541934">n</span>&nbsp;<span class="op" id="5541936">:=</span>&nbsp;<span class="num" id="5541939">2</span>&nbsp;<span class="comment" id="5541941">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5541970">for</span>&nbsp;<span class="ident" id="5541974">n</span>&nbsp;<span class="op" id="5541976">&lt;</span>&nbsp;<span class="builtinfunc" id="5541978">len</span><span class="op" id="5541981">(</span><span class="ident" id="5541982">first</span><span class="op" id="5541987">)</span>&nbsp;<span class="op" id="5541989">&amp;&amp;</span>&nbsp;<span class="ident" id="5541992">first</span><span class="op" id="5541997">[</span><span class="ident" id="5541998">n</span><span class="op" id="5541999">]</span>&nbsp;<span class="op" id="5542001">&lt;=</span>&nbsp;<span class="string" id="5542004">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5542008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542014">suffix</span><span class="op" id="5542020">[</span><span class="ident" id="5542021">n</span><span class="op" id="5542022">]</span>&nbsp;<span class="op" id="5542024">=</span>&nbsp;<span class="ident" id="5542026">first</span><span class="op" id="5542031">[</span><span class="ident" id="5542032">n</span><span class="op" id="5542033">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542039">n</span><span class="op" id="5542040">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5542046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5542051">if</span>&nbsp;<span class="ident" id="5542054">n</span>&nbsp;<span class="op" id="5542056">&gt;</span>&nbsp;<span class="num" id="5542058">2</span>&nbsp;<span class="op" id="5542060">&amp;&amp;</span>&nbsp;<span class="ident" id="5542063">suffix</span><span class="op" id="5542069">[</span><span class="num" id="5542070">2</span><span class="op" id="5542071">]</span>&nbsp;<span class="op" id="5542073">==</span>&nbsp;<span class="string" id="5542076">&#39;\t&#39;</span>&nbsp;<span class="op" id="5542081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5542087">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542133">suffix</span>&nbsp;<span class="op" id="5542140">=</span>&nbsp;<span class="ident" id="5542142">suffix</span><span class="op" id="5542148">[</span><span class="num" id="5542149">2</span><span class="op" id="5542150">:</span><span class="ident" id="5542151">n</span><span class="op" id="5542152">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5542157">}</span>&nbsp;<span class="keyword" id="5542159">else</span>&nbsp;<span class="op" id="5542164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5542170">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542205">suffix</span><span class="op" id="5542211">[</span><span class="num" id="5542212">0</span><span class="op" id="5542213">]</span><span class="op" id="5542214">,</span>&nbsp;<span class="ident" id="5542216">suffix</span><span class="op" id="5542222">[</span><span class="num" id="5542223">1</span><span class="op" id="5542224">]</span>&nbsp;<span class="op" id="5542226">=</span>&nbsp;<span class="string" id="5542228">&#39;&nbsp;&#39;</span><span class="op" id="5542231">,</span>&nbsp;<span class="string" id="5542233">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542241">suffix</span>&nbsp;<span class="op" id="5542248">=</span>&nbsp;<span class="ident" id="5542250">suffix</span><span class="op" id="5542256">[</span><span class="num" id="5542257">0</span><span class="op" id="5542258">:</span><span class="ident" id="5542259">n</span><span class="op" id="5542260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5542265">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5542270">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5542328">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542382">prefix</span>&nbsp;<span class="op" id="5542389">=</span>&nbsp;<span class="ident" id="5542391">strings</span><span class="op" id="5542398">.</span><span class="ident" id="5542399">TrimSuffix</span><span class="op" id="5542409">(</span><span class="ident" id="5542410">prefix</span><span class="op" id="5542416">,</span>&nbsp;<span class="builtintype" id="5542418">string</span><span class="op" id="5542424">(</span><span class="ident" id="5542425">suffix</span><span class="op" id="5542431">)</span><span class="op" id="5542432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5542436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5542439">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5542443">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5542508">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5542573">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542584">last</span>&nbsp;<span class="op" id="5542589">:=</span>&nbsp;<span class="ident" id="5542592">lines</span><span class="op" id="5542597">[</span><span class="builtinfunc" id="5542598">len</span><span class="op" id="5542601">(</span><span class="ident" id="5542602">lines</span><span class="op" id="5542607">)</span><span class="op" id="5542608">-</span><span class="num" id="5542609">1</span><span class="op" id="5542610">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542613">closing</span>&nbsp;<span class="op" id="5542621">:=</span>&nbsp;<span class="string" id="5542624">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542630">i</span>&nbsp;<span class="op" id="5542632">:=</span>&nbsp;<span class="ident" id="5542635">strings</span><span class="op" id="5542642">.</span><span class="ident" id="5542643">Index</span><span class="op" id="5542648">(</span><span class="ident" id="5542649">last</span><span class="op" id="5542653">,</span>&nbsp;<span class="ident" id="5542655">closing</span><span class="op" id="5542662">)</span>&nbsp;<span class="comment" id="5542664">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5542703">if</span>&nbsp;<span class="ident" id="5542706">isBlank</span><span class="op" id="5542713">(</span><span class="ident" id="5542714">last</span><span class="op" id="5542718">[</span><span class="num" id="5542719">0</span><span class="op" id="5542720">:</span><span class="ident" id="5542721">i</span><span class="op" id="5542722">]</span><span class="op" id="5542723">)</span>&nbsp;<span class="op" id="5542725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5542729">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5542769">if</span>&nbsp;<span class="ident" id="5542772">lineOfStars</span>&nbsp;<span class="op" id="5542784">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542789">closing</span>&nbsp;<span class="op" id="5542797">=</span>&nbsp;<span class="string" id="5542799">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="5542805">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5542840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542844">lines</span><span class="op" id="5542849">[</span><span class="builtinfunc" id="5542850">len</span><span class="op" id="5542853">(</span><span class="ident" id="5542854">lines</span><span class="op" id="5542859">)</span><span class="op" id="5542860">-</span><span class="num" id="5542861">1</span><span class="op" id="5542862">]</span>&nbsp;<span class="op" id="5542864">=</span>&nbsp;<span class="ident" id="5542866">prefix</span>&nbsp;<span class="op" id="5542873">+</span>&nbsp;<span class="ident" id="5542875">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5542884">}</span>&nbsp;<span class="keyword" id="5542886">else</span>&nbsp;<span class="op" id="5542891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5542895">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5542946">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5542998">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543025">prefix</span>&nbsp;<span class="op" id="5543032">=</span>&nbsp;<span class="ident" id="5543034">commonPrefix</span><span class="op" id="5543046">(</span><span class="ident" id="5543047">prefix</span><span class="op" id="5543053">,</span>&nbsp;<span class="ident" id="5543055">last</span><span class="op" id="5543059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5543062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5543066">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5543135">for</span>&nbsp;<span class="ident" id="5543139">i</span><span class="op" id="5543140">,</span>&nbsp;<span class="ident" id="5543142">line</span>&nbsp;<span class="op" id="5543147">:=</span>&nbsp;<span class="keyword" id="5543150">range</span>&nbsp;<span class="ident" id="5543156">lines</span>&nbsp;<span class="op" id="5543162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5543166">if</span>&nbsp;<span class="ident" id="5543169">i</span>&nbsp;<span class="op" id="5543171">&gt;</span>&nbsp;<span class="num" id="5543173">0</span>&nbsp;<span class="op" id="5543175">&amp;&amp;</span>&nbsp;<span class="ident" id="5543178">line</span>&nbsp;<span class="op" id="5543183">!=</span>&nbsp;<span class="string" id="5543186">&#34;&#34;</span>&nbsp;<span class="op" id="5543189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543194">lines</span><span class="op" id="5543199">[</span><span class="ident" id="5543200">i</span><span class="op" id="5543201">]</span>&nbsp;<span class="op" id="5543203">=</span>&nbsp;<span class="ident" id="5543205">line</span><span class="op" id="5543209">[</span><span class="builtinfunc" id="5543210">len</span><span class="op" id="5543213">(</span><span class="ident" id="5543214">prefix</span><span class="op" id="5543220">)</span><span class="op" id="5543221">:</span><span class="op" id="5543222">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5543226">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5543229">}</span><br>
<span class="lineno"></span><span class="op" id="5543231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5543234">func</span>&nbsp;<span class="op" id="5543239">(</span><span class="ident" id="5543240">p</span>&nbsp;<span class="op" id="5543242">*</span><span class="ident" id="5543243">printer</span><span class="op" id="5543250">)</span>&nbsp;<span class="ident" id="5543252">writeComment</span><span class="op" id="5543264">(</span><span class="ident" id="5543265">comment</span>&nbsp;<span class="op" id="5543273">*</span><span class="ident" id="5543274">ast</span><span class="op" id="5543277">.</span><span class="ident" id="5543278">Comment</span><span class="op" id="5543285">)</span>&nbsp;<span class="op" id="5543287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543290">text</span>&nbsp;<span class="op" id="5543295">:=</span>&nbsp;<span class="ident" id="5543298">comment</span><span class="op" id="5543305">.</span><span class="ident" id="5543306">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543312">pos</span>&nbsp;<span class="op" id="5543316">:=</span>&nbsp;<span class="ident" id="5543319">p</span><span class="op" id="5543320">.</span><span class="ident" id="5543321">posFor</span><span class="op" id="5543327">(</span><span class="ident" id="5543328">comment</span><span class="op" id="5543335">.</span><span class="ident" id="5543336">Pos</span><span class="op" id="5543339">(</span><span class="op" id="5543340">)</span><span class="op" id="5543341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5543345">const</span>&nbsp;<span class="ident" id="5543351">linePrefix</span>&nbsp;<span class="op" id="5543362">=</span>&nbsp;<span class="string" id="5543364">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5543375">if</span>&nbsp;<span class="ident" id="5543378">strings</span><span class="op" id="5543385">.</span><span class="ident" id="5543386">HasPrefix</span><span class="op" id="5543395">(</span><span class="ident" id="5543396">text</span><span class="op" id="5543400">,</span>&nbsp;<span class="ident" id="5543402">linePrefix</span><span class="op" id="5543412">)</span>&nbsp;<span class="op" id="5543414">&amp;&amp;</span>&nbsp;<span class="op" id="5543417">(</span><span class="op" id="5543418">!</span><span class="ident" id="5543419">pos</span><span class="op" id="5543422">.</span><span class="ident" id="5543423">IsValid</span><span class="op" id="5543430">(</span><span class="op" id="5543431">)</span>&nbsp;<span class="op" id="5543433">||</span>&nbsp;<span class="ident" id="5543436">pos</span><span class="op" id="5543439">.</span><span class="ident" id="5543440">Column</span>&nbsp;<span class="op" id="5543447">==</span>&nbsp;<span class="num" id="5543450">1</span><span class="op" id="5543451">)</span>&nbsp;<span class="op" id="5543453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5543457">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543488">ldir</span>&nbsp;<span class="op" id="5543493">:=</span>&nbsp;<span class="ident" id="5543496">strings</span><span class="op" id="5543503">.</span><span class="ident" id="5543504">TrimSpace</span><span class="op" id="5543513">(</span><span class="ident" id="5543514">text</span><span class="op" id="5543518">[</span><span class="builtinfunc" id="5543519">len</span><span class="op" id="5543522">(</span><span class="ident" id="5543523">linePrefix</span><span class="op" id="5543533">)</span><span class="op" id="5543534">:</span><span class="op" id="5543535">]</span><span class="op" id="5543536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5543540">if</span>&nbsp;<span class="ident" id="5543543">i</span>&nbsp;<span class="op" id="5543545">:=</span>&nbsp;<span class="ident" id="5543548">strings</span><span class="op" id="5543555">.</span><span class="ident" id="5543556">LastIndex</span><span class="op" id="5543565">(</span><span class="ident" id="5543566">ldir</span><span class="op" id="5543570">,</span>&nbsp;<span class="string" id="5543572">&#34;:&#34;</span><span class="op" id="5543575">)</span><span class="op" id="5543576">;</span>&nbsp;<span class="ident" id="5543578">i</span>&nbsp;<span class="op" id="5543580">&gt;=</span>&nbsp;<span class="num" id="5543583">0</span>&nbsp;<span class="op" id="5543585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5543590">if</span>&nbsp;<span class="ident" id="5543593">line</span><span class="op" id="5543597">,</span>&nbsp;<span class="ident" id="5543599">err</span>&nbsp;<span class="op" id="5543603">:=</span>&nbsp;<span class="ident" id="5543606">strconv</span><span class="op" id="5543613">.</span><span class="ident" id="5543614">Atoi</span><span class="op" id="5543618">(</span><span class="ident" id="5543619">ldir</span><span class="op" id="5543623">[</span><span class="ident" id="5543624">i</span><span class="op" id="5543625">+</span><span class="num" id="5543626">1</span><span class="op" id="5543627">:</span><span class="op" id="5543628">]</span><span class="op" id="5543629">)</span><span class="op" id="5543630">;</span>&nbsp;<span class="ident" id="5543632">err</span>&nbsp;<span class="op" id="5543636">==</span>&nbsp;<span class="builtintype" id="5543639">nil</span>&nbsp;<span class="op" id="5543643">&amp;&amp;</span>&nbsp;<span class="ident" id="5543646">line</span>&nbsp;<span class="op" id="5543651">&gt;</span>&nbsp;<span class="num" id="5543653">0</span>&nbsp;<span class="op" id="5543655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5543661">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5543717">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5543773">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5543829">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543885">indent</span>&nbsp;<span class="op" id="5543892">:=</span>&nbsp;<span class="ident" id="5543895">p</span><span class="op" id="5543896">.</span><span class="ident" id="5543897">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543908">p</span><span class="op" id="5543909">.</span><span class="ident" id="5543910">indent</span>&nbsp;<span class="op" id="5543917">=</span>&nbsp;<span class="num" id="5543919">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5543925">defer</span>&nbsp;<span class="keyword" id="5543931">func</span><span class="op" id="5543935">(</span><span class="op" id="5543936">)</span>&nbsp;<span class="op" id="5543938">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543945">p</span><span class="op" id="5543946">.</span><span class="ident" id="5543947">pos</span><span class="op" id="5543950">.</span><span class="ident" id="5543951">Filename</span>&nbsp;<span class="op" id="5543960">=</span>&nbsp;<span class="ident" id="5543962">ldir</span><span class="op" id="5543966">[</span><span class="op" id="5543967">:</span><span class="ident" id="5543968">i</span><span class="op" id="5543969">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543976">p</span><span class="op" id="5543977">.</span><span class="ident" id="5543978">pos</span><span class="op" id="5543981">.</span><span class="ident" id="5543982">Line</span>&nbsp;<span class="op" id="5543987">=</span>&nbsp;<span class="ident" id="5543989">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543999">p</span><span class="op" id="5544000">.</span><span class="ident" id="5544001">pos</span><span class="op" id="5544004">.</span><span class="ident" id="5544005">Column</span>&nbsp;<span class="op" id="5544012">=</span>&nbsp;<span class="num" id="5544014">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5544021">p</span><span class="op" id="5544022">.</span><span class="ident" id="5544023">indent</span>&nbsp;<span class="op" id="5544030">=</span>&nbsp;<span class="ident" id="5544032">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5544043">}</span><span class="op" id="5544044">(</span><span class="op" id="5544045">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5544050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5544054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5544057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5544061">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5544107">if</span>&nbsp;<span class="ident" id="5544110">text</span><span class="op" id="5544114">[</span><span class="num" id="5544115">1</span><span class="op" id="5544116">]</span>&nbsp;<span class="op" id="5544118">==</span>&nbsp;<span class="string" id="5544121">&#39;/&#39;</span>&nbsp;<span class="op" id="5544125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5544129">p</span><span class="op" id="5544130">.</span><span class="ident" id="5544131">writeString</span><span class="op" id="5544142">(</span><span class="ident" id="5544143">pos</span><span class="op" id="5544146">,</span>&nbsp;<span class="ident" id="5544148">trimRight</span><span class="op" id="5544157">(</span><span class="ident" id="5544158">text</span><span class="op" id="5544162">)</span><span class="op" id="5544163">,</span>&nbsp;<span class="builtintype" id="5544165">true</span><span class="op" id="5544169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5544173">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5544181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5544185">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5544243">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5544298">lines</span>&nbsp;<span class="op" id="5544304">:=</span>&nbsp;<span class="ident" id="5544307">strings</span><span class="op" id="5544314">.</span><span class="ident" id="5544315">Split</span><span class="op" id="5544320">(</span><span class="ident" id="5544321">text</span><span class="op" id="5544325">,</span>&nbsp;<span class="string" id="5544327">&#34;\n&#34;</span><span class="op" id="5544331">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5544335">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5544392">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5544454">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5544515">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5544578">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5544638">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5544668">if</span>&nbsp;<span class="ident" id="5544671">pos</span><span class="op" id="5544674">.</span><span class="ident" id="5544675">IsValid</span><span class="op" id="5544682">(</span><span class="op" id="5544683">)</span>&nbsp;<span class="op" id="5544685">&amp;&amp;</span>&nbsp;<span class="ident" id="5544688">pos</span><span class="op" id="5544691">.</span><span class="ident" id="5544692">Column</span>&nbsp;<span class="op" id="5544699">==</span>&nbsp;<span class="num" id="5544702">1</span>&nbsp;<span class="op" id="5544704">&amp;&amp;</span>&nbsp;<span class="ident" id="5544707">p</span><span class="op" id="5544708">.</span><span class="ident" id="5544709">indent</span>&nbsp;<span class="op" id="5544716">&gt;</span>&nbsp;<span class="num" id="5544718">0</span>&nbsp;<span class="op" id="5544720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5544724">for</span>&nbsp;<span class="ident" id="5544728">i</span><span class="op" id="5544729">,</span>&nbsp;<span class="ident" id="5544731">line</span>&nbsp;<span class="op" id="5544736">:=</span>&nbsp;<span class="keyword" id="5544739">range</span>&nbsp;<span class="ident" id="5544745">lines</span><span class="op" id="5544750">[</span><span class="num" id="5544751">1</span><span class="op" id="5544752">:</span><span class="op" id="5544753">]</span>&nbsp;<span class="op" id="5544755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5544760">lines</span><span class="op" id="5544765">[</span><span class="num" id="5544766">1</span><span class="op" id="5544767">+</span><span class="ident" id="5544768">i</span><span class="op" id="5544769">]</span>&nbsp;<span class="op" id="5544771">=</span>&nbsp;<span class="string" id="5544773">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="5544779">+</span>&nbsp;<span class="ident" id="5544781">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5544788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5544791">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5544795">stripCommonPrefix</span><span class="op" id="5544812">(</span><span class="ident" id="5544813">lines</span><span class="op" id="5544818">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5544822">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5544870">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5544915">for</span>&nbsp;<span class="ident" id="5544919">i</span><span class="op" id="5544920">,</span>&nbsp;<span class="ident" id="5544922">line</span>&nbsp;<span class="op" id="5544927">:=</span>&nbsp;<span class="keyword" id="5544930">range</span>&nbsp;<span class="ident" id="5544936">lines</span>&nbsp;<span class="op" id="5544942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5544946">if</span>&nbsp;<span class="ident" id="5544949">i</span>&nbsp;<span class="op" id="5544951">&gt;</span>&nbsp;<span class="num" id="5544953">0</span>&nbsp;<span class="op" id="5544955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5544960">p</span><span class="op" id="5544961">.</span><span class="ident" id="5544962">writeByte</span><span class="op" id="5544971">(</span><span class="string" id="5544972">&#39;\f&#39;</span><span class="op" id="5544976">,</span>&nbsp;<span class="num" id="5544978">1</span><span class="op" id="5544979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5544984">pos</span>&nbsp;<span class="op" id="5544988">=</span>&nbsp;<span class="ident" id="5544990">p</span><span class="op" id="5544991">.</span><span class="ident" id="5544992">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5544998">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545002">if</span>&nbsp;<span class="builtinfunc" id="5545005">len</span><span class="op" id="5545008">(</span><span class="ident" id="5545009">line</span><span class="op" id="5545013">)</span>&nbsp;<span class="op" id="5545015">&gt;</span>&nbsp;<span class="num" id="5545017">0</span>&nbsp;<span class="op" id="5545019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545024">p</span><span class="op" id="5545025">.</span><span class="ident" id="5545026">writeString</span><span class="op" id="5545037">(</span><span class="ident" id="5545038">pos</span><span class="op" id="5545041">,</span>&nbsp;<span class="ident" id="5545043">trimRight</span><span class="op" id="5545052">(</span><span class="ident" id="5545053">line</span><span class="op" id="5545057">)</span><span class="op" id="5545058">,</span>&nbsp;<span class="builtintype" id="5545060">true</span><span class="op" id="5545064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5545068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5545071">}</span><br>
<span class="lineno"></span><span class="op" id="5545073">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5545076">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="5545147">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="5545218">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5545287">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="5545355">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5545427">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5545438">//</span><br>
<span class="lineno"></span><span class="keyword" id="5545441">func</span>&nbsp;<span class="op" id="5545446">(</span><span class="ident" id="5545447">p</span>&nbsp;<span class="op" id="5545449">*</span><span class="ident" id="5545450">printer</span><span class="op" id="5545457">)</span>&nbsp;<span class="ident" id="5545459">writeCommentSuffix</span><span class="op" id="5545477">(</span><span class="ident" id="5545478">needsLinebreak</span>&nbsp;<span class="builtintype" id="5545493">bool</span><span class="op" id="5545497">)</span>&nbsp;<span class="op" id="5545499">(</span><span class="ident" id="5545500">wroteNewline</span><span class="op" id="5545512">,</span>&nbsp;<span class="ident" id="5545514">droppedFF</span>&nbsp;<span class="builtintype" id="5545524">bool</span><span class="op" id="5545528">)</span>&nbsp;<span class="op" id="5545530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545533">for</span>&nbsp;<span class="ident" id="5545537">i</span><span class="op" id="5545538">,</span>&nbsp;<span class="ident" id="5545540">ch</span>&nbsp;<span class="op" id="5545543">:=</span>&nbsp;<span class="keyword" id="5545546">range</span>&nbsp;<span class="ident" id="5545552">p</span><span class="op" id="5545553">.</span><span class="ident" id="5545554">wsbuf</span>&nbsp;<span class="op" id="5545560">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545564">switch</span>&nbsp;<span class="ident" id="5545571">ch</span>&nbsp;<span class="op" id="5545574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545578">case</span>&nbsp;<span class="ident" id="5545583">blank</span><span class="op" id="5545588">,</span>&nbsp;<span class="ident" id="5545590">vtab</span><span class="op" id="5545594">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5545599">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545632">p</span><span class="op" id="5545633">.</span><span class="ident" id="5545634">wsbuf</span><span class="op" id="5545639">[</span><span class="ident" id="5545640">i</span><span class="op" id="5545641">]</span>&nbsp;<span class="op" id="5545643">=</span>&nbsp;<span class="ident" id="5545645">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545654">case</span>&nbsp;<span class="ident" id="5545659">indent</span><span class="op" id="5545665">,</span>&nbsp;<span class="ident" id="5545667">unindent</span><span class="op" id="5545675">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5545680">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545720">case</span>&nbsp;<span class="ident" id="5545725">newline</span><span class="op" id="5545732">,</span>&nbsp;<span class="ident" id="5545734">formfeed</span><span class="op" id="5545742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5545747">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5545795">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545842">if</span>&nbsp;<span class="ident" id="5545845">needsLinebreak</span>&nbsp;<span class="op" id="5545860">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545866">needsLinebreak</span>&nbsp;<span class="op" id="5545881">=</span>&nbsp;<span class="builtintype" id="5545883">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545893">wroteNewline</span>&nbsp;<span class="op" id="5545906">=</span>&nbsp;<span class="builtintype" id="5545908">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5545916">}</span>&nbsp;<span class="keyword" id="5545918">else</span>&nbsp;<span class="op" id="5545923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545929">if</span>&nbsp;<span class="ident" id="5545932">ch</span>&nbsp;<span class="op" id="5545935">==</span>&nbsp;<span class="ident" id="5545938">formfeed</span>&nbsp;<span class="op" id="5545947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545954">droppedFF</span>&nbsp;<span class="op" id="5545964">=</span>&nbsp;<span class="builtintype" id="5545966">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5545975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545981">p</span><span class="op" id="5545982">.</span><span class="ident" id="5545983">wsbuf</span><span class="op" id="5545988">[</span><span class="ident" id="5545989">i</span><span class="op" id="5545990">]</span>&nbsp;<span class="op" id="5545992">=</span>&nbsp;<span class="ident" id="5545994">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546011">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546014">p</span><span class="op" id="5546015">.</span><span class="ident" id="5546016">writeWhitespace</span><span class="op" id="5546031">(</span><span class="builtinfunc" id="5546032">len</span><span class="op" id="5546035">(</span><span class="ident" id="5546036">p</span><span class="op" id="5546037">.</span><span class="ident" id="5546038">wsbuf</span><span class="op" id="5546043">)</span><span class="op" id="5546044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5546048">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546083">if</span>&nbsp;<span class="ident" id="5546086">needsLinebreak</span>&nbsp;<span class="op" id="5546101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546105">p</span><span class="op" id="5546106">.</span><span class="ident" id="5546107">writeByte</span><span class="op" id="5546116">(</span><span class="string" id="5546117">&#39;\n&#39;</span><span class="op" id="5546121">,</span>&nbsp;<span class="num" id="5546123">1</span><span class="op" id="5546124">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546128">wroteNewline</span>&nbsp;<span class="op" id="5546141">=</span>&nbsp;<span class="builtintype" id="5546143">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546153">return</span><br>
<span class="lineno"></span><span class="op" id="5546160">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="5546163">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="5546242">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5546323">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="5546402">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="5546480">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5546560">//</span><br>
<span class="lineno"></span><span class="keyword" id="5546563">func</span>&nbsp;<span class="op" id="5546568">(</span><span class="ident" id="5546569">p</span>&nbsp;<span class="op" id="5546571">*</span><span class="ident" id="5546572">printer</span><span class="op" id="5546579">)</span>&nbsp;<span class="ident" id="5546581">intersperseComments</span><span class="op" id="5546600">(</span><span class="ident" id="5546601">next</span>&nbsp;<span class="ident" id="5546606">token</span><span class="op" id="5546611">.</span><span class="ident" id="5546612">Position</span><span class="op" id="5546620">,</span>&nbsp;<span class="ident" id="5546622">tok</span>&nbsp;<span class="ident" id="5546626">token</span><span class="op" id="5546631">.</span><span class="ident" id="5546632">Token</span><span class="op" id="5546637">)</span>&nbsp;<span class="op" id="5546639">(</span><span class="ident" id="5546640">wroteNewline</span><span class="op" id="5546652">,</span>&nbsp;<span class="ident" id="5546654">droppedFF</span>&nbsp;<span class="builtintype" id="5546664">bool</span><span class="op" id="5546668">)</span>&nbsp;<span class="op" id="5546670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546673">var</span>&nbsp;<span class="ident" id="5546677">last</span>&nbsp;<span class="op" id="5546682">*</span><span class="ident" id="5546683">ast</span><span class="op" id="5546686">.</span><span class="ident" id="5546687">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546696">for</span>&nbsp;<span class="ident" id="5546700">p</span><span class="op" id="5546701">.</span><span class="ident" id="5546702">commentBefore</span><span class="op" id="5546715">(</span><span class="ident" id="5546716">next</span><span class="op" id="5546720">)</span>&nbsp;<span class="op" id="5546722">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546726">for</span>&nbsp;<span class="ident" id="5546730">_</span><span class="op" id="5546731">,</span>&nbsp;<span class="ident" id="5546733">c</span>&nbsp;<span class="op" id="5546735">:=</span>&nbsp;<span class="keyword" id="5546738">range</span>&nbsp;<span class="ident" id="5546744">p</span><span class="op" id="5546745">.</span><span class="ident" id="5546746">comment</span><span class="op" id="5546753">.</span><span class="ident" id="5546754">List</span>&nbsp;<span class="op" id="5546759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546764">p</span><span class="op" id="5546765">.</span><span class="ident" id="5546766">writeCommentPrefix</span><span class="op" id="5546784">(</span><span class="ident" id="5546785">p</span><span class="op" id="5546786">.</span><span class="ident" id="5546787">posFor</span><span class="op" id="5546793">(</span><span class="ident" id="5546794">c</span><span class="op" id="5546795">.</span><span class="ident" id="5546796">Pos</span><span class="op" id="5546799">(</span><span class="op" id="5546800">)</span><span class="op" id="5546801">)</span><span class="op" id="5546802">,</span>&nbsp;<span class="ident" id="5546804">next</span><span class="op" id="5546808">,</span>&nbsp;<span class="ident" id="5546810">last</span><span class="op" id="5546814">,</span>&nbsp;<span class="ident" id="5546816">c</span><span class="op" id="5546817">,</span>&nbsp;<span class="ident" id="5546819">tok</span><span class="op" id="5546822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546827">p</span><span class="op" id="5546828">.</span><span class="ident" id="5546829">writeComment</span><span class="op" id="5546841">(</span><span class="ident" id="5546842">c</span><span class="op" id="5546843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546848">last</span>&nbsp;<span class="op" id="5546853">=</span>&nbsp;<span class="ident" id="5546855">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546859">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546863">p</span><span class="op" id="5546864">.</span><span class="ident" id="5546865">nextComment</span><span class="op" id="5546876">(</span><span class="op" id="5546877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546884">if</span>&nbsp;<span class="ident" id="5546887">last</span>&nbsp;<span class="op" id="5546892">!=</span>&nbsp;<span class="builtintype" id="5546895">nil</span>&nbsp;<span class="op" id="5546899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5546903">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5546968">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547038">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547106">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547172">if</span>&nbsp;<span class="ident" id="5547175">p</span><span class="op" id="5547176">.</span><span class="ident" id="5547177">mode</span><span class="op" id="5547181">&amp;</span><span class="ident" id="5547182">noExtraBlank</span>&nbsp;<span class="op" id="5547195">==</span>&nbsp;<span class="num" id="5547198">0</span>&nbsp;<span class="op" id="5547200">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547206">last</span><span class="op" id="5547210">.</span><span class="ident" id="5547211">Text</span><span class="op" id="5547215">[</span><span class="num" id="5547216">1</span><span class="op" id="5547217">]</span>&nbsp;<span class="op" id="5547219">==</span>&nbsp;<span class="string" id="5547222">&#39;*&#39;</span>&nbsp;<span class="op" id="5547226">&amp;&amp;</span>&nbsp;<span class="ident" id="5547229">p</span><span class="op" id="5547230">.</span><span class="ident" id="5547231">lineFor</span><span class="op" id="5547238">(</span><span class="ident" id="5547239">last</span><span class="op" id="5547243">.</span><span class="ident" id="5547244">Pos</span><span class="op" id="5547247">(</span><span class="op" id="5547248">)</span><span class="op" id="5547249">)</span>&nbsp;<span class="op" id="5547251">==</span>&nbsp;<span class="ident" id="5547254">next</span><span class="op" id="5547258">.</span><span class="ident" id="5547259">Line</span>&nbsp;<span class="op" id="5547264">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547270">tok</span>&nbsp;<span class="op" id="5547274">!=</span>&nbsp;<span class="ident" id="5547277">token</span><span class="op" id="5547282">.</span><span class="ident" id="5547283">COMMA</span>&nbsp;<span class="op" id="5547289">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547295">(</span><span class="ident" id="5547296">tok</span>&nbsp;<span class="op" id="5547300">!=</span>&nbsp;<span class="ident" id="5547303">token</span><span class="op" id="5547308">.</span><span class="ident" id="5547309">RPAREN</span>&nbsp;<span class="op" id="5547316">||</span>&nbsp;<span class="ident" id="5547319">p</span><span class="op" id="5547320">.</span><span class="ident" id="5547321">prevOpen</span>&nbsp;<span class="op" id="5547330">==</span>&nbsp;<span class="ident" id="5547333">token</span><span class="op" id="5547338">.</span><span class="ident" id="5547339">LPAREN</span><span class="op" id="5547345">)</span>&nbsp;<span class="op" id="5547347">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547353">(</span><span class="ident" id="5547354">tok</span>&nbsp;<span class="op" id="5547358">!=</span>&nbsp;<span class="ident" id="5547361">token</span><span class="op" id="5547366">.</span><span class="ident" id="5547367">RBRACK</span>&nbsp;<span class="op" id="5547374">||</span>&nbsp;<span class="ident" id="5547377">p</span><span class="op" id="5547378">.</span><span class="ident" id="5547379">prevOpen</span>&nbsp;<span class="op" id="5547388">==</span>&nbsp;<span class="ident" id="5547391">token</span><span class="op" id="5547396">.</span><span class="ident" id="5547397">LBRACK</span><span class="op" id="5547403">)</span>&nbsp;<span class="op" id="5547405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547410">p</span><span class="op" id="5547411">.</span><span class="ident" id="5547412">writeByte</span><span class="op" id="5547421">(</span><span class="string" id="5547422">&#39;&nbsp;&#39;</span><span class="op" id="5547425">,</span>&nbsp;<span class="num" id="5547427">1</span><span class="op" id="5547428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547432">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547436">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547501">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547565">needsLinebreak</span>&nbsp;<span class="op" id="5547580">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547586">last</span><span class="op" id="5547590">.</span><span class="ident" id="5547591">Text</span><span class="op" id="5547595">[</span><span class="num" id="5547596">1</span><span class="op" id="5547597">]</span>&nbsp;<span class="op" id="5547599">==</span>&nbsp;<span class="string" id="5547602">&#39;/&#39;</span>&nbsp;<span class="op" id="5547606">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547613">tok</span>&nbsp;<span class="op" id="5547617">==</span>&nbsp;<span class="ident" id="5547620">token</span><span class="op" id="5547625">.</span><span class="ident" id="5547626">RBRACE</span>&nbsp;<span class="op" id="5547633">&amp;&amp;</span>&nbsp;<span class="ident" id="5547636">p</span><span class="op" id="5547637">.</span><span class="ident" id="5547638">mode</span><span class="op" id="5547642">&amp;</span><span class="ident" id="5547643">noExtraLinebreak</span>&nbsp;<span class="op" id="5547660">==</span>&nbsp;<span class="num" id="5547663">0</span>&nbsp;<span class="op" id="5547665">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547672">tok</span>&nbsp;<span class="op" id="5547676">==</span>&nbsp;<span class="ident" id="5547679">token</span><span class="op" id="5547684">.</span><span class="ident" id="5547685">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547691">return</span>&nbsp;<span class="ident" id="5547698">p</span><span class="op" id="5547699">.</span><span class="ident" id="5547700">writeCommentSuffix</span><span class="op" id="5547718">(</span><span class="ident" id="5547719">needsLinebreak</span><span class="op" id="5547733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547740">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547802">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547860">p</span><span class="op" id="5547861">.</span><span class="ident" id="5547862">internalError</span><span class="op" id="5547875">(</span><span class="string" id="5547876">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="5547929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547932">return</span><br>
<span class="lineno"></span><span class="op" id="5547939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="5547942">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="5548000">func</span>&nbsp;<span class="op" id="5548005">(</span><span class="ident" id="5548006">p</span>&nbsp;<span class="op" id="5548008">*</span><span class="ident" id="5548009">printer</span><span class="op" id="5548016">)</span>&nbsp;<span class="ident" id="5548018">writeWhitespace</span><span class="op" id="5548033">(</span><span class="ident" id="5548034">n</span>&nbsp;<span class="builtintype" id="5548036">int</span><span class="op" id="5548039">)</span>&nbsp;<span class="op" id="5548041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548044">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5548062">for</span>&nbsp;<span class="ident" id="5548066">i</span>&nbsp;<span class="op" id="5548068">:=</span>&nbsp;<span class="num" id="5548071">0</span><span class="op" id="5548072">;</span>&nbsp;<span class="ident" id="5548074">i</span>&nbsp;<span class="op" id="5548076">&lt;</span>&nbsp;<span class="ident" id="5548078">n</span><span class="op" id="5548079">;</span>&nbsp;<span class="ident" id="5548081">i</span><span class="op" id="5548082">++</span>&nbsp;<span class="op" id="5548085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5548089">switch</span>&nbsp;<span class="ident" id="5548096">ch</span>&nbsp;<span class="op" id="5548099">:=</span>&nbsp;<span class="ident" id="5548102">p</span><span class="op" id="5548103">.</span><span class="ident" id="5548104">wsbuf</span><span class="op" id="5548109">[</span><span class="ident" id="5548110">i</span><span class="op" id="5548111">]</span><span class="op" id="5548112">;</span>&nbsp;<span class="ident" id="5548114">ch</span>&nbsp;<span class="op" id="5548117">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5548121">case</span>&nbsp;<span class="ident" id="5548126">ignore</span><span class="op" id="5548132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548137">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5548150">case</span>&nbsp;<span class="ident" id="5548155">indent</span><span class="op" id="5548161">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548166">p</span><span class="op" id="5548167">.</span><span class="ident" id="5548168">indent</span><span class="op" id="5548174">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5548179">case</span>&nbsp;<span class="ident" id="5548184">unindent</span><span class="op" id="5548192">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548197">p</span><span class="op" id="5548198">.</span><span class="ident" id="5548199">indent</span><span class="op" id="5548205">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5548211">if</span>&nbsp;<span class="ident" id="5548214">p</span><span class="op" id="5548215">.</span><span class="ident" id="5548216">indent</span>&nbsp;<span class="op" id="5548223">&lt;</span>&nbsp;<span class="num" id="5548225">0</span>&nbsp;<span class="op" id="5548227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548233">p</span><span class="op" id="5548234">.</span><span class="ident" id="5548235">internalError</span><span class="op" id="5548248">(</span><span class="string" id="5548249">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="5548272">,</span>&nbsp;<span class="ident" id="5548274">p</span><span class="op" id="5548275">.</span><span class="ident" id="5548276">indent</span><span class="op" id="5548282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548288">p</span><span class="op" id="5548289">.</span><span class="ident" id="5548290">indent</span>&nbsp;<span class="op" id="5548297">=</span>&nbsp;<span class="num" id="5548299">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5548304">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5548308">case</span>&nbsp;<span class="ident" id="5548313">newline</span><span class="op" id="5548320">,</span>&nbsp;<span class="ident" id="5548322">formfeed</span><span class="op" id="5548330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548335">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548393">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548452">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548508">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548564">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548624">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5548669">if</span>&nbsp;<span class="ident" id="5548672">i</span><span class="op" id="5548673">+</span><span class="num" id="5548674">1</span>&nbsp;<span class="op" id="5548676">&lt;</span>&nbsp;<span class="ident" id="5548678">n</span>&nbsp;<span class="op" id="5548680">&amp;&amp;</span>&nbsp;<span class="ident" id="5548683">p</span><span class="op" id="5548684">.</span><span class="ident" id="5548685">wsbuf</span><span class="op" id="5548690">[</span><span class="ident" id="5548691">i</span><span class="op" id="5548692">+</span><span class="num" id="5548693">1</span><span class="op" id="5548694">]</span>&nbsp;<span class="op" id="5548696">==</span>&nbsp;<span class="ident" id="5548699">unindent</span>&nbsp;<span class="op" id="5548708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548714">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548770">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548831">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548891">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548954">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548974">p</span><span class="op" id="5548975">.</span><span class="ident" id="5548976">wsbuf</span><span class="op" id="5548981">[</span><span class="ident" id="5548982">i</span><span class="op" id="5548983">]</span><span class="op" id="5548984">,</span>&nbsp;<span class="ident" id="5548986">p</span><span class="op" id="5548987">.</span><span class="ident" id="5548988">wsbuf</span><span class="op" id="5548993">[</span><span class="ident" id="5548994">i</span><span class="op" id="5548995">+</span><span class="num" id="5548996">1</span><span class="op" id="5548997">]</span>&nbsp;<span class="op" id="5548999">=</span>&nbsp;<span class="ident" id="5549001">unindent</span><span class="op" id="5549009">,</span>&nbsp;<span class="ident" id="5549011">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549024">i</span><span class="op" id="5549025">--</span>&nbsp;<span class="comment" id="5549028">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549047">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5549059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549064">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549078">default</span><span class="op" id="5549085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549090">p</span><span class="op" id="5549091">.</span><span class="ident" id="5549092">writeByte</span><span class="op" id="5549101">(</span><span class="builtintype" id="5549102">byte</span><span class="op" id="5549106">(</span><span class="ident" id="5549107">ch</span><span class="op" id="5549109">)</span><span class="op" id="5549110">,</span>&nbsp;<span class="num" id="5549112">1</span><span class="op" id="5549113">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5549117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5549120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5549124">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549157">l</span>&nbsp;<span class="op" id="5549159">:=</span>&nbsp;<span class="builtinfunc" id="5549162">copy</span><span class="op" id="5549166">(</span><span class="ident" id="5549167">p</span><span class="op" id="5549168">.</span><span class="ident" id="5549169">wsbuf</span><span class="op" id="5549174">,</span>&nbsp;<span class="ident" id="5549176">p</span><span class="op" id="5549177">.</span><span class="ident" id="5549178">wsbuf</span><span class="op" id="5549183">[</span><span class="ident" id="5549184">n</span><span class="op" id="5549185">:</span><span class="op" id="5549186">]</span><span class="op" id="5549187">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549190">p</span><span class="op" id="5549191">.</span><span class="ident" id="5549192">wsbuf</span>&nbsp;<span class="op" id="5549198">=</span>&nbsp;<span class="ident" id="5549200">p</span><span class="op" id="5549201">.</span><span class="ident" id="5549202">wsbuf</span><span class="op" id="5549207">[</span><span class="op" id="5549208">:</span><span class="ident" id="5549209">l</span><span class="op" id="5549210">]</span><br>
<span class="lineno"></span><span class="op" id="5549212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5549215">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5549295">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5549318">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="5549353">func</span>&nbsp;<span class="ident" id="5549358">nlimit</span><span class="op" id="5549364">(</span><span class="ident" id="5549365">n</span>&nbsp;<span class="builtintype" id="5549367">int</span><span class="op" id="5549370">)</span>&nbsp;<span class="builtintype" id="5549372">int</span>&nbsp;<span class="op" id="5549376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549379">if</span>&nbsp;<span class="ident" id="5549382">n</span>&nbsp;<span class="op" id="5549384">&gt;</span>&nbsp;<span class="ident" id="5549386">maxNewlines</span>&nbsp;<span class="op" id="5549398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549402">n</span>&nbsp;<span class="op" id="5549404">=</span>&nbsp;<span class="ident" id="5549406">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5549419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549422">return</span>&nbsp;<span class="ident" id="5549429">n</span><br>
<span class="lineno"></span><span class="op" id="5549431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5549434">func</span>&nbsp;<span class="ident" id="5549439">mayCombine</span><span class="op" id="5549449">(</span><span class="ident" id="5549450">prev</span>&nbsp;<span class="ident" id="5549455">token</span><span class="op" id="5549460">.</span><span class="ident" id="5549461">Token</span><span class="op" id="5549466">,</span>&nbsp;<span class="ident" id="5549468">next</span>&nbsp;<span class="builtintype" id="5549473">byte</span><span class="op" id="5549477">)</span>&nbsp;<span class="op" id="5549479">(</span><span class="ident" id="5549480">b</span>&nbsp;<span class="builtintype" id="5549482">bool</span><span class="op" id="5549486">)</span>&nbsp;<span class="op" id="5549488">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549491">switch</span>&nbsp;<span class="ident" id="5549498">prev</span>&nbsp;<span class="op" id="5549503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549506">case</span>&nbsp;<span class="ident" id="5549511">token</span><span class="op" id="5549516">.</span><span class="ident" id="5549517">INT</span><span class="op" id="5549520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549524">b</span>&nbsp;<span class="op" id="5549526">=</span>&nbsp;<span class="ident" id="5549528">next</span>&nbsp;<span class="op" id="5549533">==</span>&nbsp;<span class="string" id="5549536">&#39;.&#39;</span>&nbsp;<span class="comment" id="5549540">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549547">case</span>&nbsp;<span class="ident" id="5549552">token</span><span class="op" id="5549557">.</span><span class="ident" id="5549558">ADD</span><span class="op" id="5549561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549565">b</span>&nbsp;<span class="op" id="5549567">=</span>&nbsp;<span class="ident" id="5549569">next</span>&nbsp;<span class="op" id="5549574">==</span>&nbsp;<span class="string" id="5549577">&#39;+&#39;</span>&nbsp;<span class="comment" id="5549581">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549588">case</span>&nbsp;<span class="ident" id="5549593">token</span><span class="op" id="5549598">.</span><span class="ident" id="5549599">SUB</span><span class="op" id="5549602">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549606">b</span>&nbsp;<span class="op" id="5549608">=</span>&nbsp;<span class="ident" id="5549610">next</span>&nbsp;<span class="op" id="5549615">==</span>&nbsp;<span class="string" id="5549618">&#39;-&#39;</span>&nbsp;<span class="comment" id="5549622">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549629">case</span>&nbsp;<span class="ident" id="5549634">token</span><span class="op" id="5549639">.</span><span class="ident" id="5549640">QUO</span><span class="op" id="5549643">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549647">b</span>&nbsp;<span class="op" id="5549649">=</span>&nbsp;<span class="ident" id="5549651">next</span>&nbsp;<span class="op" id="5549656">==</span>&nbsp;<span class="string" id="5549659">&#39;*&#39;</span>&nbsp;<span class="comment" id="5549663">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549670">case</span>&nbsp;<span class="ident" id="5549675">token</span><span class="op" id="5549680">.</span><span class="ident" id="5549681">LSS</span><span class="op" id="5549684">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549688">b</span>&nbsp;<span class="op" id="5549690">=</span>&nbsp;<span class="ident" id="5549692">next</span>&nbsp;<span class="op" id="5549697">==</span>&nbsp;<span class="string" id="5549700">&#39;-&#39;</span>&nbsp;<span class="op" id="5549704">||</span>&nbsp;<span class="ident" id="5549707">next</span>&nbsp;<span class="op" id="5549712">==</span>&nbsp;<span class="string" id="5549715">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="5549719">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549732">case</span>&nbsp;<span class="ident" id="5549737">token</span><span class="op" id="5549742">.</span><span class="ident" id="5549743">AND</span><span class="op" id="5549746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549750">b</span>&nbsp;<span class="op" id="5549752">=</span>&nbsp;<span class="ident" id="5549754">next</span>&nbsp;<span class="op" id="5549759">==</span>&nbsp;<span class="string" id="5549762">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5549766">||</span>&nbsp;<span class="ident" id="5549769">next</span>&nbsp;<span class="op" id="5549774">==</span>&nbsp;<span class="string" id="5549777">&#39;^&#39;</span>&nbsp;<span class="comment" id="5549781">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5549794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549797">return</span><br>
<span class="lineno">825</span><span class="op" id="5549804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5549807">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="5549877">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="5549947">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="5550016">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="5550066">//</span><br>
<span class="lineno"></span><span class="comment" id="5550069">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5550140">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="5550209">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="5550279">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5550349">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5550391">//</span><br>
<span class="lineno"></span><span class="keyword" id="5550394">func</span>&nbsp;<span class="op" id="5550399">(</span><span class="ident" id="5550400">p</span>&nbsp;<span class="op" id="5550402">*</span><span class="ident" id="5550403">printer</span><span class="op" id="5550410">)</span>&nbsp;<span class="builtinfunc" id="5550412">print</span><span class="op" id="5550417">(</span><span class="ident" id="5550418">args</span>&nbsp;<span class="op" id="5550423">...</span><span class="keyword" id="5550426">interface</span><span class="op" id="5550435">{</span><span class="op" id="5550436">}</span><span class="op" id="5550437">)</span>&nbsp;<span class="op" id="5550439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550442">for</span>&nbsp;<span class="ident" id="5550446">_</span><span class="op" id="5550447">,</span>&nbsp;<span class="ident" id="5550449">arg</span>&nbsp;<span class="op" id="5550453">:=</span>&nbsp;<span class="keyword" id="5550456">range</span>&nbsp;<span class="ident" id="5550462">args</span>&nbsp;<span class="op" id="5550467">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5550471">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550510">var</span>&nbsp;<span class="ident" id="5550514">data</span>&nbsp;<span class="builtintype" id="5550519">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550528">var</span>&nbsp;<span class="ident" id="5550532">isLit</span>&nbsp;<span class="builtintype" id="5550538">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550545">var</span>&nbsp;<span class="ident" id="5550549">impliedSemi</span>&nbsp;<span class="builtintype" id="5550561">bool</span>&nbsp;<span class="comment" id="5550566">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5550611">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550654">switch</span>&nbsp;<span class="ident" id="5550661">p</span><span class="op" id="5550662">.</span><span class="ident" id="5550663">lastTok</span>&nbsp;<span class="op" id="5550671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550675">case</span>&nbsp;<span class="ident" id="5550680">token</span><span class="op" id="5550685">.</span><span class="ident" id="5550686">ILLEGAL</span><span class="op" id="5550693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5550698">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550724">case</span>&nbsp;<span class="ident" id="5550729">token</span><span class="op" id="5550734">.</span><span class="ident" id="5550735">LPAREN</span><span class="op" id="5550741">,</span>&nbsp;<span class="ident" id="5550743">token</span><span class="op" id="5550748">.</span><span class="ident" id="5550749">LBRACK</span><span class="op" id="5550755">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550760">p</span><span class="op" id="5550761">.</span><span class="ident" id="5550762">prevOpen</span>&nbsp;<span class="op" id="5550771">=</span>&nbsp;<span class="ident" id="5550773">p</span><span class="op" id="5550774">.</span><span class="ident" id="5550775">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550785">default</span><span class="op" id="5550792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5550797">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550843">p</span><span class="op" id="5550844">.</span><span class="ident" id="5550845">prevOpen</span>&nbsp;<span class="op" id="5550854">=</span>&nbsp;<span class="ident" id="5550856">token</span><span class="op" id="5550861">.</span><span class="ident" id="5550862">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5550872">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550877">switch</span>&nbsp;<span class="ident" id="5550884">x</span>&nbsp;<span class="op" id="5550886">:=</span>&nbsp;<span class="ident" id="5550889">arg</span><span class="op" id="5550892">.</span><span class="op" id="5550893">(</span><span class="keyword" id="5550894">type</span><span class="op" id="5550898">)</span>&nbsp;<span class="op" id="5550900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550904">case</span>&nbsp;<span class="ident" id="5550909">pmode</span><span class="op" id="5550914">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5550919">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550945">p</span><span class="op" id="5550946">.</span><span class="ident" id="5550947">mode</span>&nbsp;<span class="op" id="5550952">^=</span>&nbsp;<span class="ident" id="5550955">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550960">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550972">case</span>&nbsp;<span class="ident" id="5550977">whiteSpace</span><span class="op" id="5550987">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550992">if</span>&nbsp;<span class="ident" id="5550995">x</span>&nbsp;<span class="op" id="5550997">==</span>&nbsp;<span class="ident" id="5551000">ignore</span>&nbsp;<span class="op" id="5551007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551013">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551059">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551107">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551127">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551144">i</span>&nbsp;<span class="op" id="5551146">:=</span>&nbsp;<span class="builtinfunc" id="5551149">len</span><span class="op" id="5551152">(</span><span class="ident" id="5551153">p</span><span class="op" id="5551154">.</span><span class="ident" id="5551155">wsbuf</span><span class="op" id="5551160">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551165">if</span>&nbsp;<span class="ident" id="5551168">i</span>&nbsp;<span class="op" id="5551170">==</span>&nbsp;<span class="builtinfunc" id="5551173">cap</span><span class="op" id="5551176">(</span><span class="ident" id="5551177">p</span><span class="op" id="5551178">.</span><span class="ident" id="5551179">wsbuf</span><span class="op" id="5551184">)</span>&nbsp;<span class="op" id="5551186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551192">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551250">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551308">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551357">p</span><span class="op" id="5551358">.</span><span class="ident" id="5551359">writeWhitespace</span><span class="op" id="5551374">(</span><span class="ident" id="5551375">i</span><span class="op" id="5551376">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551382">i</span>&nbsp;<span class="op" id="5551384">=</span>&nbsp;<span class="num" id="5551386">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551396">p</span><span class="op" id="5551397">.</span><span class="ident" id="5551398">wsbuf</span>&nbsp;<span class="op" id="5551404">=</span>&nbsp;<span class="ident" id="5551406">p</span><span class="op" id="5551407">.</span><span class="ident" id="5551408">wsbuf</span><span class="op" id="5551413">[</span><span class="num" id="5551414">0</span>&nbsp;<span class="op" id="5551416">:</span>&nbsp;<span class="ident" id="5551418">i</span><span class="op" id="5551419">+</span><span class="num" id="5551420">1</span><span class="op" id="5551421">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551426">p</span><span class="op" id="5551427">.</span><span class="ident" id="5551428">wsbuf</span><span class="op" id="5551433">[</span><span class="ident" id="5551434">i</span><span class="op" id="5551435">]</span>&nbsp;<span class="op" id="5551437">=</span>&nbsp;<span class="ident" id="5551439">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551444">if</span>&nbsp;<span class="ident" id="5551447">x</span>&nbsp;<span class="op" id="5551449">==</span>&nbsp;<span class="ident" id="5551452">newline</span>&nbsp;<span class="op" id="5551460">||</span>&nbsp;<span class="ident" id="5551463">x</span>&nbsp;<span class="op" id="5551465">==</span>&nbsp;<span class="ident" id="5551468">formfeed</span>&nbsp;<span class="op" id="5551477">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551483">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551540">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551598">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551657">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551677">p</span><span class="op" id="5551678">.</span><span class="ident" id="5551679">impliedSemi</span>&nbsp;<span class="op" id="5551691">=</span>&nbsp;<span class="builtintype" id="5551693">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551707">p</span><span class="op" id="5551708">.</span><span class="ident" id="5551709">lastTok</span>&nbsp;<span class="op" id="5551717">=</span>&nbsp;<span class="ident" id="5551719">token</span><span class="op" id="5551724">.</span><span class="ident" id="5551725">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551736">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551748">case</span>&nbsp;<span class="op" id="5551753">*</span><span class="ident" id="5551754">ast</span><span class="op" id="5551757">.</span><span class="ident" id="5551758">Ident</span><span class="op" id="5551763">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551768">data</span>&nbsp;<span class="op" id="5551773">=</span>&nbsp;<span class="ident" id="5551775">x</span><span class="op" id="5551776">.</span><span class="ident" id="5551777">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551785">impliedSemi</span>&nbsp;<span class="op" id="5551797">=</span>&nbsp;<span class="builtintype" id="5551799">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551807">p</span><span class="op" id="5551808">.</span><span class="ident" id="5551809">lastTok</span>&nbsp;<span class="op" id="5551817">=</span>&nbsp;<span class="ident" id="5551819">token</span><span class="op" id="5551824">.</span><span class="ident" id="5551825">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551834">case</span>&nbsp;<span class="op" id="5551839">*</span><span class="ident" id="5551840">ast</span><span class="op" id="5551843">.</span><span class="ident" id="5551844">BasicLit</span><span class="op" id="5551852">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551857">data</span>&nbsp;<span class="op" id="5551862">=</span>&nbsp;<span class="ident" id="5551864">x</span><span class="op" id="5551865">.</span><span class="ident" id="5551866">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551875">isLit</span>&nbsp;<span class="op" id="5551881">=</span>&nbsp;<span class="builtintype" id="5551883">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551891">impliedSemi</span>&nbsp;<span class="op" id="5551903">=</span>&nbsp;<span class="builtintype" id="5551905">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551913">p</span><span class="op" id="5551914">.</span><span class="ident" id="5551915">lastTok</span>&nbsp;<span class="op" id="5551923">=</span>&nbsp;<span class="ident" id="5551925">x</span><span class="op" id="5551926">.</span><span class="ident" id="5551927">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551935">case</span>&nbsp;<span class="ident" id="5551940">token</span><span class="op" id="5551945">.</span><span class="ident" id="5551946">Token</span><span class="op" id="5551951">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551956">s</span>&nbsp;<span class="op" id="5551958">:=</span>&nbsp;<span class="ident" id="5551961">x</span><span class="op" id="5551962">.</span><span class="ident" id="5551963">String</span><span class="op" id="5551969">(</span><span class="op" id="5551970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551975">if</span>&nbsp;<span class="ident" id="5551978">mayCombine</span><span class="op" id="5551988">(</span><span class="ident" id="5551989">p</span><span class="op" id="5551990">.</span><span class="ident" id="5551991">lastTok</span><span class="op" id="5551998">,</span>&nbsp;<span class="ident" id="5552000">s</span><span class="op" id="5552001">[</span><span class="num" id="5552002">0</span><span class="op" id="5552003">]</span><span class="op" id="5552004">)</span>&nbsp;<span class="op" id="5552006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5552012">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5552062">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5552113">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5552162">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5552214">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5552266">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5552310">if</span>&nbsp;<span class="builtinfunc" id="5552313">len</span><span class="op" id="5552316">(</span><span class="ident" id="5552317">p</span><span class="op" id="5552318">.</span><span class="ident" id="5552319">wsbuf</span><span class="op" id="5552324">)</span>&nbsp;<span class="op" id="5552326">!=</span>&nbsp;<span class="num" id="5552329">0</span>&nbsp;<span class="op" id="5552331">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552338">p</span><span class="op" id="5552339">.</span><span class="ident" id="5552340">internalError</span><span class="op" id="5552353">(</span><span class="string" id="5552354">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="5552383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5552389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552395">p</span><span class="op" id="5552396">.</span><span class="ident" id="5552397">wsbuf</span>&nbsp;<span class="op" id="5552403">=</span>&nbsp;<span class="ident" id="5552405">p</span><span class="op" id="5552406">.</span><span class="ident" id="5552407">wsbuf</span><span class="op" id="5552412">[</span><span class="num" id="5552413">0</span><span class="op" id="5552414">:</span><span class="num" id="5552415">1</span><span class="op" id="5552416">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552422">p</span><span class="op" id="5552423">.</span><span class="ident" id="5552424">wsbuf</span><span class="op" id="5552429">[</span><span class="num" id="5552430">0</span><span class="op" id="5552431">]</span>&nbsp;<span class="op" id="5552433">=</span>&nbsp;<span class="string" id="5552435">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5552442">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552447">data</span>&nbsp;<span class="op" id="5552452">=</span>&nbsp;<span class="ident" id="5552454">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5552459">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5552519">switch</span>&nbsp;<span class="ident" id="5552526">x</span>&nbsp;<span class="op" id="5552528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5552533">case</span>&nbsp;<span class="ident" id="5552538">token</span><span class="op" id="5552543">.</span><span class="ident" id="5552544">BREAK</span><span class="op" id="5552549">,</span>&nbsp;<span class="ident" id="5552551">token</span><span class="op" id="5552556">.</span><span class="ident" id="5552557">CONTINUE</span><span class="op" id="5552565">,</span>&nbsp;<span class="ident" id="5552567">token</span><span class="op" id="5552572">.</span><span class="ident" id="5552573">FALLTHROUGH</span><span class="op" id="5552584">,</span>&nbsp;<span class="ident" id="5552586">token</span><span class="op" id="5552591">.</span><span class="ident" id="5552592">RETURN</span><span class="op" id="5552598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552604">token</span><span class="op" id="5552609">.</span><span class="ident" id="5552610">INC</span><span class="op" id="5552613">,</span>&nbsp;<span class="ident" id="5552615">token</span><span class="op" id="5552620">.</span><span class="ident" id="5552621">DEC</span><span class="op" id="5552624">,</span>&nbsp;<span class="ident" id="5552626">token</span><span class="op" id="5552631">.</span><span class="ident" id="5552632">RPAREN</span><span class="op" id="5552638">,</span>&nbsp;<span class="ident" id="5552640">token</span><span class="op" id="5552645">.</span><span class="ident" id="5552646">RBRACK</span><span class="op" id="5552652">,</span>&nbsp;<span class="ident" id="5552654">token</span><span class="op" id="5552659">.</span><span class="ident" id="5552660">RBRACE</span><span class="op" id="5552666">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552672">impliedSemi</span>&nbsp;<span class="op" id="5552684">=</span>&nbsp;<span class="builtintype" id="5552686">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5552694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552699">p</span><span class="op" id="5552700">.</span><span class="ident" id="5552701">lastTok</span>&nbsp;<span class="op" id="5552709">=</span>&nbsp;<span class="ident" id="5552711">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5552716">case</span>&nbsp;<span class="ident" id="5552721">token</span><span class="op" id="5552726">.</span><span class="ident" id="5552727">Pos</span><span class="op" id="5552730">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5552735">if</span>&nbsp;<span class="ident" id="5552738">x</span><span class="op" id="5552739">.</span><span class="ident" id="5552740">IsValid</span><span class="op" id="5552747">(</span><span class="op" id="5552748">)</span>&nbsp;<span class="op" id="5552750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552756">p</span><span class="op" id="5552757">.</span><span class="ident" id="5552758">pos</span>&nbsp;<span class="op" id="5552762">=</span>&nbsp;<span class="ident" id="5552764">p</span><span class="op" id="5552765">.</span><span class="ident" id="5552766">posFor</span><span class="op" id="5552772">(</span><span class="ident" id="5552773">x</span><span class="op" id="5552774">)</span>&nbsp;<span class="comment" id="5552776">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5552813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5552818">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5552830">case</span>&nbsp;<span class="builtintype" id="5552835">string</span><span class="op" id="5552841">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5552846">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552888">data</span>&nbsp;<span class="op" id="5552893">=</span>&nbsp;<span class="ident" id="5552895">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552900">isLit</span>&nbsp;<span class="op" id="5552906">=</span>&nbsp;<span class="builtintype" id="5552908">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552916">impliedSemi</span>&nbsp;<span class="op" id="5552928">=</span>&nbsp;<span class="builtintype" id="5552930">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552938">p</span><span class="op" id="5552939">.</span><span class="ident" id="5552940">lastTok</span>&nbsp;<span class="op" id="5552948">=</span>&nbsp;<span class="ident" id="5552950">token</span><span class="op" id="5552955">.</span><span class="ident" id="5552956">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5552966">default</span><span class="op" id="5552973">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5552978">fmt</span><span class="op" id="5552981">.</span><span class="ident" id="5552982">Fprintf</span><span class="op" id="5552989">(</span><span class="ident" id="5552990">os</span><span class="op" id="5552992">.</span><span class="ident" id="5552993">Stderr</span><span class="op" id="5552999">,</span>&nbsp;<span class="string" id="5553001">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="5553040">,</span>&nbsp;<span class="ident" id="5553042">arg</span><span class="op" id="5553045">,</span>&nbsp;<span class="ident" id="5553047">arg</span><span class="op" id="5553050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5553055">panic</span><span class="op" id="5553060">(</span><span class="string" id="5553061">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="5553078">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5553082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5553086">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553103">next</span>&nbsp;<span class="op" id="5553108">:=</span>&nbsp;<span class="ident" id="5553111">p</span><span class="op" id="5553112">.</span><span class="ident" id="5553113">pos</span>&nbsp;<span class="comment" id="5553117">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553163">wroteNewline</span><span class="op" id="5553175">,</span>&nbsp;<span class="ident" id="5553177">droppedFF</span>&nbsp;<span class="op" id="5553187">:=</span>&nbsp;<span class="ident" id="5553190">p</span><span class="op" id="5553191">.</span><span class="ident" id="5553192">flush</span><span class="op" id="5553197">(</span><span class="ident" id="5553198">next</span><span class="op" id="5553202">,</span>&nbsp;<span class="ident" id="5553204">p</span><span class="op" id="5553205">.</span><span class="ident" id="5553206">lastTok</span><span class="op" id="5553213">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5553218">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5553279">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5553339">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5553404">if</span>&nbsp;<span class="op" id="5553407">!</span><span class="ident" id="5553408">p</span><span class="op" id="5553409">.</span><span class="ident" id="5553410">impliedSemi</span>&nbsp;<span class="op" id="5553422">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553427">n</span>&nbsp;<span class="op" id="5553429">:=</span>&nbsp;<span class="ident" id="5553432">nlimit</span><span class="op" id="5553438">(</span><span class="ident" id="5553439">next</span><span class="op" id="5553443">.</span><span class="ident" id="5553444">Line</span>&nbsp;<span class="op" id="5553449">-</span>&nbsp;<span class="ident" id="5553451">p</span><span class="op" id="5553452">.</span><span class="ident" id="5553453">pos</span><span class="op" id="5553456">.</span><span class="ident" id="5553457">Line</span><span class="op" id="5553461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5553466">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5553521">if</span>&nbsp;<span class="ident" id="5553524">wroteNewline</span>&nbsp;<span class="op" id="5553537">&amp;&amp;</span>&nbsp;<span class="ident" id="5553540">n</span>&nbsp;<span class="op" id="5553542">==</span>&nbsp;<span class="ident" id="5553545">maxNewlines</span>&nbsp;<span class="op" id="5553557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553563">n</span>&nbsp;<span class="op" id="5553565">=</span>&nbsp;<span class="ident" id="5553567">maxNewlines</span>&nbsp;<span class="op" id="5553579">-</span>&nbsp;<span class="num" id="5553581">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5553586">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5553591">if</span>&nbsp;<span class="ident" id="5553594">n</span>&nbsp;<span class="op" id="5553596">&gt;</span>&nbsp;<span class="num" id="5553598">0</span>&nbsp;<span class="op" id="5553600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553606">ch</span>&nbsp;<span class="op" id="5553609">:=</span>&nbsp;<span class="builtintype" id="5553612">byte</span><span class="op" id="5553616">(</span><span class="string" id="5553617">&#39;\n&#39;</span><span class="op" id="5553621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5553627">if</span>&nbsp;<span class="ident" id="5553630">droppedFF</span>&nbsp;<span class="op" id="5553640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553647">ch</span>&nbsp;<span class="op" id="5553650">=</span>&nbsp;<span class="string" id="5553652">&#39;\f&#39;</span>&nbsp;<span class="comment" id="5553657">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5553705">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553711">p</span><span class="op" id="5553712">.</span><span class="ident" id="5553713">writeByte</span><span class="op" id="5553722">(</span><span class="ident" id="5553723">ch</span><span class="op" id="5553725">,</span>&nbsp;<span class="ident" id="5553727">n</span><span class="op" id="5553728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553734">impliedSemi</span>&nbsp;<span class="op" id="5553746">=</span>&nbsp;<span class="builtintype" id="5553748">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5553757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5553761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5553766">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5553835">if</span>&nbsp;<span class="ident" id="5553838">p</span><span class="op" id="5553839">.</span><span class="ident" id="5553840">linePtr</span>&nbsp;<span class="op" id="5553848">!=</span>&nbsp;<span class="builtintype" id="5553851">nil</span>&nbsp;<span class="op" id="5553855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5553860">*</span><span class="ident" id="5553861">p</span><span class="op" id="5553862">.</span><span class="ident" id="5553863">linePtr</span>&nbsp;<span class="op" id="5553871">=</span>&nbsp;<span class="ident" id="5553873">p</span><span class="op" id="5553874">.</span><span class="ident" id="5553875">out</span><span class="op" id="5553878">.</span><span class="ident" id="5553879">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553887">p</span><span class="op" id="5553888">.</span><span class="ident" id="5553889">linePtr</span>&nbsp;<span class="op" id="5553897">=</span>&nbsp;<span class="builtintype" id="5553899">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5553905">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553910">p</span><span class="op" id="5553911">.</span><span class="ident" id="5553912">writeString</span><span class="op" id="5553923">(</span><span class="ident" id="5553924">next</span><span class="op" id="5553928">,</span>&nbsp;<span class="ident" id="5553930">data</span><span class="op" id="5553934">,</span>&nbsp;<span class="ident" id="5553936">isLit</span><span class="op" id="5553941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553945">p</span><span class="op" id="5553946">.</span><span class="ident" id="5553947">impliedSemi</span>&nbsp;<span class="op" id="5553959">=</span>&nbsp;<span class="ident" id="5553961">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5553974">}</span><br>
<span class="lineno"></span><span class="op" id="5553976">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="5553979">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="5554051">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="5554124">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5554201">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="5554212">//</span><br>
<span class="lineno"></span><span class="keyword" id="5554215">func</span>&nbsp;<span class="op" id="5554220">(</span><span class="ident" id="5554221">p</span>&nbsp;<span class="op" id="5554223">*</span><span class="ident" id="5554224">printer</span><span class="op" id="5554231">)</span>&nbsp;<span class="ident" id="5554233">flush</span><span class="op" id="5554238">(</span><span class="ident" id="5554239">next</span>&nbsp;<span class="ident" id="5554244">token</span><span class="op" id="5554249">.</span><span class="ident" id="5554250">Position</span><span class="op" id="5554258">,</span>&nbsp;<span class="ident" id="5554260">tok</span>&nbsp;<span class="ident" id="5554264">token</span><span class="op" id="5554269">.</span><span class="ident" id="5554270">Token</span><span class="op" id="5554275">)</span>&nbsp;<span class="op" id="5554277">(</span><span class="ident" id="5554278">wroteNewline</span><span class="op" id="5554290">,</span>&nbsp;<span class="ident" id="5554292">droppedFF</span>&nbsp;<span class="builtintype" id="5554302">bool</span><span class="op" id="5554306">)</span>&nbsp;<span class="op" id="5554308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554311">if</span>&nbsp;<span class="ident" id="5554314">p</span><span class="op" id="5554315">.</span><span class="ident" id="5554316">commentBefore</span><span class="op" id="5554329">(</span><span class="ident" id="5554330">next</span><span class="op" id="5554334">)</span>&nbsp;<span class="op" id="5554336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5554340">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554406">wroteNewline</span><span class="op" id="5554418">,</span>&nbsp;<span class="ident" id="5554420">droppedFF</span>&nbsp;<span class="op" id="5554430">=</span>&nbsp;<span class="ident" id="5554432">p</span><span class="op" id="5554433">.</span><span class="ident" id="5554434">intersperseComments</span><span class="op" id="5554453">(</span><span class="ident" id="5554454">next</span><span class="op" id="5554458">,</span>&nbsp;<span class="ident" id="5554460">tok</span><span class="op" id="5554463">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5554466">}</span>&nbsp;<span class="keyword" id="5554468">else</span>&nbsp;<span class="op" id="5554473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5554477">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554523">p</span><span class="op" id="5554524">.</span><span class="ident" id="5554525">writeWhitespace</span><span class="op" id="5554540">(</span><span class="builtinfunc" id="5554541">len</span><span class="op" id="5554544">(</span><span class="ident" id="5554545">p</span><span class="op" id="5554546">.</span><span class="ident" id="5554547">wsbuf</span><span class="op" id="5554552">)</span><span class="op" id="5554553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5554556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554559">return</span><br>
<span class="lineno">990</span><span class="op" id="5554566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5554569">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="5554636">func</span>&nbsp;<span class="ident" id="5554641">getDoc</span><span class="op" id="5554647">(</span><span class="ident" id="5554648">n</span>&nbsp;<span class="ident" id="5554650">ast</span><span class="op" id="5554653">.</span><span class="ident" id="5554654">Node</span><span class="op" id="5554658">)</span>&nbsp;<span class="op" id="5554660">*</span><span class="ident" id="5554661">ast</span><span class="op" id="5554664">.</span><span class="ident" id="5554665">CommentGroup</span>&nbsp;<span class="op" id="5554678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554681">switch</span>&nbsp;<span class="ident" id="5554688">n</span>&nbsp;<span class="op" id="5554690">:=</span>&nbsp;<span class="ident" id="5554693">n</span><span class="op" id="5554694">.</span><span class="op" id="5554695">(</span><span class="keyword" id="5554696">type</span><span class="op" id="5554700">)</span>&nbsp;<span class="op" id="5554702">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554705">case</span>&nbsp;<span class="op" id="5554710">*</span><span class="ident" id="5554711">ast</span><span class="op" id="5554714">.</span><span class="ident" id="5554715">Field</span><span class="op" id="5554720">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554724">return</span>&nbsp;<span class="ident" id="5554731">n</span><span class="op" id="5554732">.</span><span class="ident" id="5554733">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554738">case</span>&nbsp;<span class="op" id="5554743">*</span><span class="ident" id="5554744">ast</span><span class="op" id="5554747">.</span><span class="ident" id="5554748">ImportSpec</span><span class="op" id="5554758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554762">return</span>&nbsp;<span class="ident" id="5554769">n</span><span class="op" id="5554770">.</span><span class="ident" id="5554771">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554776">case</span>&nbsp;<span class="op" id="5554781">*</span><span class="ident" id="5554782">ast</span><span class="op" id="5554785">.</span><span class="ident" id="5554786">ValueSpec</span><span class="op" id="5554795">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554799">return</span>&nbsp;<span class="ident" id="5554806">n</span><span class="op" id="5554807">.</span><span class="ident" id="5554808">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554813">case</span>&nbsp;<span class="op" id="5554818">*</span><span class="ident" id="5554819">ast</span><span class="op" id="5554822">.</span><span class="ident" id="5554823">TypeSpec</span><span class="op" id="5554831">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554835">return</span>&nbsp;<span class="ident" id="5554842">n</span><span class="op" id="5554843">.</span><span class="ident" id="5554844">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554849">case</span>&nbsp;<span class="op" id="5554854">*</span><span class="ident" id="5554855">ast</span><span class="op" id="5554858">.</span><span class="ident" id="5554859">GenDecl</span><span class="op" id="5554866">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554870">return</span>&nbsp;<span class="ident" id="5554877">n</span><span class="op" id="5554878">.</span><span class="ident" id="5554879">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554884">case</span>&nbsp;<span class="op" id="5554889">*</span><span class="ident" id="5554890">ast</span><span class="op" id="5554893">.</span><span class="ident" id="5554894">FuncDecl</span><span class="op" id="5554902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554906">return</span>&nbsp;<span class="ident" id="5554913">n</span><span class="op" id="5554914">.</span><span class="ident" id="5554915">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554920">case</span>&nbsp;<span class="op" id="5554925">*</span><span class="ident" id="5554926">ast</span><span class="op" id="5554929">.</span><span class="ident" id="5554930">File</span><span class="op" id="5554934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554938">return</span>&nbsp;<span class="ident" id="5554945">n</span><span class="op" id="5554946">.</span><span class="ident" id="5554947">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5554952">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5554955">return</span>&nbsp;<span class="builtintype" id="5554962">nil</span><br>
<span class="lineno"></span><span class="op" id="5554966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5554969">func</span>&nbsp;<span class="op" id="5554974">(</span><span class="ident" id="5554975">p</span>&nbsp;<span class="op" id="5554977">*</span><span class="ident" id="5554978">printer</span><span class="op" id="5554985">)</span>&nbsp;<span class="ident" id="5554987">printNode</span><span class="op" id="5554996">(</span><span class="ident" id="5554997">node</span>&nbsp;<span class="keyword" id="5555002">interface</span><span class="op" id="5555011">{</span><span class="op" id="5555012">}</span><span class="op" id="5555013">)</span>&nbsp;<span class="builtintype" id="5555015">error</span>&nbsp;<span class="op" id="5555021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5555024">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555058">var</span>&nbsp;<span class="ident" id="5555062">comments</span>&nbsp;<span class="op" id="5555071">[</span><span class="op" id="5555072">]</span><span class="op" id="5555073">*</span><span class="ident" id="5555074">ast</span><span class="op" id="5555077">.</span><span class="ident" id="5555078">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555092">if</span>&nbsp;<span class="ident" id="5555095">cnode</span><span class="op" id="5555100">,</span>&nbsp;<span class="ident" id="5555102">ok</span>&nbsp;<span class="op" id="5555105">:=</span>&nbsp;<span class="ident" id="5555108">node</span><span class="op" id="5555112">.</span><span class="op" id="5555113">(</span><span class="op" id="5555114">*</span><span class="ident" id="5555115">CommentedNode</span><span class="op" id="5555128">)</span><span class="op" id="5555129">;</span>&nbsp;<span class="ident" id="5555131">ok</span>&nbsp;<span class="op" id="5555134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555138">node</span>&nbsp;<span class="op" id="5555143">=</span>&nbsp;<span class="ident" id="5555145">cnode</span><span class="op" id="5555150">.</span><span class="ident" id="5555151">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555158">comments</span>&nbsp;<span class="op" id="5555167">=</span>&nbsp;<span class="ident" id="5555169">cnode</span><span class="op" id="5555174">.</span><span class="ident" id="5555175">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5555185">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555189">if</span>&nbsp;<span class="ident" id="5555192">comments</span>&nbsp;<span class="op" id="5555201">!=</span>&nbsp;<span class="builtintype" id="5555204">nil</span>&nbsp;<span class="op" id="5555208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5555212">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555274">n</span><span class="op" id="5555275">,</span>&nbsp;<span class="ident" id="5555277">ok</span>&nbsp;<span class="op" id="5555280">:=</span>&nbsp;<span class="ident" id="5555283">node</span><span class="op" id="5555287">.</span><span class="op" id="5555288">(</span><span class="ident" id="5555289">ast</span><span class="op" id="5555292">.</span><span class="ident" id="5555293">Node</span><span class="op" id="5555297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555301">if</span>&nbsp;<span class="op" id="5555304">!</span><span class="ident" id="5555305">ok</span>&nbsp;<span class="op" id="5555308">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555313">goto</span>&nbsp;<span class="ident" id="5555318">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5555332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555336">beg</span>&nbsp;<span class="op" id="5555340">:=</span>&nbsp;<span class="ident" id="5555343">n</span><span class="op" id="5555344">.</span><span class="ident" id="5555345">Pos</span><span class="op" id="5555348">(</span><span class="op" id="5555349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555353">end</span>&nbsp;<span class="op" id="5555357">:=</span>&nbsp;<span class="ident" id="5555360">n</span><span class="op" id="5555361">.</span><span class="ident" id="5555362">End</span><span class="op" id="5555365">(</span><span class="op" id="5555366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5555370">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5555417">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5555461">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5555507">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555558">if</span>&nbsp;<span class="ident" id="5555561">doc</span>&nbsp;<span class="op" id="5555565">:=</span>&nbsp;<span class="ident" id="5555568">getDoc</span><span class="op" id="5555574">(</span><span class="ident" id="5555575">n</span><span class="op" id="5555576">)</span><span class="op" id="5555577">;</span>&nbsp;<span class="ident" id="5555579">doc</span>&nbsp;<span class="op" id="5555583">!=</span>&nbsp;<span class="builtintype" id="5555586">nil</span>&nbsp;<span class="op" id="5555590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555595">beg</span>&nbsp;<span class="op" id="5555599">=</span>&nbsp;<span class="ident" id="5555601">doc</span><span class="op" id="5555604">.</span><span class="ident" id="5555605">Pos</span><span class="op" id="5555608">(</span><span class="op" id="5555609">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5555613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5555617">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5555666">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555693">i</span>&nbsp;<span class="op" id="5555695">:=</span>&nbsp;<span class="num" id="5555698">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555702">for</span>&nbsp;<span class="ident" id="5555706">i</span>&nbsp;<span class="op" id="5555708">&lt;</span>&nbsp;<span class="builtinfunc" id="5555710">len</span><span class="op" id="5555713">(</span><span class="ident" id="5555714">comments</span><span class="op" id="5555722">)</span>&nbsp;<span class="op" id="5555724">&amp;&amp;</span>&nbsp;<span class="ident" id="5555727">comments</span><span class="op" id="5555735">[</span><span class="ident" id="5555736">i</span><span class="op" id="5555737">]</span><span class="op" id="5555738">.</span><span class="ident" id="5555739">End</span><span class="op" id="5555742">(</span><span class="op" id="5555743">)</span>&nbsp;<span class="op" id="5555745">&lt;</span>&nbsp;<span class="ident" id="5555747">beg</span>&nbsp;<span class="op" id="5555751">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555756">i</span><span class="op" id="5555757">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5555762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555766">j</span>&nbsp;<span class="op" id="5555768">:=</span>&nbsp;<span class="ident" id="5555771">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555775">for</span>&nbsp;<span class="ident" id="5555779">j</span>&nbsp;<span class="op" id="5555781">&lt;</span>&nbsp;<span class="builtinfunc" id="5555783">len</span><span class="op" id="5555786">(</span><span class="ident" id="5555787">comments</span><span class="op" id="5555795">)</span>&nbsp;<span class="op" id="5555797">&amp;&amp;</span>&nbsp;<span class="ident" id="5555800">comments</span><span class="op" id="5555808">[</span><span class="ident" id="5555809">j</span><span class="op" id="5555810">]</span><span class="op" id="5555811">.</span><span class="ident" id="5555812">Pos</span><span class="op" id="5555815">(</span><span class="op" id="5555816">)</span>&nbsp;<span class="op" id="5555818">&lt;</span>&nbsp;<span class="ident" id="5555820">end</span>&nbsp;<span class="op" id="5555824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555829">j</span><span class="op" id="5555830">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5555835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555839">if</span>&nbsp;<span class="ident" id="5555842">i</span>&nbsp;<span class="op" id="5555844">&lt;</span>&nbsp;<span class="ident" id="5555846">j</span>&nbsp;<span class="op" id="5555848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555853">p</span><span class="op" id="5555854">.</span><span class="ident" id="5555855">comments</span>&nbsp;<span class="op" id="5555864">=</span>&nbsp;<span class="ident" id="5555866">comments</span><span class="op" id="5555874">[</span><span class="ident" id="5555875">i</span><span class="op" id="5555876">:</span><span class="ident" id="5555877">j</span><span class="op" id="5555878">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5555882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5555885">}</span>&nbsp;<span class="keyword" id="5555887">else</span>&nbsp;<span class="keyword" id="5555892">if</span>&nbsp;<span class="ident" id="5555895">n</span><span class="op" id="5555896">,</span>&nbsp;<span class="ident" id="5555898">ok</span>&nbsp;<span class="op" id="5555901">:=</span>&nbsp;<span class="ident" id="5555904">node</span><span class="op" id="5555908">.</span><span class="op" id="5555909">(</span><span class="op" id="5555910">*</span><span class="ident" id="5555911">ast</span><span class="op" id="5555914">.</span><span class="ident" id="5555915">File</span><span class="op" id="5555919">)</span><span class="op" id="5555920">;</span>&nbsp;<span class="ident" id="5555922">ok</span>&nbsp;<span class="op" id="5555925">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5555929">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555964">p</span><span class="op" id="5555965">.</span><span class="ident" id="5555966">comments</span>&nbsp;<span class="op" id="5555975">=</span>&nbsp;<span class="ident" id="5555977">n</span><span class="op" id="5555978">.</span><span class="ident" id="5555979">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5555989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5555993">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556041">p</span><span class="op" id="5556042">.</span><span class="ident" id="5556043">useNodeComments</span>&nbsp;<span class="op" id="5556059">=</span>&nbsp;<span class="ident" id="5556061">p</span><span class="op" id="5556062">.</span><span class="ident" id="5556063">comments</span>&nbsp;<span class="op" id="5556072">==</span>&nbsp;<span class="builtintype" id="5556075">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5556081">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556112">p</span><span class="op" id="5556113">.</span><span class="ident" id="5556114">nextComment</span><span class="op" id="5556125">(</span><span class="op" id="5556126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5556130">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556146">switch</span>&nbsp;<span class="ident" id="5556153">n</span>&nbsp;<span class="op" id="5556155">:=</span>&nbsp;<span class="ident" id="5556158">node</span><span class="op" id="5556162">.</span><span class="op" id="5556163">(</span><span class="keyword" id="5556164">type</span><span class="op" id="5556168">)</span>&nbsp;<span class="op" id="5556170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556173">case</span>&nbsp;<span class="ident" id="5556178">ast</span><span class="op" id="5556181">.</span><span class="ident" id="5556182">Expr</span><span class="op" id="5556186">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556190">p</span><span class="op" id="5556191">.</span><span class="ident" id="5556192">expr</span><span class="op" id="5556196">(</span><span class="ident" id="5556197">n</span><span class="op" id="5556198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556201">case</span>&nbsp;<span class="ident" id="5556206">ast</span><span class="op" id="5556209">.</span><span class="ident" id="5556210">Stmt</span><span class="op" id="5556214">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5556218">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5556281">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556340">if</span>&nbsp;<span class="ident" id="5556343">_</span><span class="op" id="5556344">,</span>&nbsp;<span class="ident" id="5556346">ok</span>&nbsp;<span class="op" id="5556349">:=</span>&nbsp;<span class="ident" id="5556352">n</span><span class="op" id="5556353">.</span><span class="op" id="5556354">(</span><span class="op" id="5556355">*</span><span class="ident" id="5556356">ast</span><span class="op" id="5556359">.</span><span class="ident" id="5556360">LabeledStmt</span><span class="op" id="5556371">)</span><span class="op" id="5556372">;</span>&nbsp;<span class="ident" id="5556374">ok</span>&nbsp;<span class="op" id="5556377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556382">p</span><span class="op" id="5556383">.</span><span class="ident" id="5556384">indent</span>&nbsp;<span class="op" id="5556391">=</span>&nbsp;<span class="num" id="5556393">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556397">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556401">p</span><span class="op" id="5556402">.</span><span class="ident" id="5556403">stmt</span><span class="op" id="5556407">(</span><span class="ident" id="5556408">n</span><span class="op" id="5556409">,</span>&nbsp;<span class="builtintype" id="5556411">false</span><span class="op" id="5556416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556419">case</span>&nbsp;<span class="ident" id="5556424">ast</span><span class="op" id="5556427">.</span><span class="ident" id="5556428">Decl</span><span class="op" id="5556432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556436">p</span><span class="op" id="5556437">.</span><span class="ident" id="5556438">decl</span><span class="op" id="5556442">(</span><span class="ident" id="5556443">n</span><span class="op" id="5556444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556447">case</span>&nbsp;<span class="ident" id="5556452">ast</span><span class="op" id="5556455">.</span><span class="ident" id="5556456">Spec</span><span class="op" id="5556460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556464">p</span><span class="op" id="5556465">.</span><span class="ident" id="5556466">spec</span><span class="op" id="5556470">(</span><span class="ident" id="5556471">n</span><span class="op" id="5556472">,</span>&nbsp;<span class="num" id="5556474">1</span><span class="op" id="5556475">,</span>&nbsp;<span class="builtintype" id="5556477">false</span><span class="op" id="5556482">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556485">case</span>&nbsp;<span class="op" id="5556490">[</span><span class="op" id="5556491">]</span><span class="ident" id="5556492">ast</span><span class="op" id="5556495">.</span><span class="ident" id="5556496">Stmt</span><span class="op" id="5556500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5556504">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5556567">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556626">for</span>&nbsp;<span class="ident" id="5556630">_</span><span class="op" id="5556631">,</span>&nbsp;<span class="ident" id="5556633">s</span>&nbsp;<span class="op" id="5556635">:=</span>&nbsp;<span class="keyword" id="5556638">range</span>&nbsp;<span class="ident" id="5556644">n</span>&nbsp;<span class="op" id="5556646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556651">if</span>&nbsp;<span class="ident" id="5556654">_</span><span class="op" id="5556655">,</span>&nbsp;<span class="ident" id="5556657">ok</span>&nbsp;<span class="op" id="5556660">:=</span>&nbsp;<span class="ident" id="5556663">s</span><span class="op" id="5556664">.</span><span class="op" id="5556665">(</span><span class="op" id="5556666">*</span><span class="ident" id="5556667">ast</span><span class="op" id="5556670">.</span><span class="ident" id="5556671">LabeledStmt</span><span class="op" id="5556682">)</span><span class="op" id="5556683">;</span>&nbsp;<span class="ident" id="5556685">ok</span>&nbsp;<span class="op" id="5556688">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556694">p</span><span class="op" id="5556695">.</span><span class="ident" id="5556696">indent</span>&nbsp;<span class="op" id="5556703">=</span>&nbsp;<span class="num" id="5556705">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556718">p</span><span class="op" id="5556719">.</span><span class="ident" id="5556720">stmtList</span><span class="op" id="5556728">(</span><span class="ident" id="5556729">n</span><span class="op" id="5556730">,</span>&nbsp;<span class="num" id="5556732">0</span><span class="op" id="5556733">,</span>&nbsp;<span class="builtintype" id="5556735">false</span><span class="op" id="5556740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556743">case</span>&nbsp;<span class="op" id="5556748">[</span><span class="op" id="5556749">]</span><span class="ident" id="5556750">ast</span><span class="op" id="5556753">.</span><span class="ident" id="5556754">Decl</span><span class="op" id="5556758">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556762">p</span><span class="op" id="5556763">.</span><span class="ident" id="5556764">declList</span><span class="op" id="5556772">(</span><span class="ident" id="5556773">n</span><span class="op" id="5556774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556777">case</span>&nbsp;<span class="op" id="5556782">*</span><span class="ident" id="5556783">ast</span><span class="op" id="5556786">.</span><span class="ident" id="5556787">File</span><span class="op" id="5556791">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556795">p</span><span class="op" id="5556796">.</span><span class="ident" id="5556797">file</span><span class="op" id="5556801">(</span><span class="ident" id="5556802">n</span><span class="op" id="5556803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556806">default</span><span class="op" id="5556813">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556817">goto</span>&nbsp;<span class="ident" id="5556822">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556839">return</span>&nbsp;<span class="builtintype" id="5556846">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="5556851">unsupported</span><span class="op" id="5556862">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556865">return</span>&nbsp;<span class="ident" id="5556872">fmt</span><span class="op" id="5556875">.</span><span class="ident" id="5556876">Errorf</span><span class="op" id="5556882">(</span><span class="string" id="5556883">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="5556921">,</span>&nbsp;<span class="ident" id="5556923">node</span><span class="op" id="5556927">)</span><br>
<span class="lineno"></span><span class="op" id="5556929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5556932">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5557012">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="5557024">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="5557091">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="5557160">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="5557229">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="5557298">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="5557320">//</span><br>
<span class="lineno"></span><span class="keyword" id="5557323">type</span>&nbsp;<span class="ident" id="5557328">trimmer</span>&nbsp;<span class="keyword" id="5557336">struct</span>&nbsp;<span class="op" id="5557343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557346">output</span>&nbsp;<span class="ident" id="5557353">io</span><span class="op" id="5557355">.</span><span class="ident" id="5557356">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557364">state</span>&nbsp;&nbsp;<span class="builtintype" id="5557371">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557376">space</span>&nbsp;&nbsp;<span class="op" id="5557383">[</span><span class="op" id="5557384">]</span><span class="builtintype" id="5557385">byte</span><br>
<span class="lineno"></span><span class="op" id="5557390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5557393">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="5557439">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="5557484">const</span>&nbsp;<span class="op" id="5557490">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557493">inSpace</span>&nbsp;&nbsp;<span class="op" id="5557502">=</span>&nbsp;<span class="ident" id="5557504">iota</span>&nbsp;<span class="comment" id="5557509">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557526">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5557542">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557589">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5557605">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="5557620">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="5557623">func</span>&nbsp;<span class="op" id="5557628">(</span><span class="ident" id="5557629">p</span>&nbsp;<span class="op" id="5557631">*</span><span class="ident" id="5557632">trimmer</span><span class="op" id="5557639">)</span>&nbsp;<span class="ident" id="5557641">resetSpace</span><span class="op" id="5557651">(</span><span class="op" id="5557652">)</span>&nbsp;<span class="op" id="5557654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557657">p</span><span class="op" id="5557658">.</span><span class="ident" id="5557659">state</span>&nbsp;<span class="op" id="5557665">=</span>&nbsp;<span class="ident" id="5557667">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557676">p</span><span class="op" id="5557677">.</span><span class="ident" id="5557678">space</span>&nbsp;<span class="op" id="5557684">=</span>&nbsp;<span class="ident" id="5557686">p</span><span class="op" id="5557687">.</span><span class="ident" id="5557688">space</span><span class="op" id="5557693">[</span><span class="num" id="5557694">0</span><span class="op" id="5557695">:</span><span class="num" id="5557696">0</span><span class="op" id="5557697">]</span><br>
<span class="lineno"></span><span class="op" id="5557699">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="5557702">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5557772">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="5557842">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5557910">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="5557977">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5558009">var</span>&nbsp;<span class="ident" id="5558013">aNewline</span>&nbsp;<span class="op" id="5558022">=</span>&nbsp;<span class="op" id="5558024">[</span><span class="op" id="5558025">]</span><span class="builtintype" id="5558026">byte</span><span class="op" id="5558030">(</span><span class="string" id="5558031">&#34;\n&#34;</span><span class="op" id="5558035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5558038">func</span>&nbsp;<span class="op" id="5558043">(</span><span class="ident" id="5558044">p</span>&nbsp;<span class="op" id="5558046">*</span><span class="ident" id="5558047">trimmer</span><span class="op" id="5558054">)</span>&nbsp;<span class="ident" id="5558056">Write</span><span class="op" id="5558061">(</span><span class="ident" id="5558062">data</span>&nbsp;<span class="op" id="5558067">[</span><span class="op" id="5558068">]</span><span class="builtintype" id="5558069">byte</span><span class="op" id="5558073">)</span>&nbsp;<span class="op" id="5558075">(</span><span class="ident" id="5558076">n</span>&nbsp;<span class="builtintype" id="5558078">int</span><span class="op" id="5558081">,</span>&nbsp;<span class="ident" id="5558083">err</span>&nbsp;<span class="builtintype" id="5558087">error</span><span class="op" id="5558092">)</span>&nbsp;<span class="op" id="5558094">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5558097">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5558113">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5558137">//&nbsp;&nbsp;&nbsp;&nbsp;p.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5558162">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5558195">//&nbsp;&nbsp;&nbsp;&nbsp;data[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558222">m</span>&nbsp;<span class="op" id="5558224">:=</span>&nbsp;<span class="num" id="5558227">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558230">var</span>&nbsp;<span class="ident" id="5558234">b</span>&nbsp;<span class="builtintype" id="5558236">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558242">for</span>&nbsp;<span class="ident" id="5558246">n</span><span class="op" id="5558247">,</span>&nbsp;<span class="ident" id="5558249">b</span>&nbsp;<span class="op" id="5558251">=</span>&nbsp;<span class="keyword" id="5558253">range</span>&nbsp;<span class="ident" id="5558259">data</span>&nbsp;<span class="op" id="5558264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558268">if</span>&nbsp;<span class="ident" id="5558271">b</span>&nbsp;<span class="op" id="5558273">==</span>&nbsp;<span class="string" id="5558276">&#39;\v&#39;</span>&nbsp;<span class="op" id="5558281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558286">b</span>&nbsp;<span class="op" id="5558288">=</span>&nbsp;<span class="string" id="5558290">&#39;\t&#39;</span>&nbsp;<span class="comment" id="5558295">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5558316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558320">switch</span>&nbsp;<span class="ident" id="5558327">p</span><span class="op" id="5558328">.</span><span class="ident" id="5558329">state</span>&nbsp;<span class="op" id="5558335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558339">case</span>&nbsp;<span class="ident" id="5558344">inSpace</span><span class="op" id="5558351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558356">switch</span>&nbsp;<span class="ident" id="5558363">b</span>&nbsp;<span class="op" id="5558365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558370">case</span>&nbsp;<span class="string" id="5558375">&#39;\t&#39;</span><span class="op" id="5558379">,</span>&nbsp;<span class="string" id="5558381">&#39;&nbsp;&#39;</span><span class="op" id="5558384">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558390">p</span><span class="op" id="5558391">.</span><span class="ident" id="5558392">space</span>&nbsp;<span class="op" id="5558398">=</span>&nbsp;<span class="builtinfunc" id="5558400">append</span><span class="op" id="5558406">(</span><span class="ident" id="5558407">p</span><span class="op" id="5558408">.</span><span class="ident" id="5558409">space</span><span class="op" id="5558414">,</span>&nbsp;<span class="ident" id="5558416">b</span><span class="op" id="5558417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558422">case</span>&nbsp;<span class="string" id="5558427">&#39;\n&#39;</span><span class="op" id="5558431">,</span>&nbsp;<span class="string" id="5558433">&#39;\f&#39;</span><span class="op" id="5558437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558443">p</span><span class="op" id="5558444">.</span><span class="ident" id="5558445">resetSpace</span><span class="op" id="5558455">(</span><span class="op" id="5558456">)</span>&nbsp;<span class="comment" id="5558458">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558488">_</span><span class="op" id="5558489">,</span>&nbsp;<span class="ident" id="5558491">err</span>&nbsp;<span class="op" id="5558495">=</span>&nbsp;<span class="ident" id="5558497">p</span><span class="op" id="5558498">.</span><span class="ident" id="5558499">output</span><span class="op" id="5558505">.</span><span class="ident" id="5558506">Write</span><span class="op" id="5558511">(</span><span class="ident" id="5558512">aNewline</span><span class="op" id="5558520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558525">case</span>&nbsp;<span class="ident" id="5558530">tabwriter</span><span class="op" id="5558539">.</span><span class="ident" id="5558540">Escape</span><span class="op" id="5558546">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558552">_</span><span class="op" id="5558553">,</span>&nbsp;<span class="ident" id="5558555">err</span>&nbsp;<span class="op" id="5558559">=</span>&nbsp;<span class="ident" id="5558561">p</span><span class="op" id="5558562">.</span><span class="ident" id="5558563">output</span><span class="op" id="5558569">.</span><span class="ident" id="5558570">Write</span><span class="op" id="5558575">(</span><span class="ident" id="5558576">p</span><span class="op" id="5558577">.</span><span class="ident" id="5558578">space</span><span class="op" id="5558583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558589">p</span><span class="op" id="5558590">.</span><span class="ident" id="5558591">state</span>&nbsp;<span class="op" id="5558597">=</span>&nbsp;<span class="ident" id="5558599">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558612">m</span>&nbsp;<span class="op" id="5558614">=</span>&nbsp;<span class="ident" id="5558616">n</span>&nbsp;<span class="op" id="5558618">+</span>&nbsp;<span class="num" id="5558620">1</span>&nbsp;<span class="comment" id="5558622">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558654">default</span><span class="op" id="5558661">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558667">_</span><span class="op" id="5558668">,</span>&nbsp;<span class="ident" id="5558670">err</span>&nbsp;<span class="op" id="5558674">=</span>&nbsp;<span class="ident" id="5558676">p</span><span class="op" id="5558677">.</span><span class="ident" id="5558678">output</span><span class="op" id="5558684">.</span><span class="ident" id="5558685">Write</span><span class="op" id="5558690">(</span><span class="ident" id="5558691">p</span><span class="op" id="5558692">.</span><span class="ident" id="5558693">space</span><span class="op" id="5558698">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558704">p</span><span class="op" id="5558705">.</span><span class="ident" id="5558706">state</span>&nbsp;<span class="op" id="5558712">=</span>&nbsp;<span class="ident" id="5558714">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558725">m</span>&nbsp;<span class="op" id="5558727">=</span>&nbsp;<span class="ident" id="5558729">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5558734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558738">case</span>&nbsp;<span class="ident" id="5558743">inEscape</span><span class="op" id="5558751">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558756">if</span>&nbsp;<span class="ident" id="5558759">b</span>&nbsp;<span class="op" id="5558761">==</span>&nbsp;<span class="ident" id="5558764">tabwriter</span><span class="op" id="5558773">.</span><span class="ident" id="5558774">Escape</span>&nbsp;<span class="op" id="5558781">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558787">_</span><span class="op" id="5558788">,</span>&nbsp;<span class="ident" id="5558790">err</span>&nbsp;<span class="op" id="5558794">=</span>&nbsp;<span class="ident" id="5558796">p</span><span class="op" id="5558797">.</span><span class="ident" id="5558798">output</span><span class="op" id="5558804">.</span><span class="ident" id="5558805">Write</span><span class="op" id="5558810">(</span><span class="ident" id="5558811">data</span><span class="op" id="5558815">[</span><span class="ident" id="5558816">m</span><span class="op" id="5558817">:</span><span class="ident" id="5558818">n</span><span class="op" id="5558819">]</span><span class="op" id="5558820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558826">p</span><span class="op" id="5558827">.</span><span class="ident" id="5558828">resetSpace</span><span class="op" id="5558838">(</span><span class="op" id="5558839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5558844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558848">case</span>&nbsp;<span class="ident" id="5558853">inText</span><span class="op" id="5558859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558864">switch</span>&nbsp;<span class="ident" id="5558871">b</span>&nbsp;<span class="op" id="5558873">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558878">case</span>&nbsp;<span class="string" id="5558883">&#39;\t&#39;</span><span class="op" id="5558887">,</span>&nbsp;<span class="string" id="5558889">&#39;&nbsp;&#39;</span><span class="op" id="5558892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558898">_</span><span class="op" id="5558899">,</span>&nbsp;<span class="ident" id="5558901">err</span>&nbsp;<span class="op" id="5558905">=</span>&nbsp;<span class="ident" id="5558907">p</span><span class="op" id="5558908">.</span><span class="ident" id="5558909">output</span><span class="op" id="5558915">.</span><span class="ident" id="5558916">Write</span><span class="op" id="5558921">(</span><span class="ident" id="5558922">data</span><span class="op" id="5558926">[</span><span class="ident" id="5558927">m</span><span class="op" id="5558928">:</span><span class="ident" id="5558929">n</span><span class="op" id="5558930">]</span><span class="op" id="5558931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558937">p</span><span class="op" id="5558938">.</span><span class="ident" id="5558939">resetSpace</span><span class="op" id="5558949">(</span><span class="op" id="5558950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558956">p</span><span class="op" id="5558957">.</span><span class="ident" id="5558958">space</span>&nbsp;<span class="op" id="5558964">=</span>&nbsp;<span class="builtinfunc" id="5558966">append</span><span class="op" id="5558972">(</span><span class="ident" id="5558973">p</span><span class="op" id="5558974">.</span><span class="ident" id="5558975">space</span><span class="op" id="5558980">,</span>&nbsp;<span class="ident" id="5558982">b</span><span class="op" id="5558983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558988">case</span>&nbsp;<span class="string" id="5558993">&#39;\n&#39;</span><span class="op" id="5558997">,</span>&nbsp;<span class="string" id="5558999">&#39;\f&#39;</span><span class="op" id="5559003">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559009">_</span><span class="op" id="5559010">,</span>&nbsp;<span class="ident" id="5559012">err</span>&nbsp;<span class="op" id="5559016">=</span>&nbsp;<span class="ident" id="5559018">p</span><span class="op" id="5559019">.</span><span class="ident" id="5559020">output</span><span class="op" id="5559026">.</span><span class="ident" id="5559027">Write</span><span class="op" id="5559032">(</span><span class="ident" id="5559033">data</span><span class="op" id="5559037">[</span><span class="ident" id="5559038">m</span><span class="op" id="5559039">:</span><span class="ident" id="5559040">n</span><span class="op" id="5559041">]</span><span class="op" id="5559042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559048">p</span><span class="op" id="5559049">.</span><span class="ident" id="5559050">resetSpace</span><span class="op" id="5559060">(</span><span class="op" id="5559061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559067">_</span><span class="op" id="5559068">,</span>&nbsp;<span class="ident" id="5559070">err</span>&nbsp;<span class="op" id="5559074">=</span>&nbsp;<span class="ident" id="5559076">p</span><span class="op" id="5559077">.</span><span class="ident" id="5559078">output</span><span class="op" id="5559084">.</span><span class="ident" id="5559085">Write</span><span class="op" id="5559090">(</span><span class="ident" id="5559091">aNewline</span><span class="op" id="5559099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559104">case</span>&nbsp;<span class="ident" id="5559109">tabwriter</span><span class="op" id="5559118">.</span><span class="ident" id="5559119">Escape</span><span class="op" id="5559125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559131">_</span><span class="op" id="5559132">,</span>&nbsp;<span class="ident" id="5559134">err</span>&nbsp;<span class="op" id="5559138">=</span>&nbsp;<span class="ident" id="5559140">p</span><span class="op" id="5559141">.</span><span class="ident" id="5559142">output</span><span class="op" id="5559148">.</span><span class="ident" id="5559149">Write</span><span class="op" id="5559154">(</span><span class="ident" id="5559155">data</span><span class="op" id="5559159">[</span><span class="ident" id="5559160">m</span><span class="op" id="5559161">:</span><span class="ident" id="5559162">n</span><span class="op" id="5559163">]</span><span class="op" id="5559164">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559170">p</span><span class="op" id="5559171">.</span><span class="ident" id="5559172">state</span>&nbsp;<span class="op" id="5559178">=</span>&nbsp;<span class="ident" id="5559180">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559193">m</span>&nbsp;<span class="op" id="5559195">=</span>&nbsp;<span class="ident" id="5559197">n</span>&nbsp;<span class="op" id="5559199">+</span>&nbsp;<span class="num" id="5559201">1</span>&nbsp;<span class="comment" id="5559203">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5559235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559239">default</span><span class="op" id="5559246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5559251">panic</span><span class="op" id="5559256">(</span><span class="string" id="5559257">&#34;unreachable&#34;</span><span class="op" id="5559270">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5559274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559278">if</span>&nbsp;<span class="ident" id="5559281">err</span>&nbsp;<span class="op" id="5559285">!=</span>&nbsp;<span class="builtintype" id="5559288">nil</span>&nbsp;<span class="op" id="5559292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559297">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5559306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5559309">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559312">n</span>&nbsp;<span class="op" id="5559314">=</span>&nbsp;<span class="builtinfunc" id="5559316">len</span><span class="op" id="5559319">(</span><span class="ident" id="5559320">data</span><span class="op" id="5559324">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559328">switch</span>&nbsp;<span class="ident" id="5559335">p</span><span class="op" id="5559336">.</span><span class="ident" id="5559337">state</span>&nbsp;<span class="op" id="5559343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559346">case</span>&nbsp;<span class="ident" id="5559351">inEscape</span><span class="op" id="5559359">,</span>&nbsp;<span class="ident" id="5559361">inText</span><span class="op" id="5559367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559371">_</span><span class="op" id="5559372">,</span>&nbsp;<span class="ident" id="5559374">err</span>&nbsp;<span class="op" id="5559378">=</span>&nbsp;<span class="ident" id="5559380">p</span><span class="op" id="5559381">.</span><span class="ident" id="5559382">output</span><span class="op" id="5559388">.</span><span class="ident" id="5559389">Write</span><span class="op" id="5559394">(</span><span class="ident" id="5559395">data</span><span class="op" id="5559399">[</span><span class="ident" id="5559400">m</span><span class="op" id="5559401">:</span><span class="ident" id="5559402">n</span><span class="op" id="5559403">]</span><span class="op" id="5559404">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559408">p</span><span class="op" id="5559409">.</span><span class="ident" id="5559410">resetSpace</span><span class="op" id="5559420">(</span><span class="op" id="5559421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5559424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559428">return</span><br>
<span class="lineno"></span><span class="op" id="5559435">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="5559438">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5559518">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5559539">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="5559604">type</span>&nbsp;<span class="ident" id="5559609">Mode</span>&nbsp;<span class="builtintype" id="5559614">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5559620">const</span>&nbsp;<span class="op" id="5559626">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559629">RawFormat</span>&nbsp;<span class="ident" id="5559639">Mode</span>&nbsp;<span class="op" id="5559644">=</span>&nbsp;<span class="num" id="5559646">1</span>&nbsp;<span class="op" id="5559648">&lt;&lt;</span>&nbsp;<span class="ident" id="5559651">iota</span>&nbsp;<span class="comment" id="5559656">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559713">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5559740">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559794">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5559821">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559866">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5559893">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="5559955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5559958">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="5560006">type</span>&nbsp;<span class="ident" id="5560011">Config</span>&nbsp;<span class="keyword" id="5560018">struct</span>&nbsp;<span class="op" id="5560025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560028">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560037">Mode</span>&nbsp;<span class="comment" id="5560042">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560057">Tabwidth</span>&nbsp;<span class="builtintype" id="5560066">int</span>&nbsp;&nbsp;<span class="comment" id="5560071">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560086">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5560095">int</span>&nbsp;&nbsp;<span class="comment" id="5560100">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="5560159">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="5560162">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5560251">func</span>&nbsp;<span class="op" id="5560256">(</span><span class="ident" id="5560257">cfg</span>&nbsp;<span class="op" id="5560261">*</span><span class="ident" id="5560262">Config</span><span class="op" id="5560268">)</span>&nbsp;<span class="ident" id="5560270">fprint</span><span class="op" id="5560276">(</span><span class="ident" id="5560277">output</span>&nbsp;<span class="ident" id="5560284">io</span><span class="op" id="5560286">.</span><span class="ident" id="5560287">Writer</span><span class="op" id="5560293">,</span>&nbsp;<span class="ident" id="5560295">fset</span>&nbsp;<span class="op" id="5560300">*</span><span class="ident" id="5560301">token</span><span class="op" id="5560306">.</span><span class="ident" id="5560307">FileSet</span><span class="op" id="5560314">,</span>&nbsp;<span class="ident" id="5560316">node</span>&nbsp;<span class="keyword" id="5560321">interface</span><span class="op" id="5560330">{</span><span class="op" id="5560331">}</span><span class="op" id="5560332">,</span>&nbsp;<span class="ident" id="5560334">nodeSizes</span>&nbsp;<span class="keyword" id="5560344">map</span><span class="op" id="5560347">[</span><span class="ident" id="5560348">ast</span><span class="op" id="5560351">.</span><span class="ident" id="5560352">Node</span><span class="op" id="5560356">]</span><span class="builtintype" id="5560357">int</span><span class="op" id="5560360">)</span>&nbsp;<span class="op" id="5560362">(</span><span class="ident" id="5560363">err</span>&nbsp;<span class="builtintype" id="5560367">error</span><span class="op" id="5560372">)</span>&nbsp;<span class="op" id="5560374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560377">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560392">var</span>&nbsp;<span class="ident" id="5560396">p</span>&nbsp;<span class="ident" id="5560398">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560407">p</span><span class="op" id="5560408">.</span><span class="ident" id="5560409">init</span><span class="op" id="5560413">(</span><span class="ident" id="5560414">cfg</span><span class="op" id="5560417">,</span>&nbsp;<span class="ident" id="5560419">fset</span><span class="op" id="5560423">,</span>&nbsp;<span class="ident" id="5560425">nodeSizes</span><span class="op" id="5560434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560437">if</span>&nbsp;<span class="ident" id="5560440">err</span>&nbsp;<span class="op" id="5560444">=</span>&nbsp;<span class="ident" id="5560446">p</span><span class="op" id="5560447">.</span><span class="ident" id="5560448">printNode</span><span class="op" id="5560457">(</span><span class="ident" id="5560458">node</span><span class="op" id="5560462">)</span><span class="op" id="5560463">;</span>&nbsp;<span class="ident" id="5560465">err</span>&nbsp;<span class="op" id="5560469">!=</span>&nbsp;<span class="builtintype" id="5560472">nil</span>&nbsp;<span class="op" id="5560476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560480">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5560488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560491">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560522">p</span><span class="op" id="5560523">.</span><span class="ident" id="5560524">impliedSemi</span>&nbsp;<span class="op" id="5560536">=</span>&nbsp;<span class="builtintype" id="5560538">false</span>&nbsp;<span class="comment" id="5560544">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560572">p</span><span class="op" id="5560573">.</span><span class="ident" id="5560574">flush</span><span class="op" id="5560579">(</span><span class="ident" id="5560580">token</span><span class="op" id="5560585">.</span><span class="ident" id="5560586">Position</span><span class="op" id="5560594">{</span><span class="ident" id="5560595">Offset</span><span class="op" id="5560601">:</span>&nbsp;<span class="ident" id="5560603">infinity</span><span class="op" id="5560611">,</span>&nbsp;<span class="ident" id="5560613">Line</span><span class="op" id="5560617">:</span>&nbsp;<span class="ident" id="5560619">infinity</span><span class="op" id="5560627">}</span><span class="op" id="5560628">,</span>&nbsp;<span class="ident" id="5560630">token</span><span class="op" id="5560635">.</span><span class="ident" id="5560636">EOF</span><span class="op" id="5560639">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560643">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560714">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560786">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560851">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560918">output</span>&nbsp;<span class="op" id="5560925">=</span>&nbsp;<span class="op" id="5560927">&amp;</span><span class="ident" id="5560928">trimmer</span><span class="op" id="5560935">{</span><span class="ident" id="5560936">output</span><span class="op" id="5560942">:</span>&nbsp;<span class="ident" id="5560944">output</span><span class="op" id="5560950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560954">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561007">if</span>&nbsp;<span class="ident" id="5561010">cfg</span><span class="op" id="5561013">.</span><span class="ident" id="5561014">Mode</span><span class="op" id="5561018">&amp;</span><span class="ident" id="5561019">RawFormat</span>&nbsp;<span class="op" id="5561029">==</span>&nbsp;<span class="num" id="5561032">0</span>&nbsp;<span class="op" id="5561034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561038">minwidth</span>&nbsp;<span class="op" id="5561047">:=</span>&nbsp;<span class="ident" id="5561050">cfg</span><span class="op" id="5561053">.</span><span class="ident" id="5561054">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561066">padchar</span>&nbsp;<span class="op" id="5561074">:=</span>&nbsp;<span class="builtintype" id="5561077">byte</span><span class="op" id="5561081">(</span><span class="string" id="5561082">&#39;\t&#39;</span><span class="op" id="5561086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561090">if</span>&nbsp;<span class="ident" id="5561093">cfg</span><span class="op" id="5561096">.</span><span class="ident" id="5561097">Mode</span><span class="op" id="5561101">&amp;</span><span class="ident" id="5561102">UseSpaces</span>&nbsp;<span class="op" id="5561112">!=</span>&nbsp;<span class="num" id="5561115">0</span>&nbsp;<span class="op" id="5561117">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561122">padchar</span>&nbsp;<span class="op" id="5561130">=</span>&nbsp;<span class="string" id="5561132">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561143">twmode</span>&nbsp;<span class="op" id="5561150">:=</span>&nbsp;<span class="ident" id="5561153">tabwriter</span><span class="op" id="5561162">.</span><span class="ident" id="5561163">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561185">if</span>&nbsp;<span class="ident" id="5561188">cfg</span><span class="op" id="5561191">.</span><span class="ident" id="5561192">Mode</span><span class="op" id="5561196">&amp;</span><span class="ident" id="5561197">TabIndent</span>&nbsp;<span class="op" id="5561207">!=</span>&nbsp;<span class="num" id="5561210">0</span>&nbsp;<span class="op" id="5561212">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561217">minwidth</span>&nbsp;<span class="op" id="5561226">=</span>&nbsp;<span class="num" id="5561228">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561233">twmode</span>&nbsp;<span class="op" id="5561240">|=</span>&nbsp;<span class="ident" id="5561243">tabwriter</span><span class="op" id="5561252">.</span><span class="ident" id="5561253">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561270">output</span>&nbsp;<span class="op" id="5561277">=</span>&nbsp;<span class="ident" id="5561279">tabwriter</span><span class="op" id="5561288">.</span><span class="ident" id="5561289">NewWriter</span><span class="op" id="5561298">(</span><span class="ident" id="5561299">output</span><span class="op" id="5561305">,</span>&nbsp;<span class="ident" id="5561307">minwidth</span><span class="op" id="5561315">,</span>&nbsp;<span class="ident" id="5561317">cfg</span><span class="op" id="5561320">.</span><span class="ident" id="5561321">Tabwidth</span><span class="op" id="5561329">,</span>&nbsp;<span class="num" id="5561331">1</span><span class="op" id="5561332">,</span>&nbsp;<span class="ident" id="5561334">padchar</span><span class="op" id="5561341">,</span>&nbsp;<span class="ident" id="5561343">twmode</span><span class="op" id="5561349">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5561356">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561413">if</span>&nbsp;<span class="ident" id="5561416">_</span><span class="op" id="5561417">,</span>&nbsp;<span class="ident" id="5561419">err</span>&nbsp;<span class="op" id="5561423">=</span>&nbsp;<span class="ident" id="5561425">output</span><span class="op" id="5561431">.</span><span class="ident" id="5561432">Write</span><span class="op" id="5561437">(</span><span class="ident" id="5561438">p</span><span class="op" id="5561439">.</span><span class="ident" id="5561440">output</span><span class="op" id="5561446">)</span><span class="op" id="5561447">;</span>&nbsp;<span class="ident" id="5561449">err</span>&nbsp;<span class="op" id="5561453">!=</span>&nbsp;<span class="builtintype" id="5561456">nil</span>&nbsp;<span class="op" id="5561460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561464">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5561476">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561504">if</span>&nbsp;<span class="ident" id="5561507">tw</span><span class="op" id="5561509">,</span>&nbsp;<span class="ident" id="5561511">_</span>&nbsp;<span class="op" id="5561513">:=</span>&nbsp;<span class="ident" id="5561516">output</span><span class="op" id="5561522">.</span><span class="op" id="5561523">(</span><span class="op" id="5561524">*</span><span class="ident" id="5561525">tabwriter</span><span class="op" id="5561534">.</span><span class="ident" id="5561535">Writer</span><span class="op" id="5561541">)</span><span class="op" id="5561542">;</span>&nbsp;<span class="ident" id="5561544">tw</span>&nbsp;<span class="op" id="5561547">!=</span>&nbsp;<span class="builtintype" id="5561550">nil</span>&nbsp;<span class="op" id="5561554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561558">err</span>&nbsp;<span class="op" id="5561562">=</span>&nbsp;<span class="ident" id="5561564">tw</span><span class="op" id="5561566">.</span><span class="ident" id="5561567">Flush</span><span class="op" id="5561572">(</span><span class="op" id="5561573">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561580">return</span><br>
<span class="lineno"></span><span class="op" id="5561587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="5561590">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5561657">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5561723">//</span><br>
<span class="lineno"></span><span class="keyword" id="5561726">type</span>&nbsp;<span class="ident" id="5561731">CommentedNode</span>&nbsp;<span class="keyword" id="5561745">struct</span>&nbsp;<span class="op" id="5561752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561755">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561764">interface</span><span class="op" id="5561773">{</span><span class="op" id="5561774">}</span>&nbsp;<span class="comment" id="5561776">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561836">Comments</span>&nbsp;<span class="op" id="5561845">[</span><span class="op" id="5561846">]</span><span class="op" id="5561847">*</span><span class="ident" id="5561848">ast</span><span class="op" id="5561851">.</span><span class="ident" id="5561852">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="5561865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5561868">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="5561947">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="5562017">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="5562093">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="5562167">//</span><br>
<span class="lineno"></span><span class="keyword" id="5562170">func</span>&nbsp;<span class="op" id="5562175">(</span><span class="ident" id="5562176">cfg</span>&nbsp;<span class="op" id="5562180">*</span><span class="ident" id="5562181">Config</span><span class="op" id="5562187">)</span>&nbsp;<span class="ident" id="5562189">Fprint</span><span class="op" id="5562195">(</span><span class="ident" id="5562196">output</span>&nbsp;<span class="ident" id="5562203">io</span><span class="op" id="5562205">.</span><span class="ident" id="5562206">Writer</span><span class="op" id="5562212">,</span>&nbsp;<span class="ident" id="5562214">fset</span>&nbsp;<span class="op" id="5562219">*</span><span class="ident" id="5562220">token</span><span class="op" id="5562225">.</span><span class="ident" id="5562226">FileSet</span><span class="op" id="5562233">,</span>&nbsp;<span class="ident" id="5562235">node</span>&nbsp;<span class="keyword" id="5562240">interface</span><span class="op" id="5562249">{</span><span class="op" id="5562250">}</span><span class="op" id="5562251">)</span>&nbsp;<span class="builtintype" id="5562253">error</span>&nbsp;<span class="op" id="5562259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5562262">return</span>&nbsp;<span class="ident" id="5562269">cfg</span><span class="op" id="5562272">.</span><span class="ident" id="5562273">fprint</span><span class="op" id="5562279">(</span><span class="ident" id="5562280">output</span><span class="op" id="5562286">,</span>&nbsp;<span class="ident" id="5562288">fset</span><span class="op" id="5562292">,</span>&nbsp;<span class="ident" id="5562294">node</span><span class="op" id="5562298">,</span>&nbsp;<span class="builtinfunc" id="5562300">make</span><span class="op" id="5562304">(</span><span class="keyword" id="5562305">map</span><span class="op" id="5562308">[</span><span class="ident" id="5562309">ast</span><span class="op" id="5562312">.</span><span class="ident" id="5562313">Node</span><span class="op" id="5562317">]</span><span class="builtintype" id="5562318">int</span><span class="op" id="5562321">)</span><span class="op" id="5562322">)</span><br>
<span class="lineno">1285</span><span class="op" id="5562324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5562327">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5562376">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="5562425">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="5562428">func</span>&nbsp;<span class="ident" id="5562433">Fprint</span><span class="op" id="5562439">(</span><span class="ident" id="5562440">output</span>&nbsp;<span class="ident" id="5562447">io</span><span class="op" id="5562449">.</span><span class="ident" id="5562450">Writer</span><span class="op" id="5562456">,</span>&nbsp;<span class="ident" id="5562458">fset</span>&nbsp;<span class="op" id="5562463">*</span><span class="ident" id="5562464">token</span><span class="op" id="5562469">.</span><span class="ident" id="5562470">FileSet</span><span class="op" id="5562477">,</span>&nbsp;<span class="ident" id="5562479">node</span>&nbsp;<span class="keyword" id="5562484">interface</span><span class="op" id="5562493">{</span><span class="op" id="5562494">}</span><span class="op" id="5562495">)</span>&nbsp;<span class="builtintype" id="5562497">error</span>&nbsp;<span class="op" id="5562503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5562506">return</span>&nbsp;<span class="op" id="5562513">(</span><span class="op" id="5562514">&amp;</span><span class="ident" id="5562515">Config</span><span class="op" id="5562521">{</span><span class="ident" id="5562522">Tabwidth</span><span class="op" id="5562530">:</span>&nbsp;<span class="num" id="5562532">8</span><span class="op" id="5562533">}</span><span class="op" id="5562534">)</span><span class="op" id="5562535">.</span><span class="ident" id="5562536">Fprint</span><span class="op" id="5562542">(</span><span class="ident" id="5562543">output</span><span class="op" id="5562549">,</span>&nbsp;<span class="ident" id="5562551">fset</span><span class="op" id="5562555">,</span>&nbsp;<span class="ident" id="5562557">node</span><span class="op" id="5562561">)</span><br>
<span class="lineno"></span><span class="op" id="5562563">}</span>
</div>
</body>
</html>
