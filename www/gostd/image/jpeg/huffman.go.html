<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html" class="current">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4885093">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4885148">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4885202">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4885253">package</span>&nbsp;<span class="ident" id="4885261">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4885267">import</span>&nbsp;<span class="op" id="4885274">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4885277">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4885282">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4885285">//&nbsp;maxCodeLength&nbsp;is&nbsp;the&nbsp;maximum&nbsp;(inclusive)&nbsp;number&nbsp;of&nbsp;bits&nbsp;in&nbsp;a&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="4885363">const</span>&nbsp;<span class="ident" id="4885369">maxCodeLength</span>&nbsp;<span class="op" id="4885383">=</span>&nbsp;<span class="num" id="4885385">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4885389">//&nbsp;maxNCodes&nbsp;is&nbsp;the&nbsp;maximum&nbsp;(inclusive)&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;a&nbsp;Huffman&nbsp;tree.</span><br>
<span class="lineno">15</span><span class="keyword" id="4885464">const</span>&nbsp;<span class="ident" id="4885470">maxNCodes</span>&nbsp;<span class="op" id="4885480">=</span>&nbsp;<span class="num" id="4885482">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4885487">//&nbsp;lutSize&nbsp;is&nbsp;the&nbsp;log-2&nbsp;size&nbsp;of&nbsp;the&nbsp;Huffman&nbsp;decoder&#39;s&nbsp;look-up&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword" id="4885556">const</span>&nbsp;<span class="ident" id="4885562">lutSize</span>&nbsp;<span class="op" id="4885570">=</span>&nbsp;<span class="num" id="4885572">8</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4885575">//&nbsp;huffman&nbsp;is&nbsp;a&nbsp;Huffman&nbsp;decoder,&nbsp;specified&nbsp;in&nbsp;section&nbsp;C.</span><br>
<span class="lineno"></span><span class="keyword" id="4885632">type</span>&nbsp;<span class="ident" id="4885637">huffman</span>&nbsp;<span class="keyword" id="4885645">struct</span>&nbsp;<span class="op" id="4885652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4885655">//&nbsp;length&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4885702">nCodes</span>&nbsp;<span class="builtintype" id="4885709">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4885716">//&nbsp;lut&nbsp;is&nbsp;the&nbsp;look-up&nbsp;table&nbsp;for&nbsp;the&nbsp;next&nbsp;lutSize&nbsp;bits&nbsp;in&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4885790">//&nbsp;The&nbsp;high&nbsp;8&nbsp;bits&nbsp;of&nbsp;the&nbsp;uint16&nbsp;are&nbsp;the&nbsp;encoded&nbsp;value.&nbsp;The&nbsp;low&nbsp;8&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4885862">//&nbsp;are&nbsp;1&nbsp;plus&nbsp;the&nbsp;code&nbsp;length,&nbsp;or&nbsp;0&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;fit&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4885935">//&nbsp;lutSize&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4885953">lut</span>&nbsp;<span class="op" id="4885957">[</span><span class="num" id="4885958">1</span>&nbsp;<span class="op" id="4885960">&lt;&lt;</span>&nbsp;<span class="ident" id="4885963">lutSize</span><span class="op" id="4885970">]</span><span class="builtintype" id="4885971">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4885979">//&nbsp;vals&nbsp;are&nbsp;the&nbsp;decoded&nbsp;values,&nbsp;sorted&nbsp;by&nbsp;their&nbsp;encoding.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4886038">vals</span>&nbsp;<span class="op" id="4886043">[</span><span class="ident" id="4886044">maxNCodes</span><span class="op" id="4886053">]</span><span class="builtintype" id="4886054">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4886061">//&nbsp;minCodes[i]&nbsp;is&nbsp;the&nbsp;minimum&nbsp;code&nbsp;of&nbsp;length&nbsp;i,&nbsp;or&nbsp;-1&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4886132">//&nbsp;codes&nbsp;of&nbsp;that&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4886158">minCodes</span>&nbsp;<span class="op" id="4886167">[</span><span class="ident" id="4886168">maxCodeLength</span><span class="op" id="4886181">]</span><span class="builtintype" id="4886182">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4886189">//&nbsp;maxCodes[i]&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code&nbsp;of&nbsp;length&nbsp;i,&nbsp;or&nbsp;-1&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4886260">//&nbsp;codes&nbsp;of&nbsp;that&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4886286">maxCodes</span>&nbsp;<span class="op" id="4886295">[</span><span class="ident" id="4886296">maxCodeLength</span><span class="op" id="4886309">]</span><span class="builtintype" id="4886310">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4886317">//&nbsp;valsIndices[i]&nbsp;is&nbsp;the&nbsp;index&nbsp;into&nbsp;vals&nbsp;of&nbsp;minCodes[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4886375">valsIndices</span>&nbsp;<span class="op" id="4886387">[</span><span class="ident" id="4886388">maxCodeLength</span><span class="op" id="4886401">]</span><span class="builtintype" id="4886402">int32</span><br>
<span class="lineno"></span><span class="op" id="4886408">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4886411">//&nbsp;errShortHuffmanData&nbsp;means&nbsp;that&nbsp;an&nbsp;unexpected&nbsp;EOF&nbsp;occurred&nbsp;while&nbsp;decoding</span><br>
<span class="lineno"></span><span class="comment" id="4886487">//&nbsp;Huffman&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4886504">var</span>&nbsp;<span class="ident" id="4886508">errShortHuffmanData</span>&nbsp;<span class="op" id="4886528">=</span>&nbsp;<span class="ident" id="4886530">FormatError</span><span class="op" id="4886541">(</span><span class="string" id="4886542">&#34;short&nbsp;Huffman&nbsp;data&#34;</span><span class="op" id="4886562">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4886565">//&nbsp;ensureNBits&nbsp;reads&nbsp;bytes&nbsp;from&nbsp;the&nbsp;byte&nbsp;buffer&nbsp;to&nbsp;ensure&nbsp;that&nbsp;d.bits.n&nbsp;is&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="4886643">//&nbsp;least&nbsp;n.&nbsp;For&nbsp;best&nbsp;performance&nbsp;(avoiding&nbsp;function&nbsp;calls&nbsp;inside&nbsp;hot&nbsp;loops),</span><br>
<span class="lineno"></span><span class="comment" id="4886720">//&nbsp;the&nbsp;caller&nbsp;is&nbsp;the&nbsp;one&nbsp;responsible&nbsp;for&nbsp;first&nbsp;checking&nbsp;that&nbsp;d.bits.n&nbsp;&lt;&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="4886795">func</span>&nbsp;<span class="op" id="4886800">(</span><span class="ident" id="4886801">d</span>&nbsp;<span class="op" id="4886803">*</span><span class="ident" id="4886804">decoder</span><span class="op" id="4886811">)</span>&nbsp;<span class="ident" id="4886813">ensureNBits</span><span class="op" id="4886824">(</span><span class="ident" id="4886825">n</span>&nbsp;<span class="builtintype" id="4886827">int32</span><span class="op" id="4886832">)</span>&nbsp;<span class="builtintype" id="4886834">error</span>&nbsp;<span class="op" id="4886840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4886843">for</span>&nbsp;<span class="op" id="4886847">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4886851">c</span><span class="op" id="4886852">,</span>&nbsp;<span class="ident" id="4886854">err</span>&nbsp;<span class="op" id="4886858">:=</span>&nbsp;<span class="ident" id="4886861">d</span><span class="op" id="4886862">.</span><span class="ident" id="4886863">readByteStuffedByte</span><span class="op" id="4886882">(</span><span class="op" id="4886883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4886887">if</span>&nbsp;<span class="ident" id="4886890">err</span>&nbsp;<span class="op" id="4886894">!=</span>&nbsp;<span class="builtintype" id="4886897">nil</span>&nbsp;<span class="op" id="4886901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4886906">if</span>&nbsp;<span class="ident" id="4886909">err</span>&nbsp;<span class="op" id="4886913">==</span>&nbsp;<span class="ident" id="4886916">io</span><span class="op" id="4886918">.</span><span class="ident" id="4886919">EOF</span>&nbsp;<span class="op" id="4886923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4886929">return</span>&nbsp;<span class="ident" id="4886936">errShortHuffmanData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4886959">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4886964">return</span>&nbsp;<span class="ident" id="4886971">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4886977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4886981">d</span><span class="op" id="4886982">.</span><span class="ident" id="4886983">bits</span><span class="op" id="4886987">.</span><span class="ident" id="4886988">a</span>&nbsp;<span class="op" id="4886990">=</span>&nbsp;<span class="ident" id="4886992">d</span><span class="op" id="4886993">.</span><span class="ident" id="4886994">bits</span><span class="op" id="4886998">.</span><span class="ident" id="4886999">a</span><span class="op" id="4887000">&lt;&lt;</span><span class="num" id="4887002">8</span>&nbsp;<span class="op" id="4887004">|</span>&nbsp;<span class="builtintype" id="4887006">uint32</span><span class="op" id="4887012">(</span><span class="ident" id="4887013">c</span><span class="op" id="4887014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887018">d</span><span class="op" id="4887019">.</span><span class="ident" id="4887020">bits</span><span class="op" id="4887024">.</span><span class="ident" id="4887025">n</span>&nbsp;<span class="op" id="4887027">+=</span>&nbsp;<span class="num" id="4887030">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887034">if</span>&nbsp;<span class="ident" id="4887037">d</span><span class="op" id="4887038">.</span><span class="ident" id="4887039">bits</span><span class="op" id="4887043">.</span><span class="ident" id="4887044">m</span>&nbsp;<span class="op" id="4887046">==</span>&nbsp;<span class="num" id="4887049">0</span>&nbsp;<span class="op" id="4887051">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887056">d</span><span class="op" id="4887057">.</span><span class="ident" id="4887058">bits</span><span class="op" id="4887062">.</span><span class="ident" id="4887063">m</span>&nbsp;<span class="op" id="4887065">=</span>&nbsp;<span class="num" id="4887067">1</span>&nbsp;<span class="op" id="4887069">&lt;&lt;</span>&nbsp;<span class="num" id="4887072">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887076">}</span>&nbsp;<span class="keyword" id="4887078">else</span>&nbsp;<span class="op" id="4887083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887088">d</span><span class="op" id="4887089">.</span><span class="ident" id="4887090">bits</span><span class="op" id="4887094">.</span><span class="ident" id="4887095">m</span>&nbsp;<span class="op" id="4887097">&lt;&lt;=</span>&nbsp;<span class="num" id="4887101">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887109">if</span>&nbsp;<span class="ident" id="4887112">d</span><span class="op" id="4887113">.</span><span class="ident" id="4887114">bits</span><span class="op" id="4887118">.</span><span class="ident" id="4887119">n</span>&nbsp;<span class="op" id="4887121">&gt;=</span>&nbsp;<span class="ident" id="4887124">n</span>&nbsp;<span class="op" id="4887126">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887131">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887145">return</span>&nbsp;<span class="builtintype" id="4887152">nil</span><br>
<span class="lineno"></span><span class="op" id="4887156">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="4887159">//&nbsp;receiveExtend&nbsp;is&nbsp;the&nbsp;composition&nbsp;of&nbsp;RECEIVE&nbsp;and&nbsp;EXTEND,&nbsp;specified&nbsp;in&nbsp;section</span><br>
<span class="lineno"></span><span class="comment" id="4887239">//&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4887251">func</span>&nbsp;<span class="op" id="4887256">(</span><span class="ident" id="4887257">d</span>&nbsp;<span class="op" id="4887259">*</span><span class="ident" id="4887260">decoder</span><span class="op" id="4887267">)</span>&nbsp;<span class="ident" id="4887269">receiveExtend</span><span class="op" id="4887282">(</span><span class="ident" id="4887283">t</span>&nbsp;<span class="builtintype" id="4887285">uint8</span><span class="op" id="4887290">)</span>&nbsp;<span class="op" id="4887292">(</span><span class="builtintype" id="4887293">int32</span><span class="op" id="4887298">,</span>&nbsp;<span class="builtintype" id="4887300">error</span><span class="op" id="4887305">)</span>&nbsp;<span class="op" id="4887307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887310">if</span>&nbsp;<span class="ident" id="4887313">d</span><span class="op" id="4887314">.</span><span class="ident" id="4887315">bits</span><span class="op" id="4887319">.</span><span class="ident" id="4887320">n</span>&nbsp;<span class="op" id="4887322">&lt;</span>&nbsp;<span class="builtintype" id="4887324">int32</span><span class="op" id="4887329">(</span><span class="ident" id="4887330">t</span><span class="op" id="4887331">)</span>&nbsp;<span class="op" id="4887333">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887337">if</span>&nbsp;<span class="ident" id="4887340">err</span>&nbsp;<span class="op" id="4887344">:=</span>&nbsp;<span class="ident" id="4887347">d</span><span class="op" id="4887348">.</span><span class="ident" id="4887349">ensureNBits</span><span class="op" id="4887360">(</span><span class="builtintype" id="4887361">int32</span><span class="op" id="4887366">(</span><span class="ident" id="4887367">t</span><span class="op" id="4887368">)</span><span class="op" id="4887369">)</span><span class="op" id="4887370">;</span>&nbsp;<span class="ident" id="4887372">err</span>&nbsp;<span class="op" id="4887376">!=</span>&nbsp;<span class="builtintype" id="4887379">nil</span>&nbsp;<span class="op" id="4887383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887388">return</span>&nbsp;<span class="num" id="4887395">0</span><span class="op" id="4887396">,</span>&nbsp;<span class="ident" id="4887398">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887410">d</span><span class="op" id="4887411">.</span><span class="ident" id="4887412">bits</span><span class="op" id="4887416">.</span><span class="ident" id="4887417">n</span>&nbsp;<span class="op" id="4887419">-=</span>&nbsp;<span class="builtintype" id="4887422">int32</span><span class="op" id="4887427">(</span><span class="ident" id="4887428">t</span><span class="op" id="4887429">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887432">d</span><span class="op" id="4887433">.</span><span class="ident" id="4887434">bits</span><span class="op" id="4887438">.</span><span class="ident" id="4887439">m</span>&nbsp;<span class="op" id="4887441">&gt;&gt;=</span>&nbsp;<span class="ident" id="4887445">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887448">s</span>&nbsp;<span class="op" id="4887450">:=</span>&nbsp;<span class="builtintype" id="4887453">int32</span><span class="op" id="4887458">(</span><span class="num" id="4887459">1</span><span class="op" id="4887460">)</span>&nbsp;<span class="op" id="4887462">&lt;&lt;</span>&nbsp;<span class="ident" id="4887465">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887468">x</span>&nbsp;<span class="op" id="4887470">:=</span>&nbsp;<span class="builtintype" id="4887473">int32</span><span class="op" id="4887478">(</span><span class="ident" id="4887479">d</span><span class="op" id="4887480">.</span><span class="ident" id="4887481">bits</span><span class="op" id="4887485">.</span><span class="ident" id="4887486">a</span><span class="op" id="4887487">&gt;&gt;</span><span class="builtintype" id="4887489">uint8</span><span class="op" id="4887494">(</span><span class="ident" id="4887495">d</span><span class="op" id="4887496">.</span><span class="ident" id="4887497">bits</span><span class="op" id="4887501">.</span><span class="ident" id="4887502">n</span><span class="op" id="4887503">)</span><span class="op" id="4887504">)</span>&nbsp;<span class="op" id="4887506">&amp;</span>&nbsp;<span class="op" id="4887508">(</span><span class="ident" id="4887509">s</span>&nbsp;<span class="op" id="4887511">-</span>&nbsp;<span class="num" id="4887513">1</span><span class="op" id="4887514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887517">if</span>&nbsp;<span class="ident" id="4887520">x</span>&nbsp;<span class="op" id="4887522">&lt;</span>&nbsp;<span class="ident" id="4887524">s</span><span class="op" id="4887525">&gt;&gt;</span><span class="num" id="4887527">1</span>&nbsp;<span class="op" id="4887529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887533">x</span>&nbsp;<span class="op" id="4887535">+=</span>&nbsp;<span class="op" id="4887538">(</span><span class="op" id="4887539">(</span><span class="op" id="4887540">-</span><span class="num" id="4887541">1</span><span class="op" id="4887542">)</span>&nbsp;<span class="op" id="4887544">&lt;&lt;</span>&nbsp;<span class="ident" id="4887547">t</span><span class="op" id="4887548">)</span>&nbsp;<span class="op" id="4887550">+</span>&nbsp;<span class="num" id="4887552">1</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887558">return</span>&nbsp;<span class="ident" id="4887565">x</span><span class="op" id="4887566">,</span>&nbsp;<span class="builtintype" id="4887568">nil</span><br>
<span class="lineno"></span><span class="op" id="4887572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4887575">//&nbsp;processDHT&nbsp;processes&nbsp;a&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker,&nbsp;and&nbsp;initializes&nbsp;a&nbsp;huffman</span><br>
<span class="lineno">90</span><span class="comment" id="4887656">//&nbsp;struct&nbsp;from&nbsp;its&nbsp;contents.&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.2.</span><br>
<span class="lineno"></span><span class="keyword" id="4887715">func</span>&nbsp;<span class="op" id="4887720">(</span><span class="ident" id="4887721">d</span>&nbsp;<span class="op" id="4887723">*</span><span class="ident" id="4887724">decoder</span><span class="op" id="4887731">)</span>&nbsp;<span class="ident" id="4887733">processDHT</span><span class="op" id="4887743">(</span><span class="ident" id="4887744">n</span>&nbsp;<span class="builtintype" id="4887746">int</span><span class="op" id="4887749">)</span>&nbsp;<span class="builtintype" id="4887751">error</span>&nbsp;<span class="op" id="4887757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887760">for</span>&nbsp;<span class="ident" id="4887764">n</span>&nbsp;<span class="op" id="4887766">&gt;</span>&nbsp;<span class="num" id="4887768">0</span>&nbsp;<span class="op" id="4887770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887774">if</span>&nbsp;<span class="ident" id="4887777">n</span>&nbsp;<span class="op" id="4887779">&lt;</span>&nbsp;<span class="num" id="4887781">17</span>&nbsp;<span class="op" id="4887784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887789">return</span>&nbsp;<span class="ident" id="4887796">FormatError</span><span class="op" id="4887807">(</span><span class="string" id="4887808">&#34;DHT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="4887830">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887838">if</span>&nbsp;<span class="ident" id="4887841">err</span>&nbsp;<span class="op" id="4887845">:=</span>&nbsp;<span class="ident" id="4887848">d</span><span class="op" id="4887849">.</span><span class="ident" id="4887850">readFull</span><span class="op" id="4887858">(</span><span class="ident" id="4887859">d</span><span class="op" id="4887860">.</span><span class="ident" id="4887861">tmp</span><span class="op" id="4887864">[</span><span class="op" id="4887865">:</span><span class="num" id="4887866">17</span><span class="op" id="4887868">]</span><span class="op" id="4887869">)</span><span class="op" id="4887870">;</span>&nbsp;<span class="ident" id="4887872">err</span>&nbsp;<span class="op" id="4887876">!=</span>&nbsp;<span class="builtintype" id="4887879">nil</span>&nbsp;<span class="op" id="4887883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887888">return</span>&nbsp;<span class="ident" id="4887895">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887905">tc</span>&nbsp;<span class="op" id="4887908">:=</span>&nbsp;<span class="ident" id="4887911">d</span><span class="op" id="4887912">.</span><span class="ident" id="4887913">tmp</span><span class="op" id="4887916">[</span><span class="num" id="4887917">0</span><span class="op" id="4887918">]</span>&nbsp;<span class="op" id="4887920">&gt;&gt;</span>&nbsp;<span class="num" id="4887923">4</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887927">if</span>&nbsp;<span class="ident" id="4887930">tc</span>&nbsp;<span class="op" id="4887933">&gt;</span>&nbsp;<span class="ident" id="4887935">maxTc</span>&nbsp;<span class="op" id="4887941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4887946">return</span>&nbsp;<span class="ident" id="4887953">FormatError</span><span class="op" id="4887964">(</span><span class="string" id="4887965">&#34;bad&nbsp;Tc&nbsp;value&#34;</span><span class="op" id="4887979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4887987">th</span>&nbsp;<span class="op" id="4887990">:=</span>&nbsp;<span class="ident" id="4887993">d</span><span class="op" id="4887994">.</span><span class="ident" id="4887995">tmp</span><span class="op" id="4887998">[</span><span class="num" id="4887999">0</span><span class="op" id="4888000">]</span>&nbsp;<span class="op" id="4888002">&amp;</span>&nbsp;<span class="num" id="4888004">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888011">if</span>&nbsp;<span class="ident" id="4888014">th</span>&nbsp;<span class="op" id="4888017">&gt;</span>&nbsp;<span class="ident" id="4888019">maxTh</span>&nbsp;<span class="op" id="4888025">||</span>&nbsp;<span class="op" id="4888028">!</span><span class="ident" id="4888029">d</span><span class="op" id="4888030">.</span><span class="ident" id="4888031">progressive</span>&nbsp;<span class="op" id="4888043">&amp;&amp;</span>&nbsp;<span class="ident" id="4888046">th</span>&nbsp;<span class="op" id="4888049">&gt;</span>&nbsp;<span class="num" id="4888051">1</span>&nbsp;<span class="op" id="4888053">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888058">return</span>&nbsp;<span class="ident" id="4888065">FormatError</span><span class="op" id="4888076">(</span><span class="string" id="4888077">&#34;bad&nbsp;Th&nbsp;value&#34;</span><span class="op" id="4888091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4888095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888099">h</span>&nbsp;<span class="op" id="4888101">:=</span>&nbsp;<span class="op" id="4888104">&amp;</span><span class="ident" id="4888105">d</span><span class="op" id="4888106">.</span><span class="ident" id="4888107">huff</span><span class="op" id="4888111">[</span><span class="ident" id="4888112">tc</span><span class="op" id="4888114">]</span><span class="op" id="4888115">[</span><span class="ident" id="4888116">th</span><span class="op" id="4888118">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4888123">//&nbsp;Read&nbsp;nCodes&nbsp;and&nbsp;h.vals&nbsp;(and&nbsp;derive&nbsp;h.nCodes).</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4888174">//&nbsp;nCodes[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;with&nbsp;code&nbsp;length&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4888232">//&nbsp;h.nCodes&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888276">h</span><span class="op" id="4888277">.</span><span class="ident" id="4888278">nCodes</span>&nbsp;<span class="op" id="4888285">=</span>&nbsp;<span class="num" id="4888287">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888291">var</span>&nbsp;<span class="ident" id="4888295">nCodes</span>&nbsp;<span class="op" id="4888302">[</span><span class="ident" id="4888303">maxCodeLength</span><span class="op" id="4888316">]</span><span class="builtintype" id="4888317">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888325">for</span>&nbsp;<span class="ident" id="4888329">i</span>&nbsp;<span class="op" id="4888331">:=</span>&nbsp;<span class="keyword" id="4888334">range</span>&nbsp;<span class="ident" id="4888340">nCodes</span>&nbsp;<span class="op" id="4888347">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888352">nCodes</span><span class="op" id="4888358">[</span><span class="ident" id="4888359">i</span><span class="op" id="4888360">]</span>&nbsp;<span class="op" id="4888362">=</span>&nbsp;<span class="builtintype" id="4888364">int32</span><span class="op" id="4888369">(</span><span class="ident" id="4888370">d</span><span class="op" id="4888371">.</span><span class="ident" id="4888372">tmp</span><span class="op" id="4888375">[</span><span class="ident" id="4888376">i</span><span class="op" id="4888377">+</span><span class="num" id="4888378">1</span><span class="op" id="4888379">]</span><span class="op" id="4888380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888385">h</span><span class="op" id="4888386">.</span><span class="ident" id="4888387">nCodes</span>&nbsp;<span class="op" id="4888394">+=</span>&nbsp;<span class="ident" id="4888397">nCodes</span><span class="op" id="4888403">[</span><span class="ident" id="4888404">i</span><span class="op" id="4888405">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4888409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888413">if</span>&nbsp;<span class="ident" id="4888416">h</span><span class="op" id="4888417">.</span><span class="ident" id="4888418">nCodes</span>&nbsp;<span class="op" id="4888425">==</span>&nbsp;<span class="num" id="4888428">0</span>&nbsp;<span class="op" id="4888430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888435">return</span>&nbsp;<span class="ident" id="4888442">FormatError</span><span class="op" id="4888453">(</span><span class="string" id="4888454">&#34;Huffman&nbsp;table&nbsp;has&nbsp;zero&nbsp;length&#34;</span><span class="op" id="4888485">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4888489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888493">if</span>&nbsp;<span class="ident" id="4888496">h</span><span class="op" id="4888497">.</span><span class="ident" id="4888498">nCodes</span>&nbsp;<span class="op" id="4888505">&gt;</span>&nbsp;<span class="ident" id="4888507">maxNCodes</span>&nbsp;<span class="op" id="4888517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888522">return</span>&nbsp;<span class="ident" id="4888529">FormatError</span><span class="op" id="4888540">(</span><span class="string" id="4888541">&#34;Huffman&nbsp;table&nbsp;has&nbsp;excessive&nbsp;length&#34;</span><span class="op" id="4888577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4888581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888585">n</span>&nbsp;<span class="op" id="4888587">-=</span>&nbsp;<span class="builtintype" id="4888590">int</span><span class="op" id="4888593">(</span><span class="ident" id="4888594">h</span><span class="op" id="4888595">.</span><span class="ident" id="4888596">nCodes</span><span class="op" id="4888602">)</span>&nbsp;<span class="op" id="4888604">+</span>&nbsp;<span class="num" id="4888606">17</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888611">if</span>&nbsp;<span class="ident" id="4888614">n</span>&nbsp;<span class="op" id="4888616">&lt;</span>&nbsp;<span class="num" id="4888618">0</span>&nbsp;<span class="op" id="4888620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888625">return</span>&nbsp;<span class="ident" id="4888632">FormatError</span><span class="op" id="4888643">(</span><span class="string" id="4888644">&#34;DHT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="4888666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4888670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888674">if</span>&nbsp;<span class="ident" id="4888677">err</span>&nbsp;<span class="op" id="4888681">:=</span>&nbsp;<span class="ident" id="4888684">d</span><span class="op" id="4888685">.</span><span class="ident" id="4888686">readFull</span><span class="op" id="4888694">(</span><span class="ident" id="4888695">h</span><span class="op" id="4888696">.</span><span class="ident" id="4888697">vals</span><span class="op" id="4888701">[</span><span class="op" id="4888702">:</span><span class="ident" id="4888703">h</span><span class="op" id="4888704">.</span><span class="ident" id="4888705">nCodes</span><span class="op" id="4888711">]</span><span class="op" id="4888712">)</span><span class="op" id="4888713">;</span>&nbsp;<span class="ident" id="4888715">err</span>&nbsp;<span class="op" id="4888719">!=</span>&nbsp;<span class="builtintype" id="4888722">nil</span>&nbsp;<span class="op" id="4888726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888731">return</span>&nbsp;<span class="ident" id="4888738">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4888744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4888749">//&nbsp;Derive&nbsp;the&nbsp;look-up&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888780">for</span>&nbsp;<span class="ident" id="4888784">i</span>&nbsp;<span class="op" id="4888786">:=</span>&nbsp;<span class="keyword" id="4888789">range</span>&nbsp;<span class="ident" id="4888795">h</span><span class="op" id="4888796">.</span><span class="ident" id="4888797">lut</span>&nbsp;<span class="op" id="4888801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888806">h</span><span class="op" id="4888807">.</span><span class="ident" id="4888808">lut</span><span class="op" id="4888811">[</span><span class="ident" id="4888812">i</span><span class="op" id="4888813">]</span>&nbsp;<span class="op" id="4888815">=</span>&nbsp;<span class="num" id="4888817">0</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4888821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888825">var</span>&nbsp;<span class="ident" id="4888829">x</span><span class="op" id="4888830">,</span>&nbsp;<span class="ident" id="4888832">code</span>&nbsp;<span class="builtintype" id="4888837">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888846">for</span>&nbsp;<span class="ident" id="4888850">i</span>&nbsp;<span class="op" id="4888852">:=</span>&nbsp;<span class="builtintype" id="4888855">uint32</span><span class="op" id="4888861">(</span><span class="num" id="4888862">0</span><span class="op" id="4888863">)</span><span class="op" id="4888864">;</span>&nbsp;<span class="ident" id="4888866">i</span>&nbsp;<span class="op" id="4888868">&lt;</span>&nbsp;<span class="ident" id="4888870">lutSize</span><span class="op" id="4888877">;</span>&nbsp;<span class="ident" id="4888879">i</span><span class="op" id="4888880">++</span>&nbsp;<span class="op" id="4888883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4888888">code</span>&nbsp;<span class="op" id="4888893">&lt;&lt;=</span>&nbsp;<span class="num" id="4888897">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4888902">for</span>&nbsp;<span class="ident" id="4888906">j</span>&nbsp;<span class="op" id="4888908">:=</span>&nbsp;<span class="builtintype" id="4888911">int32</span><span class="op" id="4888916">(</span><span class="num" id="4888917">0</span><span class="op" id="4888918">)</span><span class="op" id="4888919">;</span>&nbsp;<span class="ident" id="4888921">j</span>&nbsp;<span class="op" id="4888923">&lt;</span>&nbsp;<span class="ident" id="4888925">nCodes</span><span class="op" id="4888931">[</span><span class="ident" id="4888932">i</span><span class="op" id="4888933">]</span><span class="op" id="4888934">;</span>&nbsp;<span class="ident" id="4888936">j</span><span class="op" id="4888937">++</span>&nbsp;<span class="op" id="4888940">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4888946">//&nbsp;The&nbsp;codeLength&nbsp;is&nbsp;1+i,&nbsp;so&nbsp;shift&nbsp;code&nbsp;by&nbsp;8-(1+i)&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4889004">//&nbsp;calculate&nbsp;the&nbsp;high&nbsp;bits&nbsp;for&nbsp;every&nbsp;8-bit&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4889060">//&nbsp;whose&nbsp;codeLength&#39;s&nbsp;high&nbsp;bits&nbsp;matches&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4889110">//&nbsp;The&nbsp;high&nbsp;8&nbsp;bits&nbsp;of&nbsp;lutValue&nbsp;are&nbsp;the&nbsp;encoded&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4889168">//&nbsp;The&nbsp;low&nbsp;8&nbsp;bits&nbsp;are&nbsp;1&nbsp;plus&nbsp;the&nbsp;codeLength.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889217">base</span>&nbsp;<span class="op" id="4889222">:=</span>&nbsp;<span class="builtintype" id="4889225">uint8</span><span class="op" id="4889230">(</span><span class="ident" id="4889231">code</span>&nbsp;<span class="op" id="4889236">&lt;&lt;</span>&nbsp;<span class="op" id="4889239">(</span><span class="num" id="4889240">7</span>&nbsp;<span class="op" id="4889242">-</span>&nbsp;<span class="ident" id="4889244">i</span><span class="op" id="4889245">)</span><span class="op" id="4889246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889252">lutValue</span>&nbsp;<span class="op" id="4889261">:=</span>&nbsp;<span class="builtintype" id="4889264">uint16</span><span class="op" id="4889270">(</span><span class="ident" id="4889271">h</span><span class="op" id="4889272">.</span><span class="ident" id="4889273">vals</span><span class="op" id="4889277">[</span><span class="ident" id="4889278">x</span><span class="op" id="4889279">]</span><span class="op" id="4889280">)</span><span class="op" id="4889281">&lt;&lt;</span><span class="num" id="4889283">8</span>&nbsp;<span class="op" id="4889285">|</span>&nbsp;<span class="builtintype" id="4889287">uint16</span><span class="op" id="4889293">(</span><span class="num" id="4889294">2</span><span class="op" id="4889295">+</span><span class="ident" id="4889296">i</span><span class="op" id="4889297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889303">for</span>&nbsp;<span class="ident" id="4889307">k</span>&nbsp;<span class="op" id="4889309">:=</span>&nbsp;<span class="builtintype" id="4889312">uint8</span><span class="op" id="4889317">(</span><span class="num" id="4889318">0</span><span class="op" id="4889319">)</span><span class="op" id="4889320">;</span>&nbsp;<span class="ident" id="4889322">k</span>&nbsp;<span class="op" id="4889324">&lt;</span>&nbsp;<span class="num" id="4889326">1</span><span class="op" id="4889327">&lt;&lt;</span><span class="op" id="4889329">(</span><span class="num" id="4889330">7</span><span class="op" id="4889331">-</span><span class="ident" id="4889332">i</span><span class="op" id="4889333">)</span><span class="op" id="4889334">;</span>&nbsp;<span class="ident" id="4889336">k</span><span class="op" id="4889337">++</span>&nbsp;<span class="op" id="4889340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889347">h</span><span class="op" id="4889348">.</span><span class="ident" id="4889349">lut</span><span class="op" id="4889352">[</span><span class="ident" id="4889353">base</span><span class="op" id="4889357">|</span><span class="ident" id="4889358">k</span><span class="op" id="4889359">]</span>&nbsp;<span class="op" id="4889361">=</span>&nbsp;<span class="ident" id="4889363">lutValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889376">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889382">code</span><span class="op" id="4889386">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889393">x</span><span class="op" id="4889394">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4889409">//&nbsp;Derive&nbsp;minCodes,&nbsp;maxCodes,&nbsp;and&nbsp;valsIndices.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889458">var</span>&nbsp;<span class="ident" id="4889462">c</span><span class="op" id="4889463">,</span>&nbsp;<span class="ident" id="4889465">index</span>&nbsp;<span class="builtintype" id="4889471">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889479">for</span>&nbsp;<span class="ident" id="4889483">i</span><span class="op" id="4889484">,</span>&nbsp;<span class="ident" id="4889486">n</span>&nbsp;<span class="op" id="4889488">:=</span>&nbsp;<span class="keyword" id="4889491">range</span>&nbsp;<span class="ident" id="4889497">nCodes</span>&nbsp;<span class="op" id="4889504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889509">if</span>&nbsp;<span class="ident" id="4889512">n</span>&nbsp;<span class="op" id="4889514">==</span>&nbsp;<span class="num" id="4889517">0</span>&nbsp;<span class="op" id="4889519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889525">h</span><span class="op" id="4889526">.</span><span class="ident" id="4889527">minCodes</span><span class="op" id="4889535">[</span><span class="ident" id="4889536">i</span><span class="op" id="4889537">]</span>&nbsp;<span class="op" id="4889539">=</span>&nbsp;<span class="op" id="4889541">-</span><span class="num" id="4889542">1</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889548">h</span><span class="op" id="4889549">.</span><span class="ident" id="4889550">maxCodes</span><span class="op" id="4889558">[</span><span class="ident" id="4889559">i</span><span class="op" id="4889560">]</span>&nbsp;<span class="op" id="4889562">=</span>&nbsp;<span class="op" id="4889564">-</span><span class="num" id="4889565">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889571">h</span><span class="op" id="4889572">.</span><span class="ident" id="4889573">valsIndices</span><span class="op" id="4889584">[</span><span class="ident" id="4889585">i</span><span class="op" id="4889586">]</span>&nbsp;<span class="op" id="4889588">=</span>&nbsp;<span class="op" id="4889590">-</span><span class="num" id="4889591">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889596">}</span>&nbsp;<span class="keyword" id="4889598">else</span>&nbsp;<span class="op" id="4889603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889609">h</span><span class="op" id="4889610">.</span><span class="ident" id="4889611">minCodes</span><span class="op" id="4889619">[</span><span class="ident" id="4889620">i</span><span class="op" id="4889621">]</span>&nbsp;<span class="op" id="4889623">=</span>&nbsp;<span class="ident" id="4889625">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889631">h</span><span class="op" id="4889632">.</span><span class="ident" id="4889633">maxCodes</span><span class="op" id="4889641">[</span><span class="ident" id="4889642">i</span><span class="op" id="4889643">]</span>&nbsp;<span class="op" id="4889645">=</span>&nbsp;<span class="ident" id="4889647">c</span>&nbsp;<span class="op" id="4889649">+</span>&nbsp;<span class="ident" id="4889651">n</span>&nbsp;<span class="op" id="4889653">-</span>&nbsp;<span class="num" id="4889655">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889661">h</span><span class="op" id="4889662">.</span><span class="ident" id="4889663">valsIndices</span><span class="op" id="4889674">[</span><span class="ident" id="4889675">i</span><span class="op" id="4889676">]</span>&nbsp;<span class="op" id="4889678">=</span>&nbsp;<span class="ident" id="4889680">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889690">c</span>&nbsp;<span class="op" id="4889692">+=</span>&nbsp;<span class="ident" id="4889695">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889701">index</span>&nbsp;<span class="op" id="4889707">+=</span>&nbsp;<span class="ident" id="4889710">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889720">c</span>&nbsp;<span class="op" id="4889722">&lt;&lt;=</span>&nbsp;<span class="num" id="4889726">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889736">return</span>&nbsp;<span class="builtintype" id="4889743">nil</span><br>
<span class="lineno"></span><span class="op" id="4889747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="4889750">//&nbsp;decodeHuffman&nbsp;returns&nbsp;the&nbsp;next&nbsp;Huffman-coded&nbsp;value&nbsp;from&nbsp;the&nbsp;bit-stream,</span><br>
<span class="lineno"></span><span class="comment" id="4889825">//&nbsp;decoded&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno"></span><span class="keyword" id="4889852">func</span>&nbsp;<span class="op" id="4889857">(</span><span class="ident" id="4889858">d</span>&nbsp;<span class="op" id="4889860">*</span><span class="ident" id="4889861">decoder</span><span class="op" id="4889868">)</span>&nbsp;<span class="ident" id="4889870">decodeHuffman</span><span class="op" id="4889883">(</span><span class="ident" id="4889884">h</span>&nbsp;<span class="op" id="4889886">*</span><span class="ident" id="4889887">huffman</span><span class="op" id="4889894">)</span>&nbsp;<span class="op" id="4889896">(</span><span class="builtintype" id="4889897">uint8</span><span class="op" id="4889902">,</span>&nbsp;<span class="builtintype" id="4889904">error</span><span class="op" id="4889909">)</span>&nbsp;<span class="op" id="4889911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889914">if</span>&nbsp;<span class="ident" id="4889917">h</span><span class="op" id="4889918">.</span><span class="ident" id="4889919">nCodes</span>&nbsp;<span class="op" id="4889926">==</span>&nbsp;<span class="num" id="4889929">0</span>&nbsp;<span class="op" id="4889931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889935">return</span>&nbsp;<span class="num" id="4889942">0</span><span class="op" id="4889943">,</span>&nbsp;<span class="ident" id="4889945">FormatError</span><span class="op" id="4889956">(</span><span class="string" id="4889957">&#34;uninitialized&nbsp;Huffman&nbsp;table&#34;</span><span class="op" id="4889986">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4889993">if</span>&nbsp;<span class="ident" id="4889996">d</span><span class="op" id="4889997">.</span><span class="ident" id="4889998">bits</span><span class="op" id="4890002">.</span><span class="ident" id="4890003">n</span>&nbsp;<span class="op" id="4890005">&lt;</span>&nbsp;<span class="num" id="4890007">8</span>&nbsp;<span class="op" id="4890009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890013">if</span>&nbsp;<span class="ident" id="4890016">err</span>&nbsp;<span class="op" id="4890020">:=</span>&nbsp;<span class="ident" id="4890023">d</span><span class="op" id="4890024">.</span><span class="ident" id="4890025">ensureNBits</span><span class="op" id="4890036">(</span><span class="num" id="4890037">8</span><span class="op" id="4890038">)</span><span class="op" id="4890039">;</span>&nbsp;<span class="ident" id="4890041">err</span>&nbsp;<span class="op" id="4890045">!=</span>&nbsp;<span class="builtintype" id="4890048">nil</span>&nbsp;<span class="op" id="4890052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890057">if</span>&nbsp;<span class="ident" id="4890060">err</span>&nbsp;<span class="op" id="4890064">!=</span>&nbsp;<span class="ident" id="4890067">errMissingFF00</span>&nbsp;<span class="op" id="4890082">&amp;&amp;</span>&nbsp;<span class="ident" id="4890085">err</span>&nbsp;<span class="op" id="4890089">!=</span>&nbsp;<span class="ident" id="4890092">errShortHuffmanData</span>&nbsp;<span class="op" id="4890112">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890118">return</span>&nbsp;<span class="num" id="4890125">0</span><span class="op" id="4890126">,</span>&nbsp;<span class="ident" id="4890128">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4890140">//&nbsp;There&nbsp;are&nbsp;no&nbsp;more&nbsp;bytes&nbsp;of&nbsp;data&nbsp;in&nbsp;this&nbsp;segment,&nbsp;but&nbsp;we&nbsp;may&nbsp;still</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4890212">//&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;the&nbsp;next&nbsp;symbol&nbsp;out&nbsp;of&nbsp;the&nbsp;previously&nbsp;read&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4890283">//&nbsp;First,&nbsp;undo&nbsp;the&nbsp;readByte&nbsp;that&nbsp;the&nbsp;ensureNBits&nbsp;call&nbsp;made.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890346">d</span><span class="op" id="4890347">.</span><span class="ident" id="4890348">unreadByteStuffedByte</span><span class="op" id="4890369">(</span><span class="op" id="4890370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890375">goto</span>&nbsp;<span class="ident" id="4890380">slowPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890397">if</span>&nbsp;<span class="ident" id="4890400">v</span>&nbsp;<span class="op" id="4890402">:=</span>&nbsp;<span class="ident" id="4890405">h</span><span class="op" id="4890406">.</span><span class="ident" id="4890407">lut</span><span class="op" id="4890410">[</span><span class="op" id="4890411">(</span><span class="ident" id="4890412">d</span><span class="op" id="4890413">.</span><span class="ident" id="4890414">bits</span><span class="op" id="4890418">.</span><span class="ident" id="4890419">a</span><span class="op" id="4890420">&gt;&gt;</span><span class="builtintype" id="4890422">uint32</span><span class="op" id="4890428">(</span><span class="ident" id="4890429">d</span><span class="op" id="4890430">.</span><span class="ident" id="4890431">bits</span><span class="op" id="4890435">.</span><span class="ident" id="4890436">n</span><span class="op" id="4890437">-</span><span class="ident" id="4890438">lutSize</span><span class="op" id="4890445">)</span><span class="op" id="4890446">)</span><span class="op" id="4890447">&amp;</span><span class="num" id="4890448">0xff</span><span class="op" id="4890452">]</span><span class="op" id="4890453">;</span>&nbsp;<span class="ident" id="4890455">v</span>&nbsp;<span class="op" id="4890457">!=</span>&nbsp;<span class="num" id="4890460">0</span>&nbsp;<span class="op" id="4890462">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890466">n</span>&nbsp;<span class="op" id="4890468">:=</span>&nbsp;<span class="op" id="4890471">(</span><span class="ident" id="4890472">v</span>&nbsp;<span class="op" id="4890474">&amp;</span>&nbsp;<span class="num" id="4890476">0xff</span><span class="op" id="4890480">)</span>&nbsp;<span class="op" id="4890482">-</span>&nbsp;<span class="num" id="4890484">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890488">d</span><span class="op" id="4890489">.</span><span class="ident" id="4890490">bits</span><span class="op" id="4890494">.</span><span class="ident" id="4890495">n</span>&nbsp;<span class="op" id="4890497">-=</span>&nbsp;<span class="builtintype" id="4890500">int32</span><span class="op" id="4890505">(</span><span class="ident" id="4890506">n</span><span class="op" id="4890507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890511">d</span><span class="op" id="4890512">.</span><span class="ident" id="4890513">bits</span><span class="op" id="4890517">.</span><span class="ident" id="4890518">m</span>&nbsp;<span class="op" id="4890520">&gt;&gt;=</span>&nbsp;<span class="ident" id="4890524">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890528">return</span>&nbsp;<span class="builtintype" id="4890535">uint8</span><span class="op" id="4890540">(</span><span class="ident" id="4890541">v</span>&nbsp;<span class="op" id="4890543">&gt;&gt;</span>&nbsp;<span class="num" id="4890546">8</span><span class="op" id="4890547">)</span><span class="op" id="4890548">,</span>&nbsp;<span class="builtintype" id="4890550">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890555">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="ident" id="4890558">slowPath</span><span class="op" id="4890566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890569">for</span>&nbsp;<span class="ident" id="4890573">i</span><span class="op" id="4890574">,</span>&nbsp;<span class="ident" id="4890576">code</span>&nbsp;<span class="op" id="4890581">:=</span>&nbsp;<span class="num" id="4890584">0</span><span class="op" id="4890585">,</span>&nbsp;<span class="builtintype" id="4890587">int32</span><span class="op" id="4890592">(</span><span class="num" id="4890593">0</span><span class="op" id="4890594">)</span><span class="op" id="4890595">;</span>&nbsp;<span class="ident" id="4890597">i</span>&nbsp;<span class="op" id="4890599">&lt;</span>&nbsp;<span class="ident" id="4890601">maxCodeLength</span><span class="op" id="4890614">;</span>&nbsp;<span class="ident" id="4890616">i</span><span class="op" id="4890617">++</span>&nbsp;<span class="op" id="4890620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890624">if</span>&nbsp;<span class="ident" id="4890627">d</span><span class="op" id="4890628">.</span><span class="ident" id="4890629">bits</span><span class="op" id="4890633">.</span><span class="ident" id="4890634">n</span>&nbsp;<span class="op" id="4890636">==</span>&nbsp;<span class="num" id="4890639">0</span>&nbsp;<span class="op" id="4890641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890646">if</span>&nbsp;<span class="ident" id="4890649">err</span>&nbsp;<span class="op" id="4890653">:=</span>&nbsp;<span class="ident" id="4890656">d</span><span class="op" id="4890657">.</span><span class="ident" id="4890658">ensureNBits</span><span class="op" id="4890669">(</span><span class="num" id="4890670">1</span><span class="op" id="4890671">)</span><span class="op" id="4890672">;</span>&nbsp;<span class="ident" id="4890674">err</span>&nbsp;<span class="op" id="4890678">!=</span>&nbsp;<span class="builtintype" id="4890681">nil</span>&nbsp;<span class="op" id="4890685">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890691">return</span>&nbsp;<span class="num" id="4890698">0</span><span class="op" id="4890699">,</span>&nbsp;<span class="ident" id="4890701">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890716">if</span>&nbsp;<span class="ident" id="4890719">d</span><span class="op" id="4890720">.</span><span class="ident" id="4890721">bits</span><span class="op" id="4890725">.</span><span class="ident" id="4890726">a</span><span class="op" id="4890727">&amp;</span><span class="ident" id="4890728">d</span><span class="op" id="4890729">.</span><span class="ident" id="4890730">bits</span><span class="op" id="4890734">.</span><span class="ident" id="4890735">m</span>&nbsp;<span class="op" id="4890737">!=</span>&nbsp;<span class="num" id="4890740">0</span>&nbsp;<span class="op" id="4890742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890747">code</span>&nbsp;<span class="op" id="4890752">|=</span>&nbsp;<span class="num" id="4890755">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890763">d</span><span class="op" id="4890764">.</span><span class="ident" id="4890765">bits</span><span class="op" id="4890769">.</span><span class="ident" id="4890770">n</span><span class="op" id="4890771">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890776">d</span><span class="op" id="4890777">.</span><span class="ident" id="4890778">bits</span><span class="op" id="4890782">.</span><span class="ident" id="4890783">m</span>&nbsp;<span class="op" id="4890785">&gt;&gt;=</span>&nbsp;<span class="num" id="4890789">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890793">if</span>&nbsp;<span class="ident" id="4890796">code</span>&nbsp;<span class="op" id="4890801">&lt;=</span>&nbsp;<span class="ident" id="4890804">h</span><span class="op" id="4890805">.</span><span class="ident" id="4890806">maxCodes</span><span class="op" id="4890814">[</span><span class="ident" id="4890815">i</span><span class="op" id="4890816">]</span>&nbsp;<span class="op" id="4890818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890823">return</span>&nbsp;<span class="ident" id="4890830">h</span><span class="op" id="4890831">.</span><span class="ident" id="4890832">vals</span><span class="op" id="4890836">[</span><span class="ident" id="4890837">h</span><span class="op" id="4890838">.</span><span class="ident" id="4890839">valsIndices</span><span class="op" id="4890850">[</span><span class="ident" id="4890851">i</span><span class="op" id="4890852">]</span><span class="op" id="4890853">+</span><span class="ident" id="4890854">code</span><span class="op" id="4890858">-</span><span class="ident" id="4890859">h</span><span class="op" id="4890860">.</span><span class="ident" id="4890861">minCodes</span><span class="op" id="4890869">[</span><span class="ident" id="4890870">i</span><span class="op" id="4890871">]</span><span class="op" id="4890872">]</span><span class="op" id="4890873">,</span>&nbsp;<span class="builtintype" id="4890875">nil</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4890885">code</span>&nbsp;<span class="op" id="4890890">&lt;&lt;=</span>&nbsp;<span class="num" id="4890894">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4890897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890900">return</span>&nbsp;<span class="num" id="4890907">0</span><span class="op" id="4890908">,</span>&nbsp;<span class="ident" id="4890910">FormatError</span><span class="op" id="4890921">(</span><span class="string" id="4890922">&#34;bad&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="4890940">)</span><br>
<span class="lineno"></span><span class="op" id="4890942">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="4890945">func</span>&nbsp;<span class="op" id="4890950">(</span><span class="ident" id="4890951">d</span>&nbsp;<span class="op" id="4890953">*</span><span class="ident" id="4890954">decoder</span><span class="op" id="4890961">)</span>&nbsp;<span class="ident" id="4890963">decodeBit</span><span class="op" id="4890972">(</span><span class="op" id="4890973">)</span>&nbsp;<span class="op" id="4890975">(</span><span class="builtintype" id="4890976">bool</span><span class="op" id="4890980">,</span>&nbsp;<span class="builtintype" id="4890982">error</span><span class="op" id="4890987">)</span>&nbsp;<span class="op" id="4890989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4890992">if</span>&nbsp;<span class="ident" id="4890995">d</span><span class="op" id="4890996">.</span><span class="ident" id="4890997">bits</span><span class="op" id="4891001">.</span><span class="ident" id="4891002">n</span>&nbsp;<span class="op" id="4891004">==</span>&nbsp;<span class="num" id="4891007">0</span>&nbsp;<span class="op" id="4891009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4891013">if</span>&nbsp;<span class="ident" id="4891016">err</span>&nbsp;<span class="op" id="4891020">:=</span>&nbsp;<span class="ident" id="4891023">d</span><span class="op" id="4891024">.</span><span class="ident" id="4891025">ensureNBits</span><span class="op" id="4891036">(</span><span class="num" id="4891037">1</span><span class="op" id="4891038">)</span><span class="op" id="4891039">;</span>&nbsp;<span class="ident" id="4891041">err</span>&nbsp;<span class="op" id="4891045">!=</span>&nbsp;<span class="builtintype" id="4891048">nil</span>&nbsp;<span class="op" id="4891052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4891057">return</span>&nbsp;<span class="builtintype" id="4891064">false</span><span class="op" id="4891069">,</span>&nbsp;<span class="ident" id="4891071">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4891077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4891080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4891083">ret</span>&nbsp;<span class="op" id="4891087">:=</span>&nbsp;<span class="ident" id="4891090">d</span><span class="op" id="4891091">.</span><span class="ident" id="4891092">bits</span><span class="op" id="4891096">.</span><span class="ident" id="4891097">a</span><span class="op" id="4891098">&amp;</span><span class="ident" id="4891099">d</span><span class="op" id="4891100">.</span><span class="ident" id="4891101">bits</span><span class="op" id="4891105">.</span><span class="ident" id="4891106">m</span>&nbsp;<span class="op" id="4891108">!=</span>&nbsp;<span class="num" id="4891111">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4891114">d</span><span class="op" id="4891115">.</span><span class="ident" id="4891116">bits</span><span class="op" id="4891120">.</span><span class="ident" id="4891121">n</span><span class="op" id="4891122">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4891126">d</span><span class="op" id="4891127">.</span><span class="ident" id="4891128">bits</span><span class="op" id="4891132">.</span><span class="ident" id="4891133">m</span>&nbsp;<span class="op" id="4891135">&gt;&gt;=</span>&nbsp;<span class="num" id="4891139">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4891142">return</span>&nbsp;<span class="ident" id="4891149">ret</span><span class="op" id="4891152">,</span>&nbsp;<span class="builtintype" id="4891154">nil</span><br>
<span class="lineno"></span><span class="op" id="4891158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4891161">func</span>&nbsp;<span class="op" id="4891166">(</span><span class="ident" id="4891167">d</span>&nbsp;<span class="op" id="4891169">*</span><span class="ident" id="4891170">decoder</span><span class="op" id="4891177">)</span>&nbsp;<span class="ident" id="4891179">decodeBits</span><span class="op" id="4891189">(</span><span class="ident" id="4891190">n</span>&nbsp;<span class="builtintype" id="4891192">int32</span><span class="op" id="4891197">)</span>&nbsp;<span class="op" id="4891199">(</span><span class="builtintype" id="4891200">uint32</span><span class="op" id="4891206">,</span>&nbsp;<span class="builtintype" id="4891208">error</span><span class="op" id="4891213">)</span>&nbsp;<span class="op" id="4891215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4891218">if</span>&nbsp;<span class="ident" id="4891221">d</span><span class="op" id="4891222">.</span><span class="ident" id="4891223">bits</span><span class="op" id="4891227">.</span><span class="ident" id="4891228">n</span>&nbsp;<span class="op" id="4891230">&lt;</span>&nbsp;<span class="ident" id="4891232">n</span>&nbsp;<span class="op" id="4891234">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4891238">if</span>&nbsp;<span class="ident" id="4891241">err</span>&nbsp;<span class="op" id="4891245">:=</span>&nbsp;<span class="ident" id="4891248">d</span><span class="op" id="4891249">.</span><span class="ident" id="4891250">ensureNBits</span><span class="op" id="4891261">(</span><span class="ident" id="4891262">n</span><span class="op" id="4891263">)</span><span class="op" id="4891264">;</span>&nbsp;<span class="ident" id="4891266">err</span>&nbsp;<span class="op" id="4891270">!=</span>&nbsp;<span class="builtintype" id="4891273">nil</span>&nbsp;<span class="op" id="4891277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4891282">return</span>&nbsp;<span class="num" id="4891289">0</span><span class="op" id="4891290">,</span>&nbsp;<span class="ident" id="4891292">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4891298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4891301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4891304">ret</span>&nbsp;<span class="op" id="4891308">:=</span>&nbsp;<span class="ident" id="4891311">d</span><span class="op" id="4891312">.</span><span class="ident" id="4891313">bits</span><span class="op" id="4891317">.</span><span class="ident" id="4891318">a</span>&nbsp;<span class="op" id="4891320">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4891323">uint32</span><span class="op" id="4891329">(</span><span class="ident" id="4891330">d</span><span class="op" id="4891331">.</span><span class="ident" id="4891332">bits</span><span class="op" id="4891336">.</span><span class="ident" id="4891337">n</span><span class="op" id="4891338">-</span><span class="ident" id="4891339">n</span><span class="op" id="4891340">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4891343">ret</span>&nbsp;<span class="op" id="4891347">&amp;=</span>&nbsp;<span class="op" id="4891350">(</span><span class="num" id="4891351">1</span>&nbsp;<span class="op" id="4891353">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4891356">uint32</span><span class="op" id="4891362">(</span><span class="ident" id="4891363">n</span><span class="op" id="4891364">)</span><span class="op" id="4891365">)</span>&nbsp;<span class="op" id="4891367">-</span>&nbsp;<span class="num" id="4891369">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4891372">d</span><span class="op" id="4891373">.</span><span class="ident" id="4891374">bits</span><span class="op" id="4891378">.</span><span class="ident" id="4891379">n</span>&nbsp;<span class="op" id="4891381">-=</span>&nbsp;<span class="ident" id="4891384">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4891387">d</span><span class="op" id="4891388">.</span><span class="ident" id="4891389">bits</span><span class="op" id="4891393">.</span><span class="ident" id="4891394">m</span>&nbsp;<span class="op" id="4891396">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4891400">uint32</span><span class="op" id="4891406">(</span><span class="ident" id="4891407">n</span><span class="op" id="4891408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4891411">return</span>&nbsp;<span class="ident" id="4891418">ret</span><span class="op" id="4891421">,</span>&nbsp;<span class="builtintype" id="4891423">nil</span><br>
<span class="lineno"></span><span class="op" id="4891427">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
