<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7169735">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7169790">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7169844">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7169895">package</span>&nbsp;<span class="ident" id="7169903">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7169908">import</span>&nbsp;<span class="op" id="7169915">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7169918">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7169927">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7169943">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7169957">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7169972">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7169988">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7169995">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7170001">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7170008">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7170014">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7170025">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7170042">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7170053">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7170064">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7170071">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7170074">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="7170149">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7170165">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="7170242">type</span>&nbsp;<span class="ident" id="7170247">blockingSource</span>&nbsp;<span class="keyword" id="7170262">chan</span>&nbsp;<span class="builtintype" id="7170267">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7170273">func</span>&nbsp;<span class="op" id="7170278">(</span><span class="ident" id="7170279">b</span>&nbsp;<span class="ident" id="7170281">blockingSource</span><span class="op" id="7170295">)</span>&nbsp;<span class="ident" id="7170297">Read</span><span class="op" id="7170301">(</span><span class="op" id="7170302">[</span><span class="op" id="7170303">]</span><span class="builtintype" id="7170304">byte</span><span class="op" id="7170308">)</span>&nbsp;<span class="op" id="7170310">(</span><span class="ident" id="7170311">n</span>&nbsp;<span class="builtintype" id="7170313">int</span><span class="op" id="7170316">,</span>&nbsp;<span class="ident" id="7170318">err</span>&nbsp;<span class="builtintype" id="7170322">error</span><span class="op" id="7170327">)</span>&nbsp;<span class="op" id="7170329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7170332">&lt;-</span><span class="ident" id="7170334">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7170337">return</span>&nbsp;<span class="num" id="7170344">0</span><span class="op" id="7170345">,</span>&nbsp;<span class="ident" id="7170347">io</span><span class="op" id="7170349">.</span><span class="ident" id="7170350">EOF</span><br>
<span class="lineno"></span><span class="op" id="7170354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="7170357">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7170437">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7170456">type</span>&nbsp;<span class="ident" id="7170461">clientTest</span>&nbsp;<span class="keyword" id="7170472">struct</span>&nbsp;<span class="op" id="7170479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7170482">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7170555">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7170596">name</span>&nbsp;<span class="builtintype" id="7170601">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7170609">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7170675">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7170720">command</span>&nbsp;<span class="op" id="7170728">[</span><span class="op" id="7170729">]</span><span class="builtintype" id="7170730">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7170738">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7170809">config</span>&nbsp;<span class="op" id="7170816">*</span><span class="ident" id="7170817">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7170825">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7170892">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7170914">cert</span>&nbsp;<span class="op" id="7170919">[</span><span class="op" id="7170920">]</span><span class="builtintype" id="7170921">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7170927">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7170985">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7171058">key</span>&nbsp;<span class="keyword" id="7171062">interface</span><span class="op" id="7171071">{</span><span class="op" id="7171072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7171075">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7171144">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7171214">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7171264">validate</span>&nbsp;<span class="keyword" id="7171273">func</span><span class="op" id="7171277">(</span><span class="ident" id="7171278">ConnectionState</span><span class="op" id="7171293">)</span>&nbsp;<span class="builtintype" id="7171295">error</span><br>
<span class="lineno"></span><span class="op" id="7171301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7171304">var</span>&nbsp;<span class="ident" id="7171308">defaultServerCommand</span>&nbsp;<span class="op" id="7171329">=</span>&nbsp;<span class="op" id="7171331">[</span><span class="op" id="7171332">]</span><span class="builtintype" id="7171333">string</span><span class="op" id="7171339">{</span><span class="string" id="7171340">&#34;openssl&#34;</span><span class="op" id="7171349">,</span>&nbsp;<span class="string" id="7171351">&#34;s_server&#34;</span><span class="op" id="7171361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="7171364">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="7171439">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7171514">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="7171593">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="7171615">func</span>&nbsp;<span class="op" id="7171620">(</span><span class="ident" id="7171621">test</span>&nbsp;<span class="op" id="7171626">*</span><span class="ident" id="7171627">clientTest</span><span class="op" id="7171637">)</span>&nbsp;<span class="ident" id="7171639">connFromCommand</span><span class="op" id="7171654">(</span><span class="op" id="7171655">)</span>&nbsp;<span class="op" id="7171657">(</span><span class="ident" id="7171658">conn</span>&nbsp;<span class="op" id="7171663">*</span><span class="ident" id="7171664">recordingConn</span><span class="op" id="7171677">,</span>&nbsp;<span class="ident" id="7171679">child</span>&nbsp;<span class="op" id="7171685">*</span><span class="ident" id="7171686">exec</span><span class="op" id="7171690">.</span><span class="ident" id="7171691">Cmd</span><span class="op" id="7171694">,</span>&nbsp;<span class="ident" id="7171696">stdin</span>&nbsp;<span class="ident" id="7171702">blockingSource</span><span class="op" id="7171716">,</span>&nbsp;<span class="ident" id="7171718">err</span>&nbsp;<span class="builtintype" id="7171722">error</span><span class="op" id="7171727">)</span>&nbsp;<span class="op" id="7171729">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7171732">cert</span>&nbsp;<span class="op" id="7171737">:=</span>&nbsp;<span class="ident" id="7171740">testRSACertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7171760">if</span>&nbsp;<span class="builtinfunc" id="7171763">len</span><span class="op" id="7171766">(</span><span class="ident" id="7171767">test</span><span class="op" id="7171771">.</span><span class="ident" id="7171772">cert</span><span class="op" id="7171776">)</span>&nbsp;<span class="op" id="7171778">&gt;</span>&nbsp;<span class="num" id="7171780">0</span>&nbsp;<span class="op" id="7171782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7171786">cert</span>&nbsp;<span class="op" id="7171791">=</span>&nbsp;<span class="ident" id="7171793">test</span><span class="op" id="7171797">.</span><span class="ident" id="7171798">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7171804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7171807">certPath</span>&nbsp;<span class="op" id="7171816">:=</span>&nbsp;<span class="ident" id="7171819">tempFile</span><span class="op" id="7171827">(</span><span class="builtintype" id="7171828">string</span><span class="op" id="7171834">(</span><span class="ident" id="7171835">cert</span><span class="op" id="7171839">)</span><span class="op" id="7171840">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7171843">defer</span>&nbsp;<span class="ident" id="7171849">os</span><span class="op" id="7171851">.</span><span class="ident" id="7171852">Remove</span><span class="op" id="7171858">(</span><span class="ident" id="7171859">certPath</span><span class="op" id="7171867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7171871">var</span>&nbsp;<span class="ident" id="7171875">key</span>&nbsp;<span class="keyword" id="7171879">interface</span><span class="op" id="7171888">{</span><span class="op" id="7171889">}</span>&nbsp;<span class="op" id="7171891">=</span>&nbsp;<span class="ident" id="7171893">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7171912">if</span>&nbsp;<span class="ident" id="7171915">test</span><span class="op" id="7171919">.</span><span class="ident" id="7171920">key</span>&nbsp;<span class="op" id="7171924">!=</span>&nbsp;<span class="ident" id="7171927">nil</span>&nbsp;<span class="op" id="7171931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7171935">key</span>&nbsp;<span class="op" id="7171939">=</span>&nbsp;<span class="ident" id="7171941">test</span><span class="op" id="7171945">.</span><span class="ident" id="7171946">key</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7171951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7171954">var</span>&nbsp;<span class="ident" id="7171958">pemType</span>&nbsp;<span class="builtintype" id="7171966">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7171974">var</span>&nbsp;<span class="ident" id="7171978">derBytes</span>&nbsp;<span class="op" id="7171987">[</span><span class="op" id="7171988">]</span><span class="builtintype" id="7171989">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7171995">switch</span>&nbsp;<span class="ident" id="7172002">key</span>&nbsp;<span class="op" id="7172006">:=</span>&nbsp;<span class="ident" id="7172009">key</span><span class="op" id="7172012">.</span><span class="op" id="7172013">(</span><span class="keyword" id="7172014">type</span><span class="op" id="7172018">)</span>&nbsp;<span class="op" id="7172020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172023">case</span>&nbsp;<span class="op" id="7172028">*</span><span class="ident" id="7172029">rsa</span><span class="op" id="7172032">.</span><span class="ident" id="7172033">PrivateKey</span><span class="op" id="7172043">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172047">pemType</span>&nbsp;<span class="op" id="7172055">=</span>&nbsp;<span class="string" id="7172057">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172065">derBytes</span>&nbsp;<span class="op" id="7172074">=</span>&nbsp;<span class="ident" id="7172076">x509</span><span class="op" id="7172080">.</span><span class="ident" id="7172081">MarshalPKCS1PrivateKey</span><span class="op" id="7172103">(</span><span class="ident" id="7172104">key</span><span class="op" id="7172107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172110">case</span>&nbsp;<span class="op" id="7172115">*</span><span class="ident" id="7172116">ecdsa</span><span class="op" id="7172121">.</span><span class="ident" id="7172122">PrivateKey</span><span class="op" id="7172132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172136">pemType</span>&nbsp;<span class="op" id="7172144">=</span>&nbsp;<span class="string" id="7172146">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172153">var</span>&nbsp;<span class="ident" id="7172157">err</span>&nbsp;<span class="builtintype" id="7172161">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172169">derBytes</span><span class="op" id="7172177">,</span>&nbsp;<span class="ident" id="7172179">err</span>&nbsp;<span class="op" id="7172183">=</span>&nbsp;<span class="ident" id="7172185">x509</span><span class="op" id="7172189">.</span><span class="ident" id="7172190">MarshalECPrivateKey</span><span class="op" id="7172209">(</span><span class="ident" id="7172210">key</span><span class="op" id="7172213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172217">if</span>&nbsp;<span class="ident" id="7172220">err</span>&nbsp;<span class="op" id="7172224">!=</span>&nbsp;<span class="ident" id="7172227">nil</span>&nbsp;<span class="op" id="7172231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7172236">panic</span><span class="op" id="7172241">(</span><span class="ident" id="7172242">err</span><span class="op" id="7172245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7172249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172252">default</span><span class="op" id="7172259">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7172263">panic</span><span class="op" id="7172268">(</span><span class="string" id="7172269">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="7172287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7172290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172294">var</span>&nbsp;<span class="ident" id="7172298">pemOut</span>&nbsp;<span class="ident" id="7172305">bytes</span><span class="op" id="7172310">.</span><span class="ident" id="7172311">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172319">pem</span><span class="op" id="7172322">.</span><span class="ident" id="7172323">Encode</span><span class="op" id="7172329">(</span><span class="op" id="7172330">&amp;</span><span class="ident" id="7172331">pemOut</span><span class="op" id="7172337">,</span>&nbsp;<span class="op" id="7172339">&amp;</span><span class="ident" id="7172340">pem</span><span class="op" id="7172343">.</span><span class="ident" id="7172344">Block</span><span class="op" id="7172349">{</span><span class="ident" id="7172350">Type</span><span class="op" id="7172354">:</span>&nbsp;<span class="ident" id="7172356">pemType</span>&nbsp;<span class="op" id="7172364">+</span>&nbsp;<span class="string" id="7172366">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="7172380">,</span>&nbsp;<span class="ident" id="7172382">Bytes</span><span class="op" id="7172387">:</span>&nbsp;<span class="ident" id="7172389">derBytes</span><span class="op" id="7172397">}</span><span class="op" id="7172398">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172402">keyPath</span>&nbsp;<span class="op" id="7172410">:=</span>&nbsp;<span class="ident" id="7172413">tempFile</span><span class="op" id="7172421">(</span><span class="builtintype" id="7172422">string</span><span class="op" id="7172428">(</span><span class="ident" id="7172429">pemOut</span><span class="op" id="7172435">.</span><span class="ident" id="7172436">Bytes</span><span class="op" id="7172441">(</span><span class="op" id="7172442">)</span><span class="op" id="7172443">)</span><span class="op" id="7172444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172447">defer</span>&nbsp;<span class="ident" id="7172453">os</span><span class="op" id="7172455">.</span><span class="ident" id="7172456">Remove</span><span class="op" id="7172462">(</span><span class="ident" id="7172463">keyPath</span><span class="op" id="7172470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172474">var</span>&nbsp;<span class="ident" id="7172478">command</span>&nbsp;<span class="op" id="7172486">[</span><span class="op" id="7172487">]</span><span class="builtintype" id="7172488">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172496">if</span>&nbsp;<span class="builtinfunc" id="7172499">len</span><span class="op" id="7172502">(</span><span class="ident" id="7172503">test</span><span class="op" id="7172507">.</span><span class="ident" id="7172508">command</span><span class="op" id="7172515">)</span>&nbsp;<span class="op" id="7172517">&gt;</span>&nbsp;<span class="num" id="7172519">0</span>&nbsp;<span class="op" id="7172521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172525">command</span>&nbsp;<span class="op" id="7172533">=</span>&nbsp;<span class="builtinfunc" id="7172535">append</span><span class="op" id="7172541">(</span><span class="ident" id="7172542">command</span><span class="op" id="7172549">,</span>&nbsp;<span class="ident" id="7172551">test</span><span class="op" id="7172555">.</span><span class="ident" id="7172556">command</span><span class="op" id="7172563">...</span><span class="op" id="7172566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7172569">}</span>&nbsp;<span class="keyword" id="7172571">else</span>&nbsp;<span class="op" id="7172576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172580">command</span>&nbsp;<span class="op" id="7172588">=</span>&nbsp;<span class="builtinfunc" id="7172590">append</span><span class="op" id="7172596">(</span><span class="ident" id="7172597">command</span><span class="op" id="7172604">,</span>&nbsp;<span class="ident" id="7172606">defaultServerCommand</span><span class="op" id="7172626">...</span><span class="op" id="7172629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7172632">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172635">command</span>&nbsp;<span class="op" id="7172643">=</span>&nbsp;<span class="builtinfunc" id="7172645">append</span><span class="op" id="7172651">(</span><span class="ident" id="7172652">command</span><span class="op" id="7172659">,</span>&nbsp;<span class="string" id="7172661">&#34;-cert&#34;</span><span class="op" id="7172668">,</span>&nbsp;<span class="ident" id="7172670">certPath</span><span class="op" id="7172678">,</span>&nbsp;<span class="string" id="7172680">&#34;-certform&#34;</span><span class="op" id="7172691">,</span>&nbsp;<span class="string" id="7172693">&#34;DER&#34;</span><span class="op" id="7172698">,</span>&nbsp;<span class="string" id="7172700">&#34;-key&#34;</span><span class="op" id="7172706">,</span>&nbsp;<span class="ident" id="7172708">keyPath</span><span class="op" id="7172715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7172718">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7172788">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7172859">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7172928">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7172997">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173027">const</span>&nbsp;<span class="ident" id="7173033">serverPort</span>&nbsp;<span class="op" id="7173044">=</span>&nbsp;<span class="num" id="7173046">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173053">command</span>&nbsp;<span class="op" id="7173061">=</span>&nbsp;<span class="builtinfunc" id="7173063">append</span><span class="op" id="7173069">(</span><span class="ident" id="7173070">command</span><span class="op" id="7173077">,</span>&nbsp;<span class="string" id="7173079">&#34;-accept&#34;</span><span class="op" id="7173088">,</span>&nbsp;<span class="ident" id="7173090">strconv</span><span class="op" id="7173097">.</span><span class="ident" id="7173098">Itoa</span><span class="op" id="7173102">(</span><span class="ident" id="7173103">serverPort</span><span class="op" id="7173113">)</span><span class="op" id="7173114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173118">cmd</span>&nbsp;<span class="op" id="7173122">:=</span>&nbsp;<span class="ident" id="7173125">exec</span><span class="op" id="7173129">.</span><span class="ident" id="7173130">Command</span><span class="op" id="7173137">(</span><span class="ident" id="7173138">command</span><span class="op" id="7173145">[</span><span class="num" id="7173146">0</span><span class="op" id="7173147">]</span><span class="op" id="7173148">,</span>&nbsp;<span class="ident" id="7173150">command</span><span class="op" id="7173157">[</span><span class="num" id="7173158">1</span><span class="op" id="7173159">:</span><span class="op" id="7173160">]</span><span class="op" id="7173161">...</span><span class="op" id="7173164">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173167">stdin</span>&nbsp;<span class="op" id="7173173">=</span>&nbsp;<span class="ident" id="7173175">blockingSource</span><span class="op" id="7173189">(</span><span class="builtinfunc" id="7173190">make</span><span class="op" id="7173194">(</span><span class="keyword" id="7173195">chan</span>&nbsp;<span class="builtintype" id="7173200">bool</span><span class="op" id="7173204">)</span><span class="op" id="7173205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173208">cmd</span><span class="op" id="7173211">.</span><span class="ident" id="7173212">Stdin</span>&nbsp;<span class="op" id="7173218">=</span>&nbsp;<span class="ident" id="7173220">stdin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173227">var</span>&nbsp;<span class="ident" id="7173231">out</span>&nbsp;<span class="ident" id="7173235">bytes</span><span class="op" id="7173240">.</span><span class="ident" id="7173241">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173249">cmd</span><span class="op" id="7173252">.</span><span class="ident" id="7173253">Stdout</span>&nbsp;<span class="op" id="7173260">=</span>&nbsp;<span class="op" id="7173262">&amp;</span><span class="ident" id="7173263">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173268">cmd</span><span class="op" id="7173271">.</span><span class="ident" id="7173272">Stderr</span>&nbsp;<span class="op" id="7173279">=</span>&nbsp;<span class="op" id="7173281">&amp;</span><span class="ident" id="7173282">out</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173287">if</span>&nbsp;<span class="ident" id="7173290">err</span>&nbsp;<span class="op" id="7173294">:=</span>&nbsp;<span class="ident" id="7173297">cmd</span><span class="op" id="7173300">.</span><span class="ident" id="7173301">Start</span><span class="op" id="7173306">(</span><span class="op" id="7173307">)</span><span class="op" id="7173308">;</span>&nbsp;<span class="ident" id="7173310">err</span>&nbsp;<span class="op" id="7173314">!=</span>&nbsp;<span class="ident" id="7173317">nil</span>&nbsp;<span class="op" id="7173321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173325">return</span>&nbsp;<span class="ident" id="7173332">nil</span><span class="op" id="7173335">,</span>&nbsp;<span class="ident" id="7173337">nil</span><span class="op" id="7173340">,</span>&nbsp;<span class="ident" id="7173342">nil</span><span class="op" id="7173345">,</span>&nbsp;<span class="ident" id="7173347">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7173356">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7173423">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7173495">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7173564">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173580">var</span>&nbsp;<span class="ident" id="7173584">tcpConn</span>&nbsp;<span class="ident" id="7173592">net</span><span class="op" id="7173595">.</span><span class="ident" id="7173596">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173602">for</span>&nbsp;<span class="ident" id="7173606">i</span>&nbsp;<span class="op" id="7173608">:=</span>&nbsp;<span class="builtintype" id="7173611">uint</span><span class="op" id="7173615">(</span><span class="num" id="7173616">0</span><span class="op" id="7173617">)</span><span class="op" id="7173618">;</span>&nbsp;<span class="ident" id="7173620">i</span>&nbsp;<span class="op" id="7173622">&lt;</span>&nbsp;<span class="num" id="7173624">5</span><span class="op" id="7173625">;</span>&nbsp;<span class="ident" id="7173627">i</span><span class="op" id="7173628">++</span>&nbsp;<span class="op" id="7173631">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173635">var</span>&nbsp;<span class="ident" id="7173639">err</span>&nbsp;<span class="builtintype" id="7173643">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173651">tcpConn</span><span class="op" id="7173658">,</span>&nbsp;<span class="ident" id="7173660">err</span>&nbsp;<span class="op" id="7173664">=</span>&nbsp;<span class="ident" id="7173666">net</span><span class="op" id="7173669">.</span><span class="ident" id="7173670">DialTCP</span><span class="op" id="7173677">(</span><span class="string" id="7173678">&#34;tcp&#34;</span><span class="op" id="7173683">,</span>&nbsp;<span class="ident" id="7173685">nil</span><span class="op" id="7173688">,</span>&nbsp;<span class="op" id="7173690">&amp;</span><span class="ident" id="7173691">net</span><span class="op" id="7173694">.</span><span class="ident" id="7173695">TCPAddr</span><span class="op" id="7173702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173707">IP</span><span class="op" id="7173709">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7173713">net</span><span class="op" id="7173716">.</span><span class="ident" id="7173717">IPv4</span><span class="op" id="7173721">(</span><span class="num" id="7173722">127</span><span class="op" id="7173725">,</span>&nbsp;<span class="num" id="7173727">0</span><span class="op" id="7173728">,</span>&nbsp;<span class="num" id="7173730">0</span><span class="op" id="7173731">,</span>&nbsp;<span class="num" id="7173733">1</span><span class="op" id="7173734">)</span><span class="op" id="7173735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173740">Port</span><span class="op" id="7173744">:</span>&nbsp;<span class="ident" id="7173746">serverPort</span><span class="op" id="7173756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173760">}</span><span class="op" id="7173761">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173765">if</span>&nbsp;<span class="ident" id="7173768">err</span>&nbsp;<span class="op" id="7173772">==</span>&nbsp;<span class="ident" id="7173775">nil</span>&nbsp;<span class="op" id="7173779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173784">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173796">time</span><span class="op" id="7173800">.</span><span class="ident" id="7173801">Sleep</span><span class="op" id="7173806">(</span><span class="op" id="7173807">(</span><span class="num" id="7173808">1</span>&nbsp;<span class="op" id="7173810">&lt;&lt;</span>&nbsp;<span class="ident" id="7173813">i</span><span class="op" id="7173814">)</span>&nbsp;<span class="op" id="7173816">*</span>&nbsp;<span class="num" id="7173818">5</span>&nbsp;<span class="op" id="7173820">*</span>&nbsp;<span class="ident" id="7173822">time</span><span class="op" id="7173826">.</span><span class="ident" id="7173827">Millisecond</span><span class="op" id="7173838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173841">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173844">if</span>&nbsp;<span class="ident" id="7173847">tcpConn</span>&nbsp;<span class="op" id="7173855">==</span>&nbsp;<span class="ident" id="7173858">nil</span>&nbsp;<span class="op" id="7173862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7173866">close</span><span class="op" id="7173871">(</span><span class="ident" id="7173872">stdin</span><span class="op" id="7173877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173881">out</span><span class="op" id="7173884">.</span><span class="ident" id="7173885">WriteTo</span><span class="op" id="7173892">(</span><span class="ident" id="7173893">os</span><span class="op" id="7173895">.</span><span class="ident" id="7173896">Stdout</span><span class="op" id="7173902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173906">cmd</span><span class="op" id="7173909">.</span><span class="ident" id="7173910">Process</span><span class="op" id="7173917">.</span><span class="ident" id="7173918">Kill</span><span class="op" id="7173922">(</span><span class="op" id="7173923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173927">return</span>&nbsp;<span class="ident" id="7173934">nil</span><span class="op" id="7173937">,</span>&nbsp;<span class="ident" id="7173939">nil</span><span class="op" id="7173942">,</span>&nbsp;<span class="ident" id="7173944">nil</span><span class="op" id="7173947">,</span>&nbsp;<span class="ident" id="7173949">cmd</span><span class="op" id="7173952">.</span><span class="ident" id="7173953">Wait</span><span class="op" id="7173957">(</span><span class="op" id="7173958">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173965">record</span>&nbsp;<span class="op" id="7173972">:=</span>&nbsp;<span class="op" id="7173975">&amp;</span><span class="ident" id="7173976">recordingConn</span><span class="op" id="7173989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173993">Conn</span><span class="op" id="7173997">:</span>&nbsp;<span class="ident" id="7173999">tcpConn</span><span class="op" id="7174006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174009">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174013">return</span>&nbsp;<span class="ident" id="7174020">record</span><span class="op" id="7174026">,</span>&nbsp;<span class="ident" id="7174028">cmd</span><span class="op" id="7174031">,</span>&nbsp;<span class="ident" id="7174033">stdin</span><span class="op" id="7174038">,</span>&nbsp;<span class="ident" id="7174040">nil</span><br>
<span class="lineno"></span><span class="op" id="7174044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7174047">func</span>&nbsp;<span class="op" id="7174052">(</span><span class="ident" id="7174053">test</span>&nbsp;<span class="op" id="7174058">*</span><span class="ident" id="7174059">clientTest</span><span class="op" id="7174069">)</span>&nbsp;<span class="ident" id="7174071">dataPath</span><span class="op" id="7174079">(</span><span class="op" id="7174080">)</span>&nbsp;<span class="builtintype" id="7174082">string</span>&nbsp;<span class="op" id="7174089">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174092">return</span>&nbsp;<span class="ident" id="7174099">filepath</span><span class="op" id="7174107">.</span><span class="ident" id="7174108">Join</span><span class="op" id="7174112">(</span><span class="string" id="7174113">&#34;testdata&#34;</span><span class="op" id="7174123">,</span>&nbsp;<span class="string" id="7174125">&#34;Client-&#34;</span><span class="op" id="7174134">+</span><span class="ident" id="7174135">test</span><span class="op" id="7174139">.</span><span class="ident" id="7174140">name</span><span class="op" id="7174144">)</span><br>
<span class="lineno"></span><span class="op" id="7174146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7174149">func</span>&nbsp;<span class="op" id="7174154">(</span><span class="ident" id="7174155">test</span>&nbsp;<span class="op" id="7174160">*</span><span class="ident" id="7174161">clientTest</span><span class="op" id="7174171">)</span>&nbsp;<span class="ident" id="7174173">loadData</span><span class="op" id="7174181">(</span><span class="op" id="7174182">)</span>&nbsp;<span class="op" id="7174184">(</span><span class="ident" id="7174185">flows</span>&nbsp;<span class="op" id="7174191">[</span><span class="op" id="7174192">]</span><span class="op" id="7174193">[</span><span class="op" id="7174194">]</span><span class="builtintype" id="7174195">byte</span><span class="op" id="7174199">,</span>&nbsp;<span class="ident" id="7174201">err</span>&nbsp;<span class="builtintype" id="7174205">error</span><span class="op" id="7174210">)</span>&nbsp;<span class="op" id="7174212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174215">in</span><span class="op" id="7174217">,</span>&nbsp;<span class="ident" id="7174219">err</span>&nbsp;<span class="op" id="7174223">:=</span>&nbsp;<span class="ident" id="7174226">os</span><span class="op" id="7174228">.</span><span class="ident" id="7174229">Open</span><span class="op" id="7174233">(</span><span class="ident" id="7174234">test</span><span class="op" id="7174238">.</span><span class="ident" id="7174239">dataPath</span><span class="op" id="7174247">(</span><span class="op" id="7174248">)</span><span class="op" id="7174249">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174252">if</span>&nbsp;<span class="ident" id="7174255">err</span>&nbsp;<span class="op" id="7174259">!=</span>&nbsp;<span class="ident" id="7174262">nil</span>&nbsp;<span class="op" id="7174266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174270">return</span>&nbsp;<span class="ident" id="7174277">nil</span><span class="op" id="7174280">,</span>&nbsp;<span class="ident" id="7174282">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174290">defer</span>&nbsp;<span class="ident" id="7174296">in</span><span class="op" id="7174298">.</span><span class="ident" id="7174299">Close</span><span class="op" id="7174304">(</span><span class="op" id="7174305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174308">return</span>&nbsp;<span class="ident" id="7174315">parseTestData</span><span class="op" id="7174328">(</span><span class="ident" id="7174329">in</span><span class="op" id="7174331">)</span><br>
<span class="lineno">165</span><span class="op" id="7174333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7174336">func</span>&nbsp;<span class="op" id="7174341">(</span><span class="ident" id="7174342">test</span>&nbsp;<span class="op" id="7174347">*</span><span class="ident" id="7174348">clientTest</span><span class="op" id="7174358">)</span>&nbsp;<span class="ident" id="7174360">run</span><span class="op" id="7174363">(</span><span class="ident" id="7174364">t</span>&nbsp;<span class="op" id="7174366">*</span><span class="ident" id="7174367">testing</span><span class="op" id="7174374">.</span><span class="ident" id="7174375">T</span><span class="op" id="7174376">,</span>&nbsp;<span class="ident" id="7174378">write</span>&nbsp;<span class="builtintype" id="7174384">bool</span><span class="op" id="7174388">)</span>&nbsp;<span class="op" id="7174390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174393">var</span>&nbsp;<span class="ident" id="7174397">clientConn</span><span class="op" id="7174407">,</span>&nbsp;<span class="ident" id="7174409">serverConn</span>&nbsp;<span class="ident" id="7174420">net</span><span class="op" id="7174423">.</span><span class="ident" id="7174424">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174430">var</span>&nbsp;<span class="ident" id="7174434">recordingConn</span>&nbsp;<span class="op" id="7174448">*</span><span class="ident" id="7174449">recordingConn</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174464">var</span>&nbsp;<span class="ident" id="7174468">childProcess</span>&nbsp;<span class="op" id="7174481">*</span><span class="ident" id="7174482">exec</span><span class="op" id="7174486">.</span><span class="ident" id="7174487">Cmd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174492">var</span>&nbsp;<span class="ident" id="7174496">stdin</span>&nbsp;<span class="ident" id="7174502">blockingSource</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174519">if</span>&nbsp;<span class="ident" id="7174522">write</span>&nbsp;<span class="op" id="7174528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174532">var</span>&nbsp;<span class="ident" id="7174536">err</span>&nbsp;<span class="builtintype" id="7174540">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174548">recordingConn</span><span class="op" id="7174561">,</span>&nbsp;<span class="ident" id="7174563">childProcess</span><span class="op" id="7174575">,</span>&nbsp;<span class="ident" id="7174577">stdin</span><span class="op" id="7174582">,</span>&nbsp;<span class="ident" id="7174584">err</span>&nbsp;<span class="op" id="7174588">=</span>&nbsp;<span class="ident" id="7174590">test</span><span class="op" id="7174594">.</span><span class="ident" id="7174595">connFromCommand</span><span class="op" id="7174610">(</span><span class="op" id="7174611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174615">if</span>&nbsp;<span class="ident" id="7174618">err</span>&nbsp;<span class="op" id="7174622">!=</span>&nbsp;<span class="ident" id="7174625">nil</span>&nbsp;<span class="op" id="7174629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174634">t</span><span class="op" id="7174635">.</span><span class="ident" id="7174636">Fatalf</span><span class="op" id="7174642">(</span><span class="string" id="7174643">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7174675">,</span>&nbsp;<span class="ident" id="7174677">err</span><span class="op" id="7174680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174688">clientConn</span>&nbsp;<span class="op" id="7174699">=</span>&nbsp;<span class="ident" id="7174701">recordingConn</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174716">}</span>&nbsp;<span class="keyword" id="7174718">else</span>&nbsp;<span class="op" id="7174723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174727">clientConn</span><span class="op" id="7174737">,</span>&nbsp;<span class="ident" id="7174739">serverConn</span>&nbsp;<span class="op" id="7174750">=</span>&nbsp;<span class="ident" id="7174752">net</span><span class="op" id="7174755">.</span><span class="ident" id="7174756">Pipe</span><span class="op" id="7174760">(</span><span class="op" id="7174761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174768">config</span>&nbsp;<span class="op" id="7174775">:=</span>&nbsp;<span class="ident" id="7174778">test</span><span class="op" id="7174782">.</span><span class="ident" id="7174783">config</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174791">if</span>&nbsp;<span class="ident" id="7174794">config</span>&nbsp;<span class="op" id="7174801">==</span>&nbsp;<span class="ident" id="7174804">nil</span>&nbsp;<span class="op" id="7174808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174812">config</span>&nbsp;<span class="op" id="7174819">=</span>&nbsp;<span class="ident" id="7174821">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174836">client</span>&nbsp;<span class="op" id="7174843">:=</span>&nbsp;<span class="ident" id="7174846">Client</span><span class="op" id="7174852">(</span><span class="ident" id="7174853">clientConn</span><span class="op" id="7174863">,</span>&nbsp;<span class="ident" id="7174865">config</span><span class="op" id="7174871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174875">doneChan</span>&nbsp;<span class="op" id="7174884">:=</span>&nbsp;<span class="builtinfunc" id="7174887">make</span><span class="op" id="7174891">(</span><span class="keyword" id="7174892">chan</span>&nbsp;<span class="builtintype" id="7174897">bool</span><span class="op" id="7174901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174904">go</span>&nbsp;<span class="keyword" id="7174907">func</span><span class="op" id="7174911">(</span><span class="op" id="7174912">)</span>&nbsp;<span class="op" id="7174914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174918">if</span>&nbsp;<span class="ident" id="7174921">_</span><span class="op" id="7174922">,</span>&nbsp;<span class="ident" id="7174924">err</span>&nbsp;<span class="op" id="7174928">:=</span>&nbsp;<span class="ident" id="7174931">client</span><span class="op" id="7174937">.</span><span class="ident" id="7174938">Write</span><span class="op" id="7174943">(</span><span class="op" id="7174944">[</span><span class="op" id="7174945">]</span><span class="builtintype" id="7174946">byte</span><span class="op" id="7174950">(</span><span class="string" id="7174951">&#34;hello\n&#34;</span><span class="op" id="7174960">)</span><span class="op" id="7174961">)</span><span class="op" id="7174962">;</span>&nbsp;<span class="ident" id="7174964">err</span>&nbsp;<span class="op" id="7174968">!=</span>&nbsp;<span class="ident" id="7174971">nil</span>&nbsp;<span class="op" id="7174975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174980">t</span><span class="op" id="7174981">.</span><span class="ident" id="7174982">Logf</span><span class="op" id="7174986">(</span><span class="string" id="7174987">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7175012">,</span>&nbsp;<span class="ident" id="7175014">err</span><span class="op" id="7175017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175021">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175025">if</span>&nbsp;<span class="ident" id="7175028">test</span><span class="op" id="7175032">.</span><span class="ident" id="7175033">validate</span>&nbsp;<span class="op" id="7175042">!=</span>&nbsp;<span class="ident" id="7175045">nil</span>&nbsp;<span class="op" id="7175049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175054">if</span>&nbsp;<span class="ident" id="7175057">err</span>&nbsp;<span class="op" id="7175061">:=</span>&nbsp;<span class="ident" id="7175064">test</span><span class="op" id="7175068">.</span><span class="ident" id="7175069">validate</span><span class="op" id="7175077">(</span><span class="ident" id="7175078">client</span><span class="op" id="7175084">.</span><span class="ident" id="7175085">ConnectionState</span><span class="op" id="7175100">(</span><span class="op" id="7175101">)</span><span class="op" id="7175102">)</span><span class="op" id="7175103">;</span>&nbsp;<span class="ident" id="7175105">err</span>&nbsp;<span class="op" id="7175109">!=</span>&nbsp;<span class="ident" id="7175112">nil</span>&nbsp;<span class="op" id="7175116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175122">t</span><span class="op" id="7175123">.</span><span class="ident" id="7175124">Logf</span><span class="op" id="7175128">(</span><span class="string" id="7175129">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7175167">,</span>&nbsp;<span class="ident" id="7175169">err</span><span class="op" id="7175172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175181">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175185">client</span><span class="op" id="7175191">.</span><span class="ident" id="7175192">Close</span><span class="op" id="7175197">(</span><span class="op" id="7175198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175202">clientConn</span><span class="op" id="7175212">.</span><span class="ident" id="7175213">Close</span><span class="op" id="7175218">(</span><span class="op" id="7175219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175223">doneChan</span>&nbsp;<span class="op" id="7175232">&lt;-</span>&nbsp;<span class="builtintype" id="7175235">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175241">}</span><span class="op" id="7175242">(</span><span class="op" id="7175243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175247">if</span>&nbsp;<span class="op" id="7175250">!</span><span class="ident" id="7175251">write</span>&nbsp;<span class="op" id="7175257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175261">flows</span><span class="op" id="7175266">,</span>&nbsp;<span class="ident" id="7175268">err</span>&nbsp;<span class="op" id="7175272">:=</span>&nbsp;<span class="ident" id="7175275">test</span><span class="op" id="7175279">.</span><span class="ident" id="7175280">loadData</span><span class="op" id="7175288">(</span><span class="op" id="7175289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175293">if</span>&nbsp;<span class="ident" id="7175296">err</span>&nbsp;<span class="op" id="7175300">!=</span>&nbsp;<span class="ident" id="7175303">nil</span>&nbsp;<span class="op" id="7175307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175312">t</span><span class="op" id="7175313">.</span><span class="ident" id="7175314">Fatalf</span><span class="op" id="7175320">(</span><span class="string" id="7175321">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7175358">,</span>&nbsp;<span class="ident" id="7175360">test</span><span class="op" id="7175364">.</span><span class="ident" id="7175365">name</span><span class="op" id="7175369">,</span>&nbsp;<span class="ident" id="7175371">test</span><span class="op" id="7175375">.</span><span class="ident" id="7175376">dataPath</span><span class="op" id="7175384">(</span><span class="op" id="7175385">)</span><span class="op" id="7175386">,</span>&nbsp;<span class="ident" id="7175388">err</span><span class="op" id="7175391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175395">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175399">for</span>&nbsp;<span class="ident" id="7175403">i</span><span class="op" id="7175404">,</span>&nbsp;<span class="ident" id="7175406">b</span>&nbsp;<span class="op" id="7175408">:=</span>&nbsp;<span class="keyword" id="7175411">range</span>&nbsp;<span class="ident" id="7175417">flows</span>&nbsp;<span class="op" id="7175423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175428">if</span>&nbsp;<span class="ident" id="7175431">i</span><span class="op" id="7175432">%</span><span class="num" id="7175433">2</span>&nbsp;<span class="op" id="7175435">==</span>&nbsp;<span class="num" id="7175438">1</span>&nbsp;<span class="op" id="7175440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175446">serverConn</span><span class="op" id="7175456">.</span><span class="ident" id="7175457">Write</span><span class="op" id="7175462">(</span><span class="ident" id="7175463">b</span><span class="op" id="7175464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175470">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175482">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175487">bb</span>&nbsp;<span class="op" id="7175490">:=</span>&nbsp;<span class="builtinfunc" id="7175493">make</span><span class="op" id="7175497">(</span><span class="op" id="7175498">[</span><span class="op" id="7175499">]</span><span class="builtintype" id="7175500">byte</span><span class="op" id="7175504">,</span>&nbsp;<span class="builtinfunc" id="7175506">len</span><span class="op" id="7175509">(</span><span class="ident" id="7175510">b</span><span class="op" id="7175511">)</span><span class="op" id="7175512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175517">_</span><span class="op" id="7175518">,</span>&nbsp;<span class="ident" id="7175520">err</span>&nbsp;<span class="op" id="7175524">:=</span>&nbsp;<span class="ident" id="7175527">io</span><span class="op" id="7175529">.</span><span class="ident" id="7175530">ReadFull</span><span class="op" id="7175538">(</span><span class="ident" id="7175539">serverConn</span><span class="op" id="7175549">,</span>&nbsp;<span class="ident" id="7175551">bb</span><span class="op" id="7175553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175558">if</span>&nbsp;<span class="ident" id="7175561">err</span>&nbsp;<span class="op" id="7175565">!=</span>&nbsp;<span class="ident" id="7175568">nil</span>&nbsp;<span class="op" id="7175572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175578">t</span><span class="op" id="7175579">.</span><span class="ident" id="7175580">Fatalf</span><span class="op" id="7175586">(</span><span class="string" id="7175587">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="7175599">,</span>&nbsp;<span class="ident" id="7175601">test</span><span class="op" id="7175605">.</span><span class="ident" id="7175606">name</span><span class="op" id="7175610">,</span>&nbsp;<span class="ident" id="7175612">i</span><span class="op" id="7175613">,</span>&nbsp;<span class="ident" id="7175615">err</span><span class="op" id="7175618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175623">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175628">if</span>&nbsp;<span class="op" id="7175631">!</span><span class="ident" id="7175632">bytes</span><span class="op" id="7175637">.</span><span class="ident" id="7175638">Equal</span><span class="op" id="7175643">(</span><span class="ident" id="7175644">b</span><span class="op" id="7175645">,</span>&nbsp;<span class="ident" id="7175647">bb</span><span class="op" id="7175649">)</span>&nbsp;<span class="op" id="7175651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175657">t</span><span class="op" id="7175658">.</span><span class="ident" id="7175659">Fatalf</span><span class="op" id="7175665">(</span><span class="string" id="7175666">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7175708">,</span>&nbsp;<span class="ident" id="7175710">test</span><span class="op" id="7175714">.</span><span class="ident" id="7175715">name</span><span class="op" id="7175719">,</span>&nbsp;<span class="ident" id="7175721">i</span><span class="op" id="7175722">,</span>&nbsp;<span class="ident" id="7175724">bb</span><span class="op" id="7175726">,</span>&nbsp;<span class="ident" id="7175728">b</span><span class="op" id="7175729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175742">serverConn</span><span class="op" id="7175752">.</span><span class="ident" id="7175753">Close</span><span class="op" id="7175758">(</span><span class="op" id="7175759">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175766">&lt;-</span><span class="ident" id="7175768">doneChan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175779">if</span>&nbsp;<span class="ident" id="7175782">write</span>&nbsp;<span class="op" id="7175788">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175792">path</span>&nbsp;<span class="op" id="7175797">:=</span>&nbsp;<span class="ident" id="7175800">test</span><span class="op" id="7175804">.</span><span class="ident" id="7175805">dataPath</span><span class="op" id="7175813">(</span><span class="op" id="7175814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175818">out</span><span class="op" id="7175821">,</span>&nbsp;<span class="ident" id="7175823">err</span>&nbsp;<span class="op" id="7175827">:=</span>&nbsp;<span class="ident" id="7175830">os</span><span class="op" id="7175832">.</span><span class="ident" id="7175833">OpenFile</span><span class="op" id="7175841">(</span><span class="ident" id="7175842">path</span><span class="op" id="7175846">,</span>&nbsp;<span class="ident" id="7175848">os</span><span class="op" id="7175850">.</span><span class="ident" id="7175851">O_WRONLY</span><span class="op" id="7175859">|</span><span class="ident" id="7175860">os</span><span class="op" id="7175862">.</span><span class="ident" id="7175863">O_CREATE</span><span class="op" id="7175871">|</span><span class="ident" id="7175872">os</span><span class="op" id="7175874">.</span><span class="ident" id="7175875">O_TRUNC</span><span class="op" id="7175882">,</span>&nbsp;<span class="num" id="7175884">0644</span><span class="op" id="7175888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175892">if</span>&nbsp;<span class="ident" id="7175895">err</span>&nbsp;<span class="op" id="7175899">!=</span>&nbsp;<span class="ident" id="7175902">nil</span>&nbsp;<span class="op" id="7175906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175911">t</span><span class="op" id="7175912">.</span><span class="ident" id="7175913">Fatalf</span><span class="op" id="7175919">(</span><span class="string" id="7175920">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7175954">,</span>&nbsp;<span class="ident" id="7175956">err</span><span class="op" id="7175959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175963">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175967">defer</span>&nbsp;<span class="ident" id="7175973">out</span><span class="op" id="7175976">.</span><span class="ident" id="7175977">Close</span><span class="op" id="7175982">(</span><span class="op" id="7175983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175987">recordingConn</span><span class="op" id="7176000">.</span><span class="ident" id="7176001">Close</span><span class="op" id="7176006">(</span><span class="op" id="7176007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7176011">close</span><span class="op" id="7176016">(</span><span class="ident" id="7176017">stdin</span><span class="op" id="7176022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176026">childProcess</span><span class="op" id="7176038">.</span><span class="ident" id="7176039">Process</span><span class="op" id="7176046">.</span><span class="ident" id="7176047">Kill</span><span class="op" id="7176051">(</span><span class="op" id="7176052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176056">childProcess</span><span class="op" id="7176068">.</span><span class="ident" id="7176069">Wait</span><span class="op" id="7176073">(</span><span class="op" id="7176074">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176078">if</span>&nbsp;<span class="builtinfunc" id="7176081">len</span><span class="op" id="7176084">(</span><span class="ident" id="7176085">recordingConn</span><span class="op" id="7176098">.</span><span class="ident" id="7176099">flows</span><span class="op" id="7176104">)</span>&nbsp;<span class="op" id="7176106">&lt;</span>&nbsp;<span class="num" id="7176108">3</span>&nbsp;<span class="op" id="7176110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176115">childProcess</span><span class="op" id="7176127">.</span><span class="ident" id="7176128">Stdout</span><span class="op" id="7176134">.</span><span class="op" id="7176135">(</span><span class="op" id="7176136">*</span><span class="ident" id="7176137">bytes</span><span class="op" id="7176142">.</span><span class="ident" id="7176143">Buffer</span><span class="op" id="7176149">)</span><span class="op" id="7176150">.</span><span class="ident" id="7176151">WriteTo</span><span class="op" id="7176158">(</span><span class="ident" id="7176159">os</span><span class="op" id="7176161">.</span><span class="ident" id="7176162">Stdout</span><span class="op" id="7176168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176173">t</span><span class="op" id="7176174">.</span><span class="ident" id="7176175">Fatalf</span><span class="op" id="7176181">(</span><span class="string" id="7176182">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="7176213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176221">recordingConn</span><span class="op" id="7176234">.</span><span class="ident" id="7176235">WriteTo</span><span class="op" id="7176242">(</span><span class="ident" id="7176243">out</span><span class="op" id="7176246">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176250">fmt</span><span class="op" id="7176253">.</span><span class="ident" id="7176254">Printf</span><span class="op" id="7176260">(</span><span class="string" id="7176261">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7176273">,</span>&nbsp;<span class="ident" id="7176275">path</span><span class="op" id="7176279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176282">}</span><br>
<span class="lineno"></span><span class="op" id="7176284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7176287">func</span>&nbsp;<span class="ident" id="7176292">runClientTestForVersion</span><span class="op" id="7176315">(</span><span class="ident" id="7176316">t</span>&nbsp;<span class="op" id="7176318">*</span><span class="ident" id="7176319">testing</span><span class="op" id="7176326">.</span><span class="ident" id="7176327">T</span><span class="op" id="7176328">,</span>&nbsp;<span class="ident" id="7176330">template</span>&nbsp;<span class="op" id="7176339">*</span><span class="ident" id="7176340">clientTest</span><span class="op" id="7176350">,</span>&nbsp;<span class="ident" id="7176352">prefix</span><span class="op" id="7176358">,</span>&nbsp;<span class="ident" id="7176360">option</span>&nbsp;<span class="builtintype" id="7176367">string</span><span class="op" id="7176373">)</span>&nbsp;<span class="op" id="7176375">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176378">test</span>&nbsp;<span class="op" id="7176383">:=</span>&nbsp;<span class="op" id="7176386">*</span><span class="ident" id="7176387">template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176397">test</span><span class="op" id="7176401">.</span><span class="ident" id="7176402">name</span>&nbsp;<span class="op" id="7176407">=</span>&nbsp;<span class="ident" id="7176409">prefix</span>&nbsp;<span class="op" id="7176416">+</span>&nbsp;<span class="ident" id="7176418">test</span><span class="op" id="7176422">.</span><span class="ident" id="7176423">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176429">if</span>&nbsp;<span class="builtinfunc" id="7176432">len</span><span class="op" id="7176435">(</span><span class="ident" id="7176436">test</span><span class="op" id="7176440">.</span><span class="ident" id="7176441">command</span><span class="op" id="7176448">)</span>&nbsp;<span class="op" id="7176450">==</span>&nbsp;<span class="num" id="7176453">0</span>&nbsp;<span class="op" id="7176455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176459">test</span><span class="op" id="7176463">.</span><span class="ident" id="7176464">command</span>&nbsp;<span class="op" id="7176472">=</span>&nbsp;<span class="ident" id="7176474">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176496">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176499">test</span><span class="op" id="7176503">.</span><span class="ident" id="7176504">command</span>&nbsp;<span class="op" id="7176512">=</span>&nbsp;<span class="builtinfunc" id="7176514">append</span><span class="op" id="7176520">(</span><span class="op" id="7176521">[</span><span class="op" id="7176522">]</span><span class="builtintype" id="7176523">string</span><span class="op" id="7176529">(</span><span class="ident" id="7176530">nil</span><span class="op" id="7176533">)</span><span class="op" id="7176534">,</span>&nbsp;<span class="ident" id="7176536">test</span><span class="op" id="7176540">.</span><span class="ident" id="7176541">command</span><span class="op" id="7176548">...</span><span class="op" id="7176551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176554">test</span><span class="op" id="7176558">.</span><span class="ident" id="7176559">command</span>&nbsp;<span class="op" id="7176567">=</span>&nbsp;<span class="builtinfunc" id="7176569">append</span><span class="op" id="7176575">(</span><span class="ident" id="7176576">test</span><span class="op" id="7176580">.</span><span class="ident" id="7176581">command</span><span class="op" id="7176588">,</span>&nbsp;<span class="ident" id="7176590">option</span><span class="op" id="7176596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176599">test</span><span class="op" id="7176603">.</span><span class="ident" id="7176604">run</span><span class="op" id="7176607">(</span><span class="ident" id="7176608">t</span><span class="op" id="7176609">,</span>&nbsp;<span class="op" id="7176611">*</span><span class="ident" id="7176612">update</span><span class="op" id="7176618">)</span><br>
<span class="lineno"></span><span class="op" id="7176620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="7176623">func</span>&nbsp;<span class="ident" id="7176628">runClientTestTLS10</span><span class="op" id="7176646">(</span><span class="ident" id="7176647">t</span>&nbsp;<span class="op" id="7176649">*</span><span class="ident" id="7176650">testing</span><span class="op" id="7176657">.</span><span class="ident" id="7176658">T</span><span class="op" id="7176659">,</span>&nbsp;<span class="ident" id="7176661">template</span>&nbsp;<span class="op" id="7176670">*</span><span class="ident" id="7176671">clientTest</span><span class="op" id="7176681">)</span>&nbsp;<span class="op" id="7176683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176686">runClientTestForVersion</span><span class="op" id="7176709">(</span><span class="ident" id="7176710">t</span><span class="op" id="7176711">,</span>&nbsp;<span class="ident" id="7176713">template</span><span class="op" id="7176721">,</span>&nbsp;<span class="string" id="7176723">&#34;TLSv10-&#34;</span><span class="op" id="7176732">,</span>&nbsp;<span class="string" id="7176734">&#34;-tls1&#34;</span><span class="op" id="7176741">)</span><br>
<span class="lineno"></span><span class="op" id="7176743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7176746">func</span>&nbsp;<span class="ident" id="7176751">runClientTestTLS11</span><span class="op" id="7176769">(</span><span class="ident" id="7176770">t</span>&nbsp;<span class="op" id="7176772">*</span><span class="ident" id="7176773">testing</span><span class="op" id="7176780">.</span><span class="ident" id="7176781">T</span><span class="op" id="7176782">,</span>&nbsp;<span class="ident" id="7176784">template</span>&nbsp;<span class="op" id="7176793">*</span><span class="ident" id="7176794">clientTest</span><span class="op" id="7176804">)</span>&nbsp;<span class="op" id="7176806">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176809">runClientTestForVersion</span><span class="op" id="7176832">(</span><span class="ident" id="7176833">t</span><span class="op" id="7176834">,</span>&nbsp;<span class="ident" id="7176836">template</span><span class="op" id="7176844">,</span>&nbsp;<span class="string" id="7176846">&#34;TLSv11-&#34;</span><span class="op" id="7176855">,</span>&nbsp;<span class="string" id="7176857">&#34;-tls1_1&#34;</span><span class="op" id="7176866">)</span><br>
<span class="lineno"></span><span class="op" id="7176868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7176871">func</span>&nbsp;<span class="ident" id="7176876">runClientTestTLS12</span><span class="op" id="7176894">(</span><span class="ident" id="7176895">t</span>&nbsp;<span class="op" id="7176897">*</span><span class="ident" id="7176898">testing</span><span class="op" id="7176905">.</span><span class="ident" id="7176906">T</span><span class="op" id="7176907">,</span>&nbsp;<span class="ident" id="7176909">template</span>&nbsp;<span class="op" id="7176918">*</span><span class="ident" id="7176919">clientTest</span><span class="op" id="7176929">)</span>&nbsp;<span class="op" id="7176931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176934">runClientTestForVersion</span><span class="op" id="7176957">(</span><span class="ident" id="7176958">t</span><span class="op" id="7176959">,</span>&nbsp;<span class="ident" id="7176961">template</span><span class="op" id="7176969">,</span>&nbsp;<span class="string" id="7176971">&#34;TLSv12-&#34;</span><span class="op" id="7176980">,</span>&nbsp;<span class="string" id="7176982">&#34;-tls1_2&#34;</span><span class="op" id="7176991">)</span><br>
<span class="lineno">270</span><span class="op" id="7176993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7176996">func</span>&nbsp;<span class="ident" id="7177001">TestHandshakeClientRSARC4</span><span class="op" id="7177026">(</span><span class="ident" id="7177027">t</span>&nbsp;<span class="op" id="7177029">*</span><span class="ident" id="7177030">testing</span><span class="op" id="7177037">.</span><span class="ident" id="7177038">T</span><span class="op" id="7177039">)</span>&nbsp;<span class="op" id="7177041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177044">test</span>&nbsp;<span class="op" id="7177049">:=</span>&nbsp;<span class="op" id="7177052">&amp;</span><span class="ident" id="7177053">clientTest</span><span class="op" id="7177063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177067">name</span><span class="op" id="7177071">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7177076">&#34;RSA-RC4&#34;</span><span class="op" id="7177085">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177089">command</span><span class="op" id="7177096">:</span>&nbsp;<span class="op" id="7177098">[</span><span class="op" id="7177099">]</span><span class="builtintype" id="7177100">string</span><span class="op" id="7177106">{</span><span class="string" id="7177107">&#34;openssl&#34;</span><span class="op" id="7177116">,</span>&nbsp;<span class="string" id="7177118">&#34;s_server&#34;</span><span class="op" id="7177128">,</span>&nbsp;<span class="string" id="7177130">&#34;-cipher&#34;</span><span class="op" id="7177139">,</span>&nbsp;<span class="string" id="7177141">&#34;RC4-SHA&#34;</span><span class="op" id="7177150">}</span><span class="op" id="7177151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177157">runClientTestTLS10</span><span class="op" id="7177175">(</span><span class="ident" id="7177176">t</span><span class="op" id="7177177">,</span>&nbsp;<span class="ident" id="7177179">test</span><span class="op" id="7177183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177186">runClientTestTLS11</span><span class="op" id="7177204">(</span><span class="ident" id="7177205">t</span><span class="op" id="7177206">,</span>&nbsp;<span class="ident" id="7177208">test</span><span class="op" id="7177212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177215">runClientTestTLS12</span><span class="op" id="7177233">(</span><span class="ident" id="7177234">t</span><span class="op" id="7177235">,</span>&nbsp;<span class="ident" id="7177237">test</span><span class="op" id="7177241">)</span><br>
<span class="lineno">280</span><span class="op" id="7177243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7177246">func</span>&nbsp;<span class="ident" id="7177251">TestHandshakeClientECDHERSAAES</span><span class="op" id="7177281">(</span><span class="ident" id="7177282">t</span>&nbsp;<span class="op" id="7177284">*</span><span class="ident" id="7177285">testing</span><span class="op" id="7177292">.</span><span class="ident" id="7177293">T</span><span class="op" id="7177294">)</span>&nbsp;<span class="op" id="7177296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177299">test</span>&nbsp;<span class="op" id="7177304">:=</span>&nbsp;<span class="op" id="7177307">&amp;</span><span class="ident" id="7177308">clientTest</span><span class="op" id="7177318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177322">name</span><span class="op" id="7177326">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7177331">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="7177346">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177350">command</span><span class="op" id="7177357">:</span>&nbsp;<span class="op" id="7177359">[</span><span class="op" id="7177360">]</span><span class="builtintype" id="7177361">string</span><span class="op" id="7177367">{</span><span class="string" id="7177368">&#34;openssl&#34;</span><span class="op" id="7177377">,</span>&nbsp;<span class="string" id="7177379">&#34;s_server&#34;</span><span class="op" id="7177389">,</span>&nbsp;<span class="string" id="7177391">&#34;-cipher&#34;</span><span class="op" id="7177400">,</span>&nbsp;<span class="string" id="7177402">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="7177424">}</span><span class="op" id="7177425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177431">runClientTestTLS10</span><span class="op" id="7177449">(</span><span class="ident" id="7177450">t</span><span class="op" id="7177451">,</span>&nbsp;<span class="ident" id="7177453">test</span><span class="op" id="7177457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177460">runClientTestTLS11</span><span class="op" id="7177478">(</span><span class="ident" id="7177479">t</span><span class="op" id="7177480">,</span>&nbsp;<span class="ident" id="7177482">test</span><span class="op" id="7177486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177489">runClientTestTLS12</span><span class="op" id="7177507">(</span><span class="ident" id="7177508">t</span><span class="op" id="7177509">,</span>&nbsp;<span class="ident" id="7177511">test</span><span class="op" id="7177515">)</span><br>
<span class="lineno">290</span><span class="op" id="7177517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7177520">func</span>&nbsp;<span class="ident" id="7177525">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="7177557">(</span><span class="ident" id="7177558">t</span>&nbsp;<span class="op" id="7177560">*</span><span class="ident" id="7177561">testing</span><span class="op" id="7177568">.</span><span class="ident" id="7177569">T</span><span class="op" id="7177570">)</span>&nbsp;<span class="op" id="7177572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177575">test</span>&nbsp;<span class="op" id="7177580">:=</span>&nbsp;<span class="op" id="7177583">&amp;</span><span class="ident" id="7177584">clientTest</span><span class="op" id="7177594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177598">name</span><span class="op" id="7177602">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7177607">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7177624">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177628">command</span><span class="op" id="7177635">:</span>&nbsp;<span class="op" id="7177637">[</span><span class="op" id="7177638">]</span><span class="builtintype" id="7177639">string</span><span class="op" id="7177645">{</span><span class="string" id="7177646">&#34;openssl&#34;</span><span class="op" id="7177655">,</span>&nbsp;<span class="string" id="7177657">&#34;s_server&#34;</span><span class="op" id="7177667">,</span>&nbsp;<span class="string" id="7177669">&#34;-cipher&#34;</span><span class="op" id="7177678">,</span>&nbsp;<span class="string" id="7177680">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7177704">}</span><span class="op" id="7177705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177709">cert</span><span class="op" id="7177713">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177718">testECDSACertificate</span><span class="op" id="7177738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177742">key</span><span class="op" id="7177745">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7177751">testECDSAPrivateKey</span><span class="op" id="7177770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177776">runClientTestTLS10</span><span class="op" id="7177794">(</span><span class="ident" id="7177795">t</span><span class="op" id="7177796">,</span>&nbsp;<span class="ident" id="7177798">test</span><span class="op" id="7177802">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177805">runClientTestTLS11</span><span class="op" id="7177823">(</span><span class="ident" id="7177824">t</span><span class="op" id="7177825">,</span>&nbsp;<span class="ident" id="7177827">test</span><span class="op" id="7177831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177834">runClientTestTLS12</span><span class="op" id="7177852">(</span><span class="ident" id="7177853">t</span><span class="op" id="7177854">,</span>&nbsp;<span class="ident" id="7177856">test</span><span class="op" id="7177860">)</span><br>
<span class="lineno"></span><span class="op" id="7177862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7177865">func</span>&nbsp;<span class="ident" id="7177870">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="7177905">(</span><span class="ident" id="7177906">t</span>&nbsp;<span class="op" id="7177908">*</span><span class="ident" id="7177909">testing</span><span class="op" id="7177916">.</span><span class="ident" id="7177917">T</span><span class="op" id="7177918">)</span>&nbsp;<span class="op" id="7177920">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177923">test</span>&nbsp;<span class="op" id="7177928">:=</span>&nbsp;<span class="op" id="7177931">&amp;</span><span class="ident" id="7177932">clientTest</span><span class="op" id="7177942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177946">name</span><span class="op" id="7177950">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7177955">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="7177976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177980">command</span><span class="op" id="7177987">:</span>&nbsp;<span class="op" id="7177989">[</span><span class="op" id="7177990">]</span><span class="builtintype" id="7177991">string</span><span class="op" id="7177997">{</span><span class="string" id="7177998">&#34;openssl&#34;</span><span class="op" id="7178007">,</span>&nbsp;<span class="string" id="7178009">&#34;s_server&#34;</span><span class="op" id="7178019">,</span>&nbsp;<span class="string" id="7178021">&#34;-cipher&#34;</span><span class="op" id="7178030">,</span>&nbsp;<span class="string" id="7178032">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7178063">}</span><span class="op" id="7178064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178068">cert</span><span class="op" id="7178072">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178077">testECDSACertificate</span><span class="op" id="7178097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178101">key</span><span class="op" id="7178104">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178110">testECDSAPrivateKey</span><span class="op" id="7178129">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178135">runClientTestTLS12</span><span class="op" id="7178153">(</span><span class="ident" id="7178154">t</span><span class="op" id="7178155">,</span>&nbsp;<span class="ident" id="7178157">test</span><span class="op" id="7178161">)</span><br>
<span class="lineno"></span><span class="op" id="7178163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7178166">func</span>&nbsp;<span class="ident" id="7178171">TestHandshakeClientCertRSA</span><span class="op" id="7178197">(</span><span class="ident" id="7178198">t</span>&nbsp;<span class="op" id="7178200">*</span><span class="ident" id="7178201">testing</span><span class="op" id="7178208">.</span><span class="ident" id="7178209">T</span><span class="op" id="7178210">)</span>&nbsp;<span class="op" id="7178212">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178215">config</span>&nbsp;<span class="op" id="7178222">:=</span>&nbsp;<span class="op" id="7178225">*</span><span class="ident" id="7178226">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178238">cert</span><span class="op" id="7178242">,</span>&nbsp;<span class="ident" id="7178244">_</span>&nbsp;<span class="op" id="7178246">:=</span>&nbsp;<span class="ident" id="7178249">X509KeyPair</span><span class="op" id="7178260">(</span><span class="op" id="7178261">[</span><span class="op" id="7178262">]</span><span class="builtintype" id="7178263">byte</span><span class="op" id="7178267">(</span><span class="ident" id="7178268">clientCertificatePEM</span><span class="op" id="7178288">)</span><span class="op" id="7178289">,</span>&nbsp;<span class="op" id="7178291">[</span><span class="op" id="7178292">]</span><span class="builtintype" id="7178293">byte</span><span class="op" id="7178297">(</span><span class="ident" id="7178298">clientKeyPEM</span><span class="op" id="7178310">)</span><span class="op" id="7178311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178314">config</span><span class="op" id="7178320">.</span><span class="ident" id="7178321">Certificates</span>&nbsp;<span class="op" id="7178334">=</span>&nbsp;<span class="op" id="7178336">[</span><span class="op" id="7178337">]</span><span class="ident" id="7178338">Certificate</span><span class="op" id="7178349">{</span><span class="ident" id="7178350">cert</span><span class="op" id="7178354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178358">test</span>&nbsp;<span class="op" id="7178363">:=</span>&nbsp;<span class="op" id="7178366">&amp;</span><span class="ident" id="7178367">clientTest</span><span class="op" id="7178377">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178381">name</span><span class="op" id="7178385">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7178390">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="7178410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178414">command</span><span class="op" id="7178421">:</span>&nbsp;<span class="op" id="7178423">[</span><span class="op" id="7178424">]</span><span class="builtintype" id="7178425">string</span><span class="op" id="7178431">{</span><span class="string" id="7178432">&#34;openssl&#34;</span><span class="op" id="7178441">,</span>&nbsp;<span class="string" id="7178443">&#34;s_server&#34;</span><span class="op" id="7178453">,</span>&nbsp;<span class="string" id="7178455">&#34;-cipher&#34;</span><span class="op" id="7178464">,</span>&nbsp;<span class="string" id="7178466">&#34;RC4-SHA&#34;</span><span class="op" id="7178475">,</span>&nbsp;<span class="string" id="7178477">&#34;-verify&#34;</span><span class="op" id="7178486">,</span>&nbsp;<span class="string" id="7178488">&#34;1&#34;</span><span class="op" id="7178491">}</span><span class="op" id="7178492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178496">config</span><span class="op" id="7178502">:</span>&nbsp;&nbsp;<span class="op" id="7178505">&amp;</span><span class="ident" id="7178506">config</span><span class="op" id="7178512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178519">runClientTestTLS10</span><span class="op" id="7178537">(</span><span class="ident" id="7178538">t</span><span class="op" id="7178539">,</span>&nbsp;<span class="ident" id="7178541">test</span><span class="op" id="7178545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178548">runClientTestTLS12</span><span class="op" id="7178566">(</span><span class="ident" id="7178567">t</span><span class="op" id="7178568">,</span>&nbsp;<span class="ident" id="7178570">test</span><span class="op" id="7178574">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178578">test</span>&nbsp;<span class="op" id="7178583">=</span>&nbsp;<span class="op" id="7178585">&amp;</span><span class="ident" id="7178586">clientTest</span><span class="op" id="7178596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178600">name</span><span class="op" id="7178604">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7178609">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="7178631">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178635">command</span><span class="op" id="7178642">:</span>&nbsp;<span class="op" id="7178644">[</span><span class="op" id="7178645">]</span><span class="builtintype" id="7178646">string</span><span class="op" id="7178652">{</span><span class="string" id="7178653">&#34;openssl&#34;</span><span class="op" id="7178662">,</span>&nbsp;<span class="string" id="7178664">&#34;s_server&#34;</span><span class="op" id="7178674">,</span>&nbsp;<span class="string" id="7178676">&#34;-cipher&#34;</span><span class="op" id="7178685">,</span>&nbsp;<span class="string" id="7178687">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7178711">,</span>&nbsp;<span class="string" id="7178713">&#34;-verify&#34;</span><span class="op" id="7178722">,</span>&nbsp;<span class="string" id="7178724">&#34;1&#34;</span><span class="op" id="7178727">}</span><span class="op" id="7178728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178732">config</span><span class="op" id="7178738">:</span>&nbsp;&nbsp;<span class="op" id="7178741">&amp;</span><span class="ident" id="7178742">config</span><span class="op" id="7178748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178752">cert</span><span class="op" id="7178756">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178761">testECDSACertificate</span><span class="op" id="7178781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178785">key</span><span class="op" id="7178788">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7178794">testECDSAPrivateKey</span><span class="op" id="7178813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178816">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178820">runClientTestTLS10</span><span class="op" id="7178838">(</span><span class="ident" id="7178839">t</span><span class="op" id="7178840">,</span>&nbsp;<span class="ident" id="7178842">test</span><span class="op" id="7178846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178849">runClientTestTLS12</span><span class="op" id="7178867">(</span><span class="ident" id="7178868">t</span><span class="op" id="7178869">,</span>&nbsp;<span class="ident" id="7178871">test</span><span class="op" id="7178875">)</span><br>
<span class="lineno"></span><span class="op" id="7178877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="7178880">func</span>&nbsp;<span class="ident" id="7178885">TestHandshakeClientCertECDSA</span><span class="op" id="7178913">(</span><span class="ident" id="7178914">t</span>&nbsp;<span class="op" id="7178916">*</span><span class="ident" id="7178917">testing</span><span class="op" id="7178924">.</span><span class="ident" id="7178925">T</span><span class="op" id="7178926">)</span>&nbsp;<span class="op" id="7178928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178931">config</span>&nbsp;<span class="op" id="7178938">:=</span>&nbsp;<span class="op" id="7178941">*</span><span class="ident" id="7178942">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178954">cert</span><span class="op" id="7178958">,</span>&nbsp;<span class="ident" id="7178960">_</span>&nbsp;<span class="op" id="7178962">:=</span>&nbsp;<span class="ident" id="7178965">X509KeyPair</span><span class="op" id="7178976">(</span><span class="op" id="7178977">[</span><span class="op" id="7178978">]</span><span class="builtintype" id="7178979">byte</span><span class="op" id="7178983">(</span><span class="ident" id="7178984">clientECDSACertificatePEM</span><span class="op" id="7179009">)</span><span class="op" id="7179010">,</span>&nbsp;<span class="op" id="7179012">[</span><span class="op" id="7179013">]</span><span class="builtintype" id="7179014">byte</span><span class="op" id="7179018">(</span><span class="ident" id="7179019">clientECDSAKeyPEM</span><span class="op" id="7179036">)</span><span class="op" id="7179037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179040">config</span><span class="op" id="7179046">.</span><span class="ident" id="7179047">Certificates</span>&nbsp;<span class="op" id="7179060">=</span>&nbsp;<span class="op" id="7179062">[</span><span class="op" id="7179063">]</span><span class="ident" id="7179064">Certificate</span><span class="op" id="7179075">{</span><span class="ident" id="7179076">cert</span><span class="op" id="7179080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179084">test</span>&nbsp;<span class="op" id="7179089">:=</span>&nbsp;<span class="op" id="7179092">&amp;</span><span class="ident" id="7179093">clientTest</span><span class="op" id="7179103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179107">name</span><span class="op" id="7179111">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7179116">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="7179138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179142">command</span><span class="op" id="7179149">:</span>&nbsp;<span class="op" id="7179151">[</span><span class="op" id="7179152">]</span><span class="builtintype" id="7179153">string</span><span class="op" id="7179159">{</span><span class="string" id="7179160">&#34;openssl&#34;</span><span class="op" id="7179169">,</span>&nbsp;<span class="string" id="7179171">&#34;s_server&#34;</span><span class="op" id="7179181">,</span>&nbsp;<span class="string" id="7179183">&#34;-cipher&#34;</span><span class="op" id="7179192">,</span>&nbsp;<span class="string" id="7179194">&#34;RC4-SHA&#34;</span><span class="op" id="7179203">,</span>&nbsp;<span class="string" id="7179205">&#34;-verify&#34;</span><span class="op" id="7179214">,</span>&nbsp;<span class="string" id="7179216">&#34;1&#34;</span><span class="op" id="7179219">}</span><span class="op" id="7179220">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179224">config</span><span class="op" id="7179230">:</span>&nbsp;&nbsp;<span class="op" id="7179233">&amp;</span><span class="ident" id="7179234">config</span><span class="op" id="7179240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179243">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179247">runClientTestTLS10</span><span class="op" id="7179265">(</span><span class="ident" id="7179266">t</span><span class="op" id="7179267">,</span>&nbsp;<span class="ident" id="7179269">test</span><span class="op" id="7179273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179276">runClientTestTLS12</span><span class="op" id="7179294">(</span><span class="ident" id="7179295">t</span><span class="op" id="7179296">,</span>&nbsp;<span class="ident" id="7179298">test</span><span class="op" id="7179302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179306">test</span>&nbsp;<span class="op" id="7179311">=</span>&nbsp;<span class="op" id="7179313">&amp;</span><span class="ident" id="7179314">clientTest</span><span class="op" id="7179324">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179328">name</span><span class="op" id="7179332">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7179337">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="7179361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179365">command</span><span class="op" id="7179372">:</span>&nbsp;<span class="op" id="7179374">[</span><span class="op" id="7179375">]</span><span class="builtintype" id="7179376">string</span><span class="op" id="7179382">{</span><span class="string" id="7179383">&#34;openssl&#34;</span><span class="op" id="7179392">,</span>&nbsp;<span class="string" id="7179394">&#34;s_server&#34;</span><span class="op" id="7179404">,</span>&nbsp;<span class="string" id="7179406">&#34;-cipher&#34;</span><span class="op" id="7179415">,</span>&nbsp;<span class="string" id="7179417">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7179441">,</span>&nbsp;<span class="string" id="7179443">&#34;-verify&#34;</span><span class="op" id="7179452">,</span>&nbsp;<span class="string" id="7179454">&#34;1&#34;</span><span class="op" id="7179457">}</span><span class="op" id="7179458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179462">config</span><span class="op" id="7179468">:</span>&nbsp;&nbsp;<span class="op" id="7179471">&amp;</span><span class="ident" id="7179472">config</span><span class="op" id="7179478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179482">cert</span><span class="op" id="7179486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7179491">testECDSACertificate</span><span class="op" id="7179511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179515">key</span><span class="op" id="7179518">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7179524">testECDSAPrivateKey</span><span class="op" id="7179543">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179550">runClientTestTLS10</span><span class="op" id="7179568">(</span><span class="ident" id="7179569">t</span><span class="op" id="7179570">,</span>&nbsp;<span class="ident" id="7179572">test</span><span class="op" id="7179576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179579">runClientTestTLS12</span><span class="op" id="7179597">(</span><span class="ident" id="7179598">t</span><span class="op" id="7179599">,</span>&nbsp;<span class="ident" id="7179601">test</span><span class="op" id="7179605">)</span><br>
<span class="lineno"></span><span class="op" id="7179607">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7179610">func</span>&nbsp;<span class="ident" id="7179615">TestClientResumption</span><span class="op" id="7179635">(</span><span class="ident" id="7179636">t</span>&nbsp;<span class="op" id="7179638">*</span><span class="ident" id="7179639">testing</span><span class="op" id="7179646">.</span><span class="ident" id="7179647">T</span><span class="op" id="7179648">)</span>&nbsp;<span class="op" id="7179650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179653">serverConfig</span>&nbsp;<span class="op" id="7179666">:=</span>&nbsp;<span class="op" id="7179669">&amp;</span><span class="ident" id="7179670">Config</span><span class="op" id="7179676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179680">CipherSuites</span><span class="op" id="7179692">:</span>&nbsp;<span class="op" id="7179694">[</span><span class="op" id="7179695">]</span><span class="builtintype" id="7179696">uint16</span><span class="op" id="7179702">{</span><span class="ident" id="7179703">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7179727">,</span>&nbsp;<span class="ident" id="7179729">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7179759">}</span><span class="op" id="7179760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179764">Certificates</span><span class="op" id="7179776">:</span>&nbsp;<span class="ident" id="7179778">testConfig</span><span class="op" id="7179788">.</span><span class="ident" id="7179789">Certificates</span><span class="op" id="7179801">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179807">clientConfig</span>&nbsp;<span class="op" id="7179820">:=</span>&nbsp;<span class="op" id="7179823">&amp;</span><span class="ident" id="7179824">Config</span><span class="op" id="7179830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179834">CipherSuites</span><span class="op" id="7179846">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7179854">[</span><span class="op" id="7179855">]</span><span class="builtintype" id="7179856">uint16</span><span class="op" id="7179862">{</span><span class="ident" id="7179863">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7179887">}</span><span class="op" id="7179888">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179892">InsecureSkipVerify</span><span class="op" id="7179910">:</span>&nbsp;<span class="builtintype" id="7179912">true</span><span class="op" id="7179916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179920">ClientSessionCache</span><span class="op" id="7179938">:</span>&nbsp;<span class="ident" id="7179940">NewLRUClientSessionCache</span><span class="op" id="7179964">(</span><span class="num" id="7179965">32</span><span class="op" id="7179967">)</span><span class="op" id="7179968">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179975">testResumeState</span>&nbsp;<span class="op" id="7179991">:=</span>&nbsp;<span class="keyword" id="7179994">func</span><span class="op" id="7179998">(</span><span class="ident" id="7179999">test</span>&nbsp;<span class="builtintype" id="7180004">string</span><span class="op" id="7180010">,</span>&nbsp;<span class="ident" id="7180012">didResume</span>&nbsp;<span class="builtintype" id="7180022">bool</span><span class="op" id="7180026">)</span>&nbsp;<span class="op" id="7180028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180032">hs</span><span class="op" id="7180034">,</span>&nbsp;<span class="ident" id="7180036">err</span>&nbsp;<span class="op" id="7180040">:=</span>&nbsp;<span class="ident" id="7180043">testHandshake</span><span class="op" id="7180056">(</span><span class="ident" id="7180057">clientConfig</span><span class="op" id="7180069">,</span>&nbsp;<span class="ident" id="7180071">serverConfig</span><span class="op" id="7180083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180087">if</span>&nbsp;<span class="ident" id="7180090">err</span>&nbsp;<span class="op" id="7180094">!=</span>&nbsp;<span class="ident" id="7180097">nil</span>&nbsp;<span class="op" id="7180101">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180106">t</span><span class="op" id="7180107">.</span><span class="ident" id="7180108">Fatalf</span><span class="op" id="7180114">(</span><span class="string" id="7180115">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7180141">,</span>&nbsp;<span class="ident" id="7180143">test</span><span class="op" id="7180147">,</span>&nbsp;<span class="ident" id="7180149">err</span><span class="op" id="7180152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180160">if</span>&nbsp;<span class="ident" id="7180163">hs</span><span class="op" id="7180165">.</span><span class="ident" id="7180166">DidResume</span>&nbsp;<span class="op" id="7180176">!=</span>&nbsp;<span class="ident" id="7180179">didResume</span>&nbsp;<span class="op" id="7180189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180194">t</span><span class="op" id="7180195">.</span><span class="ident" id="7180196">Fatalf</span><span class="op" id="7180202">(</span><span class="string" id="7180203">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="7180233">,</span>&nbsp;<span class="ident" id="7180235">test</span><span class="op" id="7180239">,</span>&nbsp;<span class="ident" id="7180241">hs</span><span class="op" id="7180243">.</span><span class="ident" id="7180244">DidResume</span><span class="op" id="7180253">,</span>&nbsp;<span class="ident" id="7180255">didResume</span><span class="op" id="7180264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180268">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180275">testResumeState</span><span class="op" id="7180290">(</span><span class="string" id="7180291">&#34;Handshake&#34;</span><span class="op" id="7180302">,</span>&nbsp;<span class="builtintype" id="7180304">false</span><span class="op" id="7180309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180312">testResumeState</span><span class="op" id="7180327">(</span><span class="string" id="7180328">&#34;Resume&#34;</span><span class="op" id="7180336">,</span>&nbsp;<span class="builtintype" id="7180338">true</span><span class="op" id="7180342">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180346">if</span>&nbsp;<span class="ident" id="7180349">_</span><span class="op" id="7180350">,</span>&nbsp;<span class="ident" id="7180352">err</span>&nbsp;<span class="op" id="7180356">:=</span>&nbsp;<span class="ident" id="7180359">io</span><span class="op" id="7180361">.</span><span class="ident" id="7180362">ReadFull</span><span class="op" id="7180370">(</span><span class="ident" id="7180371">serverConfig</span><span class="op" id="7180383">.</span><span class="ident" id="7180384">rand</span><span class="op" id="7180388">(</span><span class="op" id="7180389">)</span><span class="op" id="7180390">,</span>&nbsp;<span class="ident" id="7180392">serverConfig</span><span class="op" id="7180404">.</span><span class="ident" id="7180405">SessionTicketKey</span><span class="op" id="7180421">[</span><span class="op" id="7180422">:</span><span class="op" id="7180423">]</span><span class="op" id="7180424">)</span><span class="op" id="7180425">;</span>&nbsp;<span class="ident" id="7180427">err</span>&nbsp;<span class="op" id="7180431">!=</span>&nbsp;<span class="ident" id="7180434">nil</span>&nbsp;<span class="op" id="7180438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180442">t</span><span class="op" id="7180443">.</span><span class="ident" id="7180444">Fatalf</span><span class="op" id="7180450">(</span><span class="string" id="7180451">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="7180490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180496">testResumeState</span><span class="op" id="7180511">(</span><span class="string" id="7180512">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="7180537">,</span>&nbsp;<span class="builtintype" id="7180539">false</span><span class="op" id="7180544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180547">testResumeState</span><span class="op" id="7180562">(</span><span class="string" id="7180563">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="7180599">,</span>&nbsp;<span class="builtintype" id="7180601">true</span><span class="op" id="7180605">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180609">clientConfig</span><span class="op" id="7180621">.</span><span class="ident" id="7180622">CipherSuites</span>&nbsp;<span class="op" id="7180635">=</span>&nbsp;<span class="op" id="7180637">[</span><span class="op" id="7180638">]</span><span class="builtintype" id="7180639">uint16</span><span class="op" id="7180645">{</span><span class="ident" id="7180646">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7180676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180679">testResumeState</span><span class="op" id="7180694">(</span><span class="string" id="7180695">&#34;DifferentCipherSuite&#34;</span><span class="op" id="7180717">,</span>&nbsp;<span class="builtintype" id="7180719">false</span><span class="op" id="7180724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180727">testResumeState</span><span class="op" id="7180742">(</span><span class="string" id="7180743">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="7180773">,</span>&nbsp;<span class="builtintype" id="7180775">true</span><span class="op" id="7180779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180783">clientConfig</span><span class="op" id="7180795">.</span><span class="ident" id="7180796">ClientSessionCache</span>&nbsp;<span class="op" id="7180815">=</span>&nbsp;<span class="ident" id="7180817">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180822">testResumeState</span><span class="op" id="7180837">(</span><span class="string" id="7180838">&#34;WithoutSessionCache&#34;</span><span class="op" id="7180859">,</span>&nbsp;<span class="builtintype" id="7180861">false</span><span class="op" id="7180866">)</span><br>
<span class="lineno"></span><span class="op" id="7180868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7180871">func</span>&nbsp;<span class="ident" id="7180876">TestLRUClientSessionCache</span><span class="op" id="7180901">(</span><span class="ident" id="7180902">t</span>&nbsp;<span class="op" id="7180904">*</span><span class="ident" id="7180905">testing</span><span class="op" id="7180912">.</span><span class="ident" id="7180913">T</span><span class="op" id="7180914">)</span>&nbsp;<span class="op" id="7180916">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7180919">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180955">cache</span>&nbsp;<span class="op" id="7180961">:=</span>&nbsp;<span class="ident" id="7180964">NewLRUClientSessionCache</span><span class="op" id="7180988">(</span><span class="num" id="7180989">4</span><span class="op" id="7180990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180993">cs</span>&nbsp;<span class="op" id="7180996">:=</span>&nbsp;<span class="builtinfunc" id="7180999">make</span><span class="op" id="7181003">(</span><span class="op" id="7181004">[</span><span class="op" id="7181005">]</span><span class="ident" id="7181006">ClientSessionState</span><span class="op" id="7181024">,</span>&nbsp;<span class="num" id="7181026">6</span><span class="op" id="7181027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181030">keys</span>&nbsp;<span class="op" id="7181035">:=</span>&nbsp;<span class="op" id="7181038">[</span><span class="op" id="7181039">]</span><span class="builtintype" id="7181040">string</span><span class="op" id="7181046">{</span><span class="string" id="7181047">&#34;0&#34;</span><span class="op" id="7181050">,</span>&nbsp;<span class="string" id="7181052">&#34;1&#34;</span><span class="op" id="7181055">,</span>&nbsp;<span class="string" id="7181057">&#34;2&#34;</span><span class="op" id="7181060">,</span>&nbsp;<span class="string" id="7181062">&#34;3&#34;</span><span class="op" id="7181065">,</span>&nbsp;<span class="string" id="7181067">&#34;4&#34;</span><span class="op" id="7181070">,</span>&nbsp;<span class="string" id="7181072">&#34;5&#34;</span><span class="op" id="7181075">,</span>&nbsp;<span class="string" id="7181077">&#34;6&#34;</span><span class="op" id="7181080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7181084">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181133">for</span>&nbsp;<span class="ident" id="7181137">i</span>&nbsp;<span class="op" id="7181139">:=</span>&nbsp;<span class="num" id="7181142">0</span><span class="op" id="7181143">;</span>&nbsp;<span class="ident" id="7181145">i</span>&nbsp;<span class="op" id="7181147">&lt;</span>&nbsp;<span class="num" id="7181149">4</span><span class="op" id="7181150">;</span>&nbsp;<span class="ident" id="7181152">i</span><span class="op" id="7181153">++</span>&nbsp;<span class="op" id="7181156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181160">cache</span><span class="op" id="7181165">.</span><span class="ident" id="7181166">Put</span><span class="op" id="7181169">(</span><span class="ident" id="7181170">keys</span><span class="op" id="7181174">[</span><span class="ident" id="7181175">i</span><span class="op" id="7181176">]</span><span class="op" id="7181177">,</span>&nbsp;<span class="op" id="7181179">&amp;</span><span class="ident" id="7181180">cs</span><span class="op" id="7181182">[</span><span class="ident" id="7181183">i</span><span class="op" id="7181184">]</span><span class="op" id="7181185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181191">for</span>&nbsp;<span class="ident" id="7181195">i</span>&nbsp;<span class="op" id="7181197">:=</span>&nbsp;<span class="num" id="7181200">0</span><span class="op" id="7181201">;</span>&nbsp;<span class="ident" id="7181203">i</span>&nbsp;<span class="op" id="7181205">&lt;</span>&nbsp;<span class="num" id="7181207">4</span><span class="op" id="7181208">;</span>&nbsp;<span class="ident" id="7181210">i</span><span class="op" id="7181211">++</span>&nbsp;<span class="op" id="7181214">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181218">if</span>&nbsp;<span class="ident" id="7181221">s</span><span class="op" id="7181222">,</span>&nbsp;<span class="ident" id="7181224">ok</span>&nbsp;<span class="op" id="7181227">:=</span>&nbsp;<span class="ident" id="7181230">cache</span><span class="op" id="7181235">.</span><span class="ident" id="7181236">Get</span><span class="op" id="7181239">(</span><span class="ident" id="7181240">keys</span><span class="op" id="7181244">[</span><span class="ident" id="7181245">i</span><span class="op" id="7181246">]</span><span class="op" id="7181247">)</span><span class="op" id="7181248">;</span>&nbsp;<span class="op" id="7181250">!</span><span class="ident" id="7181251">ok</span>&nbsp;<span class="op" id="7181254">||</span>&nbsp;<span class="ident" id="7181257">s</span>&nbsp;<span class="op" id="7181259">!=</span>&nbsp;<span class="op" id="7181262">&amp;</span><span class="ident" id="7181263">cs</span><span class="op" id="7181265">[</span><span class="ident" id="7181266">i</span><span class="op" id="7181267">]</span>&nbsp;<span class="op" id="7181269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181274">t</span><span class="op" id="7181275">.</span><span class="ident" id="7181276">Fatalf</span><span class="op" id="7181282">(</span><span class="string" id="7181283">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7181330">,</span>&nbsp;<span class="ident" id="7181332">keys</span><span class="op" id="7181336">[</span><span class="ident" id="7181337">i</span><span class="op" id="7181338">]</span><span class="op" id="7181339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7181350">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181414">for</span>&nbsp;<span class="ident" id="7181418">i</span>&nbsp;<span class="op" id="7181420">:=</span>&nbsp;<span class="num" id="7181423">4</span><span class="op" id="7181424">;</span>&nbsp;<span class="ident" id="7181426">i</span>&nbsp;<span class="op" id="7181428">&lt;</span>&nbsp;<span class="num" id="7181430">6</span><span class="op" id="7181431">;</span>&nbsp;<span class="ident" id="7181433">i</span><span class="op" id="7181434">++</span>&nbsp;<span class="op" id="7181437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181441">cache</span><span class="op" id="7181446">.</span><span class="ident" id="7181447">Put</span><span class="op" id="7181450">(</span><span class="ident" id="7181451">keys</span><span class="op" id="7181455">[</span><span class="ident" id="7181456">i</span><span class="op" id="7181457">]</span><span class="op" id="7181458">,</span>&nbsp;<span class="op" id="7181460">&amp;</span><span class="ident" id="7181461">cs</span><span class="op" id="7181463">[</span><span class="ident" id="7181464">i</span><span class="op" id="7181465">]</span><span class="op" id="7181466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181472">for</span>&nbsp;<span class="ident" id="7181476">i</span>&nbsp;<span class="op" id="7181478">:=</span>&nbsp;<span class="num" id="7181481">0</span><span class="op" id="7181482">;</span>&nbsp;<span class="ident" id="7181484">i</span>&nbsp;<span class="op" id="7181486">&lt;</span>&nbsp;<span class="num" id="7181488">2</span><span class="op" id="7181489">;</span>&nbsp;<span class="ident" id="7181491">i</span><span class="op" id="7181492">++</span>&nbsp;<span class="op" id="7181495">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181499">if</span>&nbsp;<span class="ident" id="7181502">s</span><span class="op" id="7181503">,</span>&nbsp;<span class="ident" id="7181505">ok</span>&nbsp;<span class="op" id="7181508">:=</span>&nbsp;<span class="ident" id="7181511">cache</span><span class="op" id="7181516">.</span><span class="ident" id="7181517">Get</span><span class="op" id="7181520">(</span><span class="ident" id="7181521">keys</span><span class="op" id="7181525">[</span><span class="ident" id="7181526">i</span><span class="op" id="7181527">]</span><span class="op" id="7181528">)</span><span class="op" id="7181529">;</span>&nbsp;<span class="ident" id="7181531">ok</span>&nbsp;<span class="op" id="7181534">||</span>&nbsp;<span class="ident" id="7181537">s</span>&nbsp;<span class="op" id="7181539">!=</span>&nbsp;<span class="ident" id="7181542">nil</span>&nbsp;<span class="op" id="7181546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181551">t</span><span class="op" id="7181552">.</span><span class="ident" id="7181553">Fatalf</span><span class="op" id="7181559">(</span><span class="string" id="7181560">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7181603">,</span>&nbsp;<span class="ident" id="7181605">keys</span><span class="op" id="7181609">[</span><span class="ident" id="7181610">i</span><span class="op" id="7181611">]</span><span class="op" id="7181612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7181623">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181667">cache</span><span class="op" id="7181672">.</span><span class="ident" id="7181673">Get</span><span class="op" id="7181676">(</span><span class="ident" id="7181677">keys</span><span class="op" id="7181681">[</span><span class="num" id="7181682">2</span><span class="op" id="7181683">]</span><span class="op" id="7181684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181687">cache</span><span class="op" id="7181692">.</span><span class="ident" id="7181693">Put</span><span class="op" id="7181696">(</span><span class="ident" id="7181697">keys</span><span class="op" id="7181701">[</span><span class="num" id="7181702">0</span><span class="op" id="7181703">]</span><span class="op" id="7181704">,</span>&nbsp;<span class="op" id="7181706">&amp;</span><span class="ident" id="7181707">cs</span><span class="op" id="7181709">[</span><span class="num" id="7181710">0</span><span class="op" id="7181711">]</span><span class="op" id="7181712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181715">if</span>&nbsp;<span class="ident" id="7181718">s</span><span class="op" id="7181719">,</span>&nbsp;<span class="ident" id="7181721">ok</span>&nbsp;<span class="op" id="7181724">:=</span>&nbsp;<span class="ident" id="7181727">cache</span><span class="op" id="7181732">.</span><span class="ident" id="7181733">Get</span><span class="op" id="7181736">(</span><span class="ident" id="7181737">keys</span><span class="op" id="7181741">[</span><span class="num" id="7181742">3</span><span class="op" id="7181743">]</span><span class="op" id="7181744">)</span><span class="op" id="7181745">;</span>&nbsp;<span class="ident" id="7181747">ok</span>&nbsp;<span class="op" id="7181750">||</span>&nbsp;<span class="ident" id="7181753">s</span>&nbsp;<span class="op" id="7181755">!=</span>&nbsp;<span class="ident" id="7181758">nil</span>&nbsp;<span class="op" id="7181762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181766">t</span><span class="op" id="7181767">.</span><span class="ident" id="7181768">Fatalf</span><span class="op" id="7181774">(</span><span class="string" id="7181775">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="7181816">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7181823">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181852">cache</span><span class="op" id="7181857">.</span><span class="ident" id="7181858">Put</span><span class="op" id="7181861">(</span><span class="ident" id="7181862">keys</span><span class="op" id="7181866">[</span><span class="num" id="7181867">0</span><span class="op" id="7181868">]</span><span class="op" id="7181869">,</span>&nbsp;<span class="op" id="7181871">&amp;</span><span class="ident" id="7181872">cs</span><span class="op" id="7181874">[</span><span class="num" id="7181875">3</span><span class="op" id="7181876">]</span><span class="op" id="7181877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181880">if</span>&nbsp;<span class="ident" id="7181883">s</span><span class="op" id="7181884">,</span>&nbsp;<span class="ident" id="7181886">ok</span>&nbsp;<span class="op" id="7181889">:=</span>&nbsp;<span class="ident" id="7181892">cache</span><span class="op" id="7181897">.</span><span class="ident" id="7181898">Get</span><span class="op" id="7181901">(</span><span class="ident" id="7181902">keys</span><span class="op" id="7181906">[</span><span class="num" id="7181907">0</span><span class="op" id="7181908">]</span><span class="op" id="7181909">)</span><span class="op" id="7181910">;</span>&nbsp;<span class="op" id="7181912">!</span><span class="ident" id="7181913">ok</span>&nbsp;<span class="op" id="7181916">||</span>&nbsp;<span class="ident" id="7181919">s</span>&nbsp;<span class="op" id="7181921">!=</span>&nbsp;<span class="op" id="7181924">&amp;</span><span class="ident" id="7181925">cs</span><span class="op" id="7181927">[</span><span class="num" id="7181928">3</span><span class="op" id="7181929">]</span>&nbsp;<span class="op" id="7181931">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181935">t</span><span class="op" id="7181936">.</span><span class="ident" id="7181937">Fatalf</span><span class="op" id="7181943">(</span><span class="string" id="7181944">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="7181983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7181990">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182023">cache</span><span class="op" id="7182028">.</span><span class="ident" id="7182029">Put</span><span class="op" id="7182032">(</span><span class="ident" id="7182033">keys</span><span class="op" id="7182037">[</span><span class="num" id="7182038">0</span><span class="op" id="7182039">]</span><span class="op" id="7182040">,</span>&nbsp;<span class="ident" id="7182042">nil</span><span class="op" id="7182045">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182048">if</span>&nbsp;<span class="ident" id="7182051">s</span><span class="op" id="7182052">,</span>&nbsp;<span class="ident" id="7182054">ok</span>&nbsp;<span class="op" id="7182057">:=</span>&nbsp;<span class="ident" id="7182060">cache</span><span class="op" id="7182065">.</span><span class="ident" id="7182066">Get</span><span class="op" id="7182069">(</span><span class="ident" id="7182070">keys</span><span class="op" id="7182074">[</span><span class="num" id="7182075">0</span><span class="op" id="7182076">]</span><span class="op" id="7182077">)</span><span class="op" id="7182078">;</span>&nbsp;<span class="op" id="7182080">!</span><span class="ident" id="7182081">ok</span>&nbsp;<span class="op" id="7182084">||</span>&nbsp;<span class="ident" id="7182087">s</span>&nbsp;<span class="op" id="7182089">!=</span>&nbsp;<span class="ident" id="7182092">nil</span>&nbsp;<span class="op" id="7182096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182100">t</span><span class="op" id="7182101">.</span><span class="ident" id="7182102">Fatalf</span><span class="op" id="7182108">(</span><span class="string" id="7182109">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="7182143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182146">}</span><br>
<span class="lineno"></span><span class="op" id="7182148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="7182151">func</span>&nbsp;<span class="ident" id="7182156">TestHandshakeClientALPNMatch</span><span class="op" id="7182184">(</span><span class="ident" id="7182185">t</span>&nbsp;<span class="op" id="7182187">*</span><span class="ident" id="7182188">testing</span><span class="op" id="7182195">.</span><span class="ident" id="7182196">T</span><span class="op" id="7182197">)</span>&nbsp;<span class="op" id="7182199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182202">config</span>&nbsp;<span class="op" id="7182209">:=</span>&nbsp;<span class="op" id="7182212">*</span><span class="ident" id="7182213">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182225">config</span><span class="op" id="7182231">.</span><span class="ident" id="7182232">NextProtos</span>&nbsp;<span class="op" id="7182243">=</span>&nbsp;<span class="op" id="7182245">[</span><span class="op" id="7182246">]</span><span class="builtintype" id="7182247">string</span><span class="op" id="7182253">{</span><span class="string" id="7182254">&#34;proto2&#34;</span><span class="op" id="7182262">,</span>&nbsp;<span class="string" id="7182264">&#34;proto1&#34;</span><span class="op" id="7182272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182276">test</span>&nbsp;<span class="op" id="7182281">:=</span>&nbsp;<span class="op" id="7182284">&amp;</span><span class="ident" id="7182285">clientTest</span><span class="op" id="7182295">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182299">name</span><span class="op" id="7182303">:</span>&nbsp;<span class="string" id="7182305">&#34;ALPN&#34;</span><span class="op" id="7182311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7182315">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7182381">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182424">command</span><span class="op" id="7182431">:</span>&nbsp;<span class="op" id="7182433">[</span><span class="op" id="7182434">]</span><span class="builtintype" id="7182435">string</span><span class="op" id="7182441">{</span><span class="string" id="7182442">&#34;openssl&#34;</span><span class="op" id="7182451">,</span>&nbsp;<span class="string" id="7182453">&#34;s_server&#34;</span><span class="op" id="7182463">,</span>&nbsp;<span class="string" id="7182465">&#34;-alpn&#34;</span><span class="op" id="7182472">,</span>&nbsp;<span class="string" id="7182474">&#34;proto1,proto2&#34;</span><span class="op" id="7182489">}</span><span class="op" id="7182490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182494">config</span><span class="op" id="7182500">:</span>&nbsp;&nbsp;<span class="op" id="7182503">&amp;</span><span class="ident" id="7182504">config</span><span class="op" id="7182510">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182514">validate</span><span class="op" id="7182522">:</span>&nbsp;<span class="keyword" id="7182524">func</span><span class="op" id="7182528">(</span><span class="ident" id="7182529">state</span>&nbsp;<span class="ident" id="7182535">ConnectionState</span><span class="op" id="7182550">)</span>&nbsp;<span class="builtintype" id="7182552">error</span>&nbsp;<span class="op" id="7182558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7182563">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182622">if</span>&nbsp;<span class="ident" id="7182625">state</span><span class="op" id="7182630">.</span><span class="ident" id="7182631">NegotiatedProtocol</span>&nbsp;<span class="op" id="7182650">!=</span>&nbsp;<span class="string" id="7182653">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7182662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182668">return</span>&nbsp;<span class="ident" id="7182675">fmt</span><span class="op" id="7182678">.</span><span class="ident" id="7182679">Errorf</span><span class="op" id="7182685">(</span><span class="string" id="7182686">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7182718">,</span>&nbsp;<span class="ident" id="7182720">state</span><span class="op" id="7182725">.</span><span class="ident" id="7182726">NegotiatedProtocol</span><span class="op" id="7182744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182749">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182754">return</span>&nbsp;<span class="ident" id="7182761">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182767">}</span><span class="op" id="7182768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182774">runClientTestTLS12</span><span class="op" id="7182792">(</span><span class="ident" id="7182793">t</span><span class="op" id="7182794">,</span>&nbsp;<span class="ident" id="7182796">test</span><span class="op" id="7182800">)</span><br>
<span class="lineno"></span><span class="op" id="7182802">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="7182805">func</span>&nbsp;<span class="ident" id="7182810">TestHandshakeClientALPNNoMatch</span><span class="op" id="7182840">(</span><span class="ident" id="7182841">t</span>&nbsp;<span class="op" id="7182843">*</span><span class="ident" id="7182844">testing</span><span class="op" id="7182851">.</span><span class="ident" id="7182852">T</span><span class="op" id="7182853">)</span>&nbsp;<span class="op" id="7182855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182858">config</span>&nbsp;<span class="op" id="7182865">:=</span>&nbsp;<span class="op" id="7182868">*</span><span class="ident" id="7182869">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182881">config</span><span class="op" id="7182887">.</span><span class="ident" id="7182888">NextProtos</span>&nbsp;<span class="op" id="7182899">=</span>&nbsp;<span class="op" id="7182901">[</span><span class="op" id="7182902">]</span><span class="builtintype" id="7182903">string</span><span class="op" id="7182909">{</span><span class="string" id="7182910">&#34;proto3&#34;</span><span class="op" id="7182918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182922">test</span>&nbsp;<span class="op" id="7182927">:=</span>&nbsp;<span class="op" id="7182930">&amp;</span><span class="ident" id="7182931">clientTest</span><span class="op" id="7182941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182945">name</span><span class="op" id="7182949">:</span>&nbsp;<span class="string" id="7182951">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7182965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7182969">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7183035">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183078">command</span><span class="op" id="7183085">:</span>&nbsp;<span class="op" id="7183087">[</span><span class="op" id="7183088">]</span><span class="builtintype" id="7183089">string</span><span class="op" id="7183095">{</span><span class="string" id="7183096">&#34;openssl&#34;</span><span class="op" id="7183105">,</span>&nbsp;<span class="string" id="7183107">&#34;s_server&#34;</span><span class="op" id="7183117">,</span>&nbsp;<span class="string" id="7183119">&#34;-alpn&#34;</span><span class="op" id="7183126">,</span>&nbsp;<span class="string" id="7183128">&#34;proto1,proto2&#34;</span><span class="op" id="7183143">}</span><span class="op" id="7183144">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183148">config</span><span class="op" id="7183154">:</span>&nbsp;&nbsp;<span class="op" id="7183157">&amp;</span><span class="ident" id="7183158">config</span><span class="op" id="7183164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183168">validate</span><span class="op" id="7183176">:</span>&nbsp;<span class="keyword" id="7183178">func</span><span class="op" id="7183182">(</span><span class="ident" id="7183183">state</span>&nbsp;<span class="ident" id="7183189">ConnectionState</span><span class="op" id="7183204">)</span>&nbsp;<span class="builtintype" id="7183206">error</span>&nbsp;<span class="op" id="7183212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7183217">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183281">if</span>&nbsp;<span class="ident" id="7183284">state</span><span class="op" id="7183289">.</span><span class="ident" id="7183290">NegotiatedProtocol</span>&nbsp;<span class="op" id="7183309">!=</span>&nbsp;<span class="string" id="7183312">&#34;&#34;</span>&nbsp;<span class="op" id="7183315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183321">return</span>&nbsp;<span class="ident" id="7183328">fmt</span><span class="op" id="7183331">.</span><span class="ident" id="7183332">Errorf</span><span class="op" id="7183338">(</span><span class="string" id="7183339">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7183367">,</span>&nbsp;<span class="ident" id="7183369">state</span><span class="op" id="7183374">.</span><span class="ident" id="7183375">NegotiatedProtocol</span><span class="op" id="7183393">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183403">return</span>&nbsp;<span class="ident" id="7183410">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183416">}</span><span class="op" id="7183417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183423">runClientTestTLS12</span><span class="op" id="7183441">(</span><span class="ident" id="7183442">t</span><span class="op" id="7183443">,</span>&nbsp;<span class="ident" id="7183445">test</span><span class="op" id="7183449">)</span><br>
<span class="lineno">490</span><span class="op" id="7183451">}</span>
</div>
</body>
</html>
