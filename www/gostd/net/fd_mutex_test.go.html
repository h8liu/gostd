<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html" class="current">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6667419">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6667474">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6667528">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6667579">package</span>&nbsp;<span class="ident" id="6667587">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6667592">import</span>&nbsp;<span class="op" id="6667599">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6667602">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6667615">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6667626">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6667637">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6667644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6667647">func</span>&nbsp;<span class="ident" id="6667652">TestMutexLock</span><span class="op" id="6667665">(</span><span class="ident" id="6667666">t</span>&nbsp;<span class="op" id="6667668">*</span><span class="ident" id="6667669">testing</span><span class="op" id="6667676">.</span><span class="ident" id="6667677">T</span><span class="op" id="6667678">)</span>&nbsp;<span class="op" id="6667680">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6667683">var</span>&nbsp;<span class="ident" id="6667687">mu</span>&nbsp;<span class="ident" id="6667690">fdMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6667700">if</span>&nbsp;<span class="op" id="6667703">!</span><span class="ident" id="6667704">mu</span><span class="op" id="6667706">.</span><span class="ident" id="6667707">Incref</span><span class="op" id="6667713">(</span><span class="op" id="6667714">)</span>&nbsp;<span class="op" id="6667716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6667720">t</span><span class="op" id="6667721">.</span><span class="ident" id="6667722">Fatal</span><span class="op" id="6667727">(</span><span class="string" id="6667728">&#34;broken&#34;</span><span class="op" id="6667736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6667739">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6667742">if</span>&nbsp;<span class="ident" id="6667745">mu</span><span class="op" id="6667747">.</span><span class="ident" id="6667748">Decref</span><span class="op" id="6667754">(</span><span class="op" id="6667755">)</span>&nbsp;<span class="op" id="6667757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6667761">t</span><span class="op" id="6667762">.</span><span class="ident" id="6667763">Fatal</span><span class="op" id="6667768">(</span><span class="string" id="6667769">&#34;broken&#34;</span><span class="op" id="6667777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6667780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6667784">if</span>&nbsp;<span class="op" id="6667787">!</span><span class="ident" id="6667788">mu</span><span class="op" id="6667790">.</span><span class="ident" id="6667791">RWLock</span><span class="op" id="6667797">(</span><span class="builtintype" id="6667798">true</span><span class="op" id="6667802">)</span>&nbsp;<span class="op" id="6667804">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6667808">t</span><span class="op" id="6667809">.</span><span class="ident" id="6667810">Fatal</span><span class="op" id="6667815">(</span><span class="string" id="6667816">&#34;broken&#34;</span><span class="op" id="6667824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6667827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6667830">if</span>&nbsp;<span class="ident" id="6667833">mu</span><span class="op" id="6667835">.</span><span class="ident" id="6667836">RWUnlock</span><span class="op" id="6667844">(</span><span class="builtintype" id="6667845">true</span><span class="op" id="6667849">)</span>&nbsp;<span class="op" id="6667851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6667855">t</span><span class="op" id="6667856">.</span><span class="ident" id="6667857">Fatal</span><span class="op" id="6667862">(</span><span class="string" id="6667863">&#34;broken&#34;</span><span class="op" id="6667871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6667874">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6667878">if</span>&nbsp;<span class="op" id="6667881">!</span><span class="ident" id="6667882">mu</span><span class="op" id="6667884">.</span><span class="ident" id="6667885">RWLock</span><span class="op" id="6667891">(</span><span class="builtintype" id="6667892">false</span><span class="op" id="6667897">)</span>&nbsp;<span class="op" id="6667899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6667903">t</span><span class="op" id="6667904">.</span><span class="ident" id="6667905">Fatal</span><span class="op" id="6667910">(</span><span class="string" id="6667911">&#34;broken&#34;</span><span class="op" id="6667919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6667922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6667925">if</span>&nbsp;<span class="ident" id="6667928">mu</span><span class="op" id="6667930">.</span><span class="ident" id="6667931">RWUnlock</span><span class="op" id="6667939">(</span><span class="builtintype" id="6667940">false</span><span class="op" id="6667945">)</span>&nbsp;<span class="op" id="6667947">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6667951">t</span><span class="op" id="6667952">.</span><span class="ident" id="6667953">Fatal</span><span class="op" id="6667958">(</span><span class="string" id="6667959">&#34;broken&#34;</span><span class="op" id="6667967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6667970">}</span><br>
<span class="lineno"></span><span class="op" id="6667972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6667975">func</span>&nbsp;<span class="ident" id="6667980">TestMutexClose</span><span class="op" id="6667994">(</span><span class="ident" id="6667995">t</span>&nbsp;<span class="op" id="6667997">*</span><span class="ident" id="6667998">testing</span><span class="op" id="6668005">.</span><span class="ident" id="6668006">T</span><span class="op" id="6668007">)</span>&nbsp;<span class="op" id="6668009">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668012">var</span>&nbsp;<span class="ident" id="6668016">mu</span>&nbsp;<span class="ident" id="6668019">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668028">if</span>&nbsp;<span class="op" id="6668031">!</span><span class="ident" id="6668032">mu</span><span class="op" id="6668034">.</span><span class="ident" id="6668035">IncrefAndClose</span><span class="op" id="6668049">(</span><span class="op" id="6668050">)</span>&nbsp;<span class="op" id="6668052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668056">t</span><span class="op" id="6668057">.</span><span class="ident" id="6668058">Fatal</span><span class="op" id="6668063">(</span><span class="string" id="6668064">&#34;broken&#34;</span><span class="op" id="6668072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668079">if</span>&nbsp;<span class="ident" id="6668082">mu</span><span class="op" id="6668084">.</span><span class="ident" id="6668085">Incref</span><span class="op" id="6668091">(</span><span class="op" id="6668092">)</span>&nbsp;<span class="op" id="6668094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668098">t</span><span class="op" id="6668099">.</span><span class="ident" id="6668100">Fatal</span><span class="op" id="6668105">(</span><span class="string" id="6668106">&#34;broken&#34;</span><span class="op" id="6668114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668120">if</span>&nbsp;<span class="ident" id="6668123">mu</span><span class="op" id="6668125">.</span><span class="ident" id="6668126">RWLock</span><span class="op" id="6668132">(</span><span class="builtintype" id="6668133">true</span><span class="op" id="6668137">)</span>&nbsp;<span class="op" id="6668139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668143">t</span><span class="op" id="6668144">.</span><span class="ident" id="6668145">Fatal</span><span class="op" id="6668150">(</span><span class="string" id="6668151">&#34;broken&#34;</span><span class="op" id="6668159">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668165">if</span>&nbsp;<span class="ident" id="6668168">mu</span><span class="op" id="6668170">.</span><span class="ident" id="6668171">RWLock</span><span class="op" id="6668177">(</span><span class="builtintype" id="6668178">false</span><span class="op" id="6668183">)</span>&nbsp;<span class="op" id="6668185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668189">t</span><span class="op" id="6668190">.</span><span class="ident" id="6668191">Fatal</span><span class="op" id="6668196">(</span><span class="string" id="6668197">&#34;broken&#34;</span><span class="op" id="6668205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668211">if</span>&nbsp;<span class="ident" id="6668214">mu</span><span class="op" id="6668216">.</span><span class="ident" id="6668217">IncrefAndClose</span><span class="op" id="6668231">(</span><span class="op" id="6668232">)</span>&nbsp;<span class="op" id="6668234">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668238">t</span><span class="op" id="6668239">.</span><span class="ident" id="6668240">Fatal</span><span class="op" id="6668245">(</span><span class="string" id="6668246">&#34;broken&#34;</span><span class="op" id="6668254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668257">}</span><br>
<span class="lineno"></span><span class="op" id="6668259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6668262">func</span>&nbsp;<span class="ident" id="6668267">TestMutexCloseUnblock</span><span class="op" id="6668288">(</span><span class="ident" id="6668289">t</span>&nbsp;<span class="op" id="6668291">*</span><span class="ident" id="6668292">testing</span><span class="op" id="6668299">.</span><span class="ident" id="6668300">T</span><span class="op" id="6668301">)</span>&nbsp;<span class="op" id="6668303">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668306">c</span>&nbsp;<span class="op" id="6668308">:=</span>&nbsp;<span class="builtinfunc" id="6668311">make</span><span class="op" id="6668315">(</span><span class="keyword" id="6668316">chan</span>&nbsp;<span class="builtintype" id="6668321">bool</span><span class="op" id="6668325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668328">var</span>&nbsp;<span class="ident" id="6668332">mu</span>&nbsp;<span class="ident" id="6668335">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668344">mu</span><span class="op" id="6668346">.</span><span class="ident" id="6668347">RWLock</span><span class="op" id="6668353">(</span><span class="builtintype" id="6668354">true</span><span class="op" id="6668358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668361">for</span>&nbsp;<span class="ident" id="6668365">i</span>&nbsp;<span class="op" id="6668367">:=</span>&nbsp;<span class="num" id="6668370">0</span><span class="op" id="6668371">;</span>&nbsp;<span class="ident" id="6668373">i</span>&nbsp;<span class="op" id="6668375">&lt;</span>&nbsp;<span class="num" id="6668377">4</span><span class="op" id="6668378">;</span>&nbsp;<span class="ident" id="6668380">i</span><span class="op" id="6668381">++</span>&nbsp;<span class="op" id="6668384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668388">go</span>&nbsp;<span class="keyword" id="6668391">func</span><span class="op" id="6668395">(</span><span class="op" id="6668396">)</span>&nbsp;<span class="op" id="6668398">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668403">if</span>&nbsp;<span class="ident" id="6668406">mu</span><span class="op" id="6668408">.</span><span class="ident" id="6668409">RWLock</span><span class="op" id="6668415">(</span><span class="builtintype" id="6668416">true</span><span class="op" id="6668420">)</span>&nbsp;<span class="op" id="6668422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668428">t</span><span class="op" id="6668429">.</span><span class="ident" id="6668430">Error</span><span class="op" id="6668435">(</span><span class="string" id="6668436">&#34;broken&#34;</span><span class="op" id="6668444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668450">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668465">c</span>&nbsp;<span class="op" id="6668467">&lt;-</span>&nbsp;<span class="builtintype" id="6668470">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668477">}</span><span class="op" id="6668478">(</span><span class="op" id="6668479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6668485">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668552">time</span><span class="op" id="6668556">.</span><span class="ident" id="6668557">Sleep</span><span class="op" id="6668562">(</span><span class="ident" id="6668563">time</span><span class="op" id="6668567">.</span><span class="ident" id="6668568">Millisecond</span><span class="op" id="6668579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668582">select</span>&nbsp;<span class="op" id="6668589">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668592">case</span>&nbsp;<span class="op" id="6668597">&lt;-</span><span class="ident" id="6668599">c</span><span class="op" id="6668600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668604">t</span><span class="op" id="6668605">.</span><span class="ident" id="6668606">Fatal</span><span class="op" id="6668611">(</span><span class="string" id="6668612">&#34;broken&#34;</span><span class="op" id="6668620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668623">default</span><span class="op" id="6668630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668636">mu</span><span class="op" id="6668638">.</span><span class="ident" id="6668639">IncrefAndClose</span><span class="op" id="6668653">(</span><span class="op" id="6668654">)</span>&nbsp;<span class="comment" id="6668656">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668686">for</span>&nbsp;<span class="ident" id="6668690">i</span>&nbsp;<span class="op" id="6668692">:=</span>&nbsp;<span class="num" id="6668695">0</span><span class="op" id="6668696">;</span>&nbsp;<span class="ident" id="6668698">i</span>&nbsp;<span class="op" id="6668700">&lt;</span>&nbsp;<span class="num" id="6668702">4</span><span class="op" id="6668703">;</span>&nbsp;<span class="ident" id="6668705">i</span><span class="op" id="6668706">++</span>&nbsp;<span class="op" id="6668709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668713">select</span>&nbsp;<span class="op" id="6668720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668724">case</span>&nbsp;<span class="op" id="6668729">&lt;-</span><span class="ident" id="6668731">c</span><span class="op" id="6668732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668736">case</span>&nbsp;<span class="op" id="6668741">&lt;-</span><span class="ident" id="6668743">time</span><span class="op" id="6668747">.</span><span class="ident" id="6668748">After</span><span class="op" id="6668753">(</span><span class="num" id="6668754">10</span>&nbsp;<span class="op" id="6668757">*</span>&nbsp;<span class="ident" id="6668759">time</span><span class="op" id="6668763">.</span><span class="ident" id="6668764">Second</span><span class="op" id="6668770">)</span><span class="op" id="6668771">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668776">t</span><span class="op" id="6668777">.</span><span class="ident" id="6668778">Fatal</span><span class="op" id="6668783">(</span><span class="string" id="6668784">&#34;broken&#34;</span><span class="op" id="6668792">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668802">if</span>&nbsp;<span class="ident" id="6668805">mu</span><span class="op" id="6668807">.</span><span class="ident" id="6668808">Decref</span><span class="op" id="6668814">(</span><span class="op" id="6668815">)</span>&nbsp;<span class="op" id="6668817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668821">t</span><span class="op" id="6668822">.</span><span class="ident" id="6668823">Fatal</span><span class="op" id="6668828">(</span><span class="string" id="6668829">&#34;broken&#34;</span><span class="op" id="6668837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668840">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668843">if</span>&nbsp;<span class="op" id="6668846">!</span><span class="ident" id="6668847">mu</span><span class="op" id="6668849">.</span><span class="ident" id="6668850">RWUnlock</span><span class="op" id="6668858">(</span><span class="builtintype" id="6668859">true</span><span class="op" id="6668863">)</span>&nbsp;<span class="op" id="6668865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668869">t</span><span class="op" id="6668870">.</span><span class="ident" id="6668871">Fatal</span><span class="op" id="6668876">(</span><span class="string" id="6668877">&#34;broken&#34;</span><span class="op" id="6668885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6668888">}</span><br>
<span class="lineno"></span><span class="op" id="6668890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6668893">func</span>&nbsp;<span class="ident" id="6668898">TestMutexPanic</span><span class="op" id="6668912">(</span><span class="ident" id="6668913">t</span>&nbsp;<span class="op" id="6668915">*</span><span class="ident" id="6668916">testing</span><span class="op" id="6668923">.</span><span class="ident" id="6668924">T</span><span class="op" id="6668925">)</span>&nbsp;<span class="op" id="6668927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6668930">ensurePanics</span>&nbsp;<span class="op" id="6668943">:=</span>&nbsp;<span class="keyword" id="6668946">func</span><span class="op" id="6668950">(</span><span class="ident" id="6668951">f</span>&nbsp;<span class="keyword" id="6668953">func</span><span class="op" id="6668957">(</span><span class="op" id="6668958">)</span><span class="op" id="6668959">)</span>&nbsp;<span class="op" id="6668961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668965">defer</span>&nbsp;<span class="keyword" id="6668971">func</span><span class="op" id="6668975">(</span><span class="op" id="6668976">)</span>&nbsp;<span class="op" id="6668978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6668983">if</span>&nbsp;<span class="builtinfunc" id="6668986">recover</span><span class="op" id="6668993">(</span><span class="op" id="6668994">)</span>&nbsp;<span class="op" id="6668996">==</span>&nbsp;<span class="builtintype" id="6668999">nil</span>&nbsp;<span class="op" id="6669003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669009">t</span><span class="op" id="6669010">.</span><span class="ident" id="6669011">Fatal</span><span class="op" id="6669016">(</span><span class="string" id="6669017">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="6669033">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6669038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6669042">}</span><span class="op" id="6669043">(</span><span class="op" id="6669044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669048">f</span><span class="op" id="6669049">(</span><span class="op" id="6669050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6669053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6669057">var</span>&nbsp;<span class="ident" id="6669061">mu</span>&nbsp;<span class="ident" id="6669064">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669073">ensurePanics</span><span class="op" id="6669085">(</span><span class="keyword" id="6669086">func</span><span class="op" id="6669090">(</span><span class="op" id="6669091">)</span>&nbsp;<span class="op" id="6669093">{</span>&nbsp;<span class="ident" id="6669095">mu</span><span class="op" id="6669097">.</span><span class="ident" id="6669098">Decref</span><span class="op" id="6669104">(</span><span class="op" id="6669105">)</span>&nbsp;<span class="op" id="6669107">}</span><span class="op" id="6669108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669111">ensurePanics</span><span class="op" id="6669123">(</span><span class="keyword" id="6669124">func</span><span class="op" id="6669128">(</span><span class="op" id="6669129">)</span>&nbsp;<span class="op" id="6669131">{</span>&nbsp;<span class="ident" id="6669133">mu</span><span class="op" id="6669135">.</span><span class="ident" id="6669136">RWUnlock</span><span class="op" id="6669144">(</span><span class="builtintype" id="6669145">true</span><span class="op" id="6669149">)</span>&nbsp;<span class="op" id="6669151">}</span><span class="op" id="6669152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669155">ensurePanics</span><span class="op" id="6669167">(</span><span class="keyword" id="6669168">func</span><span class="op" id="6669172">(</span><span class="op" id="6669173">)</span>&nbsp;<span class="op" id="6669175">{</span>&nbsp;<span class="ident" id="6669177">mu</span><span class="op" id="6669179">.</span><span class="ident" id="6669180">RWUnlock</span><span class="op" id="6669188">(</span><span class="builtintype" id="6669189">false</span><span class="op" id="6669194">)</span>&nbsp;<span class="op" id="6669196">}</span><span class="op" id="6669197">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669201">ensurePanics</span><span class="op" id="6669213">(</span><span class="keyword" id="6669214">func</span><span class="op" id="6669218">(</span><span class="op" id="6669219">)</span>&nbsp;<span class="op" id="6669221">{</span>&nbsp;<span class="ident" id="6669223">mu</span><span class="op" id="6669225">.</span><span class="ident" id="6669226">Incref</span><span class="op" id="6669232">(</span><span class="op" id="6669233">)</span><span class="op" id="6669234">;</span>&nbsp;<span class="ident" id="6669236">mu</span><span class="op" id="6669238">.</span><span class="ident" id="6669239">Decref</span><span class="op" id="6669245">(</span><span class="op" id="6669246">)</span><span class="op" id="6669247">;</span>&nbsp;<span class="ident" id="6669249">mu</span><span class="op" id="6669251">.</span><span class="ident" id="6669252">Decref</span><span class="op" id="6669258">(</span><span class="op" id="6669259">)</span>&nbsp;<span class="op" id="6669261">}</span><span class="op" id="6669262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669265">ensurePanics</span><span class="op" id="6669277">(</span><span class="keyword" id="6669278">func</span><span class="op" id="6669282">(</span><span class="op" id="6669283">)</span>&nbsp;<span class="op" id="6669285">{</span>&nbsp;<span class="ident" id="6669287">mu</span><span class="op" id="6669289">.</span><span class="ident" id="6669290">RWLock</span><span class="op" id="6669296">(</span><span class="builtintype" id="6669297">true</span><span class="op" id="6669301">)</span><span class="op" id="6669302">;</span>&nbsp;<span class="ident" id="6669304">mu</span><span class="op" id="6669306">.</span><span class="ident" id="6669307">RWUnlock</span><span class="op" id="6669315">(</span><span class="builtintype" id="6669316">true</span><span class="op" id="6669320">)</span><span class="op" id="6669321">;</span>&nbsp;<span class="ident" id="6669323">mu</span><span class="op" id="6669325">.</span><span class="ident" id="6669326">RWUnlock</span><span class="op" id="6669334">(</span><span class="builtintype" id="6669335">true</span><span class="op" id="6669339">)</span>&nbsp;<span class="op" id="6669341">}</span><span class="op" id="6669342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669345">ensurePanics</span><span class="op" id="6669357">(</span><span class="keyword" id="6669358">func</span><span class="op" id="6669362">(</span><span class="op" id="6669363">)</span>&nbsp;<span class="op" id="6669365">{</span>&nbsp;<span class="ident" id="6669367">mu</span><span class="op" id="6669369">.</span><span class="ident" id="6669370">RWLock</span><span class="op" id="6669376">(</span><span class="builtintype" id="6669377">false</span><span class="op" id="6669382">)</span><span class="op" id="6669383">;</span>&nbsp;<span class="ident" id="6669385">mu</span><span class="op" id="6669387">.</span><span class="ident" id="6669388">RWUnlock</span><span class="op" id="6669396">(</span><span class="builtintype" id="6669397">false</span><span class="op" id="6669402">)</span><span class="op" id="6669403">;</span>&nbsp;<span class="ident" id="6669405">mu</span><span class="op" id="6669407">.</span><span class="ident" id="6669408">RWUnlock</span><span class="op" id="6669416">(</span><span class="builtintype" id="6669417">false</span><span class="op" id="6669422">)</span>&nbsp;<span class="op" id="6669424">}</span><span class="op" id="6669425">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6669429">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669467">mu</span><span class="op" id="6669469">.</span><span class="ident" id="6669470">Incref</span><span class="op" id="6669476">(</span><span class="op" id="6669477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669480">mu</span><span class="op" id="6669482">.</span><span class="ident" id="6669483">Decref</span><span class="op" id="6669489">(</span><span class="op" id="6669490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669493">mu</span><span class="op" id="6669495">.</span><span class="ident" id="6669496">RWLock</span><span class="op" id="6669502">(</span><span class="builtintype" id="6669503">true</span><span class="op" id="6669507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669510">mu</span><span class="op" id="6669512">.</span><span class="ident" id="6669513">RWUnlock</span><span class="op" id="6669521">(</span><span class="builtintype" id="6669522">true</span><span class="op" id="6669526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669529">mu</span><span class="op" id="6669531">.</span><span class="ident" id="6669532">RWLock</span><span class="op" id="6669538">(</span><span class="builtintype" id="6669539">false</span><span class="op" id="6669544">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669547">mu</span><span class="op" id="6669549">.</span><span class="ident" id="6669550">RWUnlock</span><span class="op" id="6669558">(</span><span class="builtintype" id="6669559">false</span><span class="op" id="6669564">)</span><br>
<span class="lineno"></span><span class="op" id="6669566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6669569">func</span>&nbsp;<span class="ident" id="6669574">TestMutexStress</span><span class="op" id="6669589">(</span><span class="ident" id="6669590">t</span>&nbsp;<span class="op" id="6669592">*</span><span class="ident" id="6669593">testing</span><span class="op" id="6669600">.</span><span class="ident" id="6669601">T</span><span class="op" id="6669602">)</span>&nbsp;<span class="op" id="6669604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669607">P</span>&nbsp;<span class="op" id="6669609">:=</span>&nbsp;<span class="num" id="6669612">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669615">N</span>&nbsp;<span class="op" id="6669617">:=</span>&nbsp;<span class="builtintype" id="6669620">int</span><span class="op" id="6669623">(</span><span class="num" id="6669624">1e6</span><span class="op" id="6669627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6669630">if</span>&nbsp;<span class="ident" id="6669633">testing</span><span class="op" id="6669640">.</span><span class="ident" id="6669641">Short</span><span class="op" id="6669646">(</span><span class="op" id="6669647">)</span>&nbsp;<span class="op" id="6669649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669653">P</span>&nbsp;<span class="op" id="6669655">=</span>&nbsp;<span class="num" id="6669657">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669661">N</span>&nbsp;<span class="op" id="6669663">=</span>&nbsp;<span class="num" id="6669665">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6669670">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6669673">defer</span>&nbsp;<span class="ident" id="6669679">runtime</span><span class="op" id="6669686">.</span><span class="ident" id="6669687">GOMAXPROCS</span><span class="op" id="6669697">(</span><span class="ident" id="6669698">runtime</span><span class="op" id="6669705">.</span><span class="ident" id="6669706">GOMAXPROCS</span><span class="op" id="6669716">(</span><span class="ident" id="6669717">P</span><span class="op" id="6669718">)</span><span class="op" id="6669719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669722">done</span>&nbsp;<span class="op" id="6669727">:=</span>&nbsp;<span class="builtinfunc" id="6669730">make</span><span class="op" id="6669734">(</span><span class="keyword" id="6669735">chan</span>&nbsp;<span class="builtintype" id="6669740">bool</span><span class="op" id="6669744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6669747">var</span>&nbsp;<span class="ident" id="6669751">mu</span>&nbsp;<span class="ident" id="6669754">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6669763">var</span>&nbsp;<span class="ident" id="6669767">readState</span>&nbsp;<span class="op" id="6669777">[</span><span class="num" id="6669778">2</span><span class="op" id="6669779">]</span><span class="ident" id="6669780">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6669788">var</span>&nbsp;<span class="ident" id="6669792">writeState</span>&nbsp;<span class="op" id="6669803">[</span><span class="num" id="6669804">2</span><span class="op" id="6669805">]</span><span class="ident" id="6669806">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6669814">for</span>&nbsp;<span class="ident" id="6669818">p</span>&nbsp;<span class="op" id="6669820">:=</span>&nbsp;<span class="num" id="6669823">0</span><span class="op" id="6669824">;</span>&nbsp;<span class="ident" id="6669826">p</span>&nbsp;<span class="op" id="6669828">&lt;</span>&nbsp;<span class="ident" id="6669830">P</span><span class="op" id="6669831">;</span>&nbsp;<span class="ident" id="6669833">p</span><span class="op" id="6669834">++</span>&nbsp;<span class="op" id="6669837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6669841">go</span>&nbsp;<span class="keyword" id="6669844">func</span><span class="op" id="6669848">(</span><span class="op" id="6669849">)</span>&nbsp;<span class="op" id="6669851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669856">r</span>&nbsp;<span class="op" id="6669858">:=</span>&nbsp;<span class="ident" id="6669861">rand</span><span class="op" id="6669865">.</span><span class="ident" id="6669866">New</span><span class="op" id="6669869">(</span><span class="ident" id="6669870">rand</span><span class="op" id="6669874">.</span><span class="ident" id="6669875">NewSource</span><span class="op" id="6669884">(</span><span class="ident" id="6669885">rand</span><span class="op" id="6669889">.</span><span class="ident" id="6669890">Int63</span><span class="op" id="6669895">(</span><span class="op" id="6669896">)</span><span class="op" id="6669897">)</span><span class="op" id="6669898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6669903">for</span>&nbsp;<span class="ident" id="6669907">i</span>&nbsp;<span class="op" id="6669909">:=</span>&nbsp;<span class="num" id="6669912">0</span><span class="op" id="6669913">;</span>&nbsp;<span class="ident" id="6669915">i</span>&nbsp;<span class="op" id="6669917">&lt;</span>&nbsp;<span class="ident" id="6669919">N</span><span class="op" id="6669920">;</span>&nbsp;<span class="ident" id="6669922">i</span><span class="op" id="6669923">++</span>&nbsp;<span class="op" id="6669926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6669932">switch</span>&nbsp;<span class="ident" id="6669939">r</span><span class="op" id="6669940">.</span><span class="ident" id="6669941">Intn</span><span class="op" id="6669945">(</span><span class="num" id="6669946">3</span><span class="op" id="6669947">)</span>&nbsp;<span class="op" id="6669949">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6669955">case</span>&nbsp;<span class="num" id="6669960">0</span><span class="op" id="6669961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6669968">if</span>&nbsp;<span class="op" id="6669971">!</span><span class="ident" id="6669972">mu</span><span class="op" id="6669974">.</span><span class="ident" id="6669975">Incref</span><span class="op" id="6669981">(</span><span class="op" id="6669982">)</span>&nbsp;<span class="op" id="6669984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6669992">t</span><span class="op" id="6669993">.</span><span class="ident" id="6669994">Error</span><span class="op" id="6669999">(</span><span class="string" id="6670000">&#34;broken&#34;</span><span class="op" id="6670008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670016">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670028">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670035">if</span>&nbsp;<span class="ident" id="6670038">mu</span><span class="op" id="6670040">.</span><span class="ident" id="6670041">Decref</span><span class="op" id="6670047">(</span><span class="op" id="6670048">)</span>&nbsp;<span class="op" id="6670050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670058">t</span><span class="op" id="6670059">.</span><span class="ident" id="6670060">Error</span><span class="op" id="6670065">(</span><span class="string" id="6670066">&#34;broken&#34;</span><span class="op" id="6670074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670082">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670100">case</span>&nbsp;<span class="num" id="6670105">1</span><span class="op" id="6670106">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670113">if</span>&nbsp;<span class="op" id="6670116">!</span><span class="ident" id="6670117">mu</span><span class="op" id="6670119">.</span><span class="ident" id="6670120">RWLock</span><span class="op" id="6670126">(</span><span class="builtintype" id="6670127">true</span><span class="op" id="6670131">)</span>&nbsp;<span class="op" id="6670133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670141">t</span><span class="op" id="6670142">.</span><span class="ident" id="6670143">Error</span><span class="op" id="6670148">(</span><span class="string" id="6670149">&#34;broken&#34;</span><span class="op" id="6670157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670165">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6670184">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670246">if</span>&nbsp;<span class="ident" id="6670249">readState</span><span class="op" id="6670258">[</span><span class="num" id="6670259">0</span><span class="op" id="6670260">]</span>&nbsp;<span class="op" id="6670262">!=</span>&nbsp;<span class="ident" id="6670265">readState</span><span class="op" id="6670274">[</span><span class="num" id="6670275">1</span><span class="op" id="6670276">]</span>&nbsp;<span class="op" id="6670278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670286">t</span><span class="op" id="6670287">.</span><span class="ident" id="6670288">Error</span><span class="op" id="6670293">(</span><span class="string" id="6670294">&#34;broken&#34;</span><span class="op" id="6670302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670310">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670329">readState</span><span class="op" id="6670338">[</span><span class="num" id="6670339">0</span><span class="op" id="6670340">]</span><span class="op" id="6670341">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670349">readState</span><span class="op" id="6670358">[</span><span class="num" id="6670359">1</span><span class="op" id="6670360">]</span><span class="op" id="6670361">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670369">if</span>&nbsp;<span class="ident" id="6670372">mu</span><span class="op" id="6670374">.</span><span class="ident" id="6670375">RWUnlock</span><span class="op" id="6670383">(</span><span class="builtintype" id="6670384">true</span><span class="op" id="6670388">)</span>&nbsp;<span class="op" id="6670390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670398">t</span><span class="op" id="6670399">.</span><span class="ident" id="6670400">Error</span><span class="op" id="6670405">(</span><span class="string" id="6670406">&#34;broken&#34;</span><span class="op" id="6670414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670422">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670434">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670440">case</span>&nbsp;<span class="num" id="6670445">2</span><span class="op" id="6670446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670453">if</span>&nbsp;<span class="op" id="6670456">!</span><span class="ident" id="6670457">mu</span><span class="op" id="6670459">.</span><span class="ident" id="6670460">RWLock</span><span class="op" id="6670466">(</span><span class="builtintype" id="6670467">false</span><span class="op" id="6670472">)</span>&nbsp;<span class="op" id="6670474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670482">t</span><span class="op" id="6670483">.</span><span class="ident" id="6670484">Error</span><span class="op" id="6670489">(</span><span class="string" id="6670490">&#34;broken&#34;</span><span class="op" id="6670498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670506">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670518">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6670525">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670587">if</span>&nbsp;<span class="ident" id="6670590">writeState</span><span class="op" id="6670600">[</span><span class="num" id="6670601">0</span><span class="op" id="6670602">]</span>&nbsp;<span class="op" id="6670604">!=</span>&nbsp;<span class="ident" id="6670607">writeState</span><span class="op" id="6670617">[</span><span class="num" id="6670618">1</span><span class="op" id="6670619">]</span>&nbsp;<span class="op" id="6670621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670629">t</span><span class="op" id="6670630">.</span><span class="ident" id="6670631">Error</span><span class="op" id="6670636">(</span><span class="string" id="6670637">&#34;broken&#34;</span><span class="op" id="6670645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670653">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670665">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670672">writeState</span><span class="op" id="6670682">[</span><span class="num" id="6670683">0</span><span class="op" id="6670684">]</span><span class="op" id="6670685">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670693">writeState</span><span class="op" id="6670703">[</span><span class="num" id="6670704">1</span><span class="op" id="6670705">]</span><span class="op" id="6670706">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670714">if</span>&nbsp;<span class="ident" id="6670717">mu</span><span class="op" id="6670719">.</span><span class="ident" id="6670720">RWUnlock</span><span class="op" id="6670728">(</span><span class="builtintype" id="6670729">false</span><span class="op" id="6670734">)</span>&nbsp;<span class="op" id="6670736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670744">t</span><span class="op" id="6670745">.</span><span class="ident" id="6670746">Error</span><span class="op" id="6670751">(</span><span class="string" id="6670752">&#34;broken&#34;</span><span class="op" id="6670760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670768">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670796">done</span>&nbsp;<span class="op" id="6670801">&lt;-</span>&nbsp;<span class="builtintype" id="6670804">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670811">}</span><span class="op" id="6670812">(</span><span class="op" id="6670813">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670819">for</span>&nbsp;<span class="ident" id="6670823">p</span>&nbsp;<span class="op" id="6670825">:=</span>&nbsp;<span class="num" id="6670828">0</span><span class="op" id="6670829">;</span>&nbsp;<span class="ident" id="6670831">p</span>&nbsp;<span class="op" id="6670833">&lt;</span>&nbsp;<span class="ident" id="6670835">P</span><span class="op" id="6670836">;</span>&nbsp;<span class="ident" id="6670838">p</span><span class="op" id="6670839">++</span>&nbsp;<span class="op" id="6670842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670846">&lt;-</span><span class="ident" id="6670848">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670857">if</span>&nbsp;<span class="op" id="6670860">!</span><span class="ident" id="6670861">mu</span><span class="op" id="6670863">.</span><span class="ident" id="6670864">IncrefAndClose</span><span class="op" id="6670878">(</span><span class="op" id="6670879">)</span>&nbsp;<span class="op" id="6670881">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670885">t</span><span class="op" id="6670886">.</span><span class="ident" id="6670887">Fatal</span><span class="op" id="6670892">(</span><span class="string" id="6670893">&#34;broken&#34;</span><span class="op" id="6670901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6670907">if</span>&nbsp;<span class="op" id="6670910">!</span><span class="ident" id="6670911">mu</span><span class="op" id="6670913">.</span><span class="ident" id="6670914">Decref</span><span class="op" id="6670920">(</span><span class="op" id="6670921">)</span>&nbsp;<span class="op" id="6670923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6670927">t</span><span class="op" id="6670928">.</span><span class="ident" id="6670929">Fatal</span><span class="op" id="6670934">(</span><span class="string" id="6670935">&#34;broken&#34;</span><span class="op" id="6670943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6670946">}</span><br>
<span class="lineno">195</span><span class="op" id="6670948">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
