<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3420915">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3420971">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3421025">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3421076">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3421154">package</span>&nbsp;<span class="ident" id="3421162">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3421167">import</span>&nbsp;<span class="op" id="3421174">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3421177">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3421187">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3421193">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3421204">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3421211">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3421214">func</span>&nbsp;<span class="ident" id="3421219">unixSocket</span><span class="op" id="3421229">(</span><span class="ident" id="3421230">net</span>&nbsp;<span class="builtintype" id="3421234">string</span><span class="op" id="3421240">,</span>&nbsp;<span class="ident" id="3421242">laddr</span><span class="op" id="3421247">,</span>&nbsp;<span class="ident" id="3421249">raddr</span>&nbsp;<span class="ident" id="3421255">sockaddr</span><span class="op" id="3421263">,</span>&nbsp;<span class="ident" id="3421265">mode</span>&nbsp;<span class="builtintype" id="3421270">string</span><span class="op" id="3421276">,</span>&nbsp;<span class="ident" id="3421278">deadline</span>&nbsp;<span class="ident" id="3421287">time</span><span class="op" id="3421291">.</span><span class="ident" id="3421292">Time</span><span class="op" id="3421296">)</span>&nbsp;<span class="op" id="3421298">(</span><span class="op" id="3421299">*</span><span class="ident" id="3421300">netFD</span><span class="op" id="3421305">,</span>&nbsp;<span class="builtintype" id="3421307">error</span><span class="op" id="3421312">)</span>&nbsp;<span class="op" id="3421314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421317">var</span>&nbsp;<span class="ident" id="3421321">sotype</span>&nbsp;<span class="builtintype" id="3421328">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421333">switch</span>&nbsp;<span class="ident" id="3421340">net</span>&nbsp;<span class="op" id="3421344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421347">case</span>&nbsp;<span class="string" id="3421352">&#34;unix&#34;</span><span class="op" id="3421358">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421362">sotype</span>&nbsp;<span class="op" id="3421369">=</span>&nbsp;<span class="ident" id="3421371">syscall</span><span class="op" id="3421378">.</span><span class="ident" id="3421379">SOCK_STREAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421392">case</span>&nbsp;<span class="string" id="3421397">&#34;unixgram&#34;</span><span class="op" id="3421407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421411">sotype</span>&nbsp;<span class="op" id="3421418">=</span>&nbsp;<span class="ident" id="3421420">syscall</span><span class="op" id="3421427">.</span><span class="ident" id="3421428">SOCK_DGRAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421440">case</span>&nbsp;<span class="string" id="3421445">&#34;unixpacket&#34;</span><span class="op" id="3421457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421461">sotype</span>&nbsp;<span class="op" id="3421468">=</span>&nbsp;<span class="ident" id="3421470">syscall</span><span class="op" id="3421477">.</span><span class="ident" id="3421478">SOCK_SEQPACKET</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421494">default</span><span class="op" id="3421501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421505">return</span>&nbsp;<span class="ident" id="3421512">nil</span><span class="op" id="3421515">,</span>&nbsp;<span class="ident" id="3421517">UnknownNetworkError</span><span class="op" id="3421536">(</span><span class="ident" id="3421537">net</span><span class="op" id="3421540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421547">switch</span>&nbsp;<span class="ident" id="3421554">mode</span>&nbsp;<span class="op" id="3421559">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421562">case</span>&nbsp;<span class="string" id="3421567">&#34;dial&#34;</span><span class="op" id="3421573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421577">if</span>&nbsp;<span class="ident" id="3421580">laddr</span>&nbsp;<span class="op" id="3421586">!=</span>&nbsp;<span class="ident" id="3421589">nil</span>&nbsp;<span class="op" id="3421593">&amp;&amp;</span>&nbsp;<span class="ident" id="3421596">laddr</span><span class="op" id="3421601">.</span><span class="ident" id="3421602">isWildcard</span><span class="op" id="3421612">(</span><span class="op" id="3421613">)</span>&nbsp;<span class="op" id="3421615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421620">laddr</span>&nbsp;<span class="op" id="3421626">=</span>&nbsp;<span class="ident" id="3421628">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421638">if</span>&nbsp;<span class="ident" id="3421641">raddr</span>&nbsp;<span class="op" id="3421647">!=</span>&nbsp;<span class="ident" id="3421650">nil</span>&nbsp;<span class="op" id="3421654">&amp;&amp;</span>&nbsp;<span class="ident" id="3421657">raddr</span><span class="op" id="3421662">.</span><span class="ident" id="3421663">isWildcard</span><span class="op" id="3421673">(</span><span class="op" id="3421674">)</span>&nbsp;<span class="op" id="3421676">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421681">raddr</span>&nbsp;<span class="op" id="3421687">=</span>&nbsp;<span class="ident" id="3421689">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421699">if</span>&nbsp;<span class="ident" id="3421702">raddr</span>&nbsp;<span class="op" id="3421708">==</span>&nbsp;<span class="ident" id="3421711">nil</span>&nbsp;<span class="op" id="3421715">&amp;&amp;</span>&nbsp;<span class="op" id="3421718">(</span><span class="ident" id="3421719">sotype</span>&nbsp;<span class="op" id="3421726">!=</span>&nbsp;<span class="ident" id="3421729">syscall</span><span class="op" id="3421736">.</span><span class="ident" id="3421737">SOCK_DGRAM</span>&nbsp;<span class="op" id="3421748">||</span>&nbsp;<span class="ident" id="3421751">laddr</span>&nbsp;<span class="op" id="3421757">==</span>&nbsp;<span class="ident" id="3421760">nil</span><span class="op" id="3421763">)</span>&nbsp;<span class="op" id="3421765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421770">return</span>&nbsp;<span class="ident" id="3421777">nil</span><span class="op" id="3421780">,</span>&nbsp;<span class="ident" id="3421782">errMissingAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421802">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421805">case</span>&nbsp;<span class="string" id="3421810">&#34;listen&#34;</span><span class="op" id="3421818">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421821">default</span><span class="op" id="3421828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421832">return</span>&nbsp;<span class="ident" id="3421839">nil</span><span class="op" id="3421842">,</span>&nbsp;<span class="ident" id="3421844">errors</span><span class="op" id="3421850">.</span><span class="ident" id="3421851">New</span><span class="op" id="3421854">(</span><span class="string" id="3421855">&#34;unknown&nbsp;mode:&nbsp;&#34;</span>&nbsp;<span class="op" id="3421872">+</span>&nbsp;<span class="ident" id="3421874">mode</span><span class="op" id="3421878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421885">fd</span><span class="op" id="3421887">,</span>&nbsp;<span class="ident" id="3421889">err</span>&nbsp;<span class="op" id="3421893">:=</span>&nbsp;<span class="ident" id="3421896">socket</span><span class="op" id="3421902">(</span><span class="ident" id="3421903">net</span><span class="op" id="3421906">,</span>&nbsp;<span class="ident" id="3421908">syscall</span><span class="op" id="3421915">.</span><span class="ident" id="3421916">AF_UNIX</span><span class="op" id="3421923">,</span>&nbsp;<span class="ident" id="3421925">sotype</span><span class="op" id="3421931">,</span>&nbsp;<span class="num" id="3421933">0</span><span class="op" id="3421934">,</span>&nbsp;<span class="builtintype" id="3421936">false</span><span class="op" id="3421941">,</span>&nbsp;<span class="ident" id="3421943">laddr</span><span class="op" id="3421948">,</span>&nbsp;<span class="ident" id="3421950">raddr</span><span class="op" id="3421955">,</span>&nbsp;<span class="ident" id="3421957">deadline</span><span class="op" id="3421965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421968">if</span>&nbsp;<span class="ident" id="3421971">err</span>&nbsp;<span class="op" id="3421975">!=</span>&nbsp;<span class="ident" id="3421978">nil</span>&nbsp;<span class="op" id="3421982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421986">return</span>&nbsp;<span class="ident" id="3421993">nil</span><span class="op" id="3421996">,</span>&nbsp;<span class="ident" id="3421998">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422006">return</span>&nbsp;<span class="ident" id="3422013">fd</span><span class="op" id="3422015">,</span>&nbsp;<span class="ident" id="3422017">nil</span><br>
<span class="lineno">50</span><span class="op" id="3422021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3422024">func</span>&nbsp;<span class="ident" id="3422029">sockaddrToUnix</span><span class="op" id="3422043">(</span><span class="ident" id="3422044">sa</span>&nbsp;<span class="ident" id="3422047">syscall</span><span class="op" id="3422054">.</span><span class="ident" id="3422055">Sockaddr</span><span class="op" id="3422063">)</span>&nbsp;<span class="ident" id="3422065">Addr</span>&nbsp;<span class="op" id="3422070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422073">if</span>&nbsp;<span class="ident" id="3422076">s</span><span class="op" id="3422077">,</span>&nbsp;<span class="ident" id="3422079">ok</span>&nbsp;<span class="op" id="3422082">:=</span>&nbsp;<span class="ident" id="3422085">sa</span><span class="op" id="3422087">.</span><span class="op" id="3422088">(</span><span class="op" id="3422089">*</span><span class="ident" id="3422090">syscall</span><span class="op" id="3422097">.</span><span class="ident" id="3422098">SockaddrUnix</span><span class="op" id="3422110">)</span><span class="op" id="3422111">;</span>&nbsp;<span class="ident" id="3422113">ok</span>&nbsp;<span class="op" id="3422116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422120">return</span>&nbsp;<span class="op" id="3422127">&amp;</span><span class="ident" id="3422128">UnixAddr</span><span class="op" id="3422136">{</span><span class="ident" id="3422137">Name</span><span class="op" id="3422141">:</span>&nbsp;<span class="ident" id="3422143">s</span><span class="op" id="3422144">.</span><span class="ident" id="3422145">Name</span><span class="op" id="3422149">,</span>&nbsp;<span class="ident" id="3422151">Net</span><span class="op" id="3422154">:</span>&nbsp;<span class="string" id="3422156">&#34;unix&#34;</span><span class="op" id="3422162">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422168">return</span>&nbsp;<span class="ident" id="3422175">nil</span><br>
<span class="lineno"></span><span class="op" id="3422179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3422182">func</span>&nbsp;<span class="ident" id="3422187">sockaddrToUnixgram</span><span class="op" id="3422205">(</span><span class="ident" id="3422206">sa</span>&nbsp;<span class="ident" id="3422209">syscall</span><span class="op" id="3422216">.</span><span class="ident" id="3422217">Sockaddr</span><span class="op" id="3422225">)</span>&nbsp;<span class="ident" id="3422227">Addr</span>&nbsp;<span class="op" id="3422232">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422235">if</span>&nbsp;<span class="ident" id="3422238">s</span><span class="op" id="3422239">,</span>&nbsp;<span class="ident" id="3422241">ok</span>&nbsp;<span class="op" id="3422244">:=</span>&nbsp;<span class="ident" id="3422247">sa</span><span class="op" id="3422249">.</span><span class="op" id="3422250">(</span><span class="op" id="3422251">*</span><span class="ident" id="3422252">syscall</span><span class="op" id="3422259">.</span><span class="ident" id="3422260">SockaddrUnix</span><span class="op" id="3422272">)</span><span class="op" id="3422273">;</span>&nbsp;<span class="ident" id="3422275">ok</span>&nbsp;<span class="op" id="3422278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422282">return</span>&nbsp;<span class="op" id="3422289">&amp;</span><span class="ident" id="3422290">UnixAddr</span><span class="op" id="3422298">{</span><span class="ident" id="3422299">Name</span><span class="op" id="3422303">:</span>&nbsp;<span class="ident" id="3422305">s</span><span class="op" id="3422306">.</span><span class="ident" id="3422307">Name</span><span class="op" id="3422311">,</span>&nbsp;<span class="ident" id="3422313">Net</span><span class="op" id="3422316">:</span>&nbsp;<span class="string" id="3422318">&#34;unixgram&#34;</span><span class="op" id="3422328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422334">return</span>&nbsp;<span class="ident" id="3422341">nil</span><br>
<span class="lineno"></span><span class="op" id="3422345">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3422348">func</span>&nbsp;<span class="ident" id="3422353">sockaddrToUnixpacket</span><span class="op" id="3422373">(</span><span class="ident" id="3422374">sa</span>&nbsp;<span class="ident" id="3422377">syscall</span><span class="op" id="3422384">.</span><span class="ident" id="3422385">Sockaddr</span><span class="op" id="3422393">)</span>&nbsp;<span class="ident" id="3422395">Addr</span>&nbsp;<span class="op" id="3422400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422403">if</span>&nbsp;<span class="ident" id="3422406">s</span><span class="op" id="3422407">,</span>&nbsp;<span class="ident" id="3422409">ok</span>&nbsp;<span class="op" id="3422412">:=</span>&nbsp;<span class="ident" id="3422415">sa</span><span class="op" id="3422417">.</span><span class="op" id="3422418">(</span><span class="op" id="3422419">*</span><span class="ident" id="3422420">syscall</span><span class="op" id="3422427">.</span><span class="ident" id="3422428">SockaddrUnix</span><span class="op" id="3422440">)</span><span class="op" id="3422441">;</span>&nbsp;<span class="ident" id="3422443">ok</span>&nbsp;<span class="op" id="3422446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422450">return</span>&nbsp;<span class="op" id="3422457">&amp;</span><span class="ident" id="3422458">UnixAddr</span><span class="op" id="3422466">{</span><span class="ident" id="3422467">Name</span><span class="op" id="3422471">:</span>&nbsp;<span class="ident" id="3422473">s</span><span class="op" id="3422474">.</span><span class="ident" id="3422475">Name</span><span class="op" id="3422479">,</span>&nbsp;<span class="ident" id="3422481">Net</span><span class="op" id="3422484">:</span>&nbsp;<span class="string" id="3422486">&#34;unixpacket&#34;</span><span class="op" id="3422498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422501">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422504">return</span>&nbsp;<span class="ident" id="3422511">nil</span><br>
<span class="lineno"></span><span class="op" id="3422515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3422518">func</span>&nbsp;<span class="ident" id="3422523">sotypeToNet</span><span class="op" id="3422534">(</span><span class="ident" id="3422535">sotype</span>&nbsp;<span class="builtintype" id="3422542">int</span><span class="op" id="3422545">)</span>&nbsp;<span class="builtintype" id="3422547">string</span>&nbsp;<span class="op" id="3422554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422557">switch</span>&nbsp;<span class="ident" id="3422564">sotype</span>&nbsp;<span class="op" id="3422571">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422574">case</span>&nbsp;<span class="ident" id="3422579">syscall</span><span class="op" id="3422586">.</span><span class="ident" id="3422587">SOCK_STREAM</span><span class="op" id="3422598">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422602">return</span>&nbsp;<span class="string" id="3422609">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422617">case</span>&nbsp;<span class="ident" id="3422622">syscall</span><span class="op" id="3422629">.</span><span class="ident" id="3422630">SOCK_DGRAM</span><span class="op" id="3422640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422644">return</span>&nbsp;<span class="string" id="3422651">&#34;unixgram&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422663">case</span>&nbsp;<span class="ident" id="3422668">syscall</span><span class="op" id="3422675">.</span><span class="ident" id="3422676">SOCK_SEQPACKET</span><span class="op" id="3422690">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422694">return</span>&nbsp;<span class="string" id="3422701">&#34;unixpacket&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422715">default</span><span class="op" id="3422722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3422726">panic</span><span class="op" id="3422731">(</span><span class="string" id="3422732">&#34;sotypeToNet&nbsp;unknown&nbsp;socket&nbsp;type&#34;</span><span class="op" id="3422765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422768">}</span><br>
<span class="lineno"></span><span class="op" id="3422770">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3422773">func</span>&nbsp;<span class="op" id="3422778">(</span><span class="ident" id="3422779">a</span>&nbsp;<span class="op" id="3422781">*</span><span class="ident" id="3422782">UnixAddr</span><span class="op" id="3422790">)</span>&nbsp;<span class="ident" id="3422792">family</span><span class="op" id="3422798">(</span><span class="op" id="3422799">)</span>&nbsp;<span class="builtintype" id="3422801">int</span>&nbsp;<span class="op" id="3422805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422808">return</span>&nbsp;<span class="ident" id="3422815">syscall</span><span class="op" id="3422822">.</span><span class="ident" id="3422823">AF_UNIX</span><br>
<span class="lineno"></span><span class="op" id="3422831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3422834">func</span>&nbsp;<span class="op" id="3422839">(</span><span class="ident" id="3422840">a</span>&nbsp;<span class="op" id="3422842">*</span><span class="ident" id="3422843">UnixAddr</span><span class="op" id="3422851">)</span>&nbsp;<span class="ident" id="3422853">isWildcard</span><span class="op" id="3422863">(</span><span class="op" id="3422864">)</span>&nbsp;<span class="builtintype" id="3422866">bool</span>&nbsp;<span class="op" id="3422871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422874">return</span>&nbsp;<span class="ident" id="3422881">a</span>&nbsp;<span class="op" id="3422883">==</span>&nbsp;<span class="ident" id="3422886">nil</span>&nbsp;<span class="op" id="3422890">||</span>&nbsp;<span class="ident" id="3422893">a</span><span class="op" id="3422894">.</span><span class="ident" id="3422895">Name</span>&nbsp;<span class="op" id="3422900">==</span>&nbsp;<span class="string" id="3422903">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3422906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3422909">func</span>&nbsp;<span class="op" id="3422914">(</span><span class="ident" id="3422915">a</span>&nbsp;<span class="op" id="3422917">*</span><span class="ident" id="3422918">UnixAddr</span><span class="op" id="3422926">)</span>&nbsp;<span class="ident" id="3422928">sockaddr</span><span class="op" id="3422936">(</span><span class="ident" id="3422937">family</span>&nbsp;<span class="builtintype" id="3422944">int</span><span class="op" id="3422947">)</span>&nbsp;<span class="op" id="3422949">(</span><span class="ident" id="3422950">syscall</span><span class="op" id="3422957">.</span><span class="ident" id="3422958">Sockaddr</span><span class="op" id="3422966">,</span>&nbsp;<span class="builtintype" id="3422968">error</span><span class="op" id="3422973">)</span>&nbsp;<span class="op" id="3422975">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422978">if</span>&nbsp;<span class="ident" id="3422981">a</span>&nbsp;<span class="op" id="3422983">==</span>&nbsp;<span class="ident" id="3422986">nil</span>&nbsp;<span class="op" id="3422990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422994">return</span>&nbsp;<span class="ident" id="3423001">nil</span><span class="op" id="3423004">,</span>&nbsp;<span class="ident" id="3423006">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423014">return</span>&nbsp;<span class="op" id="3423021">&amp;</span><span class="ident" id="3423022">syscall</span><span class="op" id="3423029">.</span><span class="ident" id="3423030">SockaddrUnix</span><span class="op" id="3423042">{</span><span class="ident" id="3423043">Name</span><span class="op" id="3423047">:</span>&nbsp;<span class="ident" id="3423049">a</span><span class="op" id="3423050">.</span><span class="ident" id="3423051">Name</span><span class="op" id="3423055">}</span><span class="op" id="3423056">,</span>&nbsp;<span class="ident" id="3423058">nil</span><br>
<span class="lineno"></span><span class="op" id="3423062">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3423065">//&nbsp;UnixConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="3423136">//&nbsp;to&nbsp;Unix&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3423163">type</span>&nbsp;<span class="ident" id="3423168">UnixConn</span>&nbsp;<span class="keyword" id="3423177">struct</span>&nbsp;<span class="op" id="3423184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423187">conn</span><br>
<span class="lineno">105</span><span class="op" id="3423192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3423195">func</span>&nbsp;<span class="ident" id="3423200">newUnixConn</span><span class="op" id="3423211">(</span><span class="ident" id="3423212">fd</span>&nbsp;<span class="op" id="3423215">*</span><span class="ident" id="3423216">netFD</span><span class="op" id="3423221">)</span>&nbsp;<span class="op" id="3423223">*</span><span class="ident" id="3423224">UnixConn</span>&nbsp;<span class="op" id="3423233">{</span>&nbsp;<span class="keyword" id="3423235">return</span>&nbsp;<span class="op" id="3423242">&amp;</span><span class="ident" id="3423243">UnixConn</span><span class="op" id="3423251">{</span><span class="ident" id="3423252">conn</span><span class="op" id="3423256">{</span><span class="ident" id="3423257">fd</span><span class="op" id="3423259">}</span><span class="op" id="3423260">}</span>&nbsp;<span class="op" id="3423262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3423265">//&nbsp;ReadFromUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.&nbsp;&nbsp;It</span><br>
<span class="lineno">110</span><span class="comment" id="3423336">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3423407">//&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3423422">//</span><br>
<span class="lineno"></span><span class="comment" id="3423425">//&nbsp;ReadFromUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3423490">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="3423557">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3423577">func</span>&nbsp;<span class="op" id="3423582">(</span><span class="ident" id="3423583">c</span>&nbsp;<span class="op" id="3423585">*</span><span class="ident" id="3423586">UnixConn</span><span class="op" id="3423594">)</span>&nbsp;<span class="ident" id="3423596">ReadFromUnix</span><span class="op" id="3423608">(</span><span class="ident" id="3423609">b</span>&nbsp;<span class="op" id="3423611">[</span><span class="op" id="3423612">]</span><span class="builtintype" id="3423613">byte</span><span class="op" id="3423617">)</span>&nbsp;<span class="op" id="3423619">(</span><span class="ident" id="3423620">n</span>&nbsp;<span class="builtintype" id="3423622">int</span><span class="op" id="3423625">,</span>&nbsp;<span class="ident" id="3423627">addr</span>&nbsp;<span class="op" id="3423632">*</span><span class="ident" id="3423633">UnixAddr</span><span class="op" id="3423641">,</span>&nbsp;<span class="ident" id="3423643">err</span>&nbsp;<span class="builtintype" id="3423647">error</span><span class="op" id="3423652">)</span>&nbsp;<span class="op" id="3423654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423657">if</span>&nbsp;<span class="op" id="3423660">!</span><span class="ident" id="3423661">c</span><span class="op" id="3423662">.</span><span class="ident" id="3423663">ok</span><span class="op" id="3423665">(</span><span class="op" id="3423666">)</span>&nbsp;<span class="op" id="3423668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423672">return</span>&nbsp;<span class="num" id="3423679">0</span><span class="op" id="3423680">,</span>&nbsp;<span class="ident" id="3423682">nil</span><span class="op" id="3423685">,</span>&nbsp;<span class="ident" id="3423687">syscall</span><span class="op" id="3423694">.</span><span class="ident" id="3423695">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423703">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423706">n</span><span class="op" id="3423707">,</span>&nbsp;<span class="ident" id="3423709">sa</span><span class="op" id="3423711">,</span>&nbsp;<span class="ident" id="3423713">err</span>&nbsp;<span class="op" id="3423717">:=</span>&nbsp;<span class="ident" id="3423720">c</span><span class="op" id="3423721">.</span><span class="ident" id="3423722">fd</span><span class="op" id="3423724">.</span><span class="ident" id="3423725">readFrom</span><span class="op" id="3423733">(</span><span class="ident" id="3423734">b</span><span class="op" id="3423735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423738">switch</span>&nbsp;<span class="ident" id="3423745">sa</span>&nbsp;<span class="op" id="3423748">:=</span>&nbsp;<span class="ident" id="3423751">sa</span><span class="op" id="3423753">.</span><span class="op" id="3423754">(</span><span class="keyword" id="3423755">type</span><span class="op" id="3423759">)</span>&nbsp;<span class="op" id="3423761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423764">case</span>&nbsp;<span class="op" id="3423769">*</span><span class="ident" id="3423770">syscall</span><span class="op" id="3423777">.</span><span class="ident" id="3423778">SockaddrUnix</span><span class="op" id="3423790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423794">if</span>&nbsp;<span class="ident" id="3423797">sa</span><span class="op" id="3423799">.</span><span class="ident" id="3423800">Name</span>&nbsp;<span class="op" id="3423805">!=</span>&nbsp;<span class="string" id="3423808">&#34;&#34;</span>&nbsp;<span class="op" id="3423811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423816">addr</span>&nbsp;<span class="op" id="3423821">=</span>&nbsp;<span class="op" id="3423823">&amp;</span><span class="ident" id="3423824">UnixAddr</span><span class="op" id="3423832">{</span><span class="ident" id="3423833">Name</span><span class="op" id="3423837">:</span>&nbsp;<span class="ident" id="3423839">sa</span><span class="op" id="3423841">.</span><span class="ident" id="3423842">Name</span><span class="op" id="3423846">,</span>&nbsp;<span class="ident" id="3423848">Net</span><span class="op" id="3423851">:</span>&nbsp;<span class="ident" id="3423853">sotypeToNet</span><span class="op" id="3423864">(</span><span class="ident" id="3423865">c</span><span class="op" id="3423866">.</span><span class="ident" id="3423867">fd</span><span class="op" id="3423869">.</span><span class="ident" id="3423870">sotype</span><span class="op" id="3423876">)</span><span class="op" id="3423877">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423887">return</span><br>
<span class="lineno"></span><span class="op" id="3423894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3423897">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3423952">func</span>&nbsp;<span class="op" id="3423957">(</span><span class="ident" id="3423958">c</span>&nbsp;<span class="op" id="3423960">*</span><span class="ident" id="3423961">UnixConn</span><span class="op" id="3423969">)</span>&nbsp;<span class="ident" id="3423971">ReadFrom</span><span class="op" id="3423979">(</span><span class="ident" id="3423980">b</span>&nbsp;<span class="op" id="3423982">[</span><span class="op" id="3423983">]</span><span class="builtintype" id="3423984">byte</span><span class="op" id="3423988">)</span>&nbsp;<span class="op" id="3423990">(</span><span class="builtintype" id="3423991">int</span><span class="op" id="3423994">,</span>&nbsp;<span class="ident" id="3423996">Addr</span><span class="op" id="3424000">,</span>&nbsp;<span class="builtintype" id="3424002">error</span><span class="op" id="3424007">)</span>&nbsp;<span class="op" id="3424009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424012">if</span>&nbsp;<span class="op" id="3424015">!</span><span class="ident" id="3424016">c</span><span class="op" id="3424017">.</span><span class="ident" id="3424018">ok</span><span class="op" id="3424020">(</span><span class="op" id="3424021">)</span>&nbsp;<span class="op" id="3424023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424027">return</span>&nbsp;<span class="num" id="3424034">0</span><span class="op" id="3424035">,</span>&nbsp;<span class="ident" id="3424037">nil</span><span class="op" id="3424040">,</span>&nbsp;<span class="ident" id="3424042">syscall</span><span class="op" id="3424049">.</span><span class="ident" id="3424050">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424058">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424061">n</span><span class="op" id="3424062">,</span>&nbsp;<span class="ident" id="3424064">addr</span><span class="op" id="3424068">,</span>&nbsp;<span class="ident" id="3424070">err</span>&nbsp;<span class="op" id="3424074">:=</span>&nbsp;<span class="ident" id="3424077">c</span><span class="op" id="3424078">.</span><span class="ident" id="3424079">ReadFromUnix</span><span class="op" id="3424091">(</span><span class="ident" id="3424092">b</span><span class="op" id="3424093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424096">return</span>&nbsp;<span class="ident" id="3424103">n</span><span class="op" id="3424104">,</span>&nbsp;<span class="ident" id="3424106">addr</span><span class="op" id="3424110">.</span><span class="ident" id="3424111">toAddr</span><span class="op" id="3424117">(</span><span class="op" id="3424118">)</span><span class="op" id="3424119">,</span>&nbsp;<span class="ident" id="3424121">err</span><br>
<span class="lineno"></span><span class="op" id="3424125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3424128">//&nbsp;ReadMsgUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno">140</span><span class="comment" id="3424197">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3424268">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3424339">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet,&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3424409">func</span>&nbsp;<span class="op" id="3424414">(</span><span class="ident" id="3424415">c</span>&nbsp;<span class="op" id="3424417">*</span><span class="ident" id="3424418">UnixConn</span><span class="op" id="3424426">)</span>&nbsp;<span class="ident" id="3424428">ReadMsgUnix</span><span class="op" id="3424439">(</span><span class="ident" id="3424440">b</span><span class="op" id="3424441">,</span>&nbsp;<span class="ident" id="3424443">oob</span>&nbsp;<span class="op" id="3424447">[</span><span class="op" id="3424448">]</span><span class="builtintype" id="3424449">byte</span><span class="op" id="3424453">)</span>&nbsp;<span class="op" id="3424455">(</span><span class="ident" id="3424456">n</span><span class="op" id="3424457">,</span>&nbsp;<span class="ident" id="3424459">oobn</span><span class="op" id="3424463">,</span>&nbsp;<span class="ident" id="3424465">flags</span>&nbsp;<span class="builtintype" id="3424471">int</span><span class="op" id="3424474">,</span>&nbsp;<span class="ident" id="3424476">addr</span>&nbsp;<span class="op" id="3424481">*</span><span class="ident" id="3424482">UnixAddr</span><span class="op" id="3424490">,</span>&nbsp;<span class="ident" id="3424492">err</span>&nbsp;<span class="builtintype" id="3424496">error</span><span class="op" id="3424501">)</span>&nbsp;<span class="op" id="3424503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424506">if</span>&nbsp;<span class="op" id="3424509">!</span><span class="ident" id="3424510">c</span><span class="op" id="3424511">.</span><span class="ident" id="3424512">ok</span><span class="op" id="3424514">(</span><span class="op" id="3424515">)</span>&nbsp;<span class="op" id="3424517">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424521">return</span>&nbsp;<span class="num" id="3424528">0</span><span class="op" id="3424529">,</span>&nbsp;<span class="num" id="3424531">0</span><span class="op" id="3424532">,</span>&nbsp;<span class="num" id="3424534">0</span><span class="op" id="3424535">,</span>&nbsp;<span class="ident" id="3424537">nil</span><span class="op" id="3424540">,</span>&nbsp;<span class="ident" id="3424542">syscall</span><span class="op" id="3424549">.</span><span class="ident" id="3424550">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424561">n</span><span class="op" id="3424562">,</span>&nbsp;<span class="ident" id="3424564">oobn</span><span class="op" id="3424568">,</span>&nbsp;<span class="ident" id="3424570">flags</span><span class="op" id="3424575">,</span>&nbsp;<span class="ident" id="3424577">sa</span><span class="op" id="3424579">,</span>&nbsp;<span class="ident" id="3424581">err</span>&nbsp;<span class="op" id="3424585">:=</span>&nbsp;<span class="ident" id="3424588">c</span><span class="op" id="3424589">.</span><span class="ident" id="3424590">fd</span><span class="op" id="3424592">.</span><span class="ident" id="3424593">readMsg</span><span class="op" id="3424600">(</span><span class="ident" id="3424601">b</span><span class="op" id="3424602">,</span>&nbsp;<span class="ident" id="3424604">oob</span><span class="op" id="3424607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424610">switch</span>&nbsp;<span class="ident" id="3424617">sa</span>&nbsp;<span class="op" id="3424620">:=</span>&nbsp;<span class="ident" id="3424623">sa</span><span class="op" id="3424625">.</span><span class="op" id="3424626">(</span><span class="keyword" id="3424627">type</span><span class="op" id="3424631">)</span>&nbsp;<span class="op" id="3424633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424636">case</span>&nbsp;<span class="op" id="3424641">*</span><span class="ident" id="3424642">syscall</span><span class="op" id="3424649">.</span><span class="ident" id="3424650">SockaddrUnix</span><span class="op" id="3424662">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424666">if</span>&nbsp;<span class="ident" id="3424669">sa</span><span class="op" id="3424671">.</span><span class="ident" id="3424672">Name</span>&nbsp;<span class="op" id="3424677">!=</span>&nbsp;<span class="string" id="3424680">&#34;&#34;</span>&nbsp;<span class="op" id="3424683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424688">addr</span>&nbsp;<span class="op" id="3424693">=</span>&nbsp;<span class="op" id="3424695">&amp;</span><span class="ident" id="3424696">UnixAddr</span><span class="op" id="3424704">{</span><span class="ident" id="3424705">Name</span><span class="op" id="3424709">:</span>&nbsp;<span class="ident" id="3424711">sa</span><span class="op" id="3424713">.</span><span class="ident" id="3424714">Name</span><span class="op" id="3424718">,</span>&nbsp;<span class="ident" id="3424720">Net</span><span class="op" id="3424723">:</span>&nbsp;<span class="ident" id="3424725">sotypeToNet</span><span class="op" id="3424736">(</span><span class="ident" id="3424737">c</span><span class="op" id="3424738">.</span><span class="ident" id="3424739">fd</span><span class="op" id="3424741">.</span><span class="ident" id="3424742">sotype</span><span class="op" id="3424748">)</span><span class="op" id="3424749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424759">return</span><br>
<span class="lineno">155</span><span class="op" id="3424766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3424769">//&nbsp;WriteToUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3424843">//</span><br>
<span class="lineno"></span><span class="comment" id="3424846">//&nbsp;WriteToUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">160</span><span class="comment" id="3424910">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3424977">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3425046">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3425059">func</span>&nbsp;<span class="op" id="3425064">(</span><span class="ident" id="3425065">c</span>&nbsp;<span class="op" id="3425067">*</span><span class="ident" id="3425068">UnixConn</span><span class="op" id="3425076">)</span>&nbsp;<span class="ident" id="3425078">WriteToUnix</span><span class="op" id="3425089">(</span><span class="ident" id="3425090">b</span>&nbsp;<span class="op" id="3425092">[</span><span class="op" id="3425093">]</span><span class="builtintype" id="3425094">byte</span><span class="op" id="3425098">,</span>&nbsp;<span class="ident" id="3425100">addr</span>&nbsp;<span class="op" id="3425105">*</span><span class="ident" id="3425106">UnixAddr</span><span class="op" id="3425114">)</span>&nbsp;<span class="op" id="3425116">(</span><span class="ident" id="3425117">n</span>&nbsp;<span class="builtintype" id="3425119">int</span><span class="op" id="3425122">,</span>&nbsp;<span class="ident" id="3425124">err</span>&nbsp;<span class="builtintype" id="3425128">error</span><span class="op" id="3425133">)</span>&nbsp;<span class="op" id="3425135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425138">if</span>&nbsp;<span class="op" id="3425141">!</span><span class="ident" id="3425142">c</span><span class="op" id="3425143">.</span><span class="ident" id="3425144">ok</span><span class="op" id="3425146">(</span><span class="op" id="3425147">)</span>&nbsp;<span class="op" id="3425149">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425153">return</span>&nbsp;<span class="num" id="3425160">0</span><span class="op" id="3425161">,</span>&nbsp;<span class="ident" id="3425163">syscall</span><span class="op" id="3425170">.</span><span class="ident" id="3425171">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425182">if</span>&nbsp;<span class="ident" id="3425185">c</span><span class="op" id="3425186">.</span><span class="ident" id="3425187">fd</span><span class="op" id="3425189">.</span><span class="ident" id="3425190">isConnected</span>&nbsp;<span class="op" id="3425202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425206">return</span>&nbsp;<span class="num" id="3425213">0</span><span class="op" id="3425214">,</span>&nbsp;<span class="op" id="3425216">&amp;</span><span class="ident" id="3425217">OpError</span><span class="op" id="3425224">{</span><span class="ident" id="3425225">Op</span><span class="op" id="3425227">:</span>&nbsp;<span class="string" id="3425229">&#34;write&#34;</span><span class="op" id="3425236">,</span>&nbsp;<span class="ident" id="3425238">Net</span><span class="op" id="3425241">:</span>&nbsp;<span class="ident" id="3425243">c</span><span class="op" id="3425244">.</span><span class="ident" id="3425245">fd</span><span class="op" id="3425247">.</span><span class="ident" id="3425248">net</span><span class="op" id="3425251">,</span>&nbsp;<span class="ident" id="3425253">Addr</span><span class="op" id="3425257">:</span>&nbsp;<span class="ident" id="3425259">addr</span><span class="op" id="3425263">,</span>&nbsp;<span class="ident" id="3425265">Err</span><span class="op" id="3425268">:</span>&nbsp;<span class="ident" id="3425270">ErrWriteToConnected</span><span class="op" id="3425289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425292">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425295">if</span>&nbsp;<span class="ident" id="3425298">addr</span>&nbsp;<span class="op" id="3425303">==</span>&nbsp;<span class="ident" id="3425306">nil</span>&nbsp;<span class="op" id="3425310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425314">return</span>&nbsp;<span class="num" id="3425321">0</span><span class="op" id="3425322">,</span>&nbsp;<span class="op" id="3425324">&amp;</span><span class="ident" id="3425325">OpError</span><span class="op" id="3425332">{</span><span class="ident" id="3425333">Op</span><span class="op" id="3425335">:</span>&nbsp;<span class="string" id="3425337">&#34;write&#34;</span><span class="op" id="3425344">,</span>&nbsp;<span class="ident" id="3425346">Net</span><span class="op" id="3425349">:</span>&nbsp;<span class="ident" id="3425351">c</span><span class="op" id="3425352">.</span><span class="ident" id="3425353">fd</span><span class="op" id="3425355">.</span><span class="ident" id="3425356">net</span><span class="op" id="3425359">,</span>&nbsp;<span class="ident" id="3425361">Addr</span><span class="op" id="3425365">:</span>&nbsp;<span class="ident" id="3425367">nil</span><span class="op" id="3425370">,</span>&nbsp;<span class="ident" id="3425372">Err</span><span class="op" id="3425375">:</span>&nbsp;<span class="ident" id="3425377">errMissingAddress</span><span class="op" id="3425394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425400">if</span>&nbsp;<span class="ident" id="3425403">addr</span><span class="op" id="3425407">.</span><span class="ident" id="3425408">Net</span>&nbsp;<span class="op" id="3425412">!=</span>&nbsp;<span class="ident" id="3425415">sotypeToNet</span><span class="op" id="3425426">(</span><span class="ident" id="3425427">c</span><span class="op" id="3425428">.</span><span class="ident" id="3425429">fd</span><span class="op" id="3425431">.</span><span class="ident" id="3425432">sotype</span><span class="op" id="3425438">)</span>&nbsp;<span class="op" id="3425440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425444">return</span>&nbsp;<span class="num" id="3425451">0</span><span class="op" id="3425452">,</span>&nbsp;<span class="ident" id="3425454">syscall</span><span class="op" id="3425461">.</span><span class="ident" id="3425462">EAFNOSUPPORT</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3425479">sa</span>&nbsp;<span class="op" id="3425482">:=</span>&nbsp;<span class="op" id="3425485">&amp;</span><span class="ident" id="3425486">syscall</span><span class="op" id="3425493">.</span><span class="ident" id="3425494">SockaddrUnix</span><span class="op" id="3425506">{</span><span class="ident" id="3425507">Name</span><span class="op" id="3425511">:</span>&nbsp;<span class="ident" id="3425513">addr</span><span class="op" id="3425517">.</span><span class="ident" id="3425518">Name</span><span class="op" id="3425522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425525">return</span>&nbsp;<span class="ident" id="3425532">c</span><span class="op" id="3425533">.</span><span class="ident" id="3425534">fd</span><span class="op" id="3425536">.</span><span class="ident" id="3425537">writeTo</span><span class="op" id="3425544">(</span><span class="ident" id="3425545">b</span><span class="op" id="3425546">,</span>&nbsp;<span class="ident" id="3425548">sa</span><span class="op" id="3425550">)</span><br>
<span class="lineno"></span><span class="op" id="3425552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3425555">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3425608">func</span>&nbsp;<span class="op" id="3425613">(</span><span class="ident" id="3425614">c</span>&nbsp;<span class="op" id="3425616">*</span><span class="ident" id="3425617">UnixConn</span><span class="op" id="3425625">)</span>&nbsp;<span class="ident" id="3425627">WriteTo</span><span class="op" id="3425634">(</span><span class="ident" id="3425635">b</span>&nbsp;<span class="op" id="3425637">[</span><span class="op" id="3425638">]</span><span class="builtintype" id="3425639">byte</span><span class="op" id="3425643">,</span>&nbsp;<span class="ident" id="3425645">addr</span>&nbsp;<span class="ident" id="3425650">Addr</span><span class="op" id="3425654">)</span>&nbsp;<span class="op" id="3425656">(</span><span class="ident" id="3425657">n</span>&nbsp;<span class="builtintype" id="3425659">int</span><span class="op" id="3425662">,</span>&nbsp;<span class="ident" id="3425664">err</span>&nbsp;<span class="builtintype" id="3425668">error</span><span class="op" id="3425673">)</span>&nbsp;<span class="op" id="3425675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425678">if</span>&nbsp;<span class="op" id="3425681">!</span><span class="ident" id="3425682">c</span><span class="op" id="3425683">.</span><span class="ident" id="3425684">ok</span><span class="op" id="3425686">(</span><span class="op" id="3425687">)</span>&nbsp;<span class="op" id="3425689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425693">return</span>&nbsp;<span class="num" id="3425700">0</span><span class="op" id="3425701">,</span>&nbsp;<span class="ident" id="3425703">syscall</span><span class="op" id="3425710">.</span><span class="ident" id="3425711">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425719">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3425722">a</span><span class="op" id="3425723">,</span>&nbsp;<span class="ident" id="3425725">ok</span>&nbsp;<span class="op" id="3425728">:=</span>&nbsp;<span class="ident" id="3425731">addr</span><span class="op" id="3425735">.</span><span class="op" id="3425736">(</span><span class="op" id="3425737">*</span><span class="ident" id="3425738">UnixAddr</span><span class="op" id="3425746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425749">if</span>&nbsp;<span class="op" id="3425752">!</span><span class="ident" id="3425753">ok</span>&nbsp;<span class="op" id="3425756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425760">return</span>&nbsp;<span class="num" id="3425767">0</span><span class="op" id="3425768">,</span>&nbsp;<span class="op" id="3425770">&amp;</span><span class="ident" id="3425771">OpError</span><span class="op" id="3425778">{</span><span class="string" id="3425779">&#34;write&#34;</span><span class="op" id="3425786">,</span>&nbsp;<span class="ident" id="3425788">c</span><span class="op" id="3425789">.</span><span class="ident" id="3425790">fd</span><span class="op" id="3425792">.</span><span class="ident" id="3425793">net</span><span class="op" id="3425796">,</span>&nbsp;<span class="ident" id="3425798">addr</span><span class="op" id="3425802">,</span>&nbsp;<span class="ident" id="3425804">syscall</span><span class="op" id="3425811">.</span><span class="ident" id="3425812">EINVAL</span><span class="op" id="3425818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425824">return</span>&nbsp;<span class="ident" id="3425831">c</span><span class="op" id="3425832">.</span><span class="ident" id="3425833">WriteToUnix</span><span class="op" id="3425844">(</span><span class="ident" id="3425845">b</span><span class="op" id="3425846">,</span>&nbsp;<span class="ident" id="3425848">a</span><span class="op" id="3425849">)</span><br>
<span class="lineno">190</span><span class="op" id="3425851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3425854">//&nbsp;WriteMsgUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3425921">//&nbsp;from&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3425989">//&nbsp;the&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">195</span><span class="keyword" id="3426045">func</span>&nbsp;<span class="op" id="3426050">(</span><span class="ident" id="3426051">c</span>&nbsp;<span class="op" id="3426053">*</span><span class="ident" id="3426054">UnixConn</span><span class="op" id="3426062">)</span>&nbsp;<span class="ident" id="3426064">WriteMsgUnix</span><span class="op" id="3426076">(</span><span class="ident" id="3426077">b</span><span class="op" id="3426078">,</span>&nbsp;<span class="ident" id="3426080">oob</span>&nbsp;<span class="op" id="3426084">[</span><span class="op" id="3426085">]</span><span class="builtintype" id="3426086">byte</span><span class="op" id="3426090">,</span>&nbsp;<span class="ident" id="3426092">addr</span>&nbsp;<span class="op" id="3426097">*</span><span class="ident" id="3426098">UnixAddr</span><span class="op" id="3426106">)</span>&nbsp;<span class="op" id="3426108">(</span><span class="ident" id="3426109">n</span><span class="op" id="3426110">,</span>&nbsp;<span class="ident" id="3426112">oobn</span>&nbsp;<span class="builtintype" id="3426117">int</span><span class="op" id="3426120">,</span>&nbsp;<span class="ident" id="3426122">err</span>&nbsp;<span class="builtintype" id="3426126">error</span><span class="op" id="3426131">)</span>&nbsp;<span class="op" id="3426133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426136">if</span>&nbsp;<span class="op" id="3426139">!</span><span class="ident" id="3426140">c</span><span class="op" id="3426141">.</span><span class="ident" id="3426142">ok</span><span class="op" id="3426144">(</span><span class="op" id="3426145">)</span>&nbsp;<span class="op" id="3426147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426151">return</span>&nbsp;<span class="num" id="3426158">0</span><span class="op" id="3426159">,</span>&nbsp;<span class="num" id="3426161">0</span><span class="op" id="3426162">,</span>&nbsp;<span class="ident" id="3426164">syscall</span><span class="op" id="3426171">.</span><span class="ident" id="3426172">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3426180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426183">if</span>&nbsp;<span class="ident" id="3426186">c</span><span class="op" id="3426187">.</span><span class="ident" id="3426188">fd</span><span class="op" id="3426190">.</span><span class="ident" id="3426191">sotype</span>&nbsp;<span class="op" id="3426198">==</span>&nbsp;<span class="ident" id="3426201">syscall</span><span class="op" id="3426208">.</span><span class="ident" id="3426209">SOCK_DGRAM</span>&nbsp;<span class="op" id="3426220">&amp;&amp;</span>&nbsp;<span class="ident" id="3426223">c</span><span class="op" id="3426224">.</span><span class="ident" id="3426225">fd</span><span class="op" id="3426227">.</span><span class="ident" id="3426228">isConnected</span>&nbsp;<span class="op" id="3426240">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426244">return</span>&nbsp;<span class="num" id="3426251">0</span><span class="op" id="3426252">,</span>&nbsp;<span class="num" id="3426254">0</span><span class="op" id="3426255">,</span>&nbsp;<span class="op" id="3426257">&amp;</span><span class="ident" id="3426258">OpError</span><span class="op" id="3426265">{</span><span class="ident" id="3426266">Op</span><span class="op" id="3426268">:</span>&nbsp;<span class="string" id="3426270">&#34;write&#34;</span><span class="op" id="3426277">,</span>&nbsp;<span class="ident" id="3426279">Net</span><span class="op" id="3426282">:</span>&nbsp;<span class="ident" id="3426284">c</span><span class="op" id="3426285">.</span><span class="ident" id="3426286">fd</span><span class="op" id="3426288">.</span><span class="ident" id="3426289">net</span><span class="op" id="3426292">,</span>&nbsp;<span class="ident" id="3426294">Addr</span><span class="op" id="3426298">:</span>&nbsp;<span class="ident" id="3426300">addr</span><span class="op" id="3426304">,</span>&nbsp;<span class="ident" id="3426306">Err</span><span class="op" id="3426309">:</span>&nbsp;<span class="ident" id="3426311">ErrWriteToConnected</span><span class="op" id="3426330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3426333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426336">if</span>&nbsp;<span class="ident" id="3426339">addr</span>&nbsp;<span class="op" id="3426344">!=</span>&nbsp;<span class="ident" id="3426347">nil</span>&nbsp;<span class="op" id="3426351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426355">if</span>&nbsp;<span class="ident" id="3426358">addr</span><span class="op" id="3426362">.</span><span class="ident" id="3426363">Net</span>&nbsp;<span class="op" id="3426367">!=</span>&nbsp;<span class="ident" id="3426370">sotypeToNet</span><span class="op" id="3426381">(</span><span class="ident" id="3426382">c</span><span class="op" id="3426383">.</span><span class="ident" id="3426384">fd</span><span class="op" id="3426386">.</span><span class="ident" id="3426387">sotype</span><span class="op" id="3426393">)</span>&nbsp;<span class="op" id="3426395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426400">return</span>&nbsp;<span class="num" id="3426407">0</span><span class="op" id="3426408">,</span>&nbsp;<span class="num" id="3426410">0</span><span class="op" id="3426411">,</span>&nbsp;<span class="ident" id="3426413">syscall</span><span class="op" id="3426420">.</span><span class="ident" id="3426421">EAFNOSUPPORT</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3426436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3426440">sa</span>&nbsp;<span class="op" id="3426443">:=</span>&nbsp;<span class="op" id="3426446">&amp;</span><span class="ident" id="3426447">syscall</span><span class="op" id="3426454">.</span><span class="ident" id="3426455">SockaddrUnix</span><span class="op" id="3426467">{</span><span class="ident" id="3426468">Name</span><span class="op" id="3426472">:</span>&nbsp;<span class="ident" id="3426474">addr</span><span class="op" id="3426478">.</span><span class="ident" id="3426479">Name</span><span class="op" id="3426483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426487">return</span>&nbsp;<span class="ident" id="3426494">c</span><span class="op" id="3426495">.</span><span class="ident" id="3426496">fd</span><span class="op" id="3426498">.</span><span class="ident" id="3426499">writeMsg</span><span class="op" id="3426507">(</span><span class="ident" id="3426508">b</span><span class="op" id="3426509">,</span>&nbsp;<span class="ident" id="3426511">oob</span><span class="op" id="3426514">,</span>&nbsp;<span class="ident" id="3426516">sa</span><span class="op" id="3426518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3426521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426524">return</span>&nbsp;<span class="ident" id="3426531">c</span><span class="op" id="3426532">.</span><span class="ident" id="3426533">fd</span><span class="op" id="3426535">.</span><span class="ident" id="3426536">writeMsg</span><span class="op" id="3426544">(</span><span class="ident" id="3426545">b</span><span class="op" id="3426546">,</span>&nbsp;<span class="ident" id="3426548">oob</span><span class="op" id="3426551">,</span>&nbsp;<span class="ident" id="3426553">nil</span><span class="op" id="3426556">)</span><br>
<span class="lineno">210</span><span class="op" id="3426558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3426561">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3426633">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3426672">func</span>&nbsp;<span class="op" id="3426677">(</span><span class="ident" id="3426678">c</span>&nbsp;<span class="op" id="3426680">*</span><span class="ident" id="3426681">UnixConn</span><span class="op" id="3426689">)</span>&nbsp;<span class="ident" id="3426691">CloseRead</span><span class="op" id="3426700">(</span><span class="op" id="3426701">)</span>&nbsp;<span class="builtintype" id="3426703">error</span>&nbsp;<span class="op" id="3426709">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426712">if</span>&nbsp;<span class="op" id="3426715">!</span><span class="ident" id="3426716">c</span><span class="op" id="3426717">.</span><span class="ident" id="3426718">ok</span><span class="op" id="3426720">(</span><span class="op" id="3426721">)</span>&nbsp;<span class="op" id="3426723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426727">return</span>&nbsp;<span class="ident" id="3426734">syscall</span><span class="op" id="3426741">.</span><span class="ident" id="3426742">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3426750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426753">return</span>&nbsp;<span class="ident" id="3426760">c</span><span class="op" id="3426761">.</span><span class="ident" id="3426762">fd</span><span class="op" id="3426764">.</span><span class="ident" id="3426765">closeRead</span><span class="op" id="3426774">(</span><span class="op" id="3426775">)</span><br>
<span class="lineno"></span><span class="op" id="3426777">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3426780">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3426853">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3426892">func</span>&nbsp;<span class="op" id="3426897">(</span><span class="ident" id="3426898">c</span>&nbsp;<span class="op" id="3426900">*</span><span class="ident" id="3426901">UnixConn</span><span class="op" id="3426909">)</span>&nbsp;<span class="ident" id="3426911">CloseWrite</span><span class="op" id="3426921">(</span><span class="op" id="3426922">)</span>&nbsp;<span class="builtintype" id="3426924">error</span>&nbsp;<span class="op" id="3426930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426933">if</span>&nbsp;<span class="op" id="3426936">!</span><span class="ident" id="3426937">c</span><span class="op" id="3426938">.</span><span class="ident" id="3426939">ok</span><span class="op" id="3426941">(</span><span class="op" id="3426942">)</span>&nbsp;<span class="op" id="3426944">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426948">return</span>&nbsp;<span class="ident" id="3426955">syscall</span><span class="op" id="3426962">.</span><span class="ident" id="3426963">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3426971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426974">return</span>&nbsp;<span class="ident" id="3426981">c</span><span class="op" id="3426982">.</span><span class="ident" id="3426983">fd</span><span class="op" id="3426985">.</span><span class="ident" id="3426986">closeWrite</span><span class="op" id="3426996">(</span><span class="op" id="3426997">)</span><br>
<span class="lineno"></span><span class="op" id="3426999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="3427002">//&nbsp;DialUnix&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3427071">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3427141">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3427201">func</span>&nbsp;<span class="ident" id="3427206">DialUnix</span><span class="op" id="3427214">(</span><span class="ident" id="3427215">net</span>&nbsp;<span class="builtintype" id="3427219">string</span><span class="op" id="3427225">,</span>&nbsp;<span class="ident" id="3427227">laddr</span><span class="op" id="3427232">,</span>&nbsp;<span class="ident" id="3427234">raddr</span>&nbsp;<span class="op" id="3427240">*</span><span class="ident" id="3427241">UnixAddr</span><span class="op" id="3427249">)</span>&nbsp;<span class="op" id="3427251">(</span><span class="op" id="3427252">*</span><span class="ident" id="3427253">UnixConn</span><span class="op" id="3427261">,</span>&nbsp;<span class="builtintype" id="3427263">error</span><span class="op" id="3427268">)</span>&nbsp;<span class="op" id="3427270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427273">switch</span>&nbsp;<span class="ident" id="3427280">net</span>&nbsp;<span class="op" id="3427284">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427287">case</span>&nbsp;<span class="string" id="3427292">&#34;unix&#34;</span><span class="op" id="3427298">,</span>&nbsp;<span class="string" id="3427300">&#34;unixgram&#34;</span><span class="op" id="3427310">,</span>&nbsp;<span class="string" id="3427312">&#34;unixpacket&#34;</span><span class="op" id="3427324">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427327">default</span><span class="op" id="3427334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427338">return</span>&nbsp;<span class="ident" id="3427345">nil</span><span class="op" id="3427348">,</span>&nbsp;<span class="op" id="3427350">&amp;</span><span class="ident" id="3427351">OpError</span><span class="op" id="3427358">{</span><span class="ident" id="3427359">Op</span><span class="op" id="3427361">:</span>&nbsp;<span class="string" id="3427363">&#34;dial&#34;</span><span class="op" id="3427369">,</span>&nbsp;<span class="ident" id="3427371">Net</span><span class="op" id="3427374">:</span>&nbsp;<span class="ident" id="3427376">net</span><span class="op" id="3427379">,</span>&nbsp;<span class="ident" id="3427381">Addr</span><span class="op" id="3427385">:</span>&nbsp;<span class="ident" id="3427387">raddr</span><span class="op" id="3427392">,</span>&nbsp;<span class="ident" id="3427394">Err</span><span class="op" id="3427397">:</span>&nbsp;<span class="ident" id="3427399">UnknownNetworkError</span><span class="op" id="3427418">(</span><span class="ident" id="3427419">net</span><span class="op" id="3427422">)</span><span class="op" id="3427423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3427426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427429">return</span>&nbsp;<span class="ident" id="3427436">dialUnix</span><span class="op" id="3427444">(</span><span class="ident" id="3427445">net</span><span class="op" id="3427448">,</span>&nbsp;<span class="ident" id="3427450">laddr</span><span class="op" id="3427455">,</span>&nbsp;<span class="ident" id="3427457">raddr</span><span class="op" id="3427462">,</span>&nbsp;<span class="ident" id="3427464">noDeadline</span><span class="op" id="3427474">)</span><br>
<span class="lineno">240</span><span class="op" id="3427476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3427479">func</span>&nbsp;<span class="ident" id="3427484">dialUnix</span><span class="op" id="3427492">(</span><span class="ident" id="3427493">net</span>&nbsp;<span class="builtintype" id="3427497">string</span><span class="op" id="3427503">,</span>&nbsp;<span class="ident" id="3427505">laddr</span><span class="op" id="3427510">,</span>&nbsp;<span class="ident" id="3427512">raddr</span>&nbsp;<span class="op" id="3427518">*</span><span class="ident" id="3427519">UnixAddr</span><span class="op" id="3427527">,</span>&nbsp;<span class="ident" id="3427529">deadline</span>&nbsp;<span class="ident" id="3427538">time</span><span class="op" id="3427542">.</span><span class="ident" id="3427543">Time</span><span class="op" id="3427547">)</span>&nbsp;<span class="op" id="3427549">(</span><span class="op" id="3427550">*</span><span class="ident" id="3427551">UnixConn</span><span class="op" id="3427559">,</span>&nbsp;<span class="builtintype" id="3427561">error</span><span class="op" id="3427566">)</span>&nbsp;<span class="op" id="3427568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427571">fd</span><span class="op" id="3427573">,</span>&nbsp;<span class="ident" id="3427575">err</span>&nbsp;<span class="op" id="3427579">:=</span>&nbsp;<span class="ident" id="3427582">unixSocket</span><span class="op" id="3427592">(</span><span class="ident" id="3427593">net</span><span class="op" id="3427596">,</span>&nbsp;<span class="ident" id="3427598">laddr</span><span class="op" id="3427603">,</span>&nbsp;<span class="ident" id="3427605">raddr</span><span class="op" id="3427610">,</span>&nbsp;<span class="string" id="3427612">&#34;dial&#34;</span><span class="op" id="3427618">,</span>&nbsp;<span class="ident" id="3427620">deadline</span><span class="op" id="3427628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427631">if</span>&nbsp;<span class="ident" id="3427634">err</span>&nbsp;<span class="op" id="3427638">!=</span>&nbsp;<span class="ident" id="3427641">nil</span>&nbsp;<span class="op" id="3427645">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427649">return</span>&nbsp;<span class="ident" id="3427656">nil</span><span class="op" id="3427659">,</span>&nbsp;<span class="op" id="3427661">&amp;</span><span class="ident" id="3427662">OpError</span><span class="op" id="3427669">{</span><span class="ident" id="3427670">Op</span><span class="op" id="3427672">:</span>&nbsp;<span class="string" id="3427674">&#34;dial&#34;</span><span class="op" id="3427680">,</span>&nbsp;<span class="ident" id="3427682">Net</span><span class="op" id="3427685">:</span>&nbsp;<span class="ident" id="3427687">net</span><span class="op" id="3427690">,</span>&nbsp;<span class="ident" id="3427692">Addr</span><span class="op" id="3427696">:</span>&nbsp;<span class="ident" id="3427698">raddr</span><span class="op" id="3427703">,</span>&nbsp;<span class="ident" id="3427705">Err</span><span class="op" id="3427708">:</span>&nbsp;<span class="ident" id="3427710">err</span><span class="op" id="3427713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3427716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427719">return</span>&nbsp;<span class="ident" id="3427726">newUnixConn</span><span class="op" id="3427737">(</span><span class="ident" id="3427738">fd</span><span class="op" id="3427740">)</span><span class="op" id="3427741">,</span>&nbsp;<span class="ident" id="3427743">nil</span><br>
<span class="lineno"></span><span class="op" id="3427747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3427750">//&nbsp;UnixListener&nbsp;is&nbsp;a&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3427816">//&nbsp;typically&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;Unix</span><br>
<span class="lineno"></span><span class="comment" id="3427885">//&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3427904">type</span>&nbsp;<span class="ident" id="3427909">UnixListener</span>&nbsp;<span class="keyword" id="3427922">struct</span>&nbsp;<span class="op" id="3427929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427932">fd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3427937">*</span><span class="ident" id="3427938">netFD</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427945">path</span>&nbsp;<span class="builtintype" id="3427950">string</span><br>
<span class="lineno"></span><span class="op" id="3427957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3427960">//&nbsp;ListenUnix&nbsp;announces&nbsp;on&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3428030">//&nbsp;Unix&nbsp;listener.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno">260</span><span class="keyword" id="3428097">func</span>&nbsp;<span class="ident" id="3428102">ListenUnix</span><span class="op" id="3428112">(</span><span class="ident" id="3428113">net</span>&nbsp;<span class="builtintype" id="3428117">string</span><span class="op" id="3428123">,</span>&nbsp;<span class="ident" id="3428125">laddr</span>&nbsp;<span class="op" id="3428131">*</span><span class="ident" id="3428132">UnixAddr</span><span class="op" id="3428140">)</span>&nbsp;<span class="op" id="3428142">(</span><span class="op" id="3428143">*</span><span class="ident" id="3428144">UnixListener</span><span class="op" id="3428156">,</span>&nbsp;<span class="builtintype" id="3428158">error</span><span class="op" id="3428163">)</span>&nbsp;<span class="op" id="3428165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428168">switch</span>&nbsp;<span class="ident" id="3428175">net</span>&nbsp;<span class="op" id="3428179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428182">case</span>&nbsp;<span class="string" id="3428187">&#34;unix&#34;</span><span class="op" id="3428193">,</span>&nbsp;<span class="string" id="3428195">&#34;unixpacket&#34;</span><span class="op" id="3428207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428210">default</span><span class="op" id="3428217">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428221">return</span>&nbsp;<span class="ident" id="3428228">nil</span><span class="op" id="3428231">,</span>&nbsp;<span class="op" id="3428233">&amp;</span><span class="ident" id="3428234">OpError</span><span class="op" id="3428241">{</span><span class="ident" id="3428242">Op</span><span class="op" id="3428244">:</span>&nbsp;<span class="string" id="3428246">&#34;listen&#34;</span><span class="op" id="3428254">,</span>&nbsp;<span class="ident" id="3428256">Net</span><span class="op" id="3428259">:</span>&nbsp;<span class="ident" id="3428261">net</span><span class="op" id="3428264">,</span>&nbsp;<span class="ident" id="3428266">Addr</span><span class="op" id="3428270">:</span>&nbsp;<span class="ident" id="3428272">laddr</span><span class="op" id="3428277">,</span>&nbsp;<span class="ident" id="3428279">Err</span><span class="op" id="3428282">:</span>&nbsp;<span class="ident" id="3428284">UnknownNetworkError</span><span class="op" id="3428303">(</span><span class="ident" id="3428304">net</span><span class="op" id="3428307">)</span><span class="op" id="3428308">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3428311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428314">if</span>&nbsp;<span class="ident" id="3428317">laddr</span>&nbsp;<span class="op" id="3428323">==</span>&nbsp;<span class="ident" id="3428326">nil</span>&nbsp;<span class="op" id="3428330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428334">return</span>&nbsp;<span class="ident" id="3428341">nil</span><span class="op" id="3428344">,</span>&nbsp;<span class="op" id="3428346">&amp;</span><span class="ident" id="3428347">OpError</span><span class="op" id="3428354">{</span><span class="ident" id="3428355">Op</span><span class="op" id="3428357">:</span>&nbsp;<span class="string" id="3428359">&#34;listen&#34;</span><span class="op" id="3428367">,</span>&nbsp;<span class="ident" id="3428369">Net</span><span class="op" id="3428372">:</span>&nbsp;<span class="ident" id="3428374">net</span><span class="op" id="3428377">,</span>&nbsp;<span class="ident" id="3428379">Addr</span><span class="op" id="3428383">:</span>&nbsp;<span class="ident" id="3428385">nil</span><span class="op" id="3428388">,</span>&nbsp;<span class="ident" id="3428390">Err</span><span class="op" id="3428393">:</span>&nbsp;<span class="ident" id="3428395">errMissingAddress</span><span class="op" id="3428412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3428415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428418">fd</span><span class="op" id="3428420">,</span>&nbsp;<span class="ident" id="3428422">err</span>&nbsp;<span class="op" id="3428426">:=</span>&nbsp;<span class="ident" id="3428429">unixSocket</span><span class="op" id="3428439">(</span><span class="ident" id="3428440">net</span><span class="op" id="3428443">,</span>&nbsp;<span class="ident" id="3428445">laddr</span><span class="op" id="3428450">,</span>&nbsp;<span class="ident" id="3428452">nil</span><span class="op" id="3428455">,</span>&nbsp;<span class="string" id="3428457">&#34;listen&#34;</span><span class="op" id="3428465">,</span>&nbsp;<span class="ident" id="3428467">noDeadline</span><span class="op" id="3428477">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428480">if</span>&nbsp;<span class="ident" id="3428483">err</span>&nbsp;<span class="op" id="3428487">!=</span>&nbsp;<span class="ident" id="3428490">nil</span>&nbsp;<span class="op" id="3428494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428498">return</span>&nbsp;<span class="ident" id="3428505">nil</span><span class="op" id="3428508">,</span>&nbsp;<span class="op" id="3428510">&amp;</span><span class="ident" id="3428511">OpError</span><span class="op" id="3428518">{</span><span class="ident" id="3428519">Op</span><span class="op" id="3428521">:</span>&nbsp;<span class="string" id="3428523">&#34;listen&#34;</span><span class="op" id="3428531">,</span>&nbsp;<span class="ident" id="3428533">Net</span><span class="op" id="3428536">:</span>&nbsp;<span class="ident" id="3428538">net</span><span class="op" id="3428541">,</span>&nbsp;<span class="ident" id="3428543">Addr</span><span class="op" id="3428547">:</span>&nbsp;<span class="ident" id="3428549">laddr</span><span class="op" id="3428554">,</span>&nbsp;<span class="ident" id="3428556">Err</span><span class="op" id="3428559">:</span>&nbsp;<span class="ident" id="3428561">err</span><span class="op" id="3428564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3428567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428570">return</span>&nbsp;<span class="op" id="3428577">&amp;</span><span class="ident" id="3428578">UnixListener</span><span class="op" id="3428590">{</span><span class="ident" id="3428591">fd</span><span class="op" id="3428593">,</span>&nbsp;<span class="ident" id="3428595">fd</span><span class="op" id="3428597">.</span><span class="ident" id="3428598">laddr</span><span class="op" id="3428603">.</span><span class="ident" id="3428604">String</span><span class="op" id="3428610">(</span><span class="op" id="3428611">)</span><span class="op" id="3428612">}</span><span class="op" id="3428613">,</span>&nbsp;<span class="ident" id="3428615">nil</span><br>
<span class="lineno"></span><span class="op" id="3428619">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="3428622">//&nbsp;AcceptUnix&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3428687">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3428702">func</span>&nbsp;<span class="op" id="3428707">(</span><span class="ident" id="3428708">l</span>&nbsp;<span class="op" id="3428710">*</span><span class="ident" id="3428711">UnixListener</span><span class="op" id="3428723">)</span>&nbsp;<span class="ident" id="3428725">AcceptUnix</span><span class="op" id="3428735">(</span><span class="op" id="3428736">)</span>&nbsp;<span class="op" id="3428738">(</span><span class="op" id="3428739">*</span><span class="ident" id="3428740">UnixConn</span><span class="op" id="3428748">,</span>&nbsp;<span class="builtintype" id="3428750">error</span><span class="op" id="3428755">)</span>&nbsp;<span class="op" id="3428757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428760">if</span>&nbsp;<span class="ident" id="3428763">l</span>&nbsp;<span class="op" id="3428765">==</span>&nbsp;<span class="ident" id="3428768">nil</span>&nbsp;<span class="op" id="3428772">||</span>&nbsp;<span class="ident" id="3428775">l</span><span class="op" id="3428776">.</span><span class="ident" id="3428777">fd</span>&nbsp;<span class="op" id="3428780">==</span>&nbsp;<span class="ident" id="3428783">nil</span>&nbsp;<span class="op" id="3428787">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428791">return</span>&nbsp;<span class="ident" id="3428798">nil</span><span class="op" id="3428801">,</span>&nbsp;<span class="ident" id="3428803">syscall</span><span class="op" id="3428810">.</span><span class="ident" id="3428811">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3428819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428822">fd</span><span class="op" id="3428824">,</span>&nbsp;<span class="ident" id="3428826">err</span>&nbsp;<span class="op" id="3428830">:=</span>&nbsp;<span class="ident" id="3428833">l</span><span class="op" id="3428834">.</span><span class="ident" id="3428835">fd</span><span class="op" id="3428837">.</span><span class="ident" id="3428838">accept</span><span class="op" id="3428844">(</span><span class="op" id="3428845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428848">if</span>&nbsp;<span class="ident" id="3428851">err</span>&nbsp;<span class="op" id="3428855">!=</span>&nbsp;<span class="ident" id="3428858">nil</span>&nbsp;<span class="op" id="3428862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428866">return</span>&nbsp;<span class="ident" id="3428873">nil</span><span class="op" id="3428876">,</span>&nbsp;<span class="ident" id="3428878">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3428883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428886">c</span>&nbsp;<span class="op" id="3428888">:=</span>&nbsp;<span class="ident" id="3428891">newUnixConn</span><span class="op" id="3428902">(</span><span class="ident" id="3428903">fd</span><span class="op" id="3428905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428908">return</span>&nbsp;<span class="ident" id="3428915">c</span><span class="op" id="3428916">,</span>&nbsp;<span class="ident" id="3428918">nil</span><br>
<span class="lineno"></span><span class="op" id="3428922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="3428925">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3428994">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="3429049">func</span>&nbsp;<span class="op" id="3429054">(</span><span class="ident" id="3429055">l</span>&nbsp;<span class="op" id="3429057">*</span><span class="ident" id="3429058">UnixListener</span><span class="op" id="3429070">)</span>&nbsp;<span class="ident" id="3429072">Accept</span><span class="op" id="3429078">(</span><span class="op" id="3429079">)</span>&nbsp;<span class="op" id="3429081">(</span><span class="ident" id="3429082">c</span>&nbsp;<span class="ident" id="3429084">Conn</span><span class="op" id="3429088">,</span>&nbsp;<span class="ident" id="3429090">err</span>&nbsp;<span class="builtintype" id="3429094">error</span><span class="op" id="3429099">)</span>&nbsp;<span class="op" id="3429101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429104">c1</span><span class="op" id="3429106">,</span>&nbsp;<span class="ident" id="3429108">err</span>&nbsp;<span class="op" id="3429112">:=</span>&nbsp;<span class="ident" id="3429115">l</span><span class="op" id="3429116">.</span><span class="ident" id="3429117">AcceptUnix</span><span class="op" id="3429127">(</span><span class="op" id="3429128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429131">if</span>&nbsp;<span class="ident" id="3429134">err</span>&nbsp;<span class="op" id="3429138">!=</span>&nbsp;<span class="ident" id="3429141">nil</span>&nbsp;<span class="op" id="3429145">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429149">return</span>&nbsp;<span class="ident" id="3429156">nil</span><span class="op" id="3429159">,</span>&nbsp;<span class="ident" id="3429161">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3429166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429169">return</span>&nbsp;<span class="ident" id="3429176">c1</span><span class="op" id="3429178">,</span>&nbsp;<span class="ident" id="3429180">nil</span><br>
<span class="lineno"></span><span class="op" id="3429184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3429187">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;Unix&nbsp;address.&nbsp;&nbsp;Already&nbsp;accepted</span><br>
<span class="lineno"></span><span class="comment" id="3429251">//&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="3429282">func</span>&nbsp;<span class="op" id="3429287">(</span><span class="ident" id="3429288">l</span>&nbsp;<span class="op" id="3429290">*</span><span class="ident" id="3429291">UnixListener</span><span class="op" id="3429303">)</span>&nbsp;<span class="ident" id="3429305">Close</span><span class="op" id="3429310">(</span><span class="op" id="3429311">)</span>&nbsp;<span class="builtintype" id="3429313">error</span>&nbsp;<span class="op" id="3429319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429322">if</span>&nbsp;<span class="ident" id="3429325">l</span>&nbsp;<span class="op" id="3429327">==</span>&nbsp;<span class="ident" id="3429330">nil</span>&nbsp;<span class="op" id="3429334">||</span>&nbsp;<span class="ident" id="3429337">l</span><span class="op" id="3429338">.</span><span class="ident" id="3429339">fd</span>&nbsp;<span class="op" id="3429342">==</span>&nbsp;<span class="ident" id="3429345">nil</span>&nbsp;<span class="op" id="3429349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429353">return</span>&nbsp;<span class="ident" id="3429360">syscall</span><span class="op" id="3429367">.</span><span class="ident" id="3429368">EINVAL</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3429376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3429380">//&nbsp;The&nbsp;operating&nbsp;system&nbsp;doesn&#39;t&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3429422">//&nbsp;the&nbsp;file&nbsp;that&nbsp;announcing&nbsp;created,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3429463">//&nbsp;we&nbsp;have&nbsp;to&nbsp;clean&nbsp;it&nbsp;up&nbsp;ourselves.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3429501">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here--we&nbsp;can&#39;t&nbsp;know&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3429544">//&nbsp;sure&nbsp;whether&nbsp;someone&nbsp;else&nbsp;has&nbsp;come&nbsp;along</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3429589">//&nbsp;and&nbsp;replaced&nbsp;our&nbsp;socket&nbsp;name&nbsp;already--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3429632">//&nbsp;but&nbsp;this&nbsp;sequence&nbsp;(remove&nbsp;then&nbsp;close)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3429674">//&nbsp;is&nbsp;at&nbsp;least&nbsp;compatible&nbsp;with&nbsp;the&nbsp;auto-remove</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3429722">//&nbsp;sequence&nbsp;in&nbsp;ListenUnix.&nbsp;&nbsp;It&#39;s&nbsp;only&nbsp;non-Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3429768">//&nbsp;programs&nbsp;that&nbsp;can&nbsp;mess&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429802">if</span>&nbsp;<span class="ident" id="3429805">l</span><span class="op" id="3429806">.</span><span class="ident" id="3429807">path</span><span class="op" id="3429811">[</span><span class="num" id="3429812">0</span><span class="op" id="3429813">]</span>&nbsp;<span class="op" id="3429815">!=</span>&nbsp;<span class="string" id="3429818">&#39;@&#39;</span>&nbsp;<span class="op" id="3429822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429826">syscall</span><span class="op" id="3429833">.</span><span class="ident" id="3429834">Unlink</span><span class="op" id="3429840">(</span><span class="ident" id="3429841">l</span><span class="op" id="3429842">.</span><span class="ident" id="3429843">path</span><span class="op" id="3429847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3429850">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429853">return</span>&nbsp;<span class="ident" id="3429860">l</span><span class="op" id="3429861">.</span><span class="ident" id="3429862">fd</span><span class="op" id="3429864">.</span><span class="ident" id="3429865">Close</span><span class="op" id="3429870">(</span><span class="op" id="3429871">)</span><br>
<span class="lineno"></span><span class="op" id="3429873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3429876">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3429924">func</span>&nbsp;<span class="op" id="3429929">(</span><span class="ident" id="3429930">l</span>&nbsp;<span class="op" id="3429932">*</span><span class="ident" id="3429933">UnixListener</span><span class="op" id="3429945">)</span>&nbsp;<span class="ident" id="3429947">Addr</span><span class="op" id="3429951">(</span><span class="op" id="3429952">)</span>&nbsp;<span class="ident" id="3429954">Addr</span>&nbsp;<span class="op" id="3429959">{</span>&nbsp;<span class="keyword" id="3429961">return</span>&nbsp;<span class="ident" id="3429968">l</span><span class="op" id="3429969">.</span><span class="ident" id="3429970">fd</span><span class="op" id="3429972">.</span><span class="ident" id="3429973">laddr</span>&nbsp;<span class="op" id="3429979">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="3429982">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="3430045">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3430089">func</span>&nbsp;<span class="op" id="3430094">(</span><span class="ident" id="3430095">l</span>&nbsp;<span class="op" id="3430097">*</span><span class="ident" id="3430098">UnixListener</span><span class="op" id="3430110">)</span>&nbsp;<span class="ident" id="3430112">SetDeadline</span><span class="op" id="3430123">(</span><span class="ident" id="3430124">t</span>&nbsp;<span class="ident" id="3430126">time</span><span class="op" id="3430130">.</span><span class="ident" id="3430131">Time</span><span class="op" id="3430135">)</span>&nbsp;<span class="op" id="3430137">(</span><span class="ident" id="3430138">err</span>&nbsp;<span class="builtintype" id="3430142">error</span><span class="op" id="3430147">)</span>&nbsp;<span class="op" id="3430149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430152">if</span>&nbsp;<span class="ident" id="3430155">l</span>&nbsp;<span class="op" id="3430157">==</span>&nbsp;<span class="ident" id="3430160">nil</span>&nbsp;<span class="op" id="3430164">||</span>&nbsp;<span class="ident" id="3430167">l</span><span class="op" id="3430168">.</span><span class="ident" id="3430169">fd</span>&nbsp;<span class="op" id="3430172">==</span>&nbsp;<span class="ident" id="3430175">nil</span>&nbsp;<span class="op" id="3430179">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430183">return</span>&nbsp;<span class="ident" id="3430190">syscall</span><span class="op" id="3430197">.</span><span class="ident" id="3430198">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430209">return</span>&nbsp;<span class="ident" id="3430216">l</span><span class="op" id="3430217">.</span><span class="ident" id="3430218">fd</span><span class="op" id="3430220">.</span><span class="ident" id="3430221">setDeadline</span><span class="op" id="3430232">(</span><span class="ident" id="3430233">t</span><span class="op" id="3430234">)</span><br>
<span class="lineno"></span><span class="op" id="3430236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="3430239">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="3430305">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="3430375">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno"></span><span class="comment" id="3430440">//</span><br>
<span class="lineno"></span><span class="comment" id="3430443">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno">340</span><span class="comment" id="3430507">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="3430573">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="3430637">func</span>&nbsp;<span class="op" id="3430642">(</span><span class="ident" id="3430643">l</span>&nbsp;<span class="op" id="3430645">*</span><span class="ident" id="3430646">UnixListener</span><span class="op" id="3430658">)</span>&nbsp;<span class="ident" id="3430660">File</span><span class="op" id="3430664">(</span><span class="op" id="3430665">)</span>&nbsp;<span class="op" id="3430667">(</span><span class="ident" id="3430668">f</span>&nbsp;<span class="op" id="3430670">*</span><span class="ident" id="3430671">os</span><span class="op" id="3430673">.</span><span class="ident" id="3430674">File</span><span class="op" id="3430678">,</span>&nbsp;<span class="ident" id="3430680">err</span>&nbsp;<span class="builtintype" id="3430684">error</span><span class="op" id="3430689">)</span>&nbsp;<span class="op" id="3430691">{</span>&nbsp;<span class="keyword" id="3430693">return</span>&nbsp;<span class="ident" id="3430700">l</span><span class="op" id="3430701">.</span><span class="ident" id="3430702">fd</span><span class="op" id="3430704">.</span><span class="ident" id="3430705">dup</span><span class="op" id="3430708">(</span><span class="op" id="3430709">)</span>&nbsp;<span class="op" id="3430711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3430714">//&nbsp;ListenUnixgram&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;Unix&nbsp;datagram&nbsp;packets&nbsp;addressed</span><br>
<span class="lineno">345</span><span class="comment" id="3430785">//&nbsp;to&nbsp;the&nbsp;local&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3430853">//&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;methods&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3430923">//&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;packets&nbsp;with&nbsp;per-packet&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3430982">func</span>&nbsp;<span class="ident" id="3430987">ListenUnixgram</span><span class="op" id="3431001">(</span><span class="ident" id="3431002">net</span>&nbsp;<span class="builtintype" id="3431006">string</span><span class="op" id="3431012">,</span>&nbsp;<span class="ident" id="3431014">laddr</span>&nbsp;<span class="op" id="3431020">*</span><span class="ident" id="3431021">UnixAddr</span><span class="op" id="3431029">)</span>&nbsp;<span class="op" id="3431031">(</span><span class="op" id="3431032">*</span><span class="ident" id="3431033">UnixConn</span><span class="op" id="3431041">,</span>&nbsp;<span class="builtintype" id="3431043">error</span><span class="op" id="3431048">)</span>&nbsp;<span class="op" id="3431050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431053">switch</span>&nbsp;<span class="ident" id="3431060">net</span>&nbsp;<span class="op" id="3431064">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431067">case</span>&nbsp;<span class="string" id="3431072">&#34;unixgram&#34;</span><span class="op" id="3431082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431085">default</span><span class="op" id="3431092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431096">return</span>&nbsp;<span class="ident" id="3431103">nil</span><span class="op" id="3431106">,</span>&nbsp;<span class="op" id="3431108">&amp;</span><span class="ident" id="3431109">OpError</span><span class="op" id="3431116">{</span><span class="ident" id="3431117">Op</span><span class="op" id="3431119">:</span>&nbsp;<span class="string" id="3431121">&#34;listen&#34;</span><span class="op" id="3431129">,</span>&nbsp;<span class="ident" id="3431131">Net</span><span class="op" id="3431134">:</span>&nbsp;<span class="ident" id="3431136">net</span><span class="op" id="3431139">,</span>&nbsp;<span class="ident" id="3431141">Addr</span><span class="op" id="3431145">:</span>&nbsp;<span class="ident" id="3431147">laddr</span><span class="op" id="3431152">,</span>&nbsp;<span class="ident" id="3431154">Err</span><span class="op" id="3431157">:</span>&nbsp;<span class="ident" id="3431159">UnknownNetworkError</span><span class="op" id="3431178">(</span><span class="ident" id="3431179">net</span><span class="op" id="3431182">)</span><span class="op" id="3431183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431189">if</span>&nbsp;<span class="ident" id="3431192">laddr</span>&nbsp;<span class="op" id="3431198">==</span>&nbsp;<span class="ident" id="3431201">nil</span>&nbsp;<span class="op" id="3431205">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431209">return</span>&nbsp;<span class="ident" id="3431216">nil</span><span class="op" id="3431219">,</span>&nbsp;<span class="op" id="3431221">&amp;</span><span class="ident" id="3431222">OpError</span><span class="op" id="3431229">{</span><span class="ident" id="3431230">Op</span><span class="op" id="3431232">:</span>&nbsp;<span class="string" id="3431234">&#34;listen&#34;</span><span class="op" id="3431242">,</span>&nbsp;<span class="ident" id="3431244">Net</span><span class="op" id="3431247">:</span>&nbsp;<span class="ident" id="3431249">net</span><span class="op" id="3431252">,</span>&nbsp;<span class="ident" id="3431254">Addr</span><span class="op" id="3431258">:</span>&nbsp;<span class="ident" id="3431260">nil</span><span class="op" id="3431263">,</span>&nbsp;<span class="ident" id="3431265">Err</span><span class="op" id="3431268">:</span>&nbsp;<span class="ident" id="3431270">errMissingAddress</span><span class="op" id="3431287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431293">fd</span><span class="op" id="3431295">,</span>&nbsp;<span class="ident" id="3431297">err</span>&nbsp;<span class="op" id="3431301">:=</span>&nbsp;<span class="ident" id="3431304">unixSocket</span><span class="op" id="3431314">(</span><span class="ident" id="3431315">net</span><span class="op" id="3431318">,</span>&nbsp;<span class="ident" id="3431320">laddr</span><span class="op" id="3431325">,</span>&nbsp;<span class="ident" id="3431327">nil</span><span class="op" id="3431330">,</span>&nbsp;<span class="string" id="3431332">&#34;listen&#34;</span><span class="op" id="3431340">,</span>&nbsp;<span class="ident" id="3431342">noDeadline</span><span class="op" id="3431352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431355">if</span>&nbsp;<span class="ident" id="3431358">err</span>&nbsp;<span class="op" id="3431362">!=</span>&nbsp;<span class="ident" id="3431365">nil</span>&nbsp;<span class="op" id="3431369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431373">return</span>&nbsp;<span class="ident" id="3431380">nil</span><span class="op" id="3431383">,</span>&nbsp;<span class="op" id="3431385">&amp;</span><span class="ident" id="3431386">OpError</span><span class="op" id="3431393">{</span><span class="ident" id="3431394">Op</span><span class="op" id="3431396">:</span>&nbsp;<span class="string" id="3431398">&#34;listen&#34;</span><span class="op" id="3431406">,</span>&nbsp;<span class="ident" id="3431408">Net</span><span class="op" id="3431411">:</span>&nbsp;<span class="ident" id="3431413">net</span><span class="op" id="3431416">,</span>&nbsp;<span class="ident" id="3431418">Addr</span><span class="op" id="3431422">:</span>&nbsp;<span class="ident" id="3431424">laddr</span><span class="op" id="3431429">,</span>&nbsp;<span class="ident" id="3431431">Err</span><span class="op" id="3431434">:</span>&nbsp;<span class="ident" id="3431436">err</span><span class="op" id="3431439">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431445">return</span>&nbsp;<span class="ident" id="3431452">newUnixConn</span><span class="op" id="3431463">(</span><span class="ident" id="3431464">fd</span><span class="op" id="3431466">)</span><span class="op" id="3431467">,</span>&nbsp;<span class="ident" id="3431469">nil</span><br>
<span class="lineno"></span><span class="op" id="3431473">}</span>
</div>
</body>
</html>
