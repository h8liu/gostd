<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2517362">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2517418">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2517472">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2517523">package</span>&nbsp;<span class="ident" id="2517531">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2517536">import</span>&nbsp;<span class="op" id="2517543">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2517546">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2517556">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="2517563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2517566">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="2517625">//</span><br>
<span class="lineno"></span><span class="comment" id="2517628">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="2517686">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="2517748">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="2517810">type</span>&nbsp;<span class="ident" id="2517815">Dialer</span>&nbsp;<span class="keyword" id="2517822">struct</span>&nbsp;<span class="op" id="2517829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2517832">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2517895">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2517959">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2517972">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2517976">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518007">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518011">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518074">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518134">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2518162">Timeout</span>&nbsp;<span class="ident" id="2518170"><a href="/net/dial.go.html#2517556">time</a></span><span class="op" id="2518174">.</span><span class="ident" id="2518175">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518186">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518247">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518302">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518367">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2518399">Deadline</span>&nbsp;<span class="ident" id="2518408"><a href="/net/dial.go.html#2517556">time</a></span><span class="op" id="2518412">.</span><span class="ident" id="2518413">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518420">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518478">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518540">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518566">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2518619">LocalAddr</span>&nbsp;<span class="ident" id="2518629"><a href="/net/net.go.html#2652238">Addr</a></span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518636">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518695">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518758">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518819">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518883">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2518900">DualStack</span>&nbsp;<span class="builtintype" id="2518910">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518917">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2518977">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2519001">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2519061">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519116">KeepAlive</span>&nbsp;<span class="ident" id="2519126"><a href="/net/dial.go.html#2517556">time</a></span><span class="op" id="2519130">.</span><span class="ident" id="2519131">Duration</span><br>
<span class="lineno"></span><span class="op" id="2519140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="2519143">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="2519208">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="2519239">func</span>&nbsp;<span class="op" id="2519244">(</span><span class="ident" id="2519245">d</span>&nbsp;<span class="op" id="2519247">*</span><span class="ident" id="2519248"><a href="/net/dial.go.html#2517815">Dialer</a></span><span class="op" id="2519254">)</span>&nbsp;<span class="ident" id="2519256">deadline</span><span class="op" id="2519264">(</span><span class="op" id="2519265">)</span>&nbsp;<span class="ident" id="2519267"><a href="/net/dial.go.html#2517556">time</a></span><span class="op" id="2519271">.</span><span class="ident" id="2519272">Time</span>&nbsp;<span class="op" id="2519277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519280">if</span>&nbsp;<span class="ident" id="2519283"><a href="/net/dial.go.html#2519245">d</a></span><span class="op" id="2519284">.</span><span class="ident" id="2519285">Timeout</span>&nbsp;<span class="op" id="2519293">==</span>&nbsp;<span class="num" id="2519296">0</span>&nbsp;<span class="op" id="2519298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519302">return</span>&nbsp;<span class="ident" id="2519309"><a href="/net/dial.go.html#2519245">d</a></span><span class="op" id="2519310">.</span><span class="ident" id="2519311">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2519321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519324">timeoutDeadline</span>&nbsp;<span class="op" id="2519340">:=</span>&nbsp;<span class="ident" id="2519343"><a href="/net/dial.go.html#2517556">time</a></span><span class="op" id="2519347">.</span><span class="ident" id="2519348">Now</span><span class="op" id="2519351">(</span><span class="op" id="2519352">)</span><span class="op" id="2519353">.</span><span class="ident" id="2519354">Add</span><span class="op" id="2519357">(</span><span class="ident" id="2519358"><a href="/net/dial.go.html#2519245">d</a></span><span class="op" id="2519359">.</span><span class="ident" id="2519360">Timeout</span><span class="op" id="2519367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519370">if</span>&nbsp;<span class="ident" id="2519373"><a href="/net/dial.go.html#2519245">d</a></span><span class="op" id="2519374">.</span><span class="ident" id="2519375">Deadline</span><span class="op" id="2519383">.</span><span class="ident" id="2519384">IsZero</span><span class="op" id="2519390">(</span><span class="op" id="2519391">)</span>&nbsp;<span class="op" id="2519393">||</span>&nbsp;<span class="ident" id="2519396"><a href="/net/dial.go.html#2519324">timeoutDeadline</a></span><span class="op" id="2519411">.</span><span class="ident" id="2519412">Before</span><span class="op" id="2519418">(</span><span class="ident" id="2519419"><a href="/net/dial.go.html#2519245">d</a></span><span class="op" id="2519420">.</span><span class="ident" id="2519421">Deadline</span><span class="op" id="2519429">)</span>&nbsp;<span class="op" id="2519431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519435">return</span>&nbsp;<span class="ident" id="2519442"><a href="/net/dial.go.html#2519324">timeoutDeadline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2519459">}</span>&nbsp;<span class="keyword" id="2519461">else</span>&nbsp;<span class="op" id="2519466">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519470">return</span>&nbsp;<span class="ident" id="2519477"><a href="/net/dial.go.html#2519245">d</a></span><span class="op" id="2519478">.</span><span class="ident" id="2519479">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2519489">}</span><br>
<span class="lineno"></span><span class="op" id="2519491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2519494">func</span>&nbsp;<span class="ident" id="2519499">parseNetwork</span><span class="op" id="2519511">(</span><span class="ident" id="2519512">net</span>&nbsp;<span class="builtintype" id="2519516">string</span><span class="op" id="2519522">)</span>&nbsp;<span class="op" id="2519524">(</span><span class="ident" id="2519525">afnet</span>&nbsp;<span class="builtintype" id="2519531">string</span><span class="op" id="2519537">,</span>&nbsp;<span class="ident" id="2519539">proto</span>&nbsp;<span class="builtintype" id="2519545">int</span><span class="op" id="2519548">,</span>&nbsp;<span class="ident" id="2519550">err</span>&nbsp;<span class="builtintype" id="2519554">error</span><span class="op" id="2519559">)</span>&nbsp;<span class="op" id="2519561">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519564">i</span>&nbsp;<span class="op" id="2519566">:=</span>&nbsp;<span class="ident" id="2519569"><a href="/net/parse.go.html#2667199">last</a></span><span class="op" id="2519573">(</span><span class="ident" id="2519574"><a href="/net/dial.go.html#2519512">net</a></span><span class="op" id="2519577">,</span>&nbsp;<span class="string" id="2519579">&#39;:&#39;</span><span class="op" id="2519582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519585">if</span>&nbsp;<span class="ident" id="2519588"><a href="/net/dial.go.html#2519564">i</a></span>&nbsp;<span class="op" id="2519590">&lt;</span>&nbsp;<span class="num" id="2519592">0</span>&nbsp;<span class="op" id="2519594">{</span>&nbsp;<span class="comment" id="2519596">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519610">switch</span>&nbsp;<span class="ident" id="2519617"><a href="/net/dial.go.html#2519512">net</a></span>&nbsp;<span class="op" id="2519621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519625">case</span>&nbsp;<span class="string" id="2519630">&#34;tcp&#34;</span><span class="op" id="2519635">,</span>&nbsp;<span class="string" id="2519637">&#34;tcp4&#34;</span><span class="op" id="2519643">,</span>&nbsp;<span class="string" id="2519645">&#34;tcp6&#34;</span><span class="op" id="2519651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519655">case</span>&nbsp;<span class="string" id="2519660">&#34;udp&#34;</span><span class="op" id="2519665">,</span>&nbsp;<span class="string" id="2519667">&#34;udp4&#34;</span><span class="op" id="2519673">,</span>&nbsp;<span class="string" id="2519675">&#34;udp6&#34;</span><span class="op" id="2519681">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519685">case</span>&nbsp;<span class="string" id="2519690">&#34;ip&#34;</span><span class="op" id="2519694">,</span>&nbsp;<span class="string" id="2519696">&#34;ip4&#34;</span><span class="op" id="2519701">,</span>&nbsp;<span class="string" id="2519703">&#34;ip6&#34;</span><span class="op" id="2519708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519712">case</span>&nbsp;<span class="string" id="2519717">&#34;unix&#34;</span><span class="op" id="2519723">,</span>&nbsp;<span class="string" id="2519725">&#34;unixgram&#34;</span><span class="op" id="2519735">,</span>&nbsp;<span class="string" id="2519737">&#34;unixpacket&#34;</span><span class="op" id="2519749">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519753">default</span><span class="op" id="2519760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519765">return</span>&nbsp;<span class="string" id="2519772">&#34;&#34;</span><span class="op" id="2519774">,</span>&nbsp;<span class="num" id="2519776">0</span><span class="op" id="2519777">,</span>&nbsp;<span class="ident" id="2519779"><a href="/net/net.go.html#2661008">UnknownNetworkError</a></span><span class="op" id="2519798">(</span><span class="ident" id="2519799"><a href="/net/dial.go.html#2519512">net</a></span><span class="op" id="2519802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2519806">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519810">return</span>&nbsp;<span class="ident" id="2519817"><a href="/net/dial.go.html#2519512">net</a></span><span class="op" id="2519820">,</span>&nbsp;<span class="num" id="2519822">0</span><span class="op" id="2519823">,</span>&nbsp;<span class="ident" id="2519825">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2519830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519833"><a href="/net/dial.go.html#2519525">afnet</a></span>&nbsp;<span class="op" id="2519839">=</span>&nbsp;<span class="ident" id="2519841"><a href="/net/dial.go.html#2519512">net</a></span><span class="op" id="2519844">[</span><span class="op" id="2519845">:</span><span class="ident" id="2519846"><a href="/net/dial.go.html#2519564">i</a></span><span class="op" id="2519847">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519850">switch</span>&nbsp;<span class="ident" id="2519857"><a href="/net/dial.go.html#2519525">afnet</a></span>&nbsp;<span class="op" id="2519863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519866">case</span>&nbsp;<span class="string" id="2519871">&#34;ip&#34;</span><span class="op" id="2519875">,</span>&nbsp;<span class="string" id="2519877">&#34;ip4&#34;</span><span class="op" id="2519882">,</span>&nbsp;<span class="string" id="2519884">&#34;ip6&#34;</span><span class="op" id="2519889">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519893">protostr</span>&nbsp;<span class="op" id="2519902">:=</span>&nbsp;<span class="ident" id="2519905"><a href="/net/dial.go.html#2519512">net</a></span><span class="op" id="2519908">[</span><span class="ident" id="2519909"><a href="/net/dial.go.html#2519564">i</a></span><span class="op" id="2519910">+</span><span class="num" id="2519911">1</span><span class="op" id="2519912">:</span><span class="op" id="2519913">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519917">proto</span><span class="op" id="2519922">,</span>&nbsp;<span class="ident" id="2519924">i</span><span class="op" id="2519925">,</span>&nbsp;<span class="ident" id="2519927">ok</span>&nbsp;<span class="op" id="2519930">:=</span>&nbsp;<span class="ident" id="2519933"><a href="/net/parse.go.html#2665011">dtoi</a></span><span class="op" id="2519937">(</span><span class="ident" id="2519938"><a href="/net/dial.go.html#2519893">protostr</a></span><span class="op" id="2519946">,</span>&nbsp;<span class="num" id="2519948">0</span><span class="op" id="2519949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2519953">if</span>&nbsp;<span class="op" id="2519956">!</span><span class="ident" id="2519957"><a href="/net/dial.go.html#2519927">ok</a></span>&nbsp;<span class="op" id="2519960">||</span>&nbsp;<span class="ident" id="2519963"><a href="/net/dial.go.html#2519924">i</a></span>&nbsp;<span class="op" id="2519965">!=</span>&nbsp;<span class="builtinfunc" id="2519968">len</span><span class="op" id="2519971">(</span><span class="ident" id="2519972"><a href="/net/dial.go.html#2519893">protostr</a></span><span class="op" id="2519980">)</span>&nbsp;<span class="op" id="2519982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2519987"><a href="/net/dial.go.html#2519917">proto</a></span><span class="op" id="2519992">,</span>&nbsp;<span class="ident" id="2519994"><a href="/net/dial.go.html#2519550">err</a></span>&nbsp;<span class="op" id="2519998">=</span>&nbsp;<span class="ident" id="2520000"><a href="/net/lookup_unix.go.html#2646743">lookupProtocol</a></span><span class="op" id="2520014">(</span><span class="ident" id="2520015"><a href="/net/dial.go.html#2519893">protostr</a></span><span class="op" id="2520023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520028">if</span>&nbsp;<span class="ident" id="2520031"><a href="/net/dial.go.html#2519550">err</a></span>&nbsp;<span class="op" id="2520035">!=</span>&nbsp;<span class="ident" id="2520038">nil</span>&nbsp;<span class="op" id="2520042">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520048">return</span>&nbsp;<span class="string" id="2520055">&#34;&#34;</span><span class="op" id="2520057">,</span>&nbsp;<span class="num" id="2520059">0</span><span class="op" id="2520060">,</span>&nbsp;<span class="ident" id="2520062"><a href="/net/dial.go.html#2519550">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2520069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2520073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520077">return</span>&nbsp;<span class="ident" id="2520084"><a href="/net/dial.go.html#2519525">afnet</a></span><span class="op" id="2520089">,</span>&nbsp;<span class="ident" id="2520091"><a href="/net/dial.go.html#2519917">proto</a></span><span class="op" id="2520096">,</span>&nbsp;<span class="ident" id="2520098">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2520103">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520106">return</span>&nbsp;<span class="string" id="2520113">&#34;&#34;</span><span class="op" id="2520115">,</span>&nbsp;<span class="num" id="2520117">0</span><span class="op" id="2520118">,</span>&nbsp;<span class="ident" id="2520120"><a href="/net/net.go.html#2661008">UnknownNetworkError</a></span><span class="op" id="2520139">(</span><span class="ident" id="2520140"><a href="/net/dial.go.html#2519512">net</a></span><span class="op" id="2520143">)</span><br>
<span class="lineno"></span><span class="op" id="2520145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2520148">func</span>&nbsp;<span class="ident" id="2520153">resolveAddr</span><span class="op" id="2520164">(</span><span class="ident" id="2520165">op</span><span class="op" id="2520167">,</span>&nbsp;<span class="ident" id="2520169">net</span><span class="op" id="2520172">,</span>&nbsp;<span class="ident" id="2520174">addr</span>&nbsp;<span class="builtintype" id="2520179">string</span><span class="op" id="2520185">,</span>&nbsp;<span class="ident" id="2520187">deadline</span>&nbsp;<span class="ident" id="2520196"><a href="/net/dial.go.html#2517556">time</a></span><span class="op" id="2520200">.</span><span class="ident" id="2520201">Time</span><span class="op" id="2520205">)</span>&nbsp;<span class="op" id="2520207">(</span><span class="ident" id="2520208"><a href="/net/ipsock.go.html#2628205">netaddr</a></span><span class="op" id="2520215">,</span>&nbsp;<span class="builtintype" id="2520217">error</span><span class="op" id="2520222">)</span>&nbsp;<span class="op" id="2520224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2520227">afnet</span><span class="op" id="2520232">,</span>&nbsp;<span class="ident" id="2520234">_</span><span class="op" id="2520235">,</span>&nbsp;<span class="ident" id="2520237">err</span>&nbsp;<span class="op" id="2520241">:=</span>&nbsp;<span class="ident" id="2520244"><a href="/net/dial.go.html#2519499">parseNetwork</a></span><span class="op" id="2520256">(</span><span class="ident" id="2520257"><a href="/net/dial.go.html#2520169">net</a></span><span class="op" id="2520260">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520263">if</span>&nbsp;<span class="ident" id="2520266"><a href="/net/dial.go.html#2520237">err</a></span>&nbsp;<span class="op" id="2520270">!=</span>&nbsp;<span class="ident" id="2520273">nil</span>&nbsp;<span class="op" id="2520277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520281">return</span>&nbsp;<span class="ident" id="2520288">nil</span><span class="op" id="2520291">,</span>&nbsp;<span class="ident" id="2520293"><a href="/net/dial.go.html#2520237">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2520298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520301">if</span>&nbsp;<span class="ident" id="2520304"><a href="/net/dial.go.html#2520165">op</a></span>&nbsp;<span class="op" id="2520307">==</span>&nbsp;<span class="string" id="2520310">&#34;dial&#34;</span>&nbsp;<span class="op" id="2520317">&amp;&amp;</span>&nbsp;<span class="ident" id="2520320"><a href="/net/dial.go.html#2520174">addr</a></span>&nbsp;<span class="op" id="2520325">==</span>&nbsp;<span class="string" id="2520328">&#34;&#34;</span>&nbsp;<span class="op" id="2520331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520335">return</span>&nbsp;<span class="ident" id="2520342">nil</span><span class="op" id="2520345">,</span>&nbsp;<span class="ident" id="2520347"><a href="/net/net.go.html#2659161">errMissingAddress</a></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2520366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520369">switch</span>&nbsp;<span class="ident" id="2520376"><a href="/net/dial.go.html#2520227">afnet</a></span>&nbsp;<span class="op" id="2520382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520385">case</span>&nbsp;<span class="string" id="2520390">&#34;unix&#34;</span><span class="op" id="2520396">,</span>&nbsp;<span class="string" id="2520398">&#34;unixgram&#34;</span><span class="op" id="2520408">,</span>&nbsp;<span class="string" id="2520410">&#34;unixpacket&#34;</span><span class="op" id="2520422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520426">return</span>&nbsp;<span class="ident" id="2520433"><a href="/net/unixsock.go.html#2714067">ResolveUnixAddr</a></span><span class="op" id="2520448">(</span><span class="ident" id="2520449"><a href="/net/dial.go.html#2520227">afnet</a></span><span class="op" id="2520454">,</span>&nbsp;<span class="ident" id="2520456"><a href="/net/dial.go.html#2520174">addr</a></span><span class="op" id="2520460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2520463">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2520466">return</span>&nbsp;<span class="ident" id="2520473"><a href="/net/ipsock.go.html#2633734">resolveInternetAddr</a></span><span class="op" id="2520492">(</span><span class="ident" id="2520493"><a href="/net/dial.go.html#2520227">afnet</a></span><span class="op" id="2520498">,</span>&nbsp;<span class="ident" id="2520500"><a href="/net/dial.go.html#2520174">addr</a></span><span class="op" id="2520504">,</span>&nbsp;<span class="ident" id="2520506"><a href="/net/dial.go.html#2520187">deadline</a></span><span class="op" id="2520514">)</span><br>
<span class="lineno"></span><span class="op" id="2520516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2520519">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="2520573">//</span><br>
<span class="lineno">115</span><span class="comment" id="2520576">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="2520645">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2520707">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2520765">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2520782">//</span><br>
<span class="lineno">120</span><span class="comment" id="2520785">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="2520849">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="2520906">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2520971">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="2521040">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="2521057">//</span><br>
<span class="lineno"></span><span class="comment" id="2521060">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="2521073">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="2521106">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="2521140">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="2521177">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="2521212">//</span><br>
<span class="lineno"></span><span class="comment" id="2521215">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="2521285">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2521352">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="2521375">//</span><br>
<span class="lineno"></span><span class="comment" id="2521378">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="2521391">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="2521421">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="2521448">//</span><br>
<span class="lineno">140</span><span class="comment" id="2521451">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="2521513">func</span>&nbsp;<span class="ident" id="2521518">Dial</span><span class="op" id="2521522">(</span><span class="ident" id="2521523">network</span><span class="op" id="2521530">,</span>&nbsp;<span class="ident" id="2521532">address</span>&nbsp;<span class="builtintype" id="2521540">string</span><span class="op" id="2521546">)</span>&nbsp;<span class="op" id="2521548">(</span><span class="ident" id="2521549"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="2521553">,</span>&nbsp;<span class="builtintype" id="2521555">error</span><span class="op" id="2521560">)</span>&nbsp;<span class="op" id="2521562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2521565">var</span>&nbsp;<span class="ident" id="2521569">d</span>&nbsp;<span class="ident" id="2521571"><a href="/net/dial.go.html#2517815">Dialer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2521579">return</span>&nbsp;<span class="ident" id="2521586"><a href="/net/dial.go.html#2521569">d</a></span><span class="op" id="2521587">.</span><span class="ident" id="2521588">Dial</span><span class="op" id="2521592">(</span><span class="ident" id="2521593"><a href="/net/dial.go.html#2521523">network</a></span><span class="op" id="2521600">,</span>&nbsp;<span class="ident" id="2521602"><a href="/net/dial.go.html#2521532">address</a></span><span class="op" id="2521609">)</span><br>
<span class="lineno"></span><span class="op" id="2521611">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="2521614">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="2521665">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="2521719">func</span>&nbsp;<span class="ident" id="2521724">DialTimeout</span><span class="op" id="2521735">(</span><span class="ident" id="2521736">network</span><span class="op" id="2521743">,</span>&nbsp;<span class="ident" id="2521745">address</span>&nbsp;<span class="builtintype" id="2521753">string</span><span class="op" id="2521759">,</span>&nbsp;<span class="ident" id="2521761">timeout</span>&nbsp;<span class="ident" id="2521769"><a href="/net/dial.go.html#2517556">time</a></span><span class="op" id="2521773">.</span><span class="ident" id="2521774">Duration</span><span class="op" id="2521782">)</span>&nbsp;<span class="op" id="2521784">(</span><span class="ident" id="2521785"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="2521789">,</span>&nbsp;<span class="builtintype" id="2521791">error</span><span class="op" id="2521796">)</span>&nbsp;<span class="op" id="2521798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2521801">d</span>&nbsp;<span class="op" id="2521803">:=</span>&nbsp;<span class="ident" id="2521806"><a href="/net/dial.go.html#2517815">Dialer</a></span><span class="op" id="2521812">{</span><span class="ident" id="2521813">Timeout</span><span class="op" id="2521820">:</span>&nbsp;<span class="ident" id="2521822"><a href="/net/dial.go.html#2521761">timeout</a></span><span class="op" id="2521829">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2521832">return</span>&nbsp;<span class="ident" id="2521839"><a href="/net/dial.go.html#2521801">d</a></span><span class="op" id="2521840">.</span><span class="ident" id="2521841">Dial</span><span class="op" id="2521845">(</span><span class="ident" id="2521846"><a href="/net/dial.go.html#2521736">network</a></span><span class="op" id="2521853">,</span>&nbsp;<span class="ident" id="2521855"><a href="/net/dial.go.html#2521745">address</a></span><span class="op" id="2521862">)</span><br>
<span class="lineno"></span><span class="op" id="2521864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2521867">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="2521921">//</span><br>
<span class="lineno">155</span><span class="comment" id="2521924">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="2521986">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="2522001">func</span>&nbsp;<span class="op" id="2522006">(</span><span class="ident" id="2522007">d</span>&nbsp;<span class="op" id="2522009">*</span><span class="ident" id="2522010"><a href="/net/dial.go.html#2517815">Dialer</a></span><span class="op" id="2522016">)</span>&nbsp;<span class="ident" id="2522018">Dial</span><span class="op" id="2522022">(</span><span class="ident" id="2522023">network</span><span class="op" id="2522030">,</span>&nbsp;<span class="ident" id="2522032">address</span>&nbsp;<span class="builtintype" id="2522040">string</span><span class="op" id="2522046">)</span>&nbsp;<span class="op" id="2522048">(</span><span class="ident" id="2522049"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="2522053">,</span>&nbsp;<span class="builtintype" id="2522055">error</span><span class="op" id="2522060">)</span>&nbsp;<span class="op" id="2522062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522065">ra</span><span class="op" id="2522067">,</span>&nbsp;<span class="ident" id="2522069">err</span>&nbsp;<span class="op" id="2522073">:=</span>&nbsp;<span class="ident" id="2522076"><a href="/net/dial.go.html#2520153">resolveAddr</a></span><span class="op" id="2522087">(</span><span class="string" id="2522088">&#34;dial&#34;</span><span class="op" id="2522094">,</span>&nbsp;<span class="ident" id="2522096"><a href="/net/dial.go.html#2522023">network</a></span><span class="op" id="2522103">,</span>&nbsp;<span class="ident" id="2522105"><a href="/net/dial.go.html#2522032">address</a></span><span class="op" id="2522112">,</span>&nbsp;<span class="ident" id="2522114"><a href="/net/dial.go.html#2522007">d</a></span><span class="op" id="2522115">.</span><span class="ident" id="2522116">deadline</span><span class="op" id="2522124">(</span><span class="op" id="2522125">)</span><span class="op" id="2522126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522129">if</span>&nbsp;<span class="ident" id="2522132"><a href="/net/dial.go.html#2522069">err</a></span>&nbsp;<span class="op" id="2522136">!=</span>&nbsp;<span class="ident" id="2522139">nil</span>&nbsp;<span class="op" id="2522143">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522147">return</span>&nbsp;<span class="ident" id="2522154">nil</span><span class="op" id="2522157">,</span>&nbsp;<span class="op" id="2522159">&amp;</span><span class="ident" id="2522160"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2522167">{</span><span class="ident" id="2522168">Op</span><span class="op" id="2522170">:</span>&nbsp;<span class="string" id="2522172">&#34;dial&#34;</span><span class="op" id="2522178">,</span>&nbsp;<span class="ident" id="2522180">Net</span><span class="op" id="2522183">:</span>&nbsp;<span class="ident" id="2522185"><a href="/net/dial.go.html#2522023">network</a></span><span class="op" id="2522192">,</span>&nbsp;<span class="ident" id="2522194">Addr</span><span class="op" id="2522198">:</span>&nbsp;<span class="ident" id="2522200">nil</span><span class="op" id="2522203">,</span>&nbsp;<span class="ident" id="2522205">Err</span><span class="op" id="2522208">:</span>&nbsp;<span class="ident" id="2522210"><a href="/net/dial.go.html#2522069">err</a></span><span class="op" id="2522213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2522216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522219">dialer</span>&nbsp;<span class="op" id="2522226">:=</span>&nbsp;<span class="keyword" id="2522229">func</span><span class="op" id="2522233">(</span><span class="ident" id="2522234">deadline</span>&nbsp;<span class="ident" id="2522243"><a href="/net/dial.go.html#2517556">time</a></span><span class="op" id="2522247">.</span><span class="ident" id="2522248">Time</span><span class="op" id="2522252">)</span>&nbsp;<span class="op" id="2522254">(</span><span class="ident" id="2522255"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="2522259">,</span>&nbsp;<span class="builtintype" id="2522261">error</span><span class="op" id="2522266">)</span>&nbsp;<span class="op" id="2522268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522272">return</span>&nbsp;<span class="ident" id="2522279"><a href="/net/dial.go.html#2524126">dialSingle</a></span><span class="op" id="2522289">(</span><span class="ident" id="2522290"><a href="/net/dial.go.html#2522023">network</a></span><span class="op" id="2522297">,</span>&nbsp;<span class="ident" id="2522299"><a href="/net/dial.go.html#2522032">address</a></span><span class="op" id="2522306">,</span>&nbsp;<span class="ident" id="2522308"><a href="/net/dial.go.html#2522007">d</a></span><span class="op" id="2522309">.</span><span class="ident" id="2522310">LocalAddr</span><span class="op" id="2522319">,</span>&nbsp;<span class="ident" id="2522321"><a href="/net/dial.go.html#2522065">ra</a></span><span class="op" id="2522323">.</span><span class="ident" id="2522324">toAddr</span><span class="op" id="2522330">(</span><span class="op" id="2522331">)</span><span class="op" id="2522332">,</span>&nbsp;<span class="ident" id="2522334"><a href="/net/dial.go.html#2522234">deadline</a></span><span class="op" id="2522342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2522345">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522348">if</span>&nbsp;<span class="ident" id="2522351">ras</span><span class="op" id="2522354">,</span>&nbsp;<span class="ident" id="2522356">ok</span>&nbsp;<span class="op" id="2522359">:=</span>&nbsp;<span class="ident" id="2522362"><a href="/net/dial.go.html#2522065">ra</a></span><span class="op" id="2522364">.</span><span class="op" id="2522365">(</span><span class="ident" id="2522366"><a href="/net/ipsock.go.html#2628430">addrList</a></span><span class="op" id="2522374">)</span><span class="op" id="2522375">;</span>&nbsp;<span class="ident" id="2522377"><a href="/net/dial.go.html#2522356">ok</a></span>&nbsp;<span class="op" id="2522380">&amp;&amp;</span>&nbsp;<span class="ident" id="2522383"><a href="/net/dial.go.html#2522007">d</a></span><span class="op" id="2522384">.</span><span class="ident" id="2522385">DualStack</span>&nbsp;<span class="op" id="2522395">&amp;&amp;</span>&nbsp;<span class="ident" id="2522398"><a href="/net/dial.go.html#2522023">network</a></span>&nbsp;<span class="op" id="2522406">==</span>&nbsp;<span class="string" id="2522409">&#34;tcp&#34;</span>&nbsp;<span class="op" id="2522415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522419"><a href="/net/dial.go.html#2522219">dialer</a></span>&nbsp;<span class="op" id="2522426">=</span>&nbsp;<span class="keyword" id="2522428">func</span><span class="op" id="2522432">(</span><span class="ident" id="2522433">deadline</span>&nbsp;<span class="ident" id="2522442"><a href="/net/dial.go.html#2517556">time</a></span><span class="op" id="2522446">.</span><span class="ident" id="2522447">Time</span><span class="op" id="2522451">)</span>&nbsp;<span class="op" id="2522453">(</span><span class="ident" id="2522454"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="2522458">,</span>&nbsp;<span class="builtintype" id="2522460">error</span><span class="op" id="2522465">)</span>&nbsp;<span class="op" id="2522467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522472">return</span>&nbsp;<span class="ident" id="2522479"><a href="/net/dial.go.html#2523087">dialMulti</a></span><span class="op" id="2522488">(</span><span class="ident" id="2522489"><a href="/net/dial.go.html#2522023">network</a></span><span class="op" id="2522496">,</span>&nbsp;<span class="ident" id="2522498"><a href="/net/dial.go.html#2522032">address</a></span><span class="op" id="2522505">,</span>&nbsp;<span class="ident" id="2522507"><a href="/net/dial.go.html#2522007">d</a></span><span class="op" id="2522508">.</span><span class="ident" id="2522509">LocalAddr</span><span class="op" id="2522518">,</span>&nbsp;<span class="ident" id="2522520"><a href="/net/dial.go.html#2522351">ras</a></span><span class="op" id="2522523">,</span>&nbsp;<span class="ident" id="2522525"><a href="/net/dial.go.html#2522433">deadline</a></span><span class="op" id="2522533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2522537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2522540">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522543">c</span><span class="op" id="2522544">,</span>&nbsp;<span class="ident" id="2522546"><a href="/net/dial.go.html#2522069">err</a></span>&nbsp;<span class="op" id="2522550">:=</span>&nbsp;<span class="ident" id="2522553"><a href="/net/fd_unix.go.html#2575734">dial</a></span><span class="op" id="2522557">(</span><span class="ident" id="2522558"><a href="/net/dial.go.html#2522023">network</a></span><span class="op" id="2522565">,</span>&nbsp;<span class="ident" id="2522567"><a href="/net/dial.go.html#2522065">ra</a></span><span class="op" id="2522569">.</span><span class="ident" id="2522570">toAddr</span><span class="op" id="2522576">(</span><span class="op" id="2522577">)</span><span class="op" id="2522578">,</span>&nbsp;<span class="ident" id="2522580"><a href="/net/dial.go.html#2522219">dialer</a></span><span class="op" id="2522586">,</span>&nbsp;<span class="ident" id="2522588"><a href="/net/dial.go.html#2522007">d</a></span><span class="op" id="2522589">.</span><span class="ident" id="2522590">deadline</span><span class="op" id="2522598">(</span><span class="op" id="2522599">)</span><span class="op" id="2522600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522603">if</span>&nbsp;<span class="ident" id="2522606"><a href="/net/dial.go.html#2522007">d</a></span><span class="op" id="2522607">.</span><span class="ident" id="2522608">KeepAlive</span>&nbsp;<span class="op" id="2522618">&gt;</span>&nbsp;<span class="num" id="2522620">0</span>&nbsp;<span class="op" id="2522622">&amp;&amp;</span>&nbsp;<span class="ident" id="2522625"><a href="/net/dial.go.html#2522069">err</a></span>&nbsp;<span class="op" id="2522629">==</span>&nbsp;<span class="ident" id="2522632">nil</span>&nbsp;<span class="op" id="2522636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522640">if</span>&nbsp;<span class="ident" id="2522643">tc</span><span class="op" id="2522645">,</span>&nbsp;<span class="ident" id="2522647">ok</span>&nbsp;<span class="op" id="2522650">:=</span>&nbsp;<span class="ident" id="2522653"><a href="/net/dial.go.html#2522543">c</a></span><span class="op" id="2522654">.</span><span class="op" id="2522655">(</span><span class="op" id="2522656">*</span><span class="ident" id="2522657"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2522664">)</span><span class="op" id="2522665">;</span>&nbsp;<span class="ident" id="2522667"><a href="/net/dial.go.html#2522647">ok</a></span>&nbsp;<span class="op" id="2522670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522675"><a href="/net/dial.go.html#2522643">tc</a></span><span class="op" id="2522677">.</span><span class="ident" id="2522678">SetKeepAlive</span><span class="op" id="2522690">(</span><span class="ident" id="2522691">true</span><span class="op" id="2522695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522700"><a href="/net/dial.go.html#2522643">tc</a></span><span class="op" id="2522702">.</span><span class="ident" id="2522703">SetKeepAlivePeriod</span><span class="op" id="2522721">(</span><span class="ident" id="2522722"><a href="/net/dial.go.html#2522007">d</a></span><span class="op" id="2522723">.</span><span class="ident" id="2522724">KeepAlive</span><span class="op" id="2522733">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522738"><a href="/net/dial.go.html#2522790">testHookSetKeepAlive</a></span><span class="op" id="2522758">(</span><span class="op" id="2522759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2522763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2522766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522769">return</span>&nbsp;<span class="ident" id="2522776"><a href="/net/dial.go.html#2522543">c</a></span><span class="op" id="2522777">,</span>&nbsp;<span class="ident" id="2522779"><a href="/net/dial.go.html#2522069">err</a></span><br>
<span class="lineno"></span><span class="op" id="2522783">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="2522786">var</span>&nbsp;<span class="ident" id="2522790">testHookSetKeepAlive</span>&nbsp;<span class="op" id="2522811">=</span>&nbsp;<span class="keyword" id="2522813">func</span><span class="op" id="2522817">(</span><span class="op" id="2522818">)</span>&nbsp;<span class="op" id="2522820">{</span><span class="op" id="2522821">}</span>&nbsp;<span class="comment" id="2522823">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2522851">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2522921">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="2522984">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="2523052">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="2523082">func</span>&nbsp;<span class="ident" id="2523087">dialMulti</span><span class="op" id="2523096">(</span><span class="ident" id="2523097">net</span><span class="op" id="2523100">,</span>&nbsp;<span class="ident" id="2523102">addr</span>&nbsp;<span class="builtintype" id="2523107">string</span><span class="op" id="2523113">,</span>&nbsp;<span class="ident" id="2523115">la</span>&nbsp;<span class="ident" id="2523118"><a href="/net/net.go.html#2652238">Addr</a></span><span class="op" id="2523122">,</span>&nbsp;<span class="ident" id="2523124">ras</span>&nbsp;<span class="ident" id="2523128"><a href="/net/ipsock.go.html#2628430">addrList</a></span><span class="op" id="2523136">,</span>&nbsp;<span class="ident" id="2523138">deadline</span>&nbsp;<span class="ident" id="2523147"><a href="/net/dial.go.html#2517556">time</a></span><span class="op" id="2523151">.</span><span class="ident" id="2523152">Time</span><span class="op" id="2523156">)</span>&nbsp;<span class="op" id="2523158">(</span><span class="ident" id="2523159"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="2523163">,</span>&nbsp;<span class="builtintype" id="2523165">error</span><span class="op" id="2523170">)</span>&nbsp;<span class="op" id="2523172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523175">type</span>&nbsp;<span class="ident" id="2523180">racer</span>&nbsp;<span class="keyword" id="2523186">struct</span>&nbsp;<span class="op" id="2523193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523197"><a href="/net/net.go.html#2652476">Conn</a></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2523204">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2523214">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2523277">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2523340">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523369">sig</span>&nbsp;<span class="op" id="2523373">:=</span>&nbsp;<span class="builtinfunc" id="2523376">make</span><span class="op" id="2523380">(</span><span class="keyword" id="2523381">chan</span>&nbsp;<span class="builtintype" id="2523386">bool</span><span class="op" id="2523390">,</span>&nbsp;<span class="num" id="2523392">1</span><span class="op" id="2523393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523396">lane</span>&nbsp;<span class="op" id="2523401">:=</span>&nbsp;<span class="builtinfunc" id="2523404">make</span><span class="op" id="2523408">(</span><span class="keyword" id="2523409">chan</span>&nbsp;<span class="ident" id="2523414"><a href="/net/dial.go.html#2523180">racer</a></span><span class="op" id="2523419">,</span>&nbsp;<span class="num" id="2523421">1</span><span class="op" id="2523422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523425">for</span>&nbsp;<span class="ident" id="2523429">_</span><span class="op" id="2523430">,</span>&nbsp;<span class="ident" id="2523432">ra</span>&nbsp;<span class="op" id="2523435">:=</span>&nbsp;<span class="keyword" id="2523438">range</span>&nbsp;<span class="ident" id="2523444"><a href="/net/dial.go.html#2523124">ras</a></span>&nbsp;<span class="op" id="2523448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523452">go</span>&nbsp;<span class="keyword" id="2523455">func</span><span class="op" id="2523459">(</span><span class="ident" id="2523460">ra</span>&nbsp;<span class="ident" id="2523463"><a href="/net/net.go.html#2652238">Addr</a></span><span class="op" id="2523467">)</span>&nbsp;<span class="op" id="2523469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523474">c</span><span class="op" id="2523475">,</span>&nbsp;<span class="ident" id="2523477">err</span>&nbsp;<span class="op" id="2523481">:=</span>&nbsp;<span class="ident" id="2523484"><a href="/net/dial.go.html#2524126">dialSingle</a></span><span class="op" id="2523494">(</span><span class="ident" id="2523495"><a href="/net/dial.go.html#2523097">net</a></span><span class="op" id="2523498">,</span>&nbsp;<span class="ident" id="2523500"><a href="/net/dial.go.html#2523102">addr</a></span><span class="op" id="2523504">,</span>&nbsp;<span class="ident" id="2523506"><a href="/net/dial.go.html#2523115">la</a></span><span class="op" id="2523508">,</span>&nbsp;<span class="ident" id="2523510"><a href="/net/dial.go.html#2523460">ra</a></span><span class="op" id="2523512">,</span>&nbsp;<span class="ident" id="2523514"><a href="/net/dial.go.html#2523138">deadline</a></span><span class="op" id="2523522">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523527">if</span>&nbsp;<span class="ident" id="2523530">_</span><span class="op" id="2523531">,</span>&nbsp;<span class="ident" id="2523533">ok</span>&nbsp;<span class="op" id="2523536">:=</span>&nbsp;<span class="op" id="2523539">&lt;-</span><span class="ident" id="2523541"><a href="/net/dial.go.html#2523369">sig</a></span><span class="op" id="2523544">;</span>&nbsp;<span class="ident" id="2523546"><a href="/net/dial.go.html#2523533">ok</a></span>&nbsp;<span class="op" id="2523549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523555"><a href="/net/dial.go.html#2523396">lane</a></span>&nbsp;<span class="op" id="2523560">&lt;-</span>&nbsp;<span class="ident" id="2523563"><a href="/net/dial.go.html#2523180">racer</a></span><span class="op" id="2523568">{</span><span class="ident" id="2523569"><a href="/net/dial.go.html#2523474">c</a></span><span class="op" id="2523570">,</span>&nbsp;<span class="ident" id="2523572"><a href="/net/dial.go.html#2523477">err</a></span><span class="op" id="2523575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523580">}</span>&nbsp;<span class="keyword" id="2523582">else</span>&nbsp;<span class="keyword" id="2523587">if</span>&nbsp;<span class="ident" id="2523590"><a href="/net/dial.go.html#2523477">err</a></span>&nbsp;<span class="op" id="2523594">==</span>&nbsp;<span class="ident" id="2523597">nil</span>&nbsp;<span class="op" id="2523601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2523607">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2523646">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2523678">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2523715">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523755"><a href="/net/dial.go.html#2523474">c</a></span><span class="op" id="2523756">.</span><span class="ident" id="2523757">Close</span><span class="op" id="2523762">(</span><span class="op" id="2523763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523772">}</span><span class="op" id="2523773">(</span><span class="ident" id="2523774"><a href="/net/dial.go.html#2523432">ra</a></span><span class="op" id="2523776">.</span><span class="ident" id="2523777">toAddr</span><span class="op" id="2523783">(</span><span class="op" id="2523784">)</span><span class="op" id="2523785">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523791">defer</span>&nbsp;<span class="builtinfunc" id="2523797">close</span><span class="op" id="2523802">(</span><span class="ident" id="2523803"><a href="/net/dial.go.html#2523369">sig</a></span><span class="op" id="2523806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523809">lastErr</span>&nbsp;<span class="op" id="2523817">:=</span>&nbsp;<span class="ident" id="2523820"><a href="/net/net.go.html#2659253">errTimeout</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523832">nracers</span>&nbsp;<span class="op" id="2523840">:=</span>&nbsp;<span class="builtinfunc" id="2523843">len</span><span class="op" id="2523846">(</span><span class="ident" id="2523847"><a href="/net/dial.go.html#2523124">ras</a></span><span class="op" id="2523850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523853">for</span>&nbsp;<span class="ident" id="2523857"><a href="/net/dial.go.html#2523832">nracers</a></span>&nbsp;<span class="op" id="2523865">&gt;</span>&nbsp;<span class="num" id="2523867">0</span>&nbsp;<span class="op" id="2523869">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523873"><a href="/net/dial.go.html#2523369">sig</a></span>&nbsp;<span class="op" id="2523877">&lt;-</span>&nbsp;<span class="ident" id="2523880">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523887">racer</span>&nbsp;<span class="op" id="2523893">:=</span>&nbsp;<span class="op" id="2523896">&lt;-</span><span class="ident" id="2523898"><a href="/net/dial.go.html#2523396">lane</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523905">if</span>&nbsp;<span class="ident" id="2523908"><a href="/net/dial.go.html#2523887">racer</a></span><span class="op" id="2523913">.</span><span class="builtintype" id="2523914">error</span>&nbsp;<span class="op" id="2523920">==</span>&nbsp;<span class="ident" id="2523923">nil</span>&nbsp;<span class="op" id="2523927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523932">return</span>&nbsp;<span class="ident" id="2523939"><a href="/net/dial.go.html#2523887">racer</a></span><span class="op" id="2523944">.</span><span class="ident" id="2523945">Conn</span><span class="op" id="2523949">,</span>&nbsp;<span class="ident" id="2523951">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523957">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523961"><a href="/net/dial.go.html#2523809">lastErr</a></span>&nbsp;<span class="op" id="2523969">=</span>&nbsp;<span class="ident" id="2523971"><a href="/net/dial.go.html#2523887">racer</a></span><span class="op" id="2523976">.</span><span class="builtintype" id="2523977">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523985"><a href="/net/dial.go.html#2523832">nracers</a></span><span class="op" id="2523992">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523999">return</span>&nbsp;<span class="ident" id="2524006">nil</span><span class="op" id="2524009">,</span>&nbsp;<span class="ident" id="2524011"><a href="/net/dial.go.html#2523809">lastErr</a></span><br>
<span class="lineno"></span><span class="op" id="2524019">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2524022">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2524093">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="2524121">func</span>&nbsp;<span class="ident" id="2524126">dialSingle</span><span class="op" id="2524136">(</span><span class="ident" id="2524137">net</span><span class="op" id="2524140">,</span>&nbsp;<span class="ident" id="2524142">addr</span>&nbsp;<span class="builtintype" id="2524147">string</span><span class="op" id="2524153">,</span>&nbsp;<span class="ident" id="2524155">la</span><span class="op" id="2524157">,</span>&nbsp;<span class="ident" id="2524159">ra</span>&nbsp;<span class="ident" id="2524162"><a href="/net/net.go.html#2652238">Addr</a></span><span class="op" id="2524166">,</span>&nbsp;<span class="ident" id="2524168">deadline</span>&nbsp;<span class="ident" id="2524177"><a href="/net/dial.go.html#2517556">time</a></span><span class="op" id="2524181">.</span><span class="ident" id="2524182">Time</span><span class="op" id="2524186">)</span>&nbsp;<span class="op" id="2524188">(</span><span class="ident" id="2524189">c</span>&nbsp;<span class="ident" id="2524191"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="2524195">,</span>&nbsp;<span class="ident" id="2524197">err</span>&nbsp;<span class="builtintype" id="2524201">error</span><span class="op" id="2524206">)</span>&nbsp;<span class="op" id="2524208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524211">if</span>&nbsp;<span class="ident" id="2524214"><a href="/net/dial.go.html#2524155">la</a></span>&nbsp;<span class="op" id="2524217">!=</span>&nbsp;<span class="ident" id="2524220">nil</span>&nbsp;<span class="op" id="2524224">&amp;&amp;</span>&nbsp;<span class="ident" id="2524227"><a href="/net/dial.go.html#2524155">la</a></span><span class="op" id="2524229">.</span><span class="ident" id="2524230">Network</span><span class="op" id="2524237">(</span><span class="op" id="2524238">)</span>&nbsp;<span class="op" id="2524240">!=</span>&nbsp;<span class="ident" id="2524243"><a href="/net/dial.go.html#2524159">ra</a></span><span class="op" id="2524245">.</span><span class="ident" id="2524246">Network</span><span class="op" id="2524253">(</span><span class="op" id="2524254">)</span>&nbsp;<span class="op" id="2524256">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524260">return</span>&nbsp;<span class="ident" id="2524267">nil</span><span class="op" id="2524270">,</span>&nbsp;<span class="op" id="2524272">&amp;</span><span class="ident" id="2524273"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2524280">{</span><span class="ident" id="2524281">Op</span><span class="op" id="2524283">:</span>&nbsp;<span class="string" id="2524285">&#34;dial&#34;</span><span class="op" id="2524291">,</span>&nbsp;<span class="ident" id="2524293">Net</span><span class="op" id="2524296">:</span>&nbsp;<span class="ident" id="2524298"><a href="/net/dial.go.html#2524137">net</a></span><span class="op" id="2524301">,</span>&nbsp;<span class="ident" id="2524303">Addr</span><span class="op" id="2524307">:</span>&nbsp;<span class="ident" id="2524309"><a href="/net/dial.go.html#2524159">ra</a></span><span class="op" id="2524311">,</span>&nbsp;<span class="ident" id="2524313">Err</span><span class="op" id="2524316">:</span>&nbsp;<span class="ident" id="2524318"><a href="/net/dial.go.html#2517546">errors</a></span><span class="op" id="2524324">.</span><span class="ident" id="2524325">New</span><span class="op" id="2524328">(</span><span class="string" id="2524329">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="2524362">+</span>&nbsp;<span class="ident" id="2524364"><a href="/net/dial.go.html#2524155">la</a></span><span class="op" id="2524366">.</span><span class="ident" id="2524367">Network</span><span class="op" id="2524374">(</span><span class="op" id="2524375">)</span><span class="op" id="2524376">)</span><span class="op" id="2524377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2524380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524383">switch</span>&nbsp;<span class="ident" id="2524390">ra</span>&nbsp;<span class="op" id="2524393">:=</span>&nbsp;<span class="ident" id="2524396"><a href="/net/dial.go.html#2524159">ra</a></span><span class="op" id="2524398">.</span><span class="op" id="2524399">(</span><span class="keyword" id="2524400">type</span><span class="op" id="2524404">)</span>&nbsp;<span class="op" id="2524406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524409">case</span>&nbsp;<span class="op" id="2524414">*</span><span class="ident" id="2524415"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2524422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524426">la</span><span class="op" id="2524428">,</span>&nbsp;<span class="ident" id="2524430">_</span>&nbsp;<span class="op" id="2524432">:=</span>&nbsp;<span class="ident" id="2524435"><a href="/net/dial.go.html#2524155">la</a></span><span class="op" id="2524437">.</span><span class="op" id="2524438">(</span><span class="op" id="2524439">*</span><span class="ident" id="2524440"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2524447">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524451"><a href="/net/dial.go.html#2524189">c</a></span><span class="op" id="2524452">,</span>&nbsp;<span class="ident" id="2524454"><a href="/net/dial.go.html#2524197">err</a></span>&nbsp;<span class="op" id="2524458">=</span>&nbsp;<span class="ident" id="2524460"><a href="/net/tcpsock_posix.go.html#2696896">dialTCP</a></span><span class="op" id="2524467">(</span><span class="ident" id="2524468"><a href="/net/dial.go.html#2524137">net</a></span><span class="op" id="2524471">,</span>&nbsp;<span class="ident" id="2524473"><a href="/net/dial.go.html#2524426">la</a></span><span class="op" id="2524475">,</span>&nbsp;<span class="ident" id="2524477"><a href="/net/dial.go.html#2524390">ra</a></span><span class="op" id="2524479">,</span>&nbsp;<span class="ident" id="2524481"><a href="/net/dial.go.html#2524168">deadline</a></span><span class="op" id="2524489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524492">case</span>&nbsp;<span class="op" id="2524497">*</span><span class="ident" id="2524498"><a href="/net/udpsock.go.html#2703901">UDPAddr</a></span><span class="op" id="2524505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524509">la</span><span class="op" id="2524511">,</span>&nbsp;<span class="ident" id="2524513">_</span>&nbsp;<span class="op" id="2524515">:=</span>&nbsp;<span class="ident" id="2524518"><a href="/net/dial.go.html#2524155">la</a></span><span class="op" id="2524520">.</span><span class="op" id="2524521">(</span><span class="op" id="2524522">*</span><span class="ident" id="2524523"><a href="/net/udpsock.go.html#2703901">UDPAddr</a></span><span class="op" id="2524530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524534"><a href="/net/dial.go.html#2524189">c</a></span><span class="op" id="2524535">,</span>&nbsp;<span class="ident" id="2524537"><a href="/net/dial.go.html#2524197">err</a></span>&nbsp;<span class="op" id="2524541">=</span>&nbsp;<span class="ident" id="2524543"><a href="/net/udpsock_posix.go.html#2710284">dialUDP</a></span><span class="op" id="2524550">(</span><span class="ident" id="2524551"><a href="/net/dial.go.html#2524137">net</a></span><span class="op" id="2524554">,</span>&nbsp;<span class="ident" id="2524556"><a href="/net/dial.go.html#2524509">la</a></span><span class="op" id="2524558">,</span>&nbsp;<span class="ident" id="2524560"><a href="/net/dial.go.html#2524390">ra</a></span><span class="op" id="2524562">,</span>&nbsp;<span class="ident" id="2524564"><a href="/net/dial.go.html#2524168">deadline</a></span><span class="op" id="2524572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524575">case</span>&nbsp;<span class="op" id="2524580">*</span><span class="ident" id="2524581"><a href="/net/iprawsock.go.html#2619177">IPAddr</a></span><span class="op" id="2524587">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524591">la</span><span class="op" id="2524593">,</span>&nbsp;<span class="ident" id="2524595">_</span>&nbsp;<span class="op" id="2524597">:=</span>&nbsp;<span class="ident" id="2524600"><a href="/net/dial.go.html#2524155">la</a></span><span class="op" id="2524602">.</span><span class="op" id="2524603">(</span><span class="op" id="2524604">*</span><span class="ident" id="2524605"><a href="/net/iprawsock.go.html#2619177">IPAddr</a></span><span class="op" id="2524611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524615"><a href="/net/dial.go.html#2524189">c</a></span><span class="op" id="2524616">,</span>&nbsp;<span class="ident" id="2524618"><a href="/net/dial.go.html#2524197">err</a></span>&nbsp;<span class="op" id="2524622">=</span>&nbsp;<span class="ident" id="2524624"><a href="/net/iprawsock_posix.go.html#2625840">dialIP</a></span><span class="op" id="2524630">(</span><span class="ident" id="2524631"><a href="/net/dial.go.html#2524137">net</a></span><span class="op" id="2524634">,</span>&nbsp;<span class="ident" id="2524636"><a href="/net/dial.go.html#2524591">la</a></span><span class="op" id="2524638">,</span>&nbsp;<span class="ident" id="2524640"><a href="/net/dial.go.html#2524390">ra</a></span><span class="op" id="2524642">,</span>&nbsp;<span class="ident" id="2524644"><a href="/net/dial.go.html#2524168">deadline</a></span><span class="op" id="2524652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524655">case</span>&nbsp;<span class="op" id="2524660">*</span><span class="ident" id="2524661"><a href="/net/unixsock.go.html#2713560">UnixAddr</a></span><span class="op" id="2524669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524673">la</span><span class="op" id="2524675">,</span>&nbsp;<span class="ident" id="2524677">_</span>&nbsp;<span class="op" id="2524679">:=</span>&nbsp;<span class="ident" id="2524682"><a href="/net/dial.go.html#2524155">la</a></span><span class="op" id="2524684">.</span><span class="op" id="2524685">(</span><span class="op" id="2524686">*</span><span class="ident" id="2524687"><a href="/net/unixsock.go.html#2713560">UnixAddr</a></span><span class="op" id="2524695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524699"><a href="/net/dial.go.html#2524189">c</a></span><span class="op" id="2524700">,</span>&nbsp;<span class="ident" id="2524702"><a href="/net/dial.go.html#2524197">err</a></span>&nbsp;<span class="op" id="2524706">=</span>&nbsp;<span class="ident" id="2524708"><a href="/net/unixsock_posix.go.html#2720846">dialUnix</a></span><span class="op" id="2524716">(</span><span class="ident" id="2524717"><a href="/net/dial.go.html#2524137">net</a></span><span class="op" id="2524720">,</span>&nbsp;<span class="ident" id="2524722"><a href="/net/dial.go.html#2524673">la</a></span><span class="op" id="2524724">,</span>&nbsp;<span class="ident" id="2524726"><a href="/net/dial.go.html#2524390">ra</a></span><span class="op" id="2524728">,</span>&nbsp;<span class="ident" id="2524730"><a href="/net/dial.go.html#2524168">deadline</a></span><span class="op" id="2524738">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524741">default</span><span class="op" id="2524748">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524752">return</span>&nbsp;<span class="ident" id="2524759">nil</span><span class="op" id="2524762">,</span>&nbsp;<span class="op" id="2524764">&amp;</span><span class="ident" id="2524765"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2524772">{</span><span class="ident" id="2524773">Op</span><span class="op" id="2524775">:</span>&nbsp;<span class="string" id="2524777">&#34;dial&#34;</span><span class="op" id="2524783">,</span>&nbsp;<span class="ident" id="2524785">Net</span><span class="op" id="2524788">:</span>&nbsp;<span class="ident" id="2524790"><a href="/net/dial.go.html#2524137">net</a></span><span class="op" id="2524793">,</span>&nbsp;<span class="ident" id="2524795">Addr</span><span class="op" id="2524799">:</span>&nbsp;<span class="ident" id="2524801"><a href="/net/dial.go.html#2524390">ra</a></span><span class="op" id="2524803">,</span>&nbsp;<span class="ident" id="2524805">Err</span><span class="op" id="2524808">:</span>&nbsp;<span class="op" id="2524810">&amp;</span><span class="ident" id="2524811"><a href="/net/net.go.html#2660706">AddrError</a></span><span class="op" id="2524820">{</span><span class="ident" id="2524821">Err</span><span class="op" id="2524824">:</span>&nbsp;<span class="string" id="2524826">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="2524851">,</span>&nbsp;<span class="ident" id="2524853">Addr</span><span class="op" id="2524857">:</span>&nbsp;<span class="ident" id="2524859"><a href="/net/dial.go.html#2524142">addr</a></span><span class="op" id="2524863">}</span><span class="op" id="2524864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2524867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524870">if</span>&nbsp;<span class="ident" id="2524873"><a href="/net/dial.go.html#2524197">err</a></span>&nbsp;<span class="op" id="2524877">!=</span>&nbsp;<span class="ident" id="2524880">nil</span>&nbsp;<span class="op" id="2524884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524888">return</span>&nbsp;<span class="ident" id="2524895">nil</span><span class="op" id="2524898">,</span>&nbsp;<span class="ident" id="2524900"><a href="/net/dial.go.html#2524197">err</a></span>&nbsp;<span class="comment" id="2524904">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2524954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524957">return</span>&nbsp;<span class="ident" id="2524964"><a href="/net/dial.go.html#2524189">c</a></span><span class="op" id="2524965">,</span>&nbsp;<span class="ident" id="2524967">nil</span><br>
<span class="lineno"></span><span class="op" id="2524971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2524974">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="2525030">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="2525099">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2525134">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="2525171">func</span>&nbsp;<span class="ident" id="2525176">Listen</span><span class="op" id="2525182">(</span><span class="ident" id="2525183">net</span><span class="op" id="2525186">,</span>&nbsp;<span class="ident" id="2525188">laddr</span>&nbsp;<span class="builtintype" id="2525194">string</span><span class="op" id="2525200">)</span>&nbsp;<span class="op" id="2525202">(</span><span class="ident" id="2525203"><a href="/net/net.go.html#2658762">Listener</a></span><span class="op" id="2525211">,</span>&nbsp;<span class="builtintype" id="2525213">error</span><span class="op" id="2525218">)</span>&nbsp;<span class="op" id="2525220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525223">la</span><span class="op" id="2525225">,</span>&nbsp;<span class="ident" id="2525227">err</span>&nbsp;<span class="op" id="2525231">:=</span>&nbsp;<span class="ident" id="2525234"><a href="/net/dial.go.html#2520153">resolveAddr</a></span><span class="op" id="2525245">(</span><span class="string" id="2525246">&#34;listen&#34;</span><span class="op" id="2525254">,</span>&nbsp;<span class="ident" id="2525256"><a href="/net/dial.go.html#2525183">net</a></span><span class="op" id="2525259">,</span>&nbsp;<span class="ident" id="2525261"><a href="/net/dial.go.html#2525188">laddr</a></span><span class="op" id="2525266">,</span>&nbsp;<span class="ident" id="2525268"><a href="/net/net.go.html#2660335">noDeadline</a></span><span class="op" id="2525278">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525281">if</span>&nbsp;<span class="ident" id="2525284"><a href="/net/dial.go.html#2525227">err</a></span>&nbsp;<span class="op" id="2525288">!=</span>&nbsp;<span class="ident" id="2525291">nil</span>&nbsp;<span class="op" id="2525295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525299">return</span>&nbsp;<span class="ident" id="2525306">nil</span><span class="op" id="2525309">,</span>&nbsp;<span class="op" id="2525311">&amp;</span><span class="ident" id="2525312"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2525319">{</span><span class="ident" id="2525320">Op</span><span class="op" id="2525322">:</span>&nbsp;<span class="string" id="2525324">&#34;listen&#34;</span><span class="op" id="2525332">,</span>&nbsp;<span class="ident" id="2525334">Net</span><span class="op" id="2525337">:</span>&nbsp;<span class="ident" id="2525339"><a href="/net/dial.go.html#2525183">net</a></span><span class="op" id="2525342">,</span>&nbsp;<span class="ident" id="2525344">Addr</span><span class="op" id="2525348">:</span>&nbsp;<span class="ident" id="2525350">nil</span><span class="op" id="2525353">,</span>&nbsp;<span class="ident" id="2525355">Err</span><span class="op" id="2525358">:</span>&nbsp;<span class="ident" id="2525360"><a href="/net/dial.go.html#2525227">err</a></span><span class="op" id="2525363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2525366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525369">var</span>&nbsp;<span class="ident" id="2525373">l</span>&nbsp;<span class="ident" id="2525375"><a href="/net/net.go.html#2658762">Listener</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525385">switch</span>&nbsp;<span class="ident" id="2525392">la</span>&nbsp;<span class="op" id="2525395">:=</span>&nbsp;<span class="ident" id="2525398"><a href="/net/dial.go.html#2525223">la</a></span><span class="op" id="2525400">.</span><span class="ident" id="2525401">toAddr</span><span class="op" id="2525407">(</span><span class="op" id="2525408">)</span><span class="op" id="2525409">.</span><span class="op" id="2525410">(</span><span class="keyword" id="2525411">type</span><span class="op" id="2525415">)</span>&nbsp;<span class="op" id="2525417">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525420">case</span>&nbsp;<span class="op" id="2525425">*</span><span class="ident" id="2525426"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2525433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525437"><a href="/net/dial.go.html#2525373">l</a></span><span class="op" id="2525438">,</span>&nbsp;<span class="ident" id="2525440"><a href="/net/dial.go.html#2525227">err</a></span>&nbsp;<span class="op" id="2525444">=</span>&nbsp;<span class="ident" id="2525446"><a href="/net/tcpsock_posix.go.html#2701875">ListenTCP</a></span><span class="op" id="2525455">(</span><span class="ident" id="2525456"><a href="/net/dial.go.html#2525183">net</a></span><span class="op" id="2525459">,</span>&nbsp;<span class="ident" id="2525461"><a href="/net/dial.go.html#2525392">la</a></span><span class="op" id="2525463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525466">case</span>&nbsp;<span class="op" id="2525471">*</span><span class="ident" id="2525472"><a href="/net/unixsock.go.html#2713560">UnixAddr</a></span><span class="op" id="2525480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525484"><a href="/net/dial.go.html#2525373">l</a></span><span class="op" id="2525485">,</span>&nbsp;<span class="ident" id="2525487"><a href="/net/dial.go.html#2525227">err</a></span>&nbsp;<span class="op" id="2525491">=</span>&nbsp;<span class="ident" id="2525493"><a href="/net/unixsock_posix.go.html#2721464">ListenUnix</a></span><span class="op" id="2525503">(</span><span class="ident" id="2525504"><a href="/net/dial.go.html#2525183">net</a></span><span class="op" id="2525507">,</span>&nbsp;<span class="ident" id="2525509"><a href="/net/dial.go.html#2525392">la</a></span><span class="op" id="2525511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525514">default</span><span class="op" id="2525521">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525525">return</span>&nbsp;<span class="ident" id="2525532">nil</span><span class="op" id="2525535">,</span>&nbsp;<span class="op" id="2525537">&amp;</span><span class="ident" id="2525538"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2525545">{</span><span class="ident" id="2525546">Op</span><span class="op" id="2525548">:</span>&nbsp;<span class="string" id="2525550">&#34;listen&#34;</span><span class="op" id="2525558">,</span>&nbsp;<span class="ident" id="2525560">Net</span><span class="op" id="2525563">:</span>&nbsp;<span class="ident" id="2525565"><a href="/net/dial.go.html#2525183">net</a></span><span class="op" id="2525568">,</span>&nbsp;<span class="ident" id="2525570">Addr</span><span class="op" id="2525574">:</span>&nbsp;<span class="ident" id="2525576"><a href="/net/dial.go.html#2525392">la</a></span><span class="op" id="2525578">,</span>&nbsp;<span class="ident" id="2525580">Err</span><span class="op" id="2525583">:</span>&nbsp;<span class="op" id="2525585">&amp;</span><span class="ident" id="2525586"><a href="/net/net.go.html#2660706">AddrError</a></span><span class="op" id="2525595">{</span><span class="ident" id="2525596">Err</span><span class="op" id="2525599">:</span>&nbsp;<span class="string" id="2525601">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="2525626">,</span>&nbsp;<span class="ident" id="2525628">Addr</span><span class="op" id="2525632">:</span>&nbsp;<span class="ident" id="2525634"><a href="/net/dial.go.html#2525188">laddr</a></span><span class="op" id="2525639">}</span><span class="op" id="2525640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2525643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525646">if</span>&nbsp;<span class="ident" id="2525649"><a href="/net/dial.go.html#2525227">err</a></span>&nbsp;<span class="op" id="2525653">!=</span>&nbsp;<span class="ident" id="2525656">nil</span>&nbsp;<span class="op" id="2525660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525664">return</span>&nbsp;<span class="ident" id="2525671">nil</span><span class="op" id="2525674">,</span>&nbsp;<span class="ident" id="2525676"><a href="/net/dial.go.html#2525227">err</a></span>&nbsp;<span class="comment" id="2525680">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2525730">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525733">return</span>&nbsp;<span class="ident" id="2525740"><a href="/net/dial.go.html#2525373">l</a></span><span class="op" id="2525741">,</span>&nbsp;<span class="ident" id="2525743">nil</span><br>
<span class="lineno"></span><span class="op" id="2525747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2525750">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="2525812">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="2525881">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2525926">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="2525963">func</span>&nbsp;<span class="ident" id="2525968">ListenPacket</span><span class="op" id="2525980">(</span><span class="ident" id="2525981">net</span><span class="op" id="2525984">,</span>&nbsp;<span class="ident" id="2525986">laddr</span>&nbsp;<span class="builtintype" id="2525992">string</span><span class="op" id="2525998">)</span>&nbsp;<span class="op" id="2526000">(</span><span class="ident" id="2526001"><a href="/net/net.go.html#2656892">PacketConn</a></span><span class="op" id="2526011">,</span>&nbsp;<span class="builtintype" id="2526013">error</span><span class="op" id="2526018">)</span>&nbsp;<span class="op" id="2526020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2526023">la</span><span class="op" id="2526025">,</span>&nbsp;<span class="ident" id="2526027">err</span>&nbsp;<span class="op" id="2526031">:=</span>&nbsp;<span class="ident" id="2526034"><a href="/net/dial.go.html#2520153">resolveAddr</a></span><span class="op" id="2526045">(</span><span class="string" id="2526046">&#34;listen&#34;</span><span class="op" id="2526054">,</span>&nbsp;<span class="ident" id="2526056"><a href="/net/dial.go.html#2525981">net</a></span><span class="op" id="2526059">,</span>&nbsp;<span class="ident" id="2526061"><a href="/net/dial.go.html#2525986">laddr</a></span><span class="op" id="2526066">,</span>&nbsp;<span class="ident" id="2526068"><a href="/net/net.go.html#2660335">noDeadline</a></span><span class="op" id="2526078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526081">if</span>&nbsp;<span class="ident" id="2526084"><a href="/net/dial.go.html#2526027">err</a></span>&nbsp;<span class="op" id="2526088">!=</span>&nbsp;<span class="ident" id="2526091">nil</span>&nbsp;<span class="op" id="2526095">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526099">return</span>&nbsp;<span class="ident" id="2526106">nil</span><span class="op" id="2526109">,</span>&nbsp;<span class="op" id="2526111">&amp;</span><span class="ident" id="2526112"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2526119">{</span><span class="ident" id="2526120">Op</span><span class="op" id="2526122">:</span>&nbsp;<span class="string" id="2526124">&#34;listen&#34;</span><span class="op" id="2526132">,</span>&nbsp;<span class="ident" id="2526134">Net</span><span class="op" id="2526137">:</span>&nbsp;<span class="ident" id="2526139"><a href="/net/dial.go.html#2525981">net</a></span><span class="op" id="2526142">,</span>&nbsp;<span class="ident" id="2526144">Addr</span><span class="op" id="2526148">:</span>&nbsp;<span class="ident" id="2526150">nil</span><span class="op" id="2526153">,</span>&nbsp;<span class="ident" id="2526155">Err</span><span class="op" id="2526158">:</span>&nbsp;<span class="ident" id="2526160"><a href="/net/dial.go.html#2526027">err</a></span><span class="op" id="2526163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2526166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526169">var</span>&nbsp;<span class="ident" id="2526173">l</span>&nbsp;<span class="ident" id="2526175"><a href="/net/net.go.html#2656892">PacketConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526187">switch</span>&nbsp;<span class="ident" id="2526194">la</span>&nbsp;<span class="op" id="2526197">:=</span>&nbsp;<span class="ident" id="2526200"><a href="/net/dial.go.html#2526023">la</a></span><span class="op" id="2526202">.</span><span class="ident" id="2526203">toAddr</span><span class="op" id="2526209">(</span><span class="op" id="2526210">)</span><span class="op" id="2526211">.</span><span class="op" id="2526212">(</span><span class="keyword" id="2526213">type</span><span class="op" id="2526217">)</span>&nbsp;<span class="op" id="2526219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526222">case</span>&nbsp;<span class="op" id="2526227">*</span><span class="ident" id="2526228"><a href="/net/udpsock.go.html#2703901">UDPAddr</a></span><span class="op" id="2526235">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2526239"><a href="/net/dial.go.html#2526173">l</a></span><span class="op" id="2526240">,</span>&nbsp;<span class="ident" id="2526242"><a href="/net/dial.go.html#2526027">err</a></span>&nbsp;<span class="op" id="2526246">=</span>&nbsp;<span class="ident" id="2526248"><a href="/net/udpsock_posix.go.html#2710994">ListenUDP</a></span><span class="op" id="2526257">(</span><span class="ident" id="2526258"><a href="/net/dial.go.html#2525981">net</a></span><span class="op" id="2526261">,</span>&nbsp;<span class="ident" id="2526263"><a href="/net/dial.go.html#2526194">la</a></span><span class="op" id="2526265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526268">case</span>&nbsp;<span class="op" id="2526273">*</span><span class="ident" id="2526274"><a href="/net/iprawsock.go.html#2619177">IPAddr</a></span><span class="op" id="2526280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2526284"><a href="/net/dial.go.html#2526173">l</a></span><span class="op" id="2526285">,</span>&nbsp;<span class="ident" id="2526287"><a href="/net/dial.go.html#2526027">err</a></span>&nbsp;<span class="op" id="2526291">=</span>&nbsp;<span class="ident" id="2526293"><a href="/net/iprawsock_posix.go.html#2626755">ListenIP</a></span><span class="op" id="2526301">(</span><span class="ident" id="2526302"><a href="/net/dial.go.html#2525981">net</a></span><span class="op" id="2526305">,</span>&nbsp;<span class="ident" id="2526307"><a href="/net/dial.go.html#2526194">la</a></span><span class="op" id="2526309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526312">case</span>&nbsp;<span class="op" id="2526317">*</span><span class="ident" id="2526318"><a href="/net/unixsock.go.html#2713560">UnixAddr</a></span><span class="op" id="2526326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2526330"><a href="/net/dial.go.html#2526173">l</a></span><span class="op" id="2526331">,</span>&nbsp;<span class="ident" id="2526333"><a href="/net/dial.go.html#2526027">err</a></span>&nbsp;<span class="op" id="2526337">=</span>&nbsp;<span class="ident" id="2526339"><a href="/net/unixsock_posix.go.html#2724349">ListenUnixgram</a></span><span class="op" id="2526353">(</span><span class="ident" id="2526354"><a href="/net/dial.go.html#2525981">net</a></span><span class="op" id="2526357">,</span>&nbsp;<span class="ident" id="2526359"><a href="/net/dial.go.html#2526194">la</a></span><span class="op" id="2526361">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526364">default</span><span class="op" id="2526371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526375">return</span>&nbsp;<span class="ident" id="2526382">nil</span><span class="op" id="2526385">,</span>&nbsp;<span class="op" id="2526387">&amp;</span><span class="ident" id="2526388"><a href="/net/net.go.html#2659621">OpError</a></span><span class="op" id="2526395">{</span><span class="ident" id="2526396">Op</span><span class="op" id="2526398">:</span>&nbsp;<span class="string" id="2526400">&#34;listen&#34;</span><span class="op" id="2526408">,</span>&nbsp;<span class="ident" id="2526410">Net</span><span class="op" id="2526413">:</span>&nbsp;<span class="ident" id="2526415"><a href="/net/dial.go.html#2525981">net</a></span><span class="op" id="2526418">,</span>&nbsp;<span class="ident" id="2526420">Addr</span><span class="op" id="2526424">:</span>&nbsp;<span class="ident" id="2526426"><a href="/net/dial.go.html#2526194">la</a></span><span class="op" id="2526428">,</span>&nbsp;<span class="ident" id="2526430">Err</span><span class="op" id="2526433">:</span>&nbsp;<span class="op" id="2526435">&amp;</span><span class="ident" id="2526436"><a href="/net/net.go.html#2660706">AddrError</a></span><span class="op" id="2526445">{</span><span class="ident" id="2526446">Err</span><span class="op" id="2526449">:</span>&nbsp;<span class="string" id="2526451">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="2526476">,</span>&nbsp;<span class="ident" id="2526478">Addr</span><span class="op" id="2526482">:</span>&nbsp;<span class="ident" id="2526484"><a href="/net/dial.go.html#2525986">laddr</a></span><span class="op" id="2526489">}</span><span class="op" id="2526490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2526493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526496">if</span>&nbsp;<span class="ident" id="2526499"><a href="/net/dial.go.html#2526027">err</a></span>&nbsp;<span class="op" id="2526503">!=</span>&nbsp;<span class="ident" id="2526506">nil</span>&nbsp;<span class="op" id="2526510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526514">return</span>&nbsp;<span class="ident" id="2526521">nil</span><span class="op" id="2526524">,</span>&nbsp;<span class="ident" id="2526526"><a href="/net/dial.go.html#2526027">err</a></span>&nbsp;<span class="comment" id="2526530">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2526580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526583">return</span>&nbsp;<span class="ident" id="2526590"><a href="/net/dial.go.html#2526173">l</a></span><span class="op" id="2526591">,</span>&nbsp;<span class="ident" id="2526593">nil</span><br>
<span class="lineno"></span><span class="op" id="2526597">}</span>
</div>
</body>
</html>
