<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html" class="current">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7997796">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7997851">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7997905">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7997956">package</span>&nbsp;<span class="ident" id="7997964">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7997969">import</span>&nbsp;<span class="op" id="7997976">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7997979">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7997992">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7998003">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7998014">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7998021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7998024">func</span>&nbsp;<span class="ident" id="7998029">TestMutexLock</span><span class="op" id="7998042">(</span><span class="ident" id="7998043">t</span>&nbsp;<span class="op" id="7998045">*</span><span class="ident" id="7998046">testing</span><span class="op" id="7998053">.</span><span class="ident" id="7998054">T</span><span class="op" id="7998055">)</span>&nbsp;<span class="op" id="7998057">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998060">var</span>&nbsp;<span class="ident" id="7998064">mu</span>&nbsp;<span class="ident" id="7998067">fdMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998077">if</span>&nbsp;<span class="op" id="7998080">!</span><span class="ident" id="7998081">mu</span><span class="op" id="7998083">.</span><span class="ident" id="7998084">Incref</span><span class="op" id="7998090">(</span><span class="op" id="7998091">)</span>&nbsp;<span class="op" id="7998093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998097">t</span><span class="op" id="7998098">.</span><span class="ident" id="7998099">Fatal</span><span class="op" id="7998104">(</span><span class="string" id="7998105">&#34;broken&#34;</span><span class="op" id="7998113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998116">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998119">if</span>&nbsp;<span class="ident" id="7998122">mu</span><span class="op" id="7998124">.</span><span class="ident" id="7998125">Decref</span><span class="op" id="7998131">(</span><span class="op" id="7998132">)</span>&nbsp;<span class="op" id="7998134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998138">t</span><span class="op" id="7998139">.</span><span class="ident" id="7998140">Fatal</span><span class="op" id="7998145">(</span><span class="string" id="7998146">&#34;broken&#34;</span><span class="op" id="7998154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998161">if</span>&nbsp;<span class="op" id="7998164">!</span><span class="ident" id="7998165">mu</span><span class="op" id="7998167">.</span><span class="ident" id="7998168">RWLock</span><span class="op" id="7998174">(</span><span class="builtintype" id="7998175">true</span><span class="op" id="7998179">)</span>&nbsp;<span class="op" id="7998181">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998185">t</span><span class="op" id="7998186">.</span><span class="ident" id="7998187">Fatal</span><span class="op" id="7998192">(</span><span class="string" id="7998193">&#34;broken&#34;</span><span class="op" id="7998201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998207">if</span>&nbsp;<span class="ident" id="7998210">mu</span><span class="op" id="7998212">.</span><span class="ident" id="7998213">RWUnlock</span><span class="op" id="7998221">(</span><span class="builtintype" id="7998222">true</span><span class="op" id="7998226">)</span>&nbsp;<span class="op" id="7998228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998232">t</span><span class="op" id="7998233">.</span><span class="ident" id="7998234">Fatal</span><span class="op" id="7998239">(</span><span class="string" id="7998240">&#34;broken&#34;</span><span class="op" id="7998248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998251">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998255">if</span>&nbsp;<span class="op" id="7998258">!</span><span class="ident" id="7998259">mu</span><span class="op" id="7998261">.</span><span class="ident" id="7998262">RWLock</span><span class="op" id="7998268">(</span><span class="builtintype" id="7998269">false</span><span class="op" id="7998274">)</span>&nbsp;<span class="op" id="7998276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998280">t</span><span class="op" id="7998281">.</span><span class="ident" id="7998282">Fatal</span><span class="op" id="7998287">(</span><span class="string" id="7998288">&#34;broken&#34;</span><span class="op" id="7998296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998302">if</span>&nbsp;<span class="ident" id="7998305">mu</span><span class="op" id="7998307">.</span><span class="ident" id="7998308">RWUnlock</span><span class="op" id="7998316">(</span><span class="builtintype" id="7998317">false</span><span class="op" id="7998322">)</span>&nbsp;<span class="op" id="7998324">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998328">t</span><span class="op" id="7998329">.</span><span class="ident" id="7998330">Fatal</span><span class="op" id="7998335">(</span><span class="string" id="7998336">&#34;broken&#34;</span><span class="op" id="7998344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998347">}</span><br>
<span class="lineno"></span><span class="op" id="7998349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7998352">func</span>&nbsp;<span class="ident" id="7998357">TestMutexClose</span><span class="op" id="7998371">(</span><span class="ident" id="7998372">t</span>&nbsp;<span class="op" id="7998374">*</span><span class="ident" id="7998375">testing</span><span class="op" id="7998382">.</span><span class="ident" id="7998383">T</span><span class="op" id="7998384">)</span>&nbsp;<span class="op" id="7998386">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998389">var</span>&nbsp;<span class="ident" id="7998393">mu</span>&nbsp;<span class="ident" id="7998396">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998405">if</span>&nbsp;<span class="op" id="7998408">!</span><span class="ident" id="7998409">mu</span><span class="op" id="7998411">.</span><span class="ident" id="7998412">IncrefAndClose</span><span class="op" id="7998426">(</span><span class="op" id="7998427">)</span>&nbsp;<span class="op" id="7998429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998433">t</span><span class="op" id="7998434">.</span><span class="ident" id="7998435">Fatal</span><span class="op" id="7998440">(</span><span class="string" id="7998441">&#34;broken&#34;</span><span class="op" id="7998449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998456">if</span>&nbsp;<span class="ident" id="7998459">mu</span><span class="op" id="7998461">.</span><span class="ident" id="7998462">Incref</span><span class="op" id="7998468">(</span><span class="op" id="7998469">)</span>&nbsp;<span class="op" id="7998471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998475">t</span><span class="op" id="7998476">.</span><span class="ident" id="7998477">Fatal</span><span class="op" id="7998482">(</span><span class="string" id="7998483">&#34;broken&#34;</span><span class="op" id="7998491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998497">if</span>&nbsp;<span class="ident" id="7998500">mu</span><span class="op" id="7998502">.</span><span class="ident" id="7998503">RWLock</span><span class="op" id="7998509">(</span><span class="builtintype" id="7998510">true</span><span class="op" id="7998514">)</span>&nbsp;<span class="op" id="7998516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998520">t</span><span class="op" id="7998521">.</span><span class="ident" id="7998522">Fatal</span><span class="op" id="7998527">(</span><span class="string" id="7998528">&#34;broken&#34;</span><span class="op" id="7998536">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998542">if</span>&nbsp;<span class="ident" id="7998545">mu</span><span class="op" id="7998547">.</span><span class="ident" id="7998548">RWLock</span><span class="op" id="7998554">(</span><span class="builtintype" id="7998555">false</span><span class="op" id="7998560">)</span>&nbsp;<span class="op" id="7998562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998566">t</span><span class="op" id="7998567">.</span><span class="ident" id="7998568">Fatal</span><span class="op" id="7998573">(</span><span class="string" id="7998574">&#34;broken&#34;</span><span class="op" id="7998582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998588">if</span>&nbsp;<span class="ident" id="7998591">mu</span><span class="op" id="7998593">.</span><span class="ident" id="7998594">IncrefAndClose</span><span class="op" id="7998608">(</span><span class="op" id="7998609">)</span>&nbsp;<span class="op" id="7998611">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998615">t</span><span class="op" id="7998616">.</span><span class="ident" id="7998617">Fatal</span><span class="op" id="7998622">(</span><span class="string" id="7998623">&#34;broken&#34;</span><span class="op" id="7998631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998634">}</span><br>
<span class="lineno"></span><span class="op" id="7998636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7998639">func</span>&nbsp;<span class="ident" id="7998644">TestMutexCloseUnblock</span><span class="op" id="7998665">(</span><span class="ident" id="7998666">t</span>&nbsp;<span class="op" id="7998668">*</span><span class="ident" id="7998669">testing</span><span class="op" id="7998676">.</span><span class="ident" id="7998677">T</span><span class="op" id="7998678">)</span>&nbsp;<span class="op" id="7998680">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998683">c</span>&nbsp;<span class="op" id="7998685">:=</span>&nbsp;<span class="builtinfunc" id="7998688">make</span><span class="op" id="7998692">(</span><span class="keyword" id="7998693">chan</span>&nbsp;<span class="builtintype" id="7998698">bool</span><span class="op" id="7998702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998705">var</span>&nbsp;<span class="ident" id="7998709">mu</span>&nbsp;<span class="ident" id="7998712">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998721">mu</span><span class="op" id="7998723">.</span><span class="ident" id="7998724">RWLock</span><span class="op" id="7998730">(</span><span class="builtintype" id="7998731">true</span><span class="op" id="7998735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998738">for</span>&nbsp;<span class="ident" id="7998742">i</span>&nbsp;<span class="op" id="7998744">:=</span>&nbsp;<span class="num" id="7998747">0</span><span class="op" id="7998748">;</span>&nbsp;<span class="ident" id="7998750">i</span>&nbsp;<span class="op" id="7998752">&lt;</span>&nbsp;<span class="num" id="7998754">4</span><span class="op" id="7998755">;</span>&nbsp;<span class="ident" id="7998757">i</span><span class="op" id="7998758">++</span>&nbsp;<span class="op" id="7998761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998765">go</span>&nbsp;<span class="keyword" id="7998768">func</span><span class="op" id="7998772">(</span><span class="op" id="7998773">)</span>&nbsp;<span class="op" id="7998775">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998780">if</span>&nbsp;<span class="ident" id="7998783">mu</span><span class="op" id="7998785">.</span><span class="ident" id="7998786">RWLock</span><span class="op" id="7998792">(</span><span class="builtintype" id="7998793">true</span><span class="op" id="7998797">)</span>&nbsp;<span class="op" id="7998799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998805">t</span><span class="op" id="7998806">.</span><span class="ident" id="7998807">Error</span><span class="op" id="7998812">(</span><span class="string" id="7998813">&#34;broken&#34;</span><span class="op" id="7998821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998827">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998842">c</span>&nbsp;<span class="op" id="7998844">&lt;-</span>&nbsp;<span class="builtintype" id="7998847">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998854">}</span><span class="op" id="7998855">(</span><span class="op" id="7998856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7998859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7998862">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998929">time</span><span class="op" id="7998933">.</span><span class="ident" id="7998934">Sleep</span><span class="op" id="7998939">(</span><span class="ident" id="7998940">time</span><span class="op" id="7998944">.</span><span class="ident" id="7998945">Millisecond</span><span class="op" id="7998956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998959">select</span>&nbsp;<span class="op" id="7998966">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7998969">case</span>&nbsp;<span class="op" id="7998974">&lt;-</span><span class="ident" id="7998976">c</span><span class="op" id="7998977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7998981">t</span><span class="op" id="7998982">.</span><span class="ident" id="7998983">Fatal</span><span class="op" id="7998988">(</span><span class="string" id="7998989">&#34;broken&#34;</span><span class="op" id="7998997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7999000">default</span><span class="op" id="7999007">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7999010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999013">mu</span><span class="op" id="7999015">.</span><span class="ident" id="7999016">IncrefAndClose</span><span class="op" id="7999030">(</span><span class="op" id="7999031">)</span>&nbsp;<span class="comment" id="7999033">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7999063">for</span>&nbsp;<span class="ident" id="7999067">i</span>&nbsp;<span class="op" id="7999069">:=</span>&nbsp;<span class="num" id="7999072">0</span><span class="op" id="7999073">;</span>&nbsp;<span class="ident" id="7999075">i</span>&nbsp;<span class="op" id="7999077">&lt;</span>&nbsp;<span class="num" id="7999079">4</span><span class="op" id="7999080">;</span>&nbsp;<span class="ident" id="7999082">i</span><span class="op" id="7999083">++</span>&nbsp;<span class="op" id="7999086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7999090">select</span>&nbsp;<span class="op" id="7999097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7999101">case</span>&nbsp;<span class="op" id="7999106">&lt;-</span><span class="ident" id="7999108">c</span><span class="op" id="7999109">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7999113">case</span>&nbsp;<span class="op" id="7999118">&lt;-</span><span class="ident" id="7999120">time</span><span class="op" id="7999124">.</span><span class="ident" id="7999125">After</span><span class="op" id="7999130">(</span><span class="num" id="7999131">10</span>&nbsp;<span class="op" id="7999134">*</span>&nbsp;<span class="ident" id="7999136">time</span><span class="op" id="7999140">.</span><span class="ident" id="7999141">Second</span><span class="op" id="7999147">)</span><span class="op" id="7999148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999153">t</span><span class="op" id="7999154">.</span><span class="ident" id="7999155">Fatal</span><span class="op" id="7999160">(</span><span class="string" id="7999161">&#34;broken&#34;</span><span class="op" id="7999169">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7999173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7999176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7999179">if</span>&nbsp;<span class="ident" id="7999182">mu</span><span class="op" id="7999184">.</span><span class="ident" id="7999185">Decref</span><span class="op" id="7999191">(</span><span class="op" id="7999192">)</span>&nbsp;<span class="op" id="7999194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999198">t</span><span class="op" id="7999199">.</span><span class="ident" id="7999200">Fatal</span><span class="op" id="7999205">(</span><span class="string" id="7999206">&#34;broken&#34;</span><span class="op" id="7999214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7999217">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7999220">if</span>&nbsp;<span class="op" id="7999223">!</span><span class="ident" id="7999224">mu</span><span class="op" id="7999226">.</span><span class="ident" id="7999227">RWUnlock</span><span class="op" id="7999235">(</span><span class="builtintype" id="7999236">true</span><span class="op" id="7999240">)</span>&nbsp;<span class="op" id="7999242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999246">t</span><span class="op" id="7999247">.</span><span class="ident" id="7999248">Fatal</span><span class="op" id="7999253">(</span><span class="string" id="7999254">&#34;broken&#34;</span><span class="op" id="7999262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7999265">}</span><br>
<span class="lineno"></span><span class="op" id="7999267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7999270">func</span>&nbsp;<span class="ident" id="7999275">TestMutexPanic</span><span class="op" id="7999289">(</span><span class="ident" id="7999290">t</span>&nbsp;<span class="op" id="7999292">*</span><span class="ident" id="7999293">testing</span><span class="op" id="7999300">.</span><span class="ident" id="7999301">T</span><span class="op" id="7999302">)</span>&nbsp;<span class="op" id="7999304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999307">ensurePanics</span>&nbsp;<span class="op" id="7999320">:=</span>&nbsp;<span class="keyword" id="7999323">func</span><span class="op" id="7999327">(</span><span class="ident" id="7999328">f</span>&nbsp;<span class="keyword" id="7999330">func</span><span class="op" id="7999334">(</span><span class="op" id="7999335">)</span><span class="op" id="7999336">)</span>&nbsp;<span class="op" id="7999338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7999342">defer</span>&nbsp;<span class="keyword" id="7999348">func</span><span class="op" id="7999352">(</span><span class="op" id="7999353">)</span>&nbsp;<span class="op" id="7999355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7999360">if</span>&nbsp;<span class="builtinfunc" id="7999363">recover</span><span class="op" id="7999370">(</span><span class="op" id="7999371">)</span>&nbsp;<span class="op" id="7999373">==</span>&nbsp;<span class="ident" id="7999376">nil</span>&nbsp;<span class="op" id="7999380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999386">t</span><span class="op" id="7999387">.</span><span class="ident" id="7999388">Fatal</span><span class="op" id="7999393">(</span><span class="string" id="7999394">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="7999410">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7999415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7999419">}</span><span class="op" id="7999420">(</span><span class="op" id="7999421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999425">f</span><span class="op" id="7999426">(</span><span class="op" id="7999427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7999430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7999434">var</span>&nbsp;<span class="ident" id="7999438">mu</span>&nbsp;<span class="ident" id="7999441">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999450">ensurePanics</span><span class="op" id="7999462">(</span><span class="keyword" id="7999463">func</span><span class="op" id="7999467">(</span><span class="op" id="7999468">)</span>&nbsp;<span class="op" id="7999470">{</span>&nbsp;<span class="ident" id="7999472">mu</span><span class="op" id="7999474">.</span><span class="ident" id="7999475">Decref</span><span class="op" id="7999481">(</span><span class="op" id="7999482">)</span>&nbsp;<span class="op" id="7999484">}</span><span class="op" id="7999485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999488">ensurePanics</span><span class="op" id="7999500">(</span><span class="keyword" id="7999501">func</span><span class="op" id="7999505">(</span><span class="op" id="7999506">)</span>&nbsp;<span class="op" id="7999508">{</span>&nbsp;<span class="ident" id="7999510">mu</span><span class="op" id="7999512">.</span><span class="ident" id="7999513">RWUnlock</span><span class="op" id="7999521">(</span><span class="builtintype" id="7999522">true</span><span class="op" id="7999526">)</span>&nbsp;<span class="op" id="7999528">}</span><span class="op" id="7999529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999532">ensurePanics</span><span class="op" id="7999544">(</span><span class="keyword" id="7999545">func</span><span class="op" id="7999549">(</span><span class="op" id="7999550">)</span>&nbsp;<span class="op" id="7999552">{</span>&nbsp;<span class="ident" id="7999554">mu</span><span class="op" id="7999556">.</span><span class="ident" id="7999557">RWUnlock</span><span class="op" id="7999565">(</span><span class="builtintype" id="7999566">false</span><span class="op" id="7999571">)</span>&nbsp;<span class="op" id="7999573">}</span><span class="op" id="7999574">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999578">ensurePanics</span><span class="op" id="7999590">(</span><span class="keyword" id="7999591">func</span><span class="op" id="7999595">(</span><span class="op" id="7999596">)</span>&nbsp;<span class="op" id="7999598">{</span>&nbsp;<span class="ident" id="7999600">mu</span><span class="op" id="7999602">.</span><span class="ident" id="7999603">Incref</span><span class="op" id="7999609">(</span><span class="op" id="7999610">)</span><span class="op" id="7999611">;</span>&nbsp;<span class="ident" id="7999613">mu</span><span class="op" id="7999615">.</span><span class="ident" id="7999616">Decref</span><span class="op" id="7999622">(</span><span class="op" id="7999623">)</span><span class="op" id="7999624">;</span>&nbsp;<span class="ident" id="7999626">mu</span><span class="op" id="7999628">.</span><span class="ident" id="7999629">Decref</span><span class="op" id="7999635">(</span><span class="op" id="7999636">)</span>&nbsp;<span class="op" id="7999638">}</span><span class="op" id="7999639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999642">ensurePanics</span><span class="op" id="7999654">(</span><span class="keyword" id="7999655">func</span><span class="op" id="7999659">(</span><span class="op" id="7999660">)</span>&nbsp;<span class="op" id="7999662">{</span>&nbsp;<span class="ident" id="7999664">mu</span><span class="op" id="7999666">.</span><span class="ident" id="7999667">RWLock</span><span class="op" id="7999673">(</span><span class="builtintype" id="7999674">true</span><span class="op" id="7999678">)</span><span class="op" id="7999679">;</span>&nbsp;<span class="ident" id="7999681">mu</span><span class="op" id="7999683">.</span><span class="ident" id="7999684">RWUnlock</span><span class="op" id="7999692">(</span><span class="builtintype" id="7999693">true</span><span class="op" id="7999697">)</span><span class="op" id="7999698">;</span>&nbsp;<span class="ident" id="7999700">mu</span><span class="op" id="7999702">.</span><span class="ident" id="7999703">RWUnlock</span><span class="op" id="7999711">(</span><span class="builtintype" id="7999712">true</span><span class="op" id="7999716">)</span>&nbsp;<span class="op" id="7999718">}</span><span class="op" id="7999719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999722">ensurePanics</span><span class="op" id="7999734">(</span><span class="keyword" id="7999735">func</span><span class="op" id="7999739">(</span><span class="op" id="7999740">)</span>&nbsp;<span class="op" id="7999742">{</span>&nbsp;<span class="ident" id="7999744">mu</span><span class="op" id="7999746">.</span><span class="ident" id="7999747">RWLock</span><span class="op" id="7999753">(</span><span class="builtintype" id="7999754">false</span><span class="op" id="7999759">)</span><span class="op" id="7999760">;</span>&nbsp;<span class="ident" id="7999762">mu</span><span class="op" id="7999764">.</span><span class="ident" id="7999765">RWUnlock</span><span class="op" id="7999773">(</span><span class="builtintype" id="7999774">false</span><span class="op" id="7999779">)</span><span class="op" id="7999780">;</span>&nbsp;<span class="ident" id="7999782">mu</span><span class="op" id="7999784">.</span><span class="ident" id="7999785">RWUnlock</span><span class="op" id="7999793">(</span><span class="builtintype" id="7999794">false</span><span class="op" id="7999799">)</span>&nbsp;<span class="op" id="7999801">}</span><span class="op" id="7999802">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7999806">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999844">mu</span><span class="op" id="7999846">.</span><span class="ident" id="7999847">Incref</span><span class="op" id="7999853">(</span><span class="op" id="7999854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999857">mu</span><span class="op" id="7999859">.</span><span class="ident" id="7999860">Decref</span><span class="op" id="7999866">(</span><span class="op" id="7999867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999870">mu</span><span class="op" id="7999872">.</span><span class="ident" id="7999873">RWLock</span><span class="op" id="7999879">(</span><span class="builtintype" id="7999880">true</span><span class="op" id="7999884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999887">mu</span><span class="op" id="7999889">.</span><span class="ident" id="7999890">RWUnlock</span><span class="op" id="7999898">(</span><span class="builtintype" id="7999899">true</span><span class="op" id="7999903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999906">mu</span><span class="op" id="7999908">.</span><span class="ident" id="7999909">RWLock</span><span class="op" id="7999915">(</span><span class="builtintype" id="7999916">false</span><span class="op" id="7999921">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999924">mu</span><span class="op" id="7999926">.</span><span class="ident" id="7999927">RWUnlock</span><span class="op" id="7999935">(</span><span class="builtintype" id="7999936">false</span><span class="op" id="7999941">)</span><br>
<span class="lineno"></span><span class="op" id="7999943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7999946">func</span>&nbsp;<span class="ident" id="7999951">TestMutexStress</span><span class="op" id="7999966">(</span><span class="ident" id="7999967">t</span>&nbsp;<span class="op" id="7999969">*</span><span class="ident" id="7999970">testing</span><span class="op" id="7999977">.</span><span class="ident" id="7999978">T</span><span class="op" id="7999979">)</span>&nbsp;<span class="op" id="7999981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999984">P</span>&nbsp;<span class="op" id="7999986">:=</span>&nbsp;<span class="num" id="7999989">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7999992">N</span>&nbsp;<span class="op" id="7999994">:=</span>&nbsp;<span class="builtintype" id="7999997">int</span><span class="op" id="8000000">(</span><span class="num" id="8000001">1e6</span><span class="op" id="8000004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000007">if</span>&nbsp;<span class="ident" id="8000010">testing</span><span class="op" id="8000017">.</span><span class="ident" id="8000018">Short</span><span class="op" id="8000023">(</span><span class="op" id="8000024">)</span>&nbsp;<span class="op" id="8000026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8000030">P</span>&nbsp;<span class="op" id="8000032">=</span>&nbsp;<span class="num" id="8000034">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8000038">N</span>&nbsp;<span class="op" id="8000040">=</span>&nbsp;<span class="num" id="8000042">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8000047">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000050">defer</span>&nbsp;<span class="ident" id="8000056">runtime</span><span class="op" id="8000063">.</span><span class="ident" id="8000064">GOMAXPROCS</span><span class="op" id="8000074">(</span><span class="ident" id="8000075">runtime</span><span class="op" id="8000082">.</span><span class="ident" id="8000083">GOMAXPROCS</span><span class="op" id="8000093">(</span><span class="ident" id="8000094">P</span><span class="op" id="8000095">)</span><span class="op" id="8000096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8000099">done</span>&nbsp;<span class="op" id="8000104">:=</span>&nbsp;<span class="builtinfunc" id="8000107">make</span><span class="op" id="8000111">(</span><span class="keyword" id="8000112">chan</span>&nbsp;<span class="builtintype" id="8000117">bool</span><span class="op" id="8000121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000124">var</span>&nbsp;<span class="ident" id="8000128">mu</span>&nbsp;<span class="ident" id="8000131">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000140">var</span>&nbsp;<span class="ident" id="8000144">readState</span>&nbsp;<span class="op" id="8000154">[</span><span class="num" id="8000155">2</span><span class="op" id="8000156">]</span><span class="ident" id="8000157">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000165">var</span>&nbsp;<span class="ident" id="8000169">writeState</span>&nbsp;<span class="op" id="8000180">[</span><span class="num" id="8000181">2</span><span class="op" id="8000182">]</span><span class="ident" id="8000183">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000191">for</span>&nbsp;<span class="ident" id="8000195">p</span>&nbsp;<span class="op" id="8000197">:=</span>&nbsp;<span class="num" id="8000200">0</span><span class="op" id="8000201">;</span>&nbsp;<span class="ident" id="8000203">p</span>&nbsp;<span class="op" id="8000205">&lt;</span>&nbsp;<span class="ident" id="8000207">P</span><span class="op" id="8000208">;</span>&nbsp;<span class="ident" id="8000210">p</span><span class="op" id="8000211">++</span>&nbsp;<span class="op" id="8000214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000218">go</span>&nbsp;<span class="keyword" id="8000221">func</span><span class="op" id="8000225">(</span><span class="op" id="8000226">)</span>&nbsp;<span class="op" id="8000228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8000233">r</span>&nbsp;<span class="op" id="8000235">:=</span>&nbsp;<span class="ident" id="8000238">rand</span><span class="op" id="8000242">.</span><span class="ident" id="8000243">New</span><span class="op" id="8000246">(</span><span class="ident" id="8000247">rand</span><span class="op" id="8000251">.</span><span class="ident" id="8000252">NewSource</span><span class="op" id="8000261">(</span><span class="ident" id="8000262">rand</span><span class="op" id="8000266">.</span><span class="ident" id="8000267">Int63</span><span class="op" id="8000272">(</span><span class="op" id="8000273">)</span><span class="op" id="8000274">)</span><span class="op" id="8000275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000280">for</span>&nbsp;<span class="ident" id="8000284">i</span>&nbsp;<span class="op" id="8000286">:=</span>&nbsp;<span class="num" id="8000289">0</span><span class="op" id="8000290">;</span>&nbsp;<span class="ident" id="8000292">i</span>&nbsp;<span class="op" id="8000294">&lt;</span>&nbsp;<span class="ident" id="8000296">N</span><span class="op" id="8000297">;</span>&nbsp;<span class="ident" id="8000299">i</span><span class="op" id="8000300">++</span>&nbsp;<span class="op" id="8000303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000309">switch</span>&nbsp;<span class="ident" id="8000316">r</span><span class="op" id="8000317">.</span><span class="ident" id="8000318">Intn</span><span class="op" id="8000322">(</span><span class="num" id="8000323">3</span><span class="op" id="8000324">)</span>&nbsp;<span class="op" id="8000326">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000332">case</span>&nbsp;<span class="num" id="8000337">0</span><span class="op" id="8000338">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000345">if</span>&nbsp;<span class="op" id="8000348">!</span><span class="ident" id="8000349">mu</span><span class="op" id="8000351">.</span><span class="ident" id="8000352">Incref</span><span class="op" id="8000358">(</span><span class="op" id="8000359">)</span>&nbsp;<span class="op" id="8000361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8000369">t</span><span class="op" id="8000370">.</span><span class="ident" id="8000371">Error</span><span class="op" id="8000376">(</span><span class="string" id="8000377">&#34;broken&#34;</span><span class="op" id="8000385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000393">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8000405">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000412">if</span>&nbsp;<span class="ident" id="8000415">mu</span><span class="op" id="8000417">.</span><span class="ident" id="8000418">Decref</span><span class="op" id="8000424">(</span><span class="op" id="8000425">)</span>&nbsp;<span class="op" id="8000427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8000435">t</span><span class="op" id="8000436">.</span><span class="ident" id="8000437">Error</span><span class="op" id="8000442">(</span><span class="string" id="8000443">&#34;broken&#34;</span><span class="op" id="8000451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000459">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8000471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000477">case</span>&nbsp;<span class="num" id="8000482">1</span><span class="op" id="8000483">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000490">if</span>&nbsp;<span class="op" id="8000493">!</span><span class="ident" id="8000494">mu</span><span class="op" id="8000496">.</span><span class="ident" id="8000497">RWLock</span><span class="op" id="8000503">(</span><span class="builtintype" id="8000504">true</span><span class="op" id="8000508">)</span>&nbsp;<span class="op" id="8000510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8000518">t</span><span class="op" id="8000519">.</span><span class="ident" id="8000520">Error</span><span class="op" id="8000525">(</span><span class="string" id="8000526">&#34;broken&#34;</span><span class="op" id="8000534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000542">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8000554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8000561">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000623">if</span>&nbsp;<span class="ident" id="8000626">readState</span><span class="op" id="8000635">[</span><span class="num" id="8000636">0</span><span class="op" id="8000637">]</span>&nbsp;<span class="op" id="8000639">!=</span>&nbsp;<span class="ident" id="8000642">readState</span><span class="op" id="8000651">[</span><span class="num" id="8000652">1</span><span class="op" id="8000653">]</span>&nbsp;<span class="op" id="8000655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8000663">t</span><span class="op" id="8000664">.</span><span class="ident" id="8000665">Error</span><span class="op" id="8000670">(</span><span class="string" id="8000671">&#34;broken&#34;</span><span class="op" id="8000679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000687">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8000699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8000706">readState</span><span class="op" id="8000715">[</span><span class="num" id="8000716">0</span><span class="op" id="8000717">]</span><span class="op" id="8000718">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8000726">readState</span><span class="op" id="8000735">[</span><span class="num" id="8000736">1</span><span class="op" id="8000737">]</span><span class="op" id="8000738">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000746">if</span>&nbsp;<span class="ident" id="8000749">mu</span><span class="op" id="8000751">.</span><span class="ident" id="8000752">RWUnlock</span><span class="op" id="8000760">(</span><span class="builtintype" id="8000761">true</span><span class="op" id="8000765">)</span>&nbsp;<span class="op" id="8000767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8000775">t</span><span class="op" id="8000776">.</span><span class="ident" id="8000777">Error</span><span class="op" id="8000782">(</span><span class="string" id="8000783">&#34;broken&#34;</span><span class="op" id="8000791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000799">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8000811">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000817">case</span>&nbsp;<span class="num" id="8000822">2</span><span class="op" id="8000823">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000830">if</span>&nbsp;<span class="op" id="8000833">!</span><span class="ident" id="8000834">mu</span><span class="op" id="8000836">.</span><span class="ident" id="8000837">RWLock</span><span class="op" id="8000843">(</span><span class="builtintype" id="8000844">false</span><span class="op" id="8000849">)</span>&nbsp;<span class="op" id="8000851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8000859">t</span><span class="op" id="8000860">.</span><span class="ident" id="8000861">Error</span><span class="op" id="8000866">(</span><span class="string" id="8000867">&#34;broken&#34;</span><span class="op" id="8000875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000883">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8000895">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8000902">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8000964">if</span>&nbsp;<span class="ident" id="8000967">writeState</span><span class="op" id="8000977">[</span><span class="num" id="8000978">0</span><span class="op" id="8000979">]</span>&nbsp;<span class="op" id="8000981">!=</span>&nbsp;<span class="ident" id="8000984">writeState</span><span class="op" id="8000994">[</span><span class="num" id="8000995">1</span><span class="op" id="8000996">]</span>&nbsp;<span class="op" id="8000998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8001006">t</span><span class="op" id="8001007">.</span><span class="ident" id="8001008">Error</span><span class="op" id="8001013">(</span><span class="string" id="8001014">&#34;broken&#34;</span><span class="op" id="8001022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8001030">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8001042">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8001049">writeState</span><span class="op" id="8001059">[</span><span class="num" id="8001060">0</span><span class="op" id="8001061">]</span><span class="op" id="8001062">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8001070">writeState</span><span class="op" id="8001080">[</span><span class="num" id="8001081">1</span><span class="op" id="8001082">]</span><span class="op" id="8001083">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8001091">if</span>&nbsp;<span class="ident" id="8001094">mu</span><span class="op" id="8001096">.</span><span class="ident" id="8001097">RWUnlock</span><span class="op" id="8001105">(</span><span class="builtintype" id="8001106">false</span><span class="op" id="8001111">)</span>&nbsp;<span class="op" id="8001113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8001121">t</span><span class="op" id="8001122">.</span><span class="ident" id="8001123">Error</span><span class="op" id="8001128">(</span><span class="string" id="8001129">&#34;broken&#34;</span><span class="op" id="8001137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8001145">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8001157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8001163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8001168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8001173">done</span>&nbsp;<span class="op" id="8001178">&lt;-</span>&nbsp;<span class="builtintype" id="8001181">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8001188">}</span><span class="op" id="8001189">(</span><span class="op" id="8001190">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8001193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8001196">for</span>&nbsp;<span class="ident" id="8001200">p</span>&nbsp;<span class="op" id="8001202">:=</span>&nbsp;<span class="num" id="8001205">0</span><span class="op" id="8001206">;</span>&nbsp;<span class="ident" id="8001208">p</span>&nbsp;<span class="op" id="8001210">&lt;</span>&nbsp;<span class="ident" id="8001212">P</span><span class="op" id="8001213">;</span>&nbsp;<span class="ident" id="8001215">p</span><span class="op" id="8001216">++</span>&nbsp;<span class="op" id="8001219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8001223">&lt;-</span><span class="ident" id="8001225">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8001231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8001234">if</span>&nbsp;<span class="op" id="8001237">!</span><span class="ident" id="8001238">mu</span><span class="op" id="8001240">.</span><span class="ident" id="8001241">IncrefAndClose</span><span class="op" id="8001255">(</span><span class="op" id="8001256">)</span>&nbsp;<span class="op" id="8001258">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8001262">t</span><span class="op" id="8001263">.</span><span class="ident" id="8001264">Fatal</span><span class="op" id="8001269">(</span><span class="string" id="8001270">&#34;broken&#34;</span><span class="op" id="8001278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8001281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8001284">if</span>&nbsp;<span class="op" id="8001287">!</span><span class="ident" id="8001288">mu</span><span class="op" id="8001290">.</span><span class="ident" id="8001291">Decref</span><span class="op" id="8001297">(</span><span class="op" id="8001298">)</span>&nbsp;<span class="op" id="8001300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8001304">t</span><span class="op" id="8001305">.</span><span class="ident" id="8001306">Fatal</span><span class="op" id="8001311">(</span><span class="string" id="8001312">&#34;broken&#34;</span><span class="op" id="8001320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8001323">}</span><br>
<span class="lineno">195</span><span class="op" id="8001325">}</span>
</div>
</body>
</html>
