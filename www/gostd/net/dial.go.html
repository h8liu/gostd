<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html" class="current">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3186668">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3186724">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3186778">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3186829">package</span>&nbsp;<span class="ident" id="3186837">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3186842">import</span>&nbsp;<span class="op" id="3186849">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3186852">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3186862">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3186869">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3186872">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3186931">//</span><br>
<span class="lineno"></span><span class="comment" id="3186934">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="3186992">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="3187054">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3187116">type</span>&nbsp;<span class="ident" id="3187121">Dialer</span>&nbsp;<span class="keyword" id="3187128">struct</span>&nbsp;<span class="op" id="3187135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187138">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187201">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187265">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187278">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187282">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187313">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187317">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187380">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187440">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3187468">Timeout</span>&nbsp;<span class="ident" id="3187476">time</span><span class="op" id="3187480">.</span><span class="ident" id="3187481">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187492">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187553">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187608">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187673">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3187705">Deadline</span>&nbsp;<span class="ident" id="3187714">time</span><span class="op" id="3187718">.</span><span class="ident" id="3187719">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187726">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187784">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187846">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187872">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3187925">LocalAddr</span>&nbsp;<span class="ident" id="3187935">Addr</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3187942">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3188001">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3188064">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3188125">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3188189">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3188206">DualStack</span>&nbsp;<span class="builtintype" id="3188216">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3188223">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3188283">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3188307">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3188367">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3188422">KeepAlive</span>&nbsp;<span class="ident" id="3188432">time</span><span class="op" id="3188436">.</span><span class="ident" id="3188437">Duration</span><br>
<span class="lineno"></span><span class="op" id="3188446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3188449">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3188514">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3188545">func</span>&nbsp;<span class="op" id="3188550">(</span><span class="ident" id="3188551">d</span>&nbsp;<span class="op" id="3188553">*</span><span class="ident" id="3188554">Dialer</span><span class="op" id="3188560">)</span>&nbsp;<span class="ident" id="3188562">deadline</span><span class="op" id="3188570">(</span><span class="op" id="3188571">)</span>&nbsp;<span class="ident" id="3188573">time</span><span class="op" id="3188577">.</span><span class="ident" id="3188578">Time</span>&nbsp;<span class="op" id="3188583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3188586">if</span>&nbsp;<span class="ident" id="3188589">d</span><span class="op" id="3188590">.</span><span class="ident" id="3188591">Timeout</span>&nbsp;<span class="op" id="3188599">==</span>&nbsp;<span class="num" id="3188602">0</span>&nbsp;<span class="op" id="3188604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3188608">return</span>&nbsp;<span class="ident" id="3188615">d</span><span class="op" id="3188616">.</span><span class="ident" id="3188617">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3188627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3188630">timeoutDeadline</span>&nbsp;<span class="op" id="3188646">:=</span>&nbsp;<span class="ident" id="3188649">time</span><span class="op" id="3188653">.</span><span class="ident" id="3188654">Now</span><span class="op" id="3188657">(</span><span class="op" id="3188658">)</span><span class="op" id="3188659">.</span><span class="ident" id="3188660">Add</span><span class="op" id="3188663">(</span><span class="ident" id="3188664">d</span><span class="op" id="3188665">.</span><span class="ident" id="3188666">Timeout</span><span class="op" id="3188673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3188676">if</span>&nbsp;<span class="ident" id="3188679">d</span><span class="op" id="3188680">.</span><span class="ident" id="3188681">Deadline</span><span class="op" id="3188689">.</span><span class="ident" id="3188690">IsZero</span><span class="op" id="3188696">(</span><span class="op" id="3188697">)</span>&nbsp;<span class="op" id="3188699">||</span>&nbsp;<span class="ident" id="3188702">timeoutDeadline</span><span class="op" id="3188717">.</span><span class="ident" id="3188718">Before</span><span class="op" id="3188724">(</span><span class="ident" id="3188725">d</span><span class="op" id="3188726">.</span><span class="ident" id="3188727">Deadline</span><span class="op" id="3188735">)</span>&nbsp;<span class="op" id="3188737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3188741">return</span>&nbsp;<span class="ident" id="3188748">timeoutDeadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3188765">}</span>&nbsp;<span class="keyword" id="3188767">else</span>&nbsp;<span class="op" id="3188772">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3188776">return</span>&nbsp;<span class="ident" id="3188783">d</span><span class="op" id="3188784">.</span><span class="ident" id="3188785">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3188795">}</span><br>
<span class="lineno"></span><span class="op" id="3188797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3188800">func</span>&nbsp;<span class="ident" id="3188805">parseNetwork</span><span class="op" id="3188817">(</span><span class="ident" id="3188818">net</span>&nbsp;<span class="builtintype" id="3188822">string</span><span class="op" id="3188828">)</span>&nbsp;<span class="op" id="3188830">(</span><span class="ident" id="3188831">afnet</span>&nbsp;<span class="builtintype" id="3188837">string</span><span class="op" id="3188843">,</span>&nbsp;<span class="ident" id="3188845">proto</span>&nbsp;<span class="builtintype" id="3188851">int</span><span class="op" id="3188854">,</span>&nbsp;<span class="ident" id="3188856">err</span>&nbsp;<span class="builtintype" id="3188860">error</span><span class="op" id="3188865">)</span>&nbsp;<span class="op" id="3188867">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3188870">i</span>&nbsp;<span class="op" id="3188872">:=</span>&nbsp;<span class="ident" id="3188875">last</span><span class="op" id="3188879">(</span><span class="ident" id="3188880">net</span><span class="op" id="3188883">,</span>&nbsp;<span class="string" id="3188885">&#39;:&#39;</span><span class="op" id="3188888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3188891">if</span>&nbsp;<span class="ident" id="3188894">i</span>&nbsp;<span class="op" id="3188896">&lt;</span>&nbsp;<span class="num" id="3188898">0</span>&nbsp;<span class="op" id="3188900">{</span>&nbsp;<span class="comment" id="3188902">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3188916">switch</span>&nbsp;<span class="ident" id="3188923">net</span>&nbsp;<span class="op" id="3188927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3188931">case</span>&nbsp;<span class="string" id="3188936">&#34;tcp&#34;</span><span class="op" id="3188941">,</span>&nbsp;<span class="string" id="3188943">&#34;tcp4&#34;</span><span class="op" id="3188949">,</span>&nbsp;<span class="string" id="3188951">&#34;tcp6&#34;</span><span class="op" id="3188957">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3188961">case</span>&nbsp;<span class="string" id="3188966">&#34;udp&#34;</span><span class="op" id="3188971">,</span>&nbsp;<span class="string" id="3188973">&#34;udp4&#34;</span><span class="op" id="3188979">,</span>&nbsp;<span class="string" id="3188981">&#34;udp6&#34;</span><span class="op" id="3188987">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3188991">case</span>&nbsp;<span class="string" id="3188996">&#34;ip&#34;</span><span class="op" id="3189000">,</span>&nbsp;<span class="string" id="3189002">&#34;ip4&#34;</span><span class="op" id="3189007">,</span>&nbsp;<span class="string" id="3189009">&#34;ip6&#34;</span><span class="op" id="3189014">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189018">case</span>&nbsp;<span class="string" id="3189023">&#34;unix&#34;</span><span class="op" id="3189029">,</span>&nbsp;<span class="string" id="3189031">&#34;unixgram&#34;</span><span class="op" id="3189041">,</span>&nbsp;<span class="string" id="3189043">&#34;unixpacket&#34;</span><span class="op" id="3189055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189059">default</span><span class="op" id="3189066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189071">return</span>&nbsp;<span class="string" id="3189078">&#34;&#34;</span><span class="op" id="3189080">,</span>&nbsp;<span class="num" id="3189082">0</span><span class="op" id="3189083">,</span>&nbsp;<span class="ident" id="3189085">UnknownNetworkError</span><span class="op" id="3189104">(</span><span class="ident" id="3189105">net</span><span class="op" id="3189108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3189112">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189116">return</span>&nbsp;<span class="ident" id="3189123">net</span><span class="op" id="3189126">,</span>&nbsp;<span class="num" id="3189128">0</span><span class="op" id="3189129">,</span>&nbsp;<span class="builtintype" id="3189131">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3189136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3189139">afnet</span>&nbsp;<span class="op" id="3189145">=</span>&nbsp;<span class="ident" id="3189147">net</span><span class="op" id="3189150">[</span><span class="op" id="3189151">:</span><span class="ident" id="3189152">i</span><span class="op" id="3189153">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189156">switch</span>&nbsp;<span class="ident" id="3189163">afnet</span>&nbsp;<span class="op" id="3189169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189172">case</span>&nbsp;<span class="string" id="3189177">&#34;ip&#34;</span><span class="op" id="3189181">,</span>&nbsp;<span class="string" id="3189183">&#34;ip4&#34;</span><span class="op" id="3189188">,</span>&nbsp;<span class="string" id="3189190">&#34;ip6&#34;</span><span class="op" id="3189195">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3189199">protostr</span>&nbsp;<span class="op" id="3189208">:=</span>&nbsp;<span class="ident" id="3189211">net</span><span class="op" id="3189214">[</span><span class="ident" id="3189215">i</span><span class="op" id="3189216">+</span><span class="num" id="3189217">1</span><span class="op" id="3189218">:</span><span class="op" id="3189219">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3189223">proto</span><span class="op" id="3189228">,</span>&nbsp;<span class="ident" id="3189230">i</span><span class="op" id="3189231">,</span>&nbsp;<span class="ident" id="3189233">ok</span>&nbsp;<span class="op" id="3189236">:=</span>&nbsp;<span class="ident" id="3189239">dtoi</span><span class="op" id="3189243">(</span><span class="ident" id="3189244">protostr</span><span class="op" id="3189252">,</span>&nbsp;<span class="num" id="3189254">0</span><span class="op" id="3189255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189259">if</span>&nbsp;<span class="op" id="3189262">!</span><span class="ident" id="3189263">ok</span>&nbsp;<span class="op" id="3189266">||</span>&nbsp;<span class="ident" id="3189269">i</span>&nbsp;<span class="op" id="3189271">!=</span>&nbsp;<span class="builtinfunc" id="3189274">len</span><span class="op" id="3189277">(</span><span class="ident" id="3189278">protostr</span><span class="op" id="3189286">)</span>&nbsp;<span class="op" id="3189288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3189293">proto</span><span class="op" id="3189298">,</span>&nbsp;<span class="ident" id="3189300">err</span>&nbsp;<span class="op" id="3189304">=</span>&nbsp;<span class="ident" id="3189306">lookupProtocol</span><span class="op" id="3189320">(</span><span class="ident" id="3189321">protostr</span><span class="op" id="3189329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189334">if</span>&nbsp;<span class="ident" id="3189337">err</span>&nbsp;<span class="op" id="3189341">!=</span>&nbsp;<span class="builtintype" id="3189344">nil</span>&nbsp;<span class="op" id="3189348">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189354">return</span>&nbsp;<span class="string" id="3189361">&#34;&#34;</span><span class="op" id="3189363">,</span>&nbsp;<span class="num" id="3189365">0</span><span class="op" id="3189366">,</span>&nbsp;<span class="ident" id="3189368">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3189375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3189379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189383">return</span>&nbsp;<span class="ident" id="3189390">afnet</span><span class="op" id="3189395">,</span>&nbsp;<span class="ident" id="3189397">proto</span><span class="op" id="3189402">,</span>&nbsp;<span class="builtintype" id="3189404">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3189409">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189412">return</span>&nbsp;<span class="string" id="3189419">&#34;&#34;</span><span class="op" id="3189421">,</span>&nbsp;<span class="num" id="3189423">0</span><span class="op" id="3189424">,</span>&nbsp;<span class="ident" id="3189426">UnknownNetworkError</span><span class="op" id="3189445">(</span><span class="ident" id="3189446">net</span><span class="op" id="3189449">)</span><br>
<span class="lineno"></span><span class="op" id="3189451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3189454">func</span>&nbsp;<span class="ident" id="3189459">resolveAddr</span><span class="op" id="3189470">(</span><span class="ident" id="3189471">op</span><span class="op" id="3189473">,</span>&nbsp;<span class="ident" id="3189475">net</span><span class="op" id="3189478">,</span>&nbsp;<span class="ident" id="3189480">addr</span>&nbsp;<span class="builtintype" id="3189485">string</span><span class="op" id="3189491">,</span>&nbsp;<span class="ident" id="3189493">deadline</span>&nbsp;<span class="ident" id="3189502">time</span><span class="op" id="3189506">.</span><span class="ident" id="3189507">Time</span><span class="op" id="3189511">)</span>&nbsp;<span class="op" id="3189513">(</span><span class="ident" id="3189514">netaddr</span><span class="op" id="3189521">,</span>&nbsp;<span class="builtintype" id="3189523">error</span><span class="op" id="3189528">)</span>&nbsp;<span class="op" id="3189530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3189533">afnet</span><span class="op" id="3189538">,</span>&nbsp;<span class="ident" id="3189540">_</span><span class="op" id="3189541">,</span>&nbsp;<span class="ident" id="3189543">err</span>&nbsp;<span class="op" id="3189547">:=</span>&nbsp;<span class="ident" id="3189550">parseNetwork</span><span class="op" id="3189562">(</span><span class="ident" id="3189563">net</span><span class="op" id="3189566">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189569">if</span>&nbsp;<span class="ident" id="3189572">err</span>&nbsp;<span class="op" id="3189576">!=</span>&nbsp;<span class="builtintype" id="3189579">nil</span>&nbsp;<span class="op" id="3189583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189587">return</span>&nbsp;<span class="builtintype" id="3189594">nil</span><span class="op" id="3189597">,</span>&nbsp;<span class="ident" id="3189599">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3189604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189607">if</span>&nbsp;<span class="ident" id="3189610">op</span>&nbsp;<span class="op" id="3189613">==</span>&nbsp;<span class="string" id="3189616">&#34;dial&#34;</span>&nbsp;<span class="op" id="3189623">&amp;&amp;</span>&nbsp;<span class="ident" id="3189626">addr</span>&nbsp;<span class="op" id="3189631">==</span>&nbsp;<span class="string" id="3189634">&#34;&#34;</span>&nbsp;<span class="op" id="3189637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189641">return</span>&nbsp;<span class="builtintype" id="3189648">nil</span><span class="op" id="3189651">,</span>&nbsp;<span class="ident" id="3189653">errMissingAddress</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3189672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189675">switch</span>&nbsp;<span class="ident" id="3189682">afnet</span>&nbsp;<span class="op" id="3189688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189691">case</span>&nbsp;<span class="string" id="3189696">&#34;unix&#34;</span><span class="op" id="3189702">,</span>&nbsp;<span class="string" id="3189704">&#34;unixgram&#34;</span><span class="op" id="3189714">,</span>&nbsp;<span class="string" id="3189716">&#34;unixpacket&#34;</span><span class="op" id="3189728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189732">return</span>&nbsp;<span class="ident" id="3189739">ResolveUnixAddr</span><span class="op" id="3189754">(</span><span class="ident" id="3189755">afnet</span><span class="op" id="3189760">,</span>&nbsp;<span class="ident" id="3189762">addr</span><span class="op" id="3189766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3189769">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3189772">return</span>&nbsp;<span class="ident" id="3189779">resolveInternetAddr</span><span class="op" id="3189798">(</span><span class="ident" id="3189799">afnet</span><span class="op" id="3189804">,</span>&nbsp;<span class="ident" id="3189806">addr</span><span class="op" id="3189810">,</span>&nbsp;<span class="ident" id="3189812">deadline</span><span class="op" id="3189820">)</span><br>
<span class="lineno"></span><span class="op" id="3189822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3189825">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3189879">//</span><br>
<span class="lineno">115</span><span class="comment" id="3189882">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="3189951">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3190013">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3190071">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3190088">//</span><br>
<span class="lineno">120</span><span class="comment" id="3190091">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="3190155">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="3190212">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3190277">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="3190346">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="3190363">//</span><br>
<span class="lineno"></span><span class="comment" id="3190366">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3190379">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3190412">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3190446">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="3190483">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3190518">//</span><br>
<span class="lineno"></span><span class="comment" id="3190521">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="3190591">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3190658">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="3190681">//</span><br>
<span class="lineno"></span><span class="comment" id="3190684">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3190697">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3190727">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3190754">//</span><br>
<span class="lineno">140</span><span class="comment" id="3190757">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="3190819">func</span>&nbsp;<span class="ident" id="3190824">Dial</span><span class="op" id="3190828">(</span><span class="ident" id="3190829">network</span><span class="op" id="3190836">,</span>&nbsp;<span class="ident" id="3190838">address</span>&nbsp;<span class="builtintype" id="3190846">string</span><span class="op" id="3190852">)</span>&nbsp;<span class="op" id="3190854">(</span><span class="ident" id="3190855">Conn</span><span class="op" id="3190859">,</span>&nbsp;<span class="builtintype" id="3190861">error</span><span class="op" id="3190866">)</span>&nbsp;<span class="op" id="3190868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3190871">var</span>&nbsp;<span class="ident" id="3190875">d</span>&nbsp;<span class="ident" id="3190877">Dialer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3190885">return</span>&nbsp;<span class="ident" id="3190892">d</span><span class="op" id="3190893">.</span><span class="ident" id="3190894">Dial</span><span class="op" id="3190898">(</span><span class="ident" id="3190899">network</span><span class="op" id="3190906">,</span>&nbsp;<span class="ident" id="3190908">address</span><span class="op" id="3190915">)</span><br>
<span class="lineno"></span><span class="op" id="3190917">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="3190920">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="3190971">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="3191025">func</span>&nbsp;<span class="ident" id="3191030">DialTimeout</span><span class="op" id="3191041">(</span><span class="ident" id="3191042">network</span><span class="op" id="3191049">,</span>&nbsp;<span class="ident" id="3191051">address</span>&nbsp;<span class="builtintype" id="3191059">string</span><span class="op" id="3191065">,</span>&nbsp;<span class="ident" id="3191067">timeout</span>&nbsp;<span class="ident" id="3191075">time</span><span class="op" id="3191079">.</span><span class="ident" id="3191080">Duration</span><span class="op" id="3191088">)</span>&nbsp;<span class="op" id="3191090">(</span><span class="ident" id="3191091">Conn</span><span class="op" id="3191095">,</span>&nbsp;<span class="builtintype" id="3191097">error</span><span class="op" id="3191102">)</span>&nbsp;<span class="op" id="3191104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3191107">d</span>&nbsp;<span class="op" id="3191109">:=</span>&nbsp;<span class="ident" id="3191112">Dialer</span><span class="op" id="3191118">{</span><span class="ident" id="3191119">Timeout</span><span class="op" id="3191126">:</span>&nbsp;<span class="ident" id="3191128">timeout</span><span class="op" id="3191135">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3191138">return</span>&nbsp;<span class="ident" id="3191145">d</span><span class="op" id="3191146">.</span><span class="ident" id="3191147">Dial</span><span class="op" id="3191151">(</span><span class="ident" id="3191152">network</span><span class="op" id="3191159">,</span>&nbsp;<span class="ident" id="3191161">address</span><span class="op" id="3191168">)</span><br>
<span class="lineno"></span><span class="op" id="3191170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3191173">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3191227">//</span><br>
<span class="lineno">155</span><span class="comment" id="3191230">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3191292">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="3191307">func</span>&nbsp;<span class="op" id="3191312">(</span><span class="ident" id="3191313">d</span>&nbsp;<span class="op" id="3191315">*</span><span class="ident" id="3191316">Dialer</span><span class="op" id="3191322">)</span>&nbsp;<span class="ident" id="3191324">Dial</span><span class="op" id="3191328">(</span><span class="ident" id="3191329">network</span><span class="op" id="3191336">,</span>&nbsp;<span class="ident" id="3191338">address</span>&nbsp;<span class="builtintype" id="3191346">string</span><span class="op" id="3191352">)</span>&nbsp;<span class="op" id="3191354">(</span><span class="ident" id="3191355">Conn</span><span class="op" id="3191359">,</span>&nbsp;<span class="builtintype" id="3191361">error</span><span class="op" id="3191366">)</span>&nbsp;<span class="op" id="3191368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3191371">ra</span><span class="op" id="3191373">,</span>&nbsp;<span class="ident" id="3191375">err</span>&nbsp;<span class="op" id="3191379">:=</span>&nbsp;<span class="ident" id="3191382">resolveAddr</span><span class="op" id="3191393">(</span><span class="string" id="3191394">&#34;dial&#34;</span><span class="op" id="3191400">,</span>&nbsp;<span class="ident" id="3191402">network</span><span class="op" id="3191409">,</span>&nbsp;<span class="ident" id="3191411">address</span><span class="op" id="3191418">,</span>&nbsp;<span class="ident" id="3191420">d</span><span class="op" id="3191421">.</span><span class="ident" id="3191422">deadline</span><span class="op" id="3191430">(</span><span class="op" id="3191431">)</span><span class="op" id="3191432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3191435">if</span>&nbsp;<span class="ident" id="3191438">err</span>&nbsp;<span class="op" id="3191442">!=</span>&nbsp;<span class="builtintype" id="3191445">nil</span>&nbsp;<span class="op" id="3191449">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3191453">return</span>&nbsp;<span class="builtintype" id="3191460">nil</span><span class="op" id="3191463">,</span>&nbsp;<span class="op" id="3191465">&amp;</span><span class="ident" id="3191466">OpError</span><span class="op" id="3191473">{</span><span class="ident" id="3191474">Op</span><span class="op" id="3191476">:</span>&nbsp;<span class="string" id="3191478">&#34;dial&#34;</span><span class="op" id="3191484">,</span>&nbsp;<span class="ident" id="3191486">Net</span><span class="op" id="3191489">:</span>&nbsp;<span class="ident" id="3191491">network</span><span class="op" id="3191498">,</span>&nbsp;<span class="ident" id="3191500">Addr</span><span class="op" id="3191504">:</span>&nbsp;<span class="builtintype" id="3191506">nil</span><span class="op" id="3191509">,</span>&nbsp;<span class="ident" id="3191511">Err</span><span class="op" id="3191514">:</span>&nbsp;<span class="ident" id="3191516">err</span><span class="op" id="3191519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3191522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3191525">dialer</span>&nbsp;<span class="op" id="3191532">:=</span>&nbsp;<span class="keyword" id="3191535">func</span><span class="op" id="3191539">(</span><span class="ident" id="3191540">deadline</span>&nbsp;<span class="ident" id="3191549">time</span><span class="op" id="3191553">.</span><span class="ident" id="3191554">Time</span><span class="op" id="3191558">)</span>&nbsp;<span class="op" id="3191560">(</span><span class="ident" id="3191561">Conn</span><span class="op" id="3191565">,</span>&nbsp;<span class="builtintype" id="3191567">error</span><span class="op" id="3191572">)</span>&nbsp;<span class="op" id="3191574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3191578">return</span>&nbsp;<span class="ident" id="3191585">dialSingle</span><span class="op" id="3191595">(</span><span class="ident" id="3191596">network</span><span class="op" id="3191603">,</span>&nbsp;<span class="ident" id="3191605">address</span><span class="op" id="3191612">,</span>&nbsp;<span class="ident" id="3191614">d</span><span class="op" id="3191615">.</span><span class="ident" id="3191616">LocalAddr</span><span class="op" id="3191625">,</span>&nbsp;<span class="ident" id="3191627">ra</span><span class="op" id="3191629">.</span><span class="ident" id="3191630">toAddr</span><span class="op" id="3191636">(</span><span class="op" id="3191637">)</span><span class="op" id="3191638">,</span>&nbsp;<span class="ident" id="3191640">deadline</span><span class="op" id="3191648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3191651">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3191654">if</span>&nbsp;<span class="ident" id="3191657">ras</span><span class="op" id="3191660">,</span>&nbsp;<span class="ident" id="3191662">ok</span>&nbsp;<span class="op" id="3191665">:=</span>&nbsp;<span class="ident" id="3191668">ra</span><span class="op" id="3191670">.</span><span class="op" id="3191671">(</span><span class="ident" id="3191672">addrList</span><span class="op" id="3191680">)</span><span class="op" id="3191681">;</span>&nbsp;<span class="ident" id="3191683">ok</span>&nbsp;<span class="op" id="3191686">&amp;&amp;</span>&nbsp;<span class="ident" id="3191689">d</span><span class="op" id="3191690">.</span><span class="ident" id="3191691">DualStack</span>&nbsp;<span class="op" id="3191701">&amp;&amp;</span>&nbsp;<span class="ident" id="3191704">network</span>&nbsp;<span class="op" id="3191712">==</span>&nbsp;<span class="string" id="3191715">&#34;tcp&#34;</span>&nbsp;<span class="op" id="3191721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3191725">dialer</span>&nbsp;<span class="op" id="3191732">=</span>&nbsp;<span class="keyword" id="3191734">func</span><span class="op" id="3191738">(</span><span class="ident" id="3191739">deadline</span>&nbsp;<span class="ident" id="3191748">time</span><span class="op" id="3191752">.</span><span class="ident" id="3191753">Time</span><span class="op" id="3191757">)</span>&nbsp;<span class="op" id="3191759">(</span><span class="ident" id="3191760">Conn</span><span class="op" id="3191764">,</span>&nbsp;<span class="builtintype" id="3191766">error</span><span class="op" id="3191771">)</span>&nbsp;<span class="op" id="3191773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3191778">return</span>&nbsp;<span class="ident" id="3191785">dialMulti</span><span class="op" id="3191794">(</span><span class="ident" id="3191795">network</span><span class="op" id="3191802">,</span>&nbsp;<span class="ident" id="3191804">address</span><span class="op" id="3191811">,</span>&nbsp;<span class="ident" id="3191813">d</span><span class="op" id="3191814">.</span><span class="ident" id="3191815">LocalAddr</span><span class="op" id="3191824">,</span>&nbsp;<span class="ident" id="3191826">ras</span><span class="op" id="3191829">,</span>&nbsp;<span class="ident" id="3191831">deadline</span><span class="op" id="3191839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3191843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3191846">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3191849">c</span><span class="op" id="3191850">,</span>&nbsp;<span class="ident" id="3191852">err</span>&nbsp;<span class="op" id="3191856">:=</span>&nbsp;<span class="ident" id="3191859">dial</span><span class="op" id="3191863">(</span><span class="ident" id="3191864">network</span><span class="op" id="3191871">,</span>&nbsp;<span class="ident" id="3191873">ra</span><span class="op" id="3191875">.</span><span class="ident" id="3191876">toAddr</span><span class="op" id="3191882">(</span><span class="op" id="3191883">)</span><span class="op" id="3191884">,</span>&nbsp;<span class="ident" id="3191886">dialer</span><span class="op" id="3191892">,</span>&nbsp;<span class="ident" id="3191894">d</span><span class="op" id="3191895">.</span><span class="ident" id="3191896">deadline</span><span class="op" id="3191904">(</span><span class="op" id="3191905">)</span><span class="op" id="3191906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3191909">if</span>&nbsp;<span class="ident" id="3191912">d</span><span class="op" id="3191913">.</span><span class="ident" id="3191914">KeepAlive</span>&nbsp;<span class="op" id="3191924">&gt;</span>&nbsp;<span class="num" id="3191926">0</span>&nbsp;<span class="op" id="3191928">&amp;&amp;</span>&nbsp;<span class="ident" id="3191931">err</span>&nbsp;<span class="op" id="3191935">==</span>&nbsp;<span class="builtintype" id="3191938">nil</span>&nbsp;<span class="op" id="3191942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3191946">if</span>&nbsp;<span class="ident" id="3191949">tc</span><span class="op" id="3191951">,</span>&nbsp;<span class="ident" id="3191953">ok</span>&nbsp;<span class="op" id="3191956">:=</span>&nbsp;<span class="ident" id="3191959">c</span><span class="op" id="3191960">.</span><span class="op" id="3191961">(</span><span class="op" id="3191962">*</span><span class="ident" id="3191963">TCPConn</span><span class="op" id="3191970">)</span><span class="op" id="3191971">;</span>&nbsp;<span class="ident" id="3191973">ok</span>&nbsp;<span class="op" id="3191976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3191981">tc</span><span class="op" id="3191983">.</span><span class="ident" id="3191984">SetKeepAlive</span><span class="op" id="3191996">(</span><span class="builtintype" id="3191997">true</span><span class="op" id="3192001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3192006">tc</span><span class="op" id="3192008">.</span><span class="ident" id="3192009">SetKeepAlivePeriod</span><span class="op" id="3192027">(</span><span class="ident" id="3192028">d</span><span class="op" id="3192029">.</span><span class="ident" id="3192030">KeepAlive</span><span class="op" id="3192039">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3192044">testHookSetKeepAlive</span><span class="op" id="3192064">(</span><span class="op" id="3192065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3192069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3192072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3192075">return</span>&nbsp;<span class="ident" id="3192082">c</span><span class="op" id="3192083">,</span>&nbsp;<span class="ident" id="3192085">err</span><br>
<span class="lineno"></span><span class="op" id="3192089">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="3192092">var</span>&nbsp;<span class="ident" id="3192096">testHookSetKeepAlive</span>&nbsp;<span class="op" id="3192117">=</span>&nbsp;<span class="keyword" id="3192119">func</span><span class="op" id="3192123">(</span><span class="op" id="3192124">)</span>&nbsp;<span class="op" id="3192126">{</span><span class="op" id="3192127">}</span>&nbsp;<span class="comment" id="3192129">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3192157">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3192227">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="3192290">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3192358">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="3192388">func</span>&nbsp;<span class="ident" id="3192393">dialMulti</span><span class="op" id="3192402">(</span><span class="ident" id="3192403">net</span><span class="op" id="3192406">,</span>&nbsp;<span class="ident" id="3192408">addr</span>&nbsp;<span class="builtintype" id="3192413">string</span><span class="op" id="3192419">,</span>&nbsp;<span class="ident" id="3192421">la</span>&nbsp;<span class="ident" id="3192424">Addr</span><span class="op" id="3192428">,</span>&nbsp;<span class="ident" id="3192430">ras</span>&nbsp;<span class="ident" id="3192434">addrList</span><span class="op" id="3192442">,</span>&nbsp;<span class="ident" id="3192444">deadline</span>&nbsp;<span class="ident" id="3192453">time</span><span class="op" id="3192457">.</span><span class="ident" id="3192458">Time</span><span class="op" id="3192462">)</span>&nbsp;<span class="op" id="3192464">(</span><span class="ident" id="3192465">Conn</span><span class="op" id="3192469">,</span>&nbsp;<span class="builtintype" id="3192471">error</span><span class="op" id="3192476">)</span>&nbsp;<span class="op" id="3192478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3192481">type</span>&nbsp;<span class="ident" id="3192486">racer</span>&nbsp;<span class="keyword" id="3192492">struct</span>&nbsp;<span class="op" id="3192499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3192503">Conn</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3192510">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3192517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3192520">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3192583">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3192646">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3192675">sig</span>&nbsp;<span class="op" id="3192679">:=</span>&nbsp;<span class="builtinfunc" id="3192682">make</span><span class="op" id="3192686">(</span><span class="keyword" id="3192687">chan</span>&nbsp;<span class="builtintype" id="3192692">bool</span><span class="op" id="3192696">,</span>&nbsp;<span class="num" id="3192698">1</span><span class="op" id="3192699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3192702">lane</span>&nbsp;<span class="op" id="3192707">:=</span>&nbsp;<span class="builtinfunc" id="3192710">make</span><span class="op" id="3192714">(</span><span class="keyword" id="3192715">chan</span>&nbsp;<span class="ident" id="3192720">racer</span><span class="op" id="3192725">,</span>&nbsp;<span class="num" id="3192727">1</span><span class="op" id="3192728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3192731">for</span>&nbsp;<span class="ident" id="3192735">_</span><span class="op" id="3192736">,</span>&nbsp;<span class="ident" id="3192738">ra</span>&nbsp;<span class="op" id="3192741">:=</span>&nbsp;<span class="keyword" id="3192744">range</span>&nbsp;<span class="ident" id="3192750">ras</span>&nbsp;<span class="op" id="3192754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3192758">go</span>&nbsp;<span class="keyword" id="3192761">func</span><span class="op" id="3192765">(</span><span class="ident" id="3192766">ra</span>&nbsp;<span class="ident" id="3192769">Addr</span><span class="op" id="3192773">)</span>&nbsp;<span class="op" id="3192775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3192780">c</span><span class="op" id="3192781">,</span>&nbsp;<span class="ident" id="3192783">err</span>&nbsp;<span class="op" id="3192787">:=</span>&nbsp;<span class="ident" id="3192790">dialSingle</span><span class="op" id="3192800">(</span><span class="ident" id="3192801">net</span><span class="op" id="3192804">,</span>&nbsp;<span class="ident" id="3192806">addr</span><span class="op" id="3192810">,</span>&nbsp;<span class="ident" id="3192812">la</span><span class="op" id="3192814">,</span>&nbsp;<span class="ident" id="3192816">ra</span><span class="op" id="3192818">,</span>&nbsp;<span class="ident" id="3192820">deadline</span><span class="op" id="3192828">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3192833">if</span>&nbsp;<span class="ident" id="3192836">_</span><span class="op" id="3192837">,</span>&nbsp;<span class="ident" id="3192839">ok</span>&nbsp;<span class="op" id="3192842">:=</span>&nbsp;<span class="op" id="3192845">&lt;-</span><span class="ident" id="3192847">sig</span><span class="op" id="3192850">;</span>&nbsp;<span class="ident" id="3192852">ok</span>&nbsp;<span class="op" id="3192855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3192861">lane</span>&nbsp;<span class="op" id="3192866">&lt;-</span>&nbsp;<span class="ident" id="3192869">racer</span><span class="op" id="3192874">{</span><span class="ident" id="3192875">c</span><span class="op" id="3192876">,</span>&nbsp;<span class="ident" id="3192878">err</span><span class="op" id="3192881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3192886">}</span>&nbsp;<span class="keyword" id="3192888">else</span>&nbsp;<span class="keyword" id="3192893">if</span>&nbsp;<span class="ident" id="3192896">err</span>&nbsp;<span class="op" id="3192900">==</span>&nbsp;<span class="builtintype" id="3192903">nil</span>&nbsp;<span class="op" id="3192907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3192913">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3192952">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3192984">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3193021">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193061">c</span><span class="op" id="3193062">.</span><span class="ident" id="3193063">Close</span><span class="op" id="3193068">(</span><span class="op" id="3193069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3193074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3193078">}</span><span class="op" id="3193079">(</span><span class="ident" id="3193080">ra</span><span class="op" id="3193082">.</span><span class="ident" id="3193083">toAddr</span><span class="op" id="3193089">(</span><span class="op" id="3193090">)</span><span class="op" id="3193091">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3193094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193097">defer</span>&nbsp;<span class="builtinfunc" id="3193103">close</span><span class="op" id="3193108">(</span><span class="ident" id="3193109">sig</span><span class="op" id="3193112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193115">lastErr</span>&nbsp;<span class="op" id="3193123">:=</span>&nbsp;<span class="ident" id="3193126">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193138">nracers</span>&nbsp;<span class="op" id="3193146">:=</span>&nbsp;<span class="builtinfunc" id="3193149">len</span><span class="op" id="3193152">(</span><span class="ident" id="3193153">ras</span><span class="op" id="3193156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193159">for</span>&nbsp;<span class="ident" id="3193163">nracers</span>&nbsp;<span class="op" id="3193171">&gt;</span>&nbsp;<span class="num" id="3193173">0</span>&nbsp;<span class="op" id="3193175">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193179">sig</span>&nbsp;<span class="op" id="3193183">&lt;-</span>&nbsp;<span class="builtintype" id="3193186">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193193">racer</span>&nbsp;<span class="op" id="3193199">:=</span>&nbsp;<span class="op" id="3193202">&lt;-</span><span class="ident" id="3193204">lane</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193211">if</span>&nbsp;<span class="ident" id="3193214">racer</span><span class="op" id="3193219">.</span><span class="builtintype" id="3193220">error</span>&nbsp;<span class="op" id="3193226">==</span>&nbsp;<span class="builtintype" id="3193229">nil</span>&nbsp;<span class="op" id="3193233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193238">return</span>&nbsp;<span class="ident" id="3193245">racer</span><span class="op" id="3193250">.</span><span class="ident" id="3193251">Conn</span><span class="op" id="3193255">,</span>&nbsp;<span class="builtintype" id="3193257">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3193263">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193267">lastErr</span>&nbsp;<span class="op" id="3193275">=</span>&nbsp;<span class="ident" id="3193277">racer</span><span class="op" id="3193282">.</span><span class="builtintype" id="3193283">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193291">nracers</span><span class="op" id="3193298">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3193302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193305">return</span>&nbsp;<span class="builtintype" id="3193312">nil</span><span class="op" id="3193315">,</span>&nbsp;<span class="ident" id="3193317">lastErr</span><br>
<span class="lineno"></span><span class="op" id="3193325">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3193328">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3193399">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3193427">func</span>&nbsp;<span class="ident" id="3193432">dialSingle</span><span class="op" id="3193442">(</span><span class="ident" id="3193443">net</span><span class="op" id="3193446">,</span>&nbsp;<span class="ident" id="3193448">addr</span>&nbsp;<span class="builtintype" id="3193453">string</span><span class="op" id="3193459">,</span>&nbsp;<span class="ident" id="3193461">la</span><span class="op" id="3193463">,</span>&nbsp;<span class="ident" id="3193465">ra</span>&nbsp;<span class="ident" id="3193468">Addr</span><span class="op" id="3193472">,</span>&nbsp;<span class="ident" id="3193474">deadline</span>&nbsp;<span class="ident" id="3193483">time</span><span class="op" id="3193487">.</span><span class="ident" id="3193488">Time</span><span class="op" id="3193492">)</span>&nbsp;<span class="op" id="3193494">(</span><span class="ident" id="3193495">c</span>&nbsp;<span class="ident" id="3193497">Conn</span><span class="op" id="3193501">,</span>&nbsp;<span class="ident" id="3193503">err</span>&nbsp;<span class="builtintype" id="3193507">error</span><span class="op" id="3193512">)</span>&nbsp;<span class="op" id="3193514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193517">if</span>&nbsp;<span class="ident" id="3193520">la</span>&nbsp;<span class="op" id="3193523">!=</span>&nbsp;<span class="builtintype" id="3193526">nil</span>&nbsp;<span class="op" id="3193530">&amp;&amp;</span>&nbsp;<span class="ident" id="3193533">la</span><span class="op" id="3193535">.</span><span class="ident" id="3193536">Network</span><span class="op" id="3193543">(</span><span class="op" id="3193544">)</span>&nbsp;<span class="op" id="3193546">!=</span>&nbsp;<span class="ident" id="3193549">ra</span><span class="op" id="3193551">.</span><span class="ident" id="3193552">Network</span><span class="op" id="3193559">(</span><span class="op" id="3193560">)</span>&nbsp;<span class="op" id="3193562">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193566">return</span>&nbsp;<span class="builtintype" id="3193573">nil</span><span class="op" id="3193576">,</span>&nbsp;<span class="op" id="3193578">&amp;</span><span class="ident" id="3193579">OpError</span><span class="op" id="3193586">{</span><span class="ident" id="3193587">Op</span><span class="op" id="3193589">:</span>&nbsp;<span class="string" id="3193591">&#34;dial&#34;</span><span class="op" id="3193597">,</span>&nbsp;<span class="ident" id="3193599">Net</span><span class="op" id="3193602">:</span>&nbsp;<span class="ident" id="3193604">net</span><span class="op" id="3193607">,</span>&nbsp;<span class="ident" id="3193609">Addr</span><span class="op" id="3193613">:</span>&nbsp;<span class="ident" id="3193615">ra</span><span class="op" id="3193617">,</span>&nbsp;<span class="ident" id="3193619">Err</span><span class="op" id="3193622">:</span>&nbsp;<span class="ident" id="3193624">errors</span><span class="op" id="3193630">.</span><span class="ident" id="3193631">New</span><span class="op" id="3193634">(</span><span class="string" id="3193635">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3193668">+</span>&nbsp;<span class="ident" id="3193670">la</span><span class="op" id="3193672">.</span><span class="ident" id="3193673">Network</span><span class="op" id="3193680">(</span><span class="op" id="3193681">)</span><span class="op" id="3193682">)</span><span class="op" id="3193683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3193686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193689">switch</span>&nbsp;<span class="ident" id="3193696">ra</span>&nbsp;<span class="op" id="3193699">:=</span>&nbsp;<span class="ident" id="3193702">ra</span><span class="op" id="3193704">.</span><span class="op" id="3193705">(</span><span class="keyword" id="3193706">type</span><span class="op" id="3193710">)</span>&nbsp;<span class="op" id="3193712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193715">case</span>&nbsp;<span class="op" id="3193720">*</span><span class="ident" id="3193721">TCPAddr</span><span class="op" id="3193728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193732">la</span><span class="op" id="3193734">,</span>&nbsp;<span class="ident" id="3193736">_</span>&nbsp;<span class="op" id="3193738">:=</span>&nbsp;<span class="ident" id="3193741">la</span><span class="op" id="3193743">.</span><span class="op" id="3193744">(</span><span class="op" id="3193745">*</span><span class="ident" id="3193746">TCPAddr</span><span class="op" id="3193753">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193757">c</span><span class="op" id="3193758">,</span>&nbsp;<span class="ident" id="3193760">err</span>&nbsp;<span class="op" id="3193764">=</span>&nbsp;<span class="ident" id="3193766">dialTCP</span><span class="op" id="3193773">(</span><span class="ident" id="3193774">net</span><span class="op" id="3193777">,</span>&nbsp;<span class="ident" id="3193779">la</span><span class="op" id="3193781">,</span>&nbsp;<span class="ident" id="3193783">ra</span><span class="op" id="3193785">,</span>&nbsp;<span class="ident" id="3193787">deadline</span><span class="op" id="3193795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193798">case</span>&nbsp;<span class="op" id="3193803">*</span><span class="ident" id="3193804">UDPAddr</span><span class="op" id="3193811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193815">la</span><span class="op" id="3193817">,</span>&nbsp;<span class="ident" id="3193819">_</span>&nbsp;<span class="op" id="3193821">:=</span>&nbsp;<span class="ident" id="3193824">la</span><span class="op" id="3193826">.</span><span class="op" id="3193827">(</span><span class="op" id="3193828">*</span><span class="ident" id="3193829">UDPAddr</span><span class="op" id="3193836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193840">c</span><span class="op" id="3193841">,</span>&nbsp;<span class="ident" id="3193843">err</span>&nbsp;<span class="op" id="3193847">=</span>&nbsp;<span class="ident" id="3193849">dialUDP</span><span class="op" id="3193856">(</span><span class="ident" id="3193857">net</span><span class="op" id="3193860">,</span>&nbsp;<span class="ident" id="3193862">la</span><span class="op" id="3193864">,</span>&nbsp;<span class="ident" id="3193866">ra</span><span class="op" id="3193868">,</span>&nbsp;<span class="ident" id="3193870">deadline</span><span class="op" id="3193878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193881">case</span>&nbsp;<span class="op" id="3193886">*</span><span class="ident" id="3193887">IPAddr</span><span class="op" id="3193893">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193897">la</span><span class="op" id="3193899">,</span>&nbsp;<span class="ident" id="3193901">_</span>&nbsp;<span class="op" id="3193903">:=</span>&nbsp;<span class="ident" id="3193906">la</span><span class="op" id="3193908">.</span><span class="op" id="3193909">(</span><span class="op" id="3193910">*</span><span class="ident" id="3193911">IPAddr</span><span class="op" id="3193917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193921">c</span><span class="op" id="3193922">,</span>&nbsp;<span class="ident" id="3193924">err</span>&nbsp;<span class="op" id="3193928">=</span>&nbsp;<span class="ident" id="3193930">dialIP</span><span class="op" id="3193936">(</span><span class="ident" id="3193937">net</span><span class="op" id="3193940">,</span>&nbsp;<span class="ident" id="3193942">la</span><span class="op" id="3193944">,</span>&nbsp;<span class="ident" id="3193946">ra</span><span class="op" id="3193948">,</span>&nbsp;<span class="ident" id="3193950">deadline</span><span class="op" id="3193958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193961">case</span>&nbsp;<span class="op" id="3193966">*</span><span class="ident" id="3193967">UnixAddr</span><span class="op" id="3193975">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3193979">la</span><span class="op" id="3193981">,</span>&nbsp;<span class="ident" id="3193983">_</span>&nbsp;<span class="op" id="3193985">:=</span>&nbsp;<span class="ident" id="3193988">la</span><span class="op" id="3193990">.</span><span class="op" id="3193991">(</span><span class="op" id="3193992">*</span><span class="ident" id="3193993">UnixAddr</span><span class="op" id="3194001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3194005">c</span><span class="op" id="3194006">,</span>&nbsp;<span class="ident" id="3194008">err</span>&nbsp;<span class="op" id="3194012">=</span>&nbsp;<span class="ident" id="3194014">dialUnix</span><span class="op" id="3194022">(</span><span class="ident" id="3194023">net</span><span class="op" id="3194026">,</span>&nbsp;<span class="ident" id="3194028">la</span><span class="op" id="3194030">,</span>&nbsp;<span class="ident" id="3194032">ra</span><span class="op" id="3194034">,</span>&nbsp;<span class="ident" id="3194036">deadline</span><span class="op" id="3194044">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194047">default</span><span class="op" id="3194054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194058">return</span>&nbsp;<span class="builtintype" id="3194065">nil</span><span class="op" id="3194068">,</span>&nbsp;<span class="op" id="3194070">&amp;</span><span class="ident" id="3194071">OpError</span><span class="op" id="3194078">{</span><span class="ident" id="3194079">Op</span><span class="op" id="3194081">:</span>&nbsp;<span class="string" id="3194083">&#34;dial&#34;</span><span class="op" id="3194089">,</span>&nbsp;<span class="ident" id="3194091">Net</span><span class="op" id="3194094">:</span>&nbsp;<span class="ident" id="3194096">net</span><span class="op" id="3194099">,</span>&nbsp;<span class="ident" id="3194101">Addr</span><span class="op" id="3194105">:</span>&nbsp;<span class="ident" id="3194107">ra</span><span class="op" id="3194109">,</span>&nbsp;<span class="ident" id="3194111">Err</span><span class="op" id="3194114">:</span>&nbsp;<span class="op" id="3194116">&amp;</span><span class="ident" id="3194117">AddrError</span><span class="op" id="3194126">{</span><span class="ident" id="3194127">Err</span><span class="op" id="3194130">:</span>&nbsp;<span class="string" id="3194132">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3194157">,</span>&nbsp;<span class="ident" id="3194159">Addr</span><span class="op" id="3194163">:</span>&nbsp;<span class="ident" id="3194165">addr</span><span class="op" id="3194169">}</span><span class="op" id="3194170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3194173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194176">if</span>&nbsp;<span class="ident" id="3194179">err</span>&nbsp;<span class="op" id="3194183">!=</span>&nbsp;<span class="builtintype" id="3194186">nil</span>&nbsp;<span class="op" id="3194190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194194">return</span>&nbsp;<span class="builtintype" id="3194201">nil</span><span class="op" id="3194204">,</span>&nbsp;<span class="ident" id="3194206">err</span>&nbsp;<span class="comment" id="3194210">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3194260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194263">return</span>&nbsp;<span class="ident" id="3194270">c</span><span class="op" id="3194271">,</span>&nbsp;<span class="builtintype" id="3194273">nil</span><br>
<span class="lineno"></span><span class="op" id="3194277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3194280">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="3194336">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3194405">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3194440">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3194477">func</span>&nbsp;<span class="ident" id="3194482">Listen</span><span class="op" id="3194488">(</span><span class="ident" id="3194489">net</span><span class="op" id="3194492">,</span>&nbsp;<span class="ident" id="3194494">laddr</span>&nbsp;<span class="builtintype" id="3194500">string</span><span class="op" id="3194506">)</span>&nbsp;<span class="op" id="3194508">(</span><span class="ident" id="3194509">Listener</span><span class="op" id="3194517">,</span>&nbsp;<span class="builtintype" id="3194519">error</span><span class="op" id="3194524">)</span>&nbsp;<span class="op" id="3194526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3194529">la</span><span class="op" id="3194531">,</span>&nbsp;<span class="ident" id="3194533">err</span>&nbsp;<span class="op" id="3194537">:=</span>&nbsp;<span class="ident" id="3194540">resolveAddr</span><span class="op" id="3194551">(</span><span class="string" id="3194552">&#34;listen&#34;</span><span class="op" id="3194560">,</span>&nbsp;<span class="ident" id="3194562">net</span><span class="op" id="3194565">,</span>&nbsp;<span class="ident" id="3194567">laddr</span><span class="op" id="3194572">,</span>&nbsp;<span class="ident" id="3194574">noDeadline</span><span class="op" id="3194584">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194587">if</span>&nbsp;<span class="ident" id="3194590">err</span>&nbsp;<span class="op" id="3194594">!=</span>&nbsp;<span class="builtintype" id="3194597">nil</span>&nbsp;<span class="op" id="3194601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194605">return</span>&nbsp;<span class="builtintype" id="3194612">nil</span><span class="op" id="3194615">,</span>&nbsp;<span class="op" id="3194617">&amp;</span><span class="ident" id="3194618">OpError</span><span class="op" id="3194625">{</span><span class="ident" id="3194626">Op</span><span class="op" id="3194628">:</span>&nbsp;<span class="string" id="3194630">&#34;listen&#34;</span><span class="op" id="3194638">,</span>&nbsp;<span class="ident" id="3194640">Net</span><span class="op" id="3194643">:</span>&nbsp;<span class="ident" id="3194645">net</span><span class="op" id="3194648">,</span>&nbsp;<span class="ident" id="3194650">Addr</span><span class="op" id="3194654">:</span>&nbsp;<span class="builtintype" id="3194656">nil</span><span class="op" id="3194659">,</span>&nbsp;<span class="ident" id="3194661">Err</span><span class="op" id="3194664">:</span>&nbsp;<span class="ident" id="3194666">err</span><span class="op" id="3194669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3194672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194675">var</span>&nbsp;<span class="ident" id="3194679">l</span>&nbsp;<span class="ident" id="3194681">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194691">switch</span>&nbsp;<span class="ident" id="3194698">la</span>&nbsp;<span class="op" id="3194701">:=</span>&nbsp;<span class="ident" id="3194704">la</span><span class="op" id="3194706">.</span><span class="ident" id="3194707">toAddr</span><span class="op" id="3194713">(</span><span class="op" id="3194714">)</span><span class="op" id="3194715">.</span><span class="op" id="3194716">(</span><span class="keyword" id="3194717">type</span><span class="op" id="3194721">)</span>&nbsp;<span class="op" id="3194723">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194726">case</span>&nbsp;<span class="op" id="3194731">*</span><span class="ident" id="3194732">TCPAddr</span><span class="op" id="3194739">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3194743">l</span><span class="op" id="3194744">,</span>&nbsp;<span class="ident" id="3194746">err</span>&nbsp;<span class="op" id="3194750">=</span>&nbsp;<span class="ident" id="3194752">ListenTCP</span><span class="op" id="3194761">(</span><span class="ident" id="3194762">net</span><span class="op" id="3194765">,</span>&nbsp;<span class="ident" id="3194767">la</span><span class="op" id="3194769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194772">case</span>&nbsp;<span class="op" id="3194777">*</span><span class="ident" id="3194778">UnixAddr</span><span class="op" id="3194786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3194790">l</span><span class="op" id="3194791">,</span>&nbsp;<span class="ident" id="3194793">err</span>&nbsp;<span class="op" id="3194797">=</span>&nbsp;<span class="ident" id="3194799">ListenUnix</span><span class="op" id="3194809">(</span><span class="ident" id="3194810">net</span><span class="op" id="3194813">,</span>&nbsp;<span class="ident" id="3194815">la</span><span class="op" id="3194817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194820">default</span><span class="op" id="3194827">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194831">return</span>&nbsp;<span class="builtintype" id="3194838">nil</span><span class="op" id="3194841">,</span>&nbsp;<span class="op" id="3194843">&amp;</span><span class="ident" id="3194844">OpError</span><span class="op" id="3194851">{</span><span class="ident" id="3194852">Op</span><span class="op" id="3194854">:</span>&nbsp;<span class="string" id="3194856">&#34;listen&#34;</span><span class="op" id="3194864">,</span>&nbsp;<span class="ident" id="3194866">Net</span><span class="op" id="3194869">:</span>&nbsp;<span class="ident" id="3194871">net</span><span class="op" id="3194874">,</span>&nbsp;<span class="ident" id="3194876">Addr</span><span class="op" id="3194880">:</span>&nbsp;<span class="ident" id="3194882">la</span><span class="op" id="3194884">,</span>&nbsp;<span class="ident" id="3194886">Err</span><span class="op" id="3194889">:</span>&nbsp;<span class="op" id="3194891">&amp;</span><span class="ident" id="3194892">AddrError</span><span class="op" id="3194901">{</span><span class="ident" id="3194902">Err</span><span class="op" id="3194905">:</span>&nbsp;<span class="string" id="3194907">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3194932">,</span>&nbsp;<span class="ident" id="3194934">Addr</span><span class="op" id="3194938">:</span>&nbsp;<span class="ident" id="3194940">laddr</span><span class="op" id="3194945">}</span><span class="op" id="3194946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3194949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194952">if</span>&nbsp;<span class="ident" id="3194955">err</span>&nbsp;<span class="op" id="3194959">!=</span>&nbsp;<span class="builtintype" id="3194962">nil</span>&nbsp;<span class="op" id="3194966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194970">return</span>&nbsp;<span class="builtintype" id="3194977">nil</span><span class="op" id="3194980">,</span>&nbsp;<span class="ident" id="3194982">err</span>&nbsp;<span class="comment" id="3194986">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3195036">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195039">return</span>&nbsp;<span class="ident" id="3195046">l</span><span class="op" id="3195047">,</span>&nbsp;<span class="builtintype" id="3195049">nil</span><br>
<span class="lineno"></span><span class="op" id="3195053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3195056">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="3195118">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="3195187">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3195232">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3195269">func</span>&nbsp;<span class="ident" id="3195274">ListenPacket</span><span class="op" id="3195286">(</span><span class="ident" id="3195287">net</span><span class="op" id="3195290">,</span>&nbsp;<span class="ident" id="3195292">laddr</span>&nbsp;<span class="builtintype" id="3195298">string</span><span class="op" id="3195304">)</span>&nbsp;<span class="op" id="3195306">(</span><span class="ident" id="3195307">PacketConn</span><span class="op" id="3195317">,</span>&nbsp;<span class="builtintype" id="3195319">error</span><span class="op" id="3195324">)</span>&nbsp;<span class="op" id="3195326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3195329">la</span><span class="op" id="3195331">,</span>&nbsp;<span class="ident" id="3195333">err</span>&nbsp;<span class="op" id="3195337">:=</span>&nbsp;<span class="ident" id="3195340">resolveAddr</span><span class="op" id="3195351">(</span><span class="string" id="3195352">&#34;listen&#34;</span><span class="op" id="3195360">,</span>&nbsp;<span class="ident" id="3195362">net</span><span class="op" id="3195365">,</span>&nbsp;<span class="ident" id="3195367">laddr</span><span class="op" id="3195372">,</span>&nbsp;<span class="ident" id="3195374">noDeadline</span><span class="op" id="3195384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195387">if</span>&nbsp;<span class="ident" id="3195390">err</span>&nbsp;<span class="op" id="3195394">!=</span>&nbsp;<span class="builtintype" id="3195397">nil</span>&nbsp;<span class="op" id="3195401">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195405">return</span>&nbsp;<span class="builtintype" id="3195412">nil</span><span class="op" id="3195415">,</span>&nbsp;<span class="op" id="3195417">&amp;</span><span class="ident" id="3195418">OpError</span><span class="op" id="3195425">{</span><span class="ident" id="3195426">Op</span><span class="op" id="3195428">:</span>&nbsp;<span class="string" id="3195430">&#34;listen&#34;</span><span class="op" id="3195438">,</span>&nbsp;<span class="ident" id="3195440">Net</span><span class="op" id="3195443">:</span>&nbsp;<span class="ident" id="3195445">net</span><span class="op" id="3195448">,</span>&nbsp;<span class="ident" id="3195450">Addr</span><span class="op" id="3195454">:</span>&nbsp;<span class="builtintype" id="3195456">nil</span><span class="op" id="3195459">,</span>&nbsp;<span class="ident" id="3195461">Err</span><span class="op" id="3195464">:</span>&nbsp;<span class="ident" id="3195466">err</span><span class="op" id="3195469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3195472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195475">var</span>&nbsp;<span class="ident" id="3195479">l</span>&nbsp;<span class="ident" id="3195481">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195493">switch</span>&nbsp;<span class="ident" id="3195500">la</span>&nbsp;<span class="op" id="3195503">:=</span>&nbsp;<span class="ident" id="3195506">la</span><span class="op" id="3195508">.</span><span class="ident" id="3195509">toAddr</span><span class="op" id="3195515">(</span><span class="op" id="3195516">)</span><span class="op" id="3195517">.</span><span class="op" id="3195518">(</span><span class="keyword" id="3195519">type</span><span class="op" id="3195523">)</span>&nbsp;<span class="op" id="3195525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195528">case</span>&nbsp;<span class="op" id="3195533">*</span><span class="ident" id="3195534">UDPAddr</span><span class="op" id="3195541">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3195545">l</span><span class="op" id="3195546">,</span>&nbsp;<span class="ident" id="3195548">err</span>&nbsp;<span class="op" id="3195552">=</span>&nbsp;<span class="ident" id="3195554">ListenUDP</span><span class="op" id="3195563">(</span><span class="ident" id="3195564">net</span><span class="op" id="3195567">,</span>&nbsp;<span class="ident" id="3195569">la</span><span class="op" id="3195571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195574">case</span>&nbsp;<span class="op" id="3195579">*</span><span class="ident" id="3195580">IPAddr</span><span class="op" id="3195586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3195590">l</span><span class="op" id="3195591">,</span>&nbsp;<span class="ident" id="3195593">err</span>&nbsp;<span class="op" id="3195597">=</span>&nbsp;<span class="ident" id="3195599">ListenIP</span><span class="op" id="3195607">(</span><span class="ident" id="3195608">net</span><span class="op" id="3195611">,</span>&nbsp;<span class="ident" id="3195613">la</span><span class="op" id="3195615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195618">case</span>&nbsp;<span class="op" id="3195623">*</span><span class="ident" id="3195624">UnixAddr</span><span class="op" id="3195632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3195636">l</span><span class="op" id="3195637">,</span>&nbsp;<span class="ident" id="3195639">err</span>&nbsp;<span class="op" id="3195643">=</span>&nbsp;<span class="ident" id="3195645">ListenUnixgram</span><span class="op" id="3195659">(</span><span class="ident" id="3195660">net</span><span class="op" id="3195663">,</span>&nbsp;<span class="ident" id="3195665">la</span><span class="op" id="3195667">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195670">default</span><span class="op" id="3195677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195681">return</span>&nbsp;<span class="builtintype" id="3195688">nil</span><span class="op" id="3195691">,</span>&nbsp;<span class="op" id="3195693">&amp;</span><span class="ident" id="3195694">OpError</span><span class="op" id="3195701">{</span><span class="ident" id="3195702">Op</span><span class="op" id="3195704">:</span>&nbsp;<span class="string" id="3195706">&#34;listen&#34;</span><span class="op" id="3195714">,</span>&nbsp;<span class="ident" id="3195716">Net</span><span class="op" id="3195719">:</span>&nbsp;<span class="ident" id="3195721">net</span><span class="op" id="3195724">,</span>&nbsp;<span class="ident" id="3195726">Addr</span><span class="op" id="3195730">:</span>&nbsp;<span class="ident" id="3195732">la</span><span class="op" id="3195734">,</span>&nbsp;<span class="ident" id="3195736">Err</span><span class="op" id="3195739">:</span>&nbsp;<span class="op" id="3195741">&amp;</span><span class="ident" id="3195742">AddrError</span><span class="op" id="3195751">{</span><span class="ident" id="3195752">Err</span><span class="op" id="3195755">:</span>&nbsp;<span class="string" id="3195757">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3195782">,</span>&nbsp;<span class="ident" id="3195784">Addr</span><span class="op" id="3195788">:</span>&nbsp;<span class="ident" id="3195790">laddr</span><span class="op" id="3195795">}</span><span class="op" id="3195796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3195799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195802">if</span>&nbsp;<span class="ident" id="3195805">err</span>&nbsp;<span class="op" id="3195809">!=</span>&nbsp;<span class="builtintype" id="3195812">nil</span>&nbsp;<span class="op" id="3195816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195820">return</span>&nbsp;<span class="builtintype" id="3195827">nil</span><span class="op" id="3195830">,</span>&nbsp;<span class="ident" id="3195832">err</span>&nbsp;<span class="comment" id="3195836">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3195886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195889">return</span>&nbsp;<span class="ident" id="3195896">l</span><span class="op" id="3195897">,</span>&nbsp;<span class="builtintype" id="3195899">nil</span><br>
<span class="lineno"></span><span class="op" id="3195903">}</span>
</div>
</body>
</html>
