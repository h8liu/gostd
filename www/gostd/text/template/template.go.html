<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/template</h2>
<ul>
<li><a href="/gostd/text/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/text/template/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/template/examplefiles_test.go.html">examplefiles_test.go</a></li>
<li><a href="/gostd/text/template/examplefunc_test.go.html">examplefunc_test.go</a></li>
<li><a href="/gostd/text/template/exec.go.html">exec.go</a></li>
<li><a href="/gostd/text/template/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/text/template/funcs.go.html">funcs.go</a></li>
<li><a href="/gostd/text/template/helper.go.html">helper.go</a></li>
<li><a href="/gostd/text/template/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/text/template/template.go.html" class="current">template.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4596003">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4596058">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4596112">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4596163">package</span>&nbsp;<span class="ident" id="4596171">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4596181">import</span>&nbsp;<span class="op" id="4596188">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4596191">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4596198">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4596209">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="4596231">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4596234">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;information&nbsp;shared&nbsp;by&nbsp;related&nbsp;templates.</span><br>
<span class="lineno"></span><span class="keyword" id="4596295">type</span>&nbsp;<span class="ident" id="4596300">common</span>&nbsp;<span class="keyword" id="4596307">struct</span>&nbsp;<span class="op" id="4596314">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596317">tmpl</span>&nbsp;<span class="keyword" id="4596322">map</span><span class="op" id="4596325">[</span><span class="builtintype" id="4596326">string</span><span class="op" id="4596332">]</span><span class="op" id="4596333">*</span><span class="ident" id="4596334">Template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4596344">//&nbsp;We&nbsp;use&nbsp;two&nbsp;maps,&nbsp;one&nbsp;for&nbsp;parsing&nbsp;and&nbsp;one&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4596404">//&nbsp;This&nbsp;separation&nbsp;makes&nbsp;the&nbsp;API&nbsp;cleaner&nbsp;since&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4596463">//&nbsp;expose&nbsp;reflection&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596500">parseFuncs</span>&nbsp;<span class="ident" id="4596511">FuncMap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596520">execFuncs</span>&nbsp;&nbsp;<span class="keyword" id="4596531">map</span><span class="op" id="4596534">[</span><span class="builtintype" id="4596535">string</span><span class="op" id="4596541">]</span><span class="ident" id="4596542">reflect</span><span class="op" id="4596549">.</span><span class="ident" id="4596550">Value</span><br>
<span class="lineno"></span><span class="op" id="4596556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4596559">//&nbsp;Template&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;parsed&nbsp;template.&nbsp;The&nbsp;*parse.Tree</span><br>
<span class="lineno"></span><span class="comment" id="4596631">//&nbsp;field&nbsp;is&nbsp;exported&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;html/template&nbsp;and&nbsp;should&nbsp;be&nbsp;treated</span><br>
<span class="lineno">25</span><span class="comment" id="4596704">//&nbsp;as&nbsp;unexported&nbsp;by&nbsp;all&nbsp;other&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="4596743">type</span>&nbsp;<span class="ident" id="4596748">Template</span>&nbsp;<span class="keyword" id="4596757">struct</span>&nbsp;<span class="op" id="4596764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596767">name</span>&nbsp;<span class="builtintype" id="4596772">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596780">*</span><span class="ident" id="4596781">parse</span><span class="op" id="4596786">.</span><span class="ident" id="4596787">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596793">*</span><span class="ident" id="4596794">common</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596802">leftDelim</span>&nbsp;&nbsp;<span class="builtintype" id="4596813">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596821">rightDelim</span>&nbsp;<span class="builtintype" id="4596832">string</span><br>
<span class="lineno"></span><span class="op" id="4596839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4596842">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno">35</span><span class="keyword" id="4596895">func</span>&nbsp;<span class="ident" id="4596900">New</span><span class="op" id="4596903">(</span><span class="ident" id="4596904">name</span>&nbsp;<span class="builtintype" id="4596909">string</span><span class="op" id="4596915">)</span>&nbsp;<span class="op" id="4596917">*</span><span class="ident" id="4596918">Template</span>&nbsp;<span class="op" id="4596927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596930">return</span>&nbsp;<span class="op" id="4596937">&amp;</span><span class="ident" id="4596938">Template</span><span class="op" id="4596946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596950">name</span><span class="op" id="4596954">:</span>&nbsp;<span class="ident" id="4596956">name</span><span class="op" id="4596960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596963">}</span><br>
<span class="lineno"></span><span class="op" id="4596965">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4596968">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="4597010">func</span>&nbsp;<span class="op" id="4597015">(</span><span class="ident" id="4597016">t</span>&nbsp;<span class="op" id="4597018">*</span><span class="ident" id="4597019">Template</span><span class="op" id="4597027">)</span>&nbsp;<span class="ident" id="4597029">Name</span><span class="op" id="4597033">(</span><span class="op" id="4597034">)</span>&nbsp;<span class="builtintype" id="4597036">string</span>&nbsp;<span class="op" id="4597043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597046">return</span>&nbsp;<span class="ident" id="4597053">t</span><span class="op" id="4597054">.</span><span class="ident" id="4597055">name</span><br>
<span class="lineno"></span><span class="op" id="4597060">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4597063">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;one&nbsp;and&nbsp;with&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="4597143">//&nbsp;delimiters.&nbsp;The&nbsp;association,&nbsp;which&nbsp;is&nbsp;transitive,&nbsp;allows&nbsp;one&nbsp;template&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4597219">//&nbsp;invoke&nbsp;another&nbsp;with&nbsp;a&nbsp;{{template}}&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="4597265">func</span>&nbsp;<span class="op" id="4597270">(</span><span class="ident" id="4597271">t</span>&nbsp;<span class="op" id="4597273">*</span><span class="ident" id="4597274">Template</span><span class="op" id="4597282">)</span>&nbsp;<span class="ident" id="4597284">New</span><span class="op" id="4597287">(</span><span class="ident" id="4597288">name</span>&nbsp;<span class="builtintype" id="4597293">string</span><span class="op" id="4597299">)</span>&nbsp;<span class="op" id="4597301">*</span><span class="ident" id="4597302">Template</span>&nbsp;<span class="op" id="4597311">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597314">t</span><span class="op" id="4597315">.</span><span class="ident" id="4597316">init</span><span class="op" id="4597320">(</span><span class="op" id="4597321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597324">return</span>&nbsp;<span class="op" id="4597331">&amp;</span><span class="ident" id="4597332">Template</span><span class="op" id="4597340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597344">name</span><span class="op" id="4597348">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597356">name</span><span class="op" id="4597360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597364">common</span><span class="op" id="4597370">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4597376">t</span><span class="op" id="4597377">.</span><span class="ident" id="4597378">common</span><span class="op" id="4597384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597388">leftDelim</span><span class="op" id="4597397">:</span>&nbsp;&nbsp;<span class="ident" id="4597400">t</span><span class="op" id="4597401">.</span><span class="ident" id="4597402">leftDelim</span><span class="op" id="4597411">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597415">rightDelim</span><span class="op" id="4597425">:</span>&nbsp;<span class="ident" id="4597427">t</span><span class="op" id="4597428">.</span><span class="ident" id="4597429">rightDelim</span><span class="op" id="4597439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597442">}</span><br>
<span class="lineno"></span><span class="op" id="4597444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4597447">func</span>&nbsp;<span class="op" id="4597452">(</span><span class="ident" id="4597453">t</span>&nbsp;<span class="op" id="4597455">*</span><span class="ident" id="4597456">Template</span><span class="op" id="4597464">)</span>&nbsp;<span class="ident" id="4597466">init</span><span class="op" id="4597470">(</span><span class="op" id="4597471">)</span>&nbsp;<span class="op" id="4597473">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597476">if</span>&nbsp;<span class="ident" id="4597479">t</span><span class="op" id="4597480">.</span><span class="ident" id="4597481">common</span>&nbsp;<span class="op" id="4597488">==</span>&nbsp;<span class="ident" id="4597491">nil</span>&nbsp;<span class="op" id="4597495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597499">t</span><span class="op" id="4597500">.</span><span class="ident" id="4597501">common</span>&nbsp;<span class="op" id="4597508">=</span>&nbsp;<span class="builtinfunc" id="4597510">new</span><span class="op" id="4597513">(</span><span class="ident" id="4597514">common</span><span class="op" id="4597520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597524">t</span><span class="op" id="4597525">.</span><span class="ident" id="4597526">tmpl</span>&nbsp;<span class="op" id="4597531">=</span>&nbsp;<span class="builtinfunc" id="4597533">make</span><span class="op" id="4597537">(</span><span class="keyword" id="4597538">map</span><span class="op" id="4597541">[</span><span class="builtintype" id="4597542">string</span><span class="op" id="4597548">]</span><span class="op" id="4597549">*</span><span class="ident" id="4597550">Template</span><span class="op" id="4597558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597562">t</span><span class="op" id="4597563">.</span><span class="ident" id="4597564">parseFuncs</span>&nbsp;<span class="op" id="4597575">=</span>&nbsp;<span class="builtinfunc" id="4597577">make</span><span class="op" id="4597581">(</span><span class="ident" id="4597582">FuncMap</span><span class="op" id="4597589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597593">t</span><span class="op" id="4597594">.</span><span class="ident" id="4597595">execFuncs</span>&nbsp;<span class="op" id="4597605">=</span>&nbsp;<span class="builtinfunc" id="4597607">make</span><span class="op" id="4597611">(</span><span class="keyword" id="4597612">map</span><span class="op" id="4597615">[</span><span class="builtintype" id="4597616">string</span><span class="op" id="4597622">]</span><span class="ident" id="4597623">reflect</span><span class="op" id="4597630">.</span><span class="ident" id="4597631">Value</span><span class="op" id="4597636">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597639">}</span><br>
<span class="lineno"></span><span class="op" id="4597641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4597644">//&nbsp;Clone&nbsp;returns&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;template,&nbsp;including&nbsp;all&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4597715">//&nbsp;templates.&nbsp;The&nbsp;actual&nbsp;representation&nbsp;is&nbsp;not&nbsp;copied,&nbsp;but&nbsp;the&nbsp;name&nbsp;space&nbsp;of</span><br>
<span class="lineno">70</span><span class="comment" id="4597792">//&nbsp;associated&nbsp;templates&nbsp;is,&nbsp;so&nbsp;further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add</span><br>
<span class="lineno"></span><span class="comment" id="4597867">//&nbsp;templates&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&nbsp;Clone&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;prepare</span><br>
<span class="lineno"></span><span class="comment" id="4597946">//&nbsp;common&nbsp;templates&nbsp;and&nbsp;use&nbsp;them&nbsp;with&nbsp;variant&nbsp;definitions&nbsp;for&nbsp;other&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="4598024">//&nbsp;by&nbsp;adding&nbsp;the&nbsp;variants&nbsp;after&nbsp;the&nbsp;clone&nbsp;is&nbsp;made.</span><br>
<span class="lineno"></span><span class="keyword" id="4598075">func</span>&nbsp;<span class="op" id="4598080">(</span><span class="ident" id="4598081">t</span>&nbsp;<span class="op" id="4598083">*</span><span class="ident" id="4598084">Template</span><span class="op" id="4598092">)</span>&nbsp;<span class="ident" id="4598094">Clone</span><span class="op" id="4598099">(</span><span class="op" id="4598100">)</span>&nbsp;<span class="op" id="4598102">(</span><span class="op" id="4598103">*</span><span class="ident" id="4598104">Template</span><span class="op" id="4598112">,</span>&nbsp;<span class="builtintype" id="4598114">error</span><span class="op" id="4598119">)</span>&nbsp;<span class="op" id="4598121">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598124">nt</span>&nbsp;<span class="op" id="4598127">:=</span>&nbsp;<span class="ident" id="4598130">t</span><span class="op" id="4598131">.</span><span class="builtinfunc" id="4598132">copy</span><span class="op" id="4598136">(</span><span class="ident" id="4598137">nil</span><span class="op" id="4598140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598143">nt</span><span class="op" id="4598145">.</span><span class="ident" id="4598146">init</span><span class="op" id="4598150">(</span><span class="op" id="4598151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598154">nt</span><span class="op" id="4598156">.</span><span class="ident" id="4598157">tmpl</span><span class="op" id="4598161">[</span><span class="ident" id="4598162">t</span><span class="op" id="4598163">.</span><span class="ident" id="4598164">name</span><span class="op" id="4598168">]</span>&nbsp;<span class="op" id="4598170">=</span>&nbsp;<span class="ident" id="4598172">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598176">for</span>&nbsp;<span class="ident" id="4598180">k</span><span class="op" id="4598181">,</span>&nbsp;<span class="ident" id="4598183">v</span>&nbsp;<span class="op" id="4598185">:=</span>&nbsp;<span class="keyword" id="4598188">range</span>&nbsp;<span class="ident" id="4598194">t</span><span class="op" id="4598195">.</span><span class="ident" id="4598196">tmpl</span>&nbsp;<span class="op" id="4598201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598205">if</span>&nbsp;<span class="ident" id="4598208">k</span>&nbsp;<span class="op" id="4598210">==</span>&nbsp;<span class="ident" id="4598213">t</span><span class="op" id="4598214">.</span><span class="ident" id="4598215">name</span>&nbsp;<span class="op" id="4598220">{</span>&nbsp;<span class="comment" id="4598222">//&nbsp;Already&nbsp;installed.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598247">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4598258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4598262">//&nbsp;The&nbsp;associated&nbsp;templates&nbsp;share&nbsp;nt&#39;s&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598321">tmpl</span>&nbsp;<span class="op" id="4598326">:=</span>&nbsp;<span class="ident" id="4598329">v</span><span class="op" id="4598330">.</span><span class="builtinfunc" id="4598331">copy</span><span class="op" id="4598335">(</span><span class="ident" id="4598336">nt</span><span class="op" id="4598338">.</span><span class="ident" id="4598339">common</span><span class="op" id="4598345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598349">nt</span><span class="op" id="4598351">.</span><span class="ident" id="4598352">tmpl</span><span class="op" id="4598356">[</span><span class="ident" id="4598357">k</span><span class="op" id="4598358">]</span>&nbsp;<span class="op" id="4598360">=</span>&nbsp;<span class="ident" id="4598362">tmpl</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4598368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598371">for</span>&nbsp;<span class="ident" id="4598375">k</span><span class="op" id="4598376">,</span>&nbsp;<span class="ident" id="4598378">v</span>&nbsp;<span class="op" id="4598380">:=</span>&nbsp;<span class="keyword" id="4598383">range</span>&nbsp;<span class="ident" id="4598389">t</span><span class="op" id="4598390">.</span><span class="ident" id="4598391">parseFuncs</span>&nbsp;<span class="op" id="4598402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598406">nt</span><span class="op" id="4598408">.</span><span class="ident" id="4598409">parseFuncs</span><span class="op" id="4598419">[</span><span class="ident" id="4598420">k</span><span class="op" id="4598421">]</span>&nbsp;<span class="op" id="4598423">=</span>&nbsp;<span class="ident" id="4598425">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4598428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598431">for</span>&nbsp;<span class="ident" id="4598435">k</span><span class="op" id="4598436">,</span>&nbsp;<span class="ident" id="4598438">v</span>&nbsp;<span class="op" id="4598440">:=</span>&nbsp;<span class="keyword" id="4598443">range</span>&nbsp;<span class="ident" id="4598449">t</span><span class="op" id="4598450">.</span><span class="ident" id="4598451">execFuncs</span>&nbsp;<span class="op" id="4598461">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598465">nt</span><span class="op" id="4598467">.</span><span class="ident" id="4598468">execFuncs</span><span class="op" id="4598477">[</span><span class="ident" id="4598478">k</span><span class="op" id="4598479">]</span>&nbsp;<span class="op" id="4598481">=</span>&nbsp;<span class="ident" id="4598483">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4598486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598489">return</span>&nbsp;<span class="ident" id="4598496">nt</span><span class="op" id="4598498">,</span>&nbsp;<span class="ident" id="4598500">nil</span><br>
<span class="lineno"></span><span class="op" id="4598504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4598507">//&nbsp;copy&nbsp;returns&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;t,&nbsp;with&nbsp;common&nbsp;set&nbsp;to&nbsp;the&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="4598577">func</span>&nbsp;<span class="op" id="4598582">(</span><span class="ident" id="4598583">t</span>&nbsp;<span class="op" id="4598585">*</span><span class="ident" id="4598586">Template</span><span class="op" id="4598594">)</span>&nbsp;<span class="builtinfunc" id="4598596">copy</span><span class="op" id="4598600">(</span><span class="ident" id="4598601">c</span>&nbsp;<span class="op" id="4598603">*</span><span class="ident" id="4598604">common</span><span class="op" id="4598610">)</span>&nbsp;<span class="op" id="4598612">*</span><span class="ident" id="4598613">Template</span>&nbsp;<span class="op" id="4598622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598625">nt</span>&nbsp;<span class="op" id="4598628">:=</span>&nbsp;<span class="ident" id="4598631">New</span><span class="op" id="4598634">(</span><span class="ident" id="4598635">t</span><span class="op" id="4598636">.</span><span class="ident" id="4598637">name</span><span class="op" id="4598641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598644">nt</span><span class="op" id="4598646">.</span><span class="ident" id="4598647">Tree</span>&nbsp;<span class="op" id="4598652">=</span>&nbsp;<span class="ident" id="4598654">t</span><span class="op" id="4598655">.</span><span class="ident" id="4598656">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598662">nt</span><span class="op" id="4598664">.</span><span class="ident" id="4598665">common</span>&nbsp;<span class="op" id="4598672">=</span>&nbsp;<span class="ident" id="4598674">c</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598677">nt</span><span class="op" id="4598679">.</span><span class="ident" id="4598680">leftDelim</span>&nbsp;<span class="op" id="4598690">=</span>&nbsp;<span class="ident" id="4598692">t</span><span class="op" id="4598693">.</span><span class="ident" id="4598694">leftDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4598705">nt</span><span class="op" id="4598707">.</span><span class="ident" id="4598708">rightDelim</span>&nbsp;<span class="op" id="4598719">=</span>&nbsp;<span class="ident" id="4598721">t</span><span class="op" id="4598722">.</span><span class="ident" id="4598723">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598735">return</span>&nbsp;<span class="ident" id="4598742">nt</span><br>
<span class="lineno"></span><span class="op" id="4598745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4598748">//&nbsp;AddParseTree&nbsp;creates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;parse&nbsp;tree</span><br>
<span class="lineno"></span><span class="comment" id="4598816">//&nbsp;and&nbsp;associates&nbsp;it&nbsp;with&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword" id="4598845">func</span>&nbsp;<span class="op" id="4598850">(</span><span class="ident" id="4598851">t</span>&nbsp;<span class="op" id="4598853">*</span><span class="ident" id="4598854">Template</span><span class="op" id="4598862">)</span>&nbsp;<span class="ident" id="4598864">AddParseTree</span><span class="op" id="4598876">(</span><span class="ident" id="4598877">name</span>&nbsp;<span class="builtintype" id="4598882">string</span><span class="op" id="4598888">,</span>&nbsp;<span class="ident" id="4598890">tree</span>&nbsp;<span class="op" id="4598895">*</span><span class="ident" id="4598896">parse</span><span class="op" id="4598901">.</span><span class="ident" id="4598902">Tree</span><span class="op" id="4598906">)</span>&nbsp;<span class="op" id="4598908">(</span><span class="op" id="4598909">*</span><span class="ident" id="4598910">Template</span><span class="op" id="4598918">,</span>&nbsp;<span class="builtintype" id="4598920">error</span><span class="op" id="4598925">)</span>&nbsp;<span class="op" id="4598927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598930">if</span>&nbsp;<span class="ident" id="4598933">t</span><span class="op" id="4598934">.</span><span class="ident" id="4598935">common</span>&nbsp;<span class="op" id="4598942">!=</span>&nbsp;<span class="ident" id="4598945">nil</span>&nbsp;<span class="op" id="4598949">&amp;&amp;</span>&nbsp;<span class="ident" id="4598952">t</span><span class="op" id="4598953">.</span><span class="ident" id="4598954">tmpl</span><span class="op" id="4598958">[</span><span class="ident" id="4598959">name</span><span class="op" id="4598963">]</span>&nbsp;<span class="op" id="4598965">!=</span>&nbsp;<span class="ident" id="4598968">nil</span>&nbsp;<span class="op" id="4598972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4598976">return</span>&nbsp;<span class="ident" id="4598983">nil</span><span class="op" id="4598986">,</span>&nbsp;<span class="ident" id="4598988">fmt</span><span class="op" id="4598991">.</span><span class="ident" id="4598992">Errorf</span><span class="op" id="4598998">(</span><span class="string" id="4598999">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="4599038">,</span>&nbsp;<span class="ident" id="4599040">name</span><span class="op" id="4599044">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599050">nt</span>&nbsp;<span class="op" id="4599053">:=</span>&nbsp;<span class="ident" id="4599056">t</span><span class="op" id="4599057">.</span><span class="ident" id="4599058">New</span><span class="op" id="4599061">(</span><span class="ident" id="4599062">name</span><span class="op" id="4599066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599069">nt</span><span class="op" id="4599071">.</span><span class="ident" id="4599072">Tree</span>&nbsp;<span class="op" id="4599077">=</span>&nbsp;<span class="ident" id="4599079">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599085">t</span><span class="op" id="4599086">.</span><span class="ident" id="4599087">tmpl</span><span class="op" id="4599091">[</span><span class="ident" id="4599092">name</span><span class="op" id="4599096">]</span>&nbsp;<span class="op" id="4599098">=</span>&nbsp;<span class="ident" id="4599100">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599104">return</span>&nbsp;<span class="ident" id="4599111">nt</span><span class="op" id="4599113">,</span>&nbsp;<span class="ident" id="4599115">nil</span><br>
<span class="lineno">115</span><span class="op" id="4599119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4599122">//&nbsp;Templates&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;templates&nbsp;associated&nbsp;with&nbsp;t,&nbsp;including&nbsp;t</span><br>
<span class="lineno"></span><span class="comment" id="4599199">//&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4599210">func</span>&nbsp;<span class="op" id="4599215">(</span><span class="ident" id="4599216">t</span>&nbsp;<span class="op" id="4599218">*</span><span class="ident" id="4599219">Template</span><span class="op" id="4599227">)</span>&nbsp;<span class="ident" id="4599229">Templates</span><span class="op" id="4599238">(</span><span class="op" id="4599239">)</span>&nbsp;<span class="op" id="4599241">[</span><span class="op" id="4599242">]</span><span class="op" id="4599243">*</span><span class="ident" id="4599244">Template</span>&nbsp;<span class="op" id="4599253">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599256">if</span>&nbsp;<span class="ident" id="4599259">t</span><span class="op" id="4599260">.</span><span class="ident" id="4599261">common</span>&nbsp;<span class="op" id="4599268">==</span>&nbsp;<span class="ident" id="4599271">nil</span>&nbsp;<span class="op" id="4599275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599279">return</span>&nbsp;<span class="ident" id="4599286">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4599294">//&nbsp;Return&nbsp;a&nbsp;slice&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;expose&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599341">m</span>&nbsp;<span class="op" id="4599343">:=</span>&nbsp;<span class="builtinfunc" id="4599346">make</span><span class="op" id="4599350">(</span><span class="op" id="4599351">[</span><span class="op" id="4599352">]</span><span class="op" id="4599353">*</span><span class="ident" id="4599354">Template</span><span class="op" id="4599362">,</span>&nbsp;<span class="num" id="4599364">0</span><span class="op" id="4599365">,</span>&nbsp;<span class="builtinfunc" id="4599367">len</span><span class="op" id="4599370">(</span><span class="ident" id="4599371">t</span><span class="op" id="4599372">.</span><span class="ident" id="4599373">tmpl</span><span class="op" id="4599377">)</span><span class="op" id="4599378">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599381">for</span>&nbsp;<span class="ident" id="4599385">_</span><span class="op" id="4599386">,</span>&nbsp;<span class="ident" id="4599388">v</span>&nbsp;<span class="op" id="4599390">:=</span>&nbsp;<span class="keyword" id="4599393">range</span>&nbsp;<span class="ident" id="4599399">t</span><span class="op" id="4599400">.</span><span class="ident" id="4599401">tmpl</span>&nbsp;<span class="op" id="4599406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599410">m</span>&nbsp;<span class="op" id="4599412">=</span>&nbsp;<span class="builtinfunc" id="4599414">append</span><span class="op" id="4599420">(</span><span class="ident" id="4599421">m</span><span class="op" id="4599422">,</span>&nbsp;<span class="ident" id="4599424">v</span><span class="op" id="4599425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4599428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599431">return</span>&nbsp;<span class="ident" id="4599438">m</span><br>
<span class="lineno"></span><span class="op" id="4599440">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4599443">//&nbsp;Delims&nbsp;sets&nbsp;the&nbsp;action&nbsp;delimiters&nbsp;to&nbsp;the&nbsp;specified&nbsp;strings,&nbsp;to&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4599520">//&nbsp;subsequent&nbsp;calls&nbsp;to&nbsp;Parse,&nbsp;ParseFiles,&nbsp;or&nbsp;ParseGlob.&nbsp;Nested&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="4599592">//&nbsp;definitions&nbsp;will&nbsp;inherit&nbsp;the&nbsp;settings.&nbsp;An&nbsp;empty&nbsp;delimiter&nbsp;stands&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4599668">//&nbsp;corresponding&nbsp;default:&nbsp;{{&nbsp;or&nbsp;}}.</span><br>
<span class="lineno">135</span><span class="comment" id="4599704">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="4599766">func</span>&nbsp;<span class="op" id="4599771">(</span><span class="ident" id="4599772">t</span>&nbsp;<span class="op" id="4599774">*</span><span class="ident" id="4599775">Template</span><span class="op" id="4599783">)</span>&nbsp;<span class="ident" id="4599785">Delims</span><span class="op" id="4599791">(</span><span class="ident" id="4599792">left</span><span class="op" id="4599796">,</span>&nbsp;<span class="ident" id="4599798">right</span>&nbsp;<span class="builtintype" id="4599804">string</span><span class="op" id="4599810">)</span>&nbsp;<span class="op" id="4599812">*</span><span class="ident" id="4599813">Template</span>&nbsp;<span class="op" id="4599822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599825">t</span><span class="op" id="4599826">.</span><span class="ident" id="4599827">leftDelim</span>&nbsp;<span class="op" id="4599837">=</span>&nbsp;<span class="ident" id="4599839">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4599845">t</span><span class="op" id="4599846">.</span><span class="ident" id="4599847">rightDelim</span>&nbsp;<span class="op" id="4599858">=</span>&nbsp;<span class="ident" id="4599860">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4599867">return</span>&nbsp;<span class="ident" id="4599874">t</span><br>
<span class="lineno">140</span><span class="op" id="4599876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4599879">//&nbsp;Funcs&nbsp;adds&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;argument&nbsp;map&nbsp;to&nbsp;the&nbsp;template&#39;s&nbsp;function&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="4599958">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;a&nbsp;value&nbsp;in&nbsp;the&nbsp;map&nbsp;is&nbsp;not&nbsp;a&nbsp;function&nbsp;with&nbsp;appropriate&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4600035">//&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is&nbsp;legal&nbsp;to&nbsp;overwrite&nbsp;elements&nbsp;of&nbsp;the&nbsp;map.&nbsp;The&nbsp;return</span><br>
<span class="lineno">145</span><span class="comment" id="4600110">//&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="4600161">func</span>&nbsp;<span class="op" id="4600166">(</span><span class="ident" id="4600167">t</span>&nbsp;<span class="op" id="4600169">*</span><span class="ident" id="4600170">Template</span><span class="op" id="4600178">)</span>&nbsp;<span class="ident" id="4600180">Funcs</span><span class="op" id="4600185">(</span><span class="ident" id="4600186">funcMap</span>&nbsp;<span class="ident" id="4600194">FuncMap</span><span class="op" id="4600201">)</span>&nbsp;<span class="op" id="4600203">*</span><span class="ident" id="4600204">Template</span>&nbsp;<span class="op" id="4600213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600216">t</span><span class="op" id="4600217">.</span><span class="ident" id="4600218">init</span><span class="op" id="4600222">(</span><span class="op" id="4600223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600226">addValueFuncs</span><span class="op" id="4600239">(</span><span class="ident" id="4600240">t</span><span class="op" id="4600241">.</span><span class="ident" id="4600242">execFuncs</span><span class="op" id="4600251">,</span>&nbsp;<span class="ident" id="4600253">funcMap</span><span class="op" id="4600260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600263">addFuncs</span><span class="op" id="4600271">(</span><span class="ident" id="4600272">t</span><span class="op" id="4600273">.</span><span class="ident" id="4600274">parseFuncs</span><span class="op" id="4600284">,</span>&nbsp;<span class="ident" id="4600286">funcMap</span><span class="op" id="4600293">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600296">return</span>&nbsp;<span class="ident" id="4600303">t</span><br>
<span class="lineno"></span><span class="op" id="4600305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4600308">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;that&nbsp;is&nbsp;associated&nbsp;with&nbsp;t,</span><br>
<span class="lineno"></span><span class="comment" id="4600386">//&nbsp;or&nbsp;nil&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;template.</span><br>
<span class="lineno">155</span><span class="keyword" id="4600426">func</span>&nbsp;<span class="op" id="4600431">(</span><span class="ident" id="4600432">t</span>&nbsp;<span class="op" id="4600434">*</span><span class="ident" id="4600435">Template</span><span class="op" id="4600443">)</span>&nbsp;<span class="ident" id="4600445">Lookup</span><span class="op" id="4600451">(</span><span class="ident" id="4600452">name</span>&nbsp;<span class="builtintype" id="4600457">string</span><span class="op" id="4600463">)</span>&nbsp;<span class="op" id="4600465">*</span><span class="ident" id="4600466">Template</span>&nbsp;<span class="op" id="4600475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600478">if</span>&nbsp;<span class="ident" id="4600481">t</span><span class="op" id="4600482">.</span><span class="ident" id="4600483">common</span>&nbsp;<span class="op" id="4600490">==</span>&nbsp;<span class="ident" id="4600493">nil</span>&nbsp;<span class="op" id="4600497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600501">return</span>&nbsp;<span class="ident" id="4600508">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4600513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600516">return</span>&nbsp;<span class="ident" id="4600523">t</span><span class="op" id="4600524">.</span><span class="ident" id="4600525">tmpl</span><span class="op" id="4600529">[</span><span class="ident" id="4600530">name</span><span class="op" id="4600534">]</span><br>
<span class="lineno">160</span><span class="op" id="4600536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4600539">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;template.&nbsp;Nested&nbsp;template&nbsp;definitions&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4600617">//&nbsp;associated&nbsp;with&nbsp;the&nbsp;top-level&nbsp;template&nbsp;t.&nbsp;Parse&nbsp;may&nbsp;be&nbsp;called&nbsp;multiple&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="4600697">//&nbsp;to&nbsp;parse&nbsp;definitions&nbsp;of&nbsp;templates&nbsp;to&nbsp;associate&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;if&nbsp;a</span><br>
<span class="lineno">165</span><span class="comment" id="4600775">//&nbsp;resulting&nbsp;template&nbsp;is&nbsp;non-empty&nbsp;(contains&nbsp;content&nbsp;other&nbsp;than&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="4600848">//&nbsp;definitions)&nbsp;and&nbsp;would&nbsp;replace&nbsp;a&nbsp;non-empty&nbsp;template&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="4600923">//&nbsp;(In&nbsp;multiple&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;with&nbsp;the&nbsp;same&nbsp;receiver&nbsp;template,&nbsp;only&nbsp;one&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="4601001">//&nbsp;can&nbsp;contain&nbsp;text&nbsp;other&nbsp;than&nbsp;space,&nbsp;comments,&nbsp;and&nbsp;template&nbsp;definitions.)</span><br>
<span class="lineno"></span><span class="keyword" id="4601076">func</span>&nbsp;<span class="op" id="4601081">(</span><span class="ident" id="4601082">t</span>&nbsp;<span class="op" id="4601084">*</span><span class="ident" id="4601085">Template</span><span class="op" id="4601093">)</span>&nbsp;<span class="ident" id="4601095">Parse</span><span class="op" id="4601100">(</span><span class="ident" id="4601101">text</span>&nbsp;<span class="builtintype" id="4601106">string</span><span class="op" id="4601112">)</span>&nbsp;<span class="op" id="4601114">(</span><span class="op" id="4601115">*</span><span class="ident" id="4601116">Template</span><span class="op" id="4601124">,</span>&nbsp;<span class="builtintype" id="4601126">error</span><span class="op" id="4601131">)</span>&nbsp;<span class="op" id="4601133">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601136">t</span><span class="op" id="4601137">.</span><span class="ident" id="4601138">init</span><span class="op" id="4601142">(</span><span class="op" id="4601143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601146">trees</span><span class="op" id="4601151">,</span>&nbsp;<span class="ident" id="4601153">err</span>&nbsp;<span class="op" id="4601157">:=</span>&nbsp;<span class="ident" id="4601160">parse</span><span class="op" id="4601165">.</span><span class="ident" id="4601166">Parse</span><span class="op" id="4601171">(</span><span class="ident" id="4601172">t</span><span class="op" id="4601173">.</span><span class="ident" id="4601174">name</span><span class="op" id="4601178">,</span>&nbsp;<span class="ident" id="4601180">text</span><span class="op" id="4601184">,</span>&nbsp;<span class="ident" id="4601186">t</span><span class="op" id="4601187">.</span><span class="ident" id="4601188">leftDelim</span><span class="op" id="4601197">,</span>&nbsp;<span class="ident" id="4601199">t</span><span class="op" id="4601200">.</span><span class="ident" id="4601201">rightDelim</span><span class="op" id="4601211">,</span>&nbsp;<span class="ident" id="4601213">t</span><span class="op" id="4601214">.</span><span class="ident" id="4601215">parseFuncs</span><span class="op" id="4601225">,</span>&nbsp;<span class="ident" id="4601227">builtins</span><span class="op" id="4601235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601238">if</span>&nbsp;<span class="ident" id="4601241">err</span>&nbsp;<span class="op" id="4601245">!=</span>&nbsp;<span class="ident" id="4601248">nil</span>&nbsp;<span class="op" id="4601252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601256">return</span>&nbsp;<span class="ident" id="4601263">nil</span><span class="op" id="4601266">,</span>&nbsp;<span class="ident" id="4601268">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601273">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4601276">//&nbsp;Add&nbsp;the&nbsp;newly&nbsp;parsed&nbsp;trees,&nbsp;including&nbsp;the&nbsp;one&nbsp;for&nbsp;t,&nbsp;into&nbsp;our&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601360">for</span>&nbsp;<span class="ident" id="4601364">name</span><span class="op" id="4601368">,</span>&nbsp;<span class="ident" id="4601370">tree</span>&nbsp;<span class="op" id="4601375">:=</span>&nbsp;<span class="keyword" id="4601378">range</span>&nbsp;<span class="ident" id="4601384">trees</span>&nbsp;<span class="op" id="4601390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4601394">//&nbsp;If&nbsp;the&nbsp;name&nbsp;we&nbsp;parsed&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;template,&nbsp;overwrite&nbsp;this&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4601476">//&nbsp;The&nbsp;associate&nbsp;method&nbsp;checks&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;redefinition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601534">tmpl</span>&nbsp;<span class="op" id="4601539">:=</span>&nbsp;<span class="ident" id="4601542">t</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601546">if</span>&nbsp;<span class="ident" id="4601549">name</span>&nbsp;<span class="op" id="4601554">!=</span>&nbsp;<span class="ident" id="4601557">t</span><span class="op" id="4601558">.</span><span class="ident" id="4601559">name</span>&nbsp;<span class="op" id="4601564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601569">tmpl</span>&nbsp;<span class="op" id="4601574">=</span>&nbsp;<span class="ident" id="4601576">t</span><span class="op" id="4601577">.</span><span class="ident" id="4601578">New</span><span class="op" id="4601581">(</span><span class="ident" id="4601582">name</span><span class="op" id="4601586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4601594">//&nbsp;Even&nbsp;if&nbsp;t&nbsp;==&nbsp;tmpl,&nbsp;we&nbsp;need&nbsp;to&nbsp;install&nbsp;it&nbsp;in&nbsp;the&nbsp;common.tmpl&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601664">if</span>&nbsp;<span class="ident" id="4601667">replace</span><span class="op" id="4601674">,</span>&nbsp;<span class="ident" id="4601676">err</span>&nbsp;<span class="op" id="4601680">:=</span>&nbsp;<span class="ident" id="4601683">t</span><span class="op" id="4601684">.</span><span class="ident" id="4601685">associate</span><span class="op" id="4601694">(</span><span class="ident" id="4601695">tmpl</span><span class="op" id="4601699">,</span>&nbsp;<span class="ident" id="4601701">tree</span><span class="op" id="4601705">)</span><span class="op" id="4601706">;</span>&nbsp;<span class="ident" id="4601708">err</span>&nbsp;<span class="op" id="4601712">!=</span>&nbsp;<span class="ident" id="4601715">nil</span>&nbsp;<span class="op" id="4601719">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601724">return</span>&nbsp;<span class="ident" id="4601731">nil</span><span class="op" id="4601734">,</span>&nbsp;<span class="ident" id="4601736">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601742">}</span>&nbsp;<span class="keyword" id="4601744">else</span>&nbsp;<span class="keyword" id="4601749">if</span>&nbsp;<span class="ident" id="4601752">replace</span>&nbsp;<span class="op" id="4601760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601765">tmpl</span><span class="op" id="4601769">.</span><span class="ident" id="4601770">Tree</span>&nbsp;<span class="op" id="4601775">=</span>&nbsp;<span class="ident" id="4601777">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601788">tmpl</span><span class="op" id="4601792">.</span><span class="ident" id="4601793">leftDelim</span>&nbsp;<span class="op" id="4601803">=</span>&nbsp;<span class="ident" id="4601805">t</span><span class="op" id="4601806">.</span><span class="ident" id="4601807">leftDelim</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601819">tmpl</span><span class="op" id="4601823">.</span><span class="ident" id="4601824">rightDelim</span>&nbsp;<span class="op" id="4601835">=</span>&nbsp;<span class="ident" id="4601837">t</span><span class="op" id="4601838">.</span><span class="ident" id="4601839">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601854">return</span>&nbsp;<span class="ident" id="4601861">t</span><span class="op" id="4601862">,</span>&nbsp;<span class="ident" id="4601864">nil</span><br>
<span class="lineno"></span><span class="op" id="4601868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="4601871">//&nbsp;associate&nbsp;installs&nbsp;the&nbsp;new&nbsp;template&nbsp;into&nbsp;the&nbsp;group&nbsp;of&nbsp;templates&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4601949">//&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;reuse&nbsp;a&nbsp;name&nbsp;except&nbsp;to&nbsp;overwrite&nbsp;an&nbsp;empty</span><br>
<span class="lineno"></span><span class="comment" id="4602020">//&nbsp;template.&nbsp;The&nbsp;two&nbsp;are&nbsp;already&nbsp;known&nbsp;to&nbsp;share&nbsp;the&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="4602090">//&nbsp;The&nbsp;boolean&nbsp;return&nbsp;value&nbsp;reports&nbsp;wither&nbsp;to&nbsp;store&nbsp;this&nbsp;tree&nbsp;as&nbsp;t.Tree.</span><br>
<span class="lineno"></span><span class="keyword" id="4602163">func</span>&nbsp;<span class="op" id="4602168">(</span><span class="ident" id="4602169">t</span>&nbsp;<span class="op" id="4602171">*</span><span class="ident" id="4602172">Template</span><span class="op" id="4602180">)</span>&nbsp;<span class="ident" id="4602182">associate</span><span class="op" id="4602191">(</span><span class="builtinfunc" id="4602192">new</span>&nbsp;<span class="op" id="4602196">*</span><span class="ident" id="4602197">Template</span><span class="op" id="4602205">,</span>&nbsp;<span class="ident" id="4602207">tree</span>&nbsp;<span class="op" id="4602212">*</span><span class="ident" id="4602213">parse</span><span class="op" id="4602218">.</span><span class="ident" id="4602219">Tree</span><span class="op" id="4602223">)</span>&nbsp;<span class="op" id="4602225">(</span><span class="builtintype" id="4602226">bool</span><span class="op" id="4602230">,</span>&nbsp;<span class="builtintype" id="4602232">error</span><span class="op" id="4602237">)</span>&nbsp;<span class="op" id="4602239">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602242">if</span>&nbsp;<span class="builtinfunc" id="4602245">new</span><span class="op" id="4602248">.</span><span class="ident" id="4602249">common</span>&nbsp;<span class="op" id="4602256">!=</span>&nbsp;<span class="ident" id="4602259">t</span><span class="op" id="4602260">.</span><span class="ident" id="4602261">common</span>&nbsp;<span class="op" id="4602268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4602272">panic</span><span class="op" id="4602277">(</span><span class="string" id="4602278">&#34;internal&nbsp;error:&nbsp;associate&nbsp;not&nbsp;common&#34;</span><span class="op" id="4602316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602322">name</span>&nbsp;<span class="op" id="4602327">:=</span>&nbsp;<span class="builtinfunc" id="4602330">new</span><span class="op" id="4602333">.</span><span class="ident" id="4602334">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602340">if</span>&nbsp;<span class="ident" id="4602343">old</span>&nbsp;<span class="op" id="4602347">:=</span>&nbsp;<span class="ident" id="4602350">t</span><span class="op" id="4602351">.</span><span class="ident" id="4602352">tmpl</span><span class="op" id="4602356">[</span><span class="ident" id="4602357">name</span><span class="op" id="4602361">]</span><span class="op" id="4602362">;</span>&nbsp;<span class="ident" id="4602364">old</span>&nbsp;<span class="op" id="4602368">!=</span>&nbsp;<span class="ident" id="4602371">nil</span>&nbsp;<span class="op" id="4602375">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602379">oldIsEmpty</span>&nbsp;<span class="op" id="4602390">:=</span>&nbsp;<span class="ident" id="4602393">parse</span><span class="op" id="4602398">.</span><span class="ident" id="4602399">IsEmptyTree</span><span class="op" id="4602410">(</span><span class="ident" id="4602411">old</span><span class="op" id="4602414">.</span><span class="ident" id="4602415">Root</span><span class="op" id="4602419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602423">newIsEmpty</span>&nbsp;<span class="op" id="4602434">:=</span>&nbsp;<span class="ident" id="4602437">parse</span><span class="op" id="4602442">.</span><span class="ident" id="4602443">IsEmptyTree</span><span class="op" id="4602454">(</span><span class="ident" id="4602455">tree</span><span class="op" id="4602459">.</span><span class="ident" id="4602460">Root</span><span class="op" id="4602464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602468">if</span>&nbsp;<span class="ident" id="4602471">newIsEmpty</span>&nbsp;<span class="op" id="4602482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4602487">//&nbsp;Whether&nbsp;old&nbsp;is&nbsp;empty&nbsp;or&nbsp;not,&nbsp;new&nbsp;is&nbsp;empty;&nbsp;no&nbsp;reason&nbsp;to&nbsp;replace&nbsp;old.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602562">return</span>&nbsp;<span class="builtintype" id="4602569">false</span><span class="op" id="4602574">,</span>&nbsp;<span class="ident" id="4602576">nil</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602586">if</span>&nbsp;<span class="op" id="4602589">!</span><span class="ident" id="4602590">oldIsEmpty</span>&nbsp;<span class="op" id="4602601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602606">return</span>&nbsp;<span class="builtintype" id="4602613">false</span><span class="op" id="4602618">,</span>&nbsp;<span class="ident" id="4602620">fmt</span><span class="op" id="4602623">.</span><span class="ident" id="4602624">Errorf</span><span class="op" id="4602630">(</span><span class="string" id="4602631">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="4602670">,</span>&nbsp;<span class="ident" id="4602672">name</span><span class="op" id="4602676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602683">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602686">t</span><span class="op" id="4602687">.</span><span class="ident" id="4602688">tmpl</span><span class="op" id="4602692">[</span><span class="ident" id="4602693">name</span><span class="op" id="4602697">]</span>&nbsp;<span class="op" id="4602699">=</span>&nbsp;<span class="builtinfunc" id="4602701">new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602706">return</span>&nbsp;<span class="builtintype" id="4602713">true</span><span class="op" id="4602717">,</span>&nbsp;<span class="ident" id="4602719">nil</span><br>
<span class="lineno"></span><span class="op" id="4602723">}</span>
</div>
</body>
</html>
