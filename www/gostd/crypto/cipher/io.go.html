<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3631516">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3631571">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3631625">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3631676">package</span>&nbsp;<span class="ident" id="3631684">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3631692">import</span>&nbsp;<span class="string" id="3631699">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3631705">//&nbsp;The&nbsp;Stream*&nbsp;objects&nbsp;are&nbsp;so&nbsp;simple&nbsp;that&nbsp;all&nbsp;their&nbsp;members&nbsp;are&nbsp;public.&nbsp;Users</span><br>
<span class="lineno">10</span><span class="comment" id="3631783">//&nbsp;can&nbsp;create&nbsp;them&nbsp;themselves.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3631815">//&nbsp;StreamReader&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Reader.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3631887">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.</span><br>
<span class="lineno"></span><span class="keyword" id="3631942">type</span>&nbsp;<span class="ident" id="3631947">StreamReader</span>&nbsp;<span class="keyword" id="3631960">struct</span>&nbsp;<span class="op" id="3631967">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631970">S</span>&nbsp;<span class="ident" id="3631972">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631980">R</span>&nbsp;<span class="ident" id="3631982">io</span><span class="op" id="3631984">.</span><span class="ident" id="3631985">Reader</span><br>
<span class="lineno"></span><span class="op" id="3631992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3631995">func</span>&nbsp;<span class="op" id="3632000">(</span><span class="ident" id="3632001">r</span>&nbsp;<span class="ident" id="3632003">StreamReader</span><span class="op" id="3632015">)</span>&nbsp;<span class="ident" id="3632017">Read</span><span class="op" id="3632021">(</span><span class="ident" id="3632022">dst</span>&nbsp;<span class="op" id="3632026">[</span><span class="op" id="3632027">]</span><span class="builtintype" id="3632028">byte</span><span class="op" id="3632032">)</span>&nbsp;<span class="op" id="3632034">(</span><span class="ident" id="3632035">n</span>&nbsp;<span class="builtintype" id="3632037">int</span><span class="op" id="3632040">,</span>&nbsp;<span class="ident" id="3632042">err</span>&nbsp;<span class="builtintype" id="3632046">error</span><span class="op" id="3632051">)</span>&nbsp;<span class="op" id="3632053">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632056">n</span><span class="op" id="3632057">,</span>&nbsp;<span class="ident" id="3632059">err</span>&nbsp;<span class="op" id="3632063">=</span>&nbsp;<span class="ident" id="3632065">r</span><span class="op" id="3632066">.</span><span class="ident" id="3632067">R</span><span class="op" id="3632068">.</span><span class="ident" id="3632069">Read</span><span class="op" id="3632073">(</span><span class="ident" id="3632074">dst</span><span class="op" id="3632077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632080">r</span><span class="op" id="3632081">.</span><span class="ident" id="3632082">S</span><span class="op" id="3632083">.</span><span class="ident" id="3632084">XORKeyStream</span><span class="op" id="3632096">(</span><span class="ident" id="3632097">dst</span><span class="op" id="3632100">[</span><span class="op" id="3632101">:</span><span class="ident" id="3632102">n</span><span class="op" id="3632103">]</span><span class="op" id="3632104">,</span>&nbsp;<span class="ident" id="3632106">dst</span><span class="op" id="3632109">[</span><span class="op" id="3632110">:</span><span class="ident" id="3632111">n</span><span class="op" id="3632112">]</span><span class="op" id="3632113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3632116">return</span><br>
<span class="lineno"></span><span class="op" id="3632123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3632126">//&nbsp;StreamWriter&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Writer.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3632198">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.&nbsp;If&nbsp;any&nbsp;Write&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3632271">//&nbsp;returns&nbsp;short&nbsp;then&nbsp;the&nbsp;StreamWriter&nbsp;is&nbsp;out&nbsp;of&nbsp;sync&nbsp;and&nbsp;must&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="comment" id="3632348">//&nbsp;A&nbsp;StreamWriter&nbsp;has&nbsp;no&nbsp;internal&nbsp;buffering;&nbsp;Close&nbsp;does&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3632413">//&nbsp;to&nbsp;be&nbsp;called&nbsp;to&nbsp;flush&nbsp;write&nbsp;data.</span><br>
<span class="lineno">30</span><span class="keyword" id="3632450">type</span>&nbsp;<span class="ident" id="3632455">StreamWriter</span>&nbsp;<span class="keyword" id="3632468">struct</span>&nbsp;<span class="op" id="3632475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632478">S</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3632482">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632490">W</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3632494">io</span><span class="op" id="3632496">.</span><span class="ident" id="3632497">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632505">Err</span>&nbsp;<span class="builtintype" id="3632509">error</span>&nbsp;<span class="comment" id="3632515">//&nbsp;unused</span><br>
<span class="lineno"></span><span class="op" id="3632525">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3632528">func</span>&nbsp;<span class="op" id="3632533">(</span><span class="ident" id="3632534">w</span>&nbsp;<span class="ident" id="3632536">StreamWriter</span><span class="op" id="3632548">)</span>&nbsp;<span class="ident" id="3632550">Write</span><span class="op" id="3632555">(</span><span class="ident" id="3632556">src</span>&nbsp;<span class="op" id="3632560">[</span><span class="op" id="3632561">]</span><span class="builtintype" id="3632562">byte</span><span class="op" id="3632566">)</span>&nbsp;<span class="op" id="3632568">(</span><span class="ident" id="3632569">n</span>&nbsp;<span class="builtintype" id="3632571">int</span><span class="op" id="3632574">,</span>&nbsp;<span class="ident" id="3632576">err</span>&nbsp;<span class="builtintype" id="3632580">error</span><span class="op" id="3632585">)</span>&nbsp;<span class="op" id="3632587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632590">c</span>&nbsp;<span class="op" id="3632592">:=</span>&nbsp;<span class="builtinfunc" id="3632595">make</span><span class="op" id="3632599">(</span><span class="op" id="3632600">[</span><span class="op" id="3632601">]</span><span class="builtintype" id="3632602">byte</span><span class="op" id="3632606">,</span>&nbsp;<span class="builtinfunc" id="3632608">len</span><span class="op" id="3632611">(</span><span class="ident" id="3632612">src</span><span class="op" id="3632615">)</span><span class="op" id="3632616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632619">w</span><span class="op" id="3632620">.</span><span class="ident" id="3632621">S</span><span class="op" id="3632622">.</span><span class="ident" id="3632623">XORKeyStream</span><span class="op" id="3632635">(</span><span class="ident" id="3632636">c</span><span class="op" id="3632637">,</span>&nbsp;<span class="ident" id="3632639">src</span><span class="op" id="3632642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632645">n</span><span class="op" id="3632646">,</span>&nbsp;<span class="ident" id="3632648">err</span>&nbsp;<span class="op" id="3632652">=</span>&nbsp;<span class="ident" id="3632654">w</span><span class="op" id="3632655">.</span><span class="ident" id="3632656">W</span><span class="op" id="3632657">.</span><span class="ident" id="3632658">Write</span><span class="op" id="3632663">(</span><span class="ident" id="3632664">c</span><span class="op" id="3632665">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3632668">if</span>&nbsp;<span class="ident" id="3632671">n</span>&nbsp;<span class="op" id="3632673">!=</span>&nbsp;<span class="builtinfunc" id="3632676">len</span><span class="op" id="3632679">(</span><span class="ident" id="3632680">src</span><span class="op" id="3632683">)</span>&nbsp;<span class="op" id="3632685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3632689">if</span>&nbsp;<span class="ident" id="3632692">err</span>&nbsp;<span class="op" id="3632696">==</span>&nbsp;<span class="ident" id="3632699">nil</span>&nbsp;<span class="op" id="3632703">{</span>&nbsp;<span class="comment" id="3632705">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632731">err</span>&nbsp;<span class="op" id="3632735">=</span>&nbsp;<span class="ident" id="3632737">io</span><span class="op" id="3632739">.</span><span class="ident" id="3632740">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3632756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3632759">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3632762">return</span><br>
<span class="lineno"></span><span class="op" id="3632769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3632772">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;Writer&nbsp;and&nbsp;returns&nbsp;its&nbsp;Close&nbsp;return&nbsp;value,&nbsp;if&nbsp;the&nbsp;Writer</span><br>
<span class="lineno"></span><span class="comment" id="3632860">//&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer.&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">50</span><span class="keyword" id="3632911">func</span>&nbsp;<span class="op" id="3632916">(</span><span class="ident" id="3632917">w</span>&nbsp;<span class="ident" id="3632919">StreamWriter</span><span class="op" id="3632931">)</span>&nbsp;<span class="ident" id="3632933">Close</span><span class="op" id="3632938">(</span><span class="op" id="3632939">)</span>&nbsp;<span class="builtintype" id="3632941">error</span>&nbsp;<span class="op" id="3632947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3632950">if</span>&nbsp;<span class="ident" id="3632953">c</span><span class="op" id="3632954">,</span>&nbsp;<span class="ident" id="3632956">ok</span>&nbsp;<span class="op" id="3632959">:=</span>&nbsp;<span class="ident" id="3632962">w</span><span class="op" id="3632963">.</span><span class="ident" id="3632964">W</span><span class="op" id="3632965">.</span><span class="op" id="3632966">(</span><span class="ident" id="3632967">io</span><span class="op" id="3632969">.</span><span class="ident" id="3632970">Closer</span><span class="op" id="3632976">)</span><span class="op" id="3632977">;</span>&nbsp;<span class="ident" id="3632979">ok</span>&nbsp;<span class="op" id="3632982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3632986">return</span>&nbsp;<span class="ident" id="3632993">c</span><span class="op" id="3632994">.</span><span class="ident" id="3632995">Close</span><span class="op" id="3633000">(</span><span class="op" id="3633001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633007">return</span>&nbsp;<span class="ident" id="3633014">nil</span><br>
<span class="lineno">55</span><span class="op" id="3633018">}</span>
</div>
</body>
</html>
