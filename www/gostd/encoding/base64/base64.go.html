<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3704662">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3704717">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3704771">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3704822">//&nbsp;Package&nbsp;base64&nbsp;implements&nbsp;base64&nbsp;encoding&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3704893">package</span>&nbsp;<span class="ident" id="3704901">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3704909">import</span>&nbsp;<span class="op" id="3704916">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3704919">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3704928">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3704934">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3704945">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3704955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3704958">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encodings<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3704979">//&nbsp;An&nbsp;Encoding&nbsp;is&nbsp;a&nbsp;radix&nbsp;64&nbsp;encoding/decoding&nbsp;scheme,&nbsp;defined&nbsp;by&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="3705047">//&nbsp;64-character&nbsp;alphabet.&nbsp;&nbsp;The&nbsp;most&nbsp;common&nbsp;encoding&nbsp;is&nbsp;the&nbsp;&#34;base64&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3705115">//&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648&nbsp;and&nbsp;used&nbsp;in&nbsp;MIME&nbsp;(RFC&nbsp;2045)&nbsp;and&nbsp;PEM</span><br>
<span class="lineno"></span><span class="comment" id="3705183">//&nbsp;(RFC&nbsp;1421).&nbsp;&nbsp;RFC&nbsp;4648&nbsp;also&nbsp;defines&nbsp;an&nbsp;alternate&nbsp;encoding,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3705253">//&nbsp;the&nbsp;standard&nbsp;encoding&nbsp;with&nbsp;-&nbsp;and&nbsp;_&nbsp;substituted&nbsp;for&nbsp;+&nbsp;and&nbsp;/.</span><br>
<span class="lineno"></span><span class="keyword" id="3705316">type</span>&nbsp;<span class="ident" id="3705321">Encoding</span>&nbsp;<span class="keyword" id="3705330">struct</span>&nbsp;<span class="op" id="3705337">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705340">encode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3705350">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705358">decodeMap</span>&nbsp;<span class="op" id="3705368">[</span><span class="num" id="3705369">256</span><span class="op" id="3705372">]</span><span class="builtintype" id="3705373">byte</span><br>
<span class="lineno"></span><span class="op" id="3705378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3705381">const</span>&nbsp;<span class="ident" id="3705387">encodeStd</span>&nbsp;<span class="op" id="3705397">=</span>&nbsp;<span class="string" id="3705399">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span><br>
<span class="lineno">30</span><span class="keyword" id="3705466">const</span>&nbsp;<span class="ident" id="3705472">encodeURL</span>&nbsp;<span class="op" id="3705482">=</span>&nbsp;<span class="string" id="3705484">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3705552">//&nbsp;NewEncoding&nbsp;returns&nbsp;a&nbsp;new&nbsp;Encoding&nbsp;defined&nbsp;by&nbsp;the&nbsp;given&nbsp;alphabet,</span><br>
<span class="lineno"></span><span class="comment" id="3705621">//&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;64-byte&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3705656">func</span>&nbsp;<span class="ident" id="3705661">NewEncoding</span><span class="op" id="3705672">(</span><span class="ident" id="3705673">encoder</span>&nbsp;<span class="builtintype" id="3705681">string</span><span class="op" id="3705687">)</span>&nbsp;<span class="op" id="3705689">*</span><span class="ident" id="3705690">Encoding</span>&nbsp;<span class="op" id="3705699">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705702">e</span>&nbsp;<span class="op" id="3705704">:=</span>&nbsp;<span class="builtinfunc" id="3705707">new</span><span class="op" id="3705710">(</span><span class="ident" id="3705711">Encoding</span><span class="op" id="3705719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705722">e</span><span class="op" id="3705723">.</span><span class="ident" id="3705724">encode</span>&nbsp;<span class="op" id="3705731">=</span>&nbsp;<span class="ident" id="3705733">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705742">for</span>&nbsp;<span class="ident" id="3705746">i</span>&nbsp;<span class="op" id="3705748">:=</span>&nbsp;<span class="num" id="3705751">0</span><span class="op" id="3705752">;</span>&nbsp;<span class="ident" id="3705754">i</span>&nbsp;<span class="op" id="3705756">&lt;</span>&nbsp;<span class="builtinfunc" id="3705758">len</span><span class="op" id="3705761">(</span><span class="ident" id="3705762">e</span><span class="op" id="3705763">.</span><span class="ident" id="3705764">decodeMap</span><span class="op" id="3705773">)</span><span class="op" id="3705774">;</span>&nbsp;<span class="ident" id="3705776">i</span><span class="op" id="3705777">++</span>&nbsp;<span class="op" id="3705780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705784">e</span><span class="op" id="3705785">.</span><span class="ident" id="3705786">decodeMap</span><span class="op" id="3705795">[</span><span class="ident" id="3705796">i</span><span class="op" id="3705797">]</span>&nbsp;<span class="op" id="3705799">=</span>&nbsp;<span class="num" id="3705801">0xFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705807">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705810">for</span>&nbsp;<span class="ident" id="3705814">i</span>&nbsp;<span class="op" id="3705816">:=</span>&nbsp;<span class="num" id="3705819">0</span><span class="op" id="3705820">;</span>&nbsp;<span class="ident" id="3705822">i</span>&nbsp;<span class="op" id="3705824">&lt;</span>&nbsp;<span class="builtinfunc" id="3705826">len</span><span class="op" id="3705829">(</span><span class="ident" id="3705830">encoder</span><span class="op" id="3705837">)</span><span class="op" id="3705838">;</span>&nbsp;<span class="ident" id="3705840">i</span><span class="op" id="3705841">++</span>&nbsp;<span class="op" id="3705844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705848">e</span><span class="op" id="3705849">.</span><span class="ident" id="3705850">decodeMap</span><span class="op" id="3705859">[</span><span class="ident" id="3705860">encoder</span><span class="op" id="3705867">[</span><span class="ident" id="3705868">i</span><span class="op" id="3705869">]</span><span class="op" id="3705870">]</span>&nbsp;<span class="op" id="3705872">=</span>&nbsp;<span class="builtintype" id="3705874">byte</span><span class="op" id="3705878">(</span><span class="ident" id="3705879">i</span><span class="op" id="3705880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705886">return</span>&nbsp;<span class="ident" id="3705893">e</span><br>
<span class="lineno"></span><span class="op" id="3705895">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3705898">//&nbsp;StdEncoding&nbsp;is&nbsp;the&nbsp;standard&nbsp;base64&nbsp;encoding,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3705960">//&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3705973">var</span>&nbsp;<span class="ident" id="3705977">StdEncoding</span>&nbsp;<span class="op" id="3705989">=</span>&nbsp;<span class="ident" id="3705991">NewEncoding</span><span class="op" id="3706002">(</span><span class="ident" id="3706003">encodeStd</span><span class="op" id="3706012">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3706015">//&nbsp;URLEncoding&nbsp;is&nbsp;the&nbsp;alternate&nbsp;base64&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="comment" id="3706084">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;in&nbsp;URLs&nbsp;and&nbsp;file&nbsp;names.</span><br>
<span class="lineno"></span><span class="keyword" id="3706132">var</span>&nbsp;<span class="ident" id="3706136">URLEncoding</span>&nbsp;<span class="op" id="3706148">=</span>&nbsp;<span class="ident" id="3706150">NewEncoding</span><span class="op" id="3706161">(</span><span class="ident" id="3706162">encodeURL</span><span class="op" id="3706171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3706174">var</span>&nbsp;<span class="ident" id="3706178">removeNewlinesMapper</span>&nbsp;<span class="op" id="3706199">=</span>&nbsp;<span class="keyword" id="3706201">func</span><span class="op" id="3706205">(</span><span class="ident" id="3706206">r</span>&nbsp;<span class="builtintype" id="3706208">rune</span><span class="op" id="3706212">)</span>&nbsp;<span class="builtintype" id="3706214">rune</span>&nbsp;<span class="op" id="3706219">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706222">if</span>&nbsp;<span class="ident" id="3706225">r</span>&nbsp;<span class="op" id="3706227">==</span>&nbsp;<span class="string" id="3706230">&#39;\r&#39;</span>&nbsp;<span class="op" id="3706235">||</span>&nbsp;<span class="ident" id="3706238">r</span>&nbsp;<span class="op" id="3706240">==</span>&nbsp;<span class="string" id="3706243">&#39;\n&#39;</span>&nbsp;<span class="op" id="3706248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706252">return</span>&nbsp;<span class="op" id="3706259">-</span><span class="num" id="3706260">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706266">return</span>&nbsp;<span class="ident" id="3706273">r</span><br>
<span class="lineno"></span><span class="op" id="3706275">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3706278">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3706297">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc,&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="3706351">//&nbsp;EncodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="3706389">//</span><br>
<span class="lineno"></span><span class="comment" id="3706392">//&nbsp;The&nbsp;encoding&nbsp;pads&nbsp;the&nbsp;output&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;4&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3706450">//&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on&nbsp;individual&nbsp;blocks</span><br>
<span class="lineno">70</span><span class="comment" id="3706511">//&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3706565">func</span>&nbsp;<span class="op" id="3706570">(</span><span class="ident" id="3706571">enc</span>&nbsp;<span class="op" id="3706575">*</span><span class="ident" id="3706576">Encoding</span><span class="op" id="3706584">)</span>&nbsp;<span class="ident" id="3706586">Encode</span><span class="op" id="3706592">(</span><span class="ident" id="3706593">dst</span><span class="op" id="3706596">,</span>&nbsp;<span class="ident" id="3706598">src</span>&nbsp;<span class="op" id="3706602">[</span><span class="op" id="3706603">]</span><span class="builtintype" id="3706604">byte</span><span class="op" id="3706608">)</span>&nbsp;<span class="op" id="3706610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706613">if</span>&nbsp;<span class="builtinfunc" id="3706616">len</span><span class="op" id="3706619">(</span><span class="ident" id="3706620">src</span><span class="op" id="3706623">)</span>&nbsp;<span class="op" id="3706625">==</span>&nbsp;<span class="num" id="3706628">0</span>&nbsp;<span class="op" id="3706630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706634">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706642">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706646">for</span>&nbsp;<span class="builtinfunc" id="3706650">len</span><span class="op" id="3706653">(</span><span class="ident" id="3706654">src</span><span class="op" id="3706657">)</span>&nbsp;<span class="op" id="3706659">&gt;</span>&nbsp;<span class="num" id="3706661">0</span>&nbsp;<span class="op" id="3706663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706667">var</span>&nbsp;<span class="ident" id="3706671">b0</span><span class="op" id="3706673">,</span>&nbsp;<span class="ident" id="3706675">b1</span><span class="op" id="3706677">,</span>&nbsp;<span class="ident" id="3706679">b2</span><span class="op" id="3706681">,</span>&nbsp;<span class="ident" id="3706683">b3</span>&nbsp;<span class="builtintype" id="3706686">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706694">//&nbsp;Unpack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;a&nbsp;4&nbsp;byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706743">//&nbsp;destination&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706768">switch</span>&nbsp;<span class="builtinfunc" id="3706775">len</span><span class="op" id="3706778">(</span><span class="ident" id="3706779">src</span><span class="op" id="3706782">)</span>&nbsp;<span class="op" id="3706784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706788">default</span><span class="op" id="3706795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706800">b3</span>&nbsp;<span class="op" id="3706803">=</span>&nbsp;<span class="ident" id="3706805">src</span><span class="op" id="3706808">[</span><span class="num" id="3706809">2</span><span class="op" id="3706810">]</span>&nbsp;<span class="op" id="3706812">&amp;</span>&nbsp;<span class="num" id="3706814">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706822">b2</span>&nbsp;<span class="op" id="3706825">=</span>&nbsp;<span class="ident" id="3706827">src</span><span class="op" id="3706830">[</span><span class="num" id="3706831">2</span><span class="op" id="3706832">]</span>&nbsp;<span class="op" id="3706834">&gt;&gt;</span>&nbsp;<span class="num" id="3706837">6</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706842">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706856">case</span>&nbsp;<span class="num" id="3706861">2</span><span class="op" id="3706862">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706867">b2</span>&nbsp;<span class="op" id="3706870">|=</span>&nbsp;<span class="op" id="3706873">(</span><span class="ident" id="3706874">src</span><span class="op" id="3706877">[</span><span class="num" id="3706878">1</span><span class="op" id="3706879">]</span>&nbsp;<span class="op" id="3706881">&lt;&lt;</span>&nbsp;<span class="num" id="3706884">2</span><span class="op" id="3706885">)</span>&nbsp;<span class="op" id="3706887">&amp;</span>&nbsp;<span class="num" id="3706889">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706897">b1</span>&nbsp;<span class="op" id="3706900">=</span>&nbsp;<span class="ident" id="3706902">src</span><span class="op" id="3706905">[</span><span class="num" id="3706906">1</span><span class="op" id="3706907">]</span>&nbsp;<span class="op" id="3706909">&gt;&gt;</span>&nbsp;<span class="num" id="3706912">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706917">fallthrough</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706931">case</span>&nbsp;<span class="num" id="3706936">1</span><span class="op" id="3706937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706942">b1</span>&nbsp;<span class="op" id="3706945">|=</span>&nbsp;<span class="op" id="3706948">(</span><span class="ident" id="3706949">src</span><span class="op" id="3706952">[</span><span class="num" id="3706953">0</span><span class="op" id="3706954">]</span>&nbsp;<span class="op" id="3706956">&lt;&lt;</span>&nbsp;<span class="num" id="3706959">4</span><span class="op" id="3706960">)</span>&nbsp;<span class="op" id="3706962">&amp;</span>&nbsp;<span class="num" id="3706964">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706972">b0</span>&nbsp;<span class="op" id="3706975">=</span>&nbsp;<span class="ident" id="3706977">src</span><span class="op" id="3706980">[</span><span class="num" id="3706981">0</span><span class="op" id="3706982">]</span>&nbsp;<span class="op" id="3706984">&gt;&gt;</span>&nbsp;<span class="num" id="3706987">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706996">//&nbsp;Encode&nbsp;6-bit&nbsp;blocks&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707047">dst</span><span class="op" id="3707050">[</span><span class="num" id="3707051">0</span><span class="op" id="3707052">]</span>&nbsp;<span class="op" id="3707054">=</span>&nbsp;<span class="ident" id="3707056">enc</span><span class="op" id="3707059">.</span><span class="ident" id="3707060">encode</span><span class="op" id="3707066">[</span><span class="ident" id="3707067">b0</span><span class="op" id="3707069">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707073">dst</span><span class="op" id="3707076">[</span><span class="num" id="3707077">1</span><span class="op" id="3707078">]</span>&nbsp;<span class="op" id="3707080">=</span>&nbsp;<span class="ident" id="3707082">enc</span><span class="op" id="3707085">.</span><span class="ident" id="3707086">encode</span><span class="op" id="3707092">[</span><span class="ident" id="3707093">b1</span><span class="op" id="3707095">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707099">dst</span><span class="op" id="3707102">[</span><span class="num" id="3707103">2</span><span class="op" id="3707104">]</span>&nbsp;<span class="op" id="3707106">=</span>&nbsp;<span class="ident" id="3707108">enc</span><span class="op" id="3707111">.</span><span class="ident" id="3707112">encode</span><span class="op" id="3707118">[</span><span class="ident" id="3707119">b2</span><span class="op" id="3707121">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707125">dst</span><span class="op" id="3707128">[</span><span class="num" id="3707129">3</span><span class="op" id="3707130">]</span>&nbsp;<span class="op" id="3707132">=</span>&nbsp;<span class="ident" id="3707134">enc</span><span class="op" id="3707137">.</span><span class="ident" id="3707138">encode</span><span class="op" id="3707144">[</span><span class="ident" id="3707145">b3</span><span class="op" id="3707147">]</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707152">//&nbsp;Pad&nbsp;the&nbsp;final&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707179">if</span>&nbsp;<span class="builtinfunc" id="3707182">len</span><span class="op" id="3707185">(</span><span class="ident" id="3707186">src</span><span class="op" id="3707189">)</span>&nbsp;<span class="op" id="3707191">&lt;</span>&nbsp;<span class="num" id="3707193">3</span>&nbsp;<span class="op" id="3707195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707200">dst</span><span class="op" id="3707203">[</span><span class="num" id="3707204">3</span><span class="op" id="3707205">]</span>&nbsp;<span class="op" id="3707207">=</span>&nbsp;<span class="string" id="3707209">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707216">if</span>&nbsp;<span class="builtinfunc" id="3707219">len</span><span class="op" id="3707222">(</span><span class="ident" id="3707223">src</span><span class="op" id="3707226">)</span>&nbsp;<span class="op" id="3707228">&lt;</span>&nbsp;<span class="num" id="3707230">2</span>&nbsp;<span class="op" id="3707232">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707238">dst</span><span class="op" id="3707241">[</span><span class="num" id="3707242">2</span><span class="op" id="3707243">]</span>&nbsp;<span class="op" id="3707245">=</span>&nbsp;<span class="string" id="3707247">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707259">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707272">src</span>&nbsp;<span class="op" id="3707276">=</span>&nbsp;<span class="ident" id="3707278">src</span><span class="op" id="3707281">[</span><span class="num" id="3707282">3</span><span class="op" id="3707283">:</span><span class="op" id="3707284">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707288">dst</span>&nbsp;<span class="op" id="3707292">=</span>&nbsp;<span class="ident" id="3707294">dst</span><span class="op" id="3707297">[</span><span class="num" id="3707298">4</span><span class="op" id="3707299">:</span><span class="op" id="3707300">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707303">}</span><br>
<span class="lineno"></span><span class="op" id="3707305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="3707308">//&nbsp;EncodeToString&nbsp;returns&nbsp;the&nbsp;base64&nbsp;encoding&nbsp;of&nbsp;src.</span><br>
<span class="lineno"></span><span class="keyword" id="3707362">func</span>&nbsp;<span class="op" id="3707367">(</span><span class="ident" id="3707368">enc</span>&nbsp;<span class="op" id="3707372">*</span><span class="ident" id="3707373">Encoding</span><span class="op" id="3707381">)</span>&nbsp;<span class="ident" id="3707383">EncodeToString</span><span class="op" id="3707397">(</span><span class="ident" id="3707398">src</span>&nbsp;<span class="op" id="3707402">[</span><span class="op" id="3707403">]</span><span class="builtintype" id="3707404">byte</span><span class="op" id="3707408">)</span>&nbsp;<span class="builtintype" id="3707410">string</span>&nbsp;<span class="op" id="3707417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707420">buf</span>&nbsp;<span class="op" id="3707424">:=</span>&nbsp;<span class="builtinfunc" id="3707427">make</span><span class="op" id="3707431">(</span><span class="op" id="3707432">[</span><span class="op" id="3707433">]</span><span class="builtintype" id="3707434">byte</span><span class="op" id="3707438">,</span>&nbsp;<span class="ident" id="3707440">enc</span><span class="op" id="3707443">.</span><span class="ident" id="3707444">EncodedLen</span><span class="op" id="3707454">(</span><span class="builtinfunc" id="3707455">len</span><span class="op" id="3707458">(</span><span class="ident" id="3707459">src</span><span class="op" id="3707462">)</span><span class="op" id="3707463">)</span><span class="op" id="3707464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707467">enc</span><span class="op" id="3707470">.</span><span class="ident" id="3707471">Encode</span><span class="op" id="3707477">(</span><span class="ident" id="3707478">buf</span><span class="op" id="3707481">,</span>&nbsp;<span class="ident" id="3707483">src</span><span class="op" id="3707486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707489">return</span>&nbsp;<span class="builtintype" id="3707496">string</span><span class="op" id="3707502">(</span><span class="ident" id="3707503">buf</span><span class="op" id="3707506">)</span><br>
<span class="lineno">120</span><span class="op" id="3707508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3707511">type</span>&nbsp;<span class="ident" id="3707516">encoder</span>&nbsp;<span class="keyword" id="3707524">struct</span>&nbsp;<span class="op" id="3707531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707534">err</span>&nbsp;&nbsp;<span class="builtintype" id="3707539">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707546">enc</span>&nbsp;&nbsp;<span class="op" id="3707551">*</span><span class="ident" id="3707552">Encoding</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707562">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3707567">io</span><span class="op" id="3707569">.</span><span class="ident" id="3707570">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707578">buf</span>&nbsp;&nbsp;<span class="op" id="3707583">[</span><span class="num" id="3707584">3</span><span class="op" id="3707585">]</span><span class="builtintype" id="3707586">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707594">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707634">nbuf</span>&nbsp;<span class="builtintype" id="3707639">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3707650">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707677">out</span>&nbsp;&nbsp;<span class="op" id="3707682">[</span><span class="num" id="3707683">1024</span><span class="op" id="3707687">]</span><span class="builtintype" id="3707688">byte</span>&nbsp;<span class="comment" id="3707693">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="3707710">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="3707713">func</span>&nbsp;<span class="op" id="3707718">(</span><span class="ident" id="3707719">e</span>&nbsp;<span class="op" id="3707721">*</span><span class="ident" id="3707722">encoder</span><span class="op" id="3707729">)</span>&nbsp;<span class="ident" id="3707731">Write</span><span class="op" id="3707736">(</span><span class="ident" id="3707737">p</span>&nbsp;<span class="op" id="3707739">[</span><span class="op" id="3707740">]</span><span class="builtintype" id="3707741">byte</span><span class="op" id="3707745">)</span>&nbsp;<span class="op" id="3707747">(</span><span class="ident" id="3707748">n</span>&nbsp;<span class="builtintype" id="3707750">int</span><span class="op" id="3707753">,</span>&nbsp;<span class="ident" id="3707755">err</span>&nbsp;<span class="builtintype" id="3707759">error</span><span class="op" id="3707764">)</span>&nbsp;<span class="op" id="3707766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707769">if</span>&nbsp;<span class="ident" id="3707772">e</span><span class="op" id="3707773">.</span><span class="ident" id="3707774">err</span>&nbsp;<span class="op" id="3707778">!=</span>&nbsp;<span class="ident" id="3707781">nil</span>&nbsp;<span class="op" id="3707785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707789">return</span>&nbsp;<span class="num" id="3707796">0</span><span class="op" id="3707797">,</span>&nbsp;<span class="ident" id="3707799">e</span><span class="op" id="3707800">.</span><span class="ident" id="3707801">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707806">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707810">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707830">if</span>&nbsp;<span class="ident" id="3707833">e</span><span class="op" id="3707834">.</span><span class="ident" id="3707835">nbuf</span>&nbsp;<span class="op" id="3707840">&gt;</span>&nbsp;<span class="num" id="3707842">0</span>&nbsp;<span class="op" id="3707844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707848">var</span>&nbsp;<span class="ident" id="3707852">i</span>&nbsp;<span class="builtintype" id="3707854">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707860">for</span>&nbsp;<span class="ident" id="3707864">i</span>&nbsp;<span class="op" id="3707866">=</span>&nbsp;<span class="num" id="3707868">0</span><span class="op" id="3707869">;</span>&nbsp;<span class="ident" id="3707871">i</span>&nbsp;<span class="op" id="3707873">&lt;</span>&nbsp;<span class="builtinfunc" id="3707875">len</span><span class="op" id="3707878">(</span><span class="ident" id="3707879">p</span><span class="op" id="3707880">)</span>&nbsp;<span class="op" id="3707882">&amp;&amp;</span>&nbsp;<span class="ident" id="3707885">e</span><span class="op" id="3707886">.</span><span class="ident" id="3707887">nbuf</span>&nbsp;<span class="op" id="3707892">&lt;</span>&nbsp;<span class="num" id="3707894">3</span><span class="op" id="3707895">;</span>&nbsp;<span class="ident" id="3707897">i</span><span class="op" id="3707898">++</span>&nbsp;<span class="op" id="3707901">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707906">e</span><span class="op" id="3707907">.</span><span class="ident" id="3707908">buf</span><span class="op" id="3707911">[</span><span class="ident" id="3707912">e</span><span class="op" id="3707913">.</span><span class="ident" id="3707914">nbuf</span><span class="op" id="3707918">]</span>&nbsp;<span class="op" id="3707920">=</span>&nbsp;<span class="ident" id="3707922">p</span><span class="op" id="3707923">[</span><span class="ident" id="3707924">i</span><span class="op" id="3707925">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707930">e</span><span class="op" id="3707931">.</span><span class="ident" id="3707932">nbuf</span><span class="op" id="3707936">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707945">n</span>&nbsp;<span class="op" id="3707947">+=</span>&nbsp;<span class="ident" id="3707950">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707954">p</span>&nbsp;<span class="op" id="3707956">=</span>&nbsp;<span class="ident" id="3707958">p</span><span class="op" id="3707959">[</span><span class="ident" id="3707960">i</span><span class="op" id="3707961">:</span><span class="op" id="3707962">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707966">if</span>&nbsp;<span class="ident" id="3707969">e</span><span class="op" id="3707970">.</span><span class="ident" id="3707971">nbuf</span>&nbsp;<span class="op" id="3707976">&lt;</span>&nbsp;<span class="num" id="3707978">3</span>&nbsp;<span class="op" id="3707980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707985">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707998">e</span><span class="op" id="3707999">.</span><span class="ident" id="3708000">enc</span><span class="op" id="3708003">.</span><span class="ident" id="3708004">Encode</span><span class="op" id="3708010">(</span><span class="ident" id="3708011">e</span><span class="op" id="3708012">.</span><span class="ident" id="3708013">out</span><span class="op" id="3708016">[</span><span class="num" id="3708017">0</span><span class="op" id="3708018">:</span><span class="op" id="3708019">]</span><span class="op" id="3708020">,</span>&nbsp;<span class="ident" id="3708022">e</span><span class="op" id="3708023">.</span><span class="ident" id="3708024">buf</span><span class="op" id="3708027">[</span><span class="num" id="3708028">0</span><span class="op" id="3708029">:</span><span class="op" id="3708030">]</span><span class="op" id="3708031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708035">if</span>&nbsp;<span class="ident" id="3708038">_</span><span class="op" id="3708039">,</span>&nbsp;<span class="ident" id="3708041">e</span><span class="op" id="3708042">.</span><span class="ident" id="3708043">err</span>&nbsp;<span class="op" id="3708047">=</span>&nbsp;<span class="ident" id="3708049">e</span><span class="op" id="3708050">.</span><span class="ident" id="3708051">w</span><span class="op" id="3708052">.</span><span class="ident" id="3708053">Write</span><span class="op" id="3708058">(</span><span class="ident" id="3708059">e</span><span class="op" id="3708060">.</span><span class="ident" id="3708061">out</span><span class="op" id="3708064">[</span><span class="num" id="3708065">0</span><span class="op" id="3708066">:</span><span class="num" id="3708067">4</span><span class="op" id="3708068">]</span><span class="op" id="3708069">)</span><span class="op" id="3708070">;</span>&nbsp;<span class="ident" id="3708072">e</span><span class="op" id="3708073">.</span><span class="ident" id="3708074">err</span>&nbsp;<span class="op" id="3708078">!=</span>&nbsp;<span class="ident" id="3708081">nil</span>&nbsp;<span class="op" id="3708085">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708090">return</span>&nbsp;<span class="ident" id="3708097">n</span><span class="op" id="3708098">,</span>&nbsp;<span class="ident" id="3708100">e</span><span class="op" id="3708101">.</span><span class="ident" id="3708102">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708112">e</span><span class="op" id="3708113">.</span><span class="ident" id="3708114">nbuf</span>&nbsp;<span class="op" id="3708119">=</span>&nbsp;<span class="num" id="3708121">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708128">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708155">for</span>&nbsp;<span class="builtinfunc" id="3708159">len</span><span class="op" id="3708162">(</span><span class="ident" id="3708163">p</span><span class="op" id="3708164">)</span>&nbsp;<span class="op" id="3708166">&gt;=</span>&nbsp;<span class="num" id="3708169">3</span>&nbsp;<span class="op" id="3708171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708175">nn</span>&nbsp;<span class="op" id="3708178">:=</span>&nbsp;<span class="builtinfunc" id="3708181">len</span><span class="op" id="3708184">(</span><span class="ident" id="3708185">e</span><span class="op" id="3708186">.</span><span class="ident" id="3708187">out</span><span class="op" id="3708190">)</span>&nbsp;<span class="op" id="3708192">/</span>&nbsp;<span class="num" id="3708194">4</span>&nbsp;<span class="op" id="3708196">*</span>&nbsp;<span class="num" id="3708198">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708202">if</span>&nbsp;<span class="ident" id="3708205">nn</span>&nbsp;<span class="op" id="3708208">&gt;</span>&nbsp;<span class="builtinfunc" id="3708210">len</span><span class="op" id="3708213">(</span><span class="ident" id="3708214">p</span><span class="op" id="3708215">)</span>&nbsp;<span class="op" id="3708217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708222">nn</span>&nbsp;<span class="op" id="3708225">=</span>&nbsp;<span class="builtinfunc" id="3708227">len</span><span class="op" id="3708230">(</span><span class="ident" id="3708231">p</span><span class="op" id="3708232">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708237">nn</span>&nbsp;<span class="op" id="3708240">-=</span>&nbsp;<span class="ident" id="3708243">nn</span>&nbsp;<span class="op" id="3708246">%</span>&nbsp;<span class="num" id="3708248">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708256">e</span><span class="op" id="3708257">.</span><span class="ident" id="3708258">enc</span><span class="op" id="3708261">.</span><span class="ident" id="3708262">Encode</span><span class="op" id="3708268">(</span><span class="ident" id="3708269">e</span><span class="op" id="3708270">.</span><span class="ident" id="3708271">out</span><span class="op" id="3708274">[</span><span class="num" id="3708275">0</span><span class="op" id="3708276">:</span><span class="op" id="3708277">]</span><span class="op" id="3708278">,</span>&nbsp;<span class="ident" id="3708280">p</span><span class="op" id="3708281">[</span><span class="num" id="3708282">0</span><span class="op" id="3708283">:</span><span class="ident" id="3708284">nn</span><span class="op" id="3708286">]</span><span class="op" id="3708287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708291">if</span>&nbsp;<span class="ident" id="3708294">_</span><span class="op" id="3708295">,</span>&nbsp;<span class="ident" id="3708297">e</span><span class="op" id="3708298">.</span><span class="ident" id="3708299">err</span>&nbsp;<span class="op" id="3708303">=</span>&nbsp;<span class="ident" id="3708305">e</span><span class="op" id="3708306">.</span><span class="ident" id="3708307">w</span><span class="op" id="3708308">.</span><span class="ident" id="3708309">Write</span><span class="op" id="3708314">(</span><span class="ident" id="3708315">e</span><span class="op" id="3708316">.</span><span class="ident" id="3708317">out</span><span class="op" id="3708320">[</span><span class="num" id="3708321">0</span>&nbsp;<span class="op" id="3708323">:</span>&nbsp;<span class="ident" id="3708325">nn</span><span class="op" id="3708327">/</span><span class="num" id="3708328">3</span><span class="op" id="3708329">*</span><span class="num" id="3708330">4</span><span class="op" id="3708331">]</span><span class="op" id="3708332">)</span><span class="op" id="3708333">;</span>&nbsp;<span class="ident" id="3708335">e</span><span class="op" id="3708336">.</span><span class="ident" id="3708337">err</span>&nbsp;<span class="op" id="3708341">!=</span>&nbsp;<span class="ident" id="3708344">nil</span>&nbsp;<span class="op" id="3708348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708353">return</span>&nbsp;<span class="ident" id="3708360">n</span><span class="op" id="3708361">,</span>&nbsp;<span class="ident" id="3708363">e</span><span class="op" id="3708364">.</span><span class="ident" id="3708365">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708375">n</span>&nbsp;<span class="op" id="3708377">+=</span>&nbsp;<span class="ident" id="3708380">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708385">p</span>&nbsp;<span class="op" id="3708387">=</span>&nbsp;<span class="ident" id="3708389">p</span><span class="op" id="3708390">[</span><span class="ident" id="3708391">nn</span><span class="op" id="3708393">:</span><span class="op" id="3708394">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708401">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708422">for</span>&nbsp;<span class="ident" id="3708426">i</span>&nbsp;<span class="op" id="3708428">:=</span>&nbsp;<span class="num" id="3708431">0</span><span class="op" id="3708432">;</span>&nbsp;<span class="ident" id="3708434">i</span>&nbsp;<span class="op" id="3708436">&lt;</span>&nbsp;<span class="builtinfunc" id="3708438">len</span><span class="op" id="3708441">(</span><span class="ident" id="3708442">p</span><span class="op" id="3708443">)</span><span class="op" id="3708444">;</span>&nbsp;<span class="ident" id="3708446">i</span><span class="op" id="3708447">++</span>&nbsp;<span class="op" id="3708450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708454">e</span><span class="op" id="3708455">.</span><span class="ident" id="3708456">buf</span><span class="op" id="3708459">[</span><span class="ident" id="3708460">i</span><span class="op" id="3708461">]</span>&nbsp;<span class="op" id="3708463">=</span>&nbsp;<span class="ident" id="3708465">p</span><span class="op" id="3708466">[</span><span class="ident" id="3708467">i</span><span class="op" id="3708468">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708474">e</span><span class="op" id="3708475">.</span><span class="ident" id="3708476">nbuf</span>&nbsp;<span class="op" id="3708481">=</span>&nbsp;<span class="builtinfunc" id="3708483">len</span><span class="op" id="3708486">(</span><span class="ident" id="3708487">p</span><span class="op" id="3708488">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708491">n</span>&nbsp;<span class="op" id="3708493">+=</span>&nbsp;<span class="builtinfunc" id="3708496">len</span><span class="op" id="3708499">(</span><span class="ident" id="3708500">p</span><span class="op" id="3708501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708504">return</span><br>
<span class="lineno"></span><span class="op" id="3708511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3708514">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno">180</span><span class="comment" id="3708568">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3708621">func</span>&nbsp;<span class="op" id="3708626">(</span><span class="ident" id="3708627">e</span>&nbsp;<span class="op" id="3708629">*</span><span class="ident" id="3708630">encoder</span><span class="op" id="3708637">)</span>&nbsp;<span class="ident" id="3708639">Close</span><span class="op" id="3708644">(</span><span class="op" id="3708645">)</span>&nbsp;<span class="builtintype" id="3708647">error</span>&nbsp;<span class="op" id="3708653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708656">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708713">if</span>&nbsp;<span class="ident" id="3708716">e</span><span class="op" id="3708717">.</span><span class="ident" id="3708718">err</span>&nbsp;<span class="op" id="3708722">==</span>&nbsp;<span class="ident" id="3708725">nil</span>&nbsp;<span class="op" id="3708729">&amp;&amp;</span>&nbsp;<span class="ident" id="3708732">e</span><span class="op" id="3708733">.</span><span class="ident" id="3708734">nbuf</span>&nbsp;<span class="op" id="3708739">&gt;</span>&nbsp;<span class="num" id="3708741">0</span>&nbsp;<span class="op" id="3708743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708747">e</span><span class="op" id="3708748">.</span><span class="ident" id="3708749">enc</span><span class="op" id="3708752">.</span><span class="ident" id="3708753">Encode</span><span class="op" id="3708759">(</span><span class="ident" id="3708760">e</span><span class="op" id="3708761">.</span><span class="ident" id="3708762">out</span><span class="op" id="3708765">[</span><span class="num" id="3708766">0</span><span class="op" id="3708767">:</span><span class="op" id="3708768">]</span><span class="op" id="3708769">,</span>&nbsp;<span class="ident" id="3708771">e</span><span class="op" id="3708772">.</span><span class="ident" id="3708773">buf</span><span class="op" id="3708776">[</span><span class="num" id="3708777">0</span><span class="op" id="3708778">:</span><span class="ident" id="3708779">e</span><span class="op" id="3708780">.</span><span class="ident" id="3708781">nbuf</span><span class="op" id="3708785">]</span><span class="op" id="3708786">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708790">e</span><span class="op" id="3708791">.</span><span class="ident" id="3708792">nbuf</span>&nbsp;<span class="op" id="3708797">=</span>&nbsp;<span class="num" id="3708799">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708803">_</span><span class="op" id="3708804">,</span>&nbsp;<span class="ident" id="3708806">e</span><span class="op" id="3708807">.</span><span class="ident" id="3708808">err</span>&nbsp;<span class="op" id="3708812">=</span>&nbsp;<span class="ident" id="3708814">e</span><span class="op" id="3708815">.</span><span class="ident" id="3708816">w</span><span class="op" id="3708817">.</span><span class="ident" id="3708818">Write</span><span class="op" id="3708823">(</span><span class="ident" id="3708824">e</span><span class="op" id="3708825">.</span><span class="ident" id="3708826">out</span><span class="op" id="3708829">[</span><span class="num" id="3708830">0</span><span class="op" id="3708831">:</span><span class="num" id="3708832">4</span><span class="op" id="3708833">]</span><span class="op" id="3708834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708840">return</span>&nbsp;<span class="ident" id="3708847">e</span><span class="op" id="3708848">.</span><span class="ident" id="3708849">err</span><br>
<span class="lineno"></span><span class="op" id="3708853">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="3708856">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3708924">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;using&nbsp;enc&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3708996">//&nbsp;Base64&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;4-byte&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="3709056">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno">195</span><span class="comment" id="3709124">//&nbsp;partially&nbsp;written&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="3709153">func</span>&nbsp;<span class="ident" id="3709158">NewEncoder</span><span class="op" id="3709168">(</span><span class="ident" id="3709169">enc</span>&nbsp;<span class="op" id="3709173">*</span><span class="ident" id="3709174">Encoding</span><span class="op" id="3709182">,</span>&nbsp;<span class="ident" id="3709184">w</span>&nbsp;<span class="ident" id="3709186">io</span><span class="op" id="3709188">.</span><span class="ident" id="3709189">Writer</span><span class="op" id="3709195">)</span>&nbsp;<span class="ident" id="3709197">io</span><span class="op" id="3709199">.</span><span class="ident" id="3709200">WriteCloser</span>&nbsp;<span class="op" id="3709212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709215">return</span>&nbsp;<span class="op" id="3709222">&amp;</span><span class="ident" id="3709223">encoder</span><span class="op" id="3709230">{</span><span class="ident" id="3709231">enc</span><span class="op" id="3709234">:</span>&nbsp;<span class="ident" id="3709236">enc</span><span class="op" id="3709239">,</span>&nbsp;<span class="ident" id="3709241">w</span><span class="op" id="3709242">:</span>&nbsp;<span class="ident" id="3709244">w</span><span class="op" id="3709245">}</span><br>
<span class="lineno"></span><span class="op" id="3709247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3709250">//&nbsp;EncodedLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;base64&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="3709315">//&nbsp;of&nbsp;an&nbsp;input&nbsp;buffer&nbsp;of&nbsp;length&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="3709350">func</span>&nbsp;<span class="op" id="3709355">(</span><span class="ident" id="3709356">enc</span>&nbsp;<span class="op" id="3709360">*</span><span class="ident" id="3709361">Encoding</span><span class="op" id="3709369">)</span>&nbsp;<span class="ident" id="3709371">EncodedLen</span><span class="op" id="3709381">(</span><span class="ident" id="3709382">n</span>&nbsp;<span class="builtintype" id="3709384">int</span><span class="op" id="3709387">)</span>&nbsp;<span class="builtintype" id="3709389">int</span>&nbsp;<span class="op" id="3709393">{</span>&nbsp;<span class="keyword" id="3709395">return</span>&nbsp;<span class="op" id="3709402">(</span><span class="ident" id="3709403">n</span>&nbsp;<span class="op" id="3709405">+</span>&nbsp;<span class="num" id="3709407">2</span><span class="op" id="3709408">)</span>&nbsp;<span class="op" id="3709410">/</span>&nbsp;<span class="num" id="3709412">3</span>&nbsp;<span class="op" id="3709414">*</span>&nbsp;<span class="num" id="3709416">4</span>&nbsp;<span class="op" id="3709418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3709421">/*<br>
<span class="lineno">205</span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3709440">type</span>&nbsp;<span class="ident" id="3709445">CorruptInputError</span>&nbsp;<span class="ident" id="3709463">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3709470">func</span>&nbsp;<span class="op" id="3709475">(</span><span class="ident" id="3709476">e</span>&nbsp;<span class="ident" id="3709478">CorruptInputError</span><span class="op" id="3709495">)</span>&nbsp;<span class="ident" id="3709497">Error</span><span class="op" id="3709502">(</span><span class="op" id="3709503">)</span>&nbsp;<span class="builtintype" id="3709505">string</span>&nbsp;<span class="op" id="3709512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709515">return</span>&nbsp;<span class="string" id="3709522">&#34;illegal&nbsp;base64&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="3709559">+</span>&nbsp;<span class="ident" id="3709561">strconv</span><span class="op" id="3709568">.</span><span class="ident" id="3709569">FormatInt</span><span class="op" id="3709578">(</span><span class="ident" id="3709579">int64</span><span class="op" id="3709584">(</span><span class="ident" id="3709585">e</span><span class="op" id="3709586">)</span><span class="op" id="3709587">,</span>&nbsp;<span class="num" id="3709589">10</span><span class="op" id="3709591">)</span><br>
<span class="lineno"></span><span class="op" id="3709593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3709596">//&nbsp;decode&nbsp;is&nbsp;like&nbsp;Decode&nbsp;but&nbsp;returns&nbsp;an&nbsp;additional&nbsp;&#39;end&#39;&nbsp;value,&nbsp;which</span><br>
<span class="lineno">215</span><span class="comment" id="3709666">//&nbsp;indicates&nbsp;if&nbsp;end-of-message&nbsp;padding&nbsp;was&nbsp;encountered&nbsp;and&nbsp;thus&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="3709734">//&nbsp;additional&nbsp;data&nbsp;is&nbsp;an&nbsp;error.&nbsp;This&nbsp;method&nbsp;assumes&nbsp;that&nbsp;src&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="3709804">//&nbsp;stripped&nbsp;of&nbsp;all&nbsp;supported&nbsp;whitespace&nbsp;(&#39;\r&#39;&nbsp;and&nbsp;&#39;\n&#39;).</span><br>
<span class="lineno"></span><span class="keyword" id="3709861">func</span>&nbsp;<span class="op" id="3709866">(</span><span class="ident" id="3709867">enc</span>&nbsp;<span class="op" id="3709871">*</span><span class="ident" id="3709872">Encoding</span><span class="op" id="3709880">)</span>&nbsp;<span class="ident" id="3709882">decode</span><span class="op" id="3709888">(</span><span class="ident" id="3709889">dst</span><span class="op" id="3709892">,</span>&nbsp;<span class="ident" id="3709894">src</span>&nbsp;<span class="op" id="3709898">[</span><span class="op" id="3709899">]</span><span class="builtintype" id="3709900">byte</span><span class="op" id="3709904">)</span>&nbsp;<span class="op" id="3709906">(</span><span class="ident" id="3709907">n</span>&nbsp;<span class="builtintype" id="3709909">int</span><span class="op" id="3709912">,</span>&nbsp;<span class="ident" id="3709914">end</span>&nbsp;<span class="builtintype" id="3709918">bool</span><span class="op" id="3709922">,</span>&nbsp;<span class="ident" id="3709924">err</span>&nbsp;<span class="builtintype" id="3709928">error</span><span class="op" id="3709933">)</span>&nbsp;<span class="op" id="3709935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709938">olen</span>&nbsp;<span class="op" id="3709943">:=</span>&nbsp;<span class="builtinfunc" id="3709946">len</span><span class="op" id="3709949">(</span><span class="ident" id="3709950">src</span><span class="op" id="3709953">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709956">for</span>&nbsp;<span class="builtinfunc" id="3709960">len</span><span class="op" id="3709963">(</span><span class="ident" id="3709964">src</span><span class="op" id="3709967">)</span>&nbsp;<span class="op" id="3709969">&gt;</span>&nbsp;<span class="num" id="3709971">0</span>&nbsp;<span class="op" id="3709973">&amp;&amp;</span>&nbsp;<span class="op" id="3709976">!</span><span class="ident" id="3709977">end</span>&nbsp;<span class="op" id="3709981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709985">//&nbsp;Decode&nbsp;quantum&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710031">var</span>&nbsp;<span class="ident" id="3710035">dbuf</span>&nbsp;<span class="op" id="3710040">[</span><span class="num" id="3710041">4</span><span class="op" id="3710042">]</span><span class="builtintype" id="3710043">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710050">dlen</span>&nbsp;<span class="op" id="3710055">:=</span>&nbsp;<span class="num" id="3710058">4</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710063">for</span>&nbsp;<span class="ident" id="3710067">j</span>&nbsp;<span class="op" id="3710069">:=</span>&nbsp;<span class="keyword" id="3710072">range</span>&nbsp;<span class="ident" id="3710078">dbuf</span>&nbsp;<span class="op" id="3710083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710088">if</span>&nbsp;<span class="builtinfunc" id="3710091">len</span><span class="op" id="3710094">(</span><span class="ident" id="3710095">src</span><span class="op" id="3710098">)</span>&nbsp;<span class="op" id="3710100">==</span>&nbsp;<span class="num" id="3710103">0</span>&nbsp;<span class="op" id="3710105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710111">return</span>&nbsp;<span class="ident" id="3710118">n</span><span class="op" id="3710119">,</span>&nbsp;<span class="builtintype" id="3710121">false</span><span class="op" id="3710126">,</span>&nbsp;<span class="ident" id="3710128">CorruptInputError</span><span class="op" id="3710145">(</span><span class="ident" id="3710146">olen</span>&nbsp;<span class="op" id="3710151">-</span>&nbsp;<span class="builtinfunc" id="3710153">len</span><span class="op" id="3710156">(</span><span class="ident" id="3710157">src</span><span class="op" id="3710160">)</span>&nbsp;<span class="op" id="3710162">-</span>&nbsp;<span class="ident" id="3710164">j</span><span class="op" id="3710165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710175">in</span>&nbsp;<span class="op" id="3710178">:=</span>&nbsp;<span class="ident" id="3710181">src</span><span class="op" id="3710184">[</span><span class="num" id="3710185">0</span><span class="op" id="3710186">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710191">src</span>&nbsp;<span class="op" id="3710195">=</span>&nbsp;<span class="ident" id="3710197">src</span><span class="op" id="3710200">[</span><span class="num" id="3710201">1</span><span class="op" id="3710202">:</span><span class="op" id="3710203">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710208">if</span>&nbsp;<span class="ident" id="3710211">in</span>&nbsp;<span class="op" id="3710214">==</span>&nbsp;<span class="string" id="3710217">&#39;=&#39;</span>&nbsp;<span class="op" id="3710221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3710227">//&nbsp;We&#39;ve&nbsp;reached&nbsp;the&nbsp;end&nbsp;and&nbsp;there&#39;s&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710276">switch</span>&nbsp;<span class="ident" id="3710283">j</span>&nbsp;<span class="op" id="3710285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710291">case</span>&nbsp;<span class="num" id="3710296">0</span><span class="op" id="3710297">,</span>&nbsp;<span class="num" id="3710299">1</span><span class="op" id="3710300">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3710307">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710333">return</span>&nbsp;<span class="ident" id="3710340">n</span><span class="op" id="3710341">,</span>&nbsp;<span class="builtintype" id="3710343">false</span><span class="op" id="3710348">,</span>&nbsp;<span class="ident" id="3710350">CorruptInputError</span><span class="op" id="3710367">(</span><span class="ident" id="3710368">olen</span>&nbsp;<span class="op" id="3710373">-</span>&nbsp;<span class="builtinfunc" id="3710375">len</span><span class="op" id="3710378">(</span><span class="ident" id="3710379">src</span><span class="op" id="3710382">)</span>&nbsp;<span class="op" id="3710384">-</span>&nbsp;<span class="num" id="3710386">1</span><span class="op" id="3710387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710393">case</span>&nbsp;<span class="num" id="3710398">2</span><span class="op" id="3710399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3710406">//&nbsp;&#34;==&#34;&nbsp;is&nbsp;expected,&nbsp;the&nbsp;first&nbsp;&#34;=&#34;&nbsp;is&nbsp;already&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710467">if</span>&nbsp;<span class="builtinfunc" id="3710470">len</span><span class="op" id="3710473">(</span><span class="ident" id="3710474">src</span><span class="op" id="3710477">)</span>&nbsp;<span class="op" id="3710479">==</span>&nbsp;<span class="num" id="3710482">0</span>&nbsp;<span class="op" id="3710484">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3710492">//&nbsp;not&nbsp;enough&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710520">return</span>&nbsp;<span class="ident" id="3710527">n</span><span class="op" id="3710528">,</span>&nbsp;<span class="builtintype" id="3710530">false</span><span class="op" id="3710535">,</span>&nbsp;<span class="ident" id="3710537">CorruptInputError</span><span class="op" id="3710554">(</span><span class="ident" id="3710555">olen</span><span class="op" id="3710559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710573">if</span>&nbsp;<span class="ident" id="3710576">src</span><span class="op" id="3710579">[</span><span class="num" id="3710580">0</span><span class="op" id="3710581">]</span>&nbsp;<span class="op" id="3710583">!=</span>&nbsp;<span class="string" id="3710586">&#39;=&#39;</span>&nbsp;<span class="op" id="3710590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3710598">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710625">return</span>&nbsp;<span class="ident" id="3710632">n</span><span class="op" id="3710633">,</span>&nbsp;<span class="builtintype" id="3710635">false</span><span class="op" id="3710640">,</span>&nbsp;<span class="ident" id="3710642">CorruptInputError</span><span class="op" id="3710659">(</span><span class="ident" id="3710660">olen</span>&nbsp;<span class="op" id="3710665">-</span>&nbsp;<span class="builtinfunc" id="3710667">len</span><span class="op" id="3710670">(</span><span class="ident" id="3710671">src</span><span class="op" id="3710674">)</span>&nbsp;<span class="op" id="3710676">-</span>&nbsp;<span class="num" id="3710678">1</span><span class="op" id="3710679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710693">src</span>&nbsp;<span class="op" id="3710697">=</span>&nbsp;<span class="ident" id="3710699">src</span><span class="op" id="3710702">[</span><span class="num" id="3710703">1</span><span class="op" id="3710704">:</span><span class="op" id="3710705">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710717">if</span>&nbsp;<span class="builtinfunc" id="3710720">len</span><span class="op" id="3710723">(</span><span class="ident" id="3710724">src</span><span class="op" id="3710727">)</span>&nbsp;<span class="op" id="3710729">&gt;</span>&nbsp;<span class="num" id="3710731">0</span>&nbsp;<span class="op" id="3710733">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3710740">//&nbsp;trailing&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710765">err</span>&nbsp;<span class="op" id="3710769">=</span>&nbsp;<span class="ident" id="3710771">CorruptInputError</span><span class="op" id="3710788">(</span><span class="ident" id="3710789">olen</span>&nbsp;<span class="op" id="3710794">-</span>&nbsp;<span class="builtinfunc" id="3710796">len</span><span class="op" id="3710799">(</span><span class="ident" id="3710800">src</span><span class="op" id="3710803">)</span><span class="op" id="3710804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710816">dlen</span><span class="op" id="3710820">,</span>&nbsp;<span class="ident" id="3710822">end</span>&nbsp;<span class="op" id="3710826">=</span>&nbsp;<span class="ident" id="3710828">j</span><span class="op" id="3710829">,</span>&nbsp;<span class="builtintype" id="3710831">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710840">break</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710854">dbuf</span><span class="op" id="3710858">[</span><span class="ident" id="3710859">j</span><span class="op" id="3710860">]</span>&nbsp;<span class="op" id="3710862">=</span>&nbsp;<span class="ident" id="3710864">enc</span><span class="op" id="3710867">.</span><span class="ident" id="3710868">decodeMap</span><span class="op" id="3710877">[</span><span class="ident" id="3710878">in</span><span class="op" id="3710880">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710885">if</span>&nbsp;<span class="ident" id="3710888">dbuf</span><span class="op" id="3710892">[</span><span class="ident" id="3710893">j</span><span class="op" id="3710894">]</span>&nbsp;<span class="op" id="3710896">==</span>&nbsp;<span class="num" id="3710899">0xFF</span>&nbsp;<span class="op" id="3710904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710910">return</span>&nbsp;<span class="ident" id="3710917">n</span><span class="op" id="3710918">,</span>&nbsp;<span class="builtintype" id="3710920">false</span><span class="op" id="3710925">,</span>&nbsp;<span class="ident" id="3710927">CorruptInputError</span><span class="op" id="3710944">(</span><span class="ident" id="3710945">olen</span>&nbsp;<span class="op" id="3710950">-</span>&nbsp;<span class="builtinfunc" id="3710952">len</span><span class="op" id="3710955">(</span><span class="ident" id="3710956">src</span><span class="op" id="3710959">)</span>&nbsp;<span class="op" id="3710961">-</span>&nbsp;<span class="num" id="3710963">1</span><span class="op" id="3710964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710969">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3710978">//&nbsp;Pack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;3&nbsp;byte&nbsp;destination</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3711035">//&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711048">switch</span>&nbsp;<span class="ident" id="3711055">dlen</span>&nbsp;<span class="op" id="3711060">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711064">case</span>&nbsp;<span class="num" id="3711069">4</span><span class="op" id="3711070">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711075">dst</span><span class="op" id="3711078">[</span><span class="num" id="3711079">2</span><span class="op" id="3711080">]</span>&nbsp;<span class="op" id="3711082">=</span>&nbsp;<span class="ident" id="3711084">dbuf</span><span class="op" id="3711088">[</span><span class="num" id="3711089">2</span><span class="op" id="3711090">]</span><span class="op" id="3711091">&lt;&lt;</span><span class="num" id="3711093">6</span>&nbsp;<span class="op" id="3711095">|</span>&nbsp;<span class="ident" id="3711097">dbuf</span><span class="op" id="3711101">[</span><span class="num" id="3711102">3</span><span class="op" id="3711103">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711108">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711122">case</span>&nbsp;<span class="num" id="3711127">3</span><span class="op" id="3711128">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711133">dst</span><span class="op" id="3711136">[</span><span class="num" id="3711137">1</span><span class="op" id="3711138">]</span>&nbsp;<span class="op" id="3711140">=</span>&nbsp;<span class="ident" id="3711142">dbuf</span><span class="op" id="3711146">[</span><span class="num" id="3711147">1</span><span class="op" id="3711148">]</span><span class="op" id="3711149">&lt;&lt;</span><span class="num" id="3711151">4</span>&nbsp;<span class="op" id="3711153">|</span>&nbsp;<span class="ident" id="3711155">dbuf</span><span class="op" id="3711159">[</span><span class="num" id="3711160">2</span><span class="op" id="3711161">]</span><span class="op" id="3711162">&gt;&gt;</span><span class="num" id="3711164">2</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711169">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711183">case</span>&nbsp;<span class="num" id="3711188">2</span><span class="op" id="3711189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711194">dst</span><span class="op" id="3711197">[</span><span class="num" id="3711198">0</span><span class="op" id="3711199">]</span>&nbsp;<span class="op" id="3711201">=</span>&nbsp;<span class="ident" id="3711203">dbuf</span><span class="op" id="3711207">[</span><span class="num" id="3711208">0</span><span class="op" id="3711209">]</span><span class="op" id="3711210">&lt;&lt;</span><span class="num" id="3711212">2</span>&nbsp;<span class="op" id="3711214">|</span>&nbsp;<span class="ident" id="3711216">dbuf</span><span class="op" id="3711220">[</span><span class="num" id="3711221">1</span><span class="op" id="3711222">]</span><span class="op" id="3711223">&gt;&gt;</span><span class="num" id="3711225">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3711229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711233">dst</span>&nbsp;<span class="op" id="3711237">=</span>&nbsp;<span class="ident" id="3711239">dst</span><span class="op" id="3711242">[</span><span class="num" id="3711243">3</span><span class="op" id="3711244">:</span><span class="op" id="3711245">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711249">n</span>&nbsp;<span class="op" id="3711251">+=</span>&nbsp;<span class="ident" id="3711254">dlen</span>&nbsp;<span class="op" id="3711259">-</span>&nbsp;<span class="num" id="3711261">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3711264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711268">return</span>&nbsp;<span class="ident" id="3711275">n</span><span class="op" id="3711276">,</span>&nbsp;<span class="ident" id="3711278">end</span><span class="op" id="3711281">,</span>&nbsp;<span class="ident" id="3711283">err</span><br>
<span class="lineno"></span><span class="op" id="3711287">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3711290">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc.&nbsp;&nbsp;It&nbsp;writes&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="3711355">//&nbsp;DecodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span><span class="comment" id="3711424">//&nbsp;written.&nbsp;&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;base64&nbsp;data,&nbsp;it&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3711493">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;CorruptInputError.</span><br>
<span class="lineno">285</span><span class="comment" id="3711556">//&nbsp;New&nbsp;line&nbsp;characters&nbsp;(\r&nbsp;and&nbsp;\n)&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3711604">func</span>&nbsp;<span class="op" id="3711609">(</span><span class="ident" id="3711610">enc</span>&nbsp;<span class="op" id="3711614">*</span><span class="ident" id="3711615">Encoding</span><span class="op" id="3711623">)</span>&nbsp;<span class="ident" id="3711625">Decode</span><span class="op" id="3711631">(</span><span class="ident" id="3711632">dst</span><span class="op" id="3711635">,</span>&nbsp;<span class="ident" id="3711637">src</span>&nbsp;<span class="op" id="3711641">[</span><span class="op" id="3711642">]</span><span class="builtintype" id="3711643">byte</span><span class="op" id="3711647">)</span>&nbsp;<span class="op" id="3711649">(</span><span class="ident" id="3711650">n</span>&nbsp;<span class="builtintype" id="3711652">int</span><span class="op" id="3711655">,</span>&nbsp;<span class="ident" id="3711657">err</span>&nbsp;<span class="builtintype" id="3711661">error</span><span class="op" id="3711666">)</span>&nbsp;<span class="op" id="3711668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711671">src</span>&nbsp;<span class="op" id="3711675">=</span>&nbsp;<span class="ident" id="3711677">bytes</span><span class="op" id="3711682">.</span><span class="ident" id="3711683">Map</span><span class="op" id="3711686">(</span><span class="ident" id="3711687">removeNewlinesMapper</span><span class="op" id="3711707">,</span>&nbsp;<span class="ident" id="3711709">src</span><span class="op" id="3711712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711715">n</span><span class="op" id="3711716">,</span>&nbsp;<span class="ident" id="3711718">_</span><span class="op" id="3711719">,</span>&nbsp;<span class="ident" id="3711721">err</span>&nbsp;<span class="op" id="3711725">=</span>&nbsp;<span class="ident" id="3711727">enc</span><span class="op" id="3711730">.</span><span class="ident" id="3711731">decode</span><span class="op" id="3711737">(</span><span class="ident" id="3711738">dst</span><span class="op" id="3711741">,</span>&nbsp;<span class="ident" id="3711743">src</span><span class="op" id="3711746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711749">return</span><br>
<span class="lineno">290</span><span class="op" id="3711756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3711759">//&nbsp;DecodeString&nbsp;returns&nbsp;the&nbsp;bytes&nbsp;represented&nbsp;by&nbsp;the&nbsp;base64&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3711829">func</span>&nbsp;<span class="op" id="3711834">(</span><span class="ident" id="3711835">enc</span>&nbsp;<span class="op" id="3711839">*</span><span class="ident" id="3711840">Encoding</span><span class="op" id="3711848">)</span>&nbsp;<span class="ident" id="3711850">DecodeString</span><span class="op" id="3711862">(</span><span class="ident" id="3711863">s</span>&nbsp;<span class="builtintype" id="3711865">string</span><span class="op" id="3711871">)</span>&nbsp;<span class="op" id="3711873">(</span><span class="op" id="3711874">[</span><span class="op" id="3711875">]</span><span class="builtintype" id="3711876">byte</span><span class="op" id="3711880">,</span>&nbsp;<span class="builtintype" id="3711882">error</span><span class="op" id="3711887">)</span>&nbsp;<span class="op" id="3711889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711892">s</span>&nbsp;<span class="op" id="3711894">=</span>&nbsp;<span class="ident" id="3711896">strings</span><span class="op" id="3711903">.</span><span class="ident" id="3711904">Map</span><span class="op" id="3711907">(</span><span class="ident" id="3711908">removeNewlinesMapper</span><span class="op" id="3711928">,</span>&nbsp;<span class="ident" id="3711930">s</span><span class="op" id="3711931">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711934">dbuf</span>&nbsp;<span class="op" id="3711939">:=</span>&nbsp;<span class="builtinfunc" id="3711942">make</span><span class="op" id="3711946">(</span><span class="op" id="3711947">[</span><span class="op" id="3711948">]</span><span class="builtintype" id="3711949">byte</span><span class="op" id="3711953">,</span>&nbsp;<span class="ident" id="3711955">enc</span><span class="op" id="3711958">.</span><span class="ident" id="3711959">DecodedLen</span><span class="op" id="3711969">(</span><span class="builtinfunc" id="3711970">len</span><span class="op" id="3711973">(</span><span class="ident" id="3711974">s</span><span class="op" id="3711975">)</span><span class="op" id="3711976">)</span><span class="op" id="3711977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711980">n</span><span class="op" id="3711981">,</span>&nbsp;<span class="ident" id="3711983">_</span><span class="op" id="3711984">,</span>&nbsp;<span class="ident" id="3711986">err</span>&nbsp;<span class="op" id="3711990">:=</span>&nbsp;<span class="ident" id="3711993">enc</span><span class="op" id="3711996">.</span><span class="ident" id="3711997">decode</span><span class="op" id="3712003">(</span><span class="ident" id="3712004">dbuf</span><span class="op" id="3712008">,</span>&nbsp;<span class="op" id="3712010">[</span><span class="op" id="3712011">]</span><span class="builtintype" id="3712012">byte</span><span class="op" id="3712016">(</span><span class="ident" id="3712017">s</span><span class="op" id="3712018">)</span><span class="op" id="3712019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712022">return</span>&nbsp;<span class="ident" id="3712029">dbuf</span><span class="op" id="3712033">[</span><span class="op" id="3712034">:</span><span class="ident" id="3712035">n</span><span class="op" id="3712036">]</span><span class="op" id="3712037">,</span>&nbsp;<span class="ident" id="3712039">err</span><br>
<span class="lineno"></span><span class="op" id="3712043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="3712046">type</span>&nbsp;<span class="ident" id="3712051">decoder</span>&nbsp;<span class="keyword" id="3712059">struct</span>&nbsp;<span class="op" id="3712066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712069">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3712076">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712083">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3712090">*</span><span class="ident" id="3712091">Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712101">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3712108">io</span><span class="op" id="3712110">.</span><span class="ident" id="3712111">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712119">end</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3712126">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3712137">//&nbsp;saw&nbsp;end&nbsp;of&nbsp;message</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712160">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3712167">[</span><span class="num" id="3712168">1024</span><span class="op" id="3712172">]</span><span class="builtintype" id="3712173">byte</span>&nbsp;<span class="comment" id="3712178">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712197">nbuf</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3712204">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712209">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3712216">[</span><span class="op" id="3712217">]</span><span class="builtintype" id="3712218">byte</span>&nbsp;<span class="comment" id="3712223">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712251">outbuf</span>&nbsp;<span class="op" id="3712258">[</span><span class="num" id="3712259">1024</span>&nbsp;<span class="op" id="3712264">/</span>&nbsp;<span class="num" id="3712266">4</span>&nbsp;<span class="op" id="3712268">*</span>&nbsp;<span class="num" id="3712270">3</span><span class="op" id="3712271">]</span><span class="builtintype" id="3712272">byte</span><br>
<span class="lineno"></span><span class="op" id="3712277">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="3712280">func</span>&nbsp;<span class="op" id="3712285">(</span><span class="ident" id="3712286">d</span>&nbsp;<span class="op" id="3712288">*</span><span class="ident" id="3712289">decoder</span><span class="op" id="3712296">)</span>&nbsp;<span class="ident" id="3712298">Read</span><span class="op" id="3712302">(</span><span class="ident" id="3712303">p</span>&nbsp;<span class="op" id="3712305">[</span><span class="op" id="3712306">]</span><span class="builtintype" id="3712307">byte</span><span class="op" id="3712311">)</span>&nbsp;<span class="op" id="3712313">(</span><span class="ident" id="3712314">n</span>&nbsp;<span class="builtintype" id="3712316">int</span><span class="op" id="3712319">,</span>&nbsp;<span class="ident" id="3712321">err</span>&nbsp;<span class="builtintype" id="3712325">error</span><span class="op" id="3712330">)</span>&nbsp;<span class="op" id="3712332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712335">if</span>&nbsp;<span class="ident" id="3712338">d</span><span class="op" id="3712339">.</span><span class="ident" id="3712340">err</span>&nbsp;<span class="op" id="3712344">!=</span>&nbsp;<span class="ident" id="3712347">nil</span>&nbsp;<span class="op" id="3712351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712355">return</span>&nbsp;<span class="num" id="3712362">0</span><span class="op" id="3712363">,</span>&nbsp;<span class="ident" id="3712365">d</span><span class="op" id="3712366">.</span><span class="ident" id="3712367">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3712372">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3712376">//&nbsp;Use&nbsp;leftover&nbsp;decoded&nbsp;output&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712424">if</span>&nbsp;<span class="builtinfunc" id="3712427">len</span><span class="op" id="3712430">(</span><span class="ident" id="3712431">d</span><span class="op" id="3712432">.</span><span class="ident" id="3712433">out</span><span class="op" id="3712436">)</span>&nbsp;<span class="op" id="3712438">&gt;</span>&nbsp;<span class="num" id="3712440">0</span>&nbsp;<span class="op" id="3712442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712446">n</span>&nbsp;<span class="op" id="3712448">=</span>&nbsp;<span class="builtinfunc" id="3712450">copy</span><span class="op" id="3712454">(</span><span class="ident" id="3712455">p</span><span class="op" id="3712456">,</span>&nbsp;<span class="ident" id="3712458">d</span><span class="op" id="3712459">.</span><span class="ident" id="3712460">out</span><span class="op" id="3712463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712467">d</span><span class="op" id="3712468">.</span><span class="ident" id="3712469">out</span>&nbsp;<span class="op" id="3712473">=</span>&nbsp;<span class="ident" id="3712475">d</span><span class="op" id="3712476">.</span><span class="ident" id="3712477">out</span><span class="op" id="3712480">[</span><span class="ident" id="3712481">n</span><span class="op" id="3712482">:</span><span class="op" id="3712483">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712487">return</span>&nbsp;<span class="ident" id="3712494">n</span><span class="op" id="3712495">,</span>&nbsp;<span class="ident" id="3712497">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3712502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3712506">//&nbsp;Read&nbsp;a&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712524">nn</span>&nbsp;<span class="op" id="3712527">:=</span>&nbsp;<span class="builtinfunc" id="3712530">len</span><span class="op" id="3712533">(</span><span class="ident" id="3712534">p</span><span class="op" id="3712535">)</span>&nbsp;<span class="op" id="3712537">/</span>&nbsp;<span class="num" id="3712539">3</span>&nbsp;<span class="op" id="3712541">*</span>&nbsp;<span class="num" id="3712543">4</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712546">if</span>&nbsp;<span class="ident" id="3712549">nn</span>&nbsp;<span class="op" id="3712552">&lt;</span>&nbsp;<span class="num" id="3712554">4</span>&nbsp;<span class="op" id="3712556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712560">nn</span>&nbsp;<span class="op" id="3712563">=</span>&nbsp;<span class="num" id="3712565">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3712568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712571">if</span>&nbsp;<span class="ident" id="3712574">nn</span>&nbsp;<span class="op" id="3712577">&gt;</span>&nbsp;<span class="builtinfunc" id="3712579">len</span><span class="op" id="3712582">(</span><span class="ident" id="3712583">d</span><span class="op" id="3712584">.</span><span class="ident" id="3712585">buf</span><span class="op" id="3712588">)</span>&nbsp;<span class="op" id="3712590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712594">nn</span>&nbsp;<span class="op" id="3712597">=</span>&nbsp;<span class="builtinfunc" id="3712599">len</span><span class="op" id="3712602">(</span><span class="ident" id="3712603">d</span><span class="op" id="3712604">.</span><span class="ident" id="3712605">buf</span><span class="op" id="3712608">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3712611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712614">nn</span><span class="op" id="3712616">,</span>&nbsp;<span class="ident" id="3712618">d</span><span class="op" id="3712619">.</span><span class="ident" id="3712620">err</span>&nbsp;<span class="op" id="3712624">=</span>&nbsp;<span class="ident" id="3712626">io</span><span class="op" id="3712628">.</span><span class="ident" id="3712629">ReadAtLeast</span><span class="op" id="3712640">(</span><span class="ident" id="3712641">d</span><span class="op" id="3712642">.</span><span class="ident" id="3712643">r</span><span class="op" id="3712644">,</span>&nbsp;<span class="ident" id="3712646">d</span><span class="op" id="3712647">.</span><span class="ident" id="3712648">buf</span><span class="op" id="3712651">[</span><span class="ident" id="3712652">d</span><span class="op" id="3712653">.</span><span class="ident" id="3712654">nbuf</span><span class="op" id="3712658">:</span><span class="ident" id="3712659">nn</span><span class="op" id="3712661">]</span><span class="op" id="3712662">,</span>&nbsp;<span class="num" id="3712664">4</span><span class="op" id="3712665">-</span><span class="ident" id="3712666">d</span><span class="op" id="3712667">.</span><span class="ident" id="3712668">nbuf</span><span class="op" id="3712672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712675">d</span><span class="op" id="3712676">.</span><span class="ident" id="3712677">nbuf</span>&nbsp;<span class="op" id="3712682">+=</span>&nbsp;<span class="ident" id="3712685">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712689">if</span>&nbsp;<span class="ident" id="3712692">d</span><span class="op" id="3712693">.</span><span class="ident" id="3712694">err</span>&nbsp;<span class="op" id="3712698">!=</span>&nbsp;<span class="ident" id="3712701">nil</span>&nbsp;<span class="op" id="3712705">||</span>&nbsp;<span class="ident" id="3712708">d</span><span class="op" id="3712709">.</span><span class="ident" id="3712710">nbuf</span>&nbsp;<span class="op" id="3712715">&lt;</span>&nbsp;<span class="num" id="3712717">4</span>&nbsp;<span class="op" id="3712719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712723">return</span>&nbsp;<span class="num" id="3712730">0</span><span class="op" id="3712731">,</span>&nbsp;<span class="ident" id="3712733">d</span><span class="op" id="3712734">.</span><span class="ident" id="3712735">err</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3712740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3712744">//&nbsp;Decode&nbsp;chunk&nbsp;into&nbsp;p,&nbsp;or&nbsp;d.out&nbsp;and&nbsp;then&nbsp;p&nbsp;if&nbsp;p&nbsp;is&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712808">nr</span>&nbsp;<span class="op" id="3712811">:=</span>&nbsp;<span class="ident" id="3712814">d</span><span class="op" id="3712815">.</span><span class="ident" id="3712816">nbuf</span>&nbsp;<span class="op" id="3712821">/</span>&nbsp;<span class="num" id="3712823">4</span>&nbsp;<span class="op" id="3712825">*</span>&nbsp;<span class="num" id="3712827">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712830">nw</span>&nbsp;<span class="op" id="3712833">:=</span>&nbsp;<span class="ident" id="3712836">d</span><span class="op" id="3712837">.</span><span class="ident" id="3712838">nbuf</span>&nbsp;<span class="op" id="3712843">/</span>&nbsp;<span class="num" id="3712845">4</span>&nbsp;<span class="op" id="3712847">*</span>&nbsp;<span class="num" id="3712849">3</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712852">if</span>&nbsp;<span class="ident" id="3712855">nw</span>&nbsp;<span class="op" id="3712858">&gt;</span>&nbsp;<span class="builtinfunc" id="3712860">len</span><span class="op" id="3712863">(</span><span class="ident" id="3712864">p</span><span class="op" id="3712865">)</span>&nbsp;<span class="op" id="3712867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712871">nw</span><span class="op" id="3712873">,</span>&nbsp;<span class="ident" id="3712875">d</span><span class="op" id="3712876">.</span><span class="ident" id="3712877">end</span><span class="op" id="3712880">,</span>&nbsp;<span class="ident" id="3712882">d</span><span class="op" id="3712883">.</span><span class="ident" id="3712884">err</span>&nbsp;<span class="op" id="3712888">=</span>&nbsp;<span class="ident" id="3712890">d</span><span class="op" id="3712891">.</span><span class="ident" id="3712892">enc</span><span class="op" id="3712895">.</span><span class="ident" id="3712896">decode</span><span class="op" id="3712902">(</span><span class="ident" id="3712903">d</span><span class="op" id="3712904">.</span><span class="ident" id="3712905">outbuf</span><span class="op" id="3712911">[</span><span class="num" id="3712912">0</span><span class="op" id="3712913">:</span><span class="op" id="3712914">]</span><span class="op" id="3712915">,</span>&nbsp;<span class="ident" id="3712917">d</span><span class="op" id="3712918">.</span><span class="ident" id="3712919">buf</span><span class="op" id="3712922">[</span><span class="num" id="3712923">0</span><span class="op" id="3712924">:</span><span class="ident" id="3712925">nr</span><span class="op" id="3712927">]</span><span class="op" id="3712928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712932">d</span><span class="op" id="3712933">.</span><span class="ident" id="3712934">out</span>&nbsp;<span class="op" id="3712938">=</span>&nbsp;<span class="ident" id="3712940">d</span><span class="op" id="3712941">.</span><span class="ident" id="3712942">outbuf</span><span class="op" id="3712948">[</span><span class="num" id="3712949">0</span><span class="op" id="3712950">:</span><span class="ident" id="3712951">nw</span><span class="op" id="3712953">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712957">n</span>&nbsp;<span class="op" id="3712959">=</span>&nbsp;<span class="builtinfunc" id="3712961">copy</span><span class="op" id="3712965">(</span><span class="ident" id="3712966">p</span><span class="op" id="3712967">,</span>&nbsp;<span class="ident" id="3712969">d</span><span class="op" id="3712970">.</span><span class="ident" id="3712971">out</span><span class="op" id="3712974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712978">d</span><span class="op" id="3712979">.</span><span class="ident" id="3712980">out</span>&nbsp;<span class="op" id="3712984">=</span>&nbsp;<span class="ident" id="3712986">d</span><span class="op" id="3712987">.</span><span class="ident" id="3712988">out</span><span class="op" id="3712991">[</span><span class="ident" id="3712992">n</span><span class="op" id="3712993">:</span><span class="op" id="3712994">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3712997">}</span>&nbsp;<span class="keyword" id="3712999">else</span>&nbsp;<span class="op" id="3713004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713008">n</span><span class="op" id="3713009">,</span>&nbsp;<span class="ident" id="3713011">d</span><span class="op" id="3713012">.</span><span class="ident" id="3713013">end</span><span class="op" id="3713016">,</span>&nbsp;<span class="ident" id="3713018">d</span><span class="op" id="3713019">.</span><span class="ident" id="3713020">err</span>&nbsp;<span class="op" id="3713024">=</span>&nbsp;<span class="ident" id="3713026">d</span><span class="op" id="3713027">.</span><span class="ident" id="3713028">enc</span><span class="op" id="3713031">.</span><span class="ident" id="3713032">decode</span><span class="op" id="3713038">(</span><span class="ident" id="3713039">p</span><span class="op" id="3713040">,</span>&nbsp;<span class="ident" id="3713042">d</span><span class="op" id="3713043">.</span><span class="ident" id="3713044">buf</span><span class="op" id="3713047">[</span><span class="num" id="3713048">0</span><span class="op" id="3713049">:</span><span class="ident" id="3713050">nr</span><span class="op" id="3713052">]</span><span class="op" id="3713053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713059">d</span><span class="op" id="3713060">.</span><span class="ident" id="3713061">nbuf</span>&nbsp;<span class="op" id="3713066">-=</span>&nbsp;<span class="ident" id="3713069">nr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713073">for</span>&nbsp;<span class="ident" id="3713077">i</span>&nbsp;<span class="op" id="3713079">:=</span>&nbsp;<span class="num" id="3713082">0</span><span class="op" id="3713083">;</span>&nbsp;<span class="ident" id="3713085">i</span>&nbsp;<span class="op" id="3713087">&lt;</span>&nbsp;<span class="ident" id="3713089">d</span><span class="op" id="3713090">.</span><span class="ident" id="3713091">nbuf</span><span class="op" id="3713095">;</span>&nbsp;<span class="ident" id="3713097">i</span><span class="op" id="3713098">++</span>&nbsp;<span class="op" id="3713101">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713105">d</span><span class="op" id="3713106">.</span><span class="ident" id="3713107">buf</span><span class="op" id="3713110">[</span><span class="ident" id="3713111">i</span><span class="op" id="3713112">]</span>&nbsp;<span class="op" id="3713114">=</span>&nbsp;<span class="ident" id="3713116">d</span><span class="op" id="3713117">.</span><span class="ident" id="3713118">buf</span><span class="op" id="3713121">[</span><span class="ident" id="3713122">i</span><span class="op" id="3713123">+</span><span class="ident" id="3713124">nr</span><span class="op" id="3713126">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713133">if</span>&nbsp;<span class="ident" id="3713136">d</span><span class="op" id="3713137">.</span><span class="ident" id="3713138">err</span>&nbsp;<span class="op" id="3713142">==</span>&nbsp;<span class="ident" id="3713145">nil</span>&nbsp;<span class="op" id="3713149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713153">d</span><span class="op" id="3713154">.</span><span class="ident" id="3713155">err</span>&nbsp;<span class="op" id="3713159">=</span>&nbsp;<span class="ident" id="3713161">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713169">return</span>&nbsp;<span class="ident" id="3713176">n</span><span class="op" id="3713177">,</span>&nbsp;<span class="ident" id="3713179">d</span><span class="op" id="3713180">.</span><span class="ident" id="3713181">err</span><br>
<span class="lineno"></span><span class="op" id="3713185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3713188">type</span>&nbsp;<span class="ident" id="3713193">newlineFilteringReader</span>&nbsp;<span class="keyword" id="3713216">struct</span>&nbsp;<span class="op" id="3713223">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713226">wrapped</span>&nbsp;<span class="ident" id="3713234">io</span><span class="op" id="3713236">.</span><span class="ident" id="3713237">Reader</span><br>
<span class="lineno"></span><span class="op" id="3713244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3713247">func</span>&nbsp;<span class="op" id="3713252">(</span><span class="ident" id="3713253">r</span>&nbsp;<span class="op" id="3713255">*</span><span class="ident" id="3713256">newlineFilteringReader</span><span class="op" id="3713278">)</span>&nbsp;<span class="ident" id="3713280">Read</span><span class="op" id="3713284">(</span><span class="ident" id="3713285">p</span>&nbsp;<span class="op" id="3713287">[</span><span class="op" id="3713288">]</span><span class="builtintype" id="3713289">byte</span><span class="op" id="3713293">)</span>&nbsp;<span class="op" id="3713295">(</span><span class="builtintype" id="3713296">int</span><span class="op" id="3713299">,</span>&nbsp;<span class="builtintype" id="3713301">error</span><span class="op" id="3713306">)</span>&nbsp;<span class="op" id="3713308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713311">n</span><span class="op" id="3713312">,</span>&nbsp;<span class="ident" id="3713314">err</span>&nbsp;<span class="op" id="3713318">:=</span>&nbsp;<span class="ident" id="3713321">r</span><span class="op" id="3713322">.</span><span class="ident" id="3713323">wrapped</span><span class="op" id="3713330">.</span><span class="ident" id="3713331">Read</span><span class="op" id="3713335">(</span><span class="ident" id="3713336">p</span><span class="op" id="3713337">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713340">for</span>&nbsp;<span class="ident" id="3713344">n</span>&nbsp;<span class="op" id="3713346">&gt;</span>&nbsp;<span class="num" id="3713348">0</span>&nbsp;<span class="op" id="3713350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713354">offset</span>&nbsp;<span class="op" id="3713361">:=</span>&nbsp;<span class="num" id="3713364">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713368">for</span>&nbsp;<span class="ident" id="3713372">i</span><span class="op" id="3713373">,</span>&nbsp;<span class="ident" id="3713375">b</span>&nbsp;<span class="op" id="3713377">:=</span>&nbsp;<span class="keyword" id="3713380">range</span>&nbsp;<span class="ident" id="3713386">p</span><span class="op" id="3713387">[</span><span class="num" id="3713388">0</span><span class="op" id="3713389">:</span><span class="ident" id="3713390">n</span><span class="op" id="3713391">]</span>&nbsp;<span class="op" id="3713393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713398">if</span>&nbsp;<span class="ident" id="3713401">b</span>&nbsp;<span class="op" id="3713403">!=</span>&nbsp;<span class="string" id="3713406">&#39;\r&#39;</span>&nbsp;<span class="op" id="3713411">&amp;&amp;</span>&nbsp;<span class="ident" id="3713414">b</span>&nbsp;<span class="op" id="3713416">!=</span>&nbsp;<span class="string" id="3713419">&#39;\n&#39;</span>&nbsp;<span class="op" id="3713424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713430">if</span>&nbsp;<span class="ident" id="3713433">i</span>&nbsp;<span class="op" id="3713435">!=</span>&nbsp;<span class="ident" id="3713438">offset</span>&nbsp;<span class="op" id="3713445">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713452">p</span><span class="op" id="3713453">[</span><span class="ident" id="3713454">offset</span><span class="op" id="3713460">]</span>&nbsp;<span class="op" id="3713462">=</span>&nbsp;<span class="ident" id="3713464">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713476">offset</span><span class="op" id="3713482">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713492">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713496">if</span>&nbsp;<span class="ident" id="3713499">offset</span>&nbsp;<span class="op" id="3713506">&gt;</span>&nbsp;<span class="num" id="3713508">0</span>&nbsp;<span class="op" id="3713510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713515">return</span>&nbsp;<span class="ident" id="3713522">offset</span><span class="op" id="3713528">,</span>&nbsp;<span class="ident" id="3713530">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713540">//&nbsp;Previous&nbsp;buffer&nbsp;entirely&nbsp;whitespace,&nbsp;read&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713593">n</span><span class="op" id="3713594">,</span>&nbsp;<span class="ident" id="3713596">err</span>&nbsp;<span class="op" id="3713600">=</span>&nbsp;<span class="ident" id="3713602">r</span><span class="op" id="3713603">.</span><span class="ident" id="3713604">wrapped</span><span class="op" id="3713611">.</span><span class="ident" id="3713612">Read</span><span class="op" id="3713616">(</span><span class="ident" id="3713617">p</span><span class="op" id="3713618">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713624">return</span>&nbsp;<span class="ident" id="3713631">n</span><span class="op" id="3713632">,</span>&nbsp;<span class="ident" id="3713634">err</span><br>
<span class="lineno"></span><span class="op" id="3713638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3713641">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno">385</span><span class="keyword" id="3713695">func</span>&nbsp;<span class="ident" id="3713700">NewDecoder</span><span class="op" id="3713710">(</span><span class="ident" id="3713711">enc</span>&nbsp;<span class="op" id="3713715">*</span><span class="ident" id="3713716">Encoding</span><span class="op" id="3713724">,</span>&nbsp;<span class="ident" id="3713726">r</span>&nbsp;<span class="ident" id="3713728">io</span><span class="op" id="3713730">.</span><span class="ident" id="3713731">Reader</span><span class="op" id="3713737">)</span>&nbsp;<span class="ident" id="3713739">io</span><span class="op" id="3713741">.</span><span class="ident" id="3713742">Reader</span>&nbsp;<span class="op" id="3713749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713752">return</span>&nbsp;<span class="op" id="3713759">&amp;</span><span class="ident" id="3713760">decoder</span><span class="op" id="3713767">{</span><span class="ident" id="3713768">enc</span><span class="op" id="3713771">:</span>&nbsp;<span class="ident" id="3713773">enc</span><span class="op" id="3713776">,</span>&nbsp;<span class="ident" id="3713778">r</span><span class="op" id="3713779">:</span>&nbsp;<span class="op" id="3713781">&amp;</span><span class="ident" id="3713782">newlineFilteringReader</span><span class="op" id="3713804">{</span><span class="ident" id="3713805">r</span><span class="op" id="3713806">}</span><span class="op" id="3713807">}</span><br>
<span class="lineno"></span><span class="op" id="3713809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3713812">//&nbsp;DecodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;decoded&nbsp;data</span><br>
<span class="lineno">390</span><span class="comment" id="3713882">//&nbsp;corresponding&nbsp;to&nbsp;n&nbsp;bytes&nbsp;of&nbsp;base64-encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3713934">func</span>&nbsp;<span class="op" id="3713939">(</span><span class="ident" id="3713940">enc</span>&nbsp;<span class="op" id="3713944">*</span><span class="ident" id="3713945">Encoding</span><span class="op" id="3713953">)</span>&nbsp;<span class="ident" id="3713955">DecodedLen</span><span class="op" id="3713965">(</span><span class="ident" id="3713966">n</span>&nbsp;<span class="builtintype" id="3713968">int</span><span class="op" id="3713971">)</span>&nbsp;<span class="builtintype" id="3713973">int</span>&nbsp;<span class="op" id="3713977">{</span>&nbsp;<span class="keyword" id="3713979">return</span>&nbsp;<span class="ident" id="3713986">n</span>&nbsp;<span class="op" id="3713988">/</span>&nbsp;<span class="num" id="3713990">4</span>&nbsp;<span class="op" id="3713992">*</span>&nbsp;<span class="num" id="3713994">3</span>&nbsp;<span class="op" id="3713996">}</span>
</div>
</body>
</html>
