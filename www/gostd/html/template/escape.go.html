<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html" class="current">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4903664">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4903719">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4903773">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4903824">package</span>&nbsp;<span class="ident" id="4903832">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4903842">import</span>&nbsp;<span class="op" id="4903849">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4903852">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4903861">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4903868">&#34;html&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4903876">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4903882">&#34;text/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4903899">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="4903921">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4903924">//&nbsp;escapeTemplate&nbsp;rewrites&nbsp;the&nbsp;named&nbsp;template,&nbsp;which&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4903985">//&nbsp;associated&nbsp;with&nbsp;t,&nbsp;to&nbsp;guarantee&nbsp;that&nbsp;the&nbsp;output&nbsp;of&nbsp;any&nbsp;of&nbsp;the&nbsp;named</span><br>
<span class="lineno"></span><span class="comment" id="4904056">//&nbsp;templates&nbsp;is&nbsp;properly&nbsp;escaped.&nbsp;&nbsp;If&nbsp;no&nbsp;error&nbsp;is&nbsp;returned,&nbsp;then&nbsp;the&nbsp;named&nbsp;templates&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4904146">//&nbsp;been&nbsp;modified.&nbsp;&nbsp;Otherwise&nbsp;the&nbsp;named&nbsp;templates&nbsp;have&nbsp;been&nbsp;rendered</span><br>
<span class="lineno">20</span><span class="comment" id="4904214">//&nbsp;unusable.</span><br>
<span class="lineno"></span><span class="keyword" id="4904227">func</span>&nbsp;<span class="ident" id="4904232">escapeTemplate</span><span class="op" id="4904246">(</span><span class="ident" id="4904247">tmpl</span>&nbsp;<span class="op" id="4904252">*</span><span class="ident" id="4904253"><a href="/gostd/html/template/template.go.html#4946616">Template</a></span><span class="op" id="4904261">,</span>&nbsp;<span class="ident" id="4904263">node</span>&nbsp;<span class="ident" id="4904268"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4904273">.</span><span class="ident" id="4904274"><a href="/gostd/text/template/parse/node.go.html#3160534">Node</a></span><span class="op" id="4904278">,</span>&nbsp;<span class="ident" id="4904280">name</span>&nbsp;<span class="builtintype" id="4904285">string</span><span class="op" id="4904291">)</span>&nbsp;<span class="builtintype" id="4904293">error</span>&nbsp;<span class="op" id="4904299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904302">e</span>&nbsp;<span class="op" id="4904304">:=</span>&nbsp;<span class="ident" id="4904307"><a href="/gostd/html/template/escape.go.html#4906980">newEscaper</a></span><span class="op" id="4904317">(</span><span class="ident" id="4904318"><a href="/gostd/html/template/escape.go.html#4904247">tmpl</a></span><span class="op" id="4904322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904325">c</span><span class="op" id="4904326">,</span>&nbsp;<span class="ident" id="4904328">_</span>&nbsp;<span class="op" id="4904330">:=</span>&nbsp;<span class="ident" id="4904333"><a href="/gostd/html/template/escape.go.html#4904302">e</a></span><span class="op" id="4904334">.</span><span class="ident" id="4904335"><a href="/gostd/html/template/escape.go.html#4918665">escapeTree</a></span><span class="op" id="4904345">(</span><span class="ident" id="4904346"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4904353">{</span><span class="op" id="4904354">}</span><span class="op" id="4904355">,</span>&nbsp;<span class="ident" id="4904357"><a href="/gostd/html/template/escape.go.html#4904263">node</a></span><span class="op" id="4904361">,</span>&nbsp;<span class="ident" id="4904363"><a href="/gostd/html/template/escape.go.html#4904280">name</a></span><span class="op" id="4904367">,</span>&nbsp;<span class="num" id="4904369">0</span><span class="op" id="4904370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904373">var</span>&nbsp;<span class="ident" id="4904377">err</span>&nbsp;<span class="builtintype" id="4904381">error</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904388">if</span>&nbsp;<span class="ident" id="4904391"><a href="/gostd/html/template/escape.go.html#4904325">c</a></span><span class="op" id="4904392">.</span><span class="ident" id="4904393"><a href="/gostd/html/template/context.go.html#4873059">err</a></span>&nbsp;<span class="op" id="4904397">!=</span>&nbsp;<span class="builtintype" id="4904400">nil</span>&nbsp;<span class="op" id="4904404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904408"><a href="/gostd/html/template/escape.go.html#4904377">err</a></span><span class="op" id="4904411">,</span>&nbsp;<span class="ident" id="4904413"><a href="/gostd/html/template/escape.go.html#4904325">c</a></span><span class="op" id="4904414">.</span><span class="ident" id="4904415"><a href="/gostd/html/template/context.go.html#4873059">err</a></span><span class="op" id="4904418">.</span><span class="ident" id="4904419"><a href="/gostd/html/template/error.go.html#4896596">Name</a></span>&nbsp;<span class="op" id="4904424">=</span>&nbsp;<span class="ident" id="4904426"><a href="/gostd/html/template/escape.go.html#4904325">c</a></span><span class="op" id="4904427">.</span><span class="ident" id="4904428"><a href="/gostd/html/template/context.go.html#4873059">err</a></span><span class="op" id="4904431">,</span>&nbsp;<span class="ident" id="4904433"><a href="/gostd/html/template/escape.go.html#4904280">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904439">}</span>&nbsp;<span class="keyword" id="4904441">else</span>&nbsp;<span class="keyword" id="4904446">if</span>&nbsp;<span class="ident" id="4904449"><a href="/gostd/html/template/escape.go.html#4904325">c</a></span><span class="op" id="4904450">.</span><span class="ident" id="4904451"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4904457">!=</span>&nbsp;<span class="ident" id="4904460"><a href="/gostd/html/template/context.go.html#4874843">stateText</a></span>&nbsp;<span class="op" id="4904470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904474"><a href="/gostd/html/template/escape.go.html#4904377">err</a></span>&nbsp;<span class="op" id="4904478">=</span>&nbsp;<span class="op" id="4904480">&amp;</span><span class="ident" id="4904481"><a href="/gostd/html/template/error.go.html#4896326">Error</a></span><span class="op" id="4904486">{</span><span class="ident" id="4904487"><a href="/gostd/html/template/error.go.html#4900026">ErrEndContext</a></span><span class="op" id="4904500">,</span>&nbsp;<span class="builtintype" id="4904502">nil</span><span class="op" id="4904505">,</span>&nbsp;<span class="ident" id="4904507"><a href="/gostd/html/template/escape.go.html#4904280">name</a></span><span class="op" id="4904511">,</span>&nbsp;<span class="num" id="4904513">0</span><span class="op" id="4904514">,</span>&nbsp;<span class="ident" id="4904516"><a href="/gostd/html/template/escape.go.html#4903861">fmt</a></span><span class="op" id="4904519">.</span><span class="ident" id="4904520"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="4904527">(</span><span class="string" id="4904528">&#34;ends&nbsp;in&nbsp;a&nbsp;non-text&nbsp;context:&nbsp;%v&#34;</span><span class="op" id="4904560">,</span>&nbsp;<span class="ident" id="4904562"><a href="/gostd/html/template/escape.go.html#4904325">c</a></span><span class="op" id="4904563">)</span><span class="op" id="4904564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904567">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904570">if</span>&nbsp;<span class="ident" id="4904573"><a href="/gostd/html/template/escape.go.html#4904377">err</a></span>&nbsp;<span class="op" id="4904577">!=</span>&nbsp;<span class="builtintype" id="4904580">nil</span>&nbsp;<span class="op" id="4904584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4904588">//&nbsp;Prevent&nbsp;execution&nbsp;of&nbsp;unsafe&nbsp;templates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904632">if</span>&nbsp;<span class="ident" id="4904635">t</span>&nbsp;<span class="op" id="4904637">:=</span>&nbsp;<span class="ident" id="4904640"><a href="/gostd/html/template/escape.go.html#4904247">tmpl</a></span><span class="op" id="4904644">.</span><span class="ident" id="4904645"><a href="/gostd/html/template/template.go.html#4947264">set</a></span><span class="op" id="4904648">[</span><span class="ident" id="4904649"><a href="/gostd/html/template/escape.go.html#4904280">name</a></span><span class="op" id="4904653">]</span><span class="op" id="4904654">;</span>&nbsp;<span class="ident" id="4904656"><a href="/gostd/html/template/escape.go.html#4904635">t</a></span>&nbsp;<span class="op" id="4904658">!=</span>&nbsp;<span class="builtintype" id="4904661">nil</span>&nbsp;<span class="op" id="4904665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904670"><a href="/gostd/html/template/escape.go.html#4904635">t</a></span><span class="op" id="4904671">.</span><span class="ident" id="4904672"><a href="/gostd/html/template/template.go.html#4946671">escapeErr</a></span>&nbsp;<span class="op" id="4904682">=</span>&nbsp;<span class="ident" id="4904684"><a href="/gostd/html/template/escape.go.html#4904377">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904691"><a href="/gostd/html/template/escape.go.html#4904635">t</a></span><span class="op" id="4904692">.</span><span class="ident" id="4904693"><a href="/gostd/html/template/template.go.html#4946855">text</a></span><span class="op" id="4904697">.</span><span class="ident" id="4904698"><a href="/gostd/text/template/template.go.html#3739734">Tree</a></span>&nbsp;<span class="op" id="4904703">=</span>&nbsp;<span class="builtintype" id="4904705">nil</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904712"><a href="/gostd/html/template/escape.go.html#4904635">t</a></span><span class="op" id="4904713">.</span><span class="ident" id="4904714"><a href="/gostd/html/template/template.go.html#4946947">Tree</a></span>&nbsp;<span class="op" id="4904719">=</span>&nbsp;<span class="builtintype" id="4904721">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904731">return</span>&nbsp;<span class="ident" id="4904738"><a href="/gostd/html/template/escape.go.html#4904377">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904746"><a href="/gostd/html/template/escape.go.html#4904302">e</a></span><span class="op" id="4904747">.</span><span class="ident" id="4904748"><a href="/gostd/html/template/escape.go.html#4926742">commit</a></span><span class="op" id="4904754">(</span><span class="op" id="4904755">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904758">if</span>&nbsp;<span class="ident" id="4904761">t</span>&nbsp;<span class="op" id="4904763">:=</span>&nbsp;<span class="ident" id="4904766"><a href="/gostd/html/template/escape.go.html#4904247">tmpl</a></span><span class="op" id="4904770">.</span><span class="ident" id="4904771"><a href="/gostd/html/template/template.go.html#4947264">set</a></span><span class="op" id="4904774">[</span><span class="ident" id="4904775"><a href="/gostd/html/template/escape.go.html#4904280">name</a></span><span class="op" id="4904779">]</span><span class="op" id="4904780">;</span>&nbsp;<span class="ident" id="4904782"><a href="/gostd/html/template/escape.go.html#4904761">t</a></span>&nbsp;<span class="op" id="4904784">!=</span>&nbsp;<span class="builtintype" id="4904787">nil</span>&nbsp;<span class="op" id="4904791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904795"><a href="/gostd/html/template/escape.go.html#4904761">t</a></span><span class="op" id="4904796">.</span><span class="ident" id="4904797"><a href="/gostd/html/template/template.go.html#4946671">escapeErr</a></span>&nbsp;<span class="op" id="4904807">=</span>&nbsp;<span class="ident" id="4904809"><a href="/gostd/html/template/template.go.html#4947092">escapeOK</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904820"><a href="/gostd/html/template/escape.go.html#4904761">t</a></span><span class="op" id="4904821">.</span><span class="ident" id="4904822"><a href="/gostd/html/template/template.go.html#4946947">Tree</a></span>&nbsp;<span class="op" id="4904827">=</span>&nbsp;<span class="ident" id="4904829"><a href="/gostd/html/template/escape.go.html#4904761">t</a></span><span class="op" id="4904830">.</span><span class="ident" id="4904831"><a href="/gostd/html/template/template.go.html#4946855">text</a></span><span class="op" id="4904835">.</span><span class="ident" id="4904836"><a href="/gostd/text/template/template.go.html#3739734">Tree</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4904845">return</span>&nbsp;<span class="builtintype" id="4904852">nil</span><br>
<span class="lineno">45</span><span class="op" id="4904856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4904859">//&nbsp;funcMap&nbsp;maps&nbsp;command&nbsp;names&nbsp;to&nbsp;functions&nbsp;that&nbsp;render&nbsp;their&nbsp;inputs&nbsp;safe.</span><br>
<span class="lineno"></span><span class="keyword" id="4904933">var</span>&nbsp;<span class="ident" id="4904937">funcMap</span>&nbsp;<span class="op" id="4904945">=</span>&nbsp;<span class="ident" id="4904947"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4904955">.</span><span class="ident" id="4904956"><a href="/gostd/text/template/funcs.go.html#3720973">FuncMap</a></span><span class="op" id="4904963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4904966">&#34;html_template_attrescaper&#34;</span><span class="op" id="4904993">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4904999"><a href="/gostd/html/template/html.go.html#4929392">attrEscaper</a></span><span class="op" id="4905010">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905013">&#34;html_template_commentescaper&#34;</span><span class="op" id="4905043">:</span>&nbsp;&nbsp;<span class="ident" id="4905046"><a href="/gostd/html/template/html.go.html#4935925">commentEscaper</a></span><span class="op" id="4905060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905063">&#34;html_template_cssescaper&#34;</span><span class="op" id="4905089">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905096"><a href="/gostd/html/template/css.go.html#4886873">cssEscaper</a></span><span class="op" id="4905106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905109">&#34;html_template_cssvaluefilter&#34;</span><span class="op" id="4905139">:</span>&nbsp;&nbsp;<span class="ident" id="4905142"><a href="/gostd/html/template/css.go.html#4888389">cssValueFilter</a></span><span class="op" id="4905156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905159">&#34;html_template_htmlnamefilter&#34;</span><span class="op" id="4905189">:</span>&nbsp;&nbsp;<span class="ident" id="4905192"><a href="/gostd/html/template/html.go.html#4934854">htmlNameFilter</a></span><span class="op" id="4905206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905209">&#34;html_template_htmlescaper&#34;</span><span class="op" id="4905236">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905242"><a href="/gostd/html/template/html.go.html#4929956">htmlEscaper</a></span><span class="op" id="4905253">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905256">&#34;html_template_jsregexpescaper&#34;</span><span class="op" id="4905287">:</span>&nbsp;<span class="ident" id="4905289"><a href="/gostd/html/template/js.go.html#4943289">jsRegexpEscaper</a></span><span class="op" id="4905304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905307">&#34;html_template_jsstrescaper&#34;</span><span class="op" id="4905335">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905340"><a href="/gostd/html/template/js.go.html#4942805">jsStrEscaper</a></span><span class="op" id="4905352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905355">&#34;html_template_jsvalescaper&#34;</span><span class="op" id="4905383">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905388"><a href="/gostd/html/template/js.go.html#4940394">jsValEscaper</a></span><span class="op" id="4905400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905403">&#34;html_template_nospaceescaper&#34;</span><span class="op" id="4905433">:</span>&nbsp;&nbsp;<span class="ident" id="4905436"><a href="/gostd/html/template/html.go.html#4929076">htmlNospaceEscaper</a></span><span class="op" id="4905454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905457">&#34;html_template_rcdataescaper&#34;</span><span class="op" id="4905486">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4905490"><a href="/gostd/html/template/html.go.html#4929686">rcdataEscaper</a></span><span class="op" id="4905503">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905506">&#34;html_template_urlescaper&#34;</span><span class="op" id="4905532">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905539"><a href="/gostd/html/template/url.go.html#4974127">urlEscaper</a></span><span class="op" id="4905549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905552">&#34;html_template_urlfilter&#34;</span><span class="op" id="4905577">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4905585"><a href="/gostd/html/template/url.go.html#4973624">urlFilter</a></span><span class="op" id="4905594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905597">&#34;html_template_urlnormalizer&#34;</span><span class="op" id="4905626">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4905630"><a href="/gostd/html/template/url.go.html#4974513">urlNormalizer</a></span><span class="op" id="4905643">,</span><br>
<span class="lineno"></span><span class="op" id="4905645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4905648">//&nbsp;equivEscapers&nbsp;matches&nbsp;contextual&nbsp;escapers&nbsp;to&nbsp;equivalent&nbsp;template&nbsp;builtins.</span><br>
<span class="lineno"></span><span class="keyword" id="4905726">var</span>&nbsp;<span class="ident" id="4905730">equivEscapers</span>&nbsp;<span class="op" id="4905744">=</span>&nbsp;<span class="keyword" id="4905746">map</span><span class="op" id="4905749">[</span><span class="builtintype" id="4905750">string</span><span class="op" id="4905756">]</span><span class="builtintype" id="4905757">string</span><span class="op" id="4905763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905766">&#34;html_template_attrescaper&#34;</span><span class="op" id="4905793">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905798">&#34;html&#34;</span><span class="op" id="4905804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905807">&#34;html_template_htmlescaper&#34;</span><span class="op" id="4905834">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905839">&#34;html&#34;</span><span class="op" id="4905845">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905848">&#34;html_template_nospaceescaper&#34;</span><span class="op" id="4905878">:</span>&nbsp;<span class="string" id="4905880">&#34;html&#34;</span><span class="op" id="4905886">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905889">&#34;html_template_rcdataescaper&#34;</span><span class="op" id="4905918">:</span>&nbsp;&nbsp;<span class="string" id="4905921">&#34;html&#34;</span><span class="op" id="4905927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905930">&#34;html_template_urlescaper&#34;</span><span class="op" id="4905956">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905962">&#34;urlquery&#34;</span><span class="op" id="4905972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4905975">&#34;html_template_urlnormalizer&#34;</span><span class="op" id="4906004">:</span>&nbsp;&nbsp;<span class="string" id="4906007">&#34;urlquery&#34;</span><span class="op" id="4906017">,</span><br>
<span class="lineno"></span><span class="op" id="4906019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="4906022">//&nbsp;escaper&nbsp;collects&nbsp;type&nbsp;inferences&nbsp;about&nbsp;templates&nbsp;and&nbsp;changes&nbsp;needed&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span><span class="comment" id="4906101">//&nbsp;templates&nbsp;injection&nbsp;safe.</span><br>
<span class="lineno"></span><span class="keyword" id="4906130">type</span>&nbsp;<span class="ident" id="4906135">escaper</span>&nbsp;<span class="keyword" id="4906143">struct</span>&nbsp;<span class="op" id="4906150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906153">tmpl</span>&nbsp;<span class="op" id="4906158">*</span><span class="ident" id="4906159"><a href="/gostd/html/template/template.go.html#4946616">Template</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906169">//&nbsp;output[templateName]&nbsp;is&nbsp;the&nbsp;output&nbsp;context&nbsp;for&nbsp;a&nbsp;templateName&nbsp;that</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906240">//&nbsp;has&nbsp;been&nbsp;mangled&nbsp;to&nbsp;include&nbsp;its&nbsp;input&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906291">output</span>&nbsp;<span class="keyword" id="4906298">map</span><span class="op" id="4906301">[</span><span class="builtintype" id="4906302">string</span><span class="op" id="4906308">]</span><span class="ident" id="4906309"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906318">//&nbsp;derived[c.mangle(name)]&nbsp;maps&nbsp;to&nbsp;a&nbsp;template&nbsp;derived&nbsp;from&nbsp;the&nbsp;template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906391">//&nbsp;named&nbsp;name&nbsp;templateName&nbsp;for&nbsp;the&nbsp;start&nbsp;context&nbsp;c.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906444">derived</span>&nbsp;<span class="keyword" id="4906452">map</span><span class="op" id="4906455">[</span><span class="builtintype" id="4906456">string</span><span class="op" id="4906462">]</span><span class="op" id="4906463">*</span><span class="ident" id="4906464"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4906472">.</span><span class="ident" id="4906473"><a href="/gostd/text/template/template.go.html#3739702">Template</a></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906483">//&nbsp;called[templateName]&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;called&nbsp;mangled&nbsp;template&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906551">called</span>&nbsp;<span class="keyword" id="4906558">map</span><span class="op" id="4906561">[</span><span class="builtintype" id="4906562">string</span><span class="op" id="4906568">]</span><span class="builtintype" id="4906569">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906575">//&nbsp;xxxNodeEdits&nbsp;are&nbsp;the&nbsp;accumulated&nbsp;edits&nbsp;to&nbsp;apply&nbsp;during&nbsp;commit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906642">//&nbsp;Such&nbsp;edits&nbsp;are&nbsp;not&nbsp;applied&nbsp;immediately&nbsp;in&nbsp;case&nbsp;a&nbsp;template&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4906708">//&nbsp;executes&nbsp;a&nbsp;given&nbsp;template&nbsp;in&nbsp;different&nbsp;escaping&nbsp;contexts.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906770">actionNodeEdits</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906788">map</span><span class="op" id="4906791">[</span><span class="op" id="4906792">*</span><span class="ident" id="4906793"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4906798">.</span><span class="ident" id="4906799"><a href="/gostd/text/template/parse/node.go.html#3165284">ActionNode</a></span><span class="op" id="4906809">]</span><span class="op" id="4906810">[</span><span class="op" id="4906811">]</span><span class="builtintype" id="4906812">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906820">templateNodeEdits</span>&nbsp;<span class="keyword" id="4906838">map</span><span class="op" id="4906841">[</span><span class="op" id="4906842">*</span><span class="ident" id="4906843"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4906848">.</span><span class="ident" id="4906849"><a href="/gostd/text/template/parse/node.go.html#3179791">TemplateNode</a></span><span class="op" id="4906861">]</span><span class="builtintype" id="4906862">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4906870">textNodeEdits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4906888">map</span><span class="op" id="4906891">[</span><span class="op" id="4906892">*</span><span class="ident" id="4906893"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4906898">.</span><span class="ident" id="4906899"><a href="/gostd/text/template/parse/node.go.html#3163353">TextNode</a></span><span class="op" id="4906907">]</span><span class="op" id="4906908">[</span><span class="op" id="4906909">]</span><span class="builtintype" id="4906910">byte</span><br>
<span class="lineno"></span><span class="op" id="4906915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4906918">//&nbsp;newEscaper&nbsp;creates&nbsp;a&nbsp;blank&nbsp;escaper&nbsp;for&nbsp;the&nbsp;given&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="4906975">func</span>&nbsp;<span class="ident" id="4906980">newEscaper</span><span class="op" id="4906990">(</span><span class="ident" id="4906991">t</span>&nbsp;<span class="op" id="4906993">*</span><span class="ident" id="4906994"><a href="/gostd/html/template/template.go.html#4946616">Template</a></span><span class="op" id="4907002">)</span>&nbsp;<span class="op" id="4907004">*</span><span class="ident" id="4907005"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span>&nbsp;<span class="op" id="4907013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907016">return</span>&nbsp;<span class="op" id="4907023">&amp;</span><span class="ident" id="4907024"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4907031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4907035"><a href="/gostd/html/template/escape.go.html#4906991">t</a></span><span class="op" id="4907036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907040">map</span><span class="op" id="4907043">[</span><span class="builtintype" id="4907044">string</span><span class="op" id="4907050">]</span><span class="ident" id="4907051"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4907058">{</span><span class="op" id="4907059">}</span><span class="op" id="4907060">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907064">map</span><span class="op" id="4907067">[</span><span class="builtintype" id="4907068">string</span><span class="op" id="4907074">]</span><span class="op" id="4907075">*</span><span class="ident" id="4907076"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4907084">.</span><span class="ident" id="4907085"><a href="/gostd/text/template/template.go.html#3739702">Template</a></span><span class="op" id="4907093">{</span><span class="op" id="4907094">}</span><span class="op" id="4907095">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907099">map</span><span class="op" id="4907102">[</span><span class="builtintype" id="4907103">string</span><span class="op" id="4907109">]</span><span class="builtintype" id="4907110">bool</span><span class="op" id="4907114">{</span><span class="op" id="4907115">}</span><span class="op" id="4907116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907120">map</span><span class="op" id="4907123">[</span><span class="op" id="4907124">*</span><span class="ident" id="4907125"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4907130">.</span><span class="ident" id="4907131"><a href="/gostd/text/template/parse/node.go.html#3165284">ActionNode</a></span><span class="op" id="4907141">]</span><span class="op" id="4907142">[</span><span class="op" id="4907143">]</span><span class="builtintype" id="4907144">string</span><span class="op" id="4907150">{</span><span class="op" id="4907151">}</span><span class="op" id="4907152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907156">map</span><span class="op" id="4907159">[</span><span class="op" id="4907160">*</span><span class="ident" id="4907161"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4907166">.</span><span class="ident" id="4907167"><a href="/gostd/text/template/parse/node.go.html#3179791">TemplateNode</a></span><span class="op" id="4907179">]</span><span class="builtintype" id="4907180">string</span><span class="op" id="4907186">{</span><span class="op" id="4907187">}</span><span class="op" id="4907188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907192">map</span><span class="op" id="4907195">[</span><span class="op" id="4907196">*</span><span class="ident" id="4907197"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4907202">.</span><span class="ident" id="4907203"><a href="/gostd/text/template/parse/node.go.html#3163353">TextNode</a></span><span class="op" id="4907211">]</span><span class="op" id="4907212">[</span><span class="op" id="4907213">]</span><span class="builtintype" id="4907214">byte</span><span class="op" id="4907218">{</span><span class="op" id="4907219">}</span><span class="op" id="4907220">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4907223">}</span><br>
<span class="lineno"></span><span class="op" id="4907225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4907228">//&nbsp;filterFailsafe&nbsp;is&nbsp;an&nbsp;innocuous&nbsp;word&nbsp;that&nbsp;is&nbsp;emitted&nbsp;in&nbsp;place&nbsp;of&nbsp;unsafe&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4907309">//&nbsp;by&nbsp;sanitizer&nbsp;functions.&nbsp;It&nbsp;is&nbsp;not&nbsp;a&nbsp;keyword&nbsp;in&nbsp;any&nbsp;programming&nbsp;language,</span><br>
<span class="lineno">110</span><span class="comment" id="4907385">//&nbsp;contains&nbsp;no&nbsp;special&nbsp;characters,&nbsp;is&nbsp;not&nbsp;empty,&nbsp;and&nbsp;when&nbsp;it&nbsp;appears&nbsp;in&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="4907464">//&nbsp;it&nbsp;is&nbsp;distinct&nbsp;enough&nbsp;that&nbsp;a&nbsp;developer&nbsp;can&nbsp;find&nbsp;the&nbsp;source&nbsp;of&nbsp;the&nbsp;problem</span><br>
<span class="lineno"></span><span class="comment" id="4907541">//&nbsp;via&nbsp;a&nbsp;search&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="4907565">const</span>&nbsp;<span class="ident" id="4907571">filterFailsafe</span>&nbsp;<span class="op" id="4907586">=</span>&nbsp;<span class="string" id="4907588">&#34;ZgotmplZ&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4907600">//&nbsp;escape&nbsp;escapes&nbsp;a&nbsp;template&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4907635">func</span>&nbsp;<span class="op" id="4907640">(</span><span class="ident" id="4907641">e</span>&nbsp;<span class="op" id="4907643">*</span><span class="ident" id="4907644"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4907651">)</span>&nbsp;<span class="ident" id="4907653">escape</span><span class="op" id="4907659">(</span><span class="ident" id="4907660">c</span>&nbsp;<span class="ident" id="4907662"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4907669">,</span>&nbsp;<span class="ident" id="4907671">n</span>&nbsp;<span class="ident" id="4907673"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4907678">.</span><span class="ident" id="4907679"><a href="/gostd/text/template/parse/node.go.html#3160534">Node</a></span><span class="op" id="4907683">)</span>&nbsp;<span class="ident" id="4907685"><a href="/gostd/html/template/context.go.html#4872948">context</a></span>&nbsp;<span class="op" id="4907693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907696">switch</span>&nbsp;<span class="ident" id="4907703">n</span>&nbsp;<span class="op" id="4907705">:=</span>&nbsp;<span class="ident" id="4907708"><a href="/gostd/html/template/escape.go.html#4907671">n</a></span><span class="op" id="4907709">.</span><span class="op" id="4907710">(</span><span class="keyword" id="4907711">type</span><span class="op" id="4907715">)</span>&nbsp;<span class="op" id="4907717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907720">case</span>&nbsp;<span class="op" id="4907725">*</span><span class="ident" id="4907726"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4907731">.</span><span class="ident" id="4907732"><a href="/gostd/text/template/parse/node.go.html#3165284">ActionNode</a></span><span class="op" id="4907742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907746">return</span>&nbsp;<span class="ident" id="4907753"><a href="/gostd/html/template/escape.go.html#4907641">e</a></span><span class="op" id="4907754">.</span><span class="ident" id="4907755"><a href="/gostd/html/template/escape.go.html#4908280">escapeAction</a></span><span class="op" id="4907767">(</span><span class="ident" id="4907768"><a href="/gostd/html/template/escape.go.html#4907660">c</a></span><span class="op" id="4907769">,</span>&nbsp;<span class="ident" id="4907771"><a href="/gostd/html/template/escape.go.html#4907703">n</a></span><span class="op" id="4907772">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907775">case</span>&nbsp;<span class="op" id="4907780">*</span><span class="ident" id="4907781"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4907786">.</span><span class="ident" id="4907787"><a href="/gostd/text/template/parse/node.go.html#3178449">IfNode</a></span><span class="op" id="4907793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907797">return</span>&nbsp;<span class="ident" id="4907804"><a href="/gostd/html/template/escape.go.html#4907641">e</a></span><span class="op" id="4907805">.</span><span class="ident" id="4907806"><a href="/gostd/html/template/escape.go.html#4916261">escapeBranch</a></span><span class="op" id="4907818">(</span><span class="ident" id="4907819"><a href="/gostd/html/template/escape.go.html#4907660">c</a></span><span class="op" id="4907820">,</span>&nbsp;<span class="op" id="4907822">&amp;</span><span class="ident" id="4907823"><a href="/gostd/html/template/escape.go.html#4907703">n</a></span><span class="op" id="4907824">.</span><span class="ident" id="4907825"><a href="/gostd/text/template/parse/node.go.html#3178466">BranchNode</a></span><span class="op" id="4907835">,</span>&nbsp;<span class="string" id="4907837">&#34;if&#34;</span><span class="op" id="4907841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907844">case</span>&nbsp;<span class="op" id="4907849">*</span><span class="ident" id="4907850"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4907855">.</span><span class="ident" id="4907856"><a href="/gostd/text/template/parse/node.go.html#3162635">ListNode</a></span><span class="op" id="4907864">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907868">return</span>&nbsp;<span class="ident" id="4907875"><a href="/gostd/html/template/escape.go.html#4907641">e</a></span><span class="op" id="4907876">.</span><span class="ident" id="4907877"><a href="/gostd/html/template/escape.go.html#4917094">escapeList</a></span><span class="op" id="4907887">(</span><span class="ident" id="4907888"><a href="/gostd/html/template/escape.go.html#4907660">c</a></span><span class="op" id="4907889">,</span>&nbsp;<span class="ident" id="4907891"><a href="/gostd/html/template/escape.go.html#4907703">n</a></span><span class="op" id="4907892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907895">case</span>&nbsp;<span class="op" id="4907900">*</span><span class="ident" id="4907901"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4907906">.</span><span class="ident" id="4907907"><a href="/gostd/text/template/parse/node.go.html#3178889">RangeNode</a></span><span class="op" id="4907916">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907920">return</span>&nbsp;<span class="ident" id="4907927"><a href="/gostd/html/template/escape.go.html#4907641">e</a></span><span class="op" id="4907928">.</span><span class="ident" id="4907929"><a href="/gostd/html/template/escape.go.html#4916261">escapeBranch</a></span><span class="op" id="4907941">(</span><span class="ident" id="4907942"><a href="/gostd/html/template/escape.go.html#4907660">c</a></span><span class="op" id="4907943">,</span>&nbsp;<span class="op" id="4907945">&amp;</span><span class="ident" id="4907946"><a href="/gostd/html/template/escape.go.html#4907703">n</a></span><span class="op" id="4907947">.</span><span class="ident" id="4907948"><a href="/gostd/text/template/parse/node.go.html#3178909">BranchNode</a></span><span class="op" id="4907958">,</span>&nbsp;<span class="string" id="4907960">&#34;range&#34;</span><span class="op" id="4907967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907970">case</span>&nbsp;<span class="op" id="4907975">*</span><span class="ident" id="4907976"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4907981">.</span><span class="ident" id="4907982"><a href="/gostd/text/template/parse/node.go.html#3179791">TemplateNode</a></span><span class="op" id="4907994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4907998">return</span>&nbsp;<span class="ident" id="4908005"><a href="/gostd/html/template/escape.go.html#4907641">e</a></span><span class="op" id="4908006">.</span><span class="ident" id="4908007"><a href="/gostd/html/template/escape.go.html#4918355">escapeTemplate</a></span><span class="op" id="4908021">(</span><span class="ident" id="4908022"><a href="/gostd/html/template/escape.go.html#4907660">c</a></span><span class="op" id="4908023">,</span>&nbsp;<span class="ident" id="4908025"><a href="/gostd/html/template/escape.go.html#4907703">n</a></span><span class="op" id="4908026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908029">case</span>&nbsp;<span class="op" id="4908034">*</span><span class="ident" id="4908035"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4908040">.</span><span class="ident" id="4908041"><a href="/gostd/text/template/parse/node.go.html#3163353">TextNode</a></span><span class="op" id="4908049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908053">return</span>&nbsp;<span class="ident" id="4908060"><a href="/gostd/html/template/escape.go.html#4907641">e</a></span><span class="op" id="4908061">.</span><span class="ident" id="4908062"><a href="/gostd/html/template/escape.go.html#4922129">escapeText</a></span><span class="op" id="4908072">(</span><span class="ident" id="4908073"><a href="/gostd/html/template/escape.go.html#4907660">c</a></span><span class="op" id="4908074">,</span>&nbsp;<span class="ident" id="4908076"><a href="/gostd/html/template/escape.go.html#4907703">n</a></span><span class="op" id="4908077">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908080">case</span>&nbsp;<span class="op" id="4908085">*</span><span class="ident" id="4908086"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4908091">.</span><span class="ident" id="4908092"><a href="/gostd/text/template/parse/node.go.html#3179348">WithNode</a></span><span class="op" id="4908100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908104">return</span>&nbsp;<span class="ident" id="4908111"><a href="/gostd/html/template/escape.go.html#4907641">e</a></span><span class="op" id="4908112">.</span><span class="ident" id="4908113"><a href="/gostd/html/template/escape.go.html#4916261">escapeBranch</a></span><span class="op" id="4908125">(</span><span class="ident" id="4908126"><a href="/gostd/html/template/escape.go.html#4907660">c</a></span><span class="op" id="4908127">,</span>&nbsp;<span class="op" id="4908129">&amp;</span><span class="ident" id="4908130"><a href="/gostd/html/template/escape.go.html#4907703">n</a></span><span class="op" id="4908131">.</span><span class="ident" id="4908132"><a href="/gostd/text/template/parse/node.go.html#3179367">BranchNode</a></span><span class="op" id="4908142">,</span>&nbsp;<span class="string" id="4908144">&#34;with&#34;</span><span class="op" id="4908150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4908153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4908156">panic</span><span class="op" id="4908161">(</span><span class="string" id="4908162">&#34;escaping&nbsp;&#34;</span>&nbsp;<span class="op" id="4908174">+</span>&nbsp;<span class="ident" id="4908176"><a href="/gostd/html/template/escape.go.html#4907671">n</a></span><span class="op" id="4908177">.</span><span class="ident" id="4908178"><a href="/gostd/text/template/parse/node.go.html#3160569">String</a></span><span class="op" id="4908184">(</span><span class="op" id="4908185">)</span>&nbsp;<span class="op" id="4908187">+</span>&nbsp;<span class="string" id="4908189">&#34;&nbsp;is&nbsp;unimplemented&#34;</span><span class="op" id="4908208">)</span><br>
<span class="lineno"></span><span class="op" id="4908210">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="4908213">//&nbsp;escapeAction&nbsp;escapes&nbsp;an&nbsp;action&nbsp;template&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4908262">func</span>&nbsp;<span class="op" id="4908267">(</span><span class="ident" id="4908268">e</span>&nbsp;<span class="op" id="4908270">*</span><span class="ident" id="4908271"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4908278">)</span>&nbsp;<span class="ident" id="4908280">escapeAction</span><span class="op" id="4908292">(</span><span class="ident" id="4908293">c</span>&nbsp;<span class="ident" id="4908295"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4908302">,</span>&nbsp;<span class="ident" id="4908304">n</span>&nbsp;<span class="op" id="4908306">*</span><span class="ident" id="4908307"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4908312">.</span><span class="ident" id="4908313"><a href="/gostd/text/template/parse/node.go.html#3165284">ActionNode</a></span><span class="op" id="4908323">)</span>&nbsp;<span class="ident" id="4908325"><a href="/gostd/html/template/context.go.html#4872948">context</a></span>&nbsp;<span class="op" id="4908333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908336">if</span>&nbsp;<span class="builtinfunc" id="4908339">len</span><span class="op" id="4908342">(</span><span class="ident" id="4908343"><a href="/gostd/html/template/escape.go.html#4908304">n</a></span><span class="op" id="4908344">.</span><span class="ident" id="4908345"><a href="/gostd/text/template/parse/node.go.html#3165417">Pipe</a></span><span class="op" id="4908349">.</span><span class="ident" id="4908350"><a href="/gostd/text/template/parse/node.go.html#3164039">Decl</a></span><span class="op" id="4908354">)</span>&nbsp;<span class="op" id="4908356">!=</span>&nbsp;<span class="num" id="4908359">0</span>&nbsp;<span class="op" id="4908361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4908365">//&nbsp;A&nbsp;local&nbsp;variable&nbsp;assignment,&nbsp;not&nbsp;an&nbsp;interpolation.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908421">return</span>&nbsp;<span class="ident" id="4908428"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4908431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908434"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span>&nbsp;<span class="op" id="4908436">=</span>&nbsp;<span class="ident" id="4908438"><a href="/gostd/html/template/escape.go.html#4914598">nudge</a></span><span class="op" id="4908443">(</span><span class="ident" id="4908444"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><span class="op" id="4908445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908448">s</span>&nbsp;<span class="op" id="4908450">:=</span>&nbsp;<span class="builtinfunc" id="4908453">make</span><span class="op" id="4908457">(</span><span class="op" id="4908458">[</span><span class="op" id="4908459">]</span><span class="builtintype" id="4908460">string</span><span class="op" id="4908466">,</span>&nbsp;<span class="num" id="4908468">0</span><span class="op" id="4908469">,</span>&nbsp;<span class="num" id="4908471">3</span><span class="op" id="4908472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908475">switch</span>&nbsp;<span class="ident" id="4908482"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><span class="op" id="4908483">.</span><span class="ident" id="4908484"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4908490">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908493">case</span>&nbsp;<span class="ident" id="4908498"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span><span class="op" id="4908508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908512">return</span>&nbsp;<span class="ident" id="4908519"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908522">case</span>&nbsp;<span class="ident" id="4908527"><a href="/gostd/html/template/context.go.html#4875729">stateURL</a></span><span class="op" id="4908535">,</span>&nbsp;<span class="ident" id="4908537"><a href="/gostd/html/template/context.go.html#4876345">stateCSSDqStr</a></span><span class="op" id="4908550">,</span>&nbsp;<span class="ident" id="4908552"><a href="/gostd/html/template/context.go.html#4876420">stateCSSSqStr</a></span><span class="op" id="4908565">,</span>&nbsp;<span class="ident" id="4908567"><a href="/gostd/html/template/context.go.html#4876499">stateCSSDqURL</a></span><span class="op" id="4908580">,</span>&nbsp;<span class="ident" id="4908582"><a href="/gostd/html/template/context.go.html#4876578">stateCSSSqURL</a></span><span class="op" id="4908595">,</span>&nbsp;<span class="ident" id="4908597"><a href="/gostd/html/template/context.go.html#4876648">stateCSSURL</a></span><span class="op" id="4908608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908612">switch</span>&nbsp;<span class="ident" id="4908619"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><span class="op" id="4908620">.</span><span class="ident" id="4908621"><a href="/gostd/html/template/context.go.html#4872996">urlPart</a></span>&nbsp;<span class="op" id="4908629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908633">case</span>&nbsp;<span class="ident" id="4908638"><a href="/gostd/html/template/context.go.html#4879478">urlPartNone</a></span><span class="op" id="4908649">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908654"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4908656">=</span>&nbsp;<span class="builtinfunc" id="4908658">append</span><span class="op" id="4908664">(</span><span class="ident" id="4908665"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4908666">,</span>&nbsp;<span class="string" id="4908668">&#34;html_template_urlfilter&#34;</span><span class="op" id="4908693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908698">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908712">case</span>&nbsp;<span class="ident" id="4908717"><a href="/gostd/html/template/context.go.html#4879621">urlPartPreQuery</a></span><span class="op" id="4908732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908737">switch</span>&nbsp;<span class="ident" id="4908744"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><span class="op" id="4908745">.</span><span class="ident" id="4908746"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4908752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908757">case</span>&nbsp;<span class="ident" id="4908762"><a href="/gostd/html/template/context.go.html#4876345">stateCSSDqStr</a></span><span class="op" id="4908775">,</span>&nbsp;<span class="ident" id="4908777"><a href="/gostd/html/template/context.go.html#4876420">stateCSSSqStr</a></span><span class="op" id="4908790">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908796"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4908798">=</span>&nbsp;<span class="builtinfunc" id="4908800">append</span><span class="op" id="4908806">(</span><span class="ident" id="4908807"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4908808">,</span>&nbsp;<span class="string" id="4908810">&#34;html_template_cssescaper&#34;</span><span class="op" id="4908836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908841">default</span><span class="op" id="4908848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908854"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4908856">=</span>&nbsp;<span class="builtinfunc" id="4908858">append</span><span class="op" id="4908864">(</span><span class="ident" id="4908865"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4908866">,</span>&nbsp;<span class="string" id="4908868">&#34;html_template_urlnormalizer&#34;</span><span class="op" id="4908897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4908902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908906">case</span>&nbsp;<span class="ident" id="4908911"><a href="/gostd/html/template/context.go.html#4879742">urlPartQueryOrFrag</a></span><span class="op" id="4908929">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4908934"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4908936">=</span>&nbsp;<span class="builtinfunc" id="4908938">append</span><span class="op" id="4908944">(</span><span class="ident" id="4908945"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4908946">,</span>&nbsp;<span class="string" id="4908948">&#34;html_template_urlescaper&#34;</span><span class="op" id="4908974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4908978">case</span>&nbsp;<span class="ident" id="4908983"><a href="/gostd/html/template/context.go.html#4879862">urlPartUnknown</a></span><span class="op" id="4908997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909002">return</span>&nbsp;<span class="ident" id="4909009"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4909016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909022"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4909027">:</span>&nbsp;<span class="ident" id="4909029"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span><span class="op" id="4909039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909045"><a href="/gostd/html/template/context.go.html#4873059">err</a></span><span class="op" id="4909048">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4909052"><a href="/gostd/html/template/error.go.html#4903515">errorf</a></span><span class="op" id="4909058">(</span><span class="ident" id="4909059"><a href="/gostd/html/template/error.go.html#4897940">ErrAmbigContext</a></span><span class="op" id="4909074">,</span>&nbsp;<span class="ident" id="4909076"><a href="/gostd/html/template/escape.go.html#4908304">n</a></span><span class="op" id="4909077">,</span>&nbsp;<span class="ident" id="4909079"><a href="/gostd/html/template/escape.go.html#4908304">n</a></span><span class="op" id="4909080">.</span><span class="ident" id="4909081"><a href="/gostd/text/template/parse/node.go.html#3165332">Line</a></span><span class="op" id="4909085">,</span>&nbsp;<span class="string" id="4909087">&#34;%s&nbsp;appears&nbsp;in&nbsp;an&nbsp;ambiguous&nbsp;URL&nbsp;context&#34;</span><span class="op" id="4909127">,</span>&nbsp;<span class="ident" id="4909129"><a href="/gostd/html/template/escape.go.html#4908304">n</a></span><span class="op" id="4909130">)</span><span class="op" id="4909131">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4909136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909140">default</span><span class="op" id="4909147">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4909152">panic</span><span class="op" id="4909157">(</span><span class="ident" id="4909158"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><span class="op" id="4909159">.</span><span class="ident" id="4909160"><a href="/gostd/html/template/context.go.html#4872996">urlPart</a></span><span class="op" id="4909167">.</span><span class="ident" id="4909168"><a href="/gostd/html/template/context.go.html#4880090">String</a></span><span class="op" id="4909174">(</span><span class="op" id="4909175">)</span><span class="op" id="4909176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4909180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909183">case</span>&nbsp;<span class="ident" id="4909188"><a href="/gostd/html/template/context.go.html#4875801">stateJS</a></span><span class="op" id="4909195">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909199"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4909201">=</span>&nbsp;<span class="builtinfunc" id="4909203">append</span><span class="op" id="4909209">(</span><span class="ident" id="4909210"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4909211">,</span>&nbsp;<span class="string" id="4909213">&#34;html_template_jsvalescaper&#34;</span><span class="op" id="4909241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909245">//&nbsp;A&nbsp;slash&nbsp;after&nbsp;a&nbsp;value&nbsp;starts&nbsp;a&nbsp;div&nbsp;operator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909295"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><span class="op" id="4909296">.</span><span class="ident" id="4909297"><a href="/gostd/html/template/context.go.html#4873013">jsCtx</a></span>&nbsp;<span class="op" id="4909303">=</span>&nbsp;<span class="ident" id="4909305"><a href="/gostd/html/template/context.go.html#4880504">jsCtxDivOp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909317">case</span>&nbsp;<span class="ident" id="4909322"><a href="/gostd/html/template/context.go.html#4875876">stateJSDqStr</a></span><span class="op" id="4909334">,</span>&nbsp;<span class="ident" id="4909336"><a href="/gostd/html/template/context.go.html#4875956">stateJSSqStr</a></span><span class="op" id="4909348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909352"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4909354">=</span>&nbsp;<span class="builtinfunc" id="4909356">append</span><span class="op" id="4909362">(</span><span class="ident" id="4909363"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4909364">,</span>&nbsp;<span class="string" id="4909366">&#34;html_template_jsstrescaper&#34;</span><span class="op" id="4909394">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909397">case</span>&nbsp;<span class="ident" id="4909402"><a href="/gostd/html/template/context.go.html#4876031">stateJSRegexp</a></span><span class="op" id="4909415">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909419"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4909421">=</span>&nbsp;<span class="builtinfunc" id="4909423">append</span><span class="op" id="4909429">(</span><span class="ident" id="4909430"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4909431">,</span>&nbsp;<span class="string" id="4909433">&#34;html_template_jsregexpescaper&#34;</span><span class="op" id="4909464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909467">case</span>&nbsp;<span class="ident" id="4909472"><a href="/gostd/html/template/context.go.html#4876275">stateCSS</a></span><span class="op" id="4909480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909484"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4909486">=</span>&nbsp;<span class="builtinfunc" id="4909488">append</span><span class="op" id="4909494">(</span><span class="ident" id="4909495"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4909496">,</span>&nbsp;<span class="string" id="4909498">&#34;html_template_cssvaluefilter&#34;</span><span class="op" id="4909528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909531">case</span>&nbsp;<span class="ident" id="4909536"><a href="/gostd/html/template/context.go.html#4874843">stateText</a></span><span class="op" id="4909545">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909549"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4909551">=</span>&nbsp;<span class="builtinfunc" id="4909553">append</span><span class="op" id="4909559">(</span><span class="ident" id="4909560"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4909561">,</span>&nbsp;<span class="string" id="4909563">&#34;html_template_htmlescaper&#34;</span><span class="op" id="4909590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909593">case</span>&nbsp;<span class="ident" id="4909598"><a href="/gostd/html/template/context.go.html#4875567">stateRCDATA</a></span><span class="op" id="4909609">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909613"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4909615">=</span>&nbsp;<span class="builtinfunc" id="4909617">append</span><span class="op" id="4909623">(</span><span class="ident" id="4909624"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4909625">,</span>&nbsp;<span class="string" id="4909627">&#34;html_template_rcdataescaper&#34;</span><span class="op" id="4909656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909659">case</span>&nbsp;<span class="ident" id="4909664"><a href="/gostd/html/template/context.go.html#4875649">stateAttr</a></span><span class="op" id="4909673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4909677">//&nbsp;Handled&nbsp;below&nbsp;in&nbsp;delim&nbsp;check.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909711">case</span>&nbsp;<span class="ident" id="4909716"><a href="/gostd/html/template/context.go.html#4875046">stateAttrName</a></span><span class="op" id="4909729">,</span>&nbsp;<span class="ident" id="4909731"><a href="/gostd/html/template/context.go.html#4874933">stateTag</a></span><span class="op" id="4909739">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909743"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><span class="op" id="4909744">.</span><span class="ident" id="4909745"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4909751">=</span>&nbsp;<span class="ident" id="4909753"><a href="/gostd/html/template/context.go.html#4875046">stateAttrName</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909769"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4909771">=</span>&nbsp;<span class="builtinfunc" id="4909773">append</span><span class="op" id="4909779">(</span><span class="ident" id="4909780"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4909781">,</span>&nbsp;<span class="string" id="4909783">&#34;html_template_htmlnamefilter&#34;</span><span class="op" id="4909813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909816">default</span><span class="op" id="4909823">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909827">if</span>&nbsp;<span class="ident" id="4909830"><a href="/gostd/html/template/context.go.html#4878067">isComment</a></span><span class="op" id="4909839">(</span><span class="ident" id="4909840"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><span class="op" id="4909841">.</span><span class="ident" id="4909842"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4909847">)</span>&nbsp;<span class="op" id="4909849">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4909854"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4909856">=</span>&nbsp;<span class="builtinfunc" id="4909858">append</span><span class="op" id="4909864">(</span><span class="ident" id="4909865"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4909866">,</span>&nbsp;<span class="string" id="4909868">&#34;html_template_commentescaper&#34;</span><span class="op" id="4909898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4909902">}</span>&nbsp;<span class="keyword" id="4909904">else</span>&nbsp;<span class="op" id="4909909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4909914">panic</span><span class="op" id="4909919">(</span><span class="string" id="4909920">&#34;unexpected&nbsp;state&nbsp;&#34;</span>&nbsp;<span class="op" id="4909940">+</span>&nbsp;<span class="ident" id="4909942"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><span class="op" id="4909943">.</span><span class="ident" id="4909944"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4909949">.</span><span class="ident" id="4909950"><a href="/gostd/html/template/context.go.html#4877803">String</a></span><span class="op" id="4909956">(</span><span class="op" id="4909957">)</span><span class="op" id="4909958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4909962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4909965">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909968">switch</span>&nbsp;<span class="ident" id="4909975"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><span class="op" id="4909976">.</span><span class="ident" id="4909977"><a href="/gostd/html/template/context.go.html#4872981">delim</a></span>&nbsp;<span class="op" id="4909983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4909986">case</span>&nbsp;<span class="ident" id="4909991"><a href="/gostd/html/template/context.go.html#4878579">delimNone</a></span><span class="op" id="4910000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4910004">//&nbsp;No&nbsp;extra-escaping&nbsp;needed&nbsp;for&nbsp;raw&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910055">case</span>&nbsp;<span class="ident" id="4910060"><a href="/gostd/html/template/context.go.html#4878883">delimSpaceOrTagEnd</a></span><span class="op" id="4910078">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910082"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4910084">=</span>&nbsp;<span class="builtinfunc" id="4910086">append</span><span class="op" id="4910092">(</span><span class="ident" id="4910093"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4910094">,</span>&nbsp;<span class="string" id="4910096">&#34;html_template_nospaceescaper&#34;</span><span class="op" id="4910126">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910129">default</span><span class="op" id="4910136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910140"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span>&nbsp;<span class="op" id="4910142">=</span>&nbsp;<span class="builtinfunc" id="4910144">append</span><span class="op" id="4910150">(</span><span class="ident" id="4910151"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4910152">,</span>&nbsp;<span class="string" id="4910154">&#34;html_template_attrescaper&#34;</span><span class="op" id="4910181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4910184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4910187"><a href="/gostd/html/template/escape.go.html#4908268">e</a></span><span class="op" id="4910188">.</span><span class="ident" id="4910189"><a href="/gostd/html/template/escape.go.html#4925834">editActionNode</a></span><span class="op" id="4910203">(</span><span class="ident" id="4910204"><a href="/gostd/html/template/escape.go.html#4908304">n</a></span><span class="op" id="4910205">,</span>&nbsp;<span class="ident" id="4910207"><a href="/gostd/html/template/escape.go.html#4908448">s</a></span><span class="op" id="4910208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910211">return</span>&nbsp;<span class="ident" id="4910218"><a href="/gostd/html/template/escape.go.html#4908293">c</a></span><br>
<span class="lineno">205</span><span class="op" id="4910220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4910223">//&nbsp;allIdents&nbsp;returns&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;identifiers&nbsp;under&nbsp;the&nbsp;Ident&nbsp;field&nbsp;of&nbsp;the&nbsp;node,</span><br>
<span class="lineno"></span><span class="comment" id="4910308">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;singleton&nbsp;(Identifier)&nbsp;or&nbsp;a&nbsp;slice&nbsp;(Field).</span><br>
<span class="lineno"></span><span class="keyword" id="4910371">func</span>&nbsp;<span class="ident" id="4910376">allIdents</span><span class="op" id="4910385">(</span><span class="ident" id="4910386">node</span>&nbsp;<span class="ident" id="4910391"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4910396">.</span><span class="ident" id="4910397"><a href="/gostd/text/template/parse/node.go.html#3160534">Node</a></span><span class="op" id="4910401">)</span>&nbsp;<span class="op" id="4910403">[</span><span class="op" id="4910404">]</span><span class="builtintype" id="4910405">string</span>&nbsp;<span class="op" id="4910412">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910415">switch</span>&nbsp;<span class="ident" id="4910422">node</span>&nbsp;<span class="op" id="4910427">:=</span>&nbsp;<span class="ident" id="4910430"><a href="/gostd/html/template/escape.go.html#4910386">node</a></span><span class="op" id="4910434">.</span><span class="op" id="4910435">(</span><span class="keyword" id="4910436">type</span><span class="op" id="4910440">)</span>&nbsp;<span class="op" id="4910442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910445">case</span>&nbsp;<span class="op" id="4910450">*</span><span class="ident" id="4910451"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4910456">.</span><span class="ident" id="4910457"><a href="/gostd/text/template/parse/node.go.html#3166735">IdentifierNode</a></span><span class="op" id="4910471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910475">return</span>&nbsp;<span class="op" id="4910482">[</span><span class="op" id="4910483">]</span><span class="builtintype" id="4910484">string</span><span class="op" id="4910490">{</span><span class="ident" id="4910491"><a href="/gostd/html/template/escape.go.html#4910422">node</a></span><span class="op" id="4910495">.</span><span class="ident" id="4910496"><a href="/gostd/text/template/parse/node.go.html#3166788">Ident</a></span><span class="op" id="4910501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910504">case</span>&nbsp;<span class="op" id="4910509">*</span><span class="ident" id="4910510"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4910515">.</span><span class="ident" id="4910516"><a href="/gostd/text/template/parse/node.go.html#3169795">FieldNode</a></span><span class="op" id="4910525">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4910529">return</span>&nbsp;<span class="ident" id="4910536"><a href="/gostd/html/template/escape.go.html#4910422">node</a></span><span class="op" id="4910540">.</span><span class="ident" id="4910541"><a href="/gostd/text/template/parse/node.go.html#3169843">Ident</a></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4910548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4910551">panic</span><span class="op" id="4910556">(</span><span class="string" id="4910557">&#34;unidentified&nbsp;node&nbsp;type&nbsp;in&nbsp;allIdents&#34;</span><span class="op" id="4910594">)</span><br>
<span class="lineno"></span><span class="op" id="4910596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4910599">//&nbsp;ensurePipelineContains&nbsp;ensures&nbsp;that&nbsp;the&nbsp;pipeline&nbsp;has&nbsp;commands&nbsp;with</span><br>
<span class="lineno">220</span><span class="comment" id="4910669">//&nbsp;the&nbsp;identifiers&nbsp;in&nbsp;s&nbsp;in&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="4910703">//&nbsp;If&nbsp;the&nbsp;pipeline&nbsp;already&nbsp;has&nbsp;some&nbsp;of&nbsp;the&nbsp;sanitizers,&nbsp;do&nbsp;not&nbsp;interfere.</span><br>
<span class="lineno"></span><span class="comment" id="4910776">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;p&nbsp;is&nbsp;(.X&nbsp;|&nbsp;html)&nbsp;and&nbsp;s&nbsp;is&nbsp;[&#34;escapeJSVal&#34;,&nbsp;&#34;html&#34;]&nbsp;then&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4910853">//&nbsp;has&nbsp;one&nbsp;matching,&nbsp;&#34;html&#34;,&nbsp;and&nbsp;one&nbsp;to&nbsp;insert,&nbsp;&#34;escapeJSVal&#34;,&nbsp;to&nbsp;produce</span><br>
<span class="lineno"></span><span class="comment" id="4910927">//&nbsp;(.X&nbsp;|&nbsp;escapeJSVal&nbsp;|&nbsp;html).</span><br>
<span class="lineno">225</span><span class="keyword" id="4910957">func</span>&nbsp;<span class="ident" id="4910962">ensurePipelineContains</span><span class="op" id="4910984">(</span><span class="ident" id="4910985">p</span>&nbsp;<span class="op" id="4910987">*</span><span class="ident" id="4910988"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4910993">.</span><span class="ident" id="4910994"><a href="/gostd/text/template/parse/node.go.html#3163902">PipeNode</a></span><span class="op" id="4911002">,</span>&nbsp;<span class="ident" id="4911004">s</span>&nbsp;<span class="op" id="4911006">[</span><span class="op" id="4911007">]</span><span class="builtintype" id="4911008">string</span><span class="op" id="4911014">)</span>&nbsp;<span class="op" id="4911016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911019">if</span>&nbsp;<span class="builtinfunc" id="4911022">len</span><span class="op" id="4911025">(</span><span class="ident" id="4911026"><a href="/gostd/html/template/escape.go.html#4911004">s</a></span><span class="op" id="4911027">)</span>&nbsp;<span class="op" id="4911029">==</span>&nbsp;<span class="num" id="4911032">0</span>&nbsp;<span class="op" id="4911034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911038">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911049">n</span>&nbsp;<span class="op" id="4911051">:=</span>&nbsp;<span class="builtinfunc" id="4911054">len</span><span class="op" id="4911057">(</span><span class="ident" id="4911058"><a href="/gostd/html/template/escape.go.html#4910985">p</a></span><span class="op" id="4911059">.</span><span class="ident" id="4911060"><a href="/gostd/text/template/parse/node.go.html#3164104">Cmds</a></span><span class="op" id="4911064">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4911067">//&nbsp;Find&nbsp;the&nbsp;identifiers&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;command&nbsp;chain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911125">idents</span>&nbsp;<span class="op" id="4911132">:=</span>&nbsp;<span class="ident" id="4911135"><a href="/gostd/html/template/escape.go.html#4910985">p</a></span><span class="op" id="4911136">.</span><span class="ident" id="4911137"><a href="/gostd/text/template/parse/node.go.html#3164104">Cmds</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911143">for</span>&nbsp;<span class="ident" id="4911147">i</span>&nbsp;<span class="op" id="4911149">:=</span>&nbsp;<span class="ident" id="4911152"><a href="/gostd/html/template/escape.go.html#4911049">n</a></span>&nbsp;<span class="op" id="4911154">-</span>&nbsp;<span class="num" id="4911156">1</span><span class="op" id="4911157">;</span>&nbsp;<span class="ident" id="4911159"><a href="/gostd/html/template/escape.go.html#4911147">i</a></span>&nbsp;<span class="op" id="4911161">&gt;=</span>&nbsp;<span class="num" id="4911164">0</span><span class="op" id="4911165">;</span>&nbsp;<span class="ident" id="4911167"><a href="/gostd/html/template/escape.go.html#4911147">i</a></span><span class="op" id="4911168">--</span>&nbsp;<span class="op" id="4911171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911175">if</span>&nbsp;<span class="ident" id="4911178">cmd</span>&nbsp;<span class="op" id="4911182">:=</span>&nbsp;<span class="ident" id="4911185"><a href="/gostd/html/template/escape.go.html#4910985">p</a></span><span class="op" id="4911186">.</span><span class="ident" id="4911187"><a href="/gostd/text/template/parse/node.go.html#3164104">Cmds</a></span><span class="op" id="4911191">[</span><span class="ident" id="4911192"><a href="/gostd/html/template/escape.go.html#4911147">i</a></span><span class="op" id="4911193">]</span><span class="op" id="4911194">;</span>&nbsp;<span class="builtinfunc" id="4911196">len</span><span class="op" id="4911199">(</span><span class="ident" id="4911200"><a href="/gostd/html/template/escape.go.html#4911178">cmd</a></span><span class="op" id="4911203">.</span><span class="ident" id="4911204"><a href="/gostd/text/template/parse/node.go.html#3165982">Args</a></span><span class="op" id="4911208">)</span>&nbsp;<span class="op" id="4911210">!=</span>&nbsp;<span class="num" id="4911213">0</span>&nbsp;<span class="op" id="4911215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911220">if</span>&nbsp;<span class="ident" id="4911223">_</span><span class="op" id="4911224">,</span>&nbsp;<span class="ident" id="4911226">ok</span>&nbsp;<span class="op" id="4911229">:=</span>&nbsp;<span class="ident" id="4911232"><a href="/gostd/html/template/escape.go.html#4911178">cmd</a></span><span class="op" id="4911235">.</span><span class="ident" id="4911236"><a href="/gostd/text/template/parse/node.go.html#3165982">Args</a></span><span class="op" id="4911240">[</span><span class="num" id="4911241">0</span><span class="op" id="4911242">]</span><span class="op" id="4911243">.</span><span class="op" id="4911244">(</span><span class="op" id="4911245">*</span><span class="ident" id="4911246"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4911251">.</span><span class="ident" id="4911252"><a href="/gostd/text/template/parse/node.go.html#3166735">IdentifierNode</a></span><span class="op" id="4911266">)</span><span class="op" id="4911267">;</span>&nbsp;<span class="ident" id="4911269"><a href="/gostd/html/template/escape.go.html#4911226">ok</a></span>&nbsp;<span class="op" id="4911272">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911278">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911298"><a href="/gostd/html/template/escape.go.html#4911125">idents</a></span>&nbsp;<span class="op" id="4911305">=</span>&nbsp;<span class="ident" id="4911307"><a href="/gostd/html/template/escape.go.html#4910985">p</a></span><span class="op" id="4911308">.</span><span class="ident" id="4911309"><a href="/gostd/text/template/parse/node.go.html#3164104">Cmds</a></span><span class="op" id="4911313">[</span><span class="ident" id="4911314"><a href="/gostd/html/template/escape.go.html#4911147">i</a></span><span class="op" id="4911315">+</span><span class="num" id="4911316">1</span><span class="op" id="4911317">:</span><span class="op" id="4911318">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911321">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911324">dups</span>&nbsp;<span class="op" id="4911329">:=</span>&nbsp;<span class="num" id="4911332">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911335">for</span>&nbsp;<span class="ident" id="4911339">_</span><span class="op" id="4911340">,</span>&nbsp;<span class="ident" id="4911342">idNode</span>&nbsp;<span class="op" id="4911349">:=</span>&nbsp;<span class="keyword" id="4911352">range</span>&nbsp;<span class="ident" id="4911358"><a href="/gostd/html/template/escape.go.html#4911125">idents</a></span>&nbsp;<span class="op" id="4911365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911369">for</span>&nbsp;<span class="ident" id="4911373">_</span><span class="op" id="4911374">,</span>&nbsp;<span class="ident" id="4911376">ident</span>&nbsp;<span class="op" id="4911382">:=</span>&nbsp;<span class="keyword" id="4911385">range</span>&nbsp;<span class="ident" id="4911391"><a href="/gostd/html/template/escape.go.html#4910376">allIdents</a></span><span class="op" id="4911400">(</span><span class="ident" id="4911401"><a href="/gostd/html/template/escape.go.html#4911342">idNode</a></span><span class="op" id="4911407">.</span><span class="ident" id="4911408"><a href="/gostd/text/template/parse/node.go.html#3165982">Args</a></span><span class="op" id="4911412">[</span><span class="num" id="4911413">0</span><span class="op" id="4911414">]</span><span class="op" id="4911415">)</span>&nbsp;<span class="op" id="4911417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911422">if</span>&nbsp;<span class="ident" id="4911425"><a href="/gostd/html/template/escape.go.html#4913522">escFnsEq</a></span><span class="op" id="4911433">(</span><span class="ident" id="4911434"><a href="/gostd/html/template/escape.go.html#4911004">s</a></span><span class="op" id="4911435">[</span><span class="ident" id="4911436"><a href="/gostd/html/template/escape.go.html#4911324">dups</a></span><span class="op" id="4911440">]</span><span class="op" id="4911441">,</span>&nbsp;<span class="ident" id="4911443"><a href="/gostd/html/template/escape.go.html#4911376">ident</a></span><span class="op" id="4911448">)</span>&nbsp;<span class="op" id="4911450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911456"><a href="/gostd/html/template/escape.go.html#4911324">dups</a></span><span class="op" id="4911460">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911467">if</span>&nbsp;<span class="ident" id="4911470"><a href="/gostd/html/template/escape.go.html#4911324">dups</a></span>&nbsp;<span class="op" id="4911475">==</span>&nbsp;<span class="builtinfunc" id="4911478">len</span><span class="op" id="4911481">(</span><span class="ident" id="4911482"><a href="/gostd/html/template/escape.go.html#4911004">s</a></span><span class="op" id="4911483">)</span>&nbsp;<span class="op" id="4911485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911492">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911512">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911518">newCmds</span>&nbsp;<span class="op" id="4911526">:=</span>&nbsp;<span class="builtinfunc" id="4911529">make</span><span class="op" id="4911533">(</span><span class="op" id="4911534">[</span><span class="op" id="4911535">]</span><span class="op" id="4911536">*</span><span class="ident" id="4911537"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4911542">.</span><span class="ident" id="4911543"><a href="/gostd/text/template/parse/node.go.html#3165933">CommandNode</a></span><span class="op" id="4911554">,</span>&nbsp;<span class="ident" id="4911556"><a href="/gostd/html/template/escape.go.html#4911049">n</a></span><span class="op" id="4911557">-</span><span class="builtinfunc" id="4911558">len</span><span class="op" id="4911561">(</span><span class="ident" id="4911562"><a href="/gostd/html/template/escape.go.html#4911125">idents</a></span><span class="op" id="4911568">)</span><span class="op" id="4911569">,</span>&nbsp;<span class="ident" id="4911571"><a href="/gostd/html/template/escape.go.html#4911049">n</a></span><span class="op" id="4911572">+</span><span class="builtinfunc" id="4911573">len</span><span class="op" id="4911576">(</span><span class="ident" id="4911577"><a href="/gostd/html/template/escape.go.html#4911004">s</a></span><span class="op" id="4911578">)</span><span class="op" id="4911579">-</span><span class="ident" id="4911580"><a href="/gostd/html/template/escape.go.html#4911324">dups</a></span><span class="op" id="4911584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4911587">copy</span><span class="op" id="4911591">(</span><span class="ident" id="4911592"><a href="/gostd/html/template/escape.go.html#4911518">newCmds</a></span><span class="op" id="4911599">,</span>&nbsp;<span class="ident" id="4911601"><a href="/gostd/html/template/escape.go.html#4910985">p</a></span><span class="op" id="4911602">.</span><span class="ident" id="4911603"><a href="/gostd/text/template/parse/node.go.html#3164104">Cmds</a></span><span class="op" id="4911607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4911610">//&nbsp;Merge&nbsp;existing&nbsp;identifier&nbsp;commands&nbsp;with&nbsp;the&nbsp;sanitizers&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911677">for</span>&nbsp;<span class="ident" id="4911681">_</span><span class="op" id="4911682">,</span>&nbsp;<span class="ident" id="4911684">idNode</span>&nbsp;<span class="op" id="4911691">:=</span>&nbsp;<span class="keyword" id="4911694">range</span>&nbsp;<span class="ident" id="4911700"><a href="/gostd/html/template/escape.go.html#4911125">idents</a></span>&nbsp;<span class="op" id="4911707">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911711">pos</span>&nbsp;<span class="op" id="4911715">:=</span>&nbsp;<span class="ident" id="4911718"><a href="/gostd/html/template/escape.go.html#4911684">idNode</a></span><span class="op" id="4911724">.</span><span class="ident" id="4911725"><a href="/gostd/text/template/parse/node.go.html#3165982">Args</a></span><span class="op" id="4911729">[</span><span class="num" id="4911730">0</span><span class="op" id="4911731">]</span><span class="op" id="4911732">.</span><span class="ident" id="4911733"><a href="/gostd/text/template/parse/node.go.html#3160769">Position</a></span><span class="op" id="4911741">(</span><span class="op" id="4911742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911746">for</span>&nbsp;<span class="ident" id="4911750">_</span><span class="op" id="4911751">,</span>&nbsp;<span class="ident" id="4911753">ident</span>&nbsp;<span class="op" id="4911759">:=</span>&nbsp;<span class="keyword" id="4911762">range</span>&nbsp;<span class="ident" id="4911768"><a href="/gostd/html/template/escape.go.html#4910376">allIdents</a></span><span class="op" id="4911777">(</span><span class="ident" id="4911778"><a href="/gostd/html/template/escape.go.html#4911684">idNode</a></span><span class="op" id="4911784">.</span><span class="ident" id="4911785"><a href="/gostd/text/template/parse/node.go.html#3165982">Args</a></span><span class="op" id="4911789">[</span><span class="num" id="4911790">0</span><span class="op" id="4911791">]</span><span class="op" id="4911792">)</span>&nbsp;<span class="op" id="4911794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911799">i</span>&nbsp;<span class="op" id="4911801">:=</span>&nbsp;<span class="ident" id="4911804"><a href="/gostd/html/template/escape.go.html#4913302">indexOfStr</a></span><span class="op" id="4911814">(</span><span class="ident" id="4911815"><a href="/gostd/html/template/escape.go.html#4911753">ident</a></span><span class="op" id="4911820">,</span>&nbsp;<span class="ident" id="4911822"><a href="/gostd/html/template/escape.go.html#4911004">s</a></span><span class="op" id="4911823">,</span>&nbsp;<span class="ident" id="4911825"><a href="/gostd/html/template/escape.go.html#4913522">escFnsEq</a></span><span class="op" id="4911833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911838">if</span>&nbsp;<span class="ident" id="4911841"><a href="/gostd/html/template/escape.go.html#4911799">i</a></span>&nbsp;<span class="op" id="4911843">!=</span>&nbsp;<span class="op" id="4911846">-</span><span class="num" id="4911847">1</span>&nbsp;<span class="op" id="4911849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4911855">for</span>&nbsp;<span class="ident" id="4911859">_</span><span class="op" id="4911860">,</span>&nbsp;<span class="ident" id="4911862">name</span>&nbsp;<span class="op" id="4911867">:=</span>&nbsp;<span class="keyword" id="4911870">range</span>&nbsp;<span class="ident" id="4911876"><a href="/gostd/html/template/escape.go.html#4911004">s</a></span><span class="op" id="4911877">[</span><span class="op" id="4911878">:</span><span class="ident" id="4911879"><a href="/gostd/html/template/escape.go.html#4911799">i</a></span><span class="op" id="4911880">]</span>&nbsp;<span class="op" id="4911882">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911889"><a href="/gostd/html/template/escape.go.html#4911518">newCmds</a></span>&nbsp;<span class="op" id="4911897">=</span>&nbsp;<span class="ident" id="4911899"><a href="/gostd/html/template/escape.go.html#4912896">appendCmd</a></span><span class="op" id="4911908">(</span><span class="ident" id="4911909"><a href="/gostd/html/template/escape.go.html#4911518">newCmds</a></span><span class="op" id="4911916">,</span>&nbsp;<span class="ident" id="4911918"><a href="/gostd/html/template/escape.go.html#4913741">newIdentCmd</a></span><span class="op" id="4911929">(</span><span class="ident" id="4911930"><a href="/gostd/html/template/escape.go.html#4911862">name</a></span><span class="op" id="4911934">,</span>&nbsp;<span class="ident" id="4911936"><a href="/gostd/html/template/escape.go.html#4911711">pos</a></span><span class="op" id="4911939">)</span><span class="op" id="4911940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911952"><a href="/gostd/html/template/escape.go.html#4911004">s</a></span>&nbsp;<span class="op" id="4911954">=</span>&nbsp;<span class="ident" id="4911956"><a href="/gostd/html/template/escape.go.html#4911004">s</a></span><span class="op" id="4911957">[</span><span class="ident" id="4911958"><a href="/gostd/html/template/escape.go.html#4911799">i</a></span><span class="op" id="4911959">+</span><span class="num" id="4911960">1</span><span class="op" id="4911961">:</span><span class="op" id="4911962">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4911971">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4911975"><a href="/gostd/html/template/escape.go.html#4911518">newCmds</a></span>&nbsp;<span class="op" id="4911983">=</span>&nbsp;<span class="ident" id="4911985"><a href="/gostd/html/template/escape.go.html#4912896">appendCmd</a></span><span class="op" id="4911994">(</span><span class="ident" id="4911995"><a href="/gostd/html/template/escape.go.html#4911518">newCmds</a></span><span class="op" id="4912002">,</span>&nbsp;<span class="ident" id="4912004"><a href="/gostd/html/template/escape.go.html#4911684">idNode</a></span><span class="op" id="4912010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4912016">//&nbsp;Create&nbsp;any&nbsp;remaining&nbsp;sanitizers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912053">for</span>&nbsp;<span class="ident" id="4912057">_</span><span class="op" id="4912058">,</span>&nbsp;<span class="ident" id="4912060">name</span>&nbsp;<span class="op" id="4912065">:=</span>&nbsp;<span class="keyword" id="4912068">range</span>&nbsp;<span class="ident" id="4912074"><a href="/gostd/html/template/escape.go.html#4911004">s</a></span>&nbsp;<span class="op" id="4912076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912080"><a href="/gostd/html/template/escape.go.html#4911518">newCmds</a></span>&nbsp;<span class="op" id="4912088">=</span>&nbsp;<span class="ident" id="4912090"><a href="/gostd/html/template/escape.go.html#4912896">appendCmd</a></span><span class="op" id="4912099">(</span><span class="ident" id="4912100"><a href="/gostd/html/template/escape.go.html#4911518">newCmds</a></span><span class="op" id="4912107">,</span>&nbsp;<span class="ident" id="4912109"><a href="/gostd/html/template/escape.go.html#4913741">newIdentCmd</a></span><span class="op" id="4912120">(</span><span class="ident" id="4912121"><a href="/gostd/html/template/escape.go.html#4912060">name</a></span><span class="op" id="4912125">,</span>&nbsp;<span class="ident" id="4912127"><a href="/gostd/html/template/escape.go.html#4910985">p</a></span><span class="op" id="4912128">.</span><span class="ident" id="4912129"><a href="/gostd/text/template/parse/node.go.html#3161178">Position</a></span><span class="op" id="4912137">(</span><span class="op" id="4912138">)</span><span class="op" id="4912139">)</span><span class="op" id="4912140">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912146"><a href="/gostd/html/template/escape.go.html#4910985">p</a></span><span class="op" id="4912147">.</span><span class="ident" id="4912148"><a href="/gostd/text/template/parse/node.go.html#3164104">Cmds</a></span>&nbsp;<span class="op" id="4912153">=</span>&nbsp;<span class="ident" id="4912155"><a href="/gostd/html/template/escape.go.html#4911518">newCmds</a></span><br>
<span class="lineno"></span><span class="op" id="4912163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4912166">//&nbsp;redundantFuncs[a][b]&nbsp;implies&nbsp;that&nbsp;funcMap[b](funcMap[a](x))&nbsp;==&nbsp;funcMap[a](x)</span><br>
<span class="lineno">275</span><span class="comment" id="4912246">//&nbsp;for&nbsp;all&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4912260">var</span>&nbsp;<span class="ident" id="4912264">redundantFuncs</span>&nbsp;<span class="op" id="4912279">=</span>&nbsp;<span class="keyword" id="4912281">map</span><span class="op" id="4912284">[</span><span class="builtintype" id="4912285">string</span><span class="op" id="4912291">]</span><span class="keyword" id="4912292">map</span><span class="op" id="4912295">[</span><span class="builtintype" id="4912296">string</span><span class="op" id="4912302">]</span><span class="builtintype" id="4912303">bool</span><span class="op" id="4912307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912310">&#34;html_template_commentescaper&#34;</span><span class="op" id="4912340">:</span>&nbsp;<span class="op" id="4912342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912346">&#34;html_template_attrescaper&#34;</span><span class="op" id="4912373">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4912378">true</span><span class="op" id="4912382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912386">&#34;html_template_nospaceescaper&#34;</span><span class="op" id="4912416">:</span>&nbsp;<span class="builtintype" id="4912418">true</span><span class="op" id="4912422">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912426">&#34;html_template_htmlescaper&#34;</span><span class="op" id="4912453">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4912458">true</span><span class="op" id="4912462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912465">}</span><span class="op" id="4912466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912469">&#34;html_template_cssescaper&#34;</span><span class="op" id="4912495">:</span>&nbsp;<span class="op" id="4912497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912501">&#34;html_template_attrescaper&#34;</span><span class="op" id="4912528">:</span>&nbsp;<span class="builtintype" id="4912530">true</span><span class="op" id="4912534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912537">}</span><span class="op" id="4912538">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912541">&#34;html_template_jsregexpescaper&#34;</span><span class="op" id="4912572">:</span>&nbsp;<span class="op" id="4912574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912578">&#34;html_template_attrescaper&#34;</span><span class="op" id="4912605">:</span>&nbsp;<span class="builtintype" id="4912607">true</span><span class="op" id="4912611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912614">}</span><span class="op" id="4912615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912618">&#34;html_template_jsstrescaper&#34;</span><span class="op" id="4912646">:</span>&nbsp;<span class="op" id="4912648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912652">&#34;html_template_attrescaper&#34;</span><span class="op" id="4912679">:</span>&nbsp;<span class="builtintype" id="4912681">true</span><span class="op" id="4912685">,</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912688">}</span><span class="op" id="4912689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912692">&#34;html_template_urlescaper&#34;</span><span class="op" id="4912718">:</span>&nbsp;<span class="op" id="4912720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912724">&#34;html_template_urlnormalizer&#34;</span><span class="op" id="4912753">:</span>&nbsp;<span class="builtintype" id="4912755">true</span><span class="op" id="4912759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912762">}</span><span class="op" id="4912763">,</span><br>
<span class="lineno"></span><span class="op" id="4912765">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="4912768">//&nbsp;appendCmd&nbsp;appends&nbsp;the&nbsp;given&nbsp;command&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;command&nbsp;pipeline</span><br>
<span class="lineno"></span><span class="comment" id="4912842">//&nbsp;unless&nbsp;it&nbsp;is&nbsp;redundant&nbsp;with&nbsp;the&nbsp;last&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="4912891">func</span>&nbsp;<span class="ident" id="4912896">appendCmd</span><span class="op" id="4912905">(</span><span class="ident" id="4912906">cmds</span>&nbsp;<span class="op" id="4912911">[</span><span class="op" id="4912912">]</span><span class="op" id="4912913">*</span><span class="ident" id="4912914"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4912919">.</span><span class="ident" id="4912920"><a href="/gostd/text/template/parse/node.go.html#3165933">CommandNode</a></span><span class="op" id="4912931">,</span>&nbsp;<span class="ident" id="4912933">cmd</span>&nbsp;<span class="op" id="4912937">*</span><span class="ident" id="4912938"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4912943">.</span><span class="ident" id="4912944"><a href="/gostd/text/template/parse/node.go.html#3165933">CommandNode</a></span><span class="op" id="4912955">)</span>&nbsp;<span class="op" id="4912957">[</span><span class="op" id="4912958">]</span><span class="op" id="4912959">*</span><span class="ident" id="4912960"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4912965">.</span><span class="ident" id="4912966"><a href="/gostd/text/template/parse/node.go.html#3165933">CommandNode</a></span>&nbsp;<span class="op" id="4912978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912981">if</span>&nbsp;<span class="ident" id="4912984">n</span>&nbsp;<span class="op" id="4912986">:=</span>&nbsp;<span class="builtinfunc" id="4912989">len</span><span class="op" id="4912992">(</span><span class="ident" id="4912993"><a href="/gostd/html/template/escape.go.html#4912906">cmds</a></span><span class="op" id="4912997">)</span><span class="op" id="4912998">;</span>&nbsp;<span class="ident" id="4913000"><a href="/gostd/html/template/escape.go.html#4912984">n</a></span>&nbsp;<span class="op" id="4913002">!=</span>&nbsp;<span class="num" id="4913005">0</span>&nbsp;<span class="op" id="4913007">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913011">last</span><span class="op" id="4913015">,</span>&nbsp;<span class="ident" id="4913017">ok</span>&nbsp;<span class="op" id="4913020">:=</span>&nbsp;<span class="ident" id="4913023"><a href="/gostd/html/template/escape.go.html#4912906">cmds</a></span><span class="op" id="4913027">[</span><span class="ident" id="4913028"><a href="/gostd/html/template/escape.go.html#4912984">n</a></span><span class="op" id="4913029">-</span><span class="num" id="4913030">1</span><span class="op" id="4913031">]</span><span class="op" id="4913032">.</span><span class="ident" id="4913033"><a href="/gostd/text/template/parse/node.go.html#3165982">Args</a></span><span class="op" id="4913037">[</span><span class="num" id="4913038">0</span><span class="op" id="4913039">]</span><span class="op" id="4913040">.</span><span class="op" id="4913041">(</span><span class="op" id="4913042">*</span><span class="ident" id="4913043"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4913048">.</span><span class="ident" id="4913049"><a href="/gostd/text/template/parse/node.go.html#3166735">IdentifierNode</a></span><span class="op" id="4913063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913067">next</span><span class="op" id="4913071">,</span>&nbsp;<span class="ident" id="4913073">_</span>&nbsp;<span class="op" id="4913075">:=</span>&nbsp;<span class="ident" id="4913078"><a href="/gostd/html/template/escape.go.html#4912933">cmd</a></span><span class="op" id="4913081">.</span><span class="ident" id="4913082"><a href="/gostd/text/template/parse/node.go.html#3165982">Args</a></span><span class="op" id="4913086">[</span><span class="num" id="4913087">0</span><span class="op" id="4913088">]</span><span class="op" id="4913089">.</span><span class="op" id="4913090">(</span><span class="op" id="4913091">*</span><span class="ident" id="4913092"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4913097">.</span><span class="ident" id="4913098"><a href="/gostd/text/template/parse/node.go.html#3166735">IdentifierNode</a></span><span class="op" id="4913112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913116">if</span>&nbsp;<span class="ident" id="4913119"><a href="/gostd/html/template/escape.go.html#4913017">ok</a></span>&nbsp;<span class="op" id="4913122">&amp;&amp;</span>&nbsp;<span class="ident" id="4913125"><a href="/gostd/html/template/escape.go.html#4912264">redundantFuncs</a></span><span class="op" id="4913139">[</span><span class="ident" id="4913140"><a href="/gostd/html/template/escape.go.html#4913011">last</a></span><span class="op" id="4913144">.</span><span class="ident" id="4913145"><a href="/gostd/text/template/parse/node.go.html#3166788">Ident</a></span><span class="op" id="4913150">]</span><span class="op" id="4913151">[</span><span class="ident" id="4913152"><a href="/gostd/html/template/escape.go.html#4913067">next</a></span><span class="op" id="4913156">.</span><span class="ident" id="4913157"><a href="/gostd/text/template/parse/node.go.html#3166788">Ident</a></span><span class="op" id="4913162">]</span>&nbsp;<span class="op" id="4913164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913169">return</span>&nbsp;<span class="ident" id="4913176"><a href="/gostd/html/template/escape.go.html#4912906">cmds</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913183">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913189">return</span>&nbsp;<span class="builtinfunc" id="4913196">append</span><span class="op" id="4913202">(</span><span class="ident" id="4913203"><a href="/gostd/html/template/escape.go.html#4912906">cmds</a></span><span class="op" id="4913207">,</span>&nbsp;<span class="ident" id="4913209"><a href="/gostd/html/template/escape.go.html#4912933">cmd</a></span><span class="op" id="4913212">)</span><br>
<span class="lineno"></span><span class="op" id="4913214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4913217">//&nbsp;indexOfStr&nbsp;is&nbsp;the&nbsp;first&nbsp;i&nbsp;such&nbsp;that&nbsp;eq(s,&nbsp;strs[i])&nbsp;or&nbsp;-1&nbsp;if&nbsp;s&nbsp;was&nbsp;not&nbsp;found.</span><br>
<span class="lineno">310</span><span class="keyword" id="4913297">func</span>&nbsp;<span class="ident" id="4913302">indexOfStr</span><span class="op" id="4913312">(</span><span class="ident" id="4913313">s</span>&nbsp;<span class="builtintype" id="4913315">string</span><span class="op" id="4913321">,</span>&nbsp;<span class="ident" id="4913323">strs</span>&nbsp;<span class="op" id="4913328">[</span><span class="op" id="4913329">]</span><span class="builtintype" id="4913330">string</span><span class="op" id="4913336">,</span>&nbsp;<span class="ident" id="4913338">eq</span>&nbsp;<span class="keyword" id="4913341">func</span><span class="op" id="4913345">(</span><span class="ident" id="4913346">a</span><span class="op" id="4913347">,</span>&nbsp;<span class="ident" id="4913349">b</span>&nbsp;<span class="builtintype" id="4913351">string</span><span class="op" id="4913357">)</span>&nbsp;<span class="builtintype" id="4913359">bool</span><span class="op" id="4913363">)</span>&nbsp;<span class="builtintype" id="4913365">int</span>&nbsp;<span class="op" id="4913369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913372">for</span>&nbsp;<span class="ident" id="4913376">i</span><span class="op" id="4913377">,</span>&nbsp;<span class="ident" id="4913379">t</span>&nbsp;<span class="op" id="4913381">:=</span>&nbsp;<span class="keyword" id="4913384">range</span>&nbsp;<span class="ident" id="4913390"><a href="/gostd/html/template/escape.go.html#4913323">strs</a></span>&nbsp;<span class="op" id="4913395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913399">if</span>&nbsp;<span class="ident" id="4913402"><a href="/gostd/html/template/escape.go.html#4913338">eq</a></span><span class="op" id="4913404">(</span><span class="ident" id="4913405"><a href="/gostd/html/template/escape.go.html#4913313">s</a></span><span class="op" id="4913406">,</span>&nbsp;<span class="ident" id="4913408"><a href="/gostd/html/template/escape.go.html#4913379">t</a></span><span class="op" id="4913409">)</span>&nbsp;<span class="op" id="4913411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913416">return</span>&nbsp;<span class="ident" id="4913423"><a href="/gostd/html/template/escape.go.html#4913376">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913427">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913433">return</span>&nbsp;<span class="op" id="4913440">-</span><span class="num" id="4913441">1</span><br>
<span class="lineno"></span><span class="op" id="4913443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4913446">//&nbsp;escFnsEq&nbsp;reports&nbsp;whether&nbsp;the&nbsp;two&nbsp;escaping&nbsp;functions&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno">320</span><span class="keyword" id="4913517">func</span>&nbsp;<span class="ident" id="4913522">escFnsEq</span><span class="op" id="4913530">(</span><span class="ident" id="4913531">a</span><span class="op" id="4913532">,</span>&nbsp;<span class="ident" id="4913534">b</span>&nbsp;<span class="builtintype" id="4913536">string</span><span class="op" id="4913542">)</span>&nbsp;<span class="builtintype" id="4913544">bool</span>&nbsp;<span class="op" id="4913549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913552">if</span>&nbsp;<span class="ident" id="4913555">e</span>&nbsp;<span class="op" id="4913557">:=</span>&nbsp;<span class="ident" id="4913560"><a href="/gostd/html/template/escape.go.html#4905730">equivEscapers</a></span><span class="op" id="4913573">[</span><span class="ident" id="4913574"><a href="/gostd/html/template/escape.go.html#4913531">a</a></span><span class="op" id="4913575">]</span><span class="op" id="4913576">;</span>&nbsp;<span class="ident" id="4913578"><a href="/gostd/html/template/escape.go.html#4913555">e</a></span>&nbsp;<span class="op" id="4913580">!=</span>&nbsp;<span class="string" id="4913583">&#34;&#34;</span>&nbsp;<span class="op" id="4913586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913590"><a href="/gostd/html/template/escape.go.html#4913531">a</a></span>&nbsp;<span class="op" id="4913592">=</span>&nbsp;<span class="ident" id="4913594"><a href="/gostd/html/template/escape.go.html#4913555">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913600">if</span>&nbsp;<span class="ident" id="4913603">e</span>&nbsp;<span class="op" id="4913605">:=</span>&nbsp;<span class="ident" id="4913608"><a href="/gostd/html/template/escape.go.html#4905730">equivEscapers</a></span><span class="op" id="4913621">[</span><span class="ident" id="4913622"><a href="/gostd/html/template/escape.go.html#4913534">b</a></span><span class="op" id="4913623">]</span><span class="op" id="4913624">;</span>&nbsp;<span class="ident" id="4913626"><a href="/gostd/html/template/escape.go.html#4913603">e</a></span>&nbsp;<span class="op" id="4913628">!=</span>&nbsp;<span class="string" id="4913631">&#34;&#34;</span>&nbsp;<span class="op" id="4913634">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913638"><a href="/gostd/html/template/escape.go.html#4913534">b</a></span>&nbsp;<span class="op" id="4913640">=</span>&nbsp;<span class="ident" id="4913642"><a href="/gostd/html/template/escape.go.html#4913603">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913648">return</span>&nbsp;<span class="ident" id="4913655"><a href="/gostd/html/template/escape.go.html#4913531">a</a></span>&nbsp;<span class="op" id="4913657">==</span>&nbsp;<span class="ident" id="4913660"><a href="/gostd/html/template/escape.go.html#4913534">b</a></span><br>
<span class="lineno"></span><span class="op" id="4913662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span><span class="comment" id="4913665">//&nbsp;newIdentCmd&nbsp;produces&nbsp;a&nbsp;command&nbsp;containing&nbsp;a&nbsp;single&nbsp;identifier&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4913736">func</span>&nbsp;<span class="ident" id="4913741">newIdentCmd</span><span class="op" id="4913752">(</span><span class="ident" id="4913753">identifier</span>&nbsp;<span class="builtintype" id="4913764">string</span><span class="op" id="4913770">,</span>&nbsp;<span class="ident" id="4913772">pos</span>&nbsp;<span class="ident" id="4913776"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4913781">.</span><span class="ident" id="4913782"><a href="/gostd/text/template/parse/node.go.html#3161156">Pos</a></span><span class="op" id="4913785">)</span>&nbsp;<span class="op" id="4913787">*</span><span class="ident" id="4913788"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4913793">.</span><span class="ident" id="4913794"><a href="/gostd/text/template/parse/node.go.html#3165933">CommandNode</a></span>&nbsp;<span class="op" id="4913806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913809">return</span>&nbsp;<span class="op" id="4913816">&amp;</span><span class="ident" id="4913817"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4913822">.</span><span class="ident" id="4913823"><a href="/gostd/text/template/parse/node.go.html#3165933">CommandNode</a></span><span class="op" id="4913834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913838"><a href="/gostd/text/template/parse/node.go.html#3165955">NodeType</a></span><span class="op" id="4913846">:</span>&nbsp;<span class="ident" id="4913848"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4913853">.</span><span class="ident" id="4913854"><a href="/gostd/text/template/parse/node.go.html#3161647">NodeCommand</a></span><span class="op" id="4913865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913869"><a href="/gostd/text/template/parse/node.go.html#3165982">Args</a></span><span class="op" id="4913873">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913879">[</span><span class="op" id="4913880">]</span><span class="ident" id="4913881"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4913886">.</span><span class="ident" id="4913887"><a href="/gostd/text/template/parse/node.go.html#3160534">Node</a></span><span class="op" id="4913891">{</span><span class="ident" id="4913892"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4913897">.</span><span class="ident" id="4913898"><a href="/gostd/text/template/parse/node.go.html#3166913">NewIdentifier</a></span><span class="op" id="4913911">(</span><span class="ident" id="4913912"><a href="/gostd/html/template/escape.go.html#4913753">identifier</a></span><span class="op" id="4913922">)</span><span class="op" id="4913923">.</span><span class="ident" id="4913924"><a href="/gostd/text/template/parse/node.go.html#3167445">SetTree</a></span><span class="op" id="4913931">(</span><span class="builtintype" id="4913932">nil</span><span class="op" id="4913935">)</span><span class="op" id="4913936">.</span><span class="ident" id="4913937"><a href="/gostd/text/template/parse/node.go.html#3167197">SetPos</a></span><span class="op" id="4913943">(</span><span class="ident" id="4913944"><a href="/gostd/html/template/escape.go.html#4913772">pos</a></span><span class="op" id="4913947">)</span><span class="op" id="4913948">}</span><span class="op" id="4913949">,</span>&nbsp;<span class="comment" id="4913951">//&nbsp;TODO:&nbsp;SetTree.</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913970">}</span><br>
<span class="lineno"></span><span class="op" id="4913972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4913975">//&nbsp;nudge&nbsp;returns&nbsp;the&nbsp;context&nbsp;that&nbsp;would&nbsp;result&nbsp;from&nbsp;following&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="4914050">//&nbsp;transitions&nbsp;from&nbsp;the&nbsp;input&nbsp;context.</span><br>
<span class="lineno">340</span><span class="comment" id="4914089">//&nbsp;For&nbsp;example,&nbsp;parsing:</span><br>
<span class="lineno"></span><span class="comment" id="4914114">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`&lt;a&nbsp;href=`</span><br>
<span class="lineno"></span><span class="comment" id="4914132">//&nbsp;will&nbsp;end&nbsp;in&nbsp;context{stateBeforeValue,&nbsp;attrURL},&nbsp;but&nbsp;parsing&nbsp;one&nbsp;extra&nbsp;rune:</span><br>
<span class="lineno"></span><span class="comment" id="4914211">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`&lt;a&nbsp;href=x`</span><br>
<span class="lineno"></span><span class="comment" id="4914230">//&nbsp;will&nbsp;end&nbsp;in&nbsp;context{stateURL,&nbsp;delimSpaceOrTagEnd,&nbsp;...}.</span><br>
<span class="lineno">345</span><span class="comment" id="4914289">//&nbsp;There&nbsp;are&nbsp;two&nbsp;transitions&nbsp;that&nbsp;happen&nbsp;when&nbsp;the&nbsp;&#39;x&#39;&nbsp;is&nbsp;seen:</span><br>
<span class="lineno"></span><span class="comment" id="4914352">//&nbsp;(1)&nbsp;Transition&nbsp;from&nbsp;a&nbsp;before-value&nbsp;state&nbsp;to&nbsp;a&nbsp;start-of-value&nbsp;state&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="4914430">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consuming&nbsp;any&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="4914462">//&nbsp;(2)&nbsp;Consume&nbsp;&#39;x&#39;&nbsp;and&nbsp;transition&nbsp;past&nbsp;the&nbsp;first&nbsp;value&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="4914528">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;nudging&nbsp;produces&nbsp;the&nbsp;context&nbsp;after&nbsp;(1)&nbsp;happens.</span><br>
<span class="lineno">350</span><span class="keyword" id="4914593">func</span>&nbsp;<span class="ident" id="4914598">nudge</span><span class="op" id="4914603">(</span><span class="ident" id="4914604">c</span>&nbsp;<span class="ident" id="4914606"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4914613">)</span>&nbsp;<span class="ident" id="4914615"><a href="/gostd/html/template/context.go.html#4872948">context</a></span>&nbsp;<span class="op" id="4914623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914626">switch</span>&nbsp;<span class="ident" id="4914633"><a href="/gostd/html/template/escape.go.html#4914604">c</a></span><span class="op" id="4914634">.</span><span class="ident" id="4914635"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4914641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914644">case</span>&nbsp;<span class="ident" id="4914649"><a href="/gostd/html/template/context.go.html#4874933">stateTag</a></span><span class="op" id="4914657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914661">//&nbsp;In&nbsp;`&lt;foo&nbsp;{{.}}`,&nbsp;the&nbsp;action&nbsp;should&nbsp;emit&nbsp;an&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4914720"><a href="/gostd/html/template/escape.go.html#4914604">c</a></span><span class="op" id="4914721">.</span><span class="ident" id="4914722"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4914728">=</span>&nbsp;<span class="ident" id="4914730"><a href="/gostd/html/template/context.go.html#4875046">stateAttrName</a></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914745">case</span>&nbsp;<span class="ident" id="4914750"><a href="/gostd/html/template/context.go.html#4875336">stateBeforeValue</a></span><span class="op" id="4914766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914770">//&nbsp;In&nbsp;`&lt;foo&nbsp;bar={{.}}`,&nbsp;the&nbsp;action&nbsp;is&nbsp;an&nbsp;undelimited&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4914832"><a href="/gostd/html/template/escape.go.html#4914604">c</a></span><span class="op" id="4914833">.</span><span class="ident" id="4914834"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4914839">,</span>&nbsp;<span class="ident" id="4914841"><a href="/gostd/html/template/escape.go.html#4914604">c</a></span><span class="op" id="4914842">.</span><span class="ident" id="4914843"><a href="/gostd/html/template/context.go.html#4872981">delim</a></span><span class="op" id="4914848">,</span>&nbsp;<span class="ident" id="4914850"><a href="/gostd/html/template/escape.go.html#4914604">c</a></span><span class="op" id="4914851">.</span><span class="ident" id="4914852"><a href="/gostd/html/template/context.go.html#4873028">attr</a></span>&nbsp;<span class="op" id="4914857">=</span>&nbsp;<span class="ident" id="4914859"><a href="/gostd/html/template/transition.go.html#4962516">attrStartStates</a></span><span class="op" id="4914874">[</span><span class="ident" id="4914875"><a href="/gostd/html/template/escape.go.html#4914604">c</a></span><span class="op" id="4914876">.</span><span class="ident" id="4914877"><a href="/gostd/html/template/context.go.html#4873028">attr</a></span><span class="op" id="4914881">]</span><span class="op" id="4914882">,</span>&nbsp;<span class="ident" id="4914884"><a href="/gostd/html/template/context.go.html#4878883">delimSpaceOrTagEnd</a></span><span class="op" id="4914902">,</span>&nbsp;<span class="ident" id="4914904"><a href="/gostd/html/template/context.go.html#4882137">attrNone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914914">case</span>&nbsp;<span class="ident" id="4914919"><a href="/gostd/html/template/context.go.html#4875196">stateAfterName</a></span><span class="op" id="4914933">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914937">//&nbsp;In&nbsp;`&lt;foo&nbsp;bar&nbsp;{{.}}`,&nbsp;the&nbsp;action&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4914996"><a href="/gostd/html/template/escape.go.html#4914604">c</a></span><span class="op" id="4914997">.</span><span class="ident" id="4914998"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4915003">,</span>&nbsp;<span class="ident" id="4915005"><a href="/gostd/html/template/escape.go.html#4914604">c</a></span><span class="op" id="4915006">.</span><span class="ident" id="4915007"><a href="/gostd/html/template/context.go.html#4873028">attr</a></span>&nbsp;<span class="op" id="4915012">=</span>&nbsp;<span class="ident" id="4915014"><a href="/gostd/html/template/context.go.html#4875046">stateAttrName</a></span><span class="op" id="4915027">,</span>&nbsp;<span class="ident" id="4915029"><a href="/gostd/html/template/context.go.html#4882137">attrNone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915042">return</span>&nbsp;<span class="ident" id="4915049"><a href="/gostd/html/template/escape.go.html#4914604">c</a></span><br>
<span class="lineno"></span><span class="op" id="4915051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4915054">//&nbsp;join&nbsp;joins&nbsp;the&nbsp;two&nbsp;contexts&nbsp;of&nbsp;a&nbsp;branch&nbsp;template&nbsp;node.&nbsp;The&nbsp;result&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4915129">//&nbsp;error&nbsp;context&nbsp;if&nbsp;either&nbsp;of&nbsp;the&nbsp;input&nbsp;contexts&nbsp;are&nbsp;error&nbsp;contexts,&nbsp;or&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4915208">//&nbsp;the&nbsp;input&nbsp;contexts&nbsp;differ.</span><br>
<span class="lineno"></span><span class="keyword" id="4915238">func</span>&nbsp;<span class="ident" id="4915243">join</span><span class="op" id="4915247">(</span><span class="ident" id="4915248">a</span><span class="op" id="4915249">,</span>&nbsp;<span class="ident" id="4915251">b</span>&nbsp;<span class="ident" id="4915253"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4915260">,</span>&nbsp;<span class="ident" id="4915262">node</span>&nbsp;<span class="ident" id="4915267"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4915272">.</span><span class="ident" id="4915273"><a href="/gostd/text/template/parse/node.go.html#3160534">Node</a></span><span class="op" id="4915277">,</span>&nbsp;<span class="ident" id="4915279">nodeName</span>&nbsp;<span class="builtintype" id="4915288">string</span><span class="op" id="4915294">)</span>&nbsp;<span class="ident" id="4915296"><a href="/gostd/html/template/context.go.html#4872948">context</a></span>&nbsp;<span class="op" id="4915304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915307">if</span>&nbsp;<span class="ident" id="4915310"><a href="/gostd/html/template/escape.go.html#4915248">a</a></span><span class="op" id="4915311">.</span><span class="ident" id="4915312"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4915318">==</span>&nbsp;<span class="ident" id="4915321"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span>&nbsp;<span class="op" id="4915332">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915336">return</span>&nbsp;<span class="ident" id="4915343"><a href="/gostd/html/template/escape.go.html#4915248">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915349">if</span>&nbsp;<span class="ident" id="4915352"><a href="/gostd/html/template/escape.go.html#4915251">b</a></span><span class="op" id="4915353">.</span><span class="ident" id="4915354"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4915360">==</span>&nbsp;<span class="ident" id="4915363"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span>&nbsp;<span class="op" id="4915374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915378">return</span>&nbsp;<span class="ident" id="4915385"><a href="/gostd/html/template/escape.go.html#4915251">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915388">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915391">if</span>&nbsp;<span class="ident" id="4915394"><a href="/gostd/html/template/escape.go.html#4915248">a</a></span><span class="op" id="4915395">.</span><span class="ident" id="4915396"><a href="/gostd/html/template/context.go.html#4873288">eq</a></span><span class="op" id="4915398">(</span><span class="ident" id="4915399"><a href="/gostd/html/template/escape.go.html#4915251">b</a></span><span class="op" id="4915400">)</span>&nbsp;<span class="op" id="4915402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915406">return</span>&nbsp;<span class="ident" id="4915413"><a href="/gostd/html/template/escape.go.html#4915248">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915420">c</span>&nbsp;<span class="op" id="4915422">:=</span>&nbsp;<span class="ident" id="4915425"><a href="/gostd/html/template/escape.go.html#4915248">a</a></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915428"><a href="/gostd/html/template/escape.go.html#4915420">c</a></span><span class="op" id="4915429">.</span><span class="ident" id="4915430"><a href="/gostd/html/template/context.go.html#4872996">urlPart</a></span>&nbsp;<span class="op" id="4915438">=</span>&nbsp;<span class="ident" id="4915440"><a href="/gostd/html/template/escape.go.html#4915251">b</a></span><span class="op" id="4915441">.</span><span class="ident" id="4915442"><a href="/gostd/html/template/context.go.html#4872996">urlPart</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915451">if</span>&nbsp;<span class="ident" id="4915454"><a href="/gostd/html/template/escape.go.html#4915420">c</a></span><span class="op" id="4915455">.</span><span class="ident" id="4915456"><a href="/gostd/html/template/context.go.html#4873288">eq</a></span><span class="op" id="4915458">(</span><span class="ident" id="4915459"><a href="/gostd/html/template/escape.go.html#4915251">b</a></span><span class="op" id="4915460">)</span>&nbsp;<span class="op" id="4915462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915466">//&nbsp;The&nbsp;contexts&nbsp;differ&nbsp;only&nbsp;by&nbsp;urlPart.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915508"><a href="/gostd/html/template/escape.go.html#4915420">c</a></span><span class="op" id="4915509">.</span><span class="ident" id="4915510"><a href="/gostd/html/template/context.go.html#4872996">urlPart</a></span>&nbsp;<span class="op" id="4915518">=</span>&nbsp;<span class="ident" id="4915520"><a href="/gostd/html/template/context.go.html#4879862">urlPartUnknown</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915537">return</span>&nbsp;<span class="ident" id="4915544"><a href="/gostd/html/template/escape.go.html#4915420">c</a></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915551"><a href="/gostd/html/template/escape.go.html#4915420">c</a></span>&nbsp;<span class="op" id="4915553">=</span>&nbsp;<span class="ident" id="4915555"><a href="/gostd/html/template/escape.go.html#4915248">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915558"><a href="/gostd/html/template/escape.go.html#4915420">c</a></span><span class="op" id="4915559">.</span><span class="ident" id="4915560"><a href="/gostd/html/template/context.go.html#4873013">jsCtx</a></span>&nbsp;<span class="op" id="4915566">=</span>&nbsp;<span class="ident" id="4915568"><a href="/gostd/html/template/escape.go.html#4915251">b</a></span><span class="op" id="4915569">.</span><span class="ident" id="4915570"><a href="/gostd/html/template/context.go.html#4873013">jsCtx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915577">if</span>&nbsp;<span class="ident" id="4915580"><a href="/gostd/html/template/escape.go.html#4915420">c</a></span><span class="op" id="4915581">.</span><span class="ident" id="4915582"><a href="/gostd/html/template/context.go.html#4873288">eq</a></span><span class="op" id="4915584">(</span><span class="ident" id="4915585"><a href="/gostd/html/template/escape.go.html#4915251">b</a></span><span class="op" id="4915586">)</span>&nbsp;<span class="op" id="4915588">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915592">//&nbsp;The&nbsp;contexts&nbsp;differ&nbsp;only&nbsp;by&nbsp;jsCtx.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915632"><a href="/gostd/html/template/escape.go.html#4915420">c</a></span><span class="op" id="4915633">.</span><span class="ident" id="4915634"><a href="/gostd/html/template/context.go.html#4873013">jsCtx</a></span>&nbsp;<span class="op" id="4915640">=</span>&nbsp;<span class="ident" id="4915642"><a href="/gostd/html/template/context.go.html#4880589">jsCtxUnknown</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915657">return</span>&nbsp;<span class="ident" id="4915664"><a href="/gostd/html/template/escape.go.html#4915420">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915671">//&nbsp;Allow&nbsp;a&nbsp;nudged&nbsp;context&nbsp;to&nbsp;join&nbsp;with&nbsp;an&nbsp;unnudged&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915728">//&nbsp;This&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915748">//&nbsp;&nbsp;&nbsp;&lt;p&nbsp;title={{if&nbsp;.C}}{{.}}{{end}}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915785">//&nbsp;ends&nbsp;in&nbsp;an&nbsp;unquoted&nbsp;value&nbsp;state&nbsp;even&nbsp;though&nbsp;the&nbsp;else&nbsp;branch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915849">//&nbsp;ends&nbsp;in&nbsp;stateBeforeValue.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915879">if</span>&nbsp;<span class="ident" id="4915882">c</span><span class="op" id="4915883">,</span>&nbsp;<span class="ident" id="4915885">d</span>&nbsp;<span class="op" id="4915887">:=</span>&nbsp;<span class="ident" id="4915890"><a href="/gostd/html/template/escape.go.html#4914598">nudge</a></span><span class="op" id="4915895">(</span><span class="ident" id="4915896"><a href="/gostd/html/template/escape.go.html#4915248">a</a></span><span class="op" id="4915897">)</span><span class="op" id="4915898">,</span>&nbsp;<span class="ident" id="4915900"><a href="/gostd/html/template/escape.go.html#4914598">nudge</a></span><span class="op" id="4915905">(</span><span class="ident" id="4915906"><a href="/gostd/html/template/escape.go.html#4915251">b</a></span><span class="op" id="4915907">)</span><span class="op" id="4915908">;</span>&nbsp;<span class="op" id="4915910">!</span><span class="op" id="4915911">(</span><span class="ident" id="4915912"><a href="/gostd/html/template/escape.go.html#4915882">c</a></span><span class="op" id="4915913">.</span><span class="ident" id="4915914"><a href="/gostd/html/template/context.go.html#4873288">eq</a></span><span class="op" id="4915916">(</span><span class="ident" id="4915917"><a href="/gostd/html/template/escape.go.html#4915248">a</a></span><span class="op" id="4915918">)</span>&nbsp;<span class="op" id="4915920">&amp;&amp;</span>&nbsp;<span class="ident" id="4915923"><a href="/gostd/html/template/escape.go.html#4915885">d</a></span><span class="op" id="4915924">.</span><span class="ident" id="4915925"><a href="/gostd/html/template/context.go.html#4873288">eq</a></span><span class="op" id="4915927">(</span><span class="ident" id="4915928"><a href="/gostd/html/template/escape.go.html#4915251">b</a></span><span class="op" id="4915929">)</span><span class="op" id="4915930">)</span>&nbsp;<span class="op" id="4915932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915936">if</span>&nbsp;<span class="ident" id="4915939">e</span>&nbsp;<span class="op" id="4915941">:=</span>&nbsp;<span class="ident" id="4915944"><a href="/gostd/html/template/escape.go.html#4915243">join</a></span><span class="op" id="4915948">(</span><span class="ident" id="4915949"><a href="/gostd/html/template/escape.go.html#4915882">c</a></span><span class="op" id="4915950">,</span>&nbsp;<span class="ident" id="4915952"><a href="/gostd/html/template/escape.go.html#4915885">d</a></span><span class="op" id="4915953">,</span>&nbsp;<span class="ident" id="4915955"><a href="/gostd/html/template/escape.go.html#4915262">node</a></span><span class="op" id="4915959">,</span>&nbsp;<span class="ident" id="4915961"><a href="/gostd/html/template/escape.go.html#4915279">nodeName</a></span><span class="op" id="4915969">)</span><span class="op" id="4915970">;</span>&nbsp;<span class="ident" id="4915972"><a href="/gostd/html/template/escape.go.html#4915939">e</a></span><span class="op" id="4915973">.</span><span class="ident" id="4915974"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4915980">!=</span>&nbsp;<span class="ident" id="4915983"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span>&nbsp;<span class="op" id="4915994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915999">return</span>&nbsp;<span class="ident" id="4916006"><a href="/gostd/html/template/escape.go.html#4915939">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916013">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916017">return</span>&nbsp;<span class="ident" id="4916024"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4916031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916035"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4916040">:</span>&nbsp;<span class="ident" id="4916042"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span><span class="op" id="4916052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916056"><a href="/gostd/html/template/context.go.html#4873059">err</a></span><span class="op" id="4916059">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4916063"><a href="/gostd/html/template/error.go.html#4903515">errorf</a></span><span class="op" id="4916069">(</span><span class="ident" id="4916070"><a href="/gostd/html/template/error.go.html#4899340">ErrBranchEnd</a></span><span class="op" id="4916082">,</span>&nbsp;<span class="ident" id="4916084"><a href="/gostd/html/template/escape.go.html#4915262">node</a></span><span class="op" id="4916088">,</span>&nbsp;<span class="num" id="4916090">0</span><span class="op" id="4916091">,</span>&nbsp;<span class="string" id="4916093">&#34;{{%s}}&nbsp;branches&nbsp;end&nbsp;in&nbsp;different&nbsp;contexts:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="4916144">,</span>&nbsp;<span class="ident" id="4916146"><a href="/gostd/html/template/escape.go.html#4915279">nodeName</a></span><span class="op" id="4916154">,</span>&nbsp;<span class="ident" id="4916156"><a href="/gostd/html/template/escape.go.html#4915248">a</a></span><span class="op" id="4916157">,</span>&nbsp;<span class="ident" id="4916159"><a href="/gostd/html/template/escape.go.html#4915251">b</a></span><span class="op" id="4916160">)</span><span class="op" id="4916161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916164">}</span><br>
<span class="lineno">410</span><span class="op" id="4916166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4916169">//&nbsp;escapeBranch&nbsp;escapes&nbsp;a&nbsp;branch&nbsp;template&nbsp;node:&nbsp;&#34;if&#34;,&nbsp;&#34;range&#34;&nbsp;and&nbsp;&#34;with&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4916243">func</span>&nbsp;<span class="op" id="4916248">(</span><span class="ident" id="4916249">e</span>&nbsp;<span class="op" id="4916251">*</span><span class="ident" id="4916252"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4916259">)</span>&nbsp;<span class="ident" id="4916261">escapeBranch</span><span class="op" id="4916273">(</span><span class="ident" id="4916274">c</span>&nbsp;<span class="ident" id="4916276"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4916283">,</span>&nbsp;<span class="ident" id="4916285">n</span>&nbsp;<span class="op" id="4916287">*</span><span class="ident" id="4916288"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4916293">.</span><span class="ident" id="4916294"><a href="/gostd/text/template/parse/node.go.html#3177261">BranchNode</a></span><span class="op" id="4916304">,</span>&nbsp;<span class="ident" id="4916306">nodeName</span>&nbsp;<span class="builtintype" id="4916315">string</span><span class="op" id="4916321">)</span>&nbsp;<span class="ident" id="4916323"><a href="/gostd/html/template/context.go.html#4872948">context</a></span>&nbsp;<span class="op" id="4916331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916334">c0</span>&nbsp;<span class="op" id="4916337">:=</span>&nbsp;<span class="ident" id="4916340"><a href="/gostd/html/template/escape.go.html#4916249">e</a></span><span class="op" id="4916341">.</span><span class="ident" id="4916342"><a href="/gostd/html/template/escape.go.html#4917094">escapeList</a></span><span class="op" id="4916352">(</span><span class="ident" id="4916353"><a href="/gostd/html/template/escape.go.html#4916274">c</a></span><span class="op" id="4916354">,</span>&nbsp;<span class="ident" id="4916356"><a href="/gostd/html/template/escape.go.html#4916285">n</a></span><span class="op" id="4916357">.</span><span class="ident" id="4916358"><a href="/gostd/text/template/parse/node.go.html#3177455">List</a></span><span class="op" id="4916362">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916365">if</span>&nbsp;<span class="ident" id="4916368"><a href="/gostd/html/template/escape.go.html#4916306">nodeName</a></span>&nbsp;<span class="op" id="4916377">==</span>&nbsp;<span class="string" id="4916380">&#34;range&#34;</span>&nbsp;<span class="op" id="4916388">&amp;&amp;</span>&nbsp;<span class="ident" id="4916391"><a href="/gostd/html/template/escape.go.html#4916334">c0</a></span><span class="op" id="4916393">.</span><span class="ident" id="4916394"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4916400">!=</span>&nbsp;<span class="ident" id="4916403"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span>&nbsp;<span class="op" id="4916414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916418">//&nbsp;The&nbsp;&#34;true&#34;&nbsp;branch&nbsp;of&nbsp;a&nbsp;&#34;range&#34;&nbsp;node&nbsp;can&nbsp;execute&nbsp;multiple&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916487">//&nbsp;We&nbsp;check&nbsp;that&nbsp;executing&nbsp;n.List&nbsp;once&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;context</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916556">//&nbsp;as&nbsp;executing&nbsp;n.List&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916588">c1</span><span class="op" id="4916590">,</span>&nbsp;<span class="ident" id="4916592">_</span>&nbsp;<span class="op" id="4916594">:=</span>&nbsp;<span class="ident" id="4916597"><a href="/gostd/html/template/escape.go.html#4916249">e</a></span><span class="op" id="4916598">.</span><span class="ident" id="4916599"><a href="/gostd/html/template/escape.go.html#4917533">escapeListConditionally</a></span><span class="op" id="4916622">(</span><span class="ident" id="4916623"><a href="/gostd/html/template/escape.go.html#4916334">c0</a></span><span class="op" id="4916625">,</span>&nbsp;<span class="ident" id="4916627"><a href="/gostd/html/template/escape.go.html#4916285">n</a></span><span class="op" id="4916628">.</span><span class="ident" id="4916629"><a href="/gostd/text/template/parse/node.go.html#3177455">List</a></span><span class="op" id="4916633">,</span>&nbsp;<span class="builtintype" id="4916635">nil</span><span class="op" id="4916638">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916642"><a href="/gostd/html/template/escape.go.html#4916334">c0</a></span>&nbsp;<span class="op" id="4916645">=</span>&nbsp;<span class="ident" id="4916647"><a href="/gostd/html/template/escape.go.html#4915243">join</a></span><span class="op" id="4916651">(</span><span class="ident" id="4916652"><a href="/gostd/html/template/escape.go.html#4916334">c0</a></span><span class="op" id="4916654">,</span>&nbsp;<span class="ident" id="4916656"><a href="/gostd/html/template/escape.go.html#4916588">c1</a></span><span class="op" id="4916658">,</span>&nbsp;<span class="ident" id="4916660"><a href="/gostd/html/template/escape.go.html#4916285">n</a></span><span class="op" id="4916661">,</span>&nbsp;<span class="ident" id="4916663"><a href="/gostd/html/template/escape.go.html#4916306">nodeName</a></span><span class="op" id="4916671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916675">if</span>&nbsp;<span class="ident" id="4916678"><a href="/gostd/html/template/escape.go.html#4916334">c0</a></span><span class="op" id="4916680">.</span><span class="ident" id="4916681"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4916687">==</span>&nbsp;<span class="ident" id="4916690"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span>&nbsp;<span class="op" id="4916701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916706">//&nbsp;Make&nbsp;clear&nbsp;that&nbsp;this&nbsp;is&nbsp;a&nbsp;problem&nbsp;on&nbsp;loop&nbsp;re-entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916763">//&nbsp;since&nbsp;developers&nbsp;tend&nbsp;to&nbsp;overlook&nbsp;that&nbsp;branch&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916820">//&nbsp;debugging&nbsp;templates.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916847"><a href="/gostd/html/template/escape.go.html#4916334">c0</a></span><span class="op" id="4916849">.</span><span class="ident" id="4916850"><a href="/gostd/html/template/context.go.html#4873059">err</a></span><span class="op" id="4916853">.</span><span class="ident" id="4916854"><a href="/gostd/html/template/error.go.html#4896679">Line</a></span>&nbsp;<span class="op" id="4916859">=</span>&nbsp;<span class="ident" id="4916861"><a href="/gostd/html/template/escape.go.html#4916285">n</a></span><span class="op" id="4916862">.</span><span class="ident" id="4916863"><a href="/gostd/text/template/parse/node.go.html#3177313">Line</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916871"><a href="/gostd/html/template/escape.go.html#4916334">c0</a></span><span class="op" id="4916873">.</span><span class="ident" id="4916874"><a href="/gostd/html/template/context.go.html#4873059">err</a></span><span class="op" id="4916877">.</span><span class="ident" id="4916878"><a href="/gostd/html/template/error.go.html#4896753">Description</a></span>&nbsp;<span class="op" id="4916890">=</span>&nbsp;<span class="string" id="4916892">&#34;on&nbsp;range&nbsp;loop&nbsp;re-entry:&nbsp;&#34;</span>&nbsp;<span class="op" id="4916919">+</span>&nbsp;<span class="ident" id="4916921"><a href="/gostd/html/template/escape.go.html#4916334">c0</a></span><span class="op" id="4916923">.</span><span class="ident" id="4916924"><a href="/gostd/html/template/context.go.html#4873059">err</a></span><span class="op" id="4916927">.</span><span class="ident" id="4916928"><a href="/gostd/html/template/error.go.html#4896753">Description</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916943">return</span>&nbsp;<span class="ident" id="4916950"><a href="/gostd/html/template/escape.go.html#4916334">c0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916958">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916961">c1</span>&nbsp;<span class="op" id="4916964">:=</span>&nbsp;<span class="ident" id="4916967"><a href="/gostd/html/template/escape.go.html#4916249">e</a></span><span class="op" id="4916968">.</span><span class="ident" id="4916969"><a href="/gostd/html/template/escape.go.html#4917094">escapeList</a></span><span class="op" id="4916979">(</span><span class="ident" id="4916980"><a href="/gostd/html/template/escape.go.html#4916274">c</a></span><span class="op" id="4916981">,</span>&nbsp;<span class="ident" id="4916983"><a href="/gostd/html/template/escape.go.html#4916285">n</a></span><span class="op" id="4916984">.</span><span class="ident" id="4916985"><a href="/gostd/text/template/parse/node.go.html#3177521">ElseList</a></span><span class="op" id="4916993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916996">return</span>&nbsp;<span class="ident" id="4917003"><a href="/gostd/html/template/escape.go.html#4915243">join</a></span><span class="op" id="4917007">(</span><span class="ident" id="4917008"><a href="/gostd/html/template/escape.go.html#4916334">c0</a></span><span class="op" id="4917010">,</span>&nbsp;<span class="ident" id="4917012"><a href="/gostd/html/template/escape.go.html#4916961">c1</a></span><span class="op" id="4917014">,</span>&nbsp;<span class="ident" id="4917016"><a href="/gostd/html/template/escape.go.html#4916285">n</a></span><span class="op" id="4917017">,</span>&nbsp;<span class="ident" id="4917019"><a href="/gostd/html/template/escape.go.html#4916306">nodeName</a></span><span class="op" id="4917027">)</span><br>
<span class="lineno"></span><span class="op" id="4917029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4917032">//&nbsp;escapeList&nbsp;escapes&nbsp;a&nbsp;list&nbsp;template&nbsp;node.</span><br>
<span class="lineno">435</span><span class="keyword" id="4917076">func</span>&nbsp;<span class="op" id="4917081">(</span><span class="ident" id="4917082">e</span>&nbsp;<span class="op" id="4917084">*</span><span class="ident" id="4917085"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4917092">)</span>&nbsp;<span class="ident" id="4917094">escapeList</span><span class="op" id="4917104">(</span><span class="ident" id="4917105">c</span>&nbsp;<span class="ident" id="4917107"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4917114">,</span>&nbsp;<span class="ident" id="4917116">n</span>&nbsp;<span class="op" id="4917118">*</span><span class="ident" id="4917119"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4917124">.</span><span class="ident" id="4917125"><a href="/gostd/text/template/parse/node.go.html#3162635">ListNode</a></span><span class="op" id="4917133">)</span>&nbsp;<span class="ident" id="4917135"><a href="/gostd/html/template/context.go.html#4872948">context</a></span>&nbsp;<span class="op" id="4917143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917146">if</span>&nbsp;<span class="ident" id="4917149"><a href="/gostd/html/template/escape.go.html#4917116">n</a></span>&nbsp;<span class="op" id="4917151">==</span>&nbsp;<span class="builtintype" id="4917154">nil</span>&nbsp;<span class="op" id="4917158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917162">return</span>&nbsp;<span class="ident" id="4917169"><a href="/gostd/html/template/escape.go.html#4917105">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4917172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917175">for</span>&nbsp;<span class="ident" id="4917179">_</span><span class="op" id="4917180">,</span>&nbsp;<span class="ident" id="4917182">m</span>&nbsp;<span class="op" id="4917184">:=</span>&nbsp;<span class="keyword" id="4917187">range</span>&nbsp;<span class="ident" id="4917193"><a href="/gostd/html/template/escape.go.html#4917116">n</a></span><span class="op" id="4917194">.</span><span class="ident" id="4917195"><a href="/gostd/text/template/parse/node.go.html#3162682">Nodes</a></span>&nbsp;<span class="op" id="4917201">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4917205"><a href="/gostd/html/template/escape.go.html#4917105">c</a></span>&nbsp;<span class="op" id="4917207">=</span>&nbsp;<span class="ident" id="4917209"><a href="/gostd/html/template/escape.go.html#4917082">e</a></span><span class="op" id="4917210">.</span><span class="ident" id="4917211"><a href="/gostd/html/template/escape.go.html#4907653">escape</a></span><span class="op" id="4917217">(</span><span class="ident" id="4917218"><a href="/gostd/html/template/escape.go.html#4917105">c</a></span><span class="op" id="4917219">,</span>&nbsp;<span class="ident" id="4917221"><a href="/gostd/html/template/escape.go.html#4917182">m</a></span><span class="op" id="4917222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4917225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917228">return</span>&nbsp;<span class="ident" id="4917235"><a href="/gostd/html/template/escape.go.html#4917105">c</a></span><br>
<span class="lineno"></span><span class="op" id="4917237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="comment" id="4917240">//&nbsp;escapeListConditionally&nbsp;escapes&nbsp;a&nbsp;list&nbsp;node&nbsp;but&nbsp;only&nbsp;preserves&nbsp;edits&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4917316">//&nbsp;inferences&nbsp;in&nbsp;e&nbsp;if&nbsp;the&nbsp;inferences&nbsp;and&nbsp;output&nbsp;context&nbsp;satisfy&nbsp;filter.</span><br>
<span class="lineno"></span><span class="comment" id="4917388">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;best&nbsp;guess&nbsp;at&nbsp;an&nbsp;output&nbsp;context,&nbsp;and&nbsp;the&nbsp;result&nbsp;of&nbsp;the&nbsp;filter</span><br>
<span class="lineno"></span><span class="comment" id="4917468">//&nbsp;which&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;whether&nbsp;e&nbsp;was&nbsp;updated.</span><br>
<span class="lineno"></span><span class="keyword" id="4917515">func</span>&nbsp;<span class="op" id="4917520">(</span><span class="ident" id="4917521">e</span>&nbsp;<span class="op" id="4917523">*</span><span class="ident" id="4917524"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4917531">)</span>&nbsp;<span class="ident" id="4917533">escapeListConditionally</span><span class="op" id="4917556">(</span><span class="ident" id="4917557">c</span>&nbsp;<span class="ident" id="4917559"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4917566">,</span>&nbsp;<span class="ident" id="4917568">n</span>&nbsp;<span class="op" id="4917570">*</span><span class="ident" id="4917571"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4917576">.</span><span class="ident" id="4917577"><a href="/gostd/text/template/parse/node.go.html#3162635">ListNode</a></span><span class="op" id="4917585">,</span>&nbsp;<span class="ident" id="4917587">filter</span>&nbsp;<span class="keyword" id="4917594">func</span><span class="op" id="4917598">(</span><span class="op" id="4917599">*</span><span class="ident" id="4917600"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4917607">,</span>&nbsp;<span class="ident" id="4917609"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4917616">)</span>&nbsp;<span class="builtintype" id="4917618">bool</span><span class="op" id="4917622">)</span>&nbsp;<span class="op" id="4917624">(</span><span class="ident" id="4917625"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4917632">,</span>&nbsp;<span class="builtintype" id="4917634">bool</span><span class="op" id="4917638">)</span>&nbsp;<span class="op" id="4917640">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4917643">e1</span>&nbsp;<span class="op" id="4917646">:=</span>&nbsp;<span class="ident" id="4917649"><a href="/gostd/html/template/escape.go.html#4906980">newEscaper</a></span><span class="op" id="4917659">(</span><span class="ident" id="4917660"><a href="/gostd/html/template/escape.go.html#4917521">e</a></span><span class="op" id="4917661">.</span><span class="ident" id="4917662"><a href="/gostd/html/template/escape.go.html#4906153">tmpl</a></span><span class="op" id="4917666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917669">//&nbsp;Make&nbsp;type&nbsp;inferences&nbsp;available&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917710">for</span>&nbsp;<span class="ident" id="4917714">k</span><span class="op" id="4917715">,</span>&nbsp;<span class="ident" id="4917717">v</span>&nbsp;<span class="op" id="4917719">:=</span>&nbsp;<span class="keyword" id="4917722">range</span>&nbsp;<span class="ident" id="4917728"><a href="/gostd/html/template/escape.go.html#4917521">e</a></span><span class="op" id="4917729">.</span><span class="ident" id="4917730"><a href="/gostd/html/template/escape.go.html#4906291">output</a></span>&nbsp;<span class="op" id="4917737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4917741"><a href="/gostd/html/template/escape.go.html#4917643">e1</a></span><span class="op" id="4917743">.</span><span class="ident" id="4917744"><a href="/gostd/html/template/escape.go.html#4906291">output</a></span><span class="op" id="4917750">[</span><span class="ident" id="4917751"><a href="/gostd/html/template/escape.go.html#4917714">k</a></span><span class="op" id="4917752">]</span>&nbsp;<span class="op" id="4917754">=</span>&nbsp;<span class="ident" id="4917756"><a href="/gostd/html/template/escape.go.html#4917717">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4917759">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4917762"><a href="/gostd/html/template/escape.go.html#4917557">c</a></span>&nbsp;<span class="op" id="4917764">=</span>&nbsp;<span class="ident" id="4917766"><a href="/gostd/html/template/escape.go.html#4917643">e1</a></span><span class="op" id="4917768">.</span><span class="ident" id="4917769"><a href="/gostd/html/template/escape.go.html#4917094">escapeList</a></span><span class="op" id="4917779">(</span><span class="ident" id="4917780"><a href="/gostd/html/template/escape.go.html#4917557">c</a></span><span class="op" id="4917781">,</span>&nbsp;<span class="ident" id="4917783"><a href="/gostd/html/template/escape.go.html#4917568">n</a></span><span class="op" id="4917784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4917787">ok</span>&nbsp;<span class="op" id="4917790">:=</span>&nbsp;<span class="ident" id="4917793"><a href="/gostd/html/template/escape.go.html#4917587">filter</a></span>&nbsp;<span class="op" id="4917800">!=</span>&nbsp;<span class="builtintype" id="4917803">nil</span>&nbsp;<span class="op" id="4917807">&amp;&amp;</span>&nbsp;<span class="ident" id="4917810"><a href="/gostd/html/template/escape.go.html#4917587">filter</a></span><span class="op" id="4917816">(</span><span class="ident" id="4917817"><a href="/gostd/html/template/escape.go.html#4917643">e1</a></span><span class="op" id="4917819">,</span>&nbsp;<span class="ident" id="4917821"><a href="/gostd/html/template/escape.go.html#4917557">c</a></span><span class="op" id="4917822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917825">if</span>&nbsp;<span class="ident" id="4917828"><a href="/gostd/html/template/escape.go.html#4917787">ok</a></span>&nbsp;<span class="op" id="4917831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917835">//&nbsp;Copy&nbsp;inferences&nbsp;and&nbsp;edits&nbsp;from&nbsp;e1&nbsp;back&nbsp;into&nbsp;e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917887">for</span>&nbsp;<span class="ident" id="4917891">k</span><span class="op" id="4917892">,</span>&nbsp;<span class="ident" id="4917894">v</span>&nbsp;<span class="op" id="4917896">:=</span>&nbsp;<span class="keyword" id="4917899">range</span>&nbsp;<span class="ident" id="4917905"><a href="/gostd/html/template/escape.go.html#4917643">e1</a></span><span class="op" id="4917907">.</span><span class="ident" id="4917908"><a href="/gostd/html/template/escape.go.html#4906291">output</a></span>&nbsp;<span class="op" id="4917915">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4917920"><a href="/gostd/html/template/escape.go.html#4917521">e</a></span><span class="op" id="4917921">.</span><span class="ident" id="4917922"><a href="/gostd/html/template/escape.go.html#4906291">output</a></span><span class="op" id="4917928">[</span><span class="ident" id="4917929"><a href="/gostd/html/template/escape.go.html#4917891">k</a></span><span class="op" id="4917930">]</span>&nbsp;<span class="op" id="4917932">=</span>&nbsp;<span class="ident" id="4917934"><a href="/gostd/html/template/escape.go.html#4917894">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4917938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917942">for</span>&nbsp;<span class="ident" id="4917946">k</span><span class="op" id="4917947">,</span>&nbsp;<span class="ident" id="4917949">v</span>&nbsp;<span class="op" id="4917951">:=</span>&nbsp;<span class="keyword" id="4917954">range</span>&nbsp;<span class="ident" id="4917960"><a href="/gostd/html/template/escape.go.html#4917643">e1</a></span><span class="op" id="4917962">.</span><span class="ident" id="4917963"><a href="/gostd/html/template/escape.go.html#4906444">derived</a></span>&nbsp;<span class="op" id="4917971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4917976"><a href="/gostd/html/template/escape.go.html#4917521">e</a></span><span class="op" id="4917977">.</span><span class="ident" id="4917978"><a href="/gostd/html/template/escape.go.html#4906444">derived</a></span><span class="op" id="4917985">[</span><span class="ident" id="4917986"><a href="/gostd/html/template/escape.go.html#4917946">k</a></span><span class="op" id="4917987">]</span>&nbsp;<span class="op" id="4917989">=</span>&nbsp;<span class="ident" id="4917991"><a href="/gostd/html/template/escape.go.html#4917949">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4917995">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917999">for</span>&nbsp;<span class="ident" id="4918003">k</span><span class="op" id="4918004">,</span>&nbsp;<span class="ident" id="4918006">v</span>&nbsp;<span class="op" id="4918008">:=</span>&nbsp;<span class="keyword" id="4918011">range</span>&nbsp;<span class="ident" id="4918017"><a href="/gostd/html/template/escape.go.html#4917643">e1</a></span><span class="op" id="4918019">.</span><span class="ident" id="4918020"><a href="/gostd/html/template/escape.go.html#4906551">called</a></span>&nbsp;<span class="op" id="4918027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918032"><a href="/gostd/html/template/escape.go.html#4917521">e</a></span><span class="op" id="4918033">.</span><span class="ident" id="4918034"><a href="/gostd/html/template/escape.go.html#4906551">called</a></span><span class="op" id="4918040">[</span><span class="ident" id="4918041"><a href="/gostd/html/template/escape.go.html#4918003">k</a></span><span class="op" id="4918042">]</span>&nbsp;<span class="op" id="4918044">=</span>&nbsp;<span class="ident" id="4918046"><a href="/gostd/html/template/escape.go.html#4918006">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918054">for</span>&nbsp;<span class="ident" id="4918058">k</span><span class="op" id="4918059">,</span>&nbsp;<span class="ident" id="4918061">v</span>&nbsp;<span class="op" id="4918063">:=</span>&nbsp;<span class="keyword" id="4918066">range</span>&nbsp;<span class="ident" id="4918072"><a href="/gostd/html/template/escape.go.html#4917643">e1</a></span><span class="op" id="4918074">.</span><span class="ident" id="4918075"><a href="/gostd/html/template/escape.go.html#4906770">actionNodeEdits</a></span>&nbsp;<span class="op" id="4918091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918096"><a href="/gostd/html/template/escape.go.html#4917521">e</a></span><span class="op" id="4918097">.</span><span class="ident" id="4918098"><a href="/gostd/html/template/escape.go.html#4925834">editActionNode</a></span><span class="op" id="4918112">(</span><span class="ident" id="4918113"><a href="/gostd/html/template/escape.go.html#4918058">k</a></span><span class="op" id="4918114">,</span>&nbsp;<span class="ident" id="4918116"><a href="/gostd/html/template/escape.go.html#4918061">v</a></span><span class="op" id="4918117">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918125">for</span>&nbsp;<span class="ident" id="4918129">k</span><span class="op" id="4918130">,</span>&nbsp;<span class="ident" id="4918132">v</span>&nbsp;<span class="op" id="4918134">:=</span>&nbsp;<span class="keyword" id="4918137">range</span>&nbsp;<span class="ident" id="4918143"><a href="/gostd/html/template/escape.go.html#4917643">e1</a></span><span class="op" id="4918145">.</span><span class="ident" id="4918146"><a href="/gostd/html/template/escape.go.html#4906820">templateNodeEdits</a></span>&nbsp;<span class="op" id="4918164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918169"><a href="/gostd/html/template/escape.go.html#4917521">e</a></span><span class="op" id="4918170">.</span><span class="ident" id="4918171"><a href="/gostd/html/template/escape.go.html#4926120">editTemplateNode</a></span><span class="op" id="4918187">(</span><span class="ident" id="4918188"><a href="/gostd/html/template/escape.go.html#4918129">k</a></span><span class="op" id="4918189">,</span>&nbsp;<span class="ident" id="4918191"><a href="/gostd/html/template/escape.go.html#4918132">v</a></span><span class="op" id="4918192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918200">for</span>&nbsp;<span class="ident" id="4918204">k</span><span class="op" id="4918205">,</span>&nbsp;<span class="ident" id="4918207">v</span>&nbsp;<span class="op" id="4918209">:=</span>&nbsp;<span class="keyword" id="4918212">range</span>&nbsp;<span class="ident" id="4918218"><a href="/gostd/html/template/escape.go.html#4917643">e1</a></span><span class="op" id="4918220">.</span><span class="ident" id="4918221"><a href="/gostd/html/template/escape.go.html#4906870">textNodeEdits</a></span>&nbsp;<span class="op" id="4918235">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918240"><a href="/gostd/html/template/escape.go.html#4917521">e</a></span><span class="op" id="4918241">.</span><span class="ident" id="4918242"><a href="/gostd/html/template/escape.go.html#4926402">editTextNode</a></span><span class="op" id="4918254">(</span><span class="ident" id="4918255"><a href="/gostd/html/template/escape.go.html#4918204">k</a></span><span class="op" id="4918256">,</span>&nbsp;<span class="ident" id="4918258"><a href="/gostd/html/template/escape.go.html#4918207">v</a></span><span class="op" id="4918259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918269">return</span>&nbsp;<span class="ident" id="4918276"><a href="/gostd/html/template/escape.go.html#4917557">c</a></span><span class="op" id="4918277">,</span>&nbsp;<span class="ident" id="4918279"><a href="/gostd/html/template/escape.go.html#4917787">ok</a></span><br>
<span class="lineno"></span><span class="op" id="4918282">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4918285">//&nbsp;escapeTemplate&nbsp;escapes&nbsp;a&nbsp;{{template}}&nbsp;call&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4918337">func</span>&nbsp;<span class="op" id="4918342">(</span><span class="ident" id="4918343">e</span>&nbsp;<span class="op" id="4918345">*</span><span class="ident" id="4918346"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4918353">)</span>&nbsp;<span class="ident" id="4918355">escapeTemplate</span><span class="op" id="4918369">(</span><span class="ident" id="4918370">c</span>&nbsp;<span class="ident" id="4918372"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4918379">,</span>&nbsp;<span class="ident" id="4918381">n</span>&nbsp;<span class="op" id="4918383">*</span><span class="ident" id="4918384"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4918389">.</span><span class="ident" id="4918390"><a href="/gostd/text/template/parse/node.go.html#3179791">TemplateNode</a></span><span class="op" id="4918402">)</span>&nbsp;<span class="ident" id="4918404"><a href="/gostd/html/template/context.go.html#4872948">context</a></span>&nbsp;<span class="op" id="4918412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918415"><a href="/gostd/html/template/escape.go.html#4918370">c</a></span><span class="op" id="4918416">,</span>&nbsp;<span class="ident" id="4918418">name</span>&nbsp;<span class="op" id="4918423">:=</span>&nbsp;<span class="ident" id="4918426"><a href="/gostd/html/template/escape.go.html#4918343">e</a></span><span class="op" id="4918427">.</span><span class="ident" id="4918428"><a href="/gostd/html/template/escape.go.html#4918665">escapeTree</a></span><span class="op" id="4918438">(</span><span class="ident" id="4918439"><a href="/gostd/html/template/escape.go.html#4918370">c</a></span><span class="op" id="4918440">,</span>&nbsp;<span class="ident" id="4918442"><a href="/gostd/html/template/escape.go.html#4918381">n</a></span><span class="op" id="4918443">,</span>&nbsp;<span class="ident" id="4918445"><a href="/gostd/html/template/escape.go.html#4918381">n</a></span><span class="op" id="4918446">.</span><span class="ident" id="4918447"><a href="/gostd/text/template/parse/node.go.html#3179926">Name</a></span><span class="op" id="4918451">,</span>&nbsp;<span class="ident" id="4918453"><a href="/gostd/html/template/escape.go.html#4918381">n</a></span><span class="op" id="4918454">.</span><span class="ident" id="4918455"><a href="/gostd/text/template/parse/node.go.html#3179841">Line</a></span><span class="op" id="4918459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918462">if</span>&nbsp;<span class="ident" id="4918465"><a href="/gostd/html/template/escape.go.html#4918418">name</a></span>&nbsp;<span class="op" id="4918470">!=</span>&nbsp;<span class="ident" id="4918473"><a href="/gostd/html/template/escape.go.html#4918381">n</a></span><span class="op" id="4918474">.</span><span class="ident" id="4918475"><a href="/gostd/text/template/parse/node.go.html#3179926">Name</a></span>&nbsp;<span class="op" id="4918480">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918484"><a href="/gostd/html/template/escape.go.html#4918343">e</a></span><span class="op" id="4918485">.</span><span class="ident" id="4918486"><a href="/gostd/html/template/escape.go.html#4926120">editTemplateNode</a></span><span class="op" id="4918502">(</span><span class="ident" id="4918503"><a href="/gostd/html/template/escape.go.html#4918381">n</a></span><span class="op" id="4918504">,</span>&nbsp;<span class="ident" id="4918506"><a href="/gostd/html/template/escape.go.html#4918418">name</a></span><span class="op" id="4918510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918516">return</span>&nbsp;<span class="ident" id="4918523"><a href="/gostd/html/template/escape.go.html#4918370">c</a></span><br>
<span class="lineno"></span><span class="op" id="4918525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span><span class="comment" id="4918528">//&nbsp;escapeTree&nbsp;escapes&nbsp;the&nbsp;named&nbsp;template&nbsp;starting&nbsp;in&nbsp;the&nbsp;given&nbsp;context&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4918602">//&nbsp;necessary&nbsp;and&nbsp;returns&nbsp;its&nbsp;output&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="4918647">func</span>&nbsp;<span class="op" id="4918652">(</span><span class="ident" id="4918653">e</span>&nbsp;<span class="op" id="4918655">*</span><span class="ident" id="4918656"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4918663">)</span>&nbsp;<span class="ident" id="4918665">escapeTree</span><span class="op" id="4918675">(</span><span class="ident" id="4918676">c</span>&nbsp;<span class="ident" id="4918678"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4918685">,</span>&nbsp;<span class="ident" id="4918687">node</span>&nbsp;<span class="ident" id="4918692"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4918697">.</span><span class="ident" id="4918698"><a href="/gostd/text/template/parse/node.go.html#3160534">Node</a></span><span class="op" id="4918702">,</span>&nbsp;<span class="ident" id="4918704">name</span>&nbsp;<span class="builtintype" id="4918709">string</span><span class="op" id="4918715">,</span>&nbsp;<span class="ident" id="4918717">line</span>&nbsp;<span class="builtintype" id="4918722">int</span><span class="op" id="4918725">)</span>&nbsp;<span class="op" id="4918727">(</span><span class="ident" id="4918728"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4918735">,</span>&nbsp;<span class="builtintype" id="4918737">string</span><span class="op" id="4918743">)</span>&nbsp;<span class="op" id="4918745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4918748">//&nbsp;Mangle&nbsp;the&nbsp;template&nbsp;name&nbsp;with&nbsp;the&nbsp;input&nbsp;context&nbsp;to&nbsp;produce&nbsp;a&nbsp;reliable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4918822">//&nbsp;identifier.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918838">dname</span>&nbsp;<span class="op" id="4918844">:=</span>&nbsp;<span class="ident" id="4918847"><a href="/gostd/html/template/escape.go.html#4918676">c</a></span><span class="op" id="4918848">.</span><span class="ident" id="4918849"><a href="/gostd/html/template/context.go.html#4873636">mangle</a></span><span class="op" id="4918855">(</span><span class="ident" id="4918856"><a href="/gostd/html/template/escape.go.html#4918704">name</a></span><span class="op" id="4918860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918863"><a href="/gostd/html/template/escape.go.html#4918653">e</a></span><span class="op" id="4918864">.</span><span class="ident" id="4918865"><a href="/gostd/html/template/escape.go.html#4906551">called</a></span><span class="op" id="4918871">[</span><span class="ident" id="4918872"><a href="/gostd/html/template/escape.go.html#4918838">dname</a></span><span class="op" id="4918877">]</span>&nbsp;<span class="op" id="4918879">=</span>&nbsp;<span class="builtintype" id="4918881">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918887">if</span>&nbsp;<span class="ident" id="4918890">out</span><span class="op" id="4918893">,</span>&nbsp;<span class="ident" id="4918895">ok</span>&nbsp;<span class="op" id="4918898">:=</span>&nbsp;<span class="ident" id="4918901"><a href="/gostd/html/template/escape.go.html#4918653">e</a></span><span class="op" id="4918902">.</span><span class="ident" id="4918903"><a href="/gostd/html/template/escape.go.html#4906291">output</a></span><span class="op" id="4918909">[</span><span class="ident" id="4918910"><a href="/gostd/html/template/escape.go.html#4918838">dname</a></span><span class="op" id="4918915">]</span><span class="op" id="4918916">;</span>&nbsp;<span class="ident" id="4918918"><a href="/gostd/html/template/escape.go.html#4918895">ok</a></span>&nbsp;<span class="op" id="4918921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4918925">//&nbsp;Already&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918947">return</span>&nbsp;<span class="ident" id="4918954"><a href="/gostd/html/template/escape.go.html#4918890">out</a></span><span class="op" id="4918957">,</span>&nbsp;<span class="ident" id="4918959"><a href="/gostd/html/template/escape.go.html#4918838">dname</a></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918969">t</span>&nbsp;<span class="op" id="4918971">:=</span>&nbsp;<span class="ident" id="4918974"><a href="/gostd/html/template/escape.go.html#4918653">e</a></span><span class="op" id="4918975">.</span><span class="ident" id="4918976"><a href="/gostd/html/template/escape.go.html#4927257">template</a></span><span class="op" id="4918984">(</span><span class="ident" id="4918985"><a href="/gostd/html/template/escape.go.html#4918704">name</a></span><span class="op" id="4918989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918992">if</span>&nbsp;<span class="ident" id="4918995"><a href="/gostd/html/template/escape.go.html#4918969">t</a></span>&nbsp;<span class="op" id="4918997">==</span>&nbsp;<span class="builtintype" id="4919000">nil</span>&nbsp;<span class="op" id="4919004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4919008">//&nbsp;Two&nbsp;cases:&nbsp;The&nbsp;template&nbsp;exists&nbsp;but&nbsp;is&nbsp;empty,&nbsp;or&nbsp;has&nbsp;never&nbsp;been&nbsp;mentioned&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4919089">//&nbsp;all.&nbsp;Distinguish&nbsp;the&nbsp;cases&nbsp;in&nbsp;the&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919144">if</span>&nbsp;<span class="ident" id="4919147"><a href="/gostd/html/template/escape.go.html#4918653">e</a></span><span class="op" id="4919148">.</span><span class="ident" id="4919149"><a href="/gostd/html/template/escape.go.html#4906153">tmpl</a></span><span class="op" id="4919153">.</span><span class="ident" id="4919154"><a href="/gostd/html/template/template.go.html#4947264">set</a></span><span class="op" id="4919157">[</span><span class="ident" id="4919158"><a href="/gostd/html/template/escape.go.html#4918704">name</a></span><span class="op" id="4919162">]</span>&nbsp;<span class="op" id="4919164">!=</span>&nbsp;<span class="builtintype" id="4919167">nil</span>&nbsp;<span class="op" id="4919171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919176">return</span>&nbsp;<span class="ident" id="4919183"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4919190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919196"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4919201">:</span>&nbsp;<span class="ident" id="4919203"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span><span class="op" id="4919213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919219"><a href="/gostd/html/template/context.go.html#4873059">err</a></span><span class="op" id="4919222">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4919226"><a href="/gostd/html/template/error.go.html#4903515">errorf</a></span><span class="op" id="4919232">(</span><span class="ident" id="4919233"><a href="/gostd/html/template/error.go.html#4900483">ErrNoSuchTemplate</a></span><span class="op" id="4919250">,</span>&nbsp;<span class="ident" id="4919252"><a href="/gostd/html/template/escape.go.html#4918687">node</a></span><span class="op" id="4919256">,</span>&nbsp;<span class="ident" id="4919258"><a href="/gostd/html/template/escape.go.html#4918717">line</a></span><span class="op" id="4919262">,</span>&nbsp;<span class="string" id="4919264">&#34;%q&nbsp;is&nbsp;an&nbsp;incomplete&nbsp;or&nbsp;empty&nbsp;template&#34;</span><span class="op" id="4919303">,</span>&nbsp;<span class="ident" id="4919305"><a href="/gostd/html/template/escape.go.html#4918704">name</a></span><span class="op" id="4919309">)</span><span class="op" id="4919310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919315">}</span><span class="op" id="4919316">,</span>&nbsp;<span class="ident" id="4919318"><a href="/gostd/html/template/escape.go.html#4918838">dname</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919330">return</span>&nbsp;<span class="ident" id="4919337"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4919344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919349"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4919354">:</span>&nbsp;<span class="ident" id="4919356"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span><span class="op" id="4919366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919371"><a href="/gostd/html/template/context.go.html#4873059">err</a></span><span class="op" id="4919374">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4919378"><a href="/gostd/html/template/error.go.html#4903515">errorf</a></span><span class="op" id="4919384">(</span><span class="ident" id="4919385"><a href="/gostd/html/template/error.go.html#4900483">ErrNoSuchTemplate</a></span><span class="op" id="4919402">,</span>&nbsp;<span class="ident" id="4919404"><a href="/gostd/html/template/escape.go.html#4918687">node</a></span><span class="op" id="4919408">,</span>&nbsp;<span class="ident" id="4919410"><a href="/gostd/html/template/escape.go.html#4918717">line</a></span><span class="op" id="4919414">,</span>&nbsp;<span class="string" id="4919416">&#34;no&nbsp;such&nbsp;template&nbsp;%q&#34;</span><span class="op" id="4919437">,</span>&nbsp;<span class="ident" id="4919439"><a href="/gostd/html/template/escape.go.html#4918704">name</a></span><span class="op" id="4919443">)</span><span class="op" id="4919444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919448">}</span><span class="op" id="4919449">,</span>&nbsp;<span class="ident" id="4919451"><a href="/gostd/html/template/escape.go.html#4918838">dname</a></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919461">if</span>&nbsp;<span class="ident" id="4919464"><a href="/gostd/html/template/escape.go.html#4918838">dname</a></span>&nbsp;<span class="op" id="4919470">!=</span>&nbsp;<span class="ident" id="4919473"><a href="/gostd/html/template/escape.go.html#4918704">name</a></span>&nbsp;<span class="op" id="4919478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4919482">//&nbsp;Use&nbsp;any&nbsp;template&nbsp;derived&nbsp;during&nbsp;an&nbsp;earlier&nbsp;call&nbsp;to&nbsp;escapeTemplate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4919553">//&nbsp;with&nbsp;different&nbsp;top&nbsp;level&nbsp;templates,&nbsp;or&nbsp;clone&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919617">dt</span>&nbsp;<span class="op" id="4919620">:=</span>&nbsp;<span class="ident" id="4919623"><a href="/gostd/html/template/escape.go.html#4918653">e</a></span><span class="op" id="4919624">.</span><span class="ident" id="4919625"><a href="/gostd/html/template/escape.go.html#4927257">template</a></span><span class="op" id="4919633">(</span><span class="ident" id="4919634"><a href="/gostd/html/template/escape.go.html#4918838">dname</a></span><span class="op" id="4919639">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919643">if</span>&nbsp;<span class="ident" id="4919646"><a href="/gostd/html/template/escape.go.html#4919617">dt</a></span>&nbsp;<span class="op" id="4919649">==</span>&nbsp;<span class="builtintype" id="4919652">nil</span>&nbsp;<span class="op" id="4919656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919661"><a href="/gostd/html/template/escape.go.html#4919617">dt</a></span>&nbsp;<span class="op" id="4919664">=</span>&nbsp;<span class="ident" id="4919666"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4919674">.</span><span class="ident" id="4919675"><a href="/gostd/text/template/template.go.html#3739854">New</a></span><span class="op" id="4919678">(</span><span class="ident" id="4919679"><a href="/gostd/html/template/escape.go.html#4918838">dname</a></span><span class="op" id="4919684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919689"><a href="/gostd/html/template/escape.go.html#4919617">dt</a></span><span class="op" id="4919691">.</span><span class="ident" id="4919692"><a href="/gostd/text/template/template.go.html#3739734">Tree</a></span>&nbsp;<span class="op" id="4919697">=</span>&nbsp;<span class="op" id="4919699">&amp;</span><span class="ident" id="4919700"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4919705">.</span><span class="ident" id="4919706"><a href="/gostd/text/template/parse/parse.go.html#3181141">Tree</a></span><span class="op" id="4919710">{</span><span class="ident" id="4919711"><a href="/gostd/text/template/parse/parse.go.html#3181156">Name</a></span><span class="op" id="4919715">:</span>&nbsp;<span class="ident" id="4919717"><a href="/gostd/html/template/escape.go.html#4918838">dname</a></span><span class="op" id="4919722">,</span>&nbsp;<span class="ident" id="4919724"><a href="/gostd/text/template/parse/parse.go.html#3181317">Root</a></span><span class="op" id="4919728">:</span>&nbsp;<span class="ident" id="4919730"><a href="/gostd/html/template/escape.go.html#4918969">t</a></span><span class="op" id="4919731">.</span><span class="ident" id="4919732"><a href="/gostd/text/template/parse/parse.go.html#3181317">Root</a></span><span class="op" id="4919736">.</span><span class="ident" id="4919737"><a href="/gostd/text/template/parse/node.go.html#3163111">CopyList</a></span><span class="op" id="4919745">(</span><span class="op" id="4919746">)</span><span class="op" id="4919747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919752"><a href="/gostd/html/template/escape.go.html#4918653">e</a></span><span class="op" id="4919753">.</span><span class="ident" id="4919754"><a href="/gostd/html/template/escape.go.html#4906444">derived</a></span><span class="op" id="4919761">[</span><span class="ident" id="4919762"><a href="/gostd/html/template/escape.go.html#4918838">dname</a></span><span class="op" id="4919767">]</span>&nbsp;<span class="op" id="4919769">=</span>&nbsp;<span class="ident" id="4919771"><a href="/gostd/html/template/escape.go.html#4919617">dt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919776">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919780"><a href="/gostd/html/template/escape.go.html#4918969">t</a></span>&nbsp;<span class="op" id="4919782">=</span>&nbsp;<span class="ident" id="4919784"><a href="/gostd/html/template/escape.go.html#4919617">dt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919791">return</span>&nbsp;<span class="ident" id="4919798"><a href="/gostd/html/template/escape.go.html#4918653">e</a></span><span class="op" id="4919799">.</span><span class="ident" id="4919800"><a href="/gostd/html/template/escape.go.html#4919974">computeOutCtx</a></span><span class="op" id="4919813">(</span><span class="ident" id="4919814"><a href="/gostd/html/template/escape.go.html#4918676">c</a></span><span class="op" id="4919815">,</span>&nbsp;<span class="ident" id="4919817"><a href="/gostd/html/template/escape.go.html#4918969">t</a></span><span class="op" id="4919818">)</span><span class="op" id="4919819">,</span>&nbsp;<span class="ident" id="4919821"><a href="/gostd/html/template/escape.go.html#4918838">dname</a></span><br>
<span class="lineno"></span><span class="op" id="4919827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="4919830">//&nbsp;computeOutCtx&nbsp;takes&nbsp;a&nbsp;template&nbsp;and&nbsp;its&nbsp;start&nbsp;context&nbsp;and&nbsp;computes&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="4919910">//&nbsp;context&nbsp;while&nbsp;storing&nbsp;any&nbsp;inferences&nbsp;in&nbsp;e.</span><br>
<span class="lineno"></span><span class="keyword" id="4919956">func</span>&nbsp;<span class="op" id="4919961">(</span><span class="ident" id="4919962">e</span>&nbsp;<span class="op" id="4919964">*</span><span class="ident" id="4919965"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4919972">)</span>&nbsp;<span class="ident" id="4919974">computeOutCtx</span><span class="op" id="4919987">(</span><span class="ident" id="4919988">c</span>&nbsp;<span class="ident" id="4919990"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4919997">,</span>&nbsp;<span class="ident" id="4919999">t</span>&nbsp;<span class="op" id="4920001">*</span><span class="ident" id="4920002"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4920010">.</span><span class="ident" id="4920011"><a href="/gostd/text/template/template.go.html#3739702">Template</a></span><span class="op" id="4920019">)</span>&nbsp;<span class="ident" id="4920021"><a href="/gostd/html/template/context.go.html#4872948">context</a></span>&nbsp;<span class="op" id="4920029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920032">//&nbsp;Propagate&nbsp;context&nbsp;over&nbsp;the&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920069">c1</span><span class="op" id="4920071">,</span>&nbsp;<span class="ident" id="4920073">ok</span>&nbsp;<span class="op" id="4920076">:=</span>&nbsp;<span class="ident" id="4920079"><a href="/gostd/html/template/escape.go.html#4919962">e</a></span><span class="op" id="4920080">.</span><span class="ident" id="4920081"><a href="/gostd/html/template/escape.go.html#4920729">escapeTemplateBody</a></span><span class="op" id="4920099">(</span><span class="ident" id="4920100"><a href="/gostd/html/template/escape.go.html#4919988">c</a></span><span class="op" id="4920101">,</span>&nbsp;<span class="ident" id="4920103"><a href="/gostd/html/template/escape.go.html#4919999">t</a></span><span class="op" id="4920104">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920107">if</span>&nbsp;<span class="op" id="4920110">!</span><span class="ident" id="4920111"><a href="/gostd/html/template/escape.go.html#4920073">ok</a></span>&nbsp;<span class="op" id="4920114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920118">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;fixed&nbsp;point&nbsp;by&nbsp;assuming&nbsp;c1&nbsp;as&nbsp;the&nbsp;output&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920184">if</span>&nbsp;<span class="ident" id="4920187">c2</span><span class="op" id="4920189">,</span>&nbsp;<span class="ident" id="4920191">ok2</span>&nbsp;<span class="op" id="4920195">:=</span>&nbsp;<span class="ident" id="4920198"><a href="/gostd/html/template/escape.go.html#4919962">e</a></span><span class="op" id="4920199">.</span><span class="ident" id="4920200"><a href="/gostd/html/template/escape.go.html#4920729">escapeTemplateBody</a></span><span class="op" id="4920218">(</span><span class="ident" id="4920219"><a href="/gostd/html/template/escape.go.html#4920069">c1</a></span><span class="op" id="4920221">,</span>&nbsp;<span class="ident" id="4920223"><a href="/gostd/html/template/escape.go.html#4919999">t</a></span><span class="op" id="4920224">)</span><span class="op" id="4920225">;</span>&nbsp;<span class="ident" id="4920227"><a href="/gostd/html/template/escape.go.html#4920191">ok2</a></span>&nbsp;<span class="op" id="4920231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920236"><a href="/gostd/html/template/escape.go.html#4920069">c1</a></span><span class="op" id="4920238">,</span>&nbsp;<span class="ident" id="4920240"><a href="/gostd/html/template/escape.go.html#4920073">ok</a></span>&nbsp;<span class="op" id="4920243">=</span>&nbsp;<span class="ident" id="4920245"><a href="/gostd/html/template/escape.go.html#4920187">c2</a></span><span class="op" id="4920247">,</span>&nbsp;<span class="builtintype" id="4920249">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920256">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920260">//&nbsp;Use&nbsp;c1&nbsp;as&nbsp;the&nbsp;error&nbsp;context&nbsp;if&nbsp;neither&nbsp;assumption&nbsp;worked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920325">if</span>&nbsp;<span class="op" id="4920328">!</span><span class="ident" id="4920329"><a href="/gostd/html/template/escape.go.html#4920073">ok</a></span>&nbsp;<span class="op" id="4920332">&amp;&amp;</span>&nbsp;<span class="ident" id="4920335"><a href="/gostd/html/template/escape.go.html#4920069">c1</a></span><span class="op" id="4920337">.</span><span class="ident" id="4920338"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4920344">!=</span>&nbsp;<span class="ident" id="4920347"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span>&nbsp;<span class="op" id="4920358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920362">return</span>&nbsp;<span class="ident" id="4920369"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4920376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920381"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4920386">:</span>&nbsp;<span class="ident" id="4920388"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span><span class="op" id="4920398">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920403"><a href="/gostd/html/template/context.go.html#4873059">err</a></span><span class="op" id="4920406">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4920410"><a href="/gostd/html/template/error.go.html#4903515">errorf</a></span><span class="op" id="4920416">(</span><span class="ident" id="4920417"><a href="/gostd/html/template/error.go.html#4901050">ErrOutputContext</a></span><span class="op" id="4920433">,</span>&nbsp;<span class="ident" id="4920435"><a href="/gostd/html/template/escape.go.html#4919999">t</a></span><span class="op" id="4920436">.</span><span class="ident" id="4920437"><a href="/gostd/text/template/template.go.html#3739734">Tree</a></span><span class="op" id="4920441">.</span><span class="ident" id="4920442"><a href="/gostd/text/template/parse/parse.go.html#3181317">Root</a></span><span class="op" id="4920446">,</span>&nbsp;<span class="num" id="4920448">0</span><span class="op" id="4920449">,</span>&nbsp;<span class="string" id="4920451">&#34;cannot&nbsp;compute&nbsp;output&nbsp;context&nbsp;for&nbsp;template&nbsp;%s&#34;</span><span class="op" id="4920498">,</span>&nbsp;<span class="ident" id="4920500"><a href="/gostd/html/template/escape.go.html#4919999">t</a></span><span class="op" id="4920501">.</span><span class="ident" id="4920502"><a href="/gostd/text/template/template.go.html#3739983">Name</a></span><span class="op" id="4920506">(</span><span class="op" id="4920507">)</span><span class="op" id="4920508">)</span><span class="op" id="4920509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920519">return</span>&nbsp;<span class="ident" id="4920526"><a href="/gostd/html/template/escape.go.html#4920069">c1</a></span><br>
<span class="lineno"></span><span class="op" id="4920529">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="4920532">//&nbsp;escapeTemplateBody&nbsp;escapes&nbsp;the&nbsp;given&nbsp;template&nbsp;assuming&nbsp;the&nbsp;given&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="4920607">//&nbsp;context,&nbsp;and&nbsp;returns&nbsp;the&nbsp;best&nbsp;guess&nbsp;at&nbsp;the&nbsp;output&nbsp;context&nbsp;and&nbsp;whether&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4920684">//&nbsp;assumption&nbsp;was&nbsp;correct.</span><br>
<span class="lineno"></span><span class="keyword" id="4920711">func</span>&nbsp;<span class="op" id="4920716">(</span><span class="ident" id="4920717">e</span>&nbsp;<span class="op" id="4920719">*</span><span class="ident" id="4920720"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4920727">)</span>&nbsp;<span class="ident" id="4920729">escapeTemplateBody</span><span class="op" id="4920747">(</span><span class="ident" id="4920748">c</span>&nbsp;<span class="ident" id="4920750"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4920757">,</span>&nbsp;<span class="ident" id="4920759">t</span>&nbsp;<span class="op" id="4920761">*</span><span class="ident" id="4920762"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4920770">.</span><span class="ident" id="4920771"><a href="/gostd/text/template/template.go.html#3739702">Template</a></span><span class="op" id="4920779">)</span>&nbsp;<span class="op" id="4920781">(</span><span class="ident" id="4920782"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4920789">,</span>&nbsp;<span class="builtintype" id="4920791">bool</span><span class="op" id="4920795">)</span>&nbsp;<span class="op" id="4920797">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920800">filter</span>&nbsp;<span class="op" id="4920807">:=</span>&nbsp;<span class="keyword" id="4920810">func</span><span class="op" id="4920814">(</span><span class="ident" id="4920815">e1</span>&nbsp;<span class="op" id="4920818">*</span><span class="ident" id="4920819"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4920826">,</span>&nbsp;<span class="ident" id="4920828">c1</span>&nbsp;<span class="ident" id="4920831"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4920838">)</span>&nbsp;<span class="builtintype" id="4920840">bool</span>&nbsp;<span class="op" id="4920845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920849">if</span>&nbsp;<span class="ident" id="4920852"><a href="/gostd/html/template/escape.go.html#4920828">c1</a></span><span class="op" id="4920854">.</span><span class="ident" id="4920855"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4920861">==</span>&nbsp;<span class="ident" id="4920864"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span>&nbsp;<span class="op" id="4920875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920880">//&nbsp;Do&nbsp;not&nbsp;update&nbsp;the&nbsp;input&nbsp;escaper,&nbsp;e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920922">return</span>&nbsp;<span class="builtintype" id="4920929">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920937">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920941">if</span>&nbsp;<span class="op" id="4920944">!</span><span class="ident" id="4920945"><a href="/gostd/html/template/escape.go.html#4920815">e1</a></span><span class="op" id="4920947">.</span><span class="ident" id="4920948"><a href="/gostd/html/template/escape.go.html#4906551">called</a></span><span class="op" id="4920954">[</span><span class="ident" id="4920955"><a href="/gostd/html/template/escape.go.html#4920759">t</a></span><span class="op" id="4920956">.</span><span class="ident" id="4920957"><a href="/gostd/text/template/template.go.html#3739983">Name</a></span><span class="op" id="4920961">(</span><span class="op" id="4920962">)</span><span class="op" id="4920963">]</span>&nbsp;<span class="op" id="4920965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920970">//&nbsp;If&nbsp;t&nbsp;is&nbsp;not&nbsp;recursively&nbsp;called,&nbsp;then&nbsp;c1&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921022">//&nbsp;accurate&nbsp;output&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921053">return</span>&nbsp;<span class="builtintype" id="4921060">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921067">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921071">//&nbsp;c1&nbsp;is&nbsp;accurate&nbsp;if&nbsp;it&nbsp;matches&nbsp;our&nbsp;assumed&nbsp;output&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921133">return</span>&nbsp;<span class="ident" id="4921140"><a href="/gostd/html/template/escape.go.html#4920748">c</a></span><span class="op" id="4921141">.</span><span class="ident" id="4921142"><a href="/gostd/html/template/context.go.html#4873288">eq</a></span><span class="op" id="4921144">(</span><span class="ident" id="4921145"><a href="/gostd/html/template/escape.go.html#4920828">c1</a></span><span class="op" id="4921147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921153">//&nbsp;We&nbsp;need&nbsp;to&nbsp;assume&nbsp;an&nbsp;output&nbsp;context&nbsp;so&nbsp;that&nbsp;recursive&nbsp;template&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921226">//&nbsp;take&nbsp;the&nbsp;fast&nbsp;path&nbsp;out&nbsp;of&nbsp;escapeTree&nbsp;instead&nbsp;of&nbsp;infinitely&nbsp;recursing.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921300">//&nbsp;Naively&nbsp;assuming&nbsp;that&nbsp;the&nbsp;input&nbsp;context&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921370">//&nbsp;works&nbsp;&gt;90%&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921398"><a href="/gostd/html/template/escape.go.html#4920717">e</a></span><span class="op" id="4921399">.</span><span class="ident" id="4921400"><a href="/gostd/html/template/escape.go.html#4906291">output</a></span><span class="op" id="4921406">[</span><span class="ident" id="4921407"><a href="/gostd/html/template/escape.go.html#4920759">t</a></span><span class="op" id="4921408">.</span><span class="ident" id="4921409"><a href="/gostd/text/template/template.go.html#3739983">Name</a></span><span class="op" id="4921413">(</span><span class="op" id="4921414">)</span><span class="op" id="4921415">]</span>&nbsp;<span class="op" id="4921417">=</span>&nbsp;<span class="ident" id="4921419"><a href="/gostd/html/template/escape.go.html#4920748">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921422">return</span>&nbsp;<span class="ident" id="4921429"><a href="/gostd/html/template/escape.go.html#4920717">e</a></span><span class="op" id="4921430">.</span><span class="ident" id="4921431"><a href="/gostd/html/template/escape.go.html#4917533">escapeListConditionally</a></span><span class="op" id="4921454">(</span><span class="ident" id="4921455"><a href="/gostd/html/template/escape.go.html#4920748">c</a></span><span class="op" id="4921456">,</span>&nbsp;<span class="ident" id="4921458"><a href="/gostd/html/template/escape.go.html#4920759">t</a></span><span class="op" id="4921459">.</span><span class="ident" id="4921460"><a href="/gostd/text/template/template.go.html#3739734">Tree</a></span><span class="op" id="4921464">.</span><span class="ident" id="4921465"><a href="/gostd/text/template/parse/parse.go.html#3181317">Root</a></span><span class="op" id="4921469">,</span>&nbsp;<span class="ident" id="4921471"><a href="/gostd/html/template/escape.go.html#4920800">filter</a></span><span class="op" id="4921477">)</span><br>
<span class="lineno"></span><span class="op" id="4921479">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="4921482">//&nbsp;delimEnds&nbsp;maps&nbsp;each&nbsp;delim&nbsp;to&nbsp;a&nbsp;string&nbsp;of&nbsp;characters&nbsp;that&nbsp;terminate&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4921556">var</span>&nbsp;<span class="ident" id="4921560">delimEnds</span>&nbsp;<span class="op" id="4921570">=</span>&nbsp;<span class="op" id="4921572">[</span><span class="op" id="4921573">...</span><span class="op" id="4921576">]</span><span class="builtintype" id="4921577">string</span><span class="op" id="4921583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921586"><a href="/gostd/html/template/context.go.html#4878677">delimDoubleQuote</a></span><span class="op" id="4921602">:</span>&nbsp;<span class="string" id="4921604">`&#34;`</span><span class="op" id="4921607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921610"><a href="/gostd/html/template/context.go.html#4878769">delimSingleQuote</a></span><span class="op" id="4921626">:</span>&nbsp;<span class="string" id="4921628">&#34;&#39;&#34;</span><span class="op" id="4921631">,</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921634">//&nbsp;Determined&nbsp;empirically&nbsp;by&nbsp;running&nbsp;the&nbsp;below&nbsp;in&nbsp;various&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921703">//&nbsp;var&nbsp;div&nbsp;=&nbsp;document.createElement(&#34;DIV&#34;);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921748">//&nbsp;for&nbsp;(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921788">//&nbsp;&nbsp;&nbsp;div.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=x&#34;&nbsp;+&nbsp;String.fromCharCode(i)&nbsp;+&nbsp;&#34;-bar&gt;&#34;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921862">//&nbsp;&nbsp;&nbsp;if&nbsp;(div.getElementsByTagName(&#34;SPAN&#34;)[0].title.indexOf(&#34;bar&#34;)&nbsp;&lt;&nbsp;0)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921934">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.write(&#34;&lt;p&gt;U+&#34;&nbsp;+&nbsp;i.toString(16));</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921984">//&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921990"><a href="/gostd/html/template/context.go.html#4878883">delimSpaceOrTagEnd</a></span><span class="op" id="4922008">:</span>&nbsp;<span class="string" id="4922010">&#34;&nbsp;\t\n\f\r&gt;&#34;</span><span class="op" id="4922022">,</span><br>
<span class="lineno"></span><span class="op" id="4922024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="4922027">var</span>&nbsp;<span class="ident" id="4922031">doctypeBytes</span>&nbsp;<span class="op" id="4922044">=</span>&nbsp;<span class="op" id="4922046">[</span><span class="op" id="4922047">]</span><span class="builtintype" id="4922048">byte</span><span class="op" id="4922052">(</span><span class="string" id="4922053">&#34;&lt;!DOCTYPE&#34;</span><span class="op" id="4922064">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4922067">//&nbsp;escapeText&nbsp;escapes&nbsp;a&nbsp;text&nbsp;template&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4922111">func</span>&nbsp;<span class="op" id="4922116">(</span><span class="ident" id="4922117">e</span>&nbsp;<span class="op" id="4922119">*</span><span class="ident" id="4922120"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4922127">)</span>&nbsp;<span class="ident" id="4922129">escapeText</span><span class="op" id="4922139">(</span><span class="ident" id="4922140">c</span>&nbsp;<span class="ident" id="4922142"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4922149">,</span>&nbsp;<span class="ident" id="4922151">n</span>&nbsp;<span class="op" id="4922153">*</span><span class="ident" id="4922154"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4922159">.</span><span class="ident" id="4922160"><a href="/gostd/text/template/parse/node.go.html#3163353">TextNode</a></span><span class="op" id="4922168">)</span>&nbsp;<span class="ident" id="4922170"><a href="/gostd/html/template/context.go.html#4872948">context</a></span>&nbsp;<span class="op" id="4922178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922181">s</span><span class="op" id="4922182">,</span>&nbsp;<span class="ident" id="4922184">written</span><span class="op" id="4922191">,</span>&nbsp;<span class="ident" id="4922193">i</span><span class="op" id="4922194">,</span>&nbsp;<span class="ident" id="4922196">b</span>&nbsp;<span class="op" id="4922198">:=</span>&nbsp;<span class="ident" id="4922201"><a href="/gostd/html/template/escape.go.html#4922151">n</a></span><span class="op" id="4922202">.</span><span class="ident" id="4922203"><a href="/gostd/text/template/parse/node.go.html#3163399">Text</a></span><span class="op" id="4922207">,</span>&nbsp;<span class="num" id="4922209">0</span><span class="op" id="4922210">,</span>&nbsp;<span class="num" id="4922212">0</span><span class="op" id="4922213">,</span>&nbsp;<span class="builtinfunc" id="4922215">new</span><span class="op" id="4922218">(</span><span class="ident" id="4922219"><a href="/gostd/html/template/escape.go.html#4903852">bytes</a></span><span class="op" id="4922224">.</span><span class="ident" id="4922225"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><span class="op" id="4922231">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922234">for</span>&nbsp;<span class="ident" id="4922238"><a href="/gostd/html/template/escape.go.html#4922193">i</a></span>&nbsp;<span class="op" id="4922240">!=</span>&nbsp;<span class="builtinfunc" id="4922243">len</span><span class="op" id="4922246">(</span><span class="ident" id="4922247"><a href="/gostd/html/template/escape.go.html#4922181">s</a></span><span class="op" id="4922248">)</span>&nbsp;<span class="op" id="4922250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922254">c1</span><span class="op" id="4922256">,</span>&nbsp;<span class="ident" id="4922258">nread</span>&nbsp;<span class="op" id="4922264">:=</span>&nbsp;<span class="ident" id="4922267"><a href="/gostd/html/template/escape.go.html#4924095">contextAfterText</a></span><span class="op" id="4922283">(</span><span class="ident" id="4922284"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4922285">,</span>&nbsp;<span class="ident" id="4922287"><a href="/gostd/html/template/escape.go.html#4922181">s</a></span><span class="op" id="4922288">[</span><span class="ident" id="4922289"><a href="/gostd/html/template/escape.go.html#4922193">i</a></span><span class="op" id="4922290">:</span><span class="op" id="4922291">]</span><span class="op" id="4922292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922296">i1</span>&nbsp;<span class="op" id="4922299">:=</span>&nbsp;<span class="ident" id="4922302"><a href="/gostd/html/template/escape.go.html#4922193">i</a></span>&nbsp;<span class="op" id="4922304">+</span>&nbsp;<span class="ident" id="4922306"><a href="/gostd/html/template/escape.go.html#4922258">nread</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922314">if</span>&nbsp;<span class="ident" id="4922317"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4922318">.</span><span class="ident" id="4922319"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4922325">==</span>&nbsp;<span class="ident" id="4922328"><a href="/gostd/html/template/context.go.html#4874843">stateText</a></span>&nbsp;<span class="op" id="4922338">||</span>&nbsp;<span class="ident" id="4922341"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4922342">.</span><span class="ident" id="4922343"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4922349">==</span>&nbsp;<span class="ident" id="4922352"><a href="/gostd/html/template/context.go.html#4875567">stateRCDATA</a></span>&nbsp;<span class="op" id="4922364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922369">end</span>&nbsp;<span class="op" id="4922373">:=</span>&nbsp;<span class="ident" id="4922376"><a href="/gostd/html/template/escape.go.html#4922296">i1</a></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922382">if</span>&nbsp;<span class="ident" id="4922385"><a href="/gostd/html/template/escape.go.html#4922254">c1</a></span><span class="op" id="4922387">.</span><span class="ident" id="4922388"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4922394">!=</span>&nbsp;<span class="ident" id="4922397"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4922398">.</span><span class="ident" id="4922399"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4922405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922411">for</span>&nbsp;<span class="ident" id="4922415">j</span>&nbsp;<span class="op" id="4922417">:=</span>&nbsp;<span class="ident" id="4922420"><a href="/gostd/html/template/escape.go.html#4922369">end</a></span>&nbsp;<span class="op" id="4922424">-</span>&nbsp;<span class="num" id="4922426">1</span><span class="op" id="4922427">;</span>&nbsp;<span class="ident" id="4922429"><a href="/gostd/html/template/escape.go.html#4922415">j</a></span>&nbsp;<span class="op" id="4922431">&gt;=</span>&nbsp;<span class="ident" id="4922434"><a href="/gostd/html/template/escape.go.html#4922193">i</a></span><span class="op" id="4922435">;</span>&nbsp;<span class="ident" id="4922437"><a href="/gostd/html/template/escape.go.html#4922415">j</a></span><span class="op" id="4922438">--</span>&nbsp;<span class="op" id="4922441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922448">if</span>&nbsp;<span class="ident" id="4922451"><a href="/gostd/html/template/escape.go.html#4922181">s</a></span><span class="op" id="4922452">[</span><span class="ident" id="4922453"><a href="/gostd/html/template/escape.go.html#4922415">j</a></span><span class="op" id="4922454">]</span>&nbsp;<span class="op" id="4922456">==</span>&nbsp;<span class="string" id="4922459">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4922463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922471"><a href="/gostd/html/template/escape.go.html#4922369">end</a></span>&nbsp;<span class="op" id="4922475">=</span>&nbsp;<span class="ident" id="4922477"><a href="/gostd/html/template/escape.go.html#4922415">j</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922485">break</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922512">for</span>&nbsp;<span class="ident" id="4922516">j</span>&nbsp;<span class="op" id="4922518">:=</span>&nbsp;<span class="ident" id="4922521"><a href="/gostd/html/template/escape.go.html#4922193">i</a></span><span class="op" id="4922522">;</span>&nbsp;<span class="ident" id="4922524"><a href="/gostd/html/template/escape.go.html#4922516">j</a></span>&nbsp;<span class="op" id="4922526">&lt;</span>&nbsp;<span class="ident" id="4922528"><a href="/gostd/html/template/escape.go.html#4922369">end</a></span><span class="op" id="4922531">;</span>&nbsp;<span class="ident" id="4922533"><a href="/gostd/html/template/escape.go.html#4922516">j</a></span><span class="op" id="4922534">++</span>&nbsp;<span class="op" id="4922537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922543">if</span>&nbsp;<span class="ident" id="4922546"><a href="/gostd/html/template/escape.go.html#4922181">s</a></span><span class="op" id="4922547">[</span><span class="ident" id="4922548"><a href="/gostd/html/template/escape.go.html#4922516">j</a></span><span class="op" id="4922549">]</span>&nbsp;<span class="op" id="4922551">==</span>&nbsp;<span class="string" id="4922554">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4922558">&amp;&amp;</span>&nbsp;<span class="op" id="4922561">!</span><span class="ident" id="4922562"><a href="/gostd/html/template/escape.go.html#4903852">bytes</a></span><span class="op" id="4922567">.</span><span class="ident" id="4922568"><a href="/gostd/bytes/bytes.go.html#1403977">HasPrefix</a></span><span class="op" id="4922577">(</span><span class="ident" id="4922578"><a href="/gostd/html/template/escape.go.html#4903852">bytes</a></span><span class="op" id="4922583">.</span><span class="ident" id="4922584"><a href="/gostd/bytes/bytes.go.html#1405760">ToUpper</a></span><span class="op" id="4922591">(</span><span class="ident" id="4922592"><a href="/gostd/html/template/escape.go.html#4922181">s</a></span><span class="op" id="4922593">[</span><span class="ident" id="4922594"><a href="/gostd/html/template/escape.go.html#4922516">j</a></span><span class="op" id="4922595">:</span><span class="op" id="4922596">]</span><span class="op" id="4922597">)</span><span class="op" id="4922598">,</span>&nbsp;<span class="ident" id="4922600"><a href="/gostd/html/template/escape.go.html#4922031">doctypeBytes</a></span><span class="op" id="4922612">)</span>&nbsp;<span class="op" id="4922614">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922621"><a href="/gostd/html/template/escape.go.html#4922196">b</a></span><span class="op" id="4922622">.</span><span class="ident" id="4922623"><a href="/gostd/bytes/buffer.go.html#1387016">Write</a></span><span class="op" id="4922628">(</span><span class="ident" id="4922629"><a href="/gostd/html/template/escape.go.html#4922181">s</a></span><span class="op" id="4922630">[</span><span class="ident" id="4922631"><a href="/gostd/html/template/escape.go.html#4922184">written</a></span><span class="op" id="4922638">:</span><span class="ident" id="4922639"><a href="/gostd/html/template/escape.go.html#4922516">j</a></span><span class="op" id="4922640">]</span><span class="op" id="4922641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922648"><a href="/gostd/html/template/escape.go.html#4922196">b</a></span><span class="op" id="4922649">.</span><span class="ident" id="4922650"><a href="/gostd/bytes/buffer.go.html#1387374">WriteString</a></span><span class="op" id="4922661">(</span><span class="string" id="4922662">&#34;&amp;lt;&#34;</span><span class="op" id="4922668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922675"><a href="/gostd/html/template/escape.go.html#4922184">written</a></span>&nbsp;<span class="op" id="4922683">=</span>&nbsp;<span class="ident" id="4922685"><a href="/gostd/html/template/escape.go.html#4922516">j</a></span>&nbsp;<span class="op" id="4922687">+</span>&nbsp;<span class="num" id="4922689">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922700">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922704">}</span>&nbsp;<span class="keyword" id="4922706">else</span>&nbsp;<span class="keyword" id="4922711">if</span>&nbsp;<span class="ident" id="4922714"><a href="/gostd/html/template/context.go.html#4878067">isComment</a></span><span class="op" id="4922723">(</span><span class="ident" id="4922724"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4922725">.</span><span class="ident" id="4922726"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4922731">)</span>&nbsp;<span class="op" id="4922733">&amp;&amp;</span>&nbsp;<span class="ident" id="4922736"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4922737">.</span><span class="ident" id="4922738"><a href="/gostd/html/template/context.go.html#4872981">delim</a></span>&nbsp;<span class="op" id="4922744">==</span>&nbsp;<span class="ident" id="4922747"><a href="/gostd/html/template/context.go.html#4878579">delimNone</a></span>&nbsp;<span class="op" id="4922757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922762">switch</span>&nbsp;<span class="ident" id="4922769"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4922770">.</span><span class="ident" id="4922771"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4922777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922782">case</span>&nbsp;<span class="ident" id="4922787"><a href="/gostd/html/template/context.go.html#4876114">stateJSBlockCmt</a></span><span class="op" id="4922802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4922808">//&nbsp;http://es5.github.com/#x7.4:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4922844">//&nbsp;&#34;Comments&nbsp;behave&nbsp;like&nbsp;white&nbsp;space&nbsp;and&nbsp;are</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4922893">//&nbsp;discarded&nbsp;except&nbsp;that,&nbsp;if&nbsp;a&nbsp;MultiLineComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4922945">//&nbsp;contains&nbsp;a&nbsp;line&nbsp;terminator&nbsp;character,&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4922995">//&nbsp;the&nbsp;entire&nbsp;comment&nbsp;is&nbsp;considered&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4923043">//&nbsp;LineTerminator&nbsp;for&nbsp;purposes&nbsp;of&nbsp;parsing&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4923092">//&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923123">if</span>&nbsp;<span class="ident" id="4923126"><a href="/gostd/html/template/escape.go.html#4903852">bytes</a></span><span class="op" id="4923131">.</span><span class="ident" id="4923132"><a href="/gostd/bytes/bytes.go.html#1399077">IndexAny</a></span><span class="op" id="4923140">(</span><span class="ident" id="4923141"><a href="/gostd/html/template/escape.go.html#4922181">s</a></span><span class="op" id="4923142">[</span><span class="ident" id="4923143"><a href="/gostd/html/template/escape.go.html#4922184">written</a></span><span class="op" id="4923150">:</span><span class="ident" id="4923151"><a href="/gostd/html/template/escape.go.html#4922296">i1</a></span><span class="op" id="4923153">]</span><span class="op" id="4923154">,</span>&nbsp;<span class="string" id="4923156">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="4923174">)</span>&nbsp;<span class="op" id="4923176">!=</span>&nbsp;<span class="op" id="4923179">-</span><span class="num" id="4923180">1</span>&nbsp;<span class="op" id="4923182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923189"><a href="/gostd/html/template/escape.go.html#4922196">b</a></span><span class="op" id="4923190">.</span><span class="ident" id="4923191"><a href="/gostd/bytes/buffer.go.html#1390121">WriteByte</a></span><span class="op" id="4923200">(</span><span class="string" id="4923201">&#39;\n&#39;</span><span class="op" id="4923205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923211">}</span>&nbsp;<span class="keyword" id="4923213">else</span>&nbsp;<span class="op" id="4923218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923225"><a href="/gostd/html/template/escape.go.html#4922196">b</a></span><span class="op" id="4923226">.</span><span class="ident" id="4923227"><a href="/gostd/bytes/buffer.go.html#1390121">WriteByte</a></span><span class="op" id="4923236">(</span><span class="string" id="4923237">&#39;&nbsp;&#39;</span><span class="op" id="4923240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923246">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923251">case</span>&nbsp;<span class="ident" id="4923256"><a href="/gostd/html/template/context.go.html#4876723">stateCSSBlockCmt</a></span><span class="op" id="4923272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923278"><a href="/gostd/html/template/escape.go.html#4922196">b</a></span><span class="op" id="4923279">.</span><span class="ident" id="4923280"><a href="/gostd/bytes/buffer.go.html#1390121">WriteByte</a></span><span class="op" id="4923289">(</span><span class="string" id="4923290">&#39;&nbsp;&#39;</span><span class="op" id="4923293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923303"><a href="/gostd/html/template/escape.go.html#4922184">written</a></span>&nbsp;<span class="op" id="4923311">=</span>&nbsp;<span class="ident" id="4923313"><a href="/gostd/html/template/escape.go.html#4922296">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923318">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923322">if</span>&nbsp;<span class="ident" id="4923325"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4923326">.</span><span class="ident" id="4923327"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4923333">!=</span>&nbsp;<span class="ident" id="4923336"><a href="/gostd/html/template/escape.go.html#4922254">c1</a></span><span class="op" id="4923338">.</span><span class="ident" id="4923339"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4923345">&amp;&amp;</span>&nbsp;<span class="ident" id="4923348"><a href="/gostd/html/template/context.go.html#4878067">isComment</a></span><span class="op" id="4923357">(</span><span class="ident" id="4923358"><a href="/gostd/html/template/escape.go.html#4922254">c1</a></span><span class="op" id="4923360">.</span><span class="ident" id="4923361"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4923366">)</span>&nbsp;<span class="op" id="4923368">&amp;&amp;</span>&nbsp;<span class="ident" id="4923371"><a href="/gostd/html/template/escape.go.html#4922254">c1</a></span><span class="op" id="4923373">.</span><span class="ident" id="4923374"><a href="/gostd/html/template/context.go.html#4872981">delim</a></span>&nbsp;<span class="op" id="4923380">==</span>&nbsp;<span class="ident" id="4923383"><a href="/gostd/html/template/context.go.html#4878579">delimNone</a></span>&nbsp;<span class="op" id="4923393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4923398">//&nbsp;Preserve&nbsp;the&nbsp;portion&nbsp;between&nbsp;written&nbsp;and&nbsp;the&nbsp;comment&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923464">cs</span>&nbsp;<span class="op" id="4923467">:=</span>&nbsp;<span class="ident" id="4923470"><a href="/gostd/html/template/escape.go.html#4922296">i1</a></span>&nbsp;<span class="op" id="4923473">-</span>&nbsp;<span class="num" id="4923475">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923480">if</span>&nbsp;<span class="ident" id="4923483"><a href="/gostd/html/template/escape.go.html#4922254">c1</a></span><span class="op" id="4923485">.</span><span class="ident" id="4923486"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4923492">==</span>&nbsp;<span class="ident" id="4923495"><a href="/gostd/html/template/context.go.html#4875411">stateHTMLCmt</a></span>&nbsp;<span class="op" id="4923508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4923514">//&nbsp;&#34;&lt;!--&#34;&nbsp;instead&nbsp;of&nbsp;&#34;/*&#34;&nbsp;or&nbsp;&#34;//&#34;</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923552"><a href="/gostd/html/template/escape.go.html#4923464">cs</a></span>&nbsp;<span class="op" id="4923555">-=</span>&nbsp;<span class="num" id="4923558">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923568"><a href="/gostd/html/template/escape.go.html#4922196">b</a></span><span class="op" id="4923569">.</span><span class="ident" id="4923570"><a href="/gostd/bytes/buffer.go.html#1387016">Write</a></span><span class="op" id="4923575">(</span><span class="ident" id="4923576"><a href="/gostd/html/template/escape.go.html#4922181">s</a></span><span class="op" id="4923577">[</span><span class="ident" id="4923578"><a href="/gostd/html/template/escape.go.html#4922184">written</a></span><span class="op" id="4923585">:</span><span class="ident" id="4923586"><a href="/gostd/html/template/escape.go.html#4923464">cs</a></span><span class="op" id="4923588">]</span><span class="op" id="4923589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923594"><a href="/gostd/html/template/escape.go.html#4922184">written</a></span>&nbsp;<span class="op" id="4923602">=</span>&nbsp;<span class="ident" id="4923604"><a href="/gostd/html/template/escape.go.html#4922296">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923609">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923613">if</span>&nbsp;<span class="ident" id="4923616"><a href="/gostd/html/template/escape.go.html#4922193">i</a></span>&nbsp;<span class="op" id="4923618">==</span>&nbsp;<span class="ident" id="4923621"><a href="/gostd/html/template/escape.go.html#4922296">i1</a></span>&nbsp;<span class="op" id="4923624">&amp;&amp;</span>&nbsp;<span class="ident" id="4923627"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4923628">.</span><span class="ident" id="4923629"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4923635">==</span>&nbsp;<span class="ident" id="4923638"><a href="/gostd/html/template/escape.go.html#4922254">c1</a></span><span class="op" id="4923640">.</span><span class="ident" id="4923641"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4923647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4923652">panic</span><span class="op" id="4923657">(</span><span class="ident" id="4923658"><a href="/gostd/html/template/escape.go.html#4903861">fmt</a></span><span class="op" id="4923661">.</span><span class="ident" id="4923662"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="4923669">(</span><span class="string" id="4923670">&#34;infinite&nbsp;loop&nbsp;from&nbsp;%v&nbsp;to&nbsp;%v&nbsp;on&nbsp;%q..%q&#34;</span><span class="op" id="4923709">,</span>&nbsp;<span class="ident" id="4923711"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4923712">,</span>&nbsp;<span class="ident" id="4923714"><a href="/gostd/html/template/escape.go.html#4922254">c1</a></span><span class="op" id="4923716">,</span>&nbsp;<span class="ident" id="4923718"><a href="/gostd/html/template/escape.go.html#4922181">s</a></span><span class="op" id="4923719">[</span><span class="op" id="4923720">:</span><span class="ident" id="4923721"><a href="/gostd/html/template/escape.go.html#4922193">i</a></span><span class="op" id="4923722">]</span><span class="op" id="4923723">,</span>&nbsp;<span class="ident" id="4923725"><a href="/gostd/html/template/escape.go.html#4922181">s</a></span><span class="op" id="4923726">[</span><span class="ident" id="4923727"><a href="/gostd/html/template/escape.go.html#4922193">i</a></span><span class="op" id="4923728">:</span><span class="op" id="4923729">]</span><span class="op" id="4923730">)</span><span class="op" id="4923731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923739"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4923740">,</span>&nbsp;<span class="ident" id="4923742"><a href="/gostd/html/template/escape.go.html#4922193">i</a></span>&nbsp;<span class="op" id="4923744">=</span>&nbsp;<span class="ident" id="4923746"><a href="/gostd/html/template/escape.go.html#4922254">c1</a></span><span class="op" id="4923748">,</span>&nbsp;<span class="ident" id="4923750"><a href="/gostd/html/template/escape.go.html#4922296">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923754">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923758">if</span>&nbsp;<span class="ident" id="4923761"><a href="/gostd/html/template/escape.go.html#4922184">written</a></span>&nbsp;<span class="op" id="4923769">!=</span>&nbsp;<span class="num" id="4923772">0</span>&nbsp;<span class="op" id="4923774">&amp;&amp;</span>&nbsp;<span class="ident" id="4923777"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4923778">.</span><span class="ident" id="4923779"><a href="/gostd/html/template/context.go.html#4872966">state</a></span>&nbsp;<span class="op" id="4923785">!=</span>&nbsp;<span class="ident" id="4923788"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span>&nbsp;<span class="op" id="4923799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923803">if</span>&nbsp;<span class="op" id="4923806">!</span><span class="ident" id="4923807"><a href="/gostd/html/template/context.go.html#4878067">isComment</a></span><span class="op" id="4923816">(</span><span class="ident" id="4923817"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4923818">.</span><span class="ident" id="4923819"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4923824">)</span>&nbsp;<span class="op" id="4923826">||</span>&nbsp;<span class="ident" id="4923829"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><span class="op" id="4923830">.</span><span class="ident" id="4923831"><a href="/gostd/html/template/context.go.html#4872981">delim</a></span>&nbsp;<span class="op" id="4923837">!=</span>&nbsp;<span class="ident" id="4923840"><a href="/gostd/html/template/context.go.html#4878579">delimNone</a></span>&nbsp;<span class="op" id="4923850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923855"><a href="/gostd/html/template/escape.go.html#4922196">b</a></span><span class="op" id="4923856">.</span><span class="ident" id="4923857"><a href="/gostd/bytes/buffer.go.html#1387016">Write</a></span><span class="op" id="4923862">(</span><span class="ident" id="4923863"><a href="/gostd/html/template/escape.go.html#4922151">n</a></span><span class="op" id="4923864">.</span><span class="ident" id="4923865"><a href="/gostd/text/template/parse/node.go.html#3163399">Text</a></span><span class="op" id="4923869">[</span><span class="ident" id="4923870"><a href="/gostd/html/template/escape.go.html#4922184">written</a></span><span class="op" id="4923877">:</span><span class="op" id="4923878">]</span><span class="op" id="4923879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923883">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923887"><a href="/gostd/html/template/escape.go.html#4922117">e</a></span><span class="op" id="4923888">.</span><span class="ident" id="4923889"><a href="/gostd/html/template/escape.go.html#4926402">editTextNode</a></span><span class="op" id="4923901">(</span><span class="ident" id="4923902"><a href="/gostd/html/template/escape.go.html#4922151">n</a></span><span class="op" id="4923903">,</span>&nbsp;<span class="ident" id="4923905"><a href="/gostd/html/template/escape.go.html#4922196">b</a></span><span class="op" id="4923906">.</span><span class="ident" id="4923907"><a href="/gostd/bytes/buffer.go.html#1384454">Bytes</a></span><span class="op" id="4923912">(</span><span class="op" id="4923913">)</span><span class="op" id="4923914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923920">return</span>&nbsp;<span class="ident" id="4923927"><a href="/gostd/html/template/escape.go.html#4922140">c</a></span><br>
<span class="lineno"></span><span class="op" id="4923929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="4923932">//&nbsp;contextAfterText&nbsp;starts&nbsp;in&nbsp;context&nbsp;c,&nbsp;consumes&nbsp;some&nbsp;tokens&nbsp;from&nbsp;the&nbsp;front&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4924012">//&nbsp;s,&nbsp;then&nbsp;returns&nbsp;the&nbsp;context&nbsp;after&nbsp;those&nbsp;tokens&nbsp;and&nbsp;the&nbsp;unprocessed&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="4924090">func</span>&nbsp;<span class="ident" id="4924095">contextAfterText</span><span class="op" id="4924111">(</span><span class="ident" id="4924112">c</span>&nbsp;<span class="ident" id="4924114"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4924121">,</span>&nbsp;<span class="ident" id="4924123">s</span>&nbsp;<span class="op" id="4924125">[</span><span class="op" id="4924126">]</span><span class="builtintype" id="4924127">byte</span><span class="op" id="4924131">)</span>&nbsp;<span class="op" id="4924133">(</span><span class="ident" id="4924134"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4924141">,</span>&nbsp;<span class="builtintype" id="4924143">int</span><span class="op" id="4924146">)</span>&nbsp;<span class="op" id="4924148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924151">if</span>&nbsp;<span class="ident" id="4924154"><a href="/gostd/html/template/escape.go.html#4924112">c</a></span><span class="op" id="4924155">.</span><span class="ident" id="4924156"><a href="/gostd/html/template/context.go.html#4872981">delim</a></span>&nbsp;<span class="op" id="4924162">==</span>&nbsp;<span class="ident" id="4924165"><a href="/gostd/html/template/context.go.html#4878579">delimNone</a></span>&nbsp;<span class="op" id="4924175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924179">c1</span><span class="op" id="4924181">,</span>&nbsp;<span class="ident" id="4924183">i</span>&nbsp;<span class="op" id="4924185">:=</span>&nbsp;<span class="ident" id="4924188"><a href="/gostd/html/template/transition.go.html#4963710">tSpecialTagEnd</a></span><span class="op" id="4924202">(</span><span class="ident" id="4924203"><a href="/gostd/html/template/escape.go.html#4924112">c</a></span><span class="op" id="4924204">,</span>&nbsp;<span class="ident" id="4924206"><a href="/gostd/html/template/escape.go.html#4924123">s</a></span><span class="op" id="4924207">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924211">if</span>&nbsp;<span class="ident" id="4924214"><a href="/gostd/html/template/escape.go.html#4924183">i</a></span>&nbsp;<span class="op" id="4924216">==</span>&nbsp;<span class="num" id="4924219">0</span>&nbsp;<span class="op" id="4924221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4924226">//&nbsp;A&nbsp;special&nbsp;end&nbsp;tag&nbsp;(`&lt;/script&gt;`)&nbsp;has&nbsp;been&nbsp;seen&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4924282">//&nbsp;all&nbsp;content&nbsp;preceding&nbsp;it&nbsp;has&nbsp;been&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924332">return</span>&nbsp;<span class="ident" id="4924339"><a href="/gostd/html/template/escape.go.html#4924179">c1</a></span><span class="op" id="4924341">,</span>&nbsp;<span class="num" id="4924343">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924347">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4924351">//&nbsp;Consider&nbsp;all&nbsp;content&nbsp;up&nbsp;to&nbsp;any&nbsp;end&nbsp;tag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924396">return</span>&nbsp;<span class="ident" id="4924403"><a href="/gostd/html/template/transition.go.html#4959238">transitionFunc</a></span><span class="op" id="4924417">[</span><span class="ident" id="4924418"><a href="/gostd/html/template/escape.go.html#4924112">c</a></span><span class="op" id="4924419">.</span><span class="ident" id="4924420"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4924425">]</span><span class="op" id="4924426">(</span><span class="ident" id="4924427"><a href="/gostd/html/template/escape.go.html#4924112">c</a></span><span class="op" id="4924428">,</span>&nbsp;<span class="ident" id="4924430"><a href="/gostd/html/template/escape.go.html#4924123">s</a></span><span class="op" id="4924431">[</span><span class="op" id="4924432">:</span><span class="ident" id="4924433"><a href="/gostd/html/template/escape.go.html#4924183">i</a></span><span class="op" id="4924434">]</span><span class="op" id="4924435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924442">i</span>&nbsp;<span class="op" id="4924444">:=</span>&nbsp;<span class="ident" id="4924447"><a href="/gostd/html/template/escape.go.html#4903852">bytes</a></span><span class="op" id="4924452">.</span><span class="ident" id="4924453"><a href="/gostd/bytes/bytes.go.html#1399077">IndexAny</a></span><span class="op" id="4924461">(</span><span class="ident" id="4924462"><a href="/gostd/html/template/escape.go.html#4924123">s</a></span><span class="op" id="4924463">,</span>&nbsp;<span class="ident" id="4924465"><a href="/gostd/html/template/escape.go.html#4921560">delimEnds</a></span><span class="op" id="4924474">[</span><span class="ident" id="4924475"><a href="/gostd/html/template/escape.go.html#4924112">c</a></span><span class="op" id="4924476">.</span><span class="ident" id="4924477"><a href="/gostd/html/template/context.go.html#4872981">delim</a></span><span class="op" id="4924482">]</span><span class="op" id="4924483">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924486">if</span>&nbsp;<span class="ident" id="4924489"><a href="/gostd/html/template/escape.go.html#4924442">i</a></span>&nbsp;<span class="op" id="4924491">==</span>&nbsp;<span class="op" id="4924494">-</span><span class="num" id="4924495">1</span>&nbsp;<span class="op" id="4924497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924501"><a href="/gostd/html/template/escape.go.html#4924442">i</a></span>&nbsp;<span class="op" id="4924503">=</span>&nbsp;<span class="builtinfunc" id="4924505">len</span><span class="op" id="4924508">(</span><span class="ident" id="4924509"><a href="/gostd/html/template/escape.go.html#4924123">s</a></span><span class="op" id="4924510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924516">if</span>&nbsp;<span class="ident" id="4924519"><a href="/gostd/html/template/escape.go.html#4924112">c</a></span><span class="op" id="4924520">.</span><span class="ident" id="4924521"><a href="/gostd/html/template/context.go.html#4872981">delim</a></span>&nbsp;<span class="op" id="4924527">==</span>&nbsp;<span class="ident" id="4924530"><a href="/gostd/html/template/context.go.html#4878883">delimSpaceOrTagEnd</a></span>&nbsp;<span class="op" id="4924549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4924553">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4924630">//&nbsp;lists&nbsp;the&nbsp;runes&nbsp;below&nbsp;as&nbsp;error&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4924678">//&nbsp;Error&nbsp;out&nbsp;because&nbsp;HTML&nbsp;parsers&nbsp;may&nbsp;differ&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4924736">//&nbsp;&#34;&lt;a&nbsp;id=&nbsp;onclick=f(&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ends&nbsp;inside&nbsp;id&#39;s&nbsp;or&nbsp;onclick&#39;s&nbsp;value,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4924802">//&nbsp;&#34;&lt;a&nbsp;class=`foo&nbsp;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ends&nbsp;inside&nbsp;a&nbsp;value,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4924852">//&nbsp;&#34;&lt;a&nbsp;style=font:&#39;Arial&#39;&#34;&nbsp;needs&nbsp;open-quote&nbsp;fixup.</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4924905">//&nbsp;IE&nbsp;treats&nbsp;&#39;`&#39;&nbsp;as&nbsp;a&nbsp;quotation&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924950">if</span>&nbsp;<span class="ident" id="4924953">j</span>&nbsp;<span class="op" id="4924955">:=</span>&nbsp;<span class="ident" id="4924958"><a href="/gostd/html/template/escape.go.html#4903852">bytes</a></span><span class="op" id="4924963">.</span><span class="ident" id="4924964"><a href="/gostd/bytes/bytes.go.html#1399077">IndexAny</a></span><span class="op" id="4924972">(</span><span class="ident" id="4924973"><a href="/gostd/html/template/escape.go.html#4924123">s</a></span><span class="op" id="4924974">[</span><span class="op" id="4924975">:</span><span class="ident" id="4924976"><a href="/gostd/html/template/escape.go.html#4924442">i</a></span><span class="op" id="4924977">]</span><span class="op" id="4924978">,</span>&nbsp;<span class="string" id="4924980">&#34;\&#34;&#39;&lt;=`&#34;</span><span class="op" id="4924988">)</span><span class="op" id="4924989">;</span>&nbsp;<span class="ident" id="4924991"><a href="/gostd/html/template/escape.go.html#4924953">j</a></span>&nbsp;<span class="op" id="4924993">&gt;=</span>&nbsp;<span class="num" id="4924996">0</span>&nbsp;<span class="op" id="4924998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925003">return</span>&nbsp;<span class="ident" id="4925010"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4925017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4925023"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4925028">:</span>&nbsp;<span class="ident" id="4925030"><a href="/gostd/html/template/context.go.html#4876904">stateError</a></span><span class="op" id="4925040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4925046"><a href="/gostd/html/template/context.go.html#4873059">err</a></span><span class="op" id="4925049">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4925053"><a href="/gostd/html/template/error.go.html#4903515">errorf</a></span><span class="op" id="4925059">(</span><span class="ident" id="4925060"><a href="/gostd/html/template/error.go.html#4898454">ErrBadHTML</a></span><span class="op" id="4925070">,</span>&nbsp;<span class="builtintype" id="4925072">nil</span><span class="op" id="4925075">,</span>&nbsp;<span class="num" id="4925077">0</span><span class="op" id="4925078">,</span>&nbsp;<span class="string" id="4925080">&#34;%q&nbsp;in&nbsp;unquoted&nbsp;attr:&nbsp;%q&#34;</span><span class="op" id="4925105">,</span>&nbsp;<span class="ident" id="4925107"><a href="/gostd/html/template/escape.go.html#4924123">s</a></span><span class="op" id="4925108">[</span><span class="ident" id="4925109"><a href="/gostd/html/template/escape.go.html#4924953">j</a></span><span class="op" id="4925110">:</span><span class="ident" id="4925111"><a href="/gostd/html/template/escape.go.html#4924953">j</a></span><span class="op" id="4925112">+</span><span class="num" id="4925113">1</span><span class="op" id="4925114">]</span><span class="op" id="4925115">,</span>&nbsp;<span class="ident" id="4925117"><a href="/gostd/html/template/escape.go.html#4924123">s</a></span><span class="op" id="4925118">[</span><span class="op" id="4925119">:</span><span class="ident" id="4925120"><a href="/gostd/html/template/escape.go.html#4924442">i</a></span><span class="op" id="4925121">]</span><span class="op" id="4925122">)</span><span class="op" id="4925123">,</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4925128">}</span><span class="op" id="4925129">,</span>&nbsp;<span class="builtinfunc" id="4925131">len</span><span class="op" id="4925134">(</span><span class="ident" id="4925135"><a href="/gostd/html/template/escape.go.html#4924123">s</a></span><span class="op" id="4925136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4925140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4925143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925146">if</span>&nbsp;<span class="ident" id="4925149"><a href="/gostd/html/template/escape.go.html#4924442">i</a></span>&nbsp;<span class="op" id="4925151">==</span>&nbsp;<span class="builtinfunc" id="4925154">len</span><span class="op" id="4925157">(</span><span class="ident" id="4925158"><a href="/gostd/html/template/escape.go.html#4924123">s</a></span><span class="op" id="4925159">)</span>&nbsp;<span class="op" id="4925161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4925165">//&nbsp;Remain&nbsp;inside&nbsp;the&nbsp;attribute.</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4925199">//&nbsp;Decode&nbsp;the&nbsp;value&nbsp;so&nbsp;non-HTML&nbsp;rules&nbsp;can&nbsp;easily&nbsp;handle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4925257">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;button&nbsp;onclick=&#34;alert(&amp;quot;Hi!&amp;quot;)&#34;&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4925308">//&nbsp;without&nbsp;having&nbsp;to&nbsp;entity&nbsp;decode&nbsp;token&nbsp;boundaries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925363">for</span>&nbsp;<span class="ident" id="4925367">u</span>&nbsp;<span class="op" id="4925369">:=</span>&nbsp;<span class="op" id="4925372">[</span><span class="op" id="4925373">]</span><span class="builtintype" id="4925374">byte</span><span class="op" id="4925378">(</span><span class="ident" id="4925379"><a href="/gostd/html/template/escape.go.html#4903868">html</a></span><span class="op" id="4925383">.</span><span class="ident" id="4925384"><a href="/gostd/html/escape.go.html#5082422">UnescapeString</a></span><span class="op" id="4925398">(</span><span class="builtintype" id="4925399">string</span><span class="op" id="4925405">(</span><span class="ident" id="4925406"><a href="/gostd/html/template/escape.go.html#4924123">s</a></span><span class="op" id="4925407">)</span><span class="op" id="4925408">)</span><span class="op" id="4925409">)</span><span class="op" id="4925410">;</span>&nbsp;<span class="builtinfunc" id="4925412">len</span><span class="op" id="4925415">(</span><span class="ident" id="4925416"><a href="/gostd/html/template/escape.go.html#4925367">u</a></span><span class="op" id="4925417">)</span>&nbsp;<span class="op" id="4925419">!=</span>&nbsp;<span class="num" id="4925422">0</span><span class="op" id="4925423">;</span>&nbsp;<span class="op" id="4925425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4925430">c1</span><span class="op" id="4925432">,</span>&nbsp;<span class="ident" id="4925434">i1</span>&nbsp;<span class="op" id="4925437">:=</span>&nbsp;<span class="ident" id="4925440"><a href="/gostd/html/template/transition.go.html#4959238">transitionFunc</a></span><span class="op" id="4925454">[</span><span class="ident" id="4925455"><a href="/gostd/html/template/escape.go.html#4924112">c</a></span><span class="op" id="4925456">.</span><span class="ident" id="4925457"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4925462">]</span><span class="op" id="4925463">(</span><span class="ident" id="4925464"><a href="/gostd/html/template/escape.go.html#4924112">c</a></span><span class="op" id="4925465">,</span>&nbsp;<span class="ident" id="4925467"><a href="/gostd/html/template/escape.go.html#4925367">u</a></span><span class="op" id="4925468">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4925473"><a href="/gostd/html/template/escape.go.html#4924112">c</a></span><span class="op" id="4925474">,</span>&nbsp;<span class="ident" id="4925476"><a href="/gostd/html/template/escape.go.html#4925367">u</a></span>&nbsp;<span class="op" id="4925478">=</span>&nbsp;<span class="ident" id="4925480"><a href="/gostd/html/template/escape.go.html#4925430">c1</a></span><span class="op" id="4925482">,</span>&nbsp;<span class="ident" id="4925484"><a href="/gostd/html/template/escape.go.html#4925367">u</a></span><span class="op" id="4925485">[</span><span class="ident" id="4925486"><a href="/gostd/html/template/escape.go.html#4925434">i1</a></span><span class="op" id="4925488">:</span><span class="op" id="4925489">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4925493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925497">return</span>&nbsp;<span class="ident" id="4925504"><a href="/gostd/html/template/escape.go.html#4924112">c</a></span><span class="op" id="4925505">,</span>&nbsp;<span class="builtinfunc" id="4925507">len</span><span class="op" id="4925510">(</span><span class="ident" id="4925511"><a href="/gostd/html/template/escape.go.html#4924123">s</a></span><span class="op" id="4925512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4925515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925518">if</span>&nbsp;<span class="ident" id="4925521"><a href="/gostd/html/template/escape.go.html#4924112">c</a></span><span class="op" id="4925522">.</span><span class="ident" id="4925523"><a href="/gostd/html/template/context.go.html#4872981">delim</a></span>&nbsp;<span class="op" id="4925529">!=</span>&nbsp;<span class="ident" id="4925532"><a href="/gostd/html/template/context.go.html#4878883">delimSpaceOrTagEnd</a></span>&nbsp;<span class="op" id="4925551">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4925555">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4925579"><a href="/gostd/html/template/escape.go.html#4924442">i</a></span><span class="op" id="4925580">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4925584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4925587">//&nbsp;On&nbsp;exiting&nbsp;an&nbsp;attribute,&nbsp;we&nbsp;discard&nbsp;all&nbsp;state&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4925649">//&nbsp;except&nbsp;the&nbsp;state&nbsp;and&nbsp;element.</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925683">return</span>&nbsp;<span class="ident" id="4925690"><a href="/gostd/html/template/context.go.html#4872948">context</a></span><span class="op" id="4925697">{</span><span class="ident" id="4925698"><a href="/gostd/html/template/context.go.html#4872966">state</a></span><span class="op" id="4925703">:</span>&nbsp;<span class="ident" id="4925705"><a href="/gostd/html/template/context.go.html#4874933">stateTag</a></span><span class="op" id="4925713">,</span>&nbsp;<span class="ident" id="4925715"><a href="/gostd/html/template/context.go.html#4873042">element</a></span><span class="op" id="4925722">:</span>&nbsp;<span class="ident" id="4925724"><a href="/gostd/html/template/escape.go.html#4924112">c</a></span><span class="op" id="4925725">.</span><span class="ident" id="4925726"><a href="/gostd/html/template/context.go.html#4873042">element</a></span><span class="op" id="4925733">}</span><span class="op" id="4925734">,</span>&nbsp;<span class="ident" id="4925736"><a href="/gostd/html/template/escape.go.html#4924442">i</a></span><br>
<span class="lineno"></span><span class="op" id="4925738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4925741">//&nbsp;editActionNode&nbsp;records&nbsp;a&nbsp;change&nbsp;to&nbsp;an&nbsp;action&nbsp;pipeline&nbsp;for&nbsp;later&nbsp;commit.</span><br>
<span class="lineno"></span><span class="keyword" id="4925816">func</span>&nbsp;<span class="op" id="4925821">(</span><span class="ident" id="4925822">e</span>&nbsp;<span class="op" id="4925824">*</span><span class="ident" id="4925825"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4925832">)</span>&nbsp;<span class="ident" id="4925834">editActionNode</span><span class="op" id="4925848">(</span><span class="ident" id="4925849">n</span>&nbsp;<span class="op" id="4925851">*</span><span class="ident" id="4925852"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4925857">.</span><span class="ident" id="4925858"><a href="/gostd/text/template/parse/node.go.html#3165284">ActionNode</a></span><span class="op" id="4925868">,</span>&nbsp;<span class="ident" id="4925870">cmds</span>&nbsp;<span class="op" id="4925875">[</span><span class="op" id="4925876">]</span><span class="builtintype" id="4925877">string</span><span class="op" id="4925883">)</span>&nbsp;<span class="op" id="4925885">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925888">if</span>&nbsp;<span class="ident" id="4925891">_</span><span class="op" id="4925892">,</span>&nbsp;<span class="ident" id="4925894">ok</span>&nbsp;<span class="op" id="4925897">:=</span>&nbsp;<span class="ident" id="4925900"><a href="/gostd/html/template/escape.go.html#4925822">e</a></span><span class="op" id="4925901">.</span><span class="ident" id="4925902"><a href="/gostd/html/template/escape.go.html#4906770">actionNodeEdits</a></span><span class="op" id="4925917">[</span><span class="ident" id="4925918"><a href="/gostd/html/template/escape.go.html#4925849">n</a></span><span class="op" id="4925919">]</span><span class="op" id="4925920">;</span>&nbsp;<span class="ident" id="4925922"><a href="/gostd/html/template/escape.go.html#4925894">ok</a></span>&nbsp;<span class="op" id="4925925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4925929">panic</span><span class="op" id="4925934">(</span><span class="ident" id="4925935"><a href="/gostd/html/template/escape.go.html#4903861">fmt</a></span><span class="op" id="4925938">.</span><span class="ident" id="4925939"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="4925946">(</span><span class="string" id="4925947">&#34;node&nbsp;%s&nbsp;shared&nbsp;between&nbsp;templates&#34;</span><span class="op" id="4925981">,</span>&nbsp;<span class="ident" id="4925983"><a href="/gostd/html/template/escape.go.html#4925849">n</a></span><span class="op" id="4925984">)</span><span class="op" id="4925985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4925988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4925991"><a href="/gostd/html/template/escape.go.html#4925822">e</a></span><span class="op" id="4925992">.</span><span class="ident" id="4925993"><a href="/gostd/html/template/escape.go.html#4906770">actionNodeEdits</a></span><span class="op" id="4926008">[</span><span class="ident" id="4926009"><a href="/gostd/html/template/escape.go.html#4925849">n</a></span><span class="op" id="4926010">]</span>&nbsp;<span class="op" id="4926012">=</span>&nbsp;<span class="ident" id="4926014"><a href="/gostd/html/template/escape.go.html#4925870">cmds</a></span><br>
<span class="lineno"></span><span class="op" id="4926019">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="comment" id="4926022">//&nbsp;editTemplateNode&nbsp;records&nbsp;a&nbsp;change&nbsp;to&nbsp;a&nbsp;{{template}}&nbsp;callee&nbsp;for&nbsp;later&nbsp;commit.</span><br>
<span class="lineno"></span><span class="keyword" id="4926102">func</span>&nbsp;<span class="op" id="4926107">(</span><span class="ident" id="4926108">e</span>&nbsp;<span class="op" id="4926110">*</span><span class="ident" id="4926111"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4926118">)</span>&nbsp;<span class="ident" id="4926120">editTemplateNode</span><span class="op" id="4926136">(</span><span class="ident" id="4926137">n</span>&nbsp;<span class="op" id="4926139">*</span><span class="ident" id="4926140"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4926145">.</span><span class="ident" id="4926146"><a href="/gostd/text/template/parse/node.go.html#3179791">TemplateNode</a></span><span class="op" id="4926158">,</span>&nbsp;<span class="ident" id="4926160">callee</span>&nbsp;<span class="builtintype" id="4926167">string</span><span class="op" id="4926173">)</span>&nbsp;<span class="op" id="4926175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4926178">if</span>&nbsp;<span class="ident" id="4926181">_</span><span class="op" id="4926182">,</span>&nbsp;<span class="ident" id="4926184">ok</span>&nbsp;<span class="op" id="4926187">:=</span>&nbsp;<span class="ident" id="4926190"><a href="/gostd/html/template/escape.go.html#4926108">e</a></span><span class="op" id="4926191">.</span><span class="ident" id="4926192"><a href="/gostd/html/template/escape.go.html#4906820">templateNodeEdits</a></span><span class="op" id="4926209">[</span><span class="ident" id="4926210"><a href="/gostd/html/template/escape.go.html#4926137">n</a></span><span class="op" id="4926211">]</span><span class="op" id="4926212">;</span>&nbsp;<span class="ident" id="4926214"><a href="/gostd/html/template/escape.go.html#4926184">ok</a></span>&nbsp;<span class="op" id="4926217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4926221">panic</span><span class="op" id="4926226">(</span><span class="ident" id="4926227"><a href="/gostd/html/template/escape.go.html#4903861">fmt</a></span><span class="op" id="4926230">.</span><span class="ident" id="4926231"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="4926238">(</span><span class="string" id="4926239">&#34;node&nbsp;%s&nbsp;shared&nbsp;between&nbsp;templates&#34;</span><span class="op" id="4926273">,</span>&nbsp;<span class="ident" id="4926275"><a href="/gostd/html/template/escape.go.html#4926137">n</a></span><span class="op" id="4926276">)</span><span class="op" id="4926277">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4926280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4926283"><a href="/gostd/html/template/escape.go.html#4926108">e</a></span><span class="op" id="4926284">.</span><span class="ident" id="4926285"><a href="/gostd/html/template/escape.go.html#4906820">templateNodeEdits</a></span><span class="op" id="4926302">[</span><span class="ident" id="4926303"><a href="/gostd/html/template/escape.go.html#4926137">n</a></span><span class="op" id="4926304">]</span>&nbsp;<span class="op" id="4926306">=</span>&nbsp;<span class="ident" id="4926308"><a href="/gostd/html/template/escape.go.html#4926160">callee</a></span><br>
<span class="lineno"></span><span class="op" id="4926315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4926318">//&nbsp;editTextNode&nbsp;records&nbsp;a&nbsp;change&nbsp;to&nbsp;a&nbsp;text&nbsp;node&nbsp;for&nbsp;later&nbsp;commit.</span><br>
<span class="lineno">730</span><span class="keyword" id="4926384">func</span>&nbsp;<span class="op" id="4926389">(</span><span class="ident" id="4926390">e</span>&nbsp;<span class="op" id="4926392">*</span><span class="ident" id="4926393"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4926400">)</span>&nbsp;<span class="ident" id="4926402">editTextNode</span><span class="op" id="4926414">(</span><span class="ident" id="4926415">n</span>&nbsp;<span class="op" id="4926417">*</span><span class="ident" id="4926418"><a href="/gostd/html/template/escape.go.html#4903899">parse</a></span><span class="op" id="4926423">.</span><span class="ident" id="4926424"><a href="/gostd/text/template/parse/node.go.html#3163353">TextNode</a></span><span class="op" id="4926432">,</span>&nbsp;<span class="ident" id="4926434">text</span>&nbsp;<span class="op" id="4926439">[</span><span class="op" id="4926440">]</span><span class="builtintype" id="4926441">byte</span><span class="op" id="4926445">)</span>&nbsp;<span class="op" id="4926447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4926450">if</span>&nbsp;<span class="ident" id="4926453">_</span><span class="op" id="4926454">,</span>&nbsp;<span class="ident" id="4926456">ok</span>&nbsp;<span class="op" id="4926459">:=</span>&nbsp;<span class="ident" id="4926462"><a href="/gostd/html/template/escape.go.html#4926390">e</a></span><span class="op" id="4926463">.</span><span class="ident" id="4926464"><a href="/gostd/html/template/escape.go.html#4906870">textNodeEdits</a></span><span class="op" id="4926477">[</span><span class="ident" id="4926478"><a href="/gostd/html/template/escape.go.html#4926415">n</a></span><span class="op" id="4926479">]</span><span class="op" id="4926480">;</span>&nbsp;<span class="ident" id="4926482"><a href="/gostd/html/template/escape.go.html#4926456">ok</a></span>&nbsp;<span class="op" id="4926485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4926489">panic</span><span class="op" id="4926494">(</span><span class="ident" id="4926495"><a href="/gostd/html/template/escape.go.html#4903861">fmt</a></span><span class="op" id="4926498">.</span><span class="ident" id="4926499"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="4926506">(</span><span class="string" id="4926507">&#34;node&nbsp;%s&nbsp;shared&nbsp;between&nbsp;templates&#34;</span><span class="op" id="4926541">,</span>&nbsp;<span class="ident" id="4926543"><a href="/gostd/html/template/escape.go.html#4926415">n</a></span><span class="op" id="4926544">)</span><span class="op" id="4926545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4926548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4926551"><a href="/gostd/html/template/escape.go.html#4926390">e</a></span><span class="op" id="4926552">.</span><span class="ident" id="4926553"><a href="/gostd/html/template/escape.go.html#4906870">textNodeEdits</a></span><span class="op" id="4926566">[</span><span class="ident" id="4926567"><a href="/gostd/html/template/escape.go.html#4926415">n</a></span><span class="op" id="4926568">]</span>&nbsp;<span class="op" id="4926570">=</span>&nbsp;<span class="ident" id="4926572"><a href="/gostd/html/template/escape.go.html#4926434">text</a></span><br>
<span class="lineno">735</span><span class="op" id="4926577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4926580">//&nbsp;commit&nbsp;applies&nbsp;changes&nbsp;to&nbsp;actions&nbsp;and&nbsp;template&nbsp;calls&nbsp;needed&nbsp;to&nbsp;contextually</span><br>
<span class="lineno"></span><span class="comment" id="4926659">//&nbsp;autoescape&nbsp;content&nbsp;and&nbsp;adds&nbsp;any&nbsp;derived&nbsp;templates&nbsp;to&nbsp;the&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="4926724">func</span>&nbsp;<span class="op" id="4926729">(</span><span class="ident" id="4926730">e</span>&nbsp;<span class="op" id="4926732">*</span><span class="ident" id="4926733"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4926740">)</span>&nbsp;<span class="ident" id="4926742">commit</span><span class="op" id="4926748">(</span><span class="op" id="4926749">)</span>&nbsp;<span class="op" id="4926751">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4926754">for</span>&nbsp;<span class="ident" id="4926758">name</span>&nbsp;<span class="op" id="4926763">:=</span>&nbsp;<span class="keyword" id="4926766">range</span>&nbsp;<span class="ident" id="4926772"><a href="/gostd/html/template/escape.go.html#4926730">e</a></span><span class="op" id="4926773">.</span><span class="ident" id="4926774"><a href="/gostd/html/template/escape.go.html#4906291">output</a></span>&nbsp;<span class="op" id="4926781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4926785"><a href="/gostd/html/template/escape.go.html#4926730">e</a></span><span class="op" id="4926786">.</span><span class="ident" id="4926787"><a href="/gostd/html/template/escape.go.html#4927257">template</a></span><span class="op" id="4926795">(</span><span class="ident" id="4926796"><a href="/gostd/html/template/escape.go.html#4926758">name</a></span><span class="op" id="4926800">)</span><span class="op" id="4926801">.</span><span class="ident" id="4926802"><a href="/gostd/text/template/template.go.html#3743134">Funcs</a></span><span class="op" id="4926807">(</span><span class="ident" id="4926808"><a href="/gostd/html/template/escape.go.html#4904937">funcMap</a></span><span class="op" id="4926815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4926818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4926821">for</span>&nbsp;<span class="ident" id="4926825">_</span><span class="op" id="4926826">,</span>&nbsp;<span class="ident" id="4926828">t</span>&nbsp;<span class="op" id="4926830">:=</span>&nbsp;<span class="keyword" id="4926833">range</span>&nbsp;<span class="ident" id="4926839"><a href="/gostd/html/template/escape.go.html#4926730">e</a></span><span class="op" id="4926840">.</span><span class="ident" id="4926841"><a href="/gostd/html/template/escape.go.html#4906444">derived</a></span>&nbsp;<span class="op" id="4926849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4926853">if</span>&nbsp;<span class="ident" id="4926856">_</span><span class="op" id="4926857">,</span>&nbsp;<span class="ident" id="4926859">err</span>&nbsp;<span class="op" id="4926863">:=</span>&nbsp;<span class="ident" id="4926866"><a href="/gostd/html/template/escape.go.html#4926730">e</a></span><span class="op" id="4926867">.</span><span class="ident" id="4926868"><a href="/gostd/html/template/escape.go.html#4906153">tmpl</a></span><span class="op" id="4926872">.</span><span class="ident" id="4926873"><a href="/gostd/html/template/template.go.html#4946855">text</a></span><span class="op" id="4926877">.</span><span class="ident" id="4926878"><a href="/gostd/text/template/template.go.html#3741818">AddParseTree</a></span><span class="op" id="4926890">(</span><span class="ident" id="4926891"><a href="/gostd/html/template/escape.go.html#4926828">t</a></span><span class="op" id="4926892">.</span><span class="ident" id="4926893"><a href="/gostd/text/template/template.go.html#3739983">Name</a></span><span class="op" id="4926897">(</span><span class="op" id="4926898">)</span><span class="op" id="4926899">,</span>&nbsp;<span class="ident" id="4926901"><a href="/gostd/html/template/escape.go.html#4926828">t</a></span><span class="op" id="4926902">.</span><span class="ident" id="4926903"><a href="/gostd/text/template/template.go.html#3739734">Tree</a></span><span class="op" id="4926907">)</span><span class="op" id="4926908">;</span>&nbsp;<span class="ident" id="4926910"><a href="/gostd/html/template/escape.go.html#4926859">err</a></span>&nbsp;<span class="op" id="4926914">!=</span>&nbsp;<span class="builtintype" id="4926917">nil</span>&nbsp;<span class="op" id="4926921">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4926926">panic</span><span class="op" id="4926931">(</span><span class="string" id="4926932">&#34;error&nbsp;adding&nbsp;derived&nbsp;template&#34;</span><span class="op" id="4926963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4926967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4926970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4926973">for</span>&nbsp;<span class="ident" id="4926977">n</span><span class="op" id="4926978">,</span>&nbsp;<span class="ident" id="4926980">s</span>&nbsp;<span class="op" id="4926982">:=</span>&nbsp;<span class="keyword" id="4926985">range</span>&nbsp;<span class="ident" id="4926991"><a href="/gostd/html/template/escape.go.html#4926730">e</a></span><span class="op" id="4926992">.</span><span class="ident" id="4926993"><a href="/gostd/html/template/escape.go.html#4906770">actionNodeEdits</a></span>&nbsp;<span class="op" id="4927009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927013"><a href="/gostd/html/template/escape.go.html#4910962">ensurePipelineContains</a></span><span class="op" id="4927035">(</span><span class="ident" id="4927036"><a href="/gostd/html/template/escape.go.html#4926977">n</a></span><span class="op" id="4927037">.</span><span class="ident" id="4927038"><a href="/gostd/text/template/parse/node.go.html#3165417">Pipe</a></span><span class="op" id="4927042">,</span>&nbsp;<span class="ident" id="4927044"><a href="/gostd/html/template/escape.go.html#4926980">s</a></span><span class="op" id="4927045">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4927048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4927051">for</span>&nbsp;<span class="ident" id="4927055">n</span><span class="op" id="4927056">,</span>&nbsp;<span class="ident" id="4927058">name</span>&nbsp;<span class="op" id="4927063">:=</span>&nbsp;<span class="keyword" id="4927066">range</span>&nbsp;<span class="ident" id="4927072"><a href="/gostd/html/template/escape.go.html#4926730">e</a></span><span class="op" id="4927073">.</span><span class="ident" id="4927074"><a href="/gostd/html/template/escape.go.html#4906820">templateNodeEdits</a></span>&nbsp;<span class="op" id="4927092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927096"><a href="/gostd/html/template/escape.go.html#4927055">n</a></span><span class="op" id="4927097">.</span><span class="ident" id="4927098"><a href="/gostd/text/template/parse/node.go.html#3179926">Name</a></span>&nbsp;<span class="op" id="4927103">=</span>&nbsp;<span class="ident" id="4927105"><a href="/gostd/html/template/escape.go.html#4927058">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4927111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4927114">for</span>&nbsp;<span class="ident" id="4927118">n</span><span class="op" id="4927119">,</span>&nbsp;<span class="ident" id="4927121">s</span>&nbsp;<span class="op" id="4927123">:=</span>&nbsp;<span class="keyword" id="4927126">range</span>&nbsp;<span class="ident" id="4927132"><a href="/gostd/html/template/escape.go.html#4926730">e</a></span><span class="op" id="4927133">.</span><span class="ident" id="4927134"><a href="/gostd/html/template/escape.go.html#4906870">textNodeEdits</a></span>&nbsp;<span class="op" id="4927148">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927152"><a href="/gostd/html/template/escape.go.html#4927118">n</a></span><span class="op" id="4927153">.</span><span class="ident" id="4927154"><a href="/gostd/text/template/parse/node.go.html#3163399">Text</a></span>&nbsp;<span class="op" id="4927159">=</span>&nbsp;<span class="ident" id="4927161"><a href="/gostd/html/template/escape.go.html#4927121">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4927164">}</span><br>
<span class="lineno"></span><span class="op" id="4927166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4927169">//&nbsp;template&nbsp;returns&nbsp;the&nbsp;named&nbsp;template&nbsp;given&nbsp;a&nbsp;mangled&nbsp;template&nbsp;name.</span><br>
<span class="lineno">760</span><span class="keyword" id="4927239">func</span>&nbsp;<span class="op" id="4927244">(</span><span class="ident" id="4927245">e</span>&nbsp;<span class="op" id="4927247">*</span><span class="ident" id="4927248"><a href="/gostd/html/template/escape.go.html#4906135">escaper</a></span><span class="op" id="4927255">)</span>&nbsp;<span class="ident" id="4927257">template</span><span class="op" id="4927265">(</span><span class="ident" id="4927266">name</span>&nbsp;<span class="builtintype" id="4927271">string</span><span class="op" id="4927277">)</span>&nbsp;<span class="op" id="4927279">*</span><span class="ident" id="4927280"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4927288">.</span><span class="ident" id="4927289"><a href="/gostd/text/template/template.go.html#3739702">Template</a></span>&nbsp;<span class="op" id="4927298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927301">t</span>&nbsp;<span class="op" id="4927303">:=</span>&nbsp;<span class="ident" id="4927306"><a href="/gostd/html/template/escape.go.html#4927245">e</a></span><span class="op" id="4927307">.</span><span class="ident" id="4927308"><a href="/gostd/html/template/escape.go.html#4906153">tmpl</a></span><span class="op" id="4927312">.</span><span class="ident" id="4927313"><a href="/gostd/html/template/template.go.html#4946855">text</a></span><span class="op" id="4927317">.</span><span class="ident" id="4927318"><a href="/gostd/text/template/template.go.html#3743399">Lookup</a></span><span class="op" id="4927324">(</span><span class="ident" id="4927325"><a href="/gostd/html/template/escape.go.html#4927266">name</a></span><span class="op" id="4927329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4927332">if</span>&nbsp;<span class="ident" id="4927335"><a href="/gostd/html/template/escape.go.html#4927301">t</a></span>&nbsp;<span class="op" id="4927337">==</span>&nbsp;<span class="builtintype" id="4927340">nil</span>&nbsp;<span class="op" id="4927344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927348"><a href="/gostd/html/template/escape.go.html#4927301">t</a></span>&nbsp;<span class="op" id="4927350">=</span>&nbsp;<span class="ident" id="4927352"><a href="/gostd/html/template/escape.go.html#4927245">e</a></span><span class="op" id="4927353">.</span><span class="ident" id="4927354"><a href="/gostd/html/template/escape.go.html#4906444">derived</a></span><span class="op" id="4927361">[</span><span class="ident" id="4927362"><a href="/gostd/html/template/escape.go.html#4927266">name</a></span><span class="op" id="4927366">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4927369">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4927372">return</span>&nbsp;<span class="ident" id="4927379"><a href="/gostd/html/template/escape.go.html#4927301">t</a></span><br>
<span class="lineno"></span><span class="op" id="4927381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4927384">//&nbsp;Forwarding&nbsp;functions&nbsp;so&nbsp;that&nbsp;clients&nbsp;need&nbsp;only&nbsp;import&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4927454">//&nbsp;to&nbsp;reach&nbsp;the&nbsp;general&nbsp;escaping&nbsp;functions&nbsp;of&nbsp;text/template.</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span><span class="comment" id="4927516">//&nbsp;HTMLEscape&nbsp;writes&nbsp;to&nbsp;w&nbsp;the&nbsp;escaped&nbsp;HTML&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;plain&nbsp;text&nbsp;data&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4927596">func</span>&nbsp;<span class="ident" id="4927601">HTMLEscape</span><span class="op" id="4927611">(</span><span class="ident" id="4927612">w</span>&nbsp;<span class="ident" id="4927614"><a href="/gostd/html/template/escape.go.html#4903876">io</a></span><span class="op" id="4927616">.</span><span class="ident" id="4927617"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="4927623">,</span>&nbsp;<span class="ident" id="4927625">b</span>&nbsp;<span class="op" id="4927627">[</span><span class="op" id="4927628">]</span><span class="builtintype" id="4927629">byte</span><span class="op" id="4927633">)</span>&nbsp;<span class="op" id="4927635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927638"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4927646">.</span><span class="ident" id="4927647"><a href="/gostd/text/template/funcs.go.html#3731757">HTMLEscape</a></span><span class="op" id="4927657">(</span><span class="ident" id="4927658"><a href="/gostd/html/template/escape.go.html#4927612">w</a></span><span class="op" id="4927659">,</span>&nbsp;<span class="ident" id="4927661"><a href="/gostd/html/template/escape.go.html#4927625">b</a></span><span class="op" id="4927662">)</span><br>
<span class="lineno"></span><span class="op" id="4927664">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="4927667">//&nbsp;HTMLEscapeString&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;HTML&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;plain&nbsp;text&nbsp;data&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="4927749">func</span>&nbsp;<span class="ident" id="4927754">HTMLEscapeString</span><span class="op" id="4927770">(</span><span class="ident" id="4927771">s</span>&nbsp;<span class="builtintype" id="4927773">string</span><span class="op" id="4927779">)</span>&nbsp;<span class="builtintype" id="4927781">string</span>&nbsp;<span class="op" id="4927788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4927791">return</span>&nbsp;<span class="ident" id="4927798"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4927806">.</span><span class="ident" id="4927807"><a href="/gostd/text/template/funcs.go.html#3732200">HTMLEscapeString</a></span><span class="op" id="4927823">(</span><span class="ident" id="4927824"><a href="/gostd/html/template/escape.go.html#4927771">s</a></span><span class="op" id="4927825">)</span><br>
<span class="lineno"></span><span class="op" id="4927827">}</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span><span class="comment" id="4927830">//&nbsp;HTMLEscaper&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;HTML&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;textual</span><br>
<span class="lineno"></span><span class="comment" id="4927896">//&nbsp;representation&nbsp;of&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="keyword" id="4927932">func</span>&nbsp;<span class="ident" id="4927937">HTMLEscaper</span><span class="op" id="4927948">(</span><span class="ident" id="4927949">args</span>&nbsp;<span class="op" id="4927954">...</span><span class="keyword" id="4927957">interface</span><span class="op" id="4927966">{</span><span class="op" id="4927967">}</span><span class="op" id="4927968">)</span>&nbsp;<span class="builtintype" id="4927970">string</span>&nbsp;<span class="op" id="4927977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4927980">return</span>&nbsp;<span class="ident" id="4927987"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4927995">.</span><span class="ident" id="4927996"><a href="/gostd/text/template/funcs.go.html#3732497">HTMLEscaper</a></span><span class="op" id="4928007">(</span><span class="ident" id="4928008"><a href="/gostd/html/template/escape.go.html#4927949">args</a></span><span class="op" id="4928012">...</span><span class="op" id="4928015">)</span><br>
<span class="lineno">785</span><span class="op" id="4928017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4928020">//&nbsp;JSEscape&nbsp;writes&nbsp;to&nbsp;w&nbsp;the&nbsp;escaped&nbsp;JavaScript&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;plain&nbsp;text&nbsp;data&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4928104">func</span>&nbsp;<span class="ident" id="4928109">JSEscape</span><span class="op" id="4928117">(</span><span class="ident" id="4928118">w</span>&nbsp;<span class="ident" id="4928120"><a href="/gostd/html/template/escape.go.html#4903876">io</a></span><span class="op" id="4928122">.</span><span class="ident" id="4928123"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="4928129">,</span>&nbsp;<span class="ident" id="4928131">b</span>&nbsp;<span class="op" id="4928133">[</span><span class="op" id="4928134">]</span><span class="builtintype" id="4928135">byte</span><span class="op" id="4928139">)</span>&nbsp;<span class="op" id="4928141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4928144"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4928152">.</span><span class="ident" id="4928153"><a href="/gostd/text/template/funcs.go.html#3732917">JSEscape</a></span><span class="op" id="4928161">(</span><span class="ident" id="4928162"><a href="/gostd/html/template/escape.go.html#4928118">w</a></span><span class="op" id="4928163">,</span>&nbsp;<span class="ident" id="4928165"><a href="/gostd/html/template/escape.go.html#4928131">b</a></span><span class="op" id="4928166">)</span><br>
<span class="lineno">790</span><span class="op" id="4928168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4928171">//&nbsp;JSEscapeString&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;JavaScript&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;plain&nbsp;text&nbsp;data&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="4928257">func</span>&nbsp;<span class="ident" id="4928262">JSEscapeString</span><span class="op" id="4928276">(</span><span class="ident" id="4928277">s</span>&nbsp;<span class="builtintype" id="4928279">string</span><span class="op" id="4928285">)</span>&nbsp;<span class="builtintype" id="4928287">string</span>&nbsp;<span class="op" id="4928294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4928297">return</span>&nbsp;<span class="ident" id="4928304"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4928312">.</span><span class="ident" id="4928313"><a href="/gostd/text/template/funcs.go.html#3733852">JSEscapeString</a></span><span class="op" id="4928327">(</span><span class="ident" id="4928328"><a href="/gostd/html/template/escape.go.html#4928277">s</a></span><span class="op" id="4928329">)</span><br>
<span class="lineno">795</span><span class="op" id="4928331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4928334">//&nbsp;JSEscaper&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;JavaScript&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;textual</span><br>
<span class="lineno"></span><span class="comment" id="4928404">//&nbsp;representation&nbsp;of&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="keyword" id="4928440">func</span>&nbsp;<span class="ident" id="4928445">JSEscaper</span><span class="op" id="4928454">(</span><span class="ident" id="4928455">args</span>&nbsp;<span class="op" id="4928460">...</span><span class="keyword" id="4928463">interface</span><span class="op" id="4928472">{</span><span class="op" id="4928473">}</span><span class="op" id="4928474">)</span>&nbsp;<span class="builtintype" id="4928476">string</span>&nbsp;<span class="op" id="4928483">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4928486">return</span>&nbsp;<span class="ident" id="4928493"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4928501">.</span><span class="ident" id="4928502"><a href="/gostd/text/template/funcs.go.html#3734289">JSEscaper</a></span><span class="op" id="4928511">(</span><span class="ident" id="4928512"><a href="/gostd/html/template/escape.go.html#4928455">args</a></span><span class="op" id="4928516">...</span><span class="op" id="4928519">)</span><br>
<span class="lineno"></span><span class="op" id="4928521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4928524">//&nbsp;URLQueryEscaper&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;value&nbsp;of&nbsp;the&nbsp;textual&nbsp;representation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4928602">//&nbsp;its&nbsp;arguments&nbsp;in&nbsp;a&nbsp;form&nbsp;suitable&nbsp;for&nbsp;embedding&nbsp;in&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno">805</span><span class="keyword" id="4928668">func</span>&nbsp;<span class="ident" id="4928673">URLQueryEscaper</span><span class="op" id="4928688">(</span><span class="ident" id="4928689">args</span>&nbsp;<span class="op" id="4928694">...</span><span class="keyword" id="4928697">interface</span><span class="op" id="4928706">{</span><span class="op" id="4928707">}</span><span class="op" id="4928708">)</span>&nbsp;<span class="builtintype" id="4928710">string</span>&nbsp;<span class="op" id="4928717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4928720">return</span>&nbsp;<span class="ident" id="4928727"><a href="/gostd/html/template/escape.go.html#4903882">template</a></span><span class="op" id="4928735">.</span><span class="ident" id="4928736"><a href="/gostd/text/template/funcs.go.html#3734520">URLQueryEscaper</a></span><span class="op" id="4928751">(</span><span class="ident" id="4928752"><a href="/gostd/html/template/escape.go.html#4928689">args</a></span><span class="op" id="4928756">...</span><span class="op" id="4928759">)</span><br>
<span class="lineno"></span><span class="op" id="4928761">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
