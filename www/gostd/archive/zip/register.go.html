<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html" class="current">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6094959">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6095014">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6095068">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6095119">package</span>&nbsp;<span class="ident" id="6095127">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6095132">import</span>&nbsp;<span class="op" id="6095139">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6095142">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6095160">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6095170">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6095176">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6095189">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6095196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6095199">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6095260">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="6095326">type</span>&nbsp;<span class="ident" id="6095331">Compressor</span>&nbsp;<span class="keyword" id="6095342">func</span><span class="op" id="6095346">(</span><span class="ident" id="6095347">io</span><span class="op" id="6095349">.</span><span class="ident" id="6095350">Writer</span><span class="op" id="6095356">)</span>&nbsp;<span class="op" id="6095358">(</span><span class="ident" id="6095359">io</span><span class="op" id="6095361">.</span><span class="ident" id="6095362">WriteCloser</span><span class="op" id="6095373">,</span>&nbsp;<span class="builtintype" id="6095375">error</span><span class="op" id="6095380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6095383">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="6095462">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6095536">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="6095614">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="6095648">type</span>&nbsp;<span class="ident" id="6095653">Decompressor</span>&nbsp;<span class="keyword" id="6095666">func</span><span class="op" id="6095670">(</span><span class="ident" id="6095671">io</span><span class="op" id="6095673">.</span><span class="ident" id="6095674">Reader</span><span class="op" id="6095680">)</span>&nbsp;<span class="ident" id="6095682">io</span><span class="op" id="6095684">.</span><span class="ident" id="6095685">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6095697">var</span>&nbsp;<span class="ident" id="6095701">flateWriterPool</span>&nbsp;<span class="ident" id="6095717">sync</span><span class="op" id="6095721">.</span><span class="ident" id="6095722">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6095728">func</span>&nbsp;<span class="ident" id="6095733">newFlateWriter</span><span class="op" id="6095747">(</span><span class="ident" id="6095748">w</span>&nbsp;<span class="ident" id="6095750">io</span><span class="op" id="6095752">.</span><span class="ident" id="6095753">Writer</span><span class="op" id="6095759">)</span>&nbsp;<span class="ident" id="6095761">io</span><span class="op" id="6095763">.</span><span class="ident" id="6095764">WriteCloser</span>&nbsp;<span class="op" id="6095776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6095779">fw</span><span class="op" id="6095781">,</span>&nbsp;<span class="ident" id="6095783">ok</span>&nbsp;<span class="op" id="6095786">:=</span>&nbsp;<span class="ident" id="6095789">flateWriterPool</span><span class="op" id="6095804">.</span><span class="ident" id="6095805">Get</span><span class="op" id="6095808">(</span><span class="op" id="6095809">)</span><span class="op" id="6095810">.</span><span class="op" id="6095811">(</span><span class="op" id="6095812">*</span><span class="ident" id="6095813">flate</span><span class="op" id="6095818">.</span><span class="ident" id="6095819">Writer</span><span class="op" id="6095825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6095828">if</span>&nbsp;<span class="ident" id="6095831">ok</span>&nbsp;<span class="op" id="6095834">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6095838">fw</span><span class="op" id="6095840">.</span><span class="ident" id="6095841">Reset</span><span class="op" id="6095846">(</span><span class="ident" id="6095847">w</span><span class="op" id="6095848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6095851">}</span>&nbsp;<span class="keyword" id="6095853">else</span>&nbsp;<span class="op" id="6095858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6095862">fw</span><span class="op" id="6095864">,</span>&nbsp;<span class="ident" id="6095866">_</span>&nbsp;<span class="op" id="6095868">=</span>&nbsp;<span class="ident" id="6095870">flate</span><span class="op" id="6095875">.</span><span class="ident" id="6095876">NewWriter</span><span class="op" id="6095885">(</span><span class="ident" id="6095886">w</span><span class="op" id="6095887">,</span>&nbsp;<span class="num" id="6095889">5</span><span class="op" id="6095890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6095893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6095896">return</span>&nbsp;<span class="op" id="6095903">&amp;</span><span class="ident" id="6095904">pooledFlateWriter</span><span class="op" id="6095921">{</span><span class="ident" id="6095922">fw</span><span class="op" id="6095924">:</span>&nbsp;<span class="ident" id="6095926">fw</span><span class="op" id="6095928">}</span><br>
<span class="lineno">35</span><span class="op" id="6095930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6095933">type</span>&nbsp;<span class="ident" id="6095938">pooledFlateWriter</span>&nbsp;<span class="keyword" id="6095956">struct</span>&nbsp;<span class="op" id="6095963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6095966">mu</span>&nbsp;<span class="ident" id="6095969">sync</span><span class="op" id="6095973">.</span><span class="ident" id="6095974">Mutex</span>&nbsp;<span class="comment" id="6095980">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096007">fw</span>&nbsp;<span class="op" id="6096010">*</span><span class="ident" id="6096011">flate</span><span class="op" id="6096016">.</span><span class="ident" id="6096017">Writer</span><br>
<span class="lineno">40</span><span class="op" id="6096024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6096027">func</span>&nbsp;<span class="op" id="6096032">(</span><span class="ident" id="6096033">w</span>&nbsp;<span class="op" id="6096035">*</span><span class="ident" id="6096036">pooledFlateWriter</span><span class="op" id="6096053">)</span>&nbsp;<span class="ident" id="6096055">Write</span><span class="op" id="6096060">(</span><span class="ident" id="6096061">p</span>&nbsp;<span class="op" id="6096063">[</span><span class="op" id="6096064">]</span><span class="builtintype" id="6096065">byte</span><span class="op" id="6096069">)</span>&nbsp;<span class="op" id="6096071">(</span><span class="ident" id="6096072">n</span>&nbsp;<span class="builtintype" id="6096074">int</span><span class="op" id="6096077">,</span>&nbsp;<span class="ident" id="6096079">err</span>&nbsp;<span class="builtintype" id="6096083">error</span><span class="op" id="6096088">)</span>&nbsp;<span class="op" id="6096090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096093">w</span><span class="op" id="6096094">.</span><span class="ident" id="6096095">mu</span><span class="op" id="6096097">.</span><span class="ident" id="6096098">Lock</span><span class="op" id="6096102">(</span><span class="op" id="6096103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6096106">defer</span>&nbsp;<span class="ident" id="6096112">w</span><span class="op" id="6096113">.</span><span class="ident" id="6096114">mu</span><span class="op" id="6096116">.</span><span class="ident" id="6096117">Unlock</span><span class="op" id="6096123">(</span><span class="op" id="6096124">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6096127">if</span>&nbsp;<span class="ident" id="6096130">w</span><span class="op" id="6096131">.</span><span class="ident" id="6096132">fw</span>&nbsp;<span class="op" id="6096135">==</span>&nbsp;<span class="ident" id="6096138">nil</span>&nbsp;<span class="op" id="6096142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6096146">return</span>&nbsp;<span class="num" id="6096153">0</span><span class="op" id="6096154">,</span>&nbsp;<span class="ident" id="6096156">errors</span><span class="op" id="6096162">.</span><span class="ident" id="6096163">New</span><span class="op" id="6096166">(</span><span class="string" id="6096167">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="6096186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6096189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6096192">return</span>&nbsp;<span class="ident" id="6096199">w</span><span class="op" id="6096200">.</span><span class="ident" id="6096201">fw</span><span class="op" id="6096203">.</span><span class="ident" id="6096204">Write</span><span class="op" id="6096209">(</span><span class="ident" id="6096210">p</span><span class="op" id="6096211">)</span><br>
<span class="lineno"></span><span class="op" id="6096213">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6096216">func</span>&nbsp;<span class="op" id="6096221">(</span><span class="ident" id="6096222">w</span>&nbsp;<span class="op" id="6096224">*</span><span class="ident" id="6096225">pooledFlateWriter</span><span class="op" id="6096242">)</span>&nbsp;<span class="ident" id="6096244">Close</span><span class="op" id="6096249">(</span><span class="op" id="6096250">)</span>&nbsp;<span class="builtintype" id="6096252">error</span>&nbsp;<span class="op" id="6096258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096261">w</span><span class="op" id="6096262">.</span><span class="ident" id="6096263">mu</span><span class="op" id="6096265">.</span><span class="ident" id="6096266">Lock</span><span class="op" id="6096270">(</span><span class="op" id="6096271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6096274">defer</span>&nbsp;<span class="ident" id="6096280">w</span><span class="op" id="6096281">.</span><span class="ident" id="6096282">mu</span><span class="op" id="6096284">.</span><span class="ident" id="6096285">Unlock</span><span class="op" id="6096291">(</span><span class="op" id="6096292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6096295">var</span>&nbsp;<span class="ident" id="6096299">err</span>&nbsp;<span class="builtintype" id="6096303">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6096310">if</span>&nbsp;<span class="ident" id="6096313">w</span><span class="op" id="6096314">.</span><span class="ident" id="6096315">fw</span>&nbsp;<span class="op" id="6096318">!=</span>&nbsp;<span class="ident" id="6096321">nil</span>&nbsp;<span class="op" id="6096325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096329">err</span>&nbsp;<span class="op" id="6096333">=</span>&nbsp;<span class="ident" id="6096335">w</span><span class="op" id="6096336">.</span><span class="ident" id="6096337">fw</span><span class="op" id="6096339">.</span><span class="ident" id="6096340">Close</span><span class="op" id="6096345">(</span><span class="op" id="6096346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096350">flateWriterPool</span><span class="op" id="6096365">.</span><span class="ident" id="6096366">Put</span><span class="op" id="6096369">(</span><span class="ident" id="6096370">w</span><span class="op" id="6096371">.</span><span class="ident" id="6096372">fw</span><span class="op" id="6096374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096378">w</span><span class="op" id="6096379">.</span><span class="ident" id="6096380">fw</span>&nbsp;<span class="op" id="6096383">=</span>&nbsp;<span class="ident" id="6096385">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6096390">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6096393">return</span>&nbsp;<span class="ident" id="6096400">err</span><br>
<span class="lineno"></span><span class="op" id="6096404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6096407">var</span>&nbsp;<span class="op" id="6096411">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096414">mu</span>&nbsp;<span class="ident" id="6096417">sync</span><span class="op" id="6096421">.</span><span class="ident" id="6096422">RWMutex</span>&nbsp;<span class="comment" id="6096430">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096475">compressors</span>&nbsp;<span class="op" id="6096487">=</span>&nbsp;<span class="keyword" id="6096489">map</span><span class="op" id="6096492">[</span><span class="builtintype" id="6096493">uint16</span><span class="op" id="6096499">]</span><span class="ident" id="6096500">Compressor</span><span class="op" id="6096510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096514">Store</span><span class="op" id="6096519">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6096523">func</span><span class="op" id="6096527">(</span><span class="ident" id="6096528">w</span>&nbsp;<span class="ident" id="6096530">io</span><span class="op" id="6096532">.</span><span class="ident" id="6096533">Writer</span><span class="op" id="6096539">)</span>&nbsp;<span class="op" id="6096541">(</span><span class="ident" id="6096542">io</span><span class="op" id="6096544">.</span><span class="ident" id="6096545">WriteCloser</span><span class="op" id="6096556">,</span>&nbsp;<span class="builtintype" id="6096558">error</span><span class="op" id="6096563">)</span>&nbsp;<span class="op" id="6096565">{</span>&nbsp;<span class="keyword" id="6096567">return</span>&nbsp;<span class="op" id="6096574">&amp;</span><span class="ident" id="6096575">nopCloser</span><span class="op" id="6096584">{</span><span class="ident" id="6096585">w</span><span class="op" id="6096586">}</span><span class="op" id="6096587">,</span>&nbsp;<span class="ident" id="6096589">nil</span>&nbsp;<span class="op" id="6096593">}</span><span class="op" id="6096594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096598">Deflate</span><span class="op" id="6096605">:</span>&nbsp;<span class="keyword" id="6096607">func</span><span class="op" id="6096611">(</span><span class="ident" id="6096612">w</span>&nbsp;<span class="ident" id="6096614">io</span><span class="op" id="6096616">.</span><span class="ident" id="6096617">Writer</span><span class="op" id="6096623">)</span>&nbsp;<span class="op" id="6096625">(</span><span class="ident" id="6096626">io</span><span class="op" id="6096628">.</span><span class="ident" id="6096629">WriteCloser</span><span class="op" id="6096640">,</span>&nbsp;<span class="builtintype" id="6096642">error</span><span class="op" id="6096647">)</span>&nbsp;<span class="op" id="6096649">{</span>&nbsp;<span class="keyword" id="6096651">return</span>&nbsp;<span class="ident" id="6096658">newFlateWriter</span><span class="op" id="6096672">(</span><span class="ident" id="6096673">w</span><span class="op" id="6096674">)</span><span class="op" id="6096675">,</span>&nbsp;<span class="ident" id="6096677">nil</span>&nbsp;<span class="op" id="6096681">}</span><span class="op" id="6096682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6096685">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096689">decompressors</span>&nbsp;<span class="op" id="6096703">=</span>&nbsp;<span class="keyword" id="6096705">map</span><span class="op" id="6096708">[</span><span class="builtintype" id="6096709">uint16</span><span class="op" id="6096715">]</span><span class="ident" id="6096716">Decompressor</span><span class="op" id="6096728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096732">Store</span><span class="op" id="6096737">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6096741">ioutil</span><span class="op" id="6096747">.</span><span class="ident" id="6096748">NopCloser</span><span class="op" id="6096757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096761">Deflate</span><span class="op" id="6096768">:</span>&nbsp;<span class="ident" id="6096770">flate</span><span class="op" id="6096775">.</span><span class="ident" id="6096776">NewReader</span><span class="op" id="6096785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6096788">}</span><br>
<span class="lineno">75</span><span class="op" id="6096790">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6096793">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="6096872">func</span>&nbsp;<span class="ident" id="6096877">RegisterDecompressor</span><span class="op" id="6096897">(</span><span class="ident" id="6096898">method</span>&nbsp;<span class="builtintype" id="6096905">uint16</span><span class="op" id="6096911">,</span>&nbsp;<span class="ident" id="6096913">d</span>&nbsp;<span class="ident" id="6096915">Decompressor</span><span class="op" id="6096927">)</span>&nbsp;<span class="op" id="6096929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6096932">mu</span><span class="op" id="6096934">.</span><span class="ident" id="6096935">Lock</span><span class="op" id="6096939">(</span><span class="op" id="6096940">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6096943">defer</span>&nbsp;<span class="ident" id="6096949">mu</span><span class="op" id="6096951">.</span><span class="ident" id="6096952">Unlock</span><span class="op" id="6096958">(</span><span class="op" id="6096959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6096963">if</span>&nbsp;<span class="ident" id="6096966">_</span><span class="op" id="6096967">,</span>&nbsp;<span class="ident" id="6096969">ok</span>&nbsp;<span class="op" id="6096972">:=</span>&nbsp;<span class="ident" id="6096975">decompressors</span><span class="op" id="6096988">[</span><span class="ident" id="6096989">method</span><span class="op" id="6096995">]</span><span class="op" id="6096996">;</span>&nbsp;<span class="ident" id="6096998">ok</span>&nbsp;<span class="op" id="6097001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6097005">panic</span><span class="op" id="6097010">(</span><span class="string" id="6097011">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="6097044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6097047">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6097050">decompressors</span><span class="op" id="6097063">[</span><span class="ident" id="6097064">method</span><span class="op" id="6097070">]</span>&nbsp;<span class="op" id="6097072">=</span>&nbsp;<span class="ident" id="6097074">d</span><br>
<span class="lineno"></span><span class="op" id="6097076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6097079">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="6097157">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="6097211">func</span>&nbsp;<span class="ident" id="6097216">RegisterCompressor</span><span class="op" id="6097234">(</span><span class="ident" id="6097235">method</span>&nbsp;<span class="builtintype" id="6097242">uint16</span><span class="op" id="6097248">,</span>&nbsp;<span class="ident" id="6097250">comp</span>&nbsp;<span class="ident" id="6097255">Compressor</span><span class="op" id="6097265">)</span>&nbsp;<span class="op" id="6097267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6097270">mu</span><span class="op" id="6097272">.</span><span class="ident" id="6097273">Lock</span><span class="op" id="6097277">(</span><span class="op" id="6097278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6097281">defer</span>&nbsp;<span class="ident" id="6097287">mu</span><span class="op" id="6097289">.</span><span class="ident" id="6097290">Unlock</span><span class="op" id="6097296">(</span><span class="op" id="6097297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6097301">if</span>&nbsp;<span class="ident" id="6097304">_</span><span class="op" id="6097305">,</span>&nbsp;<span class="ident" id="6097307">ok</span>&nbsp;<span class="op" id="6097310">:=</span>&nbsp;<span class="ident" id="6097313">compressors</span><span class="op" id="6097324">[</span><span class="ident" id="6097325">method</span><span class="op" id="6097331">]</span><span class="op" id="6097332">;</span>&nbsp;<span class="ident" id="6097334">ok</span>&nbsp;<span class="op" id="6097337">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6097341">panic</span><span class="op" id="6097346">(</span><span class="string" id="6097347">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="6097378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6097381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6097384">compressors</span><span class="op" id="6097395">[</span><span class="ident" id="6097396">method</span><span class="op" id="6097402">]</span>&nbsp;<span class="op" id="6097404">=</span>&nbsp;<span class="ident" id="6097406">comp</span><br>
<span class="lineno"></span><span class="op" id="6097411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="6097414">func</span>&nbsp;<span class="ident" id="6097419">compressor</span><span class="op" id="6097429">(</span><span class="ident" id="6097430">method</span>&nbsp;<span class="builtintype" id="6097437">uint16</span><span class="op" id="6097443">)</span>&nbsp;<span class="ident" id="6097445">Compressor</span>&nbsp;<span class="op" id="6097456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6097459">mu</span><span class="op" id="6097461">.</span><span class="ident" id="6097462">RLock</span><span class="op" id="6097467">(</span><span class="op" id="6097468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6097471">defer</span>&nbsp;<span class="ident" id="6097477">mu</span><span class="op" id="6097479">.</span><span class="ident" id="6097480">RUnlock</span><span class="op" id="6097487">(</span><span class="op" id="6097488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6097491">return</span>&nbsp;<span class="ident" id="6097498">compressors</span><span class="op" id="6097509">[</span><span class="ident" id="6097510">method</span><span class="op" id="6097516">]</span><br>
<span class="lineno"></span><span class="op" id="6097518">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6097521">func</span>&nbsp;<span class="ident" id="6097526">decompressor</span><span class="op" id="6097538">(</span><span class="ident" id="6097539">method</span>&nbsp;<span class="builtintype" id="6097546">uint16</span><span class="op" id="6097552">)</span>&nbsp;<span class="ident" id="6097554">Decompressor</span>&nbsp;<span class="op" id="6097567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6097570">mu</span><span class="op" id="6097572">.</span><span class="ident" id="6097573">RLock</span><span class="op" id="6097578">(</span><span class="op" id="6097579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6097582">defer</span>&nbsp;<span class="ident" id="6097588">mu</span><span class="op" id="6097590">.</span><span class="ident" id="6097591">RUnlock</span><span class="op" id="6097598">(</span><span class="op" id="6097599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6097602">return</span>&nbsp;<span class="ident" id="6097609">decompressors</span><span class="op" id="6097622">[</span><span class="ident" id="6097623">method</span><span class="op" id="6097629">]</span><br>
<span class="lineno">110</span><span class="op" id="6097631">}</span>
</div>
</body>
</html>
