<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html" class="current">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2467560">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2467616">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2467670">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2467721">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2467791">//&nbsp;Unix&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2467823">package</span>&nbsp;<span class="ident" id="2467831">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2467840">import</span>&nbsp;<span class="string" id="2467847">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2467855">var</span>&nbsp;<span class="op" id="2467859">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2467862">//&nbsp;envOnce&nbsp;guards&nbsp;initialization&nbsp;by&nbsp;copyenv,&nbsp;which&nbsp;populates&nbsp;env.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2467929">envOnce</span>&nbsp;<span class="ident" id="2467937">sync</span><span class="op" id="2467941">.</span><span class="ident" id="2467942">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2467949">//&nbsp;envLock&nbsp;guards&nbsp;env&nbsp;and&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2467982">envLock</span>&nbsp;<span class="ident" id="2467990">sync</span><span class="op" id="2467994">.</span><span class="ident" id="2467995">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2468005">//&nbsp;env&nbsp;maps&nbsp;from&nbsp;an&nbsp;environment&nbsp;variable&nbsp;to&nbsp;its&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2468080">env</span>&nbsp;<span class="keyword" id="2468084">map</span><span class="op" id="2468087">[</span><span class="builtintype" id="2468088">string</span><span class="op" id="2468094">]</span><span class="builtintype" id="2468095">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2468101">//&nbsp;envs&nbsp;is&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;elements&nbsp;are&nbsp;expected&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2468163">//&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;key=value&#34;.&nbsp;An&nbsp;empty&nbsp;string&nbsp;means&nbsp;deleted</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2468225">//&nbsp;(or&nbsp;a&nbsp;duplicate&nbsp;to&nbsp;be&nbsp;ignored).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2468261">envs</span>&nbsp;<span class="op" id="2468266">[</span><span class="op" id="2468267">]</span><span class="builtintype" id="2468268">string</span>&nbsp;<span class="op" id="2468275">=</span>&nbsp;<span class="ident" id="2468277">runtime_envs</span><span class="op" id="2468289">(</span><span class="op" id="2468290">)</span><br>
<span class="lineno"></span><span class="op" id="2468292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2468295">func</span>&nbsp;<span class="ident" id="2468300">runtime_envs</span><span class="op" id="2468312">(</span><span class="op" id="2468313">)</span>&nbsp;<span class="op" id="2468315">[</span><span class="op" id="2468316">]</span><span class="builtintype" id="2468317">string</span>&nbsp;<span class="comment" id="2468324">//&nbsp;in&nbsp;package&nbsp;runtime</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2468347">//&nbsp;setenv_c&nbsp;and&nbsp;unsetenv_c&nbsp;are&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime&nbsp;but&nbsp;are&nbsp;no-ops</span><br>
<span class="lineno"></span><span class="comment" id="2468417">//&nbsp;if&nbsp;cgo&nbsp;isn&#39;t&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="keyword" id="2468441">func</span>&nbsp;<span class="ident" id="2468446">setenv_c</span><span class="op" id="2468454">(</span><span class="ident" id="2468455">k</span><span class="op" id="2468456">,</span>&nbsp;<span class="ident" id="2468458">v</span>&nbsp;<span class="builtintype" id="2468460">string</span><span class="op" id="2468466">)</span><br>
<span class="lineno"></span><span class="keyword" id="2468468">func</span>&nbsp;<span class="ident" id="2468473">unsetenv_c</span><span class="op" id="2468483">(</span><span class="ident" id="2468484">k</span>&nbsp;<span class="builtintype" id="2468486">string</span><span class="op" id="2468492">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2468495">func</span>&nbsp;<span class="ident" id="2468500">copyenv</span><span class="op" id="2468507">(</span><span class="op" id="2468508">)</span>&nbsp;<span class="op" id="2468510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2468513">env</span>&nbsp;<span class="op" id="2468517">=</span>&nbsp;<span class="builtinfunc" id="2468519">make</span><span class="op" id="2468523">(</span><span class="keyword" id="2468524">map</span><span class="op" id="2468527">[</span><span class="builtintype" id="2468528">string</span><span class="op" id="2468534">]</span><span class="builtintype" id="2468535">int</span><span class="op" id="2468538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2468541">for</span>&nbsp;<span class="ident" id="2468545">i</span><span class="op" id="2468546">,</span>&nbsp;<span class="ident" id="2468548">s</span>&nbsp;<span class="op" id="2468550">:=</span>&nbsp;<span class="keyword" id="2468553">range</span>&nbsp;<span class="ident" id="2468559">envs</span>&nbsp;<span class="op" id="2468564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2468568">for</span>&nbsp;<span class="ident" id="2468572">j</span>&nbsp;<span class="op" id="2468574">:=</span>&nbsp;<span class="num" id="2468577">0</span><span class="op" id="2468578">;</span>&nbsp;<span class="ident" id="2468580">j</span>&nbsp;<span class="op" id="2468582">&lt;</span>&nbsp;<span class="builtinfunc" id="2468584">len</span><span class="op" id="2468587">(</span><span class="ident" id="2468588">s</span><span class="op" id="2468589">)</span><span class="op" id="2468590">;</span>&nbsp;<span class="ident" id="2468592">j</span><span class="op" id="2468593">++</span>&nbsp;<span class="op" id="2468596">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2468601">if</span>&nbsp;<span class="ident" id="2468604">s</span><span class="op" id="2468605">[</span><span class="ident" id="2468606">j</span><span class="op" id="2468607">]</span>&nbsp;<span class="op" id="2468609">==</span>&nbsp;<span class="string" id="2468612">&#39;=&#39;</span>&nbsp;<span class="op" id="2468616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2468622">key</span>&nbsp;<span class="op" id="2468626">:=</span>&nbsp;<span class="ident" id="2468629">s</span><span class="op" id="2468630">[</span><span class="op" id="2468631">:</span><span class="ident" id="2468632">j</span><span class="op" id="2468633">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2468639">if</span>&nbsp;<span class="ident" id="2468642">_</span><span class="op" id="2468643">,</span>&nbsp;<span class="ident" id="2468645">ok</span>&nbsp;<span class="op" id="2468648">:=</span>&nbsp;<span class="ident" id="2468651">env</span><span class="op" id="2468654">[</span><span class="ident" id="2468655">key</span><span class="op" id="2468658">]</span><span class="op" id="2468659">;</span>&nbsp;<span class="op" id="2468661">!</span><span class="ident" id="2468662">ok</span>&nbsp;<span class="op" id="2468665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2468672">env</span><span class="op" id="2468675">[</span><span class="ident" id="2468676">key</span><span class="op" id="2468679">]</span>&nbsp;<span class="op" id="2468681">=</span>&nbsp;<span class="ident" id="2468683">i</span>&nbsp;<span class="comment" id="2468685">//&nbsp;first&nbsp;mention&nbsp;of&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2468713">}</span>&nbsp;<span class="keyword" id="2468715">else</span>&nbsp;<span class="op" id="2468720">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2468727">//&nbsp;Clear&nbsp;duplicate&nbsp;keys.&nbsp;This&nbsp;permits&nbsp;Unsetenv&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2468782">//&nbsp;safely&nbsp;delete&nbsp;only&nbsp;the&nbsp;first&nbsp;item&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2468832">//&nbsp;worrying&nbsp;about&nbsp;unshadowing&nbsp;a&nbsp;later&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2468880">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;security&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2468923">envs</span><span class="op" id="2468927">[</span><span class="ident" id="2468928">i</span><span class="op" id="2468929">]</span>&nbsp;<span class="op" id="2468931">=</span>&nbsp;<span class="string" id="2468933">&#34;&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2468940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2468946">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2468955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2468959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2468962">}</span><br>
<span class="lineno">55</span><span class="op" id="2468964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2468967">func</span>&nbsp;<span class="ident" id="2468972">Unsetenv</span><span class="op" id="2468980">(</span><span class="ident" id="2468981">key</span>&nbsp;<span class="builtintype" id="2468985">string</span><span class="op" id="2468991">)</span>&nbsp;<span class="builtintype" id="2468993">error</span>&nbsp;<span class="op" id="2468999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469002">envOnce</span><span class="op" id="2469009">.</span><span class="ident" id="2469010">Do</span><span class="op" id="2469012">(</span><span class="ident" id="2469013">copyenv</span><span class="op" id="2469020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469024">envLock</span><span class="op" id="2469031">.</span><span class="ident" id="2469032">Lock</span><span class="op" id="2469036">(</span><span class="op" id="2469037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469040">defer</span>&nbsp;<span class="ident" id="2469046">envLock</span><span class="op" id="2469053">.</span><span class="ident" id="2469054">Unlock</span><span class="op" id="2469060">(</span><span class="op" id="2469061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469065">if</span>&nbsp;<span class="ident" id="2469068">i</span><span class="op" id="2469069">,</span>&nbsp;<span class="ident" id="2469071">ok</span>&nbsp;<span class="op" id="2469074">:=</span>&nbsp;<span class="ident" id="2469077">env</span><span class="op" id="2469080">[</span><span class="ident" id="2469081">key</span><span class="op" id="2469084">]</span><span class="op" id="2469085">;</span>&nbsp;<span class="ident" id="2469087">ok</span>&nbsp;<span class="op" id="2469090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469094">envs</span><span class="op" id="2469098">[</span><span class="ident" id="2469099">i</span><span class="op" id="2469100">]</span>&nbsp;<span class="op" id="2469102">=</span>&nbsp;<span class="string" id="2469104">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2469109">delete</span><span class="op" id="2469115">(</span><span class="ident" id="2469116">env</span><span class="op" id="2469119">,</span>&nbsp;<span class="ident" id="2469121">key</span><span class="op" id="2469124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2469127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469130">unsetenv_c</span><span class="op" id="2469140">(</span><span class="ident" id="2469141">key</span><span class="op" id="2469144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469147">return</span>&nbsp;<span class="builtintype" id="2469154">nil</span><br>
<span class="lineno"></span><span class="op" id="2469158">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2469161">func</span>&nbsp;<span class="ident" id="2469166">Getenv</span><span class="op" id="2469172">(</span><span class="ident" id="2469173">key</span>&nbsp;<span class="builtintype" id="2469177">string</span><span class="op" id="2469183">)</span>&nbsp;<span class="op" id="2469185">(</span><span class="ident" id="2469186">value</span>&nbsp;<span class="builtintype" id="2469192">string</span><span class="op" id="2469198">,</span>&nbsp;<span class="ident" id="2469200">found</span>&nbsp;<span class="builtintype" id="2469206">bool</span><span class="op" id="2469210">)</span>&nbsp;<span class="op" id="2469212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469215">envOnce</span><span class="op" id="2469222">.</span><span class="ident" id="2469223">Do</span><span class="op" id="2469225">(</span><span class="ident" id="2469226">copyenv</span><span class="op" id="2469233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469236">if</span>&nbsp;<span class="builtinfunc" id="2469239">len</span><span class="op" id="2469242">(</span><span class="ident" id="2469243">key</span><span class="op" id="2469246">)</span>&nbsp;<span class="op" id="2469248">==</span>&nbsp;<span class="num" id="2469251">0</span>&nbsp;<span class="op" id="2469253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469257">return</span>&nbsp;<span class="string" id="2469264">&#34;&#34;</span><span class="op" id="2469266">,</span>&nbsp;<span class="builtintype" id="2469268">false</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2469275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469279">envLock</span><span class="op" id="2469286">.</span><span class="ident" id="2469287">RLock</span><span class="op" id="2469292">(</span><span class="op" id="2469293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469296">defer</span>&nbsp;<span class="ident" id="2469302">envLock</span><span class="op" id="2469309">.</span><span class="ident" id="2469310">RUnlock</span><span class="op" id="2469317">(</span><span class="op" id="2469318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469322">i</span><span class="op" id="2469323">,</span>&nbsp;<span class="ident" id="2469325">ok</span>&nbsp;<span class="op" id="2469328">:=</span>&nbsp;<span class="ident" id="2469331">env</span><span class="op" id="2469334">[</span><span class="ident" id="2469335">key</span><span class="op" id="2469338">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469341">if</span>&nbsp;<span class="op" id="2469344">!</span><span class="ident" id="2469345">ok</span>&nbsp;<span class="op" id="2469348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469352">return</span>&nbsp;<span class="string" id="2469359">&#34;&#34;</span><span class="op" id="2469361">,</span>&nbsp;<span class="builtintype" id="2469363">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2469370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469373">s</span>&nbsp;<span class="op" id="2469375">:=</span>&nbsp;<span class="ident" id="2469378">envs</span><span class="op" id="2469382">[</span><span class="ident" id="2469383">i</span><span class="op" id="2469384">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469387">for</span>&nbsp;<span class="ident" id="2469391">i</span>&nbsp;<span class="op" id="2469393">:=</span>&nbsp;<span class="num" id="2469396">0</span><span class="op" id="2469397">;</span>&nbsp;<span class="ident" id="2469399">i</span>&nbsp;<span class="op" id="2469401">&lt;</span>&nbsp;<span class="builtinfunc" id="2469403">len</span><span class="op" id="2469406">(</span><span class="ident" id="2469407">s</span><span class="op" id="2469408">)</span><span class="op" id="2469409">;</span>&nbsp;<span class="ident" id="2469411">i</span><span class="op" id="2469412">++</span>&nbsp;<span class="op" id="2469415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469419">if</span>&nbsp;<span class="ident" id="2469422">s</span><span class="op" id="2469423">[</span><span class="ident" id="2469424">i</span><span class="op" id="2469425">]</span>&nbsp;<span class="op" id="2469427">==</span>&nbsp;<span class="string" id="2469430">&#39;=&#39;</span>&nbsp;<span class="op" id="2469434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469439">return</span>&nbsp;<span class="ident" id="2469446">s</span><span class="op" id="2469447">[</span><span class="ident" id="2469448">i</span><span class="op" id="2469449">+</span><span class="num" id="2469450">1</span><span class="op" id="2469451">:</span><span class="op" id="2469452">]</span><span class="op" id="2469453">,</span>&nbsp;<span class="builtintype" id="2469455">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2469462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2469465">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469468">return</span>&nbsp;<span class="string" id="2469475">&#34;&#34;</span><span class="op" id="2469477">,</span>&nbsp;<span class="builtintype" id="2469479">false</span><br>
<span class="lineno"></span><span class="op" id="2469485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2469488">func</span>&nbsp;<span class="ident" id="2469493">Setenv</span><span class="op" id="2469499">(</span><span class="ident" id="2469500">key</span><span class="op" id="2469503">,</span>&nbsp;<span class="ident" id="2469505">value</span>&nbsp;<span class="builtintype" id="2469511">string</span><span class="op" id="2469517">)</span>&nbsp;<span class="builtintype" id="2469519">error</span>&nbsp;<span class="op" id="2469525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469528">envOnce</span><span class="op" id="2469535">.</span><span class="ident" id="2469536">Do</span><span class="op" id="2469538">(</span><span class="ident" id="2469539">copyenv</span><span class="op" id="2469546">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469549">if</span>&nbsp;<span class="builtinfunc" id="2469552">len</span><span class="op" id="2469555">(</span><span class="ident" id="2469556">key</span><span class="op" id="2469559">)</span>&nbsp;<span class="op" id="2469561">==</span>&nbsp;<span class="num" id="2469564">0</span>&nbsp;<span class="op" id="2469566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469570">return</span>&nbsp;<span class="ident" id="2469577">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2469585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469588">for</span>&nbsp;<span class="ident" id="2469592">i</span>&nbsp;<span class="op" id="2469594">:=</span>&nbsp;<span class="num" id="2469597">0</span><span class="op" id="2469598">;</span>&nbsp;<span class="ident" id="2469600">i</span>&nbsp;<span class="op" id="2469602">&lt;</span>&nbsp;<span class="builtinfunc" id="2469604">len</span><span class="op" id="2469607">(</span><span class="ident" id="2469608">key</span><span class="op" id="2469611">)</span><span class="op" id="2469612">;</span>&nbsp;<span class="ident" id="2469614">i</span><span class="op" id="2469615">++</span>&nbsp;<span class="op" id="2469618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469622">if</span>&nbsp;<span class="ident" id="2469625">key</span><span class="op" id="2469628">[</span><span class="ident" id="2469629">i</span><span class="op" id="2469630">]</span>&nbsp;<span class="op" id="2469632">==</span>&nbsp;<span class="string" id="2469635">&#39;=&#39;</span>&nbsp;<span class="op" id="2469639">||</span>&nbsp;<span class="ident" id="2469642">key</span><span class="op" id="2469645">[</span><span class="ident" id="2469646">i</span><span class="op" id="2469647">]</span>&nbsp;<span class="op" id="2469649">==</span>&nbsp;<span class="num" id="2469652">0</span>&nbsp;<span class="op" id="2469654">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469659">return</span>&nbsp;<span class="ident" id="2469666">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2469675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2469678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469681">for</span>&nbsp;<span class="ident" id="2469685">i</span>&nbsp;<span class="op" id="2469687">:=</span>&nbsp;<span class="num" id="2469690">0</span><span class="op" id="2469691">;</span>&nbsp;<span class="ident" id="2469693">i</span>&nbsp;<span class="op" id="2469695">&lt;</span>&nbsp;<span class="builtinfunc" id="2469697">len</span><span class="op" id="2469700">(</span><span class="ident" id="2469701">value</span><span class="op" id="2469706">)</span><span class="op" id="2469707">;</span>&nbsp;<span class="ident" id="2469709">i</span><span class="op" id="2469710">++</span>&nbsp;<span class="op" id="2469713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469717">if</span>&nbsp;<span class="ident" id="2469720">value</span><span class="op" id="2469725">[</span><span class="ident" id="2469726">i</span><span class="op" id="2469727">]</span>&nbsp;<span class="op" id="2469729">==</span>&nbsp;<span class="num" id="2469732">0</span>&nbsp;<span class="op" id="2469734">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469739">return</span>&nbsp;<span class="ident" id="2469746">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2469755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2469758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469762">envLock</span><span class="op" id="2469769">.</span><span class="ident" id="2469770">Lock</span><span class="op" id="2469774">(</span><span class="op" id="2469775">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469778">defer</span>&nbsp;<span class="ident" id="2469784">envLock</span><span class="op" id="2469791">.</span><span class="ident" id="2469792">Unlock</span><span class="op" id="2469798">(</span><span class="op" id="2469799">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469803">i</span><span class="op" id="2469804">,</span>&nbsp;<span class="ident" id="2469806">ok</span>&nbsp;<span class="op" id="2469809">:=</span>&nbsp;<span class="ident" id="2469812">env</span><span class="op" id="2469815">[</span><span class="ident" id="2469816">key</span><span class="op" id="2469819">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469822">kv</span>&nbsp;<span class="op" id="2469825">:=</span>&nbsp;<span class="ident" id="2469828">key</span>&nbsp;<span class="op" id="2469832">+</span>&nbsp;<span class="string" id="2469834">&#34;=&#34;</span>&nbsp;<span class="op" id="2469838">+</span>&nbsp;<span class="ident" id="2469840">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469847">if</span>&nbsp;<span class="ident" id="2469850">ok</span>&nbsp;<span class="op" id="2469853">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469857">envs</span><span class="op" id="2469861">[</span><span class="ident" id="2469862">i</span><span class="op" id="2469863">]</span>&nbsp;<span class="op" id="2469865">=</span>&nbsp;<span class="ident" id="2469867">kv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2469871">}</span>&nbsp;<span class="keyword" id="2469873">else</span>&nbsp;<span class="op" id="2469878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469882">i</span>&nbsp;<span class="op" id="2469884">=</span>&nbsp;<span class="builtinfunc" id="2469886">len</span><span class="op" id="2469889">(</span><span class="ident" id="2469890">envs</span><span class="op" id="2469894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469898">envs</span>&nbsp;<span class="op" id="2469903">=</span>&nbsp;<span class="builtinfunc" id="2469905">append</span><span class="op" id="2469911">(</span><span class="ident" id="2469912">envs</span><span class="op" id="2469916">,</span>&nbsp;<span class="ident" id="2469918">kv</span><span class="op" id="2469920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2469923">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469926">env</span><span class="op" id="2469929">[</span><span class="ident" id="2469930">key</span><span class="op" id="2469933">]</span>&nbsp;<span class="op" id="2469935">=</span>&nbsp;<span class="ident" id="2469937">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469940">setenv_c</span><span class="op" id="2469948">(</span><span class="ident" id="2469949">key</span><span class="op" id="2469952">,</span>&nbsp;<span class="ident" id="2469954">value</span><span class="op" id="2469959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2469962">return</span>&nbsp;<span class="builtintype" id="2469969">nil</span><br>
<span class="lineno"></span><span class="op" id="2469973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2469976">func</span>&nbsp;<span class="ident" id="2469981">Clearenv</span><span class="op" id="2469989">(</span><span class="op" id="2469990">)</span>&nbsp;<span class="op" id="2469992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2469995">envOnce</span><span class="op" id="2470002">.</span><span class="ident" id="2470003">Do</span><span class="op" id="2470005">(</span><span class="ident" id="2470006">copyenv</span><span class="op" id="2470013">)</span>&nbsp;<span class="comment" id="2470015">//&nbsp;prevent&nbsp;copyenv&nbsp;in&nbsp;Getenv/Setenv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2470053">envLock</span><span class="op" id="2470060">.</span><span class="ident" id="2470061">Lock</span><span class="op" id="2470065">(</span><span class="op" id="2470066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2470069">defer</span>&nbsp;<span class="ident" id="2470075">envLock</span><span class="op" id="2470082">.</span><span class="ident" id="2470083">Unlock</span><span class="op" id="2470089">(</span><span class="op" id="2470090">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2470094">for</span>&nbsp;<span class="ident" id="2470098">k</span>&nbsp;<span class="op" id="2470100">:=</span>&nbsp;<span class="keyword" id="2470103">range</span>&nbsp;<span class="ident" id="2470109">env</span>&nbsp;<span class="op" id="2470113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2470117">unsetenv_c</span><span class="op" id="2470127">(</span><span class="ident" id="2470128">k</span><span class="op" id="2470129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2470132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2470135">env</span>&nbsp;<span class="op" id="2470139">=</span>&nbsp;<span class="builtinfunc" id="2470141">make</span><span class="op" id="2470145">(</span><span class="keyword" id="2470146">map</span><span class="op" id="2470149">[</span><span class="builtintype" id="2470150">string</span><span class="op" id="2470156">]</span><span class="builtintype" id="2470157">int</span><span class="op" id="2470160">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2470163">envs</span>&nbsp;<span class="op" id="2470168">=</span>&nbsp;<span class="op" id="2470170">[</span><span class="op" id="2470171">]</span><span class="builtintype" id="2470172">string</span><span class="op" id="2470178">{</span><span class="op" id="2470179">}</span><br>
<span class="lineno"></span><span class="op" id="2470181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2470184">func</span>&nbsp;<span class="ident" id="2470189">Environ</span><span class="op" id="2470196">(</span><span class="op" id="2470197">)</span>&nbsp;<span class="op" id="2470199">[</span><span class="op" id="2470200">]</span><span class="builtintype" id="2470201">string</span>&nbsp;<span class="op" id="2470208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2470211">envOnce</span><span class="op" id="2470218">.</span><span class="ident" id="2470219">Do</span><span class="op" id="2470221">(</span><span class="ident" id="2470222">copyenv</span><span class="op" id="2470229">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2470232">envLock</span><span class="op" id="2470239">.</span><span class="ident" id="2470240">RLock</span><span class="op" id="2470245">(</span><span class="op" id="2470246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2470249">defer</span>&nbsp;<span class="ident" id="2470255">envLock</span><span class="op" id="2470262">.</span><span class="ident" id="2470263">RUnlock</span><span class="op" id="2470270">(</span><span class="op" id="2470271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2470274">a</span>&nbsp;<span class="op" id="2470276">:=</span>&nbsp;<span class="builtinfunc" id="2470279">make</span><span class="op" id="2470283">(</span><span class="op" id="2470284">[</span><span class="op" id="2470285">]</span><span class="builtintype" id="2470286">string</span><span class="op" id="2470292">,</span>&nbsp;<span class="num" id="2470294">0</span><span class="op" id="2470295">,</span>&nbsp;<span class="builtinfunc" id="2470297">len</span><span class="op" id="2470300">(</span><span class="ident" id="2470301">envs</span><span class="op" id="2470305">)</span><span class="op" id="2470306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2470309">for</span>&nbsp;<span class="ident" id="2470313">_</span><span class="op" id="2470314">,</span>&nbsp;<span class="ident" id="2470316">env</span>&nbsp;<span class="op" id="2470320">:=</span>&nbsp;<span class="keyword" id="2470323">range</span>&nbsp;<span class="ident" id="2470329">envs</span>&nbsp;<span class="op" id="2470334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2470338">if</span>&nbsp;<span class="ident" id="2470341">env</span>&nbsp;<span class="op" id="2470345">!=</span>&nbsp;<span class="string" id="2470348">&#34;&#34;</span>&nbsp;<span class="op" id="2470351">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2470356">a</span>&nbsp;<span class="op" id="2470358">=</span>&nbsp;<span class="builtinfunc" id="2470360">append</span><span class="op" id="2470366">(</span><span class="ident" id="2470367">a</span><span class="op" id="2470368">,</span>&nbsp;<span class="ident" id="2470370">env</span><span class="op" id="2470373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2470377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2470380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2470383">return</span>&nbsp;<span class="ident" id="2470390">a</span><br>
<span class="lineno"></span><span class="op" id="2470392">}</span>
</div>
</body>
</html>
