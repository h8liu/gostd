<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7510978">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7511034">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7511088">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7511139">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="7511218">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7511227">package</span>&nbsp;<span class="ident" id="7511235">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7511240">import</span>&nbsp;<span class="op" id="7511247">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7511250">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7511263">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7511269">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7511280">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7511291">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7511298">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7511301">//&nbsp;testUnixAddr&nbsp;uses&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="7511371">//&nbsp;also&nbsp;uses&nbsp;/tmp&nbsp;directory&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;prohibited&nbsp;to&nbsp;create&nbsp;UNIX</span><br>
<span class="lineno">20</span><span class="comment" id="7511439">//&nbsp;sockets&nbsp;in&nbsp;TMPDIR.</span><br>
<span class="lineno"></span><span class="keyword" id="7511461">func</span>&nbsp;<span class="ident" id="7511466">testUnixAddr</span><span class="op" id="7511478">(</span><span class="op" id="7511479">)</span>&nbsp;<span class="builtintype" id="7511481">string</span>&nbsp;<span class="op" id="7511488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511491">f</span><span class="op" id="7511492">,</span>&nbsp;<span class="ident" id="7511494">err</span>&nbsp;<span class="op" id="7511498">:=</span>&nbsp;<span class="ident" id="7511501">ioutil</span><span class="op" id="7511507">.</span><span class="ident" id="7511508">TempFile</span><span class="op" id="7511516">(</span><span class="string" id="7511517">&#34;&#34;</span><span class="op" id="7511519">,</span>&nbsp;<span class="string" id="7511521">&#34;nettest&#34;</span><span class="op" id="7511530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511533">if</span>&nbsp;<span class="ident" id="7511536">err</span>&nbsp;<span class="op" id="7511540">!=</span>&nbsp;<span class="ident" id="7511543">nil</span>&nbsp;<span class="op" id="7511547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7511551">panic</span><span class="op" id="7511556">(</span><span class="ident" id="7511557">err</span><span class="op" id="7511560">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7511563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511566">addr</span>&nbsp;<span class="op" id="7511571">:=</span>&nbsp;<span class="ident" id="7511574">f</span><span class="op" id="7511575">.</span><span class="ident" id="7511576">Name</span><span class="op" id="7511580">(</span><span class="op" id="7511581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511584">f</span><span class="op" id="7511585">.</span><span class="ident" id="7511586">Close</span><span class="op" id="7511591">(</span><span class="op" id="7511592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511595">os</span><span class="op" id="7511597">.</span><span class="ident" id="7511598">Remove</span><span class="op" id="7511604">(</span><span class="ident" id="7511605">addr</span><span class="op" id="7511609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511612">return</span>&nbsp;<span class="ident" id="7511619">addr</span><br>
<span class="lineno">30</span><span class="op" id="7511624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7511627">var</span>&nbsp;<span class="ident" id="7511631">condFatalf</span>&nbsp;<span class="op" id="7511642">=</span>&nbsp;<span class="keyword" id="7511644">func</span><span class="op" id="7511648">(</span><span class="op" id="7511649">)</span>&nbsp;<span class="keyword" id="7511651">func</span><span class="op" id="7511655">(</span><span class="op" id="7511656">*</span><span class="ident" id="7511657">testing</span><span class="op" id="7511664">.</span><span class="ident" id="7511665">T</span><span class="op" id="7511666">,</span>&nbsp;<span class="builtintype" id="7511668">string</span><span class="op" id="7511674">,</span>&nbsp;<span class="op" id="7511676">...</span><span class="keyword" id="7511679">interface</span><span class="op" id="7511688">{</span><span class="op" id="7511689">}</span><span class="op" id="7511690">)</span>&nbsp;<span class="op" id="7511692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7511695">//&nbsp;A&nbsp;few&nbsp;APIs&nbsp;are&nbsp;not&nbsp;implemented&nbsp;yet&nbsp;on&nbsp;both&nbsp;Plan&nbsp;9&nbsp;and&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511762">switch</span>&nbsp;<span class="ident" id="7511769">runtime</span><span class="op" id="7511776">.</span><span class="ident" id="7511777">GOOS</span>&nbsp;<span class="op" id="7511782">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511785">case</span>&nbsp;<span class="string" id="7511790">&#34;plan9&#34;</span><span class="op" id="7511797">,</span>&nbsp;<span class="string" id="7511799">&#34;windows&#34;</span><span class="op" id="7511808">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511812">return</span>&nbsp;<span class="op" id="7511819">(</span><span class="op" id="7511820">*</span><span class="ident" id="7511821">testing</span><span class="op" id="7511828">.</span><span class="ident" id="7511829">T</span><span class="op" id="7511830">)</span><span class="op" id="7511831">.</span><span class="ident" id="7511832">Logf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7511838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511841">return</span>&nbsp;<span class="op" id="7511848">(</span><span class="op" id="7511849">*</span><span class="ident" id="7511850">testing</span><span class="op" id="7511857">.</span><span class="ident" id="7511858">T</span><span class="op" id="7511859">)</span><span class="op" id="7511860">.</span><span class="ident" id="7511861">Fatalf</span><br>
<span class="lineno"></span><span class="op" id="7511868">}</span><span class="op" id="7511869">(</span><span class="op" id="7511870">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7511873">func</span>&nbsp;<span class="ident" id="7511878">TestTCPListenerSpecificMethods</span><span class="op" id="7511908">(</span><span class="ident" id="7511909">t</span>&nbsp;<span class="op" id="7511911">*</span><span class="ident" id="7511912">testing</span><span class="op" id="7511919">.</span><span class="ident" id="7511920">T</span><span class="op" id="7511921">)</span>&nbsp;<span class="op" id="7511923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511926">switch</span>&nbsp;<span class="ident" id="7511933">runtime</span><span class="op" id="7511940">.</span><span class="ident" id="7511941">GOOS</span>&nbsp;<span class="op" id="7511946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511949">case</span>&nbsp;<span class="string" id="7511954">&#34;plan9&#34;</span><span class="op" id="7511961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511965">t</span><span class="op" id="7511966">.</span><span class="ident" id="7511967">Skipf</span><span class="op" id="7511972">(</span><span class="string" id="7511973">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7511994">,</span>&nbsp;<span class="ident" id="7511996">runtime</span><span class="op" id="7512003">.</span><span class="ident" id="7512004">GOOS</span><span class="op" id="7512008">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512015">la</span><span class="op" id="7512017">,</span>&nbsp;<span class="ident" id="7512019">err</span>&nbsp;<span class="op" id="7512023">:=</span>&nbsp;<span class="ident" id="7512026">ResolveTCPAddr</span><span class="op" id="7512040">(</span><span class="string" id="7512041">&#34;tcp4&#34;</span><span class="op" id="7512047">,</span>&nbsp;<span class="string" id="7512049">&#34;127.0.0.1:0&#34;</span><span class="op" id="7512062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512065">if</span>&nbsp;<span class="ident" id="7512068">err</span>&nbsp;<span class="op" id="7512072">!=</span>&nbsp;<span class="ident" id="7512075">nil</span>&nbsp;<span class="op" id="7512079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512083">t</span><span class="op" id="7512084">.</span><span class="ident" id="7512085">Fatalf</span><span class="op" id="7512091">(</span><span class="string" id="7512092">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7512119">,</span>&nbsp;<span class="ident" id="7512121">err</span><span class="op" id="7512124">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512130">ln</span><span class="op" id="7512132">,</span>&nbsp;<span class="ident" id="7512134">err</span>&nbsp;<span class="op" id="7512138">:=</span>&nbsp;<span class="ident" id="7512141">ListenTCP</span><span class="op" id="7512150">(</span><span class="string" id="7512151">&#34;tcp4&#34;</span><span class="op" id="7512157">,</span>&nbsp;<span class="ident" id="7512159">la</span><span class="op" id="7512161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512164">if</span>&nbsp;<span class="ident" id="7512167">err</span>&nbsp;<span class="op" id="7512171">!=</span>&nbsp;<span class="ident" id="7512174">nil</span>&nbsp;<span class="op" id="7512178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512182">t</span><span class="op" id="7512183">.</span><span class="ident" id="7512184">Fatalf</span><span class="op" id="7512190">(</span><span class="string" id="7512191">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7512213">,</span>&nbsp;<span class="ident" id="7512215">err</span><span class="op" id="7512218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512221">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512224">defer</span>&nbsp;<span class="ident" id="7512230">ln</span><span class="op" id="7512232">.</span><span class="ident" id="7512233">Close</span><span class="op" id="7512238">(</span><span class="op" id="7512239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512242">ln</span><span class="op" id="7512244">.</span><span class="ident" id="7512245">Addr</span><span class="op" id="7512249">(</span><span class="op" id="7512250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512253">ln</span><span class="op" id="7512255">.</span><span class="ident" id="7512256">SetDeadline</span><span class="op" id="7512267">(</span><span class="ident" id="7512268">time</span><span class="op" id="7512272">.</span><span class="ident" id="7512273">Now</span><span class="op" id="7512276">(</span><span class="op" id="7512277">)</span><span class="op" id="7512278">.</span><span class="ident" id="7512279">Add</span><span class="op" id="7512282">(</span><span class="num" id="7512283">30</span>&nbsp;<span class="op" id="7512286">*</span>&nbsp;<span class="ident" id="7512288">time</span><span class="op" id="7512292">.</span><span class="ident" id="7512293">Nanosecond</span><span class="op" id="7512303">)</span><span class="op" id="7512304">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512308">if</span>&nbsp;<span class="ident" id="7512311">c</span><span class="op" id="7512312">,</span>&nbsp;<span class="ident" id="7512314">err</span>&nbsp;<span class="op" id="7512318">:=</span>&nbsp;<span class="ident" id="7512321">ln</span><span class="op" id="7512323">.</span><span class="ident" id="7512324">Accept</span><span class="op" id="7512330">(</span><span class="op" id="7512331">)</span><span class="op" id="7512332">;</span>&nbsp;<span class="ident" id="7512334">err</span>&nbsp;<span class="op" id="7512338">!=</span>&nbsp;<span class="ident" id="7512341">nil</span>&nbsp;<span class="op" id="7512345">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512349">if</span>&nbsp;<span class="op" id="7512352">!</span><span class="ident" id="7512353">err</span><span class="op" id="7512356">.</span><span class="op" id="7512357">(</span><span class="ident" id="7512358">Error</span><span class="op" id="7512363">)</span><span class="op" id="7512364">.</span><span class="ident" id="7512365">Timeout</span><span class="op" id="7512372">(</span><span class="op" id="7512373">)</span>&nbsp;<span class="op" id="7512375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512380">t</span><span class="op" id="7512381">.</span><span class="ident" id="7512382">Fatalf</span><span class="op" id="7512388">(</span><span class="string" id="7512389">&#34;TCPListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7512420">,</span>&nbsp;<span class="ident" id="7512422">err</span><span class="op" id="7512425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512432">}</span>&nbsp;<span class="keyword" id="7512434">else</span>&nbsp;<span class="op" id="7512439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512443">c</span><span class="op" id="7512444">.</span><span class="ident" id="7512445">Close</span><span class="op" id="7512450">(</span><span class="op" id="7512451">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512457">if</span>&nbsp;<span class="ident" id="7512460">c</span><span class="op" id="7512461">,</span>&nbsp;<span class="ident" id="7512463">err</span>&nbsp;<span class="op" id="7512467">:=</span>&nbsp;<span class="ident" id="7512470">ln</span><span class="op" id="7512472">.</span><span class="ident" id="7512473">AcceptTCP</span><span class="op" id="7512482">(</span><span class="op" id="7512483">)</span><span class="op" id="7512484">;</span>&nbsp;<span class="ident" id="7512486">err</span>&nbsp;<span class="op" id="7512490">!=</span>&nbsp;<span class="ident" id="7512493">nil</span>&nbsp;<span class="op" id="7512497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512501">if</span>&nbsp;<span class="op" id="7512504">!</span><span class="ident" id="7512505">err</span><span class="op" id="7512508">.</span><span class="op" id="7512509">(</span><span class="ident" id="7512510">Error</span><span class="op" id="7512515">)</span><span class="op" id="7512516">.</span><span class="ident" id="7512517">Timeout</span><span class="op" id="7512524">(</span><span class="op" id="7512525">)</span>&nbsp;<span class="op" id="7512527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512532">t</span><span class="op" id="7512533">.</span><span class="ident" id="7512534">Fatalf</span><span class="op" id="7512540">(</span><span class="string" id="7512541">&#34;TCPListener.AcceptTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7512575">,</span>&nbsp;<span class="ident" id="7512577">err</span><span class="op" id="7512580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512584">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512587">}</span>&nbsp;<span class="keyword" id="7512589">else</span>&nbsp;<span class="op" id="7512594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512598">c</span><span class="op" id="7512599">.</span><span class="ident" id="7512600">Close</span><span class="op" id="7512605">(</span><span class="op" id="7512606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512613">if</span>&nbsp;<span class="ident" id="7512616">f</span><span class="op" id="7512617">,</span>&nbsp;<span class="ident" id="7512619">err</span>&nbsp;<span class="op" id="7512623">:=</span>&nbsp;<span class="ident" id="7512626">ln</span><span class="op" id="7512628">.</span><span class="ident" id="7512629">File</span><span class="op" id="7512633">(</span><span class="op" id="7512634">)</span><span class="op" id="7512635">;</span>&nbsp;<span class="ident" id="7512637">err</span>&nbsp;<span class="op" id="7512641">!=</span>&nbsp;<span class="ident" id="7512644">nil</span>&nbsp;<span class="op" id="7512648">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512652">condFatalf</span><span class="op" id="7512662">(</span><span class="ident" id="7512663">t</span><span class="op" id="7512664">,</span>&nbsp;<span class="string" id="7512666">&#34;TCPListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7512695">,</span>&nbsp;<span class="ident" id="7512697">err</span><span class="op" id="7512700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512703">}</span>&nbsp;<span class="keyword" id="7512705">else</span>&nbsp;<span class="op" id="7512710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512714">f</span><span class="op" id="7512715">.</span><span class="ident" id="7512716">Close</span><span class="op" id="7512721">(</span><span class="op" id="7512722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512725">}</span><br>
<span class="lineno"></span><span class="op" id="7512727">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7512730">func</span>&nbsp;<span class="ident" id="7512735">TestTCPConnSpecificMethods</span><span class="op" id="7512761">(</span><span class="ident" id="7512762">t</span>&nbsp;<span class="op" id="7512764">*</span><span class="ident" id="7512765">testing</span><span class="op" id="7512772">.</span><span class="ident" id="7512773">T</span><span class="op" id="7512774">)</span>&nbsp;<span class="op" id="7512776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512779">la</span><span class="op" id="7512781">,</span>&nbsp;<span class="ident" id="7512783">err</span>&nbsp;<span class="op" id="7512787">:=</span>&nbsp;<span class="ident" id="7512790">ResolveTCPAddr</span><span class="op" id="7512804">(</span><span class="string" id="7512805">&#34;tcp4&#34;</span><span class="op" id="7512811">,</span>&nbsp;<span class="string" id="7512813">&#34;127.0.0.1:0&#34;</span><span class="op" id="7512826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512829">if</span>&nbsp;<span class="ident" id="7512832">err</span>&nbsp;<span class="op" id="7512836">!=</span>&nbsp;<span class="ident" id="7512839">nil</span>&nbsp;<span class="op" id="7512843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512847">t</span><span class="op" id="7512848">.</span><span class="ident" id="7512849">Fatalf</span><span class="op" id="7512855">(</span><span class="string" id="7512856">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7512883">,</span>&nbsp;<span class="ident" id="7512885">err</span><span class="op" id="7512888">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512894">ln</span><span class="op" id="7512896">,</span>&nbsp;<span class="ident" id="7512898">err</span>&nbsp;<span class="op" id="7512902">:=</span>&nbsp;<span class="ident" id="7512905">ListenTCP</span><span class="op" id="7512914">(</span><span class="string" id="7512915">&#34;tcp4&#34;</span><span class="op" id="7512921">,</span>&nbsp;<span class="ident" id="7512923">la</span><span class="op" id="7512925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512928">if</span>&nbsp;<span class="ident" id="7512931">err</span>&nbsp;<span class="op" id="7512935">!=</span>&nbsp;<span class="ident" id="7512938">nil</span>&nbsp;<span class="op" id="7512942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512946">t</span><span class="op" id="7512947">.</span><span class="ident" id="7512948">Fatalf</span><span class="op" id="7512954">(</span><span class="string" id="7512955">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7512977">,</span>&nbsp;<span class="ident" id="7512979">err</span><span class="op" id="7512982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512985">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512988">defer</span>&nbsp;<span class="ident" id="7512994">ln</span><span class="op" id="7512996">.</span><span class="ident" id="7512997">Close</span><span class="op" id="7513002">(</span><span class="op" id="7513003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513006">ln</span><span class="op" id="7513008">.</span><span class="ident" id="7513009">Addr</span><span class="op" id="7513013">(</span><span class="op" id="7513014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513018">done</span>&nbsp;<span class="op" id="7513023">:=</span>&nbsp;<span class="builtinfunc" id="7513026">make</span><span class="op" id="7513030">(</span><span class="keyword" id="7513031">chan</span>&nbsp;<span class="builtintype" id="7513036">int</span><span class="op" id="7513039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513042">go</span>&nbsp;<span class="ident" id="7513045">transponder</span><span class="op" id="7513056">(</span><span class="ident" id="7513057">t</span><span class="op" id="7513058">,</span>&nbsp;<span class="ident" id="7513060">ln</span><span class="op" id="7513062">,</span>&nbsp;<span class="ident" id="7513064">done</span><span class="op" id="7513068">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513072">ra</span><span class="op" id="7513074">,</span>&nbsp;<span class="ident" id="7513076">err</span>&nbsp;<span class="op" id="7513080">:=</span>&nbsp;<span class="ident" id="7513083">ResolveTCPAddr</span><span class="op" id="7513097">(</span><span class="string" id="7513098">&#34;tcp4&#34;</span><span class="op" id="7513104">,</span>&nbsp;<span class="ident" id="7513106">ln</span><span class="op" id="7513108">.</span><span class="ident" id="7513109">Addr</span><span class="op" id="7513113">(</span><span class="op" id="7513114">)</span><span class="op" id="7513115">.</span><span class="ident" id="7513116">String</span><span class="op" id="7513122">(</span><span class="op" id="7513123">)</span><span class="op" id="7513124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513127">if</span>&nbsp;<span class="ident" id="7513130">err</span>&nbsp;<span class="op" id="7513134">!=</span>&nbsp;<span class="ident" id="7513137">nil</span>&nbsp;<span class="op" id="7513141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513145">t</span><span class="op" id="7513146">.</span><span class="ident" id="7513147">Fatalf</span><span class="op" id="7513153">(</span><span class="string" id="7513154">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7513181">,</span>&nbsp;<span class="ident" id="7513183">err</span><span class="op" id="7513186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7513189">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513192">c</span><span class="op" id="7513193">,</span>&nbsp;<span class="ident" id="7513195">err</span>&nbsp;<span class="op" id="7513199">:=</span>&nbsp;<span class="ident" id="7513202">DialTCP</span><span class="op" id="7513209">(</span><span class="string" id="7513210">&#34;tcp4&#34;</span><span class="op" id="7513216">,</span>&nbsp;<span class="ident" id="7513218">nil</span><span class="op" id="7513221">,</span>&nbsp;<span class="ident" id="7513223">ra</span><span class="op" id="7513225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513228">if</span>&nbsp;<span class="ident" id="7513231">err</span>&nbsp;<span class="op" id="7513235">!=</span>&nbsp;<span class="ident" id="7513238">nil</span>&nbsp;<span class="op" id="7513242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513246">t</span><span class="op" id="7513247">.</span><span class="ident" id="7513248">Fatalf</span><span class="op" id="7513254">(</span><span class="string" id="7513255">&#34;DialTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7513275">,</span>&nbsp;<span class="ident" id="7513277">err</span><span class="op" id="7513280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7513283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513286">defer</span>&nbsp;<span class="ident" id="7513292">c</span><span class="op" id="7513293">.</span><span class="ident" id="7513294">Close</span><span class="op" id="7513299">(</span><span class="op" id="7513300">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513303">c</span><span class="op" id="7513304">.</span><span class="ident" id="7513305">SetKeepAlive</span><span class="op" id="7513317">(</span><span class="ident" id="7513318">false</span><span class="op" id="7513323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513326">c</span><span class="op" id="7513327">.</span><span class="ident" id="7513328">SetKeepAlivePeriod</span><span class="op" id="7513346">(</span><span class="num" id="7513347">3</span>&nbsp;<span class="op" id="7513349">*</span>&nbsp;<span class="ident" id="7513351">time</span><span class="op" id="7513355">.</span><span class="ident" id="7513356">Second</span><span class="op" id="7513362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513365">c</span><span class="op" id="7513366">.</span><span class="ident" id="7513367">SetLinger</span><span class="op" id="7513376">(</span><span class="num" id="7513377">0</span><span class="op" id="7513378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513381">c</span><span class="op" id="7513382">.</span><span class="ident" id="7513383">SetNoDelay</span><span class="op" id="7513393">(</span><span class="ident" id="7513394">false</span><span class="op" id="7513399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513402">c</span><span class="op" id="7513403">.</span><span class="ident" id="7513404">LocalAddr</span><span class="op" id="7513413">(</span><span class="op" id="7513414">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513417">c</span><span class="op" id="7513418">.</span><span class="ident" id="7513419">RemoteAddr</span><span class="op" id="7513429">(</span><span class="op" id="7513430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513433">c</span><span class="op" id="7513434">.</span><span class="ident" id="7513435">SetDeadline</span><span class="op" id="7513446">(</span><span class="ident" id="7513447">time</span><span class="op" id="7513451">.</span><span class="ident" id="7513452">Now</span><span class="op" id="7513455">(</span><span class="op" id="7513456">)</span><span class="op" id="7513457">.</span><span class="ident" id="7513458">Add</span><span class="op" id="7513461">(</span><span class="ident" id="7513462">someTimeout</span><span class="op" id="7513473">)</span><span class="op" id="7513474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513477">c</span><span class="op" id="7513478">.</span><span class="ident" id="7513479">SetReadDeadline</span><span class="op" id="7513494">(</span><span class="ident" id="7513495">time</span><span class="op" id="7513499">.</span><span class="ident" id="7513500">Now</span><span class="op" id="7513503">(</span><span class="op" id="7513504">)</span><span class="op" id="7513505">.</span><span class="ident" id="7513506">Add</span><span class="op" id="7513509">(</span><span class="ident" id="7513510">someTimeout</span><span class="op" id="7513521">)</span><span class="op" id="7513522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513525">c</span><span class="op" id="7513526">.</span><span class="ident" id="7513527">SetWriteDeadline</span><span class="op" id="7513543">(</span><span class="ident" id="7513544">time</span><span class="op" id="7513548">.</span><span class="ident" id="7513549">Now</span><span class="op" id="7513552">(</span><span class="op" id="7513553">)</span><span class="op" id="7513554">.</span><span class="ident" id="7513555">Add</span><span class="op" id="7513558">(</span><span class="ident" id="7513559">someTimeout</span><span class="op" id="7513570">)</span><span class="op" id="7513571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513575">if</span>&nbsp;<span class="ident" id="7513578">_</span><span class="op" id="7513579">,</span>&nbsp;<span class="ident" id="7513581">err</span>&nbsp;<span class="op" id="7513585">:=</span>&nbsp;<span class="ident" id="7513588">c</span><span class="op" id="7513589">.</span><span class="ident" id="7513590">Write</span><span class="op" id="7513595">(</span><span class="op" id="7513596">[</span><span class="op" id="7513597">]</span><span class="builtintype" id="7513598">byte</span><span class="op" id="7513602">(</span><span class="string" id="7513603">&#34;TCPCONN&nbsp;TEST&#34;</span><span class="op" id="7513617">)</span><span class="op" id="7513618">)</span><span class="op" id="7513619">;</span>&nbsp;<span class="ident" id="7513621">err</span>&nbsp;<span class="op" id="7513625">!=</span>&nbsp;<span class="ident" id="7513628">nil</span>&nbsp;<span class="op" id="7513632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513636">t</span><span class="op" id="7513637">.</span><span class="ident" id="7513638">Fatalf</span><span class="op" id="7513644">(</span><span class="string" id="7513645">&#34;TCPConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7513671">,</span>&nbsp;<span class="ident" id="7513673">err</span><span class="op" id="7513676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7513679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513682">rb</span>&nbsp;<span class="op" id="7513685">:=</span>&nbsp;<span class="builtinfunc" id="7513688">make</span><span class="op" id="7513692">(</span><span class="op" id="7513693">[</span><span class="op" id="7513694">]</span><span class="builtintype" id="7513695">byte</span><span class="op" id="7513699">,</span>&nbsp;<span class="num" id="7513701">128</span><span class="op" id="7513704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513707">if</span>&nbsp;<span class="ident" id="7513710">_</span><span class="op" id="7513711">,</span>&nbsp;<span class="ident" id="7513713">err</span>&nbsp;<span class="op" id="7513717">:=</span>&nbsp;<span class="ident" id="7513720">c</span><span class="op" id="7513721">.</span><span class="ident" id="7513722">Read</span><span class="op" id="7513726">(</span><span class="ident" id="7513727">rb</span><span class="op" id="7513729">)</span><span class="op" id="7513730">;</span>&nbsp;<span class="ident" id="7513732">err</span>&nbsp;<span class="op" id="7513736">!=</span>&nbsp;<span class="ident" id="7513739">nil</span>&nbsp;<span class="op" id="7513743">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513747">t</span><span class="op" id="7513748">.</span><span class="ident" id="7513749">Fatalf</span><span class="op" id="7513755">(</span><span class="string" id="7513756">&#34;TCPConn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7513781">,</span>&nbsp;<span class="ident" id="7513783">err</span><span class="op" id="7513786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7513789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7513793">&lt;-</span><span class="ident" id="7513795">done</span><br>
<span class="lineno"></span><span class="op" id="7513800">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7513803">func</span>&nbsp;<span class="ident" id="7513808">TestUDPConnSpecificMethods</span><span class="op" id="7513834">(</span><span class="ident" id="7513835">t</span>&nbsp;<span class="op" id="7513837">*</span><span class="ident" id="7513838">testing</span><span class="op" id="7513845">.</span><span class="ident" id="7513846">T</span><span class="op" id="7513847">)</span>&nbsp;<span class="op" id="7513849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513852">la</span><span class="op" id="7513854">,</span>&nbsp;<span class="ident" id="7513856">err</span>&nbsp;<span class="op" id="7513860">:=</span>&nbsp;<span class="ident" id="7513863">ResolveUDPAddr</span><span class="op" id="7513877">(</span><span class="string" id="7513878">&#34;udp4&#34;</span><span class="op" id="7513884">,</span>&nbsp;<span class="string" id="7513886">&#34;127.0.0.1:0&#34;</span><span class="op" id="7513899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513902">if</span>&nbsp;<span class="ident" id="7513905">err</span>&nbsp;<span class="op" id="7513909">!=</span>&nbsp;<span class="ident" id="7513912">nil</span>&nbsp;<span class="op" id="7513916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513920">t</span><span class="op" id="7513921">.</span><span class="ident" id="7513922">Fatalf</span><span class="op" id="7513928">(</span><span class="string" id="7513929">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7513956">,</span>&nbsp;<span class="ident" id="7513958">err</span><span class="op" id="7513961">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7513964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513967">c</span><span class="op" id="7513968">,</span>&nbsp;<span class="ident" id="7513970">err</span>&nbsp;<span class="op" id="7513974">:=</span>&nbsp;<span class="ident" id="7513977">ListenUDP</span><span class="op" id="7513986">(</span><span class="string" id="7513987">&#34;udp4&#34;</span><span class="op" id="7513993">,</span>&nbsp;<span class="ident" id="7513995">la</span><span class="op" id="7513997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514000">if</span>&nbsp;<span class="ident" id="7514003">err</span>&nbsp;<span class="op" id="7514007">!=</span>&nbsp;<span class="ident" id="7514010">nil</span>&nbsp;<span class="op" id="7514014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514018">t</span><span class="op" id="7514019">.</span><span class="ident" id="7514020">Fatalf</span><span class="op" id="7514026">(</span><span class="string" id="7514027">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7514049">,</span>&nbsp;<span class="ident" id="7514051">err</span><span class="op" id="7514054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514057">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514060">defer</span>&nbsp;<span class="ident" id="7514066">c</span><span class="op" id="7514067">.</span><span class="ident" id="7514068">Close</span><span class="op" id="7514073">(</span><span class="op" id="7514074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514077">c</span><span class="op" id="7514078">.</span><span class="ident" id="7514079">LocalAddr</span><span class="op" id="7514088">(</span><span class="op" id="7514089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514092">c</span><span class="op" id="7514093">.</span><span class="ident" id="7514094">RemoteAddr</span><span class="op" id="7514104">(</span><span class="op" id="7514105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514108">c</span><span class="op" id="7514109">.</span><span class="ident" id="7514110">SetDeadline</span><span class="op" id="7514121">(</span><span class="ident" id="7514122">time</span><span class="op" id="7514126">.</span><span class="ident" id="7514127">Now</span><span class="op" id="7514130">(</span><span class="op" id="7514131">)</span><span class="op" id="7514132">.</span><span class="ident" id="7514133">Add</span><span class="op" id="7514136">(</span><span class="ident" id="7514137">someTimeout</span><span class="op" id="7514148">)</span><span class="op" id="7514149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514152">c</span><span class="op" id="7514153">.</span><span class="ident" id="7514154">SetReadDeadline</span><span class="op" id="7514169">(</span><span class="ident" id="7514170">time</span><span class="op" id="7514174">.</span><span class="ident" id="7514175">Now</span><span class="op" id="7514178">(</span><span class="op" id="7514179">)</span><span class="op" id="7514180">.</span><span class="ident" id="7514181">Add</span><span class="op" id="7514184">(</span><span class="ident" id="7514185">someTimeout</span><span class="op" id="7514196">)</span><span class="op" id="7514197">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514200">c</span><span class="op" id="7514201">.</span><span class="ident" id="7514202">SetWriteDeadline</span><span class="op" id="7514218">(</span><span class="ident" id="7514219">time</span><span class="op" id="7514223">.</span><span class="ident" id="7514224">Now</span><span class="op" id="7514227">(</span><span class="op" id="7514228">)</span><span class="op" id="7514229">.</span><span class="ident" id="7514230">Add</span><span class="op" id="7514233">(</span><span class="ident" id="7514234">someTimeout</span><span class="op" id="7514245">)</span><span class="op" id="7514246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514249">c</span><span class="op" id="7514250">.</span><span class="ident" id="7514251">SetReadBuffer</span><span class="op" id="7514264">(</span><span class="num" id="7514265">2048</span><span class="op" id="7514269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514272">c</span><span class="op" id="7514273">.</span><span class="ident" id="7514274">SetWriteBuffer</span><span class="op" id="7514288">(</span><span class="num" id="7514289">2048</span><span class="op" id="7514293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514297">wb</span>&nbsp;<span class="op" id="7514300">:=</span>&nbsp;<span class="op" id="7514303">[</span><span class="op" id="7514304">]</span><span class="builtintype" id="7514305">byte</span><span class="op" id="7514309">(</span><span class="string" id="7514310">&#34;UDPCONN&nbsp;TEST&#34;</span><span class="op" id="7514324">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514327">rb</span>&nbsp;<span class="op" id="7514330">:=</span>&nbsp;<span class="builtinfunc" id="7514333">make</span><span class="op" id="7514337">(</span><span class="op" id="7514338">[</span><span class="op" id="7514339">]</span><span class="builtintype" id="7514340">byte</span><span class="op" id="7514344">,</span>&nbsp;<span class="num" id="7514346">128</span><span class="op" id="7514349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514352">if</span>&nbsp;<span class="ident" id="7514355">_</span><span class="op" id="7514356">,</span>&nbsp;<span class="ident" id="7514358">err</span>&nbsp;<span class="op" id="7514362">:=</span>&nbsp;<span class="ident" id="7514365">c</span><span class="op" id="7514366">.</span><span class="ident" id="7514367">WriteToUDP</span><span class="op" id="7514377">(</span><span class="ident" id="7514378">wb</span><span class="op" id="7514380">,</span>&nbsp;<span class="ident" id="7514382">c</span><span class="op" id="7514383">.</span><span class="ident" id="7514384">LocalAddr</span><span class="op" id="7514393">(</span><span class="op" id="7514394">)</span><span class="op" id="7514395">.</span><span class="op" id="7514396">(</span><span class="op" id="7514397">*</span><span class="ident" id="7514398">UDPAddr</span><span class="op" id="7514405">)</span><span class="op" id="7514406">)</span><span class="op" id="7514407">;</span>&nbsp;<span class="ident" id="7514409">err</span>&nbsp;<span class="op" id="7514413">!=</span>&nbsp;<span class="ident" id="7514416">nil</span>&nbsp;<span class="op" id="7514420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514424">t</span><span class="op" id="7514425">.</span><span class="ident" id="7514426">Fatalf</span><span class="op" id="7514432">(</span><span class="string" id="7514433">&#34;UDPConn.WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7514464">,</span>&nbsp;<span class="ident" id="7514466">err</span><span class="op" id="7514469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514475">if</span>&nbsp;<span class="ident" id="7514478">_</span><span class="op" id="7514479">,</span>&nbsp;<span class="ident" id="7514481">_</span><span class="op" id="7514482">,</span>&nbsp;<span class="ident" id="7514484">err</span>&nbsp;<span class="op" id="7514488">:=</span>&nbsp;<span class="ident" id="7514491">c</span><span class="op" id="7514492">.</span><span class="ident" id="7514493">ReadFromUDP</span><span class="op" id="7514504">(</span><span class="ident" id="7514505">rb</span><span class="op" id="7514507">)</span><span class="op" id="7514508">;</span>&nbsp;<span class="ident" id="7514510">err</span>&nbsp;<span class="op" id="7514514">!=</span>&nbsp;<span class="ident" id="7514517">nil</span>&nbsp;<span class="op" id="7514521">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514525">t</span><span class="op" id="7514526">.</span><span class="ident" id="7514527">Fatalf</span><span class="op" id="7514533">(</span><span class="string" id="7514534">&#34;UDPConn.ReadFromUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7514566">,</span>&nbsp;<span class="ident" id="7514568">err</span><span class="op" id="7514571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514577">if</span>&nbsp;<span class="ident" id="7514580">_</span><span class="op" id="7514581">,</span>&nbsp;<span class="ident" id="7514583">_</span><span class="op" id="7514584">,</span>&nbsp;<span class="ident" id="7514586">err</span>&nbsp;<span class="op" id="7514590">:=</span>&nbsp;<span class="ident" id="7514593">c</span><span class="op" id="7514594">.</span><span class="ident" id="7514595">WriteMsgUDP</span><span class="op" id="7514606">(</span><span class="ident" id="7514607">wb</span><span class="op" id="7514609">,</span>&nbsp;<span class="ident" id="7514611">nil</span><span class="op" id="7514614">,</span>&nbsp;<span class="ident" id="7514616">c</span><span class="op" id="7514617">.</span><span class="ident" id="7514618">LocalAddr</span><span class="op" id="7514627">(</span><span class="op" id="7514628">)</span><span class="op" id="7514629">.</span><span class="op" id="7514630">(</span><span class="op" id="7514631">*</span><span class="ident" id="7514632">UDPAddr</span><span class="op" id="7514639">)</span><span class="op" id="7514640">)</span><span class="op" id="7514641">;</span>&nbsp;<span class="ident" id="7514643">err</span>&nbsp;<span class="op" id="7514647">!=</span>&nbsp;<span class="ident" id="7514650">nil</span>&nbsp;<span class="op" id="7514654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514658">condFatalf</span><span class="op" id="7514668">(</span><span class="ident" id="7514669">t</span><span class="op" id="7514670">,</span>&nbsp;<span class="string" id="7514672">&#34;UDPConn.WriteMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7514704">,</span>&nbsp;<span class="ident" id="7514706">err</span><span class="op" id="7514709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514712">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514715">if</span>&nbsp;<span class="ident" id="7514718">_</span><span class="op" id="7514719">,</span>&nbsp;<span class="ident" id="7514721">_</span><span class="op" id="7514722">,</span>&nbsp;<span class="ident" id="7514724">_</span><span class="op" id="7514725">,</span>&nbsp;<span class="ident" id="7514727">_</span><span class="op" id="7514728">,</span>&nbsp;<span class="ident" id="7514730">err</span>&nbsp;<span class="op" id="7514734">:=</span>&nbsp;<span class="ident" id="7514737">c</span><span class="op" id="7514738">.</span><span class="ident" id="7514739">ReadMsgUDP</span><span class="op" id="7514749">(</span><span class="ident" id="7514750">rb</span><span class="op" id="7514752">,</span>&nbsp;<span class="ident" id="7514754">nil</span><span class="op" id="7514757">)</span><span class="op" id="7514758">;</span>&nbsp;<span class="ident" id="7514760">err</span>&nbsp;<span class="op" id="7514764">!=</span>&nbsp;<span class="ident" id="7514767">nil</span>&nbsp;<span class="op" id="7514771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514775">condFatalf</span><span class="op" id="7514785">(</span><span class="ident" id="7514786">t</span><span class="op" id="7514787">,</span>&nbsp;<span class="string" id="7514789">&#34;UDPConn.ReadMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7514820">,</span>&nbsp;<span class="ident" id="7514822">err</span><span class="op" id="7514825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514832">if</span>&nbsp;<span class="ident" id="7514835">f</span><span class="op" id="7514836">,</span>&nbsp;<span class="ident" id="7514838">err</span>&nbsp;<span class="op" id="7514842">:=</span>&nbsp;<span class="ident" id="7514845">c</span><span class="op" id="7514846">.</span><span class="ident" id="7514847">File</span><span class="op" id="7514851">(</span><span class="op" id="7514852">)</span><span class="op" id="7514853">;</span>&nbsp;<span class="ident" id="7514855">err</span>&nbsp;<span class="op" id="7514859">!=</span>&nbsp;<span class="ident" id="7514862">nil</span>&nbsp;<span class="op" id="7514866">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514870">condFatalf</span><span class="op" id="7514880">(</span><span class="ident" id="7514881">t</span><span class="op" id="7514882">,</span>&nbsp;<span class="string" id="7514884">&#34;UDPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7514909">,</span>&nbsp;<span class="ident" id="7514911">err</span><span class="op" id="7514914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514917">}</span>&nbsp;<span class="keyword" id="7514919">else</span>&nbsp;<span class="op" id="7514924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514928">f</span><span class="op" id="7514929">.</span><span class="ident" id="7514930">Close</span><span class="op" id="7514935">(</span><span class="op" id="7514936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514943">defer</span>&nbsp;<span class="keyword" id="7514949">func</span><span class="op" id="7514953">(</span><span class="op" id="7514954">)</span>&nbsp;<span class="op" id="7514956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514960">if</span>&nbsp;<span class="ident" id="7514963">p</span>&nbsp;<span class="op" id="7514965">:=</span>&nbsp;<span class="builtinfunc" id="7514968">recover</span><span class="op" id="7514975">(</span><span class="op" id="7514976">)</span><span class="op" id="7514977">;</span>&nbsp;<span class="ident" id="7514979">p</span>&nbsp;<span class="op" id="7514981">!=</span>&nbsp;<span class="ident" id="7514984">nil</span>&nbsp;<span class="op" id="7514988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514993">t</span><span class="op" id="7514994">.</span><span class="ident" id="7514995">Fatalf</span><span class="op" id="7515001">(</span><span class="string" id="7515002">&#34;UDPConn.WriteToUDP&nbsp;or&nbsp;WriteMsgUDP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7515050">,</span>&nbsp;<span class="ident" id="7515052">p</span><span class="op" id="7515053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515060">}</span><span class="op" id="7515061">(</span><span class="op" id="7515062">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515066">c</span><span class="op" id="7515067">.</span><span class="ident" id="7515068">WriteToUDP</span><span class="op" id="7515078">(</span><span class="ident" id="7515079">wb</span><span class="op" id="7515081">,</span>&nbsp;<span class="ident" id="7515083">nil</span><span class="op" id="7515086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515089">c</span><span class="op" id="7515090">.</span><span class="ident" id="7515091">WriteMsgUDP</span><span class="op" id="7515102">(</span><span class="ident" id="7515103">wb</span><span class="op" id="7515105">,</span>&nbsp;<span class="ident" id="7515107">nil</span><span class="op" id="7515110">,</span>&nbsp;<span class="ident" id="7515112">nil</span><span class="op" id="7515115">)</span><br>
<span class="lineno"></span><span class="op" id="7515117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="7515120">func</span>&nbsp;<span class="ident" id="7515125">TestIPConnSpecificMethods</span><span class="op" id="7515150">(</span><span class="ident" id="7515151">t</span>&nbsp;<span class="op" id="7515153">*</span><span class="ident" id="7515154">testing</span><span class="op" id="7515161">.</span><span class="ident" id="7515162">T</span><span class="op" id="7515163">)</span>&nbsp;<span class="op" id="7515165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515168">if</span>&nbsp;<span class="ident" id="7515171">skip</span><span class="op" id="7515175">,</span>&nbsp;<span class="ident" id="7515177">skipmsg</span>&nbsp;<span class="op" id="7515185">:=</span>&nbsp;<span class="ident" id="7515188">skipRawSocketTest</span><span class="op" id="7515205">(</span><span class="ident" id="7515206">t</span><span class="op" id="7515207">)</span><span class="op" id="7515208">;</span>&nbsp;<span class="ident" id="7515210">skip</span>&nbsp;<span class="op" id="7515215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515219">t</span><span class="op" id="7515220">.</span><span class="ident" id="7515221">Skip</span><span class="op" id="7515225">(</span><span class="ident" id="7515226">skipmsg</span><span class="op" id="7515233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515240">la</span><span class="op" id="7515242">,</span>&nbsp;<span class="ident" id="7515244">err</span>&nbsp;<span class="op" id="7515248">:=</span>&nbsp;<span class="ident" id="7515251">ResolveIPAddr</span><span class="op" id="7515264">(</span><span class="string" id="7515265">&#34;ip4&#34;</span><span class="op" id="7515270">,</span>&nbsp;<span class="string" id="7515272">&#34;127.0.0.1&#34;</span><span class="op" id="7515283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515286">if</span>&nbsp;<span class="ident" id="7515289">err</span>&nbsp;<span class="op" id="7515293">!=</span>&nbsp;<span class="ident" id="7515296">nil</span>&nbsp;<span class="op" id="7515300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515304">t</span><span class="op" id="7515305">.</span><span class="ident" id="7515306">Fatalf</span><span class="op" id="7515312">(</span><span class="string" id="7515313">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7515339">,</span>&nbsp;<span class="ident" id="7515341">err</span><span class="op" id="7515344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515350">c</span><span class="op" id="7515351">,</span>&nbsp;<span class="ident" id="7515353">err</span>&nbsp;<span class="op" id="7515357">:=</span>&nbsp;<span class="ident" id="7515360">ListenIP</span><span class="op" id="7515368">(</span><span class="string" id="7515369">&#34;ip4:icmp&#34;</span><span class="op" id="7515379">,</span>&nbsp;<span class="ident" id="7515381">la</span><span class="op" id="7515383">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515386">if</span>&nbsp;<span class="ident" id="7515389">err</span>&nbsp;<span class="op" id="7515393">!=</span>&nbsp;<span class="ident" id="7515396">nil</span>&nbsp;<span class="op" id="7515400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515404">t</span><span class="op" id="7515405">.</span><span class="ident" id="7515406">Fatalf</span><span class="op" id="7515412">(</span><span class="string" id="7515413">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7515434">,</span>&nbsp;<span class="ident" id="7515436">err</span><span class="op" id="7515439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515445">defer</span>&nbsp;<span class="ident" id="7515451">c</span><span class="op" id="7515452">.</span><span class="ident" id="7515453">Close</span><span class="op" id="7515458">(</span><span class="op" id="7515459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515462">c</span><span class="op" id="7515463">.</span><span class="ident" id="7515464">LocalAddr</span><span class="op" id="7515473">(</span><span class="op" id="7515474">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515477">c</span><span class="op" id="7515478">.</span><span class="ident" id="7515479">RemoteAddr</span><span class="op" id="7515489">(</span><span class="op" id="7515490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515493">c</span><span class="op" id="7515494">.</span><span class="ident" id="7515495">SetDeadline</span><span class="op" id="7515506">(</span><span class="ident" id="7515507">time</span><span class="op" id="7515511">.</span><span class="ident" id="7515512">Now</span><span class="op" id="7515515">(</span><span class="op" id="7515516">)</span><span class="op" id="7515517">.</span><span class="ident" id="7515518">Add</span><span class="op" id="7515521">(</span><span class="ident" id="7515522">someTimeout</span><span class="op" id="7515533">)</span><span class="op" id="7515534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515537">c</span><span class="op" id="7515538">.</span><span class="ident" id="7515539">SetReadDeadline</span><span class="op" id="7515554">(</span><span class="ident" id="7515555">time</span><span class="op" id="7515559">.</span><span class="ident" id="7515560">Now</span><span class="op" id="7515563">(</span><span class="op" id="7515564">)</span><span class="op" id="7515565">.</span><span class="ident" id="7515566">Add</span><span class="op" id="7515569">(</span><span class="ident" id="7515570">someTimeout</span><span class="op" id="7515581">)</span><span class="op" id="7515582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515585">c</span><span class="op" id="7515586">.</span><span class="ident" id="7515587">SetWriteDeadline</span><span class="op" id="7515603">(</span><span class="ident" id="7515604">time</span><span class="op" id="7515608">.</span><span class="ident" id="7515609">Now</span><span class="op" id="7515612">(</span><span class="op" id="7515613">)</span><span class="op" id="7515614">.</span><span class="ident" id="7515615">Add</span><span class="op" id="7515618">(</span><span class="ident" id="7515619">someTimeout</span><span class="op" id="7515630">)</span><span class="op" id="7515631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515634">c</span><span class="op" id="7515635">.</span><span class="ident" id="7515636">SetReadBuffer</span><span class="op" id="7515649">(</span><span class="num" id="7515650">2048</span><span class="op" id="7515654">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515657">c</span><span class="op" id="7515658">.</span><span class="ident" id="7515659">SetWriteBuffer</span><span class="op" id="7515673">(</span><span class="num" id="7515674">2048</span><span class="op" id="7515678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515682">wb</span><span class="op" id="7515684">,</span>&nbsp;<span class="ident" id="7515686">err</span>&nbsp;<span class="op" id="7515690">:=</span>&nbsp;<span class="op" id="7515693">(</span><span class="op" id="7515694">&amp;</span><span class="ident" id="7515695">icmpMessage</span><span class="op" id="7515706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515710">Type</span><span class="op" id="7515714">:</span>&nbsp;<span class="ident" id="7515716">icmpv4EchoRequest</span><span class="op" id="7515733">,</span>&nbsp;<span class="ident" id="7515735">Code</span><span class="op" id="7515739">:</span>&nbsp;<span class="num" id="7515741">0</span><span class="op" id="7515742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515746">Body</span><span class="op" id="7515750">:</span>&nbsp;<span class="op" id="7515752">&amp;</span><span class="ident" id="7515753">icmpEcho</span><span class="op" id="7515761">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515766">ID</span><span class="op" id="7515768">:</span>&nbsp;<span class="ident" id="7515770">os</span><span class="op" id="7515772">.</span><span class="ident" id="7515773">Getpid</span><span class="op" id="7515779">(</span><span class="op" id="7515780">)</span>&nbsp;<span class="op" id="7515782">&amp;</span>&nbsp;<span class="num" id="7515784">0xffff</span><span class="op" id="7515790">,</span>&nbsp;<span class="ident" id="7515792">Seq</span><span class="op" id="7515795">:</span>&nbsp;<span class="num" id="7515797">1</span><span class="op" id="7515798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515803">Data</span><span class="op" id="7515807">:</span>&nbsp;<span class="op" id="7515809">[</span><span class="op" id="7515810">]</span><span class="builtintype" id="7515811">byte</span><span class="op" id="7515815">(</span><span class="string" id="7515816">&#34;IPCONN&nbsp;TEST&nbsp;&#34;</span><span class="op" id="7515830">)</span><span class="op" id="7515831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515835">}</span><span class="op" id="7515836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515839">}</span><span class="op" id="7515840">)</span><span class="op" id="7515841">.</span><span class="ident" id="7515842">Marshal</span><span class="op" id="7515849">(</span><span class="op" id="7515850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515853">if</span>&nbsp;<span class="ident" id="7515856">err</span>&nbsp;<span class="op" id="7515860">!=</span>&nbsp;<span class="ident" id="7515863">nil</span>&nbsp;<span class="op" id="7515867">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515871">t</span><span class="op" id="7515872">.</span><span class="ident" id="7515873">Fatalf</span><span class="op" id="7515879">(</span><span class="string" id="7515880">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7515912">,</span>&nbsp;<span class="ident" id="7515914">err</span><span class="op" id="7515917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515923">rb</span>&nbsp;<span class="op" id="7515926">:=</span>&nbsp;<span class="builtinfunc" id="7515929">make</span><span class="op" id="7515933">(</span><span class="op" id="7515934">[</span><span class="op" id="7515935">]</span><span class="builtintype" id="7515936">byte</span><span class="op" id="7515940">,</span>&nbsp;<span class="num" id="7515942">20</span><span class="op" id="7515944">+</span><span class="builtinfunc" id="7515945">len</span><span class="op" id="7515948">(</span><span class="ident" id="7515949">wb</span><span class="op" id="7515951">)</span><span class="op" id="7515952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515955">if</span>&nbsp;<span class="ident" id="7515958">_</span><span class="op" id="7515959">,</span>&nbsp;<span class="ident" id="7515961">err</span>&nbsp;<span class="op" id="7515965">:=</span>&nbsp;<span class="ident" id="7515968">c</span><span class="op" id="7515969">.</span><span class="ident" id="7515970">WriteToIP</span><span class="op" id="7515979">(</span><span class="ident" id="7515980">wb</span><span class="op" id="7515982">,</span>&nbsp;<span class="ident" id="7515984">c</span><span class="op" id="7515985">.</span><span class="ident" id="7515986">LocalAddr</span><span class="op" id="7515995">(</span><span class="op" id="7515996">)</span><span class="op" id="7515997">.</span><span class="op" id="7515998">(</span><span class="op" id="7515999">*</span><span class="ident" id="7516000">IPAddr</span><span class="op" id="7516006">)</span><span class="op" id="7516007">)</span><span class="op" id="7516008">;</span>&nbsp;<span class="ident" id="7516010">err</span>&nbsp;<span class="op" id="7516014">!=</span>&nbsp;<span class="ident" id="7516017">nil</span>&nbsp;<span class="op" id="7516021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516025">t</span><span class="op" id="7516026">.</span><span class="ident" id="7516027">Fatalf</span><span class="op" id="7516033">(</span><span class="string" id="7516034">&#34;IPConn.WriteToIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7516063">,</span>&nbsp;<span class="ident" id="7516065">err</span><span class="op" id="7516068">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516074">if</span>&nbsp;<span class="ident" id="7516077">_</span><span class="op" id="7516078">,</span>&nbsp;<span class="ident" id="7516080">_</span><span class="op" id="7516081">,</span>&nbsp;<span class="ident" id="7516083">err</span>&nbsp;<span class="op" id="7516087">:=</span>&nbsp;<span class="ident" id="7516090">c</span><span class="op" id="7516091">.</span><span class="ident" id="7516092">ReadFromIP</span><span class="op" id="7516102">(</span><span class="ident" id="7516103">rb</span><span class="op" id="7516105">)</span><span class="op" id="7516106">;</span>&nbsp;<span class="ident" id="7516108">err</span>&nbsp;<span class="op" id="7516112">!=</span>&nbsp;<span class="ident" id="7516115">nil</span>&nbsp;<span class="op" id="7516119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516123">t</span><span class="op" id="7516124">.</span><span class="ident" id="7516125">Fatalf</span><span class="op" id="7516131">(</span><span class="string" id="7516132">&#34;IPConn.ReadFromIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7516162">,</span>&nbsp;<span class="ident" id="7516164">err</span><span class="op" id="7516167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516173">if</span>&nbsp;<span class="ident" id="7516176">_</span><span class="op" id="7516177">,</span>&nbsp;<span class="ident" id="7516179">_</span><span class="op" id="7516180">,</span>&nbsp;<span class="ident" id="7516182">err</span>&nbsp;<span class="op" id="7516186">:=</span>&nbsp;<span class="ident" id="7516189">c</span><span class="op" id="7516190">.</span><span class="ident" id="7516191">WriteMsgIP</span><span class="op" id="7516201">(</span><span class="ident" id="7516202">wb</span><span class="op" id="7516204">,</span>&nbsp;<span class="ident" id="7516206">nil</span><span class="op" id="7516209">,</span>&nbsp;<span class="ident" id="7516211">c</span><span class="op" id="7516212">.</span><span class="ident" id="7516213">LocalAddr</span><span class="op" id="7516222">(</span><span class="op" id="7516223">)</span><span class="op" id="7516224">.</span><span class="op" id="7516225">(</span><span class="op" id="7516226">*</span><span class="ident" id="7516227">IPAddr</span><span class="op" id="7516233">)</span><span class="op" id="7516234">)</span><span class="op" id="7516235">;</span>&nbsp;<span class="ident" id="7516237">err</span>&nbsp;<span class="op" id="7516241">!=</span>&nbsp;<span class="ident" id="7516244">nil</span>&nbsp;<span class="op" id="7516248">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516252">condFatalf</span><span class="op" id="7516262">(</span><span class="ident" id="7516263">t</span><span class="op" id="7516264">,</span>&nbsp;<span class="string" id="7516266">&#34;IPConn.WriteMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7516296">,</span>&nbsp;<span class="ident" id="7516298">err</span><span class="op" id="7516301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516307">if</span>&nbsp;<span class="ident" id="7516310">_</span><span class="op" id="7516311">,</span>&nbsp;<span class="ident" id="7516313">_</span><span class="op" id="7516314">,</span>&nbsp;<span class="ident" id="7516316">_</span><span class="op" id="7516317">,</span>&nbsp;<span class="ident" id="7516319">_</span><span class="op" id="7516320">,</span>&nbsp;<span class="ident" id="7516322">err</span>&nbsp;<span class="op" id="7516326">:=</span>&nbsp;<span class="ident" id="7516329">c</span><span class="op" id="7516330">.</span><span class="ident" id="7516331">ReadMsgIP</span><span class="op" id="7516340">(</span><span class="ident" id="7516341">rb</span><span class="op" id="7516343">,</span>&nbsp;<span class="ident" id="7516345">nil</span><span class="op" id="7516348">)</span><span class="op" id="7516349">;</span>&nbsp;<span class="ident" id="7516351">err</span>&nbsp;<span class="op" id="7516355">!=</span>&nbsp;<span class="ident" id="7516358">nil</span>&nbsp;<span class="op" id="7516362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516366">condFatalf</span><span class="op" id="7516376">(</span><span class="ident" id="7516377">t</span><span class="op" id="7516378">,</span>&nbsp;<span class="string" id="7516380">&#34;IPConn.ReadMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7516409">,</span>&nbsp;<span class="ident" id="7516411">err</span><span class="op" id="7516414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516417">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516421">if</span>&nbsp;<span class="ident" id="7516424">f</span><span class="op" id="7516425">,</span>&nbsp;<span class="ident" id="7516427">err</span>&nbsp;<span class="op" id="7516431">:=</span>&nbsp;<span class="ident" id="7516434">c</span><span class="op" id="7516435">.</span><span class="ident" id="7516436">File</span><span class="op" id="7516440">(</span><span class="op" id="7516441">)</span><span class="op" id="7516442">;</span>&nbsp;<span class="ident" id="7516444">err</span>&nbsp;<span class="op" id="7516448">!=</span>&nbsp;<span class="ident" id="7516451">nil</span>&nbsp;<span class="op" id="7516455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516459">condFatalf</span><span class="op" id="7516469">(</span><span class="ident" id="7516470">t</span><span class="op" id="7516471">,</span>&nbsp;<span class="string" id="7516473">&#34;IPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7516497">,</span>&nbsp;<span class="ident" id="7516499">err</span><span class="op" id="7516502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516505">}</span>&nbsp;<span class="keyword" id="7516507">else</span>&nbsp;<span class="op" id="7516512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516516">f</span><span class="op" id="7516517">.</span><span class="ident" id="7516518">Close</span><span class="op" id="7516523">(</span><span class="op" id="7516524">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516531">defer</span>&nbsp;<span class="keyword" id="7516537">func</span><span class="op" id="7516541">(</span><span class="op" id="7516542">)</span>&nbsp;<span class="op" id="7516544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516548">if</span>&nbsp;<span class="ident" id="7516551">p</span>&nbsp;<span class="op" id="7516553">:=</span>&nbsp;<span class="builtinfunc" id="7516556">recover</span><span class="op" id="7516563">(</span><span class="op" id="7516564">)</span><span class="op" id="7516565">;</span>&nbsp;<span class="ident" id="7516567">p</span>&nbsp;<span class="op" id="7516569">!=</span>&nbsp;<span class="ident" id="7516572">nil</span>&nbsp;<span class="op" id="7516576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516581">t</span><span class="op" id="7516582">.</span><span class="ident" id="7516583">Fatalf</span><span class="op" id="7516589">(</span><span class="string" id="7516590">&#34;IPConn.WriteToIP&nbsp;or&nbsp;WriteMsgIP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7516635">,</span>&nbsp;<span class="ident" id="7516637">p</span><span class="op" id="7516638">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516645">}</span><span class="op" id="7516646">(</span><span class="op" id="7516647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516651">c</span><span class="op" id="7516652">.</span><span class="ident" id="7516653">WriteToIP</span><span class="op" id="7516662">(</span><span class="ident" id="7516663">wb</span><span class="op" id="7516665">,</span>&nbsp;<span class="ident" id="7516667">nil</span><span class="op" id="7516670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516673">c</span><span class="op" id="7516674">.</span><span class="ident" id="7516675">WriteMsgIP</span><span class="op" id="7516685">(</span><span class="ident" id="7516686">wb</span><span class="op" id="7516688">,</span>&nbsp;<span class="ident" id="7516690">nil</span><span class="op" id="7516693">,</span>&nbsp;<span class="ident" id="7516695">nil</span><span class="op" id="7516698">)</span><br>
<span class="lineno">235</span><span class="op" id="7516700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7516703">func</span>&nbsp;<span class="ident" id="7516708">TestUnixListenerSpecificMethods</span><span class="op" id="7516739">(</span><span class="ident" id="7516740">t</span>&nbsp;<span class="op" id="7516742">*</span><span class="ident" id="7516743">testing</span><span class="op" id="7516750">.</span><span class="ident" id="7516751">T</span><span class="op" id="7516752">)</span>&nbsp;<span class="op" id="7516754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516757">switch</span>&nbsp;<span class="ident" id="7516764">runtime</span><span class="op" id="7516771">.</span><span class="ident" id="7516772">GOOS</span>&nbsp;<span class="op" id="7516777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516780">case</span>&nbsp;<span class="string" id="7516785">&#34;nacl&#34;</span><span class="op" id="7516791">,</span>&nbsp;<span class="string" id="7516793">&#34;plan9&#34;</span><span class="op" id="7516800">,</span>&nbsp;<span class="string" id="7516802">&#34;windows&#34;</span><span class="op" id="7516811">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516815">t</span><span class="op" id="7516816">.</span><span class="ident" id="7516817">Skipf</span><span class="op" id="7516822">(</span><span class="string" id="7516823">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7516844">,</span>&nbsp;<span class="ident" id="7516846">runtime</span><span class="op" id="7516853">.</span><span class="ident" id="7516854">GOOS</span><span class="op" id="7516858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516865">addr</span>&nbsp;<span class="op" id="7516870">:=</span>&nbsp;<span class="ident" id="7516873">testUnixAddr</span><span class="op" id="7516885">(</span><span class="op" id="7516886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516889">la</span><span class="op" id="7516891">,</span>&nbsp;<span class="ident" id="7516893">err</span>&nbsp;<span class="op" id="7516897">:=</span>&nbsp;<span class="ident" id="7516900">ResolveUnixAddr</span><span class="op" id="7516915">(</span><span class="string" id="7516916">&#34;unix&#34;</span><span class="op" id="7516922">,</span>&nbsp;<span class="ident" id="7516924">addr</span><span class="op" id="7516928">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516931">if</span>&nbsp;<span class="ident" id="7516934">err</span>&nbsp;<span class="op" id="7516938">!=</span>&nbsp;<span class="ident" id="7516941">nil</span>&nbsp;<span class="op" id="7516945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516949">t</span><span class="op" id="7516950">.</span><span class="ident" id="7516951">Fatalf</span><span class="op" id="7516957">(</span><span class="string" id="7516958">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7516986">,</span>&nbsp;<span class="ident" id="7516988">err</span><span class="op" id="7516991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516997">ln</span><span class="op" id="7516999">,</span>&nbsp;<span class="ident" id="7517001">err</span>&nbsp;<span class="op" id="7517005">:=</span>&nbsp;<span class="ident" id="7517008">ListenUnix</span><span class="op" id="7517018">(</span><span class="string" id="7517019">&#34;unix&#34;</span><span class="op" id="7517025">,</span>&nbsp;<span class="ident" id="7517027">la</span><span class="op" id="7517029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517032">if</span>&nbsp;<span class="ident" id="7517035">err</span>&nbsp;<span class="op" id="7517039">!=</span>&nbsp;<span class="ident" id="7517042">nil</span>&nbsp;<span class="op" id="7517046">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517050">t</span><span class="op" id="7517051">.</span><span class="ident" id="7517052">Fatalf</span><span class="op" id="7517058">(</span><span class="string" id="7517059">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7517082">,</span>&nbsp;<span class="ident" id="7517084">err</span><span class="op" id="7517087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517093">defer</span>&nbsp;<span class="ident" id="7517099">ln</span><span class="op" id="7517101">.</span><span class="ident" id="7517102">Close</span><span class="op" id="7517107">(</span><span class="op" id="7517108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517111">defer</span>&nbsp;<span class="ident" id="7517117">os</span><span class="op" id="7517119">.</span><span class="ident" id="7517120">Remove</span><span class="op" id="7517126">(</span><span class="ident" id="7517127">addr</span><span class="op" id="7517131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517134">ln</span><span class="op" id="7517136">.</span><span class="ident" id="7517137">Addr</span><span class="op" id="7517141">(</span><span class="op" id="7517142">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517145">ln</span><span class="op" id="7517147">.</span><span class="ident" id="7517148">SetDeadline</span><span class="op" id="7517159">(</span><span class="ident" id="7517160">time</span><span class="op" id="7517164">.</span><span class="ident" id="7517165">Now</span><span class="op" id="7517168">(</span><span class="op" id="7517169">)</span><span class="op" id="7517170">.</span><span class="ident" id="7517171">Add</span><span class="op" id="7517174">(</span><span class="num" id="7517175">30</span>&nbsp;<span class="op" id="7517178">*</span>&nbsp;<span class="ident" id="7517180">time</span><span class="op" id="7517184">.</span><span class="ident" id="7517185">Nanosecond</span><span class="op" id="7517195">)</span><span class="op" id="7517196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517200">if</span>&nbsp;<span class="ident" id="7517203">c</span><span class="op" id="7517204">,</span>&nbsp;<span class="ident" id="7517206">err</span>&nbsp;<span class="op" id="7517210">:=</span>&nbsp;<span class="ident" id="7517213">ln</span><span class="op" id="7517215">.</span><span class="ident" id="7517216">Accept</span><span class="op" id="7517222">(</span><span class="op" id="7517223">)</span><span class="op" id="7517224">;</span>&nbsp;<span class="ident" id="7517226">err</span>&nbsp;<span class="op" id="7517230">!=</span>&nbsp;<span class="ident" id="7517233">nil</span>&nbsp;<span class="op" id="7517237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517241">if</span>&nbsp;<span class="op" id="7517244">!</span><span class="ident" id="7517245">err</span><span class="op" id="7517248">.</span><span class="op" id="7517249">(</span><span class="ident" id="7517250">Error</span><span class="op" id="7517255">)</span><span class="op" id="7517256">.</span><span class="ident" id="7517257">Timeout</span><span class="op" id="7517264">(</span><span class="op" id="7517265">)</span>&nbsp;<span class="op" id="7517267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517272">t</span><span class="op" id="7517273">.</span><span class="ident" id="7517274">Fatalf</span><span class="op" id="7517280">(</span><span class="string" id="7517281">&#34;UnixListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7517313">,</span>&nbsp;<span class="ident" id="7517315">err</span><span class="op" id="7517318">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517325">}</span>&nbsp;<span class="keyword" id="7517327">else</span>&nbsp;<span class="op" id="7517332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517336">c</span><span class="op" id="7517337">.</span><span class="ident" id="7517338">Close</span><span class="op" id="7517343">(</span><span class="op" id="7517344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517350">if</span>&nbsp;<span class="ident" id="7517353">c</span><span class="op" id="7517354">,</span>&nbsp;<span class="ident" id="7517356">err</span>&nbsp;<span class="op" id="7517360">:=</span>&nbsp;<span class="ident" id="7517363">ln</span><span class="op" id="7517365">.</span><span class="ident" id="7517366">AcceptUnix</span><span class="op" id="7517376">(</span><span class="op" id="7517377">)</span><span class="op" id="7517378">;</span>&nbsp;<span class="ident" id="7517380">err</span>&nbsp;<span class="op" id="7517384">!=</span>&nbsp;<span class="ident" id="7517387">nil</span>&nbsp;<span class="op" id="7517391">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517395">if</span>&nbsp;<span class="op" id="7517398">!</span><span class="ident" id="7517399">err</span><span class="op" id="7517402">.</span><span class="op" id="7517403">(</span><span class="ident" id="7517404">Error</span><span class="op" id="7517409">)</span><span class="op" id="7517410">.</span><span class="ident" id="7517411">Timeout</span><span class="op" id="7517418">(</span><span class="op" id="7517419">)</span>&nbsp;<span class="op" id="7517421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517426">t</span><span class="op" id="7517427">.</span><span class="ident" id="7517428">Fatalf</span><span class="op" id="7517434">(</span><span class="string" id="7517435">&#34;UnixListener.AcceptUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7517471">,</span>&nbsp;<span class="ident" id="7517473">err</span><span class="op" id="7517476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517483">}</span>&nbsp;<span class="keyword" id="7517485">else</span>&nbsp;<span class="op" id="7517490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517494">c</span><span class="op" id="7517495">.</span><span class="ident" id="7517496">Close</span><span class="op" id="7517501">(</span><span class="op" id="7517502">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517509">if</span>&nbsp;<span class="ident" id="7517512">f</span><span class="op" id="7517513">,</span>&nbsp;<span class="ident" id="7517515">err</span>&nbsp;<span class="op" id="7517519">:=</span>&nbsp;<span class="ident" id="7517522">ln</span><span class="op" id="7517524">.</span><span class="ident" id="7517525">File</span><span class="op" id="7517529">(</span><span class="op" id="7517530">)</span><span class="op" id="7517531">;</span>&nbsp;<span class="ident" id="7517533">err</span>&nbsp;<span class="op" id="7517537">!=</span>&nbsp;<span class="ident" id="7517540">nil</span>&nbsp;<span class="op" id="7517544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517548">t</span><span class="op" id="7517549">.</span><span class="ident" id="7517550">Fatalf</span><span class="op" id="7517556">(</span><span class="string" id="7517557">&#34;UnixListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7517587">,</span>&nbsp;<span class="ident" id="7517589">err</span><span class="op" id="7517592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517595">}</span>&nbsp;<span class="keyword" id="7517597">else</span>&nbsp;<span class="op" id="7517602">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517606">f</span><span class="op" id="7517607">.</span><span class="ident" id="7517608">Close</span><span class="op" id="7517613">(</span><span class="op" id="7517614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517617">}</span><br>
<span class="lineno"></span><span class="op" id="7517619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7517622">func</span>&nbsp;<span class="ident" id="7517627">TestUnixConnSpecificMethods</span><span class="op" id="7517654">(</span><span class="ident" id="7517655">t</span>&nbsp;<span class="op" id="7517657">*</span><span class="ident" id="7517658">testing</span><span class="op" id="7517665">.</span><span class="ident" id="7517666">T</span><span class="op" id="7517667">)</span>&nbsp;<span class="op" id="7517669">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517672">switch</span>&nbsp;<span class="ident" id="7517679">runtime</span><span class="op" id="7517686">.</span><span class="ident" id="7517687">GOOS</span>&nbsp;<span class="op" id="7517692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517695">case</span>&nbsp;<span class="string" id="7517700">&#34;nacl&#34;</span><span class="op" id="7517706">,</span>&nbsp;<span class="string" id="7517708">&#34;plan9&#34;</span><span class="op" id="7517715">,</span>&nbsp;<span class="string" id="7517717">&#34;windows&#34;</span><span class="op" id="7517726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517730">t</span><span class="op" id="7517731">.</span><span class="ident" id="7517732">Skipf</span><span class="op" id="7517737">(</span><span class="string" id="7517738">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7517759">,</span>&nbsp;<span class="ident" id="7517761">runtime</span><span class="op" id="7517768">.</span><span class="ident" id="7517769">GOOS</span><span class="op" id="7517773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517780">addr1</span><span class="op" id="7517785">,</span>&nbsp;<span class="ident" id="7517787">addr2</span><span class="op" id="7517792">,</span>&nbsp;<span class="ident" id="7517794">addr3</span>&nbsp;<span class="op" id="7517800">:=</span>&nbsp;<span class="ident" id="7517803">testUnixAddr</span><span class="op" id="7517815">(</span><span class="op" id="7517816">)</span><span class="op" id="7517817">,</span>&nbsp;<span class="ident" id="7517819">testUnixAddr</span><span class="op" id="7517831">(</span><span class="op" id="7517832">)</span><span class="op" id="7517833">,</span>&nbsp;<span class="ident" id="7517835">testUnixAddr</span><span class="op" id="7517847">(</span><span class="op" id="7517848">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517852">a1</span><span class="op" id="7517854">,</span>&nbsp;<span class="ident" id="7517856">err</span>&nbsp;<span class="op" id="7517860">:=</span>&nbsp;<span class="ident" id="7517863">ResolveUnixAddr</span><span class="op" id="7517878">(</span><span class="string" id="7517879">&#34;unixgram&#34;</span><span class="op" id="7517889">,</span>&nbsp;<span class="ident" id="7517891">addr1</span><span class="op" id="7517896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517899">if</span>&nbsp;<span class="ident" id="7517902">err</span>&nbsp;<span class="op" id="7517906">!=</span>&nbsp;<span class="ident" id="7517909">nil</span>&nbsp;<span class="op" id="7517913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517917">t</span><span class="op" id="7517918">.</span><span class="ident" id="7517919">Fatalf</span><span class="op" id="7517925">(</span><span class="string" id="7517926">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7517954">,</span>&nbsp;<span class="ident" id="7517956">err</span><span class="op" id="7517959">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517965">c1</span><span class="op" id="7517967">,</span>&nbsp;<span class="ident" id="7517969">err</span>&nbsp;<span class="op" id="7517973">:=</span>&nbsp;<span class="ident" id="7517976">DialUnix</span><span class="op" id="7517984">(</span><span class="string" id="7517985">&#34;unixgram&#34;</span><span class="op" id="7517995">,</span>&nbsp;<span class="ident" id="7517997">a1</span><span class="op" id="7517999">,</span>&nbsp;<span class="ident" id="7518001">nil</span><span class="op" id="7518004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518007">if</span>&nbsp;<span class="ident" id="7518010">err</span>&nbsp;<span class="op" id="7518014">!=</span>&nbsp;<span class="ident" id="7518017">nil</span>&nbsp;<span class="op" id="7518021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518025">t</span><span class="op" id="7518026">.</span><span class="ident" id="7518027">Fatalf</span><span class="op" id="7518033">(</span><span class="string" id="7518034">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7518055">,</span>&nbsp;<span class="ident" id="7518057">err</span><span class="op" id="7518060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518063">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518066">defer</span>&nbsp;<span class="ident" id="7518072">c1</span><span class="op" id="7518074">.</span><span class="ident" id="7518075">Close</span><span class="op" id="7518080">(</span><span class="op" id="7518081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518084">defer</span>&nbsp;<span class="ident" id="7518090">os</span><span class="op" id="7518092">.</span><span class="ident" id="7518093">Remove</span><span class="op" id="7518099">(</span><span class="ident" id="7518100">addr1</span><span class="op" id="7518105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518108">c1</span><span class="op" id="7518110">.</span><span class="ident" id="7518111">LocalAddr</span><span class="op" id="7518120">(</span><span class="op" id="7518121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518124">c1</span><span class="op" id="7518126">.</span><span class="ident" id="7518127">RemoteAddr</span><span class="op" id="7518137">(</span><span class="op" id="7518138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518141">c1</span><span class="op" id="7518143">.</span><span class="ident" id="7518144">SetDeadline</span><span class="op" id="7518155">(</span><span class="ident" id="7518156">time</span><span class="op" id="7518160">.</span><span class="ident" id="7518161">Now</span><span class="op" id="7518164">(</span><span class="op" id="7518165">)</span><span class="op" id="7518166">.</span><span class="ident" id="7518167">Add</span><span class="op" id="7518170">(</span><span class="ident" id="7518171">someTimeout</span><span class="op" id="7518182">)</span><span class="op" id="7518183">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518186">c1</span><span class="op" id="7518188">.</span><span class="ident" id="7518189">SetReadDeadline</span><span class="op" id="7518204">(</span><span class="ident" id="7518205">time</span><span class="op" id="7518209">.</span><span class="ident" id="7518210">Now</span><span class="op" id="7518213">(</span><span class="op" id="7518214">)</span><span class="op" id="7518215">.</span><span class="ident" id="7518216">Add</span><span class="op" id="7518219">(</span><span class="ident" id="7518220">someTimeout</span><span class="op" id="7518231">)</span><span class="op" id="7518232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518235">c1</span><span class="op" id="7518237">.</span><span class="ident" id="7518238">SetWriteDeadline</span><span class="op" id="7518254">(</span><span class="ident" id="7518255">time</span><span class="op" id="7518259">.</span><span class="ident" id="7518260">Now</span><span class="op" id="7518263">(</span><span class="op" id="7518264">)</span><span class="op" id="7518265">.</span><span class="ident" id="7518266">Add</span><span class="op" id="7518269">(</span><span class="ident" id="7518270">someTimeout</span><span class="op" id="7518281">)</span><span class="op" id="7518282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518285">c1</span><span class="op" id="7518287">.</span><span class="ident" id="7518288">SetReadBuffer</span><span class="op" id="7518301">(</span><span class="num" id="7518302">2048</span><span class="op" id="7518306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518309">c1</span><span class="op" id="7518311">.</span><span class="ident" id="7518312">SetWriteBuffer</span><span class="op" id="7518326">(</span><span class="num" id="7518327">2048</span><span class="op" id="7518331">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518335">a2</span><span class="op" id="7518337">,</span>&nbsp;<span class="ident" id="7518339">err</span>&nbsp;<span class="op" id="7518343">:=</span>&nbsp;<span class="ident" id="7518346">ResolveUnixAddr</span><span class="op" id="7518361">(</span><span class="string" id="7518362">&#34;unixgram&#34;</span><span class="op" id="7518372">,</span>&nbsp;<span class="ident" id="7518374">addr2</span><span class="op" id="7518379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518382">if</span>&nbsp;<span class="ident" id="7518385">err</span>&nbsp;<span class="op" id="7518389">!=</span>&nbsp;<span class="ident" id="7518392">nil</span>&nbsp;<span class="op" id="7518396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518400">t</span><span class="op" id="7518401">.</span><span class="ident" id="7518402">Fatalf</span><span class="op" id="7518408">(</span><span class="string" id="7518409">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7518437">,</span>&nbsp;<span class="ident" id="7518439">err</span><span class="op" id="7518442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518448">c2</span><span class="op" id="7518450">,</span>&nbsp;<span class="ident" id="7518452">err</span>&nbsp;<span class="op" id="7518456">:=</span>&nbsp;<span class="ident" id="7518459">DialUnix</span><span class="op" id="7518467">(</span><span class="string" id="7518468">&#34;unixgram&#34;</span><span class="op" id="7518478">,</span>&nbsp;<span class="ident" id="7518480">a2</span><span class="op" id="7518482">,</span>&nbsp;<span class="ident" id="7518484">nil</span><span class="op" id="7518487">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518490">if</span>&nbsp;<span class="ident" id="7518493">err</span>&nbsp;<span class="op" id="7518497">!=</span>&nbsp;<span class="ident" id="7518500">nil</span>&nbsp;<span class="op" id="7518504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518508">t</span><span class="op" id="7518509">.</span><span class="ident" id="7518510">Fatalf</span><span class="op" id="7518516">(</span><span class="string" id="7518517">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7518538">,</span>&nbsp;<span class="ident" id="7518540">err</span><span class="op" id="7518543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518549">defer</span>&nbsp;<span class="ident" id="7518555">c2</span><span class="op" id="7518557">.</span><span class="ident" id="7518558">Close</span><span class="op" id="7518563">(</span><span class="op" id="7518564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518567">defer</span>&nbsp;<span class="ident" id="7518573">os</span><span class="op" id="7518575">.</span><span class="ident" id="7518576">Remove</span><span class="op" id="7518582">(</span><span class="ident" id="7518583">addr2</span><span class="op" id="7518588">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518591">c2</span><span class="op" id="7518593">.</span><span class="ident" id="7518594">LocalAddr</span><span class="op" id="7518603">(</span><span class="op" id="7518604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518607">c2</span><span class="op" id="7518609">.</span><span class="ident" id="7518610">RemoteAddr</span><span class="op" id="7518620">(</span><span class="op" id="7518621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518624">c2</span><span class="op" id="7518626">.</span><span class="ident" id="7518627">SetDeadline</span><span class="op" id="7518638">(</span><span class="ident" id="7518639">time</span><span class="op" id="7518643">.</span><span class="ident" id="7518644">Now</span><span class="op" id="7518647">(</span><span class="op" id="7518648">)</span><span class="op" id="7518649">.</span><span class="ident" id="7518650">Add</span><span class="op" id="7518653">(</span><span class="ident" id="7518654">someTimeout</span><span class="op" id="7518665">)</span><span class="op" id="7518666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518669">c2</span><span class="op" id="7518671">.</span><span class="ident" id="7518672">SetReadDeadline</span><span class="op" id="7518687">(</span><span class="ident" id="7518688">time</span><span class="op" id="7518692">.</span><span class="ident" id="7518693">Now</span><span class="op" id="7518696">(</span><span class="op" id="7518697">)</span><span class="op" id="7518698">.</span><span class="ident" id="7518699">Add</span><span class="op" id="7518702">(</span><span class="ident" id="7518703">someTimeout</span><span class="op" id="7518714">)</span><span class="op" id="7518715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518718">c2</span><span class="op" id="7518720">.</span><span class="ident" id="7518721">SetWriteDeadline</span><span class="op" id="7518737">(</span><span class="ident" id="7518738">time</span><span class="op" id="7518742">.</span><span class="ident" id="7518743">Now</span><span class="op" id="7518746">(</span><span class="op" id="7518747">)</span><span class="op" id="7518748">.</span><span class="ident" id="7518749">Add</span><span class="op" id="7518752">(</span><span class="ident" id="7518753">someTimeout</span><span class="op" id="7518764">)</span><span class="op" id="7518765">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518768">c2</span><span class="op" id="7518770">.</span><span class="ident" id="7518771">SetReadBuffer</span><span class="op" id="7518784">(</span><span class="num" id="7518785">2048</span><span class="op" id="7518789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518792">c2</span><span class="op" id="7518794">.</span><span class="ident" id="7518795">SetWriteBuffer</span><span class="op" id="7518809">(</span><span class="num" id="7518810">2048</span><span class="op" id="7518814">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518818">a3</span><span class="op" id="7518820">,</span>&nbsp;<span class="ident" id="7518822">err</span>&nbsp;<span class="op" id="7518826">:=</span>&nbsp;<span class="ident" id="7518829">ResolveUnixAddr</span><span class="op" id="7518844">(</span><span class="string" id="7518845">&#34;unixgram&#34;</span><span class="op" id="7518855">,</span>&nbsp;<span class="ident" id="7518857">addr3</span><span class="op" id="7518862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518865">if</span>&nbsp;<span class="ident" id="7518868">err</span>&nbsp;<span class="op" id="7518872">!=</span>&nbsp;<span class="ident" id="7518875">nil</span>&nbsp;<span class="op" id="7518879">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518883">t</span><span class="op" id="7518884">.</span><span class="ident" id="7518885">Fatalf</span><span class="op" id="7518891">(</span><span class="string" id="7518892">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7518920">,</span>&nbsp;<span class="ident" id="7518922">err</span><span class="op" id="7518925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518931">c3</span><span class="op" id="7518933">,</span>&nbsp;<span class="ident" id="7518935">err</span>&nbsp;<span class="op" id="7518939">:=</span>&nbsp;<span class="ident" id="7518942">ListenUnixgram</span><span class="op" id="7518956">(</span><span class="string" id="7518957">&#34;unixgram&#34;</span><span class="op" id="7518967">,</span>&nbsp;<span class="ident" id="7518969">a3</span><span class="op" id="7518971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518974">if</span>&nbsp;<span class="ident" id="7518977">err</span>&nbsp;<span class="op" id="7518981">!=</span>&nbsp;<span class="ident" id="7518984">nil</span>&nbsp;<span class="op" id="7518988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518992">t</span><span class="op" id="7518993">.</span><span class="ident" id="7518994">Fatalf</span><span class="op" id="7519000">(</span><span class="string" id="7519001">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7519028">,</span>&nbsp;<span class="ident" id="7519030">err</span><span class="op" id="7519033">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519039">defer</span>&nbsp;<span class="ident" id="7519045">c3</span><span class="op" id="7519047">.</span><span class="ident" id="7519048">Close</span><span class="op" id="7519053">(</span><span class="op" id="7519054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519057">defer</span>&nbsp;<span class="ident" id="7519063">os</span><span class="op" id="7519065">.</span><span class="ident" id="7519066">Remove</span><span class="op" id="7519072">(</span><span class="ident" id="7519073">addr3</span><span class="op" id="7519078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519081">c3</span><span class="op" id="7519083">.</span><span class="ident" id="7519084">LocalAddr</span><span class="op" id="7519093">(</span><span class="op" id="7519094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519097">c3</span><span class="op" id="7519099">.</span><span class="ident" id="7519100">RemoteAddr</span><span class="op" id="7519110">(</span><span class="op" id="7519111">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519114">c3</span><span class="op" id="7519116">.</span><span class="ident" id="7519117">SetDeadline</span><span class="op" id="7519128">(</span><span class="ident" id="7519129">time</span><span class="op" id="7519133">.</span><span class="ident" id="7519134">Now</span><span class="op" id="7519137">(</span><span class="op" id="7519138">)</span><span class="op" id="7519139">.</span><span class="ident" id="7519140">Add</span><span class="op" id="7519143">(</span><span class="ident" id="7519144">someTimeout</span><span class="op" id="7519155">)</span><span class="op" id="7519156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519159">c3</span><span class="op" id="7519161">.</span><span class="ident" id="7519162">SetReadDeadline</span><span class="op" id="7519177">(</span><span class="ident" id="7519178">time</span><span class="op" id="7519182">.</span><span class="ident" id="7519183">Now</span><span class="op" id="7519186">(</span><span class="op" id="7519187">)</span><span class="op" id="7519188">.</span><span class="ident" id="7519189">Add</span><span class="op" id="7519192">(</span><span class="ident" id="7519193">someTimeout</span><span class="op" id="7519204">)</span><span class="op" id="7519205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519208">c3</span><span class="op" id="7519210">.</span><span class="ident" id="7519211">SetWriteDeadline</span><span class="op" id="7519227">(</span><span class="ident" id="7519228">time</span><span class="op" id="7519232">.</span><span class="ident" id="7519233">Now</span><span class="op" id="7519236">(</span><span class="op" id="7519237">)</span><span class="op" id="7519238">.</span><span class="ident" id="7519239">Add</span><span class="op" id="7519242">(</span><span class="ident" id="7519243">someTimeout</span><span class="op" id="7519254">)</span><span class="op" id="7519255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519258">c3</span><span class="op" id="7519260">.</span><span class="ident" id="7519261">SetReadBuffer</span><span class="op" id="7519274">(</span><span class="num" id="7519275">2048</span><span class="op" id="7519279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519282">c3</span><span class="op" id="7519284">.</span><span class="ident" id="7519285">SetWriteBuffer</span><span class="op" id="7519299">(</span><span class="num" id="7519300">2048</span><span class="op" id="7519304">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519308">wb</span>&nbsp;<span class="op" id="7519311">:=</span>&nbsp;<span class="op" id="7519314">[</span><span class="op" id="7519315">]</span><span class="builtintype" id="7519316">byte</span><span class="op" id="7519320">(</span><span class="string" id="7519321">&#34;UNIXCONN&nbsp;TEST&#34;</span><span class="op" id="7519336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519339">rb1</span>&nbsp;<span class="op" id="7519343">:=</span>&nbsp;<span class="builtinfunc" id="7519346">make</span><span class="op" id="7519350">(</span><span class="op" id="7519351">[</span><span class="op" id="7519352">]</span><span class="builtintype" id="7519353">byte</span><span class="op" id="7519357">,</span>&nbsp;<span class="num" id="7519359">128</span><span class="op" id="7519362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519365">rb2</span>&nbsp;<span class="op" id="7519369">:=</span>&nbsp;<span class="builtinfunc" id="7519372">make</span><span class="op" id="7519376">(</span><span class="op" id="7519377">[</span><span class="op" id="7519378">]</span><span class="builtintype" id="7519379">byte</span><span class="op" id="7519383">,</span>&nbsp;<span class="num" id="7519385">128</span><span class="op" id="7519388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519391">rb3</span>&nbsp;<span class="op" id="7519395">:=</span>&nbsp;<span class="builtinfunc" id="7519398">make</span><span class="op" id="7519402">(</span><span class="op" id="7519403">[</span><span class="op" id="7519404">]</span><span class="builtintype" id="7519405">byte</span><span class="op" id="7519409">,</span>&nbsp;<span class="num" id="7519411">128</span><span class="op" id="7519414">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519417">if</span>&nbsp;<span class="ident" id="7519420">_</span><span class="op" id="7519421">,</span>&nbsp;<span class="ident" id="7519423">_</span><span class="op" id="7519424">,</span>&nbsp;<span class="ident" id="7519426">err</span>&nbsp;<span class="op" id="7519430">:=</span>&nbsp;<span class="ident" id="7519433">c1</span><span class="op" id="7519435">.</span><span class="ident" id="7519436">WriteMsgUnix</span><span class="op" id="7519448">(</span><span class="ident" id="7519449">wb</span><span class="op" id="7519451">,</span>&nbsp;<span class="ident" id="7519453">nil</span><span class="op" id="7519456">,</span>&nbsp;<span class="ident" id="7519458">a2</span><span class="op" id="7519460">)</span><span class="op" id="7519461">;</span>&nbsp;<span class="ident" id="7519463">err</span>&nbsp;<span class="op" id="7519467">!=</span>&nbsp;<span class="ident" id="7519470">nil</span>&nbsp;<span class="op" id="7519474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519478">t</span><span class="op" id="7519479">.</span><span class="ident" id="7519480">Fatalf</span><span class="op" id="7519486">(</span><span class="string" id="7519487">&#34;UnixConn.WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7519521">,</span>&nbsp;<span class="ident" id="7519523">err</span><span class="op" id="7519526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519532">if</span>&nbsp;<span class="ident" id="7519535">_</span><span class="op" id="7519536">,</span>&nbsp;<span class="ident" id="7519538">_</span><span class="op" id="7519539">,</span>&nbsp;<span class="ident" id="7519541">_</span><span class="op" id="7519542">,</span>&nbsp;<span class="ident" id="7519544">_</span><span class="op" id="7519545">,</span>&nbsp;<span class="ident" id="7519547">err</span>&nbsp;<span class="op" id="7519551">:=</span>&nbsp;<span class="ident" id="7519554">c2</span><span class="op" id="7519556">.</span><span class="ident" id="7519557">ReadMsgUnix</span><span class="op" id="7519568">(</span><span class="ident" id="7519569">rb2</span><span class="op" id="7519572">,</span>&nbsp;<span class="ident" id="7519574">nil</span><span class="op" id="7519577">)</span><span class="op" id="7519578">;</span>&nbsp;<span class="ident" id="7519580">err</span>&nbsp;<span class="op" id="7519584">!=</span>&nbsp;<span class="ident" id="7519587">nil</span>&nbsp;<span class="op" id="7519591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519595">t</span><span class="op" id="7519596">.</span><span class="ident" id="7519597">Fatalf</span><span class="op" id="7519603">(</span><span class="string" id="7519604">&#34;UnixConn.ReadMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7519637">,</span>&nbsp;<span class="ident" id="7519639">err</span><span class="op" id="7519642">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519648">if</span>&nbsp;<span class="ident" id="7519651">_</span><span class="op" id="7519652">,</span>&nbsp;<span class="ident" id="7519654">err</span>&nbsp;<span class="op" id="7519658">:=</span>&nbsp;<span class="ident" id="7519661">c2</span><span class="op" id="7519663">.</span><span class="ident" id="7519664">WriteToUnix</span><span class="op" id="7519675">(</span><span class="ident" id="7519676">wb</span><span class="op" id="7519678">,</span>&nbsp;<span class="ident" id="7519680">a1</span><span class="op" id="7519682">)</span><span class="op" id="7519683">;</span>&nbsp;<span class="ident" id="7519685">err</span>&nbsp;<span class="op" id="7519689">!=</span>&nbsp;<span class="ident" id="7519692">nil</span>&nbsp;<span class="op" id="7519696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519700">t</span><span class="op" id="7519701">.</span><span class="ident" id="7519702">Fatalf</span><span class="op" id="7519708">(</span><span class="string" id="7519709">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7519742">,</span>&nbsp;<span class="ident" id="7519744">err</span><span class="op" id="7519747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519753">if</span>&nbsp;<span class="ident" id="7519756">_</span><span class="op" id="7519757">,</span>&nbsp;<span class="ident" id="7519759">_</span><span class="op" id="7519760">,</span>&nbsp;<span class="ident" id="7519762">err</span>&nbsp;<span class="op" id="7519766">:=</span>&nbsp;<span class="ident" id="7519769">c1</span><span class="op" id="7519771">.</span><span class="ident" id="7519772">ReadFromUnix</span><span class="op" id="7519784">(</span><span class="ident" id="7519785">rb1</span><span class="op" id="7519788">)</span><span class="op" id="7519789">;</span>&nbsp;<span class="ident" id="7519791">err</span>&nbsp;<span class="op" id="7519795">!=</span>&nbsp;<span class="ident" id="7519798">nil</span>&nbsp;<span class="op" id="7519802">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519806">t</span><span class="op" id="7519807">.</span><span class="ident" id="7519808">Fatalf</span><span class="op" id="7519814">(</span><span class="string" id="7519815">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7519849">,</span>&nbsp;<span class="ident" id="7519851">err</span><span class="op" id="7519854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519860">if</span>&nbsp;<span class="ident" id="7519863">_</span><span class="op" id="7519864">,</span>&nbsp;<span class="ident" id="7519866">err</span>&nbsp;<span class="op" id="7519870">:=</span>&nbsp;<span class="ident" id="7519873">c3</span><span class="op" id="7519875">.</span><span class="ident" id="7519876">WriteToUnix</span><span class="op" id="7519887">(</span><span class="ident" id="7519888">wb</span><span class="op" id="7519890">,</span>&nbsp;<span class="ident" id="7519892">a1</span><span class="op" id="7519894">)</span><span class="op" id="7519895">;</span>&nbsp;<span class="ident" id="7519897">err</span>&nbsp;<span class="op" id="7519901">!=</span>&nbsp;<span class="ident" id="7519904">nil</span>&nbsp;<span class="op" id="7519908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519912">t</span><span class="op" id="7519913">.</span><span class="ident" id="7519914">Fatalf</span><span class="op" id="7519920">(</span><span class="string" id="7519921">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7519954">,</span>&nbsp;<span class="ident" id="7519956">err</span><span class="op" id="7519959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519962">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519965">if</span>&nbsp;<span class="ident" id="7519968">_</span><span class="op" id="7519969">,</span>&nbsp;<span class="ident" id="7519971">_</span><span class="op" id="7519972">,</span>&nbsp;<span class="ident" id="7519974">err</span>&nbsp;<span class="op" id="7519978">:=</span>&nbsp;<span class="ident" id="7519981">c1</span><span class="op" id="7519983">.</span><span class="ident" id="7519984">ReadFromUnix</span><span class="op" id="7519996">(</span><span class="ident" id="7519997">rb1</span><span class="op" id="7520000">)</span><span class="op" id="7520001">;</span>&nbsp;<span class="ident" id="7520003">err</span>&nbsp;<span class="op" id="7520007">!=</span>&nbsp;<span class="ident" id="7520010">nil</span>&nbsp;<span class="op" id="7520014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520018">t</span><span class="op" id="7520019">.</span><span class="ident" id="7520020">Fatalf</span><span class="op" id="7520026">(</span><span class="string" id="7520027">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7520061">,</span>&nbsp;<span class="ident" id="7520063">err</span><span class="op" id="7520066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520072">if</span>&nbsp;<span class="ident" id="7520075">_</span><span class="op" id="7520076">,</span>&nbsp;<span class="ident" id="7520078">err</span>&nbsp;<span class="op" id="7520082">:=</span>&nbsp;<span class="ident" id="7520085">c2</span><span class="op" id="7520087">.</span><span class="ident" id="7520088">WriteToUnix</span><span class="op" id="7520099">(</span><span class="ident" id="7520100">wb</span><span class="op" id="7520102">,</span>&nbsp;<span class="ident" id="7520104">a3</span><span class="op" id="7520106">)</span><span class="op" id="7520107">;</span>&nbsp;<span class="ident" id="7520109">err</span>&nbsp;<span class="op" id="7520113">!=</span>&nbsp;<span class="ident" id="7520116">nil</span>&nbsp;<span class="op" id="7520120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520124">t</span><span class="op" id="7520125">.</span><span class="ident" id="7520126">Fatalf</span><span class="op" id="7520132">(</span><span class="string" id="7520133">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7520166">,</span>&nbsp;<span class="ident" id="7520168">err</span><span class="op" id="7520171">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520177">if</span>&nbsp;<span class="ident" id="7520180">_</span><span class="op" id="7520181">,</span>&nbsp;<span class="ident" id="7520183">_</span><span class="op" id="7520184">,</span>&nbsp;<span class="ident" id="7520186">err</span>&nbsp;<span class="op" id="7520190">:=</span>&nbsp;<span class="ident" id="7520193">c3</span><span class="op" id="7520195">.</span><span class="ident" id="7520196">ReadFromUnix</span><span class="op" id="7520208">(</span><span class="ident" id="7520209">rb3</span><span class="op" id="7520212">)</span><span class="op" id="7520213">;</span>&nbsp;<span class="ident" id="7520215">err</span>&nbsp;<span class="op" id="7520219">!=</span>&nbsp;<span class="ident" id="7520222">nil</span>&nbsp;<span class="op" id="7520226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520230">t</span><span class="op" id="7520231">.</span><span class="ident" id="7520232">Fatalf</span><span class="op" id="7520238">(</span><span class="string" id="7520239">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7520273">,</span>&nbsp;<span class="ident" id="7520275">err</span><span class="op" id="7520278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520285">if</span>&nbsp;<span class="ident" id="7520288">f</span><span class="op" id="7520289">,</span>&nbsp;<span class="ident" id="7520291">err</span>&nbsp;<span class="op" id="7520295">:=</span>&nbsp;<span class="ident" id="7520298">c1</span><span class="op" id="7520300">.</span><span class="ident" id="7520301">File</span><span class="op" id="7520305">(</span><span class="op" id="7520306">)</span><span class="op" id="7520307">;</span>&nbsp;<span class="ident" id="7520309">err</span>&nbsp;<span class="op" id="7520313">!=</span>&nbsp;<span class="ident" id="7520316">nil</span>&nbsp;<span class="op" id="7520320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520324">t</span><span class="op" id="7520325">.</span><span class="ident" id="7520326">Fatalf</span><span class="op" id="7520332">(</span><span class="string" id="7520333">&#34;UnixConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7520359">,</span>&nbsp;<span class="ident" id="7520361">err</span><span class="op" id="7520364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520367">}</span>&nbsp;<span class="keyword" id="7520369">else</span>&nbsp;<span class="op" id="7520374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520378">f</span><span class="op" id="7520379">.</span><span class="ident" id="7520380">Close</span><span class="op" id="7520385">(</span><span class="op" id="7520386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520389">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520393">defer</span>&nbsp;<span class="keyword" id="7520399">func</span><span class="op" id="7520403">(</span><span class="op" id="7520404">)</span>&nbsp;<span class="op" id="7520406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520410">if</span>&nbsp;<span class="ident" id="7520413">p</span>&nbsp;<span class="op" id="7520415">:=</span>&nbsp;<span class="builtinfunc" id="7520418">recover</span><span class="op" id="7520425">(</span><span class="op" id="7520426">)</span><span class="op" id="7520427">;</span>&nbsp;<span class="ident" id="7520429">p</span>&nbsp;<span class="op" id="7520431">!=</span>&nbsp;<span class="ident" id="7520434">nil</span>&nbsp;<span class="op" id="7520438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520443">t</span><span class="op" id="7520444">.</span><span class="ident" id="7520445">Fatalf</span><span class="op" id="7520451">(</span><span class="string" id="7520452">&#34;UnixConn.WriteToUnix&nbsp;or&nbsp;WriteMsgUnix&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7520503">,</span>&nbsp;<span class="ident" id="7520505">p</span><span class="op" id="7520506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520510">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520513">}</span><span class="op" id="7520514">(</span><span class="op" id="7520515">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520519">c1</span><span class="op" id="7520521">.</span><span class="ident" id="7520522">WriteToUnix</span><span class="op" id="7520533">(</span><span class="ident" id="7520534">wb</span><span class="op" id="7520536">,</span>&nbsp;<span class="ident" id="7520538">nil</span><span class="op" id="7520541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520544">c1</span><span class="op" id="7520546">.</span><span class="ident" id="7520547">WriteMsgUnix</span><span class="op" id="7520559">(</span><span class="ident" id="7520560">wb</span><span class="op" id="7520562">,</span>&nbsp;<span class="ident" id="7520564">nil</span><span class="op" id="7520567">,</span>&nbsp;<span class="ident" id="7520569">nil</span><span class="op" id="7520572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520575">c3</span><span class="op" id="7520577">.</span><span class="ident" id="7520578">WriteToUnix</span><span class="op" id="7520589">(</span><span class="ident" id="7520590">wb</span><span class="op" id="7520592">,</span>&nbsp;<span class="ident" id="7520594">nil</span><span class="op" id="7520597">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520600">c3</span><span class="op" id="7520602">.</span><span class="ident" id="7520603">WriteMsgUnix</span><span class="op" id="7520615">(</span><span class="ident" id="7520616">wb</span><span class="op" id="7520618">,</span>&nbsp;<span class="ident" id="7520620">nil</span><span class="op" id="7520623">,</span>&nbsp;<span class="ident" id="7520625">nil</span><span class="op" id="7520628">)</span><br>
<span class="lineno"></span><span class="op" id="7520630">}</span>
</div>
</body>
</html>
