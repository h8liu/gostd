<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5105462">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5105518">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5105572">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5105623">package</span>&nbsp;<span class="ident" id="5105631">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5105642">import</span>&nbsp;<span class="op" id="5105649">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5105652">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5105661">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5105668">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5105673">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5105676">//&nbsp;A&nbsp;Writer&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="5105731">//&nbsp;requests&nbsp;or&nbsp;responses&nbsp;to&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">15</span><span class="keyword" id="5105795">type</span>&nbsp;<span class="ident" id="5105800">Writer</span>&nbsp;<span class="keyword" id="5105807">struct</span>&nbsp;<span class="op" id="5105814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105817">W</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5105821">*</span><span class="ident" id="5105822">bufio</span><span class="op" id="5105827">.</span><span class="ident" id="5105828">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105836">dot</span>&nbsp;<span class="op" id="5105840">*</span><span class="ident" id="5105841">dotWriter</span><br>
<span class="lineno"></span><span class="op" id="5105851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5105854">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5105902">func</span>&nbsp;<span class="ident" id="5105907">NewWriter</span><span class="op" id="5105916">(</span><span class="ident" id="5105917">w</span>&nbsp;<span class="op" id="5105919">*</span><span class="ident" id="5105920">bufio</span><span class="op" id="5105925">.</span><span class="ident" id="5105926">Writer</span><span class="op" id="5105932">)</span>&nbsp;<span class="op" id="5105934">*</span><span class="ident" id="5105935">Writer</span>&nbsp;<span class="op" id="5105942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105945">return</span>&nbsp;<span class="op" id="5105952">&amp;</span><span class="ident" id="5105953">Writer</span><span class="op" id="5105959">{</span><span class="ident" id="5105960">W</span><span class="op" id="5105961">:</span>&nbsp;<span class="ident" id="5105963">w</span><span class="op" id="5105964">}</span><br>
<span class="lineno"></span><span class="op" id="5105966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5105969">var</span>&nbsp;<span class="ident" id="5105973">crnl</span>&nbsp;<span class="op" id="5105978">=</span>&nbsp;<span class="op" id="5105980">[</span><span class="op" id="5105981">]</span><span class="builtintype" id="5105982">byte</span><span class="op" id="5105986">{</span><span class="string" id="5105987">&#39;\r&#39;</span><span class="op" id="5105991">,</span>&nbsp;<span class="string" id="5105993">&#39;\n&#39;</span><span class="op" id="5105997">}</span><br>
<span class="lineno"></span><span class="keyword" id="5105999">var</span>&nbsp;<span class="ident" id="5106003">dotcrnl</span>&nbsp;<span class="op" id="5106011">=</span>&nbsp;<span class="op" id="5106013">[</span><span class="op" id="5106014">]</span><span class="builtintype" id="5106015">byte</span><span class="op" id="5106019">{</span><span class="string" id="5106020">&#39;.&#39;</span><span class="op" id="5106023">,</span>&nbsp;<span class="string" id="5106025">&#39;\r&#39;</span><span class="op" id="5106029">,</span>&nbsp;<span class="string" id="5106031">&#39;\n&#39;</span><span class="op" id="5106035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5106038">//&nbsp;PrintfLine&nbsp;writes&nbsp;the&nbsp;formatted&nbsp;output&nbsp;followed&nbsp;by&nbsp;\r\n.</span><br>
<span class="lineno"></span><span class="keyword" id="5106098">func</span>&nbsp;<span class="op" id="5106103">(</span><span class="ident" id="5106104">w</span>&nbsp;<span class="op" id="5106106">*</span><span class="ident" id="5106107">Writer</span><span class="op" id="5106113">)</span>&nbsp;<span class="ident" id="5106115">PrintfLine</span><span class="op" id="5106125">(</span><span class="ident" id="5106126">format</span>&nbsp;<span class="builtintype" id="5106133">string</span><span class="op" id="5106139">,</span>&nbsp;<span class="ident" id="5106141">args</span>&nbsp;<span class="op" id="5106146">...</span><span class="keyword" id="5106149">interface</span><span class="op" id="5106158">{</span><span class="op" id="5106159">}</span><span class="op" id="5106160">)</span>&nbsp;<span class="builtintype" id="5106162">error</span>&nbsp;<span class="op" id="5106168">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106171">w</span><span class="op" id="5106172">.</span><span class="ident" id="5106173">closeDot</span><span class="op" id="5106181">(</span><span class="op" id="5106182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106185">fmt</span><span class="op" id="5106188">.</span><span class="ident" id="5106189">Fprintf</span><span class="op" id="5106196">(</span><span class="ident" id="5106197">w</span><span class="op" id="5106198">.</span><span class="ident" id="5106199">W</span><span class="op" id="5106200">,</span>&nbsp;<span class="ident" id="5106202">format</span><span class="op" id="5106208">,</span>&nbsp;<span class="ident" id="5106210">args</span><span class="op" id="5106214">...</span><span class="op" id="5106217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106220">w</span><span class="op" id="5106221">.</span><span class="ident" id="5106222">W</span><span class="op" id="5106223">.</span><span class="ident" id="5106224">Write</span><span class="op" id="5106229">(</span><span class="ident" id="5106230">crnl</span><span class="op" id="5106234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106237">return</span>&nbsp;<span class="ident" id="5106244">w</span><span class="op" id="5106245">.</span><span class="ident" id="5106246">W</span><span class="op" id="5106247">.</span><span class="ident" id="5106248">Flush</span><span class="op" id="5106253">(</span><span class="op" id="5106254">)</span><br>
<span class="lineno"></span><span class="op" id="5106256">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="5106259">//&nbsp;DotWriter&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;a&nbsp;dot-encoding&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5106336">//&nbsp;It&nbsp;takes&nbsp;care&nbsp;of&nbsp;inserting&nbsp;leading&nbsp;dots&nbsp;when&nbsp;necessary,</span><br>
<span class="lineno"></span><span class="comment" id="5106395">//&nbsp;translating&nbsp;line-ending&nbsp;\n&nbsp;into&nbsp;\r\n,&nbsp;and&nbsp;adding&nbsp;the&nbsp;final&nbsp;.\r\n&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5106468">//&nbsp;when&nbsp;the&nbsp;DotWriter&nbsp;is&nbsp;closed.&nbsp;&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="5106530">//&nbsp;DotWriter&nbsp;before&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5106582">//</span><br>
<span class="lineno"></span><span class="comment" id="5106585">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Reader&#39;s&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5106672">func</span>&nbsp;<span class="op" id="5106677">(</span><span class="ident" id="5106678">w</span>&nbsp;<span class="op" id="5106680">*</span><span class="ident" id="5106681">Writer</span><span class="op" id="5106687">)</span>&nbsp;<span class="ident" id="5106689">DotWriter</span><span class="op" id="5106698">(</span><span class="op" id="5106699">)</span>&nbsp;<span class="ident" id="5106701">io</span><span class="op" id="5106703">.</span><span class="ident" id="5106704">WriteCloser</span>&nbsp;<span class="op" id="5106716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106719">w</span><span class="op" id="5106720">.</span><span class="ident" id="5106721">closeDot</span><span class="op" id="5106729">(</span><span class="op" id="5106730">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106733">w</span><span class="op" id="5106734">.</span><span class="ident" id="5106735">dot</span>&nbsp;<span class="op" id="5106739">=</span>&nbsp;<span class="op" id="5106741">&amp;</span><span class="ident" id="5106742">dotWriter</span><span class="op" id="5106751">{</span><span class="ident" id="5106752">w</span><span class="op" id="5106753">:</span>&nbsp;<span class="ident" id="5106755">w</span><span class="op" id="5106756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106759">return</span>&nbsp;<span class="ident" id="5106766">w</span><span class="op" id="5106767">.</span><span class="ident" id="5106768">dot</span><br>
<span class="lineno"></span><span class="op" id="5106772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5106775">func</span>&nbsp;<span class="op" id="5106780">(</span><span class="ident" id="5106781">w</span>&nbsp;<span class="op" id="5106783">*</span><span class="ident" id="5106784">Writer</span><span class="op" id="5106790">)</span>&nbsp;<span class="ident" id="5106792">closeDot</span><span class="op" id="5106800">(</span><span class="op" id="5106801">)</span>&nbsp;<span class="op" id="5106803">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106806">if</span>&nbsp;<span class="ident" id="5106809">w</span><span class="op" id="5106810">.</span><span class="ident" id="5106811">dot</span>&nbsp;<span class="op" id="5106815">!=</span>&nbsp;<span class="ident" id="5106818">nil</span>&nbsp;<span class="op" id="5106822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106826">w</span><span class="op" id="5106827">.</span><span class="ident" id="5106828">dot</span><span class="op" id="5106831">.</span><span class="ident" id="5106832">Close</span><span class="op" id="5106837">(</span><span class="op" id="5106838">)</span>&nbsp;<span class="comment" id="5106840">//&nbsp;sets&nbsp;w.dot&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5106861">}</span><br>
<span class="lineno"></span><span class="op" id="5106863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5106866">type</span>&nbsp;<span class="ident" id="5106871">dotWriter</span>&nbsp;<span class="keyword" id="5106881">struct</span>&nbsp;<span class="op" id="5106888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106891">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5106897">*</span><span class="ident" id="5106898">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106906">state</span>&nbsp;<span class="builtintype" id="5106912">int</span><br>
<span class="lineno"></span><span class="op" id="5106916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="5106919">const</span>&nbsp;<span class="op" id="5106925">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106928">wstateBeginLine</span>&nbsp;<span class="op" id="5106944">=</span>&nbsp;<span class="ident" id="5106946">iota</span>&nbsp;<span class="comment" id="5106951">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107002">wstateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5107025">//&nbsp;wrote&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107064">wstateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5107087">//&nbsp;writing&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span><span class="op" id="5107121">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="5107124">func</span>&nbsp;<span class="op" id="5107129">(</span><span class="ident" id="5107130">d</span>&nbsp;<span class="op" id="5107132">*</span><span class="ident" id="5107133">dotWriter</span><span class="op" id="5107142">)</span>&nbsp;<span class="ident" id="5107144">Write</span><span class="op" id="5107149">(</span><span class="ident" id="5107150">b</span>&nbsp;<span class="op" id="5107152">[</span><span class="op" id="5107153">]</span><span class="builtintype" id="5107154">byte</span><span class="op" id="5107158">)</span>&nbsp;<span class="op" id="5107160">(</span><span class="ident" id="5107161">n</span>&nbsp;<span class="builtintype" id="5107163">int</span><span class="op" id="5107166">,</span>&nbsp;<span class="ident" id="5107168">err</span>&nbsp;<span class="builtintype" id="5107172">error</span><span class="op" id="5107177">)</span>&nbsp;<span class="op" id="5107179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107182">bw</span>&nbsp;<span class="op" id="5107185">:=</span>&nbsp;<span class="ident" id="5107188">d</span><span class="op" id="5107189">.</span><span class="ident" id="5107190">w</span><span class="op" id="5107191">.</span><span class="ident" id="5107192">W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107195">for</span>&nbsp;<span class="ident" id="5107199">n</span>&nbsp;<span class="op" id="5107201">&lt;</span>&nbsp;<span class="builtinfunc" id="5107203">len</span><span class="op" id="5107206">(</span><span class="ident" id="5107207">b</span><span class="op" id="5107208">)</span>&nbsp;<span class="op" id="5107210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107214">c</span>&nbsp;<span class="op" id="5107216">:=</span>&nbsp;<span class="ident" id="5107219">b</span><span class="op" id="5107220">[</span><span class="ident" id="5107221">n</span><span class="op" id="5107222">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107226">switch</span>&nbsp;<span class="ident" id="5107233">d</span><span class="op" id="5107234">.</span><span class="ident" id="5107235">state</span>&nbsp;<span class="op" id="5107241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107245">case</span>&nbsp;<span class="ident" id="5107250">wstateBeginLine</span><span class="op" id="5107265">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107270">d</span><span class="op" id="5107271">.</span><span class="ident" id="5107272">state</span>&nbsp;<span class="op" id="5107278">=</span>&nbsp;<span class="ident" id="5107280">wstateData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107294">if</span>&nbsp;<span class="ident" id="5107297">c</span>&nbsp;<span class="op" id="5107299">==</span>&nbsp;<span class="string" id="5107302">&#39;.&#39;</span>&nbsp;<span class="op" id="5107306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107312">//&nbsp;escape&nbsp;leading&nbsp;dot</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107338">bw</span><span class="op" id="5107340">.</span><span class="ident" id="5107341">WriteByte</span><span class="op" id="5107350">(</span><span class="string" id="5107351">&#39;.&#39;</span><span class="op" id="5107354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107364">fallthrough</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107379">case</span>&nbsp;<span class="ident" id="5107384">wstateData</span><span class="op" id="5107394">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107399">if</span>&nbsp;<span class="ident" id="5107402">c</span>&nbsp;<span class="op" id="5107404">==</span>&nbsp;<span class="string" id="5107407">&#39;\r&#39;</span>&nbsp;<span class="op" id="5107412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107418">d</span><span class="op" id="5107419">.</span><span class="ident" id="5107420">state</span>&nbsp;<span class="op" id="5107426">=</span>&nbsp;<span class="ident" id="5107428">wstateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107445">if</span>&nbsp;<span class="ident" id="5107448">c</span>&nbsp;<span class="op" id="5107450">==</span>&nbsp;<span class="string" id="5107453">&#39;\n&#39;</span>&nbsp;<span class="op" id="5107458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107464">bw</span><span class="op" id="5107466">.</span><span class="ident" id="5107467">WriteByte</span><span class="op" id="5107476">(</span><span class="string" id="5107477">&#39;\r&#39;</span><span class="op" id="5107481">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107487">d</span><span class="op" id="5107488">.</span><span class="ident" id="5107489">state</span>&nbsp;<span class="op" id="5107495">=</span>&nbsp;<span class="ident" id="5107497">wstateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107521">case</span>&nbsp;<span class="ident" id="5107526">wstateCR</span><span class="op" id="5107534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107539">d</span><span class="op" id="5107540">.</span><span class="ident" id="5107541">state</span>&nbsp;<span class="op" id="5107547">=</span>&nbsp;<span class="ident" id="5107549">wstateData</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107563">if</span>&nbsp;<span class="ident" id="5107566">c</span>&nbsp;<span class="op" id="5107568">==</span>&nbsp;<span class="string" id="5107571">&#39;\n&#39;</span>&nbsp;<span class="op" id="5107576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107582">d</span><span class="op" id="5107583">.</span><span class="ident" id="5107584">state</span>&nbsp;<span class="op" id="5107590">=</span>&nbsp;<span class="ident" id="5107592">wstateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107619">if</span>&nbsp;<span class="ident" id="5107622">err</span>&nbsp;<span class="op" id="5107626">=</span>&nbsp;<span class="ident" id="5107628">bw</span><span class="op" id="5107630">.</span><span class="ident" id="5107631">WriteByte</span><span class="op" id="5107640">(</span><span class="ident" id="5107641">c</span><span class="op" id="5107642">)</span><span class="op" id="5107643">;</span>&nbsp;<span class="ident" id="5107645">err</span>&nbsp;<span class="op" id="5107649">!=</span>&nbsp;<span class="ident" id="5107652">nil</span>&nbsp;<span class="op" id="5107656">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107661">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107673">n</span><span class="op" id="5107674">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107681">return</span><br>
<span class="lineno">100</span><span class="op" id="5107688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5107691">func</span>&nbsp;<span class="op" id="5107696">(</span><span class="ident" id="5107697">d</span>&nbsp;<span class="op" id="5107699">*</span><span class="ident" id="5107700">dotWriter</span><span class="op" id="5107709">)</span>&nbsp;<span class="ident" id="5107711">Close</span><span class="op" id="5107716">(</span><span class="op" id="5107717">)</span>&nbsp;<span class="builtintype" id="5107719">error</span>&nbsp;<span class="op" id="5107725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107728">if</span>&nbsp;<span class="ident" id="5107731">d</span><span class="op" id="5107732">.</span><span class="ident" id="5107733">w</span><span class="op" id="5107734">.</span><span class="ident" id="5107735">dot</span>&nbsp;<span class="op" id="5107739">==</span>&nbsp;<span class="ident" id="5107742">d</span>&nbsp;<span class="op" id="5107744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107748">d</span><span class="op" id="5107749">.</span><span class="ident" id="5107750">w</span><span class="op" id="5107751">.</span><span class="ident" id="5107752">dot</span>&nbsp;<span class="op" id="5107756">=</span>&nbsp;<span class="ident" id="5107758">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107766">bw</span>&nbsp;<span class="op" id="5107769">:=</span>&nbsp;<span class="ident" id="5107772">d</span><span class="op" id="5107773">.</span><span class="ident" id="5107774">w</span><span class="op" id="5107775">.</span><span class="ident" id="5107776">W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107779">switch</span>&nbsp;<span class="ident" id="5107786">d</span><span class="op" id="5107787">.</span><span class="ident" id="5107788">state</span>&nbsp;<span class="op" id="5107794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107797">default</span><span class="op" id="5107804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107808">bw</span><span class="op" id="5107810">.</span><span class="ident" id="5107811">WriteByte</span><span class="op" id="5107820">(</span><span class="string" id="5107821">&#39;\r&#39;</span><span class="op" id="5107825">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107829">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107842">case</span>&nbsp;<span class="ident" id="5107847">wstateCR</span><span class="op" id="5107855">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107859">bw</span><span class="op" id="5107861">.</span><span class="ident" id="5107862">WriteByte</span><span class="op" id="5107871">(</span><span class="string" id="5107872">&#39;\n&#39;</span><span class="op" id="5107876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107880">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107893">case</span>&nbsp;<span class="ident" id="5107898">wstateBeginLine</span><span class="op" id="5107913">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107917">bw</span><span class="op" id="5107919">.</span><span class="ident" id="5107920">Write</span><span class="op" id="5107925">(</span><span class="ident" id="5107926">dotcrnl</span><span class="op" id="5107933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107939">return</span>&nbsp;<span class="ident" id="5107946">bw</span><span class="op" id="5107948">.</span><span class="ident" id="5107949">Flush</span><span class="op" id="5107954">(</span><span class="op" id="5107955">)</span><br>
<span class="lineno"></span><span class="op" id="5107957">}</span>
</div>
</body>
</html>
