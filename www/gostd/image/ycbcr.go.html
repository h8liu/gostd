<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5620641">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5620696">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5620750">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5620801">package</span>&nbsp;<span class="ident" id="5620809">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5620816">import</span>&nbsp;<span class="op" id="5620823">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5620826">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5620840">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5620843">//&nbsp;YCbCrSubsampleRatio&nbsp;is&nbsp;the&nbsp;chroma&nbsp;subsample&nbsp;ratio&nbsp;used&nbsp;in&nbsp;a&nbsp;YCbCr&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5620919">type</span>&nbsp;<span class="ident" id="5620924">YCbCrSubsampleRatio</span>&nbsp;<span class="builtintype" id="5620944">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5620949">const</span>&nbsp;<span class="op" id="5620955">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5620958">YCbCrSubsampleRatio444</span>&nbsp;<span class="ident" id="5620981">YCbCrSubsampleRatio</span>&nbsp;<span class="op" id="5621001">=</span>&nbsp;<span class="ident" id="5621003">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5621009">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5621033">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5621057">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span><span class="op" id="5621080">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5621083">func</span>&nbsp;<span class="op" id="5621088">(</span><span class="ident" id="5621089">s</span>&nbsp;<span class="ident" id="5621091">YCbCrSubsampleRatio</span><span class="op" id="5621110">)</span>&nbsp;<span class="ident" id="5621112">String</span><span class="op" id="5621118">(</span><span class="op" id="5621119">)</span>&nbsp;<span class="builtintype" id="5621121">string</span>&nbsp;<span class="op" id="5621128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5621131">switch</span>&nbsp;<span class="ident" id="5621138">s</span>&nbsp;<span class="op" id="5621140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5621143">case</span>&nbsp;<span class="ident" id="5621148">YCbCrSubsampleRatio444</span><span class="op" id="5621170">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5621174">return</span>&nbsp;<span class="string" id="5621181">&#34;YCbCrSubsampleRatio444&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5621207">case</span>&nbsp;<span class="ident" id="5621212">YCbCrSubsampleRatio422</span><span class="op" id="5621234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5621238">return</span>&nbsp;<span class="string" id="5621245">&#34;YCbCrSubsampleRatio422&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5621271">case</span>&nbsp;<span class="ident" id="5621276">YCbCrSubsampleRatio420</span><span class="op" id="5621298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5621302">return</span>&nbsp;<span class="string" id="5621309">&#34;YCbCrSubsampleRatio420&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5621335">case</span>&nbsp;<span class="ident" id="5621340">YCbCrSubsampleRatio440</span><span class="op" id="5621362">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5621366">return</span>&nbsp;<span class="string" id="5621373">&#34;YCbCrSubsampleRatio440&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5621399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5621402">return</span>&nbsp;<span class="string" id="5621409">&#34;YCbCrSubsampleRatioUnknown&#34;</span><br>
<span class="lineno"></span><span class="op" id="5621438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5621441">//&nbsp;YCbCr&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;Y&#39;CbCr&nbsp;colors.&nbsp;There&nbsp;is&nbsp;one&nbsp;Y&nbsp;sample&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="5621516">//&nbsp;pixel,&nbsp;but&nbsp;each&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;sample&nbsp;can&nbsp;span&nbsp;one&nbsp;or&nbsp;more&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="5621581">//&nbsp;YStride&nbsp;is&nbsp;the&nbsp;Y&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="5621655">//&nbsp;CStride&nbsp;is&nbsp;the&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels</span><br>
<span class="lineno"></span><span class="comment" id="5621736">//&nbsp;that&nbsp;map&nbsp;to&nbsp;separate&nbsp;chroma&nbsp;samples.</span><br>
<span class="lineno">40</span><span class="comment" id="5621776">//&nbsp;It&nbsp;is&nbsp;not&nbsp;an&nbsp;absolute&nbsp;requirement,&nbsp;but&nbsp;YStride&nbsp;and&nbsp;len(Y)&nbsp;are&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="5621851">//&nbsp;multiples&nbsp;of&nbsp;8,&nbsp;and:</span><br>
<span class="lineno"></span><span class="comment" id="5621875">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:4:4,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/1.</span><br>
<span class="lineno"></span><span class="comment" id="5621945">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:2:2,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="comment" id="5622015">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:2:0,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/4.</span><br>
<span class="lineno">45</span><span class="comment" id="5622085">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:4:0,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="keyword" id="5622155">type</span>&nbsp;<span class="ident" id="5622160">YCbCr</span>&nbsp;<span class="keyword" id="5622166">struct</span>&nbsp;<span class="op" id="5622173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5622176">Y</span><span class="op" id="5622177">,</span>&nbsp;<span class="ident" id="5622179">Cb</span><span class="op" id="5622181">,</span>&nbsp;<span class="ident" id="5622183">Cr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5622191">[</span><span class="op" id="5622192">]</span><span class="builtintype" id="5622193">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5622200">YStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5622215">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5622220">CStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5622235">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5622240">SubsampleRatio</span>&nbsp;<span class="ident" id="5622255">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5622276">Rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622291">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5622301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5622304">func</span>&nbsp;<span class="op" id="5622309">(</span><span class="ident" id="5622310">p</span>&nbsp;<span class="op" id="5622312">*</span><span class="ident" id="5622313">YCbCr</span><span class="op" id="5622318">)</span>&nbsp;<span class="ident" id="5622320">ColorModel</span><span class="op" id="5622330">(</span><span class="op" id="5622331">)</span>&nbsp;<span class="ident" id="5622333">color</span><span class="op" id="5622338">.</span><span class="ident" id="5622339">Model</span>&nbsp;<span class="op" id="5622345">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5622348">return</span>&nbsp;<span class="ident" id="5622355">color</span><span class="op" id="5622360">.</span><span class="ident" id="5622361">YCbCrModel</span><br>
<span class="lineno"></span><span class="op" id="5622372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5622375">func</span>&nbsp;<span class="op" id="5622380">(</span><span class="ident" id="5622381">p</span>&nbsp;<span class="op" id="5622383">*</span><span class="ident" id="5622384">YCbCr</span><span class="op" id="5622389">)</span>&nbsp;<span class="ident" id="5622391">Bounds</span><span class="op" id="5622397">(</span><span class="op" id="5622398">)</span>&nbsp;<span class="ident" id="5622400">Rectangle</span>&nbsp;<span class="op" id="5622410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5622413">return</span>&nbsp;<span class="ident" id="5622420">p</span><span class="op" id="5622421">.</span><span class="ident" id="5622422">Rect</span><br>
<span class="lineno">60</span><span class="op" id="5622427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5622430">func</span>&nbsp;<span class="op" id="5622435">(</span><span class="ident" id="5622436">p</span>&nbsp;<span class="op" id="5622438">*</span><span class="ident" id="5622439">YCbCr</span><span class="op" id="5622444">)</span>&nbsp;<span class="ident" id="5622446">At</span><span class="op" id="5622448">(</span><span class="ident" id="5622449">x</span><span class="op" id="5622450">,</span>&nbsp;<span class="ident" id="5622452">y</span>&nbsp;<span class="builtintype" id="5622454">int</span><span class="op" id="5622457">)</span>&nbsp;<span class="ident" id="5622459">color</span><span class="op" id="5622464">.</span><span class="ident" id="5622465">Color</span>&nbsp;<span class="op" id="5622471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5622474">return</span>&nbsp;<span class="ident" id="5622481">p</span><span class="op" id="5622482">.</span><span class="ident" id="5622483">YCbCrAt</span><span class="op" id="5622490">(</span><span class="ident" id="5622491">x</span><span class="op" id="5622492">,</span>&nbsp;<span class="ident" id="5622494">y</span><span class="op" id="5622495">)</span><br>
<span class="lineno"></span><span class="op" id="5622497">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="5622500">func</span>&nbsp;<span class="op" id="5622505">(</span><span class="ident" id="5622506">p</span>&nbsp;<span class="op" id="5622508">*</span><span class="ident" id="5622509">YCbCr</span><span class="op" id="5622514">)</span>&nbsp;<span class="ident" id="5622516">YCbCrAt</span><span class="op" id="5622523">(</span><span class="ident" id="5622524">x</span><span class="op" id="5622525">,</span>&nbsp;<span class="ident" id="5622527">y</span>&nbsp;<span class="builtintype" id="5622529">int</span><span class="op" id="5622532">)</span>&nbsp;<span class="ident" id="5622534">color</span><span class="op" id="5622539">.</span><span class="ident" id="5622540">YCbCr</span>&nbsp;<span class="op" id="5622546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5622549">if</span>&nbsp;<span class="op" id="5622552">!</span><span class="op" id="5622553">(</span><span class="ident" id="5622554">Point</span><span class="op" id="5622559">{</span><span class="ident" id="5622560">x</span><span class="op" id="5622561">,</span>&nbsp;<span class="ident" id="5622563">y</span><span class="op" id="5622564">}</span><span class="op" id="5622565">.</span><span class="ident" id="5622566">In</span><span class="op" id="5622568">(</span><span class="ident" id="5622569">p</span><span class="op" id="5622570">.</span><span class="ident" id="5622571">Rect</span><span class="op" id="5622575">)</span><span class="op" id="5622576">)</span>&nbsp;<span class="op" id="5622578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5622582">return</span>&nbsp;<span class="ident" id="5622589">color</span><span class="op" id="5622594">.</span><span class="ident" id="5622595">YCbCr</span><span class="op" id="5622600">{</span><span class="op" id="5622601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5622604">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5622607">yi</span>&nbsp;<span class="op" id="5622610">:=</span>&nbsp;<span class="ident" id="5622613">p</span><span class="op" id="5622614">.</span><span class="ident" id="5622615">YOffset</span><span class="op" id="5622622">(</span><span class="ident" id="5622623">x</span><span class="op" id="5622624">,</span>&nbsp;<span class="ident" id="5622626">y</span><span class="op" id="5622627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5622630">ci</span>&nbsp;<span class="op" id="5622633">:=</span>&nbsp;<span class="ident" id="5622636">p</span><span class="op" id="5622637">.</span><span class="ident" id="5622638">COffset</span><span class="op" id="5622645">(</span><span class="ident" id="5622646">x</span><span class="op" id="5622647">,</span>&nbsp;<span class="ident" id="5622649">y</span><span class="op" id="5622650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5622653">return</span>&nbsp;<span class="ident" id="5622660">color</span><span class="op" id="5622665">.</span><span class="ident" id="5622666">YCbCr</span><span class="op" id="5622671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5622675">p</span><span class="op" id="5622676">.</span><span class="ident" id="5622677">Y</span><span class="op" id="5622678">[</span><span class="ident" id="5622679">yi</span><span class="op" id="5622681">]</span><span class="op" id="5622682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5622686">p</span><span class="op" id="5622687">.</span><span class="ident" id="5622688">Cb</span><span class="op" id="5622690">[</span><span class="ident" id="5622691">ci</span><span class="op" id="5622693">]</span><span class="op" id="5622694">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5622698">p</span><span class="op" id="5622699">.</span><span class="ident" id="5622700">Cr</span><span class="op" id="5622702">[</span><span class="ident" id="5622703">ci</span><span class="op" id="5622705">]</span><span class="op" id="5622706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5622709">}</span><br>
<span class="lineno"></span><span class="op" id="5622711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5622714">//&nbsp;YOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Y&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">80</span><span class="comment" id="5622789">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5622813">func</span>&nbsp;<span class="op" id="5622818">(</span><span class="ident" id="5622819">p</span>&nbsp;<span class="op" id="5622821">*</span><span class="ident" id="5622822">YCbCr</span><span class="op" id="5622827">)</span>&nbsp;<span class="ident" id="5622829">YOffset</span><span class="op" id="5622836">(</span><span class="ident" id="5622837">x</span><span class="op" id="5622838">,</span>&nbsp;<span class="ident" id="5622840">y</span>&nbsp;<span class="builtintype" id="5622842">int</span><span class="op" id="5622845">)</span>&nbsp;<span class="builtintype" id="5622847">int</span>&nbsp;<span class="op" id="5622851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5622854">return</span>&nbsp;<span class="op" id="5622861">(</span><span class="ident" id="5622862">y</span><span class="op" id="5622863">-</span><span class="ident" id="5622864">p</span><span class="op" id="5622865">.</span><span class="ident" id="5622866">Rect</span><span class="op" id="5622870">.</span><span class="ident" id="5622871">Min</span><span class="op" id="5622874">.</span><span class="ident" id="5622875">Y</span><span class="op" id="5622876">)</span><span class="op" id="5622877">*</span><span class="ident" id="5622878">p</span><span class="op" id="5622879">.</span><span class="ident" id="5622880">YStride</span>&nbsp;<span class="op" id="5622888">+</span>&nbsp;<span class="op" id="5622890">(</span><span class="ident" id="5622891">x</span>&nbsp;<span class="op" id="5622893">-</span>&nbsp;<span class="ident" id="5622895">p</span><span class="op" id="5622896">.</span><span class="ident" id="5622897">Rect</span><span class="op" id="5622901">.</span><span class="ident" id="5622902">Min</span><span class="op" id="5622905">.</span><span class="ident" id="5622906">X</span><span class="op" id="5622907">)</span><br>
<span class="lineno"></span><span class="op" id="5622909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5622912">//&nbsp;COffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Cb&nbsp;or&nbsp;Cr&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="5622991">//&nbsp;to&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5623018">func</span>&nbsp;<span class="op" id="5623023">(</span><span class="ident" id="5623024">p</span>&nbsp;<span class="op" id="5623026">*</span><span class="ident" id="5623027">YCbCr</span><span class="op" id="5623032">)</span>&nbsp;<span class="ident" id="5623034">COffset</span><span class="op" id="5623041">(</span><span class="ident" id="5623042">x</span><span class="op" id="5623043">,</span>&nbsp;<span class="ident" id="5623045">y</span>&nbsp;<span class="builtintype" id="5623047">int</span><span class="op" id="5623050">)</span>&nbsp;<span class="builtintype" id="5623052">int</span>&nbsp;<span class="op" id="5623056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623059">switch</span>&nbsp;<span class="ident" id="5623066">p</span><span class="op" id="5623067">.</span><span class="ident" id="5623068">SubsampleRatio</span>&nbsp;<span class="op" id="5623083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623086">case</span>&nbsp;<span class="ident" id="5623091">YCbCrSubsampleRatio422</span><span class="op" id="5623113">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623117">return</span>&nbsp;<span class="op" id="5623124">(</span><span class="ident" id="5623125">y</span><span class="op" id="5623126">-</span><span class="ident" id="5623127">p</span><span class="op" id="5623128">.</span><span class="ident" id="5623129">Rect</span><span class="op" id="5623133">.</span><span class="ident" id="5623134">Min</span><span class="op" id="5623137">.</span><span class="ident" id="5623138">Y</span><span class="op" id="5623139">)</span><span class="op" id="5623140">*</span><span class="ident" id="5623141">p</span><span class="op" id="5623142">.</span><span class="ident" id="5623143">CStride</span>&nbsp;<span class="op" id="5623151">+</span>&nbsp;<span class="op" id="5623153">(</span><span class="ident" id="5623154">x</span><span class="op" id="5623155">/</span><span class="num" id="5623156">2</span>&nbsp;<span class="op" id="5623158">-</span>&nbsp;<span class="ident" id="5623160">p</span><span class="op" id="5623161">.</span><span class="ident" id="5623162">Rect</span><span class="op" id="5623166">.</span><span class="ident" id="5623167">Min</span><span class="op" id="5623170">.</span><span class="ident" id="5623171">X</span><span class="op" id="5623172">/</span><span class="num" id="5623173">2</span><span class="op" id="5623174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623177">case</span>&nbsp;<span class="ident" id="5623182">YCbCrSubsampleRatio420</span><span class="op" id="5623204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623208">return</span>&nbsp;<span class="op" id="5623215">(</span><span class="ident" id="5623216">y</span><span class="op" id="5623217">/</span><span class="num" id="5623218">2</span><span class="op" id="5623219">-</span><span class="ident" id="5623220">p</span><span class="op" id="5623221">.</span><span class="ident" id="5623222">Rect</span><span class="op" id="5623226">.</span><span class="ident" id="5623227">Min</span><span class="op" id="5623230">.</span><span class="ident" id="5623231">Y</span><span class="op" id="5623232">/</span><span class="num" id="5623233">2</span><span class="op" id="5623234">)</span><span class="op" id="5623235">*</span><span class="ident" id="5623236">p</span><span class="op" id="5623237">.</span><span class="ident" id="5623238">CStride</span>&nbsp;<span class="op" id="5623246">+</span>&nbsp;<span class="op" id="5623248">(</span><span class="ident" id="5623249">x</span><span class="op" id="5623250">/</span><span class="num" id="5623251">2</span>&nbsp;<span class="op" id="5623253">-</span>&nbsp;<span class="ident" id="5623255">p</span><span class="op" id="5623256">.</span><span class="ident" id="5623257">Rect</span><span class="op" id="5623261">.</span><span class="ident" id="5623262">Min</span><span class="op" id="5623265">.</span><span class="ident" id="5623266">X</span><span class="op" id="5623267">/</span><span class="num" id="5623268">2</span><span class="op" id="5623269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623272">case</span>&nbsp;<span class="ident" id="5623277">YCbCrSubsampleRatio440</span><span class="op" id="5623299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623303">return</span>&nbsp;<span class="op" id="5623310">(</span><span class="ident" id="5623311">y</span><span class="op" id="5623312">/</span><span class="num" id="5623313">2</span><span class="op" id="5623314">-</span><span class="ident" id="5623315">p</span><span class="op" id="5623316">.</span><span class="ident" id="5623317">Rect</span><span class="op" id="5623321">.</span><span class="ident" id="5623322">Min</span><span class="op" id="5623325">.</span><span class="ident" id="5623326">Y</span><span class="op" id="5623327">/</span><span class="num" id="5623328">2</span><span class="op" id="5623329">)</span><span class="op" id="5623330">*</span><span class="ident" id="5623331">p</span><span class="op" id="5623332">.</span><span class="ident" id="5623333">CStride</span>&nbsp;<span class="op" id="5623341">+</span>&nbsp;<span class="op" id="5623343">(</span><span class="ident" id="5623344">x</span>&nbsp;<span class="op" id="5623346">-</span>&nbsp;<span class="ident" id="5623348">p</span><span class="op" id="5623349">.</span><span class="ident" id="5623350">Rect</span><span class="op" id="5623354">.</span><span class="ident" id="5623355">Min</span><span class="op" id="5623358">.</span><span class="ident" id="5623359">X</span><span class="op" id="5623360">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5623363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5623366">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623400">return</span>&nbsp;<span class="op" id="5623407">(</span><span class="ident" id="5623408">y</span><span class="op" id="5623409">-</span><span class="ident" id="5623410">p</span><span class="op" id="5623411">.</span><span class="ident" id="5623412">Rect</span><span class="op" id="5623416">.</span><span class="ident" id="5623417">Min</span><span class="op" id="5623420">.</span><span class="ident" id="5623421">Y</span><span class="op" id="5623422">)</span><span class="op" id="5623423">*</span><span class="ident" id="5623424">p</span><span class="op" id="5623425">.</span><span class="ident" id="5623426">CStride</span>&nbsp;<span class="op" id="5623434">+</span>&nbsp;<span class="op" id="5623436">(</span><span class="ident" id="5623437">x</span>&nbsp;<span class="op" id="5623439">-</span>&nbsp;<span class="ident" id="5623441">p</span><span class="op" id="5623442">.</span><span class="ident" id="5623443">Rect</span><span class="op" id="5623447">.</span><span class="ident" id="5623448">Min</span><span class="op" id="5623451">.</span><span class="ident" id="5623452">X</span><span class="op" id="5623453">)</span><br>
<span class="lineno"></span><span class="op" id="5623455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5623458">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5623535">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5623607">func</span>&nbsp;<span class="op" id="5623612">(</span><span class="ident" id="5623613">p</span>&nbsp;<span class="op" id="5623615">*</span><span class="ident" id="5623616">YCbCr</span><span class="op" id="5623621">)</span>&nbsp;<span class="ident" id="5623623">SubImage</span><span class="op" id="5623631">(</span><span class="ident" id="5623632">r</span>&nbsp;<span class="ident" id="5623634">Rectangle</span><span class="op" id="5623643">)</span>&nbsp;<span class="ident" id="5623645">Image</span>&nbsp;<span class="op" id="5623651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623654">r</span>&nbsp;<span class="op" id="5623656">=</span>&nbsp;<span class="ident" id="5623658">r</span><span class="op" id="5623659">.</span><span class="ident" id="5623660">Intersect</span><span class="op" id="5623669">(</span><span class="ident" id="5623670">p</span><span class="op" id="5623671">.</span><span class="ident" id="5623672">Rect</span><span class="op" id="5623676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5623679">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5623760">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5623842">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623892">if</span>&nbsp;<span class="ident" id="5623895">r</span><span class="op" id="5623896">.</span><span class="ident" id="5623897">Empty</span><span class="op" id="5623902">(</span><span class="op" id="5623903">)</span>&nbsp;<span class="op" id="5623905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5623909">return</span>&nbsp;<span class="op" id="5623916">&amp;</span><span class="ident" id="5623917">YCbCr</span><span class="op" id="5623922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623927">SubsampleRatio</span><span class="op" id="5623941">:</span>&nbsp;<span class="ident" id="5623943">p</span><span class="op" id="5623944">.</span><span class="ident" id="5623945">SubsampleRatio</span><span class="op" id="5623959">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5623963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5623966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623969">yi</span>&nbsp;<span class="op" id="5623972">:=</span>&nbsp;<span class="ident" id="5623975">p</span><span class="op" id="5623976">.</span><span class="ident" id="5623977">YOffset</span><span class="op" id="5623984">(</span><span class="ident" id="5623985">r</span><span class="op" id="5623986">.</span><span class="ident" id="5623987">Min</span><span class="op" id="5623990">.</span><span class="ident" id="5623991">X</span><span class="op" id="5623992">,</span>&nbsp;<span class="ident" id="5623994">r</span><span class="op" id="5623995">.</span><span class="ident" id="5623996">Min</span><span class="op" id="5623999">.</span><span class="ident" id="5624000">Y</span><span class="op" id="5624001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624004">ci</span>&nbsp;<span class="op" id="5624007">:=</span>&nbsp;<span class="ident" id="5624010">p</span><span class="op" id="5624011">.</span><span class="ident" id="5624012">COffset</span><span class="op" id="5624019">(</span><span class="ident" id="5624020">r</span><span class="op" id="5624021">.</span><span class="ident" id="5624022">Min</span><span class="op" id="5624025">.</span><span class="ident" id="5624026">X</span><span class="op" id="5624027">,</span>&nbsp;<span class="ident" id="5624029">r</span><span class="op" id="5624030">.</span><span class="ident" id="5624031">Min</span><span class="op" id="5624034">.</span><span class="ident" id="5624035">Y</span><span class="op" id="5624036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624039">return</span>&nbsp;<span class="op" id="5624046">&amp;</span><span class="ident" id="5624047">YCbCr</span><span class="op" id="5624052">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624056">Y</span><span class="op" id="5624057">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624072">p</span><span class="op" id="5624073">.</span><span class="ident" id="5624074">Y</span><span class="op" id="5624075">[</span><span class="ident" id="5624076">yi</span><span class="op" id="5624078">:</span><span class="op" id="5624079">]</span><span class="op" id="5624080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624084">Cb</span><span class="op" id="5624086">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624100">p</span><span class="op" id="5624101">.</span><span class="ident" id="5624102">Cb</span><span class="op" id="5624104">[</span><span class="ident" id="5624105">ci</span><span class="op" id="5624107">:</span><span class="op" id="5624108">]</span><span class="op" id="5624109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624113">Cr</span><span class="op" id="5624115">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624129">p</span><span class="op" id="5624130">.</span><span class="ident" id="5624131">Cr</span><span class="op" id="5624133">[</span><span class="ident" id="5624134">ci</span><span class="op" id="5624136">:</span><span class="op" id="5624137">]</span><span class="op" id="5624138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624142">SubsampleRatio</span><span class="op" id="5624156">:</span>&nbsp;<span class="ident" id="5624158">p</span><span class="op" id="5624159">.</span><span class="ident" id="5624160">SubsampleRatio</span><span class="op" id="5624174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624178">YStride</span><span class="op" id="5624185">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624194">p</span><span class="op" id="5624195">.</span><span class="ident" id="5624196">YStride</span><span class="op" id="5624203">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624207">CStride</span><span class="op" id="5624214">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624223">p</span><span class="op" id="5624224">.</span><span class="ident" id="5624225">CStride</span><span class="op" id="5624232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624236">Rect</span><span class="op" id="5624240">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624252">r</span><span class="op" id="5624253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5624256">}</span><br>
<span class="lineno"></span><span class="op" id="5624258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5624261">func</span>&nbsp;<span class="op" id="5624266">(</span><span class="ident" id="5624267">p</span>&nbsp;<span class="op" id="5624269">*</span><span class="ident" id="5624270">YCbCr</span><span class="op" id="5624275">)</span>&nbsp;<span class="ident" id="5624277">Opaque</span><span class="op" id="5624283">(</span><span class="op" id="5624284">)</span>&nbsp;<span class="builtintype" id="5624286">bool</span>&nbsp;<span class="op" id="5624291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624294">return</span>&nbsp;<span class="builtintype" id="5624301">true</span><br>
<span class="lineno"></span><span class="op" id="5624306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5624309">//&nbsp;NewYCbCr&nbsp;returns&nbsp;a&nbsp;new&nbsp;YCbCr&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds&nbsp;and&nbsp;subsample&nbsp;ratio.</span><br>
<span class="lineno">130</span><span class="keyword" id="5624384">func</span>&nbsp;<span class="ident" id="5624389">NewYCbCr</span><span class="op" id="5624397">(</span><span class="ident" id="5624398">r</span>&nbsp;<span class="ident" id="5624400">Rectangle</span><span class="op" id="5624409">,</span>&nbsp;<span class="ident" id="5624411">subsampleRatio</span>&nbsp;<span class="ident" id="5624426">YCbCrSubsampleRatio</span><span class="op" id="5624445">)</span>&nbsp;<span class="op" id="5624447">*</span><span class="ident" id="5624448">YCbCr</span>&nbsp;<span class="op" id="5624454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624457">w</span><span class="op" id="5624458">,</span>&nbsp;<span class="ident" id="5624460">h</span><span class="op" id="5624461">,</span>&nbsp;<span class="ident" id="5624463">cw</span><span class="op" id="5624465">,</span>&nbsp;<span class="ident" id="5624467">ch</span>&nbsp;<span class="op" id="5624470">:=</span>&nbsp;<span class="ident" id="5624473">r</span><span class="op" id="5624474">.</span><span class="ident" id="5624475">Dx</span><span class="op" id="5624477">(</span><span class="op" id="5624478">)</span><span class="op" id="5624479">,</span>&nbsp;<span class="ident" id="5624481">r</span><span class="op" id="5624482">.</span><span class="ident" id="5624483">Dy</span><span class="op" id="5624485">(</span><span class="op" id="5624486">)</span><span class="op" id="5624487">,</span>&nbsp;<span class="num" id="5624489">0</span><span class="op" id="5624490">,</span>&nbsp;<span class="num" id="5624492">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624495">switch</span>&nbsp;<span class="ident" id="5624502">subsampleRatio</span>&nbsp;<span class="op" id="5624517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624520">case</span>&nbsp;<span class="ident" id="5624525">YCbCrSubsampleRatio422</span><span class="op" id="5624547">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624551">cw</span>&nbsp;<span class="op" id="5624554">=</span>&nbsp;<span class="op" id="5624556">(</span><span class="ident" id="5624557">r</span><span class="op" id="5624558">.</span><span class="ident" id="5624559">Max</span><span class="op" id="5624562">.</span><span class="ident" id="5624563">X</span><span class="op" id="5624564">+</span><span class="num" id="5624565">1</span><span class="op" id="5624566">)</span><span class="op" id="5624567">/</span><span class="num" id="5624568">2</span>&nbsp;<span class="op" id="5624570">-</span>&nbsp;<span class="ident" id="5624572">r</span><span class="op" id="5624573">.</span><span class="ident" id="5624574">Min</span><span class="op" id="5624577">.</span><span class="ident" id="5624578">X</span><span class="op" id="5624579">/</span><span class="num" id="5624580">2</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624584">ch</span>&nbsp;<span class="op" id="5624587">=</span>&nbsp;<span class="ident" id="5624589">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624592">case</span>&nbsp;<span class="ident" id="5624597">YCbCrSubsampleRatio420</span><span class="op" id="5624619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624623">cw</span>&nbsp;<span class="op" id="5624626">=</span>&nbsp;<span class="op" id="5624628">(</span><span class="ident" id="5624629">r</span><span class="op" id="5624630">.</span><span class="ident" id="5624631">Max</span><span class="op" id="5624634">.</span><span class="ident" id="5624635">X</span><span class="op" id="5624636">+</span><span class="num" id="5624637">1</span><span class="op" id="5624638">)</span><span class="op" id="5624639">/</span><span class="num" id="5624640">2</span>&nbsp;<span class="op" id="5624642">-</span>&nbsp;<span class="ident" id="5624644">r</span><span class="op" id="5624645">.</span><span class="ident" id="5624646">Min</span><span class="op" id="5624649">.</span><span class="ident" id="5624650">X</span><span class="op" id="5624651">/</span><span class="num" id="5624652">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624656">ch</span>&nbsp;<span class="op" id="5624659">=</span>&nbsp;<span class="op" id="5624661">(</span><span class="ident" id="5624662">r</span><span class="op" id="5624663">.</span><span class="ident" id="5624664">Max</span><span class="op" id="5624667">.</span><span class="ident" id="5624668">Y</span><span class="op" id="5624669">+</span><span class="num" id="5624670">1</span><span class="op" id="5624671">)</span><span class="op" id="5624672">/</span><span class="num" id="5624673">2</span>&nbsp;<span class="op" id="5624675">-</span>&nbsp;<span class="ident" id="5624677">r</span><span class="op" id="5624678">.</span><span class="ident" id="5624679">Min</span><span class="op" id="5624682">.</span><span class="ident" id="5624683">Y</span><span class="op" id="5624684">/</span><span class="num" id="5624685">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624688">case</span>&nbsp;<span class="ident" id="5624693">YCbCrSubsampleRatio440</span><span class="op" id="5624715">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624719">cw</span>&nbsp;<span class="op" id="5624722">=</span>&nbsp;<span class="ident" id="5624724">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624728">ch</span>&nbsp;<span class="op" id="5624731">=</span>&nbsp;<span class="op" id="5624733">(</span><span class="ident" id="5624734">r</span><span class="op" id="5624735">.</span><span class="ident" id="5624736">Max</span><span class="op" id="5624739">.</span><span class="ident" id="5624740">Y</span><span class="op" id="5624741">+</span><span class="num" id="5624742">1</span><span class="op" id="5624743">)</span><span class="op" id="5624744">/</span><span class="num" id="5624745">2</span>&nbsp;<span class="op" id="5624747">-</span>&nbsp;<span class="ident" id="5624749">r</span><span class="op" id="5624750">.</span><span class="ident" id="5624751">Min</span><span class="op" id="5624754">.</span><span class="ident" id="5624755">Y</span><span class="op" id="5624756">/</span><span class="num" id="5624757">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624760">default</span><span class="op" id="5624767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624771">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624806">cw</span>&nbsp;<span class="op" id="5624809">=</span>&nbsp;<span class="ident" id="5624811">w</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624815">ch</span>&nbsp;<span class="op" id="5624818">=</span>&nbsp;<span class="ident" id="5624820">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5624823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624826">b</span>&nbsp;<span class="op" id="5624828">:=</span>&nbsp;<span class="builtinfunc" id="5624831">make</span><span class="op" id="5624835">(</span><span class="op" id="5624836">[</span><span class="op" id="5624837">]</span><span class="builtintype" id="5624838">byte</span><span class="op" id="5624842">,</span>&nbsp;<span class="ident" id="5624844">w</span><span class="op" id="5624845">*</span><span class="ident" id="5624846">h</span><span class="op" id="5624847">+</span><span class="num" id="5624848">2</span><span class="op" id="5624849">*</span><span class="ident" id="5624850">cw</span><span class="op" id="5624852">*</span><span class="ident" id="5624853">ch</span><span class="op" id="5624855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624858">return</span>&nbsp;<span class="op" id="5624865">&amp;</span><span class="ident" id="5624866">YCbCr</span><span class="op" id="5624871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624875">Y</span><span class="op" id="5624876">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624891">b</span><span class="op" id="5624892">[</span><span class="op" id="5624893">:</span><span class="ident" id="5624894">w</span><span class="op" id="5624895">*</span><span class="ident" id="5624896">h</span><span class="op" id="5624897">]</span><span class="op" id="5624898">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624902">Cb</span><span class="op" id="5624904">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624918">b</span><span class="op" id="5624919">[</span><span class="ident" id="5624920">w</span><span class="op" id="5624921">*</span><span class="ident" id="5624922">h</span><span class="op" id="5624923">+</span><span class="num" id="5624924">0</span><span class="op" id="5624925">*</span><span class="ident" id="5624926">cw</span><span class="op" id="5624928">*</span><span class="ident" id="5624929">ch</span>&nbsp;<span class="op" id="5624932">:</span>&nbsp;<span class="ident" id="5624934">w</span><span class="op" id="5624935">*</span><span class="ident" id="5624936">h</span><span class="op" id="5624937">+</span><span class="num" id="5624938">1</span><span class="op" id="5624939">*</span><span class="ident" id="5624940">cw</span><span class="op" id="5624942">*</span><span class="ident" id="5624943">ch</span><span class="op" id="5624945">]</span><span class="op" id="5624946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624950">Cr</span><span class="op" id="5624952">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624966">b</span><span class="op" id="5624967">[</span><span class="ident" id="5624968">w</span><span class="op" id="5624969">*</span><span class="ident" id="5624970">h</span><span class="op" id="5624971">+</span><span class="num" id="5624972">1</span><span class="op" id="5624973">*</span><span class="ident" id="5624974">cw</span><span class="op" id="5624976">*</span><span class="ident" id="5624977">ch</span>&nbsp;<span class="op" id="5624980">:</span>&nbsp;<span class="ident" id="5624982">w</span><span class="op" id="5624983">*</span><span class="ident" id="5624984">h</span><span class="op" id="5624985">+</span><span class="num" id="5624986">2</span><span class="op" id="5624987">*</span><span class="ident" id="5624988">cw</span><span class="op" id="5624990">*</span><span class="ident" id="5624991">ch</span><span class="op" id="5624993">]</span><span class="op" id="5624994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624998">SubsampleRatio</span><span class="op" id="5625012">:</span>&nbsp;<span class="ident" id="5625014">subsampleRatio</span><span class="op" id="5625028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625032">YStride</span><span class="op" id="5625039">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625048">w</span><span class="op" id="5625049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625053">CStride</span><span class="op" id="5625060">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625069">cw</span><span class="op" id="5625071">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625075">Rect</span><span class="op" id="5625079">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625091">r</span><span class="op" id="5625092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5625095">}</span><br>
<span class="lineno"></span><span class="op" id="5625097">}</span>
</div>
</body>
</html>
