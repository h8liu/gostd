<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>path/filepath</h2>
<ul>
<li><a href="/gostd/path/filepath/example_unix_test.go.html">example_unix_test.go</a></li>
<li><a href="/gostd/path/filepath/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/path/filepath/match.go.html">match.go</a></li>
<li><a href="/gostd/path/filepath/match_test.go.html">match_test.go</a></li>
<li><a href="/gostd/path/filepath/path.go.html">path.go</a></li>
<li><a href="/gostd/path/filepath/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/path/filepath/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/path/filepath/symlink.go.html">symlink.go</a></li>
<li><a href="/gostd/path/filepath/symlink_unix.go.html">symlink_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2868639">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2868694">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2868748">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2868799">//&nbsp;Package&nbsp;filepath&nbsp;implements&nbsp;utility&nbsp;routines&nbsp;for&nbsp;manipulating&nbsp;filename&nbsp;paths</span><br>
<span class="lineno"></span><span class="comment" id="2868879">//&nbsp;in&nbsp;a&nbsp;way&nbsp;compatible&nbsp;with&nbsp;the&nbsp;target&nbsp;operating&nbsp;system-defined&nbsp;file&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="2868955">package</span>&nbsp;<span class="ident" id="2868963">filepath</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2868973">import</span>&nbsp;<span class="op" id="2868980">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2868983">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2868993">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2868999">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2869007">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="2869017">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2869020">//&nbsp;A&nbsp;lazybuf&nbsp;is&nbsp;a&nbsp;lazily&nbsp;constructed&nbsp;path&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2869070">//&nbsp;It&nbsp;supports&nbsp;append,&nbsp;reading&nbsp;previously&nbsp;appended&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="2869128">//&nbsp;and&nbsp;retrieving&nbsp;the&nbsp;final&nbsp;string.&nbsp;It&nbsp;does&nbsp;not&nbsp;allocate&nbsp;a&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="2869194">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;output&nbsp;until&nbsp;that&nbsp;output&nbsp;diverges&nbsp;from&nbsp;s.</span><br>
<span class="lineno">20</span><span class="keyword" id="2869251">type</span>&nbsp;<span class="ident" id="2869256">lazybuf</span>&nbsp;<span class="keyword" id="2869264">struct</span>&nbsp;<span class="op" id="2869271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869274">path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2869285">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869293">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2869304">[</span><span class="op" id="2869305">]</span><span class="builtintype" id="2869306">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869312">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2869323">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869328">volAndPath</span>&nbsp;<span class="builtintype" id="2869339">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869347">volLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2869358">int</span><br>
<span class="lineno"></span><span class="op" id="2869362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2869365">func</span>&nbsp;<span class="op" id="2869370">(</span><span class="ident" id="2869371">b</span>&nbsp;<span class="op" id="2869373">*</span><span class="ident" id="2869374">lazybuf</span><span class="op" id="2869381">)</span>&nbsp;<span class="ident" id="2869383">index</span><span class="op" id="2869388">(</span><span class="ident" id="2869389">i</span>&nbsp;<span class="builtintype" id="2869391">int</span><span class="op" id="2869394">)</span>&nbsp;<span class="builtintype" id="2869396">byte</span>&nbsp;<span class="op" id="2869401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2869404">if</span>&nbsp;<span class="ident" id="2869407">b</span><span class="op" id="2869408">.</span><span class="ident" id="2869409">buf</span>&nbsp;<span class="op" id="2869413">!=</span>&nbsp;<span class="ident" id="2869416">nil</span>&nbsp;<span class="op" id="2869420">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2869424">return</span>&nbsp;<span class="ident" id="2869431">b</span><span class="op" id="2869432">.</span><span class="ident" id="2869433">buf</span><span class="op" id="2869436">[</span><span class="ident" id="2869437">i</span><span class="op" id="2869438">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2869441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2869444">return</span>&nbsp;<span class="ident" id="2869451">b</span><span class="op" id="2869452">.</span><span class="ident" id="2869453">path</span><span class="op" id="2869457">[</span><span class="ident" id="2869458">i</span><span class="op" id="2869459">]</span><br>
<span class="lineno"></span><span class="op" id="2869461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="2869464">func</span>&nbsp;<span class="op" id="2869469">(</span><span class="ident" id="2869470">b</span>&nbsp;<span class="op" id="2869472">*</span><span class="ident" id="2869473">lazybuf</span><span class="op" id="2869480">)</span>&nbsp;<span class="builtinfunc" id="2869482">append</span><span class="op" id="2869488">(</span><span class="ident" id="2869489">c</span>&nbsp;<span class="builtintype" id="2869491">byte</span><span class="op" id="2869495">)</span>&nbsp;<span class="op" id="2869497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2869500">if</span>&nbsp;<span class="ident" id="2869503">b</span><span class="op" id="2869504">.</span><span class="ident" id="2869505">buf</span>&nbsp;<span class="op" id="2869509">==</span>&nbsp;<span class="ident" id="2869512">nil</span>&nbsp;<span class="op" id="2869516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2869520">if</span>&nbsp;<span class="ident" id="2869523">b</span><span class="op" id="2869524">.</span><span class="ident" id="2869525">w</span>&nbsp;<span class="op" id="2869527">&lt;</span>&nbsp;<span class="builtinfunc" id="2869529">len</span><span class="op" id="2869532">(</span><span class="ident" id="2869533">b</span><span class="op" id="2869534">.</span><span class="ident" id="2869535">path</span><span class="op" id="2869539">)</span>&nbsp;<span class="op" id="2869541">&amp;&amp;</span>&nbsp;<span class="ident" id="2869544">b</span><span class="op" id="2869545">.</span><span class="ident" id="2869546">path</span><span class="op" id="2869550">[</span><span class="ident" id="2869551">b</span><span class="op" id="2869552">.</span><span class="ident" id="2869553">w</span><span class="op" id="2869554">]</span>&nbsp;<span class="op" id="2869556">==</span>&nbsp;<span class="ident" id="2869559">c</span>&nbsp;<span class="op" id="2869561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869566">b</span><span class="op" id="2869567">.</span><span class="ident" id="2869568">w</span><span class="op" id="2869569">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2869575">return</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2869584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869588">b</span><span class="op" id="2869589">.</span><span class="ident" id="2869590">buf</span>&nbsp;<span class="op" id="2869594">=</span>&nbsp;<span class="builtinfunc" id="2869596">make</span><span class="op" id="2869600">(</span><span class="op" id="2869601">[</span><span class="op" id="2869602">]</span><span class="builtintype" id="2869603">byte</span><span class="op" id="2869607">,</span>&nbsp;<span class="builtinfunc" id="2869609">len</span><span class="op" id="2869612">(</span><span class="ident" id="2869613">b</span><span class="op" id="2869614">.</span><span class="ident" id="2869615">path</span><span class="op" id="2869619">)</span><span class="op" id="2869620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2869624">copy</span><span class="op" id="2869628">(</span><span class="ident" id="2869629">b</span><span class="op" id="2869630">.</span><span class="ident" id="2869631">buf</span><span class="op" id="2869634">,</span>&nbsp;<span class="ident" id="2869636">b</span><span class="op" id="2869637">.</span><span class="ident" id="2869638">path</span><span class="op" id="2869642">[</span><span class="op" id="2869643">:</span><span class="ident" id="2869644">b</span><span class="op" id="2869645">.</span><span class="ident" id="2869646">w</span><span class="op" id="2869647">]</span><span class="op" id="2869648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2869651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869654">b</span><span class="op" id="2869655">.</span><span class="ident" id="2869656">buf</span><span class="op" id="2869659">[</span><span class="ident" id="2869660">b</span><span class="op" id="2869661">.</span><span class="ident" id="2869662">w</span><span class="op" id="2869663">]</span>&nbsp;<span class="op" id="2869665">=</span>&nbsp;<span class="ident" id="2869667">c</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869670">b</span><span class="op" id="2869671">.</span><span class="ident" id="2869672">w</span><span class="op" id="2869673">++</span><br>
<span class="lineno"></span><span class="op" id="2869676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2869679">func</span>&nbsp;<span class="op" id="2869684">(</span><span class="ident" id="2869685">b</span>&nbsp;<span class="op" id="2869687">*</span><span class="ident" id="2869688">lazybuf</span><span class="op" id="2869695">)</span>&nbsp;<span class="builtintype" id="2869697">string</span><span class="op" id="2869703">(</span><span class="op" id="2869704">)</span>&nbsp;<span class="builtintype" id="2869706">string</span>&nbsp;<span class="op" id="2869713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2869716">if</span>&nbsp;<span class="ident" id="2869719">b</span><span class="op" id="2869720">.</span><span class="ident" id="2869721">buf</span>&nbsp;<span class="op" id="2869725">==</span>&nbsp;<span class="ident" id="2869728">nil</span>&nbsp;<span class="op" id="2869732">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2869736">return</span>&nbsp;<span class="ident" id="2869743">b</span><span class="op" id="2869744">.</span><span class="ident" id="2869745">volAndPath</span><span class="op" id="2869755">[</span><span class="op" id="2869756">:</span><span class="ident" id="2869757">b</span><span class="op" id="2869758">.</span><span class="ident" id="2869759">volLen</span><span class="op" id="2869765">+</span><span class="ident" id="2869766">b</span><span class="op" id="2869767">.</span><span class="ident" id="2869768">w</span><span class="op" id="2869769">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2869772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2869775">return</span>&nbsp;<span class="ident" id="2869782">b</span><span class="op" id="2869783">.</span><span class="ident" id="2869784">volAndPath</span><span class="op" id="2869794">[</span><span class="op" id="2869795">:</span><span class="ident" id="2869796">b</span><span class="op" id="2869797">.</span><span class="ident" id="2869798">volLen</span><span class="op" id="2869804">]</span>&nbsp;<span class="op" id="2869806">+</span>&nbsp;<span class="builtintype" id="2869808">string</span><span class="op" id="2869814">(</span><span class="ident" id="2869815">b</span><span class="op" id="2869816">.</span><span class="ident" id="2869817">buf</span><span class="op" id="2869820">[</span><span class="op" id="2869821">:</span><span class="ident" id="2869822">b</span><span class="op" id="2869823">.</span><span class="ident" id="2869824">w</span><span class="op" id="2869825">]</span><span class="op" id="2869826">)</span><br>
<span class="lineno"></span><span class="op" id="2869828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="2869831">const</span>&nbsp;<span class="op" id="2869837">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869840">Separator</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2869854">=</span>&nbsp;<span class="ident" id="2869856">os</span><span class="op" id="2869858">.</span><span class="ident" id="2869859">PathSeparator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869874">ListSeparator</span>&nbsp;<span class="op" id="2869888">=</span>&nbsp;<span class="ident" id="2869890">os</span><span class="op" id="2869892">.</span><span class="ident" id="2869893">PathListSeparator</span><br>
<span class="lineno"></span><span class="op" id="2869911">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="2869914">//&nbsp;Clean&nbsp;returns&nbsp;the&nbsp;shortest&nbsp;path&nbsp;name&nbsp;equivalent&nbsp;to&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="2869973">//&nbsp;by&nbsp;purely&nbsp;lexical&nbsp;processing.&nbsp;&nbsp;It&nbsp;applies&nbsp;the&nbsp;following&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="2870038">//&nbsp;iteratively&nbsp;until&nbsp;no&nbsp;further&nbsp;processing&nbsp;can&nbsp;be&nbsp;done:</span><br>
<span class="lineno"></span><span class="comment" id="2870094">//</span><br>
<span class="lineno"></span><span class="comment" id="2870097">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Replace&nbsp;multiple&nbsp;Separator&nbsp;elements&nbsp;with&nbsp;a&nbsp;single&nbsp;one.</span><br>
<span class="lineno">65</span><span class="comment" id="2870158">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Eliminate&nbsp;each&nbsp;.&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;current&nbsp;directory).</span><br>
<span class="lineno"></span><span class="comment" id="2870224">//&nbsp;&nbsp;&nbsp;&nbsp3.&nbsp;Eliminate&nbsp;each&nbsp;inner&nbsp;..&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;parent&nbsp;directory)</span><br>
<span class="lineno"></span><span class="comment" id="2870295">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;along&nbsp;with&nbsp;the&nbsp;non-..&nbsp;element&nbsp;that&nbsp;precedes&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="2870349">//&nbsp;&nbsp;&nbsp;&nbsp4.&nbsp;Eliminate&nbsp;..&nbsp;elements&nbsp;that&nbsp;begin&nbsp;a&nbsp;rooted&nbsp;path:</span><br>
<span class="lineno"></span><span class="comment" id="2870403">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;that&nbsp;is,&nbsp;replace&nbsp;&#34;/..&#34;&nbsp;by&nbsp;&#34;/&#34;&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;a&nbsp;path,</span><br>
<span class="lineno">70</span><span class="comment" id="2870467">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;assuming&nbsp;Separator&nbsp;is&nbsp;&#39;/&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="2870500">//</span><br>
<span class="lineno"></span><span class="comment" id="2870503">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash&nbsp;only&nbsp;if&nbsp;it&nbsp;represents&nbsp;a&nbsp;root&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="2870580">//&nbsp;such&nbsp;as&nbsp;&#34;/&#34;&nbsp;on&nbsp;Unix&nbsp;or&nbsp;`C:\`&nbsp;on&nbsp;Windows.</span><br>
<span class="lineno"></span><span class="comment" id="2870624">//</span><br>
<span class="lineno">75</span><span class="comment" id="2870627">//&nbsp;If&nbsp;the&nbsp;result&nbsp;of&nbsp;this&nbsp;process&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,&nbsp;Clean</span><br>
<span class="lineno"></span><span class="comment" id="2870686">//&nbsp;returns&nbsp;the&nbsp;string&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2870713">//</span><br>
<span class="lineno"></span><span class="comment" id="2870716">//&nbsp;See&nbsp;also&nbsp;Rob&nbsp;Pike,&nbsp;``Lexical&nbsp;File&nbsp;Names&nbsp;in&nbsp;Plan&nbsp;9&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2870772">//&nbsp;Getting&nbsp;Dot-Dot&nbsp;Right,&#39;&#39;</span><br>
<span class="lineno">80</span><span class="comment" id="2870800">//&nbsp;http://plan9.bell-labs.com/sys/doc/lexnames.html</span><br>
<span class="lineno"></span><span class="keyword" id="2870852">func</span>&nbsp;<span class="ident" id="2870857">Clean</span><span class="op" id="2870862">(</span><span class="ident" id="2870863">path</span>&nbsp;<span class="builtintype" id="2870868">string</span><span class="op" id="2870874">)</span>&nbsp;<span class="builtintype" id="2870876">string</span>&nbsp;<span class="op" id="2870883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2870886">originalPath</span>&nbsp;<span class="op" id="2870899">:=</span>&nbsp;<span class="ident" id="2870902">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2870908">volLen</span>&nbsp;<span class="op" id="2870915">:=</span>&nbsp;<span class="ident" id="2870918">volumeNameLen</span><span class="op" id="2870931">(</span><span class="ident" id="2870932">path</span><span class="op" id="2870936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2870939">path</span>&nbsp;<span class="op" id="2870944">=</span>&nbsp;<span class="ident" id="2870946">path</span><span class="op" id="2870950">[</span><span class="ident" id="2870951">volLen</span><span class="op" id="2870957">:</span><span class="op" id="2870958">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2870961">if</span>&nbsp;<span class="ident" id="2870964">path</span>&nbsp;<span class="op" id="2870969">==</span>&nbsp;<span class="string" id="2870972">&#34;&#34;</span>&nbsp;<span class="op" id="2870975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2870979">if</span>&nbsp;<span class="ident" id="2870982">volLen</span>&nbsp;<span class="op" id="2870989">&gt;</span>&nbsp;<span class="num" id="2870991">1</span>&nbsp;<span class="op" id="2870993">&amp;&amp;</span>&nbsp;<span class="ident" id="2870996">originalPath</span><span class="op" id="2871008">[</span><span class="num" id="2871009">1</span><span class="op" id="2871010">]</span>&nbsp;<span class="op" id="2871012">!=</span>&nbsp;<span class="string" id="2871015">&#39;:&#39;</span>&nbsp;<span class="op" id="2871019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871024">//&nbsp;should&nbsp;be&nbsp;UNC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871044">return</span>&nbsp;<span class="ident" id="2871051">FromSlash</span><span class="op" id="2871060">(</span><span class="ident" id="2871061">originalPath</span><span class="op" id="2871073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2871077">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871081">return</span>&nbsp;<span class="ident" id="2871088">originalPath</span>&nbsp;<span class="op" id="2871101">+</span>&nbsp;<span class="string" id="2871103">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2871108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871111">rooted</span>&nbsp;<span class="op" id="2871118">:=</span>&nbsp;<span class="ident" id="2871121">os</span><span class="op" id="2871123">.</span><span class="ident" id="2871124">IsPathSeparator</span><span class="op" id="2871139">(</span><span class="ident" id="2871140">path</span><span class="op" id="2871144">[</span><span class="num" id="2871145">0</span><span class="op" id="2871146">]</span><span class="op" id="2871147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871151">//&nbsp;Invariants:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871167">//&nbsp;&nbsp;&nbsp;&nbspreading&nbsp;from&nbsp;path;&nbsp;r&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;process.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871226">//&nbsp;&nbsp;&nbsp;&nbspwriting&nbsp;to&nbsp;buf;&nbsp;w&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871280">//&nbsp;&nbsp;&nbsp;&nbspdotdot&nbsp;is&nbsp;index&nbsp;in&nbsp;buf&nbsp;where&nbsp;..&nbsp;must&nbsp;stop,&nbsp;either&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871342">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspit&nbsp;is&nbsp;the&nbsp;leading&nbsp;slash&nbsp;or&nbsp;it&nbsp;is&nbsp;a&nbsp;leading&nbsp;../../..&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871407">n</span>&nbsp;<span class="op" id="2871409">:=</span>&nbsp;<span class="builtinfunc" id="2871412">len</span><span class="op" id="2871415">(</span><span class="ident" id="2871416">path</span><span class="op" id="2871420">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871423">out</span>&nbsp;<span class="op" id="2871427">:=</span>&nbsp;<span class="ident" id="2871430">lazybuf</span><span class="op" id="2871437">{</span><span class="ident" id="2871438">path</span><span class="op" id="2871442">:</span>&nbsp;<span class="ident" id="2871444">path</span><span class="op" id="2871448">,</span>&nbsp;<span class="ident" id="2871450">volAndPath</span><span class="op" id="2871460">:</span>&nbsp;<span class="ident" id="2871462">originalPath</span><span class="op" id="2871474">,</span>&nbsp;<span class="ident" id="2871476">volLen</span><span class="op" id="2871482">:</span>&nbsp;<span class="ident" id="2871484">volLen</span><span class="op" id="2871490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871493">r</span><span class="op" id="2871494">,</span>&nbsp;<span class="ident" id="2871496">dotdot</span>&nbsp;<span class="op" id="2871503">:=</span>&nbsp;<span class="num" id="2871506">0</span><span class="op" id="2871507">,</span>&nbsp;<span class="num" id="2871509">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871512">if</span>&nbsp;<span class="ident" id="2871515">rooted</span>&nbsp;<span class="op" id="2871522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871526">out</span><span class="op" id="2871529">.</span><span class="builtinfunc" id="2871530">append</span><span class="op" id="2871536">(</span><span class="ident" id="2871537">Separator</span><span class="op" id="2871546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871550">r</span><span class="op" id="2871551">,</span>&nbsp;<span class="ident" id="2871553">dotdot</span>&nbsp;<span class="op" id="2871560">=</span>&nbsp;<span class="num" id="2871562">1</span><span class="op" id="2871563">,</span>&nbsp;<span class="num" id="2871565">1</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2871568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871572">for</span>&nbsp;<span class="ident" id="2871576">r</span>&nbsp;<span class="op" id="2871578">&lt;</span>&nbsp;<span class="ident" id="2871580">n</span>&nbsp;<span class="op" id="2871582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871586">switch</span>&nbsp;<span class="op" id="2871593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871597">case</span>&nbsp;<span class="ident" id="2871602">os</span><span class="op" id="2871604">.</span><span class="ident" id="2871605">IsPathSeparator</span><span class="op" id="2871620">(</span><span class="ident" id="2871621">path</span><span class="op" id="2871625">[</span><span class="ident" id="2871626">r</span><span class="op" id="2871627">]</span><span class="op" id="2871628">)</span><span class="op" id="2871629">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871634">//&nbsp;empty&nbsp;path&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871659">r</span><span class="op" id="2871660">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871665">case</span>&nbsp;<span class="ident" id="2871670">path</span><span class="op" id="2871674">[</span><span class="ident" id="2871675">r</span><span class="op" id="2871676">]</span>&nbsp;<span class="op" id="2871678">==</span>&nbsp;<span class="string" id="2871681">&#39;.&#39;</span>&nbsp;<span class="op" id="2871685">&amp;&amp;</span>&nbsp;<span class="op" id="2871688">(</span><span class="ident" id="2871689">r</span><span class="op" id="2871690">+</span><span class="num" id="2871691">1</span>&nbsp;<span class="op" id="2871693">==</span>&nbsp;<span class="ident" id="2871696">n</span>&nbsp;<span class="op" id="2871698">||</span>&nbsp;<span class="ident" id="2871701">os</span><span class="op" id="2871703">.</span><span class="ident" id="2871704">IsPathSeparator</span><span class="op" id="2871719">(</span><span class="ident" id="2871720">path</span><span class="op" id="2871724">[</span><span class="ident" id="2871725">r</span><span class="op" id="2871726">+</span><span class="num" id="2871727">1</span><span class="op" id="2871728">]</span><span class="op" id="2871729">)</span><span class="op" id="2871730">)</span><span class="op" id="2871731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871736">//&nbsp;.&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871752">r</span><span class="op" id="2871753">++</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871758">case</span>&nbsp;<span class="ident" id="2871763">path</span><span class="op" id="2871767">[</span><span class="ident" id="2871768">r</span><span class="op" id="2871769">]</span>&nbsp;<span class="op" id="2871771">==</span>&nbsp;<span class="string" id="2871774">&#39;.&#39;</span>&nbsp;<span class="op" id="2871778">&amp;&amp;</span>&nbsp;<span class="ident" id="2871781">path</span><span class="op" id="2871785">[</span><span class="ident" id="2871786">r</span><span class="op" id="2871787">+</span><span class="num" id="2871788">1</span><span class="op" id="2871789">]</span>&nbsp;<span class="op" id="2871791">==</span>&nbsp;<span class="string" id="2871794">&#39;.&#39;</span>&nbsp;<span class="op" id="2871798">&amp;&amp;</span>&nbsp;<span class="op" id="2871801">(</span><span class="ident" id="2871802">r</span><span class="op" id="2871803">+</span><span class="num" id="2871804">2</span>&nbsp;<span class="op" id="2871806">==</span>&nbsp;<span class="ident" id="2871809">n</span>&nbsp;<span class="op" id="2871811">||</span>&nbsp;<span class="ident" id="2871814">os</span><span class="op" id="2871816">.</span><span class="ident" id="2871817">IsPathSeparator</span><span class="op" id="2871832">(</span><span class="ident" id="2871833">path</span><span class="op" id="2871837">[</span><span class="ident" id="2871838">r</span><span class="op" id="2871839">+</span><span class="num" id="2871840">2</span><span class="op" id="2871841">]</span><span class="op" id="2871842">)</span><span class="op" id="2871843">)</span><span class="op" id="2871844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871849">//&nbsp;..&nbsp;element:&nbsp;remove&nbsp;to&nbsp;last&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871892">r</span>&nbsp;<span class="op" id="2871894">+=</span>&nbsp;<span class="num" id="2871897">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871902">switch</span>&nbsp;<span class="op" id="2871909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871914">case</span>&nbsp;<span class="ident" id="2871919">out</span><span class="op" id="2871922">.</span><span class="ident" id="2871923">w</span>&nbsp;<span class="op" id="2871925">&gt;</span>&nbsp;<span class="ident" id="2871927">dotdot</span><span class="op" id="2871933">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871939">//&nbsp;can&nbsp;backtrack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871960">out</span><span class="op" id="2871963">.</span><span class="ident" id="2871964">w</span><span class="op" id="2871965">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871972">for</span>&nbsp;<span class="ident" id="2871976">out</span><span class="op" id="2871979">.</span><span class="ident" id="2871980">w</span>&nbsp;<span class="op" id="2871982">&gt;</span>&nbsp;<span class="ident" id="2871984">dotdot</span>&nbsp;<span class="op" id="2871991">&amp;&amp;</span>&nbsp;<span class="op" id="2871994">!</span><span class="ident" id="2871995">os</span><span class="op" id="2871997">.</span><span class="ident" id="2871998">IsPathSeparator</span><span class="op" id="2872013">(</span><span class="ident" id="2872014">out</span><span class="op" id="2872017">.</span><span class="ident" id="2872018">index</span><span class="op" id="2872023">(</span><span class="ident" id="2872024">out</span><span class="op" id="2872027">.</span><span class="ident" id="2872028">w</span><span class="op" id="2872029">)</span><span class="op" id="2872030">)</span>&nbsp;<span class="op" id="2872032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872039">out</span><span class="op" id="2872042">.</span><span class="ident" id="2872043">w</span><span class="op" id="2872044">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2872051">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872056">case</span>&nbsp;<span class="op" id="2872061">!</span><span class="ident" id="2872062">rooted</span><span class="op" id="2872068">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2872074">//&nbsp;cannot&nbsp;backtrack,&nbsp;but&nbsp;not&nbsp;rooted,&nbsp;so&nbsp;append&nbsp;..&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872137">if</span>&nbsp;<span class="ident" id="2872140">out</span><span class="op" id="2872143">.</span><span class="ident" id="2872144">w</span>&nbsp;<span class="op" id="2872146">&gt;</span>&nbsp;<span class="num" id="2872148">0</span>&nbsp;<span class="op" id="2872150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872157">out</span><span class="op" id="2872160">.</span><span class="builtinfunc" id="2872161">append</span><span class="op" id="2872167">(</span><span class="ident" id="2872168">Separator</span><span class="op" id="2872177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2872183">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872189">out</span><span class="op" id="2872192">.</span><span class="builtinfunc" id="2872193">append</span><span class="op" id="2872199">(</span><span class="string" id="2872200">&#39;.&#39;</span><span class="op" id="2872203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872209">out</span><span class="op" id="2872212">.</span><span class="builtinfunc" id="2872213">append</span><span class="op" id="2872219">(</span><span class="string" id="2872220">&#39;.&#39;</span><span class="op" id="2872223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872229">dotdot</span>&nbsp;<span class="op" id="2872236">=</span>&nbsp;<span class="ident" id="2872238">out</span><span class="op" id="2872241">.</span><span class="ident" id="2872242">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2872247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872251">default</span><span class="op" id="2872258">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2872263">//&nbsp;real&nbsp;path&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2872288">//&nbsp;add&nbsp;slash&nbsp;if&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872314">if</span>&nbsp;<span class="ident" id="2872317">rooted</span>&nbsp;<span class="op" id="2872324">&amp;&amp;</span>&nbsp;<span class="ident" id="2872327">out</span><span class="op" id="2872330">.</span><span class="ident" id="2872331">w</span>&nbsp;<span class="op" id="2872333">!=</span>&nbsp;<span class="num" id="2872336">1</span>&nbsp;<span class="op" id="2872338">||</span>&nbsp;<span class="op" id="2872341">!</span><span class="ident" id="2872342">rooted</span>&nbsp;<span class="op" id="2872349">&amp;&amp;</span>&nbsp;<span class="ident" id="2872352">out</span><span class="op" id="2872355">.</span><span class="ident" id="2872356">w</span>&nbsp;<span class="op" id="2872358">!=</span>&nbsp;<span class="num" id="2872361">0</span>&nbsp;<span class="op" id="2872363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872369">out</span><span class="op" id="2872372">.</span><span class="builtinfunc" id="2872373">append</span><span class="op" id="2872379">(</span><span class="ident" id="2872380">Separator</span><span class="op" id="2872389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2872394">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2872399">//&nbsp;copy&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872418">for</span>&nbsp;<span class="op" id="2872422">;</span>&nbsp;<span class="ident" id="2872424">r</span>&nbsp;<span class="op" id="2872426">&lt;</span>&nbsp;<span class="ident" id="2872428">n</span>&nbsp;<span class="op" id="2872430">&amp;&amp;</span>&nbsp;<span class="op" id="2872433">!</span><span class="ident" id="2872434">os</span><span class="op" id="2872436">.</span><span class="ident" id="2872437">IsPathSeparator</span><span class="op" id="2872452">(</span><span class="ident" id="2872453">path</span><span class="op" id="2872457">[</span><span class="ident" id="2872458">r</span><span class="op" id="2872459">]</span><span class="op" id="2872460">)</span><span class="op" id="2872461">;</span>&nbsp;<span class="ident" id="2872463">r</span><span class="op" id="2872464">++</span>&nbsp;<span class="op" id="2872467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872473">out</span><span class="op" id="2872476">.</span><span class="builtinfunc" id="2872477">append</span><span class="op" id="2872483">(</span><span class="ident" id="2872484">path</span><span class="op" id="2872488">[</span><span class="ident" id="2872489">r</span><span class="op" id="2872490">]</span><span class="op" id="2872491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2872496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2872500">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2872503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2872507">//&nbsp;Turn&nbsp;empty&nbsp;string&nbsp;into&nbsp;&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872538">if</span>&nbsp;<span class="ident" id="2872541">out</span><span class="op" id="2872544">.</span><span class="ident" id="2872545">w</span>&nbsp;<span class="op" id="2872547">==</span>&nbsp;<span class="num" id="2872550">0</span>&nbsp;<span class="op" id="2872552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872556">out</span><span class="op" id="2872559">.</span><span class="builtinfunc" id="2872560">append</span><span class="op" id="2872566">(</span><span class="string" id="2872567">&#39;.&#39;</span><span class="op" id="2872570">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2872573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872577">return</span>&nbsp;<span class="ident" id="2872584">FromSlash</span><span class="op" id="2872593">(</span><span class="ident" id="2872594">out</span><span class="op" id="2872597">.</span><span class="builtintype" id="2872598">string</span><span class="op" id="2872604">(</span><span class="op" id="2872605">)</span><span class="op" id="2872606">)</span><br>
<span class="lineno"></span><span class="op" id="2872608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="2872611">//&nbsp;ToSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;separator&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="2872679">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character.&nbsp;Multiple&nbsp;separators&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="2872744">//&nbsp;replaced&nbsp;by&nbsp;multiple&nbsp;slashes.</span><br>
<span class="lineno"></span><span class="keyword" id="2872777">func</span>&nbsp;<span class="ident" id="2872782">ToSlash</span><span class="op" id="2872789">(</span><span class="ident" id="2872790">path</span>&nbsp;<span class="builtintype" id="2872795">string</span><span class="op" id="2872801">)</span>&nbsp;<span class="builtintype" id="2872803">string</span>&nbsp;<span class="op" id="2872810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872813">if</span>&nbsp;<span class="ident" id="2872816">Separator</span>&nbsp;<span class="op" id="2872826">==</span>&nbsp;<span class="string" id="2872829">&#39;/&#39;</span>&nbsp;<span class="op" id="2872833">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872837">return</span>&nbsp;<span class="ident" id="2872844">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2872850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872853">return</span>&nbsp;<span class="ident" id="2872860">strings</span><span class="op" id="2872867">.</span><span class="ident" id="2872868">Replace</span><span class="op" id="2872875">(</span><span class="ident" id="2872876">path</span><span class="op" id="2872880">,</span>&nbsp;<span class="builtintype" id="2872882">string</span><span class="op" id="2872888">(</span><span class="ident" id="2872889">Separator</span><span class="op" id="2872898">)</span><span class="op" id="2872899">,</span>&nbsp;<span class="string" id="2872901">&#34;/&#34;</span><span class="op" id="2872904">,</span>&nbsp;<span class="op" id="2872906">-</span><span class="num" id="2872907">1</span><span class="op" id="2872908">)</span><br>
<span class="lineno"></span><span class="op" id="2872910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="2872913">//&nbsp;FromSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="2872985">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;separator&nbsp;character.&nbsp;Multiple&nbsp;slashes&nbsp;are&nbsp;replaced</span><br>
<span class="lineno"></span><span class="comment" id="2873054">//&nbsp;by&nbsp;multiple&nbsp;separators.</span><br>
<span class="lineno"></span><span class="keyword" id="2873081">func</span>&nbsp;<span class="ident" id="2873086">FromSlash</span><span class="op" id="2873095">(</span><span class="ident" id="2873096">path</span>&nbsp;<span class="builtintype" id="2873101">string</span><span class="op" id="2873107">)</span>&nbsp;<span class="builtintype" id="2873109">string</span>&nbsp;<span class="op" id="2873116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2873119">if</span>&nbsp;<span class="ident" id="2873122">Separator</span>&nbsp;<span class="op" id="2873132">==</span>&nbsp;<span class="string" id="2873135">&#39;/&#39;</span>&nbsp;<span class="op" id="2873139">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2873143">return</span>&nbsp;<span class="ident" id="2873150">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2873156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2873159">return</span>&nbsp;<span class="ident" id="2873166">strings</span><span class="op" id="2873173">.</span><span class="ident" id="2873174">Replace</span><span class="op" id="2873181">(</span><span class="ident" id="2873182">path</span><span class="op" id="2873186">,</span>&nbsp;<span class="string" id="2873188">&#34;/&#34;</span><span class="op" id="2873191">,</span>&nbsp;<span class="builtintype" id="2873193">string</span><span class="op" id="2873199">(</span><span class="ident" id="2873200">Separator</span><span class="op" id="2873209">)</span><span class="op" id="2873210">,</span>&nbsp;<span class="op" id="2873212">-</span><span class="num" id="2873213">1</span><span class="op" id="2873214">)</span><br>
<span class="lineno"></span><span class="op" id="2873216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="2873219">//&nbsp;SplitList&nbsp;splits&nbsp;a&nbsp;list&nbsp;of&nbsp;paths&nbsp;joined&nbsp;by&nbsp;the&nbsp;OS-specific&nbsp;ListSeparator,</span><br>
<span class="lineno"></span><span class="comment" id="2873296">//&nbsp;usually&nbsp;found&nbsp;in&nbsp;PATH&nbsp;or&nbsp;GOPATH&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><span class="comment" id="2873354">//&nbsp;Unlike&nbsp;strings.Split,&nbsp;SplitList&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;when&nbsp;passed&nbsp;an&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2873441">func</span>&nbsp;<span class="ident" id="2873446">SplitList</span><span class="op" id="2873455">(</span><span class="ident" id="2873456">path</span>&nbsp;<span class="builtintype" id="2873461">string</span><span class="op" id="2873467">)</span>&nbsp;<span class="op" id="2873469">[</span><span class="op" id="2873470">]</span><span class="builtintype" id="2873471">string</span>&nbsp;<span class="op" id="2873478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2873481">return</span>&nbsp;<span class="ident" id="2873488">splitList</span><span class="op" id="2873497">(</span><span class="ident" id="2873498">path</span><span class="op" id="2873502">)</span><br>
<span class="lineno">180</span><span class="op" id="2873504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2873507">//&nbsp;Split&nbsp;splits&nbsp;path&nbsp;immediately&nbsp;following&nbsp;the&nbsp;final&nbsp;Separator,</span><br>
<span class="lineno"></span><span class="comment" id="2873571">//&nbsp;separating&nbsp;it&nbsp;into&nbsp;a&nbsp;directory&nbsp;and&nbsp;file&nbsp;name&nbsp;component.</span><br>
<span class="lineno"></span><span class="comment" id="2873630">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;Separator&nbsp;in&nbsp;path,&nbsp;Split&nbsp;returns&nbsp;an&nbsp;empty&nbsp;dir</span><br>
<span class="lineno">185</span><span class="comment" id="2873694">//&nbsp;and&nbsp;file&nbsp;set&nbsp;to&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="2873719">//&nbsp;The&nbsp;returned&nbsp;values&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;path&nbsp;=&nbsp;dir+file.</span><br>
<span class="lineno"></span><span class="keyword" id="2873782">func</span>&nbsp;<span class="ident" id="2873787">Split</span><span class="op" id="2873792">(</span><span class="ident" id="2873793">path</span>&nbsp;<span class="builtintype" id="2873798">string</span><span class="op" id="2873804">)</span>&nbsp;<span class="op" id="2873806">(</span><span class="ident" id="2873807">dir</span><span class="op" id="2873810">,</span>&nbsp;<span class="ident" id="2873812">file</span>&nbsp;<span class="builtintype" id="2873817">string</span><span class="op" id="2873823">)</span>&nbsp;<span class="op" id="2873825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2873828">vol</span>&nbsp;<span class="op" id="2873832">:=</span>&nbsp;<span class="ident" id="2873835">VolumeName</span><span class="op" id="2873845">(</span><span class="ident" id="2873846">path</span><span class="op" id="2873850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2873853">i</span>&nbsp;<span class="op" id="2873855">:=</span>&nbsp;<span class="builtinfunc" id="2873858">len</span><span class="op" id="2873861">(</span><span class="ident" id="2873862">path</span><span class="op" id="2873866">)</span>&nbsp;<span class="op" id="2873868">-</span>&nbsp;<span class="num" id="2873870">1</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2873873">for</span>&nbsp;<span class="ident" id="2873877">i</span>&nbsp;<span class="op" id="2873879">&gt;=</span>&nbsp;<span class="builtinfunc" id="2873882">len</span><span class="op" id="2873885">(</span><span class="ident" id="2873886">vol</span><span class="op" id="2873889">)</span>&nbsp;<span class="op" id="2873891">&amp;&amp;</span>&nbsp;<span class="op" id="2873894">!</span><span class="ident" id="2873895">os</span><span class="op" id="2873897">.</span><span class="ident" id="2873898">IsPathSeparator</span><span class="op" id="2873913">(</span><span class="ident" id="2873914">path</span><span class="op" id="2873918">[</span><span class="ident" id="2873919">i</span><span class="op" id="2873920">]</span><span class="op" id="2873921">)</span>&nbsp;<span class="op" id="2873923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2873927">i</span><span class="op" id="2873928">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2873932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2873935">return</span>&nbsp;<span class="ident" id="2873942">path</span><span class="op" id="2873946">[</span><span class="op" id="2873947">:</span><span class="ident" id="2873948">i</span><span class="op" id="2873949">+</span><span class="num" id="2873950">1</span><span class="op" id="2873951">]</span><span class="op" id="2873952">,</span>&nbsp;<span class="ident" id="2873954">path</span><span class="op" id="2873958">[</span><span class="ident" id="2873959">i</span><span class="op" id="2873960">+</span><span class="num" id="2873961">1</span><span class="op" id="2873962">:</span><span class="op" id="2873963">]</span><br>
<span class="lineno"></span><span class="op" id="2873965">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="2873968">//&nbsp;Join&nbsp;joins&nbsp;any&nbsp;number&nbsp;of&nbsp;path&nbsp;elements&nbsp;into&nbsp;a&nbsp;single&nbsp;path,&nbsp;adding</span><br>
<span class="lineno"></span><span class="comment" id="2874037">//&nbsp;a&nbsp;Separator&nbsp;if&nbsp;necessary.&nbsp;The&nbsp;result&nbsp;is&nbsp;Cleaned,&nbsp;in&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="2874103">//&nbsp;all&nbsp;empty&nbsp;strings&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="2874137">func</span>&nbsp;<span class="ident" id="2874142">Join</span><span class="op" id="2874146">(</span><span class="ident" id="2874147">elem</span>&nbsp;<span class="op" id="2874152">...</span><span class="builtintype" id="2874155">string</span><span class="op" id="2874161">)</span>&nbsp;<span class="builtintype" id="2874163">string</span>&nbsp;<span class="op" id="2874170">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874173">for</span>&nbsp;<span class="ident" id="2874177">i</span><span class="op" id="2874178">,</span>&nbsp;<span class="ident" id="2874180">e</span>&nbsp;<span class="op" id="2874182">:=</span>&nbsp;<span class="keyword" id="2874185">range</span>&nbsp;<span class="ident" id="2874191">elem</span>&nbsp;<span class="op" id="2874196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874200">if</span>&nbsp;<span class="ident" id="2874203">e</span>&nbsp;<span class="op" id="2874205">!=</span>&nbsp;<span class="string" id="2874208">&#34;&#34;</span>&nbsp;<span class="op" id="2874211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874216">return</span>&nbsp;<span class="ident" id="2874223">Clean</span><span class="op" id="2874228">(</span><span class="ident" id="2874229">strings</span><span class="op" id="2874236">.</span><span class="ident" id="2874237">Join</span><span class="op" id="2874241">(</span><span class="ident" id="2874242">elem</span><span class="op" id="2874246">[</span><span class="ident" id="2874247">i</span><span class="op" id="2874248">:</span><span class="op" id="2874249">]</span><span class="op" id="2874250">,</span>&nbsp;<span class="builtintype" id="2874252">string</span><span class="op" id="2874258">(</span><span class="ident" id="2874259">Separator</span><span class="op" id="2874268">)</span><span class="op" id="2874269">)</span><span class="op" id="2874270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874277">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874280">return</span>&nbsp;<span class="string" id="2874287">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="2874290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2874293">//&nbsp;Ext&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;extension&nbsp;used&nbsp;by&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="2874346">//&nbsp;The&nbsp;extension&nbsp;is&nbsp;the&nbsp;suffix&nbsp;beginning&nbsp;at&nbsp;the&nbsp;final&nbsp;dot</span><br>
<span class="lineno">210</span><span class="comment" id="2874404">//&nbsp;in&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;path;&nbsp;it&nbsp;is&nbsp;empty&nbsp;if&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2874461">//&nbsp;no&nbsp;dot.</span><br>
<span class="lineno"></span><span class="keyword" id="2874472">func</span>&nbsp;<span class="ident" id="2874477">Ext</span><span class="op" id="2874480">(</span><span class="ident" id="2874481">path</span>&nbsp;<span class="builtintype" id="2874486">string</span><span class="op" id="2874492">)</span>&nbsp;<span class="builtintype" id="2874494">string</span>&nbsp;<span class="op" id="2874501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874504">for</span>&nbsp;<span class="ident" id="2874508">i</span>&nbsp;<span class="op" id="2874510">:=</span>&nbsp;<span class="builtinfunc" id="2874513">len</span><span class="op" id="2874516">(</span><span class="ident" id="2874517">path</span><span class="op" id="2874521">)</span>&nbsp;<span class="op" id="2874523">-</span>&nbsp;<span class="num" id="2874525">1</span><span class="op" id="2874526">;</span>&nbsp;<span class="ident" id="2874528">i</span>&nbsp;<span class="op" id="2874530">&gt;=</span>&nbsp;<span class="num" id="2874533">0</span>&nbsp;<span class="op" id="2874535">&amp;&amp;</span>&nbsp;<span class="op" id="2874538">!</span><span class="ident" id="2874539">os</span><span class="op" id="2874541">.</span><span class="ident" id="2874542">IsPathSeparator</span><span class="op" id="2874557">(</span><span class="ident" id="2874558">path</span><span class="op" id="2874562">[</span><span class="ident" id="2874563">i</span><span class="op" id="2874564">]</span><span class="op" id="2874565">)</span><span class="op" id="2874566">;</span>&nbsp;<span class="ident" id="2874568">i</span><span class="op" id="2874569">--</span>&nbsp;<span class="op" id="2874572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874576">if</span>&nbsp;<span class="ident" id="2874579">path</span><span class="op" id="2874583">[</span><span class="ident" id="2874584">i</span><span class="op" id="2874585">]</span>&nbsp;<span class="op" id="2874587">==</span>&nbsp;<span class="string" id="2874590">&#39;.&#39;</span>&nbsp;<span class="op" id="2874594">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874599">return</span>&nbsp;<span class="ident" id="2874606">path</span><span class="op" id="2874610">[</span><span class="ident" id="2874611">i</span><span class="op" id="2874612">:</span><span class="op" id="2874613">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874623">return</span>&nbsp;<span class="string" id="2874630">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="2874633">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="2874636">//&nbsp;EvalSymlinks&nbsp;returns&nbsp;the&nbsp;path&nbsp;name&nbsp;after&nbsp;the&nbsp;evaluation&nbsp;of&nbsp;any&nbsp;symbolic</span><br>
<span class="lineno"></span><span class="comment" id="2874711">//&nbsp;links.</span><br>
<span class="lineno"></span><span class="comment" id="2874721">//&nbsp;If&nbsp;path&nbsp;is&nbsp;relative&nbsp;the&nbsp;result&nbsp;will&nbsp;be&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="2874798">//&nbsp;unless&nbsp;one&nbsp;of&nbsp;the&nbsp;components&nbsp;is&nbsp;an&nbsp;absolute&nbsp;symbolic&nbsp;link.</span><br>
<span class="lineno">225</span><span class="keyword" id="2874860">func</span>&nbsp;<span class="ident" id="2874865">EvalSymlinks</span><span class="op" id="2874877">(</span><span class="ident" id="2874878">path</span>&nbsp;<span class="builtintype" id="2874883">string</span><span class="op" id="2874889">)</span>&nbsp;<span class="op" id="2874891">(</span><span class="builtintype" id="2874892">string</span><span class="op" id="2874898">,</span>&nbsp;<span class="builtintype" id="2874900">error</span><span class="op" id="2874905">)</span>&nbsp;<span class="op" id="2874907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874910">return</span>&nbsp;<span class="ident" id="2874917">evalSymlinks</span><span class="op" id="2874929">(</span><span class="ident" id="2874930">path</span><span class="op" id="2874934">)</span><br>
<span class="lineno"></span><span class="op" id="2874936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2874939">//&nbsp;Abs&nbsp;returns&nbsp;an&nbsp;absolute&nbsp;representation&nbsp;of&nbsp;path.</span><br>
<span class="lineno">230</span><span class="comment" id="2874990">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;not&nbsp;absolute&nbsp;it&nbsp;will&nbsp;be&nbsp;joined&nbsp;with&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="2875056">//&nbsp;working&nbsp;directory&nbsp;to&nbsp;turn&nbsp;it&nbsp;into&nbsp;an&nbsp;absolute&nbsp;path.&nbsp;&nbsp;The&nbsp;absolute</span><br>
<span class="lineno"></span><span class="comment" id="2875125">//&nbsp;path&nbsp;name&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span><span class="keyword" id="2875187">func</span>&nbsp;<span class="ident" id="2875192">Abs</span><span class="op" id="2875195">(</span><span class="ident" id="2875196">path</span>&nbsp;<span class="builtintype" id="2875201">string</span><span class="op" id="2875207">)</span>&nbsp;<span class="op" id="2875209">(</span><span class="builtintype" id="2875210">string</span><span class="op" id="2875216">,</span>&nbsp;<span class="builtintype" id="2875218">error</span><span class="op" id="2875223">)</span>&nbsp;<span class="op" id="2875225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875228">return</span>&nbsp;<span class="ident" id="2875235">abs</span><span class="op" id="2875238">(</span><span class="ident" id="2875239">path</span><span class="op" id="2875243">)</span><br>
<span class="lineno">235</span><span class="op" id="2875245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2875248">func</span>&nbsp;<span class="ident" id="2875253">unixAbs</span><span class="op" id="2875260">(</span><span class="ident" id="2875261">path</span>&nbsp;<span class="builtintype" id="2875266">string</span><span class="op" id="2875272">)</span>&nbsp;<span class="op" id="2875274">(</span><span class="builtintype" id="2875275">string</span><span class="op" id="2875281">,</span>&nbsp;<span class="builtintype" id="2875283">error</span><span class="op" id="2875288">)</span>&nbsp;<span class="op" id="2875290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875293">if</span>&nbsp;<span class="ident" id="2875296">IsAbs</span><span class="op" id="2875301">(</span><span class="ident" id="2875302">path</span><span class="op" id="2875306">)</span>&nbsp;<span class="op" id="2875308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875312">return</span>&nbsp;<span class="ident" id="2875319">Clean</span><span class="op" id="2875324">(</span><span class="ident" id="2875325">path</span><span class="op" id="2875329">)</span><span class="op" id="2875330">,</span>&nbsp;<span class="ident" id="2875332">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2875337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875340">wd</span><span class="op" id="2875342">,</span>&nbsp;<span class="ident" id="2875344">err</span>&nbsp;<span class="op" id="2875348">:=</span>&nbsp;<span class="ident" id="2875351">os</span><span class="op" id="2875353">.</span><span class="ident" id="2875354">Getwd</span><span class="op" id="2875359">(</span><span class="op" id="2875360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875363">if</span>&nbsp;<span class="ident" id="2875366">err</span>&nbsp;<span class="op" id="2875370">!=</span>&nbsp;<span class="ident" id="2875373">nil</span>&nbsp;<span class="op" id="2875377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875381">return</span>&nbsp;<span class="string" id="2875388">&#34;&#34;</span><span class="op" id="2875390">,</span>&nbsp;<span class="ident" id="2875392">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2875397">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875400">return</span>&nbsp;<span class="ident" id="2875407">Join</span><span class="op" id="2875411">(</span><span class="ident" id="2875412">wd</span><span class="op" id="2875414">,</span>&nbsp;<span class="ident" id="2875416">path</span><span class="op" id="2875420">)</span><span class="op" id="2875421">,</span>&nbsp;<span class="ident" id="2875423">nil</span><br>
<span class="lineno"></span><span class="op" id="2875427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2875430">//&nbsp;Rel&nbsp;returns&nbsp;a&nbsp;relative&nbsp;path&nbsp;that&nbsp;is&nbsp;lexically&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="2875507">//&nbsp;joined&nbsp;to&nbsp;basepath&nbsp;with&nbsp;an&nbsp;intervening&nbsp;separator.&nbsp;That&nbsp;is,</span><br>
<span class="lineno">250</span><span class="comment" id="2875569">//&nbsp;Join(basepath,&nbsp;Rel(basepath,&nbsp;targpath))&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="2875646">//&nbsp;On&nbsp;success,&nbsp;the&nbsp;returned&nbsp;path&nbsp;will&nbsp;always&nbsp;be&nbsp;relative&nbsp;to&nbsp;basepath,</span><br>
<span class="lineno"></span><span class="comment" id="2875716">//&nbsp;even&nbsp;if&nbsp;basepath&nbsp;and&nbsp;targpath&nbsp;share&nbsp;no&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="2875768">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;targpath&nbsp;can&#39;t&nbsp;be&nbsp;made&nbsp;relative&nbsp;to&nbsp;basepath&nbsp;or&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2875845">//&nbsp;knowing&nbsp;the&nbsp;current&nbsp;working&nbsp;directory&nbsp;would&nbsp;be&nbsp;necessary&nbsp;to&nbsp;compute&nbsp;it.</span><br>
<span class="lineno">255</span><span class="keyword" id="2875920">func</span>&nbsp;<span class="ident" id="2875925">Rel</span><span class="op" id="2875928">(</span><span class="ident" id="2875929">basepath</span><span class="op" id="2875937">,</span>&nbsp;<span class="ident" id="2875939">targpath</span>&nbsp;<span class="builtintype" id="2875948">string</span><span class="op" id="2875954">)</span>&nbsp;<span class="op" id="2875956">(</span><span class="builtintype" id="2875957">string</span><span class="op" id="2875963">,</span>&nbsp;<span class="builtintype" id="2875965">error</span><span class="op" id="2875970">)</span>&nbsp;<span class="op" id="2875972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875975">baseVol</span>&nbsp;<span class="op" id="2875983">:=</span>&nbsp;<span class="ident" id="2875986">VolumeName</span><span class="op" id="2875996">(</span><span class="ident" id="2875997">basepath</span><span class="op" id="2876005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876008">targVol</span>&nbsp;<span class="op" id="2876016">:=</span>&nbsp;<span class="ident" id="2876019">VolumeName</span><span class="op" id="2876029">(</span><span class="ident" id="2876030">targpath</span><span class="op" id="2876038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876041">base</span>&nbsp;<span class="op" id="2876046">:=</span>&nbsp;<span class="ident" id="2876049">Clean</span><span class="op" id="2876054">(</span><span class="ident" id="2876055">basepath</span><span class="op" id="2876063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876066">targ</span>&nbsp;<span class="op" id="2876071">:=</span>&nbsp;<span class="ident" id="2876074">Clean</span><span class="op" id="2876079">(</span><span class="ident" id="2876080">targpath</span><span class="op" id="2876088">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876091">if</span>&nbsp;<span class="ident" id="2876094">targ</span>&nbsp;<span class="op" id="2876099">==</span>&nbsp;<span class="ident" id="2876102">base</span>&nbsp;<span class="op" id="2876107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876111">return</span>&nbsp;<span class="string" id="2876118">&#34;.&#34;</span><span class="op" id="2876121">,</span>&nbsp;<span class="ident" id="2876123">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876131">base</span>&nbsp;<span class="op" id="2876136">=</span>&nbsp;<span class="ident" id="2876138">base</span><span class="op" id="2876142">[</span><span class="builtinfunc" id="2876143">len</span><span class="op" id="2876146">(</span><span class="ident" id="2876147">baseVol</span><span class="op" id="2876154">)</span><span class="op" id="2876155">:</span><span class="op" id="2876156">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876159">targ</span>&nbsp;<span class="op" id="2876164">=</span>&nbsp;<span class="ident" id="2876166">targ</span><span class="op" id="2876170">[</span><span class="builtinfunc" id="2876171">len</span><span class="op" id="2876174">(</span><span class="ident" id="2876175">targVol</span><span class="op" id="2876182">)</span><span class="op" id="2876183">:</span><span class="op" id="2876184">]</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876187">if</span>&nbsp;<span class="ident" id="2876190">base</span>&nbsp;<span class="op" id="2876195">==</span>&nbsp;<span class="string" id="2876198">&#34;.&#34;</span>&nbsp;<span class="op" id="2876202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876206">base</span>&nbsp;<span class="op" id="2876211">=</span>&nbsp;<span class="string" id="2876213">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2876220">//&nbsp;Can&#39;t&nbsp;use&nbsp;IsAbs&nbsp;-&nbsp;`\a`&nbsp;and&nbsp;`a`&nbsp;are&nbsp;both&nbsp;relative&nbsp;in&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876285">baseSlashed</span>&nbsp;<span class="op" id="2876297">:=</span>&nbsp;<span class="builtinfunc" id="2876300">len</span><span class="op" id="2876303">(</span><span class="ident" id="2876304">base</span><span class="op" id="2876308">)</span>&nbsp;<span class="op" id="2876310">&gt;</span>&nbsp;<span class="num" id="2876312">0</span>&nbsp;<span class="op" id="2876314">&amp;&amp;</span>&nbsp;<span class="ident" id="2876317">base</span><span class="op" id="2876321">[</span><span class="num" id="2876322">0</span><span class="op" id="2876323">]</span>&nbsp;<span class="op" id="2876325">==</span>&nbsp;<span class="ident" id="2876328">Separator</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876339">targSlashed</span>&nbsp;<span class="op" id="2876351">:=</span>&nbsp;<span class="builtinfunc" id="2876354">len</span><span class="op" id="2876357">(</span><span class="ident" id="2876358">targ</span><span class="op" id="2876362">)</span>&nbsp;<span class="op" id="2876364">&gt;</span>&nbsp;<span class="num" id="2876366">0</span>&nbsp;<span class="op" id="2876368">&amp;&amp;</span>&nbsp;<span class="ident" id="2876371">targ</span><span class="op" id="2876375">[</span><span class="num" id="2876376">0</span><span class="op" id="2876377">]</span>&nbsp;<span class="op" id="2876379">==</span>&nbsp;<span class="ident" id="2876382">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876393">if</span>&nbsp;<span class="ident" id="2876396">baseSlashed</span>&nbsp;<span class="op" id="2876408">!=</span>&nbsp;<span class="ident" id="2876411">targSlashed</span>&nbsp;<span class="op" id="2876423">||</span>&nbsp;<span class="ident" id="2876426">baseVol</span>&nbsp;<span class="op" id="2876434">!=</span>&nbsp;<span class="ident" id="2876437">targVol</span>&nbsp;<span class="op" id="2876445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876449">return</span>&nbsp;<span class="string" id="2876456">&#34;&#34;</span><span class="op" id="2876458">,</span>&nbsp;<span class="ident" id="2876460">errors</span><span class="op" id="2876466">.</span><span class="ident" id="2876467">New</span><span class="op" id="2876470">(</span><span class="string" id="2876471">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="2876490">+</span>&nbsp;<span class="ident" id="2876492">targ</span>&nbsp;<span class="op" id="2876497">+</span>&nbsp;<span class="string" id="2876499">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="2876515">+</span>&nbsp;<span class="ident" id="2876517">base</span><span class="op" id="2876521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2876527">//&nbsp;Position&nbsp;base[b0:bi]&nbsp;and&nbsp;targ[t0:ti]&nbsp;at&nbsp;the&nbsp;first&nbsp;differing&nbsp;elements.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876601">bl</span>&nbsp;<span class="op" id="2876604">:=</span>&nbsp;<span class="builtinfunc" id="2876607">len</span><span class="op" id="2876610">(</span><span class="ident" id="2876611">base</span><span class="op" id="2876615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876618">tl</span>&nbsp;<span class="op" id="2876621">:=</span>&nbsp;<span class="builtinfunc" id="2876624">len</span><span class="op" id="2876627">(</span><span class="ident" id="2876628">targ</span><span class="op" id="2876632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876635">var</span>&nbsp;<span class="ident" id="2876639">b0</span><span class="op" id="2876641">,</span>&nbsp;<span class="ident" id="2876643">bi</span><span class="op" id="2876645">,</span>&nbsp;<span class="ident" id="2876647">t0</span><span class="op" id="2876649">,</span>&nbsp;<span class="ident" id="2876651">ti</span>&nbsp;<span class="builtintype" id="2876654">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876659">for</span>&nbsp;<span class="op" id="2876663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876667">for</span>&nbsp;<span class="ident" id="2876671">bi</span>&nbsp;<span class="op" id="2876674">&lt;</span>&nbsp;<span class="ident" id="2876676">bl</span>&nbsp;<span class="op" id="2876679">&amp;&amp;</span>&nbsp;<span class="ident" id="2876682">base</span><span class="op" id="2876686">[</span><span class="ident" id="2876687">bi</span><span class="op" id="2876689">]</span>&nbsp;<span class="op" id="2876691">!=</span>&nbsp;<span class="ident" id="2876694">Separator</span>&nbsp;<span class="op" id="2876704">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876709">bi</span><span class="op" id="2876711">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876720">for</span>&nbsp;<span class="ident" id="2876724">ti</span>&nbsp;<span class="op" id="2876727">&lt;</span>&nbsp;<span class="ident" id="2876729">tl</span>&nbsp;<span class="op" id="2876732">&amp;&amp;</span>&nbsp;<span class="ident" id="2876735">targ</span><span class="op" id="2876739">[</span><span class="ident" id="2876740">ti</span><span class="op" id="2876742">]</span>&nbsp;<span class="op" id="2876744">!=</span>&nbsp;<span class="ident" id="2876747">Separator</span>&nbsp;<span class="op" id="2876757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876762">ti</span><span class="op" id="2876764">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876769">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876773">if</span>&nbsp;<span class="ident" id="2876776">targ</span><span class="op" id="2876780">[</span><span class="ident" id="2876781">t0</span><span class="op" id="2876783">:</span><span class="ident" id="2876784">ti</span><span class="op" id="2876786">]</span>&nbsp;<span class="op" id="2876788">!=</span>&nbsp;<span class="ident" id="2876791">base</span><span class="op" id="2876795">[</span><span class="ident" id="2876796">b0</span><span class="op" id="2876798">:</span><span class="ident" id="2876799">bi</span><span class="op" id="2876801">]</span>&nbsp;<span class="op" id="2876803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876808">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876820">if</span>&nbsp;<span class="ident" id="2876823">bi</span>&nbsp;<span class="op" id="2876826">&lt;</span>&nbsp;<span class="ident" id="2876828">bl</span>&nbsp;<span class="op" id="2876831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876836">bi</span><span class="op" id="2876838">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876847">if</span>&nbsp;<span class="ident" id="2876850">ti</span>&nbsp;<span class="op" id="2876853">&lt;</span>&nbsp;<span class="ident" id="2876855">tl</span>&nbsp;<span class="op" id="2876858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876863">ti</span><span class="op" id="2876865">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876874">b0</span>&nbsp;<span class="op" id="2876877">=</span>&nbsp;<span class="ident" id="2876879">bi</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876884">t0</span>&nbsp;<span class="op" id="2876887">=</span>&nbsp;<span class="ident" id="2876889">ti</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876896">if</span>&nbsp;<span class="ident" id="2876899">base</span><span class="op" id="2876903">[</span><span class="ident" id="2876904">b0</span><span class="op" id="2876906">:</span><span class="ident" id="2876907">bi</span><span class="op" id="2876909">]</span>&nbsp;<span class="op" id="2876911">==</span>&nbsp;<span class="string" id="2876914">&#34;..&#34;</span>&nbsp;<span class="op" id="2876919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876923">return</span>&nbsp;<span class="string" id="2876930">&#34;&#34;</span><span class="op" id="2876932">,</span>&nbsp;<span class="ident" id="2876934">errors</span><span class="op" id="2876940">.</span><span class="ident" id="2876941">New</span><span class="op" id="2876944">(</span><span class="string" id="2876945">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="2876964">+</span>&nbsp;<span class="ident" id="2876966">targ</span>&nbsp;<span class="op" id="2876971">+</span>&nbsp;<span class="string" id="2876973">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="2876989">+</span>&nbsp;<span class="ident" id="2876991">base</span><span class="op" id="2876995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876998">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877001">if</span>&nbsp;<span class="ident" id="2877004">b0</span>&nbsp;<span class="op" id="2877007">!=</span>&nbsp;<span class="ident" id="2877010">bl</span>&nbsp;<span class="op" id="2877013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2877017">//&nbsp;Base&nbsp;elements&nbsp;left.&nbsp;Must&nbsp;go&nbsp;up&nbsp;before&nbsp;going&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877072">seps</span>&nbsp;<span class="op" id="2877077">:=</span>&nbsp;<span class="ident" id="2877080">strings</span><span class="op" id="2877087">.</span><span class="ident" id="2877088">Count</span><span class="op" id="2877093">(</span><span class="ident" id="2877094">base</span><span class="op" id="2877098">[</span><span class="ident" id="2877099">b0</span><span class="op" id="2877101">:</span><span class="ident" id="2877102">bl</span><span class="op" id="2877104">]</span><span class="op" id="2877105">,</span>&nbsp;<span class="builtintype" id="2877107">string</span><span class="op" id="2877113">(</span><span class="ident" id="2877114">Separator</span><span class="op" id="2877123">)</span><span class="op" id="2877124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877128">size</span>&nbsp;<span class="op" id="2877133">:=</span>&nbsp;<span class="num" id="2877136">2</span>&nbsp;<span class="op" id="2877138">+</span>&nbsp;<span class="ident" id="2877140">seps</span><span class="op" id="2877144">*</span><span class="num" id="2877145">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877149">if</span>&nbsp;<span class="ident" id="2877152">tl</span>&nbsp;<span class="op" id="2877155">!=</span>&nbsp;<span class="ident" id="2877158">t0</span>&nbsp;<span class="op" id="2877161">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877166">size</span>&nbsp;<span class="op" id="2877171">+=</span>&nbsp;<span class="num" id="2877174">1</span>&nbsp;<span class="op" id="2877176">+</span>&nbsp;<span class="ident" id="2877178">tl</span>&nbsp;<span class="op" id="2877181">-</span>&nbsp;<span class="ident" id="2877183">t0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2877188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877192">buf</span>&nbsp;<span class="op" id="2877196">:=</span>&nbsp;<span class="builtinfunc" id="2877199">make</span><span class="op" id="2877203">(</span><span class="op" id="2877204">[</span><span class="op" id="2877205">]</span><span class="builtintype" id="2877206">byte</span><span class="op" id="2877210">,</span>&nbsp;<span class="ident" id="2877212">size</span><span class="op" id="2877216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877220">n</span>&nbsp;<span class="op" id="2877222">:=</span>&nbsp;<span class="builtinfunc" id="2877225">copy</span><span class="op" id="2877229">(</span><span class="ident" id="2877230">buf</span><span class="op" id="2877233">,</span>&nbsp;<span class="string" id="2877235">&#34;..&#34;</span><span class="op" id="2877239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877243">for</span>&nbsp;<span class="ident" id="2877247">i</span>&nbsp;<span class="op" id="2877249">:=</span>&nbsp;<span class="num" id="2877252">0</span><span class="op" id="2877253">;</span>&nbsp;<span class="ident" id="2877255">i</span>&nbsp;<span class="op" id="2877257">&lt;</span>&nbsp;<span class="ident" id="2877259">seps</span><span class="op" id="2877263">;</span>&nbsp;<span class="ident" id="2877265">i</span><span class="op" id="2877266">++</span>&nbsp;<span class="op" id="2877269">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877274">buf</span><span class="op" id="2877277">[</span><span class="ident" id="2877278">n</span><span class="op" id="2877279">]</span>&nbsp;<span class="op" id="2877281">=</span>&nbsp;<span class="ident" id="2877283">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2877296">copy</span><span class="op" id="2877300">(</span><span class="ident" id="2877301">buf</span><span class="op" id="2877304">[</span><span class="ident" id="2877305">n</span><span class="op" id="2877306">+</span><span class="num" id="2877307">1</span><span class="op" id="2877308">:</span><span class="op" id="2877309">]</span><span class="op" id="2877310">,</span>&nbsp;<span class="string" id="2877312">&#34;..&#34;</span><span class="op" id="2877316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877321">n</span>&nbsp;<span class="op" id="2877323">+=</span>&nbsp;<span class="num" id="2877326">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2877330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877334">if</span>&nbsp;<span class="ident" id="2877337">t0</span>&nbsp;<span class="op" id="2877340">!=</span>&nbsp;<span class="ident" id="2877343">tl</span>&nbsp;<span class="op" id="2877346">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877351">buf</span><span class="op" id="2877354">[</span><span class="ident" id="2877355">n</span><span class="op" id="2877356">]</span>&nbsp;<span class="op" id="2877358">=</span>&nbsp;<span class="ident" id="2877360">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2877373">copy</span><span class="op" id="2877377">(</span><span class="ident" id="2877378">buf</span><span class="op" id="2877381">[</span><span class="ident" id="2877382">n</span><span class="op" id="2877383">+</span><span class="num" id="2877384">1</span><span class="op" id="2877385">:</span><span class="op" id="2877386">]</span><span class="op" id="2877387">,</span>&nbsp;<span class="ident" id="2877389">targ</span><span class="op" id="2877393">[</span><span class="ident" id="2877394">t0</span><span class="op" id="2877396">:</span><span class="op" id="2877397">]</span><span class="op" id="2877398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2877402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877406">return</span>&nbsp;<span class="builtintype" id="2877413">string</span><span class="op" id="2877419">(</span><span class="ident" id="2877420">buf</span><span class="op" id="2877423">)</span><span class="op" id="2877424">,</span>&nbsp;<span class="ident" id="2877426">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2877431">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877434">return</span>&nbsp;<span class="ident" id="2877441">targ</span><span class="op" id="2877445">[</span><span class="ident" id="2877446">t0</span><span class="op" id="2877448">:</span><span class="op" id="2877449">]</span><span class="op" id="2877450">,</span>&nbsp;<span class="ident" id="2877452">nil</span><br>
<span class="lineno"></span><span class="op" id="2877456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2877459">//&nbsp;SkipDir&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;return&nbsp;value&nbsp;from&nbsp;WalkFuncs&nbsp;to&nbsp;indicate&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2877528">//&nbsp;the&nbsp;directory&nbsp;named&nbsp;in&nbsp;the&nbsp;call&nbsp;is&nbsp;to&nbsp;be&nbsp;skipped.&nbsp;It&nbsp;is&nbsp;not&nbsp;returned</span><br>
<span class="lineno">325</span><span class="comment" id="2877600">//&nbsp;as&nbsp;an&nbsp;error&nbsp;by&nbsp;any&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="2877632">var</span>&nbsp;<span class="ident" id="2877636">SkipDir</span>&nbsp;<span class="op" id="2877644">=</span>&nbsp;<span class="ident" id="2877646">errors</span><span class="op" id="2877652">.</span><span class="ident" id="2877653">New</span><span class="op" id="2877656">(</span><span class="string" id="2877657">&#34;skip&nbsp;this&nbsp;directory&#34;</span><span class="op" id="2877678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2877681">//&nbsp;WalkFunc&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;function&nbsp;called&nbsp;for&nbsp;each&nbsp;file&nbsp;or&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="2877755">//&nbsp;visited&nbsp;by&nbsp;Walk.&nbsp;The&nbsp;path&nbsp;argument&nbsp;contains&nbsp;the&nbsp;argument&nbsp;to&nbsp;Walk&nbsp;as&nbsp;a</span><br>
<span class="lineno">330</span><span class="comment" id="2877828">//&nbsp;prefix;&nbsp;that&nbsp;is,&nbsp;if&nbsp;Walk&nbsp;is&nbsp;called&nbsp;with&nbsp;&#34;dir&#34;,&nbsp;which&nbsp;is&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="2877899">//&nbsp;containing&nbsp;the&nbsp;file&nbsp;&#34;a&#34;,&nbsp;the&nbsp;walk&nbsp;function&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="2877974">//&nbsp;&#34;dir/a&#34;.&nbsp;The&nbsp;info&nbsp;argument&nbsp;is&nbsp;the&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;named&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="2878043">//</span><br>
<span class="lineno"></span><span class="comment" id="2878046">//&nbsp;If&nbsp;there&nbsp;was&nbsp;a&nbsp;problem&nbsp;walking&nbsp;to&nbsp;the&nbsp;file&nbsp;or&nbsp;directory&nbsp;named&nbsp;by&nbsp;path,&nbsp;the</span><br>
<span class="lineno">335</span><span class="comment" id="2878124">//&nbsp;incoming&nbsp;error&nbsp;will&nbsp;describe&nbsp;the&nbsp;problem&nbsp;and&nbsp;the&nbsp;function&nbsp;can&nbsp;decide&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="2878200">//&nbsp;to&nbsp;handle&nbsp;that&nbsp;error&nbsp;(and&nbsp;Walk&nbsp;will&nbsp;not&nbsp;descend&nbsp;into&nbsp;that&nbsp;directory).&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2878276">//&nbsp;an&nbsp;error&nbsp;is&nbsp;returned,&nbsp;processing&nbsp;stops.&nbsp;The&nbsp;sole&nbsp;exception&nbsp;is&nbsp;that&nbsp;if&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="2878354">//&nbsp;is&nbsp;a&nbsp;directory&nbsp;and&nbsp;the&nbsp;function&nbsp;returns&nbsp;the&nbsp;special&nbsp;value&nbsp;SkipDir,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2878428">//&nbsp;contents&nbsp;of&nbsp;the&nbsp;directory&nbsp;are&nbsp;skipped&nbsp;and&nbsp;processing&nbsp;continues&nbsp;as&nbsp;usual&nbsp;on</span><br>
<span class="lineno">340</span><span class="comment" id="2878506">//&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="2878524">type</span>&nbsp;<span class="ident" id="2878529">WalkFunc</span>&nbsp;<span class="keyword" id="2878538">func</span><span class="op" id="2878542">(</span><span class="ident" id="2878543">path</span>&nbsp;<span class="builtintype" id="2878548">string</span><span class="op" id="2878554">,</span>&nbsp;<span class="ident" id="2878556">info</span>&nbsp;<span class="ident" id="2878561">os</span><span class="op" id="2878563">.</span><span class="ident" id="2878564">FileInfo</span><span class="op" id="2878572">,</span>&nbsp;<span class="ident" id="2878574">err</span>&nbsp;<span class="builtintype" id="2878578">error</span><span class="op" id="2878583">)</span>&nbsp;<span class="builtintype" id="2878585">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2878592">var</span>&nbsp;<span class="ident" id="2878596">lstat</span>&nbsp;<span class="op" id="2878602">=</span>&nbsp;<span class="ident" id="2878604">os</span><span class="op" id="2878606">.</span><span class="ident" id="2878607">Lstat</span>&nbsp;<span class="comment" id="2878613">//&nbsp;for&nbsp;testing</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="2878629">//&nbsp;walk&nbsp;recursively&nbsp;descends&nbsp;path,&nbsp;calling&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="2878675">func</span>&nbsp;<span class="ident" id="2878680">walk</span><span class="op" id="2878684">(</span><span class="ident" id="2878685">path</span>&nbsp;<span class="builtintype" id="2878690">string</span><span class="op" id="2878696">,</span>&nbsp;<span class="ident" id="2878698">info</span>&nbsp;<span class="ident" id="2878703">os</span><span class="op" id="2878705">.</span><span class="ident" id="2878706">FileInfo</span><span class="op" id="2878714">,</span>&nbsp;<span class="ident" id="2878716">walkFn</span>&nbsp;<span class="ident" id="2878723">WalkFunc</span><span class="op" id="2878731">)</span>&nbsp;<span class="builtintype" id="2878733">error</span>&nbsp;<span class="op" id="2878739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878742">err</span>&nbsp;<span class="op" id="2878746">:=</span>&nbsp;<span class="ident" id="2878749">walkFn</span><span class="op" id="2878755">(</span><span class="ident" id="2878756">path</span><span class="op" id="2878760">,</span>&nbsp;<span class="ident" id="2878762">info</span><span class="op" id="2878766">,</span>&nbsp;<span class="ident" id="2878768">nil</span><span class="op" id="2878771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878774">if</span>&nbsp;<span class="ident" id="2878777">err</span>&nbsp;<span class="op" id="2878781">!=</span>&nbsp;<span class="ident" id="2878784">nil</span>&nbsp;<span class="op" id="2878788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878792">if</span>&nbsp;<span class="ident" id="2878795">info</span><span class="op" id="2878799">.</span><span class="ident" id="2878800">IsDir</span><span class="op" id="2878805">(</span><span class="op" id="2878806">)</span>&nbsp;<span class="op" id="2878808">&amp;&amp;</span>&nbsp;<span class="ident" id="2878811">err</span>&nbsp;<span class="op" id="2878815">==</span>&nbsp;<span class="ident" id="2878818">SkipDir</span>&nbsp;<span class="op" id="2878826">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878831">return</span>&nbsp;<span class="ident" id="2878838">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2878844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878848">return</span>&nbsp;<span class="ident" id="2878855">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2878860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878864">if</span>&nbsp;<span class="op" id="2878867">!</span><span class="ident" id="2878868">info</span><span class="op" id="2878872">.</span><span class="ident" id="2878873">IsDir</span><span class="op" id="2878878">(</span><span class="op" id="2878879">)</span>&nbsp;<span class="op" id="2878881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878885">return</span>&nbsp;<span class="ident" id="2878892">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2878897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878901">names</span><span class="op" id="2878906">,</span>&nbsp;<span class="ident" id="2878908">err</span>&nbsp;<span class="op" id="2878912">:=</span>&nbsp;<span class="ident" id="2878915">readDirNames</span><span class="op" id="2878927">(</span><span class="ident" id="2878928">path</span><span class="op" id="2878932">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878935">if</span>&nbsp;<span class="ident" id="2878938">err</span>&nbsp;<span class="op" id="2878942">!=</span>&nbsp;<span class="ident" id="2878945">nil</span>&nbsp;<span class="op" id="2878949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878953">return</span>&nbsp;<span class="ident" id="2878960">walkFn</span><span class="op" id="2878966">(</span><span class="ident" id="2878967">path</span><span class="op" id="2878971">,</span>&nbsp;<span class="ident" id="2878973">info</span><span class="op" id="2878977">,</span>&nbsp;<span class="ident" id="2878979">err</span><span class="op" id="2878982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2878985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878989">for</span>&nbsp;<span class="ident" id="2878993">_</span><span class="op" id="2878994">,</span>&nbsp;<span class="ident" id="2878996">name</span>&nbsp;<span class="op" id="2879001">:=</span>&nbsp;<span class="keyword" id="2879004">range</span>&nbsp;<span class="ident" id="2879010">names</span>&nbsp;<span class="op" id="2879016">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879020">filename</span>&nbsp;<span class="op" id="2879029">:=</span>&nbsp;<span class="ident" id="2879032">Join</span><span class="op" id="2879036">(</span><span class="ident" id="2879037">path</span><span class="op" id="2879041">,</span>&nbsp;<span class="ident" id="2879043">name</span><span class="op" id="2879047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879051">fileInfo</span><span class="op" id="2879059">,</span>&nbsp;<span class="ident" id="2879061">err</span>&nbsp;<span class="op" id="2879065">:=</span>&nbsp;<span class="ident" id="2879068">lstat</span><span class="op" id="2879073">(</span><span class="ident" id="2879074">filename</span><span class="op" id="2879082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879086">if</span>&nbsp;<span class="ident" id="2879089">err</span>&nbsp;<span class="op" id="2879093">!=</span>&nbsp;<span class="ident" id="2879096">nil</span>&nbsp;<span class="op" id="2879100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879105">if</span>&nbsp;<span class="ident" id="2879108">err</span>&nbsp;<span class="op" id="2879112">:=</span>&nbsp;<span class="ident" id="2879115">walkFn</span><span class="op" id="2879121">(</span><span class="ident" id="2879122">filename</span><span class="op" id="2879130">,</span>&nbsp;<span class="ident" id="2879132">fileInfo</span><span class="op" id="2879140">,</span>&nbsp;<span class="ident" id="2879142">err</span><span class="op" id="2879145">)</span><span class="op" id="2879146">;</span>&nbsp;<span class="ident" id="2879148">err</span>&nbsp;<span class="op" id="2879152">!=</span>&nbsp;<span class="ident" id="2879155">nil</span>&nbsp;<span class="op" id="2879159">&amp;&amp;</span>&nbsp;<span class="ident" id="2879162">err</span>&nbsp;<span class="op" id="2879166">!=</span>&nbsp;<span class="ident" id="2879169">SkipDir</span>&nbsp;<span class="op" id="2879177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879183">return</span>&nbsp;<span class="ident" id="2879190">err</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879201">}</span>&nbsp;<span class="keyword" id="2879203">else</span>&nbsp;<span class="op" id="2879208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879213">err</span>&nbsp;<span class="op" id="2879217">=</span>&nbsp;<span class="ident" id="2879219">walk</span><span class="op" id="2879223">(</span><span class="ident" id="2879224">filename</span><span class="op" id="2879232">,</span>&nbsp;<span class="ident" id="2879234">fileInfo</span><span class="op" id="2879242">,</span>&nbsp;<span class="ident" id="2879244">walkFn</span><span class="op" id="2879250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879255">if</span>&nbsp;<span class="ident" id="2879258">err</span>&nbsp;<span class="op" id="2879262">!=</span>&nbsp;<span class="ident" id="2879265">nil</span>&nbsp;<span class="op" id="2879269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879275">if</span>&nbsp;<span class="op" id="2879278">!</span><span class="ident" id="2879279">fileInfo</span><span class="op" id="2879287">.</span><span class="ident" id="2879288">IsDir</span><span class="op" id="2879293">(</span><span class="op" id="2879294">)</span>&nbsp;<span class="op" id="2879296">||</span>&nbsp;<span class="ident" id="2879299">err</span>&nbsp;<span class="op" id="2879303">!=</span>&nbsp;<span class="ident" id="2879306">SkipDir</span>&nbsp;<span class="op" id="2879314">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879321">return</span>&nbsp;<span class="ident" id="2879328">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879348">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879351">return</span>&nbsp;<span class="ident" id="2879358">nil</span><br>
<span class="lineno"></span><span class="op" id="2879362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2879365">//&nbsp;Walk&nbsp;walks&nbsp;the&nbsp;file&nbsp;tree&nbsp;rooted&nbsp;at&nbsp;root,&nbsp;calling&nbsp;walkFn&nbsp;for&nbsp;each&nbsp;file&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2879441">//&nbsp;directory&nbsp;in&nbsp;the&nbsp;tree,&nbsp;including&nbsp;root.&nbsp;All&nbsp;errors&nbsp;that&nbsp;arise&nbsp;visiting&nbsp;files</span><br>
<span class="lineno">385</span><span class="comment" id="2879520">//&nbsp;and&nbsp;directories&nbsp;are&nbsp;filtered&nbsp;by&nbsp;walkFn.&nbsp;The&nbsp;files&nbsp;are&nbsp;walked&nbsp;in&nbsp;lexical</span><br>
<span class="lineno"></span><span class="comment" id="2879595">//&nbsp;order,&nbsp;which&nbsp;makes&nbsp;the&nbsp;output&nbsp;deterministic&nbsp;but&nbsp;means&nbsp;that&nbsp;for&nbsp;very</span><br>
<span class="lineno"></span><span class="comment" id="2879666">//&nbsp;large&nbsp;directories&nbsp;Walk&nbsp;can&nbsp;be&nbsp;inefficient.</span><br>
<span class="lineno"></span><span class="comment" id="2879712">//&nbsp;Walk&nbsp;does&nbsp;not&nbsp;follow&nbsp;symbolic&nbsp;links.</span><br>
<span class="lineno"></span><span class="keyword" id="2879752">func</span>&nbsp;<span class="ident" id="2879757">Walk</span><span class="op" id="2879761">(</span><span class="ident" id="2879762">root</span>&nbsp;<span class="builtintype" id="2879767">string</span><span class="op" id="2879773">,</span>&nbsp;<span class="ident" id="2879775">walkFn</span>&nbsp;<span class="ident" id="2879782">WalkFunc</span><span class="op" id="2879790">)</span>&nbsp;<span class="builtintype" id="2879792">error</span>&nbsp;<span class="op" id="2879798">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879801">info</span><span class="op" id="2879805">,</span>&nbsp;<span class="ident" id="2879807">err</span>&nbsp;<span class="op" id="2879811">:=</span>&nbsp;<span class="ident" id="2879814">os</span><span class="op" id="2879816">.</span><span class="ident" id="2879817">Lstat</span><span class="op" id="2879822">(</span><span class="ident" id="2879823">root</span><span class="op" id="2879827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879830">if</span>&nbsp;<span class="ident" id="2879833">err</span>&nbsp;<span class="op" id="2879837">!=</span>&nbsp;<span class="ident" id="2879840">nil</span>&nbsp;<span class="op" id="2879844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879848">return</span>&nbsp;<span class="ident" id="2879855">walkFn</span><span class="op" id="2879861">(</span><span class="ident" id="2879862">root</span><span class="op" id="2879866">,</span>&nbsp;<span class="ident" id="2879868">nil</span><span class="op" id="2879871">,</span>&nbsp;<span class="ident" id="2879873">err</span><span class="op" id="2879876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879882">return</span>&nbsp;<span class="ident" id="2879889">walk</span><span class="op" id="2879893">(</span><span class="ident" id="2879894">root</span><span class="op" id="2879898">,</span>&nbsp;<span class="ident" id="2879900">info</span><span class="op" id="2879904">,</span>&nbsp;<span class="ident" id="2879906">walkFn</span><span class="op" id="2879912">)</span><br>
<span class="lineno">395</span><span class="op" id="2879914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2879917">//&nbsp;readDirNames&nbsp;reads&nbsp;the&nbsp;directory&nbsp;named&nbsp;by&nbsp;dirname&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="2879982">//&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="2880021">func</span>&nbsp;<span class="ident" id="2880026">readDirNames</span><span class="op" id="2880038">(</span><span class="ident" id="2880039">dirname</span>&nbsp;<span class="builtintype" id="2880047">string</span><span class="op" id="2880053">)</span>&nbsp;<span class="op" id="2880055">(</span><span class="op" id="2880056">[</span><span class="op" id="2880057">]</span><span class="builtintype" id="2880058">string</span><span class="op" id="2880064">,</span>&nbsp;<span class="builtintype" id="2880066">error</span><span class="op" id="2880071">)</span>&nbsp;<span class="op" id="2880073">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880076">f</span><span class="op" id="2880077">,</span>&nbsp;<span class="ident" id="2880079">err</span>&nbsp;<span class="op" id="2880083">:=</span>&nbsp;<span class="ident" id="2880086">os</span><span class="op" id="2880088">.</span><span class="ident" id="2880089">Open</span><span class="op" id="2880093">(</span><span class="ident" id="2880094">dirname</span><span class="op" id="2880101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880104">if</span>&nbsp;<span class="ident" id="2880107">err</span>&nbsp;<span class="op" id="2880111">!=</span>&nbsp;<span class="ident" id="2880114">nil</span>&nbsp;<span class="op" id="2880118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880122">return</span>&nbsp;<span class="ident" id="2880129">nil</span><span class="op" id="2880132">,</span>&nbsp;<span class="ident" id="2880134">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2880139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880142">names</span><span class="op" id="2880147">,</span>&nbsp;<span class="ident" id="2880149">err</span>&nbsp;<span class="op" id="2880153">:=</span>&nbsp;<span class="ident" id="2880156">f</span><span class="op" id="2880157">.</span><span class="ident" id="2880158">Readdirnames</span><span class="op" id="2880170">(</span><span class="op" id="2880171">-</span><span class="num" id="2880172">1</span><span class="op" id="2880173">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880176">f</span><span class="op" id="2880177">.</span><span class="ident" id="2880178">Close</span><span class="op" id="2880183">(</span><span class="op" id="2880184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880187">if</span>&nbsp;<span class="ident" id="2880190">err</span>&nbsp;<span class="op" id="2880194">!=</span>&nbsp;<span class="ident" id="2880197">nil</span>&nbsp;<span class="op" id="2880201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880205">return</span>&nbsp;<span class="ident" id="2880212">nil</span><span class="op" id="2880215">,</span>&nbsp;<span class="ident" id="2880217">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2880222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880225">sort</span><span class="op" id="2880229">.</span><span class="ident" id="2880230">Strings</span><span class="op" id="2880237">(</span><span class="ident" id="2880238">names</span><span class="op" id="2880243">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880246">return</span>&nbsp;<span class="ident" id="2880253">names</span><span class="op" id="2880258">,</span>&nbsp;<span class="ident" id="2880260">nil</span><br>
<span class="lineno"></span><span class="op" id="2880264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2880267">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="2880309">//&nbsp;Trailing&nbsp;path&nbsp;separators&nbsp;are&nbsp;removed&nbsp;before&nbsp;extracting&nbsp;the&nbsp;last&nbsp;element.</span><br>
<span class="lineno">415</span><span class="comment" id="2880385">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Base&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2880428">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Base&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="keyword" id="2880509">func</span>&nbsp;<span class="ident" id="2880514">Base</span><span class="op" id="2880518">(</span><span class="ident" id="2880519">path</span>&nbsp;<span class="builtintype" id="2880524">string</span><span class="op" id="2880530">)</span>&nbsp;<span class="builtintype" id="2880532">string</span>&nbsp;<span class="op" id="2880539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880542">if</span>&nbsp;<span class="ident" id="2880545">path</span>&nbsp;<span class="op" id="2880550">==</span>&nbsp;<span class="string" id="2880553">&#34;&#34;</span>&nbsp;<span class="op" id="2880556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880560">return</span>&nbsp;<span class="string" id="2880567">&#34;.&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2880572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2880575">//&nbsp;Strip&nbsp;trailing&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880603">for</span>&nbsp;<span class="builtinfunc" id="2880607">len</span><span class="op" id="2880610">(</span><span class="ident" id="2880611">path</span><span class="op" id="2880615">)</span>&nbsp;<span class="op" id="2880617">&gt;</span>&nbsp;<span class="num" id="2880619">0</span>&nbsp;<span class="op" id="2880621">&amp;&amp;</span>&nbsp;<span class="ident" id="2880624">os</span><span class="op" id="2880626">.</span><span class="ident" id="2880627">IsPathSeparator</span><span class="op" id="2880642">(</span><span class="ident" id="2880643">path</span><span class="op" id="2880647">[</span><span class="builtinfunc" id="2880648">len</span><span class="op" id="2880651">(</span><span class="ident" id="2880652">path</span><span class="op" id="2880656">)</span><span class="op" id="2880657">-</span><span class="num" id="2880658">1</span><span class="op" id="2880659">]</span><span class="op" id="2880660">)</span>&nbsp;<span class="op" id="2880662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880666">path</span>&nbsp;<span class="op" id="2880671">=</span>&nbsp;<span class="ident" id="2880673">path</span><span class="op" id="2880677">[</span><span class="num" id="2880678">0</span>&nbsp;<span class="op" id="2880680">:</span>&nbsp;<span class="builtinfunc" id="2880682">len</span><span class="op" id="2880685">(</span><span class="ident" id="2880686">path</span><span class="op" id="2880690">)</span><span class="op" id="2880691">-</span><span class="num" id="2880692">1</span><span class="op" id="2880693">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2880696">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2880699">//&nbsp;Throw&nbsp;away&nbsp;volume&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880726">path</span>&nbsp;<span class="op" id="2880731">=</span>&nbsp;<span class="ident" id="2880733">path</span><span class="op" id="2880737">[</span><span class="builtinfunc" id="2880738">len</span><span class="op" id="2880741">(</span><span class="ident" id="2880742">VolumeName</span><span class="op" id="2880752">(</span><span class="ident" id="2880753">path</span><span class="op" id="2880757">)</span><span class="op" id="2880758">)</span><span class="op" id="2880759">:</span><span class="op" id="2880760">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2880763">//&nbsp;Find&nbsp;the&nbsp;last&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880789">i</span>&nbsp;<span class="op" id="2880791">:=</span>&nbsp;<span class="builtinfunc" id="2880794">len</span><span class="op" id="2880797">(</span><span class="ident" id="2880798">path</span><span class="op" id="2880802">)</span>&nbsp;<span class="op" id="2880804">-</span>&nbsp;<span class="num" id="2880806">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880809">for</span>&nbsp;<span class="ident" id="2880813">i</span>&nbsp;<span class="op" id="2880815">&gt;=</span>&nbsp;<span class="num" id="2880818">0</span>&nbsp;<span class="op" id="2880820">&amp;&amp;</span>&nbsp;<span class="op" id="2880823">!</span><span class="ident" id="2880824">os</span><span class="op" id="2880826">.</span><span class="ident" id="2880827">IsPathSeparator</span><span class="op" id="2880842">(</span><span class="ident" id="2880843">path</span><span class="op" id="2880847">[</span><span class="ident" id="2880848">i</span><span class="op" id="2880849">]</span><span class="op" id="2880850">)</span>&nbsp;<span class="op" id="2880852">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880856">i</span><span class="op" id="2880857">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2880861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880864">if</span>&nbsp;<span class="ident" id="2880867">i</span>&nbsp;<span class="op" id="2880869">&gt;=</span>&nbsp;<span class="num" id="2880872">0</span>&nbsp;<span class="op" id="2880874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880878">path</span>&nbsp;<span class="op" id="2880883">=</span>&nbsp;<span class="ident" id="2880885">path</span><span class="op" id="2880889">[</span><span class="ident" id="2880890">i</span><span class="op" id="2880891">+</span><span class="num" id="2880892">1</span><span class="op" id="2880893">:</span><span class="op" id="2880894">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2880897">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2880900">//&nbsp;If&nbsp;empty&nbsp;now,&nbsp;it&nbsp;had&nbsp;only&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880939">if</span>&nbsp;<span class="ident" id="2880942">path</span>&nbsp;<span class="op" id="2880947">==</span>&nbsp;<span class="string" id="2880950">&#34;&#34;</span>&nbsp;<span class="op" id="2880953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880957">return</span>&nbsp;<span class="builtintype" id="2880964">string</span><span class="op" id="2880970">(</span><span class="ident" id="2880971">Separator</span><span class="op" id="2880980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2880983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880986">return</span>&nbsp;<span class="ident" id="2880993">path</span><br>
<span class="lineno">440</span><span class="op" id="2880998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2881001">//&nbsp;Dir&nbsp;returns&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path,&nbsp;typically&nbsp;the&nbsp;path&#39;s&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="2881082">//&nbsp;After&nbsp;dropping&nbsp;the&nbsp;final&nbsp;element,&nbsp;the&nbsp;path&nbsp;is&nbsp;Cleaned&nbsp;and&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2881152">//&nbsp;slashes&nbsp;are&nbsp;removed.</span><br>
<span class="lineno">445</span><span class="comment" id="2881176">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Dir&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2881218">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Dir&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="comment" id="2881298">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;a&nbsp;separator&nbsp;unless&nbsp;it&nbsp;is&nbsp;the&nbsp;root&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="2881380">func</span>&nbsp;<span class="ident" id="2881385">Dir</span><span class="op" id="2881388">(</span><span class="ident" id="2881389">path</span>&nbsp;<span class="builtintype" id="2881394">string</span><span class="op" id="2881400">)</span>&nbsp;<span class="builtintype" id="2881402">string</span>&nbsp;<span class="op" id="2881409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2881412">vol</span>&nbsp;<span class="op" id="2881416">:=</span>&nbsp;<span class="ident" id="2881419">VolumeName</span><span class="op" id="2881429">(</span><span class="ident" id="2881430">path</span><span class="op" id="2881434">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2881437">i</span>&nbsp;<span class="op" id="2881439">:=</span>&nbsp;<span class="builtinfunc" id="2881442">len</span><span class="op" id="2881445">(</span><span class="ident" id="2881446">path</span><span class="op" id="2881450">)</span>&nbsp;<span class="op" id="2881452">-</span>&nbsp;<span class="num" id="2881454">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2881457">for</span>&nbsp;<span class="ident" id="2881461">i</span>&nbsp;<span class="op" id="2881463">&gt;=</span>&nbsp;<span class="builtinfunc" id="2881466">len</span><span class="op" id="2881469">(</span><span class="ident" id="2881470">vol</span><span class="op" id="2881473">)</span>&nbsp;<span class="op" id="2881475">&amp;&amp;</span>&nbsp;<span class="op" id="2881478">!</span><span class="ident" id="2881479">os</span><span class="op" id="2881481">.</span><span class="ident" id="2881482">IsPathSeparator</span><span class="op" id="2881497">(</span><span class="ident" id="2881498">path</span><span class="op" id="2881502">[</span><span class="ident" id="2881503">i</span><span class="op" id="2881504">]</span><span class="op" id="2881505">)</span>&nbsp;<span class="op" id="2881507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2881511">i</span><span class="op" id="2881512">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2881516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2881519">dir</span>&nbsp;<span class="op" id="2881523">:=</span>&nbsp;<span class="ident" id="2881526">Clean</span><span class="op" id="2881531">(</span><span class="ident" id="2881532">path</span><span class="op" id="2881536">[</span><span class="builtinfunc" id="2881537">len</span><span class="op" id="2881540">(</span><span class="ident" id="2881541">vol</span><span class="op" id="2881544">)</span>&nbsp;<span class="op" id="2881546">:</span>&nbsp;<span class="ident" id="2881548">i</span><span class="op" id="2881549">+</span><span class="num" id="2881550">1</span><span class="op" id="2881551">]</span><span class="op" id="2881552">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2881555">return</span>&nbsp;<span class="ident" id="2881562">vol</span>&nbsp;<span class="op" id="2881566">+</span>&nbsp;<span class="ident" id="2881568">dir</span><br>
<span class="lineno"></span><span class="op" id="2881572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2881575">//&nbsp;VolumeName&nbsp;returns&nbsp;leading&nbsp;volume&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="2881618">//&nbsp;Given&nbsp;&#34;C:\foo\bar&#34;&nbsp;it&nbsp;returns&nbsp;&#34;C:&#34;&nbsp;under&nbsp;windows.</span><br>
<span class="lineno">460</span><span class="comment" id="2881671">//&nbsp;Given&nbsp;&#34;\\host\share\foo&#34;&nbsp;it&nbsp;returns&nbsp;&#34;\\host\share&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2881726">//&nbsp;On&nbsp;other&nbsp;platforms&nbsp;it&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="2881763">func</span>&nbsp;<span class="ident" id="2881768">VolumeName</span><span class="op" id="2881778">(</span><span class="ident" id="2881779">path</span>&nbsp;<span class="builtintype" id="2881784">string</span><span class="op" id="2881790">)</span>&nbsp;<span class="op" id="2881792">(</span><span class="ident" id="2881793">v</span>&nbsp;<span class="builtintype" id="2881795">string</span><span class="op" id="2881801">)</span>&nbsp;<span class="op" id="2881803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2881806">return</span>&nbsp;<span class="ident" id="2881813">path</span><span class="op" id="2881817">[</span><span class="op" id="2881818">:</span><span class="ident" id="2881819">volumeNameLen</span><span class="op" id="2881832">(</span><span class="ident" id="2881833">path</span><span class="op" id="2881837">)</span><span class="op" id="2881838">]</span><br>
<span class="lineno"></span><span class="op" id="2881840">}</span>
</div>
</body>
</html>
