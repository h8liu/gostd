<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4179934">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4179989">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4180043">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4180094">package</span>&nbsp;<span class="ident" id="4180102">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4180107">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;PSS&nbsp;signature&nbsp;scheme&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="4180161">//</span><br>
<span class="lineno"></span><span class="comment" id="4180164">//&nbsp;[1]&nbsp;http://www.rsa.com/rsalabs/pkcs/files/h11300-wp-pkcs-1v2-2-rsa-cryptography-standard.pdf</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4180261">import</span>&nbsp;<span class="op" id="4180268">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4180271">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4180280">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4180290">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4180300">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4180308">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4180314">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4180325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4180328">func</span>&nbsp;<span class="ident" id="4180333">emsaPSSEncode</span><span class="op" id="4180346">(</span><span class="ident" id="4180347">mHash</span>&nbsp;<span class="op" id="4180353">[</span><span class="op" id="4180354">]</span><span class="builtintype" id="4180355">byte</span><span class="op" id="4180359">,</span>&nbsp;<span class="ident" id="4180361">emBits</span>&nbsp;<span class="builtintype" id="4180368">int</span><span class="op" id="4180371">,</span>&nbsp;<span class="ident" id="4180373">salt</span>&nbsp;<span class="op" id="4180378">[</span><span class="op" id="4180379">]</span><span class="builtintype" id="4180380">byte</span><span class="op" id="4180384">,</span>&nbsp;<span class="ident" id="4180386">hash</span>&nbsp;<span class="ident" id="4180391">hash</span><span class="op" id="4180395">.</span><span class="ident" id="4180396">Hash</span><span class="op" id="4180400">)</span>&nbsp;<span class="op" id="4180402">(</span><span class="op" id="4180403">[</span><span class="op" id="4180404">]</span><span class="builtintype" id="4180405">byte</span><span class="op" id="4180409">,</span>&nbsp;<span class="builtintype" id="4180411">error</span><span class="op" id="4180416">)</span>&nbsp;<span class="op" id="4180418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180421">//&nbsp;See&nbsp;[1],&nbsp;section&nbsp;9.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180448">hLen</span>&nbsp;<span class="op" id="4180453">:=</span>&nbsp;<span class="ident" id="4180456">hash</span><span class="op" id="4180460">.</span><span class="ident" id="4180461">Size</span><span class="op" id="4180465">(</span><span class="op" id="4180466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180469">sLen</span>&nbsp;<span class="op" id="4180474">:=</span>&nbsp;<span class="builtinfunc" id="4180477">len</span><span class="op" id="4180480">(</span><span class="ident" id="4180481">salt</span><span class="op" id="4180485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180488">emLen</span>&nbsp;<span class="op" id="4180494">:=</span>&nbsp;<span class="op" id="4180497">(</span><span class="ident" id="4180498">emBits</span>&nbsp;<span class="op" id="4180505">+</span>&nbsp;<span class="num" id="4180507">7</span><span class="op" id="4180508">)</span>&nbsp;<span class="op" id="4180510">/</span>&nbsp;<span class="num" id="4180512">8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180516">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180588">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;message&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180659">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180683">//</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180687">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180749">if</span>&nbsp;<span class="builtinfunc" id="4180752">len</span><span class="op" id="4180755">(</span><span class="ident" id="4180756">mHash</span><span class="op" id="4180761">)</span>&nbsp;<span class="op" id="4180763">!=</span>&nbsp;<span class="ident" id="4180766">hLen</span>&nbsp;<span class="op" id="4180771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180775">return</span>&nbsp;<span class="ident" id="4180782">nil</span><span class="op" id="4180785">,</span>&nbsp;<span class="ident" id="4180787">errors</span><span class="op" id="4180793">.</span><span class="ident" id="4180794">New</span><span class="op" id="4180797">(</span><span class="string" id="4180798">&#34;crypto/rsa:&nbsp;input&nbsp;must&nbsp;be&nbsp;hashed&nbsp;message&#34;</span><span class="op" id="4180840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180843">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180847">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;encoding&nbsp;error&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180918">if</span>&nbsp;<span class="ident" id="4180921">emLen</span>&nbsp;<span class="op" id="4180927">&lt;</span>&nbsp;<span class="ident" id="4180929">hLen</span><span class="op" id="4180933">+</span><span class="ident" id="4180934">sLen</span><span class="op" id="4180938">+</span><span class="num" id="4180939">2</span>&nbsp;<span class="op" id="4180941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180945">return</span>&nbsp;<span class="ident" id="4180952">nil</span><span class="op" id="4180955">,</span>&nbsp;<span class="ident" id="4180957">errors</span><span class="op" id="4180963">.</span><span class="ident" id="4180964">New</span><span class="op" id="4180967">(</span><span class="string" id="4180968">&#34;crypto/rsa:&nbsp;encoding&nbsp;error&#34;</span><span class="op" id="4180996">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181003">em</span>&nbsp;<span class="op" id="4181006">:=</span>&nbsp;<span class="builtinfunc" id="4181009">make</span><span class="op" id="4181013">(</span><span class="op" id="4181014">[</span><span class="op" id="4181015">]</span><span class="builtintype" id="4181016">byte</span><span class="op" id="4181020">,</span>&nbsp;<span class="ident" id="4181022">emLen</span><span class="op" id="4181027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181030">db</span>&nbsp;<span class="op" id="4181033">:=</span>&nbsp;<span class="ident" id="4181036">em</span><span class="op" id="4181038">[</span><span class="op" id="4181039">:</span><span class="ident" id="4181040">emLen</span><span class="op" id="4181045">-</span><span class="ident" id="4181046">sLen</span><span class="op" id="4181050">-</span><span class="ident" id="4181051">hLen</span><span class="op" id="4181055">-</span><span class="num" id="4181056">2</span><span class="op" id="4181057">+</span><span class="num" id="4181058">1</span><span class="op" id="4181059">+</span><span class="ident" id="4181060">sLen</span><span class="op" id="4181064">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181067">h</span>&nbsp;<span class="op" id="4181069">:=</span>&nbsp;<span class="ident" id="4181072">em</span><span class="op" id="4181074">[</span><span class="ident" id="4181075">emLen</span><span class="op" id="4181080">-</span><span class="ident" id="4181081">sLen</span><span class="op" id="4181085">-</span><span class="ident" id="4181086">hLen</span><span class="op" id="4181090">-</span><span class="num" id="4181091">2</span><span class="op" id="4181092">+</span><span class="num" id="4181093">1</span><span class="op" id="4181094">+</span><span class="ident" id="4181095">sLen</span>&nbsp;<span class="op" id="4181100">:</span>&nbsp;<span class="ident" id="4181102">emLen</span><span class="op" id="4181107">-</span><span class="num" id="4181108">1</span><span class="op" id="4181109">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181113">//&nbsp;4.&nbsp;&nbsp;Generate&nbsp;a&nbsp;random&nbsp;octet&nbsp;string&nbsp;salt&nbsp;of&nbsp;length&nbsp;sLen;&nbsp;if&nbsp;sLen&nbsp;=&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181186">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;salt&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181225">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181229">//&nbsp;5.&nbsp;&nbsp;Let</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181241">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181302">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181306">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181373">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181402">//</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181406">//&nbsp;6.&nbsp;&nbsp;Let&nbsp;H&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181465">var</span>&nbsp;<span class="ident" id="4181469">prefix</span>&nbsp;<span class="op" id="4181476">[</span><span class="num" id="4181477">8</span><span class="op" id="4181478">]</span><span class="builtintype" id="4181479">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181486">hash</span><span class="op" id="4181490">.</span><span class="ident" id="4181491">Write</span><span class="op" id="4181496">(</span><span class="ident" id="4181497">prefix</span><span class="op" id="4181503">[</span><span class="op" id="4181504">:</span><span class="op" id="4181505">]</span><span class="op" id="4181506">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181509">hash</span><span class="op" id="4181513">.</span><span class="ident" id="4181514">Write</span><span class="op" id="4181519">(</span><span class="ident" id="4181520">mHash</span><span class="op" id="4181525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181528">hash</span><span class="op" id="4181532">.</span><span class="ident" id="4181533">Write</span><span class="op" id="4181538">(</span><span class="ident" id="4181539">salt</span><span class="op" id="4181543">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181547">h</span>&nbsp;<span class="op" id="4181549">=</span>&nbsp;<span class="ident" id="4181551">hash</span><span class="op" id="4181555">.</span><span class="ident" id="4181556">Sum</span><span class="op" id="4181559">(</span><span class="ident" id="4181560">h</span><span class="op" id="4181561">[</span><span class="op" id="4181562">:</span><span class="num" id="4181563">0</span><span class="op" id="4181564">]</span><span class="op" id="4181565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181568">hash</span><span class="op" id="4181572">.</span><span class="ident" id="4181573">Reset</span><span class="op" id="4181578">(</span><span class="op" id="4181579">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181583">//&nbsp;7.&nbsp;&nbsp;Generate&nbsp;an&nbsp;octet&nbsp;string&nbsp;PS&nbsp;consisting&nbsp;of&nbsp;emLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181657">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zero&nbsp;octets.&nbsp;&nbsp;The&nbsp;length&nbsp;of&nbsp;PS&nbsp;may&nbsp;be&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181706">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181710">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;PS&nbsp;||&nbsp;0x01&nbsp;||&nbsp;salt;&nbsp;DB&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181779">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181806">db</span><span class="op" id="4181808">[</span><span class="ident" id="4181809">emLen</span><span class="op" id="4181814">-</span><span class="ident" id="4181815">sLen</span><span class="op" id="4181819">-</span><span class="ident" id="4181820">hLen</span><span class="op" id="4181824">-</span><span class="num" id="4181825">2</span><span class="op" id="4181826">]</span>&nbsp;<span class="op" id="4181828">=</span>&nbsp;<span class="num" id="4181830">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4181836">copy</span><span class="op" id="4181840">(</span><span class="ident" id="4181841">db</span><span class="op" id="4181843">[</span><span class="ident" id="4181844">emLen</span><span class="op" id="4181849">-</span><span class="ident" id="4181850">sLen</span><span class="op" id="4181854">-</span><span class="ident" id="4181855">hLen</span><span class="op" id="4181859">-</span><span class="num" id="4181860">1</span><span class="op" id="4181861">:</span><span class="op" id="4181862">]</span><span class="op" id="4181863">,</span>&nbsp;<span class="ident" id="4181865">salt</span><span class="op" id="4181869">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181873">//&nbsp;9.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181920">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181924">//&nbsp;10.&nbsp;Let&nbsp;maskedDB&nbsp;=&nbsp;DB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181964">mgf1XOR</span><span class="op" id="4181971">(</span><span class="ident" id="4181972">db</span><span class="op" id="4181974">,</span>&nbsp;<span class="ident" id="4181976">hash</span><span class="op" id="4181980">,</span>&nbsp;<span class="ident" id="4181982">h</span><span class="op" id="4181983">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181987">//&nbsp;11.&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182061">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182088">db</span><span class="op" id="4182090">[</span><span class="num" id="4182091">0</span><span class="op" id="4182092">]</span>&nbsp;<span class="op" id="4182094">&amp;=</span>&nbsp;<span class="op" id="4182097">(</span><span class="num" id="4182098">0xFF</span>&nbsp;<span class="op" id="4182103">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4182106">uint</span><span class="op" id="4182110">(</span><span class="num" id="4182111">8</span><span class="op" id="4182112">*</span><span class="ident" id="4182113">emLen</span><span class="op" id="4182118">-</span><span class="ident" id="4182119">emBits</span><span class="op" id="4182125">)</span><span class="op" id="4182126">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182130">//&nbsp;12.&nbsp;Let&nbsp;EM&nbsp;=&nbsp;maskedDB&nbsp;||&nbsp;H&nbsp;||&nbsp;0xbc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182170">em</span><span class="op" id="4182172">[</span><span class="ident" id="4182173">emLen</span><span class="op" id="4182178">-</span><span class="num" id="4182179">1</span><span class="op" id="4182180">]</span>&nbsp;<span class="op" id="4182182">=</span>&nbsp;<span class="num" id="4182184">0xBC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182191">//&nbsp;13.&nbsp;Output&nbsp;EM.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182210">return</span>&nbsp;<span class="ident" id="4182217">em</span><span class="op" id="4182219">,</span>&nbsp;<span class="ident" id="4182221">nil</span><br>
<span class="lineno"></span><span class="op" id="4182225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4182228">func</span>&nbsp;<span class="ident" id="4182233">emsaPSSVerify</span><span class="op" id="4182246">(</span><span class="ident" id="4182247">mHash</span><span class="op" id="4182252">,</span>&nbsp;<span class="ident" id="4182254">em</span>&nbsp;<span class="op" id="4182257">[</span><span class="op" id="4182258">]</span><span class="builtintype" id="4182259">byte</span><span class="op" id="4182263">,</span>&nbsp;<span class="ident" id="4182265">emBits</span><span class="op" id="4182271">,</span>&nbsp;<span class="ident" id="4182273">sLen</span>&nbsp;<span class="builtintype" id="4182278">int</span><span class="op" id="4182281">,</span>&nbsp;<span class="ident" id="4182283">hash</span>&nbsp;<span class="ident" id="4182288">hash</span><span class="op" id="4182292">.</span><span class="ident" id="4182293">Hash</span><span class="op" id="4182297">)</span>&nbsp;<span class="builtintype" id="4182299">error</span>&nbsp;<span class="op" id="4182305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182308">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182380">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;inconsistent&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182453">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182471">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182475">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182536">hLen</span>&nbsp;<span class="op" id="4182541">:=</span>&nbsp;<span class="ident" id="4182544">hash</span><span class="op" id="4182548">.</span><span class="ident" id="4182549">Size</span><span class="op" id="4182553">(</span><span class="op" id="4182554">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182557">if</span>&nbsp;<span class="ident" id="4182560">hLen</span>&nbsp;<span class="op" id="4182565">!=</span>&nbsp;<span class="builtinfunc" id="4182568">len</span><span class="op" id="4182571">(</span><span class="ident" id="4182572">mHash</span><span class="op" id="4182577">)</span>&nbsp;<span class="op" id="4182579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182583">return</span>&nbsp;<span class="ident" id="4182590">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182611">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182679">emLen</span>&nbsp;<span class="op" id="4182685">:=</span>&nbsp;<span class="op" id="4182688">(</span><span class="ident" id="4182689">emBits</span>&nbsp;<span class="op" id="4182696">+</span>&nbsp;<span class="num" id="4182698">7</span><span class="op" id="4182699">)</span>&nbsp;<span class="op" id="4182701">/</span>&nbsp;<span class="num" id="4182703">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182706">if</span>&nbsp;<span class="ident" id="4182709">emLen</span>&nbsp;<span class="op" id="4182715">&lt;</span>&nbsp;<span class="ident" id="4182717">hLen</span><span class="op" id="4182721">+</span><span class="ident" id="4182722">sLen</span><span class="op" id="4182726">+</span><span class="num" id="4182727">2</span>&nbsp;<span class="op" id="4182729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182733">return</span>&nbsp;<span class="ident" id="4182740">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182761">//&nbsp;4.&nbsp;&nbsp;If&nbsp;the&nbsp;rightmost&nbsp;octet&nbsp;of&nbsp;EM&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182830">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbc,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182876">if</span>&nbsp;<span class="ident" id="4182879">em</span><span class="op" id="4182881">[</span><span class="builtinfunc" id="4182882">len</span><span class="op" id="4182885">(</span><span class="ident" id="4182886">em</span><span class="op" id="4182888">)</span><span class="op" id="4182889">-</span><span class="num" id="4182890">1</span><span class="op" id="4182891">]</span>&nbsp;<span class="op" id="4182893">!=</span>&nbsp;<span class="num" id="4182896">0xBC</span>&nbsp;<span class="op" id="4182901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182905">return</span>&nbsp;<span class="ident" id="4182912">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182929">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182933">//&nbsp;5.&nbsp;&nbsp;Let&nbsp;maskedDB&nbsp;be&nbsp;the&nbsp;leftmost&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1&nbsp;octets&nbsp;of&nbsp;EM,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183005">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;H&nbsp;be&nbsp;the&nbsp;next&nbsp;hLen&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183044">db</span>&nbsp;<span class="op" id="4183047">:=</span>&nbsp;<span class="ident" id="4183050">em</span><span class="op" id="4183052">[</span><span class="op" id="4183053">:</span><span class="ident" id="4183054">emLen</span><span class="op" id="4183059">-</span><span class="ident" id="4183060">hLen</span><span class="op" id="4183064">-</span><span class="num" id="4183065">1</span><span class="op" id="4183066">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183069">h</span>&nbsp;<span class="op" id="4183071">:=</span>&nbsp;<span class="ident" id="4183074">em</span><span class="op" id="4183076">[</span><span class="ident" id="4183077">emLen</span><span class="op" id="4183082">-</span><span class="ident" id="4183083">hLen</span><span class="op" id="4183087">-</span><span class="num" id="4183088">1</span>&nbsp;<span class="op" id="4183090">:</span>&nbsp;<span class="builtinfunc" id="4183092">len</span><span class="op" id="4183095">(</span><span class="ident" id="4183096">em</span><span class="op" id="4183098">)</span><span class="op" id="4183099">-</span><span class="num" id="4183100">1</span><span class="op" id="4183101">]</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183105">//&nbsp;6.&nbsp;&nbsp;If&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183178">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;are&nbsp;not&nbsp;all&nbsp;equal&nbsp;to&nbsp;zero,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183248">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183262">if</span>&nbsp;<span class="ident" id="4183265">em</span><span class="op" id="4183267">[</span><span class="num" id="4183268">0</span><span class="op" id="4183269">]</span><span class="op" id="4183270">&amp;</span><span class="op" id="4183271">(</span><span class="num" id="4183272">0xFF</span><span class="op" id="4183276">&lt;&lt;</span><span class="builtintype" id="4183278">uint</span><span class="op" id="4183282">(</span><span class="num" id="4183283">8</span><span class="op" id="4183284">-</span><span class="op" id="4183285">(</span><span class="num" id="4183286">8</span><span class="op" id="4183287">*</span><span class="ident" id="4183288">emLen</span><span class="op" id="4183293">-</span><span class="ident" id="4183294">emBits</span><span class="op" id="4183300">)</span><span class="op" id="4183301">)</span><span class="op" id="4183302">)</span>&nbsp;<span class="op" id="4183304">!=</span>&nbsp;<span class="num" id="4183307">0</span>&nbsp;<span class="op" id="4183309">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183313">return</span>&nbsp;<span class="ident" id="4183320">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183341">//&nbsp;7.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183388">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183392">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;maskedDB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183431">mgf1XOR</span><span class="op" id="4183438">(</span><span class="ident" id="4183439">db</span><span class="op" id="4183441">,</span>&nbsp;<span class="ident" id="4183443">hash</span><span class="op" id="4183447">,</span>&nbsp;<span class="ident" id="4183449">h</span><span class="op" id="4183450">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183454">//&nbsp;9.&nbsp;&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in&nbsp;DB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183531">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;zero.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183548">db</span><span class="op" id="4183550">[</span><span class="num" id="4183551">0</span><span class="op" id="4183552">]</span>&nbsp;<span class="op" id="4183554">&amp;=</span>&nbsp;<span class="op" id="4183557">(</span><span class="num" id="4183558">0xFF</span>&nbsp;<span class="op" id="4183563">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4183566">uint</span><span class="op" id="4183570">(</span><span class="num" id="4183571">8</span><span class="op" id="4183572">*</span><span class="ident" id="4183573">emLen</span><span class="op" id="4183578">-</span><span class="ident" id="4183579">emBits</span><span class="op" id="4183585">)</span><span class="op" id="4183586">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183590">if</span>&nbsp;<span class="ident" id="4183593">sLen</span>&nbsp;<span class="op" id="4183598">==</span>&nbsp;<span class="ident" id="4183601">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="4183619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183622">FindSaltLength</span><span class="op" id="4183636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183640">for</span>&nbsp;<span class="ident" id="4183644">sLen</span>&nbsp;<span class="op" id="4183649">=</span>&nbsp;<span class="ident" id="4183651">emLen</span>&nbsp;<span class="op" id="4183657">-</span>&nbsp;<span class="op" id="4183659">(</span><span class="ident" id="4183660">hLen</span>&nbsp;<span class="op" id="4183665">+</span>&nbsp;<span class="num" id="4183667">2</span><span class="op" id="4183668">)</span><span class="op" id="4183669">;</span>&nbsp;<span class="ident" id="4183671">sLen</span>&nbsp;<span class="op" id="4183676">&gt;=</span>&nbsp;<span class="num" id="4183679">0</span><span class="op" id="4183680">;</span>&nbsp;<span class="ident" id="4183682">sLen</span><span class="op" id="4183686">--</span>&nbsp;<span class="op" id="4183689">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183694">switch</span>&nbsp;<span class="ident" id="4183701">db</span><span class="op" id="4183703">[</span><span class="ident" id="4183704">emLen</span><span class="op" id="4183709">-</span><span class="ident" id="4183710">hLen</span><span class="op" id="4183714">-</span><span class="ident" id="4183715">sLen</span><span class="op" id="4183719">-</span><span class="num" id="4183720">2</span><span class="op" id="4183721">]</span>&nbsp;<span class="op" id="4183723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183728">case</span>&nbsp;<span class="num" id="4183733">1</span><span class="op" id="4183734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183740">break</span>&nbsp;<span class="ident" id="4183746">FindSaltLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183764">case</span>&nbsp;<span class="num" id="4183769">0</span><span class="op" id="4183770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183776">continue</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183788">default</span><span class="op" id="4183795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183801">return</span>&nbsp;<span class="ident" id="4183808">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183835">if</span>&nbsp;<span class="ident" id="4183838">sLen</span>&nbsp;<span class="op" id="4183843">&lt;</span>&nbsp;<span class="num" id="4183845">0</span>&nbsp;<span class="op" id="4183847">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183852">return</span>&nbsp;<span class="ident" id="4183859">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183880">}</span>&nbsp;<span class="keyword" id="4183882">else</span>&nbsp;<span class="op" id="4183887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183891">//&nbsp;10.&nbsp;If&nbsp;the&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;2&nbsp;leftmost&nbsp;octets&nbsp;of&nbsp;DB&nbsp;are&nbsp;not&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183966">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;if&nbsp;the&nbsp;octet&nbsp;at&nbsp;position&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;1&nbsp;(the&nbsp;leftmost</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184041">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;is&nbsp;&#34;position&nbsp;1&#34;)&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value&nbsp;0x01,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184114">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184155">for</span>&nbsp;<span class="ident" id="4184159">_</span><span class="op" id="4184160">,</span>&nbsp;<span class="ident" id="4184162">e</span>&nbsp;<span class="op" id="4184164">:=</span>&nbsp;<span class="keyword" id="4184167">range</span>&nbsp;<span class="ident" id="4184173">db</span><span class="op" id="4184175">[</span><span class="op" id="4184176">:</span><span class="ident" id="4184177">emLen</span><span class="op" id="4184182">-</span><span class="ident" id="4184183">hLen</span><span class="op" id="4184187">-</span><span class="ident" id="4184188">sLen</span><span class="op" id="4184192">-</span><span class="num" id="4184193">2</span><span class="op" id="4184194">]</span>&nbsp;<span class="op" id="4184196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184201">if</span>&nbsp;<span class="ident" id="4184204">e</span>&nbsp;<span class="op" id="4184206">!=</span>&nbsp;<span class="num" id="4184209">0x00</span>&nbsp;<span class="op" id="4184214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184220">return</span>&nbsp;<span class="ident" id="4184227">ErrVerification</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184254">if</span>&nbsp;<span class="ident" id="4184257">db</span><span class="op" id="4184259">[</span><span class="ident" id="4184260">emLen</span><span class="op" id="4184265">-</span><span class="ident" id="4184266">hLen</span><span class="op" id="4184270">-</span><span class="ident" id="4184271">sLen</span><span class="op" id="4184275">-</span><span class="num" id="4184276">2</span><span class="op" id="4184277">]</span>&nbsp;<span class="op" id="4184279">!=</span>&nbsp;<span class="num" id="4184282">0x01</span>&nbsp;<span class="op" id="4184287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184292">return</span>&nbsp;<span class="ident" id="4184299">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184317">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184324">//&nbsp;11.&nbsp;&nbsp;Let&nbsp;salt&nbsp;be&nbsp;the&nbsp;last&nbsp;sLen&nbsp;octets&nbsp;of&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184373">salt</span>&nbsp;<span class="op" id="4184378">:=</span>&nbsp;<span class="ident" id="4184381">db</span><span class="op" id="4184383">[</span><span class="builtinfunc" id="4184384">len</span><span class="op" id="4184387">(</span><span class="ident" id="4184388">db</span><span class="op" id="4184390">)</span><span class="op" id="4184391">-</span><span class="ident" id="4184392">sLen</span><span class="op" id="4184396">:</span><span class="op" id="4184397">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184401">//&nbsp;12.&nbsp;&nbsp;Let</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184414">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt&nbsp;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184479">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184546">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184575">//</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184579">//&nbsp;13.&nbsp;Let&nbsp;H&#39;&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184638">var</span>&nbsp;<span class="ident" id="4184642">prefix</span>&nbsp;<span class="op" id="4184649">[</span><span class="num" id="4184650">8</span><span class="op" id="4184651">]</span><span class="builtintype" id="4184652">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184658">hash</span><span class="op" id="4184662">.</span><span class="ident" id="4184663">Write</span><span class="op" id="4184668">(</span><span class="ident" id="4184669">prefix</span><span class="op" id="4184675">[</span><span class="op" id="4184676">:</span><span class="op" id="4184677">]</span><span class="op" id="4184678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184681">hash</span><span class="op" id="4184685">.</span><span class="ident" id="4184686">Write</span><span class="op" id="4184691">(</span><span class="ident" id="4184692">mHash</span><span class="op" id="4184697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184700">hash</span><span class="op" id="4184704">.</span><span class="ident" id="4184705">Write</span><span class="op" id="4184710">(</span><span class="ident" id="4184711">salt</span><span class="op" id="4184715">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184719">h0</span>&nbsp;<span class="op" id="4184722">:=</span>&nbsp;<span class="ident" id="4184725">hash</span><span class="op" id="4184729">.</span><span class="ident" id="4184730">Sum</span><span class="op" id="4184733">(</span><span class="ident" id="4184734">nil</span><span class="op" id="4184737">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184741">//&nbsp;14.&nbsp;If&nbsp;H&nbsp;=&nbsp;H&#39;,&nbsp;output&nbsp;&#34;consistent.&#34;&nbsp;Otherwise,&nbsp;output&nbsp;&#34;inconsistent.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184815">if</span>&nbsp;<span class="op" id="4184818">!</span><span class="ident" id="4184819">bytes</span><span class="op" id="4184824">.</span><span class="ident" id="4184825">Equal</span><span class="op" id="4184830">(</span><span class="ident" id="4184831">h0</span><span class="op" id="4184833">,</span>&nbsp;<span class="ident" id="4184835">h</span><span class="op" id="4184836">)</span>&nbsp;<span class="op" id="4184838">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184842">return</span>&nbsp;<span class="ident" id="4184849">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184869">return</span>&nbsp;<span class="ident" id="4184876">nil</span><br>
<span class="lineno"></span><span class="op" id="4184880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4184883">//&nbsp;signPSSWithSalt&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;PSS&nbsp;[1]&nbsp;with&nbsp;specified&nbsp;salt.</span><br>
<span class="lineno"></span><span class="comment" id="4184972">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4185050">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;salt&nbsp;is&nbsp;a&nbsp;random&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;whose&nbsp;length&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4185130">//&nbsp;later&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="4185169">func</span>&nbsp;<span class="ident" id="4185174">signPSSWithSalt</span><span class="op" id="4185189">(</span><span class="ident" id="4185190">rand</span>&nbsp;<span class="ident" id="4185195">io</span><span class="op" id="4185197">.</span><span class="ident" id="4185198">Reader</span><span class="op" id="4185204">,</span>&nbsp;<span class="ident" id="4185206">priv</span>&nbsp;<span class="op" id="4185211">*</span><span class="ident" id="4185212">PrivateKey</span><span class="op" id="4185222">,</span>&nbsp;<span class="ident" id="4185224">hash</span>&nbsp;<span class="ident" id="4185229">crypto</span><span class="op" id="4185235">.</span><span class="ident" id="4185236">Hash</span><span class="op" id="4185240">,</span>&nbsp;<span class="ident" id="4185242">hashed</span><span class="op" id="4185248">,</span>&nbsp;<span class="ident" id="4185250">salt</span>&nbsp;<span class="op" id="4185255">[</span><span class="op" id="4185256">]</span><span class="builtintype" id="4185257">byte</span><span class="op" id="4185261">)</span>&nbsp;<span class="op" id="4185263">(</span><span class="ident" id="4185264">s</span>&nbsp;<span class="op" id="4185266">[</span><span class="op" id="4185267">]</span><span class="builtintype" id="4185268">byte</span><span class="op" id="4185272">,</span>&nbsp;<span class="ident" id="4185274">err</span>&nbsp;<span class="builtintype" id="4185278">error</span><span class="op" id="4185283">)</span>&nbsp;<span class="op" id="4185285">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185288">nBits</span>&nbsp;<span class="op" id="4185294">:=</span>&nbsp;<span class="ident" id="4185297">priv</span><span class="op" id="4185301">.</span><span class="ident" id="4185302">N</span><span class="op" id="4185303">.</span><span class="ident" id="4185304">BitLen</span><span class="op" id="4185310">(</span><span class="op" id="4185311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185314">em</span><span class="op" id="4185316">,</span>&nbsp;<span class="ident" id="4185318">err</span>&nbsp;<span class="op" id="4185322">:=</span>&nbsp;<span class="ident" id="4185325">emsaPSSEncode</span><span class="op" id="4185338">(</span><span class="ident" id="4185339">hashed</span><span class="op" id="4185345">,</span>&nbsp;<span class="ident" id="4185347">nBits</span><span class="op" id="4185352">-</span><span class="num" id="4185353">1</span><span class="op" id="4185354">,</span>&nbsp;<span class="ident" id="4185356">salt</span><span class="op" id="4185360">,</span>&nbsp;<span class="ident" id="4185362">hash</span><span class="op" id="4185366">.</span><span class="ident" id="4185367">New</span><span class="op" id="4185370">(</span><span class="op" id="4185371">)</span><span class="op" id="4185372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185375">if</span>&nbsp;<span class="ident" id="4185378">err</span>&nbsp;<span class="op" id="4185382">!=</span>&nbsp;<span class="ident" id="4185385">nil</span>&nbsp;<span class="op" id="4185389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185393">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185401">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185404">m</span>&nbsp;<span class="op" id="4185406">:=</span>&nbsp;<span class="builtinfunc" id="4185409">new</span><span class="op" id="4185412">(</span><span class="ident" id="4185413">big</span><span class="op" id="4185416">.</span><span class="ident" id="4185417">Int</span><span class="op" id="4185420">)</span><span class="op" id="4185421">.</span><span class="ident" id="4185422">SetBytes</span><span class="op" id="4185430">(</span><span class="ident" id="4185431">em</span><span class="op" id="4185433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185436">c</span><span class="op" id="4185437">,</span>&nbsp;<span class="ident" id="4185439">err</span>&nbsp;<span class="op" id="4185443">:=</span>&nbsp;<span class="ident" id="4185446">decrypt</span><span class="op" id="4185453">(</span><span class="ident" id="4185454">rand</span><span class="op" id="4185458">,</span>&nbsp;<span class="ident" id="4185460">priv</span><span class="op" id="4185464">,</span>&nbsp;<span class="ident" id="4185466">m</span><span class="op" id="4185467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185470">if</span>&nbsp;<span class="ident" id="4185473">err</span>&nbsp;<span class="op" id="4185477">!=</span>&nbsp;<span class="ident" id="4185480">nil</span>&nbsp;<span class="op" id="4185484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185488">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185496">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185499">s</span>&nbsp;<span class="op" id="4185501">=</span>&nbsp;<span class="builtinfunc" id="4185503">make</span><span class="op" id="4185507">(</span><span class="op" id="4185508">[</span><span class="op" id="4185509">]</span><span class="builtintype" id="4185510">byte</span><span class="op" id="4185514">,</span>&nbsp;<span class="op" id="4185516">(</span><span class="ident" id="4185517">nBits</span><span class="op" id="4185522">+</span><span class="num" id="4185523">7</span><span class="op" id="4185524">)</span><span class="op" id="4185525">/</span><span class="num" id="4185526">8</span><span class="op" id="4185527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185530">copyWithLeftPad</span><span class="op" id="4185545">(</span><span class="ident" id="4185546">s</span><span class="op" id="4185547">,</span>&nbsp;<span class="ident" id="4185549">c</span><span class="op" id="4185550">.</span><span class="ident" id="4185551">Bytes</span><span class="op" id="4185556">(</span><span class="op" id="4185557">)</span><span class="op" id="4185558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185561">return</span><br>
<span class="lineno"></span><span class="op" id="4185568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="4185571">const</span>&nbsp;<span class="op" id="4185577">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185580">//&nbsp;PSSSaltLengthAuto&nbsp;causes&nbsp;the&nbsp;salt&nbsp;in&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;to&nbsp;be&nbsp;as&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185652">//&nbsp;as&nbsp;possible&nbsp;when&nbsp;signing,&nbsp;and&nbsp;to&nbsp;be&nbsp;auto-detected&nbsp;when&nbsp;verifying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185722">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="4185740">=</span>&nbsp;<span class="num" id="4185742">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185745">//&nbsp;PSSSaltLengthEqualsHash&nbsp;causes&nbsp;the&nbsp;salt&nbsp;length&nbsp;to&nbsp;equal&nbsp;the&nbsp;length</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185816">//&nbsp;of&nbsp;the&nbsp;hash&nbsp;used&nbsp;in&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185855">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="4185879">=</span>&nbsp;<span class="op" id="4185881">-</span><span class="num" id="4185882">1</span><br>
<span class="lineno"></span><span class="op" id="4185884">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4185887">//&nbsp;PSSOptions&nbsp;contains&nbsp;options&nbsp;for&nbsp;creating&nbsp;and&nbsp;verifying&nbsp;PSS&nbsp;signatures.</span><br>
<span class="lineno">220</span><span class="keyword" id="4185961">type</span>&nbsp;<span class="ident" id="4185966">PSSOptions</span>&nbsp;<span class="keyword" id="4185977">struct</span>&nbsp;<span class="op" id="4185984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185987">//&nbsp;SaltLength&nbsp;controls&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;salt&nbsp;used&nbsp;in&nbsp;the&nbsp;PSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4186050">//&nbsp;signature.&nbsp;It&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;number&nbsp;of&nbsp;bytes,&nbsp;or&nbsp;one&nbsp;of&nbsp;the&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4186123">//&nbsp;PSSSaltLength&nbsp;constants.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186152">SaltLength</span>&nbsp;<span class="builtintype" id="4186163">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4186169">//&nbsp;Hash,&nbsp;if&nbsp;not&nbsp;zero,&nbsp;overrides&nbsp;the&nbsp;hash&nbsp;function&nbsp;passed&nbsp;to&nbsp;SignPSS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4186239">//&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;specify&nbsp;the&nbsp;hash&nbsp;function&nbsp;when&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4186308">//&nbsp;crypto.Signer&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186337">Hash</span>&nbsp;<span class="ident" id="4186342">crypto</span><span class="op" id="4186348">.</span><span class="ident" id="4186349">Hash</span><br>
<span class="lineno">230</span><span class="op" id="4186354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4186357">//&nbsp;HashFunc&nbsp;returns&nbsp;pssOpts.Hash&nbsp;so&nbsp;that&nbsp;PSSOptions&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="4186420">//&nbsp;crypto.SignerOpts.</span><br>
<span class="lineno"></span><span class="keyword" id="4186442">func</span>&nbsp;<span class="op" id="4186447">(</span><span class="ident" id="4186448">pssOpts</span>&nbsp;<span class="op" id="4186456">*</span><span class="ident" id="4186457">PSSOptions</span><span class="op" id="4186467">)</span>&nbsp;<span class="ident" id="4186469">HashFunc</span><span class="op" id="4186477">(</span><span class="op" id="4186478">)</span>&nbsp;<span class="ident" id="4186480">crypto</span><span class="op" id="4186486">.</span><span class="ident" id="4186487">Hash</span>&nbsp;<span class="op" id="4186492">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186495">return</span>&nbsp;<span class="ident" id="4186502">pssOpts</span><span class="op" id="4186509">.</span><span class="ident" id="4186510">Hash</span><br>
<span class="lineno"></span><span class="op" id="4186515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4186518">func</span>&nbsp;<span class="op" id="4186523">(</span><span class="ident" id="4186524">opts</span>&nbsp;<span class="op" id="4186529">*</span><span class="ident" id="4186530">PSSOptions</span><span class="op" id="4186540">)</span>&nbsp;<span class="ident" id="4186542">saltLength</span><span class="op" id="4186552">(</span><span class="op" id="4186553">)</span>&nbsp;<span class="builtintype" id="4186555">int</span>&nbsp;<span class="op" id="4186559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186562">if</span>&nbsp;<span class="ident" id="4186565">opts</span>&nbsp;<span class="op" id="4186570">==</span>&nbsp;<span class="ident" id="4186573">nil</span>&nbsp;<span class="op" id="4186577">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186581">return</span>&nbsp;<span class="ident" id="4186588">PSSSaltLengthAuto</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186610">return</span>&nbsp;<span class="ident" id="4186617">opts</span><span class="op" id="4186621">.</span><span class="ident" id="4186622">SaltLength</span><br>
<span class="lineno"></span><span class="op" id="4186633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="4186636">//&nbsp;SignPSS&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;RSASSA-PSS&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="4186704">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4186782">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="4186859">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4186881">func</span>&nbsp;<span class="ident" id="4186886">SignPSS</span><span class="op" id="4186893">(</span><span class="ident" id="4186894">rand</span>&nbsp;<span class="ident" id="4186899">io</span><span class="op" id="4186901">.</span><span class="ident" id="4186902">Reader</span><span class="op" id="4186908">,</span>&nbsp;<span class="ident" id="4186910">priv</span>&nbsp;<span class="op" id="4186915">*</span><span class="ident" id="4186916">PrivateKey</span><span class="op" id="4186926">,</span>&nbsp;<span class="ident" id="4186928">hash</span>&nbsp;<span class="ident" id="4186933">crypto</span><span class="op" id="4186939">.</span><span class="ident" id="4186940">Hash</span><span class="op" id="4186944">,</span>&nbsp;<span class="ident" id="4186946">hashed</span>&nbsp;<span class="op" id="4186953">[</span><span class="op" id="4186954">]</span><span class="builtintype" id="4186955">byte</span><span class="op" id="4186959">,</span>&nbsp;<span class="ident" id="4186961">opts</span>&nbsp;<span class="op" id="4186966">*</span><span class="ident" id="4186967">PSSOptions</span><span class="op" id="4186977">)</span>&nbsp;<span class="op" id="4186979">(</span><span class="ident" id="4186980">s</span>&nbsp;<span class="op" id="4186982">[</span><span class="op" id="4186983">]</span><span class="builtintype" id="4186984">byte</span><span class="op" id="4186988">,</span>&nbsp;<span class="ident" id="4186990">err</span>&nbsp;<span class="builtintype" id="4186994">error</span><span class="op" id="4186999">)</span>&nbsp;<span class="op" id="4187001">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187004">saltLength</span>&nbsp;<span class="op" id="4187015">:=</span>&nbsp;<span class="ident" id="4187018">opts</span><span class="op" id="4187022">.</span><span class="ident" id="4187023">saltLength</span><span class="op" id="4187033">(</span><span class="op" id="4187034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187037">switch</span>&nbsp;<span class="ident" id="4187044">saltLength</span>&nbsp;<span class="op" id="4187055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187058">case</span>&nbsp;<span class="ident" id="4187063">PSSSaltLengthAuto</span><span class="op" id="4187080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187084">saltLength</span>&nbsp;<span class="op" id="4187095">=</span>&nbsp;<span class="op" id="4187097">(</span><span class="ident" id="4187098">priv</span><span class="op" id="4187102">.</span><span class="ident" id="4187103">N</span><span class="op" id="4187104">.</span><span class="ident" id="4187105">BitLen</span><span class="op" id="4187111">(</span><span class="op" id="4187112">)</span><span class="op" id="4187113">+</span><span class="num" id="4187114">7</span><span class="op" id="4187115">)</span><span class="op" id="4187116">/</span><span class="num" id="4187117">8</span>&nbsp;<span class="op" id="4187119">-</span>&nbsp;<span class="num" id="4187121">2</span>&nbsp;<span class="op" id="4187123">-</span>&nbsp;<span class="ident" id="4187125">hash</span><span class="op" id="4187129">.</span><span class="ident" id="4187130">Size</span><span class="op" id="4187134">(</span><span class="op" id="4187135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187138">case</span>&nbsp;<span class="ident" id="4187143">PSSSaltLengthEqualsHash</span><span class="op" id="4187166">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187170">saltLength</span>&nbsp;<span class="op" id="4187181">=</span>&nbsp;<span class="ident" id="4187183">hash</span><span class="op" id="4187187">.</span><span class="ident" id="4187188">Size</span><span class="op" id="4187192">(</span><span class="op" id="4187193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187200">if</span>&nbsp;<span class="ident" id="4187203">opts</span><span class="op" id="4187207">.</span><span class="ident" id="4187208">Hash</span>&nbsp;<span class="op" id="4187213">!=</span>&nbsp;<span class="num" id="4187216">0</span>&nbsp;<span class="op" id="4187218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187222">hash</span>&nbsp;<span class="op" id="4187227">=</span>&nbsp;<span class="ident" id="4187229">opts</span><span class="op" id="4187233">.</span><span class="ident" id="4187234">Hash</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187244">salt</span>&nbsp;<span class="op" id="4187249">:=</span>&nbsp;<span class="builtinfunc" id="4187252">make</span><span class="op" id="4187256">(</span><span class="op" id="4187257">[</span><span class="op" id="4187258">]</span><span class="builtintype" id="4187259">byte</span><span class="op" id="4187263">,</span>&nbsp;<span class="ident" id="4187265">saltLength</span><span class="op" id="4187275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187278">if</span>&nbsp;<span class="ident" id="4187281">_</span><span class="op" id="4187282">,</span>&nbsp;<span class="ident" id="4187284">err</span>&nbsp;<span class="op" id="4187288">=</span>&nbsp;<span class="ident" id="4187290">io</span><span class="op" id="4187292">.</span><span class="ident" id="4187293">ReadFull</span><span class="op" id="4187301">(</span><span class="ident" id="4187302">rand</span><span class="op" id="4187306">,</span>&nbsp;<span class="ident" id="4187308">salt</span><span class="op" id="4187312">)</span><span class="op" id="4187313">;</span>&nbsp;<span class="ident" id="4187315">err</span>&nbsp;<span class="op" id="4187319">!=</span>&nbsp;<span class="ident" id="4187322">nil</span>&nbsp;<span class="op" id="4187326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187330">return</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187341">return</span>&nbsp;<span class="ident" id="4187348">signPSSWithSalt</span><span class="op" id="4187363">(</span><span class="ident" id="4187364">rand</span><span class="op" id="4187368">,</span>&nbsp;<span class="ident" id="4187370">priv</span><span class="op" id="4187374">,</span>&nbsp;<span class="ident" id="4187376">hash</span><span class="op" id="4187380">,</span>&nbsp;<span class="ident" id="4187382">hashed</span><span class="op" id="4187388">,</span>&nbsp;<span class="ident" id="4187390">salt</span><span class="op" id="4187394">)</span><br>
<span class="lineno"></span><span class="op" id="4187396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4187399">//&nbsp;VerifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature.</span><br>
<span class="lineno">270</span><span class="comment" id="4187438">//&nbsp;hashed&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the&nbsp;given&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4187512">//&nbsp;function&nbsp;and&nbsp;sig&nbsp;is&nbsp;the&nbsp;signature.&nbsp;A&nbsp;valid&nbsp;signature&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4187584">//&nbsp;returning&nbsp;a&nbsp;nil&nbsp;error.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="4187663">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4187685">func</span>&nbsp;<span class="ident" id="4187690">VerifyPSS</span><span class="op" id="4187699">(</span><span class="ident" id="4187700">pub</span>&nbsp;<span class="op" id="4187704">*</span><span class="ident" id="4187705">PublicKey</span><span class="op" id="4187714">,</span>&nbsp;<span class="ident" id="4187716">hash</span>&nbsp;<span class="ident" id="4187721">crypto</span><span class="op" id="4187727">.</span><span class="ident" id="4187728">Hash</span><span class="op" id="4187732">,</span>&nbsp;<span class="ident" id="4187734">hashed</span>&nbsp;<span class="op" id="4187741">[</span><span class="op" id="4187742">]</span><span class="builtintype" id="4187743">byte</span><span class="op" id="4187747">,</span>&nbsp;<span class="ident" id="4187749">sig</span>&nbsp;<span class="op" id="4187753">[</span><span class="op" id="4187754">]</span><span class="builtintype" id="4187755">byte</span><span class="op" id="4187759">,</span>&nbsp;<span class="ident" id="4187761">opts</span>&nbsp;<span class="op" id="4187766">*</span><span class="ident" id="4187767">PSSOptions</span><span class="op" id="4187777">)</span>&nbsp;<span class="builtintype" id="4187779">error</span>&nbsp;<span class="op" id="4187785">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187788">return</span>&nbsp;<span class="ident" id="4187795">verifyPSS</span><span class="op" id="4187804">(</span><span class="ident" id="4187805">pub</span><span class="op" id="4187808">,</span>&nbsp;<span class="ident" id="4187810">hash</span><span class="op" id="4187814">,</span>&nbsp;<span class="ident" id="4187816">hashed</span><span class="op" id="4187822">,</span>&nbsp;<span class="ident" id="4187824">sig</span><span class="op" id="4187827">,</span>&nbsp;<span class="ident" id="4187829">opts</span><span class="op" id="4187833">.</span><span class="ident" id="4187834">saltLength</span><span class="op" id="4187844">(</span><span class="op" id="4187845">)</span><span class="op" id="4187846">)</span><br>
<span class="lineno"></span><span class="op" id="4187848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4187851">//&nbsp;verifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;with&nbsp;the&nbsp;given&nbsp;salt&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4187917">func</span>&nbsp;<span class="ident" id="4187922">verifyPSS</span><span class="op" id="4187931">(</span><span class="ident" id="4187932">pub</span>&nbsp;<span class="op" id="4187936">*</span><span class="ident" id="4187937">PublicKey</span><span class="op" id="4187946">,</span>&nbsp;<span class="ident" id="4187948">hash</span>&nbsp;<span class="ident" id="4187953">crypto</span><span class="op" id="4187959">.</span><span class="ident" id="4187960">Hash</span><span class="op" id="4187964">,</span>&nbsp;<span class="ident" id="4187966">hashed</span>&nbsp;<span class="op" id="4187973">[</span><span class="op" id="4187974">]</span><span class="builtintype" id="4187975">byte</span><span class="op" id="4187979">,</span>&nbsp;<span class="ident" id="4187981">sig</span>&nbsp;<span class="op" id="4187985">[</span><span class="op" id="4187986">]</span><span class="builtintype" id="4187987">byte</span><span class="op" id="4187991">,</span>&nbsp;<span class="ident" id="4187993">saltLen</span>&nbsp;<span class="builtintype" id="4188001">int</span><span class="op" id="4188004">)</span>&nbsp;<span class="builtintype" id="4188006">error</span>&nbsp;<span class="op" id="4188012">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188015">nBits</span>&nbsp;<span class="op" id="4188021">:=</span>&nbsp;<span class="ident" id="4188024">pub</span><span class="op" id="4188027">.</span><span class="ident" id="4188028">N</span><span class="op" id="4188029">.</span><span class="ident" id="4188030">BitLen</span><span class="op" id="4188036">(</span><span class="op" id="4188037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188040">if</span>&nbsp;<span class="builtinfunc" id="4188043">len</span><span class="op" id="4188046">(</span><span class="ident" id="4188047">sig</span><span class="op" id="4188050">)</span>&nbsp;<span class="op" id="4188052">!=</span>&nbsp;<span class="op" id="4188055">(</span><span class="ident" id="4188056">nBits</span><span class="op" id="4188061">+</span><span class="num" id="4188062">7</span><span class="op" id="4188063">)</span><span class="op" id="4188064">/</span><span class="num" id="4188065">8</span>&nbsp;<span class="op" id="4188067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188071">return</span>&nbsp;<span class="ident" id="4188078">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188098">s</span>&nbsp;<span class="op" id="4188100">:=</span>&nbsp;<span class="builtinfunc" id="4188103">new</span><span class="op" id="4188106">(</span><span class="ident" id="4188107">big</span><span class="op" id="4188110">.</span><span class="ident" id="4188111">Int</span><span class="op" id="4188114">)</span><span class="op" id="4188115">.</span><span class="ident" id="4188116">SetBytes</span><span class="op" id="4188124">(</span><span class="ident" id="4188125">sig</span><span class="op" id="4188128">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188131">m</span>&nbsp;<span class="op" id="4188133">:=</span>&nbsp;<span class="ident" id="4188136">encrypt</span><span class="op" id="4188143">(</span><span class="builtinfunc" id="4188144">new</span><span class="op" id="4188147">(</span><span class="ident" id="4188148">big</span><span class="op" id="4188151">.</span><span class="ident" id="4188152">Int</span><span class="op" id="4188155">)</span><span class="op" id="4188156">,</span>&nbsp;<span class="ident" id="4188158">pub</span><span class="op" id="4188161">,</span>&nbsp;<span class="ident" id="4188163">s</span><span class="op" id="4188164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188167">emBits</span>&nbsp;<span class="op" id="4188174">:=</span>&nbsp;<span class="ident" id="4188177">nBits</span>&nbsp;<span class="op" id="4188183">-</span>&nbsp;<span class="num" id="4188185">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188188">emLen</span>&nbsp;<span class="op" id="4188194">:=</span>&nbsp;<span class="op" id="4188197">(</span><span class="ident" id="4188198">emBits</span>&nbsp;<span class="op" id="4188205">+</span>&nbsp;<span class="num" id="4188207">7</span><span class="op" id="4188208">)</span>&nbsp;<span class="op" id="4188210">/</span>&nbsp;<span class="num" id="4188212">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188215">if</span>&nbsp;<span class="ident" id="4188218">emLen</span>&nbsp;<span class="op" id="4188224">&lt;</span>&nbsp;<span class="builtinfunc" id="4188226">len</span><span class="op" id="4188229">(</span><span class="ident" id="4188230">m</span><span class="op" id="4188231">.</span><span class="ident" id="4188232">Bytes</span><span class="op" id="4188237">(</span><span class="op" id="4188238">)</span><span class="op" id="4188239">)</span>&nbsp;<span class="op" id="4188241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188245">return</span>&nbsp;<span class="ident" id="4188252">ErrVerification</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188272">em</span>&nbsp;<span class="op" id="4188275">:=</span>&nbsp;<span class="builtinfunc" id="4188278">make</span><span class="op" id="4188282">(</span><span class="op" id="4188283">[</span><span class="op" id="4188284">]</span><span class="builtintype" id="4188285">byte</span><span class="op" id="4188289">,</span>&nbsp;<span class="ident" id="4188291">emLen</span><span class="op" id="4188296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188299">copyWithLeftPad</span><span class="op" id="4188314">(</span><span class="ident" id="4188315">em</span><span class="op" id="4188317">,</span>&nbsp;<span class="ident" id="4188319">m</span><span class="op" id="4188320">.</span><span class="ident" id="4188321">Bytes</span><span class="op" id="4188326">(</span><span class="op" id="4188327">)</span><span class="op" id="4188328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188331">if</span>&nbsp;<span class="ident" id="4188334">saltLen</span>&nbsp;<span class="op" id="4188342">==</span>&nbsp;<span class="ident" id="4188345">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="4188369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188373">saltLen</span>&nbsp;<span class="op" id="4188381">=</span>&nbsp;<span class="ident" id="4188383">hash</span><span class="op" id="4188387">.</span><span class="ident" id="4188388">Size</span><span class="op" id="4188392">(</span><span class="op" id="4188393">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188399">return</span>&nbsp;<span class="ident" id="4188406">emsaPSSVerify</span><span class="op" id="4188419">(</span><span class="ident" id="4188420">hashed</span><span class="op" id="4188426">,</span>&nbsp;<span class="ident" id="4188428">em</span><span class="op" id="4188430">,</span>&nbsp;<span class="ident" id="4188432">emBits</span><span class="op" id="4188438">,</span>&nbsp;<span class="ident" id="4188440">saltLen</span><span class="op" id="4188447">,</span>&nbsp;<span class="ident" id="4188449">hash</span><span class="op" id="4188453">.</span><span class="ident" id="4188454">New</span><span class="op" id="4188457">(</span><span class="op" id="4188458">)</span><span class="op" id="4188459">)</span><br>
<span class="lineno"></span><span class="op" id="4188461">}</span>
</div>
</body>
</html>
