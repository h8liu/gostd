<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6183304">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6183359">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6183413">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6183464">//&nbsp;Package&nbsp;gif&nbsp;implements&nbsp;a&nbsp;GIF&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6183523">//</span><br>
<span class="lineno"></span><span class="comment" id="6183526">//&nbsp;The&nbsp;GIF&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/Graphics/GIF/spec-gif89a.txt.</span><br>
<span class="lineno"></span><span class="keyword" id="6183605">package</span>&nbsp;<span class="ident" id="6183613">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6183618">import</span>&nbsp;<span class="op" id="6183625">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6183628">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6183637">&#34;compress/lzw&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6183653">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6183663">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6183670">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6183679">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6183694">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6183699">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6183702">var</span>&nbsp;<span class="op" id="6183706">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183709">errNotEnough</span>&nbsp;<span class="op" id="6183722">=</span>&nbsp;<span class="ident" id="6183724">errors</span><span class="op" id="6183730">.</span><span class="ident" id="6183731">New</span><span class="op" id="6183734">(</span><span class="string" id="6183735">&#34;gif:&nbsp;not&nbsp;enough&nbsp;image&nbsp;data&#34;</span><span class="op" id="6183763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183766">errTooMuch</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6183779">=</span>&nbsp;<span class="ident" id="6183781">errors</span><span class="op" id="6183787">.</span><span class="ident" id="6183788">New</span><span class="op" id="6183791">(</span><span class="string" id="6183792">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><span class="op" id="6183818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183821">errBadPixel</span>&nbsp;&nbsp;<span class="op" id="6183834">=</span>&nbsp;<span class="ident" id="6183836">errors</span><span class="op" id="6183842">.</span><span class="ident" id="6183843">New</span><span class="op" id="6183846">(</span><span class="string" id="6183847">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="6183873">)</span><br>
<span class="lineno"></span><span class="op" id="6183875">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="6183878">//&nbsp;If&nbsp;the&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,&nbsp;then&nbsp;decode&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="6183973">type</span>&nbsp;<span class="ident" id="6183978">reader</span>&nbsp;<span class="keyword" id="6183985">interface</span>&nbsp;<span class="op" id="6183995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183998">io</span><span class="op" id="6184000">.</span><span class="ident" id="6184001">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184009">io</span><span class="op" id="6184011">.</span><span class="ident" id="6184012">ByteReader</span><br>
<span class="lineno">30</span><span class="op" id="6184023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6184026">//&nbsp;Masks&nbsp;etc.</span><br>
<span class="lineno"></span><span class="keyword" id="6184040">const</span>&nbsp;<span class="op" id="6184046">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184049">//&nbsp;Fields.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184061">fColorMapFollows</span>&nbsp;<span class="op" id="6184078">=</span>&nbsp;<span class="num" id="6184080">1</span>&nbsp;<span class="op" id="6184082">&lt;&lt;</span>&nbsp;<span class="num" id="6184085">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184089">//&nbsp;Image&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184107">ifLocalColorTable</span>&nbsp;<span class="op" id="6184125">=</span>&nbsp;<span class="num" id="6184127">1</span>&nbsp;<span class="op" id="6184129">&lt;&lt;</span>&nbsp;<span class="num" id="6184132">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184135">ifInterlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6184153">=</span>&nbsp;<span class="num" id="6184155">1</span>&nbsp;<span class="op" id="6184157">&lt;&lt;</span>&nbsp;<span class="num" id="6184160">6</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184163">ifPixelSizeMask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6184181">=</span>&nbsp;<span class="num" id="6184183">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184187">//&nbsp;Graphic&nbsp;control&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184214">gcTransparentColorSet</span>&nbsp;<span class="op" id="6184236">=</span>&nbsp;<span class="num" id="6184238">1</span>&nbsp;<span class="op" id="6184240">&lt;&lt;</span>&nbsp;<span class="num" id="6184243">0</span><br>
<span class="lineno"></span><span class="op" id="6184245">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6184248">//&nbsp;Section&nbsp;indicators.</span><br>
<span class="lineno"></span><span class="keyword" id="6184271">const</span>&nbsp;<span class="op" id="6184277">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184280">sExtension</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6184297">=</span>&nbsp;<span class="num" id="6184299">0x21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184305">sImageDescriptor</span>&nbsp;<span class="op" id="6184322">=</span>&nbsp;<span class="num" id="6184324">0x2C</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184330">sTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6184347">=</span>&nbsp;<span class="num" id="6184349">0x3B</span><br>
<span class="lineno"></span><span class="op" id="6184354">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6184357">//&nbsp;Extensions.</span><br>
<span class="lineno"></span><span class="keyword" id="6184372">const</span>&nbsp;<span class="op" id="6184378">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184381">eText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6184397">=</span>&nbsp;<span class="num" id="6184399">0x01</span>&nbsp;<span class="comment" id="6184404">//&nbsp;Plain&nbsp;Text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184419">eGraphicControl</span>&nbsp;<span class="op" id="6184435">=</span>&nbsp;<span class="num" id="6184437">0xF9</span>&nbsp;<span class="comment" id="6184442">//&nbsp;Graphic&nbsp;Control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184462">eComment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6184478">=</span>&nbsp;<span class="num" id="6184480">0xFE</span>&nbsp;<span class="comment" id="6184485">//&nbsp;Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184497">eApplication</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6184513">=</span>&nbsp;<span class="num" id="6184515">0xFF</span>&nbsp;<span class="comment" id="6184520">//&nbsp;Application</span><br>
<span class="lineno"></span><span class="op" id="6184535">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="6184538">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;type&nbsp;used&nbsp;to&nbsp;decode&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6184588">type</span>&nbsp;<span class="ident" id="6184593">decoder</span>&nbsp;<span class="keyword" id="6184601">struct</span>&nbsp;<span class="op" id="6184608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184611">r</span>&nbsp;<span class="ident" id="6184613">reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184622">//&nbsp;From&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184639">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6184655">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184663">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6184679">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184684">height</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6184700">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184705">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6184721">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184727">headerFields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6184743">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184749">backgroundIndex</span>&nbsp;<span class="builtintype" id="6184765">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184771">loopCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6184787">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184792">delayTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6184808">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184814">//&nbsp;Unused&nbsp;from&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184838">aspect</span>&nbsp;<span class="builtintype" id="6184845">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184852">//&nbsp;From&nbsp;image&nbsp;descriptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184879">imageFields</span>&nbsp;<span class="builtintype" id="6184891">byte</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184898">//&nbsp;From&nbsp;graphics&nbsp;control.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184925">transparentIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6184945">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184951">hasTransparentIndex</span>&nbsp;<span class="builtintype" id="6184971">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184978">//&nbsp;Computed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184992">pixelSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6185007">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185013">globalColorMap</span>&nbsp;<span class="ident" id="6185028">color</span><span class="op" id="6185033">.</span><span class="ident" id="6185034">Palette</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6185044">//&nbsp;Used&nbsp;when&nbsp;decoding.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185068">delay</span>&nbsp;<span class="op" id="6185074">[</span><span class="op" id="6185075">]</span><span class="builtintype" id="6185076">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185081">image</span>&nbsp;<span class="op" id="6185087">[</span><span class="op" id="6185088">]</span><span class="op" id="6185089">*</span><span class="ident" id="6185090">image</span><span class="op" id="6185095">.</span><span class="ident" id="6185096">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185106">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6185112">[</span><span class="num" id="6185113">1024</span><span class="op" id="6185117">]</span><span class="builtintype" id="6185118">byte</span>&nbsp;<span class="comment" id="6185123">//&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;read&nbsp;color&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="6185172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6185175">//&nbsp;blockReader&nbsp;parses&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="6185242">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6185309">//&nbsp;reader&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;decoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6185373">//&nbsp;blocking.&nbsp;&nbsp;After&nbsp;the&nbsp;LZW&nbsp;decoder&nbsp;completes,&nbsp;there&nbsp;will&nbsp;be&nbsp;a&nbsp;0-byte</span><br>
<span class="lineno"></span><span class="comment" id="6185443">//&nbsp;block&nbsp;remaining&nbsp;(0,&nbsp;()),&nbsp;which&nbsp;is&nbsp;consumed&nbsp;when&nbsp;checking&nbsp;that&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="6185512">//&nbsp;blockReader&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="6185541">type</span>&nbsp;<span class="ident" id="6185546">blockReader</span>&nbsp;<span class="keyword" id="6185558">struct</span>&nbsp;<span class="op" id="6185565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185568">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6185574">reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185582">slice</span>&nbsp;<span class="op" id="6185588">[</span><span class="op" id="6185589">]</span><span class="builtintype" id="6185590">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185596">err</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6185602">error</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185609">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6185615">[</span><span class="num" id="6185616">256</span><span class="op" id="6185619">]</span><span class="builtintype" id="6185620">byte</span><br>
<span class="lineno"></span><span class="op" id="6185625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6185628">func</span>&nbsp;<span class="op" id="6185633">(</span><span class="ident" id="6185634">b</span>&nbsp;<span class="op" id="6185636">*</span><span class="ident" id="6185637">blockReader</span><span class="op" id="6185648">)</span>&nbsp;<span class="ident" id="6185650">Read</span><span class="op" id="6185654">(</span><span class="ident" id="6185655">p</span>&nbsp;<span class="op" id="6185657">[</span><span class="op" id="6185658">]</span><span class="builtintype" id="6185659">byte</span><span class="op" id="6185663">)</span>&nbsp;<span class="op" id="6185665">(</span><span class="builtintype" id="6185666">int</span><span class="op" id="6185669">,</span>&nbsp;<span class="builtintype" id="6185671">error</span><span class="op" id="6185676">)</span>&nbsp;<span class="op" id="6185678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185681">if</span>&nbsp;<span class="ident" id="6185684">b</span><span class="op" id="6185685">.</span><span class="ident" id="6185686">err</span>&nbsp;<span class="op" id="6185690">!=</span>&nbsp;<span class="ident" id="6185693">nil</span>&nbsp;<span class="op" id="6185697">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185701">return</span>&nbsp;<span class="num" id="6185708">0</span><span class="op" id="6185709">,</span>&nbsp;<span class="ident" id="6185711">b</span><span class="op" id="6185712">.</span><span class="ident" id="6185713">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185721">if</span>&nbsp;<span class="builtinfunc" id="6185724">len</span><span class="op" id="6185727">(</span><span class="ident" id="6185728">p</span><span class="op" id="6185729">)</span>&nbsp;<span class="op" id="6185731">==</span>&nbsp;<span class="num" id="6185734">0</span>&nbsp;<span class="op" id="6185736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185740">return</span>&nbsp;<span class="num" id="6185747">0</span><span class="op" id="6185748">,</span>&nbsp;<span class="ident" id="6185750">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185755">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185758">if</span>&nbsp;<span class="builtinfunc" id="6185761">len</span><span class="op" id="6185764">(</span><span class="ident" id="6185765">b</span><span class="op" id="6185766">.</span><span class="ident" id="6185767">slice</span><span class="op" id="6185772">)</span>&nbsp;<span class="op" id="6185774">==</span>&nbsp;<span class="num" id="6185777">0</span>&nbsp;<span class="op" id="6185779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185783">var</span>&nbsp;<span class="ident" id="6185787">blockLen</span>&nbsp;<span class="builtintype" id="6185796">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185804">blockLen</span><span class="op" id="6185812">,</span>&nbsp;<span class="ident" id="6185814">b</span><span class="op" id="6185815">.</span><span class="ident" id="6185816">err</span>&nbsp;<span class="op" id="6185820">=</span>&nbsp;<span class="ident" id="6185822">b</span><span class="op" id="6185823">.</span><span class="ident" id="6185824">r</span><span class="op" id="6185825">.</span><span class="ident" id="6185826">ReadByte</span><span class="op" id="6185834">(</span><span class="op" id="6185835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185839">if</span>&nbsp;<span class="ident" id="6185842">b</span><span class="op" id="6185843">.</span><span class="ident" id="6185844">err</span>&nbsp;<span class="op" id="6185848">!=</span>&nbsp;<span class="ident" id="6185851">nil</span>&nbsp;<span class="op" id="6185855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185860">return</span>&nbsp;<span class="num" id="6185867">0</span><span class="op" id="6185868">,</span>&nbsp;<span class="ident" id="6185870">b</span><span class="op" id="6185871">.</span><span class="ident" id="6185872">err</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185882">if</span>&nbsp;<span class="ident" id="6185885">blockLen</span>&nbsp;<span class="op" id="6185894">==</span>&nbsp;<span class="num" id="6185897">0</span>&nbsp;<span class="op" id="6185899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185904">b</span><span class="op" id="6185905">.</span><span class="ident" id="6185906">err</span>&nbsp;<span class="op" id="6185910">=</span>&nbsp;<span class="ident" id="6185912">io</span><span class="op" id="6185914">.</span><span class="ident" id="6185915">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185922">return</span>&nbsp;<span class="num" id="6185929">0</span><span class="op" id="6185930">,</span>&nbsp;<span class="ident" id="6185932">b</span><span class="op" id="6185933">.</span><span class="ident" id="6185934">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185940">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185944">b</span><span class="op" id="6185945">.</span><span class="ident" id="6185946">slice</span>&nbsp;<span class="op" id="6185952">=</span>&nbsp;<span class="ident" id="6185954">b</span><span class="op" id="6185955">.</span><span class="ident" id="6185956">tmp</span><span class="op" id="6185959">[</span><span class="num" id="6185960">0</span><span class="op" id="6185961">:</span><span class="ident" id="6185962">blockLen</span><span class="op" id="6185970">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185974">if</span>&nbsp;<span class="ident" id="6185977">_</span><span class="op" id="6185978">,</span>&nbsp;<span class="ident" id="6185980">b</span><span class="op" id="6185981">.</span><span class="ident" id="6185982">err</span>&nbsp;<span class="op" id="6185986">=</span>&nbsp;<span class="ident" id="6185988">io</span><span class="op" id="6185990">.</span><span class="ident" id="6185991">ReadFull</span><span class="op" id="6185999">(</span><span class="ident" id="6186000">b</span><span class="op" id="6186001">.</span><span class="ident" id="6186002">r</span><span class="op" id="6186003">,</span>&nbsp;<span class="ident" id="6186005">b</span><span class="op" id="6186006">.</span><span class="ident" id="6186007">slice</span><span class="op" id="6186012">)</span><span class="op" id="6186013">;</span>&nbsp;<span class="ident" id="6186015">b</span><span class="op" id="6186016">.</span><span class="ident" id="6186017">err</span>&nbsp;<span class="op" id="6186021">!=</span>&nbsp;<span class="ident" id="6186024">nil</span>&nbsp;<span class="op" id="6186028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186033">return</span>&nbsp;<span class="num" id="6186040">0</span><span class="op" id="6186041">,</span>&nbsp;<span class="ident" id="6186043">b</span><span class="op" id="6186044">.</span><span class="ident" id="6186045">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186054">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186057">n</span>&nbsp;<span class="op" id="6186059">:=</span>&nbsp;<span class="builtinfunc" id="6186062">copy</span><span class="op" id="6186066">(</span><span class="ident" id="6186067">p</span><span class="op" id="6186068">,</span>&nbsp;<span class="ident" id="6186070">b</span><span class="op" id="6186071">.</span><span class="ident" id="6186072">slice</span><span class="op" id="6186077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186080">b</span><span class="op" id="6186081">.</span><span class="ident" id="6186082">slice</span>&nbsp;<span class="op" id="6186088">=</span>&nbsp;<span class="ident" id="6186090">b</span><span class="op" id="6186091">.</span><span class="ident" id="6186092">slice</span><span class="op" id="6186097">[</span><span class="ident" id="6186098">n</span><span class="op" id="6186099">:</span><span class="op" id="6186100">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186103">return</span>&nbsp;<span class="ident" id="6186110">n</span><span class="op" id="6186111">,</span>&nbsp;<span class="ident" id="6186113">nil</span><br>
<span class="lineno"></span><span class="op" id="6186117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="6186120">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;stores&nbsp;the&nbsp;result&nbsp;in&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="6186183">func</span>&nbsp;<span class="op" id="6186188">(</span><span class="ident" id="6186189">d</span>&nbsp;<span class="op" id="6186191">*</span><span class="ident" id="6186192">decoder</span><span class="op" id="6186199">)</span>&nbsp;<span class="ident" id="6186201">decode</span><span class="op" id="6186207">(</span><span class="ident" id="6186208">r</span>&nbsp;<span class="ident" id="6186210">io</span><span class="op" id="6186212">.</span><span class="ident" id="6186213">Reader</span><span class="op" id="6186219">,</span>&nbsp;<span class="ident" id="6186221">configOnly</span>&nbsp;<span class="builtintype" id="6186232">bool</span><span class="op" id="6186236">)</span>&nbsp;<span class="builtintype" id="6186238">error</span>&nbsp;<span class="op" id="6186244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186247">//&nbsp;Add&nbsp;buffering&nbsp;if&nbsp;r&nbsp;does&nbsp;not&nbsp;provide&nbsp;ReadByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186297">if</span>&nbsp;<span class="ident" id="6186300">rr</span><span class="op" id="6186302">,</span>&nbsp;<span class="ident" id="6186304">ok</span>&nbsp;<span class="op" id="6186307">:=</span>&nbsp;<span class="ident" id="6186310">r</span><span class="op" id="6186311">.</span><span class="op" id="6186312">(</span><span class="ident" id="6186313">reader</span><span class="op" id="6186319">)</span><span class="op" id="6186320">;</span>&nbsp;<span class="ident" id="6186322">ok</span>&nbsp;<span class="op" id="6186325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186329">d</span><span class="op" id="6186330">.</span><span class="ident" id="6186331">r</span>&nbsp;<span class="op" id="6186333">=</span>&nbsp;<span class="ident" id="6186335">rr</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186339">}</span>&nbsp;<span class="keyword" id="6186341">else</span>&nbsp;<span class="op" id="6186346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186350">d</span><span class="op" id="6186351">.</span><span class="ident" id="6186352">r</span>&nbsp;<span class="op" id="6186354">=</span>&nbsp;<span class="ident" id="6186356">bufio</span><span class="op" id="6186361">.</span><span class="ident" id="6186362">NewReader</span><span class="op" id="6186371">(</span><span class="ident" id="6186372">r</span><span class="op" id="6186373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186380">err</span>&nbsp;<span class="op" id="6186384">:=</span>&nbsp;<span class="ident" id="6186387">d</span><span class="op" id="6186388">.</span><span class="ident" id="6186389">readHeaderAndScreenDescriptor</span><span class="op" id="6186418">(</span><span class="op" id="6186419">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186422">if</span>&nbsp;<span class="ident" id="6186425">err</span>&nbsp;<span class="op" id="6186429">!=</span>&nbsp;<span class="ident" id="6186432">nil</span>&nbsp;<span class="op" id="6186436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186440">return</span>&nbsp;<span class="ident" id="6186447">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186455">if</span>&nbsp;<span class="ident" id="6186458">configOnly</span>&nbsp;<span class="op" id="6186469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186473">return</span>&nbsp;<span class="ident" id="6186480">nil</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186489">if</span>&nbsp;<span class="ident" id="6186492">d</span><span class="op" id="6186493">.</span><span class="ident" id="6186494">headerFields</span><span class="op" id="6186506">&amp;</span><span class="ident" id="6186507">fColorMapFollows</span>&nbsp;<span class="op" id="6186524">!=</span>&nbsp;<span class="num" id="6186527">0</span>&nbsp;<span class="op" id="6186529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186533">if</span>&nbsp;<span class="ident" id="6186536">d</span><span class="op" id="6186537">.</span><span class="ident" id="6186538">globalColorMap</span><span class="op" id="6186552">,</span>&nbsp;<span class="ident" id="6186554">err</span>&nbsp;<span class="op" id="6186558">=</span>&nbsp;<span class="ident" id="6186560">d</span><span class="op" id="6186561">.</span><span class="ident" id="6186562">readColorMap</span><span class="op" id="6186574">(</span><span class="op" id="6186575">)</span><span class="op" id="6186576">;</span>&nbsp;<span class="ident" id="6186578">err</span>&nbsp;<span class="op" id="6186582">!=</span>&nbsp;<span class="ident" id="6186585">nil</span>&nbsp;<span class="op" id="6186589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186594">return</span>&nbsp;<span class="ident" id="6186601">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186614">for</span>&nbsp;<span class="op" id="6186618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186622">c</span><span class="op" id="6186623">,</span>&nbsp;<span class="ident" id="6186625">err</span>&nbsp;<span class="op" id="6186629">:=</span>&nbsp;<span class="ident" id="6186632">d</span><span class="op" id="6186633">.</span><span class="ident" id="6186634">r</span><span class="op" id="6186635">.</span><span class="ident" id="6186636">ReadByte</span><span class="op" id="6186644">(</span><span class="op" id="6186645">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186649">if</span>&nbsp;<span class="ident" id="6186652">err</span>&nbsp;<span class="op" id="6186656">!=</span>&nbsp;<span class="ident" id="6186659">nil</span>&nbsp;<span class="op" id="6186663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186668">return</span>&nbsp;<span class="ident" id="6186675">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186685">switch</span>&nbsp;<span class="ident" id="6186692">c</span>&nbsp;<span class="op" id="6186694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186698">case</span>&nbsp;<span class="ident" id="6186703">sExtension</span><span class="op" id="6186713">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186718">if</span>&nbsp;<span class="ident" id="6186721">err</span>&nbsp;<span class="op" id="6186725">=</span>&nbsp;<span class="ident" id="6186727">d</span><span class="op" id="6186728">.</span><span class="ident" id="6186729">readExtension</span><span class="op" id="6186742">(</span><span class="op" id="6186743">)</span><span class="op" id="6186744">;</span>&nbsp;<span class="ident" id="6186746">err</span>&nbsp;<span class="op" id="6186750">!=</span>&nbsp;<span class="ident" id="6186753">nil</span>&nbsp;<span class="op" id="6186757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186763">return</span>&nbsp;<span class="ident" id="6186770">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186782">case</span>&nbsp;<span class="ident" id="6186787">sImageDescriptor</span><span class="op" id="6186803">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186808">m</span><span class="op" id="6186809">,</span>&nbsp;<span class="ident" id="6186811">err</span>&nbsp;<span class="op" id="6186815">:=</span>&nbsp;<span class="ident" id="6186818">d</span><span class="op" id="6186819">.</span><span class="ident" id="6186820">newImageFromDescriptor</span><span class="op" id="6186842">(</span><span class="op" id="6186843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186848">if</span>&nbsp;<span class="ident" id="6186851">err</span>&nbsp;<span class="op" id="6186855">!=</span>&nbsp;<span class="ident" id="6186858">nil</span>&nbsp;<span class="op" id="6186862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186868">return</span>&nbsp;<span class="ident" id="6186875">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186887">useLocalColorMap</span>&nbsp;<span class="op" id="6186904">:=</span>&nbsp;<span class="ident" id="6186907">d</span><span class="op" id="6186908">.</span><span class="ident" id="6186909">imageFields</span><span class="op" id="6186920">&amp;</span><span class="ident" id="6186921">fColorMapFollows</span>&nbsp;<span class="op" id="6186938">!=</span>&nbsp;<span class="num" id="6186941">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186946">if</span>&nbsp;<span class="ident" id="6186949">useLocalColorMap</span>&nbsp;<span class="op" id="6186966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186972">m</span><span class="op" id="6186973">.</span><span class="ident" id="6186974">Palette</span><span class="op" id="6186981">,</span>&nbsp;<span class="ident" id="6186983">err</span>&nbsp;<span class="op" id="6186987">=</span>&nbsp;<span class="ident" id="6186989">d</span><span class="op" id="6186990">.</span><span class="ident" id="6186991">readColorMap</span><span class="op" id="6187003">(</span><span class="op" id="6187004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187010">if</span>&nbsp;<span class="ident" id="6187013">err</span>&nbsp;<span class="op" id="6187017">!=</span>&nbsp;<span class="ident" id="6187020">nil</span>&nbsp;<span class="op" id="6187024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187031">return</span>&nbsp;<span class="ident" id="6187038">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187046">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187051">}</span>&nbsp;<span class="keyword" id="6187053">else</span>&nbsp;<span class="op" id="6187058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187064">m</span><span class="op" id="6187065">.</span><span class="ident" id="6187066">Palette</span>&nbsp;<span class="op" id="6187074">=</span>&nbsp;<span class="ident" id="6187076">d</span><span class="op" id="6187077">.</span><span class="ident" id="6187078">globalColorMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187101">if</span>&nbsp;<span class="ident" id="6187104">d</span><span class="op" id="6187105">.</span><span class="ident" id="6187106">hasTransparentIndex</span>&nbsp;<span class="op" id="6187126">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6187129">int</span><span class="op" id="6187132">(</span><span class="ident" id="6187133">d</span><span class="op" id="6187134">.</span><span class="ident" id="6187135">transparentIndex</span><span class="op" id="6187151">)</span>&nbsp;<span class="op" id="6187153">&lt;</span>&nbsp;<span class="builtinfunc" id="6187155">len</span><span class="op" id="6187158">(</span><span class="ident" id="6187159">m</span><span class="op" id="6187160">.</span><span class="ident" id="6187161">Palette</span><span class="op" id="6187168">)</span>&nbsp;<span class="op" id="6187170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187176">if</span>&nbsp;<span class="op" id="6187179">!</span><span class="ident" id="6187180">useLocalColorMap</span>&nbsp;<span class="op" id="6187197">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187204">//&nbsp;Clone&nbsp;the&nbsp;global&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187240">m</span><span class="op" id="6187241">.</span><span class="ident" id="6187242">Palette</span>&nbsp;<span class="op" id="6187250">=</span>&nbsp;<span class="builtinfunc" id="6187252">append</span><span class="op" id="6187258">(</span><span class="ident" id="6187259">color</span><span class="op" id="6187264">.</span><span class="ident" id="6187265">Palette</span><span class="op" id="6187272">(</span><span class="ident" id="6187273">nil</span><span class="op" id="6187276">)</span><span class="op" id="6187277">,</span>&nbsp;<span class="ident" id="6187279">d</span><span class="op" id="6187280">.</span><span class="ident" id="6187281">globalColorMap</span><span class="op" id="6187295">...</span><span class="op" id="6187298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187310">m</span><span class="op" id="6187311">.</span><span class="ident" id="6187312">Palette</span><span class="op" id="6187319">[</span><span class="ident" id="6187320">d</span><span class="op" id="6187321">.</span><span class="ident" id="6187322">transparentIndex</span><span class="op" id="6187338">]</span>&nbsp;<span class="op" id="6187340">=</span>&nbsp;<span class="ident" id="6187342">color</span><span class="op" id="6187347">.</span><span class="ident" id="6187348">RGBA</span><span class="op" id="6187352">{</span><span class="op" id="6187353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187358">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187363">litWidth</span><span class="op" id="6187371">,</span>&nbsp;<span class="ident" id="6187373">err</span>&nbsp;<span class="op" id="6187377">:=</span>&nbsp;<span class="ident" id="6187380">d</span><span class="op" id="6187381">.</span><span class="ident" id="6187382">r</span><span class="op" id="6187383">.</span><span class="ident" id="6187384">ReadByte</span><span class="op" id="6187392">(</span><span class="op" id="6187393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187398">if</span>&nbsp;<span class="ident" id="6187401">err</span>&nbsp;<span class="op" id="6187405">!=</span>&nbsp;<span class="ident" id="6187408">nil</span>&nbsp;<span class="op" id="6187412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187418">return</span>&nbsp;<span class="ident" id="6187425">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187437">if</span>&nbsp;<span class="ident" id="6187440">litWidth</span>&nbsp;<span class="op" id="6187449">&lt;</span>&nbsp;<span class="num" id="6187451">2</span>&nbsp;<span class="op" id="6187453">||</span>&nbsp;<span class="ident" id="6187456">litWidth</span>&nbsp;<span class="op" id="6187465">&gt;</span>&nbsp;<span class="num" id="6187467">8</span>&nbsp;<span class="op" id="6187469">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187475">return</span>&nbsp;<span class="ident" id="6187482">fmt</span><span class="op" id="6187485">.</span><span class="ident" id="6187486">Errorf</span><span class="op" id="6187492">(</span><span class="string" id="6187493">&#34;gif:&nbsp;pixel&nbsp;size&nbsp;in&nbsp;decode&nbsp;out&nbsp;of&nbsp;range:&nbsp;%d&#34;</span><span class="op" id="6187537">,</span>&nbsp;<span class="ident" id="6187539">litWidth</span><span class="op" id="6187547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187557">//&nbsp;A&nbsp;wonderfully&nbsp;Go-like&nbsp;piece&nbsp;of&nbsp;magic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187601">br</span>&nbsp;<span class="op" id="6187604">:=</span>&nbsp;<span class="op" id="6187607">&amp;</span><span class="ident" id="6187608">blockReader</span><span class="op" id="6187619">{</span><span class="ident" id="6187620">r</span><span class="op" id="6187621">:</span>&nbsp;<span class="ident" id="6187623">d</span><span class="op" id="6187624">.</span><span class="ident" id="6187625">r</span><span class="op" id="6187626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187631">lzwr</span>&nbsp;<span class="op" id="6187636">:=</span>&nbsp;<span class="ident" id="6187639">lzw</span><span class="op" id="6187642">.</span><span class="ident" id="6187643">NewReader</span><span class="op" id="6187652">(</span><span class="ident" id="6187653">br</span><span class="op" id="6187655">,</span>&nbsp;<span class="ident" id="6187657">lzw</span><span class="op" id="6187660">.</span><span class="ident" id="6187661">LSB</span><span class="op" id="6187664">,</span>&nbsp;<span class="builtintype" id="6187666">int</span><span class="op" id="6187669">(</span><span class="ident" id="6187670">litWidth</span><span class="op" id="6187678">)</span><span class="op" id="6187679">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187684">defer</span>&nbsp;<span class="ident" id="6187690">lzwr</span><span class="op" id="6187694">.</span><span class="ident" id="6187695">Close</span><span class="op" id="6187700">(</span><span class="op" id="6187701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187706">if</span>&nbsp;<span class="ident" id="6187709">_</span><span class="op" id="6187710">,</span>&nbsp;<span class="ident" id="6187712">err</span>&nbsp;<span class="op" id="6187716">=</span>&nbsp;<span class="ident" id="6187718">io</span><span class="op" id="6187720">.</span><span class="ident" id="6187721">ReadFull</span><span class="op" id="6187729">(</span><span class="ident" id="6187730">lzwr</span><span class="op" id="6187734">,</span>&nbsp;<span class="ident" id="6187736">m</span><span class="op" id="6187737">.</span><span class="ident" id="6187738">Pix</span><span class="op" id="6187741">)</span><span class="op" id="6187742">;</span>&nbsp;<span class="ident" id="6187744">err</span>&nbsp;<span class="op" id="6187748">!=</span>&nbsp;<span class="ident" id="6187751">nil</span>&nbsp;<span class="op" id="6187755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187761">if</span>&nbsp;<span class="ident" id="6187764">err</span>&nbsp;<span class="op" id="6187768">!=</span>&nbsp;<span class="ident" id="6187771">io</span><span class="op" id="6187773">.</span><span class="ident" id="6187774">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6187791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187798">return</span>&nbsp;<span class="ident" id="6187805">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187813">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187819">return</span>&nbsp;<span class="ident" id="6187826">errNotEnough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187847">//&nbsp;Both&nbsp;lzwr&nbsp;and&nbsp;br&nbsp;should&nbsp;be&nbsp;exhausted.&nbsp;Reading&nbsp;from&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187909">//&nbsp;should&nbsp;yield&nbsp;(0,&nbsp;io.EOF).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187941">if</span>&nbsp;<span class="ident" id="6187944">n</span><span class="op" id="6187945">,</span>&nbsp;<span class="ident" id="6187947">err</span>&nbsp;<span class="op" id="6187951">:=</span>&nbsp;<span class="ident" id="6187954">lzwr</span><span class="op" id="6187958">.</span><span class="ident" id="6187959">Read</span><span class="op" id="6187963">(</span><span class="ident" id="6187964">d</span><span class="op" id="6187965">.</span><span class="ident" id="6187966">tmp</span><span class="op" id="6187969">[</span><span class="op" id="6187970">:</span><span class="num" id="6187971">1</span><span class="op" id="6187972">]</span><span class="op" id="6187973">)</span><span class="op" id="6187974">;</span>&nbsp;<span class="ident" id="6187976">n</span>&nbsp;<span class="op" id="6187978">!=</span>&nbsp;<span class="num" id="6187981">0</span>&nbsp;<span class="op" id="6187983">||</span>&nbsp;<span class="ident" id="6187986">err</span>&nbsp;<span class="op" id="6187990">!=</span>&nbsp;<span class="ident" id="6187993">io</span><span class="op" id="6187995">.</span><span class="ident" id="6187996">EOF</span>&nbsp;<span class="op" id="6188000">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188006">if</span>&nbsp;<span class="ident" id="6188009">err</span>&nbsp;<span class="op" id="6188013">!=</span>&nbsp;<span class="ident" id="6188016">nil</span>&nbsp;<span class="op" id="6188020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188027">return</span>&nbsp;<span class="ident" id="6188034">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188048">return</span>&nbsp;<span class="ident" id="6188055">errTooMuch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188069">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188074">if</span>&nbsp;<span class="ident" id="6188077">n</span><span class="op" id="6188078">,</span>&nbsp;<span class="ident" id="6188080">err</span>&nbsp;<span class="op" id="6188084">:=</span>&nbsp;<span class="ident" id="6188087">br</span><span class="op" id="6188089">.</span><span class="ident" id="6188090">Read</span><span class="op" id="6188094">(</span><span class="ident" id="6188095">d</span><span class="op" id="6188096">.</span><span class="ident" id="6188097">tmp</span><span class="op" id="6188100">[</span><span class="op" id="6188101">:</span><span class="num" id="6188102">1</span><span class="op" id="6188103">]</span><span class="op" id="6188104">)</span><span class="op" id="6188105">;</span>&nbsp;<span class="ident" id="6188107">n</span>&nbsp;<span class="op" id="6188109">!=</span>&nbsp;<span class="num" id="6188112">0</span>&nbsp;<span class="op" id="6188114">||</span>&nbsp;<span class="ident" id="6188117">err</span>&nbsp;<span class="op" id="6188121">!=</span>&nbsp;<span class="ident" id="6188124">io</span><span class="op" id="6188126">.</span><span class="ident" id="6188127">EOF</span>&nbsp;<span class="op" id="6188131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188137">if</span>&nbsp;<span class="ident" id="6188140">err</span>&nbsp;<span class="op" id="6188144">!=</span>&nbsp;<span class="ident" id="6188147">nil</span>&nbsp;<span class="op" id="6188151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188158">return</span>&nbsp;<span class="ident" id="6188165">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188179">return</span>&nbsp;<span class="ident" id="6188186">errTooMuch</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188206">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;color&nbsp;indexes&nbsp;are&nbsp;inside&nbsp;the&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188265">if</span>&nbsp;<span class="builtinfunc" id="6188268">len</span><span class="op" id="6188271">(</span><span class="ident" id="6188272">m</span><span class="op" id="6188273">.</span><span class="ident" id="6188274">Palette</span><span class="op" id="6188281">)</span>&nbsp;<span class="op" id="6188283">&lt;</span>&nbsp;<span class="num" id="6188285">256</span>&nbsp;<span class="op" id="6188289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188295">for</span>&nbsp;<span class="ident" id="6188299">_</span><span class="op" id="6188300">,</span>&nbsp;<span class="ident" id="6188302">pixel</span>&nbsp;<span class="op" id="6188308">:=</span>&nbsp;<span class="keyword" id="6188311">range</span>&nbsp;<span class="ident" id="6188317">m</span><span class="op" id="6188318">.</span><span class="ident" id="6188319">Pix</span>&nbsp;<span class="op" id="6188323">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188330">if</span>&nbsp;<span class="builtintype" id="6188333">int</span><span class="op" id="6188336">(</span><span class="ident" id="6188337">pixel</span><span class="op" id="6188342">)</span>&nbsp;<span class="op" id="6188344">&gt;=</span>&nbsp;<span class="builtinfunc" id="6188347">len</span><span class="op" id="6188350">(</span><span class="ident" id="6188351">m</span><span class="op" id="6188352">.</span><span class="ident" id="6188353">Palette</span><span class="op" id="6188360">)</span>&nbsp;<span class="op" id="6188362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188370">return</span>&nbsp;<span class="ident" id="6188377">errBadPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188405">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188411">//&nbsp;Undo&nbsp;the&nbsp;interlacing&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188452">if</span>&nbsp;<span class="ident" id="6188455">d</span><span class="op" id="6188456">.</span><span class="ident" id="6188457">imageFields</span><span class="op" id="6188468">&amp;</span><span class="ident" id="6188469">ifInterlace</span>&nbsp;<span class="op" id="6188481">!=</span>&nbsp;<span class="num" id="6188484">0</span>&nbsp;<span class="op" id="6188486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188492">uninterlace</span><span class="op" id="6188503">(</span><span class="ident" id="6188504">m</span><span class="op" id="6188505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188510">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188516">d</span><span class="op" id="6188517">.</span><span class="ident" id="6188518">image</span>&nbsp;<span class="op" id="6188524">=</span>&nbsp;<span class="builtinfunc" id="6188526">append</span><span class="op" id="6188532">(</span><span class="ident" id="6188533">d</span><span class="op" id="6188534">.</span><span class="ident" id="6188535">image</span><span class="op" id="6188540">,</span>&nbsp;<span class="ident" id="6188542">m</span><span class="op" id="6188543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188548">d</span><span class="op" id="6188549">.</span><span class="ident" id="6188550">delay</span>&nbsp;<span class="op" id="6188556">=</span>&nbsp;<span class="builtinfunc" id="6188558">append</span><span class="op" id="6188564">(</span><span class="ident" id="6188565">d</span><span class="op" id="6188566">.</span><span class="ident" id="6188567">delay</span><span class="op" id="6188572">,</span>&nbsp;<span class="ident" id="6188574">d</span><span class="op" id="6188575">.</span><span class="ident" id="6188576">delayTime</span><span class="op" id="6188585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188590">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;23&nbsp;(Graphic&nbsp;Control&nbsp;Extension)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188658">//&nbsp;&#34;The&nbsp;scope&nbsp;of&nbsp;this&nbsp;extension&nbsp;is&nbsp;the&nbsp;first&nbsp;graphic&nbsp;rendering&nbsp;block</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188730">//&nbsp;to&nbsp;follow.&#34;&nbsp;We&nbsp;therefore&nbsp;reset&nbsp;the&nbsp;GCE&nbsp;fields&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188791">d</span><span class="op" id="6188792">.</span><span class="ident" id="6188793">delayTime</span>&nbsp;<span class="op" id="6188803">=</span>&nbsp;<span class="num" id="6188805">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188810">d</span><span class="op" id="6188811">.</span><span class="ident" id="6188812">hasTransparentIndex</span>&nbsp;<span class="op" id="6188832">=</span>&nbsp;<span class="builtintype" id="6188834">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188843">case</span>&nbsp;<span class="ident" id="6188848">sTrailer</span><span class="op" id="6188856">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188861">if</span>&nbsp;<span class="builtinfunc" id="6188864">len</span><span class="op" id="6188867">(</span><span class="ident" id="6188868">d</span><span class="op" id="6188869">.</span><span class="ident" id="6188870">image</span><span class="op" id="6188875">)</span>&nbsp;<span class="op" id="6188877">==</span>&nbsp;<span class="num" id="6188880">0</span>&nbsp;<span class="op" id="6188882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188888">return</span>&nbsp;<span class="ident" id="6188895">io</span><span class="op" id="6188897">.</span><span class="ident" id="6188898">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188923">return</span>&nbsp;<span class="ident" id="6188930">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188937">default</span><span class="op" id="6188944">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188949">return</span>&nbsp;<span class="ident" id="6188956">fmt</span><span class="op" id="6188959">.</span><span class="ident" id="6188960">Errorf</span><span class="op" id="6188966">(</span><span class="string" id="6188967">&#34;gif:&nbsp;unknown&nbsp;block&nbsp;type:&nbsp;0x%.2x&#34;</span><span class="op" id="6189000">,</span>&nbsp;<span class="ident" id="6189002">c</span><span class="op" id="6189003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189010">}</span><br>
<span class="lineno"></span><span class="op" id="6189012">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6189015">func</span>&nbsp;<span class="op" id="6189020">(</span><span class="ident" id="6189021">d</span>&nbsp;<span class="op" id="6189023">*</span><span class="ident" id="6189024">decoder</span><span class="op" id="6189031">)</span>&nbsp;<span class="ident" id="6189033">readHeaderAndScreenDescriptor</span><span class="op" id="6189062">(</span><span class="op" id="6189063">)</span>&nbsp;<span class="builtintype" id="6189065">error</span>&nbsp;<span class="op" id="6189071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189074">_</span><span class="op" id="6189075">,</span>&nbsp;<span class="ident" id="6189077">err</span>&nbsp;<span class="op" id="6189081">:=</span>&nbsp;<span class="ident" id="6189084">io</span><span class="op" id="6189086">.</span><span class="ident" id="6189087">ReadFull</span><span class="op" id="6189095">(</span><span class="ident" id="6189096">d</span><span class="op" id="6189097">.</span><span class="ident" id="6189098">r</span><span class="op" id="6189099">,</span>&nbsp;<span class="ident" id="6189101">d</span><span class="op" id="6189102">.</span><span class="ident" id="6189103">tmp</span><span class="op" id="6189106">[</span><span class="num" id="6189107">0</span><span class="op" id="6189108">:</span><span class="num" id="6189109">13</span><span class="op" id="6189111">]</span><span class="op" id="6189112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189115">if</span>&nbsp;<span class="ident" id="6189118">err</span>&nbsp;<span class="op" id="6189122">!=</span>&nbsp;<span class="ident" id="6189125">nil</span>&nbsp;<span class="op" id="6189129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189133">return</span>&nbsp;<span class="ident" id="6189140">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189148">d</span><span class="op" id="6189149">.</span><span class="ident" id="6189150">vers</span>&nbsp;<span class="op" id="6189155">=</span>&nbsp;<span class="builtintype" id="6189157">string</span><span class="op" id="6189163">(</span><span class="ident" id="6189164">d</span><span class="op" id="6189165">.</span><span class="ident" id="6189166">tmp</span><span class="op" id="6189169">[</span><span class="num" id="6189170">0</span><span class="op" id="6189171">:</span><span class="num" id="6189172">6</span><span class="op" id="6189173">]</span><span class="op" id="6189174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189177">if</span>&nbsp;<span class="ident" id="6189180">d</span><span class="op" id="6189181">.</span><span class="ident" id="6189182">vers</span>&nbsp;<span class="op" id="6189187">!=</span>&nbsp;<span class="string" id="6189190">&#34;GIF87a&#34;</span>&nbsp;<span class="op" id="6189199">&amp;&amp;</span>&nbsp;<span class="ident" id="6189202">d</span><span class="op" id="6189203">.</span><span class="ident" id="6189204">vers</span>&nbsp;<span class="op" id="6189209">!=</span>&nbsp;<span class="string" id="6189212">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="6189221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189225">return</span>&nbsp;<span class="ident" id="6189232">fmt</span><span class="op" id="6189235">.</span><span class="ident" id="6189236">Errorf</span><span class="op" id="6189242">(</span><span class="string" id="6189243">&#34;gif:&nbsp;can&#39;t&nbsp;recognize&nbsp;format&nbsp;%s&#34;</span><span class="op" id="6189275">,</span>&nbsp;<span class="ident" id="6189277">d</span><span class="op" id="6189278">.</span><span class="ident" id="6189279">vers</span><span class="op" id="6189283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189286">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189289">d</span><span class="op" id="6189290">.</span><span class="ident" id="6189291">width</span>&nbsp;<span class="op" id="6189297">=</span>&nbsp;<span class="builtintype" id="6189299">int</span><span class="op" id="6189302">(</span><span class="ident" id="6189303">d</span><span class="op" id="6189304">.</span><span class="ident" id="6189305">tmp</span><span class="op" id="6189308">[</span><span class="num" id="6189309">6</span><span class="op" id="6189310">]</span><span class="op" id="6189311">)</span>&nbsp;<span class="op" id="6189313">+</span>&nbsp;<span class="builtintype" id="6189315">int</span><span class="op" id="6189318">(</span><span class="ident" id="6189319">d</span><span class="op" id="6189320">.</span><span class="ident" id="6189321">tmp</span><span class="op" id="6189324">[</span><span class="num" id="6189325">7</span><span class="op" id="6189326">]</span><span class="op" id="6189327">)</span><span class="op" id="6189328">&lt;&lt;</span><span class="num" id="6189330">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189333">d</span><span class="op" id="6189334">.</span><span class="ident" id="6189335">height</span>&nbsp;<span class="op" id="6189342">=</span>&nbsp;<span class="builtintype" id="6189344">int</span><span class="op" id="6189347">(</span><span class="ident" id="6189348">d</span><span class="op" id="6189349">.</span><span class="ident" id="6189350">tmp</span><span class="op" id="6189353">[</span><span class="num" id="6189354">8</span><span class="op" id="6189355">]</span><span class="op" id="6189356">)</span>&nbsp;<span class="op" id="6189358">+</span>&nbsp;<span class="builtintype" id="6189360">int</span><span class="op" id="6189363">(</span><span class="ident" id="6189364">d</span><span class="op" id="6189365">.</span><span class="ident" id="6189366">tmp</span><span class="op" id="6189369">[</span><span class="num" id="6189370">9</span><span class="op" id="6189371">]</span><span class="op" id="6189372">)</span><span class="op" id="6189373">&lt;&lt;</span><span class="num" id="6189375">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189378">d</span><span class="op" id="6189379">.</span><span class="ident" id="6189380">headerFields</span>&nbsp;<span class="op" id="6189393">=</span>&nbsp;<span class="ident" id="6189395">d</span><span class="op" id="6189396">.</span><span class="ident" id="6189397">tmp</span><span class="op" id="6189400">[</span><span class="num" id="6189401">10</span><span class="op" id="6189403">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189406">d</span><span class="op" id="6189407">.</span><span class="ident" id="6189408">backgroundIndex</span>&nbsp;<span class="op" id="6189424">=</span>&nbsp;<span class="ident" id="6189426">d</span><span class="op" id="6189427">.</span><span class="ident" id="6189428">tmp</span><span class="op" id="6189431">[</span><span class="num" id="6189432">11</span><span class="op" id="6189434">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189437">d</span><span class="op" id="6189438">.</span><span class="ident" id="6189439">aspect</span>&nbsp;<span class="op" id="6189446">=</span>&nbsp;<span class="ident" id="6189448">d</span><span class="op" id="6189449">.</span><span class="ident" id="6189450">tmp</span><span class="op" id="6189453">[</span><span class="num" id="6189454">12</span><span class="op" id="6189456">]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189459">d</span><span class="op" id="6189460">.</span><span class="ident" id="6189461">loopCount</span>&nbsp;<span class="op" id="6189471">=</span>&nbsp;<span class="op" id="6189473">-</span><span class="num" id="6189474">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189477">d</span><span class="op" id="6189478">.</span><span class="ident" id="6189479">pixelSize</span>&nbsp;<span class="op" id="6189489">=</span>&nbsp;<span class="builtintype" id="6189491">uint</span><span class="op" id="6189495">(</span><span class="ident" id="6189496">d</span><span class="op" id="6189497">.</span><span class="ident" id="6189498">headerFields</span><span class="op" id="6189510">&amp;</span><span class="num" id="6189511">7</span><span class="op" id="6189512">)</span>&nbsp;<span class="op" id="6189514">+</span>&nbsp;<span class="num" id="6189516">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189519">return</span>&nbsp;<span class="ident" id="6189526">nil</span><br>
<span class="lineno"></span><span class="op" id="6189530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6189533">func</span>&nbsp;<span class="op" id="6189538">(</span><span class="ident" id="6189539">d</span>&nbsp;<span class="op" id="6189541">*</span><span class="ident" id="6189542">decoder</span><span class="op" id="6189549">)</span>&nbsp;<span class="ident" id="6189551">readColorMap</span><span class="op" id="6189563">(</span><span class="op" id="6189564">)</span>&nbsp;<span class="op" id="6189566">(</span><span class="ident" id="6189567">color</span><span class="op" id="6189572">.</span><span class="ident" id="6189573">Palette</span><span class="op" id="6189580">,</span>&nbsp;<span class="builtintype" id="6189582">error</span><span class="op" id="6189587">)</span>&nbsp;<span class="op" id="6189589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189592">if</span>&nbsp;<span class="ident" id="6189595">d</span><span class="op" id="6189596">.</span><span class="ident" id="6189597">pixelSize</span>&nbsp;<span class="op" id="6189607">&gt;</span>&nbsp;<span class="num" id="6189609">8</span>&nbsp;<span class="op" id="6189611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189615">return</span>&nbsp;<span class="ident" id="6189622">nil</span><span class="op" id="6189625">,</span>&nbsp;<span class="ident" id="6189627">fmt</span><span class="op" id="6189630">.</span><span class="ident" id="6189631">Errorf</span><span class="op" id="6189637">(</span><span class="string" id="6189638">&#34;gif:&nbsp;can&#39;t&nbsp;handle&nbsp;%d&nbsp;bits&nbsp;per&nbsp;pixel&#34;</span><span class="op" id="6189675">,</span>&nbsp;<span class="ident" id="6189677">d</span><span class="op" id="6189678">.</span><span class="ident" id="6189679">pixelSize</span><span class="op" id="6189688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189694">numColors</span>&nbsp;<span class="op" id="6189704">:=</span>&nbsp;<span class="num" id="6189707">1</span>&nbsp;<span class="op" id="6189709">&lt;&lt;</span>&nbsp;<span class="ident" id="6189712">d</span><span class="op" id="6189713">.</span><span class="ident" id="6189714">pixelSize</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189725">if</span>&nbsp;<span class="ident" id="6189728">d</span><span class="op" id="6189729">.</span><span class="ident" id="6189730">imageFields</span><span class="op" id="6189741">&amp;</span><span class="ident" id="6189742">ifLocalColorTable</span>&nbsp;<span class="op" id="6189760">!=</span>&nbsp;<span class="num" id="6189763">0</span>&nbsp;<span class="op" id="6189765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189769">numColors</span>&nbsp;<span class="op" id="6189779">=</span>&nbsp;<span class="num" id="6189781">1</span>&nbsp;<span class="op" id="6189783">&lt;&lt;</span>&nbsp;<span class="op" id="6189786">(</span><span class="op" id="6189787">(</span><span class="ident" id="6189788">d</span><span class="op" id="6189789">.</span><span class="ident" id="6189790">imageFields</span>&nbsp;<span class="op" id="6189802">&amp;</span>&nbsp;<span class="ident" id="6189804">ifPixelSizeMask</span><span class="op" id="6189819">)</span>&nbsp;<span class="op" id="6189821">+</span>&nbsp;<span class="num" id="6189823">1</span><span class="op" id="6189824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189830">numValues</span>&nbsp;<span class="op" id="6189840">:=</span>&nbsp;<span class="num" id="6189843">3</span>&nbsp;<span class="op" id="6189845">*</span>&nbsp;<span class="ident" id="6189847">numColors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189858">_</span><span class="op" id="6189859">,</span>&nbsp;<span class="ident" id="6189861">err</span>&nbsp;<span class="op" id="6189865">:=</span>&nbsp;<span class="ident" id="6189868">io</span><span class="op" id="6189870">.</span><span class="ident" id="6189871">ReadFull</span><span class="op" id="6189879">(</span><span class="ident" id="6189880">d</span><span class="op" id="6189881">.</span><span class="ident" id="6189882">r</span><span class="op" id="6189883">,</span>&nbsp;<span class="ident" id="6189885">d</span><span class="op" id="6189886">.</span><span class="ident" id="6189887">tmp</span><span class="op" id="6189890">[</span><span class="num" id="6189891">0</span><span class="op" id="6189892">:</span><span class="ident" id="6189893">numValues</span><span class="op" id="6189902">]</span><span class="op" id="6189903">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189906">if</span>&nbsp;<span class="ident" id="6189909">err</span>&nbsp;<span class="op" id="6189913">!=</span>&nbsp;<span class="ident" id="6189916">nil</span>&nbsp;<span class="op" id="6189920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189924">return</span>&nbsp;<span class="ident" id="6189931">nil</span><span class="op" id="6189934">,</span>&nbsp;<span class="ident" id="6189936">fmt</span><span class="op" id="6189939">.</span><span class="ident" id="6189940">Errorf</span><span class="op" id="6189946">(</span><span class="string" id="6189947">&#34;gif:&nbsp;short&nbsp;read&nbsp;on&nbsp;color&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="6189981">,</span>&nbsp;<span class="ident" id="6189983">err</span><span class="op" id="6189986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189992">colorMap</span>&nbsp;<span class="op" id="6190001">:=</span>&nbsp;<span class="builtinfunc" id="6190004">make</span><span class="op" id="6190008">(</span><span class="ident" id="6190009">color</span><span class="op" id="6190014">.</span><span class="ident" id="6190015">Palette</span><span class="op" id="6190022">,</span>&nbsp;<span class="ident" id="6190024">numColors</span><span class="op" id="6190033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190036">j</span>&nbsp;<span class="op" id="6190038">:=</span>&nbsp;<span class="num" id="6190041">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190044">for</span>&nbsp;<span class="ident" id="6190048">i</span>&nbsp;<span class="op" id="6190050">:=</span>&nbsp;<span class="keyword" id="6190053">range</span>&nbsp;<span class="ident" id="6190059">colorMap</span>&nbsp;<span class="op" id="6190068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190072">colorMap</span><span class="op" id="6190080">[</span><span class="ident" id="6190081">i</span><span class="op" id="6190082">]</span>&nbsp;<span class="op" id="6190084">=</span>&nbsp;<span class="ident" id="6190086">color</span><span class="op" id="6190091">.</span><span class="ident" id="6190092">RGBA</span><span class="op" id="6190096">{</span><span class="ident" id="6190097">d</span><span class="op" id="6190098">.</span><span class="ident" id="6190099">tmp</span><span class="op" id="6190102">[</span><span class="ident" id="6190103">j</span><span class="op" id="6190104">+</span><span class="num" id="6190105">0</span><span class="op" id="6190106">]</span><span class="op" id="6190107">,</span>&nbsp;<span class="ident" id="6190109">d</span><span class="op" id="6190110">.</span><span class="ident" id="6190111">tmp</span><span class="op" id="6190114">[</span><span class="ident" id="6190115">j</span><span class="op" id="6190116">+</span><span class="num" id="6190117">1</span><span class="op" id="6190118">]</span><span class="op" id="6190119">,</span>&nbsp;<span class="ident" id="6190121">d</span><span class="op" id="6190122">.</span><span class="ident" id="6190123">tmp</span><span class="op" id="6190126">[</span><span class="ident" id="6190127">j</span><span class="op" id="6190128">+</span><span class="num" id="6190129">2</span><span class="op" id="6190130">]</span><span class="op" id="6190131">,</span>&nbsp;<span class="num" id="6190133">0xFF</span><span class="op" id="6190137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190141">j</span>&nbsp;<span class="op" id="6190143">+=</span>&nbsp;<span class="num" id="6190146">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190152">return</span>&nbsp;<span class="ident" id="6190159">colorMap</span><span class="op" id="6190167">,</span>&nbsp;<span class="ident" id="6190169">nil</span><br>
<span class="lineno">295</span><span class="op" id="6190173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6190176">func</span>&nbsp;<span class="op" id="6190181">(</span><span class="ident" id="6190182">d</span>&nbsp;<span class="op" id="6190184">*</span><span class="ident" id="6190185">decoder</span><span class="op" id="6190192">)</span>&nbsp;<span class="ident" id="6190194">readExtension</span><span class="op" id="6190207">(</span><span class="op" id="6190208">)</span>&nbsp;<span class="builtintype" id="6190210">error</span>&nbsp;<span class="op" id="6190216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190219">extension</span><span class="op" id="6190228">,</span>&nbsp;<span class="ident" id="6190230">err</span>&nbsp;<span class="op" id="6190234">:=</span>&nbsp;<span class="ident" id="6190237">d</span><span class="op" id="6190238">.</span><span class="ident" id="6190239">r</span><span class="op" id="6190240">.</span><span class="ident" id="6190241">ReadByte</span><span class="op" id="6190249">(</span><span class="op" id="6190250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190253">if</span>&nbsp;<span class="ident" id="6190256">err</span>&nbsp;<span class="op" id="6190260">!=</span>&nbsp;<span class="ident" id="6190263">nil</span>&nbsp;<span class="op" id="6190267">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190271">return</span>&nbsp;<span class="ident" id="6190278">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190286">size</span>&nbsp;<span class="op" id="6190291">:=</span>&nbsp;<span class="num" id="6190294">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190297">switch</span>&nbsp;<span class="ident" id="6190304">extension</span>&nbsp;<span class="op" id="6190314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190317">case</span>&nbsp;<span class="ident" id="6190322">eText</span><span class="op" id="6190327">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190331">size</span>&nbsp;<span class="op" id="6190336">=</span>&nbsp;<span class="num" id="6190338">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190342">case</span>&nbsp;<span class="ident" id="6190347">eGraphicControl</span><span class="op" id="6190362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190366">return</span>&nbsp;<span class="ident" id="6190373">d</span><span class="op" id="6190374">.</span><span class="ident" id="6190375">readGraphicControl</span><span class="op" id="6190393">(</span><span class="op" id="6190394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190397">case</span>&nbsp;<span class="ident" id="6190402">eComment</span><span class="op" id="6190410">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6190414">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;but&nbsp;read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190451">case</span>&nbsp;<span class="ident" id="6190456">eApplication</span><span class="op" id="6190468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190472">b</span><span class="op" id="6190473">,</span>&nbsp;<span class="ident" id="6190475">err</span>&nbsp;<span class="op" id="6190479">:=</span>&nbsp;<span class="ident" id="6190482">d</span><span class="op" id="6190483">.</span><span class="ident" id="6190484">r</span><span class="op" id="6190485">.</span><span class="ident" id="6190486">ReadByte</span><span class="op" id="6190494">(</span><span class="op" id="6190495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190499">if</span>&nbsp;<span class="ident" id="6190502">err</span>&nbsp;<span class="op" id="6190506">!=</span>&nbsp;<span class="ident" id="6190509">nil</span>&nbsp;<span class="op" id="6190513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190518">return</span>&nbsp;<span class="ident" id="6190525">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190531">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6190535">//&nbsp;The&nbsp;spec&nbsp;requires&nbsp;size&nbsp;be&nbsp;11,&nbsp;but&nbsp;Adobe&nbsp;sometimes&nbsp;uses&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190599">size</span>&nbsp;<span class="op" id="6190604">=</span>&nbsp;<span class="builtintype" id="6190606">int</span><span class="op" id="6190609">(</span><span class="ident" id="6190610">b</span><span class="op" id="6190611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190614">default</span><span class="op" id="6190621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190625">return</span>&nbsp;<span class="ident" id="6190632">fmt</span><span class="op" id="6190635">.</span><span class="ident" id="6190636">Errorf</span><span class="op" id="6190642">(</span><span class="string" id="6190643">&#34;gif:&nbsp;unknown&nbsp;extension&nbsp;0x%.2x&#34;</span><span class="op" id="6190674">,</span>&nbsp;<span class="ident" id="6190676">extension</span><span class="op" id="6190685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190688">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190691">if</span>&nbsp;<span class="ident" id="6190694">size</span>&nbsp;<span class="op" id="6190699">&gt;</span>&nbsp;<span class="num" id="6190701">0</span>&nbsp;<span class="op" id="6190703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190707">if</span>&nbsp;<span class="ident" id="6190710">_</span><span class="op" id="6190711">,</span>&nbsp;<span class="ident" id="6190713">err</span>&nbsp;<span class="op" id="6190717">:=</span>&nbsp;<span class="ident" id="6190720">io</span><span class="op" id="6190722">.</span><span class="ident" id="6190723">ReadFull</span><span class="op" id="6190731">(</span><span class="ident" id="6190732">d</span><span class="op" id="6190733">.</span><span class="ident" id="6190734">r</span><span class="op" id="6190735">,</span>&nbsp;<span class="ident" id="6190737">d</span><span class="op" id="6190738">.</span><span class="ident" id="6190739">tmp</span><span class="op" id="6190742">[</span><span class="num" id="6190743">0</span><span class="op" id="6190744">:</span><span class="ident" id="6190745">size</span><span class="op" id="6190749">]</span><span class="op" id="6190750">)</span><span class="op" id="6190751">;</span>&nbsp;<span class="ident" id="6190753">err</span>&nbsp;<span class="op" id="6190757">!=</span>&nbsp;<span class="ident" id="6190760">nil</span>&nbsp;<span class="op" id="6190764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190769">return</span>&nbsp;<span class="ident" id="6190776">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190785">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6190789">//&nbsp;Application&nbsp;Extension&nbsp;with&nbsp;&#34;NETSCAPE2.0&#34;&nbsp;as&nbsp;string&nbsp;and&nbsp;1&nbsp;in&nbsp;data&nbsp;means</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6190864">//&nbsp;this&nbsp;extension&nbsp;defines&nbsp;a&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190905">if</span>&nbsp;<span class="ident" id="6190908">extension</span>&nbsp;<span class="op" id="6190918">==</span>&nbsp;<span class="ident" id="6190921">eApplication</span>&nbsp;<span class="op" id="6190934">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6190937">string</span><span class="op" id="6190943">(</span><span class="ident" id="6190944">d</span><span class="op" id="6190945">.</span><span class="ident" id="6190946">tmp</span><span class="op" id="6190949">[</span><span class="op" id="6190950">:</span><span class="ident" id="6190951">size</span><span class="op" id="6190955">]</span><span class="op" id="6190956">)</span>&nbsp;<span class="op" id="6190958">==</span>&nbsp;<span class="string" id="6190961">&#34;NETSCAPE2.0&#34;</span>&nbsp;<span class="op" id="6190975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190979">n</span><span class="op" id="6190980">,</span>&nbsp;<span class="ident" id="6190982">err</span>&nbsp;<span class="op" id="6190986">:=</span>&nbsp;<span class="ident" id="6190989">d</span><span class="op" id="6190990">.</span><span class="ident" id="6190991">readBlock</span><span class="op" id="6191000">(</span><span class="op" id="6191001">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191005">if</span>&nbsp;<span class="ident" id="6191008">n</span>&nbsp;<span class="op" id="6191010">==</span>&nbsp;<span class="num" id="6191013">0</span>&nbsp;<span class="op" id="6191015">||</span>&nbsp;<span class="ident" id="6191018">err</span>&nbsp;<span class="op" id="6191022">!=</span>&nbsp;<span class="ident" id="6191025">nil</span>&nbsp;<span class="op" id="6191029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191034">return</span>&nbsp;<span class="ident" id="6191041">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191051">if</span>&nbsp;<span class="ident" id="6191054">n</span>&nbsp;<span class="op" id="6191056">==</span>&nbsp;<span class="num" id="6191059">3</span>&nbsp;<span class="op" id="6191061">&amp;&amp;</span>&nbsp;<span class="ident" id="6191064">d</span><span class="op" id="6191065">.</span><span class="ident" id="6191066">tmp</span><span class="op" id="6191069">[</span><span class="num" id="6191070">0</span><span class="op" id="6191071">]</span>&nbsp;<span class="op" id="6191073">==</span>&nbsp;<span class="num" id="6191076">1</span>&nbsp;<span class="op" id="6191078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191083">d</span><span class="op" id="6191084">.</span><span class="ident" id="6191085">loopCount</span>&nbsp;<span class="op" id="6191095">=</span>&nbsp;<span class="builtintype" id="6191097">int</span><span class="op" id="6191100">(</span><span class="ident" id="6191101">d</span><span class="op" id="6191102">.</span><span class="ident" id="6191103">tmp</span><span class="op" id="6191106">[</span><span class="num" id="6191107">1</span><span class="op" id="6191108">]</span><span class="op" id="6191109">)</span>&nbsp;<span class="op" id="6191111">|</span>&nbsp;<span class="builtintype" id="6191113">int</span><span class="op" id="6191116">(</span><span class="ident" id="6191117">d</span><span class="op" id="6191118">.</span><span class="ident" id="6191119">tmp</span><span class="op" id="6191122">[</span><span class="num" id="6191123">2</span><span class="op" id="6191124">]</span><span class="op" id="6191125">)</span><span class="op" id="6191126">&lt;&lt;</span><span class="num" id="6191128">8</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191138">for</span>&nbsp;<span class="op" id="6191142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191146">n</span><span class="op" id="6191147">,</span>&nbsp;<span class="ident" id="6191149">err</span>&nbsp;<span class="op" id="6191153">:=</span>&nbsp;<span class="ident" id="6191156">d</span><span class="op" id="6191157">.</span><span class="ident" id="6191158">readBlock</span><span class="op" id="6191167">(</span><span class="op" id="6191168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191172">if</span>&nbsp;<span class="ident" id="6191175">n</span>&nbsp;<span class="op" id="6191177">==</span>&nbsp;<span class="num" id="6191180">0</span>&nbsp;<span class="op" id="6191182">||</span>&nbsp;<span class="ident" id="6191185">err</span>&nbsp;<span class="op" id="6191189">!=</span>&nbsp;<span class="ident" id="6191192">nil</span>&nbsp;<span class="op" id="6191196">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191201">return</span>&nbsp;<span class="ident" id="6191208">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191217">}</span><br>
<span class="lineno"></span><span class="op" id="6191219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="6191222">func</span>&nbsp;<span class="op" id="6191227">(</span><span class="ident" id="6191228">d</span>&nbsp;<span class="op" id="6191230">*</span><span class="ident" id="6191231">decoder</span><span class="op" id="6191238">)</span>&nbsp;<span class="ident" id="6191240">readGraphicControl</span><span class="op" id="6191258">(</span><span class="op" id="6191259">)</span>&nbsp;<span class="builtintype" id="6191261">error</span>&nbsp;<span class="op" id="6191267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191270">if</span>&nbsp;<span class="ident" id="6191273">_</span><span class="op" id="6191274">,</span>&nbsp;<span class="ident" id="6191276">err</span>&nbsp;<span class="op" id="6191280">:=</span>&nbsp;<span class="ident" id="6191283">io</span><span class="op" id="6191285">.</span><span class="ident" id="6191286">ReadFull</span><span class="op" id="6191294">(</span><span class="ident" id="6191295">d</span><span class="op" id="6191296">.</span><span class="ident" id="6191297">r</span><span class="op" id="6191298">,</span>&nbsp;<span class="ident" id="6191300">d</span><span class="op" id="6191301">.</span><span class="ident" id="6191302">tmp</span><span class="op" id="6191305">[</span><span class="num" id="6191306">0</span><span class="op" id="6191307">:</span><span class="num" id="6191308">6</span><span class="op" id="6191309">]</span><span class="op" id="6191310">)</span><span class="op" id="6191311">;</span>&nbsp;<span class="ident" id="6191313">err</span>&nbsp;<span class="op" id="6191317">!=</span>&nbsp;<span class="ident" id="6191320">nil</span>&nbsp;<span class="op" id="6191324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191328">return</span>&nbsp;<span class="ident" id="6191335">fmt</span><span class="op" id="6191338">.</span><span class="ident" id="6191339">Errorf</span><span class="op" id="6191345">(</span><span class="string" id="6191346">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;graphic&nbsp;control:&nbsp;%s&#34;</span><span class="op" id="6191383">,</span>&nbsp;<span class="ident" id="6191385">err</span><span class="op" id="6191388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191394">d</span><span class="op" id="6191395">.</span><span class="ident" id="6191396">flags</span>&nbsp;<span class="op" id="6191402">=</span>&nbsp;<span class="ident" id="6191404">d</span><span class="op" id="6191405">.</span><span class="ident" id="6191406">tmp</span><span class="op" id="6191409">[</span><span class="num" id="6191410">1</span><span class="op" id="6191411">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191414">d</span><span class="op" id="6191415">.</span><span class="ident" id="6191416">delayTime</span>&nbsp;<span class="op" id="6191426">=</span>&nbsp;<span class="builtintype" id="6191428">int</span><span class="op" id="6191431">(</span><span class="ident" id="6191432">d</span><span class="op" id="6191433">.</span><span class="ident" id="6191434">tmp</span><span class="op" id="6191437">[</span><span class="num" id="6191438">2</span><span class="op" id="6191439">]</span><span class="op" id="6191440">)</span>&nbsp;<span class="op" id="6191442">|</span>&nbsp;<span class="builtintype" id="6191444">int</span><span class="op" id="6191447">(</span><span class="ident" id="6191448">d</span><span class="op" id="6191449">.</span><span class="ident" id="6191450">tmp</span><span class="op" id="6191453">[</span><span class="num" id="6191454">3</span><span class="op" id="6191455">]</span><span class="op" id="6191456">)</span><span class="op" id="6191457">&lt;&lt;</span><span class="num" id="6191459">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191462">if</span>&nbsp;<span class="ident" id="6191465">d</span><span class="op" id="6191466">.</span><span class="ident" id="6191467">flags</span><span class="op" id="6191472">&amp;</span><span class="ident" id="6191473">gcTransparentColorSet</span>&nbsp;<span class="op" id="6191495">!=</span>&nbsp;<span class="num" id="6191498">0</span>&nbsp;<span class="op" id="6191500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191504">d</span><span class="op" id="6191505">.</span><span class="ident" id="6191506">transparentIndex</span>&nbsp;<span class="op" id="6191523">=</span>&nbsp;<span class="ident" id="6191525">d</span><span class="op" id="6191526">.</span><span class="ident" id="6191527">tmp</span><span class="op" id="6191530">[</span><span class="num" id="6191531">4</span><span class="op" id="6191532">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191536">d</span><span class="op" id="6191537">.</span><span class="ident" id="6191538">hasTransparentIndex</span>&nbsp;<span class="op" id="6191558">=</span>&nbsp;<span class="builtintype" id="6191560">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191566">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191569">return</span>&nbsp;<span class="ident" id="6191576">nil</span><br>
<span class="lineno"></span><span class="op" id="6191580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6191583">func</span>&nbsp;<span class="op" id="6191588">(</span><span class="ident" id="6191589">d</span>&nbsp;<span class="op" id="6191591">*</span><span class="ident" id="6191592">decoder</span><span class="op" id="6191599">)</span>&nbsp;<span class="ident" id="6191601">newImageFromDescriptor</span><span class="op" id="6191623">(</span><span class="op" id="6191624">)</span>&nbsp;<span class="op" id="6191626">(</span><span class="op" id="6191627">*</span><span class="ident" id="6191628">image</span><span class="op" id="6191633">.</span><span class="ident" id="6191634">Paletted</span><span class="op" id="6191642">,</span>&nbsp;<span class="builtintype" id="6191644">error</span><span class="op" id="6191649">)</span>&nbsp;<span class="op" id="6191651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191654">if</span>&nbsp;<span class="ident" id="6191657">_</span><span class="op" id="6191658">,</span>&nbsp;<span class="ident" id="6191660">err</span>&nbsp;<span class="op" id="6191664">:=</span>&nbsp;<span class="ident" id="6191667">io</span><span class="op" id="6191669">.</span><span class="ident" id="6191670">ReadFull</span><span class="op" id="6191678">(</span><span class="ident" id="6191679">d</span><span class="op" id="6191680">.</span><span class="ident" id="6191681">r</span><span class="op" id="6191682">,</span>&nbsp;<span class="ident" id="6191684">d</span><span class="op" id="6191685">.</span><span class="ident" id="6191686">tmp</span><span class="op" id="6191689">[</span><span class="num" id="6191690">0</span><span class="op" id="6191691">:</span><span class="num" id="6191692">9</span><span class="op" id="6191693">]</span><span class="op" id="6191694">)</span><span class="op" id="6191695">;</span>&nbsp;<span class="ident" id="6191697">err</span>&nbsp;<span class="op" id="6191701">!=</span>&nbsp;<span class="ident" id="6191704">nil</span>&nbsp;<span class="op" id="6191708">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191712">return</span>&nbsp;<span class="ident" id="6191719">nil</span><span class="op" id="6191722">,</span>&nbsp;<span class="ident" id="6191724">fmt</span><span class="op" id="6191727">.</span><span class="ident" id="6191728">Errorf</span><span class="op" id="6191734">(</span><span class="string" id="6191735">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;image&nbsp;descriptor:&nbsp;%s&#34;</span><span class="op" id="6191773">,</span>&nbsp;<span class="ident" id="6191775">err</span><span class="op" id="6191778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191784">left</span>&nbsp;<span class="op" id="6191789">:=</span>&nbsp;<span class="builtintype" id="6191792">int</span><span class="op" id="6191795">(</span><span class="ident" id="6191796">d</span><span class="op" id="6191797">.</span><span class="ident" id="6191798">tmp</span><span class="op" id="6191801">[</span><span class="num" id="6191802">0</span><span class="op" id="6191803">]</span><span class="op" id="6191804">)</span>&nbsp;<span class="op" id="6191806">+</span>&nbsp;<span class="builtintype" id="6191808">int</span><span class="op" id="6191811">(</span><span class="ident" id="6191812">d</span><span class="op" id="6191813">.</span><span class="ident" id="6191814">tmp</span><span class="op" id="6191817">[</span><span class="num" id="6191818">1</span><span class="op" id="6191819">]</span><span class="op" id="6191820">)</span><span class="op" id="6191821">&lt;&lt;</span><span class="num" id="6191823">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191826">top</span>&nbsp;<span class="op" id="6191830">:=</span>&nbsp;<span class="builtintype" id="6191833">int</span><span class="op" id="6191836">(</span><span class="ident" id="6191837">d</span><span class="op" id="6191838">.</span><span class="ident" id="6191839">tmp</span><span class="op" id="6191842">[</span><span class="num" id="6191843">2</span><span class="op" id="6191844">]</span><span class="op" id="6191845">)</span>&nbsp;<span class="op" id="6191847">+</span>&nbsp;<span class="builtintype" id="6191849">int</span><span class="op" id="6191852">(</span><span class="ident" id="6191853">d</span><span class="op" id="6191854">.</span><span class="ident" id="6191855">tmp</span><span class="op" id="6191858">[</span><span class="num" id="6191859">3</span><span class="op" id="6191860">]</span><span class="op" id="6191861">)</span><span class="op" id="6191862">&lt;&lt;</span><span class="num" id="6191864">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191867">width</span>&nbsp;<span class="op" id="6191873">:=</span>&nbsp;<span class="builtintype" id="6191876">int</span><span class="op" id="6191879">(</span><span class="ident" id="6191880">d</span><span class="op" id="6191881">.</span><span class="ident" id="6191882">tmp</span><span class="op" id="6191885">[</span><span class="num" id="6191886">4</span><span class="op" id="6191887">]</span><span class="op" id="6191888">)</span>&nbsp;<span class="op" id="6191890">+</span>&nbsp;<span class="builtintype" id="6191892">int</span><span class="op" id="6191895">(</span><span class="ident" id="6191896">d</span><span class="op" id="6191897">.</span><span class="ident" id="6191898">tmp</span><span class="op" id="6191901">[</span><span class="num" id="6191902">5</span><span class="op" id="6191903">]</span><span class="op" id="6191904">)</span><span class="op" id="6191905">&lt;&lt;</span><span class="num" id="6191907">8</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191910">height</span>&nbsp;<span class="op" id="6191917">:=</span>&nbsp;<span class="builtintype" id="6191920">int</span><span class="op" id="6191923">(</span><span class="ident" id="6191924">d</span><span class="op" id="6191925">.</span><span class="ident" id="6191926">tmp</span><span class="op" id="6191929">[</span><span class="num" id="6191930">6</span><span class="op" id="6191931">]</span><span class="op" id="6191932">)</span>&nbsp;<span class="op" id="6191934">+</span>&nbsp;<span class="builtintype" id="6191936">int</span><span class="op" id="6191939">(</span><span class="ident" id="6191940">d</span><span class="op" id="6191941">.</span><span class="ident" id="6191942">tmp</span><span class="op" id="6191945">[</span><span class="num" id="6191946">7</span><span class="op" id="6191947">]</span><span class="op" id="6191948">)</span><span class="op" id="6191949">&lt;&lt;</span><span class="num" id="6191951">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191954">d</span><span class="op" id="6191955">.</span><span class="ident" id="6191956">imageFields</span>&nbsp;<span class="op" id="6191968">=</span>&nbsp;<span class="ident" id="6191970">d</span><span class="op" id="6191971">.</span><span class="ident" id="6191972">tmp</span><span class="op" id="6191975">[</span><span class="num" id="6191976">8</span><span class="op" id="6191977">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6191981">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;20&nbsp;(Image&nbsp;Descriptor)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6192038">//&nbsp;&#34;Each&nbsp;image&nbsp;must&nbsp;fit&nbsp;within&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;Logical</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6192100">//&nbsp;Screen,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;Logical&nbsp;Screen&nbsp;Descriptor.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192158">bounds</span>&nbsp;<span class="op" id="6192165">:=</span>&nbsp;<span class="ident" id="6192168">image</span><span class="op" id="6192173">.</span><span class="ident" id="6192174">Rect</span><span class="op" id="6192178">(</span><span class="ident" id="6192179">left</span><span class="op" id="6192183">,</span>&nbsp;<span class="ident" id="6192185">top</span><span class="op" id="6192188">,</span>&nbsp;<span class="ident" id="6192190">left</span><span class="op" id="6192194">+</span><span class="ident" id="6192195">width</span><span class="op" id="6192200">,</span>&nbsp;<span class="ident" id="6192202">top</span><span class="op" id="6192205">+</span><span class="ident" id="6192206">height</span><span class="op" id="6192212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192215">if</span>&nbsp;<span class="ident" id="6192218">bounds</span>&nbsp;<span class="op" id="6192225">!=</span>&nbsp;<span class="ident" id="6192228">bounds</span><span class="op" id="6192234">.</span><span class="ident" id="6192235">Intersect</span><span class="op" id="6192244">(</span><span class="ident" id="6192245">image</span><span class="op" id="6192250">.</span><span class="ident" id="6192251">Rect</span><span class="op" id="6192255">(</span><span class="num" id="6192256">0</span><span class="op" id="6192257">,</span>&nbsp;<span class="num" id="6192259">0</span><span class="op" id="6192260">,</span>&nbsp;<span class="ident" id="6192262">d</span><span class="op" id="6192263">.</span><span class="ident" id="6192264">width</span><span class="op" id="6192269">,</span>&nbsp;<span class="ident" id="6192271">d</span><span class="op" id="6192272">.</span><span class="ident" id="6192273">height</span><span class="op" id="6192279">)</span><span class="op" id="6192280">)</span>&nbsp;<span class="op" id="6192282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192286">return</span>&nbsp;<span class="ident" id="6192293">nil</span><span class="op" id="6192296">,</span>&nbsp;<span class="ident" id="6192298">errors</span><span class="op" id="6192304">.</span><span class="ident" id="6192305">New</span><span class="op" id="6192308">(</span><span class="string" id="6192309">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><span class="op" id="6192353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192356">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192359">return</span>&nbsp;<span class="ident" id="6192366">image</span><span class="op" id="6192371">.</span><span class="ident" id="6192372">NewPaletted</span><span class="op" id="6192383">(</span><span class="ident" id="6192384">bounds</span><span class="op" id="6192390">,</span>&nbsp;<span class="ident" id="6192392">nil</span><span class="op" id="6192395">)</span><span class="op" id="6192396">,</span>&nbsp;<span class="ident" id="6192398">nil</span><br>
<span class="lineno"></span><span class="op" id="6192402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6192405">func</span>&nbsp;<span class="op" id="6192410">(</span><span class="ident" id="6192411">d</span>&nbsp;<span class="op" id="6192413">*</span><span class="ident" id="6192414">decoder</span><span class="op" id="6192421">)</span>&nbsp;<span class="ident" id="6192423">readBlock</span><span class="op" id="6192432">(</span><span class="op" id="6192433">)</span>&nbsp;<span class="op" id="6192435">(</span><span class="builtintype" id="6192436">int</span><span class="op" id="6192439">,</span>&nbsp;<span class="builtintype" id="6192441">error</span><span class="op" id="6192446">)</span>&nbsp;<span class="op" id="6192448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192451">n</span><span class="op" id="6192452">,</span>&nbsp;<span class="ident" id="6192454">err</span>&nbsp;<span class="op" id="6192458">:=</span>&nbsp;<span class="ident" id="6192461">d</span><span class="op" id="6192462">.</span><span class="ident" id="6192463">r</span><span class="op" id="6192464">.</span><span class="ident" id="6192465">ReadByte</span><span class="op" id="6192473">(</span><span class="op" id="6192474">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192477">if</span>&nbsp;<span class="ident" id="6192480">n</span>&nbsp;<span class="op" id="6192482">==</span>&nbsp;<span class="num" id="6192485">0</span>&nbsp;<span class="op" id="6192487">||</span>&nbsp;<span class="ident" id="6192490">err</span>&nbsp;<span class="op" id="6192494">!=</span>&nbsp;<span class="ident" id="6192497">nil</span>&nbsp;<span class="op" id="6192501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192505">return</span>&nbsp;<span class="num" id="6192512">0</span><span class="op" id="6192513">,</span>&nbsp;<span class="ident" id="6192515">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192523">return</span>&nbsp;<span class="ident" id="6192530">io</span><span class="op" id="6192532">.</span><span class="ident" id="6192533">ReadFull</span><span class="op" id="6192541">(</span><span class="ident" id="6192542">d</span><span class="op" id="6192543">.</span><span class="ident" id="6192544">r</span><span class="op" id="6192545">,</span>&nbsp;<span class="ident" id="6192547">d</span><span class="op" id="6192548">.</span><span class="ident" id="6192549">tmp</span><span class="op" id="6192552">[</span><span class="num" id="6192553">0</span><span class="op" id="6192554">:</span><span class="ident" id="6192555">n</span><span class="op" id="6192556">]</span><span class="op" id="6192557">)</span><br>
<span class="lineno"></span><span class="op" id="6192559">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="comment" id="6192562">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;ordering&nbsp;for&nbsp;a&nbsp;pass&nbsp;of&nbsp;the&nbsp;interlace&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="6192639">type</span>&nbsp;<span class="ident" id="6192644">interlaceScan</span>&nbsp;<span class="keyword" id="6192658">struct</span>&nbsp;<span class="op" id="6192665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192668">skip</span><span class="op" id="6192672">,</span>&nbsp;<span class="ident" id="6192674">start</span>&nbsp;<span class="builtintype" id="6192680">int</span><br>
<span class="lineno"></span><span class="op" id="6192684">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="6192687">//&nbsp;interlacing&nbsp;represents&nbsp;the&nbsp;set&nbsp;of&nbsp;scans&nbsp;in&nbsp;an&nbsp;interlaced&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6192758">var</span>&nbsp;<span class="ident" id="6192762">interlacing</span>&nbsp;<span class="op" id="6192774">=</span>&nbsp;<span class="op" id="6192776">[</span><span class="op" id="6192777">]</span><span class="ident" id="6192778">interlaceScan</span><span class="op" id="6192791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192794">{</span><span class="num" id="6192795">8</span><span class="op" id="6192796">,</span>&nbsp;<span class="num" id="6192798">0</span><span class="op" id="6192799">}</span><span class="op" id="6192800">,</span>&nbsp;<span class="comment" id="6192802">//&nbsp;Group&nbsp;1&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192853">{</span><span class="num" id="6192854">8</span><span class="op" id="6192855">,</span>&nbsp;<span class="num" id="6192857">4</span><span class="op" id="6192858">}</span><span class="op" id="6192859">,</span>&nbsp;<span class="comment" id="6192861">//&nbsp;Group&nbsp;2&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;4.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192912">{</span><span class="num" id="6192913">4</span><span class="op" id="6192914">,</span>&nbsp;<span class="num" id="6192916">2</span><span class="op" id="6192917">}</span><span class="op" id="6192918">,</span>&nbsp;<span class="comment" id="6192920">//&nbsp;Group&nbsp;3&nbsp;:&nbsp;Every&nbsp;4th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192971">{</span><span class="num" id="6192972">2</span><span class="op" id="6192973">,</span>&nbsp;<span class="num" id="6192975">1</span><span class="op" id="6192976">}</span><span class="op" id="6192977">,</span>&nbsp;<span class="comment" id="6192979">//&nbsp;Group&nbsp;4&nbsp;:&nbsp;Every&nbsp;2nd.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;1.</span><br>
<span class="lineno"></span><span class="op" id="6193029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6193032">//&nbsp;uninterlace&nbsp;rearranges&nbsp;the&nbsp;pixels&nbsp;in&nbsp;m&nbsp;to&nbsp;account&nbsp;for&nbsp;interlaced&nbsp;input.</span><br>
<span class="lineno">400</span><span class="keyword" id="6193107">func</span>&nbsp;<span class="ident" id="6193112">uninterlace</span><span class="op" id="6193123">(</span><span class="ident" id="6193124">m</span>&nbsp;<span class="op" id="6193126">*</span><span class="ident" id="6193127">image</span><span class="op" id="6193132">.</span><span class="ident" id="6193133">Paletted</span><span class="op" id="6193141">)</span>&nbsp;<span class="op" id="6193143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193146">var</span>&nbsp;<span class="ident" id="6193150">nPix</span>&nbsp;<span class="op" id="6193155">[</span><span class="op" id="6193156">]</span><span class="builtintype" id="6193157">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193164">dx</span>&nbsp;<span class="op" id="6193167">:=</span>&nbsp;<span class="ident" id="6193170">m</span><span class="op" id="6193171">.</span><span class="ident" id="6193172">Bounds</span><span class="op" id="6193178">(</span><span class="op" id="6193179">)</span><span class="op" id="6193180">.</span><span class="ident" id="6193181">Dx</span><span class="op" id="6193183">(</span><span class="op" id="6193184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193187">dy</span>&nbsp;<span class="op" id="6193190">:=</span>&nbsp;<span class="ident" id="6193193">m</span><span class="op" id="6193194">.</span><span class="ident" id="6193195">Bounds</span><span class="op" id="6193201">(</span><span class="op" id="6193202">)</span><span class="op" id="6193203">.</span><span class="ident" id="6193204">Dy</span><span class="op" id="6193206">(</span><span class="op" id="6193207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193210">nPix</span>&nbsp;<span class="op" id="6193215">=</span>&nbsp;<span class="builtinfunc" id="6193217">make</span><span class="op" id="6193221">(</span><span class="op" id="6193222">[</span><span class="op" id="6193223">]</span><span class="builtintype" id="6193224">uint8</span><span class="op" id="6193229">,</span>&nbsp;<span class="ident" id="6193231">dx</span><span class="op" id="6193233">*</span><span class="ident" id="6193234">dy</span><span class="op" id="6193236">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193239">offset</span>&nbsp;<span class="op" id="6193246">:=</span>&nbsp;<span class="num" id="6193249">0</span>&nbsp;<span class="comment" id="6193251">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;input&nbsp;by&nbsp;sequential&nbsp;scan&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193305">for</span>&nbsp;<span class="ident" id="6193309">_</span><span class="op" id="6193310">,</span>&nbsp;<span class="ident" id="6193312">pass</span>&nbsp;<span class="op" id="6193317">:=</span>&nbsp;<span class="keyword" id="6193320">range</span>&nbsp;<span class="ident" id="6193326">interlacing</span>&nbsp;<span class="op" id="6193338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193342">nOffset</span>&nbsp;<span class="op" id="6193350">:=</span>&nbsp;<span class="ident" id="6193353">pass</span><span class="op" id="6193357">.</span><span class="ident" id="6193358">start</span>&nbsp;<span class="op" id="6193364">*</span>&nbsp;<span class="ident" id="6193366">dx</span>&nbsp;<span class="comment" id="6193369">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;output&nbsp;as&nbsp;defined&nbsp;by&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193419">for</span>&nbsp;<span class="ident" id="6193423">y</span>&nbsp;<span class="op" id="6193425">:=</span>&nbsp;<span class="ident" id="6193428">pass</span><span class="op" id="6193432">.</span><span class="ident" id="6193433">start</span><span class="op" id="6193438">;</span>&nbsp;<span class="ident" id="6193440">y</span>&nbsp;<span class="op" id="6193442">&lt;</span>&nbsp;<span class="ident" id="6193444">dy</span><span class="op" id="6193446">;</span>&nbsp;<span class="ident" id="6193448">y</span>&nbsp;<span class="op" id="6193450">+=</span>&nbsp;<span class="ident" id="6193453">pass</span><span class="op" id="6193457">.</span><span class="ident" id="6193458">skip</span>&nbsp;<span class="op" id="6193463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6193468">copy</span><span class="op" id="6193472">(</span><span class="ident" id="6193473">nPix</span><span class="op" id="6193477">[</span><span class="ident" id="6193478">nOffset</span><span class="op" id="6193485">:</span><span class="ident" id="6193486">nOffset</span><span class="op" id="6193493">+</span><span class="ident" id="6193494">dx</span><span class="op" id="6193496">]</span><span class="op" id="6193497">,</span>&nbsp;<span class="ident" id="6193499">m</span><span class="op" id="6193500">.</span><span class="ident" id="6193501">Pix</span><span class="op" id="6193504">[</span><span class="ident" id="6193505">offset</span><span class="op" id="6193511">:</span><span class="ident" id="6193512">offset</span><span class="op" id="6193518">+</span><span class="ident" id="6193519">dx</span><span class="op" id="6193521">]</span><span class="op" id="6193522">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193527">offset</span>&nbsp;<span class="op" id="6193534">+=</span>&nbsp;<span class="ident" id="6193537">dx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193543">nOffset</span>&nbsp;<span class="op" id="6193551">+=</span>&nbsp;<span class="ident" id="6193554">dx</span>&nbsp;<span class="op" id="6193557">*</span>&nbsp;<span class="ident" id="6193559">pass</span><span class="op" id="6193563">.</span><span class="ident" id="6193564">skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193577">m</span><span class="op" id="6193578">.</span><span class="ident" id="6193579">Pix</span>&nbsp;<span class="op" id="6193583">=</span>&nbsp;<span class="ident" id="6193585">nPix</span><br>
<span class="lineno">415</span><span class="op" id="6193590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6193593">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;first&nbsp;embedded</span><br>
<span class="lineno"></span><span class="comment" id="6193659">//&nbsp;image&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="6193687">func</span>&nbsp;<span class="ident" id="6193692">Decode</span><span class="op" id="6193698">(</span><span class="ident" id="6193699">r</span>&nbsp;<span class="ident" id="6193701">io</span><span class="op" id="6193703">.</span><span class="ident" id="6193704">Reader</span><span class="op" id="6193710">)</span>&nbsp;<span class="op" id="6193712">(</span><span class="ident" id="6193713">image</span><span class="op" id="6193718">.</span><span class="ident" id="6193719">Image</span><span class="op" id="6193724">,</span>&nbsp;<span class="builtintype" id="6193726">error</span><span class="op" id="6193731">)</span>&nbsp;<span class="op" id="6193733">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193736">var</span>&nbsp;<span class="ident" id="6193740">d</span>&nbsp;<span class="ident" id="6193742">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193751">if</span>&nbsp;<span class="ident" id="6193754">err</span>&nbsp;<span class="op" id="6193758">:=</span>&nbsp;<span class="ident" id="6193761">d</span><span class="op" id="6193762">.</span><span class="ident" id="6193763">decode</span><span class="op" id="6193769">(</span><span class="ident" id="6193770">r</span><span class="op" id="6193771">,</span>&nbsp;<span class="builtintype" id="6193773">false</span><span class="op" id="6193778">)</span><span class="op" id="6193779">;</span>&nbsp;<span class="ident" id="6193781">err</span>&nbsp;<span class="op" id="6193785">!=</span>&nbsp;<span class="ident" id="6193788">nil</span>&nbsp;<span class="op" id="6193792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193796">return</span>&nbsp;<span class="ident" id="6193803">nil</span><span class="op" id="6193806">,</span>&nbsp;<span class="ident" id="6193808">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193816">return</span>&nbsp;<span class="ident" id="6193823">d</span><span class="op" id="6193824">.</span><span class="ident" id="6193825">image</span><span class="op" id="6193830">[</span><span class="num" id="6193831">0</span><span class="op" id="6193832">]</span><span class="op" id="6193833">,</span>&nbsp;<span class="ident" id="6193835">nil</span><br>
<span class="lineno">425</span><span class="op" id="6193839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6193842">//&nbsp;GIF&nbsp;represents&nbsp;the&nbsp;possibly&nbsp;multiple&nbsp;images&nbsp;stored&nbsp;in&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6193911">type</span>&nbsp;<span class="ident" id="6193916">GIF</span>&nbsp;<span class="keyword" id="6193920">struct</span>&nbsp;<span class="op" id="6193927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193930">Image</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6193940">[</span><span class="op" id="6193941">]</span><span class="op" id="6193942">*</span><span class="ident" id="6193943">image</span><span class="op" id="6193948">.</span><span class="ident" id="6193949">Paletted</span>&nbsp;<span class="comment" id="6193958">//&nbsp;The&nbsp;successive&nbsp;images.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193985">Delay</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6193995">[</span><span class="op" id="6193996">]</span><span class="builtintype" id="6193997">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6194013">//&nbsp;The&nbsp;successive&nbsp;delay&nbsp;times,&nbsp;one&nbsp;per&nbsp;frame,&nbsp;in&nbsp;100ths&nbsp;of&nbsp;a&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194083">LoopCount</span>&nbsp;<span class="builtintype" id="6194093">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6194111">//&nbsp;The&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span><span class="op" id="6194130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6194133">//&nbsp;DecodeAll&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;sequential&nbsp;frames</span><br>
<span class="lineno">435</span><span class="comment" id="6194205">//&nbsp;and&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="6194232">func</span>&nbsp;<span class="ident" id="6194237">DecodeAll</span><span class="op" id="6194246">(</span><span class="ident" id="6194247">r</span>&nbsp;<span class="ident" id="6194249">io</span><span class="op" id="6194251">.</span><span class="ident" id="6194252">Reader</span><span class="op" id="6194258">)</span>&nbsp;<span class="op" id="6194260">(</span><span class="op" id="6194261">*</span><span class="ident" id="6194262">GIF</span><span class="op" id="6194265">,</span>&nbsp;<span class="builtintype" id="6194267">error</span><span class="op" id="6194272">)</span>&nbsp;<span class="op" id="6194274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194277">var</span>&nbsp;<span class="ident" id="6194281">d</span>&nbsp;<span class="ident" id="6194283">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194292">if</span>&nbsp;<span class="ident" id="6194295">err</span>&nbsp;<span class="op" id="6194299">:=</span>&nbsp;<span class="ident" id="6194302">d</span><span class="op" id="6194303">.</span><span class="ident" id="6194304">decode</span><span class="op" id="6194310">(</span><span class="ident" id="6194311">r</span><span class="op" id="6194312">,</span>&nbsp;<span class="builtintype" id="6194314">false</span><span class="op" id="6194319">)</span><span class="op" id="6194320">;</span>&nbsp;<span class="ident" id="6194322">err</span>&nbsp;<span class="op" id="6194326">!=</span>&nbsp;<span class="ident" id="6194329">nil</span>&nbsp;<span class="op" id="6194333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194337">return</span>&nbsp;<span class="ident" id="6194344">nil</span><span class="op" id="6194347">,</span>&nbsp;<span class="ident" id="6194349">err</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6194354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194357">gif</span>&nbsp;<span class="op" id="6194361">:=</span>&nbsp;<span class="op" id="6194364">&amp;</span><span class="ident" id="6194365">GIF</span><span class="op" id="6194368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194372">Image</span><span class="op" id="6194377">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194383">d</span><span class="op" id="6194384">.</span><span class="ident" id="6194385">image</span><span class="op" id="6194390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194394">LoopCount</span><span class="op" id="6194403">:</span>&nbsp;<span class="ident" id="6194405">d</span><span class="op" id="6194406">.</span><span class="ident" id="6194407">loopCount</span><span class="op" id="6194416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194420">Delay</span><span class="op" id="6194425">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194431">d</span><span class="op" id="6194432">.</span><span class="ident" id="6194433">delay</span><span class="op" id="6194438">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6194441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194444">return</span>&nbsp;<span class="ident" id="6194451">gif</span><span class="op" id="6194454">,</span>&nbsp;<span class="ident" id="6194456">nil</span><br>
<span class="lineno"></span><span class="op" id="6194460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6194463">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;global&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;GIF&nbsp;image</span><br>
<span class="lineno">450</span><span class="comment" id="6194540">//&nbsp;without&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6194578">func</span>&nbsp;<span class="ident" id="6194583">DecodeConfig</span><span class="op" id="6194595">(</span><span class="ident" id="6194596">r</span>&nbsp;<span class="ident" id="6194598">io</span><span class="op" id="6194600">.</span><span class="ident" id="6194601">Reader</span><span class="op" id="6194607">)</span>&nbsp;<span class="op" id="6194609">(</span><span class="ident" id="6194610">image</span><span class="op" id="6194615">.</span><span class="ident" id="6194616">Config</span><span class="op" id="6194622">,</span>&nbsp;<span class="builtintype" id="6194624">error</span><span class="op" id="6194629">)</span>&nbsp;<span class="op" id="6194631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194634">var</span>&nbsp;<span class="ident" id="6194638">d</span>&nbsp;<span class="ident" id="6194640">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194649">if</span>&nbsp;<span class="ident" id="6194652">err</span>&nbsp;<span class="op" id="6194656">:=</span>&nbsp;<span class="ident" id="6194659">d</span><span class="op" id="6194660">.</span><span class="ident" id="6194661">decode</span><span class="op" id="6194667">(</span><span class="ident" id="6194668">r</span><span class="op" id="6194669">,</span>&nbsp;<span class="builtintype" id="6194671">true</span><span class="op" id="6194675">)</span><span class="op" id="6194676">;</span>&nbsp;<span class="ident" id="6194678">err</span>&nbsp;<span class="op" id="6194682">!=</span>&nbsp;<span class="ident" id="6194685">nil</span>&nbsp;<span class="op" id="6194689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194693">return</span>&nbsp;<span class="ident" id="6194700">image</span><span class="op" id="6194705">.</span><span class="ident" id="6194706">Config</span><span class="op" id="6194712">{</span><span class="op" id="6194713">}</span><span class="op" id="6194714">,</span>&nbsp;<span class="ident" id="6194716">err</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6194721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6194724">return</span>&nbsp;<span class="ident" id="6194731">image</span><span class="op" id="6194736">.</span><span class="ident" id="6194737">Config</span><span class="op" id="6194743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194747">ColorModel</span><span class="op" id="6194757">:</span>&nbsp;<span class="ident" id="6194759">d</span><span class="op" id="6194760">.</span><span class="ident" id="6194761">globalColorMap</span><span class="op" id="6194775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194779">Width</span><span class="op" id="6194784">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194791">d</span><span class="op" id="6194792">.</span><span class="ident" id="6194793">width</span><span class="op" id="6194798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194802">Height</span><span class="op" id="6194808">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194814">d</span><span class="op" id="6194815">.</span><span class="ident" id="6194816">height</span><span class="op" id="6194822">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6194825">}</span><span class="op" id="6194826">,</span>&nbsp;<span class="ident" id="6194828">nil</span><br>
<span class="lineno"></span><span class="op" id="6194832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6194835">func</span>&nbsp;<span class="ident" id="6194840">init</span><span class="op" id="6194844">(</span><span class="op" id="6194845">)</span>&nbsp;<span class="op" id="6194847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6194850">image</span><span class="op" id="6194855">.</span><span class="ident" id="6194856">RegisterFormat</span><span class="op" id="6194870">(</span><span class="string" id="6194871">&#34;gif&#34;</span><span class="op" id="6194876">,</span>&nbsp;<span class="string" id="6194878">&#34;GIF8?a&#34;</span><span class="op" id="6194886">,</span>&nbsp;<span class="ident" id="6194888">Decode</span><span class="op" id="6194894">,</span>&nbsp;<span class="ident" id="6194896">DecodeConfig</span><span class="op" id="6194908">)</span><br>
<span class="lineno">465</span><span class="op" id="6194910">}</span>
</div>
</body>
</html>
