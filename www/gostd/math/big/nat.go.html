<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4778308">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4778363">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4778417">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4778468">//&nbsp;Package&nbsp;big&nbsp;implements&nbsp;multi-precision&nbsp;arithmetic&nbsp;(big&nbsp;numbers).</span><br>
<span class="lineno"></span><span class="comment" id="4778536">//&nbsp;The&nbsp;following&nbsp;numeric&nbsp;types&nbsp;are&nbsp;supported:</span><br>
<span class="lineno"></span><span class="comment" id="4778582">//</span><br>
<span class="lineno"></span><span class="comment" id="4778585">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Int&nbsp;&nbsp;&nbsp;&nbspsigned&nbsp;integers</span><br>
<span class="lineno"></span><span class="comment" id="4778610">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Rat&nbsp;&nbsp;&nbsp;&nbsprational&nbsp;numbers</span><br>
<span class="lineno">10</span><span class="comment" id="4778636">//</span><br>
<span class="lineno"></span><span class="comment" id="4778639">//&nbsp;Methods&nbsp;are&nbsp;typically&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="4778677">//</span><br>
<span class="lineno"></span><span class="comment" id="4778680">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(z&nbsp;*Int)&nbsp;Op(x,&nbsp;y&nbsp;*Int)&nbsp;*Int&nbsp;&nbsp;&nbsp;&nbsp(similar&nbsp;for&nbsp;*Rat)</span><br>
<span class="lineno"></span><span class="comment" id="4778735">//</span><br>
<span class="lineno">15</span><span class="comment" id="4778738">//&nbsp;and&nbsp;implement&nbsp;operations&nbsp;z&nbsp;=&nbsp;x&nbsp;Op&nbsp;y&nbsp;with&nbsp;the&nbsp;result&nbsp;as&nbsp;receiver;&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4778812">//&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;it&nbsp;may&nbsp;be&nbsp;overwritten&nbsp;(and&nbsp;its&nbsp;memory&nbsp;reused).</span><br>
<span class="lineno"></span><span class="comment" id="4778885">//&nbsp;To&nbsp;enable&nbsp;chaining&nbsp;of&nbsp;operations,&nbsp;the&nbsp;result&nbsp;is&nbsp;also&nbsp;returned.&nbsp;Methods</span><br>
<span class="lineno"></span><span class="comment" id="4778959">//&nbsp;returning&nbsp;a&nbsp;result&nbsp;other&nbsp;than&nbsp;*Int&nbsp;or&nbsp;*Rat&nbsp;take&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4779033">//&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno">20</span><span class="comment" id="4779050">//</span><br>
<span class="lineno"></span><span class="keyword" id="4779053">package</span>&nbsp;<span class="ident" id="4779061">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4779066">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;operations&nbsp;on&nbsp;unsigned&nbsp;multi-precision&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="4779137">//&nbsp;These&nbsp;are&nbsp;the&nbsp;building&nbsp;blocks&nbsp;for&nbsp;the&nbsp;operations&nbsp;on&nbsp;signed&nbsp;integers</span><br>
<span class="lineno">25</span><span class="comment" id="4779208">//&nbsp;and&nbsp;rationals.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4779227">import</span>&nbsp;<span class="op" id="4779234">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4779237">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4779247">&#34;io&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4779253">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4779261">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4779274">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4779281">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4779284">//&nbsp;An&nbsp;unsigned&nbsp;integer&nbsp;x&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="4779321">//</span><br>
<span class="lineno"></span><span class="comment" id="4779324">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x[n-1]*_B^(n-1)&nbsp;+&nbsp;x[n-2]*_B^(n-2)&nbsp;+&nbsp;...&nbsp;+&nbsp;x[1]*_B&nbsp;+&nbsp;x[0]</span><br>
<span class="lineno"></span><span class="comment" id="4779390">//</span><br>
<span class="lineno"></span><span class="comment" id="4779393">//&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;x[i]&nbsp;&lt;&nbsp;_B&nbsp;and&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;&nbsp;n&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n,</span><br>
<span class="lineno">40</span><span class="comment" id="4779465">//&nbsp;with&nbsp;the&nbsp;digits&nbsp;x[i]&nbsp;as&nbsp;the&nbsp;slice&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="4779512">//</span><br>
<span class="lineno"></span><span class="comment" id="4779515">//&nbsp;A&nbsp;number&nbsp;is&nbsp;normalized&nbsp;if&nbsp;the&nbsp;slice&nbsp;contains&nbsp;no&nbsp;leading&nbsp;0&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="4779584">//&nbsp;During&nbsp;arithmetic&nbsp;operations,&nbsp;denormalized&nbsp;values&nbsp;may&nbsp;occur&nbsp;but&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4779655">//&nbsp;always&nbsp;normalized&nbsp;before&nbsp;returning&nbsp;the&nbsp;final&nbsp;result.&nbsp;The&nbsp;normalized</span><br>
<span class="lineno">45</span><span class="comment" id="4779726">//&nbsp;representation&nbsp;of&nbsp;0&nbsp;is&nbsp;the&nbsp;empty&nbsp;or&nbsp;nil&nbsp;slice&nbsp;(length&nbsp;=&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="4779789">//</span><br>
<span class="lineno"></span><span class="keyword" id="4779792">type</span>&nbsp;<span class="ident" id="4779797">nat</span>&nbsp;<span class="op" id="4779801">[</span><span class="op" id="4779802">]</span><span class="ident" id="4779803">Word</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4779809">var</span>&nbsp;<span class="op" id="4779813">(</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779816">natOne</span>&nbsp;<span class="op" id="4779823">=</span>&nbsp;<span class="ident" id="4779825">nat</span><span class="op" id="4779828">{</span><span class="num" id="4779829">1</span><span class="op" id="4779830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779833">natTwo</span>&nbsp;<span class="op" id="4779840">=</span>&nbsp;<span class="ident" id="4779842">nat</span><span class="op" id="4779845">{</span><span class="num" id="4779846">2</span><span class="op" id="4779847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779850">natTen</span>&nbsp;<span class="op" id="4779857">=</span>&nbsp;<span class="ident" id="4779859">nat</span><span class="op" id="4779862">{</span><span class="num" id="4779863">10</span><span class="op" id="4779865">}</span><br>
<span class="lineno"></span><span class="op" id="4779867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4779870">func</span>&nbsp;<span class="op" id="4779875">(</span><span class="ident" id="4779876">z</span>&nbsp;<span class="ident" id="4779878">nat</span><span class="op" id="4779881">)</span>&nbsp;<span class="ident" id="4779883">clear</span><span class="op" id="4779888">(</span><span class="op" id="4779889">)</span>&nbsp;<span class="op" id="4779891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779894">for</span>&nbsp;<span class="ident" id="4779898">i</span>&nbsp;<span class="op" id="4779900">:=</span>&nbsp;<span class="keyword" id="4779903">range</span>&nbsp;<span class="ident" id="4779909">z</span>&nbsp;<span class="op" id="4779911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779915">z</span><span class="op" id="4779916">[</span><span class="ident" id="4779917">i</span><span class="op" id="4779918">]</span>&nbsp;<span class="op" id="4779920">=</span>&nbsp;<span class="num" id="4779922">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4779925">}</span><br>
<span class="lineno"></span><span class="op" id="4779927">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4779930">func</span>&nbsp;<span class="op" id="4779935">(</span><span class="ident" id="4779936">z</span>&nbsp;<span class="ident" id="4779938">nat</span><span class="op" id="4779941">)</span>&nbsp;<span class="ident" id="4779943">norm</span><span class="op" id="4779947">(</span><span class="op" id="4779948">)</span>&nbsp;<span class="ident" id="4779950">nat</span>&nbsp;<span class="op" id="4779954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779957">i</span>&nbsp;<span class="op" id="4779959">:=</span>&nbsp;<span class="builtinfunc" id="4779962">len</span><span class="op" id="4779965">(</span><span class="ident" id="4779966">z</span><span class="op" id="4779967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4779970">for</span>&nbsp;<span class="ident" id="4779974">i</span>&nbsp;<span class="op" id="4779976">&gt;</span>&nbsp;<span class="num" id="4779978">0</span>&nbsp;<span class="op" id="4779980">&amp;&amp;</span>&nbsp;<span class="ident" id="4779983">z</span><span class="op" id="4779984">[</span><span class="ident" id="4779985">i</span><span class="op" id="4779986">-</span><span class="num" id="4779987">1</span><span class="op" id="4779988">]</span>&nbsp;<span class="op" id="4779990">==</span>&nbsp;<span class="num" id="4779993">0</span>&nbsp;<span class="op" id="4779995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4779999">i</span><span class="op" id="4780000">--</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4780004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780007">return</span>&nbsp;<span class="ident" id="4780014">z</span><span class="op" id="4780015">[</span><span class="num" id="4780016">0</span><span class="op" id="4780017">:</span><span class="ident" id="4780018">i</span><span class="op" id="4780019">]</span><br>
<span class="lineno"></span><span class="op" id="4780021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4780024">func</span>&nbsp;<span class="op" id="4780029">(</span><span class="ident" id="4780030">z</span>&nbsp;<span class="ident" id="4780032">nat</span><span class="op" id="4780035">)</span>&nbsp;<span class="builtinfunc" id="4780037">make</span><span class="op" id="4780041">(</span><span class="ident" id="4780042">n</span>&nbsp;<span class="builtintype" id="4780044">int</span><span class="op" id="4780047">)</span>&nbsp;<span class="ident" id="4780049">nat</span>&nbsp;<span class="op" id="4780053">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780056">if</span>&nbsp;<span class="ident" id="4780059">n</span>&nbsp;<span class="op" id="4780061">&lt;=</span>&nbsp;<span class="builtinfunc" id="4780064">cap</span><span class="op" id="4780067">(</span><span class="ident" id="4780068">z</span><span class="op" id="4780069">)</span>&nbsp;<span class="op" id="4780071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780075">return</span>&nbsp;<span class="ident" id="4780082">z</span><span class="op" id="4780083">[</span><span class="num" id="4780084">0</span><span class="op" id="4780085">:</span><span class="ident" id="4780086">n</span><span class="op" id="4780087">]</span>&nbsp;<span class="comment" id="4780089">//&nbsp;reuse&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4780101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4780104">//&nbsp;Choosing&nbsp;a&nbsp;good&nbsp;value&nbsp;for&nbsp;e&nbsp;has&nbsp;significant&nbsp;performance&nbsp;impact</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4780171">//&nbsp;because&nbsp;it&nbsp;increases&nbsp;the&nbsp;chance&nbsp;that&nbsp;a&nbsp;value&nbsp;can&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780235">const</span>&nbsp;<span class="ident" id="4780241">e</span>&nbsp;<span class="op" id="4780243">=</span>&nbsp;<span class="num" id="4780245">4</span>&nbsp;<span class="comment" id="4780247">//&nbsp;extra&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780266">return</span>&nbsp;<span class="builtinfunc" id="4780273">make</span><span class="op" id="4780277">(</span><span class="ident" id="4780278">nat</span><span class="op" id="4780281">,</span>&nbsp;<span class="ident" id="4780283">n</span><span class="op" id="4780284">,</span>&nbsp;<span class="ident" id="4780286">n</span><span class="op" id="4780287">+</span><span class="ident" id="4780288">e</span><span class="op" id="4780289">)</span><br>
<span class="lineno"></span><span class="op" id="4780291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4780294">func</span>&nbsp;<span class="op" id="4780299">(</span><span class="ident" id="4780300">z</span>&nbsp;<span class="ident" id="4780302">nat</span><span class="op" id="4780305">)</span>&nbsp;<span class="ident" id="4780307">setWord</span><span class="op" id="4780314">(</span><span class="ident" id="4780315">x</span>&nbsp;<span class="ident" id="4780317">Word</span><span class="op" id="4780321">)</span>&nbsp;<span class="ident" id="4780323">nat</span>&nbsp;<span class="op" id="4780327">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780330">if</span>&nbsp;<span class="ident" id="4780333">x</span>&nbsp;<span class="op" id="4780335">==</span>&nbsp;<span class="num" id="4780338">0</span>&nbsp;<span class="op" id="4780340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780344">return</span>&nbsp;<span class="ident" id="4780351">z</span><span class="op" id="4780352">.</span><span class="builtinfunc" id="4780353">make</span><span class="op" id="4780357">(</span><span class="num" id="4780358">0</span><span class="op" id="4780359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4780362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4780365">z</span>&nbsp;<span class="op" id="4780367">=</span>&nbsp;<span class="ident" id="4780369">z</span><span class="op" id="4780370">.</span><span class="builtinfunc" id="4780371">make</span><span class="op" id="4780375">(</span><span class="num" id="4780376">1</span><span class="op" id="4780377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4780380">z</span><span class="op" id="4780381">[</span><span class="num" id="4780382">0</span><span class="op" id="4780383">]</span>&nbsp;<span class="op" id="4780385">=</span>&nbsp;<span class="ident" id="4780387">x</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780390">return</span>&nbsp;<span class="ident" id="4780397">z</span><br>
<span class="lineno"></span><span class="op" id="4780399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4780402">func</span>&nbsp;<span class="op" id="4780407">(</span><span class="ident" id="4780408">z</span>&nbsp;<span class="ident" id="4780410">nat</span><span class="op" id="4780413">)</span>&nbsp;<span class="ident" id="4780415">setUint64</span><span class="op" id="4780424">(</span><span class="ident" id="4780425">x</span>&nbsp;<span class="ident" id="4780427">uint64</span><span class="op" id="4780433">)</span>&nbsp;<span class="ident" id="4780435">nat</span>&nbsp;<span class="op" id="4780439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4780442">//&nbsp;single-digit&nbsp;values</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780466">if</span>&nbsp;<span class="ident" id="4780469">w</span>&nbsp;<span class="op" id="4780471">:=</span>&nbsp;<span class="ident" id="4780474">Word</span><span class="op" id="4780478">(</span><span class="ident" id="4780479">x</span><span class="op" id="4780480">)</span><span class="op" id="4780481">;</span>&nbsp;<span class="ident" id="4780483">uint64</span><span class="op" id="4780489">(</span><span class="ident" id="4780490">w</span><span class="op" id="4780491">)</span>&nbsp;<span class="op" id="4780493">==</span>&nbsp;<span class="ident" id="4780496">x</span>&nbsp;<span class="op" id="4780498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780502">return</span>&nbsp;<span class="ident" id="4780509">z</span><span class="op" id="4780510">.</span><span class="ident" id="4780511">setWord</span><span class="op" id="4780518">(</span><span class="ident" id="4780519">w</span><span class="op" id="4780520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4780523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4780527">//&nbsp;compute&nbsp;number&nbsp;of&nbsp;words&nbsp;n&nbsp;required&nbsp;to&nbsp;represent&nbsp;x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4780581">n</span>&nbsp;<span class="op" id="4780583">:=</span>&nbsp;<span class="num" id="4780586">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780589">for</span>&nbsp;<span class="ident" id="4780593">t</span>&nbsp;<span class="op" id="4780595">:=</span>&nbsp;<span class="ident" id="4780598">x</span><span class="op" id="4780599">;</span>&nbsp;<span class="ident" id="4780601">t</span>&nbsp;<span class="op" id="4780603">&gt;</span>&nbsp;<span class="num" id="4780605">0</span><span class="op" id="4780606">;</span>&nbsp;<span class="ident" id="4780608">t</span>&nbsp;<span class="op" id="4780610">&gt;&gt;=</span>&nbsp;<span class="ident" id="4780614">_W</span>&nbsp;<span class="op" id="4780617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4780621">n</span><span class="op" id="4780622">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4780626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4780630">//&nbsp;split&nbsp;x&nbsp;into&nbsp;n&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4780655">z</span>&nbsp;<span class="op" id="4780657">=</span>&nbsp;<span class="ident" id="4780659">z</span><span class="op" id="4780660">.</span><span class="builtinfunc" id="4780661">make</span><span class="op" id="4780665">(</span><span class="ident" id="4780666">n</span><span class="op" id="4780667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780670">for</span>&nbsp;<span class="ident" id="4780674">i</span>&nbsp;<span class="op" id="4780676">:=</span>&nbsp;<span class="keyword" id="4780679">range</span>&nbsp;<span class="ident" id="4780685">z</span>&nbsp;<span class="op" id="4780687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4780691">z</span><span class="op" id="4780692">[</span><span class="ident" id="4780693">i</span><span class="op" id="4780694">]</span>&nbsp;<span class="op" id="4780696">=</span>&nbsp;<span class="ident" id="4780698">Word</span><span class="op" id="4780702">(</span><span class="ident" id="4780703">x</span>&nbsp;<span class="op" id="4780705">&amp;</span>&nbsp;<span class="ident" id="4780707">_M</span><span class="op" id="4780709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4780713">x</span>&nbsp;<span class="op" id="4780715">&gt;&gt;=</span>&nbsp;<span class="ident" id="4780719">_W</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4780723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780727">return</span>&nbsp;<span class="ident" id="4780734">z</span><br>
<span class="lineno"></span><span class="op" id="4780736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="4780739">func</span>&nbsp;<span class="op" id="4780744">(</span><span class="ident" id="4780745">z</span>&nbsp;<span class="ident" id="4780747">nat</span><span class="op" id="4780750">)</span>&nbsp;<span class="ident" id="4780752">set</span><span class="op" id="4780755">(</span><span class="ident" id="4780756">x</span>&nbsp;<span class="ident" id="4780758">nat</span><span class="op" id="4780761">)</span>&nbsp;<span class="ident" id="4780763">nat</span>&nbsp;<span class="op" id="4780767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4780770">z</span>&nbsp;<span class="op" id="4780772">=</span>&nbsp;<span class="ident" id="4780774">z</span><span class="op" id="4780775">.</span><span class="builtinfunc" id="4780776">make</span><span class="op" id="4780780">(</span><span class="builtinfunc" id="4780781">len</span><span class="op" id="4780784">(</span><span class="ident" id="4780785">x</span><span class="op" id="4780786">)</span><span class="op" id="4780787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4780790">copy</span><span class="op" id="4780794">(</span><span class="ident" id="4780795">z</span><span class="op" id="4780796">,</span>&nbsp;<span class="ident" id="4780798">x</span><span class="op" id="4780799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780802">return</span>&nbsp;<span class="ident" id="4780809">z</span><br>
<span class="lineno"></span><span class="op" id="4780811">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="4780814">func</span>&nbsp;<span class="op" id="4780819">(</span><span class="ident" id="4780820">z</span>&nbsp;<span class="ident" id="4780822">nat</span><span class="op" id="4780825">)</span>&nbsp;<span class="ident" id="4780827">add</span><span class="op" id="4780830">(</span><span class="ident" id="4780831">x</span><span class="op" id="4780832">,</span>&nbsp;<span class="ident" id="4780834">y</span>&nbsp;<span class="ident" id="4780836">nat</span><span class="op" id="4780839">)</span>&nbsp;<span class="ident" id="4780841">nat</span>&nbsp;<span class="op" id="4780845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4780848">m</span>&nbsp;<span class="op" id="4780850">:=</span>&nbsp;<span class="builtinfunc" id="4780853">len</span><span class="op" id="4780856">(</span><span class="ident" id="4780857">x</span><span class="op" id="4780858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4780861">n</span>&nbsp;<span class="op" id="4780863">:=</span>&nbsp;<span class="builtinfunc" id="4780866">len</span><span class="op" id="4780869">(</span><span class="ident" id="4780870">y</span><span class="op" id="4780871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780875">switch</span>&nbsp;<span class="op" id="4780882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780885">case</span>&nbsp;<span class="ident" id="4780890">m</span>&nbsp;<span class="op" id="4780892">&lt;</span>&nbsp;<span class="ident" id="4780894">n</span><span class="op" id="4780895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780899">return</span>&nbsp;<span class="ident" id="4780906">z</span><span class="op" id="4780907">.</span><span class="ident" id="4780908">add</span><span class="op" id="4780911">(</span><span class="ident" id="4780912">y</span><span class="op" id="4780913">,</span>&nbsp;<span class="ident" id="4780915">x</span><span class="op" id="4780916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780919">case</span>&nbsp;<span class="ident" id="4780924">m</span>&nbsp;<span class="op" id="4780926">==</span>&nbsp;<span class="num" id="4780929">0</span><span class="op" id="4780930">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4780934">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780974">return</span>&nbsp;<span class="ident" id="4780981">z</span><span class="op" id="4780982">.</span><span class="builtinfunc" id="4780983">make</span><span class="op" id="4780987">(</span><span class="num" id="4780988">0</span><span class="op" id="4780989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4780992">case</span>&nbsp;<span class="ident" id="4780997">n</span>&nbsp;<span class="op" id="4780999">==</span>&nbsp;<span class="num" id="4781002">0</span><span class="op" id="4781003">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4781007">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781024">return</span>&nbsp;<span class="ident" id="4781031">z</span><span class="op" id="4781032">.</span><span class="ident" id="4781033">set</span><span class="op" id="4781036">(</span><span class="ident" id="4781037">x</span><span class="op" id="4781038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4781041">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4781044">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781055">z</span>&nbsp;<span class="op" id="4781057">=</span>&nbsp;<span class="ident" id="4781059">z</span><span class="op" id="4781060">.</span><span class="builtinfunc" id="4781061">make</span><span class="op" id="4781065">(</span><span class="ident" id="4781066">m</span>&nbsp;<span class="op" id="4781068">+</span>&nbsp;<span class="num" id="4781070">1</span><span class="op" id="4781071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781074">c</span>&nbsp;<span class="op" id="4781076">:=</span>&nbsp;<span class="ident" id="4781079">addVV</span><span class="op" id="4781084">(</span><span class="ident" id="4781085">z</span><span class="op" id="4781086">[</span><span class="num" id="4781087">0</span><span class="op" id="4781088">:</span><span class="ident" id="4781089">n</span><span class="op" id="4781090">]</span><span class="op" id="4781091">,</span>&nbsp;<span class="ident" id="4781093">x</span><span class="op" id="4781094">,</span>&nbsp;<span class="ident" id="4781096">y</span><span class="op" id="4781097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781100">if</span>&nbsp;<span class="ident" id="4781103">m</span>&nbsp;<span class="op" id="4781105">&gt;</span>&nbsp;<span class="ident" id="4781107">n</span>&nbsp;<span class="op" id="4781109">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781113">c</span>&nbsp;<span class="op" id="4781115">=</span>&nbsp;<span class="ident" id="4781117">addVW</span><span class="op" id="4781122">(</span><span class="ident" id="4781123">z</span><span class="op" id="4781124">[</span><span class="ident" id="4781125">n</span><span class="op" id="4781126">:</span><span class="ident" id="4781127">m</span><span class="op" id="4781128">]</span><span class="op" id="4781129">,</span>&nbsp;<span class="ident" id="4781131">x</span><span class="op" id="4781132">[</span><span class="ident" id="4781133">n</span><span class="op" id="4781134">:</span><span class="op" id="4781135">]</span><span class="op" id="4781136">,</span>&nbsp;<span class="ident" id="4781138">c</span><span class="op" id="4781139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4781142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781145">z</span><span class="op" id="4781146">[</span><span class="ident" id="4781147">m</span><span class="op" id="4781148">]</span>&nbsp;<span class="op" id="4781150">=</span>&nbsp;<span class="ident" id="4781152">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781156">return</span>&nbsp;<span class="ident" id="4781163">z</span><span class="op" id="4781164">.</span><span class="ident" id="4781165">norm</span><span class="op" id="4781169">(</span><span class="op" id="4781170">)</span><br>
<span class="lineno">140</span><span class="op" id="4781172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4781175">func</span>&nbsp;<span class="op" id="4781180">(</span><span class="ident" id="4781181">z</span>&nbsp;<span class="ident" id="4781183">nat</span><span class="op" id="4781186">)</span>&nbsp;<span class="ident" id="4781188">sub</span><span class="op" id="4781191">(</span><span class="ident" id="4781192">x</span><span class="op" id="4781193">,</span>&nbsp;<span class="ident" id="4781195">y</span>&nbsp;<span class="ident" id="4781197">nat</span><span class="op" id="4781200">)</span>&nbsp;<span class="ident" id="4781202">nat</span>&nbsp;<span class="op" id="4781206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781209">m</span>&nbsp;<span class="op" id="4781211">:=</span>&nbsp;<span class="builtinfunc" id="4781214">len</span><span class="op" id="4781217">(</span><span class="ident" id="4781218">x</span><span class="op" id="4781219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781222">n</span>&nbsp;<span class="op" id="4781224">:=</span>&nbsp;<span class="builtinfunc" id="4781227">len</span><span class="op" id="4781230">(</span><span class="ident" id="4781231">y</span><span class="op" id="4781232">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781236">switch</span>&nbsp;<span class="op" id="4781243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781246">case</span>&nbsp;<span class="ident" id="4781251">m</span>&nbsp;<span class="op" id="4781253">&lt;</span>&nbsp;<span class="ident" id="4781255">n</span><span class="op" id="4781256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4781260">panic</span><span class="op" id="4781265">(</span><span class="string" id="4781266">&#34;underflow&#34;</span><span class="op" id="4781277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781280">case</span>&nbsp;<span class="ident" id="4781285">m</span>&nbsp;<span class="op" id="4781287">==</span>&nbsp;<span class="num" id="4781290">0</span><span class="op" id="4781291">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4781295">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781335">return</span>&nbsp;<span class="ident" id="4781342">z</span><span class="op" id="4781343">.</span><span class="builtinfunc" id="4781344">make</span><span class="op" id="4781348">(</span><span class="num" id="4781349">0</span><span class="op" id="4781350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781353">case</span>&nbsp;<span class="ident" id="4781358">n</span>&nbsp;<span class="op" id="4781360">==</span>&nbsp;<span class="num" id="4781363">0</span><span class="op" id="4781364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4781368">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781385">return</span>&nbsp;<span class="ident" id="4781392">z</span><span class="op" id="4781393">.</span><span class="ident" id="4781394">set</span><span class="op" id="4781397">(</span><span class="ident" id="4781398">x</span><span class="op" id="4781399">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4781402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4781405">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781416">z</span>&nbsp;<span class="op" id="4781418">=</span>&nbsp;<span class="ident" id="4781420">z</span><span class="op" id="4781421">.</span><span class="builtinfunc" id="4781422">make</span><span class="op" id="4781426">(</span><span class="ident" id="4781427">m</span><span class="op" id="4781428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781431">c</span>&nbsp;<span class="op" id="4781433">:=</span>&nbsp;<span class="ident" id="4781436">subVV</span><span class="op" id="4781441">(</span><span class="ident" id="4781442">z</span><span class="op" id="4781443">[</span><span class="num" id="4781444">0</span><span class="op" id="4781445">:</span><span class="ident" id="4781446">n</span><span class="op" id="4781447">]</span><span class="op" id="4781448">,</span>&nbsp;<span class="ident" id="4781450">x</span><span class="op" id="4781451">,</span>&nbsp;<span class="ident" id="4781453">y</span><span class="op" id="4781454">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781457">if</span>&nbsp;<span class="ident" id="4781460">m</span>&nbsp;<span class="op" id="4781462">&gt;</span>&nbsp;<span class="ident" id="4781464">n</span>&nbsp;<span class="op" id="4781466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781470">c</span>&nbsp;<span class="op" id="4781472">=</span>&nbsp;<span class="ident" id="4781474">subVW</span><span class="op" id="4781479">(</span><span class="ident" id="4781480">z</span><span class="op" id="4781481">[</span><span class="ident" id="4781482">n</span><span class="op" id="4781483">:</span><span class="op" id="4781484">]</span><span class="op" id="4781485">,</span>&nbsp;<span class="ident" id="4781487">x</span><span class="op" id="4781488">[</span><span class="ident" id="4781489">n</span><span class="op" id="4781490">:</span><span class="op" id="4781491">]</span><span class="op" id="4781492">,</span>&nbsp;<span class="ident" id="4781494">c</span><span class="op" id="4781495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4781498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781501">if</span>&nbsp;<span class="ident" id="4781504">c</span>&nbsp;<span class="op" id="4781506">!=</span>&nbsp;<span class="num" id="4781509">0</span>&nbsp;<span class="op" id="4781511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4781515">panic</span><span class="op" id="4781520">(</span><span class="string" id="4781521">&#34;underflow&#34;</span><span class="op" id="4781532">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4781535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781539">return</span>&nbsp;<span class="ident" id="4781546">z</span><span class="op" id="4781547">.</span><span class="ident" id="4781548">norm</span><span class="op" id="4781552">(</span><span class="op" id="4781553">)</span><br>
<span class="lineno"></span><span class="op" id="4781555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="4781558">func</span>&nbsp;<span class="op" id="4781563">(</span><span class="ident" id="4781564">x</span>&nbsp;<span class="ident" id="4781566">nat</span><span class="op" id="4781569">)</span>&nbsp;<span class="ident" id="4781571">cmp</span><span class="op" id="4781574">(</span><span class="ident" id="4781575">y</span>&nbsp;<span class="ident" id="4781577">nat</span><span class="op" id="4781580">)</span>&nbsp;<span class="op" id="4781582">(</span><span class="ident" id="4781583">r</span>&nbsp;<span class="builtintype" id="4781585">int</span><span class="op" id="4781588">)</span>&nbsp;<span class="op" id="4781590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781593">m</span>&nbsp;<span class="op" id="4781595">:=</span>&nbsp;<span class="builtinfunc" id="4781598">len</span><span class="op" id="4781601">(</span><span class="ident" id="4781602">x</span><span class="op" id="4781603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781606">n</span>&nbsp;<span class="op" id="4781608">:=</span>&nbsp;<span class="builtinfunc" id="4781611">len</span><span class="op" id="4781614">(</span><span class="ident" id="4781615">y</span><span class="op" id="4781616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781619">if</span>&nbsp;<span class="ident" id="4781622">m</span>&nbsp;<span class="op" id="4781624">!=</span>&nbsp;<span class="ident" id="4781627">n</span>&nbsp;<span class="op" id="4781629">||</span>&nbsp;<span class="ident" id="4781632">m</span>&nbsp;<span class="op" id="4781634">==</span>&nbsp;<span class="num" id="4781637">0</span>&nbsp;<span class="op" id="4781639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781643">switch</span>&nbsp;<span class="op" id="4781650">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781654">case</span>&nbsp;<span class="ident" id="4781659">m</span>&nbsp;<span class="op" id="4781661">&lt;</span>&nbsp;<span class="ident" id="4781663">n</span><span class="op" id="4781664">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781669">r</span>&nbsp;<span class="op" id="4781671">=</span>&nbsp;<span class="op" id="4781673">-</span><span class="num" id="4781674">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781678">case</span>&nbsp;<span class="ident" id="4781683">m</span>&nbsp;<span class="op" id="4781685">&gt;</span>&nbsp;<span class="ident" id="4781687">n</span><span class="op" id="4781688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781693">r</span>&nbsp;<span class="op" id="4781695">=</span>&nbsp;<span class="num" id="4781697">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4781701">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781705">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4781713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781717">i</span>&nbsp;<span class="op" id="4781719">:=</span>&nbsp;<span class="ident" id="4781722">m</span>&nbsp;<span class="op" id="4781724">-</span>&nbsp;<span class="num" id="4781726">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781729">for</span>&nbsp;<span class="ident" id="4781733">i</span>&nbsp;<span class="op" id="4781735">&gt;</span>&nbsp;<span class="num" id="4781737">0</span>&nbsp;<span class="op" id="4781739">&amp;&amp;</span>&nbsp;<span class="ident" id="4781742">x</span><span class="op" id="4781743">[</span><span class="ident" id="4781744">i</span><span class="op" id="4781745">]</span>&nbsp;<span class="op" id="4781747">==</span>&nbsp;<span class="ident" id="4781750">y</span><span class="op" id="4781751">[</span><span class="ident" id="4781752">i</span><span class="op" id="4781753">]</span>&nbsp;<span class="op" id="4781755">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781759">i</span><span class="op" id="4781760">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4781764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781768">switch</span>&nbsp;<span class="op" id="4781775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781778">case</span>&nbsp;<span class="ident" id="4781783">x</span><span class="op" id="4781784">[</span><span class="ident" id="4781785">i</span><span class="op" id="4781786">]</span>&nbsp;<span class="op" id="4781788">&lt;</span>&nbsp;<span class="ident" id="4781790">y</span><span class="op" id="4781791">[</span><span class="ident" id="4781792">i</span><span class="op" id="4781793">]</span><span class="op" id="4781794">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781798">r</span>&nbsp;<span class="op" id="4781800">=</span>&nbsp;<span class="op" id="4781802">-</span><span class="num" id="4781803">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781806">case</span>&nbsp;<span class="ident" id="4781811">x</span><span class="op" id="4781812">[</span><span class="ident" id="4781813">i</span><span class="op" id="4781814">]</span>&nbsp;<span class="op" id="4781816">&gt;</span>&nbsp;<span class="ident" id="4781818">y</span><span class="op" id="4781819">[</span><span class="ident" id="4781820">i</span><span class="op" id="4781821">]</span><span class="op" id="4781822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781826">r</span>&nbsp;<span class="op" id="4781828">=</span>&nbsp;<span class="num" id="4781830">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4781833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781836">return</span><br>
<span class="lineno">195</span><span class="op" id="4781843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4781846">func</span>&nbsp;<span class="op" id="4781851">(</span><span class="ident" id="4781852">z</span>&nbsp;<span class="ident" id="4781854">nat</span><span class="op" id="4781857">)</span>&nbsp;<span class="ident" id="4781859">mulAddWW</span><span class="op" id="4781867">(</span><span class="ident" id="4781868">x</span>&nbsp;<span class="ident" id="4781870">nat</span><span class="op" id="4781873">,</span>&nbsp;<span class="ident" id="4781875">y</span><span class="op" id="4781876">,</span>&nbsp;<span class="ident" id="4781878">r</span>&nbsp;<span class="ident" id="4781880">Word</span><span class="op" id="4781884">)</span>&nbsp;<span class="ident" id="4781886">nat</span>&nbsp;<span class="op" id="4781890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781893">m</span>&nbsp;<span class="op" id="4781895">:=</span>&nbsp;<span class="builtinfunc" id="4781898">len</span><span class="op" id="4781901">(</span><span class="ident" id="4781902">x</span><span class="op" id="4781903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781906">if</span>&nbsp;<span class="ident" id="4781909">m</span>&nbsp;<span class="op" id="4781911">==</span>&nbsp;<span class="num" id="4781914">0</span>&nbsp;<span class="op" id="4781916">||</span>&nbsp;<span class="ident" id="4781919">y</span>&nbsp;<span class="op" id="4781921">==</span>&nbsp;<span class="num" id="4781924">0</span>&nbsp;<span class="op" id="4781926">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4781930">return</span>&nbsp;<span class="ident" id="4781937">z</span><span class="op" id="4781938">.</span><span class="ident" id="4781939">setWord</span><span class="op" id="4781946">(</span><span class="ident" id="4781947">r</span><span class="op" id="4781948">)</span>&nbsp;<span class="comment" id="4781950">//&nbsp;result&nbsp;is&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4781966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4781969">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781980">z</span>&nbsp;<span class="op" id="4781982">=</span>&nbsp;<span class="ident" id="4781984">z</span><span class="op" id="4781985">.</span><span class="builtinfunc" id="4781986">make</span><span class="op" id="4781990">(</span><span class="ident" id="4781991">m</span>&nbsp;<span class="op" id="4781993">+</span>&nbsp;<span class="num" id="4781995">1</span><span class="op" id="4781996">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4781999">z</span><span class="op" id="4782000">[</span><span class="ident" id="4782001">m</span><span class="op" id="4782002">]</span>&nbsp;<span class="op" id="4782004">=</span>&nbsp;<span class="ident" id="4782006">mulAddVWW</span><span class="op" id="4782015">(</span><span class="ident" id="4782016">z</span><span class="op" id="4782017">[</span><span class="num" id="4782018">0</span><span class="op" id="4782019">:</span><span class="ident" id="4782020">m</span><span class="op" id="4782021">]</span><span class="op" id="4782022">,</span>&nbsp;<span class="ident" id="4782024">x</span><span class="op" id="4782025">,</span>&nbsp;<span class="ident" id="4782027">y</span><span class="op" id="4782028">,</span>&nbsp;<span class="ident" id="4782030">r</span><span class="op" id="4782031">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4782035">return</span>&nbsp;<span class="ident" id="4782042">z</span><span class="op" id="4782043">.</span><span class="ident" id="4782044">norm</span><span class="op" id="4782048">(</span><span class="op" id="4782049">)</span><br>
<span class="lineno"></span><span class="op" id="4782051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="4782054">//&nbsp;basicMul&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4782113">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;len(x)&nbsp;+&nbsp;len(y)].</span><br>
<span class="lineno"></span><span class="keyword" id="4782181">func</span>&nbsp;<span class="ident" id="4782186">basicMul</span><span class="op" id="4782194">(</span><span class="ident" id="4782195">z</span><span class="op" id="4782196">,</span>&nbsp;<span class="ident" id="4782198">x</span><span class="op" id="4782199">,</span>&nbsp;<span class="ident" id="4782201">y</span>&nbsp;<span class="ident" id="4782203">nat</span><span class="op" id="4782206">)</span>&nbsp;<span class="op" id="4782208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4782211">z</span><span class="op" id="4782212">[</span><span class="num" id="4782213">0</span>&nbsp;<span class="op" id="4782215">:</span>&nbsp;<span class="builtinfunc" id="4782217">len</span><span class="op" id="4782220">(</span><span class="ident" id="4782221">x</span><span class="op" id="4782222">)</span><span class="op" id="4782223">+</span><span class="builtinfunc" id="4782224">len</span><span class="op" id="4782227">(</span><span class="ident" id="4782228">y</span><span class="op" id="4782229">)</span><span class="op" id="4782230">]</span><span class="op" id="4782231">.</span><span class="ident" id="4782232">clear</span><span class="op" id="4782237">(</span><span class="op" id="4782238">)</span>&nbsp;<span class="comment" id="4782240">//&nbsp;initialize&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4782257">for</span>&nbsp;<span class="ident" id="4782261">i</span><span class="op" id="4782262">,</span>&nbsp;<span class="ident" id="4782264">d</span>&nbsp;<span class="op" id="4782266">:=</span>&nbsp;<span class="keyword" id="4782269">range</span>&nbsp;<span class="ident" id="4782275">y</span>&nbsp;<span class="op" id="4782277">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4782281">if</span>&nbsp;<span class="ident" id="4782284">d</span>&nbsp;<span class="op" id="4782286">!=</span>&nbsp;<span class="num" id="4782289">0</span>&nbsp;<span class="op" id="4782291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4782296">z</span><span class="op" id="4782297">[</span><span class="builtinfunc" id="4782298">len</span><span class="op" id="4782301">(</span><span class="ident" id="4782302">x</span><span class="op" id="4782303">)</span><span class="op" id="4782304">+</span><span class="ident" id="4782305">i</span><span class="op" id="4782306">]</span>&nbsp;<span class="op" id="4782308">=</span>&nbsp;<span class="ident" id="4782310">addMulVVW</span><span class="op" id="4782319">(</span><span class="ident" id="4782320">z</span><span class="op" id="4782321">[</span><span class="ident" id="4782322">i</span><span class="op" id="4782323">:</span><span class="ident" id="4782324">i</span><span class="op" id="4782325">+</span><span class="builtinfunc" id="4782326">len</span><span class="op" id="4782329">(</span><span class="ident" id="4782330">x</span><span class="op" id="4782331">)</span><span class="op" id="4782332">]</span><span class="op" id="4782333">,</span>&nbsp;<span class="ident" id="4782335">x</span><span class="op" id="4782336">,</span>&nbsp;<span class="ident" id="4782338">d</span><span class="op" id="4782339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4782343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4782346">}</span><br>
<span class="lineno"></span><span class="op" id="4782348">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="4782351">//&nbsp;Fast&nbsp;version&nbsp;of&nbsp;z[0:n+n&gt;&gt;1].add(z[0:n+n&gt;&gt;1],&nbsp;x[0:n])&nbsp;w/o&nbsp;bounds&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="4782426">//&nbsp;Factored&nbsp;out&nbsp;for&nbsp;readability&nbsp;-&nbsp;do&nbsp;not&nbsp;use&nbsp;outside&nbsp;karatsuba.</span><br>
<span class="lineno"></span><span class="keyword" id="4782490">func</span>&nbsp;<span class="ident" id="4782495">karatsubaAdd</span><span class="op" id="4782507">(</span><span class="ident" id="4782508">z</span><span class="op" id="4782509">,</span>&nbsp;<span class="ident" id="4782511">x</span>&nbsp;<span class="ident" id="4782513">nat</span><span class="op" id="4782516">,</span>&nbsp;<span class="ident" id="4782518">n</span>&nbsp;<span class="builtintype" id="4782520">int</span><span class="op" id="4782523">)</span>&nbsp;<span class="op" id="4782525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4782528">if</span>&nbsp;<span class="ident" id="4782531">c</span>&nbsp;<span class="op" id="4782533">:=</span>&nbsp;<span class="ident" id="4782536">addVV</span><span class="op" id="4782541">(</span><span class="ident" id="4782542">z</span><span class="op" id="4782543">[</span><span class="num" id="4782544">0</span><span class="op" id="4782545">:</span><span class="ident" id="4782546">n</span><span class="op" id="4782547">]</span><span class="op" id="4782548">,</span>&nbsp;<span class="ident" id="4782550">z</span><span class="op" id="4782551">,</span>&nbsp;<span class="ident" id="4782553">x</span><span class="op" id="4782554">)</span><span class="op" id="4782555">;</span>&nbsp;<span class="ident" id="4782557">c</span>&nbsp;<span class="op" id="4782559">!=</span>&nbsp;<span class="num" id="4782562">0</span>&nbsp;<span class="op" id="4782564">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4782568">addVW</span><span class="op" id="4782573">(</span><span class="ident" id="4782574">z</span><span class="op" id="4782575">[</span><span class="ident" id="4782576">n</span><span class="op" id="4782577">:</span><span class="ident" id="4782578">n</span><span class="op" id="4782579">+</span><span class="ident" id="4782580">n</span><span class="op" id="4782581">&gt;&gt;</span><span class="num" id="4782583">1</span><span class="op" id="4782584">]</span><span class="op" id="4782585">,</span>&nbsp;<span class="ident" id="4782587">z</span><span class="op" id="4782588">[</span><span class="ident" id="4782589">n</span><span class="op" id="4782590">:</span><span class="op" id="4782591">]</span><span class="op" id="4782592">,</span>&nbsp;<span class="ident" id="4782594">c</span><span class="op" id="4782595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4782598">}</span><br>
<span class="lineno"></span><span class="op" id="4782600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4782603">//&nbsp;Like&nbsp;karatsubaAdd,&nbsp;but&nbsp;does&nbsp;subtract.</span><br>
<span class="lineno">230</span><span class="keyword" id="4782644">func</span>&nbsp;<span class="ident" id="4782649">karatsubaSub</span><span class="op" id="4782661">(</span><span class="ident" id="4782662">z</span><span class="op" id="4782663">,</span>&nbsp;<span class="ident" id="4782665">x</span>&nbsp;<span class="ident" id="4782667">nat</span><span class="op" id="4782670">,</span>&nbsp;<span class="ident" id="4782672">n</span>&nbsp;<span class="builtintype" id="4782674">int</span><span class="op" id="4782677">)</span>&nbsp;<span class="op" id="4782679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4782682">if</span>&nbsp;<span class="ident" id="4782685">c</span>&nbsp;<span class="op" id="4782687">:=</span>&nbsp;<span class="ident" id="4782690">subVV</span><span class="op" id="4782695">(</span><span class="ident" id="4782696">z</span><span class="op" id="4782697">[</span><span class="num" id="4782698">0</span><span class="op" id="4782699">:</span><span class="ident" id="4782700">n</span><span class="op" id="4782701">]</span><span class="op" id="4782702">,</span>&nbsp;<span class="ident" id="4782704">z</span><span class="op" id="4782705">,</span>&nbsp;<span class="ident" id="4782707">x</span><span class="op" id="4782708">)</span><span class="op" id="4782709">;</span>&nbsp;<span class="ident" id="4782711">c</span>&nbsp;<span class="op" id="4782713">!=</span>&nbsp;<span class="num" id="4782716">0</span>&nbsp;<span class="op" id="4782718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4782722">subVW</span><span class="op" id="4782727">(</span><span class="ident" id="4782728">z</span><span class="op" id="4782729">[</span><span class="ident" id="4782730">n</span><span class="op" id="4782731">:</span><span class="ident" id="4782732">n</span><span class="op" id="4782733">+</span><span class="ident" id="4782734">n</span><span class="op" id="4782735">&gt;&gt;</span><span class="num" id="4782737">1</span><span class="op" id="4782738">]</span><span class="op" id="4782739">,</span>&nbsp;<span class="ident" id="4782741">z</span><span class="op" id="4782742">[</span><span class="ident" id="4782743">n</span><span class="op" id="4782744">:</span><span class="op" id="4782745">]</span><span class="op" id="4782746">,</span>&nbsp;<span class="ident" id="4782748">c</span><span class="op" id="4782749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4782752">}</span><br>
<span class="lineno"></span><span class="op" id="4782754">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="4782757">//&nbsp;Operands&nbsp;that&nbsp;are&nbsp;shorter&nbsp;than&nbsp;karatsubaThreshold&nbsp;are&nbsp;multiplied&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="4782831">//&nbsp;&#34;grade&nbsp;school&#34;&nbsp;multiplication;&nbsp;for&nbsp;longer&nbsp;operands&nbsp;the&nbsp;Karatsuba&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="4782909">//&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4782921">var</span>&nbsp;<span class="ident" id="4782925">karatsubaThreshold</span>&nbsp;<span class="builtintype" id="4782944">int</span>&nbsp;<span class="op" id="4782948">=</span>&nbsp;<span class="num" id="4782950">40</span>&nbsp;<span class="comment" id="4782953">//&nbsp;computed&nbsp;by&nbsp;calibrate.go</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="4782982">//&nbsp;karatsuba&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4783042">//&nbsp;Both&nbsp;x&nbsp;and&nbsp;y&nbsp;must&nbsp;have&nbsp;the&nbsp;same&nbsp;length&nbsp;n&nbsp;and&nbsp;n&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4783102">//&nbsp;power&nbsp;of&nbsp;2.&nbsp;The&nbsp;result&nbsp;vector&nbsp;z&nbsp;must&nbsp;have&nbsp;len(z)&nbsp;&gt;=&nbsp;6*n.</span><br>
<span class="lineno"></span><span class="comment" id="4783162">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;2*n].</span><br>
<span class="lineno">245</span><span class="keyword" id="4783218">func</span>&nbsp;<span class="ident" id="4783223">karatsuba</span><span class="op" id="4783232">(</span><span class="ident" id="4783233">z</span><span class="op" id="4783234">,</span>&nbsp;<span class="ident" id="4783236">x</span><span class="op" id="4783237">,</span>&nbsp;<span class="ident" id="4783239">y</span>&nbsp;<span class="ident" id="4783241">nat</span><span class="op" id="4783244">)</span>&nbsp;<span class="op" id="4783246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4783249">n</span>&nbsp;<span class="op" id="4783251">:=</span>&nbsp;<span class="builtinfunc" id="4783254">len</span><span class="op" id="4783257">(</span><span class="ident" id="4783258">y</span><span class="op" id="4783259">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783263">//&nbsp;Switch&nbsp;to&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;numbers&nbsp;are&nbsp;odd&nbsp;or&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783327">//&nbsp;(n&nbsp;is&nbsp;always&nbsp;even&nbsp;if&nbsp;karatsubaThreshold&nbsp;is&nbsp;even,&nbsp;but&nbsp;be</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783387">//&nbsp;conservative)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4783405">if</span>&nbsp;<span class="ident" id="4783408">n</span><span class="op" id="4783409">&amp;</span><span class="num" id="4783410">1</span>&nbsp;<span class="op" id="4783412">!=</span>&nbsp;<span class="num" id="4783415">0</span>&nbsp;<span class="op" id="4783417">||</span>&nbsp;<span class="ident" id="4783420">n</span>&nbsp;<span class="op" id="4783422">&lt;</span>&nbsp;<span class="ident" id="4783424">karatsubaThreshold</span>&nbsp;<span class="op" id="4783443">||</span>&nbsp;<span class="ident" id="4783446">n</span>&nbsp;<span class="op" id="4783448">&lt;</span>&nbsp;<span class="num" id="4783450">2</span>&nbsp;<span class="op" id="4783452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4783456">basicMul</span><span class="op" id="4783464">(</span><span class="ident" id="4783465">z</span><span class="op" id="4783466">,</span>&nbsp;<span class="ident" id="4783468">x</span><span class="op" id="4783469">,</span>&nbsp;<span class="ident" id="4783471">y</span><span class="op" id="4783472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4783476">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4783484">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783487">//&nbsp;n&amp;1&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783538">//&nbsp;Karatsuba&nbsp;multiplication&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;observation&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783600">//&nbsp;for&nbsp;two&nbsp;numbers&nbsp;x&nbsp;and&nbsp;y&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783634">//</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783638">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783658">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783678">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783682">//&nbsp;the&nbsp;product&nbsp;x*y&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;3&nbsp;products&nbsp;z2,&nbsp;z1,&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783745">//&nbsp;instead&nbsp;of&nbsp;4:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783763">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783767">//&nbsp;&nbsp;&nbsp;x*y&nbsp;=&nbsp;x1*y1*b*b&nbsp;+&nbsp;(x1*y0&nbsp;+&nbsp;x0*y1)*b&nbsp;+&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783817">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z2*b*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z1*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783867">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783871">//&nbsp;with:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783881">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783885">//&nbsp;&nbsp;&nbsp;xd&nbsp;=&nbsp;x1&nbsp;-&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783904">//&nbsp;&nbsp;&nbsp;yd&nbsp;=&nbsp;y0&nbsp;-&nbsp;y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783923">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783927">//&nbsp;&nbsp;&nbsp;z1&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xd*yd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783978">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(x1-x0)*(y0&nbsp;-&nbsp;y1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784029">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784080">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z2&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784131">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;x0*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784173">//&nbsp;split&nbsp;x,&nbsp;y&nbsp;into&nbsp;&#34;digits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784202">n2</span>&nbsp;<span class="op" id="4784205">:=</span>&nbsp;<span class="ident" id="4784208">n</span>&nbsp;<span class="op" id="4784210">&gt;&gt;</span>&nbsp;<span class="num" id="4784213">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4784228">//&nbsp;n2&nbsp;&gt;=&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784240">x1</span><span class="op" id="4784242">,</span>&nbsp;<span class="ident" id="4784244">x0</span>&nbsp;<span class="op" id="4784247">:=</span>&nbsp;<span class="ident" id="4784250">x</span><span class="op" id="4784251">[</span><span class="ident" id="4784252">n2</span><span class="op" id="4784254">:</span><span class="op" id="4784255">]</span><span class="op" id="4784256">,</span>&nbsp;<span class="ident" id="4784258">x</span><span class="op" id="4784259">[</span><span class="num" id="4784260">0</span><span class="op" id="4784261">:</span><span class="ident" id="4784262">n2</span><span class="op" id="4784264">]</span>&nbsp;<span class="comment" id="4784266">//&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784284">y1</span><span class="op" id="4784286">,</span>&nbsp;<span class="ident" id="4784288">y0</span>&nbsp;<span class="op" id="4784291">:=</span>&nbsp;<span class="ident" id="4784294">y</span><span class="op" id="4784295">[</span><span class="ident" id="4784296">n2</span><span class="op" id="4784298">:</span><span class="op" id="4784299">]</span><span class="op" id="4784300">,</span>&nbsp;<span class="ident" id="4784302">y</span><span class="op" id="4784303">[</span><span class="num" id="4784304">0</span><span class="op" id="4784305">:</span><span class="ident" id="4784306">n2</span><span class="op" id="4784308">]</span>&nbsp;<span class="comment" id="4784310">//&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784329">//&nbsp;z&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;result&nbsp;and&nbsp;temporary&nbsp;storage:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784381">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784385">//&nbsp;&nbsp;&nbsp;6*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0*n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784443">//&nbsp;z&nbsp;=&nbsp;[z2&nbsp;copy|z0&nbsp;copy|&nbsp;xd*yd&nbsp;|&nbsp;yd:xd&nbsp;|&nbsp;x1*y1&nbsp;|&nbsp;x0*y0&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784501">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784505">//&nbsp;For&nbsp;each&nbsp;recursive&nbsp;call&nbsp;of&nbsp;karatsuba,&nbsp;an&nbsp;unused&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784566">//&nbsp;z&nbsp;is&nbsp;passed&nbsp;in&nbsp;that&nbsp;has&nbsp;(at&nbsp;least)&nbsp;half&nbsp;the&nbsp;length&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784628">//&nbsp;caller&#39;s&nbsp;z.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784645">//&nbsp;compute&nbsp;z0&nbsp;and&nbsp;z2&nbsp;with&nbsp;the&nbsp;result&nbsp;&#34;in&nbsp;place&#34;&nbsp;in&nbsp;z</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784699">karatsuba</span><span class="op" id="4784708">(</span><span class="ident" id="4784709">z</span><span class="op" id="4784710">,</span>&nbsp;<span class="ident" id="4784712">x0</span><span class="op" id="4784714">,</span>&nbsp;<span class="ident" id="4784716">y0</span><span class="op" id="4784718">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4784724">//&nbsp;z0&nbsp;=&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784739">karatsuba</span><span class="op" id="4784748">(</span><span class="ident" id="4784749">z</span><span class="op" id="4784750">[</span><span class="ident" id="4784751">n</span><span class="op" id="4784752">:</span><span class="op" id="4784753">]</span><span class="op" id="4784754">,</span>&nbsp;<span class="ident" id="4784756">x1</span><span class="op" id="4784758">,</span>&nbsp;<span class="ident" id="4784760">y1</span><span class="op" id="4784762">)</span>&nbsp;<span class="comment" id="4784764">//&nbsp;z2&nbsp;=&nbsp;x1*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784780">//&nbsp;compute&nbsp;xd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784839">s</span>&nbsp;<span class="op" id="4784841">:=</span>&nbsp;<span class="num" id="4784844">1</span>&nbsp;<span class="comment" id="4784846">//&nbsp;sign&nbsp;of&nbsp;product&nbsp;xd*yd</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784872">xd</span>&nbsp;<span class="op" id="4784875">:=</span>&nbsp;<span class="ident" id="4784878">z</span><span class="op" id="4784879">[</span><span class="num" id="4784880">2</span><span class="op" id="4784881">*</span><span class="ident" id="4784882">n</span>&nbsp;<span class="op" id="4784884">:</span>&nbsp;<span class="num" id="4784886">2</span><span class="op" id="4784887">*</span><span class="ident" id="4784888">n</span><span class="op" id="4784889">+</span><span class="ident" id="4784890">n2</span><span class="op" id="4784892">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784895">if</span>&nbsp;<span class="ident" id="4784898">subVV</span><span class="op" id="4784903">(</span><span class="ident" id="4784904">xd</span><span class="op" id="4784906">,</span>&nbsp;<span class="ident" id="4784908">x1</span><span class="op" id="4784910">,</span>&nbsp;<span class="ident" id="4784912">x0</span><span class="op" id="4784914">)</span>&nbsp;<span class="op" id="4784916">!=</span>&nbsp;<span class="num" id="4784919">0</span>&nbsp;<span class="op" id="4784921">{</span>&nbsp;<span class="comment" id="4784923">//&nbsp;x1-x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784934">s</span>&nbsp;<span class="op" id="4784936">=</span>&nbsp;<span class="op" id="4784938">-</span><span class="ident" id="4784939">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784943">subVV</span><span class="op" id="4784948">(</span><span class="ident" id="4784949">xd</span><span class="op" id="4784951">,</span>&nbsp;<span class="ident" id="4784953">x0</span><span class="op" id="4784955">,</span>&nbsp;<span class="ident" id="4784957">x1</span><span class="op" id="4784959">)</span>&nbsp;<span class="comment" id="4784961">//&nbsp;x0-x1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4784971">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784975">//&nbsp;compute&nbsp;yd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785034">yd</span>&nbsp;<span class="op" id="4785037">:=</span>&nbsp;<span class="ident" id="4785040">z</span><span class="op" id="4785041">[</span><span class="num" id="4785042">2</span><span class="op" id="4785043">*</span><span class="ident" id="4785044">n</span><span class="op" id="4785045">+</span><span class="ident" id="4785046">n2</span>&nbsp;<span class="op" id="4785049">:</span>&nbsp;<span class="num" id="4785051">3</span><span class="op" id="4785052">*</span><span class="ident" id="4785053">n</span><span class="op" id="4785054">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4785057">if</span>&nbsp;<span class="ident" id="4785060">subVV</span><span class="op" id="4785065">(</span><span class="ident" id="4785066">yd</span><span class="op" id="4785068">,</span>&nbsp;<span class="ident" id="4785070">y0</span><span class="op" id="4785072">,</span>&nbsp;<span class="ident" id="4785074">y1</span><span class="op" id="4785076">)</span>&nbsp;<span class="op" id="4785078">!=</span>&nbsp;<span class="num" id="4785081">0</span>&nbsp;<span class="op" id="4785083">{</span>&nbsp;<span class="comment" id="4785085">//&nbsp;y0-y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785096">s</span>&nbsp;<span class="op" id="4785098">=</span>&nbsp;<span class="op" id="4785100">-</span><span class="ident" id="4785101">s</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785105">subVV</span><span class="op" id="4785110">(</span><span class="ident" id="4785111">yd</span><span class="op" id="4785113">,</span>&nbsp;<span class="ident" id="4785115">y1</span><span class="op" id="4785117">,</span>&nbsp;<span class="ident" id="4785119">y0</span><span class="op" id="4785121">)</span>&nbsp;<span class="comment" id="4785123">//&nbsp;y1-y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4785133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4785137">//&nbsp;p&nbsp;=&nbsp;(x1-x0)*(y0-y1)&nbsp;==&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;for&nbsp;s&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4785204">//&nbsp;p&nbsp;=&nbsp;(x0-x1)*(y0-y1)&nbsp;==&nbsp;x0*y0&nbsp;-&nbsp;x0*y1&nbsp;-&nbsp;x1*y0&nbsp;+&nbsp;x1*y1&nbsp;for&nbsp;s&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785271">p</span>&nbsp;<span class="op" id="4785273">:=</span>&nbsp;<span class="ident" id="4785276">z</span><span class="op" id="4785277">[</span><span class="ident" id="4785278">n</span><span class="op" id="4785279">*</span><span class="num" id="4785280">3</span><span class="op" id="4785281">:</span><span class="op" id="4785282">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785285">karatsuba</span><span class="op" id="4785294">(</span><span class="ident" id="4785295">p</span><span class="op" id="4785296">,</span>&nbsp;<span class="ident" id="4785298">xd</span><span class="op" id="4785300">,</span>&nbsp;<span class="ident" id="4785302">yd</span><span class="op" id="4785304">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4785308">//&nbsp;save&nbsp;original&nbsp;z2:z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4785332">//&nbsp;(ok&nbsp;to&nbsp;use&nbsp;upper&nbsp;half&nbsp;of&nbsp;z&nbsp;since&nbsp;we&#39;re&nbsp;done&nbsp;recursing)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785391">r</span>&nbsp;<span class="op" id="4785393">:=</span>&nbsp;<span class="ident" id="4785396">z</span><span class="op" id="4785397">[</span><span class="ident" id="4785398">n</span><span class="op" id="4785399">*</span><span class="num" id="4785400">4</span><span class="op" id="4785401">:</span><span class="op" id="4785402">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4785405">copy</span><span class="op" id="4785409">(</span><span class="ident" id="4785410">r</span><span class="op" id="4785411">,</span>&nbsp;<span class="ident" id="4785413">z</span><span class="op" id="4785414">[</span><span class="op" id="4785415">:</span><span class="ident" id="4785416">n</span><span class="op" id="4785417">*</span><span class="num" id="4785418">2</span><span class="op" id="4785419">]</span><span class="op" id="4785420">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4785424">//&nbsp;add&nbsp;up&nbsp;all&nbsp;partial&nbsp;products</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4785456">//</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4785460">//&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4785482">//&nbsp;z&nbsp;=&nbsp;[&nbsp;z2&nbsp;&nbsp;|&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4785504">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4785523">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z2&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4785542">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;p&nbsp;&nbsp;]</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4785561">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785565">karatsubaAdd</span><span class="op" id="4785577">(</span><span class="ident" id="4785578">z</span><span class="op" id="4785579">[</span><span class="ident" id="4785580">n2</span><span class="op" id="4785582">:</span><span class="op" id="4785583">]</span><span class="op" id="4785584">,</span>&nbsp;<span class="ident" id="4785586">r</span><span class="op" id="4785587">,</span>&nbsp;<span class="ident" id="4785589">n</span><span class="op" id="4785590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785593">karatsubaAdd</span><span class="op" id="4785605">(</span><span class="ident" id="4785606">z</span><span class="op" id="4785607">[</span><span class="ident" id="4785608">n2</span><span class="op" id="4785610">:</span><span class="op" id="4785611">]</span><span class="op" id="4785612">,</span>&nbsp;<span class="ident" id="4785614">r</span><span class="op" id="4785615">[</span><span class="ident" id="4785616">n</span><span class="op" id="4785617">:</span><span class="op" id="4785618">]</span><span class="op" id="4785619">,</span>&nbsp;<span class="ident" id="4785621">n</span><span class="op" id="4785622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4785625">if</span>&nbsp;<span class="ident" id="4785628">s</span>&nbsp;<span class="op" id="4785630">&gt;</span>&nbsp;<span class="num" id="4785632">0</span>&nbsp;<span class="op" id="4785634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785638">karatsubaAdd</span><span class="op" id="4785650">(</span><span class="ident" id="4785651">z</span><span class="op" id="4785652">[</span><span class="ident" id="4785653">n2</span><span class="op" id="4785655">:</span><span class="op" id="4785656">]</span><span class="op" id="4785657">,</span>&nbsp;<span class="ident" id="4785659">p</span><span class="op" id="4785660">,</span>&nbsp;<span class="ident" id="4785662">n</span><span class="op" id="4785663">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4785666">}</span>&nbsp;<span class="keyword" id="4785668">else</span>&nbsp;<span class="op" id="4785673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785677">karatsubaSub</span><span class="op" id="4785689">(</span><span class="ident" id="4785690">z</span><span class="op" id="4785691">[</span><span class="ident" id="4785692">n2</span><span class="op" id="4785694">:</span><span class="op" id="4785695">]</span><span class="op" id="4785696">,</span>&nbsp;<span class="ident" id="4785698">p</span><span class="op" id="4785699">,</span>&nbsp;<span class="ident" id="4785701">n</span><span class="op" id="4785702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4785705">}</span><br>
<span class="lineno"></span><span class="op" id="4785707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="4785710">//&nbsp;alias&nbsp;returns&nbsp;true&nbsp;if&nbsp;x&nbsp;and&nbsp;y&nbsp;share&nbsp;the&nbsp;same&nbsp;base&nbsp;array.</span><br>
<span class="lineno"></span><span class="keyword" id="4785770">func</span>&nbsp;<span class="ident" id="4785775">alias</span><span class="op" id="4785780">(</span><span class="ident" id="4785781">x</span><span class="op" id="4785782">,</span>&nbsp;<span class="ident" id="4785784">y</span>&nbsp;<span class="ident" id="4785786">nat</span><span class="op" id="4785789">)</span>&nbsp;<span class="builtintype" id="4785791">bool</span>&nbsp;<span class="op" id="4785796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4785799">return</span>&nbsp;<span class="builtinfunc" id="4785806">cap</span><span class="op" id="4785809">(</span><span class="ident" id="4785810">x</span><span class="op" id="4785811">)</span>&nbsp;<span class="op" id="4785813">&gt;</span>&nbsp;<span class="num" id="4785815">0</span>&nbsp;<span class="op" id="4785817">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4785820">cap</span><span class="op" id="4785823">(</span><span class="ident" id="4785824">y</span><span class="op" id="4785825">)</span>&nbsp;<span class="op" id="4785827">&gt;</span>&nbsp;<span class="num" id="4785829">0</span>&nbsp;<span class="op" id="4785831">&amp;&amp;</span>&nbsp;<span class="op" id="4785834">&amp;</span><span class="ident" id="4785835">x</span><span class="op" id="4785836">[</span><span class="num" id="4785837">0</span><span class="op" id="4785838">:</span><span class="builtinfunc" id="4785839">cap</span><span class="op" id="4785842">(</span><span class="ident" id="4785843">x</span><span class="op" id="4785844">)</span><span class="op" id="4785845">]</span><span class="op" id="4785846">[</span><span class="builtinfunc" id="4785847">cap</span><span class="op" id="4785850">(</span><span class="ident" id="4785851">x</span><span class="op" id="4785852">)</span><span class="op" id="4785853">-</span><span class="num" id="4785854">1</span><span class="op" id="4785855">]</span>&nbsp;<span class="op" id="4785857">==</span>&nbsp;<span class="op" id="4785860">&amp;</span><span class="ident" id="4785861">y</span><span class="op" id="4785862">[</span><span class="num" id="4785863">0</span><span class="op" id="4785864">:</span><span class="builtinfunc" id="4785865">cap</span><span class="op" id="4785868">(</span><span class="ident" id="4785869">y</span><span class="op" id="4785870">)</span><span class="op" id="4785871">]</span><span class="op" id="4785872">[</span><span class="builtinfunc" id="4785873">cap</span><span class="op" id="4785876">(</span><span class="ident" id="4785877">y</span><span class="op" id="4785878">)</span><span class="op" id="4785879">-</span><span class="num" id="4785880">1</span><span class="op" id="4785881">]</span><br>
<span class="lineno"></span><span class="op" id="4785883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="4785886">//&nbsp;addAt&nbsp;implements&nbsp;z&nbsp;+=&nbsp;x&lt;&lt;(_W*i);&nbsp;z&nbsp;must&nbsp;be&nbsp;long&nbsp;enough.</span><br>
<span class="lineno"></span><span class="comment" id="4785945">//&nbsp;(we&nbsp;don&#39;t&nbsp;use&nbsp;nat.add&nbsp;because&nbsp;we&nbsp;need&nbsp;z&nbsp;to&nbsp;stay&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="4786005">//&nbsp;slice,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;normalize&nbsp;z&nbsp;after&nbsp;each&nbsp;addition)</span><br>
<span class="lineno"></span><span class="keyword" id="4786069">func</span>&nbsp;<span class="ident" id="4786074">addAt</span><span class="op" id="4786079">(</span><span class="ident" id="4786080">z</span><span class="op" id="4786081">,</span>&nbsp;<span class="ident" id="4786083">x</span>&nbsp;<span class="ident" id="4786085">nat</span><span class="op" id="4786088">,</span>&nbsp;<span class="ident" id="4786090">i</span>&nbsp;<span class="builtintype" id="4786092">int</span><span class="op" id="4786095">)</span>&nbsp;<span class="op" id="4786097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786100">if</span>&nbsp;<span class="ident" id="4786103">n</span>&nbsp;<span class="op" id="4786105">:=</span>&nbsp;<span class="builtinfunc" id="4786108">len</span><span class="op" id="4786111">(</span><span class="ident" id="4786112">x</span><span class="op" id="4786113">)</span><span class="op" id="4786114">;</span>&nbsp;<span class="ident" id="4786116">n</span>&nbsp;<span class="op" id="4786118">&gt;</span>&nbsp;<span class="num" id="4786120">0</span>&nbsp;<span class="op" id="4786122">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786126">if</span>&nbsp;<span class="ident" id="4786129">c</span>&nbsp;<span class="op" id="4786131">:=</span>&nbsp;<span class="ident" id="4786134">addVV</span><span class="op" id="4786139">(</span><span class="ident" id="4786140">z</span><span class="op" id="4786141">[</span><span class="ident" id="4786142">i</span><span class="op" id="4786143">:</span><span class="ident" id="4786144">i</span><span class="op" id="4786145">+</span><span class="ident" id="4786146">n</span><span class="op" id="4786147">]</span><span class="op" id="4786148">,</span>&nbsp;<span class="ident" id="4786150">z</span><span class="op" id="4786151">[</span><span class="ident" id="4786152">i</span><span class="op" id="4786153">:</span><span class="op" id="4786154">]</span><span class="op" id="4786155">,</span>&nbsp;<span class="ident" id="4786157">x</span><span class="op" id="4786158">)</span><span class="op" id="4786159">;</span>&nbsp;<span class="ident" id="4786161">c</span>&nbsp;<span class="op" id="4786163">!=</span>&nbsp;<span class="num" id="4786166">0</span>&nbsp;<span class="op" id="4786168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786173">j</span>&nbsp;<span class="op" id="4786175">:=</span>&nbsp;<span class="ident" id="4786178">i</span>&nbsp;<span class="op" id="4786180">+</span>&nbsp;<span class="ident" id="4786182">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786187">if</span>&nbsp;<span class="ident" id="4786190">j</span>&nbsp;<span class="op" id="4786192">&lt;</span>&nbsp;<span class="builtinfunc" id="4786194">len</span><span class="op" id="4786197">(</span><span class="ident" id="4786198">z</span><span class="op" id="4786199">)</span>&nbsp;<span class="op" id="4786201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786207">addVW</span><span class="op" id="4786212">(</span><span class="ident" id="4786213">z</span><span class="op" id="4786214">[</span><span class="ident" id="4786215">j</span><span class="op" id="4786216">:</span><span class="op" id="4786217">]</span><span class="op" id="4786218">,</span>&nbsp;<span class="ident" id="4786220">z</span><span class="op" id="4786221">[</span><span class="ident" id="4786222">j</span><span class="op" id="4786223">:</span><span class="op" id="4786224">]</span><span class="op" id="4786225">,</span>&nbsp;<span class="ident" id="4786227">c</span><span class="op" id="4786228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786233">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786240">}</span><br>
<span class="lineno"></span><span class="op" id="4786242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4786245">func</span>&nbsp;<span class="ident" id="4786250">max</span><span class="op" id="4786253">(</span><span class="ident" id="4786254">x</span><span class="op" id="4786255">,</span>&nbsp;<span class="ident" id="4786257">y</span>&nbsp;<span class="builtintype" id="4786259">int</span><span class="op" id="4786262">)</span>&nbsp;<span class="builtintype" id="4786264">int</span>&nbsp;<span class="op" id="4786268">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786271">if</span>&nbsp;<span class="ident" id="4786274">x</span>&nbsp;<span class="op" id="4786276">&gt;</span>&nbsp;<span class="ident" id="4786278">y</span>&nbsp;<span class="op" id="4786280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786284">return</span>&nbsp;<span class="ident" id="4786291">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786297">return</span>&nbsp;<span class="ident" id="4786304">y</span><br>
<span class="lineno"></span><span class="op" id="4786306">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="comment" id="4786309">//&nbsp;karatsubaLen&nbsp;computes&nbsp;an&nbsp;approximation&nbsp;to&nbsp;the&nbsp;maximum&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4786383">//&nbsp;k&nbsp;=&nbsp;p&lt;&lt;i&nbsp;for&nbsp;a&nbsp;number&nbsp;p&nbsp;&lt;=&nbsp;karatsubaThreshold&nbsp;and&nbsp;an&nbsp;i&nbsp;&gt;=&nbsp;0.&nbsp;Thus,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4786457">//&nbsp;result&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;that&nbsp;can&nbsp;be&nbsp;divided&nbsp;repeatedly&nbsp;by&nbsp;2&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4786532">//&nbsp;becoming&nbsp;about&nbsp;the&nbsp;value&nbsp;of&nbsp;karatsubaThreshold.</span><br>
<span class="lineno">370</span><span class="keyword" id="4786583">func</span>&nbsp;<span class="ident" id="4786588">karatsubaLen</span><span class="op" id="4786600">(</span><span class="ident" id="4786601">n</span>&nbsp;<span class="builtintype" id="4786603">int</span><span class="op" id="4786606">)</span>&nbsp;<span class="builtintype" id="4786608">int</span>&nbsp;<span class="op" id="4786612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786615">i</span>&nbsp;<span class="op" id="4786617">:=</span>&nbsp;<span class="builtintype" id="4786620">uint</span><span class="op" id="4786624">(</span><span class="num" id="4786625">0</span><span class="op" id="4786626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786629">for</span>&nbsp;<span class="ident" id="4786633">n</span>&nbsp;<span class="op" id="4786635">&gt;</span>&nbsp;<span class="ident" id="4786637">karatsubaThreshold</span>&nbsp;<span class="op" id="4786656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786660">n</span>&nbsp;<span class="op" id="4786662">&gt;&gt;=</span>&nbsp;<span class="num" id="4786666">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786670">i</span><span class="op" id="4786671">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786678">return</span>&nbsp;<span class="ident" id="4786685">n</span>&nbsp;<span class="op" id="4786687">&lt;&lt;</span>&nbsp;<span class="ident" id="4786690">i</span><br>
<span class="lineno"></span><span class="op" id="4786692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4786695">func</span>&nbsp;<span class="op" id="4786700">(</span><span class="ident" id="4786701">z</span>&nbsp;<span class="ident" id="4786703">nat</span><span class="op" id="4786706">)</span>&nbsp;<span class="ident" id="4786708">mul</span><span class="op" id="4786711">(</span><span class="ident" id="4786712">x</span><span class="op" id="4786713">,</span>&nbsp;<span class="ident" id="4786715">y</span>&nbsp;<span class="ident" id="4786717">nat</span><span class="op" id="4786720">)</span>&nbsp;<span class="ident" id="4786722">nat</span>&nbsp;<span class="op" id="4786726">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786729">m</span>&nbsp;<span class="op" id="4786731">:=</span>&nbsp;<span class="builtinfunc" id="4786734">len</span><span class="op" id="4786737">(</span><span class="ident" id="4786738">x</span><span class="op" id="4786739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786742">n</span>&nbsp;<span class="op" id="4786744">:=</span>&nbsp;<span class="builtinfunc" id="4786747">len</span><span class="op" id="4786750">(</span><span class="ident" id="4786751">y</span><span class="op" id="4786752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786756">switch</span>&nbsp;<span class="op" id="4786763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786766">case</span>&nbsp;<span class="ident" id="4786771">m</span>&nbsp;<span class="op" id="4786773">&lt;</span>&nbsp;<span class="ident" id="4786775">n</span><span class="op" id="4786776">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786780">return</span>&nbsp;<span class="ident" id="4786787">z</span><span class="op" id="4786788">.</span><span class="ident" id="4786789">mul</span><span class="op" id="4786792">(</span><span class="ident" id="4786793">y</span><span class="op" id="4786794">,</span>&nbsp;<span class="ident" id="4786796">x</span><span class="op" id="4786797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786800">case</span>&nbsp;<span class="ident" id="4786805">m</span>&nbsp;<span class="op" id="4786807">==</span>&nbsp;<span class="num" id="4786810">0</span>&nbsp;<span class="op" id="4786812">||</span>&nbsp;<span class="ident" id="4786815">n</span>&nbsp;<span class="op" id="4786817">==</span>&nbsp;<span class="num" id="4786820">0</span><span class="op" id="4786821">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786825">return</span>&nbsp;<span class="ident" id="4786832">z</span><span class="op" id="4786833">.</span><span class="builtinfunc" id="4786834">make</span><span class="op" id="4786838">(</span><span class="num" id="4786839">0</span><span class="op" id="4786840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786843">case</span>&nbsp;<span class="ident" id="4786848">n</span>&nbsp;<span class="op" id="4786850">==</span>&nbsp;<span class="num" id="4786853">1</span><span class="op" id="4786854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786858">return</span>&nbsp;<span class="ident" id="4786865">z</span><span class="op" id="4786866">.</span><span class="ident" id="4786867">mulAddWW</span><span class="op" id="4786875">(</span><span class="ident" id="4786876">x</span><span class="op" id="4786877">,</span>&nbsp;<span class="ident" id="4786879">y</span><span class="op" id="4786880">[</span><span class="num" id="4786881">0</span><span class="op" id="4786882">]</span><span class="op" id="4786883">,</span>&nbsp;<span class="num" id="4786885">0</span><span class="op" id="4786886">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786892">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4786908">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786941">if</span>&nbsp;<span class="ident" id="4786944">alias</span><span class="op" id="4786949">(</span><span class="ident" id="4786950">z</span><span class="op" id="4786951">,</span>&nbsp;<span class="ident" id="4786953">x</span><span class="op" id="4786954">)</span>&nbsp;<span class="op" id="4786956">||</span>&nbsp;<span class="ident" id="4786959">alias</span><span class="op" id="4786964">(</span><span class="ident" id="4786965">z</span><span class="op" id="4786966">,</span>&nbsp;<span class="ident" id="4786968">y</span><span class="op" id="4786969">)</span>&nbsp;<span class="op" id="4786971">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786975">z</span>&nbsp;<span class="op" id="4786977">=</span>&nbsp;<span class="ident" id="4786979">nil</span>&nbsp;<span class="comment" id="4786983">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4787027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787031">//&nbsp;use&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;the&nbsp;numbers&nbsp;are&nbsp;small</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787085">if</span>&nbsp;<span class="ident" id="4787088">n</span>&nbsp;<span class="op" id="4787090">&lt;</span>&nbsp;<span class="ident" id="4787092">karatsubaThreshold</span>&nbsp;<span class="op" id="4787111">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787115">z</span>&nbsp;<span class="op" id="4787117">=</span>&nbsp;<span class="ident" id="4787119">z</span><span class="op" id="4787120">.</span><span class="builtinfunc" id="4787121">make</span><span class="op" id="4787125">(</span><span class="ident" id="4787126">m</span>&nbsp;<span class="op" id="4787128">+</span>&nbsp;<span class="ident" id="4787130">n</span><span class="op" id="4787131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787135">basicMul</span><span class="op" id="4787143">(</span><span class="ident" id="4787144">z</span><span class="op" id="4787145">,</span>&nbsp;<span class="ident" id="4787147">x</span><span class="op" id="4787148">,</span>&nbsp;<span class="ident" id="4787150">y</span><span class="op" id="4787151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787155">return</span>&nbsp;<span class="ident" id="4787162">z</span><span class="op" id="4787163">.</span><span class="ident" id="4787164">norm</span><span class="op" id="4787168">(</span><span class="op" id="4787169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4787172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787175">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787224">//&nbsp;determine&nbsp;Karatsuba&nbsp;length&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787267">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787271">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;xh*b&nbsp;+&nbsp;x0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;x0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787306">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;yh*b&nbsp;+&nbsp;y0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;y0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787341">//&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;1&lt;&lt;(_W*k)&nbsp;&nbsp;(&#34;base&#34;&nbsp;of&nbsp;digits&nbsp;xi,&nbsp;yi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787388">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787392">k</span>&nbsp;<span class="op" id="4787394">:=</span>&nbsp;<span class="ident" id="4787397">karatsubaLen</span><span class="op" id="4787409">(</span><span class="ident" id="4787410">n</span><span class="op" id="4787411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787414">//&nbsp;k&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787426">//&nbsp;multiply&nbsp;x0&nbsp;and&nbsp;y0&nbsp;via&nbsp;Karatsuba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787463">x0</span>&nbsp;<span class="op" id="4787466">:=</span>&nbsp;<span class="ident" id="4787469">x</span><span class="op" id="4787470">[</span><span class="num" id="4787471">0</span><span class="op" id="4787472">:</span><span class="ident" id="4787473">k</span><span class="op" id="4787474">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4787489">//&nbsp;x0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787514">y0</span>&nbsp;<span class="op" id="4787517">:=</span>&nbsp;<span class="ident" id="4787520">y</span><span class="op" id="4787521">[</span><span class="num" id="4787522">0</span><span class="op" id="4787523">:</span><span class="ident" id="4787524">k</span><span class="op" id="4787525">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4787540">//&nbsp;y0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787565">z</span>&nbsp;<span class="op" id="4787567">=</span>&nbsp;<span class="ident" id="4787569">z</span><span class="op" id="4787570">.</span><span class="builtinfunc" id="4787571">make</span><span class="op" id="4787575">(</span><span class="ident" id="4787576">max</span><span class="op" id="4787579">(</span><span class="num" id="4787580">6</span><span class="op" id="4787581">*</span><span class="ident" id="4787582">k</span><span class="op" id="4787583">,</span>&nbsp;<span class="ident" id="4787585">m</span><span class="op" id="4787586">+</span><span class="ident" id="4787587">n</span><span class="op" id="4787588">)</span><span class="op" id="4787589">)</span>&nbsp;<span class="comment" id="4787591">//&nbsp;enough&nbsp;space&nbsp;for&nbsp;karatsuba&nbsp;of&nbsp;x0*y0&nbsp;and&nbsp;full&nbsp;result&nbsp;of&nbsp;x*y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787654">karatsuba</span><span class="op" id="4787663">(</span><span class="ident" id="4787664">z</span><span class="op" id="4787665">,</span>&nbsp;<span class="ident" id="4787667">x0</span><span class="op" id="4787669">,</span>&nbsp;<span class="ident" id="4787671">y0</span><span class="op" id="4787673">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787676">z</span>&nbsp;<span class="op" id="4787678">=</span>&nbsp;<span class="ident" id="4787680">z</span><span class="op" id="4787681">[</span><span class="num" id="4787682">0</span>&nbsp;<span class="op" id="4787684">:</span>&nbsp;<span class="ident" id="4787686">m</span><span class="op" id="4787687">+</span><span class="ident" id="4787688">n</span><span class="op" id="4787689">]</span>&nbsp;&nbsp;<span class="comment" id="4787692">//&nbsp;z&nbsp;has&nbsp;final&nbsp;length&nbsp;but&nbsp;may&nbsp;be&nbsp;incomplete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787737">z</span><span class="op" id="4787738">[</span><span class="num" id="4787739">2</span><span class="op" id="4787740">*</span><span class="ident" id="4787741">k</span><span class="op" id="4787742">:</span><span class="op" id="4787743">]</span><span class="op" id="4787744">.</span><span class="ident" id="4787745">clear</span><span class="op" id="4787750">(</span><span class="op" id="4787751">)</span>&nbsp;<span class="comment" id="4787753">//&nbsp;upper&nbsp;portion&nbsp;of&nbsp;z&nbsp;is&nbsp;garbage&nbsp;(and&nbsp;2*k&nbsp;&lt;=&nbsp;m+n&nbsp;since&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;m)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787823">//&nbsp;If&nbsp;xh&nbsp;!=&nbsp;0&nbsp;or&nbsp;yh&nbsp;!=&nbsp;0,&nbsp;add&nbsp;the&nbsp;missing&nbsp;terms&nbsp;to&nbsp;z.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787882">//</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787886">//&nbsp;&nbsp;&nbsp;xh&nbsp;=&nbsp;xi*b^i&nbsp;+&nbsp;...&nbsp;+&nbsp;x2*b^2&nbsp;+&nbsp;x1*b&nbsp;(0&nbsp;&lt;=&nbsp;xi&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787940">//&nbsp;&nbsp;&nbsp;yh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1*b&nbsp;(0&nbsp;&lt;=&nbsp;y1&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787994">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4787998">//&nbsp;the&nbsp;missing&nbsp;terms&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788024">//</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788028">//&nbsp;&nbsp;&nbsp;x0*y1*b&nbsp;and&nbsp;xi*y0*b^i,&nbsp;xi*y1*b^(i+1)&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788081">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788085">//&nbsp;since&nbsp;all&nbsp;the&nbsp;yi&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;1&nbsp;are&nbsp;0&nbsp;by&nbsp;choice&nbsp;of&nbsp;k:&nbsp;If&nbsp;any&nbsp;of&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788153">//&nbsp;were&nbsp;&gt;&nbsp;0,&nbsp;then&nbsp;yh&nbsp;&gt;=&nbsp;b^2&nbsp;and&nbsp;thus&nbsp;y&nbsp;&gt;=&nbsp;b^2.&nbsp;Then&nbsp;k&#39;&nbsp;=&nbsp;k*2&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788221">//&nbsp;be&nbsp;a&nbsp;larger&nbsp;valid&nbsp;threshold&nbsp;contradicting&nbsp;the&nbsp;assumption&nbsp;about&nbsp;k.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788291">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788295">if</span>&nbsp;<span class="ident" id="4788298">k</span>&nbsp;<span class="op" id="4788300">&lt;</span>&nbsp;<span class="ident" id="4788302">n</span>&nbsp;<span class="op" id="4788304">||</span>&nbsp;<span class="ident" id="4788307">m</span>&nbsp;<span class="op" id="4788309">!=</span>&nbsp;<span class="ident" id="4788312">n</span>&nbsp;<span class="op" id="4788314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788318">var</span>&nbsp;<span class="ident" id="4788322">t</span>&nbsp;<span class="ident" id="4788324">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788331">//&nbsp;add&nbsp;x0*y1*b</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788348">x0</span>&nbsp;<span class="op" id="4788351">:=</span>&nbsp;<span class="ident" id="4788354">x0</span><span class="op" id="4788356">.</span><span class="ident" id="4788357">norm</span><span class="op" id="4788361">(</span><span class="op" id="4788362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788366">y1</span>&nbsp;<span class="op" id="4788369">:=</span>&nbsp;<span class="ident" id="4788372">y</span><span class="op" id="4788373">[</span><span class="ident" id="4788374">k</span><span class="op" id="4788375">:</span><span class="op" id="4788376">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4788384">//&nbsp;y1&nbsp;is&nbsp;normalized&nbsp;because&nbsp;y&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788419">t</span>&nbsp;<span class="op" id="4788421">=</span>&nbsp;<span class="ident" id="4788423">t</span><span class="op" id="4788424">.</span><span class="ident" id="4788425">mul</span><span class="op" id="4788428">(</span><span class="ident" id="4788429">x0</span><span class="op" id="4788431">,</span>&nbsp;<span class="ident" id="4788433">y1</span><span class="op" id="4788435">)</span>&nbsp;<span class="comment" id="4788437">//&nbsp;update&nbsp;t&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;t&#39;s&nbsp;underlying&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788489">addAt</span><span class="op" id="4788494">(</span><span class="ident" id="4788495">z</span><span class="op" id="4788496">,</span>&nbsp;<span class="ident" id="4788498">t</span><span class="op" id="4788499">,</span>&nbsp;<span class="ident" id="4788501">k</span><span class="op" id="4788502">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788507">//&nbsp;add&nbsp;xi*y0&lt;&lt;i,&nbsp;xi*y1*b&lt;&lt;(i+k)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788541">y0</span>&nbsp;<span class="op" id="4788544">:=</span>&nbsp;<span class="ident" id="4788547">y0</span><span class="op" id="4788549">.</span><span class="ident" id="4788550">norm</span><span class="op" id="4788554">(</span><span class="op" id="4788555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788559">for</span>&nbsp;<span class="ident" id="4788563">i</span>&nbsp;<span class="op" id="4788565">:=</span>&nbsp;<span class="ident" id="4788568">k</span><span class="op" id="4788569">;</span>&nbsp;<span class="ident" id="4788571">i</span>&nbsp;<span class="op" id="4788573">&lt;</span>&nbsp;<span class="builtinfunc" id="4788575">len</span><span class="op" id="4788578">(</span><span class="ident" id="4788579">x</span><span class="op" id="4788580">)</span><span class="op" id="4788581">;</span>&nbsp;<span class="ident" id="4788583">i</span>&nbsp;<span class="op" id="4788585">+=</span>&nbsp;<span class="ident" id="4788588">k</span>&nbsp;<span class="op" id="4788590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788595">xi</span>&nbsp;<span class="op" id="4788598">:=</span>&nbsp;<span class="ident" id="4788601">x</span><span class="op" id="4788602">[</span><span class="ident" id="4788603">i</span><span class="op" id="4788604">:</span><span class="op" id="4788605">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788610">if</span>&nbsp;<span class="builtinfunc" id="4788613">len</span><span class="op" id="4788616">(</span><span class="ident" id="4788617">xi</span><span class="op" id="4788619">)</span>&nbsp;<span class="op" id="4788621">&gt;</span>&nbsp;<span class="ident" id="4788623">k</span>&nbsp;<span class="op" id="4788625">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788631">xi</span>&nbsp;<span class="op" id="4788634">=</span>&nbsp;<span class="ident" id="4788636">xi</span><span class="op" id="4788638">[</span><span class="op" id="4788639">:</span><span class="ident" id="4788640">k</span><span class="op" id="4788641">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4788646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788651">xi</span>&nbsp;<span class="op" id="4788654">=</span>&nbsp;<span class="ident" id="4788656">xi</span><span class="op" id="4788658">.</span><span class="ident" id="4788659">norm</span><span class="op" id="4788663">(</span><span class="op" id="4788664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788669">t</span>&nbsp;<span class="op" id="4788671">=</span>&nbsp;<span class="ident" id="4788673">t</span><span class="op" id="4788674">.</span><span class="ident" id="4788675">mul</span><span class="op" id="4788678">(</span><span class="ident" id="4788679">xi</span><span class="op" id="4788681">,</span>&nbsp;<span class="ident" id="4788683">y0</span><span class="op" id="4788685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788690">addAt</span><span class="op" id="4788695">(</span><span class="ident" id="4788696">z</span><span class="op" id="4788697">,</span>&nbsp;<span class="ident" id="4788699">t</span><span class="op" id="4788700">,</span>&nbsp;<span class="ident" id="4788702">i</span><span class="op" id="4788703">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788708">t</span>&nbsp;<span class="op" id="4788710">=</span>&nbsp;<span class="ident" id="4788712">t</span><span class="op" id="4788713">.</span><span class="ident" id="4788714">mul</span><span class="op" id="4788717">(</span><span class="ident" id="4788718">xi</span><span class="op" id="4788720">,</span>&nbsp;<span class="ident" id="4788722">y1</span><span class="op" id="4788724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788729">addAt</span><span class="op" id="4788734">(</span><span class="ident" id="4788735">z</span><span class="op" id="4788736">,</span>&nbsp;<span class="ident" id="4788738">t</span><span class="op" id="4788739">,</span>&nbsp;<span class="ident" id="4788741">i</span><span class="op" id="4788742">+</span><span class="ident" id="4788743">k</span><span class="op" id="4788744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4788748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4788751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788755">return</span>&nbsp;<span class="ident" id="4788762">z</span><span class="op" id="4788763">.</span><span class="ident" id="4788764">norm</span><span class="op" id="4788768">(</span><span class="op" id="4788769">)</span><br>
<span class="lineno"></span><span class="op" id="4788771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4788774">//&nbsp;mulRange&nbsp;computes&nbsp;the&nbsp;product&nbsp;of&nbsp;all&nbsp;the&nbsp;unsigned&nbsp;integers&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4788843">//&nbsp;range&nbsp;[a,&nbsp;b]&nbsp;inclusively.&nbsp;If&nbsp;a&nbsp;&gt;&nbsp;b&nbsp;(empty&nbsp;range),&nbsp;the&nbsp;result&nbsp;is&nbsp;1.</span><br>
<span class="lineno">465</span><span class="keyword" id="4788913">func</span>&nbsp;<span class="op" id="4788918">(</span><span class="ident" id="4788919">z</span>&nbsp;<span class="ident" id="4788921">nat</span><span class="op" id="4788924">)</span>&nbsp;<span class="ident" id="4788926">mulRange</span><span class="op" id="4788934">(</span><span class="ident" id="4788935">a</span><span class="op" id="4788936">,</span>&nbsp;<span class="ident" id="4788938">b</span>&nbsp;<span class="ident" id="4788940">uint64</span><span class="op" id="4788946">)</span>&nbsp;<span class="ident" id="4788948">nat</span>&nbsp;<span class="op" id="4788952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788955">switch</span>&nbsp;<span class="op" id="4788962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788965">case</span>&nbsp;<span class="ident" id="4788970">a</span>&nbsp;<span class="op" id="4788972">==</span>&nbsp;<span class="num" id="4788975">0</span><span class="op" id="4788976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4788980">//&nbsp;cut&nbsp;long&nbsp;ranges&nbsp;short&nbsp;(optimization)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789022">return</span>&nbsp;<span class="ident" id="4789029">z</span><span class="op" id="4789030">.</span><span class="ident" id="4789031">setUint64</span><span class="op" id="4789040">(</span><span class="num" id="4789041">0</span><span class="op" id="4789042">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789045">case</span>&nbsp;<span class="ident" id="4789050">a</span>&nbsp;<span class="op" id="4789052">&gt;</span>&nbsp;<span class="ident" id="4789054">b</span><span class="op" id="4789055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789059">return</span>&nbsp;<span class="ident" id="4789066">z</span><span class="op" id="4789067">.</span><span class="ident" id="4789068">setUint64</span><span class="op" id="4789077">(</span><span class="num" id="4789078">1</span><span class="op" id="4789079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789082">case</span>&nbsp;<span class="ident" id="4789087">a</span>&nbsp;<span class="op" id="4789089">==</span>&nbsp;<span class="ident" id="4789092">b</span><span class="op" id="4789093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789097">return</span>&nbsp;<span class="ident" id="4789104">z</span><span class="op" id="4789105">.</span><span class="ident" id="4789106">setUint64</span><span class="op" id="4789115">(</span><span class="ident" id="4789116">a</span><span class="op" id="4789117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789120">case</span>&nbsp;<span class="ident" id="4789125">a</span><span class="op" id="4789126">+</span><span class="num" id="4789127">1</span>&nbsp;<span class="op" id="4789129">==</span>&nbsp;<span class="ident" id="4789132">b</span><span class="op" id="4789133">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789137">return</span>&nbsp;<span class="ident" id="4789144">z</span><span class="op" id="4789145">.</span><span class="ident" id="4789146">mul</span><span class="op" id="4789149">(</span><span class="ident" id="4789150">nat</span><span class="op" id="4789153">(</span><span class="ident" id="4789154">nil</span><span class="op" id="4789157">)</span><span class="op" id="4789158">.</span><span class="ident" id="4789159">setUint64</span><span class="op" id="4789168">(</span><span class="ident" id="4789169">a</span><span class="op" id="4789170">)</span><span class="op" id="4789171">,</span>&nbsp;<span class="ident" id="4789173">nat</span><span class="op" id="4789176">(</span><span class="ident" id="4789177">nil</span><span class="op" id="4789180">)</span><span class="op" id="4789181">.</span><span class="ident" id="4789182">setUint64</span><span class="op" id="4789191">(</span><span class="ident" id="4789192">b</span><span class="op" id="4789193">)</span><span class="op" id="4789194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789200">m</span>&nbsp;<span class="op" id="4789202">:=</span>&nbsp;<span class="op" id="4789205">(</span><span class="ident" id="4789206">a</span>&nbsp;<span class="op" id="4789208">+</span>&nbsp;<span class="ident" id="4789210">b</span><span class="op" id="4789211">)</span>&nbsp;<span class="op" id="4789213">/</span>&nbsp;<span class="num" id="4789215">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789218">return</span>&nbsp;<span class="ident" id="4789225">z</span><span class="op" id="4789226">.</span><span class="ident" id="4789227">mul</span><span class="op" id="4789230">(</span><span class="ident" id="4789231">nat</span><span class="op" id="4789234">(</span><span class="ident" id="4789235">nil</span><span class="op" id="4789238">)</span><span class="op" id="4789239">.</span><span class="ident" id="4789240">mulRange</span><span class="op" id="4789248">(</span><span class="ident" id="4789249">a</span><span class="op" id="4789250">,</span>&nbsp;<span class="ident" id="4789252">m</span><span class="op" id="4789253">)</span><span class="op" id="4789254">,</span>&nbsp;<span class="ident" id="4789256">nat</span><span class="op" id="4789259">(</span><span class="ident" id="4789260">nil</span><span class="op" id="4789263">)</span><span class="op" id="4789264">.</span><span class="ident" id="4789265">mulRange</span><span class="op" id="4789273">(</span><span class="ident" id="4789274">m</span><span class="op" id="4789275">+</span><span class="num" id="4789276">1</span><span class="op" id="4789277">,</span>&nbsp;<span class="ident" id="4789279">b</span><span class="op" id="4789280">)</span><span class="op" id="4789281">)</span><br>
<span class="lineno"></span><span class="op" id="4789283">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4789286">//&nbsp;q&nbsp;=&nbsp;(x-r)/y,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="keyword" id="4789318">func</span>&nbsp;<span class="op" id="4789323">(</span><span class="ident" id="4789324">z</span>&nbsp;<span class="ident" id="4789326">nat</span><span class="op" id="4789329">)</span>&nbsp;<span class="ident" id="4789331">divW</span><span class="op" id="4789335">(</span><span class="ident" id="4789336">x</span>&nbsp;<span class="ident" id="4789338">nat</span><span class="op" id="4789341">,</span>&nbsp;<span class="ident" id="4789343">y</span>&nbsp;<span class="ident" id="4789345">Word</span><span class="op" id="4789349">)</span>&nbsp;<span class="op" id="4789351">(</span><span class="ident" id="4789352">q</span>&nbsp;<span class="ident" id="4789354">nat</span><span class="op" id="4789357">,</span>&nbsp;<span class="ident" id="4789359">r</span>&nbsp;<span class="ident" id="4789361">Word</span><span class="op" id="4789365">)</span>&nbsp;<span class="op" id="4789367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789370">m</span>&nbsp;<span class="op" id="4789372">:=</span>&nbsp;<span class="builtinfunc" id="4789375">len</span><span class="op" id="4789378">(</span><span class="ident" id="4789379">x</span><span class="op" id="4789380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789383">switch</span>&nbsp;<span class="op" id="4789390">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789393">case</span>&nbsp;<span class="ident" id="4789398">y</span>&nbsp;<span class="op" id="4789400">==</span>&nbsp;<span class="num" id="4789403">0</span><span class="op" id="4789404">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4789408">panic</span><span class="op" id="4789413">(</span><span class="string" id="4789414">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4789432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789435">case</span>&nbsp;<span class="ident" id="4789440">y</span>&nbsp;<span class="op" id="4789442">==</span>&nbsp;<span class="num" id="4789445">1</span><span class="op" id="4789446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789450">q</span>&nbsp;<span class="op" id="4789452">=</span>&nbsp;<span class="ident" id="4789454">z</span><span class="op" id="4789455">.</span><span class="ident" id="4789456">set</span><span class="op" id="4789459">(</span><span class="ident" id="4789460">x</span><span class="op" id="4789461">)</span>&nbsp;<span class="comment" id="4789463">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789480">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789488">case</span>&nbsp;<span class="ident" id="4789493">m</span>&nbsp;<span class="op" id="4789495">==</span>&nbsp;<span class="num" id="4789498">0</span><span class="op" id="4789499">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789503">q</span>&nbsp;<span class="op" id="4789505">=</span>&nbsp;<span class="ident" id="4789507">z</span><span class="op" id="4789508">.</span><span class="builtinfunc" id="4789509">make</span><span class="op" id="4789513">(</span><span class="num" id="4789514">0</span><span class="op" id="4789515">)</span>&nbsp;<span class="comment" id="4789517">//&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789534">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789545">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789555">z</span>&nbsp;<span class="op" id="4789557">=</span>&nbsp;<span class="ident" id="4789559">z</span><span class="op" id="4789560">.</span><span class="builtinfunc" id="4789561">make</span><span class="op" id="4789565">(</span><span class="ident" id="4789566">m</span><span class="op" id="4789567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789570">r</span>&nbsp;<span class="op" id="4789572">=</span>&nbsp;<span class="ident" id="4789574">divWVW</span><span class="op" id="4789580">(</span><span class="ident" id="4789581">z</span><span class="op" id="4789582">,</span>&nbsp;<span class="num" id="4789584">0</span><span class="op" id="4789585">,</span>&nbsp;<span class="ident" id="4789587">x</span><span class="op" id="4789588">,</span>&nbsp;<span class="ident" id="4789590">y</span><span class="op" id="4789591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789594">q</span>&nbsp;<span class="op" id="4789596">=</span>&nbsp;<span class="ident" id="4789598">z</span><span class="op" id="4789599">.</span><span class="ident" id="4789600">norm</span><span class="op" id="4789604">(</span><span class="op" id="4789605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789608">return</span><br>
<span class="lineno"></span><span class="op" id="4789615">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="4789618">func</span>&nbsp;<span class="op" id="4789623">(</span><span class="ident" id="4789624">z</span>&nbsp;<span class="ident" id="4789626">nat</span><span class="op" id="4789629">)</span>&nbsp;<span class="ident" id="4789631">div</span><span class="op" id="4789634">(</span><span class="ident" id="4789635">z2</span><span class="op" id="4789637">,</span>&nbsp;<span class="ident" id="4789639">u</span><span class="op" id="4789640">,</span>&nbsp;<span class="ident" id="4789642">v</span>&nbsp;<span class="ident" id="4789644">nat</span><span class="op" id="4789647">)</span>&nbsp;<span class="op" id="4789649">(</span><span class="ident" id="4789650">q</span><span class="op" id="4789651">,</span>&nbsp;<span class="ident" id="4789653">r</span>&nbsp;<span class="ident" id="4789655">nat</span><span class="op" id="4789658">)</span>&nbsp;<span class="op" id="4789660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789663">if</span>&nbsp;<span class="builtinfunc" id="4789666">len</span><span class="op" id="4789669">(</span><span class="ident" id="4789670">v</span><span class="op" id="4789671">)</span>&nbsp;<span class="op" id="4789673">==</span>&nbsp;<span class="num" id="4789676">0</span>&nbsp;<span class="op" id="4789678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4789682">panic</span><span class="op" id="4789687">(</span><span class="string" id="4789688">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4789706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789709">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789713">if</span>&nbsp;<span class="ident" id="4789716">u</span><span class="op" id="4789717">.</span><span class="ident" id="4789718">cmp</span><span class="op" id="4789721">(</span><span class="ident" id="4789722">v</span><span class="op" id="4789723">)</span>&nbsp;<span class="op" id="4789725">&lt;</span>&nbsp;<span class="num" id="4789727">0</span>&nbsp;<span class="op" id="4789729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789733">q</span>&nbsp;<span class="op" id="4789735">=</span>&nbsp;<span class="ident" id="4789737">z</span><span class="op" id="4789738">.</span><span class="builtinfunc" id="4789739">make</span><span class="op" id="4789743">(</span><span class="num" id="4789744">0</span><span class="op" id="4789745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789749">r</span>&nbsp;<span class="op" id="4789751">=</span>&nbsp;<span class="ident" id="4789753">z2</span><span class="op" id="4789755">.</span><span class="ident" id="4789756">set</span><span class="op" id="4789759">(</span><span class="ident" id="4789760">u</span><span class="op" id="4789761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789765">return</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789777">if</span>&nbsp;<span class="builtinfunc" id="4789780">len</span><span class="op" id="4789783">(</span><span class="ident" id="4789784">v</span><span class="op" id="4789785">)</span>&nbsp;<span class="op" id="4789787">==</span>&nbsp;<span class="num" id="4789790">1</span>&nbsp;<span class="op" id="4789792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789796">var</span>&nbsp;<span class="ident" id="4789800">r2</span>&nbsp;<span class="ident" id="4789803">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789810">q</span><span class="op" id="4789811">,</span>&nbsp;<span class="ident" id="4789813">r2</span>&nbsp;<span class="op" id="4789816">=</span>&nbsp;<span class="ident" id="4789818">z</span><span class="op" id="4789819">.</span><span class="ident" id="4789820">divW</span><span class="op" id="4789824">(</span><span class="ident" id="4789825">u</span><span class="op" id="4789826">,</span>&nbsp;<span class="ident" id="4789828">v</span><span class="op" id="4789829">[</span><span class="num" id="4789830">0</span><span class="op" id="4789831">]</span><span class="op" id="4789832">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789836">r</span>&nbsp;<span class="op" id="4789838">=</span>&nbsp;<span class="ident" id="4789840">z2</span><span class="op" id="4789842">.</span><span class="ident" id="4789843">setWord</span><span class="op" id="4789850">(</span><span class="ident" id="4789851">r2</span><span class="op" id="4789853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789857">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789869">q</span><span class="op" id="4789870">,</span>&nbsp;<span class="ident" id="4789872">r</span>&nbsp;<span class="op" id="4789874">=</span>&nbsp;<span class="ident" id="4789876">z</span><span class="op" id="4789877">.</span><span class="ident" id="4789878">divLarge</span><span class="op" id="4789886">(</span><span class="ident" id="4789887">z2</span><span class="op" id="4789889">,</span>&nbsp;<span class="ident" id="4789891">u</span><span class="op" id="4789892">,</span>&nbsp;<span class="ident" id="4789894">v</span><span class="op" id="4789895">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789898">return</span><br>
<span class="lineno"></span><span class="op" id="4789905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4789908">//&nbsp;q&nbsp;=&nbsp;(uIn-r)/v,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="4789942">//&nbsp;Uses&nbsp;z&nbsp;as&nbsp;storage&nbsp;for&nbsp;q,&nbsp;and&nbsp;u&nbsp;as&nbsp;storage&nbsp;for&nbsp;r&nbsp;if&nbsp;possible.</span><br>
<span class="lineno">525</span><span class="comment" id="4790006">//&nbsp;See&nbsp;Knuth,&nbsp;Volume&nbsp;2,&nbsp;section&nbsp;4.3.1,&nbsp;Algorithm&nbsp;D.</span><br>
<span class="lineno"></span><span class="comment" id="4790058">//&nbsp;Preconditions:</span><br>
<span class="lineno"></span><span class="comment" id="4790076">//&nbsp;&nbsp;&nbsp;&nbsp;len(v)&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="4790094">//&nbsp;&nbsp;&nbsp;&nbsp;len(uIn)&nbsp;&gt;=&nbsp;len(v)</span><br>
<span class="lineno"></span><span class="keyword" id="4790119">func</span>&nbsp;<span class="op" id="4790124">(</span><span class="ident" id="4790125">z</span>&nbsp;<span class="ident" id="4790127">nat</span><span class="op" id="4790130">)</span>&nbsp;<span class="ident" id="4790132">divLarge</span><span class="op" id="4790140">(</span><span class="ident" id="4790141">u</span><span class="op" id="4790142">,</span>&nbsp;<span class="ident" id="4790144">uIn</span><span class="op" id="4790147">,</span>&nbsp;<span class="ident" id="4790149">v</span>&nbsp;<span class="ident" id="4790151">nat</span><span class="op" id="4790154">)</span>&nbsp;<span class="op" id="4790156">(</span><span class="ident" id="4790157">q</span><span class="op" id="4790158">,</span>&nbsp;<span class="ident" id="4790160">r</span>&nbsp;<span class="ident" id="4790162">nat</span><span class="op" id="4790165">)</span>&nbsp;<span class="op" id="4790167">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790170">n</span>&nbsp;<span class="op" id="4790172">:=</span>&nbsp;<span class="builtinfunc" id="4790175">len</span><span class="op" id="4790178">(</span><span class="ident" id="4790179">v</span><span class="op" id="4790180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790183">m</span>&nbsp;<span class="op" id="4790185">:=</span>&nbsp;<span class="builtinfunc" id="4790188">len</span><span class="op" id="4790191">(</span><span class="ident" id="4790192">uIn</span><span class="op" id="4790195">)</span>&nbsp;<span class="op" id="4790197">-</span>&nbsp;<span class="ident" id="4790199">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790203">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790236">//&nbsp;TODO(gri)&nbsp;should&nbsp;find&nbsp;a&nbsp;better&nbsp;solution&nbsp;-&nbsp;this&nbsp;if&nbsp;statement</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790300">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;very&nbsp;costly&nbsp;(see&nbsp;e.g.&nbsp;time&nbsp;pidigits&nbsp;-s&nbsp;-n&nbsp;10000)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790366">if</span>&nbsp;<span class="ident" id="4790369">alias</span><span class="op" id="4790374">(</span><span class="ident" id="4790375">z</span><span class="op" id="4790376">,</span>&nbsp;<span class="ident" id="4790378">uIn</span><span class="op" id="4790381">)</span>&nbsp;<span class="op" id="4790383">||</span>&nbsp;<span class="ident" id="4790386">alias</span><span class="op" id="4790391">(</span><span class="ident" id="4790392">z</span><span class="op" id="4790393">,</span>&nbsp;<span class="ident" id="4790395">v</span><span class="op" id="4790396">)</span>&nbsp;<span class="op" id="4790398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790402">z</span>&nbsp;<span class="op" id="4790404">=</span>&nbsp;<span class="ident" id="4790406">nil</span>&nbsp;<span class="comment" id="4790410">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4790456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790459">q</span>&nbsp;<span class="op" id="4790461">=</span>&nbsp;<span class="ident" id="4790463">z</span><span class="op" id="4790464">.</span><span class="builtinfunc" id="4790465">make</span><span class="op" id="4790469">(</span><span class="ident" id="4790470">m</span>&nbsp;<span class="op" id="4790472">+</span>&nbsp;<span class="num" id="4790474">1</span><span class="op" id="4790475">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790479">qhatv</span>&nbsp;<span class="op" id="4790485">:=</span>&nbsp;<span class="builtinfunc" id="4790488">make</span><span class="op" id="4790492">(</span><span class="ident" id="4790493">nat</span><span class="op" id="4790496">,</span>&nbsp;<span class="ident" id="4790498">n</span><span class="op" id="4790499">+</span><span class="num" id="4790500">1</span><span class="op" id="4790501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790504">if</span>&nbsp;<span class="ident" id="4790507">alias</span><span class="op" id="4790512">(</span><span class="ident" id="4790513">u</span><span class="op" id="4790514">,</span>&nbsp;<span class="ident" id="4790516">uIn</span><span class="op" id="4790519">)</span>&nbsp;<span class="op" id="4790521">||</span>&nbsp;<span class="ident" id="4790524">alias</span><span class="op" id="4790529">(</span><span class="ident" id="4790530">u</span><span class="op" id="4790531">,</span>&nbsp;<span class="ident" id="4790533">v</span><span class="op" id="4790534">)</span>&nbsp;<span class="op" id="4790536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790540">u</span>&nbsp;<span class="op" id="4790542">=</span>&nbsp;<span class="ident" id="4790544">nil</span>&nbsp;<span class="comment" id="4790548">//&nbsp;u&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4790594">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790597">u</span>&nbsp;<span class="op" id="4790599">=</span>&nbsp;<span class="ident" id="4790601">u</span><span class="op" id="4790602">.</span><span class="builtinfunc" id="4790603">make</span><span class="op" id="4790607">(</span><span class="builtinfunc" id="4790608">len</span><span class="op" id="4790611">(</span><span class="ident" id="4790612">uIn</span><span class="op" id="4790615">)</span>&nbsp;<span class="op" id="4790617">+</span>&nbsp;<span class="num" id="4790619">1</span><span class="op" id="4790620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790623">u</span><span class="op" id="4790624">.</span><span class="ident" id="4790625">clear</span><span class="op" id="4790630">(</span><span class="op" id="4790631">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790635">//&nbsp;D1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790643">shift</span>&nbsp;<span class="op" id="4790649">:=</span>&nbsp;<span class="ident" id="4790652">leadingZeros</span><span class="op" id="4790664">(</span><span class="ident" id="4790665">v</span><span class="op" id="4790666">[</span><span class="ident" id="4790667">n</span><span class="op" id="4790668">-</span><span class="num" id="4790669">1</span><span class="op" id="4790670">]</span><span class="op" id="4790671">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790674">if</span>&nbsp;<span class="ident" id="4790677">shift</span>&nbsp;<span class="op" id="4790683">&gt;</span>&nbsp;<span class="num" id="4790685">0</span>&nbsp;<span class="op" id="4790687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790691">//&nbsp;do&nbsp;not&nbsp;modify&nbsp;v,&nbsp;it&nbsp;may&nbsp;be&nbsp;used&nbsp;by&nbsp;another&nbsp;goroutine&nbsp;simultaneously</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790764">v1</span>&nbsp;<span class="op" id="4790767">:=</span>&nbsp;<span class="builtinfunc" id="4790770">make</span><span class="op" id="4790774">(</span><span class="ident" id="4790775">nat</span><span class="op" id="4790778">,</span>&nbsp;<span class="ident" id="4790780">n</span><span class="op" id="4790781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790785">shlVU</span><span class="op" id="4790790">(</span><span class="ident" id="4790791">v1</span><span class="op" id="4790793">,</span>&nbsp;<span class="ident" id="4790795">v</span><span class="op" id="4790796">,</span>&nbsp;<span class="ident" id="4790798">shift</span><span class="op" id="4790803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790807">v</span>&nbsp;<span class="op" id="4790809">=</span>&nbsp;<span class="ident" id="4790811">v1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4790815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790818">u</span><span class="op" id="4790819">[</span><span class="builtinfunc" id="4790820">len</span><span class="op" id="4790823">(</span><span class="ident" id="4790824">uIn</span><span class="op" id="4790827">)</span><span class="op" id="4790828">]</span>&nbsp;<span class="op" id="4790830">=</span>&nbsp;<span class="ident" id="4790832">shlVU</span><span class="op" id="4790837">(</span><span class="ident" id="4790838">u</span><span class="op" id="4790839">[</span><span class="num" id="4790840">0</span><span class="op" id="4790841">:</span><span class="builtinfunc" id="4790842">len</span><span class="op" id="4790845">(</span><span class="ident" id="4790846">uIn</span><span class="op" id="4790849">)</span><span class="op" id="4790850">]</span><span class="op" id="4790851">,</span>&nbsp;<span class="ident" id="4790853">uIn</span><span class="op" id="4790856">,</span>&nbsp;<span class="ident" id="4790858">shift</span><span class="op" id="4790863">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790867">//&nbsp;D2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790875">for</span>&nbsp;<span class="ident" id="4790879">j</span>&nbsp;<span class="op" id="4790881">:=</span>&nbsp;<span class="ident" id="4790884">m</span><span class="op" id="4790885">;</span>&nbsp;<span class="ident" id="4790887">j</span>&nbsp;<span class="op" id="4790889">&gt;=</span>&nbsp;<span class="num" id="4790892">0</span><span class="op" id="4790893">;</span>&nbsp;<span class="ident" id="4790895">j</span><span class="op" id="4790896">--</span>&nbsp;<span class="op" id="4790899">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790903">//&nbsp;D3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790912">qhat</span>&nbsp;<span class="op" id="4790917">:=</span>&nbsp;<span class="ident" id="4790920">Word</span><span class="op" id="4790924">(</span><span class="ident" id="4790925">_M</span><span class="op" id="4790927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790931">if</span>&nbsp;<span class="ident" id="4790934">u</span><span class="op" id="4790935">[</span><span class="ident" id="4790936">j</span><span class="op" id="4790937">+</span><span class="ident" id="4790938">n</span><span class="op" id="4790939">]</span>&nbsp;<span class="op" id="4790941">!=</span>&nbsp;<span class="ident" id="4790944">v</span><span class="op" id="4790945">[</span><span class="ident" id="4790946">n</span><span class="op" id="4790947">-</span><span class="num" id="4790948">1</span><span class="op" id="4790949">]</span>&nbsp;<span class="op" id="4790951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790956">var</span>&nbsp;<span class="ident" id="4790960">rhat</span>&nbsp;<span class="ident" id="4790965">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790973">qhat</span><span class="op" id="4790977">,</span>&nbsp;<span class="ident" id="4790979">rhat</span>&nbsp;<span class="op" id="4790984">=</span>&nbsp;<span class="ident" id="4790986">divWW</span><span class="op" id="4790991">(</span><span class="ident" id="4790992">u</span><span class="op" id="4790993">[</span><span class="ident" id="4790994">j</span><span class="op" id="4790995">+</span><span class="ident" id="4790996">n</span><span class="op" id="4790997">]</span><span class="op" id="4790998">,</span>&nbsp;<span class="ident" id="4791000">u</span><span class="op" id="4791001">[</span><span class="ident" id="4791002">j</span><span class="op" id="4791003">+</span><span class="ident" id="4791004">n</span><span class="op" id="4791005">-</span><span class="num" id="4791006">1</span><span class="op" id="4791007">]</span><span class="op" id="4791008">,</span>&nbsp;<span class="ident" id="4791010">v</span><span class="op" id="4791011">[</span><span class="ident" id="4791012">n</span><span class="op" id="4791013">-</span><span class="num" id="4791014">1</span><span class="op" id="4791015">]</span><span class="op" id="4791016">)</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791022">//&nbsp;x1&nbsp;|&nbsp;x2&nbsp;=&nbsp;q̂v_{n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791049">x1</span><span class="op" id="4791051">,</span>&nbsp;<span class="ident" id="4791053">x2</span>&nbsp;<span class="op" id="4791056">:=</span>&nbsp;<span class="ident" id="4791059">mulWW</span><span class="op" id="4791064">(</span><span class="ident" id="4791065">qhat</span><span class="op" id="4791069">,</span>&nbsp;<span class="ident" id="4791071">v</span><span class="op" id="4791072">[</span><span class="ident" id="4791073">n</span><span class="op" id="4791074">-</span><span class="num" id="4791075">2</span><span class="op" id="4791076">]</span><span class="op" id="4791077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791082">//&nbsp;test&nbsp;if&nbsp;q̂v_{n-2}&nbsp;&gt;&nbsp;br̂&nbsp;+&nbsp;u_{j+n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791126">for</span>&nbsp;<span class="ident" id="4791130">greaterThan</span><span class="op" id="4791141">(</span><span class="ident" id="4791142">x1</span><span class="op" id="4791144">,</span>&nbsp;<span class="ident" id="4791146">x2</span><span class="op" id="4791148">,</span>&nbsp;<span class="ident" id="4791150">rhat</span><span class="op" id="4791154">,</span>&nbsp;<span class="ident" id="4791156">u</span><span class="op" id="4791157">[</span><span class="ident" id="4791158">j</span><span class="op" id="4791159">+</span><span class="ident" id="4791160">n</span><span class="op" id="4791161">-</span><span class="num" id="4791162">2</span><span class="op" id="4791163">]</span><span class="op" id="4791164">)</span>&nbsp;<span class="op" id="4791166">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791172">qhat</span><span class="op" id="4791176">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791183">prevRhat</span>&nbsp;<span class="op" id="4791192">:=</span>&nbsp;<span class="ident" id="4791195">rhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791204">rhat</span>&nbsp;<span class="op" id="4791209">+=</span>&nbsp;<span class="ident" id="4791212">v</span><span class="op" id="4791213">[</span><span class="ident" id="4791214">n</span><span class="op" id="4791215">-</span><span class="num" id="4791216">1</span><span class="op" id="4791217">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791223">//&nbsp;v[n-1]&nbsp;&gt;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;tests&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791271">if</span>&nbsp;<span class="ident" id="4791274">rhat</span>&nbsp;<span class="op" id="4791279">&lt;</span>&nbsp;<span class="ident" id="4791281">prevRhat</span>&nbsp;<span class="op" id="4791290">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791297">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4791307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791313">x1</span><span class="op" id="4791315">,</span>&nbsp;<span class="ident" id="4791317">x2</span>&nbsp;<span class="op" id="4791320">=</span>&nbsp;<span class="ident" id="4791322">mulWW</span><span class="op" id="4791327">(</span><span class="ident" id="4791328">qhat</span><span class="op" id="4791332">,</span>&nbsp;<span class="ident" id="4791334">v</span><span class="op" id="4791335">[</span><span class="ident" id="4791336">n</span><span class="op" id="4791337">-</span><span class="num" id="4791338">2</span><span class="op" id="4791339">]</span><span class="op" id="4791340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4791345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4791349">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791354">//&nbsp;D4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791363">qhatv</span><span class="op" id="4791368">[</span><span class="ident" id="4791369">n</span><span class="op" id="4791370">]</span>&nbsp;<span class="op" id="4791372">=</span>&nbsp;<span class="ident" id="4791374">mulAddVWW</span><span class="op" id="4791383">(</span><span class="ident" id="4791384">qhatv</span><span class="op" id="4791389">[</span><span class="num" id="4791390">0</span><span class="op" id="4791391">:</span><span class="ident" id="4791392">n</span><span class="op" id="4791393">]</span><span class="op" id="4791394">,</span>&nbsp;<span class="ident" id="4791396">v</span><span class="op" id="4791397">,</span>&nbsp;<span class="ident" id="4791399">qhat</span><span class="op" id="4791403">,</span>&nbsp;<span class="num" id="4791405">0</span><span class="op" id="4791406">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791411">c</span>&nbsp;<span class="op" id="4791413">:=</span>&nbsp;<span class="ident" id="4791416">subVV</span><span class="op" id="4791421">(</span><span class="ident" id="4791422">u</span><span class="op" id="4791423">[</span><span class="ident" id="4791424">j</span><span class="op" id="4791425">:</span><span class="ident" id="4791426">j</span><span class="op" id="4791427">+</span><span class="builtinfunc" id="4791428">len</span><span class="op" id="4791431">(</span><span class="ident" id="4791432">qhatv</span><span class="op" id="4791437">)</span><span class="op" id="4791438">]</span><span class="op" id="4791439">,</span>&nbsp;<span class="ident" id="4791441">u</span><span class="op" id="4791442">[</span><span class="ident" id="4791443">j</span><span class="op" id="4791444">:</span><span class="op" id="4791445">]</span><span class="op" id="4791446">,</span>&nbsp;<span class="ident" id="4791448">qhatv</span><span class="op" id="4791453">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791457">if</span>&nbsp;<span class="ident" id="4791460">c</span>&nbsp;<span class="op" id="4791462">!=</span>&nbsp;<span class="num" id="4791465">0</span>&nbsp;<span class="op" id="4791467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791472">c</span>&nbsp;<span class="op" id="4791474">:=</span>&nbsp;<span class="ident" id="4791477">addVV</span><span class="op" id="4791482">(</span><span class="ident" id="4791483">u</span><span class="op" id="4791484">[</span><span class="ident" id="4791485">j</span><span class="op" id="4791486">:</span><span class="ident" id="4791487">j</span><span class="op" id="4791488">+</span><span class="ident" id="4791489">n</span><span class="op" id="4791490">]</span><span class="op" id="4791491">,</span>&nbsp;<span class="ident" id="4791493">u</span><span class="op" id="4791494">[</span><span class="ident" id="4791495">j</span><span class="op" id="4791496">:</span><span class="op" id="4791497">]</span><span class="op" id="4791498">,</span>&nbsp;<span class="ident" id="4791500">v</span><span class="op" id="4791501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791506">u</span><span class="op" id="4791507">[</span><span class="ident" id="4791508">j</span><span class="op" id="4791509">+</span><span class="ident" id="4791510">n</span><span class="op" id="4791511">]</span>&nbsp;<span class="op" id="4791513">+=</span>&nbsp;<span class="ident" id="4791516">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791521">qhat</span><span class="op" id="4791525">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4791530">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791535">q</span><span class="op" id="4791536">[</span><span class="ident" id="4791537">j</span><span class="op" id="4791538">]</span>&nbsp;<span class="op" id="4791540">=</span>&nbsp;<span class="ident" id="4791542">qhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4791548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791552">q</span>&nbsp;<span class="op" id="4791554">=</span>&nbsp;<span class="ident" id="4791556">q</span><span class="op" id="4791557">.</span><span class="ident" id="4791558">norm</span><span class="op" id="4791562">(</span><span class="op" id="4791563">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791566">shrVU</span><span class="op" id="4791571">(</span><span class="ident" id="4791572">u</span><span class="op" id="4791573">,</span>&nbsp;<span class="ident" id="4791575">u</span><span class="op" id="4791576">,</span>&nbsp;<span class="ident" id="4791578">shift</span><span class="op" id="4791583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791586">r</span>&nbsp;<span class="op" id="4791588">=</span>&nbsp;<span class="ident" id="4791590">u</span><span class="op" id="4791591">.</span><span class="ident" id="4791592">norm</span><span class="op" id="4791596">(</span><span class="op" id="4791597">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791601">return</span>&nbsp;<span class="ident" id="4791608">q</span><span class="op" id="4791609">,</span>&nbsp;<span class="ident" id="4791611">r</span><br>
<span class="lineno"></span><span class="op" id="4791613">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="comment" id="4791616">//&nbsp;Length&nbsp;of&nbsp;x&nbsp;in&nbsp;bits.&nbsp;x&nbsp;must&nbsp;be&nbsp;normalized.</span><br>
<span class="lineno"></span><span class="keyword" id="4791662">func</span>&nbsp;<span class="op" id="4791667">(</span><span class="ident" id="4791668">x</span>&nbsp;<span class="ident" id="4791670">nat</span><span class="op" id="4791673">)</span>&nbsp;<span class="ident" id="4791675">bitLen</span><span class="op" id="4791681">(</span><span class="op" id="4791682">)</span>&nbsp;<span class="builtintype" id="4791684">int</span>&nbsp;<span class="op" id="4791688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791691">if</span>&nbsp;<span class="ident" id="4791694">i</span>&nbsp;<span class="op" id="4791696">:=</span>&nbsp;<span class="builtinfunc" id="4791699">len</span><span class="op" id="4791702">(</span><span class="ident" id="4791703">x</span><span class="op" id="4791704">)</span>&nbsp;<span class="op" id="4791706">-</span>&nbsp;<span class="num" id="4791708">1</span><span class="op" id="4791709">;</span>&nbsp;<span class="ident" id="4791711">i</span>&nbsp;<span class="op" id="4791713">&gt;=</span>&nbsp;<span class="num" id="4791716">0</span>&nbsp;<span class="op" id="4791718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791722">return</span>&nbsp;<span class="ident" id="4791729">i</span><span class="op" id="4791730">*</span><span class="ident" id="4791731">_W</span>&nbsp;<span class="op" id="4791734">+</span>&nbsp;<span class="ident" id="4791736">bitLen</span><span class="op" id="4791742">(</span><span class="ident" id="4791743">x</span><span class="op" id="4791744">[</span><span class="ident" id="4791745">i</span><span class="op" id="4791746">]</span><span class="op" id="4791747">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4791750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791753">return</span>&nbsp;<span class="num" id="4791760">0</span><br>
<span class="lineno"></span><span class="op" id="4791762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4791765">//&nbsp;MaxBase&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;base&nbsp;accepted&nbsp;for&nbsp;string&nbsp;conversions.</span><br>
<span class="lineno">610</span><span class="keyword" id="4791836">const</span>&nbsp;<span class="ident" id="4791842">MaxBase</span>&nbsp;<span class="op" id="4791850">=</span>&nbsp;<span class="string" id="4791852">&#39;z&#39;</span>&nbsp;<span class="op" id="4791856">-</span>&nbsp;<span class="string" id="4791858">&#39;a&#39;</span>&nbsp;<span class="op" id="4791862">+</span>&nbsp;<span class="num" id="4791864">10</span>&nbsp;<span class="op" id="4791867">+</span>&nbsp;<span class="num" id="4791869">1</span>&nbsp;<span class="comment" id="4791871">//&nbsp;=&nbsp;hexValue(&#39;z&#39;)&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4791895">func</span>&nbsp;<span class="ident" id="4791900">hexValue</span><span class="op" id="4791908">(</span><span class="ident" id="4791909">ch</span>&nbsp;<span class="builtintype" id="4791912">rune</span><span class="op" id="4791916">)</span>&nbsp;<span class="ident" id="4791918">Word</span>&nbsp;<span class="op" id="4791923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791926">d</span>&nbsp;<span class="op" id="4791928">:=</span>&nbsp;<span class="builtintype" id="4791931">int</span><span class="op" id="4791934">(</span><span class="ident" id="4791935">MaxBase</span>&nbsp;<span class="op" id="4791943">+</span>&nbsp;<span class="num" id="4791945">1</span><span class="op" id="4791946">)</span>&nbsp;<span class="comment" id="4791948">//&nbsp;illegal&nbsp;base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791965">switch</span>&nbsp;<span class="op" id="4791972">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791975">case</span>&nbsp;<span class="string" id="4791980">&#39;0&#39;</span>&nbsp;<span class="op" id="4791984">&lt;=</span>&nbsp;<span class="ident" id="4791987">ch</span>&nbsp;<span class="op" id="4791990">&amp;&amp;</span>&nbsp;<span class="ident" id="4791993">ch</span>&nbsp;<span class="op" id="4791996">&lt;=</span>&nbsp;<span class="string" id="4791999">&#39;9&#39;</span><span class="op" id="4792002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792006">d</span>&nbsp;<span class="op" id="4792008">=</span>&nbsp;<span class="builtintype" id="4792010">int</span><span class="op" id="4792013">(</span><span class="ident" id="4792014">ch</span>&nbsp;<span class="op" id="4792017">-</span>&nbsp;<span class="string" id="4792019">&#39;0&#39;</span><span class="op" id="4792022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792025">case</span>&nbsp;<span class="string" id="4792030">&#39;a&#39;</span>&nbsp;<span class="op" id="4792034">&lt;=</span>&nbsp;<span class="ident" id="4792037">ch</span>&nbsp;<span class="op" id="4792040">&amp;&amp;</span>&nbsp;<span class="ident" id="4792043">ch</span>&nbsp;<span class="op" id="4792046">&lt;=</span>&nbsp;<span class="string" id="4792049">&#39;z&#39;</span><span class="op" id="4792052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792056">d</span>&nbsp;<span class="op" id="4792058">=</span>&nbsp;<span class="builtintype" id="4792060">int</span><span class="op" id="4792063">(</span><span class="ident" id="4792064">ch</span>&nbsp;<span class="op" id="4792067">-</span>&nbsp;<span class="string" id="4792069">&#39;a&#39;</span>&nbsp;<span class="op" id="4792073">+</span>&nbsp;<span class="num" id="4792075">10</span><span class="op" id="4792077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792080">case</span>&nbsp;<span class="string" id="4792085">&#39;A&#39;</span>&nbsp;<span class="op" id="4792089">&lt;=</span>&nbsp;<span class="ident" id="4792092">ch</span>&nbsp;<span class="op" id="4792095">&amp;&amp;</span>&nbsp;<span class="ident" id="4792098">ch</span>&nbsp;<span class="op" id="4792101">&lt;=</span>&nbsp;<span class="string" id="4792104">&#39;Z&#39;</span><span class="op" id="4792107">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792111">d</span>&nbsp;<span class="op" id="4792113">=</span>&nbsp;<span class="builtintype" id="4792115">int</span><span class="op" id="4792118">(</span><span class="ident" id="4792119">ch</span>&nbsp;<span class="op" id="4792122">-</span>&nbsp;<span class="string" id="4792124">&#39;A&#39;</span>&nbsp;<span class="op" id="4792128">+</span>&nbsp;<span class="num" id="4792130">10</span><span class="op" id="4792132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4792135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792138">return</span>&nbsp;<span class="ident" id="4792145">Word</span><span class="op" id="4792149">(</span><span class="ident" id="4792150">d</span><span class="op" id="4792151">)</span><br>
<span class="lineno"></span><span class="op" id="4792153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="4792156">//&nbsp;scan&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;natural&nbsp;number&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;longest&nbsp;possible&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="4792238">//&nbsp;read&nbsp;from&nbsp;r&nbsp;representing&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;in&nbsp;a&nbsp;given&nbsp;conversion&nbsp;base.</span><br>
<span class="lineno"></span><span class="comment" id="4792314">//&nbsp;It&nbsp;returns&nbsp;z,&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base&nbsp;used,&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;In&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4792393">//&nbsp;error&nbsp;case,&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;syntax&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4792470">//&nbsp;unsigned&nbsp;integer&nbsp;literals&nbsp;in&nbsp;Go.</span><br>
<span class="lineno">630</span><span class="comment" id="4792506">//</span><br>
<span class="lineno"></span><span class="comment" id="4792509">//&nbsp;The&nbsp;base&nbsp;argument&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;a&nbsp;value&nbsp;from&nbsp;2&nbsp;through&nbsp;MaxBase.&nbsp;If&nbsp;the&nbsp;base</span><br>
<span class="lineno"></span><span class="comment" id="4792587">//&nbsp;is&nbsp;0,&nbsp;the&nbsp;string&nbsp;prefix&nbsp;determines&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base.&nbsp;A&nbsp;prefix&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4792665">//&nbsp;``0x&#39;&#39;&nbsp;or&nbsp;``0X&#39;&#39;&nbsp;selects&nbsp;base&nbsp;16;&nbsp;the&nbsp;``0&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;8,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4792741">//&nbsp;``0b&#39;&#39;&nbsp;or&nbsp;``0B&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;2.&nbsp;Otherwise&nbsp;the&nbsp;selected&nbsp;base&nbsp;is&nbsp;10.</span><br>
<span class="lineno">635</span><span class="comment" id="4792819">//</span><br>
<span class="lineno"></span><span class="keyword" id="4792822">func</span>&nbsp;<span class="op" id="4792827">(</span><span class="ident" id="4792828">z</span>&nbsp;<span class="ident" id="4792830">nat</span><span class="op" id="4792833">)</span>&nbsp;<span class="ident" id="4792835">scan</span><span class="op" id="4792839">(</span><span class="ident" id="4792840">r</span>&nbsp;<span class="ident" id="4792842">io</span><span class="op" id="4792844">.</span><span class="ident" id="4792845">RuneScanner</span><span class="op" id="4792856">,</span>&nbsp;<span class="ident" id="4792858">base</span>&nbsp;<span class="builtintype" id="4792863">int</span><span class="op" id="4792866">)</span>&nbsp;<span class="op" id="4792868">(</span><span class="ident" id="4792869">nat</span><span class="op" id="4792872">,</span>&nbsp;<span class="builtintype" id="4792874">int</span><span class="op" id="4792877">,</span>&nbsp;<span class="builtintype" id="4792879">error</span><span class="op" id="4792884">)</span>&nbsp;<span class="op" id="4792886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4792889">//&nbsp;reject&nbsp;illegal&nbsp;bases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792914">if</span>&nbsp;<span class="ident" id="4792917">base</span>&nbsp;<span class="op" id="4792922">&lt;</span>&nbsp;<span class="num" id="4792924">0</span>&nbsp;<span class="op" id="4792926">||</span>&nbsp;<span class="ident" id="4792929">base</span>&nbsp;<span class="op" id="4792934">==</span>&nbsp;<span class="num" id="4792937">1</span>&nbsp;<span class="op" id="4792939">||</span>&nbsp;<span class="ident" id="4792942">MaxBase</span>&nbsp;<span class="op" id="4792950">&lt;</span>&nbsp;<span class="ident" id="4792952">base</span>&nbsp;<span class="op" id="4792957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792961">return</span>&nbsp;<span class="ident" id="4792968">z</span><span class="op" id="4792969">,</span>&nbsp;<span class="num" id="4792971">0</span><span class="op" id="4792972">,</span>&nbsp;<span class="ident" id="4792974">errors</span><span class="op" id="4792980">.</span><span class="ident" id="4792981">New</span><span class="op" id="4792984">(</span><span class="string" id="4792985">&#34;illegal&nbsp;number&nbsp;base&#34;</span><span class="op" id="4793006">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4793013">//&nbsp;one&nbsp;char&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793037">ch</span><span class="op" id="4793039">,</span>&nbsp;<span class="ident" id="4793041">_</span><span class="op" id="4793042">,</span>&nbsp;<span class="ident" id="4793044">err</span>&nbsp;<span class="op" id="4793048">:=</span>&nbsp;<span class="ident" id="4793051">r</span><span class="op" id="4793052">.</span><span class="ident" id="4793053">ReadRune</span><span class="op" id="4793061">(</span><span class="op" id="4793062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793065">if</span>&nbsp;<span class="ident" id="4793068">err</span>&nbsp;<span class="op" id="4793072">!=</span>&nbsp;<span class="ident" id="4793075">nil</span>&nbsp;<span class="op" id="4793079">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793083">return</span>&nbsp;<span class="ident" id="4793090">z</span><span class="op" id="4793091">,</span>&nbsp;<span class="num" id="4793093">0</span><span class="op" id="4793094">,</span>&nbsp;<span class="ident" id="4793096">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4793105">//&nbsp;determine&nbsp;base&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793137">b</span>&nbsp;<span class="op" id="4793139">:=</span>&nbsp;<span class="ident" id="4793142">Word</span><span class="op" id="4793146">(</span><span class="ident" id="4793147">base</span><span class="op" id="4793151">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793154">if</span>&nbsp;<span class="ident" id="4793157">base</span>&nbsp;<span class="op" id="4793162">==</span>&nbsp;<span class="num" id="4793165">0</span>&nbsp;<span class="op" id="4793167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793171">b</span>&nbsp;<span class="op" id="4793173">=</span>&nbsp;<span class="num" id="4793175">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793180">if</span>&nbsp;<span class="ident" id="4793183">ch</span>&nbsp;<span class="op" id="4793186">==</span>&nbsp;<span class="string" id="4793189">&#39;0&#39;</span>&nbsp;<span class="op" id="4793193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793198">switch</span>&nbsp;<span class="ident" id="4793205">ch</span><span class="op" id="4793207">,</span>&nbsp;<span class="ident" id="4793209">_</span><span class="op" id="4793210">,</span>&nbsp;<span class="ident" id="4793212">err</span>&nbsp;<span class="op" id="4793216">=</span>&nbsp;<span class="ident" id="4793218">r</span><span class="op" id="4793219">.</span><span class="ident" id="4793220">ReadRune</span><span class="op" id="4793228">(</span><span class="op" id="4793229">)</span><span class="op" id="4793230">;</span>&nbsp;<span class="ident" id="4793232">err</span>&nbsp;<span class="op" id="4793236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793241">case</span>&nbsp;<span class="ident" id="4793246">nil</span><span class="op" id="4793249">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793255">b</span>&nbsp;<span class="op" id="4793257">=</span>&nbsp;<span class="num" id="4793259">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793265">switch</span>&nbsp;<span class="ident" id="4793272">ch</span>&nbsp;<span class="op" id="4793275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793281">case</span>&nbsp;<span class="string" id="4793286">&#39;x&#39;</span><span class="op" id="4793289">,</span>&nbsp;<span class="string" id="4793291">&#39;X&#39;</span><span class="op" id="4793294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793301">b</span>&nbsp;<span class="op" id="4793303">=</span>&nbsp;<span class="num" id="4793305">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793312">case</span>&nbsp;<span class="string" id="4793317">&#39;b&#39;</span><span class="op" id="4793320">,</span>&nbsp;<span class="string" id="4793322">&#39;B&#39;</span><span class="op" id="4793325">:</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793332">b</span>&nbsp;<span class="op" id="4793334">=</span>&nbsp;<span class="num" id="4793336">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793348">if</span>&nbsp;<span class="ident" id="4793351">b</span>&nbsp;<span class="op" id="4793353">==</span>&nbsp;<span class="num" id="4793356">2</span>&nbsp;<span class="op" id="4793358">||</span>&nbsp;<span class="ident" id="4793361">b</span>&nbsp;<span class="op" id="4793363">==</span>&nbsp;<span class="num" id="4793366">16</span>&nbsp;<span class="op" id="4793369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793376">if</span>&nbsp;<span class="ident" id="4793379">ch</span><span class="op" id="4793381">,</span>&nbsp;<span class="ident" id="4793383">_</span><span class="op" id="4793384">,</span>&nbsp;<span class="ident" id="4793386">err</span>&nbsp;<span class="op" id="4793390">=</span>&nbsp;<span class="ident" id="4793392">r</span><span class="op" id="4793393">.</span><span class="ident" id="4793394">ReadRune</span><span class="op" id="4793402">(</span><span class="op" id="4793403">)</span><span class="op" id="4793404">;</span>&nbsp;<span class="ident" id="4793406">err</span>&nbsp;<span class="op" id="4793410">!=</span>&nbsp;<span class="ident" id="4793413">nil</span>&nbsp;<span class="op" id="4793417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793425">return</span>&nbsp;<span class="ident" id="4793432">z</span><span class="op" id="4793433">,</span>&nbsp;<span class="num" id="4793435">0</span><span class="op" id="4793436">,</span>&nbsp;<span class="ident" id="4793438">err</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793458">case</span>&nbsp;<span class="ident" id="4793463">io</span><span class="op" id="4793465">.</span><span class="ident" id="4793466">EOF</span><span class="op" id="4793469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793475">return</span>&nbsp;<span class="ident" id="4793482">z</span><span class="op" id="4793483">.</span><span class="builtinfunc" id="4793484">make</span><span class="op" id="4793488">(</span><span class="num" id="4793489">0</span><span class="op" id="4793490">)</span><span class="op" id="4793491">,</span>&nbsp;<span class="num" id="4793493">10</span><span class="op" id="4793495">,</span>&nbsp;<span class="ident" id="4793497">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793504">default</span><span class="op" id="4793511">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793517">return</span>&nbsp;<span class="ident" id="4793524">z</span><span class="op" id="4793525">,</span>&nbsp;<span class="num" id="4793527">10</span><span class="op" id="4793529">,</span>&nbsp;<span class="ident" id="4793531">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4793549">//&nbsp;convert&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4793568">//&nbsp;-&nbsp;group&nbsp;as&nbsp;many&nbsp;digits&nbsp;d&nbsp;as&nbsp;possible&nbsp;together&nbsp;into&nbsp;a&nbsp;&#34;super-digit&#34;&nbsp;dd&nbsp;with&nbsp;&#34;super-base&#34;&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4793663">//&nbsp;-&nbsp;only&nbsp;when&nbsp;bb&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;a&nbsp;word&nbsp;anymore,&nbsp;do&nbsp;a&nbsp;full&nbsp;number&nbsp;mulAddWW&nbsp;using&nbsp;bb&nbsp;and&nbsp;dd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793758">z</span>&nbsp;<span class="op" id="4793760">=</span>&nbsp;<span class="ident" id="4793762">z</span><span class="op" id="4793763">.</span><span class="builtinfunc" id="4793764">make</span><span class="op" id="4793768">(</span><span class="num" id="4793769">0</span><span class="op" id="4793770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793773">bb</span>&nbsp;<span class="op" id="4793776">:=</span>&nbsp;<span class="ident" id="4793779">Word</span><span class="op" id="4793783">(</span><span class="num" id="4793784">1</span><span class="op" id="4793785">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793788">dd</span>&nbsp;<span class="op" id="4793791">:=</span>&nbsp;<span class="ident" id="4793794">Word</span><span class="op" id="4793798">(</span><span class="num" id="4793799">0</span><span class="op" id="4793800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793803">for</span>&nbsp;<span class="ident" id="4793807">max</span>&nbsp;<span class="op" id="4793811">:=</span>&nbsp;<span class="ident" id="4793814">_M</span>&nbsp;<span class="op" id="4793817">/</span>&nbsp;<span class="ident" id="4793819">b</span><span class="op" id="4793820">;</span>&nbsp;<span class="op" id="4793822">;</span>&nbsp;<span class="op" id="4793824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793828">d</span>&nbsp;<span class="op" id="4793830">:=</span>&nbsp;<span class="ident" id="4793833">hexValue</span><span class="op" id="4793841">(</span><span class="ident" id="4793842">ch</span><span class="op" id="4793844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793848">if</span>&nbsp;<span class="ident" id="4793851">d</span>&nbsp;<span class="op" id="4793853">&gt;=</span>&nbsp;<span class="ident" id="4793856">b</span>&nbsp;<span class="op" id="4793858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793863">r</span><span class="op" id="4793864">.</span><span class="ident" id="4793865">UnreadRune</span><span class="op" id="4793875">(</span><span class="op" id="4793876">)</span>&nbsp;<span class="comment" id="4793878">//&nbsp;ch&nbsp;does&nbsp;not&nbsp;belong&nbsp;to&nbsp;number&nbsp;anymore</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793921">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793934">if</span>&nbsp;<span class="ident" id="4793937">bb</span>&nbsp;<span class="op" id="4793940">&lt;=</span>&nbsp;<span class="ident" id="4793943">max</span>&nbsp;<span class="op" id="4793947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793952">bb</span>&nbsp;<span class="op" id="4793955">*=</span>&nbsp;<span class="ident" id="4793958">b</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793963">dd</span>&nbsp;<span class="op" id="4793966">=</span>&nbsp;<span class="ident" id="4793968">dd</span><span class="op" id="4793970">*</span><span class="ident" id="4793971">b</span>&nbsp;<span class="op" id="4793973">+</span>&nbsp;<span class="ident" id="4793975">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793979">}</span>&nbsp;<span class="keyword" id="4793981">else</span>&nbsp;<span class="op" id="4793986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4793991">//&nbsp;bb&nbsp;*&nbsp;b&nbsp;would&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4794019">z</span>&nbsp;<span class="op" id="4794021">=</span>&nbsp;<span class="ident" id="4794023">z</span><span class="op" id="4794024">.</span><span class="ident" id="4794025">mulAddWW</span><span class="op" id="4794033">(</span><span class="ident" id="4794034">z</span><span class="op" id="4794035">,</span>&nbsp;<span class="ident" id="4794037">bb</span><span class="op" id="4794039">,</span>&nbsp;<span class="ident" id="4794041">dd</span><span class="op" id="4794043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4794048">bb</span>&nbsp;<span class="op" id="4794051">=</span>&nbsp;<span class="ident" id="4794053">b</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4794058">dd</span>&nbsp;<span class="op" id="4794061">=</span>&nbsp;<span class="ident" id="4794063">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4794067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794072">if</span>&nbsp;<span class="ident" id="4794075">ch</span><span class="op" id="4794077">,</span>&nbsp;<span class="ident" id="4794079">_</span><span class="op" id="4794080">,</span>&nbsp;<span class="ident" id="4794082">err</span>&nbsp;<span class="op" id="4794086">=</span>&nbsp;<span class="ident" id="4794088">r</span><span class="op" id="4794089">.</span><span class="ident" id="4794090">ReadRune</span><span class="op" id="4794098">(</span><span class="op" id="4794099">)</span><span class="op" id="4794100">;</span>&nbsp;<span class="ident" id="4794102">err</span>&nbsp;<span class="op" id="4794106">!=</span>&nbsp;<span class="ident" id="4794109">nil</span>&nbsp;<span class="op" id="4794113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794118">if</span>&nbsp;<span class="ident" id="4794121">err</span>&nbsp;<span class="op" id="4794125">!=</span>&nbsp;<span class="ident" id="4794128">io</span><span class="op" id="4794130">.</span><span class="ident" id="4794131">EOF</span>&nbsp;<span class="op" id="4794135">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794141">return</span>&nbsp;<span class="ident" id="4794148">z</span><span class="op" id="4794149">,</span>&nbsp;<span class="builtintype" id="4794151">int</span><span class="op" id="4794154">(</span><span class="ident" id="4794155">b</span><span class="op" id="4794156">)</span><span class="op" id="4794157">,</span>&nbsp;<span class="ident" id="4794159">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4794166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794171">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4794179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4794182">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794186">switch</span>&nbsp;<span class="op" id="4794193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794196">case</span>&nbsp;<span class="ident" id="4794201">bb</span>&nbsp;<span class="op" id="4794204">&gt;</span>&nbsp;<span class="num" id="4794206">1</span><span class="op" id="4794207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4794211">//&nbsp;there&nbsp;was&nbsp;at&nbsp;least&nbsp;one&nbsp;mantissa&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4794254">z</span>&nbsp;<span class="op" id="4794256">=</span>&nbsp;<span class="ident" id="4794258">z</span><span class="op" id="4794259">.</span><span class="ident" id="4794260">mulAddWW</span><span class="op" id="4794268">(</span><span class="ident" id="4794269">z</span><span class="op" id="4794270">,</span>&nbsp;<span class="ident" id="4794272">bb</span><span class="op" id="4794274">,</span>&nbsp;<span class="ident" id="4794276">dd</span><span class="op" id="4794278">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794281">case</span>&nbsp;<span class="ident" id="4794286">base</span>&nbsp;<span class="op" id="4794291">==</span>&nbsp;<span class="num" id="4794294">0</span>&nbsp;<span class="op" id="4794296">&amp;&amp;</span>&nbsp;<span class="ident" id="4794299">b</span>&nbsp;<span class="op" id="4794301">==</span>&nbsp;<span class="num" id="4794304">8</span><span class="op" id="4794305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4794309">//&nbsp;there&nbsp;was&nbsp;only&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0&nbsp;(possibly&nbsp;followed&nbsp;by&nbsp;digits&nbsp;&gt;&nbsp;7);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4794383">//&nbsp;return&nbsp;base&nbsp;10,&nbsp;not&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794410">return</span>&nbsp;<span class="ident" id="4794417">z</span><span class="op" id="4794418">,</span>&nbsp;<span class="num" id="4794420">10</span><span class="op" id="4794422">,</span>&nbsp;<span class="ident" id="4794424">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794429">case</span>&nbsp;<span class="ident" id="4794434">base</span>&nbsp;<span class="op" id="4794439">!=</span>&nbsp;<span class="num" id="4794442">0</span>&nbsp;<span class="op" id="4794444">||</span>&nbsp;<span class="ident" id="4794447">b</span>&nbsp;<span class="op" id="4794449">!=</span>&nbsp;<span class="num" id="4794452">8</span><span class="op" id="4794453">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4794457">//&nbsp;there&nbsp;was&nbsp;neither&nbsp;a&nbsp;mantissa&nbsp;digit&nbsp;nor&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794520">return</span>&nbsp;<span class="ident" id="4794527">z</span><span class="op" id="4794528">,</span>&nbsp;<span class="builtintype" id="4794530">int</span><span class="op" id="4794533">(</span><span class="ident" id="4794534">b</span><span class="op" id="4794535">)</span><span class="op" id="4794536">,</span>&nbsp;<span class="ident" id="4794538">errors</span><span class="op" id="4794544">.</span><span class="ident" id="4794545">New</span><span class="op" id="4794548">(</span><span class="string" id="4794549">&#34;syntax&nbsp;error&nbsp;scanning&nbsp;number&#34;</span><span class="op" id="4794579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4794582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794586">return</span>&nbsp;<span class="ident" id="4794593">z</span><span class="op" id="4794594">.</span><span class="ident" id="4794595">norm</span><span class="op" id="4794599">(</span><span class="op" id="4794600">)</span><span class="op" id="4794601">,</span>&nbsp;<span class="builtintype" id="4794603">int</span><span class="op" id="4794606">(</span><span class="ident" id="4794607">b</span><span class="op" id="4794608">)</span><span class="op" id="4794609">,</span>&nbsp;<span class="ident" id="4794611">nil</span><br>
<span class="lineno">720</span><span class="op" id="4794615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4794618">//&nbsp;Character&nbsp;sets&nbsp;for&nbsp;string&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="keyword" id="4794659">const</span>&nbsp;<span class="op" id="4794665">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4794668">lowercaseDigits</span>&nbsp;<span class="op" id="4794684">=</span>&nbsp;<span class="string" id="4794686">&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4794726">uppercaseDigits</span>&nbsp;<span class="op" id="4794742">=</span>&nbsp;<span class="string" id="4794744">&#34;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span><span class="op" id="4794783">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4794786">//&nbsp;decimalString&nbsp;returns&nbsp;a&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="4794842">//&nbsp;It&nbsp;calls&nbsp;x.string&nbsp;with&nbsp;the&nbsp;charset&nbsp;&#34;0123456789&#34;.</span><br>
<span class="lineno">730</span><span class="keyword" id="4794894">func</span>&nbsp;<span class="op" id="4794899">(</span><span class="ident" id="4794900">x</span>&nbsp;<span class="ident" id="4794902">nat</span><span class="op" id="4794905">)</span>&nbsp;<span class="ident" id="4794907">decimalString</span><span class="op" id="4794920">(</span><span class="op" id="4794921">)</span>&nbsp;<span class="builtintype" id="4794923">string</span>&nbsp;<span class="op" id="4794930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794933">return</span>&nbsp;<span class="ident" id="4794940">x</span><span class="op" id="4794941">.</span><span class="builtintype" id="4794942">string</span><span class="op" id="4794948">(</span><span class="ident" id="4794949">lowercaseDigits</span><span class="op" id="4794964">[</span><span class="num" id="4794965">0</span><span class="op" id="4794966">:</span><span class="num" id="4794967">10</span><span class="op" id="4794969">]</span><span class="op" id="4794970">)</span><br>
<span class="lineno"></span><span class="op" id="4794972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4794975">//&nbsp;string&nbsp;converts&nbsp;x&nbsp;to&nbsp;a&nbsp;string&nbsp;using&nbsp;digits&nbsp;from&nbsp;a&nbsp;charset;&nbsp;a&nbsp;digit&nbsp;with</span><br>
<span class="lineno">735</span><span class="comment" id="4795050">//&nbsp;value&nbsp;d&nbsp;is&nbsp;represented&nbsp;by&nbsp;charset[d].&nbsp;The&nbsp;conversion&nbsp;base&nbsp;is&nbsp;determined</span><br>
<span class="lineno"></span><span class="comment" id="4795125">//&nbsp;by&nbsp;len(charset),&nbsp;which&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&nbsp;and&nbsp;&lt;=&nbsp;256.</span><br>
<span class="lineno"></span><span class="keyword" id="4795176">func</span>&nbsp;<span class="op" id="4795181">(</span><span class="ident" id="4795182">x</span>&nbsp;<span class="ident" id="4795184">nat</span><span class="op" id="4795187">)</span>&nbsp;<span class="builtintype" id="4795189">string</span><span class="op" id="4795195">(</span><span class="ident" id="4795196">charset</span>&nbsp;<span class="builtintype" id="4795204">string</span><span class="op" id="4795210">)</span>&nbsp;<span class="builtintype" id="4795212">string</span>&nbsp;<span class="op" id="4795219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795222">b</span>&nbsp;<span class="op" id="4795224">:=</span>&nbsp;<span class="ident" id="4795227">Word</span><span class="op" id="4795231">(</span><span class="builtinfunc" id="4795232">len</span><span class="op" id="4795235">(</span><span class="ident" id="4795236">charset</span><span class="op" id="4795243">)</span><span class="op" id="4795244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4795248">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795266">switch</span>&nbsp;<span class="op" id="4795273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795276">case</span>&nbsp;<span class="ident" id="4795281">b</span>&nbsp;<span class="op" id="4795283">&lt;</span>&nbsp;<span class="num" id="4795285">2</span>&nbsp;<span class="op" id="4795287">||</span>&nbsp;<span class="ident" id="4795290">MaxBase</span>&nbsp;<span class="op" id="4795298">&gt;</span>&nbsp;<span class="num" id="4795300">256</span><span class="op" id="4795303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4795307">panic</span><span class="op" id="4795312">(</span><span class="string" id="4795313">&#34;illegal&nbsp;base&#34;</span><span class="op" id="4795327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795330">case</span>&nbsp;<span class="builtinfunc" id="4795335">len</span><span class="op" id="4795338">(</span><span class="ident" id="4795339">x</span><span class="op" id="4795340">)</span>&nbsp;<span class="op" id="4795342">==</span>&nbsp;<span class="num" id="4795345">0</span><span class="op" id="4795346">:</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795350">return</span>&nbsp;<span class="builtintype" id="4795357">string</span><span class="op" id="4795363">(</span><span class="ident" id="4795364">charset</span><span class="op" id="4795371">[</span><span class="num" id="4795372">0</span><span class="op" id="4795373">]</span><span class="op" id="4795374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4795377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4795381">//&nbsp;allocate&nbsp;buffer&nbsp;for&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795416">i</span>&nbsp;<span class="op" id="4795418">:=</span>&nbsp;<span class="builtintype" id="4795421">int</span><span class="op" id="4795424">(</span><span class="builtintype" id="4795425">float64</span><span class="op" id="4795432">(</span><span class="ident" id="4795433">x</span><span class="op" id="4795434">.</span><span class="ident" id="4795435">bitLen</span><span class="op" id="4795441">(</span><span class="op" id="4795442">)</span><span class="op" id="4795443">)</span><span class="op" id="4795444">/</span><span class="ident" id="4795445">math</span><span class="op" id="4795449">.</span><span class="ident" id="4795450">Log2</span><span class="op" id="4795454">(</span><span class="builtintype" id="4795455">float64</span><span class="op" id="4795462">(</span><span class="ident" id="4795463">b</span><span class="op" id="4795464">)</span><span class="op" id="4795465">)</span><span class="op" id="4795466">)</span>&nbsp;<span class="op" id="4795468">+</span>&nbsp;<span class="num" id="4795470">1</span>&nbsp;<span class="comment" id="4795472">//&nbsp;off&nbsp;by&nbsp;one&nbsp;at&nbsp;most</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795495">s</span>&nbsp;<span class="op" id="4795497">:=</span>&nbsp;<span class="builtinfunc" id="4795500">make</span><span class="op" id="4795504">(</span><span class="op" id="4795505">[</span><span class="op" id="4795506">]</span><span class="builtintype" id="4795507">byte</span><span class="op" id="4795511">,</span>&nbsp;<span class="ident" id="4795513">i</span><span class="op" id="4795514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4795518">//&nbsp;convert&nbsp;power&nbsp;of&nbsp;two&nbsp;and&nbsp;non&nbsp;power&nbsp;of&nbsp;two&nbsp;bases&nbsp;separately</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795581">if</span>&nbsp;<span class="ident" id="4795584">b</span>&nbsp;<span class="op" id="4795586">==</span>&nbsp;<span class="ident" id="4795589">b</span><span class="op" id="4795590">&amp;</span><span class="op" id="4795591">-</span><span class="ident" id="4795592">b</span>&nbsp;<span class="op" id="4795594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4795598">//&nbsp;shift&nbsp;is&nbsp;base-b&nbsp;digit&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795638">shift</span>&nbsp;<span class="op" id="4795644">:=</span>&nbsp;<span class="ident" id="4795647">trailingZeroBits</span><span class="op" id="4795663">(</span><span class="ident" id="4795664">b</span><span class="op" id="4795665">)</span>&nbsp;<span class="comment" id="4795667">//&nbsp;shift&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;b&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795697">mask</span>&nbsp;<span class="op" id="4795702">:=</span>&nbsp;<span class="ident" id="4795705">Word</span><span class="op" id="4795709">(</span><span class="num" id="4795710">1</span><span class="op" id="4795711">)</span><span class="op" id="4795712">&lt;&lt;</span><span class="ident" id="4795714">shift</span>&nbsp;<span class="op" id="4795720">-</span>&nbsp;<span class="num" id="4795722">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795726">w</span>&nbsp;<span class="op" id="4795728">:=</span>&nbsp;<span class="ident" id="4795731">x</span><span class="op" id="4795732">[</span><span class="num" id="4795733">0</span><span class="op" id="4795734">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795738">nbits</span>&nbsp;<span class="op" id="4795744">:=</span>&nbsp;<span class="builtintype" id="4795747">uint</span><span class="op" id="4795751">(</span><span class="ident" id="4795752">_W</span><span class="op" id="4795754">)</span>&nbsp;<span class="comment" id="4795756">//&nbsp;number&nbsp;of&nbsp;unprocessed&nbsp;bits&nbsp;in&nbsp;w</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4795794">//&nbsp;convert&nbsp;less-significant&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795830">for</span>&nbsp;<span class="ident" id="4795834">k</span>&nbsp;<span class="op" id="4795836">:=</span>&nbsp;<span class="num" id="4795839">1</span><span class="op" id="4795840">;</span>&nbsp;<span class="ident" id="4795842">k</span>&nbsp;<span class="op" id="4795844">&lt;</span>&nbsp;<span class="builtinfunc" id="4795846">len</span><span class="op" id="4795849">(</span><span class="ident" id="4795850">x</span><span class="op" id="4795851">)</span><span class="op" id="4795852">;</span>&nbsp;<span class="ident" id="4795854">k</span><span class="op" id="4795855">++</span>&nbsp;<span class="op" id="4795858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4795863">//&nbsp;convert&nbsp;full&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4795889">for</span>&nbsp;<span class="ident" id="4795893">nbits</span>&nbsp;<span class="op" id="4795899">&gt;=</span>&nbsp;<span class="ident" id="4795902">shift</span>&nbsp;<span class="op" id="4795908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795914">i</span><span class="op" id="4795915">--</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795922">s</span><span class="op" id="4795923">[</span><span class="ident" id="4795924">i</span><span class="op" id="4795925">]</span>&nbsp;<span class="op" id="4795927">=</span>&nbsp;<span class="ident" id="4795929">charset</span><span class="op" id="4795936">[</span><span class="ident" id="4795937">w</span><span class="op" id="4795938">&amp;</span><span class="ident" id="4795939">mask</span><span class="op" id="4795943">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795949">w</span>&nbsp;<span class="op" id="4795951">&gt;&gt;=</span>&nbsp;<span class="ident" id="4795955">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4795965">nbits</span>&nbsp;<span class="op" id="4795971">-=</span>&nbsp;<span class="ident" id="4795974">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4795983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4795989">//&nbsp;convert&nbsp;any&nbsp;partial&nbsp;leading&nbsp;digit&nbsp;and&nbsp;advance&nbsp;to&nbsp;next&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4796054">if</span>&nbsp;<span class="ident" id="4796057">nbits</span>&nbsp;<span class="op" id="4796063">==</span>&nbsp;<span class="num" id="4796066">0</span>&nbsp;<span class="op" id="4796068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4796074">//&nbsp;no&nbsp;partial&nbsp;digit&nbsp;remaining,&nbsp;just&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796122">w</span>&nbsp;<span class="op" id="4796124">=</span>&nbsp;<span class="ident" id="4796126">x</span><span class="op" id="4796127">[</span><span class="ident" id="4796128">k</span><span class="op" id="4796129">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796135">nbits</span>&nbsp;<span class="op" id="4796141">=</span>&nbsp;<span class="ident" id="4796143">_W</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4796149">}</span>&nbsp;<span class="keyword" id="4796151">else</span>&nbsp;<span class="op" id="4796156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4796162">//&nbsp;partial&nbsp;digit&nbsp;in&nbsp;current&nbsp;(k-1)&nbsp;and&nbsp;next&nbsp;(k)&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796218">w</span>&nbsp;<span class="op" id="4796220">|=</span>&nbsp;<span class="ident" id="4796223">x</span><span class="op" id="4796224">[</span><span class="ident" id="4796225">k</span><span class="op" id="4796226">]</span>&nbsp;<span class="op" id="4796228">&lt;&lt;</span>&nbsp;<span class="ident" id="4796231">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796241">i</span><span class="op" id="4796242">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796249">s</span><span class="op" id="4796250">[</span><span class="ident" id="4796251">i</span><span class="op" id="4796252">]</span>&nbsp;<span class="op" id="4796254">=</span>&nbsp;<span class="ident" id="4796256">charset</span><span class="op" id="4796263">[</span><span class="ident" id="4796264">w</span><span class="op" id="4796265">&amp;</span><span class="ident" id="4796266">mask</span><span class="op" id="4796270">]</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4796277">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796292">w</span>&nbsp;<span class="op" id="4796294">=</span>&nbsp;<span class="ident" id="4796296">x</span><span class="op" id="4796297">[</span><span class="ident" id="4796298">k</span><span class="op" id="4796299">]</span>&nbsp;<span class="op" id="4796301">&gt;&gt;</span>&nbsp;<span class="op" id="4796304">(</span><span class="ident" id="4796305">shift</span>&nbsp;<span class="op" id="4796311">-</span>&nbsp;<span class="ident" id="4796313">nbits</span><span class="op" id="4796318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796324">nbits</span>&nbsp;<span class="op" id="4796330">=</span>&nbsp;<span class="ident" id="4796332">_W</span>&nbsp;<span class="op" id="4796335">-</span>&nbsp;<span class="op" id="4796337">(</span><span class="ident" id="4796338">shift</span>&nbsp;<span class="op" id="4796344">-</span>&nbsp;<span class="ident" id="4796346">nbits</span><span class="op" id="4796351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4796356">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4796360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4796365">//&nbsp;convert&nbsp;digits&nbsp;of&nbsp;most-significant&nbsp;word&nbsp;(omit&nbsp;leading&nbsp;zeros)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4796431">for</span>&nbsp;<span class="ident" id="4796435">nbits</span>&nbsp;<span class="op" id="4796441">&gt;=</span>&nbsp;<span class="num" id="4796444">0</span>&nbsp;<span class="op" id="4796446">&amp;&amp;</span>&nbsp;<span class="ident" id="4796449">w</span>&nbsp;<span class="op" id="4796451">!=</span>&nbsp;<span class="num" id="4796454">0</span>&nbsp;<span class="op" id="4796456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796461">i</span><span class="op" id="4796462">--</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796468">s</span><span class="op" id="4796469">[</span><span class="ident" id="4796470">i</span><span class="op" id="4796471">]</span>&nbsp;<span class="op" id="4796473">=</span>&nbsp;<span class="ident" id="4796475">charset</span><span class="op" id="4796482">[</span><span class="ident" id="4796483">w</span><span class="op" id="4796484">&amp;</span><span class="ident" id="4796485">mask</span><span class="op" id="4796489">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796494">w</span>&nbsp;<span class="op" id="4796496">&gt;&gt;=</span>&nbsp;<span class="ident" id="4796500">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796509">nbits</span>&nbsp;<span class="op" id="4796515">-=</span>&nbsp;<span class="ident" id="4796518">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4796526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4796530">}</span>&nbsp;<span class="keyword" id="4796532">else</span>&nbsp;<span class="op" id="4796537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4796541">//&nbsp;determine&nbsp;&#34;big&nbsp;base&#34;;&nbsp;i.e.,&nbsp;the&nbsp;largest&nbsp;possible&nbsp;value&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4796604">//&nbsp;that&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;base&nbsp;b&nbsp;and&nbsp;still&nbsp;fits&nbsp;into&nbsp;a&nbsp;Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4796662">//&nbsp;(as&nbsp;in&nbsp;10^19&nbsp;for&nbsp;19&nbsp;decimal&nbsp;digits&nbsp;in&nbsp;a&nbsp;64bit&nbsp;Word)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796719">bb</span>&nbsp;<span class="op" id="4796722">:=</span>&nbsp;<span class="ident" id="4796725">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4796732">//&nbsp;big&nbsp;base&nbsp;is&nbsp;b**ndigits</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796760">ndigits</span>&nbsp;<span class="op" id="4796768">:=</span>&nbsp;<span class="num" id="4796771">1</span>&nbsp;<span class="comment" id="4796773">//&nbsp;number&nbsp;of&nbsp;base&nbsp;b&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4796802">for</span>&nbsp;<span class="ident" id="4796806">max</span>&nbsp;<span class="op" id="4796810">:=</span>&nbsp;<span class="ident" id="4796813">Word</span><span class="op" id="4796817">(</span><span class="ident" id="4796818">_M</span>&nbsp;<span class="op" id="4796821">/</span>&nbsp;<span class="ident" id="4796823">b</span><span class="op" id="4796824">)</span><span class="op" id="4796825">;</span>&nbsp;<span class="ident" id="4796827">bb</span>&nbsp;<span class="op" id="4796830">&lt;=</span>&nbsp;<span class="ident" id="4796833">max</span><span class="op" id="4796836">;</span>&nbsp;<span class="ident" id="4796838">bb</span>&nbsp;<span class="op" id="4796841">*=</span>&nbsp;<span class="ident" id="4796844">b</span>&nbsp;<span class="op" id="4796846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4796851">ndigits</span><span class="op" id="4796858">++</span>&nbsp;<span class="comment" id="4796861">//&nbsp;maximize&nbsp;ndigits&nbsp;where&nbsp;bb&nbsp;=&nbsp;b**ndigits,&nbsp;bb&nbsp;&lt;=&nbsp;_M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4796915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4796920">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;successive&nbsp;squares&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797001">//&nbsp;result&nbsp;(table&nbsp;!=&nbsp;nil)&nbsp;&lt;=&gt;&nbsp;(len(x)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797056">table</span>&nbsp;<span class="op" id="4797062">:=</span>&nbsp;<span class="ident" id="4797065">divisors</span><span class="op" id="4797073">(</span><span class="builtinfunc" id="4797074">len</span><span class="op" id="4797077">(</span><span class="ident" id="4797078">x</span><span class="op" id="4797079">)</span><span class="op" id="4797080">,</span>&nbsp;<span class="ident" id="4797082">b</span><span class="op" id="4797083">,</span>&nbsp;<span class="ident" id="4797085">ndigits</span><span class="op" id="4797092">,</span>&nbsp;<span class="ident" id="4797094">bb</span><span class="op" id="4797096">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797101">//&nbsp;preserve&nbsp;x,&nbsp;create&nbsp;local&nbsp;copy&nbsp;for&nbsp;use&nbsp;by&nbsp;convertWords</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797160">q</span>&nbsp;<span class="op" id="4797162">:=</span>&nbsp;<span class="ident" id="4797165">nat</span><span class="op" id="4797168">(</span><span class="ident" id="4797169">nil</span><span class="op" id="4797172">)</span><span class="op" id="4797173">.</span><span class="ident" id="4797174">set</span><span class="op" id="4797177">(</span><span class="ident" id="4797178">x</span><span class="op" id="4797179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797184">//&nbsp;convert&nbsp;q&nbsp;to&nbsp;string&nbsp;s&nbsp;in&nbsp;base&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797221">q</span><span class="op" id="4797222">.</span><span class="ident" id="4797223">convertWords</span><span class="op" id="4797235">(</span><span class="ident" id="4797236">s</span><span class="op" id="4797237">,</span>&nbsp;<span class="ident" id="4797239">charset</span><span class="op" id="4797246">,</span>&nbsp;<span class="ident" id="4797248">b</span><span class="op" id="4797249">,</span>&nbsp;<span class="ident" id="4797251">ndigits</span><span class="op" id="4797258">,</span>&nbsp;<span class="ident" id="4797260">bb</span><span class="op" id="4797262">,</span>&nbsp;<span class="ident" id="4797264">table</span><span class="op" id="4797269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797274">//&nbsp;strip&nbsp;leading&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797299">//&nbsp;(x&nbsp;!=&nbsp;0;&nbsp;thus&nbsp;s&nbsp;must&nbsp;contain&nbsp;at&nbsp;least&nbsp;one&nbsp;non-zero&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797361">//&nbsp;and&nbsp;the&nbsp;loop&nbsp;will&nbsp;terminate)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797395">i</span>&nbsp;<span class="op" id="4797397">=</span>&nbsp;<span class="num" id="4797399">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797403">for</span>&nbsp;<span class="ident" id="4797407">zero</span>&nbsp;<span class="op" id="4797412">:=</span>&nbsp;<span class="ident" id="4797415">charset</span><span class="op" id="4797422">[</span><span class="num" id="4797423">0</span><span class="op" id="4797424">]</span><span class="op" id="4797425">;</span>&nbsp;<span class="ident" id="4797427">s</span><span class="op" id="4797428">[</span><span class="ident" id="4797429">i</span><span class="op" id="4797430">]</span>&nbsp;<span class="op" id="4797432">==</span>&nbsp;<span class="ident" id="4797435">zero</span><span class="op" id="4797439">;</span>&nbsp;<span class="op" id="4797441">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797446">i</span><span class="op" id="4797447">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4797452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4797455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4797459">return</span>&nbsp;<span class="builtintype" id="4797466">string</span><span class="op" id="4797472">(</span><span class="ident" id="4797473">s</span><span class="op" id="4797474">[</span><span class="ident" id="4797475">i</span><span class="op" id="4797476">:</span><span class="op" id="4797477">]</span><span class="op" id="4797478">)</span><br>
<span class="lineno">825</span><span class="op" id="4797480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4797483">//&nbsp;Convert&nbsp;words&nbsp;of&nbsp;q&nbsp;to&nbsp;base&nbsp;b&nbsp;digits&nbsp;in&nbsp;s.&nbsp;If&nbsp;q&nbsp;is&nbsp;large,&nbsp;it&nbsp;is&nbsp;recursively&nbsp;&#34;split&nbsp;in&nbsp;half&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4797577">//&nbsp;by&nbsp;nat/nat&nbsp;division&nbsp;using&nbsp;tabulated&nbsp;divisors.&nbsp;Otherwise,&nbsp;it&nbsp;is&nbsp;converted&nbsp;iteratively&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="4797671">//&nbsp;repeated&nbsp;nat/Word&nbsp;division.</span><br>
<span class="lineno">830</span><span class="comment" id="4797702">//</span><br>
<span class="lineno"></span><span class="comment" id="4797705">//&nbsp;The&nbsp;iterative&nbsp;method&nbsp;processes&nbsp;n&nbsp;Words&nbsp;by&nbsp;n&nbsp;divW()&nbsp;calls,&nbsp;each&nbsp;of&nbsp;which&nbsp;visits&nbsp;every&nbsp;Word&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4797805">//&nbsp;incrementally&nbsp;shortened&nbsp;q&nbsp;for&nbsp;a&nbsp;total&nbsp;of&nbsp;n&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;(n-2)&nbsp;...&nbsp;+&nbsp;2&nbsp;+&nbsp;1,&nbsp;or&nbsp;n(n+1)/2&nbsp;divW()&#39;s.</span><br>
<span class="lineno"></span><span class="comment" id="4797902">//&nbsp;Recursive&nbsp;conversion&nbsp;divides&nbsp;q&nbsp;by&nbsp;its&nbsp;approximate&nbsp;square&nbsp;root,&nbsp;yielding&nbsp;two&nbsp;parts,&nbsp;each&nbsp;half</span><br>
<span class="lineno"></span><span class="comment" id="4797998">//&nbsp;the&nbsp;size&nbsp;of&nbsp;q.&nbsp;Using&nbsp;the&nbsp;iterative&nbsp;method&nbsp;on&nbsp;both&nbsp;halves&nbsp;means&nbsp;2&nbsp;*&nbsp;(n/2)(n/2&nbsp;+&nbsp;1)/2&nbsp;divW()&#39;s</span><br>
<span class="lineno">835</span><span class="comment" id="4798094">//&nbsp;plus&nbsp;the&nbsp;expensive&nbsp;long&nbsp;div().&nbsp;Asymptotically,&nbsp;the&nbsp;ratio&nbsp;is&nbsp;favorable&nbsp;at&nbsp;1/2&nbsp;the&nbsp;divW()&#39;s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4798192">//&nbsp;is&nbsp;made&nbsp;better&nbsp;by&nbsp;splitting&nbsp;the&nbsp;subblocks&nbsp;recursively.&nbsp;Best&nbsp;is&nbsp;to&nbsp;split&nbsp;blocks&nbsp;until&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="4798289">//&nbsp;split&nbsp;would&nbsp;take&nbsp;longer&nbsp;(because&nbsp;of&nbsp;the&nbsp;nat/nat&nbsp;div())&nbsp;than&nbsp;the&nbsp;twice&nbsp;as&nbsp;many&nbsp;divW()&#39;s&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4798386">//&nbsp;iterative&nbsp;approach.&nbsp;This&nbsp;threshold&nbsp;is&nbsp;represented&nbsp;by&nbsp;leafSize.&nbsp;Benchmarking&nbsp;of&nbsp;leafSize&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4798484">//&nbsp;range&nbsp;2..64&nbsp;shows&nbsp;that&nbsp;values&nbsp;of&nbsp;8&nbsp;and&nbsp;16&nbsp;work&nbsp;well,&nbsp;with&nbsp;a&nbsp;4x&nbsp;speedup&nbsp;at&nbsp;medium&nbsp;lengths&nbsp;and</span><br>
<span class="lineno">840</span><span class="comment" id="4798580">//&nbsp;~30x&nbsp;for&nbsp;20000&nbsp;digits.&nbsp;Use&nbsp;nat_test.go&#39;s&nbsp;BenchmarkLeafSize&nbsp;tests&nbsp;to&nbsp;optimize&nbsp;leafSize&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4798673">//&nbsp;specific&nbsp;hardware.</span><br>
<span class="lineno"></span><span class="comment" id="4798695">//</span><br>
<span class="lineno"></span><span class="keyword" id="4798698">func</span>&nbsp;<span class="op" id="4798703">(</span><span class="ident" id="4798704">q</span>&nbsp;<span class="ident" id="4798706">nat</span><span class="op" id="4798709">)</span>&nbsp;<span class="ident" id="4798711">convertWords</span><span class="op" id="4798723">(</span><span class="ident" id="4798724">s</span>&nbsp;<span class="op" id="4798726">[</span><span class="op" id="4798727">]</span><span class="builtintype" id="4798728">byte</span><span class="op" id="4798732">,</span>&nbsp;<span class="ident" id="4798734">charset</span>&nbsp;<span class="builtintype" id="4798742">string</span><span class="op" id="4798748">,</span>&nbsp;<span class="ident" id="4798750">b</span>&nbsp;<span class="ident" id="4798752">Word</span><span class="op" id="4798756">,</span>&nbsp;<span class="ident" id="4798758">ndigits</span>&nbsp;<span class="builtintype" id="4798766">int</span><span class="op" id="4798769">,</span>&nbsp;<span class="ident" id="4798771">bb</span>&nbsp;<span class="ident" id="4798774">Word</span><span class="op" id="4798778">,</span>&nbsp;<span class="ident" id="4798780">table</span>&nbsp;<span class="op" id="4798786">[</span><span class="op" id="4798787">]</span><span class="ident" id="4798788">divisor</span><span class="op" id="4798795">)</span>&nbsp;<span class="op" id="4798797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4798800">//&nbsp;split&nbsp;larger&nbsp;blocks&nbsp;recursively</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798836">if</span>&nbsp;<span class="ident" id="4798839">table</span>&nbsp;<span class="op" id="4798845">!=</span>&nbsp;<span class="ident" id="4798848">nil</span>&nbsp;<span class="op" id="4798852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4798856">//&nbsp;len(q)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798883">var</span>&nbsp;<span class="ident" id="4798887">r</span>&nbsp;<span class="ident" id="4798889">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798895">index</span>&nbsp;<span class="op" id="4798901">:=</span>&nbsp;<span class="builtinfunc" id="4798904">len</span><span class="op" id="4798907">(</span><span class="ident" id="4798908">table</span><span class="op" id="4798913">)</span>&nbsp;<span class="op" id="4798915">-</span>&nbsp;<span class="num" id="4798917">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798921">for</span>&nbsp;<span class="builtinfunc" id="4798925">len</span><span class="op" id="4798928">(</span><span class="ident" id="4798929">q</span><span class="op" id="4798930">)</span>&nbsp;<span class="op" id="4798932">&gt;</span>&nbsp;<span class="ident" id="4798934">leafSize</span>&nbsp;<span class="op" id="4798943">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4798948">//&nbsp;find&nbsp;divisor&nbsp;close&nbsp;to&nbsp;sqrt(q)&nbsp;if&nbsp;possible,&nbsp;but&nbsp;in&nbsp;any&nbsp;case&nbsp;&lt;&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799017">maxLength</span>&nbsp;<span class="op" id="4799027">:=</span>&nbsp;<span class="ident" id="4799030">q</span><span class="op" id="4799031">.</span><span class="ident" id="4799032">bitLen</span><span class="op" id="4799038">(</span><span class="op" id="4799039">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799045">//&nbsp;~=&nbsp;log2&nbsp;q,&nbsp;or&nbsp;at&nbsp;of&nbsp;least&nbsp;largest&nbsp;possible&nbsp;q&nbsp;of&nbsp;this&nbsp;bit&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799115">minLength</span>&nbsp;<span class="op" id="4799125">:=</span>&nbsp;<span class="ident" id="4799128">maxLength</span>&nbsp;<span class="op" id="4799138">&gt;&gt;</span>&nbsp;<span class="num" id="4799141">1</span>&nbsp;<span class="comment" id="4799143">//&nbsp;~=&nbsp;log2&nbsp;sqrt(q)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799165">for</span>&nbsp;<span class="ident" id="4799169">index</span>&nbsp;<span class="op" id="4799175">&gt;</span>&nbsp;<span class="num" id="4799177">0</span>&nbsp;<span class="op" id="4799179">&amp;&amp;</span>&nbsp;<span class="ident" id="4799182">table</span><span class="op" id="4799187">[</span><span class="ident" id="4799188">index</span><span class="op" id="4799193">-</span><span class="num" id="4799194">1</span><span class="op" id="4799195">]</span><span class="op" id="4799196">.</span><span class="ident" id="4799197">nbits</span>&nbsp;<span class="op" id="4799203">&gt;</span>&nbsp;<span class="ident" id="4799205">minLength</span>&nbsp;<span class="op" id="4799215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799221">index</span><span class="op" id="4799226">--</span>&nbsp;<span class="comment" id="4799229">//&nbsp;desired</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799248">if</span>&nbsp;<span class="ident" id="4799251">table</span><span class="op" id="4799256">[</span><span class="ident" id="4799257">index</span><span class="op" id="4799262">]</span><span class="op" id="4799263">.</span><span class="ident" id="4799264">nbits</span>&nbsp;<span class="op" id="4799270">&gt;=</span>&nbsp;<span class="ident" id="4799273">maxLength</span>&nbsp;<span class="op" id="4799283">&amp;&amp;</span>&nbsp;<span class="ident" id="4799286">table</span><span class="op" id="4799291">[</span><span class="ident" id="4799292">index</span><span class="op" id="4799297">]</span><span class="op" id="4799298">.</span><span class="ident" id="4799299">bbb</span><span class="op" id="4799302">.</span><span class="ident" id="4799303">cmp</span><span class="op" id="4799306">(</span><span class="ident" id="4799307">q</span><span class="op" id="4799308">)</span>&nbsp;<span class="op" id="4799310">&gt;=</span>&nbsp;<span class="num" id="4799313">0</span>&nbsp;<span class="op" id="4799315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799321">index</span><span class="op" id="4799326">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799333">if</span>&nbsp;<span class="ident" id="4799336">index</span>&nbsp;<span class="op" id="4799342">&lt;</span>&nbsp;<span class="num" id="4799344">0</span>&nbsp;<span class="op" id="4799346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4799353">panic</span><span class="op" id="4799358">(</span><span class="string" id="4799359">&#34;internal&nbsp;inconsistency&#34;</span><span class="op" id="4799383">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799400">//&nbsp;split&nbsp;q&nbsp;into&nbsp;the&nbsp;two&nbsp;digit&nbsp;number&nbsp;(q&#39;*bbb&nbsp;+&nbsp;r)&nbsp;to&nbsp;form&nbsp;independent&nbsp;subblocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799483">q</span><span class="op" id="4799484">,</span>&nbsp;<span class="ident" id="4799486">r</span>&nbsp;<span class="op" id="4799488">=</span>&nbsp;<span class="ident" id="4799490">q</span><span class="op" id="4799491">.</span><span class="ident" id="4799492">div</span><span class="op" id="4799495">(</span><span class="ident" id="4799496">r</span><span class="op" id="4799497">,</span>&nbsp;<span class="ident" id="4799499">q</span><span class="op" id="4799500">,</span>&nbsp;<span class="ident" id="4799502">table</span><span class="op" id="4799507">[</span><span class="ident" id="4799508">index</span><span class="op" id="4799513">]</span><span class="op" id="4799514">.</span><span class="ident" id="4799515">bbb</span><span class="op" id="4799518">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799524">//&nbsp;convert&nbsp;subblocks&nbsp;and&nbsp;collect&nbsp;results&nbsp;in&nbsp;s[:h]&nbsp;and&nbsp;s[h:]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799587">h</span>&nbsp;<span class="op" id="4799589">:=</span>&nbsp;<span class="builtinfunc" id="4799592">len</span><span class="op" id="4799595">(</span><span class="ident" id="4799596">s</span><span class="op" id="4799597">)</span>&nbsp;<span class="op" id="4799599">-</span>&nbsp;<span class="ident" id="4799601">table</span><span class="op" id="4799606">[</span><span class="ident" id="4799607">index</span><span class="op" id="4799612">]</span><span class="op" id="4799613">.</span><span class="ident" id="4799614">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799625">r</span><span class="op" id="4799626">.</span><span class="ident" id="4799627">convertWords</span><span class="op" id="4799639">(</span><span class="ident" id="4799640">s</span><span class="op" id="4799641">[</span><span class="ident" id="4799642">h</span><span class="op" id="4799643">:</span><span class="op" id="4799644">]</span><span class="op" id="4799645">,</span>&nbsp;<span class="ident" id="4799647">charset</span><span class="op" id="4799654">,</span>&nbsp;<span class="ident" id="4799656">b</span><span class="op" id="4799657">,</span>&nbsp;<span class="ident" id="4799659">ndigits</span><span class="op" id="4799666">,</span>&nbsp;<span class="ident" id="4799668">bb</span><span class="op" id="4799670">,</span>&nbsp;<span class="ident" id="4799672">table</span><span class="op" id="4799677">[</span><span class="num" id="4799678">0</span><span class="op" id="4799679">:</span><span class="ident" id="4799680">index</span><span class="op" id="4799685">]</span><span class="op" id="4799686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799691">s</span>&nbsp;<span class="op" id="4799693">=</span>&nbsp;<span class="ident" id="4799695">s</span><span class="op" id="4799696">[</span><span class="op" id="4799697">:</span><span class="ident" id="4799698">h</span><span class="op" id="4799699">]</span>&nbsp;<span class="comment" id="4799701">//&nbsp;==&nbsp;q.convertWords(s,&nbsp;charset,&nbsp;b,&nbsp;ndigits,&nbsp;bb,&nbsp;table[0:index+1])</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799777">//&nbsp;having&nbsp;split&nbsp;any&nbsp;large&nbsp;blocks&nbsp;now&nbsp;process&nbsp;the&nbsp;remaining&nbsp;(small)&nbsp;block&nbsp;iteratively</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799863">i</span>&nbsp;<span class="op" id="4799865">:=</span>&nbsp;<span class="builtinfunc" id="4799868">len</span><span class="op" id="4799871">(</span><span class="ident" id="4799872">s</span><span class="op" id="4799873">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799876">var</span>&nbsp;<span class="ident" id="4799880">r</span>&nbsp;<span class="ident" id="4799882">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799888">if</span>&nbsp;<span class="ident" id="4799891">b</span>&nbsp;<span class="op" id="4799893">==</span>&nbsp;<span class="num" id="4799896">10</span>&nbsp;<span class="op" id="4799899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799903">//&nbsp;hard-coding&nbsp;for&nbsp;10&nbsp;here&nbsp;speeds&nbsp;this&nbsp;up&nbsp;by&nbsp;1.25x&nbsp;(allows&nbsp;for&nbsp;/&nbsp;and&nbsp;%&nbsp;by&nbsp;constants)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799990">for</span>&nbsp;<span class="builtinfunc" id="4799994">len</span><span class="op" id="4799997">(</span><span class="ident" id="4799998">q</span><span class="op" id="4799999">)</span>&nbsp;<span class="op" id="4800001">&gt;</span>&nbsp;<span class="num" id="4800003">0</span>&nbsp;<span class="op" id="4800005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800010">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800059">q</span><span class="op" id="4800060">,</span>&nbsp;<span class="ident" id="4800062">r</span>&nbsp;<span class="op" id="4800064">=</span>&nbsp;<span class="ident" id="4800066">q</span><span class="op" id="4800067">.</span><span class="ident" id="4800068">divW</span><span class="op" id="4800072">(</span><span class="ident" id="4800073">q</span><span class="op" id="4800074">,</span>&nbsp;<span class="ident" id="4800076">bb</span><span class="op" id="4800078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800083">for</span>&nbsp;<span class="ident" id="4800087">j</span>&nbsp;<span class="op" id="4800089">:=</span>&nbsp;<span class="num" id="4800092">0</span><span class="op" id="4800093">;</span>&nbsp;<span class="ident" id="4800095">j</span>&nbsp;<span class="op" id="4800097">&lt;</span>&nbsp;<span class="ident" id="4800099">ndigits</span>&nbsp;<span class="op" id="4800107">&amp;&amp;</span>&nbsp;<span class="ident" id="4800110">i</span>&nbsp;<span class="op" id="4800112">&gt;</span>&nbsp;<span class="num" id="4800114">0</span><span class="op" id="4800115">;</span>&nbsp;<span class="ident" id="4800117">j</span><span class="op" id="4800118">++</span>&nbsp;<span class="op" id="4800121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800127">i</span><span class="op" id="4800128">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800135">//&nbsp;avoid&nbsp;%&nbsp;computation&nbsp;since&nbsp;r%10&nbsp;==&nbsp;r&nbsp;-&nbsp;int(r/10)*10;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800194">//&nbsp;this&nbsp;appears&nbsp;to&nbsp;be&nbsp;faster&nbsp;for&nbsp;BenchmarkString10000Base10</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800258">//&nbsp;and&nbsp;smaller&nbsp;strings&nbsp;(but&nbsp;a&nbsp;bit&nbsp;slower&nbsp;for&nbsp;larger&nbsp;ones)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800320">t</span>&nbsp;<span class="op" id="4800322">:=</span>&nbsp;<span class="ident" id="4800325">r</span>&nbsp;<span class="op" id="4800327">/</span>&nbsp;<span class="num" id="4800329">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800336">s</span><span class="op" id="4800337">[</span><span class="ident" id="4800338">i</span><span class="op" id="4800339">]</span>&nbsp;<span class="op" id="4800341">=</span>&nbsp;<span class="ident" id="4800343">charset</span><span class="op" id="4800350">[</span><span class="ident" id="4800351">r</span><span class="op" id="4800352">-</span><span class="ident" id="4800353">t</span><span class="op" id="4800354">&lt;&lt;</span><span class="num" id="4800356">3</span><span class="op" id="4800357">-</span><span class="ident" id="4800358">t</span><span class="op" id="4800359">-</span><span class="ident" id="4800360">t</span><span class="op" id="4800361">]</span>&nbsp;<span class="comment" id="4800363">//&nbsp;TODO(gri)&nbsp;replace&nbsp;w/&nbsp;t*10&nbsp;once&nbsp;compiler&nbsp;produces&nbsp;better&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800431">r</span>&nbsp;<span class="op" id="4800433">=</span>&nbsp;<span class="ident" id="4800435">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800440">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800447">}</span>&nbsp;<span class="keyword" id="4800449">else</span>&nbsp;<span class="op" id="4800454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800458">for</span>&nbsp;<span class="builtinfunc" id="4800462">len</span><span class="op" id="4800465">(</span><span class="ident" id="4800466">q</span><span class="op" id="4800467">)</span>&nbsp;<span class="op" id="4800469">&gt;</span>&nbsp;<span class="num" id="4800471">0</span>&nbsp;<span class="op" id="4800473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800478">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800527">q</span><span class="op" id="4800528">,</span>&nbsp;<span class="ident" id="4800530">r</span>&nbsp;<span class="op" id="4800532">=</span>&nbsp;<span class="ident" id="4800534">q</span><span class="op" id="4800535">.</span><span class="ident" id="4800536">divW</span><span class="op" id="4800540">(</span><span class="ident" id="4800541">q</span><span class="op" id="4800542">,</span>&nbsp;<span class="ident" id="4800544">bb</span><span class="op" id="4800546">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800551">for</span>&nbsp;<span class="ident" id="4800555">j</span>&nbsp;<span class="op" id="4800557">:=</span>&nbsp;<span class="num" id="4800560">0</span><span class="op" id="4800561">;</span>&nbsp;<span class="ident" id="4800563">j</span>&nbsp;<span class="op" id="4800565">&lt;</span>&nbsp;<span class="ident" id="4800567">ndigits</span>&nbsp;<span class="op" id="4800575">&amp;&amp;</span>&nbsp;<span class="ident" id="4800578">i</span>&nbsp;<span class="op" id="4800580">&gt;</span>&nbsp;<span class="num" id="4800582">0</span><span class="op" id="4800583">;</span>&nbsp;<span class="ident" id="4800585">j</span><span class="op" id="4800586">++</span>&nbsp;<span class="op" id="4800589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800595">i</span><span class="op" id="4800596">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800603">s</span><span class="op" id="4800604">[</span><span class="ident" id="4800605">i</span><span class="op" id="4800606">]</span>&nbsp;<span class="op" id="4800608">=</span>&nbsp;<span class="ident" id="4800610">charset</span><span class="op" id="4800617">[</span><span class="ident" id="4800618">r</span><span class="op" id="4800619">%</span><span class="ident" id="4800620">b</span><span class="op" id="4800621">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800627">r</span>&nbsp;<span class="op" id="4800629">/=</span>&nbsp;<span class="ident" id="4800632">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800637">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800648">//&nbsp;prepend&nbsp;high-order&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800678">zero</span>&nbsp;<span class="op" id="4800683">:=</span>&nbsp;<span class="ident" id="4800686">charset</span><span class="op" id="4800693">[</span><span class="num" id="4800694">0</span><span class="op" id="4800695">]</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800698">for</span>&nbsp;<span class="ident" id="4800702">i</span>&nbsp;<span class="op" id="4800704">&gt;</span>&nbsp;<span class="num" id="4800706">0</span>&nbsp;<span class="op" id="4800708">{</span>&nbsp;<span class="comment" id="4800710">//&nbsp;while&nbsp;need&nbsp;more&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800746">i</span><span class="op" id="4800747">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800752">s</span><span class="op" id="4800753">[</span><span class="ident" id="4800754">i</span><span class="op" id="4800755">]</span>&nbsp;<span class="op" id="4800757">=</span>&nbsp;<span class="ident" id="4800759">zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800765">}</span><br>
<span class="lineno"></span><span class="op" id="4800767">}</span><br>
<span class="lineno">910</span><br>
<span class="lineno"></span><span class="comment" id="4800770">//&nbsp;Split&nbsp;blocks&nbsp;greater&nbsp;than&nbsp;leafSize&nbsp;Words&nbsp;(or&nbsp;set&nbsp;to&nbsp;0&nbsp;to&nbsp;disable&nbsp;recursive&nbsp;conversion)</span><br>
<span class="lineno"></span><span class="comment" id="4800860">//&nbsp;Benchmark&nbsp;and&nbsp;configure&nbsp;leafSize&nbsp;using:&nbsp;go&nbsp;test&nbsp;-bench=&#34;Leaf&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4800925">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;3.0&nbsp;GHz&nbsp;Xeon&nbsp;&#34;Clovertown&#34;&nbsp;CPU&nbsp;(128&nbsp;byte&nbsp;cache&nbsp;lines)</span><br>
<span class="lineno"></span><span class="comment" id="4801005">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;2.66&nbsp;GHz&nbsp;Core&nbsp;2&nbsp;Duo&nbsp;&#34;Penryn&#34;&nbsp;CPU</span><br>
<span class="lineno">915</span><span class="keyword" id="4801065">var</span>&nbsp;<span class="ident" id="4801069">leafSize</span>&nbsp;<span class="builtintype" id="4801078">int</span>&nbsp;<span class="op" id="4801082">=</span>&nbsp;<span class="num" id="4801084">8</span>&nbsp;<span class="comment" id="4801086">//&nbsp;number&nbsp;of&nbsp;Word-size&nbsp;binary&nbsp;values&nbsp;treat&nbsp;as&nbsp;a&nbsp;monolithic&nbsp;block</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4801152">type</span>&nbsp;<span class="ident" id="4801157">divisor</span>&nbsp;<span class="keyword" id="4801165">struct</span>&nbsp;<span class="op" id="4801172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801175">bbb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801183">nat</span>&nbsp;<span class="comment" id="4801187">//&nbsp;divisor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801199">nbits</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4801207">int</span>&nbsp;<span class="comment" id="4801211">//&nbsp;bit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;(discounting&nbsp;leading&nbsp;zeroes)&nbsp;~=&nbsp;log2(bbb)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801279">ndigits</span>&nbsp;<span class="builtintype" id="4801287">int</span>&nbsp;<span class="comment" id="4801291">//&nbsp;digit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;in&nbsp;terms&nbsp;of&nbsp;output&nbsp;base&nbsp;digits</span><br>
<span class="lineno"></span><span class="op" id="4801349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4801352">var</span>&nbsp;<span class="ident" id="4801356">cacheBase10</span>&nbsp;<span class="keyword" id="4801368">struct</span>&nbsp;<span class="op" id="4801375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801378">sync</span><span class="op" id="4801382">.</span><span class="ident" id="4801383">Mutex</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801390">table</span>&nbsp;<span class="op" id="4801396">[</span><span class="num" id="4801397">64</span><span class="op" id="4801399">]</span><span class="ident" id="4801400">divisor</span>&nbsp;<span class="comment" id="4801408">//&nbsp;cached&nbsp;divisors&nbsp;for&nbsp;base&nbsp;10</span><br>
<span class="lineno"></span><span class="op" id="4801439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4801442">//&nbsp;expWW&nbsp;computes&nbsp;x**y</span><br>
<span class="lineno"></span><span class="keyword" id="4801465">func</span>&nbsp;<span class="op" id="4801470">(</span><span class="ident" id="4801471">z</span>&nbsp;<span class="ident" id="4801473">nat</span><span class="op" id="4801476">)</span>&nbsp;<span class="ident" id="4801478">expWW</span><span class="op" id="4801483">(</span><span class="ident" id="4801484">x</span><span class="op" id="4801485">,</span>&nbsp;<span class="ident" id="4801487">y</span>&nbsp;<span class="ident" id="4801489">Word</span><span class="op" id="4801493">)</span>&nbsp;<span class="ident" id="4801495">nat</span>&nbsp;<span class="op" id="4801499">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801502">return</span>&nbsp;<span class="ident" id="4801509">z</span><span class="op" id="4801510">.</span><span class="ident" id="4801511">expNN</span><span class="op" id="4801516">(</span><span class="ident" id="4801517">nat</span><span class="op" id="4801520">(</span><span class="ident" id="4801521">nil</span><span class="op" id="4801524">)</span><span class="op" id="4801525">.</span><span class="ident" id="4801526">setWord</span><span class="op" id="4801533">(</span><span class="ident" id="4801534">x</span><span class="op" id="4801535">)</span><span class="op" id="4801536">,</span>&nbsp;<span class="ident" id="4801538">nat</span><span class="op" id="4801541">(</span><span class="ident" id="4801542">nil</span><span class="op" id="4801545">)</span><span class="op" id="4801546">.</span><span class="ident" id="4801547">setWord</span><span class="op" id="4801554">(</span><span class="ident" id="4801555">y</span><span class="op" id="4801556">)</span><span class="op" id="4801557">,</span>&nbsp;<span class="ident" id="4801559">nil</span><span class="op" id="4801562">)</span><br>
<span class="lineno"></span><span class="op" id="4801564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4801567">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;powers&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span><span class="keyword" id="4801634">func</span>&nbsp;<span class="ident" id="4801639">divisors</span><span class="op" id="4801647">(</span><span class="ident" id="4801648">m</span>&nbsp;<span class="builtintype" id="4801650">int</span><span class="op" id="4801653">,</span>&nbsp;<span class="ident" id="4801655">b</span>&nbsp;<span class="ident" id="4801657">Word</span><span class="op" id="4801661">,</span>&nbsp;<span class="ident" id="4801663">ndigits</span>&nbsp;<span class="builtintype" id="4801671">int</span><span class="op" id="4801674">,</span>&nbsp;<span class="ident" id="4801676">bb</span>&nbsp;<span class="ident" id="4801679">Word</span><span class="op" id="4801683">)</span>&nbsp;<span class="op" id="4801685">[</span><span class="op" id="4801686">]</span><span class="ident" id="4801687">divisor</span>&nbsp;<span class="op" id="4801695">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4801698">//&nbsp;only&nbsp;compute&nbsp;table&nbsp;when&nbsp;recursive&nbsp;conversion&nbsp;is&nbsp;enabled&nbsp;and&nbsp;x&nbsp;is&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801773">if</span>&nbsp;<span class="ident" id="4801776">leafSize</span>&nbsp;<span class="op" id="4801785">==</span>&nbsp;<span class="num" id="4801788">0</span>&nbsp;<span class="op" id="4801790">||</span>&nbsp;<span class="ident" id="4801793">m</span>&nbsp;<span class="op" id="4801795">&lt;=</span>&nbsp;<span class="ident" id="4801798">leafSize</span>&nbsp;<span class="op" id="4801807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801811">return</span>&nbsp;<span class="ident" id="4801818">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4801827">//&nbsp;determine&nbsp;k&nbsp;where&nbsp;(bb**leafSize)**(2**k)&nbsp;&gt;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801883">k</span>&nbsp;<span class="op" id="4801885">:=</span>&nbsp;<span class="num" id="4801888">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801891">for</span>&nbsp;<span class="ident" id="4801895">words</span>&nbsp;<span class="op" id="4801901">:=</span>&nbsp;<span class="ident" id="4801904">leafSize</span><span class="op" id="4801912">;</span>&nbsp;<span class="ident" id="4801914">words</span>&nbsp;<span class="op" id="4801920">&lt;</span>&nbsp;<span class="ident" id="4801922">m</span><span class="op" id="4801923">&gt;&gt;</span><span class="num" id="4801925">1</span>&nbsp;<span class="op" id="4801927">&amp;&amp;</span>&nbsp;<span class="ident" id="4801930">k</span>&nbsp;<span class="op" id="4801932">&lt;</span>&nbsp;<span class="builtinfunc" id="4801934">len</span><span class="op" id="4801937">(</span><span class="ident" id="4801938">cacheBase10</span><span class="op" id="4801949">.</span><span class="ident" id="4801950">table</span><span class="op" id="4801955">)</span><span class="op" id="4801956">;</span>&nbsp;<span class="ident" id="4801958">words</span>&nbsp;<span class="op" id="4801964">&lt;&lt;=</span>&nbsp;<span class="num" id="4801968">1</span>&nbsp;<span class="op" id="4801970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801974">k</span><span class="op" id="4801975">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801979">}</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4801983">//&nbsp;reuse&nbsp;and&nbsp;extend&nbsp;existing&nbsp;table&nbsp;of&nbsp;divisors&nbsp;or&nbsp;create&nbsp;new&nbsp;table&nbsp;as&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802066">var</span>&nbsp;<span class="ident" id="4802070">table</span>&nbsp;<span class="op" id="4802076">[</span><span class="op" id="4802077">]</span><span class="ident" id="4802078">divisor</span>&nbsp;<span class="comment" id="4802086">//&nbsp;for&nbsp;b&nbsp;==&nbsp;10,&nbsp;table&nbsp;overlaps&nbsp;with&nbsp;cacheBase10.table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802141">if</span>&nbsp;<span class="ident" id="4802144">b</span>&nbsp;<span class="op" id="4802146">==</span>&nbsp;<span class="num" id="4802149">10</span>&nbsp;<span class="op" id="4802152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802156">cacheBase10</span><span class="op" id="4802167">.</span><span class="ident" id="4802168">Lock</span><span class="op" id="4802172">(</span><span class="op" id="4802173">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802177">table</span>&nbsp;<span class="op" id="4802183">=</span>&nbsp;<span class="ident" id="4802185">cacheBase10</span><span class="op" id="4802196">.</span><span class="ident" id="4802197">table</span><span class="op" id="4802202">[</span><span class="num" id="4802203">0</span><span class="op" id="4802204">:</span><span class="ident" id="4802205">k</span><span class="op" id="4802206">]</span>&nbsp;<span class="comment" id="4802208">//&nbsp;reuse&nbsp;old&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802248">}</span>&nbsp;<span class="keyword" id="4802250">else</span>&nbsp;<span class="op" id="4802255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802259">table</span>&nbsp;<span class="op" id="4802265">=</span>&nbsp;<span class="builtinfunc" id="4802267">make</span><span class="op" id="4802271">(</span><span class="op" id="4802272">[</span><span class="op" id="4802273">]</span><span class="ident" id="4802274">divisor</span><span class="op" id="4802281">,</span>&nbsp;<span class="ident" id="4802283">k</span><span class="op" id="4802284">)</span>&nbsp;<span class="comment" id="4802286">//&nbsp;create&nbsp;new&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4802331">//&nbsp;extend&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802348">if</span>&nbsp;<span class="ident" id="4802351">table</span><span class="op" id="4802356">[</span><span class="ident" id="4802357">k</span><span class="op" id="4802358">-</span><span class="num" id="4802359">1</span><span class="op" id="4802360">]</span><span class="op" id="4802361">.</span><span class="ident" id="4802362">ndigits</span>&nbsp;<span class="op" id="4802370">==</span>&nbsp;<span class="num" id="4802373">0</span>&nbsp;<span class="op" id="4802375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4802379">//&nbsp;add&nbsp;new&nbsp;entries&nbsp;as&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802410">var</span>&nbsp;<span class="ident" id="4802414">larger</span>&nbsp;<span class="ident" id="4802421">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802427">for</span>&nbsp;<span class="ident" id="4802431">i</span>&nbsp;<span class="op" id="4802433">:=</span>&nbsp;<span class="num" id="4802436">0</span><span class="op" id="4802437">;</span>&nbsp;<span class="ident" id="4802439">i</span>&nbsp;<span class="op" id="4802441">&lt;</span>&nbsp;<span class="ident" id="4802443">k</span><span class="op" id="4802444">;</span>&nbsp;<span class="ident" id="4802446">i</span><span class="op" id="4802447">++</span>&nbsp;<span class="op" id="4802450">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802455">if</span>&nbsp;<span class="ident" id="4802458">table</span><span class="op" id="4802463">[</span><span class="ident" id="4802464">i</span><span class="op" id="4802465">]</span><span class="op" id="4802466">.</span><span class="ident" id="4802467">ndigits</span>&nbsp;<span class="op" id="4802475">==</span>&nbsp;<span class="num" id="4802478">0</span>&nbsp;<span class="op" id="4802480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802486">if</span>&nbsp;<span class="ident" id="4802489">i</span>&nbsp;<span class="op" id="4802491">==</span>&nbsp;<span class="num" id="4802494">0</span>&nbsp;<span class="op" id="4802496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802503">table</span><span class="op" id="4802508">[</span><span class="num" id="4802509">0</span><span class="op" id="4802510">]</span><span class="op" id="4802511">.</span><span class="ident" id="4802512">bbb</span>&nbsp;<span class="op" id="4802516">=</span>&nbsp;<span class="ident" id="4802518">nat</span><span class="op" id="4802521">(</span><span class="ident" id="4802522">nil</span><span class="op" id="4802525">)</span><span class="op" id="4802526">.</span><span class="ident" id="4802527">expWW</span><span class="op" id="4802532">(</span><span class="ident" id="4802533">bb</span><span class="op" id="4802535">,</span>&nbsp;<span class="ident" id="4802537">Word</span><span class="op" id="4802541">(</span><span class="ident" id="4802542">leafSize</span><span class="op" id="4802550">)</span><span class="op" id="4802551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802558">table</span><span class="op" id="4802563">[</span><span class="num" id="4802564">0</span><span class="op" id="4802565">]</span><span class="op" id="4802566">.</span><span class="ident" id="4802567">ndigits</span>&nbsp;<span class="op" id="4802575">=</span>&nbsp;<span class="ident" id="4802577">ndigits</span>&nbsp;<span class="op" id="4802585">*</span>&nbsp;<span class="ident" id="4802587">leafSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802600">}</span>&nbsp;<span class="keyword" id="4802602">else</span>&nbsp;<span class="op" id="4802607">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802614">table</span><span class="op" id="4802619">[</span><span class="ident" id="4802620">i</span><span class="op" id="4802621">]</span><span class="op" id="4802622">.</span><span class="ident" id="4802623">bbb</span>&nbsp;<span class="op" id="4802627">=</span>&nbsp;<span class="ident" id="4802629">nat</span><span class="op" id="4802632">(</span><span class="ident" id="4802633">nil</span><span class="op" id="4802636">)</span><span class="op" id="4802637">.</span><span class="ident" id="4802638">mul</span><span class="op" id="4802641">(</span><span class="ident" id="4802642">table</span><span class="op" id="4802647">[</span><span class="ident" id="4802648">i</span><span class="op" id="4802649">-</span><span class="num" id="4802650">1</span><span class="op" id="4802651">]</span><span class="op" id="4802652">.</span><span class="ident" id="4802653">bbb</span><span class="op" id="4802656">,</span>&nbsp;<span class="ident" id="4802658">table</span><span class="op" id="4802663">[</span><span class="ident" id="4802664">i</span><span class="op" id="4802665">-</span><span class="num" id="4802666">1</span><span class="op" id="4802667">]</span><span class="op" id="4802668">.</span><span class="ident" id="4802669">bbb</span><span class="op" id="4802672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802679">table</span><span class="op" id="4802684">[</span><span class="ident" id="4802685">i</span><span class="op" id="4802686">]</span><span class="op" id="4802687">.</span><span class="ident" id="4802688">ndigits</span>&nbsp;<span class="op" id="4802696">=</span>&nbsp;<span class="num" id="4802698">2</span>&nbsp;<span class="op" id="4802700">*</span>&nbsp;<span class="ident" id="4802702">table</span><span class="op" id="4802707">[</span><span class="ident" id="4802708">i</span><span class="op" id="4802709">-</span><span class="num" id="4802710">1</span><span class="op" id="4802711">]</span><span class="op" id="4802712">.</span><span class="ident" id="4802713">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4802732">//&nbsp;optimization:&nbsp;exploit&nbsp;aggregated&nbsp;extra&nbsp;bits&nbsp;in&nbsp;macro&nbsp;blocks</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802799">larger</span>&nbsp;<span class="op" id="4802806">=</span>&nbsp;<span class="ident" id="4802808">nat</span><span class="op" id="4802811">(</span><span class="ident" id="4802812">nil</span><span class="op" id="4802815">)</span><span class="op" id="4802816">.</span><span class="ident" id="4802817">set</span><span class="op" id="4802820">(</span><span class="ident" id="4802821">table</span><span class="op" id="4802826">[</span><span class="ident" id="4802827">i</span><span class="op" id="4802828">]</span><span class="op" id="4802829">.</span><span class="ident" id="4802830">bbb</span><span class="op" id="4802833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802839">for</span>&nbsp;<span class="ident" id="4802843">mulAddVWW</span><span class="op" id="4802852">(</span><span class="ident" id="4802853">larger</span><span class="op" id="4802859">,</span>&nbsp;<span class="ident" id="4802861">larger</span><span class="op" id="4802867">,</span>&nbsp;<span class="ident" id="4802869">b</span><span class="op" id="4802870">,</span>&nbsp;<span class="num" id="4802872">0</span><span class="op" id="4802873">)</span>&nbsp;<span class="op" id="4802875">==</span>&nbsp;<span class="num" id="4802878">0</span>&nbsp;<span class="op" id="4802880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802887">table</span><span class="op" id="4802892">[</span><span class="ident" id="4802893">i</span><span class="op" id="4802894">]</span><span class="op" id="4802895">.</span><span class="ident" id="4802896">bbb</span>&nbsp;<span class="op" id="4802900">=</span>&nbsp;<span class="ident" id="4802902">table</span><span class="op" id="4802907">[</span><span class="ident" id="4802908">i</span><span class="op" id="4802909">]</span><span class="op" id="4802910">.</span><span class="ident" id="4802911">bbb</span><span class="op" id="4802914">.</span><span class="ident" id="4802915">set</span><span class="op" id="4802918">(</span><span class="ident" id="4802919">larger</span><span class="op" id="4802925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802932">table</span><span class="op" id="4802937">[</span><span class="ident" id="4802938">i</span><span class="op" id="4802939">]</span><span class="op" id="4802940">.</span><span class="ident" id="4802941">ndigits</span><span class="op" id="4802948">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802955">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802962">table</span><span class="op" id="4802967">[</span><span class="ident" id="4802968">i</span><span class="op" id="4802969">]</span><span class="op" id="4802970">.</span><span class="ident" id="4802971">nbits</span>&nbsp;<span class="op" id="4802977">=</span>&nbsp;<span class="ident" id="4802979">table</span><span class="op" id="4802984">[</span><span class="ident" id="4802985">i</span><span class="op" id="4802986">]</span><span class="op" id="4802987">.</span><span class="ident" id="4802988">bbb</span><span class="op" id="4802991">.</span><span class="ident" id="4802992">bitLen</span><span class="op" id="4802998">(</span><span class="op" id="4802999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803011">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803015">if</span>&nbsp;<span class="ident" id="4803018">b</span>&nbsp;<span class="op" id="4803020">==</span>&nbsp;<span class="num" id="4803023">10</span>&nbsp;<span class="op" id="4803026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4803030">cacheBase10</span><span class="op" id="4803041">.</span><span class="ident" id="4803042">Unlock</span><span class="op" id="4803048">(</span><span class="op" id="4803049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803056">return</span>&nbsp;<span class="ident" id="4803063">table</span><br>
<span class="lineno"></span><span class="op" id="4803069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4803072">const</span>&nbsp;<span class="ident" id="4803078">deBruijn32</span>&nbsp;<span class="op" id="4803089">=</span>&nbsp;<span class="num" id="4803091">0x077CB531</span><br>
<span class="lineno"></span><br>
<span class="lineno">990</span><span class="keyword" id="4803103">var</span>&nbsp;<span class="ident" id="4803107">deBruijn32Lookup</span>&nbsp;<span class="op" id="4803124">=</span>&nbsp;<span class="op" id="4803126">[</span><span class="op" id="4803127">]</span><span class="builtintype" id="4803128">byte</span><span class="op" id="4803132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4803135">0</span><span class="op" id="4803136">,</span>&nbsp;<span class="num" id="4803138">1</span><span class="op" id="4803139">,</span>&nbsp;<span class="num" id="4803141">28</span><span class="op" id="4803143">,</span>&nbsp;<span class="num" id="4803145">2</span><span class="op" id="4803146">,</span>&nbsp;<span class="num" id="4803148">29</span><span class="op" id="4803150">,</span>&nbsp;<span class="num" id="4803152">14</span><span class="op" id="4803154">,</span>&nbsp;<span class="num" id="4803156">24</span><span class="op" id="4803158">,</span>&nbsp;<span class="num" id="4803160">3</span><span class="op" id="4803161">,</span>&nbsp;<span class="num" id="4803163">30</span><span class="op" id="4803165">,</span>&nbsp;<span class="num" id="4803167">22</span><span class="op" id="4803169">,</span>&nbsp;<span class="num" id="4803171">20</span><span class="op" id="4803173">,</span>&nbsp;<span class="num" id="4803175">15</span><span class="op" id="4803177">,</span>&nbsp;<span class="num" id="4803179">25</span><span class="op" id="4803181">,</span>&nbsp;<span class="num" id="4803183">17</span><span class="op" id="4803185">,</span>&nbsp;<span class="num" id="4803187">4</span><span class="op" id="4803188">,</span>&nbsp;<span class="num" id="4803190">8</span><span class="op" id="4803191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4803194">31</span><span class="op" id="4803196">,</span>&nbsp;<span class="num" id="4803198">27</span><span class="op" id="4803200">,</span>&nbsp;<span class="num" id="4803202">13</span><span class="op" id="4803204">,</span>&nbsp;<span class="num" id="4803206">23</span><span class="op" id="4803208">,</span>&nbsp;<span class="num" id="4803210">21</span><span class="op" id="4803212">,</span>&nbsp;<span class="num" id="4803214">19</span><span class="op" id="4803216">,</span>&nbsp;<span class="num" id="4803218">16</span><span class="op" id="4803220">,</span>&nbsp;<span class="num" id="4803222">7</span><span class="op" id="4803223">,</span>&nbsp;<span class="num" id="4803225">26</span><span class="op" id="4803227">,</span>&nbsp;<span class="num" id="4803229">12</span><span class="op" id="4803231">,</span>&nbsp;<span class="num" id="4803233">18</span><span class="op" id="4803235">,</span>&nbsp;<span class="num" id="4803237">6</span><span class="op" id="4803238">,</span>&nbsp;<span class="num" id="4803240">11</span><span class="op" id="4803242">,</span>&nbsp;<span class="num" id="4803244">5</span><span class="op" id="4803245">,</span>&nbsp;<span class="num" id="4803247">10</span><span class="op" id="4803249">,</span>&nbsp;<span class="num" id="4803251">9</span><span class="op" id="4803252">,</span><br>
<span class="lineno"></span><span class="op" id="4803254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="4803257">const</span>&nbsp;<span class="ident" id="4803263">deBruijn64</span>&nbsp;<span class="op" id="4803274">=</span>&nbsp;<span class="num" id="4803276">0x03f79d71b4ca8b09</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4803296">var</span>&nbsp;<span class="ident" id="4803300">deBruijn64Lookup</span>&nbsp;<span class="op" id="4803317">=</span>&nbsp;<span class="op" id="4803319">[</span><span class="op" id="4803320">]</span><span class="builtintype" id="4803321">byte</span><span class="op" id="4803325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4803328">0</span><span class="op" id="4803329">,</span>&nbsp;<span class="num" id="4803331">1</span><span class="op" id="4803332">,</span>&nbsp;<span class="num" id="4803334">56</span><span class="op" id="4803336">,</span>&nbsp;<span class="num" id="4803338">2</span><span class="op" id="4803339">,</span>&nbsp;<span class="num" id="4803341">57</span><span class="op" id="4803343">,</span>&nbsp;<span class="num" id="4803345">49</span><span class="op" id="4803347">,</span>&nbsp;<span class="num" id="4803349">28</span><span class="op" id="4803351">,</span>&nbsp;<span class="num" id="4803353">3</span><span class="op" id="4803354">,</span>&nbsp;<span class="num" id="4803356">61</span><span class="op" id="4803358">,</span>&nbsp;<span class="num" id="4803360">58</span><span class="op" id="4803362">,</span>&nbsp;<span class="num" id="4803364">42</span><span class="op" id="4803366">,</span>&nbsp;<span class="num" id="4803368">50</span><span class="op" id="4803370">,</span>&nbsp;<span class="num" id="4803372">38</span><span class="op" id="4803374">,</span>&nbsp;<span class="num" id="4803376">29</span><span class="op" id="4803378">,</span>&nbsp;<span class="num" id="4803380">17</span><span class="op" id="4803382">,</span>&nbsp;<span class="num" id="4803384">4</span><span class="op" id="4803385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4803388">62</span><span class="op" id="4803390">,</span>&nbsp;<span class="num" id="4803392">47</span><span class="op" id="4803394">,</span>&nbsp;<span class="num" id="4803396">59</span><span class="op" id="4803398">,</span>&nbsp;<span class="num" id="4803400">36</span><span class="op" id="4803402">,</span>&nbsp;<span class="num" id="4803404">45</span><span class="op" id="4803406">,</span>&nbsp;<span class="num" id="4803408">43</span><span class="op" id="4803410">,</span>&nbsp;<span class="num" id="4803412">51</span><span class="op" id="4803414">,</span>&nbsp;<span class="num" id="4803416">22</span><span class="op" id="4803418">,</span>&nbsp;<span class="num" id="4803420">53</span><span class="op" id="4803422">,</span>&nbsp;<span class="num" id="4803424">39</span><span class="op" id="4803426">,</span>&nbsp;<span class="num" id="4803428">33</span><span class="op" id="4803430">,</span>&nbsp;<span class="num" id="4803432">30</span><span class="op" id="4803434">,</span>&nbsp;<span class="num" id="4803436">24</span><span class="op" id="4803438">,</span>&nbsp;<span class="num" id="4803440">18</span><span class="op" id="4803442">,</span>&nbsp;<span class="num" id="4803444">12</span><span class="op" id="4803446">,</span>&nbsp;<span class="num" id="4803448">5</span><span class="op" id="4803449">,</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4803452">63</span><span class="op" id="4803454">,</span>&nbsp;<span class="num" id="4803456">55</span><span class="op" id="4803458">,</span>&nbsp;<span class="num" id="4803460">48</span><span class="op" id="4803462">,</span>&nbsp;<span class="num" id="4803464">27</span><span class="op" id="4803466">,</span>&nbsp;<span class="num" id="4803468">60</span><span class="op" id="4803470">,</span>&nbsp;<span class="num" id="4803472">41</span><span class="op" id="4803474">,</span>&nbsp;<span class="num" id="4803476">37</span><span class="op" id="4803478">,</span>&nbsp;<span class="num" id="4803480">16</span><span class="op" id="4803482">,</span>&nbsp;<span class="num" id="4803484">46</span><span class="op" id="4803486">,</span>&nbsp;<span class="num" id="4803488">35</span><span class="op" id="4803490">,</span>&nbsp;<span class="num" id="4803492">44</span><span class="op" id="4803494">,</span>&nbsp;<span class="num" id="4803496">21</span><span class="op" id="4803498">,</span>&nbsp;<span class="num" id="4803500">52</span><span class="op" id="4803502">,</span>&nbsp;<span class="num" id="4803504">32</span><span class="op" id="4803506">,</span>&nbsp;<span class="num" id="4803508">23</span><span class="op" id="4803510">,</span>&nbsp;<span class="num" id="4803512">11</span><span class="op" id="4803514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4803517">54</span><span class="op" id="4803519">,</span>&nbsp;<span class="num" id="4803521">26</span><span class="op" id="4803523">,</span>&nbsp;<span class="num" id="4803525">40</span><span class="op" id="4803527">,</span>&nbsp;<span class="num" id="4803529">15</span><span class="op" id="4803531">,</span>&nbsp;<span class="num" id="4803533">34</span><span class="op" id="4803535">,</span>&nbsp;<span class="num" id="4803537">20</span><span class="op" id="4803539">,</span>&nbsp;<span class="num" id="4803541">31</span><span class="op" id="4803543">,</span>&nbsp;<span class="num" id="4803545">10</span><span class="op" id="4803547">,</span>&nbsp;<span class="num" id="4803549">25</span><span class="op" id="4803551">,</span>&nbsp;<span class="num" id="4803553">14</span><span class="op" id="4803555">,</span>&nbsp;<span class="num" id="4803557">19</span><span class="op" id="4803559">,</span>&nbsp;<span class="num" id="4803561">9</span><span class="op" id="4803562">,</span>&nbsp;<span class="num" id="4803564">13</span><span class="op" id="4803566">,</span>&nbsp;<span class="num" id="4803568">8</span><span class="op" id="4803569">,</span>&nbsp;<span class="num" id="4803571">7</span><span class="op" id="4803572">,</span>&nbsp;<span class="num" id="4803574">6</span><span class="op" id="4803575">,</span><br>
<span class="lineno"></span><span class="op" id="4803577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4803580">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno">1005</span><span class="comment" id="4803657">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4803671">func</span>&nbsp;<span class="ident" id="4803676">trailingZeroBits</span><span class="op" id="4803692">(</span><span class="ident" id="4803693">x</span>&nbsp;<span class="ident" id="4803695">Word</span><span class="op" id="4803699">)</span>&nbsp;<span class="builtintype" id="4803701">uint</span>&nbsp;<span class="op" id="4803706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803709">//&nbsp;x&nbsp;&amp;&nbsp;-x&nbsp;leaves&nbsp;only&nbsp;the&nbsp;right-most&nbsp;bit&nbsp;set&nbsp;in&nbsp;the&nbsp;word.&nbsp;Let&nbsp;k&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803781">//&nbsp;index&nbsp;of&nbsp;that&nbsp;bit.&nbsp;Since&nbsp;only&nbsp;a&nbsp;single&nbsp;bit&nbsp;is&nbsp;set,&nbsp;the&nbsp;value&nbsp;is&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803853">//&nbsp;to&nbsp;the&nbsp;power&nbsp;of&nbsp;k.&nbsp;Multiplying&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;two&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803923">//&nbsp;left&nbsp;shifting,&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;k&nbsp;bits.&nbsp;&nbsp;The&nbsp;de&nbsp;Bruijn&nbsp;constant&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4803993">//&nbsp;such&nbsp;that&nbsp;all&nbsp;six&nbsp;bit,&nbsp;consecutive&nbsp;substrings&nbsp;are&nbsp;distinct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804057">//&nbsp;Therefore,&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;left&nbsp;shifted&nbsp;version&nbsp;of&nbsp;this&nbsp;constant&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804130">//&nbsp;find&nbsp;by&nbsp;how&nbsp;many&nbsp;bits&nbsp;it&nbsp;was&nbsp;shifted&nbsp;by&nbsp;looking&nbsp;at&nbsp;which&nbsp;six&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804199">//&nbsp;substring&nbsp;ended&nbsp;up&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;word.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804246">//&nbsp;(Knuth,&nbsp;volume&nbsp;4,&nbsp;section&nbsp;7.3.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804283">switch</span>&nbsp;<span class="ident" id="4804290">_W</span>&nbsp;<span class="op" id="4804293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804296">case</span>&nbsp;<span class="num" id="4804301">32</span><span class="op" id="4804303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804307">return</span>&nbsp;<span class="builtintype" id="4804314">uint</span><span class="op" id="4804318">(</span><span class="ident" id="4804319">deBruijn32Lookup</span><span class="op" id="4804335">[</span><span class="op" id="4804336">(</span><span class="op" id="4804337">(</span><span class="ident" id="4804338">x</span><span class="op" id="4804339">&amp;</span><span class="op" id="4804340">-</span><span class="ident" id="4804341">x</span><span class="op" id="4804342">)</span><span class="op" id="4804343">*</span><span class="ident" id="4804344">deBruijn32</span><span class="op" id="4804354">)</span><span class="op" id="4804355">&gt;&gt;</span><span class="num" id="4804357">27</span><span class="op" id="4804359">]</span><span class="op" id="4804360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804363">case</span>&nbsp;<span class="num" id="4804368">64</span><span class="op" id="4804370">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804374">return</span>&nbsp;<span class="builtintype" id="4804381">uint</span><span class="op" id="4804385">(</span><span class="ident" id="4804386">deBruijn64Lookup</span><span class="op" id="4804402">[</span><span class="op" id="4804403">(</span><span class="op" id="4804404">(</span><span class="ident" id="4804405">x</span><span class="op" id="4804406">&amp;</span><span class="op" id="4804407">-</span><span class="ident" id="4804408">x</span><span class="op" id="4804409">)</span><span class="op" id="4804410">*</span><span class="op" id="4804411">(</span><span class="ident" id="4804412">deBruijn64</span><span class="op" id="4804422">&amp;</span><span class="ident" id="4804423">_M</span><span class="op" id="4804425">)</span><span class="op" id="4804426">)</span><span class="op" id="4804427">&gt;&gt;</span><span class="num" id="4804429">58</span><span class="op" id="4804431">]</span><span class="op" id="4804432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804435">default</span><span class="op" id="4804442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4804446">panic</span><span class="op" id="4804451">(</span><span class="string" id="4804452">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="4804471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804474">}</span><br>
<span class="lineno"></span><span class="op" id="4804476">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span><span class="comment" id="4804479">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="4804556">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4804570">func</span>&nbsp;<span class="op" id="4804575">(</span><span class="ident" id="4804576">x</span>&nbsp;<span class="ident" id="4804578">nat</span><span class="op" id="4804581">)</span>&nbsp;<span class="ident" id="4804583">trailingZeroBits</span><span class="op" id="4804599">(</span><span class="op" id="4804600">)</span>&nbsp;<span class="builtintype" id="4804602">uint</span>&nbsp;<span class="op" id="4804607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804610">if</span>&nbsp;<span class="builtinfunc" id="4804613">len</span><span class="op" id="4804616">(</span><span class="ident" id="4804617">x</span><span class="op" id="4804618">)</span>&nbsp;<span class="op" id="4804620">==</span>&nbsp;<span class="num" id="4804623">0</span>&nbsp;<span class="op" id="4804625">{</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804629">return</span>&nbsp;<span class="num" id="4804636">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804642">var</span>&nbsp;<span class="ident" id="4804646">i</span>&nbsp;<span class="builtintype" id="4804648">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804654">for</span>&nbsp;<span class="ident" id="4804658">x</span><span class="op" id="4804659">[</span><span class="ident" id="4804660">i</span><span class="op" id="4804661">]</span>&nbsp;<span class="op" id="4804663">==</span>&nbsp;<span class="num" id="4804666">0</span>&nbsp;<span class="op" id="4804668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804672">i</span><span class="op" id="4804673">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804680">//&nbsp;x[i]&nbsp;!=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804694">return</span>&nbsp;<span class="ident" id="4804701">i</span><span class="op" id="4804702">*</span><span class="ident" id="4804703">_W</span>&nbsp;<span class="op" id="4804706">+</span>&nbsp;<span class="ident" id="4804708">trailingZeroBits</span><span class="op" id="4804724">(</span><span class="ident" id="4804725">x</span><span class="op" id="4804726">[</span><span class="ident" id="4804727">i</span><span class="op" id="4804728">]</span><span class="op" id="4804729">)</span><br>
<span class="lineno"></span><span class="op" id="4804731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1040</span><span class="comment" id="4804734">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&lt;&lt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="4804748">func</span>&nbsp;<span class="op" id="4804753">(</span><span class="ident" id="4804754">z</span>&nbsp;<span class="ident" id="4804756">nat</span><span class="op" id="4804759">)</span>&nbsp;<span class="ident" id="4804761">shl</span><span class="op" id="4804764">(</span><span class="ident" id="4804765">x</span>&nbsp;<span class="ident" id="4804767">nat</span><span class="op" id="4804770">,</span>&nbsp;<span class="ident" id="4804772">s</span>&nbsp;<span class="builtintype" id="4804774">uint</span><span class="op" id="4804778">)</span>&nbsp;<span class="ident" id="4804780">nat</span>&nbsp;<span class="op" id="4804784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804787">m</span>&nbsp;<span class="op" id="4804789">:=</span>&nbsp;<span class="builtinfunc" id="4804792">len</span><span class="op" id="4804795">(</span><span class="ident" id="4804796">x</span><span class="op" id="4804797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804800">if</span>&nbsp;<span class="ident" id="4804803">m</span>&nbsp;<span class="op" id="4804805">==</span>&nbsp;<span class="num" id="4804808">0</span>&nbsp;<span class="op" id="4804810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804814">return</span>&nbsp;<span class="ident" id="4804821">z</span><span class="op" id="4804822">.</span><span class="builtinfunc" id="4804823">make</span><span class="op" id="4804827">(</span><span class="num" id="4804828">0</span><span class="op" id="4804829">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4804835">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804846">n</span>&nbsp;<span class="op" id="4804848">:=</span>&nbsp;<span class="ident" id="4804851">m</span>&nbsp;<span class="op" id="4804853">+</span>&nbsp;<span class="builtintype" id="4804855">int</span><span class="op" id="4804858">(</span><span class="ident" id="4804859">s</span><span class="op" id="4804860">/</span><span class="ident" id="4804861">_W</span><span class="op" id="4804863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804866">z</span>&nbsp;<span class="op" id="4804868">=</span>&nbsp;<span class="ident" id="4804870">z</span><span class="op" id="4804871">.</span><span class="builtinfunc" id="4804872">make</span><span class="op" id="4804876">(</span><span class="ident" id="4804877">n</span>&nbsp;<span class="op" id="4804879">+</span>&nbsp;<span class="num" id="4804881">1</span><span class="op" id="4804882">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804885">z</span><span class="op" id="4804886">[</span><span class="ident" id="4804887">n</span><span class="op" id="4804888">]</span>&nbsp;<span class="op" id="4804890">=</span>&nbsp;<span class="ident" id="4804892">shlVU</span><span class="op" id="4804897">(</span><span class="ident" id="4804898">z</span><span class="op" id="4804899">[</span><span class="ident" id="4804900">n</span><span class="op" id="4804901">-</span><span class="ident" id="4804902">m</span><span class="op" id="4804903">:</span><span class="ident" id="4804904">n</span><span class="op" id="4804905">]</span><span class="op" id="4804906">,</span>&nbsp;<span class="ident" id="4804908">x</span><span class="op" id="4804909">,</span>&nbsp;<span class="ident" id="4804911">s</span><span class="op" id="4804912">%</span><span class="ident" id="4804913">_W</span><span class="op" id="4804915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804918">z</span><span class="op" id="4804919">[</span><span class="num" id="4804920">0</span>&nbsp;<span class="op" id="4804922">:</span>&nbsp;<span class="ident" id="4804924">n</span><span class="op" id="4804925">-</span><span class="ident" id="4804926">m</span><span class="op" id="4804927">]</span><span class="op" id="4804928">.</span><span class="ident" id="4804929">clear</span><span class="op" id="4804934">(</span><span class="op" id="4804935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804939">return</span>&nbsp;<span class="ident" id="4804946">z</span><span class="op" id="4804947">.</span><span class="ident" id="4804948">norm</span><span class="op" id="4804952">(</span><span class="op" id="4804953">)</span><br>
<span class="lineno"></span><span class="op" id="4804955">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span><span class="comment" id="4804958">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&gt;&gt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="4804972">func</span>&nbsp;<span class="op" id="4804977">(</span><span class="ident" id="4804978">z</span>&nbsp;<span class="ident" id="4804980">nat</span><span class="op" id="4804983">)</span>&nbsp;<span class="ident" id="4804985">shr</span><span class="op" id="4804988">(</span><span class="ident" id="4804989">x</span>&nbsp;<span class="ident" id="4804991">nat</span><span class="op" id="4804994">,</span>&nbsp;<span class="ident" id="4804996">s</span>&nbsp;<span class="builtintype" id="4804998">uint</span><span class="op" id="4805002">)</span>&nbsp;<span class="ident" id="4805004">nat</span>&nbsp;<span class="op" id="4805008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805011">m</span>&nbsp;<span class="op" id="4805013">:=</span>&nbsp;<span class="builtinfunc" id="4805016">len</span><span class="op" id="4805019">(</span><span class="ident" id="4805020">x</span><span class="op" id="4805021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805024">n</span>&nbsp;<span class="op" id="4805026">:=</span>&nbsp;<span class="ident" id="4805029">m</span>&nbsp;<span class="op" id="4805031">-</span>&nbsp;<span class="builtintype" id="4805033">int</span><span class="op" id="4805036">(</span><span class="ident" id="4805037">s</span><span class="op" id="4805038">/</span><span class="ident" id="4805039">_W</span><span class="op" id="4805041">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805044">if</span>&nbsp;<span class="ident" id="4805047">n</span>&nbsp;<span class="op" id="4805049">&lt;=</span>&nbsp;<span class="num" id="4805052">0</span>&nbsp;<span class="op" id="4805054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805058">return</span>&nbsp;<span class="ident" id="4805065">z</span><span class="op" id="4805066">.</span><span class="builtinfunc" id="4805067">make</span><span class="op" id="4805071">(</span><span class="num" id="4805072">0</span><span class="op" id="4805073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4805079">//&nbsp;n&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805090">z</span>&nbsp;<span class="op" id="4805092">=</span>&nbsp;<span class="ident" id="4805094">z</span><span class="op" id="4805095">.</span><span class="builtinfunc" id="4805096">make</span><span class="op" id="4805100">(</span><span class="ident" id="4805101">n</span><span class="op" id="4805102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805105">shrVU</span><span class="op" id="4805110">(</span><span class="ident" id="4805111">z</span><span class="op" id="4805112">,</span>&nbsp;<span class="ident" id="4805114">x</span><span class="op" id="4805115">[</span><span class="ident" id="4805116">m</span><span class="op" id="4805117">-</span><span class="ident" id="4805118">n</span><span class="op" id="4805119">:</span><span class="op" id="4805120">]</span><span class="op" id="4805121">,</span>&nbsp;<span class="ident" id="4805123">s</span><span class="op" id="4805124">%</span><span class="ident" id="4805125">_W</span><span class="op" id="4805127">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805131">return</span>&nbsp;<span class="ident" id="4805138">z</span><span class="op" id="4805139">.</span><span class="ident" id="4805140">norm</span><span class="op" id="4805144">(</span><span class="op" id="4805145">)</span><br>
<span class="lineno"></span><span class="op" id="4805147">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="4805150">func</span>&nbsp;<span class="op" id="4805155">(</span><span class="ident" id="4805156">z</span>&nbsp;<span class="ident" id="4805158">nat</span><span class="op" id="4805161">)</span>&nbsp;<span class="ident" id="4805163">setBit</span><span class="op" id="4805169">(</span><span class="ident" id="4805170">x</span>&nbsp;<span class="ident" id="4805172">nat</span><span class="op" id="4805175">,</span>&nbsp;<span class="ident" id="4805177">i</span>&nbsp;<span class="builtintype" id="4805179">uint</span><span class="op" id="4805183">,</span>&nbsp;<span class="ident" id="4805185">b</span>&nbsp;<span class="builtintype" id="4805187">uint</span><span class="op" id="4805191">)</span>&nbsp;<span class="ident" id="4805193">nat</span>&nbsp;<span class="op" id="4805197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805200">j</span>&nbsp;<span class="op" id="4805202">:=</span>&nbsp;<span class="builtintype" id="4805205">int</span><span class="op" id="4805208">(</span><span class="ident" id="4805209">i</span>&nbsp;<span class="op" id="4805211">/</span>&nbsp;<span class="ident" id="4805213">_W</span><span class="op" id="4805215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805218">m</span>&nbsp;<span class="op" id="4805220">:=</span>&nbsp;<span class="ident" id="4805223">Word</span><span class="op" id="4805227">(</span><span class="num" id="4805228">1</span><span class="op" id="4805229">)</span>&nbsp;<span class="op" id="4805231">&lt;&lt;</span>&nbsp;<span class="op" id="4805234">(</span><span class="ident" id="4805235">i</span>&nbsp;<span class="op" id="4805237">%</span>&nbsp;<span class="ident" id="4805239">_W</span><span class="op" id="4805241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805244">n</span>&nbsp;<span class="op" id="4805246">:=</span>&nbsp;<span class="builtinfunc" id="4805249">len</span><span class="op" id="4805252">(</span><span class="ident" id="4805253">x</span><span class="op" id="4805254">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805257">switch</span>&nbsp;<span class="ident" id="4805264">b</span>&nbsp;<span class="op" id="4805266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805269">case</span>&nbsp;<span class="num" id="4805274">0</span><span class="op" id="4805275">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805279">z</span>&nbsp;<span class="op" id="4805281">=</span>&nbsp;<span class="ident" id="4805283">z</span><span class="op" id="4805284">.</span><span class="builtinfunc" id="4805285">make</span><span class="op" id="4805289">(</span><span class="ident" id="4805290">n</span><span class="op" id="4805291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4805295">copy</span><span class="op" id="4805299">(</span><span class="ident" id="4805300">z</span><span class="op" id="4805301">,</span>&nbsp;<span class="ident" id="4805303">x</span><span class="op" id="4805304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805308">if</span>&nbsp;<span class="ident" id="4805311">j</span>&nbsp;<span class="op" id="4805313">&gt;=</span>&nbsp;<span class="ident" id="4805316">n</span>&nbsp;<span class="op" id="4805318">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4805323">//&nbsp;no&nbsp;need&nbsp;to&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805345">return</span>&nbsp;<span class="ident" id="4805352">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805360">z</span><span class="op" id="4805361">[</span><span class="ident" id="4805362">j</span><span class="op" id="4805363">]</span>&nbsp;<span class="op" id="4805365">&amp;^=</span>&nbsp;<span class="ident" id="4805369">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805373">return</span>&nbsp;<span class="ident" id="4805380">z</span><span class="op" id="4805381">.</span><span class="ident" id="4805382">norm</span><span class="op" id="4805386">(</span><span class="op" id="4805387">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805390">case</span>&nbsp;<span class="num" id="4805395">1</span><span class="op" id="4805396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805400">if</span>&nbsp;<span class="ident" id="4805403">j</span>&nbsp;<span class="op" id="4805405">&gt;=</span>&nbsp;<span class="ident" id="4805408">n</span>&nbsp;<span class="op" id="4805410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805415">z</span>&nbsp;<span class="op" id="4805417">=</span>&nbsp;<span class="ident" id="4805419">z</span><span class="op" id="4805420">.</span><span class="builtinfunc" id="4805421">make</span><span class="op" id="4805425">(</span><span class="ident" id="4805426">j</span>&nbsp;<span class="op" id="4805428">+</span>&nbsp;<span class="num" id="4805430">1</span><span class="op" id="4805431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805436">z</span><span class="op" id="4805437">[</span><span class="ident" id="4805438">n</span><span class="op" id="4805439">:</span><span class="op" id="4805440">]</span><span class="op" id="4805441">.</span><span class="ident" id="4805442">clear</span><span class="op" id="4805447">(</span><span class="op" id="4805448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805452">}</span>&nbsp;<span class="keyword" id="4805454">else</span>&nbsp;<span class="op" id="4805459">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805464">z</span>&nbsp;<span class="op" id="4805466">=</span>&nbsp;<span class="ident" id="4805468">z</span><span class="op" id="4805469">.</span><span class="builtinfunc" id="4805470">make</span><span class="op" id="4805474">(</span><span class="ident" id="4805475">n</span><span class="op" id="4805476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4805484">copy</span><span class="op" id="4805488">(</span><span class="ident" id="4805489">z</span><span class="op" id="4805490">,</span>&nbsp;<span class="ident" id="4805492">x</span><span class="op" id="4805493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805497">z</span><span class="op" id="4805498">[</span><span class="ident" id="4805499">j</span><span class="op" id="4805500">]</span>&nbsp;<span class="op" id="4805502">|=</span>&nbsp;<span class="ident" id="4805505">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4805509">//&nbsp;no&nbsp;need&nbsp;to&nbsp;normalize</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805535">return</span>&nbsp;<span class="ident" id="4805542">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4805548">panic</span><span class="op" id="4805553">(</span><span class="string" id="4805554">&#34;set&nbsp;bit&nbsp;is&nbsp;not&nbsp;0&nbsp;or&nbsp;1&#34;</span><span class="op" id="4805577">)</span><br>
<span class="lineno"></span><span class="op" id="4805579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1100</span><span class="keyword" id="4805582">func</span>&nbsp;<span class="op" id="4805587">(</span><span class="ident" id="4805588">z</span>&nbsp;<span class="ident" id="4805590">nat</span><span class="op" id="4805593">)</span>&nbsp;<span class="ident" id="4805595">bit</span><span class="op" id="4805598">(</span><span class="ident" id="4805599">i</span>&nbsp;<span class="builtintype" id="4805601">uint</span><span class="op" id="4805605">)</span>&nbsp;<span class="builtintype" id="4805607">uint</span>&nbsp;<span class="op" id="4805612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805615">j</span>&nbsp;<span class="op" id="4805617">:=</span>&nbsp;<span class="builtintype" id="4805620">int</span><span class="op" id="4805623">(</span><span class="ident" id="4805624">i</span>&nbsp;<span class="op" id="4805626">/</span>&nbsp;<span class="ident" id="4805628">_W</span><span class="op" id="4805630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805633">if</span>&nbsp;<span class="ident" id="4805636">j</span>&nbsp;<span class="op" id="4805638">&gt;=</span>&nbsp;<span class="builtinfunc" id="4805641">len</span><span class="op" id="4805644">(</span><span class="ident" id="4805645">z</span><span class="op" id="4805646">)</span>&nbsp;<span class="op" id="4805648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805652">return</span>&nbsp;<span class="num" id="4805659">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805662">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805665">return</span>&nbsp;<span class="builtintype" id="4805672">uint</span><span class="op" id="4805676">(</span><span class="ident" id="4805677">z</span><span class="op" id="4805678">[</span><span class="ident" id="4805679">j</span><span class="op" id="4805680">]</span>&nbsp;<span class="op" id="4805682">&gt;&gt;</span>&nbsp;<span class="op" id="4805685">(</span><span class="ident" id="4805686">i</span>&nbsp;<span class="op" id="4805688">%</span>&nbsp;<span class="ident" id="4805690">_W</span><span class="op" id="4805692">)</span>&nbsp;<span class="op" id="4805694">&amp;</span>&nbsp;<span class="num" id="4805696">1</span><span class="op" id="4805697">)</span><br>
<span class="lineno"></span><span class="op" id="4805699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4805702">func</span>&nbsp;<span class="op" id="4805707">(</span><span class="ident" id="4805708">z</span>&nbsp;<span class="ident" id="4805710">nat</span><span class="op" id="4805713">)</span>&nbsp;<span class="ident" id="4805715">and</span><span class="op" id="4805718">(</span><span class="ident" id="4805719">x</span><span class="op" id="4805720">,</span>&nbsp;<span class="ident" id="4805722">y</span>&nbsp;<span class="ident" id="4805724">nat</span><span class="op" id="4805727">)</span>&nbsp;<span class="ident" id="4805729">nat</span>&nbsp;<span class="op" id="4805733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805736">m</span>&nbsp;<span class="op" id="4805738">:=</span>&nbsp;<span class="builtinfunc" id="4805741">len</span><span class="op" id="4805744">(</span><span class="ident" id="4805745">x</span><span class="op" id="4805746">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805749">n</span>&nbsp;<span class="op" id="4805751">:=</span>&nbsp;<span class="builtinfunc" id="4805754">len</span><span class="op" id="4805757">(</span><span class="ident" id="4805758">y</span><span class="op" id="4805759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805762">if</span>&nbsp;<span class="ident" id="4805765">m</span>&nbsp;<span class="op" id="4805767">&gt;</span>&nbsp;<span class="ident" id="4805769">n</span>&nbsp;<span class="op" id="4805771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805775">m</span>&nbsp;<span class="op" id="4805777">=</span>&nbsp;<span class="ident" id="4805779">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4805785">//&nbsp;m&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805797">z</span>&nbsp;<span class="op" id="4805799">=</span>&nbsp;<span class="ident" id="4805801">z</span><span class="op" id="4805802">.</span><span class="builtinfunc" id="4805803">make</span><span class="op" id="4805807">(</span><span class="ident" id="4805808">m</span><span class="op" id="4805809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805812">for</span>&nbsp;<span class="ident" id="4805816">i</span>&nbsp;<span class="op" id="4805818">:=</span>&nbsp;<span class="num" id="4805821">0</span><span class="op" id="4805822">;</span>&nbsp;<span class="ident" id="4805824">i</span>&nbsp;<span class="op" id="4805826">&lt;</span>&nbsp;<span class="ident" id="4805828">m</span><span class="op" id="4805829">;</span>&nbsp;<span class="ident" id="4805831">i</span><span class="op" id="4805832">++</span>&nbsp;<span class="op" id="4805835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805839">z</span><span class="op" id="4805840">[</span><span class="ident" id="4805841">i</span><span class="op" id="4805842">]</span>&nbsp;<span class="op" id="4805844">=</span>&nbsp;<span class="ident" id="4805846">x</span><span class="op" id="4805847">[</span><span class="ident" id="4805848">i</span><span class="op" id="4805849">]</span>&nbsp;<span class="op" id="4805851">&amp;</span>&nbsp;<span class="ident" id="4805853">y</span><span class="op" id="4805854">[</span><span class="ident" id="4805855">i</span><span class="op" id="4805856">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805859">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805863">return</span>&nbsp;<span class="ident" id="4805870">z</span><span class="op" id="4805871">.</span><span class="ident" id="4805872">norm</span><span class="op" id="4805876">(</span><span class="op" id="4805877">)</span><br>
<span class="lineno"></span><span class="op" id="4805879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4805882">func</span>&nbsp;<span class="op" id="4805887">(</span><span class="ident" id="4805888">z</span>&nbsp;<span class="ident" id="4805890">nat</span><span class="op" id="4805893">)</span>&nbsp;<span class="ident" id="4805895">andNot</span><span class="op" id="4805901">(</span><span class="ident" id="4805902">x</span><span class="op" id="4805903">,</span>&nbsp;<span class="ident" id="4805905">y</span>&nbsp;<span class="ident" id="4805907">nat</span><span class="op" id="4805910">)</span>&nbsp;<span class="ident" id="4805912">nat</span>&nbsp;<span class="op" id="4805916">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805919">m</span>&nbsp;<span class="op" id="4805921">:=</span>&nbsp;<span class="builtinfunc" id="4805924">len</span><span class="op" id="4805927">(</span><span class="ident" id="4805928">x</span><span class="op" id="4805929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805932">n</span>&nbsp;<span class="op" id="4805934">:=</span>&nbsp;<span class="builtinfunc" id="4805937">len</span><span class="op" id="4805940">(</span><span class="ident" id="4805941">y</span><span class="op" id="4805942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805945">if</span>&nbsp;<span class="ident" id="4805948">n</span>&nbsp;<span class="op" id="4805950">&gt;</span>&nbsp;<span class="ident" id="4805952">m</span>&nbsp;<span class="op" id="4805954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805958">n</span>&nbsp;<span class="op" id="4805960">=</span>&nbsp;<span class="ident" id="4805962">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805965">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4805968">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805980">z</span>&nbsp;<span class="op" id="4805982">=</span>&nbsp;<span class="ident" id="4805984">z</span><span class="op" id="4805985">.</span><span class="builtinfunc" id="4805986">make</span><span class="op" id="4805990">(</span><span class="ident" id="4805991">m</span><span class="op" id="4805992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805995">for</span>&nbsp;<span class="ident" id="4805999">i</span>&nbsp;<span class="op" id="4806001">:=</span>&nbsp;<span class="num" id="4806004">0</span><span class="op" id="4806005">;</span>&nbsp;<span class="ident" id="4806007">i</span>&nbsp;<span class="op" id="4806009">&lt;</span>&nbsp;<span class="ident" id="4806011">n</span><span class="op" id="4806012">;</span>&nbsp;<span class="ident" id="4806014">i</span><span class="op" id="4806015">++</span>&nbsp;<span class="op" id="4806018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806022">z</span><span class="op" id="4806023">[</span><span class="ident" id="4806024">i</span><span class="op" id="4806025">]</span>&nbsp;<span class="op" id="4806027">=</span>&nbsp;<span class="ident" id="4806029">x</span><span class="op" id="4806030">[</span><span class="ident" id="4806031">i</span><span class="op" id="4806032">]</span>&nbsp;<span class="op" id="4806034">&amp;^</span>&nbsp;<span class="ident" id="4806037">y</span><span class="op" id="4806038">[</span><span class="ident" id="4806039">i</span><span class="op" id="4806040">]</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4806046">copy</span><span class="op" id="4806050">(</span><span class="ident" id="4806051">z</span><span class="op" id="4806052">[</span><span class="ident" id="4806053">n</span><span class="op" id="4806054">:</span><span class="ident" id="4806055">m</span><span class="op" id="4806056">]</span><span class="op" id="4806057">,</span>&nbsp;<span class="ident" id="4806059">x</span><span class="op" id="4806060">[</span><span class="ident" id="4806061">n</span><span class="op" id="4806062">:</span><span class="ident" id="4806063">m</span><span class="op" id="4806064">]</span><span class="op" id="4806065">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806069">return</span>&nbsp;<span class="ident" id="4806076">z</span><span class="op" id="4806077">.</span><span class="ident" id="4806078">norm</span><span class="op" id="4806082">(</span><span class="op" id="4806083">)</span><br>
<span class="lineno"></span><span class="op" id="4806085">}</span><br>
<span class="lineno">1140</span><br>
<span class="lineno"></span><span class="keyword" id="4806088">func</span>&nbsp;<span class="op" id="4806093">(</span><span class="ident" id="4806094">z</span>&nbsp;<span class="ident" id="4806096">nat</span><span class="op" id="4806099">)</span>&nbsp;<span class="ident" id="4806101">or</span><span class="op" id="4806103">(</span><span class="ident" id="4806104">x</span><span class="op" id="4806105">,</span>&nbsp;<span class="ident" id="4806107">y</span>&nbsp;<span class="ident" id="4806109">nat</span><span class="op" id="4806112">)</span>&nbsp;<span class="ident" id="4806114">nat</span>&nbsp;<span class="op" id="4806118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806121">m</span>&nbsp;<span class="op" id="4806123">:=</span>&nbsp;<span class="builtinfunc" id="4806126">len</span><span class="op" id="4806129">(</span><span class="ident" id="4806130">x</span><span class="op" id="4806131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806134">n</span>&nbsp;<span class="op" id="4806136">:=</span>&nbsp;<span class="builtinfunc" id="4806139">len</span><span class="op" id="4806142">(</span><span class="ident" id="4806143">y</span><span class="op" id="4806144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806147">s</span>&nbsp;<span class="op" id="4806149">:=</span>&nbsp;<span class="ident" id="4806152">x</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806155">if</span>&nbsp;<span class="ident" id="4806158">m</span>&nbsp;<span class="op" id="4806160">&lt;</span>&nbsp;<span class="ident" id="4806162">n</span>&nbsp;<span class="op" id="4806164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806168">n</span><span class="op" id="4806169">,</span>&nbsp;<span class="ident" id="4806171">m</span>&nbsp;<span class="op" id="4806173">=</span>&nbsp;<span class="ident" id="4806175">m</span><span class="op" id="4806176">,</span>&nbsp;<span class="ident" id="4806178">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806182">s</span>&nbsp;<span class="op" id="4806184">=</span>&nbsp;<span class="ident" id="4806186">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4806192">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno">1150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806204">z</span>&nbsp;<span class="op" id="4806206">=</span>&nbsp;<span class="ident" id="4806208">z</span><span class="op" id="4806209">.</span><span class="builtinfunc" id="4806210">make</span><span class="op" id="4806214">(</span><span class="ident" id="4806215">m</span><span class="op" id="4806216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806219">for</span>&nbsp;<span class="ident" id="4806223">i</span>&nbsp;<span class="op" id="4806225">:=</span>&nbsp;<span class="num" id="4806228">0</span><span class="op" id="4806229">;</span>&nbsp;<span class="ident" id="4806231">i</span>&nbsp;<span class="op" id="4806233">&lt;</span>&nbsp;<span class="ident" id="4806235">n</span><span class="op" id="4806236">;</span>&nbsp;<span class="ident" id="4806238">i</span><span class="op" id="4806239">++</span>&nbsp;<span class="op" id="4806242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806246">z</span><span class="op" id="4806247">[</span><span class="ident" id="4806248">i</span><span class="op" id="4806249">]</span>&nbsp;<span class="op" id="4806251">=</span>&nbsp;<span class="ident" id="4806253">x</span><span class="op" id="4806254">[</span><span class="ident" id="4806255">i</span><span class="op" id="4806256">]</span>&nbsp;<span class="op" id="4806258">|</span>&nbsp;<span class="ident" id="4806260">y</span><span class="op" id="4806261">[</span><span class="ident" id="4806262">i</span><span class="op" id="4806263">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806266">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4806269">copy</span><span class="op" id="4806273">(</span><span class="ident" id="4806274">z</span><span class="op" id="4806275">[</span><span class="ident" id="4806276">n</span><span class="op" id="4806277">:</span><span class="ident" id="4806278">m</span><span class="op" id="4806279">]</span><span class="op" id="4806280">,</span>&nbsp;<span class="ident" id="4806282">s</span><span class="op" id="4806283">[</span><span class="ident" id="4806284">n</span><span class="op" id="4806285">:</span><span class="ident" id="4806286">m</span><span class="op" id="4806287">]</span><span class="op" id="4806288">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806292">return</span>&nbsp;<span class="ident" id="4806299">z</span><span class="op" id="4806300">.</span><span class="ident" id="4806301">norm</span><span class="op" id="4806305">(</span><span class="op" id="4806306">)</span><br>
<span class="lineno"></span><span class="op" id="4806308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="keyword" id="4806311">func</span>&nbsp;<span class="op" id="4806316">(</span><span class="ident" id="4806317">z</span>&nbsp;<span class="ident" id="4806319">nat</span><span class="op" id="4806322">)</span>&nbsp;<span class="ident" id="4806324">xor</span><span class="op" id="4806327">(</span><span class="ident" id="4806328">x</span><span class="op" id="4806329">,</span>&nbsp;<span class="ident" id="4806331">y</span>&nbsp;<span class="ident" id="4806333">nat</span><span class="op" id="4806336">)</span>&nbsp;<span class="ident" id="4806338">nat</span>&nbsp;<span class="op" id="4806342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806345">m</span>&nbsp;<span class="op" id="4806347">:=</span>&nbsp;<span class="builtinfunc" id="4806350">len</span><span class="op" id="4806353">(</span><span class="ident" id="4806354">x</span><span class="op" id="4806355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806358">n</span>&nbsp;<span class="op" id="4806360">:=</span>&nbsp;<span class="builtinfunc" id="4806363">len</span><span class="op" id="4806366">(</span><span class="ident" id="4806367">y</span><span class="op" id="4806368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806371">s</span>&nbsp;<span class="op" id="4806373">:=</span>&nbsp;<span class="ident" id="4806376">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806379">if</span>&nbsp;<span class="ident" id="4806382">m</span>&nbsp;<span class="op" id="4806384">&lt;</span>&nbsp;<span class="ident" id="4806386">n</span>&nbsp;<span class="op" id="4806388">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806392">n</span><span class="op" id="4806393">,</span>&nbsp;<span class="ident" id="4806395">m</span>&nbsp;<span class="op" id="4806397">=</span>&nbsp;<span class="ident" id="4806399">m</span><span class="op" id="4806400">,</span>&nbsp;<span class="ident" id="4806402">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806406">s</span>&nbsp;<span class="op" id="4806408">=</span>&nbsp;<span class="ident" id="4806410">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4806416">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806428">z</span>&nbsp;<span class="op" id="4806430">=</span>&nbsp;<span class="ident" id="4806432">z</span><span class="op" id="4806433">.</span><span class="builtinfunc" id="4806434">make</span><span class="op" id="4806438">(</span><span class="ident" id="4806439">m</span><span class="op" id="4806440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806443">for</span>&nbsp;<span class="ident" id="4806447">i</span>&nbsp;<span class="op" id="4806449">:=</span>&nbsp;<span class="num" id="4806452">0</span><span class="op" id="4806453">;</span>&nbsp;<span class="ident" id="4806455">i</span>&nbsp;<span class="op" id="4806457">&lt;</span>&nbsp;<span class="ident" id="4806459">n</span><span class="op" id="4806460">;</span>&nbsp;<span class="ident" id="4806462">i</span><span class="op" id="4806463">++</span>&nbsp;<span class="op" id="4806466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806470">z</span><span class="op" id="4806471">[</span><span class="ident" id="4806472">i</span><span class="op" id="4806473">]</span>&nbsp;<span class="op" id="4806475">=</span>&nbsp;<span class="ident" id="4806477">x</span><span class="op" id="4806478">[</span><span class="ident" id="4806479">i</span><span class="op" id="4806480">]</span>&nbsp;<span class="op" id="4806482">^</span>&nbsp;<span class="ident" id="4806484">y</span><span class="op" id="4806485">[</span><span class="ident" id="4806486">i</span><span class="op" id="4806487">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4806493">copy</span><span class="op" id="4806497">(</span><span class="ident" id="4806498">z</span><span class="op" id="4806499">[</span><span class="ident" id="4806500">n</span><span class="op" id="4806501">:</span><span class="ident" id="4806502">m</span><span class="op" id="4806503">]</span><span class="op" id="4806504">,</span>&nbsp;<span class="ident" id="4806506">s</span><span class="op" id="4806507">[</span><span class="ident" id="4806508">n</span><span class="op" id="4806509">:</span><span class="ident" id="4806510">m</span><span class="op" id="4806511">]</span><span class="op" id="4806512">)</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806516">return</span>&nbsp;<span class="ident" id="4806523">z</span><span class="op" id="4806524">.</span><span class="ident" id="4806525">norm</span><span class="op" id="4806529">(</span><span class="op" id="4806530">)</span><br>
<span class="lineno"></span><span class="op" id="4806532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4806535">//&nbsp;greaterThan&nbsp;returns&nbsp;true&nbsp;iff&nbsp;(x1&lt;&lt;_W&nbsp;+&nbsp;x2)&nbsp;&gt;&nbsp;(y1&lt;&lt;_W&nbsp;+&nbsp;y2)</span><br>
<span class="lineno">1180</span><span class="keyword" id="4806597">func</span>&nbsp;<span class="ident" id="4806602">greaterThan</span><span class="op" id="4806613">(</span><span class="ident" id="4806614">x1</span><span class="op" id="4806616">,</span>&nbsp;<span class="ident" id="4806618">x2</span><span class="op" id="4806620">,</span>&nbsp;<span class="ident" id="4806622">y1</span><span class="op" id="4806624">,</span>&nbsp;<span class="ident" id="4806626">y2</span>&nbsp;<span class="ident" id="4806629">Word</span><span class="op" id="4806633">)</span>&nbsp;<span class="builtintype" id="4806635">bool</span>&nbsp;<span class="op" id="4806640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806643">return</span>&nbsp;<span class="ident" id="4806650">x1</span>&nbsp;<span class="op" id="4806653">&gt;</span>&nbsp;<span class="ident" id="4806655">y1</span>&nbsp;<span class="op" id="4806658">||</span>&nbsp;<span class="ident" id="4806661">x1</span>&nbsp;<span class="op" id="4806664">==</span>&nbsp;<span class="ident" id="4806667">y1</span>&nbsp;<span class="op" id="4806670">&amp;&amp;</span>&nbsp;<span class="ident" id="4806673">x2</span>&nbsp;<span class="op" id="4806676">&gt;</span>&nbsp;<span class="ident" id="4806678">y2</span><br>
<span class="lineno"></span><span class="op" id="4806681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4806684">//&nbsp;modW&nbsp;returns&nbsp;x&nbsp;%&nbsp;d.</span><br>
<span class="lineno">1185</span><span class="keyword" id="4806707">func</span>&nbsp;<span class="op" id="4806712">(</span><span class="ident" id="4806713">x</span>&nbsp;<span class="ident" id="4806715">nat</span><span class="op" id="4806718">)</span>&nbsp;<span class="ident" id="4806720">modW</span><span class="op" id="4806724">(</span><span class="ident" id="4806725">d</span>&nbsp;<span class="ident" id="4806727">Word</span><span class="op" id="4806731">)</span>&nbsp;<span class="op" id="4806733">(</span><span class="ident" id="4806734">r</span>&nbsp;<span class="ident" id="4806736">Word</span><span class="op" id="4806740">)</span>&nbsp;<span class="op" id="4806742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4806745">//&nbsp;TODO(agl):&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;q&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806805">var</span>&nbsp;<span class="ident" id="4806809">q</span>&nbsp;<span class="ident" id="4806811">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806816">q</span>&nbsp;<span class="op" id="4806818">=</span>&nbsp;<span class="ident" id="4806820">q</span><span class="op" id="4806821">.</span><span class="builtinfunc" id="4806822">make</span><span class="op" id="4806826">(</span><span class="builtinfunc" id="4806827">len</span><span class="op" id="4806830">(</span><span class="ident" id="4806831">x</span><span class="op" id="4806832">)</span><span class="op" id="4806833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806836">return</span>&nbsp;<span class="ident" id="4806843">divWVW</span><span class="op" id="4806849">(</span><span class="ident" id="4806850">q</span><span class="op" id="4806851">,</span>&nbsp;<span class="num" id="4806853">0</span><span class="op" id="4806854">,</span>&nbsp;<span class="ident" id="4806856">x</span><span class="op" id="4806857">,</span>&nbsp;<span class="ident" id="4806859">d</span><span class="op" id="4806860">)</span><br>
<span class="lineno">1190</span><span class="op" id="4806862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4806865">//&nbsp;random&nbsp;creates&nbsp;a&nbsp;random&nbsp;integer&nbsp;in&nbsp;[0..limit),&nbsp;using&nbsp;the&nbsp;space&nbsp;in&nbsp;z&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4806939">//&nbsp;possible.&nbsp;n&nbsp;is&nbsp;the&nbsp;bit&nbsp;length&nbsp;of&nbsp;limit.</span><br>
<span class="lineno"></span><span class="keyword" id="4806982">func</span>&nbsp;<span class="op" id="4806987">(</span><span class="ident" id="4806988">z</span>&nbsp;<span class="ident" id="4806990">nat</span><span class="op" id="4806993">)</span>&nbsp;<span class="ident" id="4806995">random</span><span class="op" id="4807001">(</span><span class="ident" id="4807002">rand</span>&nbsp;<span class="op" id="4807007">*</span><span class="ident" id="4807008">rand</span><span class="op" id="4807012">.</span><span class="ident" id="4807013">Rand</span><span class="op" id="4807017">,</span>&nbsp;<span class="ident" id="4807019">limit</span>&nbsp;<span class="ident" id="4807025">nat</span><span class="op" id="4807028">,</span>&nbsp;<span class="ident" id="4807030">n</span>&nbsp;<span class="builtintype" id="4807032">int</span><span class="op" id="4807035">)</span>&nbsp;<span class="ident" id="4807037">nat</span>&nbsp;<span class="op" id="4807041">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807044">if</span>&nbsp;<span class="ident" id="4807047">alias</span><span class="op" id="4807052">(</span><span class="ident" id="4807053">z</span><span class="op" id="4807054">,</span>&nbsp;<span class="ident" id="4807056">limit</span><span class="op" id="4807061">)</span>&nbsp;<span class="op" id="4807063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807067">z</span>&nbsp;<span class="op" id="4807069">=</span>&nbsp;<span class="ident" id="4807071">nil</span>&nbsp;<span class="comment" id="4807075">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;limit&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807121">z</span>&nbsp;<span class="op" id="4807123">=</span>&nbsp;<span class="ident" id="4807125">z</span><span class="op" id="4807126">.</span><span class="builtinfunc" id="4807127">make</span><span class="op" id="4807131">(</span><span class="builtinfunc" id="4807132">len</span><span class="op" id="4807135">(</span><span class="ident" id="4807136">limit</span><span class="op" id="4807141">)</span><span class="op" id="4807142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807146">bitLengthOfMSW</span>&nbsp;<span class="op" id="4807161">:=</span>&nbsp;<span class="builtintype" id="4807164">uint</span><span class="op" id="4807168">(</span><span class="ident" id="4807169">n</span>&nbsp;<span class="op" id="4807171">%</span>&nbsp;<span class="ident" id="4807173">_W</span><span class="op" id="4807175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807178">if</span>&nbsp;<span class="ident" id="4807181">bitLengthOfMSW</span>&nbsp;<span class="op" id="4807196">==</span>&nbsp;<span class="num" id="4807199">0</span>&nbsp;<span class="op" id="4807201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807205">bitLengthOfMSW</span>&nbsp;<span class="op" id="4807220">=</span>&nbsp;<span class="ident" id="4807222">_W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807229">mask</span>&nbsp;<span class="op" id="4807234">:=</span>&nbsp;<span class="ident" id="4807237">Word</span><span class="op" id="4807241">(</span><span class="op" id="4807242">(</span><span class="num" id="4807243">1</span>&nbsp;<span class="op" id="4807245">&lt;&lt;</span>&nbsp;<span class="ident" id="4807248">bitLengthOfMSW</span><span class="op" id="4807262">)</span>&nbsp;<span class="op" id="4807264">-</span>&nbsp;<span class="num" id="4807266">1</span><span class="op" id="4807267">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807271">for</span>&nbsp;<span class="op" id="4807275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807279">switch</span>&nbsp;<span class="ident" id="4807286">_W</span>&nbsp;<span class="op" id="4807289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807293">case</span>&nbsp;<span class="num" id="4807298">32</span><span class="op" id="4807300">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807305">for</span>&nbsp;<span class="ident" id="4807309">i</span>&nbsp;<span class="op" id="4807311">:=</span>&nbsp;<span class="keyword" id="4807314">range</span>&nbsp;<span class="ident" id="4807320">z</span>&nbsp;<span class="op" id="4807322">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807328">z</span><span class="op" id="4807329">[</span><span class="ident" id="4807330">i</span><span class="op" id="4807331">]</span>&nbsp;<span class="op" id="4807333">=</span>&nbsp;<span class="ident" id="4807335">Word</span><span class="op" id="4807339">(</span><span class="ident" id="4807340">rand</span><span class="op" id="4807344">.</span><span class="ident" id="4807345">Uint32</span><span class="op" id="4807351">(</span><span class="op" id="4807352">)</span><span class="op" id="4807353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807362">case</span>&nbsp;<span class="num" id="4807367">64</span><span class="op" id="4807369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807374">for</span>&nbsp;<span class="ident" id="4807378">i</span>&nbsp;<span class="op" id="4807380">:=</span>&nbsp;<span class="keyword" id="4807383">range</span>&nbsp;<span class="ident" id="4807389">z</span>&nbsp;<span class="op" id="4807391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807397">z</span><span class="op" id="4807398">[</span><span class="ident" id="4807399">i</span><span class="op" id="4807400">]</span>&nbsp;<span class="op" id="4807402">=</span>&nbsp;<span class="ident" id="4807404">Word</span><span class="op" id="4807408">(</span><span class="ident" id="4807409">rand</span><span class="op" id="4807413">.</span><span class="ident" id="4807414">Uint32</span><span class="op" id="4807420">(</span><span class="op" id="4807421">)</span><span class="op" id="4807422">)</span>&nbsp;<span class="op" id="4807424">|</span>&nbsp;<span class="ident" id="4807426">Word</span><span class="op" id="4807430">(</span><span class="ident" id="4807431">rand</span><span class="op" id="4807435">.</span><span class="ident" id="4807436">Uint32</span><span class="op" id="4807442">(</span><span class="op" id="4807443">)</span><span class="op" id="4807444">)</span><span class="op" id="4807445">&lt;&lt;</span><span class="num" id="4807447">32</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807457">default</span><span class="op" id="4807464">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4807469">panic</span><span class="op" id="4807474">(</span><span class="string" id="4807475">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="4807494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807502">z</span><span class="op" id="4807503">[</span><span class="builtinfunc" id="4807504">len</span><span class="op" id="4807507">(</span><span class="ident" id="4807508">limit</span><span class="op" id="4807513">)</span><span class="op" id="4807514">-</span><span class="num" id="4807515">1</span><span class="op" id="4807516">]</span>&nbsp;<span class="op" id="4807518">&amp;=</span>&nbsp;<span class="ident" id="4807521">mask</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807528">if</span>&nbsp;<span class="ident" id="4807531">z</span><span class="op" id="4807532">.</span><span class="ident" id="4807533">cmp</span><span class="op" id="4807536">(</span><span class="ident" id="4807537">limit</span><span class="op" id="4807542">)</span>&nbsp;<span class="op" id="4807544">&lt;</span>&nbsp;<span class="num" id="4807546">0</span>&nbsp;<span class="op" id="4807548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807553">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807568">return</span>&nbsp;<span class="ident" id="4807575">z</span><span class="op" id="4807576">.</span><span class="ident" id="4807577">norm</span><span class="op" id="4807581">(</span><span class="op" id="4807582">)</span><br>
<span class="lineno"></span><span class="op" id="4807584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4807587">//&nbsp;If&nbsp;m&nbsp;!=&nbsp;0&nbsp;(i.e.,&nbsp;len(m)&nbsp;!=&nbsp;0),&nbsp;expNN&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y&nbsp;mod&nbsp;m;</span><br>
<span class="lineno"></span><span class="comment" id="4807649">//&nbsp;otherwise&nbsp;it&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y.&nbsp;The&nbsp;result&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;z.</span><br>
<span class="lineno">1230</span><span class="keyword" id="4807711">func</span>&nbsp;<span class="op" id="4807716">(</span><span class="ident" id="4807717">z</span>&nbsp;<span class="ident" id="4807719">nat</span><span class="op" id="4807722">)</span>&nbsp;<span class="ident" id="4807724">expNN</span><span class="op" id="4807729">(</span><span class="ident" id="4807730">x</span><span class="op" id="4807731">,</span>&nbsp;<span class="ident" id="4807733">y</span><span class="op" id="4807734">,</span>&nbsp;<span class="ident" id="4807736">m</span>&nbsp;<span class="ident" id="4807738">nat</span><span class="op" id="4807741">)</span>&nbsp;<span class="ident" id="4807743">nat</span>&nbsp;<span class="op" id="4807747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807750">if</span>&nbsp;<span class="ident" id="4807753">alias</span><span class="op" id="4807758">(</span><span class="ident" id="4807759">z</span><span class="op" id="4807760">,</span>&nbsp;<span class="ident" id="4807762">x</span><span class="op" id="4807763">)</span>&nbsp;<span class="op" id="4807765">||</span>&nbsp;<span class="ident" id="4807768">alias</span><span class="op" id="4807773">(</span><span class="ident" id="4807774">z</span><span class="op" id="4807775">,</span>&nbsp;<span class="ident" id="4807777">y</span><span class="op" id="4807778">)</span>&nbsp;<span class="op" id="4807780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4807784">//&nbsp;We&nbsp;cannot&nbsp;allow&nbsp;in-place&nbsp;modification&nbsp;of&nbsp;x&nbsp;or&nbsp;y.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807838">z</span>&nbsp;<span class="op" id="4807840">=</span>&nbsp;<span class="ident" id="4807842">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807847">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4807851">//&nbsp;x**y&nbsp;mod&nbsp;1&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807871">if</span>&nbsp;<span class="builtinfunc" id="4807874">len</span><span class="op" id="4807877">(</span><span class="ident" id="4807878">m</span><span class="op" id="4807879">)</span>&nbsp;<span class="op" id="4807881">==</span>&nbsp;<span class="num" id="4807884">1</span>&nbsp;<span class="op" id="4807886">&amp;&amp;</span>&nbsp;<span class="ident" id="4807889">m</span><span class="op" id="4807890">[</span><span class="num" id="4807891">0</span><span class="op" id="4807892">]</span>&nbsp;<span class="op" id="4807894">==</span>&nbsp;<span class="num" id="4807897">1</span>&nbsp;<span class="op" id="4807899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807903">return</span>&nbsp;<span class="ident" id="4807910">z</span><span class="op" id="4807911">.</span><span class="ident" id="4807912">setWord</span><span class="op" id="4807919">(</span><span class="num" id="4807920">0</span><span class="op" id="4807921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807924">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4807927">//&nbsp;m&nbsp;==&nbsp;0&nbsp;||&nbsp;m&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4807948">//&nbsp;x**0&nbsp;==&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807962">if</span>&nbsp;<span class="builtinfunc" id="4807965">len</span><span class="op" id="4807968">(</span><span class="ident" id="4807969">y</span><span class="op" id="4807970">)</span>&nbsp;<span class="op" id="4807972">==</span>&nbsp;<span class="num" id="4807975">0</span>&nbsp;<span class="op" id="4807977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807981">return</span>&nbsp;<span class="ident" id="4807988">z</span><span class="op" id="4807989">.</span><span class="ident" id="4807990">setWord</span><span class="op" id="4807997">(</span><span class="num" id="4807998">1</span><span class="op" id="4807999">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808005">//&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808016">if</span>&nbsp;<span class="builtinfunc" id="4808019">len</span><span class="op" id="4808022">(</span><span class="ident" id="4808023">m</span><span class="op" id="4808024">)</span>&nbsp;<span class="op" id="4808026">!=</span>&nbsp;<span class="num" id="4808029">0</span>&nbsp;<span class="op" id="4808031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808035">//&nbsp;We&nbsp;likely&nbsp;end&nbsp;up&nbsp;being&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;modulus.</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808087">z</span>&nbsp;<span class="op" id="4808089">=</span>&nbsp;<span class="ident" id="4808091">z</span><span class="op" id="4808092">.</span><span class="builtinfunc" id="4808093">make</span><span class="op" id="4808097">(</span><span class="builtinfunc" id="4808098">len</span><span class="op" id="4808101">(</span><span class="ident" id="4808102">m</span><span class="op" id="4808103">)</span><span class="op" id="4808104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808110">z</span>&nbsp;<span class="op" id="4808112">=</span>&nbsp;<span class="ident" id="4808114">z</span><span class="op" id="4808115">.</span><span class="ident" id="4808116">set</span><span class="op" id="4808119">(</span><span class="ident" id="4808120">x</span><span class="op" id="4808121">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808125">//&nbsp;If&nbsp;the&nbsp;base&nbsp;is&nbsp;non-trivial&nbsp;and&nbsp;the&nbsp;exponent&nbsp;is&nbsp;large,&nbsp;we&nbsp;use</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808190">//&nbsp;4-bit,&nbsp;windowed&nbsp;exponentiation.&nbsp;This&nbsp;involves&nbsp;precomputing&nbsp;14&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808263">//&nbsp;(x^2...x^15)&nbsp;but&nbsp;then&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;multiply-reduces&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808333">//&nbsp;third.&nbsp;Even&nbsp;for&nbsp;a&nbsp;32-bit&nbsp;exponent,&nbsp;this&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808399">//&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808415">if</span>&nbsp;<span class="builtinfunc" id="4808418">len</span><span class="op" id="4808421">(</span><span class="ident" id="4808422">x</span><span class="op" id="4808423">)</span>&nbsp;<span class="op" id="4808425">&gt;</span>&nbsp;<span class="num" id="4808427">1</span>&nbsp;<span class="op" id="4808429">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4808432">len</span><span class="op" id="4808435">(</span><span class="ident" id="4808436">y</span><span class="op" id="4808437">)</span>&nbsp;<span class="op" id="4808439">&gt;</span>&nbsp;<span class="num" id="4808441">1</span>&nbsp;<span class="op" id="4808443">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4808446">len</span><span class="op" id="4808449">(</span><span class="ident" id="4808450">m</span><span class="op" id="4808451">)</span>&nbsp;<span class="op" id="4808453">&gt;</span>&nbsp;<span class="num" id="4808455">0</span>&nbsp;<span class="op" id="4808457">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808461">return</span>&nbsp;<span class="ident" id="4808468">z</span><span class="op" id="4808469">.</span><span class="ident" id="4808470">expNNWindowed</span><span class="op" id="4808483">(</span><span class="ident" id="4808484">x</span><span class="op" id="4808485">,</span>&nbsp;<span class="ident" id="4808487">y</span><span class="op" id="4808488">,</span>&nbsp;<span class="ident" id="4808490">m</span><span class="op" id="4808491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808498">v</span>&nbsp;<span class="op" id="4808500">:=</span>&nbsp;<span class="ident" id="4808503">y</span><span class="op" id="4808504">[</span><span class="builtinfunc" id="4808505">len</span><span class="op" id="4808508">(</span><span class="ident" id="4808509">y</span><span class="op" id="4808510">)</span><span class="op" id="4808511">-</span><span class="num" id="4808512">1</span><span class="op" id="4808513">]</span>&nbsp;<span class="comment" id="4808515">//&nbsp;v&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;y&nbsp;is&nbsp;normalized&nbsp;and&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808559">shift</span>&nbsp;<span class="op" id="4808565">:=</span>&nbsp;<span class="ident" id="4808568">leadingZeros</span><span class="op" id="4808580">(</span><span class="ident" id="4808581">v</span><span class="op" id="4808582">)</span>&nbsp;<span class="op" id="4808584">+</span>&nbsp;<span class="num" id="4808586">1</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808589">v</span>&nbsp;<span class="op" id="4808591">&lt;&lt;=</span>&nbsp;<span class="ident" id="4808595">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808602">var</span>&nbsp;<span class="ident" id="4808606">q</span>&nbsp;<span class="ident" id="4808608">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808614">const</span>&nbsp;<span class="ident" id="4808620">mask</span>&nbsp;<span class="op" id="4808625">=</span>&nbsp;<span class="num" id="4808627">1</span>&nbsp;<span class="op" id="4808629">&lt;&lt;</span>&nbsp;<span class="op" id="4808632">(</span><span class="ident" id="4808633">_W</span>&nbsp;<span class="op" id="4808636">-</span>&nbsp;<span class="num" id="4808638">1</span><span class="op" id="4808639">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808643">//&nbsp;We&nbsp;walk&nbsp;through&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;exponent&nbsp;one&nbsp;by&nbsp;one.&nbsp;Each&nbsp;time&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808713">//&nbsp;see&nbsp;a&nbsp;bit,&nbsp;we&nbsp;square,&nbsp;thus&nbsp;doubling&nbsp;the&nbsp;power.&nbsp;If&nbsp;the&nbsp;bit&nbsp;is&nbsp;a&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808785">//&nbsp;we&nbsp;also&nbsp;multiply&nbsp;by&nbsp;x,&nbsp;thus&nbsp;adding&nbsp;one&nbsp;to&nbsp;the&nbsp;power.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808843">w</span>&nbsp;<span class="op" id="4808845">:=</span>&nbsp;<span class="ident" id="4808848">_W</span>&nbsp;<span class="op" id="4808851">-</span>&nbsp;<span class="builtintype" id="4808853">int</span><span class="op" id="4808856">(</span><span class="ident" id="4808857">shift</span><span class="op" id="4808862">)</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808865">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808925">//&nbsp;otherwise&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808966">var</span>&nbsp;<span class="ident" id="4808970">zz</span><span class="op" id="4808972">,</span>&nbsp;<span class="ident" id="4808974">r</span>&nbsp;<span class="ident" id="4808976">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808981">for</span>&nbsp;<span class="ident" id="4808985">j</span>&nbsp;<span class="op" id="4808987">:=</span>&nbsp;<span class="num" id="4808990">0</span><span class="op" id="4808991">;</span>&nbsp;<span class="ident" id="4808993">j</span>&nbsp;<span class="op" id="4808995">&lt;</span>&nbsp;<span class="ident" id="4808997">w</span><span class="op" id="4808998">;</span>&nbsp;<span class="ident" id="4809000">j</span><span class="op" id="4809001">++</span>&nbsp;<span class="op" id="4809004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809008">zz</span>&nbsp;<span class="op" id="4809011">=</span>&nbsp;<span class="ident" id="4809013">zz</span><span class="op" id="4809015">.</span><span class="ident" id="4809016">mul</span><span class="op" id="4809019">(</span><span class="ident" id="4809020">z</span><span class="op" id="4809021">,</span>&nbsp;<span class="ident" id="4809023">z</span><span class="op" id="4809024">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809028">zz</span><span class="op" id="4809030">,</span>&nbsp;<span class="ident" id="4809032">z</span>&nbsp;<span class="op" id="4809034">=</span>&nbsp;<span class="ident" id="4809036">z</span><span class="op" id="4809037">,</span>&nbsp;<span class="ident" id="4809039">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809045">if</span>&nbsp;<span class="ident" id="4809048">v</span><span class="op" id="4809049">&amp;</span><span class="ident" id="4809050">mask</span>&nbsp;<span class="op" id="4809055">!=</span>&nbsp;<span class="num" id="4809058">0</span>&nbsp;<span class="op" id="4809060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809065">zz</span>&nbsp;<span class="op" id="4809068">=</span>&nbsp;<span class="ident" id="4809070">zz</span><span class="op" id="4809072">.</span><span class="ident" id="4809073">mul</span><span class="op" id="4809076">(</span><span class="ident" id="4809077">z</span><span class="op" id="4809078">,</span>&nbsp;<span class="ident" id="4809080">x</span><span class="op" id="4809081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809086">zz</span><span class="op" id="4809088">,</span>&nbsp;<span class="ident" id="4809090">z</span>&nbsp;<span class="op" id="4809092">=</span>&nbsp;<span class="ident" id="4809094">z</span><span class="op" id="4809095">,</span>&nbsp;<span class="ident" id="4809097">zz</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809107">if</span>&nbsp;<span class="builtinfunc" id="4809110">len</span><span class="op" id="4809113">(</span><span class="ident" id="4809114">m</span><span class="op" id="4809115">)</span>&nbsp;<span class="op" id="4809117">!=</span>&nbsp;<span class="num" id="4809120">0</span>&nbsp;<span class="op" id="4809122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809127">zz</span><span class="op" id="4809129">,</span>&nbsp;<span class="ident" id="4809131">r</span>&nbsp;<span class="op" id="4809133">=</span>&nbsp;<span class="ident" id="4809135">zz</span><span class="op" id="4809137">.</span><span class="ident" id="4809138">div</span><span class="op" id="4809141">(</span><span class="ident" id="4809142">r</span><span class="op" id="4809143">,</span>&nbsp;<span class="ident" id="4809145">z</span><span class="op" id="4809146">,</span>&nbsp;<span class="ident" id="4809148">m</span><span class="op" id="4809149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809154">zz</span><span class="op" id="4809156">,</span>&nbsp;<span class="ident" id="4809158">r</span><span class="op" id="4809159">,</span>&nbsp;<span class="ident" id="4809161">q</span><span class="op" id="4809162">,</span>&nbsp;<span class="ident" id="4809164">z</span>&nbsp;<span class="op" id="4809166">=</span>&nbsp;<span class="ident" id="4809168">q</span><span class="op" id="4809169">,</span>&nbsp;<span class="ident" id="4809171">z</span><span class="op" id="4809172">,</span>&nbsp;<span class="ident" id="4809174">zz</span><span class="op" id="4809176">,</span>&nbsp;<span class="ident" id="4809178">r</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809187">v</span>&nbsp;<span class="op" id="4809189">&lt;&lt;=</span>&nbsp;<span class="num" id="4809193">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809200">for</span>&nbsp;<span class="ident" id="4809204">i</span>&nbsp;<span class="op" id="4809206">:=</span>&nbsp;<span class="builtinfunc" id="4809209">len</span><span class="op" id="4809212">(</span><span class="ident" id="4809213">y</span><span class="op" id="4809214">)</span>&nbsp;<span class="op" id="4809216">-</span>&nbsp;<span class="num" id="4809218">2</span><span class="op" id="4809219">;</span>&nbsp;<span class="ident" id="4809221">i</span>&nbsp;<span class="op" id="4809223">&gt;=</span>&nbsp;<span class="num" id="4809226">0</span><span class="op" id="4809227">;</span>&nbsp;<span class="ident" id="4809229">i</span><span class="op" id="4809230">--</span>&nbsp;<span class="op" id="4809233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809237">v</span>&nbsp;<span class="op" id="4809239">=</span>&nbsp;<span class="ident" id="4809241">y</span><span class="op" id="4809242">[</span><span class="ident" id="4809243">i</span><span class="op" id="4809244">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809249">for</span>&nbsp;<span class="ident" id="4809253">j</span>&nbsp;<span class="op" id="4809255">:=</span>&nbsp;<span class="num" id="4809258">0</span><span class="op" id="4809259">;</span>&nbsp;<span class="ident" id="4809261">j</span>&nbsp;<span class="op" id="4809263">&lt;</span>&nbsp;<span class="ident" id="4809265">_W</span><span class="op" id="4809267">;</span>&nbsp;<span class="ident" id="4809269">j</span><span class="op" id="4809270">++</span>&nbsp;<span class="op" id="4809273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809278">zz</span>&nbsp;<span class="op" id="4809281">=</span>&nbsp;<span class="ident" id="4809283">zz</span><span class="op" id="4809285">.</span><span class="ident" id="4809286">mul</span><span class="op" id="4809289">(</span><span class="ident" id="4809290">z</span><span class="op" id="4809291">,</span>&nbsp;<span class="ident" id="4809293">z</span><span class="op" id="4809294">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809299">zz</span><span class="op" id="4809301">,</span>&nbsp;<span class="ident" id="4809303">z</span>&nbsp;<span class="op" id="4809305">=</span>&nbsp;<span class="ident" id="4809307">z</span><span class="op" id="4809308">,</span>&nbsp;<span class="ident" id="4809310">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809317">if</span>&nbsp;<span class="ident" id="4809320">v</span><span class="op" id="4809321">&amp;</span><span class="ident" id="4809322">mask</span>&nbsp;<span class="op" id="4809327">!=</span>&nbsp;<span class="num" id="4809330">0</span>&nbsp;<span class="op" id="4809332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809338">zz</span>&nbsp;<span class="op" id="4809341">=</span>&nbsp;<span class="ident" id="4809343">zz</span><span class="op" id="4809345">.</span><span class="ident" id="4809346">mul</span><span class="op" id="4809349">(</span><span class="ident" id="4809350">z</span><span class="op" id="4809351">,</span>&nbsp;<span class="ident" id="4809353">x</span><span class="op" id="4809354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809360">zz</span><span class="op" id="4809362">,</span>&nbsp;<span class="ident" id="4809364">z</span>&nbsp;<span class="op" id="4809366">=</span>&nbsp;<span class="ident" id="4809368">z</span><span class="op" id="4809369">,</span>&nbsp;<span class="ident" id="4809371">zz</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809383">if</span>&nbsp;<span class="builtinfunc" id="4809386">len</span><span class="op" id="4809389">(</span><span class="ident" id="4809390">m</span><span class="op" id="4809391">)</span>&nbsp;<span class="op" id="4809393">!=</span>&nbsp;<span class="num" id="4809396">0</span>&nbsp;<span class="op" id="4809398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809404">zz</span><span class="op" id="4809406">,</span>&nbsp;<span class="ident" id="4809408">r</span>&nbsp;<span class="op" id="4809410">=</span>&nbsp;<span class="ident" id="4809412">zz</span><span class="op" id="4809414">.</span><span class="ident" id="4809415">div</span><span class="op" id="4809418">(</span><span class="ident" id="4809419">r</span><span class="op" id="4809420">,</span>&nbsp;<span class="ident" id="4809422">z</span><span class="op" id="4809423">,</span>&nbsp;<span class="ident" id="4809425">m</span><span class="op" id="4809426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809432">zz</span><span class="op" id="4809434">,</span>&nbsp;<span class="ident" id="4809436">r</span><span class="op" id="4809437">,</span>&nbsp;<span class="ident" id="4809439">q</span><span class="op" id="4809440">,</span>&nbsp;<span class="ident" id="4809442">z</span>&nbsp;<span class="op" id="4809444">=</span>&nbsp;<span class="ident" id="4809446">q</span><span class="op" id="4809447">,</span>&nbsp;<span class="ident" id="4809449">z</span><span class="op" id="4809450">,</span>&nbsp;<span class="ident" id="4809452">zz</span><span class="op" id="4809454">,</span>&nbsp;<span class="ident" id="4809456">r</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809467">v</span>&nbsp;<span class="op" id="4809469">&lt;&lt;=</span>&nbsp;<span class="num" id="4809473">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809480">}</span><br>
<span class="lineno">1315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809484">return</span>&nbsp;<span class="ident" id="4809491">z</span><span class="op" id="4809492">.</span><span class="ident" id="4809493">norm</span><span class="op" id="4809497">(</span><span class="op" id="4809498">)</span><br>
<span class="lineno"></span><span class="op" id="4809500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4809503">//&nbsp;expNNWindowed&nbsp;calculates&nbsp;x**y&nbsp;mod&nbsp;m&nbsp;using&nbsp;a&nbsp;fixed,&nbsp;4-bit&nbsp;window.</span><br>
<span class="lineno">1320</span><span class="keyword" id="4809571">func</span>&nbsp;<span class="op" id="4809576">(</span><span class="ident" id="4809577">z</span>&nbsp;<span class="ident" id="4809579">nat</span><span class="op" id="4809582">)</span>&nbsp;<span class="ident" id="4809584">expNNWindowed</span><span class="op" id="4809597">(</span><span class="ident" id="4809598">x</span><span class="op" id="4809599">,</span>&nbsp;<span class="ident" id="4809601">y</span><span class="op" id="4809602">,</span>&nbsp;<span class="ident" id="4809604">m</span>&nbsp;<span class="ident" id="4809606">nat</span><span class="op" id="4809609">)</span>&nbsp;<span class="ident" id="4809611">nat</span>&nbsp;<span class="op" id="4809615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809618">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809688">//&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809719">var</span>&nbsp;<span class="ident" id="4809723">zz</span><span class="op" id="4809725">,</span>&nbsp;<span class="ident" id="4809727">r</span>&nbsp;<span class="ident" id="4809729">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809735">const</span>&nbsp;<span class="ident" id="4809741">n</span>&nbsp;<span class="op" id="4809743">=</span>&nbsp;<span class="num" id="4809745">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809748">//&nbsp;powers[i]&nbsp;contains&nbsp;x^i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809776">var</span>&nbsp;<span class="ident" id="4809780">powers</span>&nbsp;<span class="op" id="4809787">[</span><span class="num" id="4809788">1</span>&nbsp;<span class="op" id="4809790">&lt;&lt;</span>&nbsp;<span class="ident" id="4809793">n</span><span class="op" id="4809794">]</span><span class="ident" id="4809795">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809800">powers</span><span class="op" id="4809806">[</span><span class="num" id="4809807">0</span><span class="op" id="4809808">]</span>&nbsp;<span class="op" id="4809810">=</span>&nbsp;<span class="ident" id="4809812">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809820">powers</span><span class="op" id="4809826">[</span><span class="num" id="4809827">1</span><span class="op" id="4809828">]</span>&nbsp;<span class="op" id="4809830">=</span>&nbsp;<span class="ident" id="4809832">x</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809835">for</span>&nbsp;<span class="ident" id="4809839">i</span>&nbsp;<span class="op" id="4809841">:=</span>&nbsp;<span class="num" id="4809844">2</span><span class="op" id="4809845">;</span>&nbsp;<span class="ident" id="4809847">i</span>&nbsp;<span class="op" id="4809849">&lt;</span>&nbsp;<span class="num" id="4809851">1</span><span class="op" id="4809852">&lt;&lt;</span><span class="ident" id="4809854">n</span><span class="op" id="4809855">;</span>&nbsp;<span class="ident" id="4809857">i</span>&nbsp;<span class="op" id="4809859">+=</span>&nbsp;<span class="num" id="4809862">2</span>&nbsp;<span class="op" id="4809864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809868">p2</span><span class="op" id="4809870">,</span>&nbsp;<span class="ident" id="4809872">p</span><span class="op" id="4809873">,</span>&nbsp;<span class="ident" id="4809875">p1</span>&nbsp;<span class="op" id="4809878">:=</span>&nbsp;<span class="op" id="4809881">&amp;</span><span class="ident" id="4809882">powers</span><span class="op" id="4809888">[</span><span class="ident" id="4809889">i</span><span class="op" id="4809890">/</span><span class="num" id="4809891">2</span><span class="op" id="4809892">]</span><span class="op" id="4809893">,</span>&nbsp;<span class="op" id="4809895">&amp;</span><span class="ident" id="4809896">powers</span><span class="op" id="4809902">[</span><span class="ident" id="4809903">i</span><span class="op" id="4809904">]</span><span class="op" id="4809905">,</span>&nbsp;<span class="op" id="4809907">&amp;</span><span class="ident" id="4809908">powers</span><span class="op" id="4809914">[</span><span class="ident" id="4809915">i</span><span class="op" id="4809916">+</span><span class="num" id="4809917">1</span><span class="op" id="4809918">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809922">*</span><span class="ident" id="4809923">p</span>&nbsp;<span class="op" id="4809925">=</span>&nbsp;<span class="ident" id="4809927">p</span><span class="op" id="4809928">.</span><span class="ident" id="4809929">mul</span><span class="op" id="4809932">(</span><span class="op" id="4809933">*</span><span class="ident" id="4809934">p2</span><span class="op" id="4809936">,</span>&nbsp;<span class="op" id="4809938">*</span><span class="ident" id="4809939">p2</span><span class="op" id="4809941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809945">zz</span><span class="op" id="4809947">,</span>&nbsp;<span class="ident" id="4809949">r</span>&nbsp;<span class="op" id="4809951">=</span>&nbsp;<span class="ident" id="4809953">zz</span><span class="op" id="4809955">.</span><span class="ident" id="4809956">div</span><span class="op" id="4809959">(</span><span class="ident" id="4809960">r</span><span class="op" id="4809961">,</span>&nbsp;<span class="op" id="4809963">*</span><span class="ident" id="4809964">p</span><span class="op" id="4809965">,</span>&nbsp;<span class="ident" id="4809967">m</span><span class="op" id="4809968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809972">*</span><span class="ident" id="4809973">p</span><span class="op" id="4809974">,</span>&nbsp;<span class="ident" id="4809976">r</span>&nbsp;<span class="op" id="4809978">=</span>&nbsp;<span class="ident" id="4809980">r</span><span class="op" id="4809981">,</span>&nbsp;<span class="op" id="4809983">*</span><span class="ident" id="4809984">p</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809988">*</span><span class="ident" id="4809989">p1</span>&nbsp;<span class="op" id="4809992">=</span>&nbsp;<span class="ident" id="4809994">p1</span><span class="op" id="4809996">.</span><span class="ident" id="4809997">mul</span><span class="op" id="4810000">(</span><span class="op" id="4810001">*</span><span class="ident" id="4810002">p</span><span class="op" id="4810003">,</span>&nbsp;<span class="ident" id="4810005">x</span><span class="op" id="4810006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810010">zz</span><span class="op" id="4810012">,</span>&nbsp;<span class="ident" id="4810014">r</span>&nbsp;<span class="op" id="4810016">=</span>&nbsp;<span class="ident" id="4810018">zz</span><span class="op" id="4810020">.</span><span class="ident" id="4810021">div</span><span class="op" id="4810024">(</span><span class="ident" id="4810025">r</span><span class="op" id="4810026">,</span>&nbsp;<span class="op" id="4810028">*</span><span class="ident" id="4810029">p1</span><span class="op" id="4810031">,</span>&nbsp;<span class="ident" id="4810033">m</span><span class="op" id="4810034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810038">*</span><span class="ident" id="4810039">p1</span><span class="op" id="4810041">,</span>&nbsp;<span class="ident" id="4810043">r</span>&nbsp;<span class="op" id="4810045">=</span>&nbsp;<span class="ident" id="4810047">r</span><span class="op" id="4810048">,</span>&nbsp;<span class="op" id="4810050">*</span><span class="ident" id="4810051">p1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810059">z</span>&nbsp;<span class="op" id="4810061">=</span>&nbsp;<span class="ident" id="4810063">z</span><span class="op" id="4810064">.</span><span class="ident" id="4810065">setWord</span><span class="op" id="4810072">(</span><span class="num" id="4810073">1</span><span class="op" id="4810074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810078">for</span>&nbsp;<span class="ident" id="4810082">i</span>&nbsp;<span class="op" id="4810084">:=</span>&nbsp;<span class="builtinfunc" id="4810087">len</span><span class="op" id="4810090">(</span><span class="ident" id="4810091">y</span><span class="op" id="4810092">)</span>&nbsp;<span class="op" id="4810094">-</span>&nbsp;<span class="num" id="4810096">1</span><span class="op" id="4810097">;</span>&nbsp;<span class="ident" id="4810099">i</span>&nbsp;<span class="op" id="4810101">&gt;=</span>&nbsp;<span class="num" id="4810104">0</span><span class="op" id="4810105">;</span>&nbsp;<span class="ident" id="4810107">i</span><span class="op" id="4810108">--</span>&nbsp;<span class="op" id="4810111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810115">yi</span>&nbsp;<span class="op" id="4810118">:=</span>&nbsp;<span class="ident" id="4810121">y</span><span class="op" id="4810122">[</span><span class="ident" id="4810123">i</span><span class="op" id="4810124">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810128">for</span>&nbsp;<span class="ident" id="4810132">j</span>&nbsp;<span class="op" id="4810134">:=</span>&nbsp;<span class="num" id="4810137">0</span><span class="op" id="4810138">;</span>&nbsp;<span class="ident" id="4810140">j</span>&nbsp;<span class="op" id="4810142">&lt;</span>&nbsp;<span class="ident" id="4810144">_W</span><span class="op" id="4810146">;</span>&nbsp;<span class="ident" id="4810148">j</span>&nbsp;<span class="op" id="4810150">+=</span>&nbsp;<span class="ident" id="4810153">n</span>&nbsp;<span class="op" id="4810155">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810160">if</span>&nbsp;<span class="ident" id="4810163">i</span>&nbsp;<span class="op" id="4810165">!=</span>&nbsp;<span class="builtinfunc" id="4810168">len</span><span class="op" id="4810171">(</span><span class="ident" id="4810172">y</span><span class="op" id="4810173">)</span><span class="op" id="4810174">-</span><span class="num" id="4810175">1</span>&nbsp;<span class="op" id="4810177">||</span>&nbsp;<span class="ident" id="4810180">j</span>&nbsp;<span class="op" id="4810182">!=</span>&nbsp;<span class="num" id="4810185">0</span>&nbsp;<span class="op" id="4810187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810193">//&nbsp;Unrolled&nbsp;loop&nbsp;for&nbsp;significant&nbsp;performance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810242">//&nbsp;gain.&nbsp;&nbsp;Use&nbsp;go&nbsp;test&nbsp;-bench=&#34;.*&#34;&nbsp;in&nbsp;crypto/rsa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810294">//&nbsp;to&nbsp;check&nbsp;performance&nbsp;before&nbsp;making&nbsp;changes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810345">zz</span>&nbsp;<span class="op" id="4810348">=</span>&nbsp;<span class="ident" id="4810350">zz</span><span class="op" id="4810352">.</span><span class="ident" id="4810353">mul</span><span class="op" id="4810356">(</span><span class="ident" id="4810357">z</span><span class="op" id="4810358">,</span>&nbsp;<span class="ident" id="4810360">z</span><span class="op" id="4810361">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810367">zz</span><span class="op" id="4810369">,</span>&nbsp;<span class="ident" id="4810371">z</span>&nbsp;<span class="op" id="4810373">=</span>&nbsp;<span class="ident" id="4810375">z</span><span class="op" id="4810376">,</span>&nbsp;<span class="ident" id="4810378">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810385">zz</span><span class="op" id="4810387">,</span>&nbsp;<span class="ident" id="4810389">r</span>&nbsp;<span class="op" id="4810391">=</span>&nbsp;<span class="ident" id="4810393">zz</span><span class="op" id="4810395">.</span><span class="ident" id="4810396">div</span><span class="op" id="4810399">(</span><span class="ident" id="4810400">r</span><span class="op" id="4810401">,</span>&nbsp;<span class="ident" id="4810403">z</span><span class="op" id="4810404">,</span>&nbsp;<span class="ident" id="4810406">m</span><span class="op" id="4810407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810413">z</span><span class="op" id="4810414">,</span>&nbsp;<span class="ident" id="4810416">r</span>&nbsp;<span class="op" id="4810418">=</span>&nbsp;<span class="ident" id="4810420">r</span><span class="op" id="4810421">,</span>&nbsp;<span class="ident" id="4810423">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810430">zz</span>&nbsp;<span class="op" id="4810433">=</span>&nbsp;<span class="ident" id="4810435">zz</span><span class="op" id="4810437">.</span><span class="ident" id="4810438">mul</span><span class="op" id="4810441">(</span><span class="ident" id="4810442">z</span><span class="op" id="4810443">,</span>&nbsp;<span class="ident" id="4810445">z</span><span class="op" id="4810446">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810452">zz</span><span class="op" id="4810454">,</span>&nbsp;<span class="ident" id="4810456">z</span>&nbsp;<span class="op" id="4810458">=</span>&nbsp;<span class="ident" id="4810460">z</span><span class="op" id="4810461">,</span>&nbsp;<span class="ident" id="4810463">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810470">zz</span><span class="op" id="4810472">,</span>&nbsp;<span class="ident" id="4810474">r</span>&nbsp;<span class="op" id="4810476">=</span>&nbsp;<span class="ident" id="4810478">zz</span><span class="op" id="4810480">.</span><span class="ident" id="4810481">div</span><span class="op" id="4810484">(</span><span class="ident" id="4810485">r</span><span class="op" id="4810486">,</span>&nbsp;<span class="ident" id="4810488">z</span><span class="op" id="4810489">,</span>&nbsp;<span class="ident" id="4810491">m</span><span class="op" id="4810492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810498">z</span><span class="op" id="4810499">,</span>&nbsp;<span class="ident" id="4810501">r</span>&nbsp;<span class="op" id="4810503">=</span>&nbsp;<span class="ident" id="4810505">r</span><span class="op" id="4810506">,</span>&nbsp;<span class="ident" id="4810508">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810515">zz</span>&nbsp;<span class="op" id="4810518">=</span>&nbsp;<span class="ident" id="4810520">zz</span><span class="op" id="4810522">.</span><span class="ident" id="4810523">mul</span><span class="op" id="4810526">(</span><span class="ident" id="4810527">z</span><span class="op" id="4810528">,</span>&nbsp;<span class="ident" id="4810530">z</span><span class="op" id="4810531">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810537">zz</span><span class="op" id="4810539">,</span>&nbsp;<span class="ident" id="4810541">z</span>&nbsp;<span class="op" id="4810543">=</span>&nbsp;<span class="ident" id="4810545">z</span><span class="op" id="4810546">,</span>&nbsp;<span class="ident" id="4810548">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810555">zz</span><span class="op" id="4810557">,</span>&nbsp;<span class="ident" id="4810559">r</span>&nbsp;<span class="op" id="4810561">=</span>&nbsp;<span class="ident" id="4810563">zz</span><span class="op" id="4810565">.</span><span class="ident" id="4810566">div</span><span class="op" id="4810569">(</span><span class="ident" id="4810570">r</span><span class="op" id="4810571">,</span>&nbsp;<span class="ident" id="4810573">z</span><span class="op" id="4810574">,</span>&nbsp;<span class="ident" id="4810576">m</span><span class="op" id="4810577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810583">z</span><span class="op" id="4810584">,</span>&nbsp;<span class="ident" id="4810586">r</span>&nbsp;<span class="op" id="4810588">=</span>&nbsp;<span class="ident" id="4810590">r</span><span class="op" id="4810591">,</span>&nbsp;<span class="ident" id="4810593">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810600">zz</span>&nbsp;<span class="op" id="4810603">=</span>&nbsp;<span class="ident" id="4810605">zz</span><span class="op" id="4810607">.</span><span class="ident" id="4810608">mul</span><span class="op" id="4810611">(</span><span class="ident" id="4810612">z</span><span class="op" id="4810613">,</span>&nbsp;<span class="ident" id="4810615">z</span><span class="op" id="4810616">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810622">zz</span><span class="op" id="4810624">,</span>&nbsp;<span class="ident" id="4810626">z</span>&nbsp;<span class="op" id="4810628">=</span>&nbsp;<span class="ident" id="4810630">z</span><span class="op" id="4810631">,</span>&nbsp;<span class="ident" id="4810633">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810640">zz</span><span class="op" id="4810642">,</span>&nbsp;<span class="ident" id="4810644">r</span>&nbsp;<span class="op" id="4810646">=</span>&nbsp;<span class="ident" id="4810648">zz</span><span class="op" id="4810650">.</span><span class="ident" id="4810651">div</span><span class="op" id="4810654">(</span><span class="ident" id="4810655">r</span><span class="op" id="4810656">,</span>&nbsp;<span class="ident" id="4810658">z</span><span class="op" id="4810659">,</span>&nbsp;<span class="ident" id="4810661">m</span><span class="op" id="4810662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810668">z</span><span class="op" id="4810669">,</span>&nbsp;<span class="ident" id="4810671">r</span>&nbsp;<span class="op" id="4810673">=</span>&nbsp;<span class="ident" id="4810675">r</span><span class="op" id="4810676">,</span>&nbsp;<span class="ident" id="4810678">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810689">zz</span>&nbsp;<span class="op" id="4810692">=</span>&nbsp;<span class="ident" id="4810694">zz</span><span class="op" id="4810696">.</span><span class="ident" id="4810697">mul</span><span class="op" id="4810700">(</span><span class="ident" id="4810701">z</span><span class="op" id="4810702">,</span>&nbsp;<span class="ident" id="4810704">powers</span><span class="op" id="4810710">[</span><span class="ident" id="4810711">yi</span><span class="op" id="4810713">&gt;&gt;</span><span class="op" id="4810715">(</span><span class="ident" id="4810716">_W</span><span class="op" id="4810718">-</span><span class="ident" id="4810719">n</span><span class="op" id="4810720">)</span><span class="op" id="4810721">]</span><span class="op" id="4810722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810727">zz</span><span class="op" id="4810729">,</span>&nbsp;<span class="ident" id="4810731">z</span>&nbsp;<span class="op" id="4810733">=</span>&nbsp;<span class="ident" id="4810735">z</span><span class="op" id="4810736">,</span>&nbsp;<span class="ident" id="4810738">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810744">zz</span><span class="op" id="4810746">,</span>&nbsp;<span class="ident" id="4810748">r</span>&nbsp;<span class="op" id="4810750">=</span>&nbsp;<span class="ident" id="4810752">zz</span><span class="op" id="4810754">.</span><span class="ident" id="4810755">div</span><span class="op" id="4810758">(</span><span class="ident" id="4810759">r</span><span class="op" id="4810760">,</span>&nbsp;<span class="ident" id="4810762">z</span><span class="op" id="4810763">,</span>&nbsp;<span class="ident" id="4810765">m</span><span class="op" id="4810766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810771">z</span><span class="op" id="4810772">,</span>&nbsp;<span class="ident" id="4810774">r</span>&nbsp;<span class="op" id="4810776">=</span>&nbsp;<span class="ident" id="4810778">r</span><span class="op" id="4810779">,</span>&nbsp;<span class="ident" id="4810781">z</span><br>
<span class="lineno"></span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810787">yi</span>&nbsp;<span class="op" id="4810790">&lt;&lt;=</span>&nbsp;<span class="ident" id="4810794">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810805">return</span>&nbsp;<span class="ident" id="4810812">z</span><span class="op" id="4810813">.</span><span class="ident" id="4810814">norm</span><span class="op" id="4810818">(</span><span class="op" id="4810819">)</span><br>
<span class="lineno">1380</span><span class="op" id="4810821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4810824">//&nbsp;probablyPrime&nbsp;performs&nbsp;reps&nbsp;Miller-Rabin&nbsp;tests&nbsp;to&nbsp;check&nbsp;whether&nbsp;n&nbsp;is&nbsp;prime.</span><br>
<span class="lineno"></span><span class="comment" id="4810903">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;true,&nbsp;n&nbsp;is&nbsp;prime&nbsp;with&nbsp;probability&nbsp;1&nbsp;-&nbsp;1/4^reps.</span><br>
<span class="lineno"></span><span class="comment" id="4810968">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;false,&nbsp;n&nbsp;is&nbsp;not&nbsp;prime.</span><br>
<span class="lineno">1385</span><span class="keyword" id="4811008">func</span>&nbsp;<span class="op" id="4811013">(</span><span class="ident" id="4811014">n</span>&nbsp;<span class="ident" id="4811016">nat</span><span class="op" id="4811019">)</span>&nbsp;<span class="ident" id="4811021">probablyPrime</span><span class="op" id="4811034">(</span><span class="ident" id="4811035">reps</span>&nbsp;<span class="builtintype" id="4811040">int</span><span class="op" id="4811043">)</span>&nbsp;<span class="builtintype" id="4811045">bool</span>&nbsp;<span class="op" id="4811050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811053">if</span>&nbsp;<span class="builtinfunc" id="4811056">len</span><span class="op" id="4811059">(</span><span class="ident" id="4811060">n</span><span class="op" id="4811061">)</span>&nbsp;<span class="op" id="4811063">==</span>&nbsp;<span class="num" id="4811066">0</span>&nbsp;<span class="op" id="4811068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811072">return</span>&nbsp;<span class="builtintype" id="4811079">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811090">if</span>&nbsp;<span class="builtinfunc" id="4811093">len</span><span class="op" id="4811096">(</span><span class="ident" id="4811097">n</span><span class="op" id="4811098">)</span>&nbsp;<span class="op" id="4811100">==</span>&nbsp;<span class="num" id="4811103">1</span>&nbsp;<span class="op" id="4811105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811109">if</span>&nbsp;<span class="ident" id="4811112">n</span><span class="op" id="4811113">[</span><span class="num" id="4811114">0</span><span class="op" id="4811115">]</span>&nbsp;<span class="op" id="4811117">&lt;</span>&nbsp;<span class="num" id="4811119">2</span>&nbsp;<span class="op" id="4811121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811126">return</span>&nbsp;<span class="builtintype" id="4811133">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811146">if</span>&nbsp;<span class="ident" id="4811149">n</span><span class="op" id="4811150">[</span><span class="num" id="4811151">0</span><span class="op" id="4811152">]</span><span class="op" id="4811153">%</span><span class="num" id="4811154">2</span>&nbsp;<span class="op" id="4811156">==</span>&nbsp;<span class="num" id="4811159">0</span>&nbsp;<span class="op" id="4811161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811166">return</span>&nbsp;<span class="ident" id="4811173">n</span><span class="op" id="4811174">[</span><span class="num" id="4811175">0</span><span class="op" id="4811176">]</span>&nbsp;<span class="op" id="4811178">==</span>&nbsp;<span class="num" id="4811181">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811190">//&nbsp;We&nbsp;have&nbsp;to&nbsp;exclude&nbsp;these&nbsp;cases&nbsp;because&nbsp;we&nbsp;reject&nbsp;all</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811248">//&nbsp;multiples&nbsp;of&nbsp;these&nbsp;numbers&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811287">switch</span>&nbsp;<span class="ident" id="4811294">n</span><span class="op" id="4811295">[</span><span class="num" id="4811296">0</span><span class="op" id="4811297">]</span>&nbsp;<span class="op" id="4811299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811303">case</span>&nbsp;<span class="num" id="4811308">3</span><span class="op" id="4811309">,</span>&nbsp;<span class="num" id="4811311">5</span><span class="op" id="4811312">,</span>&nbsp;<span class="num" id="4811314">7</span><span class="op" id="4811315">,</span>&nbsp;<span class="num" id="4811317">11</span><span class="op" id="4811319">,</span>&nbsp;<span class="num" id="4811321">13</span><span class="op" id="4811323">,</span>&nbsp;<span class="num" id="4811325">17</span><span class="op" id="4811327">,</span>&nbsp;<span class="num" id="4811329">19</span><span class="op" id="4811331">,</span>&nbsp;<span class="num" id="4811333">23</span><span class="op" id="4811335">,</span>&nbsp;<span class="num" id="4811337">29</span><span class="op" id="4811339">,</span>&nbsp;<span class="num" id="4811341">31</span><span class="op" id="4811343">,</span>&nbsp;<span class="num" id="4811345">37</span><span class="op" id="4811347">,</span>&nbsp;<span class="num" id="4811349">41</span><span class="op" id="4811351">,</span>&nbsp;<span class="num" id="4811353">43</span><span class="op" id="4811355">,</span>&nbsp;<span class="num" id="4811357">47</span><span class="op" id="4811359">,</span>&nbsp;<span class="num" id="4811361">53</span><span class="op" id="4811363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811368">return</span>&nbsp;<span class="builtintype" id="4811375">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811382">}</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811389">const</span>&nbsp;<span class="ident" id="4811395">primesProduct32</span>&nbsp;<span class="op" id="4811411">=</span>&nbsp;<span class="num" id="4811413">0xC0CFD797</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811432">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;29}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811467">const</span>&nbsp;<span class="ident" id="4811473">primesProduct64</span>&nbsp;<span class="op" id="4811489">=</span>&nbsp;<span class="num" id="4811491">0xE221F97C30E94E1D</span>&nbsp;<span class="comment" id="4811510">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;53}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811546">var</span>&nbsp;<span class="ident" id="4811550">r</span>&nbsp;<span class="ident" id="4811552">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811558">switch</span>&nbsp;<span class="ident" id="4811565">_W</span>&nbsp;<span class="op" id="4811568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811571">case</span>&nbsp;<span class="num" id="4811576">32</span><span class="op" id="4811578">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4811582">r</span>&nbsp;<span class="op" id="4811584">=</span>&nbsp;<span class="ident" id="4811586">n</span><span class="op" id="4811587">.</span><span class="ident" id="4811588">modW</span><span class="op" id="4811592">(</span><span class="ident" id="4811593">primesProduct32</span><span class="op" id="4811608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811611">case</span>&nbsp;<span class="num" id="4811616">64</span><span class="op" id="4811618">:</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4811622">r</span>&nbsp;<span class="op" id="4811624">=</span>&nbsp;<span class="ident" id="4811626">n</span><span class="op" id="4811627">.</span><span class="ident" id="4811628">modW</span><span class="op" id="4811632">(</span><span class="ident" id="4811633">primesProduct64</span>&nbsp;<span class="op" id="4811649">&amp;</span>&nbsp;<span class="ident" id="4811651">_M</span><span class="op" id="4811653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811656">default</span><span class="op" id="4811663">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4811667">panic</span><span class="op" id="4811672">(</span><span class="string" id="4811673">&#34;Unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="4811692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811699">if</span>&nbsp;<span class="ident" id="4811702">r</span><span class="op" id="4811703">%</span><span class="num" id="4811704">3</span>&nbsp;<span class="op" id="4811706">==</span>&nbsp;<span class="num" id="4811709">0</span>&nbsp;<span class="op" id="4811711">||</span>&nbsp;<span class="ident" id="4811714">r</span><span class="op" id="4811715">%</span><span class="num" id="4811716">5</span>&nbsp;<span class="op" id="4811718">==</span>&nbsp;<span class="num" id="4811721">0</span>&nbsp;<span class="op" id="4811723">||</span>&nbsp;<span class="ident" id="4811726">r</span><span class="op" id="4811727">%</span><span class="num" id="4811728">7</span>&nbsp;<span class="op" id="4811730">==</span>&nbsp;<span class="num" id="4811733">0</span>&nbsp;<span class="op" id="4811735">||</span>&nbsp;<span class="ident" id="4811738">r</span><span class="op" id="4811739">%</span><span class="num" id="4811740">11</span>&nbsp;<span class="op" id="4811743">==</span>&nbsp;<span class="num" id="4811746">0</span>&nbsp;<span class="op" id="4811748">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4811753">r</span><span class="op" id="4811754">%</span><span class="num" id="4811755">13</span>&nbsp;<span class="op" id="4811758">==</span>&nbsp;<span class="num" id="4811761">0</span>&nbsp;<span class="op" id="4811763">||</span>&nbsp;<span class="ident" id="4811766">r</span><span class="op" id="4811767">%</span><span class="num" id="4811768">17</span>&nbsp;<span class="op" id="4811771">==</span>&nbsp;<span class="num" id="4811774">0</span>&nbsp;<span class="op" id="4811776">||</span>&nbsp;<span class="ident" id="4811779">r</span><span class="op" id="4811780">%</span><span class="num" id="4811781">19</span>&nbsp;<span class="op" id="4811784">==</span>&nbsp;<span class="num" id="4811787">0</span>&nbsp;<span class="op" id="4811789">||</span>&nbsp;<span class="ident" id="4811792">r</span><span class="op" id="4811793">%</span><span class="num" id="4811794">23</span>&nbsp;<span class="op" id="4811797">==</span>&nbsp;<span class="num" id="4811800">0</span>&nbsp;<span class="op" id="4811802">||</span>&nbsp;<span class="ident" id="4811805">r</span><span class="op" id="4811806">%</span><span class="num" id="4811807">29</span>&nbsp;<span class="op" id="4811810">==</span>&nbsp;<span class="num" id="4811813">0</span>&nbsp;<span class="op" id="4811815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811819">return</span>&nbsp;<span class="builtintype" id="4811826">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811837">if</span>&nbsp;<span class="ident" id="4811840">_W</span>&nbsp;<span class="op" id="4811843">==</span>&nbsp;<span class="num" id="4811846">64</span>&nbsp;<span class="op" id="4811849">&amp;&amp;</span>&nbsp;<span class="op" id="4811852">(</span><span class="ident" id="4811853">r</span><span class="op" id="4811854">%</span><span class="num" id="4811855">31</span>&nbsp;<span class="op" id="4811858">==</span>&nbsp;<span class="num" id="4811861">0</span>&nbsp;<span class="op" id="4811863">||</span>&nbsp;<span class="ident" id="4811866">r</span><span class="op" id="4811867">%</span><span class="num" id="4811868">37</span>&nbsp;<span class="op" id="4811871">==</span>&nbsp;<span class="num" id="4811874">0</span>&nbsp;<span class="op" id="4811876">||</span>&nbsp;<span class="ident" id="4811879">r</span><span class="op" id="4811880">%</span><span class="num" id="4811881">41</span>&nbsp;<span class="op" id="4811884">==</span>&nbsp;<span class="num" id="4811887">0</span>&nbsp;<span class="op" id="4811889">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4811894">r</span><span class="op" id="4811895">%</span><span class="num" id="4811896">43</span>&nbsp;<span class="op" id="4811899">==</span>&nbsp;<span class="num" id="4811902">0</span>&nbsp;<span class="op" id="4811904">||</span>&nbsp;<span class="ident" id="4811907">r</span><span class="op" id="4811908">%</span><span class="num" id="4811909">47</span>&nbsp;<span class="op" id="4811912">==</span>&nbsp;<span class="num" id="4811915">0</span>&nbsp;<span class="op" id="4811917">||</span>&nbsp;<span class="ident" id="4811920">r</span><span class="op" id="4811921">%</span><span class="num" id="4811922">53</span>&nbsp;<span class="op" id="4811925">==</span>&nbsp;<span class="num" id="4811928">0</span><span class="op" id="4811929">)</span>&nbsp;<span class="op" id="4811931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811935">return</span>&nbsp;<span class="builtintype" id="4811942">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4811953">nm1</span>&nbsp;<span class="op" id="4811957">:=</span>&nbsp;<span class="ident" id="4811960">nat</span><span class="op" id="4811963">(</span><span class="ident" id="4811964">nil</span><span class="op" id="4811967">)</span><span class="op" id="4811968">.</span><span class="ident" id="4811969">sub</span><span class="op" id="4811972">(</span><span class="ident" id="4811973">n</span><span class="op" id="4811974">,</span>&nbsp;<span class="ident" id="4811976">natOne</span><span class="op" id="4811982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811985">//&nbsp;determine&nbsp;q,&nbsp;k&nbsp;such&nbsp;that&nbsp;nm1&nbsp;=&nbsp;q&nbsp;&lt;&lt;&nbsp;k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812027">k</span>&nbsp;<span class="op" id="4812029">:=</span>&nbsp;<span class="ident" id="4812032">nm1</span><span class="op" id="4812035">.</span><span class="ident" id="4812036">trailingZeroBits</span><span class="op" id="4812052">(</span><span class="op" id="4812053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812056">q</span>&nbsp;<span class="op" id="4812058">:=</span>&nbsp;<span class="ident" id="4812061">nat</span><span class="op" id="4812064">(</span><span class="ident" id="4812065">nil</span><span class="op" id="4812068">)</span><span class="op" id="4812069">.</span><span class="ident" id="4812070">shr</span><span class="op" id="4812073">(</span><span class="ident" id="4812074">nm1</span><span class="op" id="4812077">,</span>&nbsp;<span class="ident" id="4812079">k</span><span class="op" id="4812080">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812084">nm3</span>&nbsp;<span class="op" id="4812088">:=</span>&nbsp;<span class="ident" id="4812091">nat</span><span class="op" id="4812094">(</span><span class="ident" id="4812095">nil</span><span class="op" id="4812098">)</span><span class="op" id="4812099">.</span><span class="ident" id="4812100">sub</span><span class="op" id="4812103">(</span><span class="ident" id="4812104">nm1</span><span class="op" id="4812107">,</span>&nbsp;<span class="ident" id="4812109">natTwo</span><span class="op" id="4812115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812118">rand</span>&nbsp;<span class="op" id="4812123">:=</span>&nbsp;<span class="ident" id="4812126">rand</span><span class="op" id="4812130">.</span><span class="ident" id="4812131">New</span><span class="op" id="4812134">(</span><span class="ident" id="4812135">rand</span><span class="op" id="4812139">.</span><span class="ident" id="4812140">NewSource</span><span class="op" id="4812149">(</span><span class="ident" id="4812150">int64</span><span class="op" id="4812155">(</span><span class="ident" id="4812156">n</span><span class="op" id="4812157">[</span><span class="num" id="4812158">0</span><span class="op" id="4812159">]</span><span class="op" id="4812160">)</span><span class="op" id="4812161">)</span><span class="op" id="4812162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812166">var</span>&nbsp;<span class="ident" id="4812170">x</span><span class="op" id="4812171">,</span>&nbsp;<span class="ident" id="4812173">y</span><span class="op" id="4812174">,</span>&nbsp;<span class="ident" id="4812176">quotient</span>&nbsp;<span class="ident" id="4812185">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812190">nm3Len</span>&nbsp;<span class="op" id="4812197">:=</span>&nbsp;<span class="ident" id="4812200">nm3</span><span class="op" id="4812203">.</span><span class="ident" id="4812204">bitLen</span><span class="op" id="4812210">(</span><span class="op" id="4812211">)</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="ident" id="4812214">NextRandom</span><span class="op" id="4812224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812227">for</span>&nbsp;<span class="ident" id="4812231">i</span>&nbsp;<span class="op" id="4812233">:=</span>&nbsp;<span class="num" id="4812236">0</span><span class="op" id="4812237">;</span>&nbsp;<span class="ident" id="4812239">i</span>&nbsp;<span class="op" id="4812241">&lt;</span>&nbsp;<span class="ident" id="4812243">reps</span><span class="op" id="4812247">;</span>&nbsp;<span class="ident" id="4812249">i</span><span class="op" id="4812250">++</span>&nbsp;<span class="op" id="4812253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812257">x</span>&nbsp;<span class="op" id="4812259">=</span>&nbsp;<span class="ident" id="4812261">x</span><span class="op" id="4812262">.</span><span class="ident" id="4812263">random</span><span class="op" id="4812269">(</span><span class="ident" id="4812270">rand</span><span class="op" id="4812274">,</span>&nbsp;<span class="ident" id="4812276">nm3</span><span class="op" id="4812279">,</span>&nbsp;<span class="ident" id="4812281">nm3Len</span><span class="op" id="4812287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812291">x</span>&nbsp;<span class="op" id="4812293">=</span>&nbsp;<span class="ident" id="4812295">x</span><span class="op" id="4812296">.</span><span class="ident" id="4812297">add</span><span class="op" id="4812300">(</span><span class="ident" id="4812301">x</span><span class="op" id="4812302">,</span>&nbsp;<span class="ident" id="4812304">natTwo</span><span class="op" id="4812310">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812314">y</span>&nbsp;<span class="op" id="4812316">=</span>&nbsp;<span class="ident" id="4812318">y</span><span class="op" id="4812319">.</span><span class="ident" id="4812320">expNN</span><span class="op" id="4812325">(</span><span class="ident" id="4812326">x</span><span class="op" id="4812327">,</span>&nbsp;<span class="ident" id="4812329">q</span><span class="op" id="4812330">,</span>&nbsp;<span class="ident" id="4812332">n</span><span class="op" id="4812333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812337">if</span>&nbsp;<span class="ident" id="4812340">y</span><span class="op" id="4812341">.</span><span class="ident" id="4812342">cmp</span><span class="op" id="4812345">(</span><span class="ident" id="4812346">natOne</span><span class="op" id="4812352">)</span>&nbsp;<span class="op" id="4812354">==</span>&nbsp;<span class="num" id="4812357">0</span>&nbsp;<span class="op" id="4812359">||</span>&nbsp;<span class="ident" id="4812362">y</span><span class="op" id="4812363">.</span><span class="ident" id="4812364">cmp</span><span class="op" id="4812367">(</span><span class="ident" id="4812368">nm1</span><span class="op" id="4812371">)</span>&nbsp;<span class="op" id="4812373">==</span>&nbsp;<span class="num" id="4812376">0</span>&nbsp;<span class="op" id="4812378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812383">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4812394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812398">for</span>&nbsp;<span class="ident" id="4812402">j</span>&nbsp;<span class="op" id="4812404">:=</span>&nbsp;<span class="builtintype" id="4812407">uint</span><span class="op" id="4812411">(</span><span class="num" id="4812412">1</span><span class="op" id="4812413">)</span><span class="op" id="4812414">;</span>&nbsp;<span class="ident" id="4812416">j</span>&nbsp;<span class="op" id="4812418">&lt;</span>&nbsp;<span class="ident" id="4812420">k</span><span class="op" id="4812421">;</span>&nbsp;<span class="ident" id="4812423">j</span><span class="op" id="4812424">++</span>&nbsp;<span class="op" id="4812427">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812432">y</span>&nbsp;<span class="op" id="4812434">=</span>&nbsp;<span class="ident" id="4812436">y</span><span class="op" id="4812437">.</span><span class="ident" id="4812438">mul</span><span class="op" id="4812441">(</span><span class="ident" id="4812442">y</span><span class="op" id="4812443">,</span>&nbsp;<span class="ident" id="4812445">y</span><span class="op" id="4812446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812451">quotient</span><span class="op" id="4812459">,</span>&nbsp;<span class="ident" id="4812461">y</span>&nbsp;<span class="op" id="4812463">=</span>&nbsp;<span class="ident" id="4812465">quotient</span><span class="op" id="4812473">.</span><span class="ident" id="4812474">div</span><span class="op" id="4812477">(</span><span class="ident" id="4812478">y</span><span class="op" id="4812479">,</span>&nbsp;<span class="ident" id="4812481">y</span><span class="op" id="4812482">,</span>&nbsp;<span class="ident" id="4812484">n</span><span class="op" id="4812485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812490">if</span>&nbsp;<span class="ident" id="4812493">y</span><span class="op" id="4812494">.</span><span class="ident" id="4812495">cmp</span><span class="op" id="4812498">(</span><span class="ident" id="4812499">nm1</span><span class="op" id="4812502">)</span>&nbsp;<span class="op" id="4812504">==</span>&nbsp;<span class="num" id="4812507">0</span>&nbsp;<span class="op" id="4812509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812515">continue</span>&nbsp;<span class="ident" id="4812524">NextRandom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4812538">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812543">if</span>&nbsp;<span class="ident" id="4812546">y</span><span class="op" id="4812547">.</span><span class="ident" id="4812548">cmp</span><span class="op" id="4812551">(</span><span class="ident" id="4812552">natOne</span><span class="op" id="4812558">)</span>&nbsp;<span class="op" id="4812560">==</span>&nbsp;<span class="num" id="4812563">0</span>&nbsp;<span class="op" id="4812565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812571">return</span>&nbsp;<span class="builtintype" id="4812578">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4812587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4812591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812595">return</span>&nbsp;<span class="builtintype" id="4812602">false</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4812609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812613">return</span>&nbsp;<span class="builtintype" id="4812620">true</span><br>
<span class="lineno"></span><span class="op" id="4812625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1465</span><span class="comment" id="4812628">//&nbsp;bytes&nbsp;writes&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;into&nbsp;buf&nbsp;using&nbsp;big-endian&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4812695">//&nbsp;len(buf)&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;len(z)*_S.&nbsp;The&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4812762">//&nbsp;slice&nbsp;buf[i:].&nbsp;The&nbsp;number&nbsp;i&nbsp;of&nbsp;unused&nbsp;bytes&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4812829">//&nbsp;buf&nbsp;is&nbsp;returned&nbsp;as&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="4812859">func</span>&nbsp;<span class="op" id="4812864">(</span><span class="ident" id="4812865">z</span>&nbsp;<span class="ident" id="4812867">nat</span><span class="op" id="4812870">)</span>&nbsp;<span class="ident" id="4812872">bytes</span><span class="op" id="4812877">(</span><span class="ident" id="4812878">buf</span>&nbsp;<span class="op" id="4812882">[</span><span class="op" id="4812883">]</span><span class="builtintype" id="4812884">byte</span><span class="op" id="4812888">)</span>&nbsp;<span class="op" id="4812890">(</span><span class="ident" id="4812891">i</span>&nbsp;<span class="builtintype" id="4812893">int</span><span class="op" id="4812896">)</span>&nbsp;<span class="op" id="4812898">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812901">i</span>&nbsp;<span class="op" id="4812903">=</span>&nbsp;<span class="builtinfunc" id="4812905">len</span><span class="op" id="4812908">(</span><span class="ident" id="4812909">buf</span><span class="op" id="4812912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812915">for</span>&nbsp;<span class="ident" id="4812919">_</span><span class="op" id="4812920">,</span>&nbsp;<span class="ident" id="4812922">d</span>&nbsp;<span class="op" id="4812924">:=</span>&nbsp;<span class="keyword" id="4812927">range</span>&nbsp;<span class="ident" id="4812933">z</span>&nbsp;<span class="op" id="4812935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812939">for</span>&nbsp;<span class="ident" id="4812943">j</span>&nbsp;<span class="op" id="4812945">:=</span>&nbsp;<span class="num" id="4812948">0</span><span class="op" id="4812949">;</span>&nbsp;<span class="ident" id="4812951">j</span>&nbsp;<span class="op" id="4812953">&lt;</span>&nbsp;<span class="ident" id="4812955">_S</span><span class="op" id="4812957">;</span>&nbsp;<span class="ident" id="4812959">j</span><span class="op" id="4812960">++</span>&nbsp;<span class="op" id="4812963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812968">i</span><span class="op" id="4812969">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812975">buf</span><span class="op" id="4812978">[</span><span class="ident" id="4812979">i</span><span class="op" id="4812980">]</span>&nbsp;<span class="op" id="4812982">=</span>&nbsp;<span class="builtintype" id="4812984">byte</span><span class="op" id="4812988">(</span><span class="ident" id="4812989">d</span><span class="op" id="4812990">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812995">d</span>&nbsp;<span class="op" id="4812997">&gt;&gt;=</span>&nbsp;<span class="num" id="4813001">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813012">for</span>&nbsp;<span class="ident" id="4813016">i</span>&nbsp;<span class="op" id="4813018">&lt;</span>&nbsp;<span class="builtinfunc" id="4813020">len</span><span class="op" id="4813023">(</span><span class="ident" id="4813024">buf</span><span class="op" id="4813027">)</span>&nbsp;<span class="op" id="4813029">&amp;&amp;</span>&nbsp;<span class="ident" id="4813032">buf</span><span class="op" id="4813035">[</span><span class="ident" id="4813036">i</span><span class="op" id="4813037">]</span>&nbsp;<span class="op" id="4813039">==</span>&nbsp;<span class="num" id="4813042">0</span>&nbsp;<span class="op" id="4813044">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813048">i</span><span class="op" id="4813049">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813057">return</span><br>
<span class="lineno"></span><span class="op" id="4813064">}</span><br>
<span class="lineno">1485</span><br>
<span class="lineno"></span><span class="comment" id="4813067">//&nbsp;setBytes&nbsp;interprets&nbsp;buf&nbsp;as&nbsp;the&nbsp;bytes&nbsp;of&nbsp;a&nbsp;big-endian&nbsp;unsigned</span><br>
<span class="lineno"></span><span class="comment" id="4813132">//&nbsp;integer,&nbsp;sets&nbsp;z&nbsp;to&nbsp;that&nbsp;value,&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4813181">func</span>&nbsp;<span class="op" id="4813186">(</span><span class="ident" id="4813187">z</span>&nbsp;<span class="ident" id="4813189">nat</span><span class="op" id="4813192">)</span>&nbsp;<span class="ident" id="4813194">setBytes</span><span class="op" id="4813202">(</span><span class="ident" id="4813203">buf</span>&nbsp;<span class="op" id="4813207">[</span><span class="op" id="4813208">]</span><span class="builtintype" id="4813209">byte</span><span class="op" id="4813213">)</span>&nbsp;<span class="ident" id="4813215">nat</span>&nbsp;<span class="op" id="4813219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813222">z</span>&nbsp;<span class="op" id="4813224">=</span>&nbsp;<span class="ident" id="4813226">z</span><span class="op" id="4813227">.</span><span class="builtinfunc" id="4813228">make</span><span class="op" id="4813232">(</span><span class="op" id="4813233">(</span><span class="builtinfunc" id="4813234">len</span><span class="op" id="4813237">(</span><span class="ident" id="4813238">buf</span><span class="op" id="4813241">)</span>&nbsp;<span class="op" id="4813243">+</span>&nbsp;<span class="ident" id="4813245">_S</span>&nbsp;<span class="op" id="4813248">-</span>&nbsp;<span class="num" id="4813250">1</span><span class="op" id="4813251">)</span>&nbsp;<span class="op" id="4813253">/</span>&nbsp;<span class="ident" id="4813255">_S</span><span class="op" id="4813257">)</span><br>
<span class="lineno">1490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813261">k</span>&nbsp;<span class="op" id="4813263">:=</span>&nbsp;<span class="num" id="4813266">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813269">s</span>&nbsp;<span class="op" id="4813271">:=</span>&nbsp;<span class="builtintype" id="4813274">uint</span><span class="op" id="4813278">(</span><span class="num" id="4813279">0</span><span class="op" id="4813280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813283">var</span>&nbsp;<span class="ident" id="4813287">d</span>&nbsp;<span class="ident" id="4813289">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813295">for</span>&nbsp;<span class="ident" id="4813299">i</span>&nbsp;<span class="op" id="4813301">:=</span>&nbsp;<span class="builtinfunc" id="4813304">len</span><span class="op" id="4813307">(</span><span class="ident" id="4813308">buf</span><span class="op" id="4813311">)</span><span class="op" id="4813312">;</span>&nbsp;<span class="ident" id="4813314">i</span>&nbsp;<span class="op" id="4813316">&gt;</span>&nbsp;<span class="num" id="4813318">0</span><span class="op" id="4813319">;</span>&nbsp;<span class="ident" id="4813321">i</span><span class="op" id="4813322">--</span>&nbsp;<span class="op" id="4813325">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813329">d</span>&nbsp;<span class="op" id="4813331">|=</span>&nbsp;<span class="ident" id="4813334">Word</span><span class="op" id="4813338">(</span><span class="ident" id="4813339">buf</span><span class="op" id="4813342">[</span><span class="ident" id="4813343">i</span><span class="op" id="4813344">-</span><span class="num" id="4813345">1</span><span class="op" id="4813346">]</span><span class="op" id="4813347">)</span>&nbsp;<span class="op" id="4813349">&lt;&lt;</span>&nbsp;<span class="ident" id="4813352">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813356">if</span>&nbsp;<span class="ident" id="4813359">s</span>&nbsp;<span class="op" id="4813361">+=</span>&nbsp;<span class="num" id="4813364">8</span><span class="op" id="4813365">;</span>&nbsp;<span class="ident" id="4813367">s</span>&nbsp;<span class="op" id="4813369">==</span>&nbsp;<span class="ident" id="4813372">_S</span><span class="op" id="4813374">*</span><span class="num" id="4813375">8</span>&nbsp;<span class="op" id="4813377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813382">z</span><span class="op" id="4813383">[</span><span class="ident" id="4813384">k</span><span class="op" id="4813385">]</span>&nbsp;<span class="op" id="4813387">=</span>&nbsp;<span class="ident" id="4813389">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813394">k</span><span class="op" id="4813395">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813401">s</span>&nbsp;<span class="op" id="4813403">=</span>&nbsp;<span class="num" id="4813405">0</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813410">d</span>&nbsp;<span class="op" id="4813412">=</span>&nbsp;<span class="num" id="4813414">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813424">if</span>&nbsp;<span class="ident" id="4813427">k</span>&nbsp;<span class="op" id="4813429">&lt;</span>&nbsp;<span class="builtinfunc" id="4813431">len</span><span class="op" id="4813434">(</span><span class="ident" id="4813435">z</span><span class="op" id="4813436">)</span>&nbsp;<span class="op" id="4813438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813442">z</span><span class="op" id="4813443">[</span><span class="ident" id="4813444">k</span><span class="op" id="4813445">]</span>&nbsp;<span class="op" id="4813447">=</span>&nbsp;<span class="ident" id="4813449">d</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813456">return</span>&nbsp;<span class="ident" id="4813463">z</span><span class="op" id="4813464">.</span><span class="ident" id="4813465">norm</span><span class="op" id="4813469">(</span><span class="op" id="4813470">)</span><br>
<span class="lineno"></span><span class="op" id="4813472">}</span>
</div>
</body>
</html>
