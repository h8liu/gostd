<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8354616">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8354671">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8354725">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8354776">package</span>&nbsp;<span class="ident" id="8354784">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8354789">import</span>&nbsp;<span class="op" id="8354796">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8354799">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8354809">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8354816">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8354822">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8354829">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8354836">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8354857">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8354868">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8354879">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8354887">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8354902">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8354913">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="8354920">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8354923">var</span>&nbsp;<span class="op" id="8354927">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354930">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8354956">*</span><span class="ident" id="8354957">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354965">serverAddr</span><span class="op" id="8354975">,</span>&nbsp;<span class="ident" id="8354977">newServerAddr</span>&nbsp;<span class="builtintype" id="8354991">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354999">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8355025">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355033">once</span><span class="op" id="8355037">,</span>&nbsp;<span class="ident" id="8355039">newOnce</span><span class="op" id="8355046">,</span>&nbsp;<span class="ident" id="8355048">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8355059">sync</span><span class="op" id="8355063">.</span><span class="ident" id="8355064">Once</span><br>
<span class="lineno"></span><span class="op" id="8355069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8355072">const</span>&nbsp;<span class="op" id="8355078">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355081">newHttpPath</span>&nbsp;<span class="op" id="8355093">=</span>&nbsp;<span class="string" id="8355095">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="8355102">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8355105">type</span>&nbsp;<span class="ident" id="8355110">Args</span>&nbsp;<span class="keyword" id="8355115">struct</span>&nbsp;<span class="op" id="8355122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355125">A</span><span class="op" id="8355126">,</span>&nbsp;<span class="ident" id="8355128">B</span>&nbsp;<span class="builtintype" id="8355130">int</span><br>
<span class="lineno">35</span><span class="op" id="8355134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8355137">type</span>&nbsp;<span class="ident" id="8355142">Reply</span>&nbsp;<span class="keyword" id="8355148">struct</span>&nbsp;<span class="op" id="8355155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355158">C</span>&nbsp;<span class="builtintype" id="8355160">int</span><br>
<span class="lineno"></span><span class="op" id="8355164">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8355167">type</span>&nbsp;<span class="ident" id="8355172">Arith</span>&nbsp;<span class="builtintype" id="8355178">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8355183">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="8355271">func</span>&nbsp;<span class="op" id="8355276">(</span><span class="ident" id="8355277">t</span>&nbsp;<span class="op" id="8355279">*</span><span class="ident" id="8355280">Arith</span><span class="op" id="8355285">)</span>&nbsp;<span class="ident" id="8355287">Add</span><span class="op" id="8355290">(</span><span class="ident" id="8355291">args</span>&nbsp;<span class="ident" id="8355296">Args</span><span class="op" id="8355300">,</span>&nbsp;<span class="ident" id="8355302">reply</span>&nbsp;<span class="op" id="8355308">*</span><span class="ident" id="8355309">Reply</span><span class="op" id="8355314">)</span>&nbsp;<span class="builtintype" id="8355316">error</span>&nbsp;<span class="op" id="8355322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355325">reply</span><span class="op" id="8355330">.</span><span class="ident" id="8355331">C</span>&nbsp;<span class="op" id="8355333">=</span>&nbsp;<span class="ident" id="8355335">args</span><span class="op" id="8355339">.</span><span class="ident" id="8355340">A</span>&nbsp;<span class="op" id="8355342">+</span>&nbsp;<span class="ident" id="8355344">args</span><span class="op" id="8355348">.</span><span class="ident" id="8355349">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355352">return</span>&nbsp;<span class="ident" id="8355359">nil</span><br>
<span class="lineno"></span><span class="op" id="8355363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8355366">func</span>&nbsp;<span class="op" id="8355371">(</span><span class="ident" id="8355372">t</span>&nbsp;<span class="op" id="8355374">*</span><span class="ident" id="8355375">Arith</span><span class="op" id="8355380">)</span>&nbsp;<span class="ident" id="8355382">Mul</span><span class="op" id="8355385">(</span><span class="ident" id="8355386">args</span>&nbsp;<span class="op" id="8355391">*</span><span class="ident" id="8355392">Args</span><span class="op" id="8355396">,</span>&nbsp;<span class="ident" id="8355398">reply</span>&nbsp;<span class="op" id="8355404">*</span><span class="ident" id="8355405">Reply</span><span class="op" id="8355410">)</span>&nbsp;<span class="builtintype" id="8355412">error</span>&nbsp;<span class="op" id="8355418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355421">reply</span><span class="op" id="8355426">.</span><span class="ident" id="8355427">C</span>&nbsp;<span class="op" id="8355429">=</span>&nbsp;<span class="ident" id="8355431">args</span><span class="op" id="8355435">.</span><span class="ident" id="8355436">A</span>&nbsp;<span class="op" id="8355438">*</span>&nbsp;<span class="ident" id="8355440">args</span><span class="op" id="8355444">.</span><span class="ident" id="8355445">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355448">return</span>&nbsp;<span class="ident" id="8355455">nil</span><br>
<span class="lineno"></span><span class="op" id="8355459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8355462">func</span>&nbsp;<span class="op" id="8355467">(</span><span class="ident" id="8355468">t</span>&nbsp;<span class="op" id="8355470">*</span><span class="ident" id="8355471">Arith</span><span class="op" id="8355476">)</span>&nbsp;<span class="ident" id="8355478">Div</span><span class="op" id="8355481">(</span><span class="ident" id="8355482">args</span>&nbsp;<span class="ident" id="8355487">Args</span><span class="op" id="8355491">,</span>&nbsp;<span class="ident" id="8355493">reply</span>&nbsp;<span class="op" id="8355499">*</span><span class="ident" id="8355500">Reply</span><span class="op" id="8355505">)</span>&nbsp;<span class="builtintype" id="8355507">error</span>&nbsp;<span class="op" id="8355513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355516">if</span>&nbsp;<span class="ident" id="8355519">args</span><span class="op" id="8355523">.</span><span class="ident" id="8355524">B</span>&nbsp;<span class="op" id="8355526">==</span>&nbsp;<span class="num" id="8355529">0</span>&nbsp;<span class="op" id="8355531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355535">return</span>&nbsp;<span class="ident" id="8355542">errors</span><span class="op" id="8355548">.</span><span class="ident" id="8355549">New</span><span class="op" id="8355552">(</span><span class="string" id="8355553">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="8355569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355575">reply</span><span class="op" id="8355580">.</span><span class="ident" id="8355581">C</span>&nbsp;<span class="op" id="8355583">=</span>&nbsp;<span class="ident" id="8355585">args</span><span class="op" id="8355589">.</span><span class="ident" id="8355590">A</span>&nbsp;<span class="op" id="8355592">/</span>&nbsp;<span class="ident" id="8355594">args</span><span class="op" id="8355598">.</span><span class="ident" id="8355599">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355602">return</span>&nbsp;<span class="ident" id="8355609">nil</span><br>
<span class="lineno"></span><span class="op" id="8355613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8355616">func</span>&nbsp;<span class="op" id="8355621">(</span><span class="ident" id="8355622">t</span>&nbsp;<span class="op" id="8355624">*</span><span class="ident" id="8355625">Arith</span><span class="op" id="8355630">)</span>&nbsp;<span class="ident" id="8355632">String</span><span class="op" id="8355638">(</span><span class="ident" id="8355639">args</span>&nbsp;<span class="op" id="8355644">*</span><span class="ident" id="8355645">Args</span><span class="op" id="8355649">,</span>&nbsp;<span class="ident" id="8355651">reply</span>&nbsp;<span class="op" id="8355657">*</span><span class="builtintype" id="8355658">string</span><span class="op" id="8355664">)</span>&nbsp;<span class="builtintype" id="8355666">error</span>&nbsp;<span class="op" id="8355672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355675">*</span><span class="ident" id="8355676">reply</span>&nbsp;<span class="op" id="8355682">=</span>&nbsp;<span class="ident" id="8355684">fmt</span><span class="op" id="8355687">.</span><span class="ident" id="8355688">Sprintf</span><span class="op" id="8355695">(</span><span class="string" id="8355696">&#34;%d+%d=%d&#34;</span><span class="op" id="8355706">,</span>&nbsp;<span class="ident" id="8355708">args</span><span class="op" id="8355712">.</span><span class="ident" id="8355713">A</span><span class="op" id="8355714">,</span>&nbsp;<span class="ident" id="8355716">args</span><span class="op" id="8355720">.</span><span class="ident" id="8355721">B</span><span class="op" id="8355722">,</span>&nbsp;<span class="ident" id="8355724">args</span><span class="op" id="8355728">.</span><span class="ident" id="8355729">A</span><span class="op" id="8355730">+</span><span class="ident" id="8355731">args</span><span class="op" id="8355735">.</span><span class="ident" id="8355736">B</span><span class="op" id="8355737">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355740">return</span>&nbsp;<span class="ident" id="8355747">nil</span><br>
<span class="lineno"></span><span class="op" id="8355751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8355754">func</span>&nbsp;<span class="op" id="8355759">(</span><span class="ident" id="8355760">t</span>&nbsp;<span class="op" id="8355762">*</span><span class="ident" id="8355763">Arith</span><span class="op" id="8355768">)</span>&nbsp;<span class="ident" id="8355770">Scan</span><span class="op" id="8355774">(</span><span class="ident" id="8355775">args</span>&nbsp;<span class="builtintype" id="8355780">string</span><span class="op" id="8355786">,</span>&nbsp;<span class="ident" id="8355788">reply</span>&nbsp;<span class="op" id="8355794">*</span><span class="ident" id="8355795">Reply</span><span class="op" id="8355800">)</span>&nbsp;<span class="op" id="8355802">(</span><span class="ident" id="8355803">err</span>&nbsp;<span class="builtintype" id="8355807">error</span><span class="op" id="8355812">)</span>&nbsp;<span class="op" id="8355814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355817">_</span><span class="op" id="8355818">,</span>&nbsp;<span class="ident" id="8355820">err</span>&nbsp;<span class="op" id="8355824">=</span>&nbsp;<span class="ident" id="8355826">fmt</span><span class="op" id="8355829">.</span><span class="ident" id="8355830">Sscan</span><span class="op" id="8355835">(</span><span class="ident" id="8355836">args</span><span class="op" id="8355840">,</span>&nbsp;<span class="op" id="8355842">&amp;</span><span class="ident" id="8355843">reply</span><span class="op" id="8355848">.</span><span class="ident" id="8355849">C</span><span class="op" id="8355850">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355853">return</span><br>
<span class="lineno"></span><span class="op" id="8355860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8355863">func</span>&nbsp;<span class="op" id="8355868">(</span><span class="ident" id="8355869">t</span>&nbsp;<span class="op" id="8355871">*</span><span class="ident" id="8355872">Arith</span><span class="op" id="8355877">)</span>&nbsp;<span class="ident" id="8355879">Error</span><span class="op" id="8355884">(</span><span class="ident" id="8355885">args</span>&nbsp;<span class="op" id="8355890">*</span><span class="ident" id="8355891">Args</span><span class="op" id="8355895">,</span>&nbsp;<span class="ident" id="8355897">reply</span>&nbsp;<span class="op" id="8355903">*</span><span class="ident" id="8355904">Reply</span><span class="op" id="8355909">)</span>&nbsp;<span class="builtintype" id="8355911">error</span>&nbsp;<span class="op" id="8355917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8355920">panic</span><span class="op" id="8355925">(</span><span class="string" id="8355926">&#34;ERROR&#34;</span><span class="op" id="8355933">)</span><br>
<span class="lineno">75</span><span class="op" id="8355935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8355938">func</span>&nbsp;<span class="ident" id="8355943">listenTCP</span><span class="op" id="8355952">(</span><span class="op" id="8355953">)</span>&nbsp;<span class="op" id="8355955">(</span><span class="ident" id="8355956">net</span><span class="op" id="8355959">.</span><span class="ident" id="8355960">Listener</span><span class="op" id="8355968">,</span>&nbsp;<span class="builtintype" id="8355970">string</span><span class="op" id="8355976">)</span>&nbsp;<span class="op" id="8355978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355981">l</span><span class="op" id="8355982">,</span>&nbsp;<span class="ident" id="8355984">e</span>&nbsp;<span class="op" id="8355986">:=</span>&nbsp;<span class="ident" id="8355989">net</span><span class="op" id="8355992">.</span><span class="ident" id="8355993">Listen</span><span class="op" id="8355999">(</span><span class="string" id="8356000">&#34;tcp&#34;</span><span class="op" id="8356005">,</span>&nbsp;<span class="string" id="8356007">&#34;127.0.0.1:0&#34;</span><span class="op" id="8356020">)</span>&nbsp;<span class="comment" id="8356022">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356048">if</span>&nbsp;<span class="ident" id="8356051">e</span>&nbsp;<span class="op" id="8356053">!=</span>&nbsp;<span class="ident" id="8356056">nil</span>&nbsp;<span class="op" id="8356060">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356064">log</span><span class="op" id="8356067">.</span><span class="ident" id="8356068">Fatalf</span><span class="op" id="8356074">(</span><span class="string" id="8356075">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="8356098">,</span>&nbsp;<span class="ident" id="8356100">e</span><span class="op" id="8356101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356107">return</span>&nbsp;<span class="ident" id="8356114">l</span><span class="op" id="8356115">,</span>&nbsp;<span class="ident" id="8356117">l</span><span class="op" id="8356118">.</span><span class="ident" id="8356119">Addr</span><span class="op" id="8356123">(</span><span class="op" id="8356124">)</span><span class="op" id="8356125">.</span><span class="ident" id="8356126">String</span><span class="op" id="8356132">(</span><span class="op" id="8356133">)</span><br>
<span class="lineno"></span><span class="op" id="8356135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="8356138">func</span>&nbsp;<span class="ident" id="8356143">startServer</span><span class="op" id="8356154">(</span><span class="op" id="8356155">)</span>&nbsp;<span class="op" id="8356157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356160">Register</span><span class="op" id="8356168">(</span><span class="builtinfunc" id="8356169">new</span><span class="op" id="8356172">(</span><span class="ident" id="8356173">Arith</span><span class="op" id="8356178">)</span><span class="op" id="8356179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356182">RegisterName</span><span class="op" id="8356194">(</span><span class="string" id="8356195">&#34;net.rpc.Arith&#34;</span><span class="op" id="8356210">,</span>&nbsp;<span class="builtinfunc" id="8356212">new</span><span class="op" id="8356215">(</span><span class="ident" id="8356216">Arith</span><span class="op" id="8356221">)</span><span class="op" id="8356222">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356226">var</span>&nbsp;<span class="ident" id="8356230">l</span>&nbsp;<span class="ident" id="8356232">net</span><span class="op" id="8356235">.</span><span class="ident" id="8356236">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356246">l</span><span class="op" id="8356247">,</span>&nbsp;<span class="ident" id="8356249">serverAddr</span>&nbsp;<span class="op" id="8356260">=</span>&nbsp;<span class="ident" id="8356262">listenTCP</span><span class="op" id="8356271">(</span><span class="op" id="8356272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356275">log</span><span class="op" id="8356278">.</span><span class="ident" id="8356279">Println</span><span class="op" id="8356286">(</span><span class="string" id="8356287">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="8356317">,</span>&nbsp;<span class="ident" id="8356319">serverAddr</span><span class="op" id="8356329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356332">go</span>&nbsp;<span class="ident" id="8356335">Accept</span><span class="op" id="8356341">(</span><span class="ident" id="8356342">l</span><span class="op" id="8356343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356347">HandleHTTP</span><span class="op" id="8356357">(</span><span class="op" id="8356358">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356361">httpOnce</span><span class="op" id="8356369">.</span><span class="ident" id="8356370">Do</span><span class="op" id="8356372">(</span><span class="ident" id="8356373">startHttpServer</span><span class="op" id="8356388">)</span><br>
<span class="lineno"></span><span class="op" id="8356390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8356393">func</span>&nbsp;<span class="ident" id="8356398">startNewServer</span><span class="op" id="8356412">(</span><span class="op" id="8356413">)</span>&nbsp;<span class="op" id="8356415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356418">newServer</span>&nbsp;<span class="op" id="8356428">=</span>&nbsp;<span class="ident" id="8356430">NewServer</span><span class="op" id="8356439">(</span><span class="op" id="8356440">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356443">newServer</span><span class="op" id="8356452">.</span><span class="ident" id="8356453">Register</span><span class="op" id="8356461">(</span><span class="builtinfunc" id="8356462">new</span><span class="op" id="8356465">(</span><span class="ident" id="8356466">Arith</span><span class="op" id="8356471">)</span><span class="op" id="8356472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356475">newServer</span><span class="op" id="8356484">.</span><span class="ident" id="8356485">RegisterName</span><span class="op" id="8356497">(</span><span class="string" id="8356498">&#34;net.rpc.Arith&#34;</span><span class="op" id="8356513">,</span>&nbsp;<span class="builtinfunc" id="8356515">new</span><span class="op" id="8356518">(</span><span class="ident" id="8356519">Arith</span><span class="op" id="8356524">)</span><span class="op" id="8356525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356528">newServer</span><span class="op" id="8356537">.</span><span class="ident" id="8356538">RegisterName</span><span class="op" id="8356550">(</span><span class="string" id="8356551">&#34;newServer.Arith&#34;</span><span class="op" id="8356568">,</span>&nbsp;<span class="builtinfunc" id="8356570">new</span><span class="op" id="8356573">(</span><span class="ident" id="8356574">Arith</span><span class="op" id="8356579">)</span><span class="op" id="8356580">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356584">var</span>&nbsp;<span class="ident" id="8356588">l</span>&nbsp;<span class="ident" id="8356590">net</span><span class="op" id="8356593">.</span><span class="ident" id="8356594">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356604">l</span><span class="op" id="8356605">,</span>&nbsp;<span class="ident" id="8356607">newServerAddr</span>&nbsp;<span class="op" id="8356621">=</span>&nbsp;<span class="ident" id="8356623">listenTCP</span><span class="op" id="8356632">(</span><span class="op" id="8356633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356636">log</span><span class="op" id="8356639">.</span><span class="ident" id="8356640">Println</span><span class="op" id="8356647">(</span><span class="string" id="8356648">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="8356688">,</span>&nbsp;<span class="ident" id="8356690">newServerAddr</span><span class="op" id="8356703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356706">go</span>&nbsp;<span class="ident" id="8356709">newServer</span><span class="op" id="8356718">.</span><span class="ident" id="8356719">Accept</span><span class="op" id="8356725">(</span><span class="ident" id="8356726">l</span><span class="op" id="8356727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356731">newServer</span><span class="op" id="8356740">.</span><span class="ident" id="8356741">HandleHTTP</span><span class="op" id="8356751">(</span><span class="ident" id="8356752">newHttpPath</span><span class="op" id="8356763">,</span>&nbsp;<span class="string" id="8356765">&#34;/bar&#34;</span><span class="op" id="8356771">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356774">httpOnce</span><span class="op" id="8356782">.</span><span class="ident" id="8356783">Do</span><span class="op" id="8356785">(</span><span class="ident" id="8356786">startHttpServer</span><span class="op" id="8356801">)</span><br>
<span class="lineno"></span><span class="op" id="8356803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8356806">func</span>&nbsp;<span class="ident" id="8356811">startHttpServer</span><span class="op" id="8356826">(</span><span class="op" id="8356827">)</span>&nbsp;<span class="op" id="8356829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356832">server</span>&nbsp;<span class="op" id="8356839">:=</span>&nbsp;<span class="ident" id="8356842">httptest</span><span class="op" id="8356850">.</span><span class="ident" id="8356851">NewServer</span><span class="op" id="8356860">(</span><span class="ident" id="8356861">nil</span><span class="op" id="8356864">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356867">httpServerAddr</span>&nbsp;<span class="op" id="8356882">=</span>&nbsp;<span class="ident" id="8356884">server</span><span class="op" id="8356890">.</span><span class="ident" id="8356891">Listener</span><span class="op" id="8356899">.</span><span class="ident" id="8356900">Addr</span><span class="op" id="8356904">(</span><span class="op" id="8356905">)</span><span class="op" id="8356906">.</span><span class="ident" id="8356907">String</span><span class="op" id="8356913">(</span><span class="op" id="8356914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356917">log</span><span class="op" id="8356920">.</span><span class="ident" id="8356921">Println</span><span class="op" id="8356928">(</span><span class="string" id="8356929">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="8356964">,</span>&nbsp;<span class="ident" id="8356966">httpServerAddr</span><span class="op" id="8356980">)</span><br>
<span class="lineno"></span><span class="op" id="8356982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8356985">func</span>&nbsp;<span class="ident" id="8356990">TestRPC</span><span class="op" id="8356997">(</span><span class="ident" id="8356998">t</span>&nbsp;<span class="op" id="8357000">*</span><span class="ident" id="8357001">testing</span><span class="op" id="8357008">.</span><span class="ident" id="8357009">T</span><span class="op" id="8357010">)</span>&nbsp;<span class="op" id="8357012">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357015">once</span><span class="op" id="8357019">.</span><span class="ident" id="8357020">Do</span><span class="op" id="8357022">(</span><span class="ident" id="8357023">startServer</span><span class="op" id="8357034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357037">testRPC</span><span class="op" id="8357044">(</span><span class="ident" id="8357045">t</span><span class="op" id="8357046">,</span>&nbsp;<span class="ident" id="8357048">serverAddr</span><span class="op" id="8357058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357061">newOnce</span><span class="op" id="8357068">.</span><span class="ident" id="8357069">Do</span><span class="op" id="8357071">(</span><span class="ident" id="8357072">startNewServer</span><span class="op" id="8357086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357089">testRPC</span><span class="op" id="8357096">(</span><span class="ident" id="8357097">t</span><span class="op" id="8357098">,</span>&nbsp;<span class="ident" id="8357100">newServerAddr</span><span class="op" id="8357113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357116">testNewServerRPC</span><span class="op" id="8357132">(</span><span class="ident" id="8357133">t</span><span class="op" id="8357134">,</span>&nbsp;<span class="ident" id="8357136">newServerAddr</span><span class="op" id="8357149">)</span><br>
<span class="lineno">125</span><span class="op" id="8357151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8357154">func</span>&nbsp;<span class="ident" id="8357159">testRPC</span><span class="op" id="8357166">(</span><span class="ident" id="8357167">t</span>&nbsp;<span class="op" id="8357169">*</span><span class="ident" id="8357170">testing</span><span class="op" id="8357177">.</span><span class="ident" id="8357178">T</span><span class="op" id="8357179">,</span>&nbsp;<span class="ident" id="8357181">addr</span>&nbsp;<span class="builtintype" id="8357186">string</span><span class="op" id="8357192">)</span>&nbsp;<span class="op" id="8357194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357197">client</span><span class="op" id="8357203">,</span>&nbsp;<span class="ident" id="8357205">err</span>&nbsp;<span class="op" id="8357209">:=</span>&nbsp;<span class="ident" id="8357212">Dial</span><span class="op" id="8357216">(</span><span class="string" id="8357217">&#34;tcp&#34;</span><span class="op" id="8357222">,</span>&nbsp;<span class="ident" id="8357224">addr</span><span class="op" id="8357228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357231">if</span>&nbsp;<span class="ident" id="8357234">err</span>&nbsp;<span class="op" id="8357238">!=</span>&nbsp;<span class="ident" id="8357241">nil</span>&nbsp;<span class="op" id="8357245">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357249">t</span><span class="op" id="8357250">.</span><span class="ident" id="8357251">Fatal</span><span class="op" id="8357256">(</span><span class="string" id="8357257">&#34;dialing&#34;</span><span class="op" id="8357266">,</span>&nbsp;<span class="ident" id="8357268">err</span><span class="op" id="8357271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357277">defer</span>&nbsp;<span class="ident" id="8357283">client</span><span class="op" id="8357289">.</span><span class="ident" id="8357290">Close</span><span class="op" id="8357295">(</span><span class="op" id="8357296">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8357300">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357322">args</span>&nbsp;<span class="op" id="8357327">:=</span>&nbsp;<span class="op" id="8357330">&amp;</span><span class="ident" id="8357331">Args</span><span class="op" id="8357335">{</span><span class="num" id="8357336">7</span><span class="op" id="8357337">,</span>&nbsp;<span class="num" id="8357339">8</span><span class="op" id="8357340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357343">reply</span>&nbsp;<span class="op" id="8357349">:=</span>&nbsp;<span class="builtinfunc" id="8357352">new</span><span class="op" id="8357355">(</span><span class="ident" id="8357356">Reply</span><span class="op" id="8357361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357364">err</span>&nbsp;<span class="op" id="8357368">=</span>&nbsp;<span class="ident" id="8357370">client</span><span class="op" id="8357376">.</span><span class="ident" id="8357377">Call</span><span class="op" id="8357381">(</span><span class="string" id="8357382">&#34;Arith.Add&#34;</span><span class="op" id="8357393">,</span>&nbsp;<span class="ident" id="8357395">args</span><span class="op" id="8357399">,</span>&nbsp;<span class="ident" id="8357401">reply</span><span class="op" id="8357406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357409">if</span>&nbsp;<span class="ident" id="8357412">err</span>&nbsp;<span class="op" id="8357416">!=</span>&nbsp;<span class="ident" id="8357419">nil</span>&nbsp;<span class="op" id="8357423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357427">t</span><span class="op" id="8357428">.</span><span class="ident" id="8357429">Errorf</span><span class="op" id="8357435">(</span><span class="string" id="8357436">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8357478">,</span>&nbsp;<span class="ident" id="8357480">err</span><span class="op" id="8357483">.</span><span class="ident" id="8357484">Error</span><span class="op" id="8357489">(</span><span class="op" id="8357490">)</span><span class="op" id="8357491">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357497">if</span>&nbsp;<span class="ident" id="8357500">reply</span><span class="op" id="8357505">.</span><span class="ident" id="8357506">C</span>&nbsp;<span class="op" id="8357508">!=</span>&nbsp;<span class="ident" id="8357511">args</span><span class="op" id="8357515">.</span><span class="ident" id="8357516">A</span><span class="op" id="8357517">+</span><span class="ident" id="8357518">args</span><span class="op" id="8357522">.</span><span class="ident" id="8357523">B</span>&nbsp;<span class="op" id="8357525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357529">t</span><span class="op" id="8357530">.</span><span class="ident" id="8357531">Errorf</span><span class="op" id="8357537">(</span><span class="string" id="8357538">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8357563">,</span>&nbsp;<span class="ident" id="8357565">reply</span><span class="op" id="8357570">.</span><span class="ident" id="8357571">C</span><span class="op" id="8357572">,</span>&nbsp;<span class="ident" id="8357574">args</span><span class="op" id="8357578">.</span><span class="ident" id="8357579">A</span><span class="op" id="8357580">+</span><span class="ident" id="8357581">args</span><span class="op" id="8357585">.</span><span class="ident" id="8357586">B</span><span class="op" id="8357587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8357594">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357617">args</span>&nbsp;<span class="op" id="8357622">=</span>&nbsp;<span class="op" id="8357624">&amp;</span><span class="ident" id="8357625">Args</span><span class="op" id="8357629">{</span><span class="num" id="8357630">7</span><span class="op" id="8357631">,</span>&nbsp;<span class="num" id="8357633">0</span><span class="op" id="8357634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357637">reply</span>&nbsp;<span class="op" id="8357643">=</span>&nbsp;<span class="builtinfunc" id="8357645">new</span><span class="op" id="8357648">(</span><span class="ident" id="8357649">Reply</span><span class="op" id="8357654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357657">err</span>&nbsp;<span class="op" id="8357661">=</span>&nbsp;<span class="ident" id="8357663">client</span><span class="op" id="8357669">.</span><span class="ident" id="8357670">Call</span><span class="op" id="8357674">(</span><span class="string" id="8357675">&#34;Arith.BadOperation&#34;</span><span class="op" id="8357695">,</span>&nbsp;<span class="ident" id="8357697">args</span><span class="op" id="8357701">,</span>&nbsp;<span class="ident" id="8357703">reply</span><span class="op" id="8357708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8357711">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357731">if</span>&nbsp;<span class="ident" id="8357734">err</span>&nbsp;<span class="op" id="8357738">==</span>&nbsp;<span class="ident" id="8357741">nil</span>&nbsp;<span class="op" id="8357745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357749">t</span><span class="op" id="8357750">.</span><span class="ident" id="8357751">Error</span><span class="op" id="8357756">(</span><span class="string" id="8357757">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8357787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357790">}</span>&nbsp;<span class="keyword" id="8357792">else</span>&nbsp;<span class="keyword" id="8357797">if</span>&nbsp;<span class="op" id="8357800">!</span><span class="ident" id="8357801">strings</span><span class="op" id="8357808">.</span><span class="ident" id="8357809">HasPrefix</span><span class="op" id="8357818">(</span><span class="ident" id="8357819">err</span><span class="op" id="8357822">.</span><span class="ident" id="8357823">Error</span><span class="op" id="8357828">(</span><span class="op" id="8357829">)</span><span class="op" id="8357830">,</span>&nbsp;<span class="string" id="8357832">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="8357857">)</span>&nbsp;<span class="op" id="8357859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357863">t</span><span class="op" id="8357864">.</span><span class="ident" id="8357865">Errorf</span><span class="op" id="8357871">(</span><span class="string" id="8357872">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8357928">,</span>&nbsp;<span class="ident" id="8357930">err</span><span class="op" id="8357933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357936">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8357940">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357960">args</span>&nbsp;<span class="op" id="8357965">=</span>&nbsp;<span class="op" id="8357967">&amp;</span><span class="ident" id="8357968">Args</span><span class="op" id="8357972">{</span><span class="num" id="8357973">7</span><span class="op" id="8357974">,</span>&nbsp;<span class="num" id="8357976">8</span><span class="op" id="8357977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357980">reply</span>&nbsp;<span class="op" id="8357986">=</span>&nbsp;<span class="builtinfunc" id="8357988">new</span><span class="op" id="8357991">(</span><span class="ident" id="8357992">Reply</span><span class="op" id="8357997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358000">err</span>&nbsp;<span class="op" id="8358004">=</span>&nbsp;<span class="ident" id="8358006">client</span><span class="op" id="8358012">.</span><span class="ident" id="8358013">Call</span><span class="op" id="8358017">(</span><span class="string" id="8358018">&#34;Arith.Unknown&#34;</span><span class="op" id="8358033">,</span>&nbsp;<span class="ident" id="8358035">args</span><span class="op" id="8358039">,</span>&nbsp;<span class="ident" id="8358041">reply</span><span class="op" id="8358046">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358049">if</span>&nbsp;<span class="ident" id="8358052">err</span>&nbsp;<span class="op" id="8358056">==</span>&nbsp;<span class="ident" id="8358059">nil</span>&nbsp;<span class="op" id="8358063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358067">t</span><span class="op" id="8358068">.</span><span class="ident" id="8358069">Error</span><span class="op" id="8358074">(</span><span class="string" id="8358075">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="8358115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358118">}</span>&nbsp;<span class="keyword" id="8358120">else</span>&nbsp;<span class="keyword" id="8358125">if</span>&nbsp;<span class="ident" id="8358128">strings</span><span class="op" id="8358135">.</span><span class="ident" id="8358136">Index</span><span class="op" id="8358141">(</span><span class="ident" id="8358142">err</span><span class="op" id="8358145">.</span><span class="ident" id="8358146">Error</span><span class="op" id="8358151">(</span><span class="op" id="8358152">)</span><span class="op" id="8358153">,</span>&nbsp;<span class="string" id="8358155">&#34;method&#34;</span><span class="op" id="8358163">)</span>&nbsp;<span class="op" id="8358165">&lt;</span>&nbsp;<span class="num" id="8358167">0</span>&nbsp;<span class="op" id="8358169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358173">t</span><span class="op" id="8358174">.</span><span class="ident" id="8358175">Error</span><span class="op" id="8358180">(</span><span class="string" id="8358181">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="8358215">,</span>&nbsp;<span class="ident" id="8358217">err</span><span class="op" id="8358220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358223">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8358227">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358245">args</span>&nbsp;<span class="op" id="8358250">=</span>&nbsp;<span class="op" id="8358252">&amp;</span><span class="ident" id="8358253">Args</span><span class="op" id="8358257">{</span><span class="num" id="8358258">7</span><span class="op" id="8358259">,</span>&nbsp;<span class="num" id="8358261">8</span><span class="op" id="8358262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358265">mulReply</span>&nbsp;<span class="op" id="8358274">:=</span>&nbsp;<span class="builtinfunc" id="8358277">new</span><span class="op" id="8358280">(</span><span class="ident" id="8358281">Reply</span><span class="op" id="8358286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358289">mulCall</span>&nbsp;<span class="op" id="8358297">:=</span>&nbsp;<span class="ident" id="8358300">client</span><span class="op" id="8358306">.</span><span class="ident" id="8358307">Go</span><span class="op" id="8358309">(</span><span class="string" id="8358310">&#34;Arith.Mul&#34;</span><span class="op" id="8358321">,</span>&nbsp;<span class="ident" id="8358323">args</span><span class="op" id="8358327">,</span>&nbsp;<span class="ident" id="8358329">mulReply</span><span class="op" id="8358337">,</span>&nbsp;<span class="ident" id="8358339">nil</span><span class="op" id="8358342">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358345">addReply</span>&nbsp;<span class="op" id="8358354">:=</span>&nbsp;<span class="builtinfunc" id="8358357">new</span><span class="op" id="8358360">(</span><span class="ident" id="8358361">Reply</span><span class="op" id="8358366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358369">addCall</span>&nbsp;<span class="op" id="8358377">:=</span>&nbsp;<span class="ident" id="8358380">client</span><span class="op" id="8358386">.</span><span class="ident" id="8358387">Go</span><span class="op" id="8358389">(</span><span class="string" id="8358390">&#34;Arith.Add&#34;</span><span class="op" id="8358401">,</span>&nbsp;<span class="ident" id="8358403">args</span><span class="op" id="8358407">,</span>&nbsp;<span class="ident" id="8358409">addReply</span><span class="op" id="8358417">,</span>&nbsp;<span class="ident" id="8358419">nil</span><span class="op" id="8358422">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358426">addCall</span>&nbsp;<span class="op" id="8358434">=</span>&nbsp;<span class="op" id="8358436">&lt;-</span><span class="ident" id="8358438">addCall</span><span class="op" id="8358445">.</span><span class="ident" id="8358446">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358452">if</span>&nbsp;<span class="ident" id="8358455">addCall</span><span class="op" id="8358462">.</span><span class="ident" id="8358463">Error</span>&nbsp;<span class="op" id="8358469">!=</span>&nbsp;<span class="ident" id="8358472">nil</span>&nbsp;<span class="op" id="8358476">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358480">t</span><span class="op" id="8358481">.</span><span class="ident" id="8358482">Errorf</span><span class="op" id="8358488">(</span><span class="string" id="8358489">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8358531">,</span>&nbsp;<span class="ident" id="8358533">addCall</span><span class="op" id="8358540">.</span><span class="ident" id="8358541">Error</span><span class="op" id="8358546">.</span><span class="ident" id="8358547">Error</span><span class="op" id="8358552">(</span><span class="op" id="8358553">)</span><span class="op" id="8358554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358560">if</span>&nbsp;<span class="ident" id="8358563">addReply</span><span class="op" id="8358571">.</span><span class="ident" id="8358572">C</span>&nbsp;<span class="op" id="8358574">!=</span>&nbsp;<span class="ident" id="8358577">args</span><span class="op" id="8358581">.</span><span class="ident" id="8358582">A</span><span class="op" id="8358583">+</span><span class="ident" id="8358584">args</span><span class="op" id="8358588">.</span><span class="ident" id="8358589">B</span>&nbsp;<span class="op" id="8358591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358595">t</span><span class="op" id="8358596">.</span><span class="ident" id="8358597">Errorf</span><span class="op" id="8358603">(</span><span class="string" id="8358604">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8358629">,</span>&nbsp;<span class="ident" id="8358631">addReply</span><span class="op" id="8358639">.</span><span class="ident" id="8358640">C</span><span class="op" id="8358641">,</span>&nbsp;<span class="ident" id="8358643">args</span><span class="op" id="8358647">.</span><span class="ident" id="8358648">A</span><span class="op" id="8358649">+</span><span class="ident" id="8358650">args</span><span class="op" id="8358654">.</span><span class="ident" id="8358655">B</span><span class="op" id="8358656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358659">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358663">mulCall</span>&nbsp;<span class="op" id="8358671">=</span>&nbsp;<span class="op" id="8358673">&lt;-</span><span class="ident" id="8358675">mulCall</span><span class="op" id="8358682">.</span><span class="ident" id="8358683">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358689">if</span>&nbsp;<span class="ident" id="8358692">mulCall</span><span class="op" id="8358699">.</span><span class="ident" id="8358700">Error</span>&nbsp;<span class="op" id="8358706">!=</span>&nbsp;<span class="ident" id="8358709">nil</span>&nbsp;<span class="op" id="8358713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358717">t</span><span class="op" id="8358718">.</span><span class="ident" id="8358719">Errorf</span><span class="op" id="8358725">(</span><span class="string" id="8358726">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8358768">,</span>&nbsp;<span class="ident" id="8358770">mulCall</span><span class="op" id="8358777">.</span><span class="ident" id="8358778">Error</span><span class="op" id="8358783">.</span><span class="ident" id="8358784">Error</span><span class="op" id="8358789">(</span><span class="op" id="8358790">)</span><span class="op" id="8358791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358794">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358797">if</span>&nbsp;<span class="ident" id="8358800">mulReply</span><span class="op" id="8358808">.</span><span class="ident" id="8358809">C</span>&nbsp;<span class="op" id="8358811">!=</span>&nbsp;<span class="ident" id="8358814">args</span><span class="op" id="8358818">.</span><span class="ident" id="8358819">A</span><span class="op" id="8358820">*</span><span class="ident" id="8358821">args</span><span class="op" id="8358825">.</span><span class="ident" id="8358826">B</span>&nbsp;<span class="op" id="8358828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358832">t</span><span class="op" id="8358833">.</span><span class="ident" id="8358834">Errorf</span><span class="op" id="8358840">(</span><span class="string" id="8358841">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8358866">,</span>&nbsp;<span class="ident" id="8358868">mulReply</span><span class="op" id="8358876">.</span><span class="ident" id="8358877">C</span><span class="op" id="8358878">,</span>&nbsp;<span class="ident" id="8358880">args</span><span class="op" id="8358884">.</span><span class="ident" id="8358885">A</span><span class="op" id="8358886">*</span><span class="ident" id="8358887">args</span><span class="op" id="8358891">.</span><span class="ident" id="8358892">B</span><span class="op" id="8358893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8358900">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358915">args</span>&nbsp;<span class="op" id="8358920">=</span>&nbsp;<span class="op" id="8358922">&amp;</span><span class="ident" id="8358923">Args</span><span class="op" id="8358927">{</span><span class="num" id="8358928">7</span><span class="op" id="8358929">,</span>&nbsp;<span class="num" id="8358931">0</span><span class="op" id="8358932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358935">reply</span>&nbsp;<span class="op" id="8358941">=</span>&nbsp;<span class="builtinfunc" id="8358943">new</span><span class="op" id="8358946">(</span><span class="ident" id="8358947">Reply</span><span class="op" id="8358952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358955">err</span>&nbsp;<span class="op" id="8358959">=</span>&nbsp;<span class="ident" id="8358961">client</span><span class="op" id="8358967">.</span><span class="ident" id="8358968">Call</span><span class="op" id="8358972">(</span><span class="string" id="8358973">&#34;Arith.Div&#34;</span><span class="op" id="8358984">,</span>&nbsp;<span class="ident" id="8358986">args</span><span class="op" id="8358990">,</span>&nbsp;<span class="ident" id="8358992">reply</span><span class="op" id="8358997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8359000">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359033">if</span>&nbsp;<span class="ident" id="8359036">err</span>&nbsp;<span class="op" id="8359040">==</span>&nbsp;<span class="ident" id="8359043">nil</span>&nbsp;<span class="op" id="8359047">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359051">t</span><span class="op" id="8359052">.</span><span class="ident" id="8359053">Error</span><span class="op" id="8359058">(</span><span class="string" id="8359059">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8359080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359083">}</span>&nbsp;<span class="keyword" id="8359085">else</span>&nbsp;<span class="keyword" id="8359090">if</span>&nbsp;<span class="ident" id="8359093">err</span><span class="op" id="8359096">.</span><span class="ident" id="8359097">Error</span><span class="op" id="8359102">(</span><span class="op" id="8359103">)</span>&nbsp;<span class="op" id="8359105">!=</span>&nbsp;<span class="string" id="8359108">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="8359125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359129">t</span><span class="op" id="8359130">.</span><span class="ident" id="8359131">Error</span><span class="op" id="8359136">(</span><span class="string" id="8359137">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8359178">,</span>&nbsp;<span class="ident" id="8359180">err</span><span class="op" id="8359183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8359190">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359204">reply</span>&nbsp;<span class="op" id="8359210">=</span>&nbsp;<span class="builtinfunc" id="8359212">new</span><span class="op" id="8359215">(</span><span class="ident" id="8359216">Reply</span><span class="op" id="8359221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359224">err</span>&nbsp;<span class="op" id="8359228">=</span>&nbsp;<span class="ident" id="8359230">client</span><span class="op" id="8359236">.</span><span class="ident" id="8359237">Call</span><span class="op" id="8359241">(</span><span class="string" id="8359242">&#34;Arith.Add&#34;</span><span class="op" id="8359253">,</span>&nbsp;<span class="ident" id="8359255">reply</span><span class="op" id="8359260">,</span>&nbsp;<span class="ident" id="8359262">reply</span><span class="op" id="8359267">)</span>&nbsp;<span class="comment" id="8359269">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359319">if</span>&nbsp;<span class="ident" id="8359322">err</span>&nbsp;<span class="op" id="8359326">==</span>&nbsp;<span class="ident" id="8359329">nil</span>&nbsp;<span class="op" id="8359333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359337">t</span><span class="op" id="8359338">.</span><span class="ident" id="8359339">Error</span><span class="op" id="8359344">(</span><span class="string" id="8359345">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="8359399">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359402">}</span>&nbsp;<span class="keyword" id="8359404">else</span>&nbsp;<span class="keyword" id="8359409">if</span>&nbsp;<span class="ident" id="8359412">strings</span><span class="op" id="8359419">.</span><span class="ident" id="8359420">Index</span><span class="op" id="8359425">(</span><span class="ident" id="8359426">err</span><span class="op" id="8359429">.</span><span class="ident" id="8359430">Error</span><span class="op" id="8359435">(</span><span class="op" id="8359436">)</span><span class="op" id="8359437">,</span>&nbsp;<span class="string" id="8359439">&#34;type&#34;</span><span class="op" id="8359445">)</span>&nbsp;<span class="op" id="8359447">&lt;</span>&nbsp;<span class="num" id="8359449">0</span>&nbsp;<span class="op" id="8359451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359455">t</span><span class="op" id="8359456">.</span><span class="ident" id="8359457">Error</span><span class="op" id="8359462">(</span><span class="string" id="8359463">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="8359495">,</span>&nbsp;<span class="ident" id="8359497">err</span><span class="op" id="8359500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8359507">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359531">const</span>&nbsp;<span class="ident" id="8359537">Val</span>&nbsp;<span class="op" id="8359541">=</span>&nbsp;<span class="num" id="8359543">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359550">str</span>&nbsp;<span class="op" id="8359554">:=</span>&nbsp;<span class="ident" id="8359557">fmt</span><span class="op" id="8359560">.</span><span class="ident" id="8359561">Sprint</span><span class="op" id="8359567">(</span><span class="ident" id="8359568">Val</span><span class="op" id="8359571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359574">reply</span>&nbsp;<span class="op" id="8359580">=</span>&nbsp;<span class="builtinfunc" id="8359582">new</span><span class="op" id="8359585">(</span><span class="ident" id="8359586">Reply</span><span class="op" id="8359591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359594">err</span>&nbsp;<span class="op" id="8359598">=</span>&nbsp;<span class="ident" id="8359600">client</span><span class="op" id="8359606">.</span><span class="ident" id="8359607">Call</span><span class="op" id="8359611">(</span><span class="string" id="8359612">&#34;Arith.Scan&#34;</span><span class="op" id="8359624">,</span>&nbsp;<span class="op" id="8359626">&amp;</span><span class="ident" id="8359627">str</span><span class="op" id="8359630">,</span>&nbsp;<span class="ident" id="8359632">reply</span><span class="op" id="8359637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359640">if</span>&nbsp;<span class="ident" id="8359643">err</span>&nbsp;<span class="op" id="8359647">!=</span>&nbsp;<span class="ident" id="8359650">nil</span>&nbsp;<span class="op" id="8359654">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359658">t</span><span class="op" id="8359659">.</span><span class="ident" id="8359660">Errorf</span><span class="op" id="8359666">(</span><span class="string" id="8359667">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8359710">,</span>&nbsp;<span class="ident" id="8359712">err</span><span class="op" id="8359715">.</span><span class="ident" id="8359716">Error</span><span class="op" id="8359721">(</span><span class="op" id="8359722">)</span><span class="op" id="8359723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359726">}</span>&nbsp;<span class="keyword" id="8359728">else</span>&nbsp;<span class="keyword" id="8359733">if</span>&nbsp;<span class="ident" id="8359736">reply</span><span class="op" id="8359741">.</span><span class="ident" id="8359742">C</span>&nbsp;<span class="op" id="8359744">!=</span>&nbsp;<span class="ident" id="8359747">Val</span>&nbsp;<span class="op" id="8359751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359755">t</span><span class="op" id="8359756">.</span><span class="ident" id="8359757">Errorf</span><span class="op" id="8359763">(</span><span class="string" id="8359764">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8359790">,</span>&nbsp;<span class="ident" id="8359792">Val</span><span class="op" id="8359795">,</span>&nbsp;<span class="ident" id="8359797">reply</span><span class="op" id="8359802">.</span><span class="ident" id="8359803">C</span><span class="op" id="8359804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8359811">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359832">args</span>&nbsp;<span class="op" id="8359837">=</span>&nbsp;<span class="op" id="8359839">&amp;</span><span class="ident" id="8359840">Args</span><span class="op" id="8359844">{</span><span class="num" id="8359845">27</span><span class="op" id="8359847">,</span>&nbsp;<span class="num" id="8359849">35</span><span class="op" id="8359851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359854">str</span>&nbsp;<span class="op" id="8359858">=</span>&nbsp;<span class="string" id="8359860">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359864">err</span>&nbsp;<span class="op" id="8359868">=</span>&nbsp;<span class="ident" id="8359870">client</span><span class="op" id="8359876">.</span><span class="ident" id="8359877">Call</span><span class="op" id="8359881">(</span><span class="string" id="8359882">&#34;Arith.String&#34;</span><span class="op" id="8359896">,</span>&nbsp;<span class="ident" id="8359898">args</span><span class="op" id="8359902">,</span>&nbsp;<span class="op" id="8359904">&amp;</span><span class="ident" id="8359905">str</span><span class="op" id="8359908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359911">if</span>&nbsp;<span class="ident" id="8359914">err</span>&nbsp;<span class="op" id="8359918">!=</span>&nbsp;<span class="ident" id="8359921">nil</span>&nbsp;<span class="op" id="8359925">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359929">t</span><span class="op" id="8359930">.</span><span class="ident" id="8359931">Errorf</span><span class="op" id="8359937">(</span><span class="string" id="8359938">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8359983">,</span>&nbsp;<span class="ident" id="8359985">err</span><span class="op" id="8359988">.</span><span class="ident" id="8359989">Error</span><span class="op" id="8359994">(</span><span class="op" id="8359995">)</span><span class="op" id="8359996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360002">expect</span>&nbsp;<span class="op" id="8360009">:=</span>&nbsp;<span class="ident" id="8360012">fmt</span><span class="op" id="8360015">.</span><span class="ident" id="8360016">Sprintf</span><span class="op" id="8360023">(</span><span class="string" id="8360024">&#34;%d+%d=%d&#34;</span><span class="op" id="8360034">,</span>&nbsp;<span class="ident" id="8360036">args</span><span class="op" id="8360040">.</span><span class="ident" id="8360041">A</span><span class="op" id="8360042">,</span>&nbsp;<span class="ident" id="8360044">args</span><span class="op" id="8360048">.</span><span class="ident" id="8360049">B</span><span class="op" id="8360050">,</span>&nbsp;<span class="ident" id="8360052">args</span><span class="op" id="8360056">.</span><span class="ident" id="8360057">A</span><span class="op" id="8360058">+</span><span class="ident" id="8360059">args</span><span class="op" id="8360063">.</span><span class="ident" id="8360064">B</span><span class="op" id="8360065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360068">if</span>&nbsp;<span class="ident" id="8360071">str</span>&nbsp;<span class="op" id="8360075">!=</span>&nbsp;<span class="ident" id="8360078">expect</span>&nbsp;<span class="op" id="8360085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360089">t</span><span class="op" id="8360090">.</span><span class="ident" id="8360091">Errorf</span><span class="op" id="8360097">(</span><span class="string" id="8360098">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8360126">,</span>&nbsp;<span class="ident" id="8360128">expect</span><span class="op" id="8360134">,</span>&nbsp;<span class="ident" id="8360136">str</span><span class="op" id="8360139">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360146">args</span>&nbsp;<span class="op" id="8360151">=</span>&nbsp;<span class="op" id="8360153">&amp;</span><span class="ident" id="8360154">Args</span><span class="op" id="8360158">{</span><span class="num" id="8360159">7</span><span class="op" id="8360160">,</span>&nbsp;<span class="num" id="8360162">8</span><span class="op" id="8360163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360166">reply</span>&nbsp;<span class="op" id="8360172">=</span>&nbsp;<span class="builtinfunc" id="8360174">new</span><span class="op" id="8360177">(</span><span class="ident" id="8360178">Reply</span><span class="op" id="8360183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360186">err</span>&nbsp;<span class="op" id="8360190">=</span>&nbsp;<span class="ident" id="8360192">client</span><span class="op" id="8360198">.</span><span class="ident" id="8360199">Call</span><span class="op" id="8360203">(</span><span class="string" id="8360204">&#34;Arith.Mul&#34;</span><span class="op" id="8360215">,</span>&nbsp;<span class="ident" id="8360217">args</span><span class="op" id="8360221">,</span>&nbsp;<span class="ident" id="8360223">reply</span><span class="op" id="8360228">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360231">if</span>&nbsp;<span class="ident" id="8360234">err</span>&nbsp;<span class="op" id="8360238">!=</span>&nbsp;<span class="ident" id="8360241">nil</span>&nbsp;<span class="op" id="8360245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360249">t</span><span class="op" id="8360250">.</span><span class="ident" id="8360251">Errorf</span><span class="op" id="8360257">(</span><span class="string" id="8360258">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8360300">,</span>&nbsp;<span class="ident" id="8360302">err</span><span class="op" id="8360305">.</span><span class="ident" id="8360306">Error</span><span class="op" id="8360311">(</span><span class="op" id="8360312">)</span><span class="op" id="8360313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360319">if</span>&nbsp;<span class="ident" id="8360322">reply</span><span class="op" id="8360327">.</span><span class="ident" id="8360328">C</span>&nbsp;<span class="op" id="8360330">!=</span>&nbsp;<span class="ident" id="8360333">args</span><span class="op" id="8360337">.</span><span class="ident" id="8360338">A</span><span class="op" id="8360339">*</span><span class="ident" id="8360340">args</span><span class="op" id="8360344">.</span><span class="ident" id="8360345">B</span>&nbsp;<span class="op" id="8360347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360351">t</span><span class="op" id="8360352">.</span><span class="ident" id="8360353">Errorf</span><span class="op" id="8360359">(</span><span class="string" id="8360360">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8360385">,</span>&nbsp;<span class="ident" id="8360387">reply</span><span class="op" id="8360392">.</span><span class="ident" id="8360393">C</span><span class="op" id="8360394">,</span>&nbsp;<span class="ident" id="8360396">args</span><span class="op" id="8360400">.</span><span class="ident" id="8360401">A</span><span class="op" id="8360402">*</span><span class="ident" id="8360403">args</span><span class="op" id="8360407">.</span><span class="ident" id="8360408">B</span><span class="op" id="8360409">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8360416">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360454">args</span>&nbsp;<span class="op" id="8360459">=</span>&nbsp;<span class="op" id="8360461">&amp;</span><span class="ident" id="8360462">Args</span><span class="op" id="8360466">{</span><span class="num" id="8360467">7</span><span class="op" id="8360468">,</span>&nbsp;<span class="num" id="8360470">8</span><span class="op" id="8360471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360474">reply</span>&nbsp;<span class="op" id="8360480">=</span>&nbsp;<span class="builtinfunc" id="8360482">new</span><span class="op" id="8360485">(</span><span class="ident" id="8360486">Reply</span><span class="op" id="8360491">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360494">err</span>&nbsp;<span class="op" id="8360498">=</span>&nbsp;<span class="ident" id="8360500">client</span><span class="op" id="8360506">.</span><span class="ident" id="8360507">Call</span><span class="op" id="8360511">(</span><span class="string" id="8360512">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="8360531">,</span>&nbsp;<span class="ident" id="8360533">args</span><span class="op" id="8360537">,</span>&nbsp;<span class="ident" id="8360539">reply</span><span class="op" id="8360544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360547">if</span>&nbsp;<span class="ident" id="8360550">err</span>&nbsp;<span class="op" id="8360554">!=</span>&nbsp;<span class="ident" id="8360557">nil</span>&nbsp;<span class="op" id="8360561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360565">t</span><span class="op" id="8360566">.</span><span class="ident" id="8360567">Errorf</span><span class="op" id="8360573">(</span><span class="string" id="8360574">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8360616">,</span>&nbsp;<span class="ident" id="8360618">err</span><span class="op" id="8360621">.</span><span class="ident" id="8360622">Error</span><span class="op" id="8360627">(</span><span class="op" id="8360628">)</span><span class="op" id="8360629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360635">if</span>&nbsp;<span class="ident" id="8360638">reply</span><span class="op" id="8360643">.</span><span class="ident" id="8360644">C</span>&nbsp;<span class="op" id="8360646">!=</span>&nbsp;<span class="ident" id="8360649">args</span><span class="op" id="8360653">.</span><span class="ident" id="8360654">A</span><span class="op" id="8360655">+</span><span class="ident" id="8360656">args</span><span class="op" id="8360660">.</span><span class="ident" id="8360661">B</span>&nbsp;<span class="op" id="8360663">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360667">t</span><span class="op" id="8360668">.</span><span class="ident" id="8360669">Errorf</span><span class="op" id="8360675">(</span><span class="string" id="8360676">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8360701">,</span>&nbsp;<span class="ident" id="8360703">reply</span><span class="op" id="8360708">.</span><span class="ident" id="8360709">C</span><span class="op" id="8360710">,</span>&nbsp;<span class="ident" id="8360712">args</span><span class="op" id="8360716">.</span><span class="ident" id="8360717">A</span><span class="op" id="8360718">+</span><span class="ident" id="8360719">args</span><span class="op" id="8360723">.</span><span class="ident" id="8360724">B</span><span class="op" id="8360725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360728">}</span><br>
<span class="lineno"></span><span class="op" id="8360730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8360733">func</span>&nbsp;<span class="ident" id="8360738">testNewServerRPC</span><span class="op" id="8360754">(</span><span class="ident" id="8360755">t</span>&nbsp;<span class="op" id="8360757">*</span><span class="ident" id="8360758">testing</span><span class="op" id="8360765">.</span><span class="ident" id="8360766">T</span><span class="op" id="8360767">,</span>&nbsp;<span class="ident" id="8360769">addr</span>&nbsp;<span class="builtintype" id="8360774">string</span><span class="op" id="8360780">)</span>&nbsp;<span class="op" id="8360782">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360785">client</span><span class="op" id="8360791">,</span>&nbsp;<span class="ident" id="8360793">err</span>&nbsp;<span class="op" id="8360797">:=</span>&nbsp;<span class="ident" id="8360800">Dial</span><span class="op" id="8360804">(</span><span class="string" id="8360805">&#34;tcp&#34;</span><span class="op" id="8360810">,</span>&nbsp;<span class="ident" id="8360812">addr</span><span class="op" id="8360816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360819">if</span>&nbsp;<span class="ident" id="8360822">err</span>&nbsp;<span class="op" id="8360826">!=</span>&nbsp;<span class="ident" id="8360829">nil</span>&nbsp;<span class="op" id="8360833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360837">t</span><span class="op" id="8360838">.</span><span class="ident" id="8360839">Fatal</span><span class="op" id="8360844">(</span><span class="string" id="8360845">&#34;dialing&#34;</span><span class="op" id="8360854">,</span>&nbsp;<span class="ident" id="8360856">err</span><span class="op" id="8360859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360865">defer</span>&nbsp;<span class="ident" id="8360871">client</span><span class="op" id="8360877">.</span><span class="ident" id="8360878">Close</span><span class="op" id="8360883">(</span><span class="op" id="8360884">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8360888">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360910">args</span>&nbsp;<span class="op" id="8360915">:=</span>&nbsp;<span class="op" id="8360918">&amp;</span><span class="ident" id="8360919">Args</span><span class="op" id="8360923">{</span><span class="num" id="8360924">7</span><span class="op" id="8360925">,</span>&nbsp;<span class="num" id="8360927">8</span><span class="op" id="8360928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360931">reply</span>&nbsp;<span class="op" id="8360937">:=</span>&nbsp;<span class="builtinfunc" id="8360940">new</span><span class="op" id="8360943">(</span><span class="ident" id="8360944">Reply</span><span class="op" id="8360949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360952">err</span>&nbsp;<span class="op" id="8360956">=</span>&nbsp;<span class="ident" id="8360958">client</span><span class="op" id="8360964">.</span><span class="ident" id="8360965">Call</span><span class="op" id="8360969">(</span><span class="string" id="8360970">&#34;newServer.Arith.Add&#34;</span><span class="op" id="8360991">,</span>&nbsp;<span class="ident" id="8360993">args</span><span class="op" id="8360997">,</span>&nbsp;<span class="ident" id="8360999">reply</span><span class="op" id="8361004">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361007">if</span>&nbsp;<span class="ident" id="8361010">err</span>&nbsp;<span class="op" id="8361014">!=</span>&nbsp;<span class="ident" id="8361017">nil</span>&nbsp;<span class="op" id="8361021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361025">t</span><span class="op" id="8361026">.</span><span class="ident" id="8361027">Errorf</span><span class="op" id="8361033">(</span><span class="string" id="8361034">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8361076">,</span>&nbsp;<span class="ident" id="8361078">err</span><span class="op" id="8361081">.</span><span class="ident" id="8361082">Error</span><span class="op" id="8361087">(</span><span class="op" id="8361088">)</span><span class="op" id="8361089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8361092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361095">if</span>&nbsp;<span class="ident" id="8361098">reply</span><span class="op" id="8361103">.</span><span class="ident" id="8361104">C</span>&nbsp;<span class="op" id="8361106">!=</span>&nbsp;<span class="ident" id="8361109">args</span><span class="op" id="8361113">.</span><span class="ident" id="8361114">A</span><span class="op" id="8361115">+</span><span class="ident" id="8361116">args</span><span class="op" id="8361120">.</span><span class="ident" id="8361121">B</span>&nbsp;<span class="op" id="8361123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361127">t</span><span class="op" id="8361128">.</span><span class="ident" id="8361129">Errorf</span><span class="op" id="8361135">(</span><span class="string" id="8361136">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8361161">,</span>&nbsp;<span class="ident" id="8361163">reply</span><span class="op" id="8361168">.</span><span class="ident" id="8361169">C</span><span class="op" id="8361170">,</span>&nbsp;<span class="ident" id="8361172">args</span><span class="op" id="8361176">.</span><span class="ident" id="8361177">A</span><span class="op" id="8361178">+</span><span class="ident" id="8361179">args</span><span class="op" id="8361183">.</span><span class="ident" id="8361184">B</span><span class="op" id="8361185">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8361188">}</span><br>
<span class="lineno"></span><span class="op" id="8361190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8361193">func</span>&nbsp;<span class="ident" id="8361198">TestHTTP</span><span class="op" id="8361206">(</span><span class="ident" id="8361207">t</span>&nbsp;<span class="op" id="8361209">*</span><span class="ident" id="8361210">testing</span><span class="op" id="8361217">.</span><span class="ident" id="8361218">T</span><span class="op" id="8361219">)</span>&nbsp;<span class="op" id="8361221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361224">once</span><span class="op" id="8361228">.</span><span class="ident" id="8361229">Do</span><span class="op" id="8361231">(</span><span class="ident" id="8361232">startServer</span><span class="op" id="8361243">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361246">testHTTPRPC</span><span class="op" id="8361257">(</span><span class="ident" id="8361258">t</span><span class="op" id="8361259">,</span>&nbsp;<span class="string" id="8361261">&#34;&#34;</span><span class="op" id="8361263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361266">newOnce</span><span class="op" id="8361273">.</span><span class="ident" id="8361274">Do</span><span class="op" id="8361276">(</span><span class="ident" id="8361277">startNewServer</span><span class="op" id="8361291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361294">testHTTPRPC</span><span class="op" id="8361305">(</span><span class="ident" id="8361306">t</span><span class="op" id="8361307">,</span>&nbsp;<span class="ident" id="8361309">newHttpPath</span><span class="op" id="8361320">)</span><br>
<span class="lineno"></span><span class="op" id="8361322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8361325">func</span>&nbsp;<span class="ident" id="8361330">testHTTPRPC</span><span class="op" id="8361341">(</span><span class="ident" id="8361342">t</span>&nbsp;<span class="op" id="8361344">*</span><span class="ident" id="8361345">testing</span><span class="op" id="8361352">.</span><span class="ident" id="8361353">T</span><span class="op" id="8361354">,</span>&nbsp;<span class="ident" id="8361356">path</span>&nbsp;<span class="builtintype" id="8361361">string</span><span class="op" id="8361367">)</span>&nbsp;<span class="op" id="8361369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361372">var</span>&nbsp;<span class="ident" id="8361376">client</span>&nbsp;<span class="op" id="8361383">*</span><span class="ident" id="8361384">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361392">var</span>&nbsp;<span class="ident" id="8361396">err</span>&nbsp;<span class="builtintype" id="8361400">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361407">if</span>&nbsp;<span class="ident" id="8361410">path</span>&nbsp;<span class="op" id="8361415">==</span>&nbsp;<span class="string" id="8361418">&#34;&#34;</span>&nbsp;<span class="op" id="8361421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361425">client</span><span class="op" id="8361431">,</span>&nbsp;<span class="ident" id="8361433">err</span>&nbsp;<span class="op" id="8361437">=</span>&nbsp;<span class="ident" id="8361439">DialHTTP</span><span class="op" id="8361447">(</span><span class="string" id="8361448">&#34;tcp&#34;</span><span class="op" id="8361453">,</span>&nbsp;<span class="ident" id="8361455">httpServerAddr</span><span class="op" id="8361469">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8361472">}</span>&nbsp;<span class="keyword" id="8361474">else</span>&nbsp;<span class="op" id="8361479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361483">client</span><span class="op" id="8361489">,</span>&nbsp;<span class="ident" id="8361491">err</span>&nbsp;<span class="op" id="8361495">=</span>&nbsp;<span class="ident" id="8361497">DialHTTPPath</span><span class="op" id="8361509">(</span><span class="string" id="8361510">&#34;tcp&#34;</span><span class="op" id="8361515">,</span>&nbsp;<span class="ident" id="8361517">httpServerAddr</span><span class="op" id="8361531">,</span>&nbsp;<span class="ident" id="8361533">path</span><span class="op" id="8361537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8361540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361543">if</span>&nbsp;<span class="ident" id="8361546">err</span>&nbsp;<span class="op" id="8361550">!=</span>&nbsp;<span class="ident" id="8361553">nil</span>&nbsp;<span class="op" id="8361557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361561">t</span><span class="op" id="8361562">.</span><span class="ident" id="8361563">Fatal</span><span class="op" id="8361568">(</span><span class="string" id="8361569">&#34;dialing&#34;</span><span class="op" id="8361578">,</span>&nbsp;<span class="ident" id="8361580">err</span><span class="op" id="8361583">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8361586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361589">defer</span>&nbsp;<span class="ident" id="8361595">client</span><span class="op" id="8361601">.</span><span class="ident" id="8361602">Close</span><span class="op" id="8361607">(</span><span class="op" id="8361608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8361612">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361634">args</span>&nbsp;<span class="op" id="8361639">:=</span>&nbsp;<span class="op" id="8361642">&amp;</span><span class="ident" id="8361643">Args</span><span class="op" id="8361647">{</span><span class="num" id="8361648">7</span><span class="op" id="8361649">,</span>&nbsp;<span class="num" id="8361651">8</span><span class="op" id="8361652">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361655">reply</span>&nbsp;<span class="op" id="8361661">:=</span>&nbsp;<span class="builtinfunc" id="8361664">new</span><span class="op" id="8361667">(</span><span class="ident" id="8361668">Reply</span><span class="op" id="8361673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361676">err</span>&nbsp;<span class="op" id="8361680">=</span>&nbsp;<span class="ident" id="8361682">client</span><span class="op" id="8361688">.</span><span class="ident" id="8361689">Call</span><span class="op" id="8361693">(</span><span class="string" id="8361694">&#34;Arith.Add&#34;</span><span class="op" id="8361705">,</span>&nbsp;<span class="ident" id="8361707">args</span><span class="op" id="8361711">,</span>&nbsp;<span class="ident" id="8361713">reply</span><span class="op" id="8361718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361721">if</span>&nbsp;<span class="ident" id="8361724">err</span>&nbsp;<span class="op" id="8361728">!=</span>&nbsp;<span class="ident" id="8361731">nil</span>&nbsp;<span class="op" id="8361735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361739">t</span><span class="op" id="8361740">.</span><span class="ident" id="8361741">Errorf</span><span class="op" id="8361747">(</span><span class="string" id="8361748">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8361790">,</span>&nbsp;<span class="ident" id="8361792">err</span><span class="op" id="8361795">.</span><span class="ident" id="8361796">Error</span><span class="op" id="8361801">(</span><span class="op" id="8361802">)</span><span class="op" id="8361803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8361806">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361809">if</span>&nbsp;<span class="ident" id="8361812">reply</span><span class="op" id="8361817">.</span><span class="ident" id="8361818">C</span>&nbsp;<span class="op" id="8361820">!=</span>&nbsp;<span class="ident" id="8361823">args</span><span class="op" id="8361827">.</span><span class="ident" id="8361828">A</span><span class="op" id="8361829">+</span><span class="ident" id="8361830">args</span><span class="op" id="8361834">.</span><span class="ident" id="8361835">B</span>&nbsp;<span class="op" id="8361837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361841">t</span><span class="op" id="8361842">.</span><span class="ident" id="8361843">Errorf</span><span class="op" id="8361849">(</span><span class="string" id="8361850">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8361875">,</span>&nbsp;<span class="ident" id="8361877">reply</span><span class="op" id="8361882">.</span><span class="ident" id="8361883">C</span><span class="op" id="8361884">,</span>&nbsp;<span class="ident" id="8361886">args</span><span class="op" id="8361890">.</span><span class="ident" id="8361891">A</span><span class="op" id="8361892">+</span><span class="ident" id="8361893">args</span><span class="op" id="8361897">.</span><span class="ident" id="8361898">B</span><span class="op" id="8361899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8361902">}</span><br>
<span class="lineno"></span><span class="op" id="8361904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="8361907">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="8361980">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="8362017">type</span>&nbsp;<span class="ident" id="8362022">CodecEmulator</span>&nbsp;<span class="keyword" id="8362036">struct</span>&nbsp;<span class="op" id="8362043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362046">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8362060">*</span><span class="ident" id="8362061">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362069">serviceMethod</span>&nbsp;<span class="builtintype" id="8362083">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362091">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8362105">*</span><span class="ident" id="8362106">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362112">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8362126">*</span><span class="ident" id="8362127">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362134">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8362148">error</span><br>
<span class="lineno"></span><span class="op" id="8362154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="8362157">func</span>&nbsp;<span class="op" id="8362162">(</span><span class="ident" id="8362163">codec</span>&nbsp;<span class="op" id="8362169">*</span><span class="ident" id="8362170">CodecEmulator</span><span class="op" id="8362183">)</span>&nbsp;<span class="ident" id="8362185">Call</span><span class="op" id="8362189">(</span><span class="ident" id="8362190">serviceMethod</span>&nbsp;<span class="builtintype" id="8362204">string</span><span class="op" id="8362210">,</span>&nbsp;<span class="ident" id="8362212">args</span>&nbsp;<span class="op" id="8362217">*</span><span class="ident" id="8362218">Args</span><span class="op" id="8362222">,</span>&nbsp;<span class="ident" id="8362224">reply</span>&nbsp;<span class="op" id="8362230">*</span><span class="ident" id="8362231">Reply</span><span class="op" id="8362236">)</span>&nbsp;<span class="builtintype" id="8362238">error</span>&nbsp;<span class="op" id="8362244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362247">codec</span><span class="op" id="8362252">.</span><span class="ident" id="8362253">serviceMethod</span>&nbsp;<span class="op" id="8362267">=</span>&nbsp;<span class="ident" id="8362269">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362284">codec</span><span class="op" id="8362289">.</span><span class="ident" id="8362290">args</span>&nbsp;<span class="op" id="8362295">=</span>&nbsp;<span class="ident" id="8362297">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362303">codec</span><span class="op" id="8362308">.</span><span class="ident" id="8362309">reply</span>&nbsp;<span class="op" id="8362315">=</span>&nbsp;<span class="ident" id="8362317">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362324">codec</span><span class="op" id="8362329">.</span><span class="ident" id="8362330">err</span>&nbsp;<span class="op" id="8362334">=</span>&nbsp;<span class="ident" id="8362336">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362341">var</span>&nbsp;<span class="ident" id="8362345">serverError</span>&nbsp;<span class="builtintype" id="8362357">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362364">if</span>&nbsp;<span class="ident" id="8362367">codec</span><span class="op" id="8362372">.</span><span class="ident" id="8362373">server</span>&nbsp;<span class="op" id="8362380">==</span>&nbsp;<span class="ident" id="8362383">nil</span>&nbsp;<span class="op" id="8362387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362391">serverError</span>&nbsp;<span class="op" id="8362403">=</span>&nbsp;<span class="ident" id="8362405">ServeRequest</span><span class="op" id="8362417">(</span><span class="ident" id="8362418">codec</span><span class="op" id="8362423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8362426">}</span>&nbsp;<span class="keyword" id="8362428">else</span>&nbsp;<span class="op" id="8362433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362437">serverError</span>&nbsp;<span class="op" id="8362449">=</span>&nbsp;<span class="ident" id="8362451">codec</span><span class="op" id="8362456">.</span><span class="ident" id="8362457">server</span><span class="op" id="8362463">.</span><span class="ident" id="8362464">ServeRequest</span><span class="op" id="8362476">(</span><span class="ident" id="8362477">codec</span><span class="op" id="8362482">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8362485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362488">if</span>&nbsp;<span class="ident" id="8362491">codec</span><span class="op" id="8362496">.</span><span class="ident" id="8362497">err</span>&nbsp;<span class="op" id="8362501">==</span>&nbsp;<span class="ident" id="8362504">nil</span>&nbsp;<span class="op" id="8362508">&amp;&amp;</span>&nbsp;<span class="ident" id="8362511">serverError</span>&nbsp;<span class="op" id="8362523">!=</span>&nbsp;<span class="ident" id="8362526">nil</span>&nbsp;<span class="op" id="8362530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362534">codec</span><span class="op" id="8362539">.</span><span class="ident" id="8362540">err</span>&nbsp;<span class="op" id="8362544">=</span>&nbsp;<span class="ident" id="8362546">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8362559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362562">return</span>&nbsp;<span class="ident" id="8362569">codec</span><span class="op" id="8362574">.</span><span class="ident" id="8362575">err</span><br>
<span class="lineno">330</span><span class="op" id="8362579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8362582">func</span>&nbsp;<span class="op" id="8362587">(</span><span class="ident" id="8362588">codec</span>&nbsp;<span class="op" id="8362594">*</span><span class="ident" id="8362595">CodecEmulator</span><span class="op" id="8362608">)</span>&nbsp;<span class="ident" id="8362610">ReadRequestHeader</span><span class="op" id="8362627">(</span><span class="ident" id="8362628">req</span>&nbsp;<span class="op" id="8362632">*</span><span class="ident" id="8362633">Request</span><span class="op" id="8362640">)</span>&nbsp;<span class="builtintype" id="8362642">error</span>&nbsp;<span class="op" id="8362648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362651">req</span><span class="op" id="8362654">.</span><span class="ident" id="8362655">ServiceMethod</span>&nbsp;<span class="op" id="8362669">=</span>&nbsp;<span class="ident" id="8362671">codec</span><span class="op" id="8362676">.</span><span class="ident" id="8362677">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362692">req</span><span class="op" id="8362695">.</span><span class="ident" id="8362696">Seq</span>&nbsp;<span class="op" id="8362700">=</span>&nbsp;<span class="num" id="8362702">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362705">return</span>&nbsp;<span class="ident" id="8362712">nil</span><br>
<span class="lineno"></span><span class="op" id="8362716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8362719">func</span>&nbsp;<span class="op" id="8362724">(</span><span class="ident" id="8362725">codec</span>&nbsp;<span class="op" id="8362731">*</span><span class="ident" id="8362732">CodecEmulator</span><span class="op" id="8362745">)</span>&nbsp;<span class="ident" id="8362747">ReadRequestBody</span><span class="op" id="8362762">(</span><span class="ident" id="8362763">argv</span>&nbsp;<span class="keyword" id="8362768">interface</span><span class="op" id="8362777">{</span><span class="op" id="8362778">}</span><span class="op" id="8362779">)</span>&nbsp;<span class="builtintype" id="8362781">error</span>&nbsp;<span class="op" id="8362787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362790">if</span>&nbsp;<span class="ident" id="8362793">codec</span><span class="op" id="8362798">.</span><span class="ident" id="8362799">args</span>&nbsp;<span class="op" id="8362804">==</span>&nbsp;<span class="ident" id="8362807">nil</span>&nbsp;<span class="op" id="8362811">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362815">return</span>&nbsp;<span class="ident" id="8362822">io</span><span class="op" id="8362824">.</span><span class="ident" id="8362825">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8362843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8362846">*</span><span class="op" id="8362847">(</span><span class="ident" id="8362848">argv</span><span class="op" id="8362852">.</span><span class="op" id="8362853">(</span><span class="op" id="8362854">*</span><span class="ident" id="8362855">Args</span><span class="op" id="8362859">)</span><span class="op" id="8362860">)</span>&nbsp;<span class="op" id="8362862">=</span>&nbsp;<span class="op" id="8362864">*</span><span class="ident" id="8362865">codec</span><span class="op" id="8362870">.</span><span class="ident" id="8362871">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362877">return</span>&nbsp;<span class="ident" id="8362884">nil</span><br>
<span class="lineno"></span><span class="op" id="8362888">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="8362891">func</span>&nbsp;<span class="op" id="8362896">(</span><span class="ident" id="8362897">codec</span>&nbsp;<span class="op" id="8362903">*</span><span class="ident" id="8362904">CodecEmulator</span><span class="op" id="8362917">)</span>&nbsp;<span class="ident" id="8362919">WriteResponse</span><span class="op" id="8362932">(</span><span class="ident" id="8362933">resp</span>&nbsp;<span class="op" id="8362938">*</span><span class="ident" id="8362939">Response</span><span class="op" id="8362947">,</span>&nbsp;<span class="ident" id="8362949">reply</span>&nbsp;<span class="keyword" id="8362955">interface</span><span class="op" id="8362964">{</span><span class="op" id="8362965">}</span><span class="op" id="8362966">)</span>&nbsp;<span class="builtintype" id="8362968">error</span>&nbsp;<span class="op" id="8362974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362977">if</span>&nbsp;<span class="ident" id="8362980">resp</span><span class="op" id="8362984">.</span><span class="ident" id="8362985">Error</span>&nbsp;<span class="op" id="8362991">!=</span>&nbsp;<span class="string" id="8362994">&#34;&#34;</span>&nbsp;<span class="op" id="8362997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363001">codec</span><span class="op" id="8363006">.</span><span class="ident" id="8363007">err</span>&nbsp;<span class="op" id="8363011">=</span>&nbsp;<span class="ident" id="8363013">errors</span><span class="op" id="8363019">.</span><span class="ident" id="8363020">New</span><span class="op" id="8363023">(</span><span class="ident" id="8363024">resp</span><span class="op" id="8363028">.</span><span class="ident" id="8363029">Error</span><span class="op" id="8363034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8363037">}</span>&nbsp;<span class="keyword" id="8363039">else</span>&nbsp;<span class="op" id="8363044">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8363048">*</span><span class="ident" id="8363049">codec</span><span class="op" id="8363054">.</span><span class="ident" id="8363055">reply</span>&nbsp;<span class="op" id="8363061">=</span>&nbsp;<span class="op" id="8363063">*</span><span class="op" id="8363064">(</span><span class="ident" id="8363065">reply</span><span class="op" id="8363070">.</span><span class="op" id="8363071">(</span><span class="op" id="8363072">*</span><span class="ident" id="8363073">Reply</span><span class="op" id="8363078">)</span><span class="op" id="8363079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8363082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363085">return</span>&nbsp;<span class="ident" id="8363092">nil</span><br>
<span class="lineno"></span><span class="op" id="8363096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="8363099">func</span>&nbsp;<span class="op" id="8363104">(</span><span class="ident" id="8363105">codec</span>&nbsp;<span class="op" id="8363111">*</span><span class="ident" id="8363112">CodecEmulator</span><span class="op" id="8363125">)</span>&nbsp;<span class="ident" id="8363127">Close</span><span class="op" id="8363132">(</span><span class="op" id="8363133">)</span>&nbsp;<span class="builtintype" id="8363135">error</span>&nbsp;<span class="op" id="8363141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363144">return</span>&nbsp;<span class="ident" id="8363151">nil</span><br>
<span class="lineno"></span><span class="op" id="8363155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8363158">func</span>&nbsp;<span class="ident" id="8363163">TestServeRequest</span><span class="op" id="8363179">(</span><span class="ident" id="8363180">t</span>&nbsp;<span class="op" id="8363182">*</span><span class="ident" id="8363183">testing</span><span class="op" id="8363190">.</span><span class="ident" id="8363191">T</span><span class="op" id="8363192">)</span>&nbsp;<span class="op" id="8363194">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363197">once</span><span class="op" id="8363201">.</span><span class="ident" id="8363202">Do</span><span class="op" id="8363204">(</span><span class="ident" id="8363205">startServer</span><span class="op" id="8363216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363219">testServeRequest</span><span class="op" id="8363235">(</span><span class="ident" id="8363236">t</span><span class="op" id="8363237">,</span>&nbsp;<span class="ident" id="8363239">nil</span><span class="op" id="8363242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363245">newOnce</span><span class="op" id="8363252">.</span><span class="ident" id="8363253">Do</span><span class="op" id="8363255">(</span><span class="ident" id="8363256">startNewServer</span><span class="op" id="8363270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363273">testServeRequest</span><span class="op" id="8363289">(</span><span class="ident" id="8363290">t</span><span class="op" id="8363291">,</span>&nbsp;<span class="ident" id="8363293">newServer</span><span class="op" id="8363302">)</span><br>
<span class="lineno"></span><span class="op" id="8363304">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="8363307">func</span>&nbsp;<span class="ident" id="8363312">testServeRequest</span><span class="op" id="8363328">(</span><span class="ident" id="8363329">t</span>&nbsp;<span class="op" id="8363331">*</span><span class="ident" id="8363332">testing</span><span class="op" id="8363339">.</span><span class="ident" id="8363340">T</span><span class="op" id="8363341">,</span>&nbsp;<span class="ident" id="8363343">server</span>&nbsp;<span class="op" id="8363350">*</span><span class="ident" id="8363351">Server</span><span class="op" id="8363357">)</span>&nbsp;<span class="op" id="8363359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363362">client</span>&nbsp;<span class="op" id="8363369">:=</span>&nbsp;<span class="ident" id="8363372">CodecEmulator</span><span class="op" id="8363385">{</span><span class="ident" id="8363386">server</span><span class="op" id="8363392">:</span>&nbsp;<span class="ident" id="8363394">server</span><span class="op" id="8363400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363403">defer</span>&nbsp;<span class="ident" id="8363409">client</span><span class="op" id="8363415">.</span><span class="ident" id="8363416">Close</span><span class="op" id="8363421">(</span><span class="op" id="8363422">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363426">args</span>&nbsp;<span class="op" id="8363431">:=</span>&nbsp;<span class="op" id="8363434">&amp;</span><span class="ident" id="8363435">Args</span><span class="op" id="8363439">{</span><span class="num" id="8363440">7</span><span class="op" id="8363441">,</span>&nbsp;<span class="num" id="8363443">8</span><span class="op" id="8363444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363447">reply</span>&nbsp;<span class="op" id="8363453">:=</span>&nbsp;<span class="builtinfunc" id="8363456">new</span><span class="op" id="8363459">(</span><span class="ident" id="8363460">Reply</span><span class="op" id="8363465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363468">err</span>&nbsp;<span class="op" id="8363472">:=</span>&nbsp;<span class="ident" id="8363475">client</span><span class="op" id="8363481">.</span><span class="ident" id="8363482">Call</span><span class="op" id="8363486">(</span><span class="string" id="8363487">&#34;Arith.Add&#34;</span><span class="op" id="8363498">,</span>&nbsp;<span class="ident" id="8363500">args</span><span class="op" id="8363504">,</span>&nbsp;<span class="ident" id="8363506">reply</span><span class="op" id="8363511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363514">if</span>&nbsp;<span class="ident" id="8363517">err</span>&nbsp;<span class="op" id="8363521">!=</span>&nbsp;<span class="ident" id="8363524">nil</span>&nbsp;<span class="op" id="8363528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363532">t</span><span class="op" id="8363533">.</span><span class="ident" id="8363534">Errorf</span><span class="op" id="8363540">(</span><span class="string" id="8363541">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8363583">,</span>&nbsp;<span class="ident" id="8363585">err</span><span class="op" id="8363588">.</span><span class="ident" id="8363589">Error</span><span class="op" id="8363594">(</span><span class="op" id="8363595">)</span><span class="op" id="8363596">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8363599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363602">if</span>&nbsp;<span class="ident" id="8363605">reply</span><span class="op" id="8363610">.</span><span class="ident" id="8363611">C</span>&nbsp;<span class="op" id="8363613">!=</span>&nbsp;<span class="ident" id="8363616">args</span><span class="op" id="8363620">.</span><span class="ident" id="8363621">A</span><span class="op" id="8363622">+</span><span class="ident" id="8363623">args</span><span class="op" id="8363627">.</span><span class="ident" id="8363628">B</span>&nbsp;<span class="op" id="8363630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363634">t</span><span class="op" id="8363635">.</span><span class="ident" id="8363636">Errorf</span><span class="op" id="8363642">(</span><span class="string" id="8363643">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8363668">,</span>&nbsp;<span class="ident" id="8363670">reply</span><span class="op" id="8363675">.</span><span class="ident" id="8363676">C</span><span class="op" id="8363677">,</span>&nbsp;<span class="ident" id="8363679">args</span><span class="op" id="8363683">.</span><span class="ident" id="8363684">A</span><span class="op" id="8363685">+</span><span class="ident" id="8363686">args</span><span class="op" id="8363690">.</span><span class="ident" id="8363691">B</span><span class="op" id="8363692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8363695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363699">err</span>&nbsp;<span class="op" id="8363703">=</span>&nbsp;<span class="ident" id="8363705">client</span><span class="op" id="8363711">.</span><span class="ident" id="8363712">Call</span><span class="op" id="8363716">(</span><span class="string" id="8363717">&#34;Arith.Add&#34;</span><span class="op" id="8363728">,</span>&nbsp;<span class="ident" id="8363730">nil</span><span class="op" id="8363733">,</span>&nbsp;<span class="ident" id="8363735">reply</span><span class="op" id="8363740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363743">if</span>&nbsp;<span class="ident" id="8363746">err</span>&nbsp;<span class="op" id="8363750">==</span>&nbsp;<span class="ident" id="8363753">nil</span>&nbsp;<span class="op" id="8363757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363761">t</span><span class="op" id="8363762">.</span><span class="ident" id="8363763">Errorf</span><span class="op" id="8363769">(</span><span class="string" id="8363770">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="8363817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8363820">}</span><br>
<span class="lineno"></span><span class="op" id="8363822">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="8363825">type</span>&nbsp;<span class="ident" id="8363830">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="8363846">int</span><br>
<span class="lineno"></span><span class="keyword" id="8363850">type</span>&nbsp;<span class="ident" id="8363855">ArgNotPublic</span>&nbsp;<span class="builtintype" id="8363868">int</span><br>
<span class="lineno"></span><span class="keyword" id="8363872">type</span>&nbsp;<span class="ident" id="8363877">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="8363892">int</span><br>
<span class="lineno"></span><span class="keyword" id="8363896">type</span>&nbsp;<span class="ident" id="8363901">NeedsPtrType</span>&nbsp;<span class="builtintype" id="8363914">int</span><br>
<span class="lineno">390</span><span class="keyword" id="8363918">type</span>&nbsp;<span class="ident" id="8363923">local</span>&nbsp;<span class="keyword" id="8363929">struct</span><span class="op" id="8363935">{</span><span class="op" id="8363936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8363939">func</span>&nbsp;<span class="op" id="8363944">(</span><span class="ident" id="8363945">t</span>&nbsp;<span class="op" id="8363947">*</span><span class="ident" id="8363948">ReplyNotPointer</span><span class="op" id="8363963">)</span>&nbsp;<span class="ident" id="8363965">ReplyNotPointer</span><span class="op" id="8363980">(</span><span class="ident" id="8363981">args</span>&nbsp;<span class="op" id="8363986">*</span><span class="ident" id="8363987">Args</span><span class="op" id="8363991">,</span>&nbsp;<span class="ident" id="8363993">reply</span>&nbsp;<span class="ident" id="8363999">Reply</span><span class="op" id="8364004">)</span>&nbsp;<span class="builtintype" id="8364006">error</span>&nbsp;<span class="op" id="8364012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364015">return</span>&nbsp;<span class="ident" id="8364022">nil</span><br>
<span class="lineno"></span><span class="op" id="8364026">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="8364029">func</span>&nbsp;<span class="op" id="8364034">(</span><span class="ident" id="8364035">t</span>&nbsp;<span class="op" id="8364037">*</span><span class="ident" id="8364038">ArgNotPublic</span><span class="op" id="8364050">)</span>&nbsp;<span class="ident" id="8364052">ArgNotPublic</span><span class="op" id="8364064">(</span><span class="ident" id="8364065">args</span>&nbsp;<span class="op" id="8364070">*</span><span class="ident" id="8364071">local</span><span class="op" id="8364076">,</span>&nbsp;<span class="ident" id="8364078">reply</span>&nbsp;<span class="op" id="8364084">*</span><span class="ident" id="8364085">Reply</span><span class="op" id="8364090">)</span>&nbsp;<span class="builtintype" id="8364092">error</span>&nbsp;<span class="op" id="8364098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364101">return</span>&nbsp;<span class="ident" id="8364108">nil</span><br>
<span class="lineno"></span><span class="op" id="8364112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="8364115">func</span>&nbsp;<span class="op" id="8364120">(</span><span class="ident" id="8364121">t</span>&nbsp;<span class="op" id="8364123">*</span><span class="ident" id="8364124">ReplyNotPublic</span><span class="op" id="8364138">)</span>&nbsp;<span class="ident" id="8364140">ReplyNotPublic</span><span class="op" id="8364154">(</span><span class="ident" id="8364155">args</span>&nbsp;<span class="op" id="8364160">*</span><span class="ident" id="8364161">Args</span><span class="op" id="8364165">,</span>&nbsp;<span class="ident" id="8364167">reply</span>&nbsp;<span class="op" id="8364173">*</span><span class="ident" id="8364174">local</span><span class="op" id="8364179">)</span>&nbsp;<span class="builtintype" id="8364181">error</span>&nbsp;<span class="op" id="8364187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364190">return</span>&nbsp;<span class="ident" id="8364197">nil</span><br>
<span class="lineno"></span><span class="op" id="8364201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8364204">func</span>&nbsp;<span class="op" id="8364209">(</span><span class="ident" id="8364210">t</span>&nbsp;<span class="op" id="8364212">*</span><span class="ident" id="8364213">NeedsPtrType</span><span class="op" id="8364225">)</span>&nbsp;<span class="ident" id="8364227">NeedsPtrType</span><span class="op" id="8364239">(</span><span class="ident" id="8364240">args</span>&nbsp;<span class="op" id="8364245">*</span><span class="ident" id="8364246">Args</span><span class="op" id="8364250">,</span>&nbsp;<span class="ident" id="8364252">reply</span>&nbsp;<span class="op" id="8364258">*</span><span class="ident" id="8364259">Reply</span><span class="op" id="8364264">)</span>&nbsp;<span class="builtintype" id="8364266">error</span>&nbsp;<span class="op" id="8364272">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364275">return</span>&nbsp;<span class="ident" id="8364282">nil</span><br>
<span class="lineno"></span><span class="op" id="8364286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8364289">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="8364381">func</span>&nbsp;<span class="ident" id="8364386">TestRegistrationError</span><span class="op" id="8364407">(</span><span class="ident" id="8364408">t</span>&nbsp;<span class="op" id="8364410">*</span><span class="ident" id="8364411">testing</span><span class="op" id="8364418">.</span><span class="ident" id="8364419">T</span><span class="op" id="8364420">)</span>&nbsp;<span class="op" id="8364422">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364425">err</span>&nbsp;<span class="op" id="8364429">:=</span>&nbsp;<span class="ident" id="8364432">Register</span><span class="op" id="8364440">(</span><span class="builtinfunc" id="8364441">new</span><span class="op" id="8364444">(</span><span class="ident" id="8364445">ReplyNotPointer</span><span class="op" id="8364460">)</span><span class="op" id="8364461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364464">if</span>&nbsp;<span class="ident" id="8364467">err</span>&nbsp;<span class="op" id="8364471">==</span>&nbsp;<span class="ident" id="8364474">nil</span>&nbsp;<span class="op" id="8364478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364482">t</span><span class="op" id="8364483">.</span><span class="ident" id="8364484">Error</span><span class="op" id="8364489">(</span><span class="string" id="8364490">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="8364534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364540">err</span>&nbsp;<span class="op" id="8364544">=</span>&nbsp;<span class="ident" id="8364546">Register</span><span class="op" id="8364554">(</span><span class="builtinfunc" id="8364555">new</span><span class="op" id="8364558">(</span><span class="ident" id="8364559">ArgNotPublic</span><span class="op" id="8364571">)</span><span class="op" id="8364572">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364575">if</span>&nbsp;<span class="ident" id="8364578">err</span>&nbsp;<span class="op" id="8364582">==</span>&nbsp;<span class="ident" id="8364585">nil</span>&nbsp;<span class="op" id="8364589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364593">t</span><span class="op" id="8364594">.</span><span class="ident" id="8364595">Error</span><span class="op" id="8364600">(</span><span class="string" id="8364601">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="8364642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364648">err</span>&nbsp;<span class="op" id="8364652">=</span>&nbsp;<span class="ident" id="8364654">Register</span><span class="op" id="8364662">(</span><span class="builtinfunc" id="8364663">new</span><span class="op" id="8364666">(</span><span class="ident" id="8364667">ReplyNotPublic</span><span class="op" id="8364681">)</span><span class="op" id="8364682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364685">if</span>&nbsp;<span class="ident" id="8364688">err</span>&nbsp;<span class="op" id="8364692">==</span>&nbsp;<span class="ident" id="8364695">nil</span>&nbsp;<span class="op" id="8364699">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364703">t</span><span class="op" id="8364704">.</span><span class="ident" id="8364705">Error</span><span class="op" id="8364710">(</span><span class="string" id="8364711">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="8364754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364760">err</span>&nbsp;<span class="op" id="8364764">=</span>&nbsp;<span class="ident" id="8364766">Register</span><span class="op" id="8364774">(</span><span class="ident" id="8364775">NeedsPtrType</span><span class="op" id="8364787">(</span><span class="num" id="8364788">0</span><span class="op" id="8364789">)</span><span class="op" id="8364790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364793">if</span>&nbsp;<span class="ident" id="8364796">err</span>&nbsp;<span class="op" id="8364800">==</span>&nbsp;<span class="ident" id="8364803">nil</span>&nbsp;<span class="op" id="8364807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364811">t</span><span class="op" id="8364812">.</span><span class="ident" id="8364813">Error</span><span class="op" id="8364818">(</span><span class="string" id="8364819">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="8364860">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364863">}</span>&nbsp;<span class="keyword" id="8364865">else</span>&nbsp;<span class="keyword" id="8364870">if</span>&nbsp;<span class="op" id="8364873">!</span><span class="ident" id="8364874">strings</span><span class="op" id="8364881">.</span><span class="ident" id="8364882">Contains</span><span class="op" id="8364890">(</span><span class="ident" id="8364891">err</span><span class="op" id="8364894">.</span><span class="ident" id="8364895">Error</span><span class="op" id="8364900">(</span><span class="op" id="8364901">)</span><span class="op" id="8364902">,</span>&nbsp;<span class="string" id="8364904">&#34;pointer&#34;</span><span class="op" id="8364913">)</span>&nbsp;<span class="op" id="8364915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364919">t</span><span class="op" id="8364920">.</span><span class="ident" id="8364921">Error</span><span class="op" id="8364926">(</span><span class="string" id="8364927">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="8364972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364975">}</span><br>
<span class="lineno"></span><span class="op" id="8364977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8364980">type</span>&nbsp;<span class="ident" id="8364985">WriteFailCodec</span>&nbsp;<span class="builtintype" id="8365000">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8365005">func</span>&nbsp;<span class="op" id="8365010">(</span><span class="ident" id="8365011">WriteFailCodec</span><span class="op" id="8365025">)</span>&nbsp;<span class="ident" id="8365027">WriteRequest</span><span class="op" id="8365039">(</span><span class="op" id="8365040">*</span><span class="ident" id="8365041">Request</span><span class="op" id="8365048">,</span>&nbsp;<span class="keyword" id="8365050">interface</span><span class="op" id="8365059">{</span><span class="op" id="8365060">}</span><span class="op" id="8365061">)</span>&nbsp;<span class="builtintype" id="8365063">error</span>&nbsp;<span class="op" id="8365069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8365072">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365134">return</span>&nbsp;<span class="ident" id="8365141">errors</span><span class="op" id="8365147">.</span><span class="ident" id="8365148">New</span><span class="op" id="8365151">(</span><span class="string" id="8365152">&#34;fail&#34;</span><span class="op" id="8365158">)</span><br>
<span class="lineno">435</span><span class="op" id="8365160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8365163">func</span>&nbsp;<span class="op" id="8365168">(</span><span class="ident" id="8365169">WriteFailCodec</span><span class="op" id="8365183">)</span>&nbsp;<span class="ident" id="8365185">ReadResponseHeader</span><span class="op" id="8365203">(</span><span class="op" id="8365204">*</span><span class="ident" id="8365205">Response</span><span class="op" id="8365213">)</span>&nbsp;<span class="builtintype" id="8365215">error</span>&nbsp;<span class="op" id="8365221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365224">select</span>&nbsp;<span class="op" id="8365231">{</span><span class="op" id="8365232">}</span><br>
<span class="lineno"></span><span class="op" id="8365234">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="8365237">func</span>&nbsp;<span class="op" id="8365242">(</span><span class="ident" id="8365243">WriteFailCodec</span><span class="op" id="8365257">)</span>&nbsp;<span class="ident" id="8365259">ReadResponseBody</span><span class="op" id="8365275">(</span><span class="keyword" id="8365276">interface</span><span class="op" id="8365285">{</span><span class="op" id="8365286">}</span><span class="op" id="8365287">)</span>&nbsp;<span class="builtintype" id="8365289">error</span>&nbsp;<span class="op" id="8365295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365298">select</span>&nbsp;<span class="op" id="8365305">{</span><span class="op" id="8365306">}</span><br>
<span class="lineno"></span><span class="op" id="8365308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="8365311">func</span>&nbsp;<span class="op" id="8365316">(</span><span class="ident" id="8365317">WriteFailCodec</span><span class="op" id="8365331">)</span>&nbsp;<span class="ident" id="8365333">Close</span><span class="op" id="8365338">(</span><span class="op" id="8365339">)</span>&nbsp;<span class="builtintype" id="8365341">error</span>&nbsp;<span class="op" id="8365347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365350">return</span>&nbsp;<span class="ident" id="8365357">nil</span><br>
<span class="lineno"></span><span class="op" id="8365361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8365364">func</span>&nbsp;<span class="ident" id="8365369">TestSendDeadlock</span><span class="op" id="8365385">(</span><span class="ident" id="8365386">t</span>&nbsp;<span class="op" id="8365388">*</span><span class="ident" id="8365389">testing</span><span class="op" id="8365396">.</span><span class="ident" id="8365397">T</span><span class="op" id="8365398">)</span>&nbsp;<span class="op" id="8365400">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365403">client</span>&nbsp;<span class="op" id="8365410">:=</span>&nbsp;<span class="ident" id="8365413">NewClientWithCodec</span><span class="op" id="8365431">(</span><span class="ident" id="8365432">WriteFailCodec</span><span class="op" id="8365446">(</span><span class="num" id="8365447">0</span><span class="op" id="8365448">)</span><span class="op" id="8365449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365452">defer</span>&nbsp;<span class="ident" id="8365458">client</span><span class="op" id="8365464">.</span><span class="ident" id="8365465">Close</span><span class="op" id="8365470">(</span><span class="op" id="8365471">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365475">done</span>&nbsp;<span class="op" id="8365480">:=</span>&nbsp;<span class="builtinfunc" id="8365483">make</span><span class="op" id="8365487">(</span><span class="keyword" id="8365488">chan</span>&nbsp;<span class="builtintype" id="8365493">bool</span><span class="op" id="8365497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365500">go</span>&nbsp;<span class="keyword" id="8365503">func</span><span class="op" id="8365507">(</span><span class="op" id="8365508">)</span>&nbsp;<span class="op" id="8365510">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365514">testSendDeadlock</span><span class="op" id="8365530">(</span><span class="ident" id="8365531">client</span><span class="op" id="8365537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365541">testSendDeadlock</span><span class="op" id="8365557">(</span><span class="ident" id="8365558">client</span><span class="op" id="8365564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365568">done</span>&nbsp;<span class="op" id="8365573">&lt;-</span>&nbsp;<span class="ident" id="8365576">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8365582">}</span><span class="op" id="8365583">(</span><span class="op" id="8365584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365587">select</span>&nbsp;<span class="op" id="8365594">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365597">case</span>&nbsp;<span class="op" id="8365602">&lt;-</span><span class="ident" id="8365604">done</span><span class="op" id="8365608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365612">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365620">case</span>&nbsp;<span class="op" id="8365625">&lt;-</span><span class="ident" id="8365627">time</span><span class="op" id="8365631">.</span><span class="ident" id="8365632">After</span><span class="op" id="8365637">(</span><span class="num" id="8365638">5</span>&nbsp;<span class="op" id="8365640">*</span>&nbsp;<span class="ident" id="8365642">time</span><span class="op" id="8365646">.</span><span class="ident" id="8365647">Second</span><span class="op" id="8365653">)</span><span class="op" id="8365654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365658">t</span><span class="op" id="8365659">.</span><span class="ident" id="8365660">Fatal</span><span class="op" id="8365665">(</span><span class="string" id="8365666">&#34;deadlock&#34;</span><span class="op" id="8365676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8365679">}</span><br>
<span class="lineno">465</span><span class="op" id="8365681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8365684">func</span>&nbsp;<span class="ident" id="8365689">testSendDeadlock</span><span class="op" id="8365705">(</span><span class="ident" id="8365706">client</span>&nbsp;<span class="op" id="8365713">*</span><span class="ident" id="8365714">Client</span><span class="op" id="8365720">)</span>&nbsp;<span class="op" id="8365722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365725">defer</span>&nbsp;<span class="keyword" id="8365731">func</span><span class="op" id="8365735">(</span><span class="op" id="8365736">)</span>&nbsp;<span class="op" id="8365738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8365742">recover</span><span class="op" id="8365749">(</span><span class="op" id="8365750">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8365753">}</span><span class="op" id="8365754">(</span><span class="op" id="8365755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365758">args</span>&nbsp;<span class="op" id="8365763">:=</span>&nbsp;<span class="op" id="8365766">&amp;</span><span class="ident" id="8365767">Args</span><span class="op" id="8365771">{</span><span class="num" id="8365772">7</span><span class="op" id="8365773">,</span>&nbsp;<span class="num" id="8365775">8</span><span class="op" id="8365776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365779">reply</span>&nbsp;<span class="op" id="8365785">:=</span>&nbsp;<span class="builtinfunc" id="8365788">new</span><span class="op" id="8365791">(</span><span class="ident" id="8365792">Reply</span><span class="op" id="8365797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365800">client</span><span class="op" id="8365806">.</span><span class="ident" id="8365807">Call</span><span class="op" id="8365811">(</span><span class="string" id="8365812">&#34;Arith.Add&#34;</span><span class="op" id="8365823">,</span>&nbsp;<span class="ident" id="8365825">args</span><span class="op" id="8365829">,</span>&nbsp;<span class="ident" id="8365831">reply</span><span class="op" id="8365836">)</span><br>
<span class="lineno"></span><span class="op" id="8365838">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="8365841">func</span>&nbsp;<span class="ident" id="8365846">dialDirect</span><span class="op" id="8365856">(</span><span class="op" id="8365857">)</span>&nbsp;<span class="op" id="8365859">(</span><span class="op" id="8365860">*</span><span class="ident" id="8365861">Client</span><span class="op" id="8365867">,</span>&nbsp;<span class="builtintype" id="8365869">error</span><span class="op" id="8365874">)</span>&nbsp;<span class="op" id="8365876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365879">return</span>&nbsp;<span class="ident" id="8365886">Dial</span><span class="op" id="8365890">(</span><span class="string" id="8365891">&#34;tcp&#34;</span><span class="op" id="8365896">,</span>&nbsp;<span class="ident" id="8365898">serverAddr</span><span class="op" id="8365908">)</span><br>
<span class="lineno"></span><span class="op" id="8365910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="8365913">func</span>&nbsp;<span class="ident" id="8365918">dialHTTP</span><span class="op" id="8365926">(</span><span class="op" id="8365927">)</span>&nbsp;<span class="op" id="8365929">(</span><span class="op" id="8365930">*</span><span class="ident" id="8365931">Client</span><span class="op" id="8365937">,</span>&nbsp;<span class="builtintype" id="8365939">error</span><span class="op" id="8365944">)</span>&nbsp;<span class="op" id="8365946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365949">return</span>&nbsp;<span class="ident" id="8365956">DialHTTP</span><span class="op" id="8365964">(</span><span class="string" id="8365965">&#34;tcp&#34;</span><span class="op" id="8365970">,</span>&nbsp;<span class="ident" id="8365972">httpServerAddr</span><span class="op" id="8365986">)</span><br>
<span class="lineno"></span><span class="op" id="8365988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8365991">func</span>&nbsp;<span class="ident" id="8365996">countMallocs</span><span class="op" id="8366008">(</span><span class="ident" id="8366009">dial</span>&nbsp;<span class="keyword" id="8366014">func</span><span class="op" id="8366018">(</span><span class="op" id="8366019">)</span>&nbsp;<span class="op" id="8366021">(</span><span class="op" id="8366022">*</span><span class="ident" id="8366023">Client</span><span class="op" id="8366029">,</span>&nbsp;<span class="builtintype" id="8366031">error</span><span class="op" id="8366036">)</span><span class="op" id="8366037">,</span>&nbsp;<span class="ident" id="8366039">t</span>&nbsp;<span class="op" id="8366041">*</span><span class="ident" id="8366042">testing</span><span class="op" id="8366049">.</span><span class="ident" id="8366050">T</span><span class="op" id="8366051">)</span>&nbsp;<span class="builtintype" id="8366053">float64</span>&nbsp;<span class="op" id="8366061">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366064">once</span><span class="op" id="8366068">.</span><span class="ident" id="8366069">Do</span><span class="op" id="8366071">(</span><span class="ident" id="8366072">startServer</span><span class="op" id="8366083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366086">client</span><span class="op" id="8366092">,</span>&nbsp;<span class="ident" id="8366094">err</span>&nbsp;<span class="op" id="8366098">:=</span>&nbsp;<span class="ident" id="8366101">dial</span><span class="op" id="8366105">(</span><span class="op" id="8366106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366109">if</span>&nbsp;<span class="ident" id="8366112">err</span>&nbsp;<span class="op" id="8366116">!=</span>&nbsp;<span class="ident" id="8366119">nil</span>&nbsp;<span class="op" id="8366123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366127">t</span><span class="op" id="8366128">.</span><span class="ident" id="8366129">Fatal</span><span class="op" id="8366134">(</span><span class="string" id="8366135">&#34;error&nbsp;dialing&#34;</span><span class="op" id="8366150">,</span>&nbsp;<span class="ident" id="8366152">err</span><span class="op" id="8366155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366158">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366161">defer</span>&nbsp;<span class="ident" id="8366167">client</span><span class="op" id="8366173">.</span><span class="ident" id="8366174">Close</span><span class="op" id="8366179">(</span><span class="op" id="8366180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366184">args</span>&nbsp;<span class="op" id="8366189">:=</span>&nbsp;<span class="op" id="8366192">&amp;</span><span class="ident" id="8366193">Args</span><span class="op" id="8366197">{</span><span class="num" id="8366198">7</span><span class="op" id="8366199">,</span>&nbsp;<span class="num" id="8366201">8</span><span class="op" id="8366202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366205">reply</span>&nbsp;<span class="op" id="8366211">:=</span>&nbsp;<span class="builtinfunc" id="8366214">new</span><span class="op" id="8366217">(</span><span class="ident" id="8366218">Reply</span><span class="op" id="8366223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366226">return</span>&nbsp;<span class="ident" id="8366233">testing</span><span class="op" id="8366240">.</span><span class="ident" id="8366241">AllocsPerRun</span><span class="op" id="8366253">(</span><span class="num" id="8366254">100</span><span class="op" id="8366257">,</span>&nbsp;<span class="keyword" id="8366259">func</span><span class="op" id="8366263">(</span><span class="op" id="8366264">)</span>&nbsp;<span class="op" id="8366266">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366270">err</span>&nbsp;<span class="op" id="8366274">:=</span>&nbsp;<span class="ident" id="8366277">client</span><span class="op" id="8366283">.</span><span class="ident" id="8366284">Call</span><span class="op" id="8366288">(</span><span class="string" id="8366289">&#34;Arith.Add&#34;</span><span class="op" id="8366300">,</span>&nbsp;<span class="ident" id="8366302">args</span><span class="op" id="8366306">,</span>&nbsp;<span class="ident" id="8366308">reply</span><span class="op" id="8366313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366317">if</span>&nbsp;<span class="ident" id="8366320">err</span>&nbsp;<span class="op" id="8366324">!=</span>&nbsp;<span class="ident" id="8366327">nil</span>&nbsp;<span class="op" id="8366331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366336">t</span><span class="op" id="8366337">.</span><span class="ident" id="8366338">Errorf</span><span class="op" id="8366344">(</span><span class="string" id="8366345">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8366387">,</span>&nbsp;<span class="ident" id="8366389">err</span><span class="op" id="8366392">.</span><span class="ident" id="8366393">Error</span><span class="op" id="8366398">(</span><span class="op" id="8366399">)</span><span class="op" id="8366400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366408">if</span>&nbsp;<span class="ident" id="8366411">reply</span><span class="op" id="8366416">.</span><span class="ident" id="8366417">C</span>&nbsp;<span class="op" id="8366419">!=</span>&nbsp;<span class="ident" id="8366422">args</span><span class="op" id="8366426">.</span><span class="ident" id="8366427">A</span><span class="op" id="8366428">+</span><span class="ident" id="8366429">args</span><span class="op" id="8366433">.</span><span class="ident" id="8366434">B</span>&nbsp;<span class="op" id="8366436">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366441">t</span><span class="op" id="8366442">.</span><span class="ident" id="8366443">Errorf</span><span class="op" id="8366449">(</span><span class="string" id="8366450">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8366475">,</span>&nbsp;<span class="ident" id="8366477">reply</span><span class="op" id="8366482">.</span><span class="ident" id="8366483">C</span><span class="op" id="8366484">,</span>&nbsp;<span class="ident" id="8366486">args</span><span class="op" id="8366490">.</span><span class="ident" id="8366491">A</span><span class="op" id="8366492">+</span><span class="ident" id="8366493">args</span><span class="op" id="8366497">.</span><span class="ident" id="8366498">B</span><span class="op" id="8366499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366506">}</span><span class="op" id="8366507">)</span><br>
<span class="lineno"></span><span class="op" id="8366509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="8366512">func</span>&nbsp;<span class="ident" id="8366517">TestCountMallocs</span><span class="op" id="8366533">(</span><span class="ident" id="8366534">t</span>&nbsp;<span class="op" id="8366536">*</span><span class="ident" id="8366537">testing</span><span class="op" id="8366544">.</span><span class="ident" id="8366545">T</span><span class="op" id="8366546">)</span>&nbsp;<span class="op" id="8366548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366551">if</span>&nbsp;<span class="ident" id="8366554">testing</span><span class="op" id="8366561">.</span><span class="ident" id="8366562">Short</span><span class="op" id="8366567">(</span><span class="op" id="8366568">)</span>&nbsp;<span class="op" id="8366570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366574">t</span><span class="op" id="8366575">.</span><span class="ident" id="8366576">Skip</span><span class="op" id="8366580">(</span><span class="string" id="8366581">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8366618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366624">if</span>&nbsp;<span class="ident" id="8366627">runtime</span><span class="op" id="8366634">.</span><span class="ident" id="8366635">GOMAXPROCS</span><span class="op" id="8366645">(</span><span class="num" id="8366646">0</span><span class="op" id="8366647">)</span>&nbsp;<span class="op" id="8366649">&gt;</span>&nbsp;<span class="num" id="8366651">1</span>&nbsp;<span class="op" id="8366653">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366657">t</span><span class="op" id="8366658">.</span><span class="ident" id="8366659">Skip</span><span class="op" id="8366663">(</span><span class="string" id="8366664">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="8366688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366694">fmt</span><span class="op" id="8366697">.</span><span class="ident" id="8366698">Printf</span><span class="op" id="8366704">(</span><span class="string" id="8366705">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="8366739">,</span>&nbsp;<span class="ident" id="8366741">countMallocs</span><span class="op" id="8366753">(</span><span class="ident" id="8366754">dialDirect</span><span class="op" id="8366764">,</span>&nbsp;<span class="ident" id="8366766">t</span><span class="op" id="8366767">)</span><span class="op" id="8366768">)</span><br>
<span class="lineno"></span><span class="op" id="8366770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="8366773">func</span>&nbsp;<span class="ident" id="8366778">TestCountMallocsOverHTTP</span><span class="op" id="8366802">(</span><span class="ident" id="8366803">t</span>&nbsp;<span class="op" id="8366805">*</span><span class="ident" id="8366806">testing</span><span class="op" id="8366813">.</span><span class="ident" id="8366814">T</span><span class="op" id="8366815">)</span>&nbsp;<span class="op" id="8366817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366820">if</span>&nbsp;<span class="ident" id="8366823">testing</span><span class="op" id="8366830">.</span><span class="ident" id="8366831">Short</span><span class="op" id="8366836">(</span><span class="op" id="8366837">)</span>&nbsp;<span class="op" id="8366839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366843">t</span><span class="op" id="8366844">.</span><span class="ident" id="8366845">Skip</span><span class="op" id="8366849">(</span><span class="string" id="8366850">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8366887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366893">if</span>&nbsp;<span class="ident" id="8366896">runtime</span><span class="op" id="8366903">.</span><span class="ident" id="8366904">GOMAXPROCS</span><span class="op" id="8366914">(</span><span class="num" id="8366915">0</span><span class="op" id="8366916">)</span>&nbsp;<span class="op" id="8366918">&gt;</span>&nbsp;<span class="num" id="8366920">1</span>&nbsp;<span class="op" id="8366922">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366926">t</span><span class="op" id="8366927">.</span><span class="ident" id="8366928">Skip</span><span class="op" id="8366932">(</span><span class="string" id="8366933">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="8366957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366963">fmt</span><span class="op" id="8366966">.</span><span class="ident" id="8366967">Printf</span><span class="op" id="8366973">(</span><span class="string" id="8366974">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="8367013">,</span>&nbsp;<span class="ident" id="8367015">countMallocs</span><span class="op" id="8367027">(</span><span class="ident" id="8367028">dialHTTP</span><span class="op" id="8367036">,</span>&nbsp;<span class="ident" id="8367038">t</span><span class="op" id="8367039">)</span><span class="op" id="8367040">)</span><br>
<span class="lineno"></span><span class="op" id="8367042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="8367045">type</span>&nbsp;<span class="ident" id="8367050">writeCrasher</span>&nbsp;<span class="keyword" id="8367063">struct</span>&nbsp;<span class="op" id="8367070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367073">done</span>&nbsp;<span class="keyword" id="8367078">chan</span>&nbsp;<span class="builtintype" id="8367083">bool</span><br>
<span class="lineno"></span><span class="op" id="8367088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8367091">func</span>&nbsp;<span class="op" id="8367096">(</span><span class="ident" id="8367097">writeCrasher</span><span class="op" id="8367109">)</span>&nbsp;<span class="ident" id="8367111">Close</span><span class="op" id="8367116">(</span><span class="op" id="8367117">)</span>&nbsp;<span class="builtintype" id="8367119">error</span>&nbsp;<span class="op" id="8367125">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367128">return</span>&nbsp;<span class="ident" id="8367135">nil</span><br>
<span class="lineno"></span><span class="op" id="8367139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8367142">func</span>&nbsp;<span class="op" id="8367147">(</span><span class="ident" id="8367148">w</span>&nbsp;<span class="op" id="8367150">*</span><span class="ident" id="8367151">writeCrasher</span><span class="op" id="8367163">)</span>&nbsp;<span class="ident" id="8367165">Read</span><span class="op" id="8367169">(</span><span class="ident" id="8367170">p</span>&nbsp;<span class="op" id="8367172">[</span><span class="op" id="8367173">]</span><span class="builtintype" id="8367174">byte</span><span class="op" id="8367178">)</span>&nbsp;<span class="op" id="8367180">(</span><span class="builtintype" id="8367181">int</span><span class="op" id="8367184">,</span>&nbsp;<span class="builtintype" id="8367186">error</span><span class="op" id="8367191">)</span>&nbsp;<span class="op" id="8367193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367196">&lt;-</span><span class="ident" id="8367198">w</span><span class="op" id="8367199">.</span><span class="ident" id="8367200">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367206">return</span>&nbsp;<span class="num" id="8367213">0</span><span class="op" id="8367214">,</span>&nbsp;<span class="ident" id="8367216">io</span><span class="op" id="8367218">.</span><span class="ident" id="8367219">EOF</span><br>
<span class="lineno"></span><span class="op" id="8367223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8367226">func</span>&nbsp;<span class="op" id="8367231">(</span><span class="ident" id="8367232">writeCrasher</span><span class="op" id="8367244">)</span>&nbsp;<span class="ident" id="8367246">Write</span><span class="op" id="8367251">(</span><span class="ident" id="8367252">p</span>&nbsp;<span class="op" id="8367254">[</span><span class="op" id="8367255">]</span><span class="builtintype" id="8367256">byte</span><span class="op" id="8367260">)</span>&nbsp;<span class="op" id="8367262">(</span><span class="builtintype" id="8367263">int</span><span class="op" id="8367266">,</span>&nbsp;<span class="builtintype" id="8367268">error</span><span class="op" id="8367273">)</span>&nbsp;<span class="op" id="8367275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367278">return</span>&nbsp;<span class="num" id="8367285">0</span><span class="op" id="8367286">,</span>&nbsp;<span class="ident" id="8367288">errors</span><span class="op" id="8367294">.</span><span class="ident" id="8367295">New</span><span class="op" id="8367298">(</span><span class="string" id="8367299">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="8367319">)</span><br>
<span class="lineno">540</span><span class="op" id="8367321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8367324">func</span>&nbsp;<span class="ident" id="8367329">TestClientWriteError</span><span class="op" id="8367349">(</span><span class="ident" id="8367350">t</span>&nbsp;<span class="op" id="8367352">*</span><span class="ident" id="8367353">testing</span><span class="op" id="8367360">.</span><span class="ident" id="8367361">T</span><span class="op" id="8367362">)</span>&nbsp;<span class="op" id="8367364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367367">w</span>&nbsp;<span class="op" id="8367369">:=</span>&nbsp;<span class="op" id="8367372">&amp;</span><span class="ident" id="8367373">writeCrasher</span><span class="op" id="8367385">{</span><span class="ident" id="8367386">done</span><span class="op" id="8367390">:</span>&nbsp;<span class="builtinfunc" id="8367392">make</span><span class="op" id="8367396">(</span><span class="keyword" id="8367397">chan</span>&nbsp;<span class="builtintype" id="8367402">bool</span><span class="op" id="8367406">)</span><span class="op" id="8367407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367410">c</span>&nbsp;<span class="op" id="8367412">:=</span>&nbsp;<span class="ident" id="8367415">NewClient</span><span class="op" id="8367424">(</span><span class="ident" id="8367425">w</span><span class="op" id="8367426">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367429">defer</span>&nbsp;<span class="ident" id="8367435">c</span><span class="op" id="8367436">.</span><span class="ident" id="8367437">Close</span><span class="op" id="8367442">(</span><span class="op" id="8367443">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367447">res</span>&nbsp;<span class="op" id="8367451">:=</span>&nbsp;<span class="ident" id="8367454">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367461">err</span>&nbsp;<span class="op" id="8367465">:=</span>&nbsp;<span class="ident" id="8367468">c</span><span class="op" id="8367469">.</span><span class="ident" id="8367470">Call</span><span class="op" id="8367474">(</span><span class="string" id="8367475">&#34;foo&#34;</span><span class="op" id="8367480">,</span>&nbsp;<span class="num" id="8367482">1</span><span class="op" id="8367483">,</span>&nbsp;<span class="op" id="8367485">&amp;</span><span class="ident" id="8367486">res</span><span class="op" id="8367489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367492">if</span>&nbsp;<span class="ident" id="8367495">err</span>&nbsp;<span class="op" id="8367499">==</span>&nbsp;<span class="ident" id="8367502">nil</span>&nbsp;<span class="op" id="8367506">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367510">t</span><span class="op" id="8367511">.</span><span class="ident" id="8367512">Fatal</span><span class="op" id="8367517">(</span><span class="string" id="8367518">&#34;expected&nbsp;error&#34;</span><span class="op" id="8367534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367540">if</span>&nbsp;<span class="ident" id="8367543">err</span><span class="op" id="8367546">.</span><span class="ident" id="8367547">Error</span><span class="op" id="8367552">(</span><span class="op" id="8367553">)</span>&nbsp;<span class="op" id="8367555">!=</span>&nbsp;<span class="string" id="8367558">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="8367579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367583">t</span><span class="op" id="8367584">.</span><span class="ident" id="8367585">Error</span><span class="op" id="8367590">(</span><span class="string" id="8367591">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="8367619">,</span>&nbsp;<span class="ident" id="8367621">err</span><span class="op" id="8367624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367627">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367630">w</span><span class="op" id="8367631">.</span><span class="ident" id="8367632">done</span>&nbsp;<span class="op" id="8367637">&lt;-</span>&nbsp;<span class="ident" id="8367640">true</span><br>
<span class="lineno"></span><span class="op" id="8367645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8367648">func</span>&nbsp;<span class="ident" id="8367653">TestTCPClose</span><span class="op" id="8367665">(</span><span class="ident" id="8367666">t</span>&nbsp;<span class="op" id="8367668">*</span><span class="ident" id="8367669">testing</span><span class="op" id="8367676">.</span><span class="ident" id="8367677">T</span><span class="op" id="8367678">)</span>&nbsp;<span class="op" id="8367680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367683">once</span><span class="op" id="8367687">.</span><span class="ident" id="8367688">Do</span><span class="op" id="8367690">(</span><span class="ident" id="8367691">startServer</span><span class="op" id="8367702">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367706">client</span><span class="op" id="8367712">,</span>&nbsp;<span class="ident" id="8367714">err</span>&nbsp;<span class="op" id="8367718">:=</span>&nbsp;<span class="ident" id="8367721">dialHTTP</span><span class="op" id="8367729">(</span><span class="op" id="8367730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367733">if</span>&nbsp;<span class="ident" id="8367736">err</span>&nbsp;<span class="op" id="8367740">!=</span>&nbsp;<span class="ident" id="8367743">nil</span>&nbsp;<span class="op" id="8367747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367751">t</span><span class="op" id="8367752">.</span><span class="ident" id="8367753">Fatalf</span><span class="op" id="8367759">(</span><span class="string" id="8367760">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="8367773">,</span>&nbsp;<span class="ident" id="8367775">err</span><span class="op" id="8367778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367781">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367784">defer</span>&nbsp;<span class="ident" id="8367790">client</span><span class="op" id="8367796">.</span><span class="ident" id="8367797">Close</span><span class="op" id="8367802">(</span><span class="op" id="8367803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367807">args</span>&nbsp;<span class="op" id="8367812">:=</span>&nbsp;<span class="ident" id="8367815">Args</span><span class="op" id="8367819">{</span><span class="num" id="8367820">17</span><span class="op" id="8367822">,</span>&nbsp;<span class="num" id="8367824">8</span><span class="op" id="8367825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367828">var</span>&nbsp;<span class="ident" id="8367832">reply</span>&nbsp;<span class="ident" id="8367838">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367845">err</span>&nbsp;<span class="op" id="8367849">=</span>&nbsp;<span class="ident" id="8367851">client</span><span class="op" id="8367857">.</span><span class="ident" id="8367858">Call</span><span class="op" id="8367862">(</span><span class="string" id="8367863">&#34;Arith.Mul&#34;</span><span class="op" id="8367874">,</span>&nbsp;<span class="ident" id="8367876">args</span><span class="op" id="8367880">,</span>&nbsp;<span class="op" id="8367882">&amp;</span><span class="ident" id="8367883">reply</span><span class="op" id="8367888">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367891">if</span>&nbsp;<span class="ident" id="8367894">err</span>&nbsp;<span class="op" id="8367898">!=</span>&nbsp;<span class="ident" id="8367901">nil</span>&nbsp;<span class="op" id="8367905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367909">t</span><span class="op" id="8367910">.</span><span class="ident" id="8367911">Fatal</span><span class="op" id="8367916">(</span><span class="string" id="8367917">&#34;arith&nbsp;error:&#34;</span><span class="op" id="8367931">,</span>&nbsp;<span class="ident" id="8367933">err</span><span class="op" id="8367936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367942">t</span><span class="op" id="8367943">.</span><span class="ident" id="8367944">Logf</span><span class="op" id="8367948">(</span><span class="string" id="8367949">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="8367968">,</span>&nbsp;<span class="ident" id="8367970">args</span><span class="op" id="8367974">.</span><span class="ident" id="8367975">A</span><span class="op" id="8367976">,</span>&nbsp;<span class="ident" id="8367978">args</span><span class="op" id="8367982">.</span><span class="ident" id="8367983">B</span><span class="op" id="8367984">,</span>&nbsp;<span class="ident" id="8367986">reply</span><span class="op" id="8367991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367994">if</span>&nbsp;<span class="ident" id="8367997">reply</span><span class="op" id="8368002">.</span><span class="ident" id="8368003">C</span>&nbsp;<span class="op" id="8368005">!=</span>&nbsp;<span class="ident" id="8368008">args</span><span class="op" id="8368012">.</span><span class="ident" id="8368013">A</span><span class="op" id="8368014">*</span><span class="ident" id="8368015">args</span><span class="op" id="8368019">.</span><span class="ident" id="8368020">B</span>&nbsp;<span class="op" id="8368022">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368026">t</span><span class="op" id="8368027">.</span><span class="ident" id="8368028">Errorf</span><span class="op" id="8368034">(</span><span class="string" id="8368035">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8368060">,</span>&nbsp;<span class="ident" id="8368062">reply</span><span class="op" id="8368067">.</span><span class="ident" id="8368068">C</span><span class="op" id="8368069">,</span>&nbsp;<span class="ident" id="8368071">args</span><span class="op" id="8368075">.</span><span class="ident" id="8368076">A</span><span class="op" id="8368077">*</span><span class="ident" id="8368078">args</span><span class="op" id="8368082">.</span><span class="ident" id="8368083">B</span><span class="op" id="8368084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368087">}</span><br>
<span class="lineno"></span><span class="op" id="8368089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8368092">func</span>&nbsp;<span class="ident" id="8368097">TestErrorAfterClientClose</span><span class="op" id="8368122">(</span><span class="ident" id="8368123">t</span>&nbsp;<span class="op" id="8368125">*</span><span class="ident" id="8368126">testing</span><span class="op" id="8368133">.</span><span class="ident" id="8368134">T</span><span class="op" id="8368135">)</span>&nbsp;<span class="op" id="8368137">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368140">once</span><span class="op" id="8368144">.</span><span class="ident" id="8368145">Do</span><span class="op" id="8368147">(</span><span class="ident" id="8368148">startServer</span><span class="op" id="8368159">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368163">client</span><span class="op" id="8368169">,</span>&nbsp;<span class="ident" id="8368171">err</span>&nbsp;<span class="op" id="8368175">:=</span>&nbsp;<span class="ident" id="8368178">dialHTTP</span><span class="op" id="8368186">(</span><span class="op" id="8368187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368190">if</span>&nbsp;<span class="ident" id="8368193">err</span>&nbsp;<span class="op" id="8368197">!=</span>&nbsp;<span class="ident" id="8368200">nil</span>&nbsp;<span class="op" id="8368204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368208">t</span><span class="op" id="8368209">.</span><span class="ident" id="8368210">Fatalf</span><span class="op" id="8368216">(</span><span class="string" id="8368217">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="8368230">,</span>&nbsp;<span class="ident" id="8368232">err</span><span class="op" id="8368235">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368241">err</span>&nbsp;<span class="op" id="8368245">=</span>&nbsp;<span class="ident" id="8368247">client</span><span class="op" id="8368253">.</span><span class="ident" id="8368254">Close</span><span class="op" id="8368259">(</span><span class="op" id="8368260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368263">if</span>&nbsp;<span class="ident" id="8368266">err</span>&nbsp;<span class="op" id="8368270">!=</span>&nbsp;<span class="ident" id="8368273">nil</span>&nbsp;<span class="op" id="8368277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368281">t</span><span class="op" id="8368282">.</span><span class="ident" id="8368283">Fatal</span><span class="op" id="8368288">(</span><span class="string" id="8368289">&#34;close&nbsp;error:&#34;</span><span class="op" id="8368303">,</span>&nbsp;<span class="ident" id="8368305">err</span><span class="op" id="8368308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368311">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368314">err</span>&nbsp;<span class="op" id="8368318">=</span>&nbsp;<span class="ident" id="8368320">client</span><span class="op" id="8368326">.</span><span class="ident" id="8368327">Call</span><span class="op" id="8368331">(</span><span class="string" id="8368332">&#34;Arith.Add&#34;</span><span class="op" id="8368343">,</span>&nbsp;<span class="op" id="8368345">&amp;</span><span class="ident" id="8368346">Args</span><span class="op" id="8368350">{</span><span class="num" id="8368351">7</span><span class="op" id="8368352">,</span>&nbsp;<span class="num" id="8368354">9</span><span class="op" id="8368355">}</span><span class="op" id="8368356">,</span>&nbsp;<span class="builtinfunc" id="8368358">new</span><span class="op" id="8368361">(</span><span class="ident" id="8368362">Reply</span><span class="op" id="8368367">)</span><span class="op" id="8368368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368371">if</span>&nbsp;<span class="ident" id="8368374">err</span>&nbsp;<span class="op" id="8368378">!=</span>&nbsp;<span class="ident" id="8368381">ErrShutdown</span>&nbsp;<span class="op" id="8368393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368397">t</span><span class="op" id="8368398">.</span><span class="ident" id="8368399">Errorf</span><span class="op" id="8368405">(</span><span class="string" id="8368406">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8368444">,</span>&nbsp;<span class="ident" id="8368446">err</span><span class="op" id="8368449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368452">}</span><br>
<span class="lineno"></span><span class="op" id="8368454">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="8368457">func</span>&nbsp;<span class="ident" id="8368462">benchmarkEndToEnd</span><span class="op" id="8368479">(</span><span class="ident" id="8368480">dial</span>&nbsp;<span class="keyword" id="8368485">func</span><span class="op" id="8368489">(</span><span class="op" id="8368490">)</span>&nbsp;<span class="op" id="8368492">(</span><span class="op" id="8368493">*</span><span class="ident" id="8368494">Client</span><span class="op" id="8368500">,</span>&nbsp;<span class="builtintype" id="8368502">error</span><span class="op" id="8368507">)</span><span class="op" id="8368508">,</span>&nbsp;<span class="ident" id="8368510">b</span>&nbsp;<span class="op" id="8368512">*</span><span class="ident" id="8368513">testing</span><span class="op" id="8368520">.</span><span class="ident" id="8368521">B</span><span class="op" id="8368522">)</span>&nbsp;<span class="op" id="8368524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368527">once</span><span class="op" id="8368531">.</span><span class="ident" id="8368532">Do</span><span class="op" id="8368534">(</span><span class="ident" id="8368535">startServer</span><span class="op" id="8368546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368549">client</span><span class="op" id="8368555">,</span>&nbsp;<span class="ident" id="8368557">err</span>&nbsp;<span class="op" id="8368561">:=</span>&nbsp;<span class="ident" id="8368564">dial</span><span class="op" id="8368568">(</span><span class="op" id="8368569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368572">if</span>&nbsp;<span class="ident" id="8368575">err</span>&nbsp;<span class="op" id="8368579">!=</span>&nbsp;<span class="ident" id="8368582">nil</span>&nbsp;<span class="op" id="8368586">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368590">b</span><span class="op" id="8368591">.</span><span class="ident" id="8368592">Fatal</span><span class="op" id="8368597">(</span><span class="string" id="8368598">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="8368614">,</span>&nbsp;<span class="ident" id="8368616">err</span><span class="op" id="8368619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368625">defer</span>&nbsp;<span class="ident" id="8368631">client</span><span class="op" id="8368637">.</span><span class="ident" id="8368638">Close</span><span class="op" id="8368643">(</span><span class="op" id="8368644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8368648">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368670">args</span>&nbsp;<span class="op" id="8368675">:=</span>&nbsp;<span class="op" id="8368678">&amp;</span><span class="ident" id="8368679">Args</span><span class="op" id="8368683">{</span><span class="num" id="8368684">7</span><span class="op" id="8368685">,</span>&nbsp;<span class="num" id="8368687">8</span><span class="op" id="8368688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368691">b</span><span class="op" id="8368692">.</span><span class="ident" id="8368693">ResetTimer</span><span class="op" id="8368703">(</span><span class="op" id="8368704">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368708">b</span><span class="op" id="8368709">.</span><span class="ident" id="8368710">RunParallel</span><span class="op" id="8368721">(</span><span class="keyword" id="8368722">func</span><span class="op" id="8368726">(</span><span class="ident" id="8368727">pb</span>&nbsp;<span class="op" id="8368730">*</span><span class="ident" id="8368731">testing</span><span class="op" id="8368738">.</span><span class="ident" id="8368739">PB</span><span class="op" id="8368741">)</span>&nbsp;<span class="op" id="8368743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368747">reply</span>&nbsp;<span class="op" id="8368753">:=</span>&nbsp;<span class="builtinfunc" id="8368756">new</span><span class="op" id="8368759">(</span><span class="ident" id="8368760">Reply</span><span class="op" id="8368765">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368769">for</span>&nbsp;<span class="ident" id="8368773">pb</span><span class="op" id="8368775">.</span><span class="ident" id="8368776">Next</span><span class="op" id="8368780">(</span><span class="op" id="8368781">)</span>&nbsp;<span class="op" id="8368783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368788">err</span>&nbsp;<span class="op" id="8368792">:=</span>&nbsp;<span class="ident" id="8368795">client</span><span class="op" id="8368801">.</span><span class="ident" id="8368802">Call</span><span class="op" id="8368806">(</span><span class="string" id="8368807">&#34;Arith.Add&#34;</span><span class="op" id="8368818">,</span>&nbsp;<span class="ident" id="8368820">args</span><span class="op" id="8368824">,</span>&nbsp;<span class="ident" id="8368826">reply</span><span class="op" id="8368831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368836">if</span>&nbsp;<span class="ident" id="8368839">err</span>&nbsp;<span class="op" id="8368843">!=</span>&nbsp;<span class="ident" id="8368846">nil</span>&nbsp;<span class="op" id="8368850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368856">b</span><span class="op" id="8368857">.</span><span class="ident" id="8368858">Fatalf</span><span class="op" id="8368864">(</span><span class="string" id="8368865">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8368918">,</span>&nbsp;<span class="ident" id="8368920">err</span><span class="op" id="8368923">.</span><span class="ident" id="8368924">Error</span><span class="op" id="8368929">(</span><span class="op" id="8368930">)</span><span class="op" id="8368931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368936">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368941">if</span>&nbsp;<span class="ident" id="8368944">reply</span><span class="op" id="8368949">.</span><span class="ident" id="8368950">C</span>&nbsp;<span class="op" id="8368952">!=</span>&nbsp;<span class="ident" id="8368955">args</span><span class="op" id="8368959">.</span><span class="ident" id="8368960">A</span><span class="op" id="8368961">+</span><span class="ident" id="8368962">args</span><span class="op" id="8368966">.</span><span class="ident" id="8368967">B</span>&nbsp;<span class="op" id="8368969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368975">b</span><span class="op" id="8368976">.</span><span class="ident" id="8368977">Fatalf</span><span class="op" id="8368983">(</span><span class="string" id="8368984">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8369020">,</span>&nbsp;<span class="ident" id="8369022">reply</span><span class="op" id="8369027">.</span><span class="ident" id="8369028">C</span><span class="op" id="8369029">,</span>&nbsp;<span class="ident" id="8369031">args</span><span class="op" id="8369035">.</span><span class="ident" id="8369036">A</span><span class="op" id="8369037">+</span><span class="ident" id="8369038">args</span><span class="op" id="8369042">.</span><span class="ident" id="8369043">B</span><span class="op" id="8369044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369056">}</span><span class="op" id="8369057">)</span><br>
<span class="lineno">620</span><span class="op" id="8369059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8369062">func</span>&nbsp;<span class="ident" id="8369067">benchmarkEndToEndAsync</span><span class="op" id="8369089">(</span><span class="ident" id="8369090">dial</span>&nbsp;<span class="keyword" id="8369095">func</span><span class="op" id="8369099">(</span><span class="op" id="8369100">)</span>&nbsp;<span class="op" id="8369102">(</span><span class="op" id="8369103">*</span><span class="ident" id="8369104">Client</span><span class="op" id="8369110">,</span>&nbsp;<span class="builtintype" id="8369112">error</span><span class="op" id="8369117">)</span><span class="op" id="8369118">,</span>&nbsp;<span class="ident" id="8369120">b</span>&nbsp;<span class="op" id="8369122">*</span><span class="ident" id="8369123">testing</span><span class="op" id="8369130">.</span><span class="ident" id="8369131">B</span><span class="op" id="8369132">)</span>&nbsp;<span class="op" id="8369134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369137">const</span>&nbsp;<span class="ident" id="8369143">MaxConcurrentCalls</span>&nbsp;<span class="op" id="8369162">=</span>&nbsp;<span class="num" id="8369164">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369169">once</span><span class="op" id="8369173">.</span><span class="ident" id="8369174">Do</span><span class="op" id="8369176">(</span><span class="ident" id="8369177">startServer</span><span class="op" id="8369188">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369191">client</span><span class="op" id="8369197">,</span>&nbsp;<span class="ident" id="8369199">err</span>&nbsp;<span class="op" id="8369203">:=</span>&nbsp;<span class="ident" id="8369206">dial</span><span class="op" id="8369210">(</span><span class="op" id="8369211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369214">if</span>&nbsp;<span class="ident" id="8369217">err</span>&nbsp;<span class="op" id="8369221">!=</span>&nbsp;<span class="ident" id="8369224">nil</span>&nbsp;<span class="op" id="8369228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369232">b</span><span class="op" id="8369233">.</span><span class="ident" id="8369234">Fatal</span><span class="op" id="8369239">(</span><span class="string" id="8369240">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="8369256">,</span>&nbsp;<span class="ident" id="8369258">err</span><span class="op" id="8369261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369267">defer</span>&nbsp;<span class="ident" id="8369273">client</span><span class="op" id="8369279">.</span><span class="ident" id="8369280">Close</span><span class="op" id="8369285">(</span><span class="op" id="8369286">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8369290">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369313">args</span>&nbsp;<span class="op" id="8369318">:=</span>&nbsp;<span class="op" id="8369321">&amp;</span><span class="ident" id="8369322">Args</span><span class="op" id="8369326">{</span><span class="num" id="8369327">7</span><span class="op" id="8369328">,</span>&nbsp;<span class="num" id="8369330">8</span><span class="op" id="8369331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369334">procs</span>&nbsp;<span class="op" id="8369340">:=</span>&nbsp;<span class="num" id="8369343">4</span>&nbsp;<span class="op" id="8369345">*</span>&nbsp;<span class="ident" id="8369347">runtime</span><span class="op" id="8369354">.</span><span class="ident" id="8369355">GOMAXPROCS</span><span class="op" id="8369365">(</span><span class="op" id="8369366">-</span><span class="num" id="8369367">1</span><span class="op" id="8369368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369371">send</span>&nbsp;<span class="op" id="8369376">:=</span>&nbsp;<span class="builtintype" id="8369379">int32</span><span class="op" id="8369384">(</span><span class="ident" id="8369385">b</span><span class="op" id="8369386">.</span><span class="ident" id="8369387">N</span><span class="op" id="8369388">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369391">recv</span>&nbsp;<span class="op" id="8369396">:=</span>&nbsp;<span class="builtintype" id="8369399">int32</span><span class="op" id="8369404">(</span><span class="ident" id="8369405">b</span><span class="op" id="8369406">.</span><span class="ident" id="8369407">N</span><span class="op" id="8369408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369411">var</span>&nbsp;<span class="ident" id="8369415">wg</span>&nbsp;<span class="ident" id="8369418">sync</span><span class="op" id="8369422">.</span><span class="ident" id="8369423">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369434">wg</span><span class="op" id="8369436">.</span><span class="ident" id="8369437">Add</span><span class="op" id="8369440">(</span><span class="ident" id="8369441">procs</span><span class="op" id="8369446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369449">gate</span>&nbsp;<span class="op" id="8369454">:=</span>&nbsp;<span class="builtinfunc" id="8369457">make</span><span class="op" id="8369461">(</span><span class="keyword" id="8369462">chan</span>&nbsp;<span class="builtintype" id="8369467">bool</span><span class="op" id="8369471">,</span>&nbsp;<span class="ident" id="8369473">MaxConcurrentCalls</span><span class="op" id="8369491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369494">res</span>&nbsp;<span class="op" id="8369498">:=</span>&nbsp;<span class="builtinfunc" id="8369501">make</span><span class="op" id="8369505">(</span><span class="keyword" id="8369506">chan</span>&nbsp;<span class="op" id="8369511">*</span><span class="ident" id="8369512">Call</span><span class="op" id="8369516">,</span>&nbsp;<span class="ident" id="8369518">MaxConcurrentCalls</span><span class="op" id="8369536">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369539">b</span><span class="op" id="8369540">.</span><span class="ident" id="8369541">ResetTimer</span><span class="op" id="8369551">(</span><span class="op" id="8369552">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369556">for</span>&nbsp;<span class="ident" id="8369560">p</span>&nbsp;<span class="op" id="8369562">:=</span>&nbsp;<span class="num" id="8369565">0</span><span class="op" id="8369566">;</span>&nbsp;<span class="ident" id="8369568">p</span>&nbsp;<span class="op" id="8369570">&lt;</span>&nbsp;<span class="ident" id="8369572">procs</span><span class="op" id="8369577">;</span>&nbsp;<span class="ident" id="8369579">p</span><span class="op" id="8369580">++</span>&nbsp;<span class="op" id="8369583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369587">go</span>&nbsp;<span class="keyword" id="8369590">func</span><span class="op" id="8369594">(</span><span class="op" id="8369595">)</span>&nbsp;<span class="op" id="8369597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369602">for</span>&nbsp;<span class="ident" id="8369606">atomic</span><span class="op" id="8369612">.</span><span class="ident" id="8369613">AddInt32</span><span class="op" id="8369621">(</span><span class="op" id="8369622">&amp;</span><span class="ident" id="8369623">send</span><span class="op" id="8369627">,</span>&nbsp;<span class="op" id="8369629">-</span><span class="num" id="8369630">1</span><span class="op" id="8369631">)</span>&nbsp;<span class="op" id="8369633">&gt;=</span>&nbsp;<span class="num" id="8369636">0</span>&nbsp;<span class="op" id="8369638">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369644">gate</span>&nbsp;<span class="op" id="8369649">&lt;-</span>&nbsp;<span class="ident" id="8369652">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369661">reply</span>&nbsp;<span class="op" id="8369667">:=</span>&nbsp;<span class="builtinfunc" id="8369670">new</span><span class="op" id="8369673">(</span><span class="ident" id="8369674">Reply</span><span class="op" id="8369679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369685">client</span><span class="op" id="8369691">.</span><span class="ident" id="8369692">Go</span><span class="op" id="8369694">(</span><span class="string" id="8369695">&#34;Arith.Add&#34;</span><span class="op" id="8369706">,</span>&nbsp;<span class="ident" id="8369708">args</span><span class="op" id="8369712">,</span>&nbsp;<span class="ident" id="8369714">reply</span><span class="op" id="8369719">,</span>&nbsp;<span class="ident" id="8369721">res</span><span class="op" id="8369724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369733">}</span><span class="op" id="8369734">(</span><span class="op" id="8369735">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369739">go</span>&nbsp;<span class="keyword" id="8369742">func</span><span class="op" id="8369746">(</span><span class="op" id="8369747">)</span>&nbsp;<span class="op" id="8369749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369754">for</span>&nbsp;<span class="ident" id="8369758">call</span>&nbsp;<span class="op" id="8369763">:=</span>&nbsp;<span class="keyword" id="8369766">range</span>&nbsp;<span class="ident" id="8369772">res</span>&nbsp;<span class="op" id="8369776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369782">A</span>&nbsp;<span class="op" id="8369784">:=</span>&nbsp;<span class="ident" id="8369787">call</span><span class="op" id="8369791">.</span><span class="ident" id="8369792">Args</span><span class="op" id="8369796">.</span><span class="op" id="8369797">(</span><span class="op" id="8369798">*</span><span class="ident" id="8369799">Args</span><span class="op" id="8369803">)</span><span class="op" id="8369804">.</span><span class="ident" id="8369805">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369811">B</span>&nbsp;<span class="op" id="8369813">:=</span>&nbsp;<span class="ident" id="8369816">call</span><span class="op" id="8369820">.</span><span class="ident" id="8369821">Args</span><span class="op" id="8369825">.</span><span class="op" id="8369826">(</span><span class="op" id="8369827">*</span><span class="ident" id="8369828">Args</span><span class="op" id="8369832">)</span><span class="op" id="8369833">.</span><span class="ident" id="8369834">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369840">C</span>&nbsp;<span class="op" id="8369842">:=</span>&nbsp;<span class="ident" id="8369845">call</span><span class="op" id="8369849">.</span><span class="ident" id="8369850">Reply</span><span class="op" id="8369855">.</span><span class="op" id="8369856">(</span><span class="op" id="8369857">*</span><span class="ident" id="8369858">Reply</span><span class="op" id="8369863">)</span><span class="op" id="8369864">.</span><span class="ident" id="8369865">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369871">if</span>&nbsp;<span class="ident" id="8369874">A</span><span class="op" id="8369875">+</span><span class="ident" id="8369876">B</span>&nbsp;<span class="op" id="8369878">!=</span>&nbsp;<span class="ident" id="8369881">C</span>&nbsp;<span class="op" id="8369883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369890">b</span><span class="op" id="8369891">.</span><span class="ident" id="8369892">Fatalf</span><span class="op" id="8369898">(</span><span class="string" id="8369899">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8369941">,</span>&nbsp;<span class="ident" id="8369943">A</span><span class="op" id="8369944">+</span><span class="ident" id="8369945">B</span><span class="op" id="8369946">,</span>&nbsp;<span class="ident" id="8369948">C</span><span class="op" id="8369949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369961">&lt;-</span><span class="ident" id="8369963">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369972">if</span>&nbsp;<span class="ident" id="8369975">atomic</span><span class="op" id="8369981">.</span><span class="ident" id="8369982">AddInt32</span><span class="op" id="8369990">(</span><span class="op" id="8369991">&amp;</span><span class="ident" id="8369992">recv</span><span class="op" id="8369996">,</span>&nbsp;<span class="op" id="8369998">-</span><span class="num" id="8369999">1</span><span class="op" id="8370000">)</span>&nbsp;<span class="op" id="8370002">==</span>&nbsp;<span class="num" id="8370005">0</span>&nbsp;<span class="op" id="8370007">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8370014">close</span><span class="op" id="8370019">(</span><span class="ident" id="8370020">res</span><span class="op" id="8370023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370039">wg</span><span class="op" id="8370041">.</span><span class="ident" id="8370042">Done</span><span class="op" id="8370046">(</span><span class="op" id="8370047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370051">}</span><span class="op" id="8370052">(</span><span class="op" id="8370053">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370059">wg</span><span class="op" id="8370061">.</span><span class="ident" id="8370062">Wait</span><span class="op" id="8370066">(</span><span class="op" id="8370067">)</span><br>
<span class="lineno"></span><span class="op" id="8370069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8370072">func</span>&nbsp;<span class="ident" id="8370077">BenchmarkEndToEnd</span><span class="op" id="8370094">(</span><span class="ident" id="8370095">b</span>&nbsp;<span class="op" id="8370097">*</span><span class="ident" id="8370098">testing</span><span class="op" id="8370105">.</span><span class="ident" id="8370106">B</span><span class="op" id="8370107">)</span>&nbsp;<span class="op" id="8370109">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370112">benchmarkEndToEnd</span><span class="op" id="8370129">(</span><span class="ident" id="8370130">dialDirect</span><span class="op" id="8370140">,</span>&nbsp;<span class="ident" id="8370142">b</span><span class="op" id="8370143">)</span><br>
<span class="lineno"></span><span class="op" id="8370145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8370148">func</span>&nbsp;<span class="ident" id="8370153">BenchmarkEndToEndHTTP</span><span class="op" id="8370174">(</span><span class="ident" id="8370175">b</span>&nbsp;<span class="op" id="8370177">*</span><span class="ident" id="8370178">testing</span><span class="op" id="8370185">.</span><span class="ident" id="8370186">B</span><span class="op" id="8370187">)</span>&nbsp;<span class="op" id="8370189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370192">benchmarkEndToEnd</span><span class="op" id="8370209">(</span><span class="ident" id="8370210">dialHTTP</span><span class="op" id="8370218">,</span>&nbsp;<span class="ident" id="8370220">b</span><span class="op" id="8370221">)</span><br>
<span class="lineno">675</span><span class="op" id="8370223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8370226">func</span>&nbsp;<span class="ident" id="8370231">BenchmarkEndToEndAsync</span><span class="op" id="8370253">(</span><span class="ident" id="8370254">b</span>&nbsp;<span class="op" id="8370256">*</span><span class="ident" id="8370257">testing</span><span class="op" id="8370264">.</span><span class="ident" id="8370265">B</span><span class="op" id="8370266">)</span>&nbsp;<span class="op" id="8370268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370271">benchmarkEndToEndAsync</span><span class="op" id="8370293">(</span><span class="ident" id="8370294">dialDirect</span><span class="op" id="8370304">,</span>&nbsp;<span class="ident" id="8370306">b</span><span class="op" id="8370307">)</span><br>
<span class="lineno"></span><span class="op" id="8370309">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="8370312">func</span>&nbsp;<span class="ident" id="8370317">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="8370343">(</span><span class="ident" id="8370344">b</span>&nbsp;<span class="op" id="8370346">*</span><span class="ident" id="8370347">testing</span><span class="op" id="8370354">.</span><span class="ident" id="8370355">B</span><span class="op" id="8370356">)</span>&nbsp;<span class="op" id="8370358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370361">benchmarkEndToEndAsync</span><span class="op" id="8370383">(</span><span class="ident" id="8370384">dialHTTP</span><span class="op" id="8370392">,</span>&nbsp;<span class="ident" id="8370394">b</span><span class="op" id="8370395">)</span><br>
<span class="lineno"></span><span class="op" id="8370397">}</span>
</div>
</body>
</html>
