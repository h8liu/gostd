<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1121659">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1121714">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1121768">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="1121818">package</span>&nbsp;<span class="ident" id="1121826">sync_test</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span><span class="keyword" id="1121837">import</span>&nbsp;<span class="op" id="1121844">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1121847">.</span>&nbsp;<span class="string" id="1121849">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1121858">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1121869">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="1121879">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1121882">func</span>&nbsp;<span class="ident" id="1121887">TestCondSignal</span><span class="op" id="1121901">(</span><span class="ident" id="1121902">t</span>&nbsp;<span class="op" id="1121904">*</span><span class="ident" id="1121905"><a href="/sync/cond_test.go.html#1121869">testing</a></span><span class="op" id="1121912">.</span><span class="ident" id="1121913">T</span><span class="op" id="1121914">)</span>&nbsp;<span class="op" id="1121916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1121919">var</span>&nbsp;<span class="ident" id="1121923">m</span>&nbsp;<span class="ident" id="1121925"><a href="/sync/mutex.go.html#1673941">Mutex</a></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1121932">c</span>&nbsp;<span class="op" id="1121934">:=</span>&nbsp;<span class="ident" id="1121937"><a href="/sync/cond.go.html#1671270">NewCond</a></span><span class="op" id="1121944">(</span><span class="op" id="1121945">&amp;</span><span class="ident" id="1121946"><a href="/sync/cond_test.go.html#1121923">m</a></span><span class="op" id="1121947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1121950">n</span>&nbsp;<span class="op" id="1121952">:=</span>&nbsp;<span class="num" id="1121955">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1121958">running</span>&nbsp;<span class="op" id="1121966">:=</span>&nbsp;<span class="builtinfunc" id="1121969">make</span><span class="op" id="1121973">(</span><span class="keyword" id="1121974">chan</span>&nbsp;<span class="builtintype" id="1121979">bool</span><span class="op" id="1121983">,</span>&nbsp;<span class="ident" id="1121985"><a href="/sync/cond_test.go.html#1121950">n</a></span><span class="op" id="1121986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1121989">awake</span>&nbsp;<span class="op" id="1121995">:=</span>&nbsp;<span class="builtinfunc" id="1121998">make</span><span class="op" id="1122002">(</span><span class="keyword" id="1122003">chan</span>&nbsp;<span class="builtintype" id="1122008">bool</span><span class="op" id="1122012">,</span>&nbsp;<span class="ident" id="1122014"><a href="/sync/cond_test.go.html#1121950">n</a></span><span class="op" id="1122015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122018">for</span>&nbsp;<span class="ident" id="1122022">i</span>&nbsp;<span class="op" id="1122024">:=</span>&nbsp;<span class="num" id="1122027">0</span><span class="op" id="1122028">;</span>&nbsp;<span class="ident" id="1122030"><a href="/sync/cond_test.go.html#1122022">i</a></span>&nbsp;<span class="op" id="1122032">&lt;</span>&nbsp;<span class="ident" id="1122034"><a href="/sync/cond_test.go.html#1121950">n</a></span><span class="op" id="1122035">;</span>&nbsp;<span class="ident" id="1122037"><a href="/sync/cond_test.go.html#1122022">i</a></span><span class="op" id="1122038">++</span>&nbsp;<span class="op" id="1122041">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122045">go</span>&nbsp;<span class="keyword" id="1122048">func</span><span class="op" id="1122052">(</span><span class="op" id="1122053">)</span>&nbsp;<span class="op" id="1122055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122060"><a href="/sync/cond_test.go.html#1121923">m</a></span><span class="op" id="1122061">.</span><span class="ident" id="1122062">Lock</span><span class="op" id="1122066">(</span><span class="op" id="1122067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122072"><a href="/sync/cond_test.go.html#1121958">running</a></span>&nbsp;<span class="op" id="1122080">&lt;-</span>&nbsp;<span class="ident" id="1122083">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122091"><a href="/sync/cond_test.go.html#1121932">c</a></span><span class="op" id="1122092">.</span><span class="ident" id="1122093">Wait</span><span class="op" id="1122097">(</span><span class="op" id="1122098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122103"><a href="/sync/cond_test.go.html#1121989">awake</a></span>&nbsp;<span class="op" id="1122109">&lt;-</span>&nbsp;<span class="ident" id="1122112">true</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122120"><a href="/sync/cond_test.go.html#1121923">m</a></span><span class="op" id="1122121">.</span><span class="ident" id="1122122">Unlock</span><span class="op" id="1122128">(</span><span class="op" id="1122129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122133">}</span><span class="op" id="1122134">(</span><span class="op" id="1122135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122141">for</span>&nbsp;<span class="ident" id="1122145">i</span>&nbsp;<span class="op" id="1122147">:=</span>&nbsp;<span class="num" id="1122150">0</span><span class="op" id="1122151">;</span>&nbsp;<span class="ident" id="1122153"><a href="/sync/cond_test.go.html#1122145">i</a></span>&nbsp;<span class="op" id="1122155">&lt;</span>&nbsp;<span class="ident" id="1122157"><a href="/sync/cond_test.go.html#1121950">n</a></span><span class="op" id="1122158">;</span>&nbsp;<span class="ident" id="1122160"><a href="/sync/cond_test.go.html#1122145">i</a></span><span class="op" id="1122161">++</span>&nbsp;<span class="op" id="1122164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122168">&lt;-</span><span class="ident" id="1122170"><a href="/sync/cond_test.go.html#1121958">running</a></span>&nbsp;<span class="comment" id="1122178">//&nbsp;Wait&nbsp;for&nbsp;everyone&nbsp;to&nbsp;run.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122211">for</span>&nbsp;<span class="ident" id="1122215"><a href="/sync/cond_test.go.html#1121950">n</a></span>&nbsp;<span class="op" id="1122217">&gt;</span>&nbsp;<span class="num" id="1122219">0</span>&nbsp;<span class="op" id="1122221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122225">select</span>&nbsp;<span class="op" id="1122232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122236">case</span>&nbsp;<span class="op" id="1122241">&lt;-</span><span class="ident" id="1122243"><a href="/sync/cond_test.go.html#1121989">awake</a></span><span class="op" id="1122248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122253"><a href="/sync/cond_test.go.html#1121902">t</a></span><span class="op" id="1122254">.</span><span class="ident" id="1122255">Fatal</span><span class="op" id="1122260">(</span><span class="string" id="1122261">&#34;goroutine&nbsp;not&nbsp;asleep&#34;</span><span class="op" id="1122283">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122287">default</span><span class="op" id="1122294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122302"><a href="/sync/cond_test.go.html#1121923">m</a></span><span class="op" id="1122303">.</span><span class="ident" id="1122304">Lock</span><span class="op" id="1122308">(</span><span class="op" id="1122309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122313"><a href="/sync/cond_test.go.html#1121932">c</a></span><span class="op" id="1122314">.</span><span class="ident" id="1122315">Signal</span><span class="op" id="1122321">(</span><span class="op" id="1122322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122326"><a href="/sync/cond_test.go.html#1121923">m</a></span><span class="op" id="1122327">.</span><span class="ident" id="1122328">Unlock</span><span class="op" id="1122334">(</span><span class="op" id="1122335">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122339">&lt;-</span><span class="ident" id="1122341"><a href="/sync/cond_test.go.html#1121989">awake</a></span>&nbsp;<span class="comment" id="1122347">//&nbsp;Will&nbsp;deadlock&nbsp;if&nbsp;no&nbsp;goroutine&nbsp;wakes&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122391">select</span>&nbsp;<span class="op" id="1122398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122402">case</span>&nbsp;<span class="op" id="1122407">&lt;-</span><span class="ident" id="1122409"><a href="/sync/cond_test.go.html#1121989">awake</a></span><span class="op" id="1122414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122419"><a href="/sync/cond_test.go.html#1121902">t</a></span><span class="op" id="1122420">.</span><span class="ident" id="1122421">Fatal</span><span class="op" id="1122426">(</span><span class="string" id="1122427">&#34;too&nbsp;many&nbsp;goroutines&nbsp;awake&#34;</span><span class="op" id="1122454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122458">default</span><span class="op" id="1122465">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122473"><a href="/sync/cond_test.go.html#1121950">n</a></span><span class="op" id="1122474">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122481"><a href="/sync/cond_test.go.html#1121932">c</a></span><span class="op" id="1122482">.</span><span class="ident" id="1122483">Signal</span><span class="op" id="1122489">(</span><span class="op" id="1122490">)</span><br>
<span class="lineno"></span><span class="op" id="1122492">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="1122495">func</span>&nbsp;<span class="ident" id="1122500">TestCondSignalGenerations</span><span class="op" id="1122525">(</span><span class="ident" id="1122526">t</span>&nbsp;<span class="op" id="1122528">*</span><span class="ident" id="1122529"><a href="/sync/cond_test.go.html#1121869">testing</a></span><span class="op" id="1122536">.</span><span class="ident" id="1122537">T</span><span class="op" id="1122538">)</span>&nbsp;<span class="op" id="1122540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122543">var</span>&nbsp;<span class="ident" id="1122547">m</span>&nbsp;<span class="ident" id="1122549"><a href="/sync/mutex.go.html#1673941">Mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122556">c</span>&nbsp;<span class="op" id="1122558">:=</span>&nbsp;<span class="ident" id="1122561"><a href="/sync/cond.go.html#1671270">NewCond</a></span><span class="op" id="1122568">(</span><span class="op" id="1122569">&amp;</span><span class="ident" id="1122570"><a href="/sync/cond_test.go.html#1122547">m</a></span><span class="op" id="1122571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122574">n</span>&nbsp;<span class="op" id="1122576">:=</span>&nbsp;<span class="num" id="1122579">100</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122584">running</span>&nbsp;<span class="op" id="1122592">:=</span>&nbsp;<span class="builtinfunc" id="1122595">make</span><span class="op" id="1122599">(</span><span class="keyword" id="1122600">chan</span>&nbsp;<span class="builtintype" id="1122605">bool</span><span class="op" id="1122609">,</span>&nbsp;<span class="ident" id="1122611"><a href="/sync/cond_test.go.html#1122574">n</a></span><span class="op" id="1122612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122615">awake</span>&nbsp;<span class="op" id="1122621">:=</span>&nbsp;<span class="builtinfunc" id="1122624">make</span><span class="op" id="1122628">(</span><span class="keyword" id="1122629">chan</span>&nbsp;<span class="builtintype" id="1122634">int</span><span class="op" id="1122637">,</span>&nbsp;<span class="ident" id="1122639"><a href="/sync/cond_test.go.html#1122574">n</a></span><span class="op" id="1122640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122643">for</span>&nbsp;<span class="ident" id="1122647">i</span>&nbsp;<span class="op" id="1122649">:=</span>&nbsp;<span class="num" id="1122652">0</span><span class="op" id="1122653">;</span>&nbsp;<span class="ident" id="1122655"><a href="/sync/cond_test.go.html#1122647">i</a></span>&nbsp;<span class="op" id="1122657">&lt;</span>&nbsp;<span class="ident" id="1122659"><a href="/sync/cond_test.go.html#1122574">n</a></span><span class="op" id="1122660">;</span>&nbsp;<span class="ident" id="1122662"><a href="/sync/cond_test.go.html#1122647">i</a></span><span class="op" id="1122663">++</span>&nbsp;<span class="op" id="1122666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122670">go</span>&nbsp;<span class="keyword" id="1122673">func</span><span class="op" id="1122677">(</span><span class="ident" id="1122678">i</span>&nbsp;<span class="builtintype" id="1122680">int</span><span class="op" id="1122683">)</span>&nbsp;<span class="op" id="1122685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122690"><a href="/sync/cond_test.go.html#1122547">m</a></span><span class="op" id="1122691">.</span><span class="ident" id="1122692">Lock</span><span class="op" id="1122696">(</span><span class="op" id="1122697">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122702"><a href="/sync/cond_test.go.html#1122584">running</a></span>&nbsp;<span class="op" id="1122710">&lt;-</span>&nbsp;<span class="ident" id="1122713">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122721"><a href="/sync/cond_test.go.html#1122556">c</a></span><span class="op" id="1122722">.</span><span class="ident" id="1122723">Wait</span><span class="op" id="1122727">(</span><span class="op" id="1122728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122733"><a href="/sync/cond_test.go.html#1122615">awake</a></span>&nbsp;<span class="op" id="1122739">&lt;-</span>&nbsp;<span class="ident" id="1122742"><a href="/sync/cond_test.go.html#1122678">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122747"><a href="/sync/cond_test.go.html#1122547">m</a></span><span class="op" id="1122748">.</span><span class="ident" id="1122749">Unlock</span><span class="op" id="1122755">(</span><span class="op" id="1122756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122760">}</span><span class="op" id="1122761">(</span><span class="ident" id="1122762"><a href="/sync/cond_test.go.html#1122647">i</a></span><span class="op" id="1122763">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122767">if</span>&nbsp;<span class="ident" id="1122770"><a href="/sync/cond_test.go.html#1122647">i</a></span>&nbsp;<span class="op" id="1122772">&gt;</span>&nbsp;<span class="num" id="1122774">0</span>&nbsp;<span class="op" id="1122776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122781">a</span>&nbsp;<span class="op" id="1122783">:=</span>&nbsp;<span class="op" id="1122786">&lt;-</span><span class="ident" id="1122788"><a href="/sync/cond_test.go.html#1122615">awake</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122797">if</span>&nbsp;<span class="ident" id="1122800"><a href="/sync/cond_test.go.html#1122781">a</a></span>&nbsp;<span class="op" id="1122802">!=</span>&nbsp;<span class="ident" id="1122805"><a href="/sync/cond_test.go.html#1122647">i</a></span><span class="op" id="1122806">-</span><span class="num" id="1122807">1</span>&nbsp;<span class="op" id="1122809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122815"><a href="/sync/cond_test.go.html#1122526">t</a></span><span class="op" id="1122816">.</span><span class="ident" id="1122817">Fatalf</span><span class="op" id="1122823">(</span><span class="string" id="1122824">&#34;wrong&nbsp;goroutine&nbsp;woke&nbsp;up:&nbsp;want&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="1122866">,</span>&nbsp;<span class="ident" id="1122868"><a href="/sync/cond_test.go.html#1122647">i</a></span><span class="op" id="1122869">-</span><span class="num" id="1122870">1</span><span class="op" id="1122871">,</span>&nbsp;<span class="ident" id="1122873"><a href="/sync/cond_test.go.html#1122781">a</a></span><span class="op" id="1122874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122879">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122887">&lt;-</span><span class="ident" id="1122889"><a href="/sync/cond_test.go.html#1122584">running</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122899"><a href="/sync/cond_test.go.html#1122547">m</a></span><span class="op" id="1122900">.</span><span class="ident" id="1122901">Lock</span><span class="op" id="1122905">(</span><span class="op" id="1122906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122910"><a href="/sync/cond_test.go.html#1122556">c</a></span><span class="op" id="1122911">.</span><span class="ident" id="1122912">Signal</span><span class="op" id="1122918">(</span><span class="op" id="1122919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122923"><a href="/sync/cond_test.go.html#1122547">m</a></span><span class="op" id="1122924">.</span><span class="ident" id="1122925">Unlock</span><span class="op" id="1122931">(</span><span class="op" id="1122932">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1122935">}</span><br>
<span class="lineno"></span><span class="op" id="1122937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1122940">func</span>&nbsp;<span class="ident" id="1122945">TestCondBroadcast</span><span class="op" id="1122962">(</span><span class="ident" id="1122963">t</span>&nbsp;<span class="op" id="1122965">*</span><span class="ident" id="1122966"><a href="/sync/cond_test.go.html#1121869">testing</a></span><span class="op" id="1122973">.</span><span class="ident" id="1122974">T</span><span class="op" id="1122975">)</span>&nbsp;<span class="op" id="1122977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1122980">var</span>&nbsp;<span class="ident" id="1122984">m</span>&nbsp;<span class="ident" id="1122986"><a href="/sync/mutex.go.html#1673941">Mutex</a></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1122993">c</span>&nbsp;<span class="op" id="1122995">:=</span>&nbsp;<span class="ident" id="1122998"><a href="/sync/cond.go.html#1671270">NewCond</a></span><span class="op" id="1123005">(</span><span class="op" id="1123006">&amp;</span><span class="ident" id="1123007"><a href="/sync/cond_test.go.html#1122984">m</a></span><span class="op" id="1123008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123011">n</span>&nbsp;<span class="op" id="1123013">:=</span>&nbsp;<span class="num" id="1123016">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123021">running</span>&nbsp;<span class="op" id="1123029">:=</span>&nbsp;<span class="builtinfunc" id="1123032">make</span><span class="op" id="1123036">(</span><span class="keyword" id="1123037">chan</span>&nbsp;<span class="builtintype" id="1123042">int</span><span class="op" id="1123045">,</span>&nbsp;<span class="ident" id="1123047"><a href="/sync/cond_test.go.html#1123011">n</a></span><span class="op" id="1123048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123051">awake</span>&nbsp;<span class="op" id="1123057">:=</span>&nbsp;<span class="builtinfunc" id="1123060">make</span><span class="op" id="1123064">(</span><span class="keyword" id="1123065">chan</span>&nbsp;<span class="builtintype" id="1123070">int</span><span class="op" id="1123073">,</span>&nbsp;<span class="ident" id="1123075"><a href="/sync/cond_test.go.html#1123011">n</a></span><span class="op" id="1123076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123079">exit</span>&nbsp;<span class="op" id="1123084">:=</span>&nbsp;<span class="ident" id="1123087">false</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123094">for</span>&nbsp;<span class="ident" id="1123098">i</span>&nbsp;<span class="op" id="1123100">:=</span>&nbsp;<span class="num" id="1123103">0</span><span class="op" id="1123104">;</span>&nbsp;<span class="ident" id="1123106"><a href="/sync/cond_test.go.html#1123098">i</a></span>&nbsp;<span class="op" id="1123108">&lt;</span>&nbsp;<span class="ident" id="1123110"><a href="/sync/cond_test.go.html#1123011">n</a></span><span class="op" id="1123111">;</span>&nbsp;<span class="ident" id="1123113"><a href="/sync/cond_test.go.html#1123098">i</a></span><span class="op" id="1123114">++</span>&nbsp;<span class="op" id="1123117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123121">go</span>&nbsp;<span class="keyword" id="1123124">func</span><span class="op" id="1123128">(</span><span class="ident" id="1123129">g</span>&nbsp;<span class="builtintype" id="1123131">int</span><span class="op" id="1123134">)</span>&nbsp;<span class="op" id="1123136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123141"><a href="/sync/cond_test.go.html#1122984">m</a></span><span class="op" id="1123142">.</span><span class="ident" id="1123143">Lock</span><span class="op" id="1123147">(</span><span class="op" id="1123148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123153">for</span>&nbsp;<span class="op" id="1123157">!</span><span class="ident" id="1123158"><a href="/sync/cond_test.go.html#1123079">exit</a></span>&nbsp;<span class="op" id="1123163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123169"><a href="/sync/cond_test.go.html#1123021">running</a></span>&nbsp;<span class="op" id="1123177">&lt;-</span>&nbsp;<span class="ident" id="1123180"><a href="/sync/cond_test.go.html#1123129">g</a></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123186"><a href="/sync/cond_test.go.html#1122993">c</a></span><span class="op" id="1123187">.</span><span class="ident" id="1123188">Wait</span><span class="op" id="1123192">(</span><span class="op" id="1123193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123199"><a href="/sync/cond_test.go.html#1123051">awake</a></span>&nbsp;<span class="op" id="1123205">&lt;-</span>&nbsp;<span class="ident" id="1123208"><a href="/sync/cond_test.go.html#1123129">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123218"><a href="/sync/cond_test.go.html#1122984">m</a></span><span class="op" id="1123219">.</span><span class="ident" id="1123220">Unlock</span><span class="op" id="1123226">(</span><span class="op" id="1123227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123231">}</span><span class="op" id="1123232">(</span><span class="ident" id="1123233"><a href="/sync/cond_test.go.html#1123098">i</a></span><span class="op" id="1123234">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123240">for</span>&nbsp;<span class="ident" id="1123244">i</span>&nbsp;<span class="op" id="1123246">:=</span>&nbsp;<span class="num" id="1123249">0</span><span class="op" id="1123250">;</span>&nbsp;<span class="ident" id="1123252"><a href="/sync/cond_test.go.html#1123244">i</a></span>&nbsp;<span class="op" id="1123254">&lt;</span>&nbsp;<span class="ident" id="1123256"><a href="/sync/cond_test.go.html#1123011">n</a></span><span class="op" id="1123257">;</span>&nbsp;<span class="ident" id="1123259"><a href="/sync/cond_test.go.html#1123244">i</a></span><span class="op" id="1123260">++</span>&nbsp;<span class="op" id="1123263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123267">for</span>&nbsp;<span class="ident" id="1123271">i</span>&nbsp;<span class="op" id="1123273">:=</span>&nbsp;<span class="num" id="1123276">0</span><span class="op" id="1123277">;</span>&nbsp;<span class="ident" id="1123279"><a href="/sync/cond_test.go.html#1123271">i</a></span>&nbsp;<span class="op" id="1123281">&lt;</span>&nbsp;<span class="ident" id="1123283"><a href="/sync/cond_test.go.html#1123011">n</a></span><span class="op" id="1123284">;</span>&nbsp;<span class="ident" id="1123286"><a href="/sync/cond_test.go.html#1123271">i</a></span><span class="op" id="1123287">++</span>&nbsp;<span class="op" id="1123290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123295">&lt;-</span><span class="ident" id="1123297"><a href="/sync/cond_test.go.html#1123021">running</a></span>&nbsp;<span class="comment" id="1123305">//&nbsp;Will&nbsp;deadlock&nbsp;unless&nbsp;n&nbsp;are&nbsp;running.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123346">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123350">if</span>&nbsp;<span class="ident" id="1123353"><a href="/sync/cond_test.go.html#1123244">i</a></span>&nbsp;<span class="op" id="1123355">==</span>&nbsp;<span class="ident" id="1123358"><a href="/sync/cond_test.go.html#1123011">n</a></span><span class="op" id="1123359">-</span><span class="num" id="1123360">1</span>&nbsp;<span class="op" id="1123362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123367"><a href="/sync/cond_test.go.html#1122984">m</a></span><span class="op" id="1123368">.</span><span class="ident" id="1123369">Lock</span><span class="op" id="1123373">(</span><span class="op" id="1123374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123379"><a href="/sync/cond_test.go.html#1123079">exit</a></span>&nbsp;<span class="op" id="1123384">=</span>&nbsp;<span class="ident" id="1123386">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123394"><a href="/sync/cond_test.go.html#1122984">m</a></span><span class="op" id="1123395">.</span><span class="ident" id="1123396">Unlock</span><span class="op" id="1123402">(</span><span class="op" id="1123403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123407">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123411">select</span>&nbsp;<span class="op" id="1123418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123422">case</span>&nbsp;<span class="op" id="1123427">&lt;-</span><span class="ident" id="1123429"><a href="/sync/cond_test.go.html#1123051">awake</a></span><span class="op" id="1123434">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123439"><a href="/sync/cond_test.go.html#1122963">t</a></span><span class="op" id="1123440">.</span><span class="ident" id="1123441">Fatal</span><span class="op" id="1123446">(</span><span class="string" id="1123447">&#34;goroutine&nbsp;not&nbsp;asleep&#34;</span><span class="op" id="1123469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123473">default</span><span class="op" id="1123480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123484">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123488"><a href="/sync/cond_test.go.html#1122984">m</a></span><span class="op" id="1123489">.</span><span class="ident" id="1123490">Lock</span><span class="op" id="1123494">(</span><span class="op" id="1123495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123499"><a href="/sync/cond_test.go.html#1122993">c</a></span><span class="op" id="1123500">.</span><span class="ident" id="1123501">Broadcast</span><span class="op" id="1123510">(</span><span class="op" id="1123511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123515"><a href="/sync/cond_test.go.html#1122984">m</a></span><span class="op" id="1123516">.</span><span class="ident" id="1123517">Unlock</span><span class="op" id="1123523">(</span><span class="op" id="1123524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123528">seen</span>&nbsp;<span class="op" id="1123533">:=</span>&nbsp;<span class="builtinfunc" id="1123536">make</span><span class="op" id="1123540">(</span><span class="op" id="1123541">[</span><span class="op" id="1123542">]</span><span class="builtintype" id="1123543">bool</span><span class="op" id="1123547">,</span>&nbsp;<span class="ident" id="1123549"><a href="/sync/cond_test.go.html#1123011">n</a></span><span class="op" id="1123550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123554">for</span>&nbsp;<span class="ident" id="1123558">i</span>&nbsp;<span class="op" id="1123560">:=</span>&nbsp;<span class="num" id="1123563">0</span><span class="op" id="1123564">;</span>&nbsp;<span class="ident" id="1123566"><a href="/sync/cond_test.go.html#1123558">i</a></span>&nbsp;<span class="op" id="1123568">&lt;</span>&nbsp;<span class="ident" id="1123570"><a href="/sync/cond_test.go.html#1123011">n</a></span><span class="op" id="1123571">;</span>&nbsp;<span class="ident" id="1123573"><a href="/sync/cond_test.go.html#1123558">i</a></span><span class="op" id="1123574">++</span>&nbsp;<span class="op" id="1123577">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123582">g</span>&nbsp;<span class="op" id="1123584">:=</span>&nbsp;<span class="op" id="1123587">&lt;-</span><span class="ident" id="1123589"><a href="/sync/cond_test.go.html#1123051">awake</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123598">if</span>&nbsp;<span class="ident" id="1123601"><a href="/sync/cond_test.go.html#1123528">seen</a></span><span class="op" id="1123605">[</span><span class="ident" id="1123606"><a href="/sync/cond_test.go.html#1123582">g</a></span><span class="op" id="1123607">]</span>&nbsp;<span class="op" id="1123609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123615"><a href="/sync/cond_test.go.html#1122963">t</a></span><span class="op" id="1123616">.</span><span class="ident" id="1123617">Fatal</span><span class="op" id="1123622">(</span><span class="string" id="1123623">&#34;goroutine&nbsp;woke&nbsp;up&nbsp;twice&#34;</span><span class="op" id="1123648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123658"><a href="/sync/cond_test.go.html#1123528">seen</a></span><span class="op" id="1123662">[</span><span class="ident" id="1123663"><a href="/sync/cond_test.go.html#1123582">g</a></span><span class="op" id="1123664">]</span>&nbsp;<span class="op" id="1123666">=</span>&nbsp;<span class="ident" id="1123668">true</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123681">select</span>&nbsp;<span class="op" id="1123688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123691">case</span>&nbsp;<span class="op" id="1123696">&lt;-</span><span class="ident" id="1123698"><a href="/sync/cond_test.go.html#1123021">running</a></span><span class="op" id="1123705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123709"><a href="/sync/cond_test.go.html#1122963">t</a></span><span class="op" id="1123710">.</span><span class="ident" id="1123711">Fatal</span><span class="op" id="1123716">(</span><span class="string" id="1123717">&#34;goroutine&nbsp;did&nbsp;not&nbsp;exit&#34;</span><span class="op" id="1123741">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123744">default</span><span class="op" id="1123751">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123757"><a href="/sync/cond_test.go.html#1122993">c</a></span><span class="op" id="1123758">.</span><span class="ident" id="1123759">Broadcast</span><span class="op" id="1123768">(</span><span class="op" id="1123769">)</span><br>
<span class="lineno"></span><span class="op" id="1123771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="1123774">func</span>&nbsp;<span class="ident" id="1123779">TestRace</span><span class="op" id="1123787">(</span><span class="ident" id="1123788">t</span>&nbsp;<span class="op" id="1123790">*</span><span class="ident" id="1123791"><a href="/sync/cond_test.go.html#1121869">testing</a></span><span class="op" id="1123798">.</span><span class="ident" id="1123799">T</span><span class="op" id="1123800">)</span>&nbsp;<span class="op" id="1123802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123805">x</span>&nbsp;<span class="op" id="1123807">:=</span>&nbsp;<span class="num" id="1123810">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123813">c</span>&nbsp;<span class="op" id="1123815">:=</span>&nbsp;<span class="ident" id="1123818"><a href="/sync/cond.go.html#1671270">NewCond</a></span><span class="op" id="1123825">(</span><span class="op" id="1123826">&amp;</span><span class="ident" id="1123827"><a href="/sync/mutex.go.html#1673941">Mutex</a></span><span class="op" id="1123832">{</span><span class="op" id="1123833">}</span><span class="op" id="1123834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123837">done</span>&nbsp;<span class="op" id="1123842">:=</span>&nbsp;<span class="builtinfunc" id="1123845">make</span><span class="op" id="1123849">(</span><span class="keyword" id="1123850">chan</span>&nbsp;<span class="builtintype" id="1123855">bool</span><span class="op" id="1123859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123862">go</span>&nbsp;<span class="keyword" id="1123865">func</span><span class="op" id="1123869">(</span><span class="op" id="1123870">)</span>&nbsp;<span class="op" id="1123872">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123876"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1123877">.</span><span class="ident" id="1123878">L</span><span class="op" id="1123879">.</span><span class="ident" id="1123880">Lock</span><span class="op" id="1123884">(</span><span class="op" id="1123885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123889"><a href="/sync/cond_test.go.html#1123805">x</a></span>&nbsp;<span class="op" id="1123891">=</span>&nbsp;<span class="num" id="1123893">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123897"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1123898">.</span><span class="ident" id="1123899">Wait</span><span class="op" id="1123903">(</span><span class="op" id="1123904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1123908">if</span>&nbsp;<span class="ident" id="1123911"><a href="/sync/cond_test.go.html#1123805">x</a></span>&nbsp;<span class="op" id="1123913">!=</span>&nbsp;<span class="num" id="1123916">2</span>&nbsp;<span class="op" id="1123918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123923"><a href="/sync/cond_test.go.html#1123788">t</a></span><span class="op" id="1123924">.</span><span class="ident" id="1123925">Fatal</span><span class="op" id="1123930">(</span><span class="string" id="1123931">&#34;want&nbsp;2&#34;</span><span class="op" id="1123939">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123947"><a href="/sync/cond_test.go.html#1123805">x</a></span>&nbsp;<span class="op" id="1123949">=</span>&nbsp;<span class="num" id="1123951">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123955"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1123956">.</span><span class="ident" id="1123957">Signal</span><span class="op" id="1123963">(</span><span class="op" id="1123964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123968"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1123969">.</span><span class="ident" id="1123970">L</span><span class="op" id="1123971">.</span><span class="ident" id="1123972">Unlock</span><span class="op" id="1123978">(</span><span class="op" id="1123979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1123983"><a href="/sync/cond_test.go.html#1123837">done</a></span>&nbsp;<span class="op" id="1123988">&lt;-</span>&nbsp;<span class="ident" id="1123991">true</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1123997">}</span><span class="op" id="1123998">(</span><span class="op" id="1123999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124002">go</span>&nbsp;<span class="keyword" id="1124005">func</span><span class="op" id="1124009">(</span><span class="op" id="1124010">)</span>&nbsp;<span class="op" id="1124012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124016"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1124017">.</span><span class="ident" id="1124018">L</span><span class="op" id="1124019">.</span><span class="ident" id="1124020">Lock</span><span class="op" id="1124024">(</span><span class="op" id="1124025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124029">for</span>&nbsp;<span class="op" id="1124033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124038">if</span>&nbsp;<span class="ident" id="1124041"><a href="/sync/cond_test.go.html#1123805">x</a></span>&nbsp;<span class="op" id="1124043">==</span>&nbsp;<span class="num" id="1124046">1</span>&nbsp;<span class="op" id="1124048">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124054"><a href="/sync/cond_test.go.html#1123805">x</a></span>&nbsp;<span class="op" id="1124056">=</span>&nbsp;<span class="num" id="1124058">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124064"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1124065">.</span><span class="ident" id="1124066">Signal</span><span class="op" id="1124072">(</span><span class="op" id="1124073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124079">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124093"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1124094">.</span><span class="ident" id="1124095">L</span><span class="op" id="1124096">.</span><span class="ident" id="1124097">Unlock</span><span class="op" id="1124103">(</span><span class="op" id="1124104">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124109"><a href="/sync/cond_test.go.html#1121858">runtime</a></span><span class="op" id="1124116">.</span><span class="ident" id="1124117">Gosched</span><span class="op" id="1124124">(</span><span class="op" id="1124125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124130"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1124131">.</span><span class="ident" id="1124132">L</span><span class="op" id="1124133">.</span><span class="ident" id="1124134">Lock</span><span class="op" id="1124138">(</span><span class="op" id="1124139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124147"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1124148">.</span><span class="ident" id="1124149">L</span><span class="op" id="1124150">.</span><span class="ident" id="1124151">Unlock</span><span class="op" id="1124157">(</span><span class="op" id="1124158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124162"><a href="/sync/cond_test.go.html#1123837">done</a></span>&nbsp;<span class="op" id="1124167">&lt;-</span>&nbsp;<span class="ident" id="1124170">true</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124176">}</span><span class="op" id="1124177">(</span><span class="op" id="1124178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124181">go</span>&nbsp;<span class="keyword" id="1124184">func</span><span class="op" id="1124188">(</span><span class="op" id="1124189">)</span>&nbsp;<span class="op" id="1124191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124195"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1124196">.</span><span class="ident" id="1124197">L</span><span class="op" id="1124198">.</span><span class="ident" id="1124199">Lock</span><span class="op" id="1124203">(</span><span class="op" id="1124204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124208">for</span>&nbsp;<span class="op" id="1124212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124217">if</span>&nbsp;<span class="ident" id="1124220"><a href="/sync/cond_test.go.html#1123805">x</a></span>&nbsp;<span class="op" id="1124222">==</span>&nbsp;<span class="num" id="1124225">2</span>&nbsp;<span class="op" id="1124227">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124233"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1124234">.</span><span class="ident" id="1124235">Wait</span><span class="op" id="1124239">(</span><span class="op" id="1124240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124246">if</span>&nbsp;<span class="ident" id="1124249"><a href="/sync/cond_test.go.html#1123805">x</a></span>&nbsp;<span class="op" id="1124251">!=</span>&nbsp;<span class="num" id="1124254">3</span>&nbsp;<span class="op" id="1124256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124263"><a href="/sync/cond_test.go.html#1123788">t</a></span><span class="op" id="1124264">.</span><span class="ident" id="1124265">Fatal</span><span class="op" id="1124270">(</span><span class="string" id="1124271">&#34;want&nbsp;3&#34;</span><span class="op" id="1124279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124291">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124305">if</span>&nbsp;<span class="ident" id="1124308"><a href="/sync/cond_test.go.html#1123805">x</a></span>&nbsp;<span class="op" id="1124310">==</span>&nbsp;<span class="num" id="1124313">3</span>&nbsp;<span class="op" id="1124315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124321">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124335"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1124336">.</span><span class="ident" id="1124337">L</span><span class="op" id="1124338">.</span><span class="ident" id="1124339">Unlock</span><span class="op" id="1124345">(</span><span class="op" id="1124346">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124351"><a href="/sync/cond_test.go.html#1121858">runtime</a></span><span class="op" id="1124358">.</span><span class="ident" id="1124359">Gosched</span><span class="op" id="1124366">(</span><span class="op" id="1124367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124372"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1124373">.</span><span class="ident" id="1124374">L</span><span class="op" id="1124375">.</span><span class="ident" id="1124376">Lock</span><span class="op" id="1124380">(</span><span class="op" id="1124381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124389"><a href="/sync/cond_test.go.html#1123813">c</a></span><span class="op" id="1124390">.</span><span class="ident" id="1124391">L</span><span class="op" id="1124392">.</span><span class="ident" id="1124393">Unlock</span><span class="op" id="1124399">(</span><span class="op" id="1124400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124404"><a href="/sync/cond_test.go.html#1123837">done</a></span>&nbsp;<span class="op" id="1124409">&lt;-</span>&nbsp;<span class="ident" id="1124412">true</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124418">}</span><span class="op" id="1124419">(</span><span class="op" id="1124420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124423">&lt;-</span><span class="ident" id="1124425"><a href="/sync/cond_test.go.html#1123837">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124431">&lt;-</span><span class="ident" id="1124433"><a href="/sync/cond_test.go.html#1123837">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124439">&lt;-</span><span class="ident" id="1124441"><a href="/sync/cond_test.go.html#1123837">done</a></span><br>
<span class="lineno"></span><span class="op" id="1124446">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="1124449">func</span>&nbsp;<span class="ident" id="1124454">TestCondCopy</span><span class="op" id="1124466">(</span><span class="ident" id="1124467">t</span>&nbsp;<span class="op" id="1124469">*</span><span class="ident" id="1124470"><a href="/sync/cond_test.go.html#1121869">testing</a></span><span class="op" id="1124477">.</span><span class="ident" id="1124478">T</span><span class="op" id="1124479">)</span>&nbsp;<span class="op" id="1124481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124484">defer</span>&nbsp;<span class="keyword" id="1124490">func</span><span class="op" id="1124494">(</span><span class="op" id="1124495">)</span>&nbsp;<span class="op" id="1124497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124501">err</span>&nbsp;<span class="op" id="1124505">:=</span>&nbsp;<span class="builtinfunc" id="1124508">recover</span><span class="op" id="1124515">(</span><span class="op" id="1124516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1124520">if</span>&nbsp;<span class="ident" id="1124523"><a href="/sync/cond_test.go.html#1124501">err</a></span>&nbsp;<span class="op" id="1124527">==</span>&nbsp;<span class="ident" id="1124530">nil</span>&nbsp;<span class="op" id="1124534">||</span>&nbsp;<span class="ident" id="1124537"><a href="/sync/cond_test.go.html#1124501">err</a></span><span class="op" id="1124540">.</span><span class="op" id="1124541">(</span><span class="builtintype" id="1124542">string</span><span class="op" id="1124548">)</span>&nbsp;<span class="op" id="1124550">!=</span>&nbsp;<span class="string" id="1124553">&#34;sync.Cond&nbsp;is&nbsp;copied&#34;</span>&nbsp;<span class="op" id="1124575">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124580"><a href="/sync/cond_test.go.html#1124467">t</a></span><span class="op" id="1124581">.</span><span class="ident" id="1124582">Fatalf</span><span class="op" id="1124588">(</span><span class="string" id="1124589">&#34;got&nbsp;%v,&nbsp;expect&nbsp;sync.Cond&nbsp;is&nbsp;copied&#34;</span><span class="op" id="1124625">,</span>&nbsp;<span class="ident" id="1124627"><a href="/sync/cond_test.go.html#1124501">err</a></span><span class="op" id="1124630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1124637">}</span><span class="op" id="1124638">(</span><span class="op" id="1124639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124642">c</span>&nbsp;<span class="op" id="1124644">:=</span>&nbsp;<span class="ident" id="1124647"><a href="/sync/cond.go.html#1671060">Cond</a></span><span class="op" id="1124651">{</span><span class="ident" id="1124652">L</span><span class="op" id="1124653">:</span>&nbsp;<span class="op" id="1124655">&amp;</span><span class="ident" id="1124656"><a href="/sync/mutex.go.html#1673941">Mutex</a></span><span class="op" id="1124661">{</span><span class="op" id="1124662">}</span><span class="op" id="1124663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124666"><a href="/sync/cond_test.go.html#1124642">c</a></span><span class="op" id="1124667">.</span><span class="ident" id="1124668">Signal</span><span class="op" id="1124674">(</span><span class="op" id="1124675">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124678">c2</span>&nbsp;<span class="op" id="1124681">:=</span>&nbsp;<span class="ident" id="1124684"><a href="/sync/cond_test.go.html#1124642">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124687"><a href="/sync/cond_test.go.html#1124678">c2</a></span><span class="op" id="1124689">.</span><span class="ident" id="1124690">Signal</span><span class="op" id="1124696">(</span><span class="op" id="1124697">)</span><br>
<span class="lineno"></span><span class="op" id="1124699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1124702">func</span>&nbsp;<span class="ident" id="1124707">BenchmarkCond1</span><span class="op" id="1124721">(</span><span class="ident" id="1124722">b</span>&nbsp;<span class="op" id="1124724">*</span><span class="ident" id="1124725"><a href="/sync/cond_test.go.html#1121869">testing</a></span><span class="op" id="1124732">.</span><span class="ident" id="1124733">B</span><span class="op" id="1124734">)</span>&nbsp;<span class="op" id="1124736">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124739"><a href="/sync/cond_test.go.html#1125071">benchmarkCond</a></span><span class="op" id="1124752">(</span><span class="ident" id="1124753"><a href="/sync/cond_test.go.html#1124722">b</a></span><span class="op" id="1124754">,</span>&nbsp;<span class="num" id="1124756">1</span><span class="op" id="1124757">)</span><br>
<span class="lineno"></span><span class="op" id="1124759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1124762">func</span>&nbsp;<span class="ident" id="1124767">BenchmarkCond2</span><span class="op" id="1124781">(</span><span class="ident" id="1124782">b</span>&nbsp;<span class="op" id="1124784">*</span><span class="ident" id="1124785"><a href="/sync/cond_test.go.html#1121869">testing</a></span><span class="op" id="1124792">.</span><span class="ident" id="1124793">B</span><span class="op" id="1124794">)</span>&nbsp;<span class="op" id="1124796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124799"><a href="/sync/cond_test.go.html#1125071">benchmarkCond</a></span><span class="op" id="1124812">(</span><span class="ident" id="1124813"><a href="/sync/cond_test.go.html#1124782">b</a></span><span class="op" id="1124814">,</span>&nbsp;<span class="num" id="1124816">2</span><span class="op" id="1124817">)</span><br>
<span class="lineno">205</span><span class="op" id="1124819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1124822">func</span>&nbsp;<span class="ident" id="1124827">BenchmarkCond4</span><span class="op" id="1124841">(</span><span class="ident" id="1124842">b</span>&nbsp;<span class="op" id="1124844">*</span><span class="ident" id="1124845"><a href="/sync/cond_test.go.html#1121869">testing</a></span><span class="op" id="1124852">.</span><span class="ident" id="1124853">B</span><span class="op" id="1124854">)</span>&nbsp;<span class="op" id="1124856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124859"><a href="/sync/cond_test.go.html#1125071">benchmarkCond</a></span><span class="op" id="1124872">(</span><span class="ident" id="1124873"><a href="/sync/cond_test.go.html#1124842">b</a></span><span class="op" id="1124874">,</span>&nbsp;<span class="num" id="1124876">4</span><span class="op" id="1124877">)</span><br>
<span class="lineno"></span><span class="op" id="1124879">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="1124882">func</span>&nbsp;<span class="ident" id="1124887">BenchmarkCond8</span><span class="op" id="1124901">(</span><span class="ident" id="1124902">b</span>&nbsp;<span class="op" id="1124904">*</span><span class="ident" id="1124905"><a href="/sync/cond_test.go.html#1121869">testing</a></span><span class="op" id="1124912">.</span><span class="ident" id="1124913">B</span><span class="op" id="1124914">)</span>&nbsp;<span class="op" id="1124916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124919"><a href="/sync/cond_test.go.html#1125071">benchmarkCond</a></span><span class="op" id="1124932">(</span><span class="ident" id="1124933"><a href="/sync/cond_test.go.html#1124902">b</a></span><span class="op" id="1124934">,</span>&nbsp;<span class="num" id="1124936">8</span><span class="op" id="1124937">)</span><br>
<span class="lineno"></span><span class="op" id="1124939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1124942">func</span>&nbsp;<span class="ident" id="1124947">BenchmarkCond16</span><span class="op" id="1124962">(</span><span class="ident" id="1124963">b</span>&nbsp;<span class="op" id="1124965">*</span><span class="ident" id="1124966"><a href="/sync/cond_test.go.html#1121869">testing</a></span><span class="op" id="1124973">.</span><span class="ident" id="1124974">B</span><span class="op" id="1124975">)</span>&nbsp;<span class="op" id="1124977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1124980"><a href="/sync/cond_test.go.html#1125071">benchmarkCond</a></span><span class="op" id="1124993">(</span><span class="ident" id="1124994"><a href="/sync/cond_test.go.html#1124963">b</a></span><span class="op" id="1124995">,</span>&nbsp;<span class="num" id="1124997">16</span><span class="op" id="1124999">)</span><br>
<span class="lineno"></span><span class="op" id="1125001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1125004">func</span>&nbsp;<span class="ident" id="1125009">BenchmarkCond32</span><span class="op" id="1125024">(</span><span class="ident" id="1125025">b</span>&nbsp;<span class="op" id="1125027">*</span><span class="ident" id="1125028"><a href="/sync/cond_test.go.html#1121869">testing</a></span><span class="op" id="1125035">.</span><span class="ident" id="1125036">B</span><span class="op" id="1125037">)</span>&nbsp;<span class="op" id="1125039">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125042"><a href="/sync/cond_test.go.html#1125071">benchmarkCond</a></span><span class="op" id="1125055">(</span><span class="ident" id="1125056"><a href="/sync/cond_test.go.html#1125025">b</a></span><span class="op" id="1125057">,</span>&nbsp;<span class="num" id="1125059">32</span><span class="op" id="1125061">)</span><br>
<span class="lineno"></span><span class="op" id="1125063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1125066">func</span>&nbsp;<span class="ident" id="1125071">benchmarkCond</span><span class="op" id="1125084">(</span><span class="ident" id="1125085">b</span>&nbsp;<span class="op" id="1125087">*</span><span class="ident" id="1125088"><a href="/sync/cond_test.go.html#1121869">testing</a></span><span class="op" id="1125095">.</span><span class="ident" id="1125096">B</span><span class="op" id="1125097">,</span>&nbsp;<span class="ident" id="1125099">waiters</span>&nbsp;<span class="builtintype" id="1125107">int</span><span class="op" id="1125110">)</span>&nbsp;<span class="op" id="1125112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125115">c</span>&nbsp;<span class="op" id="1125117">:=</span>&nbsp;<span class="ident" id="1125120"><a href="/sync/cond.go.html#1671270">NewCond</a></span><span class="op" id="1125127">(</span><span class="op" id="1125128">&amp;</span><span class="ident" id="1125129"><a href="/sync/mutex.go.html#1673941">Mutex</a></span><span class="op" id="1125134">{</span><span class="op" id="1125135">}</span><span class="op" id="1125136">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125139">done</span>&nbsp;<span class="op" id="1125144">:=</span>&nbsp;<span class="builtinfunc" id="1125147">make</span><span class="op" id="1125151">(</span><span class="keyword" id="1125152">chan</span>&nbsp;<span class="builtintype" id="1125157">bool</span><span class="op" id="1125161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125164">id</span>&nbsp;<span class="op" id="1125167">:=</span>&nbsp;<span class="num" id="1125170">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1125174">for</span>&nbsp;<span class="ident" id="1125178">routine</span>&nbsp;<span class="op" id="1125186">:=</span>&nbsp;<span class="num" id="1125189">0</span><span class="op" id="1125190">;</span>&nbsp;<span class="ident" id="1125192"><a href="/sync/cond_test.go.html#1125178">routine</a></span>&nbsp;<span class="op" id="1125200">&lt;</span>&nbsp;<span class="ident" id="1125202"><a href="/sync/cond_test.go.html#1125099">waiters</a></span><span class="op" id="1125209">+</span><span class="num" id="1125210">1</span><span class="op" id="1125211">;</span>&nbsp;<span class="ident" id="1125213"><a href="/sync/cond_test.go.html#1125178">routine</a></span><span class="op" id="1125220">++</span>&nbsp;<span class="op" id="1125223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1125227">go</span>&nbsp;<span class="keyword" id="1125230">func</span><span class="op" id="1125234">(</span><span class="op" id="1125235">)</span>&nbsp;<span class="op" id="1125237">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1125242">for</span>&nbsp;<span class="ident" id="1125246">i</span>&nbsp;<span class="op" id="1125248">:=</span>&nbsp;<span class="num" id="1125251">0</span><span class="op" id="1125252">;</span>&nbsp;<span class="ident" id="1125254"><a href="/sync/cond_test.go.html#1125246">i</a></span>&nbsp;<span class="op" id="1125256">&lt;</span>&nbsp;<span class="ident" id="1125258"><a href="/sync/cond_test.go.html#1125085">b</a></span><span class="op" id="1125259">.</span><span class="ident" id="1125260">N</span><span class="op" id="1125261">;</span>&nbsp;<span class="ident" id="1125263"><a href="/sync/cond_test.go.html#1125246">i</a></span><span class="op" id="1125264">++</span>&nbsp;<span class="op" id="1125267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125273"><a href="/sync/cond_test.go.html#1125115">c</a></span><span class="op" id="1125274">.</span><span class="ident" id="1125275">L</span><span class="op" id="1125276">.</span><span class="ident" id="1125277">Lock</span><span class="op" id="1125281">(</span><span class="op" id="1125282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1125288">if</span>&nbsp;<span class="ident" id="1125291"><a href="/sync/cond_test.go.html#1125164">id</a></span>&nbsp;<span class="op" id="1125294">==</span>&nbsp;<span class="op" id="1125297">-</span><span class="num" id="1125298">1</span>&nbsp;<span class="op" id="1125300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125307"><a href="/sync/cond_test.go.html#1125115">c</a></span><span class="op" id="1125308">.</span><span class="ident" id="1125309">L</span><span class="op" id="1125310">.</span><span class="ident" id="1125311">Unlock</span><span class="op" id="1125317">(</span><span class="op" id="1125318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1125325">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1125335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125341"><a href="/sync/cond_test.go.html#1125164">id</a></span><span class="op" id="1125343">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1125350">if</span>&nbsp;<span class="ident" id="1125353"><a href="/sync/cond_test.go.html#1125164">id</a></span>&nbsp;<span class="op" id="1125356">==</span>&nbsp;<span class="ident" id="1125359"><a href="/sync/cond_test.go.html#1125099">waiters</a></span><span class="op" id="1125366">+</span><span class="num" id="1125367">1</span>&nbsp;<span class="op" id="1125369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125376"><a href="/sync/cond_test.go.html#1125164">id</a></span>&nbsp;<span class="op" id="1125379">=</span>&nbsp;<span class="num" id="1125381">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125388"><a href="/sync/cond_test.go.html#1125115">c</a></span><span class="op" id="1125389">.</span><span class="ident" id="1125390">Broadcast</span><span class="op" id="1125399">(</span><span class="op" id="1125400">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1125406">}</span>&nbsp;<span class="keyword" id="1125408">else</span>&nbsp;<span class="op" id="1125413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125420"><a href="/sync/cond_test.go.html#1125115">c</a></span><span class="op" id="1125421">.</span><span class="ident" id="1125422">Wait</span><span class="op" id="1125426">(</span><span class="op" id="1125427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1125433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125439"><a href="/sync/cond_test.go.html#1125115">c</a></span><span class="op" id="1125440">.</span><span class="ident" id="1125441">L</span><span class="op" id="1125442">.</span><span class="ident" id="1125443">Unlock</span><span class="op" id="1125449">(</span><span class="op" id="1125450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1125455">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125460"><a href="/sync/cond_test.go.html#1125115">c</a></span><span class="op" id="1125461">.</span><span class="ident" id="1125462">L</span><span class="op" id="1125463">.</span><span class="ident" id="1125464">Lock</span><span class="op" id="1125468">(</span><span class="op" id="1125469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125474"><a href="/sync/cond_test.go.html#1125164">id</a></span>&nbsp;<span class="op" id="1125477">=</span>&nbsp;<span class="op" id="1125479">-</span><span class="num" id="1125480">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125485"><a href="/sync/cond_test.go.html#1125115">c</a></span><span class="op" id="1125486">.</span><span class="ident" id="1125487">Broadcast</span><span class="op" id="1125496">(</span><span class="op" id="1125497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125502"><a href="/sync/cond_test.go.html#1125115">c</a></span><span class="op" id="1125503">.</span><span class="ident" id="1125504">L</span><span class="op" id="1125505">.</span><span class="ident" id="1125506">Unlock</span><span class="op" id="1125512">(</span><span class="op" id="1125513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1125518"><a href="/sync/cond_test.go.html#1125139">done</a></span>&nbsp;<span class="op" id="1125523">&lt;-</span>&nbsp;<span class="ident" id="1125526">true</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1125533">}</span><span class="op" id="1125534">(</span><span class="op" id="1125535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1125538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1125541">for</span>&nbsp;<span class="ident" id="1125545">routine</span>&nbsp;<span class="op" id="1125553">:=</span>&nbsp;<span class="num" id="1125556">0</span><span class="op" id="1125557">;</span>&nbsp;<span class="ident" id="1125559"><a href="/sync/cond_test.go.html#1125545">routine</a></span>&nbsp;<span class="op" id="1125567">&lt;</span>&nbsp;<span class="ident" id="1125569"><a href="/sync/cond_test.go.html#1125099">waiters</a></span><span class="op" id="1125576">+</span><span class="num" id="1125577">1</span><span class="op" id="1125578">;</span>&nbsp;<span class="ident" id="1125580"><a href="/sync/cond_test.go.html#1125545">routine</a></span><span class="op" id="1125587">++</span>&nbsp;<span class="op" id="1125590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1125594">&lt;-</span><span class="ident" id="1125596"><a href="/sync/cond_test.go.html#1125139">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1125602">}</span><br>
<span class="lineno">255</span><span class="op" id="1125604">}</span>
</div>
</body>
</html>
