<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>log/syslog</h2>
<ul>
<li><a href="/gostd/log/syslog/syslog.go.html" class="current">syslog.go</a></li>
<li><a href="/gostd/log/syslog/syslog_test.go.html">syslog_test.go</a></li>
<li><a href="/gostd/log/syslog/syslog_unix.go.html">syslog_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6266284">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6266339">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6266393">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6266444">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6266477">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="6266541">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="6266606">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="6266637">//</span><br>
<span class="lineno"></span><span class="comment" id="6266640">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="6266698">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="6266759">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="6266779">package</span>&nbsp;<span class="ident" id="6266787">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6266795">import</span>&nbsp;<span class="op" id="6266802">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6266805">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6266815">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6266822">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6266829">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6266836">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6266842">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6266853">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6266861">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6266868">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6266871">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6266931">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6267001">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="6267070">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="6267107">type</span>&nbsp;<span class="ident" id="6267112">Priority</span>&nbsp;<span class="builtintype" id="6267121">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6267126">const</span>&nbsp;<span class="ident" id="6267132">severityMask</span>&nbsp;<span class="op" id="6267145">=</span>&nbsp;<span class="num" id="6267147">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="6267152">const</span>&nbsp;<span class="ident" id="6267158">facilityMask</span>&nbsp;<span class="op" id="6267171">=</span>&nbsp;<span class="num" id="6267173">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6267179">const</span>&nbsp;<span class="op" id="6267185">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6267188">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6267203">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6267239">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267287">LOG_EMERG</span>&nbsp;<span class="ident" id="6267297">Priority</span>&nbsp;<span class="op" id="6267306">=</span>&nbsp;<span class="ident" id="6267308">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267314">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267325">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267335">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267344">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267357">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267369">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267379">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="6267389">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6267392">const</span>&nbsp;<span class="op" id="6267398">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6267401">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6267416">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6267452">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267514">LOG_KERN</span>&nbsp;<span class="ident" id="6267523">Priority</span>&nbsp;<span class="op" id="6267532">=</span>&nbsp;<span class="ident" id="6267534">iota</span>&nbsp;<span class="op" id="6267539">&lt;&lt;</span>&nbsp;<span class="num" id="6267542">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267545">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267555">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267565">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267577">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267587">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267599">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267608">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267618">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267628">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267638">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267652">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267661">_</span>&nbsp;<span class="comment" id="6267663">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267674">_</span>&nbsp;<span class="comment" id="6267676">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267687">_</span>&nbsp;<span class="comment" id="6267689">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267700">_</span>&nbsp;<span class="comment" id="6267702">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267713">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267725">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267737">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267749">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267761">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267773">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267785">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267797">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="6267808">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6267811">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6267859">type</span>&nbsp;<span class="ident" id="6267864">Writer</span>&nbsp;<span class="keyword" id="6267871">struct</span>&nbsp;<span class="op" id="6267878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267881">priority</span>&nbsp;<span class="ident" id="6267890">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267900">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6267909">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267917">hostname</span>&nbsp;<span class="builtintype" id="6267926">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267934">network</span>&nbsp;&nbsp;<span class="builtintype" id="6267943">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267951">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6267960">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6267969">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6267974">sync</span><span class="op" id="6267978">.</span><span class="ident" id="6267979">Mutex</span>&nbsp;<span class="comment" id="6267985">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6268001">conn</span>&nbsp;<span class="ident" id="6268006">serverConn</span><br>
<span class="lineno"></span><span class="op" id="6268017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6268020">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="6268085">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6268153">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="6268218">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6268289">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="6268359">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="6268387">type</span>&nbsp;<span class="ident" id="6268392">serverConn</span>&nbsp;<span class="keyword" id="6268403">interface</span>&nbsp;<span class="op" id="6268413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6268416">writeString</span><span class="op" id="6268427">(</span><span class="ident" id="6268428">p</span>&nbsp;<span class="ident" id="6268430">Priority</span><span class="op" id="6268438">,</span>&nbsp;<span class="ident" id="6268440">hostname</span><span class="op" id="6268448">,</span>&nbsp;<span class="ident" id="6268450">tag</span><span class="op" id="6268453">,</span>&nbsp;<span class="ident" id="6268455">s</span><span class="op" id="6268456">,</span>&nbsp;<span class="ident" id="6268458">nl</span>&nbsp;<span class="builtintype" id="6268461">string</span><span class="op" id="6268467">)</span>&nbsp;<span class="builtintype" id="6268469">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6268476">close</span><span class="op" id="6268481">(</span><span class="op" id="6268482">)</span>&nbsp;<span class="builtintype" id="6268484">error</span><br>
<span class="lineno"></span><span class="op" id="6268490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6268493">type</span>&nbsp;<span class="ident" id="6268498">netConn</span>&nbsp;<span class="keyword" id="6268506">struct</span>&nbsp;<span class="op" id="6268513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6268516">local</span>&nbsp;<span class="builtintype" id="6268522">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6268528">conn</span>&nbsp;&nbsp;<span class="ident" id="6268534">net</span><span class="op" id="6268537">.</span><span class="ident" id="6268538">Conn</span><br>
<span class="lineno"></span><span class="op" id="6268543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6268546">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="6268614">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6268681">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6268705">func</span>&nbsp;<span class="ident" id="6268710">New</span><span class="op" id="6268713">(</span><span class="ident" id="6268714">priority</span>&nbsp;<span class="ident" id="6268723">Priority</span><span class="op" id="6268731">,</span>&nbsp;<span class="ident" id="6268733">tag</span>&nbsp;<span class="builtintype" id="6268737">string</span><span class="op" id="6268743">)</span>&nbsp;<span class="op" id="6268745">(</span><span class="ident" id="6268746">w</span>&nbsp;<span class="op" id="6268748">*</span><span class="ident" id="6268749">Writer</span><span class="op" id="6268755">,</span>&nbsp;<span class="ident" id="6268757">err</span>&nbsp;<span class="builtintype" id="6268761">error</span><span class="op" id="6268766">)</span>&nbsp;<span class="op" id="6268768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6268771">return</span>&nbsp;<span class="ident" id="6268778">Dial</span><span class="op" id="6268782">(</span><span class="string" id="6268783">&#34;&#34;</span><span class="op" id="6268785">,</span>&nbsp;<span class="string" id="6268787">&#34;&#34;</span><span class="op" id="6268789">,</span>&nbsp;<span class="ident" id="6268791">priority</span><span class="op" id="6268799">,</span>&nbsp;<span class="ident" id="6268801">tag</span><span class="op" id="6268804">)</span><br>
<span class="lineno">115</span><span class="op" id="6268806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6268809">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6268875">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6268946">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="6269014">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="6269022">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6269092">func</span>&nbsp;<span class="ident" id="6269097">Dial</span><span class="op" id="6269101">(</span><span class="ident" id="6269102">network</span><span class="op" id="6269109">,</span>&nbsp;<span class="ident" id="6269111">raddr</span>&nbsp;<span class="builtintype" id="6269117">string</span><span class="op" id="6269123">,</span>&nbsp;<span class="ident" id="6269125">priority</span>&nbsp;<span class="ident" id="6269134">Priority</span><span class="op" id="6269142">,</span>&nbsp;<span class="ident" id="6269144">tag</span>&nbsp;<span class="builtintype" id="6269148">string</span><span class="op" id="6269154">)</span>&nbsp;<span class="op" id="6269156">(</span><span class="op" id="6269157">*</span><span class="ident" id="6269158">Writer</span><span class="op" id="6269164">,</span>&nbsp;<span class="builtintype" id="6269166">error</span><span class="op" id="6269171">)</span>&nbsp;<span class="op" id="6269173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6269176">if</span>&nbsp;<span class="ident" id="6269179">priority</span>&nbsp;<span class="op" id="6269188">&lt;</span>&nbsp;<span class="num" id="6269190">0</span>&nbsp;<span class="op" id="6269192">||</span>&nbsp;<span class="ident" id="6269195">priority</span>&nbsp;<span class="op" id="6269204">&gt;</span>&nbsp;<span class="ident" id="6269206">LOG_LOCAL7</span><span class="op" id="6269216">|</span><span class="ident" id="6269217">LOG_DEBUG</span>&nbsp;<span class="op" id="6269227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6269231">return</span>&nbsp;<span class="ident" id="6269238">nil</span><span class="op" id="6269241">,</span>&nbsp;<span class="ident" id="6269243">errors</span><span class="op" id="6269249">.</span><span class="ident" id="6269250">New</span><span class="op" id="6269253">(</span><span class="string" id="6269254">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="6269284">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6269287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6269291">if</span>&nbsp;<span class="ident" id="6269294">tag</span>&nbsp;<span class="op" id="6269298">==</span>&nbsp;<span class="string" id="6269301">&#34;&#34;</span>&nbsp;<span class="op" id="6269304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269308">tag</span>&nbsp;<span class="op" id="6269312">=</span>&nbsp;<span class="ident" id="6269314">os</span><span class="op" id="6269316">.</span><span class="ident" id="6269317">Args</span><span class="op" id="6269321">[</span><span class="num" id="6269322">0</span><span class="op" id="6269323">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6269326">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269329">hostname</span><span class="op" id="6269337">,</span>&nbsp;<span class="ident" id="6269339">_</span>&nbsp;<span class="op" id="6269341">:=</span>&nbsp;<span class="ident" id="6269344">os</span><span class="op" id="6269346">.</span><span class="ident" id="6269347">Hostname</span><span class="op" id="6269355">(</span><span class="op" id="6269356">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269360">w</span>&nbsp;<span class="op" id="6269362">:=</span>&nbsp;<span class="op" id="6269365">&amp;</span><span class="ident" id="6269366">Writer</span><span class="op" id="6269372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269376">priority</span><span class="op" id="6269384">:</span>&nbsp;<span class="ident" id="6269386">priority</span><span class="op" id="6269394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269398">tag</span><span class="op" id="6269401">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269408">tag</span><span class="op" id="6269411">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269415">hostname</span><span class="op" id="6269423">:</span>&nbsp;<span class="ident" id="6269425">hostname</span><span class="op" id="6269433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269437">network</span><span class="op" id="6269444">:</span>&nbsp;&nbsp;<span class="ident" id="6269447">network</span><span class="op" id="6269454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269458">raddr</span><span class="op" id="6269463">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269468">raddr</span><span class="op" id="6269473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6269476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269480">w</span><span class="op" id="6269481">.</span><span class="ident" id="6269482">mu</span><span class="op" id="6269484">.</span><span class="ident" id="6269485">Lock</span><span class="op" id="6269489">(</span><span class="op" id="6269490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6269493">defer</span>&nbsp;<span class="ident" id="6269499">w</span><span class="op" id="6269500">.</span><span class="ident" id="6269501">mu</span><span class="op" id="6269503">.</span><span class="ident" id="6269504">Unlock</span><span class="op" id="6269510">(</span><span class="op" id="6269511">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269515">err</span>&nbsp;<span class="op" id="6269519">:=</span>&nbsp;<span class="ident" id="6269522">w</span><span class="op" id="6269523">.</span><span class="ident" id="6269524">connect</span><span class="op" id="6269531">(</span><span class="op" id="6269532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6269535">if</span>&nbsp;<span class="ident" id="6269538">err</span>&nbsp;<span class="op" id="6269542">!=</span>&nbsp;<span class="ident" id="6269545">nil</span>&nbsp;<span class="op" id="6269549">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6269553">return</span>&nbsp;<span class="ident" id="6269560">nil</span><span class="op" id="6269563">,</span>&nbsp;<span class="ident" id="6269565">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6269570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6269573">return</span>&nbsp;<span class="ident" id="6269580">w</span><span class="op" id="6269581">,</span>&nbsp;<span class="ident" id="6269583">err</span><br>
<span class="lineno"></span><span class="op" id="6269587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6269590">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6269642">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="6269679">func</span>&nbsp;<span class="op" id="6269684">(</span><span class="ident" id="6269685">w</span>&nbsp;<span class="op" id="6269687">*</span><span class="ident" id="6269688">Writer</span><span class="op" id="6269694">)</span>&nbsp;<span class="ident" id="6269696">connect</span><span class="op" id="6269703">(</span><span class="op" id="6269704">)</span>&nbsp;<span class="op" id="6269706">(</span><span class="ident" id="6269707">err</span>&nbsp;<span class="builtintype" id="6269711">error</span><span class="op" id="6269716">)</span>&nbsp;<span class="op" id="6269718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6269721">if</span>&nbsp;<span class="ident" id="6269724">w</span><span class="op" id="6269725">.</span><span class="ident" id="6269726">conn</span>&nbsp;<span class="op" id="6269731">!=</span>&nbsp;<span class="ident" id="6269734">nil</span>&nbsp;<span class="op" id="6269738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6269742">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269804">w</span><span class="op" id="6269805">.</span><span class="ident" id="6269806">conn</span><span class="op" id="6269810">.</span><span class="builtinfunc" id="6269811">close</span><span class="op" id="6269816">(</span><span class="op" id="6269817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269821">w</span><span class="op" id="6269822">.</span><span class="ident" id="6269823">conn</span>&nbsp;<span class="op" id="6269828">=</span>&nbsp;<span class="ident" id="6269830">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6269835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6269839">if</span>&nbsp;<span class="ident" id="6269842">w</span><span class="op" id="6269843">.</span><span class="ident" id="6269844">network</span>&nbsp;<span class="op" id="6269852">==</span>&nbsp;<span class="string" id="6269855">&#34;&#34;</span>&nbsp;<span class="op" id="6269858">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269862">w</span><span class="op" id="6269863">.</span><span class="ident" id="6269864">conn</span><span class="op" id="6269868">,</span>&nbsp;<span class="ident" id="6269870">err</span>&nbsp;<span class="op" id="6269874">=</span>&nbsp;<span class="ident" id="6269876">unixSyslog</span><span class="op" id="6269886">(</span><span class="op" id="6269887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6269891">if</span>&nbsp;<span class="ident" id="6269894">w</span><span class="op" id="6269895">.</span><span class="ident" id="6269896">hostname</span>&nbsp;<span class="op" id="6269905">==</span>&nbsp;<span class="string" id="6269908">&#34;&#34;</span>&nbsp;<span class="op" id="6269911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269916">w</span><span class="op" id="6269917">.</span><span class="ident" id="6269918">hostname</span>&nbsp;<span class="op" id="6269927">=</span>&nbsp;<span class="string" id="6269929">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6269943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6269946">}</span>&nbsp;<span class="keyword" id="6269948">else</span>&nbsp;<span class="op" id="6269953">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6269957">var</span>&nbsp;<span class="ident" id="6269961">c</span>&nbsp;<span class="ident" id="6269963">net</span><span class="op" id="6269966">.</span><span class="ident" id="6269967">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6269974">c</span><span class="op" id="6269975">,</span>&nbsp;<span class="ident" id="6269977">err</span>&nbsp;<span class="op" id="6269981">=</span>&nbsp;<span class="ident" id="6269983">net</span><span class="op" id="6269986">.</span><span class="ident" id="6269987">Dial</span><span class="op" id="6269991">(</span><span class="ident" id="6269992">w</span><span class="op" id="6269993">.</span><span class="ident" id="6269994">network</span><span class="op" id="6270001">,</span>&nbsp;<span class="ident" id="6270003">w</span><span class="op" id="6270004">.</span><span class="ident" id="6270005">raddr</span><span class="op" id="6270010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6270014">if</span>&nbsp;<span class="ident" id="6270017">err</span>&nbsp;<span class="op" id="6270021">==</span>&nbsp;<span class="ident" id="6270024">nil</span>&nbsp;<span class="op" id="6270028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6270033">w</span><span class="op" id="6270034">.</span><span class="ident" id="6270035">conn</span>&nbsp;<span class="op" id="6270040">=</span>&nbsp;<span class="op" id="6270042">&amp;</span><span class="ident" id="6270043">netConn</span><span class="op" id="6270050">{</span><span class="ident" id="6270051">conn</span><span class="op" id="6270055">:</span>&nbsp;<span class="ident" id="6270057">c</span><span class="op" id="6270058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6270063">if</span>&nbsp;<span class="ident" id="6270066">w</span><span class="op" id="6270067">.</span><span class="ident" id="6270068">hostname</span>&nbsp;<span class="op" id="6270077">==</span>&nbsp;<span class="string" id="6270080">&#34;&#34;</span>&nbsp;<span class="op" id="6270083">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6270089">w</span><span class="op" id="6270090">.</span><span class="ident" id="6270091">hostname</span>&nbsp;<span class="op" id="6270100">=</span>&nbsp;<span class="ident" id="6270102">c</span><span class="op" id="6270103">.</span><span class="ident" id="6270104">LocalAddr</span><span class="op" id="6270113">(</span><span class="op" id="6270114">)</span><span class="op" id="6270115">.</span><span class="ident" id="6270116">String</span><span class="op" id="6270122">(</span><span class="op" id="6270123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6270128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6270132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6270135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6270138">return</span><br>
<span class="lineno">175</span><span class="op" id="6270145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6270148">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6270199">func</span>&nbsp;<span class="op" id="6270204">(</span><span class="ident" id="6270205">w</span>&nbsp;<span class="op" id="6270207">*</span><span class="ident" id="6270208">Writer</span><span class="op" id="6270214">)</span>&nbsp;<span class="ident" id="6270216">Write</span><span class="op" id="6270221">(</span><span class="ident" id="6270222">b</span>&nbsp;<span class="op" id="6270224">[</span><span class="op" id="6270225">]</span><span class="builtintype" id="6270226">byte</span><span class="op" id="6270230">)</span>&nbsp;<span class="op" id="6270232">(</span><span class="builtintype" id="6270233">int</span><span class="op" id="6270236">,</span>&nbsp;<span class="builtintype" id="6270238">error</span><span class="op" id="6270243">)</span>&nbsp;<span class="op" id="6270245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6270248">return</span>&nbsp;<span class="ident" id="6270255">w</span><span class="op" id="6270256">.</span><span class="ident" id="6270257">writeAndRetry</span><span class="op" id="6270270">(</span><span class="ident" id="6270271">w</span><span class="op" id="6270272">.</span><span class="ident" id="6270273">priority</span><span class="op" id="6270281">,</span>&nbsp;<span class="builtintype" id="6270283">string</span><span class="op" id="6270289">(</span><span class="ident" id="6270290">b</span><span class="op" id="6270291">)</span><span class="op" id="6270292">)</span><br>
<span class="lineno">180</span><span class="op" id="6270294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6270297">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6270348">func</span>&nbsp;<span class="op" id="6270353">(</span><span class="ident" id="6270354">w</span>&nbsp;<span class="op" id="6270356">*</span><span class="ident" id="6270357">Writer</span><span class="op" id="6270363">)</span>&nbsp;<span class="ident" id="6270365">Close</span><span class="op" id="6270370">(</span><span class="op" id="6270371">)</span>&nbsp;<span class="builtintype" id="6270373">error</span>&nbsp;<span class="op" id="6270379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6270382">w</span><span class="op" id="6270383">.</span><span class="ident" id="6270384">mu</span><span class="op" id="6270386">.</span><span class="ident" id="6270387">Lock</span><span class="op" id="6270391">(</span><span class="op" id="6270392">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6270395">defer</span>&nbsp;<span class="ident" id="6270401">w</span><span class="op" id="6270402">.</span><span class="ident" id="6270403">mu</span><span class="op" id="6270405">.</span><span class="ident" id="6270406">Unlock</span><span class="op" id="6270412">(</span><span class="op" id="6270413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6270417">if</span>&nbsp;<span class="ident" id="6270420">w</span><span class="op" id="6270421">.</span><span class="ident" id="6270422">conn</span>&nbsp;<span class="op" id="6270427">!=</span>&nbsp;<span class="ident" id="6270430">nil</span>&nbsp;<span class="op" id="6270434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6270438">err</span>&nbsp;<span class="op" id="6270442">:=</span>&nbsp;<span class="ident" id="6270445">w</span><span class="op" id="6270446">.</span><span class="ident" id="6270447">conn</span><span class="op" id="6270451">.</span><span class="builtinfunc" id="6270452">close</span><span class="op" id="6270457">(</span><span class="op" id="6270458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6270462">w</span><span class="op" id="6270463">.</span><span class="ident" id="6270464">conn</span>&nbsp;<span class="op" id="6270469">=</span>&nbsp;<span class="ident" id="6270471">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6270477">return</span>&nbsp;<span class="ident" id="6270484">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6270489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6270492">return</span>&nbsp;<span class="ident" id="6270499">nil</span><br>
<span class="lineno"></span><span class="op" id="6270503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="6270506">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6270577">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6270595">func</span>&nbsp;<span class="op" id="6270600">(</span><span class="ident" id="6270601">w</span>&nbsp;<span class="op" id="6270603">*</span><span class="ident" id="6270604">Writer</span><span class="op" id="6270610">)</span>&nbsp;<span class="ident" id="6270612">Emerg</span><span class="op" id="6270617">(</span><span class="ident" id="6270618">m</span>&nbsp;<span class="builtintype" id="6270620">string</span><span class="op" id="6270626">)</span>&nbsp;<span class="op" id="6270628">(</span><span class="ident" id="6270629">err</span>&nbsp;<span class="builtintype" id="6270633">error</span><span class="op" id="6270638">)</span>&nbsp;<span class="op" id="6270640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6270643">_</span><span class="op" id="6270644">,</span>&nbsp;<span class="ident" id="6270646">err</span>&nbsp;<span class="op" id="6270650">=</span>&nbsp;<span class="ident" id="6270652">w</span><span class="op" id="6270653">.</span><span class="ident" id="6270654">writeAndRetry</span><span class="op" id="6270667">(</span><span class="ident" id="6270668">LOG_EMERG</span><span class="op" id="6270677">,</span>&nbsp;<span class="ident" id="6270679">m</span><span class="op" id="6270680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6270683">return</span>&nbsp;<span class="ident" id="6270690">err</span><br>
<span class="lineno">200</span><span class="op" id="6270694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6270697">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6270768">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6270786">func</span>&nbsp;<span class="op" id="6270791">(</span><span class="ident" id="6270792">w</span>&nbsp;<span class="op" id="6270794">*</span><span class="ident" id="6270795">Writer</span><span class="op" id="6270801">)</span>&nbsp;<span class="ident" id="6270803">Alert</span><span class="op" id="6270808">(</span><span class="ident" id="6270809">m</span>&nbsp;<span class="builtintype" id="6270811">string</span><span class="op" id="6270817">)</span>&nbsp;<span class="op" id="6270819">(</span><span class="ident" id="6270820">err</span>&nbsp;<span class="builtintype" id="6270824">error</span><span class="op" id="6270829">)</span>&nbsp;<span class="op" id="6270831">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6270834">_</span><span class="op" id="6270835">,</span>&nbsp;<span class="ident" id="6270837">err</span>&nbsp;<span class="op" id="6270841">=</span>&nbsp;<span class="ident" id="6270843">w</span><span class="op" id="6270844">.</span><span class="ident" id="6270845">writeAndRetry</span><span class="op" id="6270858">(</span><span class="ident" id="6270859">LOG_ALERT</span><span class="op" id="6270868">,</span>&nbsp;<span class="ident" id="6270870">m</span><span class="op" id="6270871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6270874">return</span>&nbsp;<span class="ident" id="6270881">err</span><br>
<span class="lineno"></span><span class="op" id="6270885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6270888">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="6270957">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6270975">func</span>&nbsp;<span class="op" id="6270980">(</span><span class="ident" id="6270981">w</span>&nbsp;<span class="op" id="6270983">*</span><span class="ident" id="6270984">Writer</span><span class="op" id="6270990">)</span>&nbsp;<span class="ident" id="6270992">Crit</span><span class="op" id="6270996">(</span><span class="ident" id="6270997">m</span>&nbsp;<span class="builtintype" id="6270999">string</span><span class="op" id="6271005">)</span>&nbsp;<span class="op" id="6271007">(</span><span class="ident" id="6271008">err</span>&nbsp;<span class="builtintype" id="6271012">error</span><span class="op" id="6271017">)</span>&nbsp;<span class="op" id="6271019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6271022">_</span><span class="op" id="6271023">,</span>&nbsp;<span class="ident" id="6271025">err</span>&nbsp;<span class="op" id="6271029">=</span>&nbsp;<span class="ident" id="6271031">w</span><span class="op" id="6271032">.</span><span class="ident" id="6271033">writeAndRetry</span><span class="op" id="6271046">(</span><span class="ident" id="6271047">LOG_CRIT</span><span class="op" id="6271055">,</span>&nbsp;<span class="ident" id="6271057">m</span><span class="op" id="6271058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6271061">return</span>&nbsp;<span class="ident" id="6271068">err</span><br>
<span class="lineno"></span><span class="op" id="6271072">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6271075">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6271142">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6271160">func</span>&nbsp;<span class="op" id="6271165">(</span><span class="ident" id="6271166">w</span>&nbsp;<span class="op" id="6271168">*</span><span class="ident" id="6271169">Writer</span><span class="op" id="6271175">)</span>&nbsp;<span class="ident" id="6271177">Err</span><span class="op" id="6271180">(</span><span class="ident" id="6271181">m</span>&nbsp;<span class="builtintype" id="6271183">string</span><span class="op" id="6271189">)</span>&nbsp;<span class="op" id="6271191">(</span><span class="ident" id="6271192">err</span>&nbsp;<span class="builtintype" id="6271196">error</span><span class="op" id="6271201">)</span>&nbsp;<span class="op" id="6271203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6271206">_</span><span class="op" id="6271207">,</span>&nbsp;<span class="ident" id="6271209">err</span>&nbsp;<span class="op" id="6271213">=</span>&nbsp;<span class="ident" id="6271215">w</span><span class="op" id="6271216">.</span><span class="ident" id="6271217">writeAndRetry</span><span class="op" id="6271230">(</span><span class="ident" id="6271231">LOG_ERR</span><span class="op" id="6271238">,</span>&nbsp;<span class="ident" id="6271240">m</span><span class="op" id="6271241">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6271244">return</span>&nbsp;<span class="ident" id="6271251">err</span><br>
<span class="lineno"></span><span class="op" id="6271255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6271258">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6271324">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="6271351">func</span>&nbsp;<span class="op" id="6271356">(</span><span class="ident" id="6271357">w</span>&nbsp;<span class="op" id="6271359">*</span><span class="ident" id="6271360">Writer</span><span class="op" id="6271366">)</span>&nbsp;<span class="ident" id="6271368">Warning</span><span class="op" id="6271375">(</span><span class="ident" id="6271376">m</span>&nbsp;<span class="builtintype" id="6271378">string</span><span class="op" id="6271384">)</span>&nbsp;<span class="op" id="6271386">(</span><span class="ident" id="6271387">err</span>&nbsp;<span class="builtintype" id="6271391">error</span><span class="op" id="6271396">)</span>&nbsp;<span class="op" id="6271398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6271401">_</span><span class="op" id="6271402">,</span>&nbsp;<span class="ident" id="6271404">err</span>&nbsp;<span class="op" id="6271408">=</span>&nbsp;<span class="ident" id="6271410">w</span><span class="op" id="6271411">.</span><span class="ident" id="6271412">writeAndRetry</span><span class="op" id="6271425">(</span><span class="ident" id="6271426">LOG_WARNING</span><span class="op" id="6271437">,</span>&nbsp;<span class="ident" id="6271439">m</span><span class="op" id="6271440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6271443">return</span>&nbsp;<span class="ident" id="6271450">err</span><br>
<span class="lineno"></span><span class="op" id="6271454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="6271457">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6271521">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6271548">func</span>&nbsp;<span class="op" id="6271553">(</span><span class="ident" id="6271554">w</span>&nbsp;<span class="op" id="6271556">*</span><span class="ident" id="6271557">Writer</span><span class="op" id="6271563">)</span>&nbsp;<span class="ident" id="6271565">Notice</span><span class="op" id="6271571">(</span><span class="ident" id="6271572">m</span>&nbsp;<span class="builtintype" id="6271574">string</span><span class="op" id="6271580">)</span>&nbsp;<span class="op" id="6271582">(</span><span class="ident" id="6271583">err</span>&nbsp;<span class="builtintype" id="6271587">error</span><span class="op" id="6271592">)</span>&nbsp;<span class="op" id="6271594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6271597">_</span><span class="op" id="6271598">,</span>&nbsp;<span class="ident" id="6271600">err</span>&nbsp;<span class="op" id="6271604">=</span>&nbsp;<span class="ident" id="6271606">w</span><span class="op" id="6271607">.</span><span class="ident" id="6271608">writeAndRetry</span><span class="op" id="6271621">(</span><span class="ident" id="6271622">LOG_NOTICE</span><span class="op" id="6271632">,</span>&nbsp;<span class="ident" id="6271634">m</span><span class="op" id="6271635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6271638">return</span>&nbsp;<span class="ident" id="6271645">err</span><br>
<span class="lineno">235</span><span class="op" id="6271649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6271652">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6271721">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6271739">func</span>&nbsp;<span class="op" id="6271744">(</span><span class="ident" id="6271745">w</span>&nbsp;<span class="op" id="6271747">*</span><span class="ident" id="6271748">Writer</span><span class="op" id="6271754">)</span>&nbsp;<span class="ident" id="6271756">Info</span><span class="op" id="6271760">(</span><span class="ident" id="6271761">m</span>&nbsp;<span class="builtintype" id="6271763">string</span><span class="op" id="6271769">)</span>&nbsp;<span class="op" id="6271771">(</span><span class="ident" id="6271772">err</span>&nbsp;<span class="builtintype" id="6271776">error</span><span class="op" id="6271781">)</span>&nbsp;<span class="op" id="6271783">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6271786">_</span><span class="op" id="6271787">,</span>&nbsp;<span class="ident" id="6271789">err</span>&nbsp;<span class="op" id="6271793">=</span>&nbsp;<span class="ident" id="6271795">w</span><span class="op" id="6271796">.</span><span class="ident" id="6271797">writeAndRetry</span><span class="op" id="6271810">(</span><span class="ident" id="6271811">LOG_INFO</span><span class="op" id="6271819">,</span>&nbsp;<span class="ident" id="6271821">m</span><span class="op" id="6271822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6271825">return</span>&nbsp;<span class="ident" id="6271832">err</span><br>
<span class="lineno"></span><span class="op" id="6271836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6271839">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="6271910">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6271928">func</span>&nbsp;<span class="op" id="6271933">(</span><span class="ident" id="6271934">w</span>&nbsp;<span class="op" id="6271936">*</span><span class="ident" id="6271937">Writer</span><span class="op" id="6271943">)</span>&nbsp;<span class="ident" id="6271945">Debug</span><span class="op" id="6271950">(</span><span class="ident" id="6271951">m</span>&nbsp;<span class="builtintype" id="6271953">string</span><span class="op" id="6271959">)</span>&nbsp;<span class="op" id="6271961">(</span><span class="ident" id="6271962">err</span>&nbsp;<span class="builtintype" id="6271966">error</span><span class="op" id="6271971">)</span>&nbsp;<span class="op" id="6271973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6271976">_</span><span class="op" id="6271977">,</span>&nbsp;<span class="ident" id="6271979">err</span>&nbsp;<span class="op" id="6271983">=</span>&nbsp;<span class="ident" id="6271985">w</span><span class="op" id="6271986">.</span><span class="ident" id="6271987">writeAndRetry</span><span class="op" id="6272000">(</span><span class="ident" id="6272001">LOG_DEBUG</span><span class="op" id="6272010">,</span>&nbsp;<span class="ident" id="6272012">m</span><span class="op" id="6272013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272016">return</span>&nbsp;<span class="ident" id="6272023">err</span><br>
<span class="lineno"></span><span class="op" id="6272027">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6272030">func</span>&nbsp;<span class="op" id="6272035">(</span><span class="ident" id="6272036">w</span>&nbsp;<span class="op" id="6272038">*</span><span class="ident" id="6272039">Writer</span><span class="op" id="6272045">)</span>&nbsp;<span class="ident" id="6272047">writeAndRetry</span><span class="op" id="6272060">(</span><span class="ident" id="6272061">p</span>&nbsp;<span class="ident" id="6272063">Priority</span><span class="op" id="6272071">,</span>&nbsp;<span class="ident" id="6272073">s</span>&nbsp;<span class="builtintype" id="6272075">string</span><span class="op" id="6272081">)</span>&nbsp;<span class="op" id="6272083">(</span><span class="builtintype" id="6272084">int</span><span class="op" id="6272087">,</span>&nbsp;<span class="builtintype" id="6272089">error</span><span class="op" id="6272094">)</span>&nbsp;<span class="op" id="6272096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6272099">pr</span>&nbsp;<span class="op" id="6272102">:=</span>&nbsp;<span class="op" id="6272105">(</span><span class="ident" id="6272106">w</span><span class="op" id="6272107">.</span><span class="ident" id="6272108">priority</span>&nbsp;<span class="op" id="6272117">&amp;</span>&nbsp;<span class="ident" id="6272119">facilityMask</span><span class="op" id="6272131">)</span>&nbsp;<span class="op" id="6272133">|</span>&nbsp;<span class="op" id="6272135">(</span><span class="ident" id="6272136">p</span>&nbsp;<span class="op" id="6272138">&amp;</span>&nbsp;<span class="ident" id="6272140">severityMask</span><span class="op" id="6272152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6272156">w</span><span class="op" id="6272157">.</span><span class="ident" id="6272158">mu</span><span class="op" id="6272160">.</span><span class="ident" id="6272161">Lock</span><span class="op" id="6272165">(</span><span class="op" id="6272166">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272169">defer</span>&nbsp;<span class="ident" id="6272175">w</span><span class="op" id="6272176">.</span><span class="ident" id="6272177">mu</span><span class="op" id="6272179">.</span><span class="ident" id="6272180">Unlock</span><span class="op" id="6272186">(</span><span class="op" id="6272187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272191">if</span>&nbsp;<span class="ident" id="6272194">w</span><span class="op" id="6272195">.</span><span class="ident" id="6272196">conn</span>&nbsp;<span class="op" id="6272201">!=</span>&nbsp;<span class="ident" id="6272204">nil</span>&nbsp;<span class="op" id="6272208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272212">if</span>&nbsp;<span class="ident" id="6272215">n</span><span class="op" id="6272216">,</span>&nbsp;<span class="ident" id="6272218">err</span>&nbsp;<span class="op" id="6272222">:=</span>&nbsp;<span class="ident" id="6272225">w</span><span class="op" id="6272226">.</span><span class="ident" id="6272227">write</span><span class="op" id="6272232">(</span><span class="ident" id="6272233">pr</span><span class="op" id="6272235">,</span>&nbsp;<span class="ident" id="6272237">s</span><span class="op" id="6272238">)</span><span class="op" id="6272239">;</span>&nbsp;<span class="ident" id="6272241">err</span>&nbsp;<span class="op" id="6272245">==</span>&nbsp;<span class="ident" id="6272248">nil</span>&nbsp;<span class="op" id="6272252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272257">return</span>&nbsp;<span class="ident" id="6272264">n</span><span class="op" id="6272265">,</span>&nbsp;<span class="ident" id="6272267">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6272273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6272276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272279">if</span>&nbsp;<span class="ident" id="6272282">err</span>&nbsp;<span class="op" id="6272286">:=</span>&nbsp;<span class="ident" id="6272289">w</span><span class="op" id="6272290">.</span><span class="ident" id="6272291">connect</span><span class="op" id="6272298">(</span><span class="op" id="6272299">)</span><span class="op" id="6272300">;</span>&nbsp;<span class="ident" id="6272302">err</span>&nbsp;<span class="op" id="6272306">!=</span>&nbsp;<span class="ident" id="6272309">nil</span>&nbsp;<span class="op" id="6272313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272317">return</span>&nbsp;<span class="num" id="6272324">0</span><span class="op" id="6272325">,</span>&nbsp;<span class="ident" id="6272327">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6272332">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272335">return</span>&nbsp;<span class="ident" id="6272342">w</span><span class="op" id="6272343">.</span><span class="ident" id="6272344">write</span><span class="op" id="6272349">(</span><span class="ident" id="6272350">pr</span><span class="op" id="6272352">,</span>&nbsp;<span class="ident" id="6272354">s</span><span class="op" id="6272355">)</span><br>
<span class="lineno"></span><span class="op" id="6272357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6272360">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6272421">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="6272484">func</span>&nbsp;<span class="op" id="6272489">(</span><span class="ident" id="6272490">w</span>&nbsp;<span class="op" id="6272492">*</span><span class="ident" id="6272493">Writer</span><span class="op" id="6272499">)</span>&nbsp;<span class="ident" id="6272501">write</span><span class="op" id="6272506">(</span><span class="ident" id="6272507">p</span>&nbsp;<span class="ident" id="6272509">Priority</span><span class="op" id="6272517">,</span>&nbsp;<span class="ident" id="6272519">msg</span>&nbsp;<span class="builtintype" id="6272523">string</span><span class="op" id="6272529">)</span>&nbsp;<span class="op" id="6272531">(</span><span class="builtintype" id="6272532">int</span><span class="op" id="6272535">,</span>&nbsp;<span class="builtintype" id="6272537">error</span><span class="op" id="6272542">)</span>&nbsp;<span class="op" id="6272544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272547">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6272574">nl</span>&nbsp;<span class="op" id="6272577">:=</span>&nbsp;<span class="string" id="6272580">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272584">if</span>&nbsp;<span class="op" id="6272587">!</span><span class="ident" id="6272588">strings</span><span class="op" id="6272595">.</span><span class="ident" id="6272596">HasSuffix</span><span class="op" id="6272605">(</span><span class="ident" id="6272606">msg</span><span class="op" id="6272609">,</span>&nbsp;<span class="string" id="6272611">&#34;\n&#34;</span><span class="op" id="6272615">)</span>&nbsp;<span class="op" id="6272617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6272621">nl</span>&nbsp;<span class="op" id="6272624">=</span>&nbsp;<span class="string" id="6272626">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6272632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6272636">err</span>&nbsp;<span class="op" id="6272640">:=</span>&nbsp;<span class="ident" id="6272643">w</span><span class="op" id="6272644">.</span><span class="ident" id="6272645">conn</span><span class="op" id="6272649">.</span><span class="ident" id="6272650">writeString</span><span class="op" id="6272661">(</span><span class="ident" id="6272662">p</span><span class="op" id="6272663">,</span>&nbsp;<span class="ident" id="6272665">w</span><span class="op" id="6272666">.</span><span class="ident" id="6272667">hostname</span><span class="op" id="6272675">,</span>&nbsp;<span class="ident" id="6272677">w</span><span class="op" id="6272678">.</span><span class="ident" id="6272679">tag</span><span class="op" id="6272682">,</span>&nbsp;<span class="ident" id="6272684">msg</span><span class="op" id="6272687">,</span>&nbsp;<span class="ident" id="6272689">nl</span><span class="op" id="6272691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272694">if</span>&nbsp;<span class="ident" id="6272697">err</span>&nbsp;<span class="op" id="6272701">!=</span>&nbsp;<span class="ident" id="6272704">nil</span>&nbsp;<span class="op" id="6272708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272712">return</span>&nbsp;<span class="num" id="6272719">0</span><span class="op" id="6272720">,</span>&nbsp;<span class="ident" id="6272722">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6272727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272730">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272790">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272850">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272868">return</span>&nbsp;<span class="builtinfunc" id="6272875">len</span><span class="op" id="6272878">(</span><span class="ident" id="6272879">msg</span><span class="op" id="6272882">)</span><span class="op" id="6272883">,</span>&nbsp;<span class="ident" id="6272885">nil</span><br>
<span class="lineno">285</span><span class="op" id="6272889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6272892">func</span>&nbsp;<span class="op" id="6272897">(</span><span class="ident" id="6272898">n</span>&nbsp;<span class="op" id="6272900">*</span><span class="ident" id="6272901">netConn</span><span class="op" id="6272908">)</span>&nbsp;<span class="ident" id="6272910">writeString</span><span class="op" id="6272921">(</span><span class="ident" id="6272922">p</span>&nbsp;<span class="ident" id="6272924">Priority</span><span class="op" id="6272932">,</span>&nbsp;<span class="ident" id="6272934">hostname</span><span class="op" id="6272942">,</span>&nbsp;<span class="ident" id="6272944">tag</span><span class="op" id="6272947">,</span>&nbsp;<span class="ident" id="6272949">msg</span><span class="op" id="6272952">,</span>&nbsp;<span class="ident" id="6272954">nl</span>&nbsp;<span class="builtintype" id="6272957">string</span><span class="op" id="6272963">)</span>&nbsp;<span class="builtintype" id="6272965">error</span>&nbsp;<span class="op" id="6272971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6272974">if</span>&nbsp;<span class="ident" id="6272977">n</span><span class="op" id="6272978">.</span><span class="ident" id="6272979">local</span>&nbsp;<span class="op" id="6272985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272989">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6273047">//&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6273095">//&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273145">timestamp</span>&nbsp;<span class="op" id="6273155">:=</span>&nbsp;<span class="ident" id="6273158">time</span><span class="op" id="6273162">.</span><span class="ident" id="6273163">Now</span><span class="op" id="6273166">(</span><span class="op" id="6273167">)</span><span class="op" id="6273168">.</span><span class="ident" id="6273169">Format</span><span class="op" id="6273175">(</span><span class="ident" id="6273176">time</span><span class="op" id="6273180">.</span><span class="ident" id="6273181">Stamp</span><span class="op" id="6273186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273190">_</span><span class="op" id="6273191">,</span>&nbsp;<span class="ident" id="6273193">err</span>&nbsp;<span class="op" id="6273197">:=</span>&nbsp;<span class="ident" id="6273200">fmt</span><span class="op" id="6273203">.</span><span class="ident" id="6273204">Fprintf</span><span class="op" id="6273211">(</span><span class="ident" id="6273212">n</span><span class="op" id="6273213">.</span><span class="ident" id="6273214">conn</span><span class="op" id="6273218">,</span>&nbsp;<span class="string" id="6273220">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6273241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273246">p</span><span class="op" id="6273247">,</span>&nbsp;<span class="ident" id="6273249">timestamp</span><span class="op" id="6273258">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273263">tag</span><span class="op" id="6273266">,</span>&nbsp;<span class="ident" id="6273268">os</span><span class="op" id="6273270">.</span><span class="ident" id="6273271">Getpid</span><span class="op" id="6273277">(</span><span class="op" id="6273278">)</span><span class="op" id="6273279">,</span>&nbsp;<span class="ident" id="6273281">msg</span><span class="op" id="6273284">,</span>&nbsp;<span class="ident" id="6273286">nl</span><span class="op" id="6273288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6273292">return</span>&nbsp;<span class="ident" id="6273299">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6273304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273307">timestamp</span>&nbsp;<span class="op" id="6273317">:=</span>&nbsp;<span class="ident" id="6273320">time</span><span class="op" id="6273324">.</span><span class="ident" id="6273325">Now</span><span class="op" id="6273328">(</span><span class="op" id="6273329">)</span><span class="op" id="6273330">.</span><span class="ident" id="6273331">Format</span><span class="op" id="6273337">(</span><span class="ident" id="6273338">time</span><span class="op" id="6273342">.</span><span class="ident" id="6273343">RFC3339</span><span class="op" id="6273350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273353">_</span><span class="op" id="6273354">,</span>&nbsp;<span class="ident" id="6273356">err</span>&nbsp;<span class="op" id="6273360">:=</span>&nbsp;<span class="ident" id="6273363">fmt</span><span class="op" id="6273366">.</span><span class="ident" id="6273367">Fprintf</span><span class="op" id="6273374">(</span><span class="ident" id="6273375">n</span><span class="op" id="6273376">.</span><span class="ident" id="6273377">conn</span><span class="op" id="6273381">,</span>&nbsp;<span class="string" id="6273383">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6273407">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273411">p</span><span class="op" id="6273412">,</span>&nbsp;<span class="ident" id="6273414">timestamp</span><span class="op" id="6273423">,</span>&nbsp;<span class="ident" id="6273425">hostname</span><span class="op" id="6273433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273437">tag</span><span class="op" id="6273440">,</span>&nbsp;<span class="ident" id="6273442">os</span><span class="op" id="6273444">.</span><span class="ident" id="6273445">Getpid</span><span class="op" id="6273451">(</span><span class="op" id="6273452">)</span><span class="op" id="6273453">,</span>&nbsp;<span class="ident" id="6273455">msg</span><span class="op" id="6273458">,</span>&nbsp;<span class="ident" id="6273460">nl</span><span class="op" id="6273462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6273465">return</span>&nbsp;<span class="ident" id="6273472">err</span><br>
<span class="lineno"></span><span class="op" id="6273476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6273479">func</span>&nbsp;<span class="op" id="6273484">(</span><span class="ident" id="6273485">n</span>&nbsp;<span class="op" id="6273487">*</span><span class="ident" id="6273488">netConn</span><span class="op" id="6273495">)</span>&nbsp;<span class="builtinfunc" id="6273497">close</span><span class="op" id="6273502">(</span><span class="op" id="6273503">)</span>&nbsp;<span class="builtintype" id="6273505">error</span>&nbsp;<span class="op" id="6273511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6273514">return</span>&nbsp;<span class="ident" id="6273521">n</span><span class="op" id="6273522">.</span><span class="ident" id="6273523">conn</span><span class="op" id="6273527">.</span><span class="ident" id="6273528">Close</span><span class="op" id="6273533">(</span><span class="op" id="6273534">)</span><br>
<span class="lineno"></span><span class="op" id="6273536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6273539">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="6273600">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="6273667">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="6273731">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="6273746">func</span>&nbsp;<span class="ident" id="6273751">NewLogger</span><span class="op" id="6273760">(</span><span class="ident" id="6273761">p</span>&nbsp;<span class="ident" id="6273763">Priority</span><span class="op" id="6273771">,</span>&nbsp;<span class="ident" id="6273773">logFlag</span>&nbsp;<span class="builtintype" id="6273781">int</span><span class="op" id="6273784">)</span>&nbsp;<span class="op" id="6273786">(</span><span class="op" id="6273787">*</span><span class="ident" id="6273788">log</span><span class="op" id="6273791">.</span><span class="ident" id="6273792">Logger</span><span class="op" id="6273798">,</span>&nbsp;<span class="builtintype" id="6273800">error</span><span class="op" id="6273805">)</span>&nbsp;<span class="op" id="6273807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273810">s</span><span class="op" id="6273811">,</span>&nbsp;<span class="ident" id="6273813">err</span>&nbsp;<span class="op" id="6273817">:=</span>&nbsp;<span class="ident" id="6273820">New</span><span class="op" id="6273823">(</span><span class="ident" id="6273824">p</span><span class="op" id="6273825">,</span>&nbsp;<span class="string" id="6273827">&#34;&#34;</span><span class="op" id="6273829">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6273832">if</span>&nbsp;<span class="ident" id="6273835">err</span>&nbsp;<span class="op" id="6273839">!=</span>&nbsp;<span class="ident" id="6273842">nil</span>&nbsp;<span class="op" id="6273846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6273850">return</span>&nbsp;<span class="ident" id="6273857">nil</span><span class="op" id="6273860">,</span>&nbsp;<span class="ident" id="6273862">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6273867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6273870">return</span>&nbsp;<span class="ident" id="6273877">log</span><span class="op" id="6273880">.</span><span class="ident" id="6273881">New</span><span class="op" id="6273884">(</span><span class="ident" id="6273885">s</span><span class="op" id="6273886">,</span>&nbsp;<span class="string" id="6273888">&#34;&#34;</span><span class="op" id="6273890">,</span>&nbsp;<span class="ident" id="6273892">logFlag</span><span class="op" id="6273899">)</span><span class="op" id="6273900">,</span>&nbsp;<span class="ident" id="6273902">nil</span><br>
<span class="lineno"></span><span class="op" id="6273906">}</span>
</div>
</body>
</html>
