<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html" class="current">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1659840">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1659895">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1659949">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1660000">package</span>&nbsp;<span class="ident" id="1660008">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1660017">import</span>&nbsp;<span class="op" id="1660024">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1660027">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1660036">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1660039">type</span>&nbsp;<span class="ident" id="1660044">sliceStruct</span>&nbsp;<span class="keyword" id="1660056">struct</span>&nbsp;<span class="op" id="1660063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1660066">array</span>&nbsp;<span class="ident" id="1660072">unsafe</span><span class="op" id="1660078">.</span><span class="ident" id="1660079">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1660088">len</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1660094">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1660099">cap</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1660105">int</span><br>
<span class="lineno">15</span><span class="op" id="1660109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1660112">//&nbsp;TODO:&nbsp;take&nbsp;uintptrs&nbsp;instead&nbsp;of&nbsp;int64s?</span><br>
<span class="lineno"></span><span class="keyword" id="1660154">func</span>&nbsp;<span class="ident" id="1660159">makeslice</span><span class="op" id="1660168">(</span><span class="ident" id="1660169">t</span>&nbsp;<span class="op" id="1660171">*</span><span class="ident" id="1660172">slicetype</span><span class="op" id="1660181">,</span>&nbsp;<span class="ident" id="1660183">len64</span>&nbsp;<span class="ident" id="1660189">int64</span><span class="op" id="1660194">,</span>&nbsp;<span class="ident" id="1660196">cap64</span>&nbsp;<span class="ident" id="1660202">int64</span><span class="op" id="1660207">)</span>&nbsp;<span class="ident" id="1660209">sliceStruct</span>&nbsp;<span class="op" id="1660221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1660224">//&nbsp;NOTE:&nbsp;The&nbsp;len&nbsp;&gt;&nbsp;MaxMem/elemsize&nbsp;check&nbsp;here&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1660298">//&nbsp;but&nbsp;it&nbsp;produces&nbsp;a&nbsp;&#39;len&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error&nbsp;instead&nbsp;of&nbsp;a&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1660383">//&nbsp;when&nbsp;someone&nbsp;does&nbsp;make([]T,&nbsp;bignumber).&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;is&nbsp;true&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1660459">//&nbsp;but&nbsp;since&nbsp;the&nbsp;cap&nbsp;is&nbsp;only&nbsp;being&nbsp;supplied&nbsp;implicitly,&nbsp;saying&nbsp;len&nbsp;is&nbsp;clearer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1660539">//&nbsp;See&nbsp;issue&nbsp;4085.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1660559">len</span>&nbsp;<span class="op" id="1660563">:=</span>&nbsp;<span class="builtintype" id="1660566">int</span><span class="op" id="1660569">(</span><span class="ident" id="1660570">len64</span><span class="op" id="1660575">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1660578">if</span>&nbsp;<span class="ident" id="1660581">len64</span>&nbsp;<span class="op" id="1660587">&lt;</span>&nbsp;<span class="num" id="1660589">0</span>&nbsp;<span class="op" id="1660591">||</span>&nbsp;<span class="ident" id="1660594">int64</span><span class="op" id="1660599">(</span><span class="builtinfunc" id="1660600">len</span><span class="op" id="1660603">)</span>&nbsp;<span class="op" id="1660605">!=</span>&nbsp;<span class="ident" id="1660608">len64</span>&nbsp;<span class="op" id="1660614">||</span>&nbsp;<span class="ident" id="1660617">t</span><span class="op" id="1660618">.</span><span class="ident" id="1660619">elem</span><span class="op" id="1660623">.</span><span class="ident" id="1660624">size</span>&nbsp;<span class="op" id="1660629">&gt;</span>&nbsp;<span class="num" id="1660631">0</span>&nbsp;<span class="op" id="1660633">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1660636">uintptr</span><span class="op" id="1660643">(</span><span class="builtinfunc" id="1660644">len</span><span class="op" id="1660647">)</span>&nbsp;<span class="op" id="1660649">&gt;</span>&nbsp;<span class="ident" id="1660651">maxmem</span><span class="op" id="1660657">/</span><span class="builtintype" id="1660658">uintptr</span><span class="op" id="1660665">(</span><span class="ident" id="1660666">t</span><span class="op" id="1660667">.</span><span class="ident" id="1660668">elem</span><span class="op" id="1660672">.</span><span class="ident" id="1660673">size</span><span class="op" id="1660677">)</span>&nbsp;<span class="op" id="1660679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1660683">panic</span><span class="op" id="1660688">(</span><span class="ident" id="1660689">errorString</span><span class="op" id="1660700">(</span><span class="string" id="1660701">&#34;makeslice:&nbsp;len&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1660730">)</span><span class="op" id="1660731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1660734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1660737">cap</span>&nbsp;<span class="op" id="1660741">:=</span>&nbsp;<span class="builtintype" id="1660744">int</span><span class="op" id="1660747">(</span><span class="ident" id="1660748">cap64</span><span class="op" id="1660753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1660756">if</span>&nbsp;<span class="builtinfunc" id="1660759">cap</span>&nbsp;<span class="op" id="1660763">&lt;</span>&nbsp;<span class="builtinfunc" id="1660765">len</span>&nbsp;<span class="op" id="1660769">||</span>&nbsp;<span class="ident" id="1660772">int64</span><span class="op" id="1660777">(</span><span class="builtinfunc" id="1660778">cap</span><span class="op" id="1660781">)</span>&nbsp;<span class="op" id="1660783">!=</span>&nbsp;<span class="ident" id="1660786">cap64</span>&nbsp;<span class="op" id="1660792">||</span>&nbsp;<span class="ident" id="1660795">t</span><span class="op" id="1660796">.</span><span class="ident" id="1660797">elem</span><span class="op" id="1660801">.</span><span class="ident" id="1660802">size</span>&nbsp;<span class="op" id="1660807">&gt;</span>&nbsp;<span class="num" id="1660809">0</span>&nbsp;<span class="op" id="1660811">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1660814">uintptr</span><span class="op" id="1660821">(</span><span class="builtinfunc" id="1660822">cap</span><span class="op" id="1660825">)</span>&nbsp;<span class="op" id="1660827">&gt;</span>&nbsp;<span class="ident" id="1660829">maxmem</span><span class="op" id="1660835">/</span><span class="builtintype" id="1660836">uintptr</span><span class="op" id="1660843">(</span><span class="ident" id="1660844">t</span><span class="op" id="1660845">.</span><span class="ident" id="1660846">elem</span><span class="op" id="1660850">.</span><span class="ident" id="1660851">size</span><span class="op" id="1660855">)</span>&nbsp;<span class="op" id="1660857">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1660861">panic</span><span class="op" id="1660866">(</span><span class="ident" id="1660867">errorString</span><span class="op" id="1660878">(</span><span class="string" id="1660879">&#34;makeslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1660908">)</span><span class="op" id="1660909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1660912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1660915">p</span>&nbsp;<span class="op" id="1660917">:=</span>&nbsp;<span class="ident" id="1660920">newarray</span><span class="op" id="1660928">(</span><span class="ident" id="1660929">t</span><span class="op" id="1660930">.</span><span class="ident" id="1660931">elem</span><span class="op" id="1660935">,</span>&nbsp;<span class="builtintype" id="1660937">uintptr</span><span class="op" id="1660944">(</span><span class="builtinfunc" id="1660945">cap</span><span class="op" id="1660948">)</span><span class="op" id="1660949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1660952">return</span>&nbsp;<span class="ident" id="1660959">sliceStruct</span><span class="op" id="1660970">{</span><span class="ident" id="1660971">p</span><span class="op" id="1660972">,</span>&nbsp;<span class="builtinfunc" id="1660974">len</span><span class="op" id="1660977">,</span>&nbsp;<span class="builtinfunc" id="1660979">cap</span><span class="op" id="1660982">}</span><br>
<span class="lineno"></span><span class="op" id="1660984">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1660987">//&nbsp;TODO:&nbsp;take&nbsp;uintptr&nbsp;instead&nbsp;of&nbsp;int64?</span><br>
<span class="lineno"></span><span class="keyword" id="1661027">func</span>&nbsp;<span class="ident" id="1661032">growslice</span><span class="op" id="1661041">(</span><span class="ident" id="1661042">t</span>&nbsp;<span class="op" id="1661044">*</span><span class="ident" id="1661045">slicetype</span><span class="op" id="1661054">,</span>&nbsp;<span class="ident" id="1661056">old</span>&nbsp;<span class="ident" id="1661060">sliceStruct</span><span class="op" id="1661071">,</span>&nbsp;<span class="ident" id="1661073">n</span>&nbsp;<span class="ident" id="1661075">int64</span><span class="op" id="1661080">)</span>&nbsp;<span class="ident" id="1661082">sliceStruct</span>&nbsp;<span class="op" id="1661094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1661097">if</span>&nbsp;<span class="ident" id="1661100">n</span>&nbsp;<span class="op" id="1661102">&lt;</span>&nbsp;<span class="num" id="1661104">1</span>&nbsp;<span class="op" id="1661106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1661110">panic</span><span class="op" id="1661115">(</span><span class="ident" id="1661116">errorString</span><span class="op" id="1661127">(</span><span class="string" id="1661128">&#34;growslice:&nbsp;invalid&nbsp;n&#34;</span><span class="op" id="1661150">)</span><span class="op" id="1661151">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1661154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1661158">cap64</span>&nbsp;<span class="op" id="1661164">:=</span>&nbsp;<span class="ident" id="1661167">int64</span><span class="op" id="1661172">(</span><span class="ident" id="1661173">old</span><span class="op" id="1661176">.</span><span class="builtinfunc" id="1661177">cap</span><span class="op" id="1661180">)</span>&nbsp;<span class="op" id="1661182">+</span>&nbsp;<span class="ident" id="1661184">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1661187">cap</span>&nbsp;<span class="op" id="1661191">:=</span>&nbsp;<span class="builtintype" id="1661194">int</span><span class="op" id="1661197">(</span><span class="ident" id="1661198">cap64</span><span class="op" id="1661203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1661207">if</span>&nbsp;<span class="ident" id="1661210">int64</span><span class="op" id="1661215">(</span><span class="builtinfunc" id="1661216">cap</span><span class="op" id="1661219">)</span>&nbsp;<span class="op" id="1661221">!=</span>&nbsp;<span class="ident" id="1661224">cap64</span>&nbsp;<span class="op" id="1661230">||</span>&nbsp;<span class="builtinfunc" id="1661233">cap</span>&nbsp;<span class="op" id="1661237">&lt;</span>&nbsp;<span class="ident" id="1661239">old</span><span class="op" id="1661242">.</span><span class="builtinfunc" id="1661243">cap</span>&nbsp;<span class="op" id="1661247">||</span>&nbsp;<span class="ident" id="1661250">t</span><span class="op" id="1661251">.</span><span class="ident" id="1661252">elem</span><span class="op" id="1661256">.</span><span class="ident" id="1661257">size</span>&nbsp;<span class="op" id="1661262">&gt;</span>&nbsp;<span class="num" id="1661264">0</span>&nbsp;<span class="op" id="1661266">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1661269">uintptr</span><span class="op" id="1661276">(</span><span class="builtinfunc" id="1661277">cap</span><span class="op" id="1661280">)</span>&nbsp;<span class="op" id="1661282">&gt;</span>&nbsp;<span class="ident" id="1661284">maxmem</span><span class="op" id="1661290">/</span><span class="builtintype" id="1661291">uintptr</span><span class="op" id="1661298">(</span><span class="ident" id="1661299">t</span><span class="op" id="1661300">.</span><span class="ident" id="1661301">elem</span><span class="op" id="1661305">.</span><span class="ident" id="1661306">size</span><span class="op" id="1661310">)</span>&nbsp;<span class="op" id="1661312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1661316">panic</span><span class="op" id="1661321">(</span><span class="ident" id="1661322">errorString</span><span class="op" id="1661333">(</span><span class="string" id="1661334">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1661363">)</span><span class="op" id="1661364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1661367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1661371">if</span>&nbsp;<span class="ident" id="1661374">raceenabled</span>&nbsp;<span class="op" id="1661386">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1661390">callerpc</span>&nbsp;<span class="op" id="1661399">:=</span>&nbsp;<span class="ident" id="1661402">getcallerpc</span><span class="op" id="1661413">(</span><span class="ident" id="1661414">unsafe</span><span class="op" id="1661420">.</span><span class="ident" id="1661421">Pointer</span><span class="op" id="1661428">(</span><span class="op" id="1661429">&amp;</span><span class="ident" id="1661430">t</span><span class="op" id="1661431">)</span><span class="op" id="1661432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1661436">racereadrangepc</span><span class="op" id="1661451">(</span><span class="ident" id="1661452">old</span><span class="op" id="1661455">.</span><span class="ident" id="1661456">array</span><span class="op" id="1661461">,</span>&nbsp;<span class="builtintype" id="1661463">uintptr</span><span class="op" id="1661470">(</span><span class="ident" id="1661471">old</span><span class="op" id="1661474">.</span><span class="builtinfunc" id="1661475">len</span><span class="op" id="1661478">*</span><span class="builtintype" id="1661479">int</span><span class="op" id="1661482">(</span><span class="ident" id="1661483">t</span><span class="op" id="1661484">.</span><span class="ident" id="1661485">elem</span><span class="op" id="1661489">.</span><span class="ident" id="1661490">size</span><span class="op" id="1661494">)</span><span class="op" id="1661495">)</span><span class="op" id="1661496">,</span>&nbsp;<span class="ident" id="1661498">callerpc</span><span class="op" id="1661506">,</span>&nbsp;<span class="ident" id="1661508">funcPC</span><span class="op" id="1661514">(</span><span class="ident" id="1661515">growslice</span><span class="op" id="1661524">)</span><span class="op" id="1661525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1661528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1661532">et</span>&nbsp;<span class="op" id="1661535">:=</span>&nbsp;<span class="ident" id="1661538">t</span><span class="op" id="1661539">.</span><span class="ident" id="1661540">elem</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1661546">if</span>&nbsp;<span class="ident" id="1661549">et</span><span class="op" id="1661551">.</span><span class="ident" id="1661552">size</span>&nbsp;<span class="op" id="1661557">==</span>&nbsp;<span class="num" id="1661560">0</span>&nbsp;<span class="op" id="1661562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1661566">return</span>&nbsp;<span class="ident" id="1661573">sliceStruct</span><span class="op" id="1661584">{</span><span class="ident" id="1661585">old</span><span class="op" id="1661588">.</span><span class="ident" id="1661589">array</span><span class="op" id="1661594">,</span>&nbsp;<span class="ident" id="1661596">old</span><span class="op" id="1661599">.</span><span class="builtinfunc" id="1661600">len</span><span class="op" id="1661603">,</span>&nbsp;<span class="builtinfunc" id="1661605">cap</span><span class="op" id="1661608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1661611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1661615">newcap</span>&nbsp;<span class="op" id="1661622">:=</span>&nbsp;<span class="ident" id="1661625">old</span><span class="op" id="1661628">.</span><span class="builtinfunc" id="1661629">cap</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1661634">if</span>&nbsp;<span class="ident" id="1661637">newcap</span><span class="op" id="1661643">+</span><span class="ident" id="1661644">newcap</span>&nbsp;<span class="op" id="1661651">&lt;</span>&nbsp;<span class="builtinfunc" id="1661653">cap</span>&nbsp;<span class="op" id="1661657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1661661">newcap</span>&nbsp;<span class="op" id="1661668">=</span>&nbsp;<span class="builtinfunc" id="1661670">cap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1661675">}</span>&nbsp;<span class="keyword" id="1661677">else</span>&nbsp;<span class="op" id="1661682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1661686">for</span>&nbsp;<span class="op" id="1661690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1661695">if</span>&nbsp;<span class="ident" id="1661698">old</span><span class="op" id="1661701">.</span><span class="builtinfunc" id="1661702">len</span>&nbsp;<span class="op" id="1661706">&lt;</span>&nbsp;<span class="num" id="1661708">1024</span>&nbsp;<span class="op" id="1661713">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1661719">newcap</span>&nbsp;<span class="op" id="1661726">+=</span>&nbsp;<span class="ident" id="1661729">newcap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1661739">}</span>&nbsp;<span class="keyword" id="1661741">else</span>&nbsp;<span class="op" id="1661746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1661752">newcap</span>&nbsp;<span class="op" id="1661759">+=</span>&nbsp;<span class="ident" id="1661762">newcap</span>&nbsp;<span class="op" id="1661769">/</span>&nbsp;<span class="num" id="1661771">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1661776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1661781">if</span>&nbsp;<span class="ident" id="1661784">newcap</span>&nbsp;<span class="op" id="1661791">&gt;=</span>&nbsp;<span class="builtinfunc" id="1661794">cap</span>&nbsp;<span class="op" id="1661798">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1661804">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1661813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1661817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1661820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1661824">if</span>&nbsp;<span class="builtintype" id="1661827">uintptr</span><span class="op" id="1661834">(</span><span class="ident" id="1661835">newcap</span><span class="op" id="1661841">)</span>&nbsp;<span class="op" id="1661843">&gt;=</span>&nbsp;<span class="ident" id="1661846">maxmem</span><span class="op" id="1661852">/</span><span class="builtintype" id="1661853">uintptr</span><span class="op" id="1661860">(</span><span class="ident" id="1661861">et</span><span class="op" id="1661863">.</span><span class="ident" id="1661864">size</span><span class="op" id="1661868">)</span>&nbsp;<span class="op" id="1661870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1661874">panic</span><span class="op" id="1661879">(</span><span class="ident" id="1661880">errorString</span><span class="op" id="1661891">(</span><span class="string" id="1661892">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1661921">)</span><span class="op" id="1661922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1661925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1661928">lenmem</span>&nbsp;<span class="op" id="1661935">:=</span>&nbsp;<span class="builtintype" id="1661938">uintptr</span><span class="op" id="1661945">(</span><span class="ident" id="1661946">old</span><span class="op" id="1661949">.</span><span class="builtinfunc" id="1661950">len</span><span class="op" id="1661953">)</span>&nbsp;<span class="op" id="1661955">*</span>&nbsp;<span class="builtintype" id="1661957">uintptr</span><span class="op" id="1661964">(</span><span class="ident" id="1661965">et</span><span class="op" id="1661967">.</span><span class="ident" id="1661968">size</span><span class="op" id="1661972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1661975">capmem</span>&nbsp;<span class="op" id="1661982">:=</span>&nbsp;<span class="ident" id="1661985">goroundupsize</span><span class="op" id="1661998">(</span><span class="builtintype" id="1661999">uintptr</span><span class="op" id="1662006">(</span><span class="ident" id="1662007">newcap</span><span class="op" id="1662013">)</span>&nbsp;<span class="op" id="1662015">*</span>&nbsp;<span class="builtintype" id="1662017">uintptr</span><span class="op" id="1662024">(</span><span class="ident" id="1662025">et</span><span class="op" id="1662027">.</span><span class="ident" id="1662028">size</span><span class="op" id="1662032">)</span><span class="op" id="1662033">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1662036">newcap</span>&nbsp;<span class="op" id="1662043">=</span>&nbsp;<span class="builtintype" id="1662045">int</span><span class="op" id="1662048">(</span><span class="ident" id="1662049">capmem</span>&nbsp;<span class="op" id="1662056">/</span>&nbsp;<span class="builtintype" id="1662058">uintptr</span><span class="op" id="1662065">(</span><span class="ident" id="1662066">et</span><span class="op" id="1662068">.</span><span class="ident" id="1662069">size</span><span class="op" id="1662073">)</span><span class="op" id="1662074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1662077">var</span>&nbsp;<span class="ident" id="1662081">p</span>&nbsp;<span class="ident" id="1662083">unsafe</span><span class="op" id="1662089">.</span><span class="ident" id="1662090">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1662099">if</span>&nbsp;<span class="ident" id="1662102">et</span><span class="op" id="1662104">.</span><span class="ident" id="1662105">kind</span><span class="op" id="1662109">&amp;</span><span class="ident" id="1662110">kindNoPointers</span>&nbsp;<span class="op" id="1662125">!=</span>&nbsp;<span class="num" id="1662128">0</span>&nbsp;<span class="op" id="1662130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1662134">p</span>&nbsp;<span class="op" id="1662136">=</span>&nbsp;<span class="ident" id="1662138">rawmem</span><span class="op" id="1662144">(</span><span class="ident" id="1662145">capmem</span><span class="op" id="1662151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1662155">memclr</span><span class="op" id="1662161">(</span><span class="ident" id="1662162">add</span><span class="op" id="1662165">(</span><span class="ident" id="1662166">p</span><span class="op" id="1662167">,</span>&nbsp;<span class="ident" id="1662169">lenmem</span><span class="op" id="1662175">)</span><span class="op" id="1662176">,</span>&nbsp;<span class="ident" id="1662178">capmem</span><span class="op" id="1662184">-</span><span class="ident" id="1662185">lenmem</span><span class="op" id="1662191">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1662194">}</span>&nbsp;<span class="keyword" id="1662196">else</span>&nbsp;<span class="op" id="1662201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1662205">//&nbsp;Note:&nbsp;can&#39;t&nbsp;use&nbsp;rawmem&nbsp;(which&nbsp;avoids&nbsp;zeroing&nbsp;of&nbsp;memory),&nbsp;because&nbsp;then&nbsp;GC&nbsp;can&nbsp;scan&nbsp;unitialized&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1662311">p</span>&nbsp;<span class="op" id="1662313">=</span>&nbsp;<span class="ident" id="1662315">newarray</span><span class="op" id="1662323">(</span><span class="ident" id="1662324">et</span><span class="op" id="1662326">,</span>&nbsp;<span class="builtintype" id="1662328">uintptr</span><span class="op" id="1662335">(</span><span class="ident" id="1662336">newcap</span><span class="op" id="1662342">)</span><span class="op" id="1662343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1662346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1662349">memmove</span><span class="op" id="1662356">(</span><span class="ident" id="1662357">p</span><span class="op" id="1662358">,</span>&nbsp;<span class="ident" id="1662360">old</span><span class="op" id="1662363">.</span><span class="ident" id="1662364">array</span><span class="op" id="1662369">,</span>&nbsp;<span class="ident" id="1662371">lenmem</span><span class="op" id="1662377">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1662381">return</span>&nbsp;<span class="ident" id="1662388">sliceStruct</span><span class="op" id="1662399">{</span><span class="ident" id="1662400">p</span><span class="op" id="1662401">,</span>&nbsp;<span class="ident" id="1662403">old</span><span class="op" id="1662406">.</span><span class="builtinfunc" id="1662407">len</span><span class="op" id="1662410">,</span>&nbsp;<span class="ident" id="1662412">newcap</span><span class="op" id="1662418">}</span><br>
<span class="lineno"></span><span class="op" id="1662420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1662423">func</span>&nbsp;<span class="ident" id="1662428">slicecopy</span><span class="op" id="1662437">(</span><span class="ident" id="1662438">to</span>&nbsp;<span class="ident" id="1662441">sliceStruct</span><span class="op" id="1662452">,</span>&nbsp;<span class="ident" id="1662454">fm</span>&nbsp;<span class="ident" id="1662457">sliceStruct</span><span class="op" id="1662468">,</span>&nbsp;<span class="ident" id="1662470">width</span>&nbsp;<span class="builtintype" id="1662476">uintptr</span><span class="op" id="1662483">)</span>&nbsp;<span class="builtintype" id="1662485">int</span>&nbsp;<span class="op" id="1662489">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1662492">if</span>&nbsp;<span class="ident" id="1662495">fm</span><span class="op" id="1662497">.</span><span class="builtinfunc" id="1662498">len</span>&nbsp;<span class="op" id="1662502">==</span>&nbsp;<span class="num" id="1662505">0</span>&nbsp;<span class="op" id="1662507">||</span>&nbsp;<span class="ident" id="1662510">to</span><span class="op" id="1662512">.</span><span class="builtinfunc" id="1662513">len</span>&nbsp;<span class="op" id="1662517">==</span>&nbsp;<span class="num" id="1662520">0</span>&nbsp;<span class="op" id="1662522">||</span>&nbsp;<span class="ident" id="1662525">width</span>&nbsp;<span class="op" id="1662531">==</span>&nbsp;<span class="num" id="1662534">0</span>&nbsp;<span class="op" id="1662536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1662540">return</span>&nbsp;<span class="num" id="1662547">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1662550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1662554">n</span>&nbsp;<span class="op" id="1662556">:=</span>&nbsp;<span class="ident" id="1662559">fm</span><span class="op" id="1662561">.</span><span class="builtinfunc" id="1662562">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1662567">if</span>&nbsp;<span class="ident" id="1662570">to</span><span class="op" id="1662572">.</span><span class="builtinfunc" id="1662573">len</span>&nbsp;<span class="op" id="1662577">&lt;</span>&nbsp;<span class="ident" id="1662579">n</span>&nbsp;<span class="op" id="1662581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1662585">n</span>&nbsp;<span class="op" id="1662587">=</span>&nbsp;<span class="ident" id="1662589">to</span><span class="op" id="1662591">.</span><span class="builtinfunc" id="1662592">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1662597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1662601">if</span>&nbsp;<span class="ident" id="1662604">raceenabled</span>&nbsp;<span class="op" id="1662616">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1662620">callerpc</span>&nbsp;<span class="op" id="1662629">:=</span>&nbsp;<span class="ident" id="1662632">getcallerpc</span><span class="op" id="1662643">(</span><span class="ident" id="1662644">unsafe</span><span class="op" id="1662650">.</span><span class="ident" id="1662651">Pointer</span><span class="op" id="1662658">(</span><span class="op" id="1662659">&amp;</span><span class="ident" id="1662660">to</span><span class="op" id="1662662">)</span><span class="op" id="1662663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1662667">pc</span>&nbsp;<span class="op" id="1662670">:=</span>&nbsp;<span class="ident" id="1662673">funcPC</span><span class="op" id="1662679">(</span><span class="ident" id="1662680">slicecopy</span><span class="op" id="1662689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1662693">racewriterangepc</span><span class="op" id="1662709">(</span><span class="ident" id="1662710">to</span><span class="op" id="1662712">.</span><span class="ident" id="1662713">array</span><span class="op" id="1662718">,</span>&nbsp;<span class="builtintype" id="1662720">uintptr</span><span class="op" id="1662727">(</span><span class="ident" id="1662728">n</span><span class="op" id="1662729">*</span><span class="builtintype" id="1662730">int</span><span class="op" id="1662733">(</span><span class="ident" id="1662734">width</span><span class="op" id="1662739">)</span><span class="op" id="1662740">)</span><span class="op" id="1662741">,</span>&nbsp;<span class="ident" id="1662743">callerpc</span><span class="op" id="1662751">,</span>&nbsp;<span class="ident" id="1662753">pc</span><span class="op" id="1662755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1662759">racereadrangepc</span><span class="op" id="1662774">(</span><span class="ident" id="1662775">fm</span><span class="op" id="1662777">.</span><span class="ident" id="1662778">array</span><span class="op" id="1662783">,</span>&nbsp;<span class="builtintype" id="1662785">uintptr</span><span class="op" id="1662792">(</span><span class="ident" id="1662793">n</span><span class="op" id="1662794">*</span><span class="builtintype" id="1662795">int</span><span class="op" id="1662798">(</span><span class="ident" id="1662799">width</span><span class="op" id="1662804">)</span><span class="op" id="1662805">)</span><span class="op" id="1662806">,</span>&nbsp;<span class="ident" id="1662808">callerpc</span><span class="op" id="1662816">,</span>&nbsp;<span class="ident" id="1662818">pc</span><span class="op" id="1662820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1662823">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1662827">size</span>&nbsp;<span class="op" id="1662832">:=</span>&nbsp;<span class="builtintype" id="1662835">uintptr</span><span class="op" id="1662842">(</span><span class="ident" id="1662843">n</span><span class="op" id="1662844">)</span>&nbsp;<span class="op" id="1662846">*</span>&nbsp;<span class="ident" id="1662848">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1662855">if</span>&nbsp;<span class="ident" id="1662858">size</span>&nbsp;<span class="op" id="1662863">==</span>&nbsp;<span class="num" id="1662866">1</span>&nbsp;<span class="op" id="1662868">{</span>&nbsp;<span class="comment" id="1662870">//&nbsp;common&nbsp;case&nbsp;worth&nbsp;about&nbsp;2x&nbsp;to&nbsp;do&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1662913">//&nbsp;TODO:&nbsp;is&nbsp;this&nbsp;still&nbsp;worth&nbsp;it&nbsp;with&nbsp;new&nbsp;memmove&nbsp;impl?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1662970">*</span><span class="op" id="1662971">(</span><span class="op" id="1662972">*</span><span class="builtintype" id="1662973">byte</span><span class="op" id="1662977">)</span><span class="op" id="1662978">(</span><span class="ident" id="1662979">to</span><span class="op" id="1662981">.</span><span class="ident" id="1662982">array</span><span class="op" id="1662987">)</span>&nbsp;<span class="op" id="1662989">=</span>&nbsp;<span class="op" id="1662991">*</span><span class="op" id="1662992">(</span><span class="op" id="1662993">*</span><span class="builtintype" id="1662994">byte</span><span class="op" id="1662998">)</span><span class="op" id="1662999">(</span><span class="ident" id="1663000">fm</span><span class="op" id="1663002">.</span><span class="ident" id="1663003">array</span><span class="op" id="1663008">)</span>&nbsp;<span class="comment" id="1663010">//&nbsp;known&nbsp;to&nbsp;be&nbsp;a&nbsp;byte&nbsp;pointer</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1663041">}</span>&nbsp;<span class="keyword" id="1663043">else</span>&nbsp;<span class="op" id="1663048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1663052">memmove</span><span class="op" id="1663059">(</span><span class="ident" id="1663060">to</span><span class="op" id="1663062">.</span><span class="ident" id="1663063">array</span><span class="op" id="1663068">,</span>&nbsp;<span class="ident" id="1663070">fm</span><span class="op" id="1663072">.</span><span class="ident" id="1663073">array</span><span class="op" id="1663078">,</span>&nbsp;<span class="ident" id="1663080">size</span><span class="op" id="1663084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1663087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1663090">return</span>&nbsp;<span class="builtintype" id="1663097">int</span><span class="op" id="1663100">(</span><span class="ident" id="1663101">n</span><span class="op" id="1663102">)</span><br>
<span class="lineno"></span><span class="op" id="1663104">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="1663107">func</span>&nbsp;<span class="ident" id="1663112">slicestringcopy</span><span class="op" id="1663127">(</span><span class="ident" id="1663128">to</span>&nbsp;<span class="op" id="1663131">[</span><span class="op" id="1663132">]</span><span class="builtintype" id="1663133">byte</span><span class="op" id="1663137">,</span>&nbsp;<span class="ident" id="1663139">fm</span>&nbsp;<span class="builtintype" id="1663142">string</span><span class="op" id="1663148">)</span>&nbsp;<span class="builtintype" id="1663150">int</span>&nbsp;<span class="op" id="1663154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1663157">if</span>&nbsp;<span class="builtinfunc" id="1663160">len</span><span class="op" id="1663163">(</span><span class="ident" id="1663164">fm</span><span class="op" id="1663166">)</span>&nbsp;<span class="op" id="1663168">==</span>&nbsp;<span class="num" id="1663171">0</span>&nbsp;<span class="op" id="1663173">||</span>&nbsp;<span class="builtinfunc" id="1663176">len</span><span class="op" id="1663179">(</span><span class="ident" id="1663180">to</span><span class="op" id="1663182">)</span>&nbsp;<span class="op" id="1663184">==</span>&nbsp;<span class="num" id="1663187">0</span>&nbsp;<span class="op" id="1663189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1663193">return</span>&nbsp;<span class="num" id="1663200">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1663203">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1663207">n</span>&nbsp;<span class="op" id="1663209">:=</span>&nbsp;<span class="builtinfunc" id="1663212">len</span><span class="op" id="1663215">(</span><span class="ident" id="1663216">fm</span><span class="op" id="1663218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1663221">if</span>&nbsp;<span class="builtinfunc" id="1663224">len</span><span class="op" id="1663227">(</span><span class="ident" id="1663228">to</span><span class="op" id="1663230">)</span>&nbsp;<span class="op" id="1663232">&lt;</span>&nbsp;<span class="ident" id="1663234">n</span>&nbsp;<span class="op" id="1663236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1663240">n</span>&nbsp;<span class="op" id="1663242">=</span>&nbsp;<span class="builtinfunc" id="1663244">len</span><span class="op" id="1663247">(</span><span class="ident" id="1663248">to</span><span class="op" id="1663250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1663253">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1663257">if</span>&nbsp;<span class="ident" id="1663260">raceenabled</span>&nbsp;<span class="op" id="1663272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1663276">callerpc</span>&nbsp;<span class="op" id="1663285">:=</span>&nbsp;<span class="ident" id="1663288">getcallerpc</span><span class="op" id="1663299">(</span><span class="ident" id="1663300">unsafe</span><span class="op" id="1663306">.</span><span class="ident" id="1663307">Pointer</span><span class="op" id="1663314">(</span><span class="op" id="1663315">&amp;</span><span class="ident" id="1663316">to</span><span class="op" id="1663318">)</span><span class="op" id="1663319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1663323">pc</span>&nbsp;<span class="op" id="1663326">:=</span>&nbsp;<span class="ident" id="1663329">funcPC</span><span class="op" id="1663335">(</span><span class="ident" id="1663336">slicestringcopy</span><span class="op" id="1663351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1663355">racewriterangepc</span><span class="op" id="1663371">(</span><span class="ident" id="1663372">unsafe</span><span class="op" id="1663378">.</span><span class="ident" id="1663379">Pointer</span><span class="op" id="1663386">(</span><span class="op" id="1663387">&amp;</span><span class="ident" id="1663388">to</span><span class="op" id="1663390">[</span><span class="num" id="1663391">0</span><span class="op" id="1663392">]</span><span class="op" id="1663393">)</span><span class="op" id="1663394">,</span>&nbsp;<span class="builtintype" id="1663396">uintptr</span><span class="op" id="1663403">(</span><span class="ident" id="1663404">n</span><span class="op" id="1663405">)</span><span class="op" id="1663406">,</span>&nbsp;<span class="ident" id="1663408">callerpc</span><span class="op" id="1663416">,</span>&nbsp;<span class="ident" id="1663418">pc</span><span class="op" id="1663420">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1663423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1663427">memmove</span><span class="op" id="1663434">(</span><span class="ident" id="1663435">unsafe</span><span class="op" id="1663441">.</span><span class="ident" id="1663442">Pointer</span><span class="op" id="1663449">(</span><span class="op" id="1663450">&amp;</span><span class="ident" id="1663451">to</span><span class="op" id="1663453">[</span><span class="num" id="1663454">0</span><span class="op" id="1663455">]</span><span class="op" id="1663456">)</span><span class="op" id="1663457">,</span>&nbsp;<span class="ident" id="1663459">unsafe</span><span class="op" id="1663465">.</span><span class="ident" id="1663466">Pointer</span><span class="op" id="1663473">(</span><span class="op" id="1663474">(</span><span class="op" id="1663475">*</span><span class="ident" id="1663476">stringStruct</span><span class="op" id="1663488">)</span><span class="op" id="1663489">(</span><span class="ident" id="1663490">unsafe</span><span class="op" id="1663496">.</span><span class="ident" id="1663497">Pointer</span><span class="op" id="1663504">(</span><span class="op" id="1663505">&amp;</span><span class="ident" id="1663506">fm</span><span class="op" id="1663508">)</span><span class="op" id="1663509">)</span><span class="op" id="1663510">.</span><span class="ident" id="1663511">str</span><span class="op" id="1663514">)</span><span class="op" id="1663515">,</span>&nbsp;<span class="builtintype" id="1663517">uintptr</span><span class="op" id="1663524">(</span><span class="ident" id="1663525">n</span><span class="op" id="1663526">)</span><span class="op" id="1663527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1663530">return</span>&nbsp;<span class="ident" id="1663537">n</span><br>
<span class="lineno"></span><span class="op" id="1663539">}</span>
</div>
</body>
</html>
