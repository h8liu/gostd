<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3115790">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3115846">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3115900">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3115951">package</span>&nbsp;<span class="ident" id="3115959">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3115964">import</span>&nbsp;<span class="op" id="3115971">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3115974">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3115984">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3115991">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3115994">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3116053">//</span><br>
<span class="lineno"></span><span class="comment" id="3116056">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="3116114">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="3116176">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3116238">type</span>&nbsp;<span class="ident" id="3116243">Dialer</span>&nbsp;<span class="keyword" id="3116250">struct</span>&nbsp;<span class="op" id="3116257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116260">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116323">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116387">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116400">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116404">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116435">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116439">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116502">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116562">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116590">Timeout</span>&nbsp;<span class="ident" id="3116598">time</span><span class="op" id="3116602">.</span><span class="ident" id="3116603">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116614">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116675">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116730">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116795">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116827">Deadline</span>&nbsp;<span class="ident" id="3116836">time</span><span class="op" id="3116840">.</span><span class="ident" id="3116841">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116848">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116906">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116968">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116994">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117047">LocalAddr</span>&nbsp;<span class="ident" id="3117057">Addr</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3117064">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3117123">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3117186">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3117247">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3117311">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117328">DualStack</span>&nbsp;<span class="builtintype" id="3117338">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3117345">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3117405">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3117429">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3117489">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117544">KeepAlive</span>&nbsp;<span class="ident" id="3117554">time</span><span class="op" id="3117558">.</span><span class="ident" id="3117559">Duration</span><br>
<span class="lineno"></span><span class="op" id="3117568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3117571">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3117636">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3117667">func</span>&nbsp;<span class="op" id="3117672">(</span><span class="ident" id="3117673">d</span>&nbsp;<span class="op" id="3117675">*</span><span class="ident" id="3117676">Dialer</span><span class="op" id="3117682">)</span>&nbsp;<span class="ident" id="3117684">deadline</span><span class="op" id="3117692">(</span><span class="op" id="3117693">)</span>&nbsp;<span class="ident" id="3117695">time</span><span class="op" id="3117699">.</span><span class="ident" id="3117700">Time</span>&nbsp;<span class="op" id="3117705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117708">if</span>&nbsp;<span class="ident" id="3117711">d</span><span class="op" id="3117712">.</span><span class="ident" id="3117713">Timeout</span>&nbsp;<span class="op" id="3117721">==</span>&nbsp;<span class="num" id="3117724">0</span>&nbsp;<span class="op" id="3117726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117730">return</span>&nbsp;<span class="ident" id="3117737">d</span><span class="op" id="3117738">.</span><span class="ident" id="3117739">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117752">timeoutDeadline</span>&nbsp;<span class="op" id="3117768">:=</span>&nbsp;<span class="ident" id="3117771">time</span><span class="op" id="3117775">.</span><span class="ident" id="3117776">Now</span><span class="op" id="3117779">(</span><span class="op" id="3117780">)</span><span class="op" id="3117781">.</span><span class="ident" id="3117782">Add</span><span class="op" id="3117785">(</span><span class="ident" id="3117786">d</span><span class="op" id="3117787">.</span><span class="ident" id="3117788">Timeout</span><span class="op" id="3117795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117798">if</span>&nbsp;<span class="ident" id="3117801">d</span><span class="op" id="3117802">.</span><span class="ident" id="3117803">Deadline</span><span class="op" id="3117811">.</span><span class="ident" id="3117812">IsZero</span><span class="op" id="3117818">(</span><span class="op" id="3117819">)</span>&nbsp;<span class="op" id="3117821">||</span>&nbsp;<span class="ident" id="3117824">timeoutDeadline</span><span class="op" id="3117839">.</span><span class="ident" id="3117840">Before</span><span class="op" id="3117846">(</span><span class="ident" id="3117847">d</span><span class="op" id="3117848">.</span><span class="ident" id="3117849">Deadline</span><span class="op" id="3117857">)</span>&nbsp;<span class="op" id="3117859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117863">return</span>&nbsp;<span class="ident" id="3117870">timeoutDeadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117887">}</span>&nbsp;<span class="keyword" id="3117889">else</span>&nbsp;<span class="op" id="3117894">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117898">return</span>&nbsp;<span class="ident" id="3117905">d</span><span class="op" id="3117906">.</span><span class="ident" id="3117907">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117917">}</span><br>
<span class="lineno"></span><span class="op" id="3117919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3117922">func</span>&nbsp;<span class="ident" id="3117927">parseNetwork</span><span class="op" id="3117939">(</span><span class="ident" id="3117940">net</span>&nbsp;<span class="builtintype" id="3117944">string</span><span class="op" id="3117950">)</span>&nbsp;<span class="op" id="3117952">(</span><span class="ident" id="3117953">afnet</span>&nbsp;<span class="builtintype" id="3117959">string</span><span class="op" id="3117965">,</span>&nbsp;<span class="ident" id="3117967">proto</span>&nbsp;<span class="builtintype" id="3117973">int</span><span class="op" id="3117976">,</span>&nbsp;<span class="ident" id="3117978">err</span>&nbsp;<span class="builtintype" id="3117982">error</span><span class="op" id="3117987">)</span>&nbsp;<span class="op" id="3117989">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117992">i</span>&nbsp;<span class="op" id="3117994">:=</span>&nbsp;<span class="ident" id="3117997">last</span><span class="op" id="3118001">(</span><span class="ident" id="3118002">net</span><span class="op" id="3118005">,</span>&nbsp;<span class="string" id="3118007">&#39;:&#39;</span><span class="op" id="3118010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118013">if</span>&nbsp;<span class="ident" id="3118016">i</span>&nbsp;<span class="op" id="3118018">&lt;</span>&nbsp;<span class="num" id="3118020">0</span>&nbsp;<span class="op" id="3118022">{</span>&nbsp;<span class="comment" id="3118024">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118038">switch</span>&nbsp;<span class="ident" id="3118045">net</span>&nbsp;<span class="op" id="3118049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118053">case</span>&nbsp;<span class="string" id="3118058">&#34;tcp&#34;</span><span class="op" id="3118063">,</span>&nbsp;<span class="string" id="3118065">&#34;tcp4&#34;</span><span class="op" id="3118071">,</span>&nbsp;<span class="string" id="3118073">&#34;tcp6&#34;</span><span class="op" id="3118079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118083">case</span>&nbsp;<span class="string" id="3118088">&#34;udp&#34;</span><span class="op" id="3118093">,</span>&nbsp;<span class="string" id="3118095">&#34;udp4&#34;</span><span class="op" id="3118101">,</span>&nbsp;<span class="string" id="3118103">&#34;udp6&#34;</span><span class="op" id="3118109">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118113">case</span>&nbsp;<span class="string" id="3118118">&#34;ip&#34;</span><span class="op" id="3118122">,</span>&nbsp;<span class="string" id="3118124">&#34;ip4&#34;</span><span class="op" id="3118129">,</span>&nbsp;<span class="string" id="3118131">&#34;ip6&#34;</span><span class="op" id="3118136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118140">case</span>&nbsp;<span class="string" id="3118145">&#34;unix&#34;</span><span class="op" id="3118151">,</span>&nbsp;<span class="string" id="3118153">&#34;unixgram&#34;</span><span class="op" id="3118163">,</span>&nbsp;<span class="string" id="3118165">&#34;unixpacket&#34;</span><span class="op" id="3118177">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118181">default</span><span class="op" id="3118188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118193">return</span>&nbsp;<span class="string" id="3118200">&#34;&#34;</span><span class="op" id="3118202">,</span>&nbsp;<span class="num" id="3118204">0</span><span class="op" id="3118205">,</span>&nbsp;<span class="ident" id="3118207">UnknownNetworkError</span><span class="op" id="3118226">(</span><span class="ident" id="3118227">net</span><span class="op" id="3118230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118234">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118238">return</span>&nbsp;<span class="ident" id="3118245">net</span><span class="op" id="3118248">,</span>&nbsp;<span class="num" id="3118250">0</span><span class="op" id="3118251">,</span>&nbsp;<span class="ident" id="3118253">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118261">afnet</span>&nbsp;<span class="op" id="3118267">=</span>&nbsp;<span class="ident" id="3118269">net</span><span class="op" id="3118272">[</span><span class="op" id="3118273">:</span><span class="ident" id="3118274">i</span><span class="op" id="3118275">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118278">switch</span>&nbsp;<span class="ident" id="3118285">afnet</span>&nbsp;<span class="op" id="3118291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118294">case</span>&nbsp;<span class="string" id="3118299">&#34;ip&#34;</span><span class="op" id="3118303">,</span>&nbsp;<span class="string" id="3118305">&#34;ip4&#34;</span><span class="op" id="3118310">,</span>&nbsp;<span class="string" id="3118312">&#34;ip6&#34;</span><span class="op" id="3118317">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118321">protostr</span>&nbsp;<span class="op" id="3118330">:=</span>&nbsp;<span class="ident" id="3118333">net</span><span class="op" id="3118336">[</span><span class="ident" id="3118337">i</span><span class="op" id="3118338">+</span><span class="num" id="3118339">1</span><span class="op" id="3118340">:</span><span class="op" id="3118341">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118345">proto</span><span class="op" id="3118350">,</span>&nbsp;<span class="ident" id="3118352">i</span><span class="op" id="3118353">,</span>&nbsp;<span class="ident" id="3118355">ok</span>&nbsp;<span class="op" id="3118358">:=</span>&nbsp;<span class="ident" id="3118361">dtoi</span><span class="op" id="3118365">(</span><span class="ident" id="3118366">protostr</span><span class="op" id="3118374">,</span>&nbsp;<span class="num" id="3118376">0</span><span class="op" id="3118377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118381">if</span>&nbsp;<span class="op" id="3118384">!</span><span class="ident" id="3118385">ok</span>&nbsp;<span class="op" id="3118388">||</span>&nbsp;<span class="ident" id="3118391">i</span>&nbsp;<span class="op" id="3118393">!=</span>&nbsp;<span class="builtinfunc" id="3118396">len</span><span class="op" id="3118399">(</span><span class="ident" id="3118400">protostr</span><span class="op" id="3118408">)</span>&nbsp;<span class="op" id="3118410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118415">proto</span><span class="op" id="3118420">,</span>&nbsp;<span class="ident" id="3118422">err</span>&nbsp;<span class="op" id="3118426">=</span>&nbsp;<span class="ident" id="3118428">lookupProtocol</span><span class="op" id="3118442">(</span><span class="ident" id="3118443">protostr</span><span class="op" id="3118451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118456">if</span>&nbsp;<span class="ident" id="3118459">err</span>&nbsp;<span class="op" id="3118463">!=</span>&nbsp;<span class="ident" id="3118466">nil</span>&nbsp;<span class="op" id="3118470">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118476">return</span>&nbsp;<span class="string" id="3118483">&#34;&#34;</span><span class="op" id="3118485">,</span>&nbsp;<span class="num" id="3118487">0</span><span class="op" id="3118488">,</span>&nbsp;<span class="ident" id="3118490">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118505">return</span>&nbsp;<span class="ident" id="3118512">afnet</span><span class="op" id="3118517">,</span>&nbsp;<span class="ident" id="3118519">proto</span><span class="op" id="3118524">,</span>&nbsp;<span class="ident" id="3118526">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118531">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118534">return</span>&nbsp;<span class="string" id="3118541">&#34;&#34;</span><span class="op" id="3118543">,</span>&nbsp;<span class="num" id="3118545">0</span><span class="op" id="3118546">,</span>&nbsp;<span class="ident" id="3118548">UnknownNetworkError</span><span class="op" id="3118567">(</span><span class="ident" id="3118568">net</span><span class="op" id="3118571">)</span><br>
<span class="lineno"></span><span class="op" id="3118573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3118576">func</span>&nbsp;<span class="ident" id="3118581">resolveAddr</span><span class="op" id="3118592">(</span><span class="ident" id="3118593">op</span><span class="op" id="3118595">,</span>&nbsp;<span class="ident" id="3118597">net</span><span class="op" id="3118600">,</span>&nbsp;<span class="ident" id="3118602">addr</span>&nbsp;<span class="builtintype" id="3118607">string</span><span class="op" id="3118613">,</span>&nbsp;<span class="ident" id="3118615">deadline</span>&nbsp;<span class="ident" id="3118624">time</span><span class="op" id="3118628">.</span><span class="ident" id="3118629">Time</span><span class="op" id="3118633">)</span>&nbsp;<span class="op" id="3118635">(</span><span class="ident" id="3118636">netaddr</span><span class="op" id="3118643">,</span>&nbsp;<span class="builtintype" id="3118645">error</span><span class="op" id="3118650">)</span>&nbsp;<span class="op" id="3118652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118655">afnet</span><span class="op" id="3118660">,</span>&nbsp;<span class="ident" id="3118662">_</span><span class="op" id="3118663">,</span>&nbsp;<span class="ident" id="3118665">err</span>&nbsp;<span class="op" id="3118669">:=</span>&nbsp;<span class="ident" id="3118672">parseNetwork</span><span class="op" id="3118684">(</span><span class="ident" id="3118685">net</span><span class="op" id="3118688">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118691">if</span>&nbsp;<span class="ident" id="3118694">err</span>&nbsp;<span class="op" id="3118698">!=</span>&nbsp;<span class="ident" id="3118701">nil</span>&nbsp;<span class="op" id="3118705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118709">return</span>&nbsp;<span class="ident" id="3118716">nil</span><span class="op" id="3118719">,</span>&nbsp;<span class="ident" id="3118721">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118729">if</span>&nbsp;<span class="ident" id="3118732">op</span>&nbsp;<span class="op" id="3118735">==</span>&nbsp;<span class="string" id="3118738">&#34;dial&#34;</span>&nbsp;<span class="op" id="3118745">&amp;&amp;</span>&nbsp;<span class="ident" id="3118748">addr</span>&nbsp;<span class="op" id="3118753">==</span>&nbsp;<span class="string" id="3118756">&#34;&#34;</span>&nbsp;<span class="op" id="3118759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118763">return</span>&nbsp;<span class="ident" id="3118770">nil</span><span class="op" id="3118773">,</span>&nbsp;<span class="ident" id="3118775">errMissingAddress</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118797">switch</span>&nbsp;<span class="ident" id="3118804">afnet</span>&nbsp;<span class="op" id="3118810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118813">case</span>&nbsp;<span class="string" id="3118818">&#34;unix&#34;</span><span class="op" id="3118824">,</span>&nbsp;<span class="string" id="3118826">&#34;unixgram&#34;</span><span class="op" id="3118836">,</span>&nbsp;<span class="string" id="3118838">&#34;unixpacket&#34;</span><span class="op" id="3118850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118854">return</span>&nbsp;<span class="ident" id="3118861">ResolveUnixAddr</span><span class="op" id="3118876">(</span><span class="ident" id="3118877">afnet</span><span class="op" id="3118882">,</span>&nbsp;<span class="ident" id="3118884">addr</span><span class="op" id="3118888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118891">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118894">return</span>&nbsp;<span class="ident" id="3118901">resolveInternetAddr</span><span class="op" id="3118920">(</span><span class="ident" id="3118921">afnet</span><span class="op" id="3118926">,</span>&nbsp;<span class="ident" id="3118928">addr</span><span class="op" id="3118932">,</span>&nbsp;<span class="ident" id="3118934">deadline</span><span class="op" id="3118942">)</span><br>
<span class="lineno"></span><span class="op" id="3118944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3118947">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3119001">//</span><br>
<span class="lineno">115</span><span class="comment" id="3119004">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="3119073">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3119135">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3119193">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3119210">//</span><br>
<span class="lineno">120</span><span class="comment" id="3119213">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="3119277">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="3119334">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3119399">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="3119468">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="3119485">//</span><br>
<span class="lineno"></span><span class="comment" id="3119488">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3119501">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3119534">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3119568">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="3119605">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3119640">//</span><br>
<span class="lineno"></span><span class="comment" id="3119643">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="3119713">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3119780">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="3119803">//</span><br>
<span class="lineno"></span><span class="comment" id="3119806">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3119819">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3119849">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3119876">//</span><br>
<span class="lineno">140</span><span class="comment" id="3119879">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="3119941">func</span>&nbsp;<span class="ident" id="3119946">Dial</span><span class="op" id="3119950">(</span><span class="ident" id="3119951">network</span><span class="op" id="3119958">,</span>&nbsp;<span class="ident" id="3119960">address</span>&nbsp;<span class="builtintype" id="3119968">string</span><span class="op" id="3119974">)</span>&nbsp;<span class="op" id="3119976">(</span><span class="ident" id="3119977">Conn</span><span class="op" id="3119981">,</span>&nbsp;<span class="builtintype" id="3119983">error</span><span class="op" id="3119988">)</span>&nbsp;<span class="op" id="3119990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119993">var</span>&nbsp;<span class="ident" id="3119997">d</span>&nbsp;<span class="ident" id="3119999">Dialer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120007">return</span>&nbsp;<span class="ident" id="3120014">d</span><span class="op" id="3120015">.</span><span class="ident" id="3120016">Dial</span><span class="op" id="3120020">(</span><span class="ident" id="3120021">network</span><span class="op" id="3120028">,</span>&nbsp;<span class="ident" id="3120030">address</span><span class="op" id="3120037">)</span><br>
<span class="lineno"></span><span class="op" id="3120039">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="3120042">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="3120093">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="3120147">func</span>&nbsp;<span class="ident" id="3120152">DialTimeout</span><span class="op" id="3120163">(</span><span class="ident" id="3120164">network</span><span class="op" id="3120171">,</span>&nbsp;<span class="ident" id="3120173">address</span>&nbsp;<span class="builtintype" id="3120181">string</span><span class="op" id="3120187">,</span>&nbsp;<span class="ident" id="3120189">timeout</span>&nbsp;<span class="ident" id="3120197">time</span><span class="op" id="3120201">.</span><span class="ident" id="3120202">Duration</span><span class="op" id="3120210">)</span>&nbsp;<span class="op" id="3120212">(</span><span class="ident" id="3120213">Conn</span><span class="op" id="3120217">,</span>&nbsp;<span class="builtintype" id="3120219">error</span><span class="op" id="3120224">)</span>&nbsp;<span class="op" id="3120226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120229">d</span>&nbsp;<span class="op" id="3120231">:=</span>&nbsp;<span class="ident" id="3120234">Dialer</span><span class="op" id="3120240">{</span><span class="ident" id="3120241">Timeout</span><span class="op" id="3120248">:</span>&nbsp;<span class="ident" id="3120250">timeout</span><span class="op" id="3120257">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120260">return</span>&nbsp;<span class="ident" id="3120267">d</span><span class="op" id="3120268">.</span><span class="ident" id="3120269">Dial</span><span class="op" id="3120273">(</span><span class="ident" id="3120274">network</span><span class="op" id="3120281">,</span>&nbsp;<span class="ident" id="3120283">address</span><span class="op" id="3120290">)</span><br>
<span class="lineno"></span><span class="op" id="3120292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3120295">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3120349">//</span><br>
<span class="lineno">155</span><span class="comment" id="3120352">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3120414">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="3120429">func</span>&nbsp;<span class="op" id="3120434">(</span><span class="ident" id="3120435">d</span>&nbsp;<span class="op" id="3120437">*</span><span class="ident" id="3120438">Dialer</span><span class="op" id="3120444">)</span>&nbsp;<span class="ident" id="3120446">Dial</span><span class="op" id="3120450">(</span><span class="ident" id="3120451">network</span><span class="op" id="3120458">,</span>&nbsp;<span class="ident" id="3120460">address</span>&nbsp;<span class="builtintype" id="3120468">string</span><span class="op" id="3120474">)</span>&nbsp;<span class="op" id="3120476">(</span><span class="ident" id="3120477">Conn</span><span class="op" id="3120481">,</span>&nbsp;<span class="builtintype" id="3120483">error</span><span class="op" id="3120488">)</span>&nbsp;<span class="op" id="3120490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120493">ra</span><span class="op" id="3120495">,</span>&nbsp;<span class="ident" id="3120497">err</span>&nbsp;<span class="op" id="3120501">:=</span>&nbsp;<span class="ident" id="3120504">resolveAddr</span><span class="op" id="3120515">(</span><span class="string" id="3120516">&#34;dial&#34;</span><span class="op" id="3120522">,</span>&nbsp;<span class="ident" id="3120524">network</span><span class="op" id="3120531">,</span>&nbsp;<span class="ident" id="3120533">address</span><span class="op" id="3120540">,</span>&nbsp;<span class="ident" id="3120542">d</span><span class="op" id="3120543">.</span><span class="ident" id="3120544">deadline</span><span class="op" id="3120552">(</span><span class="op" id="3120553">)</span><span class="op" id="3120554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120557">if</span>&nbsp;<span class="ident" id="3120560">err</span>&nbsp;<span class="op" id="3120564">!=</span>&nbsp;<span class="ident" id="3120567">nil</span>&nbsp;<span class="op" id="3120571">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120575">return</span>&nbsp;<span class="ident" id="3120582">nil</span><span class="op" id="3120585">,</span>&nbsp;<span class="op" id="3120587">&amp;</span><span class="ident" id="3120588">OpError</span><span class="op" id="3120595">{</span><span class="ident" id="3120596">Op</span><span class="op" id="3120598">:</span>&nbsp;<span class="string" id="3120600">&#34;dial&#34;</span><span class="op" id="3120606">,</span>&nbsp;<span class="ident" id="3120608">Net</span><span class="op" id="3120611">:</span>&nbsp;<span class="ident" id="3120613">network</span><span class="op" id="3120620">,</span>&nbsp;<span class="ident" id="3120622">Addr</span><span class="op" id="3120626">:</span>&nbsp;<span class="ident" id="3120628">nil</span><span class="op" id="3120631">,</span>&nbsp;<span class="ident" id="3120633">Err</span><span class="op" id="3120636">:</span>&nbsp;<span class="ident" id="3120638">err</span><span class="op" id="3120641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120647">dialer</span>&nbsp;<span class="op" id="3120654">:=</span>&nbsp;<span class="keyword" id="3120657">func</span><span class="op" id="3120661">(</span><span class="ident" id="3120662">deadline</span>&nbsp;<span class="ident" id="3120671">time</span><span class="op" id="3120675">.</span><span class="ident" id="3120676">Time</span><span class="op" id="3120680">)</span>&nbsp;<span class="op" id="3120682">(</span><span class="ident" id="3120683">Conn</span><span class="op" id="3120687">,</span>&nbsp;<span class="builtintype" id="3120689">error</span><span class="op" id="3120694">)</span>&nbsp;<span class="op" id="3120696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120700">return</span>&nbsp;<span class="ident" id="3120707">dialSingle</span><span class="op" id="3120717">(</span><span class="ident" id="3120718">network</span><span class="op" id="3120725">,</span>&nbsp;<span class="ident" id="3120727">address</span><span class="op" id="3120734">,</span>&nbsp;<span class="ident" id="3120736">d</span><span class="op" id="3120737">.</span><span class="ident" id="3120738">LocalAddr</span><span class="op" id="3120747">,</span>&nbsp;<span class="ident" id="3120749">ra</span><span class="op" id="3120751">.</span><span class="ident" id="3120752">toAddr</span><span class="op" id="3120758">(</span><span class="op" id="3120759">)</span><span class="op" id="3120760">,</span>&nbsp;<span class="ident" id="3120762">deadline</span><span class="op" id="3120770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120773">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120776">if</span>&nbsp;<span class="ident" id="3120779">ras</span><span class="op" id="3120782">,</span>&nbsp;<span class="ident" id="3120784">ok</span>&nbsp;<span class="op" id="3120787">:=</span>&nbsp;<span class="ident" id="3120790">ra</span><span class="op" id="3120792">.</span><span class="op" id="3120793">(</span><span class="ident" id="3120794">addrList</span><span class="op" id="3120802">)</span><span class="op" id="3120803">;</span>&nbsp;<span class="ident" id="3120805">ok</span>&nbsp;<span class="op" id="3120808">&amp;&amp;</span>&nbsp;<span class="ident" id="3120811">d</span><span class="op" id="3120812">.</span><span class="ident" id="3120813">DualStack</span>&nbsp;<span class="op" id="3120823">&amp;&amp;</span>&nbsp;<span class="ident" id="3120826">network</span>&nbsp;<span class="op" id="3120834">==</span>&nbsp;<span class="string" id="3120837">&#34;tcp&#34;</span>&nbsp;<span class="op" id="3120843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120847">dialer</span>&nbsp;<span class="op" id="3120854">=</span>&nbsp;<span class="keyword" id="3120856">func</span><span class="op" id="3120860">(</span><span class="ident" id="3120861">deadline</span>&nbsp;<span class="ident" id="3120870">time</span><span class="op" id="3120874">.</span><span class="ident" id="3120875">Time</span><span class="op" id="3120879">)</span>&nbsp;<span class="op" id="3120881">(</span><span class="ident" id="3120882">Conn</span><span class="op" id="3120886">,</span>&nbsp;<span class="builtintype" id="3120888">error</span><span class="op" id="3120893">)</span>&nbsp;<span class="op" id="3120895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120900">return</span>&nbsp;<span class="ident" id="3120907">dialMulti</span><span class="op" id="3120916">(</span><span class="ident" id="3120917">network</span><span class="op" id="3120924">,</span>&nbsp;<span class="ident" id="3120926">address</span><span class="op" id="3120933">,</span>&nbsp;<span class="ident" id="3120935">d</span><span class="op" id="3120936">.</span><span class="ident" id="3120937">LocalAddr</span><span class="op" id="3120946">,</span>&nbsp;<span class="ident" id="3120948">ras</span><span class="op" id="3120951">,</span>&nbsp;<span class="ident" id="3120953">deadline</span><span class="op" id="3120961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120968">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120971">c</span><span class="op" id="3120972">,</span>&nbsp;<span class="ident" id="3120974">err</span>&nbsp;<span class="op" id="3120978">:=</span>&nbsp;<span class="ident" id="3120981">dial</span><span class="op" id="3120985">(</span><span class="ident" id="3120986">network</span><span class="op" id="3120993">,</span>&nbsp;<span class="ident" id="3120995">ra</span><span class="op" id="3120997">.</span><span class="ident" id="3120998">toAddr</span><span class="op" id="3121004">(</span><span class="op" id="3121005">)</span><span class="op" id="3121006">,</span>&nbsp;<span class="ident" id="3121008">dialer</span><span class="op" id="3121014">,</span>&nbsp;<span class="ident" id="3121016">d</span><span class="op" id="3121017">.</span><span class="ident" id="3121018">deadline</span><span class="op" id="3121026">(</span><span class="op" id="3121027">)</span><span class="op" id="3121028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121031">if</span>&nbsp;<span class="ident" id="3121034">d</span><span class="op" id="3121035">.</span><span class="ident" id="3121036">KeepAlive</span>&nbsp;<span class="op" id="3121046">&gt;</span>&nbsp;<span class="num" id="3121048">0</span>&nbsp;<span class="op" id="3121050">&amp;&amp;</span>&nbsp;<span class="ident" id="3121053">err</span>&nbsp;<span class="op" id="3121057">==</span>&nbsp;<span class="ident" id="3121060">nil</span>&nbsp;<span class="op" id="3121064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121068">if</span>&nbsp;<span class="ident" id="3121071">tc</span><span class="op" id="3121073">,</span>&nbsp;<span class="ident" id="3121075">ok</span>&nbsp;<span class="op" id="3121078">:=</span>&nbsp;<span class="ident" id="3121081">c</span><span class="op" id="3121082">.</span><span class="op" id="3121083">(</span><span class="op" id="3121084">*</span><span class="ident" id="3121085">TCPConn</span><span class="op" id="3121092">)</span><span class="op" id="3121093">;</span>&nbsp;<span class="ident" id="3121095">ok</span>&nbsp;<span class="op" id="3121098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3121103">tc</span><span class="op" id="3121105">.</span><span class="ident" id="3121106">SetKeepAlive</span><span class="op" id="3121118">(</span><span class="builtintype" id="3121119">true</span><span class="op" id="3121123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3121128">tc</span><span class="op" id="3121130">.</span><span class="ident" id="3121131">SetKeepAlivePeriod</span><span class="op" id="3121149">(</span><span class="ident" id="3121150">d</span><span class="op" id="3121151">.</span><span class="ident" id="3121152">KeepAlive</span><span class="op" id="3121161">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3121166">testHookSetKeepAlive</span><span class="op" id="3121186">(</span><span class="op" id="3121187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3121191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3121194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121197">return</span>&nbsp;<span class="ident" id="3121204">c</span><span class="op" id="3121205">,</span>&nbsp;<span class="ident" id="3121207">err</span><br>
<span class="lineno"></span><span class="op" id="3121211">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="3121214">var</span>&nbsp;<span class="ident" id="3121218">testHookSetKeepAlive</span>&nbsp;<span class="op" id="3121239">=</span>&nbsp;<span class="keyword" id="3121241">func</span><span class="op" id="3121245">(</span><span class="op" id="3121246">)</span>&nbsp;<span class="op" id="3121248">{</span><span class="op" id="3121249">}</span>&nbsp;<span class="comment" id="3121251">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3121279">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3121349">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="3121412">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3121480">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="3121510">func</span>&nbsp;<span class="ident" id="3121515">dialMulti</span><span class="op" id="3121524">(</span><span class="ident" id="3121525">net</span><span class="op" id="3121528">,</span>&nbsp;<span class="ident" id="3121530">addr</span>&nbsp;<span class="builtintype" id="3121535">string</span><span class="op" id="3121541">,</span>&nbsp;<span class="ident" id="3121543">la</span>&nbsp;<span class="ident" id="3121546">Addr</span><span class="op" id="3121550">,</span>&nbsp;<span class="ident" id="3121552">ras</span>&nbsp;<span class="ident" id="3121556">addrList</span><span class="op" id="3121564">,</span>&nbsp;<span class="ident" id="3121566">deadline</span>&nbsp;<span class="ident" id="3121575">time</span><span class="op" id="3121579">.</span><span class="ident" id="3121580">Time</span><span class="op" id="3121584">)</span>&nbsp;<span class="op" id="3121586">(</span><span class="ident" id="3121587">Conn</span><span class="op" id="3121591">,</span>&nbsp;<span class="builtintype" id="3121593">error</span><span class="op" id="3121598">)</span>&nbsp;<span class="op" id="3121600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121603">type</span>&nbsp;<span class="ident" id="3121608">racer</span>&nbsp;<span class="keyword" id="3121614">struct</span>&nbsp;<span class="op" id="3121621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3121625">Conn</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3121632">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3121639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3121642">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3121705">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3121768">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3121797">sig</span>&nbsp;<span class="op" id="3121801">:=</span>&nbsp;<span class="builtinfunc" id="3121804">make</span><span class="op" id="3121808">(</span><span class="keyword" id="3121809">chan</span>&nbsp;<span class="builtintype" id="3121814">bool</span><span class="op" id="3121818">,</span>&nbsp;<span class="num" id="3121820">1</span><span class="op" id="3121821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3121824">lane</span>&nbsp;<span class="op" id="3121829">:=</span>&nbsp;<span class="builtinfunc" id="3121832">make</span><span class="op" id="3121836">(</span><span class="keyword" id="3121837">chan</span>&nbsp;<span class="ident" id="3121842">racer</span><span class="op" id="3121847">,</span>&nbsp;<span class="num" id="3121849">1</span><span class="op" id="3121850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121853">for</span>&nbsp;<span class="ident" id="3121857">_</span><span class="op" id="3121858">,</span>&nbsp;<span class="ident" id="3121860">ra</span>&nbsp;<span class="op" id="3121863">:=</span>&nbsp;<span class="keyword" id="3121866">range</span>&nbsp;<span class="ident" id="3121872">ras</span>&nbsp;<span class="op" id="3121876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121880">go</span>&nbsp;<span class="keyword" id="3121883">func</span><span class="op" id="3121887">(</span><span class="ident" id="3121888">ra</span>&nbsp;<span class="ident" id="3121891">Addr</span><span class="op" id="3121895">)</span>&nbsp;<span class="op" id="3121897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3121902">c</span><span class="op" id="3121903">,</span>&nbsp;<span class="ident" id="3121905">err</span>&nbsp;<span class="op" id="3121909">:=</span>&nbsp;<span class="ident" id="3121912">dialSingle</span><span class="op" id="3121922">(</span><span class="ident" id="3121923">net</span><span class="op" id="3121926">,</span>&nbsp;<span class="ident" id="3121928">addr</span><span class="op" id="3121932">,</span>&nbsp;<span class="ident" id="3121934">la</span><span class="op" id="3121936">,</span>&nbsp;<span class="ident" id="3121938">ra</span><span class="op" id="3121940">,</span>&nbsp;<span class="ident" id="3121942">deadline</span><span class="op" id="3121950">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121955">if</span>&nbsp;<span class="ident" id="3121958">_</span><span class="op" id="3121959">,</span>&nbsp;<span class="ident" id="3121961">ok</span>&nbsp;<span class="op" id="3121964">:=</span>&nbsp;<span class="op" id="3121967">&lt;-</span><span class="ident" id="3121969">sig</span><span class="op" id="3121972">;</span>&nbsp;<span class="ident" id="3121974">ok</span>&nbsp;<span class="op" id="3121977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3121983">lane</span>&nbsp;<span class="op" id="3121988">&lt;-</span>&nbsp;<span class="ident" id="3121991">racer</span><span class="op" id="3121996">{</span><span class="ident" id="3121997">c</span><span class="op" id="3121998">,</span>&nbsp;<span class="ident" id="3122000">err</span><span class="op" id="3122003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3122008">}</span>&nbsp;<span class="keyword" id="3122010">else</span>&nbsp;<span class="keyword" id="3122015">if</span>&nbsp;<span class="ident" id="3122018">err</span>&nbsp;<span class="op" id="3122022">==</span>&nbsp;<span class="ident" id="3122025">nil</span>&nbsp;<span class="op" id="3122029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3122035">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3122074">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3122106">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3122143">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3122183">c</span><span class="op" id="3122184">.</span><span class="ident" id="3122185">Close</span><span class="op" id="3122190">(</span><span class="op" id="3122191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3122196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3122200">}</span><span class="op" id="3122201">(</span><span class="ident" id="3122202">ra</span><span class="op" id="3122204">.</span><span class="ident" id="3122205">toAddr</span><span class="op" id="3122211">(</span><span class="op" id="3122212">)</span><span class="op" id="3122213">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3122216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3122219">defer</span>&nbsp;<span class="builtinfunc" id="3122225">close</span><span class="op" id="3122230">(</span><span class="ident" id="3122231">sig</span><span class="op" id="3122234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3122237">lastErr</span>&nbsp;<span class="op" id="3122245">:=</span>&nbsp;<span class="ident" id="3122248">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3122260">nracers</span>&nbsp;<span class="op" id="3122268">:=</span>&nbsp;<span class="builtinfunc" id="3122271">len</span><span class="op" id="3122274">(</span><span class="ident" id="3122275">ras</span><span class="op" id="3122278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3122281">for</span>&nbsp;<span class="ident" id="3122285">nracers</span>&nbsp;<span class="op" id="3122293">&gt;</span>&nbsp;<span class="num" id="3122295">0</span>&nbsp;<span class="op" id="3122297">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3122301">sig</span>&nbsp;<span class="op" id="3122305">&lt;-</span>&nbsp;<span class="builtintype" id="3122308">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3122315">racer</span>&nbsp;<span class="op" id="3122321">:=</span>&nbsp;<span class="op" id="3122324">&lt;-</span><span class="ident" id="3122326">lane</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3122333">if</span>&nbsp;<span class="ident" id="3122336">racer</span><span class="op" id="3122341">.</span><span class="builtintype" id="3122342">error</span>&nbsp;<span class="op" id="3122348">==</span>&nbsp;<span class="ident" id="3122351">nil</span>&nbsp;<span class="op" id="3122355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3122360">return</span>&nbsp;<span class="ident" id="3122367">racer</span><span class="op" id="3122372">.</span><span class="ident" id="3122373">Conn</span><span class="op" id="3122377">,</span>&nbsp;<span class="ident" id="3122379">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3122385">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3122389">lastErr</span>&nbsp;<span class="op" id="3122397">=</span>&nbsp;<span class="ident" id="3122399">racer</span><span class="op" id="3122404">.</span><span class="builtintype" id="3122405">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3122413">nracers</span><span class="op" id="3122420">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3122424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3122427">return</span>&nbsp;<span class="ident" id="3122434">nil</span><span class="op" id="3122437">,</span>&nbsp;<span class="ident" id="3122439">lastErr</span><br>
<span class="lineno"></span><span class="op" id="3122447">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3122450">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3122521">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3122549">func</span>&nbsp;<span class="ident" id="3122554">dialSingle</span><span class="op" id="3122564">(</span><span class="ident" id="3122565">net</span><span class="op" id="3122568">,</span>&nbsp;<span class="ident" id="3122570">addr</span>&nbsp;<span class="builtintype" id="3122575">string</span><span class="op" id="3122581">,</span>&nbsp;<span class="ident" id="3122583">la</span><span class="op" id="3122585">,</span>&nbsp;<span class="ident" id="3122587">ra</span>&nbsp;<span class="ident" id="3122590">Addr</span><span class="op" id="3122594">,</span>&nbsp;<span class="ident" id="3122596">deadline</span>&nbsp;<span class="ident" id="3122605">time</span><span class="op" id="3122609">.</span><span class="ident" id="3122610">Time</span><span class="op" id="3122614">)</span>&nbsp;<span class="op" id="3122616">(</span><span class="ident" id="3122617">c</span>&nbsp;<span class="ident" id="3122619">Conn</span><span class="op" id="3122623">,</span>&nbsp;<span class="ident" id="3122625">err</span>&nbsp;<span class="builtintype" id="3122629">error</span><span class="op" id="3122634">)</span>&nbsp;<span class="op" id="3122636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3122639">if</span>&nbsp;<span class="ident" id="3122642">la</span>&nbsp;<span class="op" id="3122645">!=</span>&nbsp;<span class="ident" id="3122648">nil</span>&nbsp;<span class="op" id="3122652">&amp;&amp;</span>&nbsp;<span class="ident" id="3122655">la</span><span class="op" id="3122657">.</span><span class="ident" id="3122658">Network</span><span class="op" id="3122665">(</span><span class="op" id="3122666">)</span>&nbsp;<span class="op" id="3122668">!=</span>&nbsp;<span class="ident" id="3122671">ra</span><span class="op" id="3122673">.</span><span class="ident" id="3122674">Network</span><span class="op" id="3122681">(</span><span class="op" id="3122682">)</span>&nbsp;<span class="op" id="3122684">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3122688">return</span>&nbsp;<span class="ident" id="3122695">nil</span><span class="op" id="3122698">,</span>&nbsp;<span class="op" id="3122700">&amp;</span><span class="ident" id="3122701">OpError</span><span class="op" id="3122708">{</span><span class="ident" id="3122709">Op</span><span class="op" id="3122711">:</span>&nbsp;<span class="string" id="3122713">&#34;dial&#34;</span><span class="op" id="3122719">,</span>&nbsp;<span class="ident" id="3122721">Net</span><span class="op" id="3122724">:</span>&nbsp;<span class="ident" id="3122726">net</span><span class="op" id="3122729">,</span>&nbsp;<span class="ident" id="3122731">Addr</span><span class="op" id="3122735">:</span>&nbsp;<span class="ident" id="3122737">ra</span><span class="op" id="3122739">,</span>&nbsp;<span class="ident" id="3122741">Err</span><span class="op" id="3122744">:</span>&nbsp;<span class="ident" id="3122746">errors</span><span class="op" id="3122752">.</span><span class="ident" id="3122753">New</span><span class="op" id="3122756">(</span><span class="string" id="3122757">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3122790">+</span>&nbsp;<span class="ident" id="3122792">la</span><span class="op" id="3122794">.</span><span class="ident" id="3122795">Network</span><span class="op" id="3122802">(</span><span class="op" id="3122803">)</span><span class="op" id="3122804">)</span><span class="op" id="3122805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3122808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3122811">switch</span>&nbsp;<span class="ident" id="3122818">ra</span>&nbsp;<span class="op" id="3122821">:=</span>&nbsp;<span class="ident" id="3122824">ra</span><span class="op" id="3122826">.</span><span class="op" id="3122827">(</span><span class="keyword" id="3122828">type</span><span class="op" id="3122832">)</span>&nbsp;<span class="op" id="3122834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3122837">case</span>&nbsp;<span class="op" id="3122842">*</span><span class="ident" id="3122843">TCPAddr</span><span class="op" id="3122850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3122854">la</span><span class="op" id="3122856">,</span>&nbsp;<span class="ident" id="3122858">_</span>&nbsp;<span class="op" id="3122860">:=</span>&nbsp;<span class="ident" id="3122863">la</span><span class="op" id="3122865">.</span><span class="op" id="3122866">(</span><span class="op" id="3122867">*</span><span class="ident" id="3122868">TCPAddr</span><span class="op" id="3122875">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3122879">c</span><span class="op" id="3122880">,</span>&nbsp;<span class="ident" id="3122882">err</span>&nbsp;<span class="op" id="3122886">=</span>&nbsp;<span class="ident" id="3122888">dialTCP</span><span class="op" id="3122895">(</span><span class="ident" id="3122896">net</span><span class="op" id="3122899">,</span>&nbsp;<span class="ident" id="3122901">la</span><span class="op" id="3122903">,</span>&nbsp;<span class="ident" id="3122905">ra</span><span class="op" id="3122907">,</span>&nbsp;<span class="ident" id="3122909">deadline</span><span class="op" id="3122917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3122920">case</span>&nbsp;<span class="op" id="3122925">*</span><span class="ident" id="3122926">UDPAddr</span><span class="op" id="3122933">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3122937">la</span><span class="op" id="3122939">,</span>&nbsp;<span class="ident" id="3122941">_</span>&nbsp;<span class="op" id="3122943">:=</span>&nbsp;<span class="ident" id="3122946">la</span><span class="op" id="3122948">.</span><span class="op" id="3122949">(</span><span class="op" id="3122950">*</span><span class="ident" id="3122951">UDPAddr</span><span class="op" id="3122958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3122962">c</span><span class="op" id="3122963">,</span>&nbsp;<span class="ident" id="3122965">err</span>&nbsp;<span class="op" id="3122969">=</span>&nbsp;<span class="ident" id="3122971">dialUDP</span><span class="op" id="3122978">(</span><span class="ident" id="3122979">net</span><span class="op" id="3122982">,</span>&nbsp;<span class="ident" id="3122984">la</span><span class="op" id="3122986">,</span>&nbsp;<span class="ident" id="3122988">ra</span><span class="op" id="3122990">,</span>&nbsp;<span class="ident" id="3122992">deadline</span><span class="op" id="3123000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123003">case</span>&nbsp;<span class="op" id="3123008">*</span><span class="ident" id="3123009">IPAddr</span><span class="op" id="3123015">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3123019">la</span><span class="op" id="3123021">,</span>&nbsp;<span class="ident" id="3123023">_</span>&nbsp;<span class="op" id="3123025">:=</span>&nbsp;<span class="ident" id="3123028">la</span><span class="op" id="3123030">.</span><span class="op" id="3123031">(</span><span class="op" id="3123032">*</span><span class="ident" id="3123033">IPAddr</span><span class="op" id="3123039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3123043">c</span><span class="op" id="3123044">,</span>&nbsp;<span class="ident" id="3123046">err</span>&nbsp;<span class="op" id="3123050">=</span>&nbsp;<span class="ident" id="3123052">dialIP</span><span class="op" id="3123058">(</span><span class="ident" id="3123059">net</span><span class="op" id="3123062">,</span>&nbsp;<span class="ident" id="3123064">la</span><span class="op" id="3123066">,</span>&nbsp;<span class="ident" id="3123068">ra</span><span class="op" id="3123070">,</span>&nbsp;<span class="ident" id="3123072">deadline</span><span class="op" id="3123080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123083">case</span>&nbsp;<span class="op" id="3123088">*</span><span class="ident" id="3123089">UnixAddr</span><span class="op" id="3123097">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3123101">la</span><span class="op" id="3123103">,</span>&nbsp;<span class="ident" id="3123105">_</span>&nbsp;<span class="op" id="3123107">:=</span>&nbsp;<span class="ident" id="3123110">la</span><span class="op" id="3123112">.</span><span class="op" id="3123113">(</span><span class="op" id="3123114">*</span><span class="ident" id="3123115">UnixAddr</span><span class="op" id="3123123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3123127">c</span><span class="op" id="3123128">,</span>&nbsp;<span class="ident" id="3123130">err</span>&nbsp;<span class="op" id="3123134">=</span>&nbsp;<span class="ident" id="3123136">dialUnix</span><span class="op" id="3123144">(</span><span class="ident" id="3123145">net</span><span class="op" id="3123148">,</span>&nbsp;<span class="ident" id="3123150">la</span><span class="op" id="3123152">,</span>&nbsp;<span class="ident" id="3123154">ra</span><span class="op" id="3123156">,</span>&nbsp;<span class="ident" id="3123158">deadline</span><span class="op" id="3123166">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123169">default</span><span class="op" id="3123176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123180">return</span>&nbsp;<span class="ident" id="3123187">nil</span><span class="op" id="3123190">,</span>&nbsp;<span class="op" id="3123192">&amp;</span><span class="ident" id="3123193">OpError</span><span class="op" id="3123200">{</span><span class="ident" id="3123201">Op</span><span class="op" id="3123203">:</span>&nbsp;<span class="string" id="3123205">&#34;dial&#34;</span><span class="op" id="3123211">,</span>&nbsp;<span class="ident" id="3123213">Net</span><span class="op" id="3123216">:</span>&nbsp;<span class="ident" id="3123218">net</span><span class="op" id="3123221">,</span>&nbsp;<span class="ident" id="3123223">Addr</span><span class="op" id="3123227">:</span>&nbsp;<span class="ident" id="3123229">ra</span><span class="op" id="3123231">,</span>&nbsp;<span class="ident" id="3123233">Err</span><span class="op" id="3123236">:</span>&nbsp;<span class="op" id="3123238">&amp;</span><span class="ident" id="3123239">AddrError</span><span class="op" id="3123248">{</span><span class="ident" id="3123249">Err</span><span class="op" id="3123252">:</span>&nbsp;<span class="string" id="3123254">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3123279">,</span>&nbsp;<span class="ident" id="3123281">Addr</span><span class="op" id="3123285">:</span>&nbsp;<span class="ident" id="3123287">addr</span><span class="op" id="3123291">}</span><span class="op" id="3123292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3123295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123298">if</span>&nbsp;<span class="ident" id="3123301">err</span>&nbsp;<span class="op" id="3123305">!=</span>&nbsp;<span class="ident" id="3123308">nil</span>&nbsp;<span class="op" id="3123312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123316">return</span>&nbsp;<span class="ident" id="3123323">nil</span><span class="op" id="3123326">,</span>&nbsp;<span class="ident" id="3123328">err</span>&nbsp;<span class="comment" id="3123332">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3123382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123385">return</span>&nbsp;<span class="ident" id="3123392">c</span><span class="op" id="3123393">,</span>&nbsp;<span class="ident" id="3123395">nil</span><br>
<span class="lineno"></span><span class="op" id="3123399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3123402">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="3123458">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3123527">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3123562">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3123599">func</span>&nbsp;<span class="ident" id="3123604">Listen</span><span class="op" id="3123610">(</span><span class="ident" id="3123611">net</span><span class="op" id="3123614">,</span>&nbsp;<span class="ident" id="3123616">laddr</span>&nbsp;<span class="builtintype" id="3123622">string</span><span class="op" id="3123628">)</span>&nbsp;<span class="op" id="3123630">(</span><span class="ident" id="3123631">Listener</span><span class="op" id="3123639">,</span>&nbsp;<span class="builtintype" id="3123641">error</span><span class="op" id="3123646">)</span>&nbsp;<span class="op" id="3123648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3123651">la</span><span class="op" id="3123653">,</span>&nbsp;<span class="ident" id="3123655">err</span>&nbsp;<span class="op" id="3123659">:=</span>&nbsp;<span class="ident" id="3123662">resolveAddr</span><span class="op" id="3123673">(</span><span class="string" id="3123674">&#34;listen&#34;</span><span class="op" id="3123682">,</span>&nbsp;<span class="ident" id="3123684">net</span><span class="op" id="3123687">,</span>&nbsp;<span class="ident" id="3123689">laddr</span><span class="op" id="3123694">,</span>&nbsp;<span class="ident" id="3123696">noDeadline</span><span class="op" id="3123706">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123709">if</span>&nbsp;<span class="ident" id="3123712">err</span>&nbsp;<span class="op" id="3123716">!=</span>&nbsp;<span class="ident" id="3123719">nil</span>&nbsp;<span class="op" id="3123723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123727">return</span>&nbsp;<span class="ident" id="3123734">nil</span><span class="op" id="3123737">,</span>&nbsp;<span class="op" id="3123739">&amp;</span><span class="ident" id="3123740">OpError</span><span class="op" id="3123747">{</span><span class="ident" id="3123748">Op</span><span class="op" id="3123750">:</span>&nbsp;<span class="string" id="3123752">&#34;listen&#34;</span><span class="op" id="3123760">,</span>&nbsp;<span class="ident" id="3123762">Net</span><span class="op" id="3123765">:</span>&nbsp;<span class="ident" id="3123767">net</span><span class="op" id="3123770">,</span>&nbsp;<span class="ident" id="3123772">Addr</span><span class="op" id="3123776">:</span>&nbsp;<span class="ident" id="3123778">nil</span><span class="op" id="3123781">,</span>&nbsp;<span class="ident" id="3123783">Err</span><span class="op" id="3123786">:</span>&nbsp;<span class="ident" id="3123788">err</span><span class="op" id="3123791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3123794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123797">var</span>&nbsp;<span class="ident" id="3123801">l</span>&nbsp;<span class="ident" id="3123803">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123813">switch</span>&nbsp;<span class="ident" id="3123820">la</span>&nbsp;<span class="op" id="3123823">:=</span>&nbsp;<span class="ident" id="3123826">la</span><span class="op" id="3123828">.</span><span class="ident" id="3123829">toAddr</span><span class="op" id="3123835">(</span><span class="op" id="3123836">)</span><span class="op" id="3123837">.</span><span class="op" id="3123838">(</span><span class="keyword" id="3123839">type</span><span class="op" id="3123843">)</span>&nbsp;<span class="op" id="3123845">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123848">case</span>&nbsp;<span class="op" id="3123853">*</span><span class="ident" id="3123854">TCPAddr</span><span class="op" id="3123861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3123865">l</span><span class="op" id="3123866">,</span>&nbsp;<span class="ident" id="3123868">err</span>&nbsp;<span class="op" id="3123872">=</span>&nbsp;<span class="ident" id="3123874">ListenTCP</span><span class="op" id="3123883">(</span><span class="ident" id="3123884">net</span><span class="op" id="3123887">,</span>&nbsp;<span class="ident" id="3123889">la</span><span class="op" id="3123891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123894">case</span>&nbsp;<span class="op" id="3123899">*</span><span class="ident" id="3123900">UnixAddr</span><span class="op" id="3123908">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3123912">l</span><span class="op" id="3123913">,</span>&nbsp;<span class="ident" id="3123915">err</span>&nbsp;<span class="op" id="3123919">=</span>&nbsp;<span class="ident" id="3123921">ListenUnix</span><span class="op" id="3123931">(</span><span class="ident" id="3123932">net</span><span class="op" id="3123935">,</span>&nbsp;<span class="ident" id="3123937">la</span><span class="op" id="3123939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123942">default</span><span class="op" id="3123949">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3123953">return</span>&nbsp;<span class="ident" id="3123960">nil</span><span class="op" id="3123963">,</span>&nbsp;<span class="op" id="3123965">&amp;</span><span class="ident" id="3123966">OpError</span><span class="op" id="3123973">{</span><span class="ident" id="3123974">Op</span><span class="op" id="3123976">:</span>&nbsp;<span class="string" id="3123978">&#34;listen&#34;</span><span class="op" id="3123986">,</span>&nbsp;<span class="ident" id="3123988">Net</span><span class="op" id="3123991">:</span>&nbsp;<span class="ident" id="3123993">net</span><span class="op" id="3123996">,</span>&nbsp;<span class="ident" id="3123998">Addr</span><span class="op" id="3124002">:</span>&nbsp;<span class="ident" id="3124004">la</span><span class="op" id="3124006">,</span>&nbsp;<span class="ident" id="3124008">Err</span><span class="op" id="3124011">:</span>&nbsp;<span class="op" id="3124013">&amp;</span><span class="ident" id="3124014">AddrError</span><span class="op" id="3124023">{</span><span class="ident" id="3124024">Err</span><span class="op" id="3124027">:</span>&nbsp;<span class="string" id="3124029">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3124054">,</span>&nbsp;<span class="ident" id="3124056">Addr</span><span class="op" id="3124060">:</span>&nbsp;<span class="ident" id="3124062">laddr</span><span class="op" id="3124067">}</span><span class="op" id="3124068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3124071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124074">if</span>&nbsp;<span class="ident" id="3124077">err</span>&nbsp;<span class="op" id="3124081">!=</span>&nbsp;<span class="ident" id="3124084">nil</span>&nbsp;<span class="op" id="3124088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124092">return</span>&nbsp;<span class="ident" id="3124099">nil</span><span class="op" id="3124102">,</span>&nbsp;<span class="ident" id="3124104">err</span>&nbsp;<span class="comment" id="3124108">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3124158">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124161">return</span>&nbsp;<span class="ident" id="3124168">l</span><span class="op" id="3124169">,</span>&nbsp;<span class="ident" id="3124171">nil</span><br>
<span class="lineno"></span><span class="op" id="3124175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3124178">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="3124240">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="3124309">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3124354">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3124391">func</span>&nbsp;<span class="ident" id="3124396">ListenPacket</span><span class="op" id="3124408">(</span><span class="ident" id="3124409">net</span><span class="op" id="3124412">,</span>&nbsp;<span class="ident" id="3124414">laddr</span>&nbsp;<span class="builtintype" id="3124420">string</span><span class="op" id="3124426">)</span>&nbsp;<span class="op" id="3124428">(</span><span class="ident" id="3124429">PacketConn</span><span class="op" id="3124439">,</span>&nbsp;<span class="builtintype" id="3124441">error</span><span class="op" id="3124446">)</span>&nbsp;<span class="op" id="3124448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3124451">la</span><span class="op" id="3124453">,</span>&nbsp;<span class="ident" id="3124455">err</span>&nbsp;<span class="op" id="3124459">:=</span>&nbsp;<span class="ident" id="3124462">resolveAddr</span><span class="op" id="3124473">(</span><span class="string" id="3124474">&#34;listen&#34;</span><span class="op" id="3124482">,</span>&nbsp;<span class="ident" id="3124484">net</span><span class="op" id="3124487">,</span>&nbsp;<span class="ident" id="3124489">laddr</span><span class="op" id="3124494">,</span>&nbsp;<span class="ident" id="3124496">noDeadline</span><span class="op" id="3124506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124509">if</span>&nbsp;<span class="ident" id="3124512">err</span>&nbsp;<span class="op" id="3124516">!=</span>&nbsp;<span class="ident" id="3124519">nil</span>&nbsp;<span class="op" id="3124523">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124527">return</span>&nbsp;<span class="ident" id="3124534">nil</span><span class="op" id="3124537">,</span>&nbsp;<span class="op" id="3124539">&amp;</span><span class="ident" id="3124540">OpError</span><span class="op" id="3124547">{</span><span class="ident" id="3124548">Op</span><span class="op" id="3124550">:</span>&nbsp;<span class="string" id="3124552">&#34;listen&#34;</span><span class="op" id="3124560">,</span>&nbsp;<span class="ident" id="3124562">Net</span><span class="op" id="3124565">:</span>&nbsp;<span class="ident" id="3124567">net</span><span class="op" id="3124570">,</span>&nbsp;<span class="ident" id="3124572">Addr</span><span class="op" id="3124576">:</span>&nbsp;<span class="ident" id="3124578">nil</span><span class="op" id="3124581">,</span>&nbsp;<span class="ident" id="3124583">Err</span><span class="op" id="3124586">:</span>&nbsp;<span class="ident" id="3124588">err</span><span class="op" id="3124591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3124594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124597">var</span>&nbsp;<span class="ident" id="3124601">l</span>&nbsp;<span class="ident" id="3124603">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124615">switch</span>&nbsp;<span class="ident" id="3124622">la</span>&nbsp;<span class="op" id="3124625">:=</span>&nbsp;<span class="ident" id="3124628">la</span><span class="op" id="3124630">.</span><span class="ident" id="3124631">toAddr</span><span class="op" id="3124637">(</span><span class="op" id="3124638">)</span><span class="op" id="3124639">.</span><span class="op" id="3124640">(</span><span class="keyword" id="3124641">type</span><span class="op" id="3124645">)</span>&nbsp;<span class="op" id="3124647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124650">case</span>&nbsp;<span class="op" id="3124655">*</span><span class="ident" id="3124656">UDPAddr</span><span class="op" id="3124663">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3124667">l</span><span class="op" id="3124668">,</span>&nbsp;<span class="ident" id="3124670">err</span>&nbsp;<span class="op" id="3124674">=</span>&nbsp;<span class="ident" id="3124676">ListenUDP</span><span class="op" id="3124685">(</span><span class="ident" id="3124686">net</span><span class="op" id="3124689">,</span>&nbsp;<span class="ident" id="3124691">la</span><span class="op" id="3124693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124696">case</span>&nbsp;<span class="op" id="3124701">*</span><span class="ident" id="3124702">IPAddr</span><span class="op" id="3124708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3124712">l</span><span class="op" id="3124713">,</span>&nbsp;<span class="ident" id="3124715">err</span>&nbsp;<span class="op" id="3124719">=</span>&nbsp;<span class="ident" id="3124721">ListenIP</span><span class="op" id="3124729">(</span><span class="ident" id="3124730">net</span><span class="op" id="3124733">,</span>&nbsp;<span class="ident" id="3124735">la</span><span class="op" id="3124737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124740">case</span>&nbsp;<span class="op" id="3124745">*</span><span class="ident" id="3124746">UnixAddr</span><span class="op" id="3124754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3124758">l</span><span class="op" id="3124759">,</span>&nbsp;<span class="ident" id="3124761">err</span>&nbsp;<span class="op" id="3124765">=</span>&nbsp;<span class="ident" id="3124767">ListenUnixgram</span><span class="op" id="3124781">(</span><span class="ident" id="3124782">net</span><span class="op" id="3124785">,</span>&nbsp;<span class="ident" id="3124787">la</span><span class="op" id="3124789">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124792">default</span><span class="op" id="3124799">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124803">return</span>&nbsp;<span class="ident" id="3124810">nil</span><span class="op" id="3124813">,</span>&nbsp;<span class="op" id="3124815">&amp;</span><span class="ident" id="3124816">OpError</span><span class="op" id="3124823">{</span><span class="ident" id="3124824">Op</span><span class="op" id="3124826">:</span>&nbsp;<span class="string" id="3124828">&#34;listen&#34;</span><span class="op" id="3124836">,</span>&nbsp;<span class="ident" id="3124838">Net</span><span class="op" id="3124841">:</span>&nbsp;<span class="ident" id="3124843">net</span><span class="op" id="3124846">,</span>&nbsp;<span class="ident" id="3124848">Addr</span><span class="op" id="3124852">:</span>&nbsp;<span class="ident" id="3124854">la</span><span class="op" id="3124856">,</span>&nbsp;<span class="ident" id="3124858">Err</span><span class="op" id="3124861">:</span>&nbsp;<span class="op" id="3124863">&amp;</span><span class="ident" id="3124864">AddrError</span><span class="op" id="3124873">{</span><span class="ident" id="3124874">Err</span><span class="op" id="3124877">:</span>&nbsp;<span class="string" id="3124879">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3124904">,</span>&nbsp;<span class="ident" id="3124906">Addr</span><span class="op" id="3124910">:</span>&nbsp;<span class="ident" id="3124912">laddr</span><span class="op" id="3124917">}</span><span class="op" id="3124918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3124921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124924">if</span>&nbsp;<span class="ident" id="3124927">err</span>&nbsp;<span class="op" id="3124931">!=</span>&nbsp;<span class="ident" id="3124934">nil</span>&nbsp;<span class="op" id="3124938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3124942">return</span>&nbsp;<span class="ident" id="3124949">nil</span><span class="op" id="3124952">,</span>&nbsp;<span class="ident" id="3124954">err</span>&nbsp;<span class="comment" id="3124958">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3125008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3125011">return</span>&nbsp;<span class="ident" id="3125018">l</span><span class="op" id="3125019">,</span>&nbsp;<span class="ident" id="3125021">nil</span><br>
<span class="lineno"></span><span class="op" id="3125025">}</span>
</div>
</body>
</html>
