<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5725797">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5725852">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5725906">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5725957">package</span>&nbsp;<span class="ident" id="5725965">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5725970">import</span>&nbsp;<span class="op" id="5725977">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5725980">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5725989">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5726005">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5726015">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5726024">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5726039">&#34;image/color/palette&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5726062">&#34;image/draw&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5726076">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5726081">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5726084">//&nbsp;Graphic&nbsp;control&nbsp;extension&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="5726121">const</span>&nbsp;<span class="op" id="5726127">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5726130">gcLabel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5726142">=</span>&nbsp;<span class="num" id="5726144">0xF9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5726150">gcBlockSize</span>&nbsp;<span class="op" id="5726162">=</span>&nbsp;<span class="num" id="5726164">0x04</span><br>
<span class="lineno"></span><span class="op" id="5726169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5726172">var</span>&nbsp;<span class="ident" id="5726176">log2Lookup</span>&nbsp;<span class="op" id="5726187">=</span>&nbsp;<span class="op" id="5726189">[</span><span class="num" id="5726190">8</span><span class="op" id="5726191">]</span><span class="builtintype" id="5726192">int</span><span class="op" id="5726195">{</span><span class="num" id="5726196">2</span><span class="op" id="5726197">,</span>&nbsp;<span class="num" id="5726199">4</span><span class="op" id="5726200">,</span>&nbsp;<span class="num" id="5726202">8</span><span class="op" id="5726203">,</span>&nbsp;<span class="num" id="5726205">16</span><span class="op" id="5726207">,</span>&nbsp;<span class="num" id="5726209">32</span><span class="op" id="5726211">,</span>&nbsp;<span class="num" id="5726213">64</span><span class="op" id="5726215">,</span>&nbsp;<span class="num" id="5726217">128</span><span class="op" id="5726220">,</span>&nbsp;<span class="num" id="5726222">256</span><span class="op" id="5726225">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5726228">func</span>&nbsp;<span class="ident" id="5726233">log2</span><span class="op" id="5726237">(</span><span class="ident" id="5726238">x</span>&nbsp;<span class="builtintype" id="5726240">int</span><span class="op" id="5726243">)</span>&nbsp;<span class="builtintype" id="5726245">int</span>&nbsp;<span class="op" id="5726249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5726252">for</span>&nbsp;<span class="ident" id="5726256">i</span><span class="op" id="5726257">,</span>&nbsp;<span class="ident" id="5726259">v</span>&nbsp;<span class="op" id="5726261">:=</span>&nbsp;<span class="keyword" id="5726264">range</span>&nbsp;<span class="ident" id="5726270"><a href="/gostd/image/gif/writer.go.html#5726176">log2Lookup</a></span>&nbsp;<span class="op" id="5726281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5726285">if</span>&nbsp;<span class="ident" id="5726288"><a href="/gostd/image/gif/writer.go.html#5726238">x</a></span>&nbsp;<span class="op" id="5726290">&lt;=</span>&nbsp;<span class="ident" id="5726293"><a href="/gostd/image/gif/writer.go.html#5726259">v</a></span>&nbsp;<span class="op" id="5726295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5726300">return</span>&nbsp;<span class="ident" id="5726307"><a href="/gostd/image/gif/writer.go.html#5726256">i</a></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5726311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5726314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5726317">return</span>&nbsp;<span class="op" id="5726324">-</span><span class="num" id="5726325">1</span><br>
<span class="lineno"></span><span class="op" id="5726327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5726330">//&nbsp;Little-endian.</span><br>
<span class="lineno"></span><span class="keyword" id="5726348">func</span>&nbsp;<span class="ident" id="5726353">writeUint16</span><span class="op" id="5726364">(</span><span class="ident" id="5726365">b</span>&nbsp;<span class="op" id="5726367">[</span><span class="op" id="5726368">]</span><span class="builtintype" id="5726369">uint8</span><span class="op" id="5726374">,</span>&nbsp;<span class="ident" id="5726376">u</span>&nbsp;<span class="builtintype" id="5726378">uint16</span><span class="op" id="5726384">)</span>&nbsp;<span class="op" id="5726386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5726389"><a href="/gostd/image/gif/writer.go.html#5726365">b</a></span><span class="op" id="5726390">[</span><span class="num" id="5726391">0</span><span class="op" id="5726392">]</span>&nbsp;<span class="op" id="5726394">=</span>&nbsp;<span class="builtintype" id="5726396">uint8</span><span class="op" id="5726401">(</span><span class="ident" id="5726402"><a href="/gostd/image/gif/writer.go.html#5726376">u</a></span><span class="op" id="5726403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5726406"><a href="/gostd/image/gif/writer.go.html#5726365">b</a></span><span class="op" id="5726407">[</span><span class="num" id="5726408">1</span><span class="op" id="5726409">]</span>&nbsp;<span class="op" id="5726411">=</span>&nbsp;<span class="builtintype" id="5726413">uint8</span><span class="op" id="5726418">(</span><span class="ident" id="5726419"><a href="/gostd/image/gif/writer.go.html#5726376">u</a></span>&nbsp;<span class="op" id="5726421">&gt;&gt;</span>&nbsp;<span class="num" id="5726424">8</span><span class="op" id="5726425">)</span><br>
<span class="lineno"></span><span class="op" id="5726427">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5726430">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5726462">type</span>&nbsp;<span class="ident" id="5726467">writer</span>&nbsp;<span class="keyword" id="5726474">interface</span>&nbsp;<span class="op" id="5726484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5726487">Flush</span><span class="op" id="5726492">(</span><span class="op" id="5726493">)</span>&nbsp;<span class="builtintype" id="5726495">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5726502"><a href="/gostd/image/gif/writer.go.html#5726076">io</a></span><span class="op" id="5726504">.</span><span class="ident" id="5726505"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5726513"><a href="/gostd/image/gif/writer.go.html#5726076">io</a></span><span class="op" id="5726515">.</span><span class="ident" id="5726516"><a href="/gostd/io/io.go.html#1427455">ByteWriter</a></span><br>
<span class="lineno"></span><span class="op" id="5726527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5726530">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5726577">type</span>&nbsp;<span class="ident" id="5726582">encoder</span>&nbsp;<span class="keyword" id="5726590">struct</span>&nbsp;<span class="op" id="5726597">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5726600">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5726675">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5726746">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5726750"><a href="/gostd/image/gif/writer.go.html#5726467">writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5726758">err</span>&nbsp;<span class="builtintype" id="5726762">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5726769">//&nbsp;g&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;data&nbsp;that&nbsp;is&nbsp;being&nbsp;encoded.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5726825">g</span>&nbsp;<span class="op" id="5726827">*</span><span class="ident" id="5726828"><a href="/gostd/image/gif/reader.go.html#5724800">GIF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5726833">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.&nbsp;It&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;write&nbsp;the&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5726917">buf</span>&nbsp;<span class="op" id="5726921">[</span><span class="num" id="5726922">1024</span><span class="op" id="5726926">]</span><span class="builtintype" id="5726927">byte</span><br>
<span class="lineno"></span><span class="op" id="5726932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5726935">//&nbsp;blockWriter&nbsp;writes&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5727002">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5727068">//&nbsp;writer&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;encoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5727132">//&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="5727145">type</span>&nbsp;<span class="ident" id="5727150">blockWriter</span>&nbsp;<span class="keyword" id="5727162">struct</span>&nbsp;<span class="op" id="5727169">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727172">e</span>&nbsp;<span class="op" id="5727174">*</span><span class="ident" id="5727175"><a href="/gostd/image/gif/writer.go.html#5726582">encoder</a></span><br>
<span class="lineno"></span><span class="op" id="5727183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5727186">func</span>&nbsp;<span class="op" id="5727191">(</span><span class="ident" id="5727192">b</span>&nbsp;<span class="ident" id="5727194"><a href="/gostd/image/gif/writer.go.html#5727150">blockWriter</a></span><span class="op" id="5727205">)</span>&nbsp;<span class="ident" id="5727207">Write</span><span class="op" id="5727212">(</span><span class="ident" id="5727213">data</span>&nbsp;<span class="op" id="5727218">[</span><span class="op" id="5727219">]</span><span class="builtintype" id="5727220">byte</span><span class="op" id="5727224">)</span>&nbsp;<span class="op" id="5727226">(</span><span class="builtintype" id="5727227">int</span><span class="op" id="5727230">,</span>&nbsp;<span class="builtintype" id="5727232">error</span><span class="op" id="5727237">)</span>&nbsp;<span class="op" id="5727239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727242">if</span>&nbsp;<span class="ident" id="5727245"><a href="/gostd/image/gif/writer.go.html#5727192">b</a></span><span class="op" id="5727246">.</span><span class="ident" id="5727247"><a href="/gostd/image/gif/writer.go.html#5727172">e</a></span><span class="op" id="5727248">.</span><span class="ident" id="5727249"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5727253">!=</span>&nbsp;<span class="builtintype" id="5727256">nil</span>&nbsp;<span class="op" id="5727260">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727264">return</span>&nbsp;<span class="num" id="5727271">0</span><span class="op" id="5727272">,</span>&nbsp;<span class="ident" id="5727274"><a href="/gostd/image/gif/writer.go.html#5727192">b</a></span><span class="op" id="5727275">.</span><span class="ident" id="5727276"><a href="/gostd/image/gif/writer.go.html#5727172">e</a></span><span class="op" id="5727277">.</span><span class="ident" id="5727278"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5727283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727286">if</span>&nbsp;<span class="builtinfunc" id="5727289">len</span><span class="op" id="5727292">(</span><span class="ident" id="5727293"><a href="/gostd/image/gif/writer.go.html#5727213">data</a></span><span class="op" id="5727297">)</span>&nbsp;<span class="op" id="5727299">==</span>&nbsp;<span class="num" id="5727302">0</span>&nbsp;<span class="op" id="5727304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727308">return</span>&nbsp;<span class="num" id="5727315">0</span><span class="op" id="5727316">,</span>&nbsp;<span class="builtintype" id="5727318">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5727323">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727326">total</span>&nbsp;<span class="op" id="5727332">:=</span>&nbsp;<span class="num" id="5727335">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727338">for</span>&nbsp;<span class="ident" id="5727342"><a href="/gostd/image/gif/writer.go.html#5727326">total</a></span>&nbsp;<span class="op" id="5727348">&lt;</span>&nbsp;<span class="builtinfunc" id="5727350">len</span><span class="op" id="5727353">(</span><span class="ident" id="5727354"><a href="/gostd/image/gif/writer.go.html#5727213">data</a></span><span class="op" id="5727358">)</span>&nbsp;<span class="op" id="5727360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727364">n</span>&nbsp;<span class="op" id="5727366">:=</span>&nbsp;<span class="builtinfunc" id="5727369">copy</span><span class="op" id="5727373">(</span><span class="ident" id="5727374"><a href="/gostd/image/gif/writer.go.html#5727192">b</a></span><span class="op" id="5727375">.</span><span class="ident" id="5727376"><a href="/gostd/image/gif/writer.go.html#5727172">e</a></span><span class="op" id="5727377">.</span><span class="ident" id="5727378"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5727381">[</span><span class="num" id="5727382">1</span><span class="op" id="5727383">:</span><span class="num" id="5727384">256</span><span class="op" id="5727387">]</span><span class="op" id="5727388">,</span>&nbsp;<span class="ident" id="5727390"><a href="/gostd/image/gif/writer.go.html#5727213">data</a></span><span class="op" id="5727394">[</span><span class="ident" id="5727395"><a href="/gostd/image/gif/writer.go.html#5727326">total</a></span><span class="op" id="5727400">:</span><span class="op" id="5727401">]</span><span class="op" id="5727402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727406"><a href="/gostd/image/gif/writer.go.html#5727326">total</a></span>&nbsp;<span class="op" id="5727412">+=</span>&nbsp;<span class="ident" id="5727415"><a href="/gostd/image/gif/writer.go.html#5727364">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727419"><a href="/gostd/image/gif/writer.go.html#5727192">b</a></span><span class="op" id="5727420">.</span><span class="ident" id="5727421"><a href="/gostd/image/gif/writer.go.html#5727172">e</a></span><span class="op" id="5727422">.</span><span class="ident" id="5727423"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5727426">[</span><span class="num" id="5727427">0</span><span class="op" id="5727428">]</span>&nbsp;<span class="op" id="5727430">=</span>&nbsp;<span class="builtintype" id="5727432">uint8</span><span class="op" id="5727437">(</span><span class="ident" id="5727438"><a href="/gostd/image/gif/writer.go.html#5727364">n</a></span><span class="op" id="5727439">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727444"><a href="/gostd/image/gif/writer.go.html#5727364">n</a></span><span class="op" id="5727445">,</span>&nbsp;<span class="ident" id="5727447"><a href="/gostd/image/gif/writer.go.html#5727192">b</a></span><span class="op" id="5727448">.</span><span class="ident" id="5727449"><a href="/gostd/image/gif/writer.go.html#5727172">e</a></span><span class="op" id="5727450">.</span><span class="ident" id="5727451"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5727455">=</span>&nbsp;<span class="ident" id="5727457"><a href="/gostd/image/gif/writer.go.html#5727192">b</a></span><span class="op" id="5727458">.</span><span class="ident" id="5727459"><a href="/gostd/image/gif/writer.go.html#5727172">e</a></span><span class="op" id="5727460">.</span><span class="ident" id="5727461"><a href="/gostd/image/gif/writer.go.html#5726746">w</a></span><span class="op" id="5727462">.</span><span class="ident" id="5727463"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="5727468">(</span><span class="ident" id="5727469"><a href="/gostd/image/gif/writer.go.html#5727192">b</a></span><span class="op" id="5727470">.</span><span class="ident" id="5727471"><a href="/gostd/image/gif/writer.go.html#5727172">e</a></span><span class="op" id="5727472">.</span><span class="ident" id="5727473"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5727476">[</span><span class="op" id="5727477">:</span><span class="ident" id="5727478"><a href="/gostd/image/gif/writer.go.html#5727364">n</a></span><span class="op" id="5727479">+</span><span class="num" id="5727480">1</span><span class="op" id="5727481">]</span><span class="op" id="5727482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727486">if</span>&nbsp;<span class="ident" id="5727489"><a href="/gostd/image/gif/writer.go.html#5727192">b</a></span><span class="op" id="5727490">.</span><span class="ident" id="5727491"><a href="/gostd/image/gif/writer.go.html#5727172">e</a></span><span class="op" id="5727492">.</span><span class="ident" id="5727493"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5727497">!=</span>&nbsp;<span class="builtintype" id="5727500">nil</span>&nbsp;<span class="op" id="5727504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727509">return</span>&nbsp;<span class="num" id="5727516">0</span><span class="op" id="5727517">,</span>&nbsp;<span class="ident" id="5727519"><a href="/gostd/image/gif/writer.go.html#5727192">b</a></span><span class="op" id="5727520">.</span><span class="ident" id="5727521"><a href="/gostd/image/gif/writer.go.html#5727172">e</a></span><span class="op" id="5727522">.</span><span class="ident" id="5727523"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5727529">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5727532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727535">return</span>&nbsp;<span class="ident" id="5727542"><a href="/gostd/image/gif/writer.go.html#5727326">total</a></span><span class="op" id="5727547">,</span>&nbsp;<span class="ident" id="5727549"><a href="/gostd/image/gif/writer.go.html#5727192">b</a></span><span class="op" id="5727550">.</span><span class="ident" id="5727551"><a href="/gostd/image/gif/writer.go.html#5727172">e</a></span><span class="op" id="5727552">.</span><span class="ident" id="5727553"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span><br>
<span class="lineno"></span><span class="op" id="5727557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5727560">func</span>&nbsp;<span class="op" id="5727565">(</span><span class="ident" id="5727566">e</span>&nbsp;<span class="op" id="5727568">*</span><span class="ident" id="5727569"><a href="/gostd/image/gif/writer.go.html#5726582">encoder</a></span><span class="op" id="5727576">)</span>&nbsp;<span class="ident" id="5727578">flush</span><span class="op" id="5727583">(</span><span class="op" id="5727584">)</span>&nbsp;<span class="op" id="5727586">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727589">if</span>&nbsp;<span class="ident" id="5727592"><a href="/gostd/image/gif/writer.go.html#5727566">e</a></span><span class="op" id="5727593">.</span><span class="ident" id="5727594"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5727598">!=</span>&nbsp;<span class="builtintype" id="5727601">nil</span>&nbsp;<span class="op" id="5727605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727609">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5727617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727620"><a href="/gostd/image/gif/writer.go.html#5727566">e</a></span><span class="op" id="5727621">.</span><span class="ident" id="5727622"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5727626">=</span>&nbsp;<span class="ident" id="5727628"><a href="/gostd/image/gif/writer.go.html#5727566">e</a></span><span class="op" id="5727629">.</span><span class="ident" id="5727630"><a href="/gostd/image/gif/writer.go.html#5726746">w</a></span><span class="op" id="5727631">.</span><span class="ident" id="5727632"><a href="/gostd/image/gif/writer.go.html#5726487">Flush</a></span><span class="op" id="5727637">(</span><span class="op" id="5727638">)</span><br>
<span class="lineno"></span><span class="op" id="5727640">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="5727643">func</span>&nbsp;<span class="op" id="5727648">(</span><span class="ident" id="5727649">e</span>&nbsp;<span class="op" id="5727651">*</span><span class="ident" id="5727652"><a href="/gostd/image/gif/writer.go.html#5726582">encoder</a></span><span class="op" id="5727659">)</span>&nbsp;<span class="ident" id="5727661">write</span><span class="op" id="5727666">(</span><span class="ident" id="5727667">p</span>&nbsp;<span class="op" id="5727669">[</span><span class="op" id="5727670">]</span><span class="builtintype" id="5727671">byte</span><span class="op" id="5727675">)</span>&nbsp;<span class="op" id="5727677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727680">if</span>&nbsp;<span class="ident" id="5727683"><a href="/gostd/image/gif/writer.go.html#5727649">e</a></span><span class="op" id="5727684">.</span><span class="ident" id="5727685"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5727689">!=</span>&nbsp;<span class="builtintype" id="5727692">nil</span>&nbsp;<span class="op" id="5727696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727700">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5727708">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727711">_</span><span class="op" id="5727712">,</span>&nbsp;<span class="ident" id="5727714"><a href="/gostd/image/gif/writer.go.html#5727649">e</a></span><span class="op" id="5727715">.</span><span class="ident" id="5727716"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5727720">=</span>&nbsp;<span class="ident" id="5727722"><a href="/gostd/image/gif/writer.go.html#5727649">e</a></span><span class="op" id="5727723">.</span><span class="ident" id="5727724"><a href="/gostd/image/gif/writer.go.html#5726746">w</a></span><span class="op" id="5727725">.</span><span class="ident" id="5727726"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="5727731">(</span><span class="ident" id="5727732"><a href="/gostd/image/gif/writer.go.html#5727667">p</a></span><span class="op" id="5727733">)</span><br>
<span class="lineno"></span><span class="op" id="5727735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5727738">func</span>&nbsp;<span class="op" id="5727743">(</span><span class="ident" id="5727744">e</span>&nbsp;<span class="op" id="5727746">*</span><span class="ident" id="5727747"><a href="/gostd/image/gif/writer.go.html#5726582">encoder</a></span><span class="op" id="5727754">)</span>&nbsp;<span class="ident" id="5727756">writeByte</span><span class="op" id="5727765">(</span><span class="ident" id="5727766">b</span>&nbsp;<span class="builtintype" id="5727768">byte</span><span class="op" id="5727772">)</span>&nbsp;<span class="op" id="5727774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727777">if</span>&nbsp;<span class="ident" id="5727780"><a href="/gostd/image/gif/writer.go.html#5727744">e</a></span><span class="op" id="5727781">.</span><span class="ident" id="5727782"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5727786">!=</span>&nbsp;<span class="builtintype" id="5727789">nil</span>&nbsp;<span class="op" id="5727793">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727797">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5727805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727808"><a href="/gostd/image/gif/writer.go.html#5727744">e</a></span><span class="op" id="5727809">.</span><span class="ident" id="5727810"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5727814">=</span>&nbsp;<span class="ident" id="5727816"><a href="/gostd/image/gif/writer.go.html#5727744">e</a></span><span class="op" id="5727817">.</span><span class="ident" id="5727818"><a href="/gostd/image/gif/writer.go.html#5726746">w</a></span><span class="op" id="5727819">.</span><span class="ident" id="5727820"><a href="/gostd/io/io.go.html#1427479">WriteByte</a></span><span class="op" id="5727829">(</span><span class="ident" id="5727830"><a href="/gostd/image/gif/writer.go.html#5727766">b</a></span><span class="op" id="5727831">)</span><br>
<span class="lineno"></span><span class="op" id="5727833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="5727836">func</span>&nbsp;<span class="op" id="5727841">(</span><span class="ident" id="5727842">e</span>&nbsp;<span class="op" id="5727844">*</span><span class="ident" id="5727845"><a href="/gostd/image/gif/writer.go.html#5726582">encoder</a></span><span class="op" id="5727852">)</span>&nbsp;<span class="ident" id="5727854">writeHeader</span><span class="op" id="5727865">(</span><span class="op" id="5727866">)</span>&nbsp;<span class="op" id="5727868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727871">if</span>&nbsp;<span class="ident" id="5727874"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5727875">.</span><span class="ident" id="5727876"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5727880">!=</span>&nbsp;<span class="builtintype" id="5727883">nil</span>&nbsp;<span class="op" id="5727887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727891">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5727899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727902">_</span><span class="op" id="5727903">,</span>&nbsp;<span class="ident" id="5727905"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5727906">.</span><span class="ident" id="5727907"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5727911">=</span>&nbsp;<span class="ident" id="5727913"><a href="/gostd/image/gif/writer.go.html#5726076">io</a></span><span class="op" id="5727915">.</span><span class="ident" id="5727916"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="5727927">(</span><span class="ident" id="5727928"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5727929">.</span><span class="ident" id="5727930"><a href="/gostd/image/gif/writer.go.html#5726746">w</a></span><span class="op" id="5727931">,</span>&nbsp;<span class="string" id="5727933">&#34;GIF89a&#34;</span><span class="op" id="5727941">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727944">if</span>&nbsp;<span class="ident" id="5727947"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5727948">.</span><span class="ident" id="5727949"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5727953">!=</span>&nbsp;<span class="builtintype" id="5727956">nil</span>&nbsp;<span class="op" id="5727960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5727964">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5727972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727976">pm</span>&nbsp;<span class="op" id="5727979">:=</span>&nbsp;<span class="ident" id="5727982"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5727983">.</span><span class="ident" id="5727984"><a href="/gostd/image/gif/writer.go.html#5726825">g</a></span><span class="op" id="5727985">.</span><span class="ident" id="5727986"><a href="/gostd/image/gif/reader.go.html#5724814">Image</a></span><span class="op" id="5727991">[</span><span class="num" id="5727992">0</span><span class="op" id="5727993">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5727996">//&nbsp;Logical&nbsp;screen&nbsp;width&nbsp;and&nbsp;height.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728033"><a href="/gostd/image/gif/writer.go.html#5726353">writeUint16</a></span><span class="op" id="5728044">(</span><span class="ident" id="5728045"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728046">.</span><span class="ident" id="5728047"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728050">[</span><span class="num" id="5728051">0</span><span class="op" id="5728052">:</span><span class="num" id="5728053">2</span><span class="op" id="5728054">]</span><span class="op" id="5728055">,</span>&nbsp;<span class="builtintype" id="5728057">uint16</span><span class="op" id="5728063">(</span><span class="ident" id="5728064"><a href="/gostd/image/gif/writer.go.html#5727976">pm</a></span><span class="op" id="5728066">.</span><span class="ident" id="5728067"><a href="/gostd/image/image.go.html#5176884">Bounds</a></span><span class="op" id="5728073">(</span><span class="op" id="5728074">)</span><span class="op" id="5728075">.</span><span class="ident" id="5728076"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="5728078">(</span><span class="op" id="5728079">)</span><span class="op" id="5728080">)</span><span class="op" id="5728081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728084"><a href="/gostd/image/gif/writer.go.html#5726353">writeUint16</a></span><span class="op" id="5728095">(</span><span class="ident" id="5728096"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728097">.</span><span class="ident" id="5728098"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728101">[</span><span class="num" id="5728102">2</span><span class="op" id="5728103">:</span><span class="num" id="5728104">4</span><span class="op" id="5728105">]</span><span class="op" id="5728106">,</span>&nbsp;<span class="builtintype" id="5728108">uint16</span><span class="op" id="5728114">(</span><span class="ident" id="5728115"><a href="/gostd/image/gif/writer.go.html#5727976">pm</a></span><span class="op" id="5728117">.</span><span class="ident" id="5728118"><a href="/gostd/image/image.go.html#5176884">Bounds</a></span><span class="op" id="5728124">(</span><span class="op" id="5728125">)</span><span class="op" id="5728126">.</span><span class="ident" id="5728127"><a href="/gostd/image/geom.go.html#5150316">Dy</a></span><span class="op" id="5728129">(</span><span class="op" id="5728130">)</span><span class="op" id="5728131">)</span><span class="op" id="5728132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728135"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728136">.</span><span class="ident" id="5728137"><a href="/gostd/image/gif/writer.go.html#5727661">write</a></span><span class="op" id="5728142">(</span><span class="ident" id="5728143"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728144">.</span><span class="ident" id="5728145"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728148">[</span><span class="op" id="5728149">:</span><span class="num" id="5728150">4</span><span class="op" id="5728151">]</span><span class="op" id="5728152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5728156">//&nbsp;All&nbsp;frames&nbsp;have&nbsp;a&nbsp;local&nbsp;color&nbsp;table,&nbsp;so&nbsp;a&nbsp;global&nbsp;color&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5728221">//&nbsp;is&nbsp;not&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728240"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728241">.</span><span class="ident" id="5728242"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728245">[</span><span class="num" id="5728246">0</span><span class="op" id="5728247">]</span>&nbsp;<span class="op" id="5728249">=</span>&nbsp;<span class="num" id="5728251">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728257"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728258">.</span><span class="ident" id="5728259"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728262">[</span><span class="num" id="5728263">1</span><span class="op" id="5728264">]</span>&nbsp;<span class="op" id="5728266">=</span>&nbsp;<span class="num" id="5728268">0x00</span>&nbsp;<span class="comment" id="5728273">//&nbsp;Background&nbsp;Color&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728301"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728302">.</span><span class="ident" id="5728303"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728306">[</span><span class="num" id="5728307">2</span><span class="op" id="5728308">]</span>&nbsp;<span class="op" id="5728310">=</span>&nbsp;<span class="num" id="5728312">0x00</span>&nbsp;<span class="comment" id="5728317">//&nbsp;Pixel&nbsp;Aspect&nbsp;Ratio.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728341"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728342">.</span><span class="ident" id="5728343"><a href="/gostd/image/gif/writer.go.html#5727661">write</a></span><span class="op" id="5728348">(</span><span class="ident" id="5728349"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728350">.</span><span class="ident" id="5728351"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728354">[</span><span class="op" id="5728355">:</span><span class="num" id="5728356">3</span><span class="op" id="5728357">]</span><span class="op" id="5728358">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5728362">//&nbsp;Add&nbsp;animation&nbsp;info&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5728399">if</span>&nbsp;<span class="builtinfunc" id="5728402">len</span><span class="op" id="5728405">(</span><span class="ident" id="5728406"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728407">.</span><span class="ident" id="5728408"><a href="/gostd/image/gif/writer.go.html#5726825">g</a></span><span class="op" id="5728409">.</span><span class="ident" id="5728410"><a href="/gostd/image/gif/reader.go.html#5724814">Image</a></span><span class="op" id="5728415">)</span>&nbsp;<span class="op" id="5728417">&gt;</span>&nbsp;<span class="num" id="5728419">1</span>&nbsp;<span class="op" id="5728421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728425"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728426">.</span><span class="ident" id="5728427"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728430">[</span><span class="num" id="5728431">0</span><span class="op" id="5728432">]</span>&nbsp;<span class="op" id="5728434">=</span>&nbsp;<span class="num" id="5728436">0x21</span>&nbsp;<span class="comment" id="5728441">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728468"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728469">.</span><span class="ident" id="5728470"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728473">[</span><span class="num" id="5728474">1</span><span class="op" id="5728475">]</span>&nbsp;<span class="op" id="5728477">=</span>&nbsp;<span class="num" id="5728479">0xff</span>&nbsp;<span class="comment" id="5728484">//&nbsp;Application&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728508"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728509">.</span><span class="ident" id="5728510"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728513">[</span><span class="num" id="5728514">2</span><span class="op" id="5728515">]</span>&nbsp;<span class="op" id="5728517">=</span>&nbsp;<span class="num" id="5728519">0x0b</span>&nbsp;<span class="comment" id="5728524">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728541"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728542">.</span><span class="ident" id="5728543"><a href="/gostd/image/gif/writer.go.html#5727661">write</a></span><span class="op" id="5728548">(</span><span class="ident" id="5728549"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728550">.</span><span class="ident" id="5728551"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728554">[</span><span class="op" id="5728555">:</span><span class="num" id="5728556">3</span><span class="op" id="5728557">]</span><span class="op" id="5728558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728562">_</span><span class="op" id="5728563">,</span>&nbsp;<span class="ident" id="5728565"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728566">.</span><span class="ident" id="5728567"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5728571">=</span>&nbsp;<span class="ident" id="5728573"><a href="/gostd/image/gif/writer.go.html#5726076">io</a></span><span class="op" id="5728575">.</span><span class="ident" id="5728576"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="5728587">(</span><span class="ident" id="5728588"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728589">.</span><span class="ident" id="5728590"><a href="/gostd/image/gif/writer.go.html#5726746">w</a></span><span class="op" id="5728591">,</span>&nbsp;<span class="string" id="5728593">&#34;NETSCAPE2.0&#34;</span><span class="op" id="5728606">)</span>&nbsp;<span class="comment" id="5728608">//&nbsp;Application&nbsp;Identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5728637">if</span>&nbsp;<span class="ident" id="5728640"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728641">.</span><span class="ident" id="5728642"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5728646">!=</span>&nbsp;<span class="builtintype" id="5728649">nil</span>&nbsp;<span class="op" id="5728653">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5728658">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5728667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728671"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728672">.</span><span class="ident" id="5728673"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728676">[</span><span class="num" id="5728677">0</span><span class="op" id="5728678">]</span>&nbsp;<span class="op" id="5728680">=</span>&nbsp;<span class="num" id="5728682">0x03</span>&nbsp;<span class="comment" id="5728687">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728704"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728705">.</span><span class="ident" id="5728706"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728709">[</span><span class="num" id="5728710">1</span><span class="op" id="5728711">]</span>&nbsp;<span class="op" id="5728713">=</span>&nbsp;<span class="num" id="5728715">0x01</span>&nbsp;<span class="comment" id="5728720">//&nbsp;Sub-block&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728742"><a href="/gostd/image/gif/writer.go.html#5726353">writeUint16</a></span><span class="op" id="5728753">(</span><span class="ident" id="5728754"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728755">.</span><span class="ident" id="5728756"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728759">[</span><span class="num" id="5728760">2</span><span class="op" id="5728761">:</span><span class="num" id="5728762">4</span><span class="op" id="5728763">]</span><span class="op" id="5728764">,</span>&nbsp;<span class="builtintype" id="5728766">uint16</span><span class="op" id="5728772">(</span><span class="ident" id="5728773"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728774">.</span><span class="ident" id="5728775"><a href="/gostd/image/gif/writer.go.html#5726825">g</a></span><span class="op" id="5728776">.</span><span class="ident" id="5728777"><a href="/gostd/image/gif/reader.go.html#5724967">LoopCount</a></span><span class="op" id="5728786">)</span><span class="op" id="5728787">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728791"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728792">.</span><span class="ident" id="5728793"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728796">[</span><span class="num" id="5728797">4</span><span class="op" id="5728798">]</span>&nbsp;<span class="op" id="5728800">=</span>&nbsp;<span class="num" id="5728802">0x00</span>&nbsp;<span class="comment" id="5728807">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728830"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728831">.</span><span class="ident" id="5728832"><a href="/gostd/image/gif/writer.go.html#5727661">write</a></span><span class="op" id="5728837">(</span><span class="ident" id="5728838"><a href="/gostd/image/gif/writer.go.html#5727842">e</a></span><span class="op" id="5728839">.</span><span class="ident" id="5728840"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5728843">[</span><span class="op" id="5728844">:</span><span class="num" id="5728845">5</span><span class="op" id="5728846">]</span><span class="op" id="5728847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5728850">}</span><br>
<span class="lineno"></span><span class="op" id="5728852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="5728855">func</span>&nbsp;<span class="op" id="5728860">(</span><span class="ident" id="5728861">e</span>&nbsp;<span class="op" id="5728863">*</span><span class="ident" id="5728864"><a href="/gostd/image/gif/writer.go.html#5726582">encoder</a></span><span class="op" id="5728871">)</span>&nbsp;<span class="ident" id="5728873">writeColorTable</span><span class="op" id="5728888">(</span><span class="ident" id="5728889">p</span>&nbsp;<span class="ident" id="5728891"><a href="/gostd/image/gif/writer.go.html#5726024">color</a></span><span class="op" id="5728896">.</span><span class="ident" id="5728897"><a href="/gostd/image/color/color.go.html#5190467">Palette</a></span><span class="op" id="5728904">,</span>&nbsp;<span class="ident" id="5728906">size</span>&nbsp;<span class="builtintype" id="5728911">int</span><span class="op" id="5728914">)</span>&nbsp;<span class="op" id="5728916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5728919">if</span>&nbsp;<span class="ident" id="5728922"><a href="/gostd/image/gif/writer.go.html#5728861">e</a></span><span class="op" id="5728923">.</span><span class="ident" id="5728924"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5728928">!=</span>&nbsp;<span class="builtintype" id="5728931">nil</span>&nbsp;<span class="op" id="5728935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5728939">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5728947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5728951">for</span>&nbsp;<span class="ident" id="5728955">i</span>&nbsp;<span class="op" id="5728957">:=</span>&nbsp;<span class="num" id="5728960">0</span><span class="op" id="5728961">;</span>&nbsp;<span class="ident" id="5728963"><a href="/gostd/image/gif/writer.go.html#5728955">i</a></span>&nbsp;<span class="op" id="5728965">&lt;</span>&nbsp;<span class="ident" id="5728967"><a href="/gostd/image/gif/writer.go.html#5726176">log2Lookup</a></span><span class="op" id="5728977">[</span><span class="ident" id="5728978"><a href="/gostd/image/gif/writer.go.html#5728906">size</a></span><span class="op" id="5728982">]</span><span class="op" id="5728983">;</span>&nbsp;<span class="ident" id="5728985"><a href="/gostd/image/gif/writer.go.html#5728955">i</a></span><span class="op" id="5728986">++</span>&nbsp;<span class="op" id="5728989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5728993">if</span>&nbsp;<span class="ident" id="5728996"><a href="/gostd/image/gif/writer.go.html#5728955">i</a></span>&nbsp;<span class="op" id="5728998">&lt;</span>&nbsp;<span class="builtinfunc" id="5729000">len</span><span class="op" id="5729003">(</span><span class="ident" id="5729004"><a href="/gostd/image/gif/writer.go.html#5728889">p</a></span><span class="op" id="5729005">)</span>&nbsp;<span class="op" id="5729007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729012">r</span><span class="op" id="5729013">,</span>&nbsp;<span class="ident" id="5729015">g</span><span class="op" id="5729016">,</span>&nbsp;<span class="ident" id="5729018">b</span><span class="op" id="5729019">,</span>&nbsp;<span class="ident" id="5729021">_</span>&nbsp;<span class="op" id="5729023">:=</span>&nbsp;<span class="ident" id="5729026"><a href="/gostd/image/gif/writer.go.html#5728889">p</a></span><span class="op" id="5729027">[</span><span class="ident" id="5729028"><a href="/gostd/image/gif/writer.go.html#5728955">i</a></span><span class="op" id="5729029">]</span><span class="op" id="5729030">.</span><span class="ident" id="5729031"><a href="/gostd/image/color/color.go.html#5185453">RGBA</a></span><span class="op" id="5729035">(</span><span class="op" id="5729036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729041"><a href="/gostd/image/gif/writer.go.html#5728861">e</a></span><span class="op" id="5729042">.</span><span class="ident" id="5729043"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5729046">[</span><span class="num" id="5729047">3</span><span class="op" id="5729048">*</span><span class="ident" id="5729049"><a href="/gostd/image/gif/writer.go.html#5728955">i</a></span><span class="op" id="5729050">+</span><span class="num" id="5729051">0</span><span class="op" id="5729052">]</span>&nbsp;<span class="op" id="5729054">=</span>&nbsp;<span class="builtintype" id="5729056">uint8</span><span class="op" id="5729061">(</span><span class="ident" id="5729062"><a href="/gostd/image/gif/writer.go.html#5729012">r</a></span>&nbsp;<span class="op" id="5729064">&gt;&gt;</span>&nbsp;<span class="num" id="5729067">8</span><span class="op" id="5729068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729073"><a href="/gostd/image/gif/writer.go.html#5728861">e</a></span><span class="op" id="5729074">.</span><span class="ident" id="5729075"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5729078">[</span><span class="num" id="5729079">3</span><span class="op" id="5729080">*</span><span class="ident" id="5729081"><a href="/gostd/image/gif/writer.go.html#5728955">i</a></span><span class="op" id="5729082">+</span><span class="num" id="5729083">1</span><span class="op" id="5729084">]</span>&nbsp;<span class="op" id="5729086">=</span>&nbsp;<span class="builtintype" id="5729088">uint8</span><span class="op" id="5729093">(</span><span class="ident" id="5729094"><a href="/gostd/image/gif/writer.go.html#5729015">g</a></span>&nbsp;<span class="op" id="5729096">&gt;&gt;</span>&nbsp;<span class="num" id="5729099">8</span><span class="op" id="5729100">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729105"><a href="/gostd/image/gif/writer.go.html#5728861">e</a></span><span class="op" id="5729106">.</span><span class="ident" id="5729107"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5729110">[</span><span class="num" id="5729111">3</span><span class="op" id="5729112">*</span><span class="ident" id="5729113"><a href="/gostd/image/gif/writer.go.html#5728955">i</a></span><span class="op" id="5729114">+</span><span class="num" id="5729115">2</span><span class="op" id="5729116">]</span>&nbsp;<span class="op" id="5729118">=</span>&nbsp;<span class="builtintype" id="5729120">uint8</span><span class="op" id="5729125">(</span><span class="ident" id="5729126"><a href="/gostd/image/gif/writer.go.html#5729018">b</a></span>&nbsp;<span class="op" id="5729128">&gt;&gt;</span>&nbsp;<span class="num" id="5729131">8</span><span class="op" id="5729132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729136">}</span>&nbsp;<span class="keyword" id="5729138">else</span>&nbsp;<span class="op" id="5729143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5729148">//&nbsp;Pad&nbsp;with&nbsp;black.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729170"><a href="/gostd/image/gif/writer.go.html#5728861">e</a></span><span class="op" id="5729171">.</span><span class="ident" id="5729172"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5729175">[</span><span class="num" id="5729176">3</span><span class="op" id="5729177">*</span><span class="ident" id="5729178"><a href="/gostd/image/gif/writer.go.html#5728955">i</a></span><span class="op" id="5729179">+</span><span class="num" id="5729180">0</span><span class="op" id="5729181">]</span>&nbsp;<span class="op" id="5729183">=</span>&nbsp;<span class="num" id="5729185">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729193"><a href="/gostd/image/gif/writer.go.html#5728861">e</a></span><span class="op" id="5729194">.</span><span class="ident" id="5729195"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5729198">[</span><span class="num" id="5729199">3</span><span class="op" id="5729200">*</span><span class="ident" id="5729201"><a href="/gostd/image/gif/writer.go.html#5728955">i</a></span><span class="op" id="5729202">+</span><span class="num" id="5729203">1</span><span class="op" id="5729204">]</span>&nbsp;<span class="op" id="5729206">=</span>&nbsp;<span class="num" id="5729208">0x00</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729216"><a href="/gostd/image/gif/writer.go.html#5728861">e</a></span><span class="op" id="5729217">.</span><span class="ident" id="5729218"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5729221">[</span><span class="num" id="5729222">3</span><span class="op" id="5729223">*</span><span class="ident" id="5729224"><a href="/gostd/image/gif/writer.go.html#5728955">i</a></span><span class="op" id="5729225">+</span><span class="num" id="5729226">2</span><span class="op" id="5729227">]</span>&nbsp;<span class="op" id="5729229">=</span>&nbsp;<span class="num" id="5729231">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729244"><a href="/gostd/image/gif/writer.go.html#5728861">e</a></span><span class="op" id="5729245">.</span><span class="ident" id="5729246"><a href="/gostd/image/gif/writer.go.html#5727661">write</a></span><span class="op" id="5729251">(</span><span class="ident" id="5729252"><a href="/gostd/image/gif/writer.go.html#5728861">e</a></span><span class="op" id="5729253">.</span><span class="ident" id="5729254"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5729257">[</span><span class="op" id="5729258">:</span><span class="num" id="5729259">3</span><span class="op" id="5729260">*</span><span class="ident" id="5729261"><a href="/gostd/image/gif/writer.go.html#5726176">log2Lookup</a></span><span class="op" id="5729271">[</span><span class="ident" id="5729272"><a href="/gostd/image/gif/writer.go.html#5728906">size</a></span><span class="op" id="5729276">]</span><span class="op" id="5729277">]</span><span class="op" id="5729278">)</span><br>
<span class="lineno"></span><span class="op" id="5729280">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5729283">func</span>&nbsp;<span class="op" id="5729288">(</span><span class="ident" id="5729289">e</span>&nbsp;<span class="op" id="5729291">*</span><span class="ident" id="5729292"><a href="/gostd/image/gif/writer.go.html#5726582">encoder</a></span><span class="op" id="5729299">)</span>&nbsp;<span class="ident" id="5729301">writeImageBlock</span><span class="op" id="5729316">(</span><span class="ident" id="5729317">pm</span>&nbsp;<span class="op" id="5729320">*</span><span class="ident" id="5729321"><a href="/gostd/image/gif/writer.go.html#5726015">image</a></span><span class="op" id="5729326">.</span><span class="ident" id="5729327"><a href="/gostd/image/image.go.html#5176435">Paletted</a></span><span class="op" id="5729335">,</span>&nbsp;<span class="ident" id="5729337">delay</span>&nbsp;<span class="builtintype" id="5729343">int</span><span class="op" id="5729346">)</span>&nbsp;<span class="op" id="5729348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729351">if</span>&nbsp;<span class="ident" id="5729354"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5729355">.</span><span class="ident" id="5729356"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5729360">!=</span>&nbsp;<span class="builtintype" id="5729363">nil</span>&nbsp;<span class="op" id="5729367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729371">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729379">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729383">if</span>&nbsp;<span class="builtinfunc" id="5729386">len</span><span class="op" id="5729389">(</span><span class="ident" id="5729390"><a href="/gostd/image/gif/writer.go.html#5729317">pm</a></span><span class="op" id="5729392">.</span><span class="ident" id="5729393"><a href="/gostd/image/image.go.html#5176774">Palette</a></span><span class="op" id="5729400">)</span>&nbsp;<span class="op" id="5729402">==</span>&nbsp;<span class="num" id="5729405">0</span>&nbsp;<span class="op" id="5729407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729411"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5729412">.</span><span class="ident" id="5729413"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5729417">=</span>&nbsp;<span class="ident" id="5729419"><a href="/gostd/image/gif/writer.go.html#5726005">errors</a></span><span class="op" id="5729425">.</span><span class="ident" id="5729426"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5729429">(</span><span class="string" id="5729430">&#34;gif:&nbsp;cannot&nbsp;encode&nbsp;image&nbsp;block&nbsp;with&nbsp;empty&nbsp;palette&#34;</span><span class="op" id="5729481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729485">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729493">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729497">b</span>&nbsp;<span class="op" id="5729499">:=</span>&nbsp;<span class="ident" id="5729502"><a href="/gostd/image/gif/writer.go.html#5729317">pm</a></span><span class="op" id="5729504">.</span><span class="ident" id="5729505"><a href="/gostd/image/image.go.html#5176884">Bounds</a></span><span class="op" id="5729511">(</span><span class="op" id="5729512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729515">if</span>&nbsp;<span class="ident" id="5729518"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5729519">.</span><span class="ident" id="5729520"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="5729522">(</span><span class="op" id="5729523">)</span>&nbsp;<span class="op" id="5729525">&gt;=</span>&nbsp;<span class="num" id="5729528">1</span><span class="op" id="5729529">&lt;&lt;</span><span class="num" id="5729531">16</span>&nbsp;<span class="op" id="5729534">||</span>&nbsp;<span class="ident" id="5729537"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5729538">.</span><span class="ident" id="5729539"><a href="/gostd/image/geom.go.html#5150316">Dy</a></span><span class="op" id="5729541">(</span><span class="op" id="5729542">)</span>&nbsp;<span class="op" id="5729544">&gt;=</span>&nbsp;<span class="num" id="5729547">1</span><span class="op" id="5729548">&lt;&lt;</span><span class="num" id="5729550">16</span>&nbsp;<span class="op" id="5729553">||</span>&nbsp;<span class="ident" id="5729556"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5729557">.</span><span class="ident" id="5729558"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="5729561">.</span><span class="ident" id="5729562"><a href="/gostd/image/geom.go.html#5148451">X</a></span>&nbsp;<span class="op" id="5729564">&lt;</span>&nbsp;<span class="num" id="5729566">0</span>&nbsp;<span class="op" id="5729568">||</span>&nbsp;<span class="ident" id="5729571"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5729572">.</span><span class="ident" id="5729573"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="5729576">.</span><span class="ident" id="5729577"><a href="/gostd/image/geom.go.html#5148451">X</a></span>&nbsp;<span class="op" id="5729579">&gt;=</span>&nbsp;<span class="num" id="5729582">1</span><span class="op" id="5729583">&lt;&lt;</span><span class="num" id="5729585">16</span>&nbsp;<span class="op" id="5729588">||</span>&nbsp;<span class="ident" id="5729591"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5729592">.</span><span class="ident" id="5729593"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="5729596">.</span><span class="ident" id="5729597"><a href="/gostd/image/geom.go.html#5148454">Y</a></span>&nbsp;<span class="op" id="5729599">&lt;</span>&nbsp;<span class="num" id="5729601">0</span>&nbsp;<span class="op" id="5729603">||</span>&nbsp;<span class="ident" id="5729606"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5729607">.</span><span class="ident" id="5729608"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="5729611">.</span><span class="ident" id="5729612"><a href="/gostd/image/geom.go.html#5148454">Y</a></span>&nbsp;<span class="op" id="5729614">&gt;=</span>&nbsp;<span class="num" id="5729617">1</span><span class="op" id="5729618">&lt;&lt;</span><span class="num" id="5729620">16</span>&nbsp;<span class="op" id="5729623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729627"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5729628">.</span><span class="ident" id="5729629"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5729633">=</span>&nbsp;<span class="ident" id="5729635"><a href="/gostd/image/gif/writer.go.html#5726005">errors</a></span><span class="op" id="5729641">.</span><span class="ident" id="5729642"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5729645">(</span><span class="string" id="5729646">&#34;gif:&nbsp;image&nbsp;block&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5729687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729691">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729703">transparentIndex</span>&nbsp;<span class="op" id="5729720">:=</span>&nbsp;<span class="op" id="5729723">-</span><span class="num" id="5729724">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729727">for</span>&nbsp;<span class="ident" id="5729731">i</span><span class="op" id="5729732">,</span>&nbsp;<span class="ident" id="5729734">c</span>&nbsp;<span class="op" id="5729736">:=</span>&nbsp;<span class="keyword" id="5729739">range</span>&nbsp;<span class="ident" id="5729745"><a href="/gostd/image/gif/writer.go.html#5729317">pm</a></span><span class="op" id="5729747">.</span><span class="ident" id="5729748"><a href="/gostd/image/image.go.html#5176774">Palette</a></span>&nbsp;<span class="op" id="5729756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729760">if</span>&nbsp;<span class="ident" id="5729763">_</span><span class="op" id="5729764">,</span>&nbsp;<span class="ident" id="5729766">_</span><span class="op" id="5729767">,</span>&nbsp;<span class="ident" id="5729769">_</span><span class="op" id="5729770">,</span>&nbsp;<span class="ident" id="5729772">a</span>&nbsp;<span class="op" id="5729774">:=</span>&nbsp;<span class="ident" id="5729777"><a href="/gostd/image/gif/writer.go.html#5729734">c</a></span><span class="op" id="5729778">.</span><span class="ident" id="5729779"><a href="/gostd/image/color/color.go.html#5185453">RGBA</a></span><span class="op" id="5729783">(</span><span class="op" id="5729784">)</span><span class="op" id="5729785">;</span>&nbsp;<span class="ident" id="5729787"><a href="/gostd/image/gif/writer.go.html#5729772">a</a></span>&nbsp;<span class="op" id="5729789">==</span>&nbsp;<span class="num" id="5729792">0</span>&nbsp;<span class="op" id="5729794">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729799"><a href="/gostd/image/gif/writer.go.html#5729703">transparentIndex</a></span>&nbsp;<span class="op" id="5729816">=</span>&nbsp;<span class="ident" id="5729818"><a href="/gostd/image/gif/writer.go.html#5729731">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729823">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729838">if</span>&nbsp;<span class="ident" id="5729841"><a href="/gostd/image/gif/writer.go.html#5729337">delay</a></span>&nbsp;<span class="op" id="5729847">&gt;</span>&nbsp;<span class="num" id="5729849">0</span>&nbsp;<span class="op" id="5729851">||</span>&nbsp;<span class="ident" id="5729854"><a href="/gostd/image/gif/writer.go.html#5729703">transparentIndex</a></span>&nbsp;<span class="op" id="5729871">!=</span>&nbsp;<span class="op" id="5729874">-</span><span class="num" id="5729875">1</span>&nbsp;<span class="op" id="5729877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729881"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5729882">.</span><span class="ident" id="5729883"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5729886">[</span><span class="num" id="5729887">0</span><span class="op" id="5729888">]</span>&nbsp;<span class="op" id="5729890">=</span>&nbsp;<span class="ident" id="5729892"><a href="/gostd/image/gif/reader.go.html#5715164">sExtension</a></span>&nbsp;&nbsp;<span class="comment" id="5729904">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729931"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5729932">.</span><span class="ident" id="5729933"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5729936">[</span><span class="num" id="5729937">1</span><span class="op" id="5729938">]</span>&nbsp;<span class="op" id="5729940">=</span>&nbsp;<span class="ident" id="5729942"><a href="/gostd/image/gif/writer.go.html#5726130">gcLabel</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5729954">//&nbsp;Graphic&nbsp;Control&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729982"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5729983">.</span><span class="ident" id="5729984"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5729987">[</span><span class="num" id="5729988">2</span><span class="op" id="5729989">]</span>&nbsp;<span class="op" id="5729991">=</span>&nbsp;<span class="ident" id="5729993"><a href="/gostd/image/gif/writer.go.html#5726150">gcBlockSize</a></span>&nbsp;<span class="comment" id="5730005">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730022">if</span>&nbsp;<span class="ident" id="5730025"><a href="/gostd/image/gif/writer.go.html#5729703">transparentIndex</a></span>&nbsp;<span class="op" id="5730042">!=</span>&nbsp;<span class="op" id="5730045">-</span><span class="num" id="5730046">1</span>&nbsp;<span class="op" id="5730048">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730053"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730054">.</span><span class="ident" id="5730055"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730058">[</span><span class="num" id="5730059">3</span><span class="op" id="5730060">]</span>&nbsp;<span class="op" id="5730062">=</span>&nbsp;<span class="num" id="5730064">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5730071">}</span>&nbsp;<span class="keyword" id="5730073">else</span>&nbsp;<span class="op" id="5730078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730083"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730084">.</span><span class="ident" id="5730085"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730088">[</span><span class="num" id="5730089">3</span><span class="op" id="5730090">]</span>&nbsp;<span class="op" id="5730092">=</span>&nbsp;<span class="num" id="5730094">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5730101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730105"><a href="/gostd/image/gif/writer.go.html#5726353">writeUint16</a></span><span class="op" id="5730116">(</span><span class="ident" id="5730117"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730118">.</span><span class="ident" id="5730119"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730122">[</span><span class="num" id="5730123">4</span><span class="op" id="5730124">:</span><span class="num" id="5730125">6</span><span class="op" id="5730126">]</span><span class="op" id="5730127">,</span>&nbsp;<span class="builtintype" id="5730129">uint16</span><span class="op" id="5730135">(</span><span class="ident" id="5730136"><a href="/gostd/image/gif/writer.go.html#5729337">delay</a></span><span class="op" id="5730141">)</span><span class="op" id="5730142">)</span>&nbsp;<span class="comment" id="5730144">//&nbsp;Delay&nbsp;Time&nbsp;(1/100ths&nbsp;of&nbsp;a&nbsp;second)</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5730184">//&nbsp;Transparent&nbsp;color&nbsp;index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730214">if</span>&nbsp;<span class="ident" id="5730217"><a href="/gostd/image/gif/writer.go.html#5729703">transparentIndex</a></span>&nbsp;<span class="op" id="5730234">!=</span>&nbsp;<span class="op" id="5730237">-</span><span class="num" id="5730238">1</span>&nbsp;<span class="op" id="5730240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730245"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730246">.</span><span class="ident" id="5730247"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730250">[</span><span class="num" id="5730251">6</span><span class="op" id="5730252">]</span>&nbsp;<span class="op" id="5730254">=</span>&nbsp;<span class="builtintype" id="5730256">uint8</span><span class="op" id="5730261">(</span><span class="ident" id="5730262"><a href="/gostd/image/gif/writer.go.html#5729703">transparentIndex</a></span><span class="op" id="5730278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5730282">}</span>&nbsp;<span class="keyword" id="5730284">else</span>&nbsp;<span class="op" id="5730289">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730294"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730295">.</span><span class="ident" id="5730296"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730299">[</span><span class="num" id="5730300">6</span><span class="op" id="5730301">]</span>&nbsp;<span class="op" id="5730303">=</span>&nbsp;<span class="num" id="5730305">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5730312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730316"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730317">.</span><span class="ident" id="5730318"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730321">[</span><span class="num" id="5730322">7</span><span class="op" id="5730323">]</span>&nbsp;<span class="op" id="5730325">=</span>&nbsp;<span class="num" id="5730327">0x00</span>&nbsp;<span class="comment" id="5730332">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730355"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730356">.</span><span class="ident" id="5730357"><a href="/gostd/image/gif/writer.go.html#5727661">write</a></span><span class="op" id="5730362">(</span><span class="ident" id="5730363"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730364">.</span><span class="ident" id="5730365"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730368">[</span><span class="op" id="5730369">:</span><span class="num" id="5730370">8</span><span class="op" id="5730371">]</span><span class="op" id="5730372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5730375">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730378"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730379">.</span><span class="ident" id="5730380"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730383">[</span><span class="num" id="5730384">0</span><span class="op" id="5730385">]</span>&nbsp;<span class="op" id="5730387">=</span>&nbsp;<span class="ident" id="5730389"><a href="/gostd/image/gif/reader.go.html#5715189">sImageDescriptor</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730407"><a href="/gostd/image/gif/writer.go.html#5726353">writeUint16</a></span><span class="op" id="5730418">(</span><span class="ident" id="5730419"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730420">.</span><span class="ident" id="5730421"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730424">[</span><span class="num" id="5730425">1</span><span class="op" id="5730426">:</span><span class="num" id="5730427">3</span><span class="op" id="5730428">]</span><span class="op" id="5730429">,</span>&nbsp;<span class="builtintype" id="5730431">uint16</span><span class="op" id="5730437">(</span><span class="ident" id="5730438"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5730439">.</span><span class="ident" id="5730440"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="5730443">.</span><span class="ident" id="5730444"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="5730445">)</span><span class="op" id="5730446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730449"><a href="/gostd/image/gif/writer.go.html#5726353">writeUint16</a></span><span class="op" id="5730460">(</span><span class="ident" id="5730461"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730462">.</span><span class="ident" id="5730463"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730466">[</span><span class="num" id="5730467">3</span><span class="op" id="5730468">:</span><span class="num" id="5730469">5</span><span class="op" id="5730470">]</span><span class="op" id="5730471">,</span>&nbsp;<span class="builtintype" id="5730473">uint16</span><span class="op" id="5730479">(</span><span class="ident" id="5730480"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5730481">.</span><span class="ident" id="5730482"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="5730485">.</span><span class="ident" id="5730486"><a href="/gostd/image/geom.go.html#5148454">Y</a></span><span class="op" id="5730487">)</span><span class="op" id="5730488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730491"><a href="/gostd/image/gif/writer.go.html#5726353">writeUint16</a></span><span class="op" id="5730502">(</span><span class="ident" id="5730503"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730504">.</span><span class="ident" id="5730505"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730508">[</span><span class="num" id="5730509">5</span><span class="op" id="5730510">:</span><span class="num" id="5730511">7</span><span class="op" id="5730512">]</span><span class="op" id="5730513">,</span>&nbsp;<span class="builtintype" id="5730515">uint16</span><span class="op" id="5730521">(</span><span class="ident" id="5730522"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5730523">.</span><span class="ident" id="5730524"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="5730526">(</span><span class="op" id="5730527">)</span><span class="op" id="5730528">)</span><span class="op" id="5730529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730532"><a href="/gostd/image/gif/writer.go.html#5726353">writeUint16</a></span><span class="op" id="5730543">(</span><span class="ident" id="5730544"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730545">.</span><span class="ident" id="5730546"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730549">[</span><span class="num" id="5730550">7</span><span class="op" id="5730551">:</span><span class="num" id="5730552">9</span><span class="op" id="5730553">]</span><span class="op" id="5730554">,</span>&nbsp;<span class="builtintype" id="5730556">uint16</span><span class="op" id="5730562">(</span><span class="ident" id="5730563"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5730564">.</span><span class="ident" id="5730565"><a href="/gostd/image/geom.go.html#5150316">Dy</a></span><span class="op" id="5730567">(</span><span class="op" id="5730568">)</span><span class="op" id="5730569">)</span><span class="op" id="5730570">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730573"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730574">.</span><span class="ident" id="5730575"><a href="/gostd/image/gif/writer.go.html#5727661">write</a></span><span class="op" id="5730580">(</span><span class="ident" id="5730581"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730582">.</span><span class="ident" id="5730583"><a href="/gostd/image/gif/writer.go.html#5726917">buf</a></span><span class="op" id="5730586">[</span><span class="op" id="5730587">:</span><span class="num" id="5730588">9</span><span class="op" id="5730589">]</span><span class="op" id="5730590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730594">paddedSize</span>&nbsp;<span class="op" id="5730605">:=</span>&nbsp;<span class="ident" id="5730608"><a href="/gostd/image/gif/writer.go.html#5726233">log2</a></span><span class="op" id="5730612">(</span><span class="builtinfunc" id="5730613">len</span><span class="op" id="5730616">(</span><span class="ident" id="5730617"><a href="/gostd/image/gif/writer.go.html#5729317">pm</a></span><span class="op" id="5730619">.</span><span class="ident" id="5730620"><a href="/gostd/image/image.go.html#5176774">Palette</a></span><span class="op" id="5730627">)</span><span class="op" id="5730628">)</span>&nbsp;<span class="comment" id="5730630">//&nbsp;Size&nbsp;of&nbsp;Local&nbsp;Color&nbsp;Table:&nbsp;2^(1+n).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5730670">//&nbsp;Interlacing&nbsp;is&nbsp;not&nbsp;supported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730704"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730705">.</span><span class="ident" id="5730706"><a href="/gostd/image/gif/writer.go.html#5727756">writeByte</a></span><span class="op" id="5730715">(</span><span class="num" id="5730716">0x80</span>&nbsp;<span class="op" id="5730721">|</span>&nbsp;<span class="builtintype" id="5730723">uint8</span><span class="op" id="5730728">(</span><span class="ident" id="5730729"><a href="/gostd/image/gif/writer.go.html#5730594">paddedSize</a></span><span class="op" id="5730739">)</span><span class="op" id="5730740">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5730744">//&nbsp;Local&nbsp;Color&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730767"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730768">.</span><span class="ident" id="5730769"><a href="/gostd/image/gif/writer.go.html#5728873">writeColorTable</a></span><span class="op" id="5730784">(</span><span class="ident" id="5730785"><a href="/gostd/image/gif/writer.go.html#5729317">pm</a></span><span class="op" id="5730787">.</span><span class="ident" id="5730788"><a href="/gostd/image/image.go.html#5176774">Palette</a></span><span class="op" id="5730795">,</span>&nbsp;<span class="ident" id="5730797"><a href="/gostd/image/gif/writer.go.html#5730594">paddedSize</a></span><span class="op" id="5730807">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730811">litWidth</span>&nbsp;<span class="op" id="5730820">:=</span>&nbsp;<span class="ident" id="5730823"><a href="/gostd/image/gif/writer.go.html#5730594">paddedSize</a></span>&nbsp;<span class="op" id="5730834">+</span>&nbsp;<span class="num" id="5730836">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730839">if</span>&nbsp;<span class="ident" id="5730842"><a href="/gostd/image/gif/writer.go.html#5730811">litWidth</a></span>&nbsp;<span class="op" id="5730851">&lt;</span>&nbsp;<span class="num" id="5730853">2</span>&nbsp;<span class="op" id="5730855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730859"><a href="/gostd/image/gif/writer.go.html#5730811">litWidth</a></span>&nbsp;<span class="op" id="5730868">=</span>&nbsp;<span class="num" id="5730870">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5730873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730876"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730877">.</span><span class="ident" id="5730878"><a href="/gostd/image/gif/writer.go.html#5727756">writeByte</a></span><span class="op" id="5730887">(</span><span class="builtintype" id="5730888">uint8</span><span class="op" id="5730893">(</span><span class="ident" id="5730894"><a href="/gostd/image/gif/writer.go.html#5730811">litWidth</a></span><span class="op" id="5730902">)</span><span class="op" id="5730903">)</span>&nbsp;<span class="comment" id="5730905">//&nbsp;LZW&nbsp;Minimum&nbsp;Code&nbsp;Size.</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730933">lzww</span>&nbsp;<span class="op" id="5730938">:=</span>&nbsp;<span class="ident" id="5730941"><a href="/gostd/image/gif/writer.go.html#5725989">lzw</a></span><span class="op" id="5730944">.</span><span class="ident" id="5730945"><a href="/gostd/compress/lzw/writer.go.html#5746657">NewWriter</a></span><span class="op" id="5730954">(</span><span class="ident" id="5730955"><a href="/gostd/image/gif/writer.go.html#5727150">blockWriter</a></span><span class="op" id="5730966">{</span><span class="ident" id="5730967"><a href="/gostd/image/gif/writer.go.html#5727172">e</a></span><span class="op" id="5730968">:</span>&nbsp;<span class="ident" id="5730970"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5730971">}</span><span class="op" id="5730972">,</span>&nbsp;<span class="ident" id="5730974"><a href="/gostd/image/gif/writer.go.html#5725989">lzw</a></span><span class="op" id="5730977">.</span><span class="ident" id="5730978"><a href="/gostd/compress/lzw/reader.go.html#5734384">LSB</a></span><span class="op" id="5730981">,</span>&nbsp;<span class="ident" id="5730983"><a href="/gostd/image/gif/writer.go.html#5730811">litWidth</a></span><span class="op" id="5730991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730994">if</span>&nbsp;<span class="ident" id="5730997">dx</span>&nbsp;<span class="op" id="5731000">:=</span>&nbsp;<span class="ident" id="5731003"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5731004">.</span><span class="ident" id="5731005"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="5731007">(</span><span class="op" id="5731008">)</span><span class="op" id="5731009">;</span>&nbsp;<span class="ident" id="5731011"><a href="/gostd/image/gif/writer.go.html#5730997">dx</a></span>&nbsp;<span class="op" id="5731014">==</span>&nbsp;<span class="ident" id="5731017"><a href="/gostd/image/gif/writer.go.html#5729317">pm</a></span><span class="op" id="5731019">.</span><span class="ident" id="5731020"><a href="/gostd/image/image.go.html#5176678">Stride</a></span>&nbsp;<span class="op" id="5731027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731031">_</span><span class="op" id="5731032">,</span>&nbsp;<span class="ident" id="5731034"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5731035">.</span><span class="ident" id="5731036"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5731040">=</span>&nbsp;<span class="ident" id="5731042"><a href="/gostd/image/gif/writer.go.html#5730933">lzww</a></span><span class="op" id="5731046">.</span><span class="ident" id="5731047"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="5731052">(</span><span class="ident" id="5731053"><a href="/gostd/image/gif/writer.go.html#5729317">pm</a></span><span class="op" id="5731055">.</span><span class="ident" id="5731056"><a href="/gostd/image/image.go.html#5176589">Pix</a></span><span class="op" id="5731059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5731063">if</span>&nbsp;<span class="ident" id="5731066"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5731067">.</span><span class="ident" id="5731068"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5731072">!=</span>&nbsp;<span class="builtintype" id="5731075">nil</span>&nbsp;<span class="op" id="5731079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731084"><a href="/gostd/image/gif/writer.go.html#5730933">lzww</a></span><span class="op" id="5731088">.</span><span class="ident" id="5731089"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="5731094">(</span><span class="op" id="5731095">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5731100">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5731109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5731112">}</span>&nbsp;<span class="keyword" id="5731114">else</span>&nbsp;<span class="op" id="5731119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5731123">for</span>&nbsp;<span class="ident" id="5731127">i</span><span class="op" id="5731128">,</span>&nbsp;<span class="ident" id="5731130">y</span>&nbsp;<span class="op" id="5731132">:=</span>&nbsp;<span class="num" id="5731135">0</span><span class="op" id="5731136">,</span>&nbsp;<span class="ident" id="5731138"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5731139">.</span><span class="ident" id="5731140"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="5731143">.</span><span class="ident" id="5731144"><a href="/gostd/image/geom.go.html#5148454">Y</a></span><span class="op" id="5731145">;</span>&nbsp;<span class="ident" id="5731147"><a href="/gostd/image/gif/writer.go.html#5731130">y</a></span>&nbsp;<span class="op" id="5731149">&lt;</span>&nbsp;<span class="ident" id="5731151"><a href="/gostd/image/gif/writer.go.html#5729497">b</a></span><span class="op" id="5731152">.</span><span class="ident" id="5731153"><a href="/gostd/image/geom.go.html#5150021">Max</a></span><span class="op" id="5731156">.</span><span class="ident" id="5731157"><a href="/gostd/image/geom.go.html#5148454">Y</a></span><span class="op" id="5731158">;</span>&nbsp;<span class="ident" id="5731160"><a href="/gostd/image/gif/writer.go.html#5731127">i</a></span><span class="op" id="5731161">,</span>&nbsp;<span class="ident" id="5731163"><a href="/gostd/image/gif/writer.go.html#5731130">y</a></span>&nbsp;<span class="op" id="5731165">=</span>&nbsp;<span class="ident" id="5731167"><a href="/gostd/image/gif/writer.go.html#5731127">i</a></span><span class="op" id="5731168">+</span><span class="ident" id="5731169"><a href="/gostd/image/gif/writer.go.html#5729317">pm</a></span><span class="op" id="5731171">.</span><span class="ident" id="5731172"><a href="/gostd/image/image.go.html#5176678">Stride</a></span><span class="op" id="5731178">,</span>&nbsp;<span class="ident" id="5731180"><a href="/gostd/image/gif/writer.go.html#5731130">y</a></span><span class="op" id="5731181">+</span><span class="num" id="5731182">1</span>&nbsp;<span class="op" id="5731184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731189">_</span><span class="op" id="5731190">,</span>&nbsp;<span class="ident" id="5731192"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5731193">.</span><span class="ident" id="5731194"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5731198">=</span>&nbsp;<span class="ident" id="5731200"><a href="/gostd/image/gif/writer.go.html#5730933">lzww</a></span><span class="op" id="5731204">.</span><span class="ident" id="5731205"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="5731210">(</span><span class="ident" id="5731211"><a href="/gostd/image/gif/writer.go.html#5729317">pm</a></span><span class="op" id="5731213">.</span><span class="ident" id="5731214"><a href="/gostd/image/image.go.html#5176589">Pix</a></span><span class="op" id="5731217">[</span><span class="ident" id="5731218"><a href="/gostd/image/gif/writer.go.html#5731127">i</a></span>&nbsp;<span class="op" id="5731220">:</span>&nbsp;<span class="ident" id="5731222"><a href="/gostd/image/gif/writer.go.html#5731127">i</a></span><span class="op" id="5731223">+</span><span class="ident" id="5731224"><a href="/gostd/image/gif/writer.go.html#5730997">dx</a></span><span class="op" id="5731226">]</span><span class="op" id="5731227">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5731232">if</span>&nbsp;<span class="ident" id="5731235"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5731236">.</span><span class="ident" id="5731237"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span>&nbsp;<span class="op" id="5731241">!=</span>&nbsp;<span class="builtintype" id="5731244">nil</span>&nbsp;<span class="op" id="5731248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731254"><a href="/gostd/image/gif/writer.go.html#5730933">lzww</a></span><span class="op" id="5731258">.</span><span class="ident" id="5731259"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="5731264">(</span><span class="op" id="5731265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5731271">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5731281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5731285">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5731288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731291"><a href="/gostd/image/gif/writer.go.html#5730933">lzww</a></span><span class="op" id="5731295">.</span><span class="ident" id="5731296"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="5731301">(</span><span class="op" id="5731302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731305"><a href="/gostd/image/gif/writer.go.html#5729289">e</a></span><span class="op" id="5731306">.</span><span class="ident" id="5731307"><a href="/gostd/image/gif/writer.go.html#5727756">writeByte</a></span><span class="op" id="5731316">(</span><span class="num" id="5731317">0x00</span><span class="op" id="5731321">)</span>&nbsp;<span class="comment" id="5731323">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span><span class="op" id="5731344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="5731347">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="5731387">type</span>&nbsp;<span class="ident" id="5731392">Options</span>&nbsp;<span class="keyword" id="5731400">struct</span>&nbsp;<span class="op" id="5731407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5731410">//&nbsp;NumColors&nbsp;is&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;colors&nbsp;used&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5731475">//&nbsp;It&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;256.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731504">NumColors</span>&nbsp;<span class="builtintype" id="5731514">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5731520">//&nbsp;Quantizer&nbsp;is&nbsp;used&nbsp;to&nbsp;produce&nbsp;a&nbsp;palette&nbsp;with&nbsp;size&nbsp;NumColors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5731584">//&nbsp;palette.Plan9&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Quantizer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731639">Quantizer</span>&nbsp;<span class="ident" id="5731649"><a href="/gostd/image/gif/writer.go.html#5726062">draw</a></span><span class="op" id="5731653">.</span><span class="ident" id="5731654"><a href="/gostd/image/draw/draw.go.html#5767029">Quantizer</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5731666">//&nbsp;Drawer&nbsp;is&nbsp;used&nbsp;to&nbsp;convert&nbsp;the&nbsp;source&nbsp;image&nbsp;to&nbsp;the&nbsp;desired&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5731737">//&nbsp;draw.FloydSteinberg&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Drawer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731795">Drawer</span>&nbsp;<span class="ident" id="5731802"><a href="/gostd/image/gif/writer.go.html#5726062">draw</a></span><span class="op" id="5731806">.</span><span class="ident" id="5731807"><a href="/gostd/image/draw/draw.go.html#5767684">Drawer</a></span><br>
<span class="lineno"></span><span class="op" id="5731814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5731817">//&nbsp;EncodeAll&nbsp;writes&nbsp;the&nbsp;images&nbsp;in&nbsp;g&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5731881">//&nbsp;given&nbsp;loop&nbsp;count&nbsp;and&nbsp;delay&nbsp;between&nbsp;frames.</span><br>
<span class="lineno"></span><span class="keyword" id="5731927">func</span>&nbsp;<span class="ident" id="5731932">EncodeAll</span><span class="op" id="5731941">(</span><span class="ident" id="5731942">w</span>&nbsp;<span class="ident" id="5731944"><a href="/gostd/image/gif/writer.go.html#5726076">io</a></span><span class="op" id="5731946">.</span><span class="ident" id="5731947"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5731953">,</span>&nbsp;<span class="ident" id="5731955">g</span>&nbsp;<span class="op" id="5731957">*</span><span class="ident" id="5731958"><a href="/gostd/image/gif/reader.go.html#5724800">GIF</a></span><span class="op" id="5731961">)</span>&nbsp;<span class="builtintype" id="5731963">error</span>&nbsp;<span class="op" id="5731969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5731972">if</span>&nbsp;<span class="builtinfunc" id="5731975">len</span><span class="op" id="5731978">(</span><span class="ident" id="5731979"><a href="/gostd/image/gif/writer.go.html#5731955">g</a></span><span class="op" id="5731980">.</span><span class="ident" id="5731981"><a href="/gostd/image/gif/reader.go.html#5724814">Image</a></span><span class="op" id="5731986">)</span>&nbsp;<span class="op" id="5731988">==</span>&nbsp;<span class="num" id="5731991">0</span>&nbsp;<span class="op" id="5731993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5731997">return</span>&nbsp;<span class="ident" id="5732004"><a href="/gostd/image/gif/writer.go.html#5726005">errors</a></span><span class="op" id="5732010">.</span><span class="ident" id="5732011"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5732014">(</span><span class="string" id="5732015">&#34;gif:&nbsp;must&nbsp;provide&nbsp;at&nbsp;least&nbsp;one&nbsp;image&#34;</span><span class="op" id="5732053">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732060">if</span>&nbsp;<span class="builtinfunc" id="5732063">len</span><span class="op" id="5732066">(</span><span class="ident" id="5732067"><a href="/gostd/image/gif/writer.go.html#5731955">g</a></span><span class="op" id="5732068">.</span><span class="ident" id="5732069"><a href="/gostd/image/gif/reader.go.html#5724814">Image</a></span><span class="op" id="5732074">)</span>&nbsp;<span class="op" id="5732076">!=</span>&nbsp;<span class="builtinfunc" id="5732079">len</span><span class="op" id="5732082">(</span><span class="ident" id="5732083"><a href="/gostd/image/gif/writer.go.html#5731955">g</a></span><span class="op" id="5732084">.</span><span class="ident" id="5732085"><a href="/gostd/image/gif/reader.go.html#5724869">Delay</a></span><span class="op" id="5732090">)</span>&nbsp;<span class="op" id="5732092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732096">return</span>&nbsp;<span class="ident" id="5732103"><a href="/gostd/image/gif/writer.go.html#5726005">errors</a></span><span class="op" id="5732109">.</span><span class="ident" id="5732110"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5732113">(</span><span class="string" id="5732114">&#34;gif:&nbsp;mismatched&nbsp;image&nbsp;and&nbsp;delay&nbsp;lengths&#34;</span><span class="op" id="5732155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732158">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732161">if</span>&nbsp;<span class="ident" id="5732164"><a href="/gostd/image/gif/writer.go.html#5731955">g</a></span><span class="op" id="5732165">.</span><span class="ident" id="5732166"><a href="/gostd/image/gif/reader.go.html#5724967">LoopCount</a></span>&nbsp;<span class="op" id="5732176">&lt;</span>&nbsp;<span class="num" id="5732178">0</span>&nbsp;<span class="op" id="5732180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732184"><a href="/gostd/image/gif/writer.go.html#5731955">g</a></span><span class="op" id="5732185">.</span><span class="ident" id="5732186"><a href="/gostd/image/gif/reader.go.html#5724967">LoopCount</a></span>&nbsp;<span class="op" id="5732196">=</span>&nbsp;<span class="num" id="5732198">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732205">e</span>&nbsp;<span class="op" id="5732207">:=</span>&nbsp;<span class="ident" id="5732210"><a href="/gostd/image/gif/writer.go.html#5726582">encoder</a></span><span class="op" id="5732217">{</span><span class="ident" id="5732218"><a href="/gostd/image/gif/writer.go.html#5726825">g</a></span><span class="op" id="5732219">:</span>&nbsp;<span class="ident" id="5732221"><a href="/gostd/image/gif/writer.go.html#5731955">g</a></span><span class="op" id="5732222">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732225">if</span>&nbsp;<span class="ident" id="5732228">ww</span><span class="op" id="5732230">,</span>&nbsp;<span class="ident" id="5732232">ok</span>&nbsp;<span class="op" id="5732235">:=</span>&nbsp;<span class="ident" id="5732238"><a href="/gostd/image/gif/writer.go.html#5731942">w</a></span><span class="op" id="5732239">.</span><span class="op" id="5732240">(</span><span class="ident" id="5732241"><a href="/gostd/image/gif/writer.go.html#5726467">writer</a></span><span class="op" id="5732247">)</span><span class="op" id="5732248">;</span>&nbsp;<span class="ident" id="5732250"><a href="/gostd/image/gif/writer.go.html#5732232">ok</a></span>&nbsp;<span class="op" id="5732253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732257"><a href="/gostd/image/gif/writer.go.html#5732205">e</a></span><span class="op" id="5732258">.</span><span class="ident" id="5732259"><a href="/gostd/image/gif/writer.go.html#5726746">w</a></span>&nbsp;<span class="op" id="5732261">=</span>&nbsp;<span class="ident" id="5732263"><a href="/gostd/image/gif/writer.go.html#5732228">ww</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732267">}</span>&nbsp;<span class="keyword" id="5732269">else</span>&nbsp;<span class="op" id="5732274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732278"><a href="/gostd/image/gif/writer.go.html#5732205">e</a></span><span class="op" id="5732279">.</span><span class="ident" id="5732280"><a href="/gostd/image/gif/writer.go.html#5726746">w</a></span>&nbsp;<span class="op" id="5732282">=</span>&nbsp;<span class="ident" id="5732284"><a href="/gostd/image/gif/writer.go.html#5725980">bufio</a></span><span class="op" id="5732289">.</span><span class="ident" id="5732290"><a href="/gostd/bufio/bufio.go.html#1367149">NewWriter</a></span><span class="op" id="5732299">(</span><span class="ident" id="5732300"><a href="/gostd/image/gif/writer.go.html#5731942">w</a></span><span class="op" id="5732301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732304">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732308"><a href="/gostd/image/gif/writer.go.html#5732205">e</a></span><span class="op" id="5732309">.</span><span class="ident" id="5732310"><a href="/gostd/image/gif/writer.go.html#5727854">writeHeader</a></span><span class="op" id="5732321">(</span><span class="op" id="5732322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732325">for</span>&nbsp;<span class="ident" id="5732329">i</span><span class="op" id="5732330">,</span>&nbsp;<span class="ident" id="5732332">pm</span>&nbsp;<span class="op" id="5732335">:=</span>&nbsp;<span class="keyword" id="5732338">range</span>&nbsp;<span class="ident" id="5732344"><a href="/gostd/image/gif/writer.go.html#5731955">g</a></span><span class="op" id="5732345">.</span><span class="ident" id="5732346"><a href="/gostd/image/gif/reader.go.html#5724814">Image</a></span>&nbsp;<span class="op" id="5732352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732356"><a href="/gostd/image/gif/writer.go.html#5732205">e</a></span><span class="op" id="5732357">.</span><span class="ident" id="5732358"><a href="/gostd/image/gif/writer.go.html#5729301">writeImageBlock</a></span><span class="op" id="5732373">(</span><span class="ident" id="5732374"><a href="/gostd/image/gif/writer.go.html#5732332">pm</a></span><span class="op" id="5732376">,</span>&nbsp;<span class="ident" id="5732378"><a href="/gostd/image/gif/writer.go.html#5731955">g</a></span><span class="op" id="5732379">.</span><span class="ident" id="5732380"><a href="/gostd/image/gif/reader.go.html#5724869">Delay</a></span><span class="op" id="5732385">[</span><span class="ident" id="5732386"><a href="/gostd/image/gif/writer.go.html#5732329">i</a></span><span class="op" id="5732387">]</span><span class="op" id="5732388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732391">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732394"><a href="/gostd/image/gif/writer.go.html#5732205">e</a></span><span class="op" id="5732395">.</span><span class="ident" id="5732396"><a href="/gostd/image/gif/writer.go.html#5727756">writeByte</a></span><span class="op" id="5732405">(</span><span class="ident" id="5732406"><a href="/gostd/image/gif/reader.go.html#5715214">sTrailer</a></span><span class="op" id="5732414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732417"><a href="/gostd/image/gif/writer.go.html#5732205">e</a></span><span class="op" id="5732418">.</span><span class="ident" id="5732419"><a href="/gostd/image/gif/writer.go.html#5727578">flush</a></span><span class="op" id="5732424">(</span><span class="op" id="5732425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732428">return</span>&nbsp;<span class="ident" id="5732435"><a href="/gostd/image/gif/writer.go.html#5732205">e</a></span><span class="op" id="5732436">.</span><span class="ident" id="5732437"><a href="/gostd/image/gif/writer.go.html#5726758">err</a></span><br>
<span class="lineno"></span><span class="op" id="5732441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="5732444">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5732493">func</span>&nbsp;<span class="ident" id="5732498">Encode</span><span class="op" id="5732504">(</span><span class="ident" id="5732505">w</span>&nbsp;<span class="ident" id="5732507"><a href="/gostd/image/gif/writer.go.html#5726076">io</a></span><span class="op" id="5732509">.</span><span class="ident" id="5732510"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="5732516">,</span>&nbsp;<span class="ident" id="5732518">m</span>&nbsp;<span class="ident" id="5732520"><a href="/gostd/image/gif/writer.go.html#5726015">image</a></span><span class="op" id="5732525">.</span><span class="ident" id="5732526"><a href="/gostd/image/image.go.html#5154907">Image</a></span><span class="op" id="5732531">,</span>&nbsp;<span class="ident" id="5732533">o</span>&nbsp;<span class="op" id="5732535">*</span><span class="ident" id="5732536"><a href="/gostd/image/gif/writer.go.html#5731392">Options</a></span><span class="op" id="5732543">)</span>&nbsp;<span class="builtintype" id="5732545">error</span>&nbsp;<span class="op" id="5732551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5732554">//&nbsp;Check&nbsp;for&nbsp;bounds&nbsp;and&nbsp;size&nbsp;restrictions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732598">b</span>&nbsp;<span class="op" id="5732600">:=</span>&nbsp;<span class="ident" id="5732603"><a href="/gostd/image/gif/writer.go.html#5732518">m</a></span><span class="op" id="5732604">.</span><span class="ident" id="5732605"><a href="/gostd/image/image.go.html#5155130">Bounds</a></span><span class="op" id="5732611">(</span><span class="op" id="5732612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732615">if</span>&nbsp;<span class="ident" id="5732618"><a href="/gostd/image/gif/writer.go.html#5732598">b</a></span><span class="op" id="5732619">.</span><span class="ident" id="5732620"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="5732622">(</span><span class="op" id="5732623">)</span>&nbsp;<span class="op" id="5732625">&gt;=</span>&nbsp;<span class="num" id="5732628">1</span><span class="op" id="5732629">&lt;&lt;</span><span class="num" id="5732631">16</span>&nbsp;<span class="op" id="5732634">||</span>&nbsp;<span class="ident" id="5732637"><a href="/gostd/image/gif/writer.go.html#5732598">b</a></span><span class="op" id="5732638">.</span><span class="ident" id="5732639"><a href="/gostd/image/geom.go.html#5150316">Dy</a></span><span class="op" id="5732641">(</span><span class="op" id="5732642">)</span>&nbsp;<span class="op" id="5732644">&gt;=</span>&nbsp;<span class="num" id="5732647">1</span><span class="op" id="5732648">&lt;&lt;</span><span class="num" id="5732650">16</span>&nbsp;<span class="op" id="5732653">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732657">return</span>&nbsp;<span class="ident" id="5732664"><a href="/gostd/image/gif/writer.go.html#5726005">errors</a></span><span class="op" id="5732670">.</span><span class="ident" id="5732671"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5732674">(</span><span class="string" id="5732675">&#34;gif:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5732710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732717">opts</span>&nbsp;<span class="op" id="5732722">:=</span>&nbsp;<span class="ident" id="5732725"><a href="/gostd/image/gif/writer.go.html#5731392">Options</a></span><span class="op" id="5732732">{</span><span class="op" id="5732733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732736">if</span>&nbsp;<span class="ident" id="5732739"><a href="/gostd/image/gif/writer.go.html#5732533">o</a></span>&nbsp;<span class="op" id="5732741">!=</span>&nbsp;<span class="builtintype" id="5732744">nil</span>&nbsp;<span class="op" id="5732748">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732752"><a href="/gostd/image/gif/writer.go.html#5732717">opts</a></span>&nbsp;<span class="op" id="5732757">=</span>&nbsp;<span class="op" id="5732759">*</span><span class="ident" id="5732760"><a href="/gostd/image/gif/writer.go.html#5732533">o</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732766">if</span>&nbsp;<span class="ident" id="5732769"><a href="/gostd/image/gif/writer.go.html#5732717">opts</a></span><span class="op" id="5732773">.</span><span class="ident" id="5732774"><a href="/gostd/image/gif/writer.go.html#5731504">NumColors</a></span>&nbsp;<span class="op" id="5732784">&lt;</span>&nbsp;<span class="num" id="5732786">1</span>&nbsp;<span class="op" id="5732788">||</span>&nbsp;<span class="num" id="5732791">256</span>&nbsp;<span class="op" id="5732795">&lt;</span>&nbsp;<span class="ident" id="5732797"><a href="/gostd/image/gif/writer.go.html#5732717">opts</a></span><span class="op" id="5732801">.</span><span class="ident" id="5732802"><a href="/gostd/image/gif/writer.go.html#5731504">NumColors</a></span>&nbsp;<span class="op" id="5732812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732816"><a href="/gostd/image/gif/writer.go.html#5732717">opts</a></span><span class="op" id="5732820">.</span><span class="ident" id="5732821"><a href="/gostd/image/gif/writer.go.html#5731504">NumColors</a></span>&nbsp;<span class="op" id="5732831">=</span>&nbsp;<span class="num" id="5732833">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732838">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732841">if</span>&nbsp;<span class="ident" id="5732844"><a href="/gostd/image/gif/writer.go.html#5732717">opts</a></span><span class="op" id="5732848">.</span><span class="ident" id="5732849"><a href="/gostd/image/gif/writer.go.html#5731795">Drawer</a></span>&nbsp;<span class="op" id="5732856">==</span>&nbsp;<span class="builtintype" id="5732859">nil</span>&nbsp;<span class="op" id="5732863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732867"><a href="/gostd/image/gif/writer.go.html#5732717">opts</a></span><span class="op" id="5732871">.</span><span class="ident" id="5732872"><a href="/gostd/image/gif/writer.go.html#5731795">Drawer</a></span>&nbsp;<span class="op" id="5732879">=</span>&nbsp;<span class="ident" id="5732881"><a href="/gostd/image/gif/writer.go.html#5726062">draw</a></span><span class="op" id="5732885">.</span><span class="ident" id="5732886"><a href="/gostd/image/draw/draw.go.html#5767997">FloydSteinberg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732906">pm</span><span class="op" id="5732908">,</span>&nbsp;<span class="ident" id="5732910">ok</span>&nbsp;<span class="op" id="5732913">:=</span>&nbsp;<span class="ident" id="5732916"><a href="/gostd/image/gif/writer.go.html#5732518">m</a></span><span class="op" id="5732917">.</span><span class="op" id="5732918">(</span><span class="op" id="5732919">*</span><span class="ident" id="5732920"><a href="/gostd/image/gif/writer.go.html#5726015">image</a></span><span class="op" id="5732925">.</span><span class="ident" id="5732926"><a href="/gostd/image/image.go.html#5176435">Paletted</a></span><span class="op" id="5732934">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732937">if</span>&nbsp;<span class="op" id="5732940">!</span><span class="ident" id="5732941"><a href="/gostd/image/gif/writer.go.html#5732910">ok</a></span>&nbsp;<span class="op" id="5732944">||</span>&nbsp;<span class="builtinfunc" id="5732947">len</span><span class="op" id="5732950">(</span><span class="ident" id="5732951"><a href="/gostd/image/gif/writer.go.html#5732906">pm</a></span><span class="op" id="5732953">.</span><span class="ident" id="5732954"><a href="/gostd/image/image.go.html#5176774">Palette</a></span><span class="op" id="5732961">)</span>&nbsp;<span class="op" id="5732963">&gt;</span>&nbsp;<span class="ident" id="5732965"><a href="/gostd/image/gif/writer.go.html#5732717">opts</a></span><span class="op" id="5732969">.</span><span class="ident" id="5732970"><a href="/gostd/image/gif/writer.go.html#5731504">NumColors</a></span>&nbsp;<span class="op" id="5732980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5732984">//&nbsp;TODO:&nbsp;Pick&nbsp;a&nbsp;better&nbsp;sub-sample&nbsp;of&nbsp;the&nbsp;Plan&nbsp;9&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733043"><a href="/gostd/image/gif/writer.go.html#5732906">pm</a></span>&nbsp;<span class="op" id="5733046">=</span>&nbsp;<span class="ident" id="5733048"><a href="/gostd/image/gif/writer.go.html#5726015">image</a></span><span class="op" id="5733053">.</span><span class="ident" id="5733054"><a href="/gostd/image/image.go.html#5178970">NewPaletted</a></span><span class="op" id="5733065">(</span><span class="ident" id="5733066"><a href="/gostd/image/gif/writer.go.html#5732598">b</a></span><span class="op" id="5733067">,</span>&nbsp;<span class="ident" id="5733069"><a href="/gostd/image/gif/writer.go.html#5726039">palette</a></span><span class="op" id="5733076">.</span><span class="ident" id="5733077"><a href="/gostd/image/color/palette/palette.go.html#5748620">Plan9</a></span><span class="op" id="5733082">[</span><span class="op" id="5733083">:</span><span class="ident" id="5733084"><a href="/gostd/image/gif/writer.go.html#5732717">opts</a></span><span class="op" id="5733088">.</span><span class="ident" id="5733089"><a href="/gostd/image/gif/writer.go.html#5731504">NumColors</a></span><span class="op" id="5733098">]</span><span class="op" id="5733099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733103">if</span>&nbsp;<span class="ident" id="5733106"><a href="/gostd/image/gif/writer.go.html#5732717">opts</a></span><span class="op" id="5733110">.</span><span class="ident" id="5733111"><a href="/gostd/image/gif/writer.go.html#5731639">Quantizer</a></span>&nbsp;<span class="op" id="5733121">!=</span>&nbsp;<span class="builtintype" id="5733124">nil</span>&nbsp;<span class="op" id="5733128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733133"><a href="/gostd/image/gif/writer.go.html#5732906">pm</a></span><span class="op" id="5733135">.</span><span class="ident" id="5733136"><a href="/gostd/image/image.go.html#5176774">Palette</a></span>&nbsp;<span class="op" id="5733144">=</span>&nbsp;<span class="ident" id="5733146"><a href="/gostd/image/gif/writer.go.html#5732717">opts</a></span><span class="op" id="5733150">.</span><span class="ident" id="5733151"><a href="/gostd/image/gif/writer.go.html#5731639">Quantizer</a></span><span class="op" id="5733160">.</span><span class="ident" id="5733161"><a href="/gostd/image/draw/draw.go.html#5767190">Quantize</a></span><span class="op" id="5733169">(</span><span class="builtinfunc" id="5733170">make</span><span class="op" id="5733174">(</span><span class="ident" id="5733175"><a href="/gostd/image/gif/writer.go.html#5726024">color</a></span><span class="op" id="5733180">.</span><span class="ident" id="5733181"><a href="/gostd/image/color/color.go.html#5190467">Palette</a></span><span class="op" id="5733188">,</span>&nbsp;<span class="num" id="5733190">0</span><span class="op" id="5733191">,</span>&nbsp;<span class="ident" id="5733193"><a href="/gostd/image/gif/writer.go.html#5732717">opts</a></span><span class="op" id="5733197">.</span><span class="ident" id="5733198"><a href="/gostd/image/gif/writer.go.html#5731504">NumColors</a></span><span class="op" id="5733207">)</span><span class="op" id="5733208">,</span>&nbsp;<span class="ident" id="5733210"><a href="/gostd/image/gif/writer.go.html#5732518">m</a></span><span class="op" id="5733211">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5733215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733219"><a href="/gostd/image/gif/writer.go.html#5732717">opts</a></span><span class="op" id="5733223">.</span><span class="ident" id="5733224"><a href="/gostd/image/gif/writer.go.html#5731795">Drawer</a></span><span class="op" id="5733230">.</span><span class="ident" id="5733231"><a href="/gostd/image/draw/draw.go.html#5767832">Draw</a></span><span class="op" id="5733235">(</span><span class="ident" id="5733236"><a href="/gostd/image/gif/writer.go.html#5732906">pm</a></span><span class="op" id="5733238">,</span>&nbsp;<span class="ident" id="5733240"><a href="/gostd/image/gif/writer.go.html#5732598">b</a></span><span class="op" id="5733241">,</span>&nbsp;<span class="ident" id="5733243"><a href="/gostd/image/gif/writer.go.html#5732518">m</a></span><span class="op" id="5733244">,</span>&nbsp;<span class="ident" id="5733246"><a href="/gostd/image/gif/writer.go.html#5726015">image</a></span><span class="op" id="5733251">.</span><span class="ident" id="5733252"><a href="/gostd/image/geom.go.html#5149640">ZP</a></span><span class="op" id="5733254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5733257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733261">return</span>&nbsp;<span class="ident" id="5733268"><a href="/gostd/image/gif/writer.go.html#5731932">EncodeAll</a></span><span class="op" id="5733277">(</span><span class="ident" id="5733278"><a href="/gostd/image/gif/writer.go.html#5732505">w</a></span><span class="op" id="5733279">,</span>&nbsp;<span class="op" id="5733281">&amp;</span><span class="ident" id="5733282"><a href="/gostd/image/gif/reader.go.html#5724800">GIF</a></span><span class="op" id="5733285">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733289"><a href="/gostd/image/gif/reader.go.html#5724814">Image</a></span><span class="op" id="5733294">:</span>&nbsp;<span class="op" id="5733296">[</span><span class="op" id="5733297">]</span><span class="op" id="5733298">*</span><span class="ident" id="5733299"><a href="/gostd/image/gif/writer.go.html#5726015">image</a></span><span class="op" id="5733304">.</span><span class="ident" id="5733305"><a href="/gostd/image/image.go.html#5176435">Paletted</a></span><span class="op" id="5733313">{</span><span class="ident" id="5733314"><a href="/gostd/image/gif/writer.go.html#5732906">pm</a></span><span class="op" id="5733316">}</span><span class="op" id="5733317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733321"><a href="/gostd/image/gif/reader.go.html#5724869">Delay</a></span><span class="op" id="5733326">:</span>&nbsp;<span class="op" id="5733328">[</span><span class="op" id="5733329">]</span><span class="builtintype" id="5733330">int</span><span class="op" id="5733333">{</span><span class="num" id="5733334">0</span><span class="op" id="5733335">}</span><span class="op" id="5733336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5733339">}</span><span class="op" id="5733340">)</span><br>
<span class="lineno"></span><span class="op" id="5733342">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
