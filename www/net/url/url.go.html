<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3705952">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3706007">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3706061">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3706112">//&nbsp;Package&nbsp;url&nbsp;parses&nbsp;URLs&nbsp;and&nbsp;implements&nbsp;query&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="3706170">//&nbsp;See&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3706187">package</span>&nbsp;<span class="ident" id="3706195">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3706200">import</span>&nbsp;<span class="op" id="3706207">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3706210">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3706219">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3706229">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3706237">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3706248">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3706258">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3706261">//&nbsp;Error&nbsp;reports&nbsp;an&nbsp;error&nbsp;and&nbsp;the&nbsp;operation&nbsp;and&nbsp;URL&nbsp;that&nbsp;caused&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3706329">type</span>&nbsp;<span class="ident" id="3706334">Error</span>&nbsp;<span class="keyword" id="3706340">struct</span>&nbsp;<span class="op" id="3706347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706350">Op</span>&nbsp;&nbsp;<span class="builtintype" id="3706354">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706362">URL</span>&nbsp;<span class="builtintype" id="3706366">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706374">Err</span>&nbsp;<span class="builtintype" id="3706378">error</span><br>
<span class="lineno"></span><span class="op" id="3706384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3706387">func</span>&nbsp;<span class="op" id="3706392">(</span><span class="ident" id="3706393">e</span>&nbsp;<span class="op" id="3706395">*</span><span class="ident" id="3706396">Error</span><span class="op" id="3706401">)</span>&nbsp;<span class="ident" id="3706403">Error</span><span class="op" id="3706408">(</span><span class="op" id="3706409">)</span>&nbsp;<span class="builtintype" id="3706411">string</span>&nbsp;<span class="op" id="3706418">{</span>&nbsp;<span class="keyword" id="3706420">return</span>&nbsp;<span class="ident" id="3706427">e</span><span class="op" id="3706428">.</span><span class="ident" id="3706429">Op</span>&nbsp;<span class="op" id="3706432">+</span>&nbsp;<span class="string" id="3706434">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3706438">+</span>&nbsp;<span class="ident" id="3706440">e</span><span class="op" id="3706441">.</span><span class="ident" id="3706442">URL</span>&nbsp;<span class="op" id="3706446">+</span>&nbsp;<span class="string" id="3706448">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3706453">+</span>&nbsp;<span class="ident" id="3706455">e</span><span class="op" id="3706456">.</span><span class="ident" id="3706457">Err</span><span class="op" id="3706460">.</span><span class="ident" id="3706461">Error</span><span class="op" id="3706466">(</span><span class="op" id="3706467">)</span>&nbsp;<span class="op" id="3706469">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3706472">func</span>&nbsp;<span class="ident" id="3706477">ishex</span><span class="op" id="3706482">(</span><span class="ident" id="3706483">c</span>&nbsp;<span class="builtintype" id="3706485">byte</span><span class="op" id="3706489">)</span>&nbsp;<span class="builtintype" id="3706491">bool</span>&nbsp;<span class="op" id="3706496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706499">switch</span>&nbsp;<span class="op" id="3706506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706509">case</span>&nbsp;<span class="string" id="3706514">&#39;0&#39;</span>&nbsp;<span class="op" id="3706518">&lt;=</span>&nbsp;<span class="ident" id="3706521">c</span>&nbsp;<span class="op" id="3706523">&amp;&amp;</span>&nbsp;<span class="ident" id="3706526">c</span>&nbsp;<span class="op" id="3706528">&lt;=</span>&nbsp;<span class="string" id="3706531">&#39;9&#39;</span><span class="op" id="3706534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706538">return</span>&nbsp;<span class="ident" id="3706545">true</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706551">case</span>&nbsp;<span class="string" id="3706556">&#39;a&#39;</span>&nbsp;<span class="op" id="3706560">&lt;=</span>&nbsp;<span class="ident" id="3706563">c</span>&nbsp;<span class="op" id="3706565">&amp;&amp;</span>&nbsp;<span class="ident" id="3706568">c</span>&nbsp;<span class="op" id="3706570">&lt;=</span>&nbsp;<span class="string" id="3706573">&#39;f&#39;</span><span class="op" id="3706576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706580">return</span>&nbsp;<span class="ident" id="3706587">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706593">case</span>&nbsp;<span class="string" id="3706598">&#39;A&#39;</span>&nbsp;<span class="op" id="3706602">&lt;=</span>&nbsp;<span class="ident" id="3706605">c</span>&nbsp;<span class="op" id="3706607">&amp;&amp;</span>&nbsp;<span class="ident" id="3706610">c</span>&nbsp;<span class="op" id="3706612">&lt;=</span>&nbsp;<span class="string" id="3706615">&#39;F&#39;</span><span class="op" id="3706618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706622">return</span>&nbsp;<span class="ident" id="3706629">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706635">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706638">return</span>&nbsp;<span class="ident" id="3706645">false</span><br>
<span class="lineno"></span><span class="op" id="3706651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3706654">func</span>&nbsp;<span class="ident" id="3706659">unhex</span><span class="op" id="3706664">(</span><span class="ident" id="3706665">c</span>&nbsp;<span class="builtintype" id="3706667">byte</span><span class="op" id="3706671">)</span>&nbsp;<span class="builtintype" id="3706673">byte</span>&nbsp;<span class="op" id="3706678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706681">switch</span>&nbsp;<span class="op" id="3706688">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706691">case</span>&nbsp;<span class="string" id="3706696">&#39;0&#39;</span>&nbsp;<span class="op" id="3706700">&lt;=</span>&nbsp;<span class="ident" id="3706703">c</span>&nbsp;<span class="op" id="3706705">&amp;&amp;</span>&nbsp;<span class="ident" id="3706708">c</span>&nbsp;<span class="op" id="3706710">&lt;=</span>&nbsp;<span class="string" id="3706713">&#39;9&#39;</span><span class="op" id="3706716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706720">return</span>&nbsp;<span class="ident" id="3706727">c</span>&nbsp;<span class="op" id="3706729">-</span>&nbsp;<span class="string" id="3706731">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706736">case</span>&nbsp;<span class="string" id="3706741">&#39;a&#39;</span>&nbsp;<span class="op" id="3706745">&lt;=</span>&nbsp;<span class="ident" id="3706748">c</span>&nbsp;<span class="op" id="3706750">&amp;&amp;</span>&nbsp;<span class="ident" id="3706753">c</span>&nbsp;<span class="op" id="3706755">&lt;=</span>&nbsp;<span class="string" id="3706758">&#39;f&#39;</span><span class="op" id="3706761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706765">return</span>&nbsp;<span class="ident" id="3706772">c</span>&nbsp;<span class="op" id="3706774">-</span>&nbsp;<span class="string" id="3706776">&#39;a&#39;</span>&nbsp;<span class="op" id="3706780">+</span>&nbsp;<span class="num" id="3706782">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706786">case</span>&nbsp;<span class="string" id="3706791">&#39;A&#39;</span>&nbsp;<span class="op" id="3706795">&lt;=</span>&nbsp;<span class="ident" id="3706798">c</span>&nbsp;<span class="op" id="3706800">&amp;&amp;</span>&nbsp;<span class="ident" id="3706803">c</span>&nbsp;<span class="op" id="3706805">&lt;=</span>&nbsp;<span class="string" id="3706808">&#39;F&#39;</span><span class="op" id="3706811">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706815">return</span>&nbsp;<span class="ident" id="3706822">c</span>&nbsp;<span class="op" id="3706824">-</span>&nbsp;<span class="string" id="3706826">&#39;A&#39;</span>&nbsp;<span class="op" id="3706830">+</span>&nbsp;<span class="num" id="3706832">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706839">return</span>&nbsp;<span class="num" id="3706846">0</span><br>
<span class="lineno"></span><span class="op" id="3706848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="3706851">type</span>&nbsp;<span class="ident" id="3706856">encoding</span>&nbsp;<span class="builtintype" id="3706865">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3706870">const</span>&nbsp;<span class="op" id="3706876">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706879">encodePath</span>&nbsp;<span class="ident" id="3706890">encoding</span>&nbsp;<span class="op" id="3706899">=</span>&nbsp;<span class="num" id="3706901">1</span>&nbsp;<span class="op" id="3706903">+</span>&nbsp;<span class="ident" id="3706905">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706911">encodeUserPassword</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706931">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706953">encodeFragment</span><br>
<span class="lineno"></span><span class="op" id="3706968">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3706971">type</span>&nbsp;<span class="ident" id="3706976">EscapeError</span>&nbsp;<span class="builtintype" id="3706988">string</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3706996">func</span>&nbsp;<span class="op" id="3707001">(</span><span class="ident" id="3707002">e</span>&nbsp;<span class="ident" id="3707004">EscapeError</span><span class="op" id="3707015">)</span>&nbsp;<span class="ident" id="3707017">Error</span><span class="op" id="3707022">(</span><span class="op" id="3707023">)</span>&nbsp;<span class="builtintype" id="3707025">string</span>&nbsp;<span class="op" id="3707032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707035">return</span>&nbsp;<span class="string" id="3707042">&#34;invalid&nbsp;URL&nbsp;escape&nbsp;&#34;</span>&nbsp;<span class="op" id="3707064">+</span>&nbsp;<span class="ident" id="3707066">strconv</span><span class="op" id="3707073">.</span><span class="ident" id="3707074">Quote</span><span class="op" id="3707079">(</span><span class="builtintype" id="3707080">string</span><span class="op" id="3707086">(</span><span class="ident" id="3707087">e</span><span class="op" id="3707088">)</span><span class="op" id="3707089">)</span><br>
<span class="lineno"></span><span class="op" id="3707091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3707094">//&nbsp;Return&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;character&nbsp;should&nbsp;be&nbsp;escaped&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3707159">//&nbsp;appearing&nbsp;in&nbsp;a&nbsp;URL&nbsp;string,&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3707212">func</span>&nbsp;<span class="ident" id="3707217">shouldEscape</span><span class="op" id="3707229">(</span><span class="ident" id="3707230">c</span>&nbsp;<span class="builtintype" id="3707232">byte</span><span class="op" id="3707236">,</span>&nbsp;<span class="ident" id="3707238">mode</span>&nbsp;<span class="ident" id="3707243">encoding</span><span class="op" id="3707251">)</span>&nbsp;<span class="builtintype" id="3707253">bool</span>&nbsp;<span class="op" id="3707258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707261">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(alphanum)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707304">if</span>&nbsp;<span class="string" id="3707307">&#39;A&#39;</span>&nbsp;<span class="op" id="3707311">&lt;=</span>&nbsp;<span class="ident" id="3707314">c</span>&nbsp;<span class="op" id="3707316">&amp;&amp;</span>&nbsp;<span class="ident" id="3707319">c</span>&nbsp;<span class="op" id="3707321">&lt;=</span>&nbsp;<span class="string" id="3707324">&#39;Z&#39;</span>&nbsp;<span class="op" id="3707328">||</span>&nbsp;<span class="string" id="3707331">&#39;a&#39;</span>&nbsp;<span class="op" id="3707335">&lt;=</span>&nbsp;<span class="ident" id="3707338">c</span>&nbsp;<span class="op" id="3707340">&amp;&amp;</span>&nbsp;<span class="ident" id="3707343">c</span>&nbsp;<span class="op" id="3707345">&lt;=</span>&nbsp;<span class="string" id="3707348">&#39;z&#39;</span>&nbsp;<span class="op" id="3707352">||</span>&nbsp;<span class="string" id="3707355">&#39;0&#39;</span>&nbsp;<span class="op" id="3707359">&lt;=</span>&nbsp;<span class="ident" id="3707362">c</span>&nbsp;<span class="op" id="3707364">&amp;&amp;</span>&nbsp;<span class="ident" id="3707367">c</span>&nbsp;<span class="op" id="3707369">&lt;=</span>&nbsp;<span class="string" id="3707372">&#39;9&#39;</span>&nbsp;<span class="op" id="3707376">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707380">return</span>&nbsp;<span class="ident" id="3707387">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707398">switch</span>&nbsp;<span class="ident" id="3707405">c</span>&nbsp;<span class="op" id="3707407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707410">case</span>&nbsp;<span class="string" id="3707415">&#39;-&#39;</span><span class="op" id="3707418">,</span>&nbsp;<span class="string" id="3707420">&#39;_&#39;</span><span class="op" id="3707423">,</span>&nbsp;<span class="string" id="3707425">&#39;.&#39;</span><span class="op" id="3707428">,</span>&nbsp;<span class="string" id="3707430">&#39;~&#39;</span><span class="op" id="3707433">:</span>&nbsp;<span class="comment" id="3707435">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(mark)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707475">return</span>&nbsp;<span class="ident" id="3707482">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707490">case</span>&nbsp;<span class="string" id="3707495">&#39;$&#39;</span><span class="op" id="3707498">,</span>&nbsp;<span class="string" id="3707500">&#39;&amp;&#39;</span><span class="op" id="3707503">,</span>&nbsp;<span class="string" id="3707505">&#39;+&#39;</span><span class="op" id="3707508">,</span>&nbsp;<span class="string" id="3707510">&#39;,&#39;</span><span class="op" id="3707513">,</span>&nbsp;<span class="string" id="3707515">&#39;/&#39;</span><span class="op" id="3707518">,</span>&nbsp;<span class="string" id="3707520">&#39;:&#39;</span><span class="op" id="3707523">,</span>&nbsp;<span class="string" id="3707525">&#39;;&#39;</span><span class="op" id="3707528">,</span>&nbsp;<span class="string" id="3707530">&#39;=&#39;</span><span class="op" id="3707533">,</span>&nbsp;<span class="string" id="3707535">&#39;?&#39;</span><span class="op" id="3707538">,</span>&nbsp;<span class="string" id="3707540">&#39;@&#39;</span><span class="op" id="3707543">:</span>&nbsp;<span class="comment" id="3707545">//&nbsp;§2.2&nbsp;Reserved&nbsp;characters&nbsp;(reserved)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707587">//&nbsp;Different&nbsp;sections&nbsp;of&nbsp;the&nbsp;URL&nbsp;allow&nbsp;a&nbsp;few&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707637">//&nbsp;the&nbsp;reserved&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707687">switch</span>&nbsp;<span class="ident" id="3707694">mode</span>&nbsp;<span class="op" id="3707699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707703">case</span>&nbsp;<span class="ident" id="3707708">encodePath</span><span class="op" id="3707718">:</span>&nbsp;<span class="comment" id="3707720">//&nbsp;§3.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707732">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;:&nbsp;@&nbsp;&amp;&nbsp;=&nbsp;+&nbsp;$&nbsp;but&nbsp;saves&nbsp;/&nbsp;;&nbsp;,&nbsp;for&nbsp;assigning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707795">//&nbsp;meaning&nbsp;to&nbsp;individual&nbsp;path&nbsp;segments.&nbsp;This&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707851">//&nbsp;only&nbsp;manipulates&nbsp;the&nbsp;path&nbsp;as&nbsp;a&nbsp;whole,&nbsp;so&nbsp;we&nbsp;allow&nbsp;those</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707913">//&nbsp;last&nbsp;two&nbsp;as&nbsp;well.&nbsp;That&nbsp;leaves&nbsp;only&nbsp;?&nbsp;to&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707967">return</span>&nbsp;<span class="ident" id="3707974">c</span>&nbsp;<span class="op" id="3707976">==</span>&nbsp;<span class="string" id="3707979">&#39;?&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707986">case</span>&nbsp;<span class="ident" id="3707991">encodeUserPassword</span><span class="op" id="3708009">:</span>&nbsp;<span class="comment" id="3708011">//&nbsp;§3.2.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708025">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;&#39;;&#39;,&nbsp;&#39;:&#39;,&nbsp;&#39;&amp;&#39;,&nbsp;&#39;=&#39;,&nbsp;&#39;+&#39;,&nbsp;&#39;$&#39;,&nbsp;and&nbsp;&#39;,&#39;&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708087">//&nbsp;userinfo,&nbsp;so&nbsp;we&nbsp;must&nbsp;escape&nbsp;only&nbsp;&#39;@&#39;,&nbsp;&#39;/&#39;,&nbsp;and&nbsp;&#39;?&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708145">//&nbsp;The&nbsp;parsing&nbsp;of&nbsp;userinfo&nbsp;treats&nbsp;&#39;:&#39;&nbsp;as&nbsp;special&nbsp;so&nbsp;we&nbsp;must&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708215">//&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708231">return</span>&nbsp;<span class="ident" id="3708238">c</span>&nbsp;<span class="op" id="3708240">==</span>&nbsp;<span class="string" id="3708243">&#39;@&#39;</span>&nbsp;<span class="op" id="3708247">||</span>&nbsp;<span class="ident" id="3708250">c</span>&nbsp;<span class="op" id="3708252">==</span>&nbsp;<span class="string" id="3708255">&#39;/&#39;</span>&nbsp;<span class="op" id="3708259">||</span>&nbsp;<span class="ident" id="3708262">c</span>&nbsp;<span class="op" id="3708264">==</span>&nbsp;<span class="string" id="3708267">&#39;?&#39;</span>&nbsp;<span class="op" id="3708271">||</span>&nbsp;<span class="ident" id="3708274">c</span>&nbsp;<span class="op" id="3708276">==</span>&nbsp;<span class="string" id="3708279">&#39;:&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708286">case</span>&nbsp;<span class="ident" id="3708291">encodeQueryComponent</span><span class="op" id="3708311">:</span>&nbsp;<span class="comment" id="3708313">//&nbsp;§3.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708325">//&nbsp;The&nbsp;RFC&nbsp;reserves&nbsp;(so&nbsp;we&nbsp;must&nbsp;escape)&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708380">return</span>&nbsp;<span class="ident" id="3708387">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708395">case</span>&nbsp;<span class="ident" id="3708400">encodeFragment</span><span class="op" id="3708414">:</span>&nbsp;<span class="comment" id="3708416">//&nbsp;§4.1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708428">//&nbsp;The&nbsp;RFC&nbsp;text&nbsp;is&nbsp;silent&nbsp;but&nbsp;the&nbsp;grammar&nbsp;allows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708480">//&nbsp;everything,&nbsp;so&nbsp;escape&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708517">return</span>&nbsp;<span class="ident" id="3708524">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708535">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708539">//&nbsp;Everything&nbsp;else&nbsp;must&nbsp;be&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708576">return</span>&nbsp;<span class="ident" id="3708583">true</span><br>
<span class="lineno"></span><span class="op" id="3708588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3708591">//&nbsp;QueryUnescape&nbsp;does&nbsp;the&nbsp;inverse&nbsp;transformation&nbsp;of&nbsp;QueryEscape,&nbsp;converting</span><br>
<span class="lineno"></span><span class="comment" id="3708667">//&nbsp;%AB&nbsp;into&nbsp;the&nbsp;byte&nbsp;0xAB&nbsp;and&nbsp;&#39;+&#39;&nbsp;into&nbsp;&#39;&nbsp;&#39;&nbsp;(space).&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3708742">//&nbsp;any&nbsp;%&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hexadecimal&nbsp;digits.</span><br>
<span class="lineno"></span><span class="keyword" id="3708794">func</span>&nbsp;<span class="ident" id="3708799">QueryUnescape</span><span class="op" id="3708812">(</span><span class="ident" id="3708813">s</span>&nbsp;<span class="builtintype" id="3708815">string</span><span class="op" id="3708821">)</span>&nbsp;<span class="op" id="3708823">(</span><span class="builtintype" id="3708824">string</span><span class="op" id="3708830">,</span>&nbsp;<span class="builtintype" id="3708832">error</span><span class="op" id="3708837">)</span>&nbsp;<span class="op" id="3708839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708842">return</span>&nbsp;<span class="ident" id="3708849">unescape</span><span class="op" id="3708857">(</span><span class="ident" id="3708858">s</span><span class="op" id="3708859">,</span>&nbsp;<span class="ident" id="3708861">encodeQueryComponent</span><span class="op" id="3708881">)</span><br>
<span class="lineno">115</span><span class="op" id="3708883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3708886">//&nbsp;unescape&nbsp;unescapes&nbsp;a&nbsp;string;&nbsp;the&nbsp;mode&nbsp;specifies</span><br>
<span class="lineno"></span><span class="comment" id="3708937">//&nbsp;which&nbsp;section&nbsp;of&nbsp;the&nbsp;URL&nbsp;string&nbsp;is&nbsp;being&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3708992">func</span>&nbsp;<span class="ident" id="3708997">unescape</span><span class="op" id="3709005">(</span><span class="ident" id="3709006">s</span>&nbsp;<span class="builtintype" id="3709008">string</span><span class="op" id="3709014">,</span>&nbsp;<span class="ident" id="3709016">mode</span>&nbsp;<span class="ident" id="3709021">encoding</span><span class="op" id="3709029">)</span>&nbsp;<span class="op" id="3709031">(</span><span class="builtintype" id="3709032">string</span><span class="op" id="3709038">,</span>&nbsp;<span class="builtintype" id="3709040">error</span><span class="op" id="3709045">)</span>&nbsp;<span class="op" id="3709047">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709050">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709095">n</span>&nbsp;<span class="op" id="3709097">:=</span>&nbsp;<span class="num" id="3709100">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709103">hasPlus</span>&nbsp;<span class="op" id="3709111">:=</span>&nbsp;<span class="ident" id="3709114">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709121">for</span>&nbsp;<span class="ident" id="3709125">i</span>&nbsp;<span class="op" id="3709127">:=</span>&nbsp;<span class="num" id="3709130">0</span><span class="op" id="3709131">;</span>&nbsp;<span class="ident" id="3709133">i</span>&nbsp;<span class="op" id="3709135">&lt;</span>&nbsp;<span class="builtinfunc" id="3709137">len</span><span class="op" id="3709140">(</span><span class="ident" id="3709141">s</span><span class="op" id="3709142">)</span><span class="op" id="3709143">;</span>&nbsp;<span class="op" id="3709145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709149">switch</span>&nbsp;<span class="ident" id="3709156">s</span><span class="op" id="3709157">[</span><span class="ident" id="3709158">i</span><span class="op" id="3709159">]</span>&nbsp;<span class="op" id="3709161">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709165">case</span>&nbsp;<span class="string" id="3709170">&#39;%&#39;</span><span class="op" id="3709173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709178">n</span><span class="op" id="3709179">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709185">if</span>&nbsp;<span class="ident" id="3709188">i</span><span class="op" id="3709189">+</span><span class="num" id="3709190">2</span>&nbsp;<span class="op" id="3709192">&gt;=</span>&nbsp;<span class="builtinfunc" id="3709195">len</span><span class="op" id="3709198">(</span><span class="ident" id="3709199">s</span><span class="op" id="3709200">)</span>&nbsp;<span class="op" id="3709202">||</span>&nbsp;<span class="op" id="3709205">!</span><span class="ident" id="3709206">ishex</span><span class="op" id="3709211">(</span><span class="ident" id="3709212">s</span><span class="op" id="3709213">[</span><span class="ident" id="3709214">i</span><span class="op" id="3709215">+</span><span class="num" id="3709216">1</span><span class="op" id="3709217">]</span><span class="op" id="3709218">)</span>&nbsp;<span class="op" id="3709220">||</span>&nbsp;<span class="op" id="3709223">!</span><span class="ident" id="3709224">ishex</span><span class="op" id="3709229">(</span><span class="ident" id="3709230">s</span><span class="op" id="3709231">[</span><span class="ident" id="3709232">i</span><span class="op" id="3709233">+</span><span class="num" id="3709234">2</span><span class="op" id="3709235">]</span><span class="op" id="3709236">)</span>&nbsp;<span class="op" id="3709238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709244">s</span>&nbsp;<span class="op" id="3709246">=</span>&nbsp;<span class="ident" id="3709248">s</span><span class="op" id="3709249">[</span><span class="ident" id="3709250">i</span><span class="op" id="3709251">:</span><span class="op" id="3709252">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709258">if</span>&nbsp;<span class="builtinfunc" id="3709261">len</span><span class="op" id="3709264">(</span><span class="ident" id="3709265">s</span><span class="op" id="3709266">)</span>&nbsp;<span class="op" id="3709268">&gt;</span>&nbsp;<span class="num" id="3709270">3</span>&nbsp;<span class="op" id="3709272">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709279">s</span>&nbsp;<span class="op" id="3709281">=</span>&nbsp;<span class="ident" id="3709283">s</span><span class="op" id="3709284">[</span><span class="num" id="3709285">0</span><span class="op" id="3709286">:</span><span class="num" id="3709287">3</span><span class="op" id="3709288">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709300">return</span>&nbsp;<span class="string" id="3709307">&#34;&#34;</span><span class="op" id="3709309">,</span>&nbsp;<span class="ident" id="3709311">EscapeError</span><span class="op" id="3709322">(</span><span class="ident" id="3709323">s</span><span class="op" id="3709324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709334">i</span>&nbsp;<span class="op" id="3709336">+=</span>&nbsp;<span class="num" id="3709339">3</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709343">case</span>&nbsp;<span class="string" id="3709348">&#39;+&#39;</span><span class="op" id="3709351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709356">hasPlus</span>&nbsp;<span class="op" id="3709364">=</span>&nbsp;<span class="ident" id="3709366">mode</span>&nbsp;<span class="op" id="3709371">==</span>&nbsp;<span class="ident" id="3709374">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709398">i</span><span class="op" id="3709399">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709404">default</span><span class="op" id="3709411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709416">i</span><span class="op" id="3709417">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709429">if</span>&nbsp;<span class="ident" id="3709432">n</span>&nbsp;<span class="op" id="3709434">==</span>&nbsp;<span class="num" id="3709437">0</span>&nbsp;<span class="op" id="3709439">&amp;&amp;</span>&nbsp;<span class="op" id="3709442">!</span><span class="ident" id="3709443">hasPlus</span>&nbsp;<span class="op" id="3709451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709455">return</span>&nbsp;<span class="ident" id="3709462">s</span><span class="op" id="3709463">,</span>&nbsp;<span class="ident" id="3709465">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709474">t</span>&nbsp;<span class="op" id="3709476">:=</span>&nbsp;<span class="builtinfunc" id="3709479">make</span><span class="op" id="3709483">(</span><span class="op" id="3709484">[</span><span class="op" id="3709485">]</span><span class="builtintype" id="3709486">byte</span><span class="op" id="3709490">,</span>&nbsp;<span class="builtinfunc" id="3709492">len</span><span class="op" id="3709495">(</span><span class="ident" id="3709496">s</span><span class="op" id="3709497">)</span><span class="op" id="3709498">-</span><span class="num" id="3709499">2</span><span class="op" id="3709500">*</span><span class="ident" id="3709501">n</span><span class="op" id="3709502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709505">j</span>&nbsp;<span class="op" id="3709507">:=</span>&nbsp;<span class="num" id="3709510">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709513">for</span>&nbsp;<span class="ident" id="3709517">i</span>&nbsp;<span class="op" id="3709519">:=</span>&nbsp;<span class="num" id="3709522">0</span><span class="op" id="3709523">;</span>&nbsp;<span class="ident" id="3709525">i</span>&nbsp;<span class="op" id="3709527">&lt;</span>&nbsp;<span class="builtinfunc" id="3709529">len</span><span class="op" id="3709532">(</span><span class="ident" id="3709533">s</span><span class="op" id="3709534">)</span><span class="op" id="3709535">;</span>&nbsp;<span class="op" id="3709537">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709541">switch</span>&nbsp;<span class="ident" id="3709548">s</span><span class="op" id="3709549">[</span><span class="ident" id="3709550">i</span><span class="op" id="3709551">]</span>&nbsp;<span class="op" id="3709553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709557">case</span>&nbsp;<span class="string" id="3709562">&#39;%&#39;</span><span class="op" id="3709565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709570">t</span><span class="op" id="3709571">[</span><span class="ident" id="3709572">j</span><span class="op" id="3709573">]</span>&nbsp;<span class="op" id="3709575">=</span>&nbsp;<span class="ident" id="3709577">unhex</span><span class="op" id="3709582">(</span><span class="ident" id="3709583">s</span><span class="op" id="3709584">[</span><span class="ident" id="3709585">i</span><span class="op" id="3709586">+</span><span class="num" id="3709587">1</span><span class="op" id="3709588">]</span><span class="op" id="3709589">)</span><span class="op" id="3709590">&lt;&lt;</span><span class="num" id="3709592">4</span>&nbsp;<span class="op" id="3709594">|</span>&nbsp;<span class="ident" id="3709596">unhex</span><span class="op" id="3709601">(</span><span class="ident" id="3709602">s</span><span class="op" id="3709603">[</span><span class="ident" id="3709604">i</span><span class="op" id="3709605">+</span><span class="num" id="3709606">2</span><span class="op" id="3709607">]</span><span class="op" id="3709608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709613">j</span><span class="op" id="3709614">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709620">i</span>&nbsp;<span class="op" id="3709622">+=</span>&nbsp;<span class="num" id="3709625">3</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709629">case</span>&nbsp;<span class="string" id="3709634">&#39;+&#39;</span><span class="op" id="3709637">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709642">if</span>&nbsp;<span class="ident" id="3709645">mode</span>&nbsp;<span class="op" id="3709650">==</span>&nbsp;<span class="ident" id="3709653">encodeQueryComponent</span>&nbsp;<span class="op" id="3709674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709680">t</span><span class="op" id="3709681">[</span><span class="ident" id="3709682">j</span><span class="op" id="3709683">]</span>&nbsp;<span class="op" id="3709685">=</span>&nbsp;<span class="string" id="3709687">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709694">}</span>&nbsp;<span class="keyword" id="3709696">else</span>&nbsp;<span class="op" id="3709701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709707">t</span><span class="op" id="3709708">[</span><span class="ident" id="3709709">j</span><span class="op" id="3709710">]</span>&nbsp;<span class="op" id="3709712">=</span>&nbsp;<span class="string" id="3709714">&#39;+&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709726">j</span><span class="op" id="3709727">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709733">i</span><span class="op" id="3709734">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709739">default</span><span class="op" id="3709746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709751">t</span><span class="op" id="3709752">[</span><span class="ident" id="3709753">j</span><span class="op" id="3709754">]</span>&nbsp;<span class="op" id="3709756">=</span>&nbsp;<span class="ident" id="3709758">s</span><span class="op" id="3709759">[</span><span class="ident" id="3709760">i</span><span class="op" id="3709761">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709766">j</span><span class="op" id="3709767">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709773">i</span><span class="op" id="3709774">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709785">return</span>&nbsp;<span class="builtintype" id="3709792">string</span><span class="op" id="3709798">(</span><span class="ident" id="3709799">t</span><span class="op" id="3709800">)</span><span class="op" id="3709801">,</span>&nbsp;<span class="ident" id="3709803">nil</span><br>
<span class="lineno">170</span><span class="op" id="3709807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3709810">//&nbsp;QueryEscape&nbsp;escapes&nbsp;the&nbsp;string&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;safely&nbsp;placed</span><br>
<span class="lineno"></span><span class="comment" id="3709871">//&nbsp;inside&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="3709894">func</span>&nbsp;<span class="ident" id="3709899">QueryEscape</span><span class="op" id="3709910">(</span><span class="ident" id="3709911">s</span>&nbsp;<span class="builtintype" id="3709913">string</span><span class="op" id="3709919">)</span>&nbsp;<span class="builtintype" id="3709921">string</span>&nbsp;<span class="op" id="3709928">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709931">return</span>&nbsp;<span class="ident" id="3709938">escape</span><span class="op" id="3709944">(</span><span class="ident" id="3709945">s</span><span class="op" id="3709946">,</span>&nbsp;<span class="ident" id="3709948">encodeQueryComponent</span><span class="op" id="3709968">)</span><br>
<span class="lineno"></span><span class="op" id="3709970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3709973">func</span>&nbsp;<span class="ident" id="3709978">escape</span><span class="op" id="3709984">(</span><span class="ident" id="3709985">s</span>&nbsp;<span class="builtintype" id="3709987">string</span><span class="op" id="3709993">,</span>&nbsp;<span class="ident" id="3709995">mode</span>&nbsp;<span class="ident" id="3710000">encoding</span><span class="op" id="3710008">)</span>&nbsp;<span class="builtintype" id="3710010">string</span>&nbsp;<span class="op" id="3710017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710020">spaceCount</span><span class="op" id="3710030">,</span>&nbsp;<span class="ident" id="3710032">hexCount</span>&nbsp;<span class="op" id="3710041">:=</span>&nbsp;<span class="num" id="3710044">0</span><span class="op" id="3710045">,</span>&nbsp;<span class="num" id="3710047">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710050">for</span>&nbsp;<span class="ident" id="3710054">i</span>&nbsp;<span class="op" id="3710056">:=</span>&nbsp;<span class="num" id="3710059">0</span><span class="op" id="3710060">;</span>&nbsp;<span class="ident" id="3710062">i</span>&nbsp;<span class="op" id="3710064">&lt;</span>&nbsp;<span class="builtinfunc" id="3710066">len</span><span class="op" id="3710069">(</span><span class="ident" id="3710070">s</span><span class="op" id="3710071">)</span><span class="op" id="3710072">;</span>&nbsp;<span class="ident" id="3710074">i</span><span class="op" id="3710075">++</span>&nbsp;<span class="op" id="3710078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710082">c</span>&nbsp;<span class="op" id="3710084">:=</span>&nbsp;<span class="ident" id="3710087">s</span><span class="op" id="3710088">[</span><span class="ident" id="3710089">i</span><span class="op" id="3710090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710094">if</span>&nbsp;<span class="ident" id="3710097">shouldEscape</span><span class="op" id="3710109">(</span><span class="ident" id="3710110">c</span><span class="op" id="3710111">,</span>&nbsp;<span class="ident" id="3710113">mode</span><span class="op" id="3710117">)</span>&nbsp;<span class="op" id="3710119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710124">if</span>&nbsp;<span class="ident" id="3710127">c</span>&nbsp;<span class="op" id="3710129">==</span>&nbsp;<span class="string" id="3710132">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3710136">&amp;&amp;</span>&nbsp;<span class="ident" id="3710139">mode</span>&nbsp;<span class="op" id="3710144">==</span>&nbsp;<span class="ident" id="3710147">encodeQueryComponent</span>&nbsp;<span class="op" id="3710168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710174">spaceCount</span><span class="op" id="3710184">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710190">}</span>&nbsp;<span class="keyword" id="3710192">else</span>&nbsp;<span class="op" id="3710197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710203">hexCount</span><span class="op" id="3710211">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710224">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710228">if</span>&nbsp;<span class="ident" id="3710231">spaceCount</span>&nbsp;<span class="op" id="3710242">==</span>&nbsp;<span class="num" id="3710245">0</span>&nbsp;<span class="op" id="3710247">&amp;&amp;</span>&nbsp;<span class="ident" id="3710250">hexCount</span>&nbsp;<span class="op" id="3710259">==</span>&nbsp;<span class="num" id="3710262">0</span>&nbsp;<span class="op" id="3710264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710268">return</span>&nbsp;<span class="ident" id="3710275">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710282">t</span>&nbsp;<span class="op" id="3710284">:=</span>&nbsp;<span class="builtinfunc" id="3710287">make</span><span class="op" id="3710291">(</span><span class="op" id="3710292">[</span><span class="op" id="3710293">]</span><span class="builtintype" id="3710294">byte</span><span class="op" id="3710298">,</span>&nbsp;<span class="builtinfunc" id="3710300">len</span><span class="op" id="3710303">(</span><span class="ident" id="3710304">s</span><span class="op" id="3710305">)</span><span class="op" id="3710306">+</span><span class="num" id="3710307">2</span><span class="op" id="3710308">*</span><span class="ident" id="3710309">hexCount</span><span class="op" id="3710317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710320">j</span>&nbsp;<span class="op" id="3710322">:=</span>&nbsp;<span class="num" id="3710325">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710328">for</span>&nbsp;<span class="ident" id="3710332">i</span>&nbsp;<span class="op" id="3710334">:=</span>&nbsp;<span class="num" id="3710337">0</span><span class="op" id="3710338">;</span>&nbsp;<span class="ident" id="3710340">i</span>&nbsp;<span class="op" id="3710342">&lt;</span>&nbsp;<span class="builtinfunc" id="3710344">len</span><span class="op" id="3710347">(</span><span class="ident" id="3710348">s</span><span class="op" id="3710349">)</span><span class="op" id="3710350">;</span>&nbsp;<span class="ident" id="3710352">i</span><span class="op" id="3710353">++</span>&nbsp;<span class="op" id="3710356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710360">switch</span>&nbsp;<span class="ident" id="3710367">c</span>&nbsp;<span class="op" id="3710369">:=</span>&nbsp;<span class="ident" id="3710372">s</span><span class="op" id="3710373">[</span><span class="ident" id="3710374">i</span><span class="op" id="3710375">]</span><span class="op" id="3710376">;</span>&nbsp;<span class="op" id="3710378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710382">case</span>&nbsp;<span class="ident" id="3710387">c</span>&nbsp;<span class="op" id="3710389">==</span>&nbsp;<span class="string" id="3710392">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3710396">&amp;&amp;</span>&nbsp;<span class="ident" id="3710399">mode</span>&nbsp;<span class="op" id="3710404">==</span>&nbsp;<span class="ident" id="3710407">encodeQueryComponent</span><span class="op" id="3710427">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710432">t</span><span class="op" id="3710433">[</span><span class="ident" id="3710434">j</span><span class="op" id="3710435">]</span>&nbsp;<span class="op" id="3710437">=</span>&nbsp;<span class="string" id="3710439">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710446">j</span><span class="op" id="3710447">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710452">case</span>&nbsp;<span class="ident" id="3710457">shouldEscape</span><span class="op" id="3710469">(</span><span class="ident" id="3710470">c</span><span class="op" id="3710471">,</span>&nbsp;<span class="ident" id="3710473">mode</span><span class="op" id="3710477">)</span><span class="op" id="3710478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710483">t</span><span class="op" id="3710484">[</span><span class="ident" id="3710485">j</span><span class="op" id="3710486">]</span>&nbsp;<span class="op" id="3710488">=</span>&nbsp;<span class="string" id="3710490">&#39;%&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710497">t</span><span class="op" id="3710498">[</span><span class="ident" id="3710499">j</span><span class="op" id="3710500">+</span><span class="num" id="3710501">1</span><span class="op" id="3710502">]</span>&nbsp;<span class="op" id="3710504">=</span>&nbsp;<span class="string" id="3710506">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3710524">[</span><span class="ident" id="3710525">c</span><span class="op" id="3710526">&gt;&gt;</span><span class="num" id="3710528">4</span><span class="op" id="3710529">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710534">t</span><span class="op" id="3710535">[</span><span class="ident" id="3710536">j</span><span class="op" id="3710537">+</span><span class="num" id="3710538">2</span><span class="op" id="3710539">]</span>&nbsp;<span class="op" id="3710541">=</span>&nbsp;<span class="string" id="3710543">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3710561">[</span><span class="ident" id="3710562">c</span><span class="op" id="3710563">&amp;</span><span class="num" id="3710564">15</span><span class="op" id="3710566">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710571">j</span>&nbsp;<span class="op" id="3710573">+=</span>&nbsp;<span class="num" id="3710576">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710580">default</span><span class="op" id="3710587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710592">t</span><span class="op" id="3710593">[</span><span class="ident" id="3710594">j</span><span class="op" id="3710595">]</span>&nbsp;<span class="op" id="3710597">=</span>&nbsp;<span class="ident" id="3710599">s</span><span class="op" id="3710600">[</span><span class="ident" id="3710601">i</span><span class="op" id="3710602">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710607">j</span><span class="op" id="3710608">++</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710619">return</span>&nbsp;<span class="builtintype" id="3710626">string</span><span class="op" id="3710632">(</span><span class="ident" id="3710633">t</span><span class="op" id="3710634">)</span><br>
<span class="lineno"></span><span class="op" id="3710636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3710639">//&nbsp;A&nbsp;URL&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;URL&nbsp;(technically,&nbsp;a&nbsp;URI&nbsp;reference).</span><br>
<span class="lineno"></span><span class="comment" id="3710704">//&nbsp;The&nbsp;general&nbsp;form&nbsp;represented&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3710740">//</span><br>
<span class="lineno"></span><span class="comment" id="3710743">//&nbsp;&nbsp;&nbsp;&nbspscheme://[userinfo@]host/path[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3710795">//</span><br>
<span class="lineno">220</span><span class="comment" id="3710798">//&nbsp;URLs&nbsp;that&nbsp;do&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;slash&nbsp;after&nbsp;the&nbsp;scheme&nbsp;are&nbsp;interpreted&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="3710874">//</span><br>
<span class="lineno"></span><span class="comment" id="3710877">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3710913">//</span><br>
<span class="lineno"></span><span class="comment" id="3710916">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Path&nbsp;field&nbsp;is&nbsp;stored&nbsp;in&nbsp;decoded&nbsp;form:&nbsp;/%47%6f%2f&nbsp;becomes&nbsp;/Go/.</span><br>
<span class="lineno">225</span><span class="comment" id="3710996">//&nbsp;A&nbsp;consequence&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;which&nbsp;slashes&nbsp;in&nbsp;the&nbsp;Path&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="3711077">//&nbsp;slashes&nbsp;in&nbsp;the&nbsp;raw&nbsp;URL&nbsp;and&nbsp;which&nbsp;were&nbsp;%2f.&nbsp;This&nbsp;distinction&nbsp;is&nbsp;rarely&nbsp;important,</span><br>
<span class="lineno"></span><span class="comment" id="3711161">//&nbsp;but&nbsp;when&nbsp;it&nbsp;is&nbsp;a&nbsp;client&nbsp;must&nbsp;use&nbsp;other&nbsp;routines&nbsp;to&nbsp;parse&nbsp;the&nbsp;raw&nbsp;URL&nbsp;or&nbsp;construct</span><br>
<span class="lineno"></span><span class="comment" id="3711246">//&nbsp;the&nbsp;parsed&nbsp;URL.&nbsp;For&nbsp;example,&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;consult&nbsp;req.RequestURI,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3711325">//&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;can&nbsp;use&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Opaque:&nbsp;&#34;//example.com/Go%2f&#34;}</span><br>
<span class="lineno">230</span><span class="comment" id="3711407">//&nbsp;instead&nbsp;of&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Path:&nbsp;&#34;/Go/&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="3711461">type</span>&nbsp;<span class="ident" id="3711466">URL</span>&nbsp;<span class="keyword" id="3711470">struct</span>&nbsp;<span class="op" id="3711477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711480">Scheme</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3711489">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711497">Opaque</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3711506">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3711516">//&nbsp;encoded&nbsp;opaque&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711540">User</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3711549">*</span><span class="ident" id="3711550">Userinfo</span>&nbsp;<span class="comment" id="3711559">//&nbsp;username&nbsp;and&nbsp;password&nbsp;information</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711597">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3711606">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3711616">//&nbsp;host&nbsp;or&nbsp;host:port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711638">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3711647">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711655">RawQuery</span>&nbsp;<span class="builtintype" id="3711664">string</span>&nbsp;<span class="comment" id="3711671">//&nbsp;encoded&nbsp;query&nbsp;values,&nbsp;without&nbsp;&#39;?&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711709">Fragment</span>&nbsp;<span class="builtintype" id="3711718">string</span>&nbsp;<span class="comment" id="3711725">//&nbsp;fragment&nbsp;for&nbsp;references,&nbsp;without&nbsp;&#39;#&#39;</span><br>
<span class="lineno"></span><span class="op" id="3711765">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3711768">//&nbsp;User&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3711828">//&nbsp;and&nbsp;no&nbsp;password&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3711852">func</span>&nbsp;<span class="ident" id="3711857">User</span><span class="op" id="3711861">(</span><span class="ident" id="3711862">username</span>&nbsp;<span class="builtintype" id="3711871">string</span><span class="op" id="3711877">)</span>&nbsp;<span class="op" id="3711879">*</span><span class="ident" id="3711880">Userinfo</span>&nbsp;<span class="op" id="3711889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711892">return</span>&nbsp;<span class="op" id="3711899">&amp;</span><span class="ident" id="3711900">Userinfo</span><span class="op" id="3711908">{</span><span class="ident" id="3711909">username</span><span class="op" id="3711917">,</span>&nbsp;<span class="string" id="3711919">&#34;&#34;</span><span class="op" id="3711921">,</span>&nbsp;<span class="ident" id="3711923">false</span><span class="op" id="3711928">}</span><br>
<span class="lineno">245</span><span class="op" id="3711930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3711933">//&nbsp;UserPassword&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3712001">//&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3712018">//&nbsp;This&nbsp;functionality&nbsp;should&nbsp;only&nbsp;be&nbsp;used&nbsp;with&nbsp;legacy&nbsp;web&nbsp;sites.</span><br>
<span class="lineno">250</span><span class="comment" id="3712083">//&nbsp;RFC&nbsp;2396&nbsp;warns&nbsp;that&nbsp;interpreting&nbsp;Userinfo&nbsp;this&nbsp;way</span><br>
<span class="lineno"></span><span class="comment" id="3712137">//&nbsp;``is&nbsp;NOT&nbsp;RECOMMENDED,&nbsp;because&nbsp;the&nbsp;passing&nbsp;of&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="3712200">//&nbsp;information&nbsp;in&nbsp;clear&nbsp;text&nbsp;(such&nbsp;as&nbsp;URI)&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3712262">//&nbsp;security&nbsp;risk&nbsp;in&nbsp;almost&nbsp;every&nbsp;case&nbsp;where&nbsp;it&nbsp;has&nbsp;been&nbsp;used.&#39;&#39;</span><br>
<span class="lineno"></span><span class="keyword" id="3712326">func</span>&nbsp;<span class="ident" id="3712331">UserPassword</span><span class="op" id="3712343">(</span><span class="ident" id="3712344">username</span><span class="op" id="3712352">,</span>&nbsp;<span class="ident" id="3712354">password</span>&nbsp;<span class="builtintype" id="3712363">string</span><span class="op" id="3712369">)</span>&nbsp;<span class="op" id="3712371">*</span><span class="ident" id="3712372">Userinfo</span>&nbsp;<span class="op" id="3712381">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712384">return</span>&nbsp;<span class="op" id="3712391">&amp;</span><span class="ident" id="3712392">Userinfo</span><span class="op" id="3712400">{</span><span class="ident" id="3712401">username</span><span class="op" id="3712409">,</span>&nbsp;<span class="ident" id="3712411">password</span><span class="op" id="3712419">,</span>&nbsp;<span class="ident" id="3712421">true</span><span class="op" id="3712425">}</span><br>
<span class="lineno"></span><span class="op" id="3712427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3712430">//&nbsp;The&nbsp;Userinfo&nbsp;type&nbsp;is&nbsp;an&nbsp;immutable&nbsp;encapsulation&nbsp;of&nbsp;username&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3712497">//&nbsp;password&nbsp;details&nbsp;for&nbsp;a&nbsp;URL.&nbsp;An&nbsp;existing&nbsp;Userinfo&nbsp;value&nbsp;is&nbsp;guaranteed</span><br>
<span class="lineno">260</span><span class="comment" id="3712569">//&nbsp;to&nbsp;have&nbsp;a&nbsp;username&nbsp;set&nbsp;(potentially&nbsp;empty,&nbsp;as&nbsp;allowed&nbsp;by&nbsp;RFC&nbsp;2396),</span><br>
<span class="lineno"></span><span class="comment" id="3712640">//&nbsp;and&nbsp;optionally&nbsp;a&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3712670">type</span>&nbsp;<span class="ident" id="3712675">Userinfo</span>&nbsp;<span class="keyword" id="3712684">struct</span>&nbsp;<span class="op" id="3712691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712694">username</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3712706">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712714">password</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3712726">string</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712734">passwordSet</span>&nbsp;<span class="builtintype" id="3712746">bool</span><br>
<span class="lineno"></span><span class="op" id="3712751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3712754">//&nbsp;Username&nbsp;returns&nbsp;the&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="3712788">func</span>&nbsp;<span class="op" id="3712793">(</span><span class="ident" id="3712794">u</span>&nbsp;<span class="op" id="3712796">*</span><span class="ident" id="3712797">Userinfo</span><span class="op" id="3712805">)</span>&nbsp;<span class="ident" id="3712807">Username</span><span class="op" id="3712815">(</span><span class="op" id="3712816">)</span>&nbsp;<span class="builtintype" id="3712818">string</span>&nbsp;<span class="op" id="3712825">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712828">return</span>&nbsp;<span class="ident" id="3712835">u</span><span class="op" id="3712836">.</span><span class="ident" id="3712837">username</span><br>
<span class="lineno"></span><span class="op" id="3712846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3712849">//&nbsp;Password&nbsp;returns&nbsp;the&nbsp;password&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;set,&nbsp;and&nbsp;whether&nbsp;it&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3712924">func</span>&nbsp;<span class="op" id="3712929">(</span><span class="ident" id="3712930">u</span>&nbsp;<span class="op" id="3712932">*</span><span class="ident" id="3712933">Userinfo</span><span class="op" id="3712941">)</span>&nbsp;<span class="ident" id="3712943">Password</span><span class="op" id="3712951">(</span><span class="op" id="3712952">)</span>&nbsp;<span class="op" id="3712954">(</span><span class="builtintype" id="3712955">string</span><span class="op" id="3712961">,</span>&nbsp;<span class="builtintype" id="3712963">bool</span><span class="op" id="3712967">)</span>&nbsp;<span class="op" id="3712969">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712972">if</span>&nbsp;<span class="ident" id="3712975">u</span><span class="op" id="3712976">.</span><span class="ident" id="3712977">passwordSet</span>&nbsp;<span class="op" id="3712989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712993">return</span>&nbsp;<span class="ident" id="3713000">u</span><span class="op" id="3713001">.</span><span class="ident" id="3713002">password</span><span class="op" id="3713010">,</span>&nbsp;<span class="ident" id="3713012">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713021">return</span>&nbsp;<span class="string" id="3713028">&#34;&#34;</span><span class="op" id="3713030">,</span>&nbsp;<span class="ident" id="3713032">false</span><br>
<span class="lineno"></span><span class="op" id="3713038">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3713041">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;userinfo&nbsp;information&nbsp;in&nbsp;the&nbsp;standard&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3713113">//&nbsp;of&nbsp;&#34;username[:password]&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3713142">func</span>&nbsp;<span class="op" id="3713147">(</span><span class="ident" id="3713148">u</span>&nbsp;<span class="op" id="3713150">*</span><span class="ident" id="3713151">Userinfo</span><span class="op" id="3713159">)</span>&nbsp;<span class="ident" id="3713161">String</span><span class="op" id="3713167">(</span><span class="op" id="3713168">)</span>&nbsp;<span class="builtintype" id="3713170">string</span>&nbsp;<span class="op" id="3713177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713180">s</span>&nbsp;<span class="op" id="3713182">:=</span>&nbsp;<span class="ident" id="3713185">escape</span><span class="op" id="3713191">(</span><span class="ident" id="3713192">u</span><span class="op" id="3713193">.</span><span class="ident" id="3713194">username</span><span class="op" id="3713202">,</span>&nbsp;<span class="ident" id="3713204">encodeUserPassword</span><span class="op" id="3713222">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713225">if</span>&nbsp;<span class="ident" id="3713228">u</span><span class="op" id="3713229">.</span><span class="ident" id="3713230">passwordSet</span>&nbsp;<span class="op" id="3713242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713246">s</span>&nbsp;<span class="op" id="3713248">+=</span>&nbsp;<span class="string" id="3713251">&#34;:&#34;</span>&nbsp;<span class="op" id="3713255">+</span>&nbsp;<span class="ident" id="3713257">escape</span><span class="op" id="3713263">(</span><span class="ident" id="3713264">u</span><span class="op" id="3713265">.</span><span class="ident" id="3713266">password</span><span class="op" id="3713274">,</span>&nbsp;<span class="ident" id="3713276">encodeUserPassword</span><span class="op" id="3713294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713300">return</span>&nbsp;<span class="ident" id="3713307">s</span><br>
<span class="lineno"></span><span class="op" id="3713309">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3713312">//&nbsp;Maybe&nbsp;rawurl&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;scheme:path.</span><br>
<span class="lineno"></span><span class="comment" id="3713356">//&nbsp;(Scheme&nbsp;must&nbsp;be&nbsp;[a-zA-Z][a-zA-Z0-9+-.]*)</span><br>
<span class="lineno"></span><span class="comment" id="3713400">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;scheme,&nbsp;path;&nbsp;else&nbsp;return&nbsp;&#34;&#34;,&nbsp;rawurl.</span><br>
<span class="lineno"></span><span class="keyword" id="3713455">func</span>&nbsp;<span class="ident" id="3713460">getscheme</span><span class="op" id="3713469">(</span><span class="ident" id="3713470">rawurl</span>&nbsp;<span class="builtintype" id="3713477">string</span><span class="op" id="3713483">)</span>&nbsp;<span class="op" id="3713485">(</span><span class="ident" id="3713486">scheme</span><span class="op" id="3713492">,</span>&nbsp;<span class="ident" id="3713494">path</span>&nbsp;<span class="builtintype" id="3713499">string</span><span class="op" id="3713505">,</span>&nbsp;<span class="ident" id="3713507">err</span>&nbsp;<span class="builtintype" id="3713511">error</span><span class="op" id="3713516">)</span>&nbsp;<span class="op" id="3713518">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713521">for</span>&nbsp;<span class="ident" id="3713525">i</span>&nbsp;<span class="op" id="3713527">:=</span>&nbsp;<span class="num" id="3713530">0</span><span class="op" id="3713531">;</span>&nbsp;<span class="ident" id="3713533">i</span>&nbsp;<span class="op" id="3713535">&lt;</span>&nbsp;<span class="builtinfunc" id="3713537">len</span><span class="op" id="3713540">(</span><span class="ident" id="3713541">rawurl</span><span class="op" id="3713547">)</span><span class="op" id="3713548">;</span>&nbsp;<span class="ident" id="3713550">i</span><span class="op" id="3713551">++</span>&nbsp;<span class="op" id="3713554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713558">c</span>&nbsp;<span class="op" id="3713560">:=</span>&nbsp;<span class="ident" id="3713563">rawurl</span><span class="op" id="3713569">[</span><span class="ident" id="3713570">i</span><span class="op" id="3713571">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713575">switch</span>&nbsp;<span class="op" id="3713582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713586">case</span>&nbsp;<span class="string" id="3713591">&#39;a&#39;</span>&nbsp;<span class="op" id="3713595">&lt;=</span>&nbsp;<span class="ident" id="3713598">c</span>&nbsp;<span class="op" id="3713600">&amp;&amp;</span>&nbsp;<span class="ident" id="3713603">c</span>&nbsp;<span class="op" id="3713605">&lt;=</span>&nbsp;<span class="string" id="3713608">&#39;z&#39;</span>&nbsp;<span class="op" id="3713612">||</span>&nbsp;<span class="string" id="3713615">&#39;A&#39;</span>&nbsp;<span class="op" id="3713619">&lt;=</span>&nbsp;<span class="ident" id="3713622">c</span>&nbsp;<span class="op" id="3713624">&amp;&amp;</span>&nbsp;<span class="ident" id="3713627">c</span>&nbsp;<span class="op" id="3713629">&lt;=</span>&nbsp;<span class="string" id="3713632">&#39;Z&#39;</span><span class="op" id="3713635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713639">//&nbsp;do&nbsp;nothing</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713655">case</span>&nbsp;<span class="string" id="3713660">&#39;0&#39;</span>&nbsp;<span class="op" id="3713664">&lt;=</span>&nbsp;<span class="ident" id="3713667">c</span>&nbsp;<span class="op" id="3713669">&amp;&amp;</span>&nbsp;<span class="ident" id="3713672">c</span>&nbsp;<span class="op" id="3713674">&lt;=</span>&nbsp;<span class="string" id="3713677">&#39;9&#39;</span>&nbsp;<span class="op" id="3713681">||</span>&nbsp;<span class="ident" id="3713684">c</span>&nbsp;<span class="op" id="3713686">==</span>&nbsp;<span class="string" id="3713689">&#39;+&#39;</span>&nbsp;<span class="op" id="3713693">||</span>&nbsp;<span class="ident" id="3713696">c</span>&nbsp;<span class="op" id="3713698">==</span>&nbsp;<span class="string" id="3713701">&#39;-&#39;</span>&nbsp;<span class="op" id="3713705">||</span>&nbsp;<span class="ident" id="3713708">c</span>&nbsp;<span class="op" id="3713710">==</span>&nbsp;<span class="string" id="3713713">&#39;.&#39;</span><span class="op" id="3713716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713721">if</span>&nbsp;<span class="ident" id="3713724">i</span>&nbsp;<span class="op" id="3713726">==</span>&nbsp;<span class="num" id="3713729">0</span>&nbsp;<span class="op" id="3713731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713737">return</span>&nbsp;<span class="string" id="3713744">&#34;&#34;</span><span class="op" id="3713746">,</span>&nbsp;<span class="ident" id="3713748">rawurl</span><span class="op" id="3713754">,</span>&nbsp;<span class="ident" id="3713756">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713767">case</span>&nbsp;<span class="ident" id="3713772">c</span>&nbsp;<span class="op" id="3713774">==</span>&nbsp;<span class="string" id="3713777">&#39;:&#39;</span><span class="op" id="3713780">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713785">if</span>&nbsp;<span class="ident" id="3713788">i</span>&nbsp;<span class="op" id="3713790">==</span>&nbsp;<span class="num" id="3713793">0</span>&nbsp;<span class="op" id="3713795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713801">return</span>&nbsp;<span class="string" id="3713808">&#34;&#34;</span><span class="op" id="3713810">,</span>&nbsp;<span class="string" id="3713812">&#34;&#34;</span><span class="op" id="3713814">,</span>&nbsp;<span class="ident" id="3713816">errors</span><span class="op" id="3713822">.</span><span class="ident" id="3713823">New</span><span class="op" id="3713826">(</span><span class="string" id="3713827">&#34;missing&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3713852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713862">return</span>&nbsp;<span class="ident" id="3713869">rawurl</span><span class="op" id="3713875">[</span><span class="num" id="3713876">0</span><span class="op" id="3713877">:</span><span class="ident" id="3713878">i</span><span class="op" id="3713879">]</span><span class="op" id="3713880">,</span>&nbsp;<span class="ident" id="3713882">rawurl</span><span class="op" id="3713888">[</span><span class="ident" id="3713889">i</span><span class="op" id="3713890">+</span><span class="num" id="3713891">1</span><span class="op" id="3713892">:</span><span class="op" id="3713893">]</span><span class="op" id="3713894">,</span>&nbsp;<span class="ident" id="3713896">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713902">default</span><span class="op" id="3713909">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713914">//&nbsp;we&nbsp;have&nbsp;encountered&nbsp;an&nbsp;invalid&nbsp;character,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713962">//&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713996">return</span>&nbsp;<span class="string" id="3714003">&#34;&#34;</span><span class="op" id="3714005">,</span>&nbsp;<span class="ident" id="3714007">rawurl</span><span class="op" id="3714013">,</span>&nbsp;<span class="ident" id="3714015">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714024">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714027">return</span>&nbsp;<span class="string" id="3714034">&#34;&#34;</span><span class="op" id="3714036">,</span>&nbsp;<span class="ident" id="3714038">rawurl</span><span class="op" id="3714044">,</span>&nbsp;<span class="ident" id="3714046">nil</span><br>
<span class="lineno"></span><span class="op" id="3714050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3714053">//&nbsp;Maybe&nbsp;s&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;t&nbsp;c&nbsp;u.</span><br>
<span class="lineno"></span><span class="comment" id="3714086">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;t,&nbsp;c&nbsp;u&nbsp;(or&nbsp;t,&nbsp;u&nbsp;if&nbsp;cutc&nbsp;==&nbsp;true).</span><br>
<span class="lineno">320</span><span class="comment" id="3714137">//&nbsp;If&nbsp;not,&nbsp;return&nbsp;s,&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3714162">func</span>&nbsp;<span class="ident" id="3714167">split</span><span class="op" id="3714172">(</span><span class="ident" id="3714173">s</span>&nbsp;<span class="builtintype" id="3714175">string</span><span class="op" id="3714181">,</span>&nbsp;<span class="ident" id="3714183">c</span>&nbsp;<span class="builtintype" id="3714185">string</span><span class="op" id="3714191">,</span>&nbsp;<span class="ident" id="3714193">cutc</span>&nbsp;<span class="builtintype" id="3714198">bool</span><span class="op" id="3714202">)</span>&nbsp;<span class="op" id="3714204">(</span><span class="builtintype" id="3714205">string</span><span class="op" id="3714211">,</span>&nbsp;<span class="builtintype" id="3714213">string</span><span class="op" id="3714219">)</span>&nbsp;<span class="op" id="3714221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714224">i</span>&nbsp;<span class="op" id="3714226">:=</span>&nbsp;<span class="ident" id="3714229">strings</span><span class="op" id="3714236">.</span><span class="ident" id="3714237">Index</span><span class="op" id="3714242">(</span><span class="ident" id="3714243">s</span><span class="op" id="3714244">,</span>&nbsp;<span class="ident" id="3714246">c</span><span class="op" id="3714247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714250">if</span>&nbsp;<span class="ident" id="3714253">i</span>&nbsp;<span class="op" id="3714255">&lt;</span>&nbsp;<span class="num" id="3714257">0</span>&nbsp;<span class="op" id="3714259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714263">return</span>&nbsp;<span class="ident" id="3714270">s</span><span class="op" id="3714271">,</span>&nbsp;<span class="string" id="3714273">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714280">if</span>&nbsp;<span class="ident" id="3714283">cutc</span>&nbsp;<span class="op" id="3714288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714292">return</span>&nbsp;<span class="ident" id="3714299">s</span><span class="op" id="3714300">[</span><span class="num" id="3714301">0</span><span class="op" id="3714302">:</span><span class="ident" id="3714303">i</span><span class="op" id="3714304">]</span><span class="op" id="3714305">,</span>&nbsp;<span class="ident" id="3714307">s</span><span class="op" id="3714308">[</span><span class="ident" id="3714309">i</span><span class="op" id="3714310">+</span><span class="builtinfunc" id="3714311">len</span><span class="op" id="3714314">(</span><span class="ident" id="3714315">c</span><span class="op" id="3714316">)</span><span class="op" id="3714317">:</span><span class="op" id="3714318">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714324">return</span>&nbsp;<span class="ident" id="3714331">s</span><span class="op" id="3714332">[</span><span class="num" id="3714333">0</span><span class="op" id="3714334">:</span><span class="ident" id="3714335">i</span><span class="op" id="3714336">]</span><span class="op" id="3714337">,</span>&nbsp;<span class="ident" id="3714339">s</span><span class="op" id="3714340">[</span><span class="ident" id="3714341">i</span><span class="op" id="3714342">:</span><span class="op" id="3714343">]</span><br>
<span class="lineno">330</span><span class="op" id="3714345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3714348">//&nbsp;Parse&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3714393">//&nbsp;The&nbsp;rawurl&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3714436">func</span>&nbsp;<span class="ident" id="3714441">Parse</span><span class="op" id="3714446">(</span><span class="ident" id="3714447">rawurl</span>&nbsp;<span class="builtintype" id="3714454">string</span><span class="op" id="3714460">)</span>&nbsp;<span class="op" id="3714462">(</span><span class="ident" id="3714463">url</span>&nbsp;<span class="op" id="3714467">*</span><span class="ident" id="3714468">URL</span><span class="op" id="3714471">,</span>&nbsp;<span class="ident" id="3714473">err</span>&nbsp;<span class="builtintype" id="3714477">error</span><span class="op" id="3714482">)</span>&nbsp;<span class="op" id="3714484">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3714487">//&nbsp;Cut&nbsp;off&nbsp;#frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714505">u</span><span class="op" id="3714506">,</span>&nbsp;<span class="ident" id="3714508">frag</span>&nbsp;<span class="op" id="3714513">:=</span>&nbsp;<span class="ident" id="3714516">split</span><span class="op" id="3714521">(</span><span class="ident" id="3714522">rawurl</span><span class="op" id="3714528">,</span>&nbsp;<span class="string" id="3714530">&#34;#&#34;</span><span class="op" id="3714533">,</span>&nbsp;<span class="ident" id="3714535">true</span><span class="op" id="3714539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714542">if</span>&nbsp;<span class="ident" id="3714545">url</span><span class="op" id="3714548">,</span>&nbsp;<span class="ident" id="3714550">err</span>&nbsp;<span class="op" id="3714554">=</span>&nbsp;<span class="ident" id="3714556">parse</span><span class="op" id="3714561">(</span><span class="ident" id="3714562">u</span><span class="op" id="3714563">,</span>&nbsp;<span class="ident" id="3714565">false</span><span class="op" id="3714570">)</span><span class="op" id="3714571">;</span>&nbsp;<span class="ident" id="3714573">err</span>&nbsp;<span class="op" id="3714577">!=</span>&nbsp;<span class="ident" id="3714580">nil</span>&nbsp;<span class="op" id="3714584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714588">return</span>&nbsp;<span class="ident" id="3714595">nil</span><span class="op" id="3714598">,</span>&nbsp;<span class="ident" id="3714600">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714605">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714608">if</span>&nbsp;<span class="ident" id="3714611">frag</span>&nbsp;<span class="op" id="3714616">==</span>&nbsp;<span class="string" id="3714619">&#34;&#34;</span>&nbsp;<span class="op" id="3714622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714626">return</span>&nbsp;<span class="ident" id="3714633">url</span><span class="op" id="3714636">,</span>&nbsp;<span class="ident" id="3714638">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714646">if</span>&nbsp;<span class="ident" id="3714649">url</span><span class="op" id="3714652">.</span><span class="ident" id="3714653">Fragment</span><span class="op" id="3714661">,</span>&nbsp;<span class="ident" id="3714663">err</span>&nbsp;<span class="op" id="3714667">=</span>&nbsp;<span class="ident" id="3714669">unescape</span><span class="op" id="3714677">(</span><span class="ident" id="3714678">frag</span><span class="op" id="3714682">,</span>&nbsp;<span class="ident" id="3714684">encodeFragment</span><span class="op" id="3714698">)</span><span class="op" id="3714699">;</span>&nbsp;<span class="ident" id="3714701">err</span>&nbsp;<span class="op" id="3714705">!=</span>&nbsp;<span class="ident" id="3714708">nil</span>&nbsp;<span class="op" id="3714712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714716">return</span>&nbsp;<span class="ident" id="3714723">nil</span><span class="op" id="3714726">,</span>&nbsp;<span class="op" id="3714728">&amp;</span><span class="ident" id="3714729">Error</span><span class="op" id="3714734">{</span><span class="string" id="3714735">&#34;parse&#34;</span><span class="op" id="3714742">,</span>&nbsp;<span class="ident" id="3714744">rawurl</span><span class="op" id="3714750">,</span>&nbsp;<span class="ident" id="3714752">err</span><span class="op" id="3714755">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714761">return</span>&nbsp;<span class="ident" id="3714768">url</span><span class="op" id="3714771">,</span>&nbsp;<span class="ident" id="3714773">nil</span><br>
<span class="lineno"></span><span class="op" id="3714777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3714780">//&nbsp;ParseRequestURI&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.&nbsp;&nbsp;It&nbsp;assumes&nbsp;that</span><br>
<span class="lineno">350</span><span class="comment" id="3714852">//&nbsp;rawurl&nbsp;was&nbsp;received&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request,&nbsp;so&nbsp;the&nbsp;rawurl&nbsp;is&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3714924">//&nbsp;only&nbsp;as&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;or&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3714972">//&nbsp;The&nbsp;string&nbsp;rawurl&nbsp;is&nbsp;assumed&nbsp;not&nbsp;to&nbsp;have&nbsp;a&nbsp;#fragment&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="comment" id="3715036">//&nbsp;(Web&nbsp;browsers&nbsp;strip&nbsp;#fragment&nbsp;before&nbsp;sending&nbsp;the&nbsp;URL&nbsp;to&nbsp;a&nbsp;web&nbsp;server.)</span><br>
<span class="lineno"></span><span class="keyword" id="3715110">func</span>&nbsp;<span class="ident" id="3715115">ParseRequestURI</span><span class="op" id="3715130">(</span><span class="ident" id="3715131">rawurl</span>&nbsp;<span class="builtintype" id="3715138">string</span><span class="op" id="3715144">)</span>&nbsp;<span class="op" id="3715146">(</span><span class="ident" id="3715147">url</span>&nbsp;<span class="op" id="3715151">*</span><span class="ident" id="3715152">URL</span><span class="op" id="3715155">,</span>&nbsp;<span class="ident" id="3715157">err</span>&nbsp;<span class="builtintype" id="3715161">error</span><span class="op" id="3715166">)</span>&nbsp;<span class="op" id="3715168">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715171">return</span>&nbsp;<span class="ident" id="3715178">parse</span><span class="op" id="3715183">(</span><span class="ident" id="3715184">rawurl</span><span class="op" id="3715190">,</span>&nbsp;<span class="ident" id="3715192">true</span><span class="op" id="3715196">)</span><br>
<span class="lineno"></span><span class="op" id="3715198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3715201">//&nbsp;parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;from&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;contexts.&nbsp;&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3715265">//&nbsp;viaRequest&nbsp;is&nbsp;true,&nbsp;the&nbsp;URL&nbsp;is&nbsp;assumed&nbsp;to&nbsp;have&nbsp;arrived&nbsp;via&nbsp;an&nbsp;HTTP&nbsp;request,</span><br>
<span class="lineno">360</span><span class="comment" id="3715344">//&nbsp;in&nbsp;which&nbsp;case&nbsp;only&nbsp;absolute&nbsp;URLs&nbsp;or&nbsp;path-absolute&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="3715424">//&nbsp;If&nbsp;viaRequest&nbsp;is&nbsp;false,&nbsp;all&nbsp;forms&nbsp;of&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="keyword" id="3715491">func</span>&nbsp;<span class="ident" id="3715496">parse</span><span class="op" id="3715501">(</span><span class="ident" id="3715502">rawurl</span>&nbsp;<span class="builtintype" id="3715509">string</span><span class="op" id="3715515">,</span>&nbsp;<span class="ident" id="3715517">viaRequest</span>&nbsp;<span class="builtintype" id="3715528">bool</span><span class="op" id="3715532">)</span>&nbsp;<span class="op" id="3715534">(</span><span class="ident" id="3715535">url</span>&nbsp;<span class="op" id="3715539">*</span><span class="ident" id="3715540">URL</span><span class="op" id="3715543">,</span>&nbsp;<span class="ident" id="3715545">err</span>&nbsp;<span class="builtintype" id="3715549">error</span><span class="op" id="3715554">)</span>&nbsp;<span class="op" id="3715556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715559">var</span>&nbsp;<span class="ident" id="3715563">rest</span>&nbsp;<span class="builtintype" id="3715568">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715577">if</span>&nbsp;<span class="ident" id="3715580">rawurl</span>&nbsp;<span class="op" id="3715587">==</span>&nbsp;<span class="string" id="3715590">&#34;&#34;</span>&nbsp;<span class="op" id="3715593">&amp;&amp;</span>&nbsp;<span class="ident" id="3715596">viaRequest</span>&nbsp;<span class="op" id="3715607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715611">err</span>&nbsp;<span class="op" id="3715615">=</span>&nbsp;<span class="ident" id="3715617">errors</span><span class="op" id="3715623">.</span><span class="ident" id="3715624">New</span><span class="op" id="3715627">(</span><span class="string" id="3715628">&#34;empty&nbsp;url&#34;</span><span class="op" id="3715639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715643">goto</span>&nbsp;<span class="ident" id="3715648">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3715655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715658">url</span>&nbsp;<span class="op" id="3715662">=</span>&nbsp;<span class="builtinfunc" id="3715664">new</span><span class="op" id="3715667">(</span><span class="ident" id="3715668">URL</span><span class="op" id="3715671">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715675">if</span>&nbsp;<span class="ident" id="3715678">rawurl</span>&nbsp;<span class="op" id="3715685">==</span>&nbsp;<span class="string" id="3715688">&#34;*&#34;</span>&nbsp;<span class="op" id="3715692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715696">url</span><span class="op" id="3715699">.</span><span class="ident" id="3715700">Path</span>&nbsp;<span class="op" id="3715705">=</span>&nbsp;<span class="string" id="3715707">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715713">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3715721">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715725">//&nbsp;Split&nbsp;off&nbsp;possible&nbsp;leading&nbsp;&#34;http:&#34;,&nbsp;&#34;mailto:&#34;,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715781">//&nbsp;Cannot&nbsp;contain&nbsp;escaped&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715820">if</span>&nbsp;<span class="ident" id="3715823">url</span><span class="op" id="3715826">.</span><span class="ident" id="3715827">Scheme</span><span class="op" id="3715833">,</span>&nbsp;<span class="ident" id="3715835">rest</span><span class="op" id="3715839">,</span>&nbsp;<span class="ident" id="3715841">err</span>&nbsp;<span class="op" id="3715845">=</span>&nbsp;<span class="ident" id="3715847">getscheme</span><span class="op" id="3715856">(</span><span class="ident" id="3715857">rawurl</span><span class="op" id="3715863">)</span><span class="op" id="3715864">;</span>&nbsp;<span class="ident" id="3715866">err</span>&nbsp;<span class="op" id="3715870">!=</span>&nbsp;<span class="ident" id="3715873">nil</span>&nbsp;<span class="op" id="3715877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715881">goto</span>&nbsp;<span class="ident" id="3715886">Error</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3715893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715896">url</span><span class="op" id="3715899">.</span><span class="ident" id="3715900">Scheme</span>&nbsp;<span class="op" id="3715907">=</span>&nbsp;<span class="ident" id="3715909">strings</span><span class="op" id="3715916">.</span><span class="ident" id="3715917">ToLower</span><span class="op" id="3715924">(</span><span class="ident" id="3715925">url</span><span class="op" id="3715928">.</span><span class="ident" id="3715929">Scheme</span><span class="op" id="3715935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715939">rest</span><span class="op" id="3715943">,</span>&nbsp;<span class="ident" id="3715945">url</span><span class="op" id="3715948">.</span><span class="ident" id="3715949">RawQuery</span>&nbsp;<span class="op" id="3715958">=</span>&nbsp;<span class="ident" id="3715960">split</span><span class="op" id="3715965">(</span><span class="ident" id="3715966">rest</span><span class="op" id="3715970">,</span>&nbsp;<span class="string" id="3715972">&#34;?&#34;</span><span class="op" id="3715975">,</span>&nbsp;<span class="ident" id="3715977">true</span><span class="op" id="3715981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715985">if</span>&nbsp;<span class="op" id="3715988">!</span><span class="ident" id="3715989">strings</span><span class="op" id="3715996">.</span><span class="ident" id="3715997">HasPrefix</span><span class="op" id="3716006">(</span><span class="ident" id="3716007">rest</span><span class="op" id="3716011">,</span>&nbsp;<span class="string" id="3716013">&#34;/&#34;</span><span class="op" id="3716016">)</span>&nbsp;<span class="op" id="3716018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716022">if</span>&nbsp;<span class="ident" id="3716025">url</span><span class="op" id="3716028">.</span><span class="ident" id="3716029">Scheme</span>&nbsp;<span class="op" id="3716036">!=</span>&nbsp;<span class="string" id="3716039">&#34;&#34;</span>&nbsp;<span class="op" id="3716042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3716047">//&nbsp;We&nbsp;consider&nbsp;rootless&nbsp;paths&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;as&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716104">url</span><span class="op" id="3716107">.</span><span class="ident" id="3716108">Opaque</span>&nbsp;<span class="op" id="3716115">=</span>&nbsp;<span class="ident" id="3716117">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716125">return</span>&nbsp;<span class="ident" id="3716132">url</span><span class="op" id="3716135">,</span>&nbsp;<span class="ident" id="3716137">nil</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716147">if</span>&nbsp;<span class="ident" id="3716150">viaRequest</span>&nbsp;<span class="op" id="3716161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716166">err</span>&nbsp;<span class="op" id="3716170">=</span>&nbsp;<span class="ident" id="3716172">errors</span><span class="op" id="3716178">.</span><span class="ident" id="3716179">New</span><span class="op" id="3716182">(</span><span class="string" id="3716183">&#34;invalid&nbsp;URI&nbsp;for&nbsp;request&#34;</span><span class="op" id="3716208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716213">goto</span>&nbsp;<span class="ident" id="3716218">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716226">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716233">if</span>&nbsp;<span class="op" id="3716236">(</span><span class="ident" id="3716237">url</span><span class="op" id="3716240">.</span><span class="ident" id="3716241">Scheme</span>&nbsp;<span class="op" id="3716248">!=</span>&nbsp;<span class="string" id="3716251">&#34;&#34;</span>&nbsp;<span class="op" id="3716254">||</span>&nbsp;<span class="op" id="3716257">!</span><span class="ident" id="3716258">viaRequest</span>&nbsp;<span class="op" id="3716269">&amp;&amp;</span>&nbsp;<span class="op" id="3716272">!</span><span class="ident" id="3716273">strings</span><span class="op" id="3716280">.</span><span class="ident" id="3716281">HasPrefix</span><span class="op" id="3716290">(</span><span class="ident" id="3716291">rest</span><span class="op" id="3716295">,</span>&nbsp;<span class="string" id="3716297">&#34;///&#34;</span><span class="op" id="3716302">)</span><span class="op" id="3716303">)</span>&nbsp;<span class="op" id="3716305">&amp;&amp;</span>&nbsp;<span class="ident" id="3716308">strings</span><span class="op" id="3716315">.</span><span class="ident" id="3716316">HasPrefix</span><span class="op" id="3716325">(</span><span class="ident" id="3716326">rest</span><span class="op" id="3716330">,</span>&nbsp;<span class="string" id="3716332">&#34;//&#34;</span><span class="op" id="3716336">)</span>&nbsp;<span class="op" id="3716338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716342">var</span>&nbsp;<span class="ident" id="3716346">authority</span>&nbsp;<span class="builtintype" id="3716356">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716365">authority</span><span class="op" id="3716374">,</span>&nbsp;<span class="ident" id="3716376">rest</span>&nbsp;<span class="op" id="3716381">=</span>&nbsp;<span class="ident" id="3716383">split</span><span class="op" id="3716388">(</span><span class="ident" id="3716389">rest</span><span class="op" id="3716393">[</span><span class="num" id="3716394">2</span><span class="op" id="3716395">:</span><span class="op" id="3716396">]</span><span class="op" id="3716397">,</span>&nbsp;<span class="string" id="3716399">&#34;/&#34;</span><span class="op" id="3716402">,</span>&nbsp;<span class="ident" id="3716404">false</span><span class="op" id="3716409">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716413">url</span><span class="op" id="3716416">.</span><span class="ident" id="3716417">User</span><span class="op" id="3716421">,</span>&nbsp;<span class="ident" id="3716423">url</span><span class="op" id="3716426">.</span><span class="ident" id="3716427">Host</span><span class="op" id="3716431">,</span>&nbsp;<span class="ident" id="3716433">err</span>&nbsp;<span class="op" id="3716437">=</span>&nbsp;<span class="ident" id="3716439">parseAuthority</span><span class="op" id="3716453">(</span><span class="ident" id="3716454">authority</span><span class="op" id="3716463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716467">if</span>&nbsp;<span class="ident" id="3716470">err</span>&nbsp;<span class="op" id="3716474">!=</span>&nbsp;<span class="ident" id="3716477">nil</span>&nbsp;<span class="op" id="3716481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716486">goto</span>&nbsp;<span class="ident" id="3716491">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716503">if</span>&nbsp;<span class="ident" id="3716506">strings</span><span class="op" id="3716513">.</span><span class="ident" id="3716514">Contains</span><span class="op" id="3716522">(</span><span class="ident" id="3716523">url</span><span class="op" id="3716526">.</span><span class="ident" id="3716527">Host</span><span class="op" id="3716531">,</span>&nbsp;<span class="string" id="3716533">&#34;%&#34;</span><span class="op" id="3716536">)</span>&nbsp;<span class="op" id="3716538">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716543">err</span>&nbsp;<span class="op" id="3716547">=</span>&nbsp;<span class="ident" id="3716549">errors</span><span class="op" id="3716555">.</span><span class="ident" id="3716556">New</span><span class="op" id="3716559">(</span><span class="string" id="3716560">&#34;hexadecimal&nbsp;escape&nbsp;in&nbsp;host&#34;</span><span class="op" id="3716588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716593">goto</span>&nbsp;<span class="ident" id="3716598">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716612">if</span>&nbsp;<span class="ident" id="3716615">url</span><span class="op" id="3716618">.</span><span class="ident" id="3716619">Path</span><span class="op" id="3716623">,</span>&nbsp;<span class="ident" id="3716625">err</span>&nbsp;<span class="op" id="3716629">=</span>&nbsp;<span class="ident" id="3716631">unescape</span><span class="op" id="3716639">(</span><span class="ident" id="3716640">rest</span><span class="op" id="3716644">,</span>&nbsp;<span class="ident" id="3716646">encodePath</span><span class="op" id="3716656">)</span><span class="op" id="3716657">;</span>&nbsp;<span class="ident" id="3716659">err</span>&nbsp;<span class="op" id="3716663">!=</span>&nbsp;<span class="ident" id="3716666">nil</span>&nbsp;<span class="op" id="3716670">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716674">goto</span>&nbsp;<span class="ident" id="3716679">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716689">return</span>&nbsp;<span class="ident" id="3716696">url</span><span class="op" id="3716699">,</span>&nbsp;<span class="ident" id="3716701">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3716706">Error</span><span class="op" id="3716711">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716714">return</span>&nbsp;<span class="ident" id="3716721">nil</span><span class="op" id="3716724">,</span>&nbsp;<span class="op" id="3716726">&amp;</span><span class="ident" id="3716727">Error</span><span class="op" id="3716732">{</span><span class="string" id="3716733">&#34;parse&#34;</span><span class="op" id="3716740">,</span>&nbsp;<span class="ident" id="3716742">rawurl</span><span class="op" id="3716748">,</span>&nbsp;<span class="ident" id="3716750">err</span><span class="op" id="3716753">}</span><br>
<span class="lineno"></span><span class="op" id="3716755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3716758">func</span>&nbsp;<span class="ident" id="3716763">parseAuthority</span><span class="op" id="3716777">(</span><span class="ident" id="3716778">authority</span>&nbsp;<span class="builtintype" id="3716788">string</span><span class="op" id="3716794">)</span>&nbsp;<span class="op" id="3716796">(</span><span class="ident" id="3716797">user</span>&nbsp;<span class="op" id="3716802">*</span><span class="ident" id="3716803">Userinfo</span><span class="op" id="3716811">,</span>&nbsp;<span class="ident" id="3716813">host</span>&nbsp;<span class="builtintype" id="3716818">string</span><span class="op" id="3716824">,</span>&nbsp;<span class="ident" id="3716826">err</span>&nbsp;<span class="builtintype" id="3716830">error</span><span class="op" id="3716835">)</span>&nbsp;<span class="op" id="3716837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716840">i</span>&nbsp;<span class="op" id="3716842">:=</span>&nbsp;<span class="ident" id="3716845">strings</span><span class="op" id="3716852">.</span><span class="ident" id="3716853">LastIndex</span><span class="op" id="3716862">(</span><span class="ident" id="3716863">authority</span><span class="op" id="3716872">,</span>&nbsp;<span class="string" id="3716874">&#34;@&#34;</span><span class="op" id="3716877">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716880">if</span>&nbsp;<span class="ident" id="3716883">i</span>&nbsp;<span class="op" id="3716885">&lt;</span>&nbsp;<span class="num" id="3716887">0</span>&nbsp;<span class="op" id="3716889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716893">host</span>&nbsp;<span class="op" id="3716898">=</span>&nbsp;<span class="ident" id="3716900">authority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716912">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716923">userinfo</span><span class="op" id="3716931">,</span>&nbsp;<span class="ident" id="3716933">host</span>&nbsp;<span class="op" id="3716938">:=</span>&nbsp;<span class="ident" id="3716941">authority</span><span class="op" id="3716950">[</span><span class="op" id="3716951">:</span><span class="ident" id="3716952">i</span><span class="op" id="3716953">]</span><span class="op" id="3716954">,</span>&nbsp;<span class="ident" id="3716956">authority</span><span class="op" id="3716965">[</span><span class="ident" id="3716966">i</span><span class="op" id="3716967">+</span><span class="num" id="3716968">1</span><span class="op" id="3716969">:</span><span class="op" id="3716970">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716973">if</span>&nbsp;<span class="ident" id="3716976">strings</span><span class="op" id="3716983">.</span><span class="ident" id="3716984">Index</span><span class="op" id="3716989">(</span><span class="ident" id="3716990">userinfo</span><span class="op" id="3716998">,</span>&nbsp;<span class="string" id="3717000">&#34;:&#34;</span><span class="op" id="3717003">)</span>&nbsp;<span class="op" id="3717005">&lt;</span>&nbsp;<span class="num" id="3717007">0</span>&nbsp;<span class="op" id="3717009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717013">if</span>&nbsp;<span class="ident" id="3717016">userinfo</span><span class="op" id="3717024">,</span>&nbsp;<span class="ident" id="3717026">err</span>&nbsp;<span class="op" id="3717030">=</span>&nbsp;<span class="ident" id="3717032">unescape</span><span class="op" id="3717040">(</span><span class="ident" id="3717041">userinfo</span><span class="op" id="3717049">,</span>&nbsp;<span class="ident" id="3717051">encodeUserPassword</span><span class="op" id="3717069">)</span><span class="op" id="3717070">;</span>&nbsp;<span class="ident" id="3717072">err</span>&nbsp;<span class="op" id="3717076">!=</span>&nbsp;<span class="ident" id="3717079">nil</span>&nbsp;<span class="op" id="3717083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717088">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717101">user</span>&nbsp;<span class="op" id="3717106">=</span>&nbsp;<span class="ident" id="3717108">User</span><span class="op" id="3717112">(</span><span class="ident" id="3717113">userinfo</span><span class="op" id="3717121">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717124">}</span>&nbsp;<span class="keyword" id="3717126">else</span>&nbsp;<span class="op" id="3717131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717135">username</span><span class="op" id="3717143">,</span>&nbsp;<span class="ident" id="3717145">password</span>&nbsp;<span class="op" id="3717154">:=</span>&nbsp;<span class="ident" id="3717157">split</span><span class="op" id="3717162">(</span><span class="ident" id="3717163">userinfo</span><span class="op" id="3717171">,</span>&nbsp;<span class="string" id="3717173">&#34;:&#34;</span><span class="op" id="3717176">,</span>&nbsp;<span class="ident" id="3717178">true</span><span class="op" id="3717182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717186">if</span>&nbsp;<span class="ident" id="3717189">username</span><span class="op" id="3717197">,</span>&nbsp;<span class="ident" id="3717199">err</span>&nbsp;<span class="op" id="3717203">=</span>&nbsp;<span class="ident" id="3717205">unescape</span><span class="op" id="3717213">(</span><span class="ident" id="3717214">username</span><span class="op" id="3717222">,</span>&nbsp;<span class="ident" id="3717224">encodeUserPassword</span><span class="op" id="3717242">)</span><span class="op" id="3717243">;</span>&nbsp;<span class="ident" id="3717245">err</span>&nbsp;<span class="op" id="3717249">!=</span>&nbsp;<span class="ident" id="3717252">nil</span>&nbsp;<span class="op" id="3717256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717261">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717270">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717274">if</span>&nbsp;<span class="ident" id="3717277">password</span><span class="op" id="3717285">,</span>&nbsp;<span class="ident" id="3717287">err</span>&nbsp;<span class="op" id="3717291">=</span>&nbsp;<span class="ident" id="3717293">unescape</span><span class="op" id="3717301">(</span><span class="ident" id="3717302">password</span><span class="op" id="3717310">,</span>&nbsp;<span class="ident" id="3717312">encodeUserPassword</span><span class="op" id="3717330">)</span><span class="op" id="3717331">;</span>&nbsp;<span class="ident" id="3717333">err</span>&nbsp;<span class="op" id="3717337">!=</span>&nbsp;<span class="ident" id="3717340">nil</span>&nbsp;<span class="op" id="3717344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717349">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717362">user</span>&nbsp;<span class="op" id="3717367">=</span>&nbsp;<span class="ident" id="3717369">UserPassword</span><span class="op" id="3717381">(</span><span class="ident" id="3717382">username</span><span class="op" id="3717390">,</span>&nbsp;<span class="ident" id="3717392">password</span><span class="op" id="3717400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717403">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717406">return</span><br>
<span class="lineno"></span><span class="op" id="3717413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3717416">//&nbsp;String&nbsp;reassembles&nbsp;the&nbsp;URL&nbsp;into&nbsp;a&nbsp;valid&nbsp;URL&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3717471">//&nbsp;The&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;result&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno">445</span><span class="comment" id="3717516">//</span><br>
<span class="lineno"></span><span class="comment" id="3717519">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque</span><br>
<span class="lineno"></span><span class="comment" id="3717536">//&nbsp;&nbsp;&nbsp;&nbspscheme://userinfo@host/path?query#fragment</span><br>
<span class="lineno"></span><span class="comment" id="3717582">//</span><br>
<span class="lineno"></span><span class="comment" id="3717585">//&nbsp;If&nbsp;u.Opaque&nbsp;is&nbsp;non-empty,&nbsp;String&nbsp;uses&nbsp;the&nbsp;first&nbsp;form;</span><br>
<span class="lineno">450</span><span class="comment" id="3717642">//&nbsp;otherwise&nbsp;it&nbsp;uses&nbsp;the&nbsp;second&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3717680">//</span><br>
<span class="lineno"></span><span class="comment" id="3717683">//&nbsp;In&nbsp;the&nbsp;second&nbsp;form,&nbsp;the&nbsp;following&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="3717733">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;is&nbsp;empty,&nbsp;scheme:&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3717780">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.User&nbsp;is&nbsp;nil,&nbsp;userinfo@&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">455</span><span class="comment" id="3717825">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;empty,&nbsp;host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3717868">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;and&nbsp;u.Host&nbsp;are&nbsp;empty&nbsp;and&nbsp;u.User&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="3717925">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;entire&nbsp;scheme://userinfo@host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3717978">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;non-empty&nbsp;and&nbsp;u.Path&nbsp;begins&nbsp;with&nbsp;a&nbsp;/,</span><br>
<span class="lineno"></span><span class="comment" id="3718034">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;form&nbsp;host/path&nbsp;does&nbsp;not&nbsp;add&nbsp;its&nbsp;own&nbsp;/.</span><br>
<span class="lineno">460</span><span class="comment" id="3718083">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.RawQuery&nbsp;is&nbsp;empty,&nbsp;?query&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3718131">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Fragment&nbsp;is&nbsp;empty,&nbsp;#fragment&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="keyword" id="3718182">func</span>&nbsp;<span class="op" id="3718187">(</span><span class="ident" id="3718188">u</span>&nbsp;<span class="op" id="3718190">*</span><span class="ident" id="3718191">URL</span><span class="op" id="3718194">)</span>&nbsp;<span class="ident" id="3718196">String</span><span class="op" id="3718202">(</span><span class="op" id="3718203">)</span>&nbsp;<span class="builtintype" id="3718205">string</span>&nbsp;<span class="op" id="3718212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718215">var</span>&nbsp;<span class="ident" id="3718219">buf</span>&nbsp;<span class="ident" id="3718223">bytes</span><span class="op" id="3718228">.</span><span class="ident" id="3718229">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718237">if</span>&nbsp;<span class="ident" id="3718240">u</span><span class="op" id="3718241">.</span><span class="ident" id="3718242">Scheme</span>&nbsp;<span class="op" id="3718249">!=</span>&nbsp;<span class="string" id="3718252">&#34;&#34;</span>&nbsp;<span class="op" id="3718255">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718259">buf</span><span class="op" id="3718262">.</span><span class="ident" id="3718263">WriteString</span><span class="op" id="3718274">(</span><span class="ident" id="3718275">u</span><span class="op" id="3718276">.</span><span class="ident" id="3718277">Scheme</span><span class="op" id="3718283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718287">buf</span><span class="op" id="3718290">.</span><span class="ident" id="3718291">WriteByte</span><span class="op" id="3718300">(</span><span class="string" id="3718301">&#39;:&#39;</span><span class="op" id="3718304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718310">if</span>&nbsp;<span class="ident" id="3718313">u</span><span class="op" id="3718314">.</span><span class="ident" id="3718315">Opaque</span>&nbsp;<span class="op" id="3718322">!=</span>&nbsp;<span class="string" id="3718325">&#34;&#34;</span>&nbsp;<span class="op" id="3718328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718332">buf</span><span class="op" id="3718335">.</span><span class="ident" id="3718336">WriteString</span><span class="op" id="3718347">(</span><span class="ident" id="3718348">u</span><span class="op" id="3718349">.</span><span class="ident" id="3718350">Opaque</span><span class="op" id="3718356">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718359">}</span>&nbsp;<span class="keyword" id="3718361">else</span>&nbsp;<span class="op" id="3718366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718370">if</span>&nbsp;<span class="ident" id="3718373">u</span><span class="op" id="3718374">.</span><span class="ident" id="3718375">Scheme</span>&nbsp;<span class="op" id="3718382">!=</span>&nbsp;<span class="string" id="3718385">&#34;&#34;</span>&nbsp;<span class="op" id="3718388">||</span>&nbsp;<span class="ident" id="3718391">u</span><span class="op" id="3718392">.</span><span class="ident" id="3718393">Host</span>&nbsp;<span class="op" id="3718398">!=</span>&nbsp;<span class="string" id="3718401">&#34;&#34;</span>&nbsp;<span class="op" id="3718404">||</span>&nbsp;<span class="ident" id="3718407">u</span><span class="op" id="3718408">.</span><span class="ident" id="3718409">User</span>&nbsp;<span class="op" id="3718414">!=</span>&nbsp;<span class="ident" id="3718417">nil</span>&nbsp;<span class="op" id="3718421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718426">buf</span><span class="op" id="3718429">.</span><span class="ident" id="3718430">WriteString</span><span class="op" id="3718441">(</span><span class="string" id="3718442">&#34;//&#34;</span><span class="op" id="3718446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718451">if</span>&nbsp;<span class="ident" id="3718454">ui</span>&nbsp;<span class="op" id="3718457">:=</span>&nbsp;<span class="ident" id="3718460">u</span><span class="op" id="3718461">.</span><span class="ident" id="3718462">User</span><span class="op" id="3718466">;</span>&nbsp;<span class="ident" id="3718468">ui</span>&nbsp;<span class="op" id="3718471">!=</span>&nbsp;<span class="ident" id="3718474">nil</span>&nbsp;<span class="op" id="3718478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718484">buf</span><span class="op" id="3718487">.</span><span class="ident" id="3718488">WriteString</span><span class="op" id="3718499">(</span><span class="ident" id="3718500">ui</span><span class="op" id="3718502">.</span><span class="ident" id="3718503">String</span><span class="op" id="3718509">(</span><span class="op" id="3718510">)</span><span class="op" id="3718511">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718517">buf</span><span class="op" id="3718520">.</span><span class="ident" id="3718521">WriteByte</span><span class="op" id="3718530">(</span><span class="string" id="3718531">&#39;@&#39;</span><span class="op" id="3718534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718544">if</span>&nbsp;<span class="ident" id="3718547">h</span>&nbsp;<span class="op" id="3718549">:=</span>&nbsp;<span class="ident" id="3718552">u</span><span class="op" id="3718553">.</span><span class="ident" id="3718554">Host</span><span class="op" id="3718558">;</span>&nbsp;<span class="ident" id="3718560">h</span>&nbsp;<span class="op" id="3718562">!=</span>&nbsp;<span class="string" id="3718565">&#34;&#34;</span>&nbsp;<span class="op" id="3718568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718574">buf</span><span class="op" id="3718577">.</span><span class="ident" id="3718578">WriteString</span><span class="op" id="3718589">(</span><span class="ident" id="3718590">h</span><span class="op" id="3718591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718596">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718604">if</span>&nbsp;<span class="ident" id="3718607">u</span><span class="op" id="3718608">.</span><span class="ident" id="3718609">Path</span>&nbsp;<span class="op" id="3718614">!=</span>&nbsp;<span class="string" id="3718617">&#34;&#34;</span>&nbsp;<span class="op" id="3718620">&amp;&amp;</span>&nbsp;<span class="ident" id="3718623">u</span><span class="op" id="3718624">.</span><span class="ident" id="3718625">Path</span><span class="op" id="3718629">[</span><span class="num" id="3718630">0</span><span class="op" id="3718631">]</span>&nbsp;<span class="op" id="3718633">!=</span>&nbsp;<span class="string" id="3718636">&#39;/&#39;</span>&nbsp;<span class="op" id="3718640">&amp;&amp;</span>&nbsp;<span class="ident" id="3718643">u</span><span class="op" id="3718644">.</span><span class="ident" id="3718645">Host</span>&nbsp;<span class="op" id="3718650">!=</span>&nbsp;<span class="string" id="3718653">&#34;&#34;</span>&nbsp;<span class="op" id="3718656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718661">buf</span><span class="op" id="3718664">.</span><span class="ident" id="3718665">WriteByte</span><span class="op" id="3718674">(</span><span class="string" id="3718675">&#39;/&#39;</span><span class="op" id="3718678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718686">buf</span><span class="op" id="3718689">.</span><span class="ident" id="3718690">WriteString</span><span class="op" id="3718701">(</span><span class="ident" id="3718702">escape</span><span class="op" id="3718708">(</span><span class="ident" id="3718709">u</span><span class="op" id="3718710">.</span><span class="ident" id="3718711">Path</span><span class="op" id="3718715">,</span>&nbsp;<span class="ident" id="3718717">encodePath</span><span class="op" id="3718727">)</span><span class="op" id="3718728">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718734">if</span>&nbsp;<span class="ident" id="3718737">u</span><span class="op" id="3718738">.</span><span class="ident" id="3718739">RawQuery</span>&nbsp;<span class="op" id="3718748">!=</span>&nbsp;<span class="string" id="3718751">&#34;&#34;</span>&nbsp;<span class="op" id="3718754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718758">buf</span><span class="op" id="3718761">.</span><span class="ident" id="3718762">WriteByte</span><span class="op" id="3718771">(</span><span class="string" id="3718772">&#39;?&#39;</span><span class="op" id="3718775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718779">buf</span><span class="op" id="3718782">.</span><span class="ident" id="3718783">WriteString</span><span class="op" id="3718794">(</span><span class="ident" id="3718795">u</span><span class="op" id="3718796">.</span><span class="ident" id="3718797">RawQuery</span><span class="op" id="3718805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718808">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718811">if</span>&nbsp;<span class="ident" id="3718814">u</span><span class="op" id="3718815">.</span><span class="ident" id="3718816">Fragment</span>&nbsp;<span class="op" id="3718825">!=</span>&nbsp;<span class="string" id="3718828">&#34;&#34;</span>&nbsp;<span class="op" id="3718831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718835">buf</span><span class="op" id="3718838">.</span><span class="ident" id="3718839">WriteByte</span><span class="op" id="3718848">(</span><span class="string" id="3718849">&#39;#&#39;</span><span class="op" id="3718852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718856">buf</span><span class="op" id="3718859">.</span><span class="ident" id="3718860">WriteString</span><span class="op" id="3718871">(</span><span class="ident" id="3718872">escape</span><span class="op" id="3718878">(</span><span class="ident" id="3718879">u</span><span class="op" id="3718880">.</span><span class="ident" id="3718881">Fragment</span><span class="op" id="3718889">,</span>&nbsp;<span class="ident" id="3718891">encodeFragment</span><span class="op" id="3718905">)</span><span class="op" id="3718906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718912">return</span>&nbsp;<span class="ident" id="3718919">buf</span><span class="op" id="3718922">.</span><span class="ident" id="3718923">String</span><span class="op" id="3718929">(</span><span class="op" id="3718930">)</span><br>
<span class="lineno">495</span><span class="op" id="3718932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3718935">//&nbsp;Values&nbsp;maps&nbsp;a&nbsp;string&nbsp;key&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3718984">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;for&nbsp;query&nbsp;parameters&nbsp;and&nbsp;form&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3719046">//&nbsp;Unlike&nbsp;in&nbsp;the&nbsp;http.Header&nbsp;map,&nbsp;the&nbsp;keys&nbsp;in&nbsp;a&nbsp;Values&nbsp;map</span><br>
<span class="lineno">500</span><span class="comment" id="3719105">//&nbsp;are&nbsp;case-sensitive.</span><br>
<span class="lineno"></span><span class="keyword" id="3719128">type</span>&nbsp;<span class="ident" id="3719133">Values</span>&nbsp;<span class="keyword" id="3719140">map</span><span class="op" id="3719143">[</span><span class="builtintype" id="3719144">string</span><span class="op" id="3719150">]</span><span class="op" id="3719151">[</span><span class="op" id="3719152">]</span><span class="builtintype" id="3719153">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3719161">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3719220">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno">505</span><span class="comment" id="3719283">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values,&nbsp;use&nbsp;the&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3719343">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3719356">func</span>&nbsp;<span class="op" id="3719361">(</span><span class="ident" id="3719362">v</span>&nbsp;<span class="ident" id="3719364">Values</span><span class="op" id="3719370">)</span>&nbsp;<span class="ident" id="3719372">Get</span><span class="op" id="3719375">(</span><span class="ident" id="3719376">key</span>&nbsp;<span class="builtintype" id="3719380">string</span><span class="op" id="3719386">)</span>&nbsp;<span class="builtintype" id="3719388">string</span>&nbsp;<span class="op" id="3719395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719398">if</span>&nbsp;<span class="ident" id="3719401">v</span>&nbsp;<span class="op" id="3719403">==</span>&nbsp;<span class="ident" id="3719406">nil</span>&nbsp;<span class="op" id="3719410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719414">return</span>&nbsp;<span class="string" id="3719421">&#34;&#34;</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719428">vs</span><span class="op" id="3719430">,</span>&nbsp;<span class="ident" id="3719432">ok</span>&nbsp;<span class="op" id="3719435">:=</span>&nbsp;<span class="ident" id="3719438">v</span><span class="op" id="3719439">[</span><span class="ident" id="3719440">key</span><span class="op" id="3719443">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719446">if</span>&nbsp;<span class="op" id="3719449">!</span><span class="ident" id="3719450">ok</span>&nbsp;<span class="op" id="3719453">||</span>&nbsp;<span class="builtinfunc" id="3719456">len</span><span class="op" id="3719459">(</span><span class="ident" id="3719460">vs</span><span class="op" id="3719462">)</span>&nbsp;<span class="op" id="3719464">==</span>&nbsp;<span class="num" id="3719467">0</span>&nbsp;<span class="op" id="3719469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719473">return</span>&nbsp;<span class="string" id="3719480">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719484">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719487">return</span>&nbsp;<span class="ident" id="3719494">vs</span><span class="op" id="3719496">[</span><span class="num" id="3719497">0</span><span class="op" id="3719498">]</span><br>
<span class="lineno"></span><span class="op" id="3719500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3719503">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;key&nbsp;to&nbsp;value.&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3719558">//&nbsp;values.</span><br>
<span class="lineno">520</span><span class="keyword" id="3719569">func</span>&nbsp;<span class="op" id="3719574">(</span><span class="ident" id="3719575">v</span>&nbsp;<span class="ident" id="3719577">Values</span><span class="op" id="3719583">)</span>&nbsp;<span class="ident" id="3719585">Set</span><span class="op" id="3719588">(</span><span class="ident" id="3719589">key</span><span class="op" id="3719592">,</span>&nbsp;<span class="ident" id="3719594">value</span>&nbsp;<span class="builtintype" id="3719600">string</span><span class="op" id="3719606">)</span>&nbsp;<span class="op" id="3719608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719611">v</span><span class="op" id="3719612">[</span><span class="ident" id="3719613">key</span><span class="op" id="3719616">]</span>&nbsp;<span class="op" id="3719618">=</span>&nbsp;<span class="op" id="3719620">[</span><span class="op" id="3719621">]</span><span class="builtintype" id="3719622">string</span><span class="op" id="3719628">{</span><span class="ident" id="3719629">value</span><span class="op" id="3719634">}</span><br>
<span class="lineno"></span><span class="op" id="3719636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3719639">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;value&nbsp;to&nbsp;key.&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing</span><br>
<span class="lineno">525</span><span class="comment" id="3719696">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3719727">func</span>&nbsp;<span class="op" id="3719732">(</span><span class="ident" id="3719733">v</span>&nbsp;<span class="ident" id="3719735">Values</span><span class="op" id="3719741">)</span>&nbsp;<span class="ident" id="3719743">Add</span><span class="op" id="3719746">(</span><span class="ident" id="3719747">key</span><span class="op" id="3719750">,</span>&nbsp;<span class="ident" id="3719752">value</span>&nbsp;<span class="builtintype" id="3719758">string</span><span class="op" id="3719764">)</span>&nbsp;<span class="op" id="3719766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719769">v</span><span class="op" id="3719770">[</span><span class="ident" id="3719771">key</span><span class="op" id="3719774">]</span>&nbsp;<span class="op" id="3719776">=</span>&nbsp;<span class="builtinfunc" id="3719778">append</span><span class="op" id="3719784">(</span><span class="ident" id="3719785">v</span><span class="op" id="3719786">[</span><span class="ident" id="3719787">key</span><span class="op" id="3719790">]</span><span class="op" id="3719791">,</span>&nbsp;<span class="ident" id="3719793">value</span><span class="op" id="3719798">)</span><br>
<span class="lineno"></span><span class="op" id="3719800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3719803">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3719850">func</span>&nbsp;<span class="op" id="3719855">(</span><span class="ident" id="3719856">v</span>&nbsp;<span class="ident" id="3719858">Values</span><span class="op" id="3719864">)</span>&nbsp;<span class="ident" id="3719866">Del</span><span class="op" id="3719869">(</span><span class="ident" id="3719870">key</span>&nbsp;<span class="builtintype" id="3719874">string</span><span class="op" id="3719880">)</span>&nbsp;<span class="op" id="3719882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3719885">delete</span><span class="op" id="3719891">(</span><span class="ident" id="3719892">v</span><span class="op" id="3719893">,</span>&nbsp;<span class="ident" id="3719895">key</span><span class="op" id="3719898">)</span><br>
<span class="lineno"></span><span class="op" id="3719900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3719903">//&nbsp;ParseQuery&nbsp;parses&nbsp;the&nbsp;URL-encoded&nbsp;query&nbsp;string&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3719965">//&nbsp;a&nbsp;map&nbsp;listing&nbsp;the&nbsp;values&nbsp;specified&nbsp;for&nbsp;each&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3720017">//&nbsp;ParseQuery&nbsp;always&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;map&nbsp;containing&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3720079">//&nbsp;valid&nbsp;query&nbsp;parameters&nbsp;found;&nbsp;err&nbsp;describes&nbsp;the&nbsp;first&nbsp;decoding&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3720151">//&nbsp;encountered,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">540</span><span class="keyword" id="3720175">func</span>&nbsp;<span class="ident" id="3720180">ParseQuery</span><span class="op" id="3720190">(</span><span class="ident" id="3720191">query</span>&nbsp;<span class="builtintype" id="3720197">string</span><span class="op" id="3720203">)</span>&nbsp;<span class="op" id="3720205">(</span><span class="ident" id="3720206">m</span>&nbsp;<span class="ident" id="3720208">Values</span><span class="op" id="3720214">,</span>&nbsp;<span class="ident" id="3720216">err</span>&nbsp;<span class="builtintype" id="3720220">error</span><span class="op" id="3720225">)</span>&nbsp;<span class="op" id="3720227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720230">m</span>&nbsp;<span class="op" id="3720232">=</span>&nbsp;<span class="builtinfunc" id="3720234">make</span><span class="op" id="3720238">(</span><span class="ident" id="3720239">Values</span><span class="op" id="3720245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720248">err</span>&nbsp;<span class="op" id="3720252">=</span>&nbsp;<span class="ident" id="3720254">parseQuery</span><span class="op" id="3720264">(</span><span class="ident" id="3720265">m</span><span class="op" id="3720266">,</span>&nbsp;<span class="ident" id="3720268">query</span><span class="op" id="3720273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720276">return</span><br>
<span class="lineno"></span><span class="op" id="3720283">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="3720286">func</span>&nbsp;<span class="ident" id="3720291">parseQuery</span><span class="op" id="3720301">(</span><span class="ident" id="3720302">m</span>&nbsp;<span class="ident" id="3720304">Values</span><span class="op" id="3720310">,</span>&nbsp;<span class="ident" id="3720312">query</span>&nbsp;<span class="builtintype" id="3720318">string</span><span class="op" id="3720324">)</span>&nbsp;<span class="op" id="3720326">(</span><span class="ident" id="3720327">err</span>&nbsp;<span class="builtintype" id="3720331">error</span><span class="op" id="3720336">)</span>&nbsp;<span class="op" id="3720338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720341">for</span>&nbsp;<span class="ident" id="3720345">query</span>&nbsp;<span class="op" id="3720351">!=</span>&nbsp;<span class="string" id="3720354">&#34;&#34;</span>&nbsp;<span class="op" id="3720357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720361">key</span>&nbsp;<span class="op" id="3720365">:=</span>&nbsp;<span class="ident" id="3720368">query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720376">if</span>&nbsp;<span class="ident" id="3720379">i</span>&nbsp;<span class="op" id="3720381">:=</span>&nbsp;<span class="ident" id="3720384">strings</span><span class="op" id="3720391">.</span><span class="ident" id="3720392">IndexAny</span><span class="op" id="3720400">(</span><span class="ident" id="3720401">key</span><span class="op" id="3720404">,</span>&nbsp;<span class="string" id="3720406">&#34;&amp;;&#34;</span><span class="op" id="3720410">)</span><span class="op" id="3720411">;</span>&nbsp;<span class="ident" id="3720413">i</span>&nbsp;<span class="op" id="3720415">&gt;=</span>&nbsp;<span class="num" id="3720418">0</span>&nbsp;<span class="op" id="3720420">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720425">key</span><span class="op" id="3720428">,</span>&nbsp;<span class="ident" id="3720430">query</span>&nbsp;<span class="op" id="3720436">=</span>&nbsp;<span class="ident" id="3720438">key</span><span class="op" id="3720441">[</span><span class="op" id="3720442">:</span><span class="ident" id="3720443">i</span><span class="op" id="3720444">]</span><span class="op" id="3720445">,</span>&nbsp;<span class="ident" id="3720447">key</span><span class="op" id="3720450">[</span><span class="ident" id="3720451">i</span><span class="op" id="3720452">+</span><span class="num" id="3720453">1</span><span class="op" id="3720454">:</span><span class="op" id="3720455">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720459">}</span>&nbsp;<span class="keyword" id="3720461">else</span>&nbsp;<span class="op" id="3720466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720471">query</span>&nbsp;<span class="op" id="3720477">=</span>&nbsp;<span class="string" id="3720479">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720488">if</span>&nbsp;<span class="ident" id="3720491">key</span>&nbsp;<span class="op" id="3720495">==</span>&nbsp;<span class="string" id="3720498">&#34;&#34;</span>&nbsp;<span class="op" id="3720501">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720506">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720521">value</span>&nbsp;<span class="op" id="3720527">:=</span>&nbsp;<span class="string" id="3720530">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720535">if</span>&nbsp;<span class="ident" id="3720538">i</span>&nbsp;<span class="op" id="3720540">:=</span>&nbsp;<span class="ident" id="3720543">strings</span><span class="op" id="3720550">.</span><span class="ident" id="3720551">Index</span><span class="op" id="3720556">(</span><span class="ident" id="3720557">key</span><span class="op" id="3720560">,</span>&nbsp;<span class="string" id="3720562">&#34;=&#34;</span><span class="op" id="3720565">)</span><span class="op" id="3720566">;</span>&nbsp;<span class="ident" id="3720568">i</span>&nbsp;<span class="op" id="3720570">&gt;=</span>&nbsp;<span class="num" id="3720573">0</span>&nbsp;<span class="op" id="3720575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720580">key</span><span class="op" id="3720583">,</span>&nbsp;<span class="ident" id="3720585">value</span>&nbsp;<span class="op" id="3720591">=</span>&nbsp;<span class="ident" id="3720593">key</span><span class="op" id="3720596">[</span><span class="op" id="3720597">:</span><span class="ident" id="3720598">i</span><span class="op" id="3720599">]</span><span class="op" id="3720600">,</span>&nbsp;<span class="ident" id="3720602">key</span><span class="op" id="3720605">[</span><span class="ident" id="3720606">i</span><span class="op" id="3720607">+</span><span class="num" id="3720608">1</span><span class="op" id="3720609">:</span><span class="op" id="3720610">]</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720618">key</span><span class="op" id="3720621">,</span>&nbsp;<span class="ident" id="3720623">err1</span>&nbsp;<span class="op" id="3720628">:=</span>&nbsp;<span class="ident" id="3720631">QueryUnescape</span><span class="op" id="3720644">(</span><span class="ident" id="3720645">key</span><span class="op" id="3720648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720652">if</span>&nbsp;<span class="ident" id="3720655">err1</span>&nbsp;<span class="op" id="3720660">!=</span>&nbsp;<span class="ident" id="3720663">nil</span>&nbsp;<span class="op" id="3720667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720672">if</span>&nbsp;<span class="ident" id="3720675">err</span>&nbsp;<span class="op" id="3720679">==</span>&nbsp;<span class="ident" id="3720682">nil</span>&nbsp;<span class="op" id="3720686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720692">err</span>&nbsp;<span class="op" id="3720696">=</span>&nbsp;<span class="ident" id="3720698">err1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720711">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720726">value</span><span class="op" id="3720731">,</span>&nbsp;<span class="ident" id="3720733">err1</span>&nbsp;<span class="op" id="3720738">=</span>&nbsp;<span class="ident" id="3720740">QueryUnescape</span><span class="op" id="3720753">(</span><span class="ident" id="3720754">value</span><span class="op" id="3720759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720763">if</span>&nbsp;<span class="ident" id="3720766">err1</span>&nbsp;<span class="op" id="3720771">!=</span>&nbsp;<span class="ident" id="3720774">nil</span>&nbsp;<span class="op" id="3720778">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720783">if</span>&nbsp;<span class="ident" id="3720786">err</span>&nbsp;<span class="op" id="3720790">==</span>&nbsp;<span class="ident" id="3720793">nil</span>&nbsp;<span class="op" id="3720797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720803">err</span>&nbsp;<span class="op" id="3720807">=</span>&nbsp;<span class="ident" id="3720809">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720822">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720833">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720837">m</span><span class="op" id="3720838">[</span><span class="ident" id="3720839">key</span><span class="op" id="3720842">]</span>&nbsp;<span class="op" id="3720844">=</span>&nbsp;<span class="builtinfunc" id="3720846">append</span><span class="op" id="3720852">(</span><span class="ident" id="3720853">m</span><span class="op" id="3720854">[</span><span class="ident" id="3720855">key</span><span class="op" id="3720858">]</span><span class="op" id="3720859">,</span>&nbsp;<span class="ident" id="3720861">value</span><span class="op" id="3720866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720872">return</span>&nbsp;<span class="ident" id="3720879">err</span><br>
<span class="lineno"></span><span class="op" id="3720883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3720886">//&nbsp;Encode&nbsp;encodes&nbsp;the&nbsp;values&nbsp;into&nbsp;``URL&nbsp;encoded&#39;&#39;&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3720941">//&nbsp;(&#34;bar=baz&amp;foo=quux&#34;)&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3720980">func</span>&nbsp;<span class="op" id="3720985">(</span><span class="ident" id="3720986">v</span>&nbsp;<span class="ident" id="3720988">Values</span><span class="op" id="3720994">)</span>&nbsp;<span class="ident" id="3720996">Encode</span><span class="op" id="3721002">(</span><span class="op" id="3721003">)</span>&nbsp;<span class="builtintype" id="3721005">string</span>&nbsp;<span class="op" id="3721012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721015">if</span>&nbsp;<span class="ident" id="3721018">v</span>&nbsp;<span class="op" id="3721020">==</span>&nbsp;<span class="ident" id="3721023">nil</span>&nbsp;<span class="op" id="3721027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721031">return</span>&nbsp;<span class="string" id="3721038">&#34;&#34;</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721045">var</span>&nbsp;<span class="ident" id="3721049">buf</span>&nbsp;<span class="ident" id="3721053">bytes</span><span class="op" id="3721058">.</span><span class="ident" id="3721059">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721067">keys</span>&nbsp;<span class="op" id="3721072">:=</span>&nbsp;<span class="builtinfunc" id="3721075">make</span><span class="op" id="3721079">(</span><span class="op" id="3721080">[</span><span class="op" id="3721081">]</span><span class="builtintype" id="3721082">string</span><span class="op" id="3721088">,</span>&nbsp;<span class="num" id="3721090">0</span><span class="op" id="3721091">,</span>&nbsp;<span class="builtinfunc" id="3721093">len</span><span class="op" id="3721096">(</span><span class="ident" id="3721097">v</span><span class="op" id="3721098">)</span><span class="op" id="3721099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721102">for</span>&nbsp;<span class="ident" id="3721106">k</span>&nbsp;<span class="op" id="3721108">:=</span>&nbsp;<span class="keyword" id="3721111">range</span>&nbsp;<span class="ident" id="3721117">v</span>&nbsp;<span class="op" id="3721119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721123">keys</span>&nbsp;<span class="op" id="3721128">=</span>&nbsp;<span class="builtinfunc" id="3721130">append</span><span class="op" id="3721136">(</span><span class="ident" id="3721137">keys</span><span class="op" id="3721141">,</span>&nbsp;<span class="ident" id="3721143">k</span><span class="op" id="3721144">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721150">sort</span><span class="op" id="3721154">.</span><span class="ident" id="3721155">Strings</span><span class="op" id="3721162">(</span><span class="ident" id="3721163">keys</span><span class="op" id="3721167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721170">for</span>&nbsp;<span class="ident" id="3721174">_</span><span class="op" id="3721175">,</span>&nbsp;<span class="ident" id="3721177">k</span>&nbsp;<span class="op" id="3721179">:=</span>&nbsp;<span class="keyword" id="3721182">range</span>&nbsp;<span class="ident" id="3721188">keys</span>&nbsp;<span class="op" id="3721193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721197">vs</span>&nbsp;<span class="op" id="3721200">:=</span>&nbsp;<span class="ident" id="3721203">v</span><span class="op" id="3721204">[</span><span class="ident" id="3721205">k</span><span class="op" id="3721206">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721210">prefix</span>&nbsp;<span class="op" id="3721217">:=</span>&nbsp;<span class="ident" id="3721220">QueryEscape</span><span class="op" id="3721231">(</span><span class="ident" id="3721232">k</span><span class="op" id="3721233">)</span>&nbsp;<span class="op" id="3721235">+</span>&nbsp;<span class="string" id="3721237">&#34;=&#34;</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721243">for</span>&nbsp;<span class="ident" id="3721247">_</span><span class="op" id="3721248">,</span>&nbsp;<span class="ident" id="3721250">v</span>&nbsp;<span class="op" id="3721252">:=</span>&nbsp;<span class="keyword" id="3721255">range</span>&nbsp;<span class="ident" id="3721261">vs</span>&nbsp;<span class="op" id="3721264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721269">if</span>&nbsp;<span class="ident" id="3721272">buf</span><span class="op" id="3721275">.</span><span class="ident" id="3721276">Len</span><span class="op" id="3721279">(</span><span class="op" id="3721280">)</span>&nbsp;<span class="op" id="3721282">&gt;</span>&nbsp;<span class="num" id="3721284">0</span>&nbsp;<span class="op" id="3721286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721292">buf</span><span class="op" id="3721295">.</span><span class="ident" id="3721296">WriteByte</span><span class="op" id="3721305">(</span><span class="string" id="3721306">&#39;&amp;&#39;</span><span class="op" id="3721309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721319">buf</span><span class="op" id="3721322">.</span><span class="ident" id="3721323">WriteString</span><span class="op" id="3721334">(</span><span class="ident" id="3721335">prefix</span><span class="op" id="3721341">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721346">buf</span><span class="op" id="3721349">.</span><span class="ident" id="3721350">WriteString</span><span class="op" id="3721361">(</span><span class="ident" id="3721362">QueryEscape</span><span class="op" id="3721373">(</span><span class="ident" id="3721374">v</span><span class="op" id="3721375">)</span><span class="op" id="3721376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721386">return</span>&nbsp;<span class="ident" id="3721393">buf</span><span class="op" id="3721396">.</span><span class="ident" id="3721397">String</span><span class="op" id="3721403">(</span><span class="op" id="3721404">)</span><br>
<span class="lineno"></span><span class="op" id="3721406">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="comment" id="3721409">//&nbsp;resolvePath&nbsp;applies&nbsp;special&nbsp;path&nbsp;segments&nbsp;from&nbsp;refs&nbsp;and&nbsp;applies</span><br>
<span class="lineno"></span><span class="comment" id="3721476">//&nbsp;them&nbsp;to&nbsp;base,&nbsp;per&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3721507">func</span>&nbsp;<span class="ident" id="3721512">resolvePath</span><span class="op" id="3721523">(</span><span class="ident" id="3721524">base</span><span class="op" id="3721528">,</span>&nbsp;<span class="ident" id="3721530">ref</span>&nbsp;<span class="builtintype" id="3721534">string</span><span class="op" id="3721540">)</span>&nbsp;<span class="builtintype" id="3721542">string</span>&nbsp;<span class="op" id="3721549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721552">var</span>&nbsp;<span class="ident" id="3721556">full</span>&nbsp;<span class="builtintype" id="3721561">string</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721569">if</span>&nbsp;<span class="ident" id="3721572">ref</span>&nbsp;<span class="op" id="3721576">==</span>&nbsp;<span class="string" id="3721579">&#34;&#34;</span>&nbsp;<span class="op" id="3721582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721586">full</span>&nbsp;<span class="op" id="3721591">=</span>&nbsp;<span class="ident" id="3721593">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721599">}</span>&nbsp;<span class="keyword" id="3721601">else</span>&nbsp;<span class="keyword" id="3721606">if</span>&nbsp;<span class="ident" id="3721609">ref</span><span class="op" id="3721612">[</span><span class="num" id="3721613">0</span><span class="op" id="3721614">]</span>&nbsp;<span class="op" id="3721616">!=</span>&nbsp;<span class="string" id="3721619">&#39;/&#39;</span>&nbsp;<span class="op" id="3721623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721627">i</span>&nbsp;<span class="op" id="3721629">:=</span>&nbsp;<span class="ident" id="3721632">strings</span><span class="op" id="3721639">.</span><span class="ident" id="3721640">LastIndex</span><span class="op" id="3721649">(</span><span class="ident" id="3721650">base</span><span class="op" id="3721654">,</span>&nbsp;<span class="string" id="3721656">&#34;/&#34;</span><span class="op" id="3721659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721663">full</span>&nbsp;<span class="op" id="3721668">=</span>&nbsp;<span class="ident" id="3721670">base</span><span class="op" id="3721674">[</span><span class="op" id="3721675">:</span><span class="ident" id="3721676">i</span><span class="op" id="3721677">+</span><span class="num" id="3721678">1</span><span class="op" id="3721679">]</span>&nbsp;<span class="op" id="3721681">+</span>&nbsp;<span class="ident" id="3721683">ref</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721688">}</span>&nbsp;<span class="keyword" id="3721690">else</span>&nbsp;<span class="op" id="3721695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721699">full</span>&nbsp;<span class="op" id="3721704">=</span>&nbsp;<span class="ident" id="3721706">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721714">if</span>&nbsp;<span class="ident" id="3721717">full</span>&nbsp;<span class="op" id="3721722">==</span>&nbsp;<span class="string" id="3721725">&#34;&#34;</span>&nbsp;<span class="op" id="3721728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721732">return</span>&nbsp;<span class="string" id="3721739">&#34;&#34;</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721746">var</span>&nbsp;<span class="ident" id="3721750">dst</span>&nbsp;<span class="op" id="3721754">[</span><span class="op" id="3721755">]</span><span class="builtintype" id="3721756">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721764">src</span>&nbsp;<span class="op" id="3721768">:=</span>&nbsp;<span class="ident" id="3721771">strings</span><span class="op" id="3721778">.</span><span class="ident" id="3721779">Split</span><span class="op" id="3721784">(</span><span class="ident" id="3721785">full</span><span class="op" id="3721789">,</span>&nbsp;<span class="string" id="3721791">&#34;/&#34;</span><span class="op" id="3721794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721797">for</span>&nbsp;<span class="ident" id="3721801">_</span><span class="op" id="3721802">,</span>&nbsp;<span class="ident" id="3721804">elem</span>&nbsp;<span class="op" id="3721809">:=</span>&nbsp;<span class="keyword" id="3721812">range</span>&nbsp;<span class="ident" id="3721818">src</span>&nbsp;<span class="op" id="3721822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721826">switch</span>&nbsp;<span class="ident" id="3721833">elem</span>&nbsp;<span class="op" id="3721838">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721842">case</span>&nbsp;<span class="string" id="3721847">&#34;.&#34;</span><span class="op" id="3721850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721855">//&nbsp;drop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721865">case</span>&nbsp;<span class="string" id="3721870">&#34;..&#34;</span><span class="op" id="3721874">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721879">if</span>&nbsp;<span class="builtinfunc" id="3721882">len</span><span class="op" id="3721885">(</span><span class="ident" id="3721886">dst</span><span class="op" id="3721889">)</span>&nbsp;<span class="op" id="3721891">&gt;</span>&nbsp;<span class="num" id="3721893">0</span>&nbsp;<span class="op" id="3721895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721901">dst</span>&nbsp;<span class="op" id="3721905">=</span>&nbsp;<span class="ident" id="3721907">dst</span><span class="op" id="3721910">[</span><span class="op" id="3721911">:</span><span class="builtinfunc" id="3721912">len</span><span class="op" id="3721915">(</span><span class="ident" id="3721916">dst</span><span class="op" id="3721919">)</span><span class="op" id="3721920">-</span><span class="num" id="3721921">1</span><span class="op" id="3721922">]</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721931">default</span><span class="op" id="3721938">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721943">dst</span>&nbsp;<span class="op" id="3721947">=</span>&nbsp;<span class="builtinfunc" id="3721949">append</span><span class="op" id="3721955">(</span><span class="ident" id="3721956">dst</span><span class="op" id="3721959">,</span>&nbsp;<span class="ident" id="3721961">elem</span><span class="op" id="3721965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721972">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721975">if</span>&nbsp;<span class="ident" id="3721978">last</span>&nbsp;<span class="op" id="3721983">:=</span>&nbsp;<span class="ident" id="3721986">src</span><span class="op" id="3721989">[</span><span class="builtinfunc" id="3721990">len</span><span class="op" id="3721993">(</span><span class="ident" id="3721994">src</span><span class="op" id="3721997">)</span><span class="op" id="3721998">-</span><span class="num" id="3721999">1</span><span class="op" id="3722000">]</span><span class="op" id="3722001">;</span>&nbsp;<span class="ident" id="3722003">last</span>&nbsp;<span class="op" id="3722008">==</span>&nbsp;<span class="string" id="3722011">&#34;.&#34;</span>&nbsp;<span class="op" id="3722015">||</span>&nbsp;<span class="ident" id="3722018">last</span>&nbsp;<span class="op" id="3722023">==</span>&nbsp;<span class="string" id="3722026">&#34;..&#34;</span>&nbsp;<span class="op" id="3722031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722035">//&nbsp;Add&nbsp;final&nbsp;slash&nbsp;to&nbsp;the&nbsp;joined&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722076">dst</span>&nbsp;<span class="op" id="3722080">=</span>&nbsp;<span class="builtinfunc" id="3722082">append</span><span class="op" id="3722088">(</span><span class="ident" id="3722089">dst</span><span class="op" id="3722092">,</span>&nbsp;<span class="string" id="3722094">&#34;&#34;</span><span class="op" id="3722096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722102">return</span>&nbsp;<span class="string" id="3722109">&#34;/&#34;</span>&nbsp;<span class="op" id="3722113">+</span>&nbsp;<span class="ident" id="3722115">strings</span><span class="op" id="3722122">.</span><span class="ident" id="3722123">TrimLeft</span><span class="op" id="3722131">(</span><span class="ident" id="3722132">strings</span><span class="op" id="3722139">.</span><span class="ident" id="3722140">Join</span><span class="op" id="3722144">(</span><span class="ident" id="3722145">dst</span><span class="op" id="3722148">,</span>&nbsp;<span class="string" id="3722150">&#34;/&#34;</span><span class="op" id="3722153">)</span><span class="op" id="3722154">,</span>&nbsp;<span class="string" id="3722156">&#34;/&#34;</span><span class="op" id="3722159">)</span><br>
<span class="lineno">640</span><span class="op" id="3722161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3722164">//&nbsp;IsAbs&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;URL&nbsp;is&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3722210">func</span>&nbsp;<span class="op" id="3722215">(</span><span class="ident" id="3722216">u</span>&nbsp;<span class="op" id="3722218">*</span><span class="ident" id="3722219">URL</span><span class="op" id="3722222">)</span>&nbsp;<span class="ident" id="3722224">IsAbs</span><span class="op" id="3722229">(</span><span class="op" id="3722230">)</span>&nbsp;<span class="builtintype" id="3722232">bool</span>&nbsp;<span class="op" id="3722237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722240">return</span>&nbsp;<span class="ident" id="3722247">u</span><span class="op" id="3722248">.</span><span class="ident" id="3722249">Scheme</span>&nbsp;<span class="op" id="3722256">!=</span>&nbsp;<span class="string" id="3722259">&#34;&#34;</span><br>
<span class="lineno">645</span><span class="op" id="3722262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3722265">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;receiver.&nbsp;&nbsp;The&nbsp;provided&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3722337">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;Parse&nbsp;returns&nbsp;nil,&nbsp;err&nbsp;on&nbsp;parse</span><br>
<span class="lineno"></span><span class="comment" id="3722402">//&nbsp;failure,&nbsp;otherwise&nbsp;its&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;ResolveReference.</span><br>
<span class="lineno">650</span><span class="keyword" id="3722474">func</span>&nbsp;<span class="op" id="3722479">(</span><span class="ident" id="3722480">u</span>&nbsp;<span class="op" id="3722482">*</span><span class="ident" id="3722483">URL</span><span class="op" id="3722486">)</span>&nbsp;<span class="ident" id="3722488">Parse</span><span class="op" id="3722493">(</span><span class="ident" id="3722494">ref</span>&nbsp;<span class="builtintype" id="3722498">string</span><span class="op" id="3722504">)</span>&nbsp;<span class="op" id="3722506">(</span><span class="op" id="3722507">*</span><span class="ident" id="3722508">URL</span><span class="op" id="3722511">,</span>&nbsp;<span class="builtintype" id="3722513">error</span><span class="op" id="3722518">)</span>&nbsp;<span class="op" id="3722520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722523">refurl</span><span class="op" id="3722529">,</span>&nbsp;<span class="ident" id="3722531">err</span>&nbsp;<span class="op" id="3722535">:=</span>&nbsp;<span class="ident" id="3722538">Parse</span><span class="op" id="3722543">(</span><span class="ident" id="3722544">ref</span><span class="op" id="3722547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722550">if</span>&nbsp;<span class="ident" id="3722553">err</span>&nbsp;<span class="op" id="3722557">!=</span>&nbsp;<span class="ident" id="3722560">nil</span>&nbsp;<span class="op" id="3722564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722568">return</span>&nbsp;<span class="ident" id="3722575">nil</span><span class="op" id="3722578">,</span>&nbsp;<span class="ident" id="3722580">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722585">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722588">return</span>&nbsp;<span class="ident" id="3722595">u</span><span class="op" id="3722596">.</span><span class="ident" id="3722597">ResolveReference</span><span class="op" id="3722613">(</span><span class="ident" id="3722614">refurl</span><span class="op" id="3722620">)</span><span class="op" id="3722621">,</span>&nbsp;<span class="ident" id="3722623">nil</span><br>
<span class="lineno"></span><span class="op" id="3722627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3722630">//&nbsp;ResolveReference&nbsp;resolves&nbsp;a&nbsp;URI&nbsp;reference&nbsp;to&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3722699">//&nbsp;an&nbsp;absolute&nbsp;base&nbsp;URI,&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;Section&nbsp;5.2.&nbsp;&nbsp;The&nbsp;URI&nbsp;reference</span><br>
<span class="lineno">660</span><span class="comment" id="3722769">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;ResolveReference&nbsp;always&nbsp;returns&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3722840">//&nbsp;URL&nbsp;instance,&nbsp;even&nbsp;if&nbsp;the&nbsp;returned&nbsp;URL&nbsp;is&nbsp;identical&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3722909">//&nbsp;base&nbsp;or&nbsp;reference.&nbsp;If&nbsp;ref&nbsp;is&nbsp;an&nbsp;absolute&nbsp;URL,&nbsp;then&nbsp;ResolveReference</span><br>
<span class="lineno"></span><span class="comment" id="3722980">//&nbsp;ignores&nbsp;base&nbsp;and&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;ref.</span><br>
<span class="lineno"></span><span class="keyword" id="3723023">func</span>&nbsp;<span class="op" id="3723028">(</span><span class="ident" id="3723029">u</span>&nbsp;<span class="op" id="3723031">*</span><span class="ident" id="3723032">URL</span><span class="op" id="3723035">)</span>&nbsp;<span class="ident" id="3723037">ResolveReference</span><span class="op" id="3723053">(</span><span class="ident" id="3723054">ref</span>&nbsp;<span class="op" id="3723058">*</span><span class="ident" id="3723059">URL</span><span class="op" id="3723062">)</span>&nbsp;<span class="op" id="3723064">*</span><span class="ident" id="3723065">URL</span>&nbsp;<span class="op" id="3723069">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723072">url</span>&nbsp;<span class="op" id="3723076">:=</span>&nbsp;<span class="op" id="3723079">*</span><span class="ident" id="3723080">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723085">if</span>&nbsp;<span class="ident" id="3723088">ref</span><span class="op" id="3723091">.</span><span class="ident" id="3723092">Scheme</span>&nbsp;<span class="op" id="3723099">==</span>&nbsp;<span class="string" id="3723102">&#34;&#34;</span>&nbsp;<span class="op" id="3723105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723109">url</span><span class="op" id="3723112">.</span><span class="ident" id="3723113">Scheme</span>&nbsp;<span class="op" id="3723120">=</span>&nbsp;<span class="ident" id="3723122">u</span><span class="op" id="3723123">.</span><span class="ident" id="3723124">Scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723135">if</span>&nbsp;<span class="ident" id="3723138">ref</span><span class="op" id="3723141">.</span><span class="ident" id="3723142">Scheme</span>&nbsp;<span class="op" id="3723149">!=</span>&nbsp;<span class="string" id="3723152">&#34;&#34;</span>&nbsp;<span class="op" id="3723155">||</span>&nbsp;<span class="ident" id="3723158">ref</span><span class="op" id="3723161">.</span><span class="ident" id="3723162">Host</span>&nbsp;<span class="op" id="3723167">!=</span>&nbsp;<span class="string" id="3723170">&#34;&#34;</span>&nbsp;<span class="op" id="3723173">||</span>&nbsp;<span class="ident" id="3723176">ref</span><span class="op" id="3723179">.</span><span class="ident" id="3723180">User</span>&nbsp;<span class="op" id="3723185">!=</span>&nbsp;<span class="ident" id="3723188">nil</span>&nbsp;<span class="op" id="3723192">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723196">//&nbsp;The&nbsp;&#34;absoluteURI&#34;&nbsp;or&nbsp;&#34;net_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723240">url</span><span class="op" id="3723243">.</span><span class="ident" id="3723244">Path</span>&nbsp;<span class="op" id="3723249">=</span>&nbsp;<span class="ident" id="3723251">resolvePath</span><span class="op" id="3723262">(</span><span class="ident" id="3723263">ref</span><span class="op" id="3723266">.</span><span class="ident" id="3723267">Path</span><span class="op" id="3723271">,</span>&nbsp;<span class="string" id="3723273">&#34;&#34;</span><span class="op" id="3723275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723279">return</span>&nbsp;<span class="op" id="3723286">&amp;</span><span class="ident" id="3723287">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723295">if</span>&nbsp;<span class="ident" id="3723298">ref</span><span class="op" id="3723301">.</span><span class="ident" id="3723302">Opaque</span>&nbsp;<span class="op" id="3723309">!=</span>&nbsp;<span class="string" id="3723312">&#34;&#34;</span>&nbsp;<span class="op" id="3723315">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723319">url</span><span class="op" id="3723322">.</span><span class="ident" id="3723323">User</span>&nbsp;<span class="op" id="3723328">=</span>&nbsp;<span class="ident" id="3723330">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723336">url</span><span class="op" id="3723339">.</span><span class="ident" id="3723340">Host</span>&nbsp;<span class="op" id="3723345">=</span>&nbsp;<span class="string" id="3723347">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723352">url</span><span class="op" id="3723355">.</span><span class="ident" id="3723356">Path</span>&nbsp;<span class="op" id="3723361">=</span>&nbsp;<span class="string" id="3723363">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723368">return</span>&nbsp;<span class="op" id="3723375">&amp;</span><span class="ident" id="3723376">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723381">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723384">if</span>&nbsp;<span class="ident" id="3723387">ref</span><span class="op" id="3723390">.</span><span class="ident" id="3723391">Path</span>&nbsp;<span class="op" id="3723396">==</span>&nbsp;<span class="string" id="3723399">&#34;&#34;</span>&nbsp;<span class="op" id="3723402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723406">if</span>&nbsp;<span class="ident" id="3723409">ref</span><span class="op" id="3723412">.</span><span class="ident" id="3723413">RawQuery</span>&nbsp;<span class="op" id="3723422">==</span>&nbsp;<span class="string" id="3723425">&#34;&#34;</span>&nbsp;<span class="op" id="3723428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723433">url</span><span class="op" id="3723436">.</span><span class="ident" id="3723437">RawQuery</span>&nbsp;<span class="op" id="3723446">=</span>&nbsp;<span class="ident" id="3723448">u</span><span class="op" id="3723449">.</span><span class="ident" id="3723450">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723462">if</span>&nbsp;<span class="ident" id="3723465">ref</span><span class="op" id="3723468">.</span><span class="ident" id="3723469">Fragment</span>&nbsp;<span class="op" id="3723478">==</span>&nbsp;<span class="string" id="3723481">&#34;&#34;</span>&nbsp;<span class="op" id="3723484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723490">url</span><span class="op" id="3723493">.</span><span class="ident" id="3723494">Fragment</span>&nbsp;<span class="op" id="3723503">=</span>&nbsp;<span class="ident" id="3723505">u</span><span class="op" id="3723506">.</span><span class="ident" id="3723507">Fragment</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723529">//&nbsp;The&nbsp;&#34;abs_path&#34;&nbsp;or&nbsp;&#34;rel_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723569">url</span><span class="op" id="3723572">.</span><span class="ident" id="3723573">Host</span>&nbsp;<span class="op" id="3723578">=</span>&nbsp;<span class="ident" id="3723580">u</span><span class="op" id="3723581">.</span><span class="ident" id="3723582">Host</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723588">url</span><span class="op" id="3723591">.</span><span class="ident" id="3723592">User</span>&nbsp;<span class="op" id="3723597">=</span>&nbsp;<span class="ident" id="3723599">u</span><span class="op" id="3723600">.</span><span class="ident" id="3723601">User</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723607">url</span><span class="op" id="3723610">.</span><span class="ident" id="3723611">Path</span>&nbsp;<span class="op" id="3723616">=</span>&nbsp;<span class="ident" id="3723618">resolvePath</span><span class="op" id="3723629">(</span><span class="ident" id="3723630">u</span><span class="op" id="3723631">.</span><span class="ident" id="3723632">Path</span><span class="op" id="3723636">,</span>&nbsp;<span class="ident" id="3723638">ref</span><span class="op" id="3723641">.</span><span class="ident" id="3723642">Path</span><span class="op" id="3723646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723649">return</span>&nbsp;<span class="op" id="3723656">&amp;</span><span class="ident" id="3723657">url</span><br>
<span class="lineno"></span><span class="op" id="3723661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3723664">//&nbsp;Query&nbsp;parses&nbsp;RawQuery&nbsp;and&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3723727">func</span>&nbsp;<span class="op" id="3723732">(</span><span class="ident" id="3723733">u</span>&nbsp;<span class="op" id="3723735">*</span><span class="ident" id="3723736">URL</span><span class="op" id="3723739">)</span>&nbsp;<span class="ident" id="3723741">Query</span><span class="op" id="3723746">(</span><span class="op" id="3723747">)</span>&nbsp;<span class="ident" id="3723749">Values</span>&nbsp;<span class="op" id="3723756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723759">v</span><span class="op" id="3723760">,</span>&nbsp;<span class="ident" id="3723762">_</span>&nbsp;<span class="op" id="3723764">:=</span>&nbsp;<span class="ident" id="3723767">ParseQuery</span><span class="op" id="3723777">(</span><span class="ident" id="3723778">u</span><span class="op" id="3723779">.</span><span class="ident" id="3723780">RawQuery</span><span class="op" id="3723788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723791">return</span>&nbsp;<span class="ident" id="3723798">v</span><br>
<span class="lineno"></span><span class="op" id="3723800">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="comment" id="3723803">//&nbsp;RequestURI&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;path?query&nbsp;or&nbsp;opaque?query</span><br>
<span class="lineno"></span><span class="comment" id="3723864">//&nbsp;string&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;for&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword" id="3723919">func</span>&nbsp;<span class="op" id="3723924">(</span><span class="ident" id="3723925">u</span>&nbsp;<span class="op" id="3723927">*</span><span class="ident" id="3723928">URL</span><span class="op" id="3723931">)</span>&nbsp;<span class="ident" id="3723933">RequestURI</span><span class="op" id="3723943">(</span><span class="op" id="3723944">)</span>&nbsp;<span class="builtintype" id="3723946">string</span>&nbsp;<span class="op" id="3723953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723956">result</span>&nbsp;<span class="op" id="3723963">:=</span>&nbsp;<span class="ident" id="3723966">u</span><span class="op" id="3723967">.</span><span class="ident" id="3723968">Opaque</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723976">if</span>&nbsp;<span class="ident" id="3723979">result</span>&nbsp;<span class="op" id="3723986">==</span>&nbsp;<span class="string" id="3723989">&#34;&#34;</span>&nbsp;<span class="op" id="3723992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723996">result</span>&nbsp;<span class="op" id="3724003">=</span>&nbsp;<span class="ident" id="3724005">escape</span><span class="op" id="3724011">(</span><span class="ident" id="3724012">u</span><span class="op" id="3724013">.</span><span class="ident" id="3724014">Path</span><span class="op" id="3724018">,</span>&nbsp;<span class="ident" id="3724020">encodePath</span><span class="op" id="3724030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724034">if</span>&nbsp;<span class="ident" id="3724037">result</span>&nbsp;<span class="op" id="3724044">==</span>&nbsp;<span class="string" id="3724047">&#34;&#34;</span>&nbsp;<span class="op" id="3724050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724055">result</span>&nbsp;<span class="op" id="3724062">=</span>&nbsp;<span class="string" id="3724064">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724070">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724073">}</span>&nbsp;<span class="keyword" id="3724075">else</span>&nbsp;<span class="op" id="3724080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724084">if</span>&nbsp;<span class="ident" id="3724087">strings</span><span class="op" id="3724094">.</span><span class="ident" id="3724095">HasPrefix</span><span class="op" id="3724104">(</span><span class="ident" id="3724105">result</span><span class="op" id="3724111">,</span>&nbsp;<span class="string" id="3724113">&#34;//&#34;</span><span class="op" id="3724117">)</span>&nbsp;<span class="op" id="3724119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724124">result</span>&nbsp;<span class="op" id="3724131">=</span>&nbsp;<span class="ident" id="3724133">u</span><span class="op" id="3724134">.</span><span class="ident" id="3724135">Scheme</span>&nbsp;<span class="op" id="3724142">+</span>&nbsp;<span class="string" id="3724144">&#34;:&#34;</span>&nbsp;<span class="op" id="3724148">+</span>&nbsp;<span class="ident" id="3724150">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724162">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724165">if</span>&nbsp;<span class="ident" id="3724168">u</span><span class="op" id="3724169">.</span><span class="ident" id="3724170">RawQuery</span>&nbsp;<span class="op" id="3724179">!=</span>&nbsp;<span class="string" id="3724182">&#34;&#34;</span>&nbsp;<span class="op" id="3724185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724189">result</span>&nbsp;<span class="op" id="3724196">+=</span>&nbsp;<span class="string" id="3724199">&#34;?&#34;</span>&nbsp;<span class="op" id="3724203">+</span>&nbsp;<span class="ident" id="3724205">u</span><span class="op" id="3724206">.</span><span class="ident" id="3724207">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724220">return</span>&nbsp;<span class="ident" id="3724227">result</span><br>
<span class="lineno"></span><span class="op" id="3724234">}</span>
</div>
</body>
</html>
