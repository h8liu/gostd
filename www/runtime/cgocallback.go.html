<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1883633">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1883689">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1883743">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1883794">package</span>&nbsp;<span class="ident" id="1883802">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1883811">import</span>&nbsp;<span class="string" id="1883818">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1883828">//&nbsp;These&nbsp;functions&nbsp;are&nbsp;called&nbsp;from&nbsp;C&nbsp;code&nbsp;via&nbsp;cgo/callbacks.c.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1883892">//&nbsp;Allocate&nbsp;memory.&nbsp;&nbsp;This&nbsp;allocates&nbsp;the&nbsp;requested&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1883961">//&nbsp;memory&nbsp;controlled&nbsp;by&nbsp;the&nbsp;Go&nbsp;runtime.&nbsp;&nbsp;The&nbsp;allocated&nbsp;memory&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1884031">//&nbsp;zeroed.&nbsp;&nbsp;You&nbsp;are&nbsp;responsible&nbsp;for&nbsp;ensuring&nbsp;that&nbsp;the&nbsp;Go&nbsp;garbage</span><br>
<span class="lineno"></span><span class="comment" id="1884096">//&nbsp;collector&nbsp;can&nbsp;see&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;allocated&nbsp;memory&nbsp;for&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">15</span><span class="comment" id="1884166">//&nbsp;it&nbsp;is&nbsp;valid,&nbsp;e.g.,&nbsp;by&nbsp;storing&nbsp;a&nbsp;pointer&nbsp;in&nbsp;a&nbsp;local&nbsp;variable&nbsp;in&nbsp;your</span><br>
<span class="lineno"></span><span class="comment" id="1884237">//&nbsp;C&nbsp;function,&nbsp;or&nbsp;in&nbsp;memory&nbsp;allocated&nbsp;by&nbsp;the&nbsp;Go&nbsp;runtime.&nbsp;&nbsp;If&nbsp;the&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="1884307">//&nbsp;pointers&nbsp;are&nbsp;in&nbsp;a&nbsp;C&nbsp;global&nbsp;variable&nbsp;or&nbsp;in&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="1884373">//&nbsp;malloc,&nbsp;then&nbsp;the&nbsp;Go&nbsp;garbage&nbsp;collector&nbsp;may&nbsp;collect&nbsp;the&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1884438">//</span><br>
<span class="lineno">20</span><span class="comment" id="1884441">//&nbsp;TODO(rsc,iant):&nbsp;This&nbsp;memory&nbsp;is&nbsp;untyped.</span><br>
<span class="lineno"></span><span class="comment" id="1884484">//&nbsp;Either&nbsp;we&nbsp;need&nbsp;to&nbsp;add&nbsp;types&nbsp;or&nbsp;we&nbsp;need&nbsp;to&nbsp;stop&nbsp;using&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1884545">func</span>&nbsp;<span class="ident" id="1884550">_cgo_allocate_internal</span><span class="op" id="1884572">(</span><span class="builtinfunc" id="1884573">len</span>&nbsp;<span class="builtintype" id="1884577">uintptr</span><span class="op" id="1884584">)</span>&nbsp;<span class="ident" id="1884586"><a href="/runtime/cgocallback.go.html#1883818">unsafe</a></span><span class="op" id="1884592">.</span><span class="ident" id="1884593">Pointer</span>&nbsp;<span class="op" id="1884601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1884604">if</span>&nbsp;<span class="builtinfunc" id="1884607"><a href="/runtime/cgocallback.go.html#1884573">len</a></span>&nbsp;<span class="op" id="1884611">==</span>&nbsp;<span class="num" id="1884614">0</span>&nbsp;<span class="op" id="1884616">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1884620"><a href="/runtime/cgocallback.go.html#1884573">len</a></span>&nbsp;<span class="op" id="1884624">=</span>&nbsp;<span class="num" id="1884626">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1884629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884632">ret</span>&nbsp;<span class="op" id="1884636">:=</span>&nbsp;<span class="ident" id="1884639"><a href="/runtime/cgocallback.go.html#1883818">unsafe</a></span><span class="op" id="1884645">.</span><span class="ident" id="1884646">Pointer</span><span class="op" id="1884653">(</span><span class="op" id="1884654">&amp;</span><span class="builtinfunc" id="1884655">make</span><span class="op" id="1884659">(</span><span class="op" id="1884660">[</span><span class="op" id="1884661">]</span><span class="ident" id="1884662"><a href="/runtime/cgocallback.go.html#1883818">unsafe</a></span><span class="op" id="1884668">.</span><span class="ident" id="1884669">Pointer</span><span class="op" id="1884676">,</span>&nbsp;<span class="op" id="1884678">(</span><span class="builtinfunc" id="1884679"><a href="/runtime/cgocallback.go.html#1884573">len</a></span><span class="op" id="1884682">+</span><span class="ident" id="1884683"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span><span class="op" id="1884690">-</span><span class="num" id="1884691">1</span><span class="op" id="1884692">)</span><span class="op" id="1884693">/</span><span class="ident" id="1884694"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span><span class="op" id="1884701">)</span><span class="op" id="1884702">[</span><span class="num" id="1884703">0</span><span class="op" id="1884704">]</span><span class="op" id="1884705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884708">c</span>&nbsp;<span class="op" id="1884710">:=</span>&nbsp;<span class="builtinfunc" id="1884713">new</span><span class="op" id="1884716">(</span><span class="ident" id="1884717"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2183291">cgomal</a></span><span class="op" id="1884723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884726"><a href="/runtime/cgocallback.go.html#1884708">c</a></span><span class="op" id="1884727">.</span><span class="ident" id="1884728">alloc</span>&nbsp;<span class="op" id="1884734">=</span>&nbsp;<span class="ident" id="1884736"><a href="/runtime/cgocallback.go.html#1884632">ret</a></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884741">gp</span>&nbsp;<span class="op" id="1884744">:=</span>&nbsp;<span class="ident" id="1884747"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="1884751">(</span><span class="op" id="1884752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884755"><a href="/runtime/cgocallback.go.html#1884708">c</a></span><span class="op" id="1884756">.</span><span class="ident" id="1884757">next</span>&nbsp;<span class="op" id="1884762">=</span>&nbsp;<span class="ident" id="1884764"><a href="/runtime/cgocallback.go.html#1884741">gp</a></span><span class="op" id="1884766">.</span><span class="ident" id="1884767">m</span><span class="op" id="1884768">.</span><span class="ident" id="1884769">cgomal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884777"><a href="/runtime/cgocallback.go.html#1884741">gp</a></span><span class="op" id="1884779">.</span><span class="ident" id="1884780">m</span><span class="op" id="1884781">.</span><span class="ident" id="1884782">cgomal</span>&nbsp;<span class="op" id="1884789">=</span>&nbsp;<span class="ident" id="1884791"><a href="/runtime/cgocallback.go.html#1884708">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1884794">return</span>&nbsp;<span class="ident" id="1884801"><a href="/runtime/cgocallback.go.html#1884632">ret</a></span><br>
<span class="lineno"></span><span class="op" id="1884805">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1884808">//&nbsp;Panic.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1884819">func</span>&nbsp;<span class="ident" id="1884824">_cgo_panic_internal</span><span class="op" id="1884843">(</span><span class="ident" id="1884844">p</span>&nbsp;<span class="op" id="1884846">*</span><span class="builtintype" id="1884847">byte</span><span class="op" id="1884851">)</span>&nbsp;<span class="op" id="1884853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1884856">panic</span><span class="op" id="1884861">(</span><span class="ident" id="1884862"><a href="/runtime/stubs.go.html#2137710">gostringnocopy</a></span><span class="op" id="1884876">(</span><span class="ident" id="1884877"><a href="/runtime/cgocallback.go.html#1884844">p</a></span><span class="op" id="1884878">)</span><span class="op" id="1884879">)</span><br>
<span class="lineno">40</span><span class="op" id="1884881">}</span>
</div>
</body>
</html>
