<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3939727">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3939782">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3939836">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3939887">//&nbsp;OFB&nbsp;(Output&nbsp;Feedback)&nbsp;Mode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3939919">package</span>&nbsp;<span class="ident" id="3939927">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3939935">type</span>&nbsp;<span class="ident" id="3939940">ofb</span>&nbsp;<span class="keyword" id="3939944">struct</span>&nbsp;<span class="op" id="3939951">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939954">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3939962">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939969">cipher</span>&nbsp;&nbsp;<span class="op" id="3939977">[</span><span class="op" id="3939978">]</span><span class="builtintype" id="3939979">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939985">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3939993">[</span><span class="op" id="3939994">]</span><span class="builtintype" id="3939995">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940001">outUsed</span>&nbsp;<span class="builtintype" id="3940009">int</span><br>
<span class="lineno"></span><span class="op" id="3940013">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3940016">//&nbsp;NewOFB&nbsp;returns&nbsp;a&nbsp;Stream&nbsp;that&nbsp;encrypts&nbsp;or&nbsp;decrypts&nbsp;using&nbsp;the&nbsp;block&nbsp;cipher&nbsp;b</span><br>
<span class="lineno"></span><span class="comment" id="3940094">//&nbsp;in&nbsp;output&nbsp;feedback&nbsp;mode.&nbsp;The&nbsp;initialization&nbsp;vector&nbsp;iv&#39;s&nbsp;length&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span><span class="comment" id="3940174">//&nbsp;to&nbsp;b&#39;s&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3940196">func</span>&nbsp;<span class="ident" id="3940201">NewOFB</span><span class="op" id="3940207">(</span><span class="ident" id="3940208">b</span>&nbsp;<span class="ident" id="3940210">Block</span><span class="op" id="3940215">,</span>&nbsp;<span class="ident" id="3940217">iv</span>&nbsp;<span class="op" id="3940220">[</span><span class="op" id="3940221">]</span><span class="builtintype" id="3940222">byte</span><span class="op" id="3940226">)</span>&nbsp;<span class="ident" id="3940228">Stream</span>&nbsp;<span class="op" id="3940235">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940238">blockSize</span>&nbsp;<span class="op" id="3940248">:=</span>&nbsp;<span class="ident" id="3940251">b</span><span class="op" id="3940252">.</span><span class="ident" id="3940253">BlockSize</span><span class="op" id="3940262">(</span><span class="op" id="3940263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940266">if</span>&nbsp;<span class="builtinfunc" id="3940269">len</span><span class="op" id="3940272">(</span><span class="ident" id="3940273">iv</span><span class="op" id="3940275">)</span>&nbsp;<span class="op" id="3940277">!=</span>&nbsp;<span class="ident" id="3940280">blockSize</span>&nbsp;<span class="op" id="3940290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940294">return</span>&nbsp;<span class="ident" id="3940301">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940309">bufSize</span>&nbsp;<span class="op" id="3940317">:=</span>&nbsp;<span class="ident" id="3940320">streamBufferSize</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940338">if</span>&nbsp;<span class="ident" id="3940341">bufSize</span>&nbsp;<span class="op" id="3940349">&lt;</span>&nbsp;<span class="ident" id="3940351">blockSize</span>&nbsp;<span class="op" id="3940361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940365">bufSize</span>&nbsp;<span class="op" id="3940373">=</span>&nbsp;<span class="ident" id="3940375">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940389">x</span>&nbsp;<span class="op" id="3940391">:=</span>&nbsp;<span class="op" id="3940394">&amp;</span><span class="ident" id="3940395">ofb</span><span class="op" id="3940398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940402">b</span><span class="op" id="3940403">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3940411">b</span><span class="op" id="3940412">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940416">cipher</span><span class="op" id="3940422">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3940425">make</span><span class="op" id="3940429">(</span><span class="op" id="3940430">[</span><span class="op" id="3940431">]</span><span class="builtintype" id="3940432">byte</span><span class="op" id="3940436">,</span>&nbsp;<span class="ident" id="3940438">blockSize</span><span class="op" id="3940447">)</span><span class="op" id="3940448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940452">out</span><span class="op" id="3940455">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3940461">make</span><span class="op" id="3940465">(</span><span class="op" id="3940466">[</span><span class="op" id="3940467">]</span><span class="builtintype" id="3940468">byte</span><span class="op" id="3940472">,</span>&nbsp;<span class="num" id="3940474">0</span><span class="op" id="3940475">,</span>&nbsp;<span class="ident" id="3940477">bufSize</span><span class="op" id="3940484">)</span><span class="op" id="3940485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940489">outUsed</span><span class="op" id="3940496">:</span>&nbsp;<span class="num" id="3940498">0</span><span class="op" id="3940499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3940506">copy</span><span class="op" id="3940510">(</span><span class="ident" id="3940511">x</span><span class="op" id="3940512">.</span><span class="ident" id="3940513">cipher</span><span class="op" id="3940519">,</span>&nbsp;<span class="ident" id="3940521">iv</span><span class="op" id="3940523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940526">return</span>&nbsp;<span class="ident" id="3940533">x</span><br>
<span class="lineno"></span><span class="op" id="3940535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3940538">func</span>&nbsp;<span class="op" id="3940543">(</span><span class="ident" id="3940544">x</span>&nbsp;<span class="op" id="3940546">*</span><span class="ident" id="3940547">ofb</span><span class="op" id="3940550">)</span>&nbsp;<span class="ident" id="3940552">refill</span><span class="op" id="3940558">(</span><span class="op" id="3940559">)</span>&nbsp;<span class="op" id="3940561">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940564">bs</span>&nbsp;<span class="op" id="3940567">:=</span>&nbsp;<span class="ident" id="3940570">x</span><span class="op" id="3940571">.</span><span class="ident" id="3940572">b</span><span class="op" id="3940573">.</span><span class="ident" id="3940574">BlockSize</span><span class="op" id="3940583">(</span><span class="op" id="3940584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940587">remain</span>&nbsp;<span class="op" id="3940594">:=</span>&nbsp;<span class="builtinfunc" id="3940597">len</span><span class="op" id="3940600">(</span><span class="ident" id="3940601">x</span><span class="op" id="3940602">.</span><span class="ident" id="3940603">out</span><span class="op" id="3940606">)</span>&nbsp;<span class="op" id="3940608">-</span>&nbsp;<span class="ident" id="3940610">x</span><span class="op" id="3940611">.</span><span class="ident" id="3940612">outUsed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940621">if</span>&nbsp;<span class="ident" id="3940624">remain</span>&nbsp;<span class="op" id="3940631">&gt;</span>&nbsp;<span class="ident" id="3940633">x</span><span class="op" id="3940634">.</span><span class="ident" id="3940635">outUsed</span>&nbsp;<span class="op" id="3940643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940647">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940655">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3940658">copy</span><span class="op" id="3940662">(</span><span class="ident" id="3940663">x</span><span class="op" id="3940664">.</span><span class="ident" id="3940665">out</span><span class="op" id="3940668">,</span>&nbsp;<span class="ident" id="3940670">x</span><span class="op" id="3940671">.</span><span class="ident" id="3940672">out</span><span class="op" id="3940675">[</span><span class="ident" id="3940676">x</span><span class="op" id="3940677">.</span><span class="ident" id="3940678">outUsed</span><span class="op" id="3940685">:</span><span class="op" id="3940686">]</span><span class="op" id="3940687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940690">x</span><span class="op" id="3940691">.</span><span class="ident" id="3940692">out</span>&nbsp;<span class="op" id="3940696">=</span>&nbsp;<span class="ident" id="3940698">x</span><span class="op" id="3940699">.</span><span class="ident" id="3940700">out</span><span class="op" id="3940703">[</span><span class="op" id="3940704">:</span><span class="builtinfunc" id="3940705">cap</span><span class="op" id="3940708">(</span><span class="ident" id="3940709">x</span><span class="op" id="3940710">.</span><span class="ident" id="3940711">out</span><span class="op" id="3940714">)</span><span class="op" id="3940715">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940718">for</span>&nbsp;<span class="ident" id="3940722">remain</span>&nbsp;<span class="op" id="3940729">&lt;</span>&nbsp;<span class="builtinfunc" id="3940731">len</span><span class="op" id="3940734">(</span><span class="ident" id="3940735">x</span><span class="op" id="3940736">.</span><span class="ident" id="3940737">out</span><span class="op" id="3940740">)</span><span class="op" id="3940741">-</span><span class="ident" id="3940742">bs</span>&nbsp;<span class="op" id="3940745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940749">x</span><span class="op" id="3940750">.</span><span class="ident" id="3940751">b</span><span class="op" id="3940752">.</span><span class="ident" id="3940753">Encrypt</span><span class="op" id="3940760">(</span><span class="ident" id="3940761">x</span><span class="op" id="3940762">.</span><span class="ident" id="3940763">cipher</span><span class="op" id="3940769">,</span>&nbsp;<span class="ident" id="3940771">x</span><span class="op" id="3940772">.</span><span class="ident" id="3940773">cipher</span><span class="op" id="3940779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3940783">copy</span><span class="op" id="3940787">(</span><span class="ident" id="3940788">x</span><span class="op" id="3940789">.</span><span class="ident" id="3940790">out</span><span class="op" id="3940793">[</span><span class="ident" id="3940794">remain</span><span class="op" id="3940800">:</span><span class="op" id="3940801">]</span><span class="op" id="3940802">,</span>&nbsp;<span class="ident" id="3940804">x</span><span class="op" id="3940805">.</span><span class="ident" id="3940806">cipher</span><span class="op" id="3940812">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940816">remain</span>&nbsp;<span class="op" id="3940823">+=</span>&nbsp;<span class="ident" id="3940826">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940833">x</span><span class="op" id="3940834">.</span><span class="ident" id="3940835">out</span>&nbsp;<span class="op" id="3940839">=</span>&nbsp;<span class="ident" id="3940841">x</span><span class="op" id="3940842">.</span><span class="ident" id="3940843">out</span><span class="op" id="3940846">[</span><span class="op" id="3940847">:</span><span class="ident" id="3940848">remain</span><span class="op" id="3940854">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940857">x</span><span class="op" id="3940858">.</span><span class="ident" id="3940859">outUsed</span>&nbsp;<span class="op" id="3940867">=</span>&nbsp;<span class="num" id="3940869">0</span><br>
<span class="lineno"></span><span class="op" id="3940871">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3940874">func</span>&nbsp;<span class="op" id="3940879">(</span><span class="ident" id="3940880">x</span>&nbsp;<span class="op" id="3940882">*</span><span class="ident" id="3940883">ofb</span><span class="op" id="3940886">)</span>&nbsp;<span class="ident" id="3940888">XORKeyStream</span><span class="op" id="3940900">(</span><span class="ident" id="3940901">dst</span><span class="op" id="3940904">,</span>&nbsp;<span class="ident" id="3940906">src</span>&nbsp;<span class="op" id="3940910">[</span><span class="op" id="3940911">]</span><span class="builtintype" id="3940912">byte</span><span class="op" id="3940916">)</span>&nbsp;<span class="op" id="3940918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940921">for</span>&nbsp;<span class="builtinfunc" id="3940925">len</span><span class="op" id="3940928">(</span><span class="ident" id="3940929">src</span><span class="op" id="3940932">)</span>&nbsp;<span class="op" id="3940934">&gt;</span>&nbsp;<span class="num" id="3940936">0</span>&nbsp;<span class="op" id="3940938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940942">if</span>&nbsp;<span class="ident" id="3940945">x</span><span class="op" id="3940946">.</span><span class="ident" id="3940947">outUsed</span>&nbsp;<span class="op" id="3940955">&gt;=</span>&nbsp;<span class="builtinfunc" id="3940958">len</span><span class="op" id="3940961">(</span><span class="ident" id="3940962">x</span><span class="op" id="3940963">.</span><span class="ident" id="3940964">out</span><span class="op" id="3940967">)</span><span class="op" id="3940968">-</span><span class="ident" id="3940969">x</span><span class="op" id="3940970">.</span><span class="ident" id="3940971">b</span><span class="op" id="3940972">.</span><span class="ident" id="3940973">BlockSize</span><span class="op" id="3940982">(</span><span class="op" id="3940983">)</span>&nbsp;<span class="op" id="3940985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940990">x</span><span class="op" id="3940991">.</span><span class="ident" id="3940992">refill</span><span class="op" id="3940998">(</span><span class="op" id="3940999">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3941003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941007">n</span>&nbsp;<span class="op" id="3941009">:=</span>&nbsp;<span class="ident" id="3941012">xorBytes</span><span class="op" id="3941020">(</span><span class="ident" id="3941021">dst</span><span class="op" id="3941024">,</span>&nbsp;<span class="ident" id="3941026">src</span><span class="op" id="3941029">,</span>&nbsp;<span class="ident" id="3941031">x</span><span class="op" id="3941032">.</span><span class="ident" id="3941033">out</span><span class="op" id="3941036">[</span><span class="ident" id="3941037">x</span><span class="op" id="3941038">.</span><span class="ident" id="3941039">outUsed</span><span class="op" id="3941046">:</span><span class="op" id="3941047">]</span><span class="op" id="3941048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941052">dst</span>&nbsp;<span class="op" id="3941056">=</span>&nbsp;<span class="ident" id="3941058">dst</span><span class="op" id="3941061">[</span><span class="ident" id="3941062">n</span><span class="op" id="3941063">:</span><span class="op" id="3941064">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941068">src</span>&nbsp;<span class="op" id="3941072">=</span>&nbsp;<span class="ident" id="3941074">src</span><span class="op" id="3941077">[</span><span class="ident" id="3941078">n</span><span class="op" id="3941079">:</span><span class="op" id="3941080">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941084">x</span><span class="op" id="3941085">.</span><span class="ident" id="3941086">outUsed</span>&nbsp;<span class="op" id="3941094">+=</span>&nbsp;<span class="ident" id="3941097">n</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3941100">}</span><br>
<span class="lineno"></span><span class="op" id="3941102">}</span>
</div>
</body>
</html>
