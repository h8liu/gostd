<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/dsa</h2>
<ul>
<li><a href="/gostd/crypto/dsa/dsa.go.html" class="current">dsa.go</a></li>
<li><a href="/gostd/crypto/dsa/dsa_test.go.html">dsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4070078">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4070133">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4070187">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4070238">//&nbsp;Package&nbsp;dsa&nbsp;implements&nbsp;the&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4070323">package</span>&nbsp;<span class="ident" id="4070331">dsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4070336">import</span>&nbsp;<span class="op" id="4070343">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4070346">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4070356">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4070362">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4070373">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4070376">//&nbsp;Parameters&nbsp;represents&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;for&nbsp;a&nbsp;key.&nbsp;These&nbsp;parameters&nbsp;can</span><br>
<span class="lineno">15</span><span class="comment" id="4070455">//&nbsp;be&nbsp;shared&nbsp;across&nbsp;many&nbsp;keys.&nbsp;The&nbsp;bit&nbsp;length&nbsp;of&nbsp;Q&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="4070531">type</span>&nbsp;<span class="ident" id="4070536">Parameters</span>&nbsp;<span class="keyword" id="4070547">struct</span>&nbsp;<span class="op" id="4070554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070557">P</span><span class="op" id="4070558">,</span>&nbsp;<span class="ident" id="4070560">Q</span><span class="op" id="4070561">,</span>&nbsp;<span class="ident" id="4070563">G</span>&nbsp;<span class="op" id="4070565">*</span><span class="ident" id="4070566">big</span><span class="op" id="4070569">.</span><span class="ident" id="4070570">Int</span><br>
<span class="lineno"></span><span class="op" id="4070574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4070577">//&nbsp;PublicKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4070619">type</span>&nbsp;<span class="ident" id="4070624">PublicKey</span>&nbsp;<span class="keyword" id="4070634">struct</span>&nbsp;<span class="op" id="4070641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070644">Parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070656">Y</span>&nbsp;<span class="op" id="4070658">*</span><span class="ident" id="4070659">big</span><span class="op" id="4070662">.</span><span class="ident" id="4070663">Int</span><br>
<span class="lineno"></span><span class="op" id="4070667">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4070670">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4070714">type</span>&nbsp;<span class="ident" id="4070719">PrivateKey</span>&nbsp;<span class="keyword" id="4070730">struct</span>&nbsp;<span class="op" id="4070737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070740">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070751">X</span>&nbsp;<span class="op" id="4070753">*</span><span class="ident" id="4070754">big</span><span class="op" id="4070757">.</span><span class="ident" id="4070758">Int</span><br>
<span class="lineno">30</span><span class="op" id="4070762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4070765">//&nbsp;ErrInvalidPublicKey&nbsp;results&nbsp;when&nbsp;a&nbsp;public&nbsp;key&nbsp;is&nbsp;not&nbsp;usable&nbsp;by&nbsp;this&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4070842">//&nbsp;FIPS&nbsp;is&nbsp;quite&nbsp;strict&nbsp;about&nbsp;the&nbsp;format&nbsp;of&nbsp;DSA&nbsp;keys,&nbsp;but&nbsp;other&nbsp;code&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4070918">//&nbsp;less&nbsp;so.&nbsp;Thus,&nbsp;when&nbsp;using&nbsp;keys&nbsp;which&nbsp;may&nbsp;have&nbsp;been&nbsp;generated&nbsp;by&nbsp;other&nbsp;code,</span><br>
<span class="lineno">35</span><span class="comment" id="4070997">//&nbsp;this&nbsp;error&nbsp;must&nbsp;be&nbsp;handled.</span><br>
<span class="lineno"></span><span class="keyword" id="4071028">var</span>&nbsp;<span class="ident" id="4071032">ErrInvalidPublicKey</span>&nbsp;<span class="op" id="4071052">=</span>&nbsp;<span class="ident" id="4071054">errors</span><span class="op" id="4071060">.</span><span class="ident" id="4071061">New</span><span class="op" id="4071064">(</span><span class="string" id="4071065">&#34;crypto/dsa:&nbsp;invalid&nbsp;public&nbsp;key&#34;</span><span class="op" id="4071097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4071100">//&nbsp;ParameterSizes&nbsp;is&nbsp;a&nbsp;enumeration&nbsp;of&nbsp;the&nbsp;acceptable&nbsp;bit&nbsp;lengths&nbsp;of&nbsp;the&nbsp;primes</span><br>
<span class="lineno"></span><span class="comment" id="4071179">//&nbsp;in&nbsp;a&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters.&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno">40</span><span class="keyword" id="4071239">type</span>&nbsp;<span class="ident" id="4071244">ParameterSizes</span>&nbsp;<span class="builtintype" id="4071259">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4071264">const</span>&nbsp;<span class="op" id="4071270">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071273">L1024N160</span>&nbsp;<span class="ident" id="4071283">ParameterSizes</span>&nbsp;<span class="op" id="4071298">=</span>&nbsp;<span class="ident" id="4071300">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071306">L2048N224</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071317">L2048N256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071328">L3072N256</span><br>
<span class="lineno"></span><span class="op" id="4071338">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4071341">//&nbsp;numMRTests&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;Miller-Rabin&nbsp;primality&nbsp;tests&nbsp;that&nbsp;we&nbsp;perform.&nbsp;We</span><br>
<span class="lineno">50</span><span class="comment" id="4071421">//&nbsp;pick&nbsp;the&nbsp;largest&nbsp;recommended&nbsp;number&nbsp;from&nbsp;table&nbsp;C.1&nbsp;of&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4071490">const</span>&nbsp;<span class="ident" id="4071496">numMRTests</span>&nbsp;<span class="op" id="4071507">=</span>&nbsp;<span class="num" id="4071509">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4071513">//&nbsp;GenerateParameters&nbsp;puts&nbsp;a&nbsp;random,&nbsp;valid&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters&nbsp;into&nbsp;params.</span><br>
<span class="lineno"></span><span class="comment" id="4071591">//&nbsp;This&nbsp;function&nbsp;takes&nbsp;many&nbsp;seconds,&nbsp;even&nbsp;on&nbsp;fast&nbsp;machines.</span><br>
<span class="lineno">55</span><span class="keyword" id="4071651">func</span>&nbsp;<span class="ident" id="4071656">GenerateParameters</span><span class="op" id="4071674">(</span><span class="ident" id="4071675">params</span>&nbsp;<span class="op" id="4071682">*</span><span class="ident" id="4071683">Parameters</span><span class="op" id="4071693">,</span>&nbsp;<span class="ident" id="4071695">rand</span>&nbsp;<span class="ident" id="4071700">io</span><span class="op" id="4071702">.</span><span class="ident" id="4071703">Reader</span><span class="op" id="4071709">,</span>&nbsp;<span class="ident" id="4071711">sizes</span>&nbsp;<span class="ident" id="4071717">ParameterSizes</span><span class="op" id="4071731">)</span>&nbsp;<span class="op" id="4071733">(</span><span class="ident" id="4071734">err</span>&nbsp;<span class="builtintype" id="4071738">error</span><span class="op" id="4071743">)</span>&nbsp;<span class="op" id="4071745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071748">//&nbsp;This&nbsp;function&nbsp;doesn&#39;t&nbsp;follow&nbsp;FIPS&nbsp;186-3&nbsp;exactly&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071819">//&nbsp;use&nbsp;a&nbsp;verification&nbsp;seed&nbsp;to&nbsp;generate&nbsp;the&nbsp;primes.&nbsp;The&nbsp;verification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071888">//&nbsp;seed&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;exported&nbsp;or&nbsp;used&nbsp;by&nbsp;other&nbsp;code&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071953">//&nbsp;omitting&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;cleaner.</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071994">var</span>&nbsp;<span class="ident" id="4071998">L</span><span class="op" id="4071999">,</span>&nbsp;<span class="ident" id="4072001">N</span>&nbsp;<span class="builtintype" id="4072003">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072008">switch</span>&nbsp;<span class="ident" id="4072015">sizes</span>&nbsp;<span class="op" id="4072021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072024">case</span>&nbsp;<span class="ident" id="4072029">L1024N160</span><span class="op" id="4072038">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072042">L</span>&nbsp;<span class="op" id="4072044">=</span>&nbsp;<span class="num" id="4072046">1024</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072053">N</span>&nbsp;<span class="op" id="4072055">=</span>&nbsp;<span class="num" id="4072057">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072062">case</span>&nbsp;<span class="ident" id="4072067">L2048N224</span><span class="op" id="4072076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072080">L</span>&nbsp;<span class="op" id="4072082">=</span>&nbsp;<span class="num" id="4072084">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072091">N</span>&nbsp;<span class="op" id="4072093">=</span>&nbsp;<span class="num" id="4072095">224</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072100">case</span>&nbsp;<span class="ident" id="4072105">L2048N256</span><span class="op" id="4072114">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072118">L</span>&nbsp;<span class="op" id="4072120">=</span>&nbsp;<span class="num" id="4072122">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072129">N</span>&nbsp;<span class="op" id="4072131">=</span>&nbsp;<span class="num" id="4072133">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072138">case</span>&nbsp;<span class="ident" id="4072143">L3072N256</span><span class="op" id="4072152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072156">L</span>&nbsp;<span class="op" id="4072158">=</span>&nbsp;<span class="num" id="4072160">3072</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072167">N</span>&nbsp;<span class="op" id="4072169">=</span>&nbsp;<span class="num" id="4072171">256</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072176">default</span><span class="op" id="4072183">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072187">return</span>&nbsp;<span class="ident" id="4072194">errors</span><span class="op" id="4072200">.</span><span class="ident" id="4072201">New</span><span class="op" id="4072204">(</span><span class="string" id="4072205">&#34;crypto/dsa:&nbsp;invalid&nbsp;ParameterSizes&#34;</span><span class="op" id="4072241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072248">qBytes</span>&nbsp;<span class="op" id="4072255">:=</span>&nbsp;<span class="builtinfunc" id="4072258">make</span><span class="op" id="4072262">(</span><span class="op" id="4072263">[</span><span class="op" id="4072264">]</span><span class="builtintype" id="4072265">byte</span><span class="op" id="4072269">,</span>&nbsp;<span class="ident" id="4072271">N</span><span class="op" id="4072272">/</span><span class="num" id="4072273">8</span><span class="op" id="4072274">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072277">pBytes</span>&nbsp;<span class="op" id="4072284">:=</span>&nbsp;<span class="builtinfunc" id="4072287">make</span><span class="op" id="4072291">(</span><span class="op" id="4072292">[</span><span class="op" id="4072293">]</span><span class="builtintype" id="4072294">byte</span><span class="op" id="4072298">,</span>&nbsp;<span class="ident" id="4072300">L</span><span class="op" id="4072301">/</span><span class="num" id="4072302">8</span><span class="op" id="4072303">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072307">q</span>&nbsp;<span class="op" id="4072309">:=</span>&nbsp;<span class="builtinfunc" id="4072312">new</span><span class="op" id="4072315">(</span><span class="ident" id="4072316">big</span><span class="op" id="4072319">.</span><span class="ident" id="4072320">Int</span><span class="op" id="4072323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072326">p</span>&nbsp;<span class="op" id="4072328">:=</span>&nbsp;<span class="builtinfunc" id="4072331">new</span><span class="op" id="4072334">(</span><span class="ident" id="4072335">big</span><span class="op" id="4072338">.</span><span class="ident" id="4072339">Int</span><span class="op" id="4072342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072345">rem</span>&nbsp;<span class="op" id="4072349">:=</span>&nbsp;<span class="builtinfunc" id="4072352">new</span><span class="op" id="4072355">(</span><span class="ident" id="4072356">big</span><span class="op" id="4072359">.</span><span class="ident" id="4072360">Int</span><span class="op" id="4072363">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072366">one</span>&nbsp;<span class="op" id="4072370">:=</span>&nbsp;<span class="builtinfunc" id="4072373">new</span><span class="op" id="4072376">(</span><span class="ident" id="4072377">big</span><span class="op" id="4072380">.</span><span class="ident" id="4072381">Int</span><span class="op" id="4072384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072387">one</span><span class="op" id="4072390">.</span><span class="ident" id="4072391">SetInt64</span><span class="op" id="4072399">(</span><span class="num" id="4072400">1</span><span class="op" id="4072401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4072404">GeneratePrimes</span><span class="op" id="4072418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072421">for</span>&nbsp;<span class="op" id="4072425">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072429">_</span><span class="op" id="4072430">,</span>&nbsp;<span class="ident" id="4072432">err</span>&nbsp;<span class="op" id="4072436">=</span>&nbsp;<span class="ident" id="4072438">io</span><span class="op" id="4072440">.</span><span class="ident" id="4072441">ReadFull</span><span class="op" id="4072449">(</span><span class="ident" id="4072450">rand</span><span class="op" id="4072454">,</span>&nbsp;<span class="ident" id="4072456">qBytes</span><span class="op" id="4072462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072466">if</span>&nbsp;<span class="ident" id="4072469">err</span>&nbsp;<span class="op" id="4072473">!=</span>&nbsp;<span class="ident" id="4072476">nil</span>&nbsp;<span class="op" id="4072480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072485">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072499">qBytes</span><span class="op" id="4072505">[</span><span class="builtinfunc" id="4072506">len</span><span class="op" id="4072509">(</span><span class="ident" id="4072510">qBytes</span><span class="op" id="4072516">)</span><span class="op" id="4072517">-</span><span class="num" id="4072518">1</span><span class="op" id="4072519">]</span>&nbsp;<span class="op" id="4072521">|=</span>&nbsp;<span class="num" id="4072524">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072528">qBytes</span><span class="op" id="4072534">[</span><span class="num" id="4072535">0</span><span class="op" id="4072536">]</span>&nbsp;<span class="op" id="4072538">|=</span>&nbsp;<span class="num" id="4072541">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072548">q</span><span class="op" id="4072549">.</span><span class="ident" id="4072550">SetBytes</span><span class="op" id="4072558">(</span><span class="ident" id="4072559">qBytes</span><span class="op" id="4072565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072570">if</span>&nbsp;<span class="op" id="4072573">!</span><span class="ident" id="4072574">q</span><span class="op" id="4072575">.</span><span class="ident" id="4072576">ProbablyPrime</span><span class="op" id="4072589">(</span><span class="ident" id="4072590">numMRTests</span><span class="op" id="4072600">)</span>&nbsp;<span class="op" id="4072602">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072607">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072623">for</span>&nbsp;<span class="ident" id="4072627">i</span>&nbsp;<span class="op" id="4072629">:=</span>&nbsp;<span class="num" id="4072632">0</span><span class="op" id="4072633">;</span>&nbsp;<span class="ident" id="4072635">i</span>&nbsp;<span class="op" id="4072637">&lt;</span>&nbsp;<span class="num" id="4072639">4</span><span class="op" id="4072640">*</span><span class="ident" id="4072641">L</span><span class="op" id="4072642">;</span>&nbsp;<span class="ident" id="4072644">i</span><span class="op" id="4072645">++</span>&nbsp;<span class="op" id="4072648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072653">_</span><span class="op" id="4072654">,</span>&nbsp;<span class="ident" id="4072656">err</span>&nbsp;<span class="op" id="4072660">=</span>&nbsp;<span class="ident" id="4072662">io</span><span class="op" id="4072664">.</span><span class="ident" id="4072665">ReadFull</span><span class="op" id="4072673">(</span><span class="ident" id="4072674">rand</span><span class="op" id="4072678">,</span>&nbsp;<span class="ident" id="4072680">pBytes</span><span class="op" id="4072686">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072691">if</span>&nbsp;<span class="ident" id="4072694">err</span>&nbsp;<span class="op" id="4072698">!=</span>&nbsp;<span class="ident" id="4072701">nil</span>&nbsp;<span class="op" id="4072705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072711">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072727">pBytes</span><span class="op" id="4072733">[</span><span class="builtinfunc" id="4072734">len</span><span class="op" id="4072737">(</span><span class="ident" id="4072738">pBytes</span><span class="op" id="4072744">)</span><span class="op" id="4072745">-</span><span class="num" id="4072746">1</span><span class="op" id="4072747">]</span>&nbsp;<span class="op" id="4072749">|=</span>&nbsp;<span class="num" id="4072752">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072757">pBytes</span><span class="op" id="4072763">[</span><span class="num" id="4072764">0</span><span class="op" id="4072765">]</span>&nbsp;<span class="op" id="4072767">|=</span>&nbsp;<span class="num" id="4072770">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072779">p</span><span class="op" id="4072780">.</span><span class="ident" id="4072781">SetBytes</span><span class="op" id="4072789">(</span><span class="ident" id="4072790">pBytes</span><span class="op" id="4072796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072801">rem</span><span class="op" id="4072804">.</span><span class="ident" id="4072805">Mod</span><span class="op" id="4072808">(</span><span class="ident" id="4072809">p</span><span class="op" id="4072810">,</span>&nbsp;<span class="ident" id="4072812">q</span><span class="op" id="4072813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072818">rem</span><span class="op" id="4072821">.</span><span class="ident" id="4072822">Sub</span><span class="op" id="4072825">(</span><span class="ident" id="4072826">rem</span><span class="op" id="4072829">,</span>&nbsp;<span class="ident" id="4072831">one</span><span class="op" id="4072834">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072839">p</span><span class="op" id="4072840">.</span><span class="ident" id="4072841">Sub</span><span class="op" id="4072844">(</span><span class="ident" id="4072845">p</span><span class="op" id="4072846">,</span>&nbsp;<span class="ident" id="4072848">rem</span><span class="op" id="4072851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072856">if</span>&nbsp;<span class="ident" id="4072859">p</span><span class="op" id="4072860">.</span><span class="ident" id="4072861">BitLen</span><span class="op" id="4072867">(</span><span class="op" id="4072868">)</span>&nbsp;<span class="op" id="4072870">&lt;</span>&nbsp;<span class="ident" id="4072872">L</span>&nbsp;<span class="op" id="4072874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072880">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072898">if</span>&nbsp;<span class="op" id="4072901">!</span><span class="ident" id="4072902">p</span><span class="op" id="4072903">.</span><span class="ident" id="4072904">ProbablyPrime</span><span class="op" id="4072917">(</span><span class="ident" id="4072918">numMRTests</span><span class="op" id="4072928">)</span>&nbsp;<span class="op" id="4072930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072936">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072954">params</span><span class="op" id="4072960">.</span><span class="ident" id="4072961">P</span>&nbsp;<span class="op" id="4072963">=</span>&nbsp;<span class="ident" id="4072965">p</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072970">params</span><span class="op" id="4072976">.</span><span class="ident" id="4072977">Q</span>&nbsp;<span class="op" id="4072979">=</span>&nbsp;<span class="ident" id="4072981">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072986">break</span>&nbsp;<span class="ident" id="4072992">GeneratePrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073016">h</span>&nbsp;<span class="op" id="4073018">:=</span>&nbsp;<span class="builtinfunc" id="4073021">new</span><span class="op" id="4073024">(</span><span class="ident" id="4073025">big</span><span class="op" id="4073028">.</span><span class="ident" id="4073029">Int</span><span class="op" id="4073032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073035">h</span><span class="op" id="4073036">.</span><span class="ident" id="4073037">SetInt64</span><span class="op" id="4073045">(</span><span class="num" id="4073046">2</span><span class="op" id="4073047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073050">g</span>&nbsp;<span class="op" id="4073052">:=</span>&nbsp;<span class="builtinfunc" id="4073055">new</span><span class="op" id="4073058">(</span><span class="ident" id="4073059">big</span><span class="op" id="4073062">.</span><span class="ident" id="4073063">Int</span><span class="op" id="4073066">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073070">pm1</span>&nbsp;<span class="op" id="4073074">:=</span>&nbsp;<span class="builtinfunc" id="4073077">new</span><span class="op" id="4073080">(</span><span class="ident" id="4073081">big</span><span class="op" id="4073084">.</span><span class="ident" id="4073085">Int</span><span class="op" id="4073088">)</span><span class="op" id="4073089">.</span><span class="ident" id="4073090">Sub</span><span class="op" id="4073093">(</span><span class="ident" id="4073094">p</span><span class="op" id="4073095">,</span>&nbsp;<span class="ident" id="4073097">one</span><span class="op" id="4073100">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073103">e</span>&nbsp;<span class="op" id="4073105">:=</span>&nbsp;<span class="builtinfunc" id="4073108">new</span><span class="op" id="4073111">(</span><span class="ident" id="4073112">big</span><span class="op" id="4073115">.</span><span class="ident" id="4073116">Int</span><span class="op" id="4073119">)</span><span class="op" id="4073120">.</span><span class="ident" id="4073121">Div</span><span class="op" id="4073124">(</span><span class="ident" id="4073125">pm1</span><span class="op" id="4073128">,</span>&nbsp;<span class="ident" id="4073130">q</span><span class="op" id="4073131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073135">for</span>&nbsp;<span class="op" id="4073139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073143">g</span><span class="op" id="4073144">.</span><span class="ident" id="4073145">Exp</span><span class="op" id="4073148">(</span><span class="ident" id="4073149">h</span><span class="op" id="4073150">,</span>&nbsp;<span class="ident" id="4073152">e</span><span class="op" id="4073153">,</span>&nbsp;<span class="ident" id="4073155">p</span><span class="op" id="4073156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073160">if</span>&nbsp;<span class="ident" id="4073163">g</span><span class="op" id="4073164">.</span><span class="ident" id="4073165">Cmp</span><span class="op" id="4073168">(</span><span class="ident" id="4073169">one</span><span class="op" id="4073172">)</span>&nbsp;<span class="op" id="4073174">==</span>&nbsp;<span class="num" id="4073177">0</span>&nbsp;<span class="op" id="4073179">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073184">h</span><span class="op" id="4073185">.</span><span class="ident" id="4073186">Add</span><span class="op" id="4073189">(</span><span class="ident" id="4073190">h</span><span class="op" id="4073191">,</span>&nbsp;<span class="ident" id="4073193">one</span><span class="op" id="4073196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073201">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073217">params</span><span class="op" id="4073223">.</span><span class="ident" id="4073224">G</span>&nbsp;<span class="op" id="4073226">=</span>&nbsp;<span class="ident" id="4073228">g</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073232">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073240">}</span><br>
<span class="lineno"></span><span class="op" id="4073242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4073245">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&amp;private&nbsp;key&nbsp;pair.&nbsp;The&nbsp;Parameters&nbsp;of&nbsp;the</span><br>
<span class="lineno">150</span><span class="comment" id="4073319">//&nbsp;PrivateKey&nbsp;must&nbsp;already&nbsp;be&nbsp;valid&nbsp;(see&nbsp;GenerateParameters).</span><br>
<span class="lineno"></span><span class="keyword" id="4073381">func</span>&nbsp;<span class="ident" id="4073386">GenerateKey</span><span class="op" id="4073397">(</span><span class="ident" id="4073398">priv</span>&nbsp;<span class="op" id="4073403">*</span><span class="ident" id="4073404">PrivateKey</span><span class="op" id="4073414">,</span>&nbsp;<span class="ident" id="4073416">rand</span>&nbsp;<span class="ident" id="4073421">io</span><span class="op" id="4073423">.</span><span class="ident" id="4073424">Reader</span><span class="op" id="4073430">)</span>&nbsp;<span class="builtintype" id="4073432">error</span>&nbsp;<span class="op" id="4073438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073441">if</span>&nbsp;<span class="ident" id="4073444">priv</span><span class="op" id="4073448">.</span><span class="ident" id="4073449">P</span>&nbsp;<span class="op" id="4073451">==</span>&nbsp;<span class="ident" id="4073454">nil</span>&nbsp;<span class="op" id="4073458">||</span>&nbsp;<span class="ident" id="4073461">priv</span><span class="op" id="4073465">.</span><span class="ident" id="4073466">Q</span>&nbsp;<span class="op" id="4073468">==</span>&nbsp;<span class="ident" id="4073471">nil</span>&nbsp;<span class="op" id="4073475">||</span>&nbsp;<span class="ident" id="4073478">priv</span><span class="op" id="4073482">.</span><span class="ident" id="4073483">G</span>&nbsp;<span class="op" id="4073485">==</span>&nbsp;<span class="ident" id="4073488">nil</span>&nbsp;<span class="op" id="4073492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073496">return</span>&nbsp;<span class="ident" id="4073503">errors</span><span class="op" id="4073509">.</span><span class="ident" id="4073510">New</span><span class="op" id="4073513">(</span><span class="string" id="4073514">&#34;crypto/dsa:&nbsp;parameters&nbsp;not&nbsp;set&nbsp;up&nbsp;before&nbsp;generating&nbsp;key&#34;</span><span class="op" id="4073571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073574">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073578">x</span>&nbsp;<span class="op" id="4073580">:=</span>&nbsp;<span class="builtinfunc" id="4073583">new</span><span class="op" id="4073586">(</span><span class="ident" id="4073587">big</span><span class="op" id="4073590">.</span><span class="ident" id="4073591">Int</span><span class="op" id="4073594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073597">xBytes</span>&nbsp;<span class="op" id="4073604">:=</span>&nbsp;<span class="builtinfunc" id="4073607">make</span><span class="op" id="4073611">(</span><span class="op" id="4073612">[</span><span class="op" id="4073613">]</span><span class="builtintype" id="4073614">byte</span><span class="op" id="4073618">,</span>&nbsp;<span class="ident" id="4073620">priv</span><span class="op" id="4073624">.</span><span class="ident" id="4073625">Q</span><span class="op" id="4073626">.</span><span class="ident" id="4073627">BitLen</span><span class="op" id="4073633">(</span><span class="op" id="4073634">)</span><span class="op" id="4073635">/</span><span class="num" id="4073636">8</span><span class="op" id="4073637">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073641">for</span>&nbsp;<span class="op" id="4073645">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073649">_</span><span class="op" id="4073650">,</span>&nbsp;<span class="ident" id="4073652">err</span>&nbsp;<span class="op" id="4073656">:=</span>&nbsp;<span class="ident" id="4073659">io</span><span class="op" id="4073661">.</span><span class="ident" id="4073662">ReadFull</span><span class="op" id="4073670">(</span><span class="ident" id="4073671">rand</span><span class="op" id="4073675">,</span>&nbsp;<span class="ident" id="4073677">xBytes</span><span class="op" id="4073683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073687">if</span>&nbsp;<span class="ident" id="4073690">err</span>&nbsp;<span class="op" id="4073694">!=</span>&nbsp;<span class="ident" id="4073697">nil</span>&nbsp;<span class="op" id="4073701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073706">return</span>&nbsp;<span class="ident" id="4073713">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073723">x</span><span class="op" id="4073724">.</span><span class="ident" id="4073725">SetBytes</span><span class="op" id="4073733">(</span><span class="ident" id="4073734">xBytes</span><span class="op" id="4073740">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073744">if</span>&nbsp;<span class="ident" id="4073747">x</span><span class="op" id="4073748">.</span><span class="ident" id="4073749">Sign</span><span class="op" id="4073753">(</span><span class="op" id="4073754">)</span>&nbsp;<span class="op" id="4073756">!=</span>&nbsp;<span class="num" id="4073759">0</span>&nbsp;<span class="op" id="4073761">&amp;&amp;</span>&nbsp;<span class="ident" id="4073764">x</span><span class="op" id="4073765">.</span><span class="ident" id="4073766">Cmp</span><span class="op" id="4073769">(</span><span class="ident" id="4073770">priv</span><span class="op" id="4073774">.</span><span class="ident" id="4073775">Q</span><span class="op" id="4073776">)</span>&nbsp;<span class="op" id="4073778">&lt;</span>&nbsp;<span class="num" id="4073780">0</span>&nbsp;<span class="op" id="4073782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073787">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073802">priv</span><span class="op" id="4073806">.</span><span class="ident" id="4073807">X</span>&nbsp;<span class="op" id="4073809">=</span>&nbsp;<span class="ident" id="4073811">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073814">priv</span><span class="op" id="4073818">.</span><span class="ident" id="4073819">Y</span>&nbsp;<span class="op" id="4073821">=</span>&nbsp;<span class="builtinfunc" id="4073823">new</span><span class="op" id="4073826">(</span><span class="ident" id="4073827">big</span><span class="op" id="4073830">.</span><span class="ident" id="4073831">Int</span><span class="op" id="4073834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073837">priv</span><span class="op" id="4073841">.</span><span class="ident" id="4073842">Y</span><span class="op" id="4073843">.</span><span class="ident" id="4073844">Exp</span><span class="op" id="4073847">(</span><span class="ident" id="4073848">priv</span><span class="op" id="4073852">.</span><span class="ident" id="4073853">G</span><span class="op" id="4073854">,</span>&nbsp;<span class="ident" id="4073856">x</span><span class="op" id="4073857">,</span>&nbsp;<span class="ident" id="4073859">priv</span><span class="op" id="4073863">.</span><span class="ident" id="4073864">P</span><span class="op" id="4073865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073868">return</span>&nbsp;<span class="ident" id="4073875">nil</span><br>
<span class="lineno"></span><span class="op" id="4073879">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4073882">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4073959">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4074037">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4074108">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">180</span><span class="keyword" id="4074146">func</span>&nbsp;<span class="ident" id="4074151">fermatInverse</span><span class="op" id="4074164">(</span><span class="ident" id="4074165">k</span><span class="op" id="4074166">,</span>&nbsp;<span class="ident" id="4074168">P</span>&nbsp;<span class="op" id="4074170">*</span><span class="ident" id="4074171">big</span><span class="op" id="4074174">.</span><span class="ident" id="4074175">Int</span><span class="op" id="4074178">)</span>&nbsp;<span class="op" id="4074180">*</span><span class="ident" id="4074181">big</span><span class="op" id="4074184">.</span><span class="ident" id="4074185">Int</span>&nbsp;<span class="op" id="4074189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074192">two</span>&nbsp;<span class="op" id="4074196">:=</span>&nbsp;<span class="ident" id="4074199">big</span><span class="op" id="4074202">.</span><span class="ident" id="4074203">NewInt</span><span class="op" id="4074209">(</span><span class="num" id="4074210">2</span><span class="op" id="4074211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074214">pMinus2</span>&nbsp;<span class="op" id="4074222">:=</span>&nbsp;<span class="builtinfunc" id="4074225">new</span><span class="op" id="4074228">(</span><span class="ident" id="4074229">big</span><span class="op" id="4074232">.</span><span class="ident" id="4074233">Int</span><span class="op" id="4074236">)</span><span class="op" id="4074237">.</span><span class="ident" id="4074238">Sub</span><span class="op" id="4074241">(</span><span class="ident" id="4074242">P</span><span class="op" id="4074243">,</span>&nbsp;<span class="ident" id="4074245">two</span><span class="op" id="4074248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074251">return</span>&nbsp;<span class="builtinfunc" id="4074258">new</span><span class="op" id="4074261">(</span><span class="ident" id="4074262">big</span><span class="op" id="4074265">.</span><span class="ident" id="4074266">Int</span><span class="op" id="4074269">)</span><span class="op" id="4074270">.</span><span class="ident" id="4074271">Exp</span><span class="op" id="4074274">(</span><span class="ident" id="4074275">k</span><span class="op" id="4074276">,</span>&nbsp;<span class="ident" id="4074278">pMinus2</span><span class="op" id="4074285">,</span>&nbsp;<span class="ident" id="4074287">P</span><span class="op" id="4074288">)</span><br>
<span class="lineno"></span><span class="op" id="4074290">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4074293">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4074373">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4074451">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4074530">//&nbsp;rand.</span><br>
<span class="lineno">190</span><span class="comment" id="4074539">//</span><br>
<span class="lineno"></span><span class="comment" id="4074542">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4074622">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4074697">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4074719">func</span>&nbsp;<span class="ident" id="4074724">Sign</span><span class="op" id="4074728">(</span><span class="ident" id="4074729">rand</span>&nbsp;<span class="ident" id="4074734">io</span><span class="op" id="4074736">.</span><span class="ident" id="4074737">Reader</span><span class="op" id="4074743">,</span>&nbsp;<span class="ident" id="4074745">priv</span>&nbsp;<span class="op" id="4074750">*</span><span class="ident" id="4074751">PrivateKey</span><span class="op" id="4074761">,</span>&nbsp;<span class="ident" id="4074763">hash</span>&nbsp;<span class="op" id="4074768">[</span><span class="op" id="4074769">]</span><span class="builtintype" id="4074770">byte</span><span class="op" id="4074774">)</span>&nbsp;<span class="op" id="4074776">(</span><span class="ident" id="4074777">r</span><span class="op" id="4074778">,</span>&nbsp;<span class="ident" id="4074780">s</span>&nbsp;<span class="op" id="4074782">*</span><span class="ident" id="4074783">big</span><span class="op" id="4074786">.</span><span class="ident" id="4074787">Int</span><span class="op" id="4074790">,</span>&nbsp;<span class="ident" id="4074792">err</span>&nbsp;<span class="builtintype" id="4074796">error</span><span class="op" id="4074801">)</span>&nbsp;<span class="op" id="4074803">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074806">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074835">n</span>&nbsp;<span class="op" id="4074837">:=</span>&nbsp;<span class="ident" id="4074840">priv</span><span class="op" id="4074844">.</span><span class="ident" id="4074845">Q</span><span class="op" id="4074846">.</span><span class="ident" id="4074847">BitLen</span><span class="op" id="4074853">(</span><span class="op" id="4074854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074857">if</span>&nbsp;<span class="ident" id="4074860">n</span><span class="op" id="4074861">&amp;</span><span class="num" id="4074862">7</span>&nbsp;<span class="op" id="4074864">!=</span>&nbsp;<span class="num" id="4074867">0</span>&nbsp;<span class="op" id="4074869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074873">err</span>&nbsp;<span class="op" id="4074877">=</span>&nbsp;<span class="ident" id="4074879">ErrInvalidPublicKey</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074901">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074912">n</span>&nbsp;<span class="op" id="4074914">&gt;&gt;=</span>&nbsp;<span class="num" id="4074918">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074922">for</span>&nbsp;<span class="op" id="4074926">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074930">k</span>&nbsp;<span class="op" id="4074932">:=</span>&nbsp;<span class="builtinfunc" id="4074935">new</span><span class="op" id="4074938">(</span><span class="ident" id="4074939">big</span><span class="op" id="4074942">.</span><span class="ident" id="4074943">Int</span><span class="op" id="4074946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074950">buf</span>&nbsp;<span class="op" id="4074954">:=</span>&nbsp;<span class="builtinfunc" id="4074957">make</span><span class="op" id="4074961">(</span><span class="op" id="4074962">[</span><span class="op" id="4074963">]</span><span class="builtintype" id="4074964">byte</span><span class="op" id="4074968">,</span>&nbsp;<span class="ident" id="4074970">n</span><span class="op" id="4074971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074975">for</span>&nbsp;<span class="op" id="4074979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074984">_</span><span class="op" id="4074985">,</span>&nbsp;<span class="ident" id="4074987">err</span>&nbsp;<span class="op" id="4074991">=</span>&nbsp;<span class="ident" id="4074993">io</span><span class="op" id="4074995">.</span><span class="ident" id="4074996">ReadFull</span><span class="op" id="4075004">(</span><span class="ident" id="4075005">rand</span><span class="op" id="4075009">,</span>&nbsp;<span class="ident" id="4075011">buf</span><span class="op" id="4075014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075019">if</span>&nbsp;<span class="ident" id="4075022">err</span>&nbsp;<span class="op" id="4075026">!=</span>&nbsp;<span class="ident" id="4075029">nil</span>&nbsp;<span class="op" id="4075033">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075039">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075054">k</span><span class="op" id="4075055">.</span><span class="ident" id="4075056">SetBytes</span><span class="op" id="4075064">(</span><span class="ident" id="4075065">buf</span><span class="op" id="4075068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075073">if</span>&nbsp;<span class="ident" id="4075076">k</span><span class="op" id="4075077">.</span><span class="ident" id="4075078">Sign</span><span class="op" id="4075082">(</span><span class="op" id="4075083">)</span>&nbsp;<span class="op" id="4075085">&gt;</span>&nbsp;<span class="num" id="4075087">0</span>&nbsp;<span class="op" id="4075089">&amp;&amp;</span>&nbsp;<span class="ident" id="4075092">k</span><span class="op" id="4075093">.</span><span class="ident" id="4075094">Cmp</span><span class="op" id="4075097">(</span><span class="ident" id="4075098">priv</span><span class="op" id="4075102">.</span><span class="ident" id="4075103">Q</span><span class="op" id="4075104">)</span>&nbsp;<span class="op" id="4075106">&lt;</span>&nbsp;<span class="num" id="4075108">0</span>&nbsp;<span class="op" id="4075110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075116">break</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075134">kInv</span>&nbsp;<span class="op" id="4075139">:=</span>&nbsp;<span class="ident" id="4075142">fermatInverse</span><span class="op" id="4075155">(</span><span class="ident" id="4075156">k</span><span class="op" id="4075157">,</span>&nbsp;<span class="ident" id="4075159">priv</span><span class="op" id="4075163">.</span><span class="ident" id="4075164">Q</span><span class="op" id="4075165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075170">r</span>&nbsp;<span class="op" id="4075172">=</span>&nbsp;<span class="builtinfunc" id="4075174">new</span><span class="op" id="4075177">(</span><span class="ident" id="4075178">big</span><span class="op" id="4075181">.</span><span class="ident" id="4075182">Int</span><span class="op" id="4075185">)</span><span class="op" id="4075186">.</span><span class="ident" id="4075187">Exp</span><span class="op" id="4075190">(</span><span class="ident" id="4075191">priv</span><span class="op" id="4075195">.</span><span class="ident" id="4075196">G</span><span class="op" id="4075197">,</span>&nbsp;<span class="ident" id="4075199">k</span><span class="op" id="4075200">,</span>&nbsp;<span class="ident" id="4075202">priv</span><span class="op" id="4075206">.</span><span class="ident" id="4075207">P</span><span class="op" id="4075208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075212">r</span><span class="op" id="4075213">.</span><span class="ident" id="4075214">Mod</span><span class="op" id="4075217">(</span><span class="ident" id="4075218">r</span><span class="op" id="4075219">,</span>&nbsp;<span class="ident" id="4075221">priv</span><span class="op" id="4075225">.</span><span class="ident" id="4075226">Q</span><span class="op" id="4075227">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075232">if</span>&nbsp;<span class="ident" id="4075235">r</span><span class="op" id="4075236">.</span><span class="ident" id="4075237">Sign</span><span class="op" id="4075241">(</span><span class="op" id="4075242">)</span>&nbsp;<span class="op" id="4075244">==</span>&nbsp;<span class="num" id="4075247">0</span>&nbsp;<span class="op" id="4075249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075254">continue</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075270">z</span>&nbsp;<span class="op" id="4075272">:=</span>&nbsp;<span class="ident" id="4075275">k</span><span class="op" id="4075276">.</span><span class="ident" id="4075277">SetBytes</span><span class="op" id="4075285">(</span><span class="ident" id="4075286">hash</span><span class="op" id="4075290">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075295">s</span>&nbsp;<span class="op" id="4075297">=</span>&nbsp;<span class="builtinfunc" id="4075299">new</span><span class="op" id="4075302">(</span><span class="ident" id="4075303">big</span><span class="op" id="4075306">.</span><span class="ident" id="4075307">Int</span><span class="op" id="4075310">)</span><span class="op" id="4075311">.</span><span class="ident" id="4075312">Mul</span><span class="op" id="4075315">(</span><span class="ident" id="4075316">priv</span><span class="op" id="4075320">.</span><span class="ident" id="4075321">X</span><span class="op" id="4075322">,</span>&nbsp;<span class="ident" id="4075324">r</span><span class="op" id="4075325">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075329">s</span><span class="op" id="4075330">.</span><span class="ident" id="4075331">Add</span><span class="op" id="4075334">(</span><span class="ident" id="4075335">s</span><span class="op" id="4075336">,</span>&nbsp;<span class="ident" id="4075338">z</span><span class="op" id="4075339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075343">s</span><span class="op" id="4075344">.</span><span class="ident" id="4075345">Mod</span><span class="op" id="4075348">(</span><span class="ident" id="4075349">s</span><span class="op" id="4075350">,</span>&nbsp;<span class="ident" id="4075352">priv</span><span class="op" id="4075356">.</span><span class="ident" id="4075357">Q</span><span class="op" id="4075358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075362">s</span><span class="op" id="4075363">.</span><span class="ident" id="4075364">Mul</span><span class="op" id="4075367">(</span><span class="ident" id="4075368">s</span><span class="op" id="4075369">,</span>&nbsp;<span class="ident" id="4075371">kInv</span><span class="op" id="4075375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075379">s</span><span class="op" id="4075380">.</span><span class="ident" id="4075381">Mod</span><span class="op" id="4075384">(</span><span class="ident" id="4075385">s</span><span class="op" id="4075386">,</span>&nbsp;<span class="ident" id="4075388">priv</span><span class="op" id="4075392">.</span><span class="ident" id="4075393">Q</span><span class="op" id="4075394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075399">if</span>&nbsp;<span class="ident" id="4075402">s</span><span class="op" id="4075403">.</span><span class="ident" id="4075404">Sign</span><span class="op" id="4075408">(</span><span class="op" id="4075409">)</span>&nbsp;<span class="op" id="4075411">!=</span>&nbsp;<span class="num" id="4075414">0</span>&nbsp;<span class="op" id="4075416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075421">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075436">return</span><br>
<span class="lineno"></span><span class="op" id="4075443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4075446">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4075525">//&nbsp;reports&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno">245</span><span class="comment" id="4075568">//</span><br>
<span class="lineno"></span><span class="comment" id="4075571">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4075651">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4075726">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4075748">func</span>&nbsp;<span class="ident" id="4075753">Verify</span><span class="op" id="4075759">(</span><span class="ident" id="4075760">pub</span>&nbsp;<span class="op" id="4075764">*</span><span class="ident" id="4075765">PublicKey</span><span class="op" id="4075774">,</span>&nbsp;<span class="ident" id="4075776">hash</span>&nbsp;<span class="op" id="4075781">[</span><span class="op" id="4075782">]</span><span class="builtintype" id="4075783">byte</span><span class="op" id="4075787">,</span>&nbsp;<span class="ident" id="4075789">r</span><span class="op" id="4075790">,</span>&nbsp;<span class="ident" id="4075792">s</span>&nbsp;<span class="op" id="4075794">*</span><span class="ident" id="4075795">big</span><span class="op" id="4075798">.</span><span class="ident" id="4075799">Int</span><span class="op" id="4075802">)</span>&nbsp;<span class="builtintype" id="4075804">bool</span>&nbsp;<span class="op" id="4075809">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075812">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075841">if</span>&nbsp;<span class="ident" id="4075844">r</span><span class="op" id="4075845">.</span><span class="ident" id="4075846">Sign</span><span class="op" id="4075850">(</span><span class="op" id="4075851">)</span>&nbsp;<span class="op" id="4075853">&lt;</span>&nbsp;<span class="num" id="4075855">1</span>&nbsp;<span class="op" id="4075857">||</span>&nbsp;<span class="ident" id="4075860">r</span><span class="op" id="4075861">.</span><span class="ident" id="4075862">Cmp</span><span class="op" id="4075865">(</span><span class="ident" id="4075866">pub</span><span class="op" id="4075869">.</span><span class="ident" id="4075870">Q</span><span class="op" id="4075871">)</span>&nbsp;<span class="op" id="4075873">&gt;=</span>&nbsp;<span class="num" id="4075876">0</span>&nbsp;<span class="op" id="4075878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075882">return</span>&nbsp;<span class="builtintype" id="4075889">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075896">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075899">if</span>&nbsp;<span class="ident" id="4075902">s</span><span class="op" id="4075903">.</span><span class="ident" id="4075904">Sign</span><span class="op" id="4075908">(</span><span class="op" id="4075909">)</span>&nbsp;<span class="op" id="4075911">&lt;</span>&nbsp;<span class="num" id="4075913">1</span>&nbsp;<span class="op" id="4075915">||</span>&nbsp;<span class="ident" id="4075918">s</span><span class="op" id="4075919">.</span><span class="ident" id="4075920">Cmp</span><span class="op" id="4075923">(</span><span class="ident" id="4075924">pub</span><span class="op" id="4075927">.</span><span class="ident" id="4075928">Q</span><span class="op" id="4075929">)</span>&nbsp;<span class="op" id="4075931">&gt;=</span>&nbsp;<span class="num" id="4075934">0</span>&nbsp;<span class="op" id="4075936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075940">return</span>&nbsp;<span class="builtintype" id="4075947">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075958">w</span>&nbsp;<span class="op" id="4075960">:=</span>&nbsp;<span class="builtinfunc" id="4075963">new</span><span class="op" id="4075966">(</span><span class="ident" id="4075967">big</span><span class="op" id="4075970">.</span><span class="ident" id="4075971">Int</span><span class="op" id="4075974">)</span><span class="op" id="4075975">.</span><span class="ident" id="4075976">ModInverse</span><span class="op" id="4075986">(</span><span class="ident" id="4075987">s</span><span class="op" id="4075988">,</span>&nbsp;<span class="ident" id="4075990">pub</span><span class="op" id="4075993">.</span><span class="ident" id="4075994">Q</span><span class="op" id="4075995">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075999">n</span>&nbsp;<span class="op" id="4076001">:=</span>&nbsp;<span class="ident" id="4076004">pub</span><span class="op" id="4076007">.</span><span class="ident" id="4076008">Q</span><span class="op" id="4076009">.</span><span class="ident" id="4076010">BitLen</span><span class="op" id="4076016">(</span><span class="op" id="4076017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076020">if</span>&nbsp;<span class="ident" id="4076023">n</span><span class="op" id="4076024">&amp;</span><span class="num" id="4076025">7</span>&nbsp;<span class="op" id="4076027">!=</span>&nbsp;<span class="num" id="4076030">0</span>&nbsp;<span class="op" id="4076032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076036">return</span>&nbsp;<span class="builtintype" id="4076043">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076050">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076053">z</span>&nbsp;<span class="op" id="4076055">:=</span>&nbsp;<span class="builtinfunc" id="4076058">new</span><span class="op" id="4076061">(</span><span class="ident" id="4076062">big</span><span class="op" id="4076065">.</span><span class="ident" id="4076066">Int</span><span class="op" id="4076069">)</span><span class="op" id="4076070">.</span><span class="ident" id="4076071">SetBytes</span><span class="op" id="4076079">(</span><span class="ident" id="4076080">hash</span><span class="op" id="4076084">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076088">u1</span>&nbsp;<span class="op" id="4076091">:=</span>&nbsp;<span class="builtinfunc" id="4076094">new</span><span class="op" id="4076097">(</span><span class="ident" id="4076098">big</span><span class="op" id="4076101">.</span><span class="ident" id="4076102">Int</span><span class="op" id="4076105">)</span><span class="op" id="4076106">.</span><span class="ident" id="4076107">Mul</span><span class="op" id="4076110">(</span><span class="ident" id="4076111">z</span><span class="op" id="4076112">,</span>&nbsp;<span class="ident" id="4076114">w</span><span class="op" id="4076115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076118">u1</span><span class="op" id="4076120">.</span><span class="ident" id="4076121">Mod</span><span class="op" id="4076124">(</span><span class="ident" id="4076125">u1</span><span class="op" id="4076127">,</span>&nbsp;<span class="ident" id="4076129">pub</span><span class="op" id="4076132">.</span><span class="ident" id="4076133">Q</span><span class="op" id="4076134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076137">u2</span>&nbsp;<span class="op" id="4076140">:=</span>&nbsp;<span class="ident" id="4076143">w</span><span class="op" id="4076144">.</span><span class="ident" id="4076145">Mul</span><span class="op" id="4076148">(</span><span class="ident" id="4076149">r</span><span class="op" id="4076150">,</span>&nbsp;<span class="ident" id="4076152">w</span><span class="op" id="4076153">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076156">u2</span><span class="op" id="4076158">.</span><span class="ident" id="4076159">Mod</span><span class="op" id="4076162">(</span><span class="ident" id="4076163">u2</span><span class="op" id="4076165">,</span>&nbsp;<span class="ident" id="4076167">pub</span><span class="op" id="4076170">.</span><span class="ident" id="4076171">Q</span><span class="op" id="4076172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076175">v</span>&nbsp;<span class="op" id="4076177">:=</span>&nbsp;<span class="ident" id="4076180">u1</span><span class="op" id="4076182">.</span><span class="ident" id="4076183">Exp</span><span class="op" id="4076186">(</span><span class="ident" id="4076187">pub</span><span class="op" id="4076190">.</span><span class="ident" id="4076191">G</span><span class="op" id="4076192">,</span>&nbsp;<span class="ident" id="4076194">u1</span><span class="op" id="4076196">,</span>&nbsp;<span class="ident" id="4076198">pub</span><span class="op" id="4076201">.</span><span class="ident" id="4076202">P</span><span class="op" id="4076203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076206">u2</span><span class="op" id="4076208">.</span><span class="ident" id="4076209">Exp</span><span class="op" id="4076212">(</span><span class="ident" id="4076213">pub</span><span class="op" id="4076216">.</span><span class="ident" id="4076217">Y</span><span class="op" id="4076218">,</span>&nbsp;<span class="ident" id="4076220">u2</span><span class="op" id="4076222">,</span>&nbsp;<span class="ident" id="4076224">pub</span><span class="op" id="4076227">.</span><span class="ident" id="4076228">P</span><span class="op" id="4076229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076232">v</span><span class="op" id="4076233">.</span><span class="ident" id="4076234">Mul</span><span class="op" id="4076237">(</span><span class="ident" id="4076238">v</span><span class="op" id="4076239">,</span>&nbsp;<span class="ident" id="4076241">u2</span><span class="op" id="4076243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076246">v</span><span class="op" id="4076247">.</span><span class="ident" id="4076248">Mod</span><span class="op" id="4076251">(</span><span class="ident" id="4076252">v</span><span class="op" id="4076253">,</span>&nbsp;<span class="ident" id="4076255">pub</span><span class="op" id="4076258">.</span><span class="ident" id="4076259">P</span><span class="op" id="4076260">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076263">v</span><span class="op" id="4076264">.</span><span class="ident" id="4076265">Mod</span><span class="op" id="4076268">(</span><span class="ident" id="4076269">v</span><span class="op" id="4076270">,</span>&nbsp;<span class="ident" id="4076272">pub</span><span class="op" id="4076275">.</span><span class="ident" id="4076276">Q</span><span class="op" id="4076277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076281">return</span>&nbsp;<span class="ident" id="4076288">v</span><span class="op" id="4076289">.</span><span class="ident" id="4076290">Cmp</span><span class="op" id="4076293">(</span><span class="ident" id="4076294">r</span><span class="op" id="4076295">)</span>&nbsp;<span class="op" id="4076297">==</span>&nbsp;<span class="num" id="4076300">0</span><br>
<span class="lineno"></span><span class="op" id="4076302">}</span>
</div>
</body>
</html>
