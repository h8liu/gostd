<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="8029067">package</span>&nbsp;<span class="ident" id="8029075">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8029082">import</span>&nbsp;<span class="op" id="8029089">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8029092">&#34;testing&#34;</span><br>
<span class="lineno">5</span><span class="op" id="8029102">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8029105">func</span>&nbsp;<span class="ident" id="8029110">TestPhyMemory</span><span class="op" id="8029123">(</span><span class="ident" id="8029124">t</span>&nbsp;<span class="op" id="8029126">*</span><span class="ident" id="8029127">testing</span><span class="op" id="8029134">.</span><span class="ident" id="8029135">T</span><span class="op" id="8029136">)</span>&nbsp;<span class="op" id="8029138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029141">eo</span>&nbsp;<span class="op" id="8029144">:=</span>&nbsp;<span class="keyword" id="8029147">func</span><span class="op" id="8029151">(</span><span class="ident" id="8029152">cond</span>&nbsp;<span class="builtintype" id="8029157">bool</span><span class="op" id="8029161">,</span>&nbsp;<span class="ident" id="8029163">s</span>&nbsp;<span class="builtintype" id="8029165">string</span><span class="op" id="8029171">,</span>&nbsp;<span class="ident" id="8029173">args</span>&nbsp;<span class="op" id="8029178">...</span><span class="keyword" id="8029181">interface</span><span class="op" id="8029190">{</span><span class="op" id="8029191">}</span><span class="op" id="8029192">)</span>&nbsp;<span class="op" id="8029194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029198">if</span>&nbsp;<span class="ident" id="8029201">cond</span>&nbsp;<span class="op" id="8029206">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029211">t</span><span class="op" id="8029212">.</span><span class="ident" id="8029213">Fatalf</span><span class="op" id="8029219">(</span><span class="ident" id="8029220">s</span><span class="op" id="8029221">,</span>&nbsp;<span class="ident" id="8029223">args</span><span class="op" id="8029227">...</span><span class="op" id="8029230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8029234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8029237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029241">as</span>&nbsp;<span class="op" id="8029244">:=</span>&nbsp;<span class="keyword" id="8029247">func</span><span class="op" id="8029251">(</span><span class="ident" id="8029252">cond</span>&nbsp;<span class="builtintype" id="8029257">bool</span><span class="op" id="8029261">)</span>&nbsp;<span class="op" id="8029263">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029267">if</span>&nbsp;<span class="op" id="8029270">!</span><span class="ident" id="8029271">cond</span>&nbsp;<span class="op" id="8029276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029281">t</span><span class="op" id="8029282">.</span><span class="ident" id="8029283">Fatal</span><span class="op" id="8029288">(</span><span class="string" id="8029289">&#34;assertion&nbsp;failed&#34;</span><span class="op" id="8029307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8029311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8029314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029318">size</span>&nbsp;<span class="op" id="8029323">:=</span>&nbsp;<span class="builtintype" id="8029326">uint32</span><span class="op" id="8029332">(</span><span class="num" id="8029333">20</span>&nbsp;<span class="op" id="8029336">*</span>&nbsp;<span class="ident" id="8029338">PageSize</span><span class="op" id="8029346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029349">m</span>&nbsp;<span class="op" id="8029351">:=</span>&nbsp;<span class="ident" id="8029354">newPhyMemory</span><span class="op" id="8029366">(</span><span class="ident" id="8029367">size</span><span class="op" id="8029371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029374">eo</span><span class="op" id="8029376">(</span><span class="ident" id="8029377">m</span><span class="op" id="8029378">.</span><span class="ident" id="8029379">Size</span><span class="op" id="8029383">(</span><span class="op" id="8029384">)</span>&nbsp;<span class="op" id="8029386">!=</span>&nbsp;<span class="ident" id="8029389">size</span><span class="op" id="8029393">,</span>&nbsp;<span class="string" id="8029395">&#34;size&nbsp;mismatch&#34;</span><span class="op" id="8029410">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029414">w</span><span class="op" id="8029415">,</span>&nbsp;<span class="ident" id="8029417">e</span>&nbsp;<span class="op" id="8029419">:=</span>&nbsp;<span class="ident" id="8029422">m</span><span class="op" id="8029423">.</span><span class="ident" id="8029424">ReadWord</span><span class="op" id="8029432">(</span><span class="num" id="8029433">4</span><span class="op" id="8029434">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029437">eo</span><span class="op" id="8029439">(</span><span class="ident" id="8029440">e</span>&nbsp;<span class="op" id="8029442">!=</span>&nbsp;<span class="ident" id="8029445">nil</span><span class="op" id="8029448">,</span>&nbsp;<span class="string" id="8029450">&#34;get&nbsp;an&nbsp;error&nbsp;for&nbsp;word&nbsp;reading&#34;</span><span class="op" id="8029481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029484">eo</span><span class="op" id="8029486">(</span><span class="ident" id="8029487">w</span>&nbsp;<span class="op" id="8029489">!=</span>&nbsp;<span class="num" id="8029492">0</span><span class="op" id="8029493">,</span>&nbsp;<span class="string" id="8029495">&#34;page&nbsp;is&nbsp;not&nbsp;zeroed&nbsp;out&#34;</span><span class="op" id="8029519">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029523">_</span><span class="op" id="8029524">,</span>&nbsp;<span class="ident" id="8029526">e</span>&nbsp;<span class="op" id="8029528">=</span>&nbsp;<span class="ident" id="8029530">m</span><span class="op" id="8029531">.</span><span class="ident" id="8029532">ReadWord</span><span class="op" id="8029540">(</span><span class="num" id="8029541">13</span><span class="op" id="8029543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029546">eo</span><span class="op" id="8029548">(</span><span class="ident" id="8029549">e</span>&nbsp;<span class="op" id="8029551">!=</span>&nbsp;<span class="ident" id="8029554">errMisalign</span><span class="op" id="8029565">,</span>&nbsp;<span class="string" id="8029567">&#34;should&nbsp;have&nbsp;misalign&nbsp;error&#34;</span><span class="op" id="8029595">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029598">_</span><span class="op" id="8029599">,</span>&nbsp;<span class="ident" id="8029601">e</span>&nbsp;<span class="op" id="8029603">=</span>&nbsp;<span class="ident" id="8029605">m</span><span class="op" id="8029606">.</span><span class="ident" id="8029607">ReadWord</span><span class="op" id="8029615">(</span><span class="ident" id="8029616">size</span>&nbsp;<span class="op" id="8029621">-</span>&nbsp;<span class="num" id="8029623">1</span><span class="op" id="8029624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029627">eo</span><span class="op" id="8029629">(</span><span class="ident" id="8029630">e</span>&nbsp;<span class="op" id="8029632">!=</span>&nbsp;<span class="ident" id="8029635">errMisalign</span><span class="op" id="8029646">,</span>&nbsp;<span class="string" id="8029648">&#34;should&nbsp;have&nbsp;misalign&nbsp;error&#34;</span><span class="op" id="8029676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029680">_</span><span class="op" id="8029681">,</span>&nbsp;<span class="ident" id="8029683">e</span>&nbsp;<span class="op" id="8029685">=</span>&nbsp;<span class="ident" id="8029687">m</span><span class="op" id="8029688">.</span><span class="ident" id="8029689">ReadWord</span><span class="op" id="8029697">(</span><span class="ident" id="8029698">size</span><span class="op" id="8029702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029705">eo</span><span class="op" id="8029707">(</span><span class="ident" id="8029708">e</span>&nbsp;<span class="op" id="8029710">!=</span>&nbsp;<span class="ident" id="8029713">errOutOfRange</span><span class="op" id="8029726">,</span>&nbsp;<span class="string" id="8029728">&#34;should&nbsp;have&nbsp;out&nbsp;of&nbsp;range&nbsp;error&#34;</span><span class="op" id="8029760">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029764">off</span>&nbsp;<span class="op" id="8029768">:=</span>&nbsp;<span class="builtintype" id="8029771">uint32</span><span class="op" id="8029777">(</span><span class="num" id="8029778">56</span>&nbsp;<span class="op" id="8029781">+</span>&nbsp;<span class="ident" id="8029783">PageSize</span><span class="op" id="8029791">*</span><span class="num" id="8029792">2</span><span class="op" id="8029793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029796">as</span><span class="op" id="8029798">(</span><span class="ident" id="8029799">m</span><span class="op" id="8029800">.</span><span class="ident" id="8029801">WriteByte</span><span class="op" id="8029810">(</span><span class="ident" id="8029811">off</span><span class="op" id="8029814">+</span><span class="num" id="8029815">0</span><span class="op" id="8029816">,</span>&nbsp;<span class="num" id="8029818">0x37</span><span class="op" id="8029822">)</span>&nbsp;<span class="op" id="8029824">==</span>&nbsp;<span class="ident" id="8029827">nil</span><span class="op" id="8029830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029833">as</span><span class="op" id="8029835">(</span><span class="ident" id="8029836">m</span><span class="op" id="8029837">.</span><span class="ident" id="8029838">WriteByte</span><span class="op" id="8029847">(</span><span class="ident" id="8029848">off</span><span class="op" id="8029851">+</span><span class="num" id="8029852">1</span><span class="op" id="8029853">,</span>&nbsp;<span class="num" id="8029855">0x21</span><span class="op" id="8029859">)</span>&nbsp;<span class="op" id="8029861">==</span>&nbsp;<span class="ident" id="8029864">nil</span><span class="op" id="8029867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029870">as</span><span class="op" id="8029872">(</span><span class="ident" id="8029873">m</span><span class="op" id="8029874">.</span><span class="ident" id="8029875">WriteByte</span><span class="op" id="8029884">(</span><span class="ident" id="8029885">off</span><span class="op" id="8029888">+</span><span class="num" id="8029889">2</span><span class="op" id="8029890">,</span>&nbsp;<span class="num" id="8029892">0x5a</span><span class="op" id="8029896">)</span>&nbsp;<span class="op" id="8029898">==</span>&nbsp;<span class="ident" id="8029901">nil</span><span class="op" id="8029904">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029907">as</span><span class="op" id="8029909">(</span><span class="ident" id="8029910">m</span><span class="op" id="8029911">.</span><span class="ident" id="8029912">WriteByte</span><span class="op" id="8029921">(</span><span class="ident" id="8029922">off</span><span class="op" id="8029925">+</span><span class="num" id="8029926">3</span><span class="op" id="8029927">,</span>&nbsp;<span class="num" id="8029929">0x70</span><span class="op" id="8029933">)</span>&nbsp;<span class="op" id="8029935">==</span>&nbsp;<span class="ident" id="8029938">nil</span><span class="op" id="8029941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029944">exp</span>&nbsp;<span class="op" id="8029948">:=</span>&nbsp;<span class="builtintype" id="8029951">uint32</span><span class="op" id="8029957">(</span><span class="num" id="8029958">0x705a2137</span><span class="op" id="8029968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029971">w</span><span class="op" id="8029972">,</span>&nbsp;<span class="ident" id="8029974">e</span>&nbsp;<span class="op" id="8029976">=</span>&nbsp;<span class="ident" id="8029978">m</span><span class="op" id="8029979">.</span><span class="ident" id="8029980">ReadWord</span><span class="op" id="8029988">(</span><span class="ident" id="8029989">off</span><span class="op" id="8029992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029995">as</span><span class="op" id="8029997">(</span><span class="ident" id="8029998">e</span>&nbsp;<span class="op" id="8030000">==</span>&nbsp;<span class="ident" id="8030003">nil</span><span class="op" id="8030006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8030009">eo</span><span class="op" id="8030011">(</span><span class="ident" id="8030012">w</span>&nbsp;<span class="op" id="8030014">!=</span>&nbsp;<span class="ident" id="8030017">exp</span><span class="op" id="8030020">,</span>&nbsp;<span class="string" id="8030022">&#34;expect&nbsp;0x%08x&nbsp;got&nbsp;0x%08x&#34;</span><span class="op" id="8030048">,</span>&nbsp;<span class="ident" id="8030050">exp</span><span class="op" id="8030053">,</span>&nbsp;<span class="ident" id="8030055">w</span><span class="op" id="8030056">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8030059">b</span><span class="op" id="8030060">,</span>&nbsp;<span class="ident" id="8030062">e</span>&nbsp;<span class="op" id="8030064">:=</span>&nbsp;<span class="ident" id="8030067">m</span><span class="op" id="8030068">.</span><span class="ident" id="8030069">ReadByte</span><span class="op" id="8030077">(</span><span class="ident" id="8030078">off</span>&nbsp;<span class="op" id="8030082">+</span>&nbsp;<span class="num" id="8030084">2</span><span class="op" id="8030085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8030088">as</span><span class="op" id="8030090">(</span><span class="ident" id="8030091">e</span>&nbsp;<span class="op" id="8030093">==</span>&nbsp;<span class="ident" id="8030096">nil</span><span class="op" id="8030099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8030102">eo</span><span class="op" id="8030104">(</span><span class="ident" id="8030105">b</span>&nbsp;<span class="op" id="8030107">!=</span>&nbsp;<span class="num" id="8030110">0x5a</span><span class="op" id="8030114">,</span>&nbsp;<span class="string" id="8030116">&#34;expect&nbsp;0x5a&nbsp;got&nbsp;%02x&#34;</span><span class="op" id="8030138">,</span>&nbsp;<span class="ident" id="8030140">b</span><span class="op" id="8030141">)</span><br>
<span class="lineno"></span><span class="op" id="8030143">}</span>
</div>
</body>
</html>
