<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html" class="current">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3432271">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3432326">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3432380">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3432431">//&nbsp;This&nbsp;Go&nbsp;implementation&nbsp;is&nbsp;derived&nbsp;in&nbsp;part&nbsp;from&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="3432495">//&nbsp;ANSI&nbsp;C&nbsp;implementation,&nbsp;which&nbsp;carries&nbsp;the&nbsp;following&nbsp;notice:</span><br>
<span class="lineno"></span><span class="comment" id="3432557">//</span><br>
<span class="lineno"></span><span class="comment" id="3432560">//&nbsp;&nbsp;&nbsp;&nbsprijndael-alg-fst.c</span><br>
<span class="lineno"></span><span class="comment" id="3432582">//</span><br>
<span class="lineno">10</span><span class="comment" id="3432585">//&nbsp;&nbsp;&nbsp;&nbsp@version&nbsp;3.0&nbsp;(December&nbsp;2000)</span><br>
<span class="lineno"></span><span class="comment" id="3432617">//</span><br>
<span class="lineno"></span><span class="comment" id="3432620">//&nbsp;&nbsp;&nbsp;&nbspOptimised&nbsp;ANSI&nbsp;C&nbsp;code&nbsp;for&nbsp;the&nbsp;Rijndael&nbsp;cipher&nbsp;(now&nbsp;AES)</span><br>
<span class="lineno"></span><span class="comment" id="3432679">//</span><br>
<span class="lineno"></span><span class="comment" id="3432682">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Vincent&nbsp;Rijmen&nbsp;&lt;vincent.rijmen@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno">15</span><span class="comment" id="3432745">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Antoon&nbsp;Bosselaers&nbsp;&lt;antoon.bosselaers@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3432814">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Paulo&nbsp;Barreto&nbsp;&lt;paulo.barreto@terra.com.br&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3432868">//</span><br>
<span class="lineno"></span><span class="comment" id="3432871">//&nbsp;&nbsp;&nbsp;&nbspThis&nbsp;code&nbsp;is&nbsp;hereby&nbsp;placed&nbsp;in&nbsp;the&nbsp;public&nbsp;domain.</span><br>
<span class="lineno"></span><span class="comment" id="3432923">//</span><br>
<span class="lineno">20</span><span class="comment" id="3432926">//&nbsp;&nbsp;&nbsp;&nbspTHIS&nbsp;SOFTWARE&nbsp;IS&nbsp;PROVIDED&nbsp;BY&nbsp;THE&nbsp;AUTHORS&nbsp;&#39;&#39;AS&nbsp;IS&#39;&#39;&nbsp;AND&nbsp;ANY&nbsp;EXPRESS</span><br>
<span class="lineno"></span><span class="comment" id="3432996">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;IMPLIED&nbsp;WARRANTIES,&nbsp;INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;THE&nbsp;IMPLIED</span><br>
<span class="lineno"></span><span class="comment" id="3433065">//&nbsp;&nbsp;&nbsp;&nbspWARRANTIES&nbsp;OF&nbsp;MERCHANTABILITY&nbsp;AND&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE</span><br>
<span class="lineno"></span><span class="comment" id="3433135">//&nbsp;&nbsp;&nbsp;&nbspARE&nbsp;DISCLAIMED.&nbsp;&nbsp;IN&nbsp;NO&nbsp;EVENT&nbsp;SHALL&nbsp;THE&nbsp;AUTHORS&nbsp;OR&nbsp;CONTRIBUTORS&nbsp;BE</span><br>
<span class="lineno"></span><span class="comment" id="3433204">//&nbsp;&nbsp;&nbsp;&nbspLIABLE&nbsp;FOR&nbsp;ANY&nbsp;DIRECT,&nbsp;INDIRECT,&nbsp;INCIDENTAL,&nbsp;SPECIAL,&nbsp;EXEMPLARY,&nbsp;OR</span><br>
<span class="lineno">25</span><span class="comment" id="3433275">//&nbsp;&nbsp;&nbsp;&nbspCONSEQUENTIAL&nbsp;DAMAGES&nbsp;(INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;PROCUREMENT&nbsp;OF</span><br>
<span class="lineno"></span><span class="comment" id="3433347">//&nbsp;&nbsp;&nbsp;&nbspSUBSTITUTE&nbsp;GOODS&nbsp;OR&nbsp;SERVICES;&nbsp;LOSS&nbsp;OF&nbsp;USE,&nbsp;DATA,&nbsp;OR&nbsp;PROFITS;&nbsp;OR</span><br>
<span class="lineno"></span><span class="comment" id="3433414">//&nbsp;&nbsp;&nbsp;&nbspBUSINESS&nbsp;INTERRUPTION)&nbsp;HOWEVER&nbsp;CAUSED&nbsp;AND&nbsp;ON&nbsp;ANY&nbsp;THEORY&nbsp;OF&nbsp;LIABILITY,</span><br>
<span class="lineno"></span><span class="comment" id="3433487">//&nbsp;&nbsp;&nbsp;&nbspWHETHER&nbsp;IN&nbsp;CONTRACT,&nbsp;STRICT&nbsp;LIABILITY,&nbsp;OR&nbsp;TORT&nbsp;(INCLUDING&nbsp;NEGLIGENCE</span><br>
<span class="lineno"></span><span class="comment" id="3433559">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;OTHERWISE)&nbsp;ARISING&nbsp;IN&nbsp;ANY&nbsp;WAY&nbsp;OUT&nbsp;OF&nbsp;THE&nbsp;USE&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE,</span><br>
<span class="lineno">30</span><span class="comment" id="3433628">//&nbsp;&nbsp;&nbsp;&nbspEVEN&nbsp;IF&nbsp;ADVISED&nbsp;OF&nbsp;THE&nbsp;POSSIBILITY&nbsp;OF&nbsp;SUCH&nbsp;DAMAGE.</span><br>
<span class="lineno"></span><span class="comment" id="3433682">//</span><br>
<span class="lineno"></span><span class="comment" id="3433685">//&nbsp;See&nbsp;FIPS&nbsp;197&nbsp;for&nbsp;specification,&nbsp;and&nbsp;see&nbsp;Daemen&nbsp;and&nbsp;Rijmen&#39;s&nbsp;Rijndael&nbsp;submission</span><br>
<span class="lineno"></span><span class="comment" id="3433768">//&nbsp;for&nbsp;implementation&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3433799">//&nbsp;&nbsp;&nbsp;&nbsphttp://www.csrc.nist.gov/publications/fips/fips197/fips-197.pdf</span><br>
<span class="lineno">35</span><span class="comment" id="3433866">//&nbsp;&nbsp;&nbsp;&nbsphttp://csrc.nist.gov/archive/aes/rijndael/Rijndael-ammended.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3433934">package</span>&nbsp;<span class="ident" id="3433942">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3433947">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">40</span><span class="keyword" id="3434014">func</span>&nbsp;<span class="ident" id="3434019">encryptBlockGo</span><span class="op" id="3434033">(</span><span class="ident" id="3434034">xk</span>&nbsp;<span class="op" id="3434037">[</span><span class="op" id="3434038">]</span><span class="builtintype" id="3434039">uint32</span><span class="op" id="3434045">,</span>&nbsp;<span class="ident" id="3434047">dst</span><span class="op" id="3434050">,</span>&nbsp;<span class="ident" id="3434052">src</span>&nbsp;<span class="op" id="3434056">[</span><span class="op" id="3434057">]</span><span class="builtintype" id="3434058">byte</span><span class="op" id="3434062">)</span>&nbsp;<span class="op" id="3434064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3434067">var</span>&nbsp;<span class="ident" id="3434071">s0</span><span class="op" id="3434073">,</span>&nbsp;<span class="ident" id="3434075">s1</span><span class="op" id="3434077">,</span>&nbsp;<span class="ident" id="3434079">s2</span><span class="op" id="3434081">,</span>&nbsp;<span class="ident" id="3434083">s3</span><span class="op" id="3434085">,</span>&nbsp;<span class="ident" id="3434087">t0</span><span class="op" id="3434089">,</span>&nbsp;<span class="ident" id="3434091">t1</span><span class="op" id="3434093">,</span>&nbsp;<span class="ident" id="3434095">t2</span><span class="op" id="3434097">,</span>&nbsp;<span class="ident" id="3434099">t3</span>&nbsp;<span class="builtintype" id="3434102">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434111">s0</span>&nbsp;<span class="op" id="3434114">=</span>&nbsp;<span class="builtintype" id="3434116">uint32</span><span class="op" id="3434122">(</span><span class="ident" id="3434123">src</span><span class="op" id="3434126">[</span><span class="num" id="3434127">0</span><span class="op" id="3434128">]</span><span class="op" id="3434129">)</span><span class="op" id="3434130">&lt;&lt;</span><span class="num" id="3434132">24</span>&nbsp;<span class="op" id="3434135">|</span>&nbsp;<span class="builtintype" id="3434137">uint32</span><span class="op" id="3434143">(</span><span class="ident" id="3434144">src</span><span class="op" id="3434147">[</span><span class="num" id="3434148">1</span><span class="op" id="3434149">]</span><span class="op" id="3434150">)</span><span class="op" id="3434151">&lt;&lt;</span><span class="num" id="3434153">16</span>&nbsp;<span class="op" id="3434156">|</span>&nbsp;<span class="builtintype" id="3434158">uint32</span><span class="op" id="3434164">(</span><span class="ident" id="3434165">src</span><span class="op" id="3434168">[</span><span class="num" id="3434169">2</span><span class="op" id="3434170">]</span><span class="op" id="3434171">)</span><span class="op" id="3434172">&lt;&lt;</span><span class="num" id="3434174">8</span>&nbsp;<span class="op" id="3434176">|</span>&nbsp;<span class="builtintype" id="3434178">uint32</span><span class="op" id="3434184">(</span><span class="ident" id="3434185">src</span><span class="op" id="3434188">[</span><span class="num" id="3434189">3</span><span class="op" id="3434190">]</span><span class="op" id="3434191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434194">s1</span>&nbsp;<span class="op" id="3434197">=</span>&nbsp;<span class="builtintype" id="3434199">uint32</span><span class="op" id="3434205">(</span><span class="ident" id="3434206">src</span><span class="op" id="3434209">[</span><span class="num" id="3434210">4</span><span class="op" id="3434211">]</span><span class="op" id="3434212">)</span><span class="op" id="3434213">&lt;&lt;</span><span class="num" id="3434215">24</span>&nbsp;<span class="op" id="3434218">|</span>&nbsp;<span class="builtintype" id="3434220">uint32</span><span class="op" id="3434226">(</span><span class="ident" id="3434227">src</span><span class="op" id="3434230">[</span><span class="num" id="3434231">5</span><span class="op" id="3434232">]</span><span class="op" id="3434233">)</span><span class="op" id="3434234">&lt;&lt;</span><span class="num" id="3434236">16</span>&nbsp;<span class="op" id="3434239">|</span>&nbsp;<span class="builtintype" id="3434241">uint32</span><span class="op" id="3434247">(</span><span class="ident" id="3434248">src</span><span class="op" id="3434251">[</span><span class="num" id="3434252">6</span><span class="op" id="3434253">]</span><span class="op" id="3434254">)</span><span class="op" id="3434255">&lt;&lt;</span><span class="num" id="3434257">8</span>&nbsp;<span class="op" id="3434259">|</span>&nbsp;<span class="builtintype" id="3434261">uint32</span><span class="op" id="3434267">(</span><span class="ident" id="3434268">src</span><span class="op" id="3434271">[</span><span class="num" id="3434272">7</span><span class="op" id="3434273">]</span><span class="op" id="3434274">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434277">s2</span>&nbsp;<span class="op" id="3434280">=</span>&nbsp;<span class="builtintype" id="3434282">uint32</span><span class="op" id="3434288">(</span><span class="ident" id="3434289">src</span><span class="op" id="3434292">[</span><span class="num" id="3434293">8</span><span class="op" id="3434294">]</span><span class="op" id="3434295">)</span><span class="op" id="3434296">&lt;&lt;</span><span class="num" id="3434298">24</span>&nbsp;<span class="op" id="3434301">|</span>&nbsp;<span class="builtintype" id="3434303">uint32</span><span class="op" id="3434309">(</span><span class="ident" id="3434310">src</span><span class="op" id="3434313">[</span><span class="num" id="3434314">9</span><span class="op" id="3434315">]</span><span class="op" id="3434316">)</span><span class="op" id="3434317">&lt;&lt;</span><span class="num" id="3434319">16</span>&nbsp;<span class="op" id="3434322">|</span>&nbsp;<span class="builtintype" id="3434324">uint32</span><span class="op" id="3434330">(</span><span class="ident" id="3434331">src</span><span class="op" id="3434334">[</span><span class="num" id="3434335">10</span><span class="op" id="3434337">]</span><span class="op" id="3434338">)</span><span class="op" id="3434339">&lt;&lt;</span><span class="num" id="3434341">8</span>&nbsp;<span class="op" id="3434343">|</span>&nbsp;<span class="builtintype" id="3434345">uint32</span><span class="op" id="3434351">(</span><span class="ident" id="3434352">src</span><span class="op" id="3434355">[</span><span class="num" id="3434356">11</span><span class="op" id="3434358">]</span><span class="op" id="3434359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434362">s3</span>&nbsp;<span class="op" id="3434365">=</span>&nbsp;<span class="builtintype" id="3434367">uint32</span><span class="op" id="3434373">(</span><span class="ident" id="3434374">src</span><span class="op" id="3434377">[</span><span class="num" id="3434378">12</span><span class="op" id="3434380">]</span><span class="op" id="3434381">)</span><span class="op" id="3434382">&lt;&lt;</span><span class="num" id="3434384">24</span>&nbsp;<span class="op" id="3434387">|</span>&nbsp;<span class="builtintype" id="3434389">uint32</span><span class="op" id="3434395">(</span><span class="ident" id="3434396">src</span><span class="op" id="3434399">[</span><span class="num" id="3434400">13</span><span class="op" id="3434402">]</span><span class="op" id="3434403">)</span><span class="op" id="3434404">&lt;&lt;</span><span class="num" id="3434406">16</span>&nbsp;<span class="op" id="3434409">|</span>&nbsp;<span class="builtintype" id="3434411">uint32</span><span class="op" id="3434417">(</span><span class="ident" id="3434418">src</span><span class="op" id="3434421">[</span><span class="num" id="3434422">14</span><span class="op" id="3434424">]</span><span class="op" id="3434425">)</span><span class="op" id="3434426">&lt;&lt;</span><span class="num" id="3434428">8</span>&nbsp;<span class="op" id="3434430">|</span>&nbsp;<span class="builtintype" id="3434432">uint32</span><span class="op" id="3434438">(</span><span class="ident" id="3434439">src</span><span class="op" id="3434442">[</span><span class="num" id="3434443">15</span><span class="op" id="3434445">]</span><span class="op" id="3434446">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3434450">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434492">s0</span>&nbsp;<span class="op" id="3434495">^=</span>&nbsp;<span class="ident" id="3434498">xk</span><span class="op" id="3434500">[</span><span class="num" id="3434501">0</span><span class="op" id="3434502">]</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434505">s1</span>&nbsp;<span class="op" id="3434508">^=</span>&nbsp;<span class="ident" id="3434511">xk</span><span class="op" id="3434513">[</span><span class="num" id="3434514">1</span><span class="op" id="3434515">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434518">s2</span>&nbsp;<span class="op" id="3434521">^=</span>&nbsp;<span class="ident" id="3434524">xk</span><span class="op" id="3434526">[</span><span class="num" id="3434527">2</span><span class="op" id="3434528">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434531">s3</span>&nbsp;<span class="op" id="3434534">^=</span>&nbsp;<span class="ident" id="3434537">xk</span><span class="op" id="3434539">[</span><span class="num" id="3434540">3</span><span class="op" id="3434541">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3434545">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3434585">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434640">nr</span>&nbsp;<span class="op" id="3434643">:=</span>&nbsp;<span class="builtinfunc" id="3434646">len</span><span class="op" id="3434649">(</span><span class="ident" id="3434650">xk</span><span class="op" id="3434652">)</span><span class="op" id="3434653">/</span><span class="num" id="3434654">4</span>&nbsp;<span class="op" id="3434656">-</span>&nbsp;<span class="num" id="3434658">2</span>&nbsp;<span class="comment" id="3434660">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434695">k</span>&nbsp;<span class="op" id="3434697">:=</span>&nbsp;<span class="num" id="3434700">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3434703">for</span>&nbsp;<span class="ident" id="3434707">r</span>&nbsp;<span class="op" id="3434709">:=</span>&nbsp;<span class="num" id="3434712">0</span><span class="op" id="3434713">;</span>&nbsp;<span class="ident" id="3434715">r</span>&nbsp;<span class="op" id="3434717">&lt;</span>&nbsp;<span class="ident" id="3434719">nr</span><span class="op" id="3434721">;</span>&nbsp;<span class="ident" id="3434723">r</span><span class="op" id="3434724">++</span>&nbsp;<span class="op" id="3434727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434731">t0</span>&nbsp;<span class="op" id="3434734">=</span>&nbsp;<span class="ident" id="3434736">xk</span><span class="op" id="3434738">[</span><span class="ident" id="3434739">k</span><span class="op" id="3434740">+</span><span class="num" id="3434741">0</span><span class="op" id="3434742">]</span>&nbsp;<span class="op" id="3434744">^</span>&nbsp;<span class="ident" id="3434746">te0</span><span class="op" id="3434749">[</span><span class="builtintype" id="3434750">uint8</span><span class="op" id="3434755">(</span><span class="ident" id="3434756">s0</span><span class="op" id="3434758">&gt;&gt;</span><span class="num" id="3434760">24</span><span class="op" id="3434762">)</span><span class="op" id="3434763">]</span>&nbsp;<span class="op" id="3434765">^</span>&nbsp;<span class="ident" id="3434767">te1</span><span class="op" id="3434770">[</span><span class="builtintype" id="3434771">uint8</span><span class="op" id="3434776">(</span><span class="ident" id="3434777">s1</span><span class="op" id="3434779">&gt;&gt;</span><span class="num" id="3434781">16</span><span class="op" id="3434783">)</span><span class="op" id="3434784">]</span>&nbsp;<span class="op" id="3434786">^</span>&nbsp;<span class="ident" id="3434788">te2</span><span class="op" id="3434791">[</span><span class="builtintype" id="3434792">uint8</span><span class="op" id="3434797">(</span><span class="ident" id="3434798">s2</span><span class="op" id="3434800">&gt;&gt;</span><span class="num" id="3434802">8</span><span class="op" id="3434803">)</span><span class="op" id="3434804">]</span>&nbsp;<span class="op" id="3434806">^</span>&nbsp;<span class="ident" id="3434808">te3</span><span class="op" id="3434811">[</span><span class="builtintype" id="3434812">uint8</span><span class="op" id="3434817">(</span><span class="ident" id="3434818">s3</span><span class="op" id="3434820">)</span><span class="op" id="3434821">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434825">t1</span>&nbsp;<span class="op" id="3434828">=</span>&nbsp;<span class="ident" id="3434830">xk</span><span class="op" id="3434832">[</span><span class="ident" id="3434833">k</span><span class="op" id="3434834">+</span><span class="num" id="3434835">1</span><span class="op" id="3434836">]</span>&nbsp;<span class="op" id="3434838">^</span>&nbsp;<span class="ident" id="3434840">te0</span><span class="op" id="3434843">[</span><span class="builtintype" id="3434844">uint8</span><span class="op" id="3434849">(</span><span class="ident" id="3434850">s1</span><span class="op" id="3434852">&gt;&gt;</span><span class="num" id="3434854">24</span><span class="op" id="3434856">)</span><span class="op" id="3434857">]</span>&nbsp;<span class="op" id="3434859">^</span>&nbsp;<span class="ident" id="3434861">te1</span><span class="op" id="3434864">[</span><span class="builtintype" id="3434865">uint8</span><span class="op" id="3434870">(</span><span class="ident" id="3434871">s2</span><span class="op" id="3434873">&gt;&gt;</span><span class="num" id="3434875">16</span><span class="op" id="3434877">)</span><span class="op" id="3434878">]</span>&nbsp;<span class="op" id="3434880">^</span>&nbsp;<span class="ident" id="3434882">te2</span><span class="op" id="3434885">[</span><span class="builtintype" id="3434886">uint8</span><span class="op" id="3434891">(</span><span class="ident" id="3434892">s3</span><span class="op" id="3434894">&gt;&gt;</span><span class="num" id="3434896">8</span><span class="op" id="3434897">)</span><span class="op" id="3434898">]</span>&nbsp;<span class="op" id="3434900">^</span>&nbsp;<span class="ident" id="3434902">te3</span><span class="op" id="3434905">[</span><span class="builtintype" id="3434906">uint8</span><span class="op" id="3434911">(</span><span class="ident" id="3434912">s0</span><span class="op" id="3434914">)</span><span class="op" id="3434915">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3434919">t2</span>&nbsp;<span class="op" id="3434922">=</span>&nbsp;<span class="ident" id="3434924">xk</span><span class="op" id="3434926">[</span><span class="ident" id="3434927">k</span><span class="op" id="3434928">+</span><span class="num" id="3434929">2</span><span class="op" id="3434930">]</span>&nbsp;<span class="op" id="3434932">^</span>&nbsp;<span class="ident" id="3434934">te0</span><span class="op" id="3434937">[</span><span class="builtintype" id="3434938">uint8</span><span class="op" id="3434943">(</span><span class="ident" id="3434944">s2</span><span class="op" id="3434946">&gt;&gt;</span><span class="num" id="3434948">24</span><span class="op" id="3434950">)</span><span class="op" id="3434951">]</span>&nbsp;<span class="op" id="3434953">^</span>&nbsp;<span class="ident" id="3434955">te1</span><span class="op" id="3434958">[</span><span class="builtintype" id="3434959">uint8</span><span class="op" id="3434964">(</span><span class="ident" id="3434965">s3</span><span class="op" id="3434967">&gt;&gt;</span><span class="num" id="3434969">16</span><span class="op" id="3434971">)</span><span class="op" id="3434972">]</span>&nbsp;<span class="op" id="3434974">^</span>&nbsp;<span class="ident" id="3434976">te2</span><span class="op" id="3434979">[</span><span class="builtintype" id="3434980">uint8</span><span class="op" id="3434985">(</span><span class="ident" id="3434986">s0</span><span class="op" id="3434988">&gt;&gt;</span><span class="num" id="3434990">8</span><span class="op" id="3434991">)</span><span class="op" id="3434992">]</span>&nbsp;<span class="op" id="3434994">^</span>&nbsp;<span class="ident" id="3434996">te3</span><span class="op" id="3434999">[</span><span class="builtintype" id="3435000">uint8</span><span class="op" id="3435005">(</span><span class="ident" id="3435006">s1</span><span class="op" id="3435008">)</span><span class="op" id="3435009">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435013">t3</span>&nbsp;<span class="op" id="3435016">=</span>&nbsp;<span class="ident" id="3435018">xk</span><span class="op" id="3435020">[</span><span class="ident" id="3435021">k</span><span class="op" id="3435022">+</span><span class="num" id="3435023">3</span><span class="op" id="3435024">]</span>&nbsp;<span class="op" id="3435026">^</span>&nbsp;<span class="ident" id="3435028">te0</span><span class="op" id="3435031">[</span><span class="builtintype" id="3435032">uint8</span><span class="op" id="3435037">(</span><span class="ident" id="3435038">s3</span><span class="op" id="3435040">&gt;&gt;</span><span class="num" id="3435042">24</span><span class="op" id="3435044">)</span><span class="op" id="3435045">]</span>&nbsp;<span class="op" id="3435047">^</span>&nbsp;<span class="ident" id="3435049">te1</span><span class="op" id="3435052">[</span><span class="builtintype" id="3435053">uint8</span><span class="op" id="3435058">(</span><span class="ident" id="3435059">s0</span><span class="op" id="3435061">&gt;&gt;</span><span class="num" id="3435063">16</span><span class="op" id="3435065">)</span><span class="op" id="3435066">]</span>&nbsp;<span class="op" id="3435068">^</span>&nbsp;<span class="ident" id="3435070">te2</span><span class="op" id="3435073">[</span><span class="builtintype" id="3435074">uint8</span><span class="op" id="3435079">(</span><span class="ident" id="3435080">s1</span><span class="op" id="3435082">&gt;&gt;</span><span class="num" id="3435084">8</span><span class="op" id="3435085">)</span><span class="op" id="3435086">]</span>&nbsp;<span class="op" id="3435088">^</span>&nbsp;<span class="ident" id="3435090">te3</span><span class="op" id="3435093">[</span><span class="builtintype" id="3435094">uint8</span><span class="op" id="3435099">(</span><span class="ident" id="3435100">s2</span><span class="op" id="3435102">)</span><span class="op" id="3435103">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435107">k</span>&nbsp;<span class="op" id="3435109">+=</span>&nbsp;<span class="num" id="3435112">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435116">s0</span><span class="op" id="3435118">,</span>&nbsp;<span class="ident" id="3435120">s1</span><span class="op" id="3435122">,</span>&nbsp;<span class="ident" id="3435124">s2</span><span class="op" id="3435126">,</span>&nbsp;<span class="ident" id="3435128">s3</span>&nbsp;<span class="op" id="3435131">=</span>&nbsp;<span class="ident" id="3435133">t0</span><span class="op" id="3435135">,</span>&nbsp;<span class="ident" id="3435137">t1</span><span class="op" id="3435139">,</span>&nbsp;<span class="ident" id="3435141">t2</span><span class="op" id="3435143">,</span>&nbsp;<span class="ident" id="3435145">t3</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3435149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3435153">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435216">s0</span>&nbsp;<span class="op" id="3435219">=</span>&nbsp;<span class="builtintype" id="3435221">uint32</span><span class="op" id="3435227">(</span><span class="ident" id="3435228">sbox0</span><span class="op" id="3435233">[</span><span class="ident" id="3435234">t0</span><span class="op" id="3435236">&gt;&gt;</span><span class="num" id="3435238">24</span><span class="op" id="3435240">]</span><span class="op" id="3435241">)</span><span class="op" id="3435242">&lt;&lt;</span><span class="num" id="3435244">24</span>&nbsp;<span class="op" id="3435247">|</span>&nbsp;<span class="builtintype" id="3435249">uint32</span><span class="op" id="3435255">(</span><span class="ident" id="3435256">sbox0</span><span class="op" id="3435261">[</span><span class="ident" id="3435262">t1</span><span class="op" id="3435264">&gt;&gt;</span><span class="num" id="3435266">16</span><span class="op" id="3435268">&amp;</span><span class="num" id="3435269">0xff</span><span class="op" id="3435273">]</span><span class="op" id="3435274">)</span><span class="op" id="3435275">&lt;&lt;</span><span class="num" id="3435277">16</span>&nbsp;<span class="op" id="3435280">|</span>&nbsp;<span class="builtintype" id="3435282">uint32</span><span class="op" id="3435288">(</span><span class="ident" id="3435289">sbox0</span><span class="op" id="3435294">[</span><span class="ident" id="3435295">t2</span><span class="op" id="3435297">&gt;&gt;</span><span class="num" id="3435299">8</span><span class="op" id="3435300">&amp;</span><span class="num" id="3435301">0xff</span><span class="op" id="3435305">]</span><span class="op" id="3435306">)</span><span class="op" id="3435307">&lt;&lt;</span><span class="num" id="3435309">8</span>&nbsp;<span class="op" id="3435311">|</span>&nbsp;<span class="builtintype" id="3435313">uint32</span><span class="op" id="3435319">(</span><span class="ident" id="3435320">sbox0</span><span class="op" id="3435325">[</span><span class="ident" id="3435326">t3</span><span class="op" id="3435328">&amp;</span><span class="num" id="3435329">0xff</span><span class="op" id="3435333">]</span><span class="op" id="3435334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435337">s1</span>&nbsp;<span class="op" id="3435340">=</span>&nbsp;<span class="builtintype" id="3435342">uint32</span><span class="op" id="3435348">(</span><span class="ident" id="3435349">sbox0</span><span class="op" id="3435354">[</span><span class="ident" id="3435355">t1</span><span class="op" id="3435357">&gt;&gt;</span><span class="num" id="3435359">24</span><span class="op" id="3435361">]</span><span class="op" id="3435362">)</span><span class="op" id="3435363">&lt;&lt;</span><span class="num" id="3435365">24</span>&nbsp;<span class="op" id="3435368">|</span>&nbsp;<span class="builtintype" id="3435370">uint32</span><span class="op" id="3435376">(</span><span class="ident" id="3435377">sbox0</span><span class="op" id="3435382">[</span><span class="ident" id="3435383">t2</span><span class="op" id="3435385">&gt;&gt;</span><span class="num" id="3435387">16</span><span class="op" id="3435389">&amp;</span><span class="num" id="3435390">0xff</span><span class="op" id="3435394">]</span><span class="op" id="3435395">)</span><span class="op" id="3435396">&lt;&lt;</span><span class="num" id="3435398">16</span>&nbsp;<span class="op" id="3435401">|</span>&nbsp;<span class="builtintype" id="3435403">uint32</span><span class="op" id="3435409">(</span><span class="ident" id="3435410">sbox0</span><span class="op" id="3435415">[</span><span class="ident" id="3435416">t3</span><span class="op" id="3435418">&gt;&gt;</span><span class="num" id="3435420">8</span><span class="op" id="3435421">&amp;</span><span class="num" id="3435422">0xff</span><span class="op" id="3435426">]</span><span class="op" id="3435427">)</span><span class="op" id="3435428">&lt;&lt;</span><span class="num" id="3435430">8</span>&nbsp;<span class="op" id="3435432">|</span>&nbsp;<span class="builtintype" id="3435434">uint32</span><span class="op" id="3435440">(</span><span class="ident" id="3435441">sbox0</span><span class="op" id="3435446">[</span><span class="ident" id="3435447">t0</span><span class="op" id="3435449">&amp;</span><span class="num" id="3435450">0xff</span><span class="op" id="3435454">]</span><span class="op" id="3435455">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435458">s2</span>&nbsp;<span class="op" id="3435461">=</span>&nbsp;<span class="builtintype" id="3435463">uint32</span><span class="op" id="3435469">(</span><span class="ident" id="3435470">sbox0</span><span class="op" id="3435475">[</span><span class="ident" id="3435476">t2</span><span class="op" id="3435478">&gt;&gt;</span><span class="num" id="3435480">24</span><span class="op" id="3435482">]</span><span class="op" id="3435483">)</span><span class="op" id="3435484">&lt;&lt;</span><span class="num" id="3435486">24</span>&nbsp;<span class="op" id="3435489">|</span>&nbsp;<span class="builtintype" id="3435491">uint32</span><span class="op" id="3435497">(</span><span class="ident" id="3435498">sbox0</span><span class="op" id="3435503">[</span><span class="ident" id="3435504">t3</span><span class="op" id="3435506">&gt;&gt;</span><span class="num" id="3435508">16</span><span class="op" id="3435510">&amp;</span><span class="num" id="3435511">0xff</span><span class="op" id="3435515">]</span><span class="op" id="3435516">)</span><span class="op" id="3435517">&lt;&lt;</span><span class="num" id="3435519">16</span>&nbsp;<span class="op" id="3435522">|</span>&nbsp;<span class="builtintype" id="3435524">uint32</span><span class="op" id="3435530">(</span><span class="ident" id="3435531">sbox0</span><span class="op" id="3435536">[</span><span class="ident" id="3435537">t0</span><span class="op" id="3435539">&gt;&gt;</span><span class="num" id="3435541">8</span><span class="op" id="3435542">&amp;</span><span class="num" id="3435543">0xff</span><span class="op" id="3435547">]</span><span class="op" id="3435548">)</span><span class="op" id="3435549">&lt;&lt;</span><span class="num" id="3435551">8</span>&nbsp;<span class="op" id="3435553">|</span>&nbsp;<span class="builtintype" id="3435555">uint32</span><span class="op" id="3435561">(</span><span class="ident" id="3435562">sbox0</span><span class="op" id="3435567">[</span><span class="ident" id="3435568">t1</span><span class="op" id="3435570">&amp;</span><span class="num" id="3435571">0xff</span><span class="op" id="3435575">]</span><span class="op" id="3435576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435579">s3</span>&nbsp;<span class="op" id="3435582">=</span>&nbsp;<span class="builtintype" id="3435584">uint32</span><span class="op" id="3435590">(</span><span class="ident" id="3435591">sbox0</span><span class="op" id="3435596">[</span><span class="ident" id="3435597">t3</span><span class="op" id="3435599">&gt;&gt;</span><span class="num" id="3435601">24</span><span class="op" id="3435603">]</span><span class="op" id="3435604">)</span><span class="op" id="3435605">&lt;&lt;</span><span class="num" id="3435607">24</span>&nbsp;<span class="op" id="3435610">|</span>&nbsp;<span class="builtintype" id="3435612">uint32</span><span class="op" id="3435618">(</span><span class="ident" id="3435619">sbox0</span><span class="op" id="3435624">[</span><span class="ident" id="3435625">t0</span><span class="op" id="3435627">&gt;&gt;</span><span class="num" id="3435629">16</span><span class="op" id="3435631">&amp;</span><span class="num" id="3435632">0xff</span><span class="op" id="3435636">]</span><span class="op" id="3435637">)</span><span class="op" id="3435638">&lt;&lt;</span><span class="num" id="3435640">16</span>&nbsp;<span class="op" id="3435643">|</span>&nbsp;<span class="builtintype" id="3435645">uint32</span><span class="op" id="3435651">(</span><span class="ident" id="3435652">sbox0</span><span class="op" id="3435657">[</span><span class="ident" id="3435658">t1</span><span class="op" id="3435660">&gt;&gt;</span><span class="num" id="3435662">8</span><span class="op" id="3435663">&amp;</span><span class="num" id="3435664">0xff</span><span class="op" id="3435668">]</span><span class="op" id="3435669">)</span><span class="op" id="3435670">&lt;&lt;</span><span class="num" id="3435672">8</span>&nbsp;<span class="op" id="3435674">|</span>&nbsp;<span class="builtintype" id="3435676">uint32</span><span class="op" id="3435682">(</span><span class="ident" id="3435683">sbox0</span><span class="op" id="3435688">[</span><span class="ident" id="3435689">t2</span><span class="op" id="3435691">&amp;</span><span class="num" id="3435692">0xff</span><span class="op" id="3435696">]</span><span class="op" id="3435697">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435701">s0</span>&nbsp;<span class="op" id="3435704">^=</span>&nbsp;<span class="ident" id="3435707">xk</span><span class="op" id="3435709">[</span><span class="ident" id="3435710">k</span><span class="op" id="3435711">+</span><span class="num" id="3435712">0</span><span class="op" id="3435713">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435716">s1</span>&nbsp;<span class="op" id="3435719">^=</span>&nbsp;<span class="ident" id="3435722">xk</span><span class="op" id="3435724">[</span><span class="ident" id="3435725">k</span><span class="op" id="3435726">+</span><span class="num" id="3435727">1</span><span class="op" id="3435728">]</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435731">s2</span>&nbsp;<span class="op" id="3435734">^=</span>&nbsp;<span class="ident" id="3435737">xk</span><span class="op" id="3435739">[</span><span class="ident" id="3435740">k</span><span class="op" id="3435741">+</span><span class="num" id="3435742">2</span><span class="op" id="3435743">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435746">s3</span>&nbsp;<span class="op" id="3435749">^=</span>&nbsp;<span class="ident" id="3435752">xk</span><span class="op" id="3435754">[</span><span class="ident" id="3435755">k</span><span class="op" id="3435756">+</span><span class="num" id="3435757">3</span><span class="op" id="3435758">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435762">dst</span><span class="op" id="3435765">[</span><span class="num" id="3435766">0</span><span class="op" id="3435767">]</span><span class="op" id="3435768">,</span>&nbsp;<span class="ident" id="3435770">dst</span><span class="op" id="3435773">[</span><span class="num" id="3435774">1</span><span class="op" id="3435775">]</span><span class="op" id="3435776">,</span>&nbsp;<span class="ident" id="3435778">dst</span><span class="op" id="3435781">[</span><span class="num" id="3435782">2</span><span class="op" id="3435783">]</span><span class="op" id="3435784">,</span>&nbsp;<span class="ident" id="3435786">dst</span><span class="op" id="3435789">[</span><span class="num" id="3435790">3</span><span class="op" id="3435791">]</span>&nbsp;<span class="op" id="3435793">=</span>&nbsp;<span class="builtintype" id="3435795">byte</span><span class="op" id="3435799">(</span><span class="ident" id="3435800">s0</span><span class="op" id="3435802">&gt;&gt;</span><span class="num" id="3435804">24</span><span class="op" id="3435806">)</span><span class="op" id="3435807">,</span>&nbsp;<span class="builtintype" id="3435809">byte</span><span class="op" id="3435813">(</span><span class="ident" id="3435814">s0</span><span class="op" id="3435816">&gt;&gt;</span><span class="num" id="3435818">16</span><span class="op" id="3435820">)</span><span class="op" id="3435821">,</span>&nbsp;<span class="builtintype" id="3435823">byte</span><span class="op" id="3435827">(</span><span class="ident" id="3435828">s0</span><span class="op" id="3435830">&gt;&gt;</span><span class="num" id="3435832">8</span><span class="op" id="3435833">)</span><span class="op" id="3435834">,</span>&nbsp;<span class="builtintype" id="3435836">byte</span><span class="op" id="3435840">(</span><span class="ident" id="3435841">s0</span><span class="op" id="3435843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435846">dst</span><span class="op" id="3435849">[</span><span class="num" id="3435850">4</span><span class="op" id="3435851">]</span><span class="op" id="3435852">,</span>&nbsp;<span class="ident" id="3435854">dst</span><span class="op" id="3435857">[</span><span class="num" id="3435858">5</span><span class="op" id="3435859">]</span><span class="op" id="3435860">,</span>&nbsp;<span class="ident" id="3435862">dst</span><span class="op" id="3435865">[</span><span class="num" id="3435866">6</span><span class="op" id="3435867">]</span><span class="op" id="3435868">,</span>&nbsp;<span class="ident" id="3435870">dst</span><span class="op" id="3435873">[</span><span class="num" id="3435874">7</span><span class="op" id="3435875">]</span>&nbsp;<span class="op" id="3435877">=</span>&nbsp;<span class="builtintype" id="3435879">byte</span><span class="op" id="3435883">(</span><span class="ident" id="3435884">s1</span><span class="op" id="3435886">&gt;&gt;</span><span class="num" id="3435888">24</span><span class="op" id="3435890">)</span><span class="op" id="3435891">,</span>&nbsp;<span class="builtintype" id="3435893">byte</span><span class="op" id="3435897">(</span><span class="ident" id="3435898">s1</span><span class="op" id="3435900">&gt;&gt;</span><span class="num" id="3435902">16</span><span class="op" id="3435904">)</span><span class="op" id="3435905">,</span>&nbsp;<span class="builtintype" id="3435907">byte</span><span class="op" id="3435911">(</span><span class="ident" id="3435912">s1</span><span class="op" id="3435914">&gt;&gt;</span><span class="num" id="3435916">8</span><span class="op" id="3435917">)</span><span class="op" id="3435918">,</span>&nbsp;<span class="builtintype" id="3435920">byte</span><span class="op" id="3435924">(</span><span class="ident" id="3435925">s1</span><span class="op" id="3435927">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3435930">dst</span><span class="op" id="3435933">[</span><span class="num" id="3435934">8</span><span class="op" id="3435935">]</span><span class="op" id="3435936">,</span>&nbsp;<span class="ident" id="3435938">dst</span><span class="op" id="3435941">[</span><span class="num" id="3435942">9</span><span class="op" id="3435943">]</span><span class="op" id="3435944">,</span>&nbsp;<span class="ident" id="3435946">dst</span><span class="op" id="3435949">[</span><span class="num" id="3435950">10</span><span class="op" id="3435952">]</span><span class="op" id="3435953">,</span>&nbsp;<span class="ident" id="3435955">dst</span><span class="op" id="3435958">[</span><span class="num" id="3435959">11</span><span class="op" id="3435961">]</span>&nbsp;<span class="op" id="3435963">=</span>&nbsp;<span class="builtintype" id="3435965">byte</span><span class="op" id="3435969">(</span><span class="ident" id="3435970">s2</span><span class="op" id="3435972">&gt;&gt;</span><span class="num" id="3435974">24</span><span class="op" id="3435976">)</span><span class="op" id="3435977">,</span>&nbsp;<span class="builtintype" id="3435979">byte</span><span class="op" id="3435983">(</span><span class="ident" id="3435984">s2</span><span class="op" id="3435986">&gt;&gt;</span><span class="num" id="3435988">16</span><span class="op" id="3435990">)</span><span class="op" id="3435991">,</span>&nbsp;<span class="builtintype" id="3435993">byte</span><span class="op" id="3435997">(</span><span class="ident" id="3435998">s2</span><span class="op" id="3436000">&gt;&gt;</span><span class="num" id="3436002">8</span><span class="op" id="3436003">)</span><span class="op" id="3436004">,</span>&nbsp;<span class="builtintype" id="3436006">byte</span><span class="op" id="3436010">(</span><span class="ident" id="3436011">s2</span><span class="op" id="3436013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436016">dst</span><span class="op" id="3436019">[</span><span class="num" id="3436020">12</span><span class="op" id="3436022">]</span><span class="op" id="3436023">,</span>&nbsp;<span class="ident" id="3436025">dst</span><span class="op" id="3436028">[</span><span class="num" id="3436029">13</span><span class="op" id="3436031">]</span><span class="op" id="3436032">,</span>&nbsp;<span class="ident" id="3436034">dst</span><span class="op" id="3436037">[</span><span class="num" id="3436038">14</span><span class="op" id="3436040">]</span><span class="op" id="3436041">,</span>&nbsp;<span class="ident" id="3436043">dst</span><span class="op" id="3436046">[</span><span class="num" id="3436047">15</span><span class="op" id="3436049">]</span>&nbsp;<span class="op" id="3436051">=</span>&nbsp;<span class="builtintype" id="3436053">byte</span><span class="op" id="3436057">(</span><span class="ident" id="3436058">s3</span><span class="op" id="3436060">&gt;&gt;</span><span class="num" id="3436062">24</span><span class="op" id="3436064">)</span><span class="op" id="3436065">,</span>&nbsp;<span class="builtintype" id="3436067">byte</span><span class="op" id="3436071">(</span><span class="ident" id="3436072">s3</span><span class="op" id="3436074">&gt;&gt;</span><span class="num" id="3436076">16</span><span class="op" id="3436078">)</span><span class="op" id="3436079">,</span>&nbsp;<span class="builtintype" id="3436081">byte</span><span class="op" id="3436085">(</span><span class="ident" id="3436086">s3</span><span class="op" id="3436088">&gt;&gt;</span><span class="num" id="3436090">8</span><span class="op" id="3436091">)</span><span class="op" id="3436092">,</span>&nbsp;<span class="builtintype" id="3436094">byte</span><span class="op" id="3436098">(</span><span class="ident" id="3436099">s3</span><span class="op" id="3436101">)</span><br>
<span class="lineno"></span><span class="op" id="3436103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3436106">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">85</span><span class="keyword" id="3436173">func</span>&nbsp;<span class="ident" id="3436178">decryptBlockGo</span><span class="op" id="3436192">(</span><span class="ident" id="3436193">xk</span>&nbsp;<span class="op" id="3436196">[</span><span class="op" id="3436197">]</span><span class="builtintype" id="3436198">uint32</span><span class="op" id="3436204">,</span>&nbsp;<span class="ident" id="3436206">dst</span><span class="op" id="3436209">,</span>&nbsp;<span class="ident" id="3436211">src</span>&nbsp;<span class="op" id="3436215">[</span><span class="op" id="3436216">]</span><span class="builtintype" id="3436217">byte</span><span class="op" id="3436221">)</span>&nbsp;<span class="op" id="3436223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436226">var</span>&nbsp;<span class="ident" id="3436230">s0</span><span class="op" id="3436232">,</span>&nbsp;<span class="ident" id="3436234">s1</span><span class="op" id="3436236">,</span>&nbsp;<span class="ident" id="3436238">s2</span><span class="op" id="3436240">,</span>&nbsp;<span class="ident" id="3436242">s3</span><span class="op" id="3436244">,</span>&nbsp;<span class="ident" id="3436246">t0</span><span class="op" id="3436248">,</span>&nbsp;<span class="ident" id="3436250">t1</span><span class="op" id="3436252">,</span>&nbsp;<span class="ident" id="3436254">t2</span><span class="op" id="3436256">,</span>&nbsp;<span class="ident" id="3436258">t3</span>&nbsp;<span class="builtintype" id="3436261">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436270">s0</span>&nbsp;<span class="op" id="3436273">=</span>&nbsp;<span class="builtintype" id="3436275">uint32</span><span class="op" id="3436281">(</span><span class="ident" id="3436282">src</span><span class="op" id="3436285">[</span><span class="num" id="3436286">0</span><span class="op" id="3436287">]</span><span class="op" id="3436288">)</span><span class="op" id="3436289">&lt;&lt;</span><span class="num" id="3436291">24</span>&nbsp;<span class="op" id="3436294">|</span>&nbsp;<span class="builtintype" id="3436296">uint32</span><span class="op" id="3436302">(</span><span class="ident" id="3436303">src</span><span class="op" id="3436306">[</span><span class="num" id="3436307">1</span><span class="op" id="3436308">]</span><span class="op" id="3436309">)</span><span class="op" id="3436310">&lt;&lt;</span><span class="num" id="3436312">16</span>&nbsp;<span class="op" id="3436315">|</span>&nbsp;<span class="builtintype" id="3436317">uint32</span><span class="op" id="3436323">(</span><span class="ident" id="3436324">src</span><span class="op" id="3436327">[</span><span class="num" id="3436328">2</span><span class="op" id="3436329">]</span><span class="op" id="3436330">)</span><span class="op" id="3436331">&lt;&lt;</span><span class="num" id="3436333">8</span>&nbsp;<span class="op" id="3436335">|</span>&nbsp;<span class="builtintype" id="3436337">uint32</span><span class="op" id="3436343">(</span><span class="ident" id="3436344">src</span><span class="op" id="3436347">[</span><span class="num" id="3436348">3</span><span class="op" id="3436349">]</span><span class="op" id="3436350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436353">s1</span>&nbsp;<span class="op" id="3436356">=</span>&nbsp;<span class="builtintype" id="3436358">uint32</span><span class="op" id="3436364">(</span><span class="ident" id="3436365">src</span><span class="op" id="3436368">[</span><span class="num" id="3436369">4</span><span class="op" id="3436370">]</span><span class="op" id="3436371">)</span><span class="op" id="3436372">&lt;&lt;</span><span class="num" id="3436374">24</span>&nbsp;<span class="op" id="3436377">|</span>&nbsp;<span class="builtintype" id="3436379">uint32</span><span class="op" id="3436385">(</span><span class="ident" id="3436386">src</span><span class="op" id="3436389">[</span><span class="num" id="3436390">5</span><span class="op" id="3436391">]</span><span class="op" id="3436392">)</span><span class="op" id="3436393">&lt;&lt;</span><span class="num" id="3436395">16</span>&nbsp;<span class="op" id="3436398">|</span>&nbsp;<span class="builtintype" id="3436400">uint32</span><span class="op" id="3436406">(</span><span class="ident" id="3436407">src</span><span class="op" id="3436410">[</span><span class="num" id="3436411">6</span><span class="op" id="3436412">]</span><span class="op" id="3436413">)</span><span class="op" id="3436414">&lt;&lt;</span><span class="num" id="3436416">8</span>&nbsp;<span class="op" id="3436418">|</span>&nbsp;<span class="builtintype" id="3436420">uint32</span><span class="op" id="3436426">(</span><span class="ident" id="3436427">src</span><span class="op" id="3436430">[</span><span class="num" id="3436431">7</span><span class="op" id="3436432">]</span><span class="op" id="3436433">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436436">s2</span>&nbsp;<span class="op" id="3436439">=</span>&nbsp;<span class="builtintype" id="3436441">uint32</span><span class="op" id="3436447">(</span><span class="ident" id="3436448">src</span><span class="op" id="3436451">[</span><span class="num" id="3436452">8</span><span class="op" id="3436453">]</span><span class="op" id="3436454">)</span><span class="op" id="3436455">&lt;&lt;</span><span class="num" id="3436457">24</span>&nbsp;<span class="op" id="3436460">|</span>&nbsp;<span class="builtintype" id="3436462">uint32</span><span class="op" id="3436468">(</span><span class="ident" id="3436469">src</span><span class="op" id="3436472">[</span><span class="num" id="3436473">9</span><span class="op" id="3436474">]</span><span class="op" id="3436475">)</span><span class="op" id="3436476">&lt;&lt;</span><span class="num" id="3436478">16</span>&nbsp;<span class="op" id="3436481">|</span>&nbsp;<span class="builtintype" id="3436483">uint32</span><span class="op" id="3436489">(</span><span class="ident" id="3436490">src</span><span class="op" id="3436493">[</span><span class="num" id="3436494">10</span><span class="op" id="3436496">]</span><span class="op" id="3436497">)</span><span class="op" id="3436498">&lt;&lt;</span><span class="num" id="3436500">8</span>&nbsp;<span class="op" id="3436502">|</span>&nbsp;<span class="builtintype" id="3436504">uint32</span><span class="op" id="3436510">(</span><span class="ident" id="3436511">src</span><span class="op" id="3436514">[</span><span class="num" id="3436515">11</span><span class="op" id="3436517">]</span><span class="op" id="3436518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436521">s3</span>&nbsp;<span class="op" id="3436524">=</span>&nbsp;<span class="builtintype" id="3436526">uint32</span><span class="op" id="3436532">(</span><span class="ident" id="3436533">src</span><span class="op" id="3436536">[</span><span class="num" id="3436537">12</span><span class="op" id="3436539">]</span><span class="op" id="3436540">)</span><span class="op" id="3436541">&lt;&lt;</span><span class="num" id="3436543">24</span>&nbsp;<span class="op" id="3436546">|</span>&nbsp;<span class="builtintype" id="3436548">uint32</span><span class="op" id="3436554">(</span><span class="ident" id="3436555">src</span><span class="op" id="3436558">[</span><span class="num" id="3436559">13</span><span class="op" id="3436561">]</span><span class="op" id="3436562">)</span><span class="op" id="3436563">&lt;&lt;</span><span class="num" id="3436565">16</span>&nbsp;<span class="op" id="3436568">|</span>&nbsp;<span class="builtintype" id="3436570">uint32</span><span class="op" id="3436576">(</span><span class="ident" id="3436577">src</span><span class="op" id="3436580">[</span><span class="num" id="3436581">14</span><span class="op" id="3436583">]</span><span class="op" id="3436584">)</span><span class="op" id="3436585">&lt;&lt;</span><span class="num" id="3436587">8</span>&nbsp;<span class="op" id="3436589">|</span>&nbsp;<span class="builtintype" id="3436591">uint32</span><span class="op" id="3436597">(</span><span class="ident" id="3436598">src</span><span class="op" id="3436601">[</span><span class="num" id="3436602">15</span><span class="op" id="3436604">]</span><span class="op" id="3436605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3436609">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436651">s0</span>&nbsp;<span class="op" id="3436654">^=</span>&nbsp;<span class="ident" id="3436657">xk</span><span class="op" id="3436659">[</span><span class="num" id="3436660">0</span><span class="op" id="3436661">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436664">s1</span>&nbsp;<span class="op" id="3436667">^=</span>&nbsp;<span class="ident" id="3436670">xk</span><span class="op" id="3436672">[</span><span class="num" id="3436673">1</span><span class="op" id="3436674">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436677">s2</span>&nbsp;<span class="op" id="3436680">^=</span>&nbsp;<span class="ident" id="3436683">xk</span><span class="op" id="3436685">[</span><span class="num" id="3436686">2</span><span class="op" id="3436687">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436690">s3</span>&nbsp;<span class="op" id="3436693">^=</span>&nbsp;<span class="ident" id="3436696">xk</span><span class="op" id="3436698">[</span><span class="num" id="3436699">3</span><span class="op" id="3436700">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3436704">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3436744">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436799">nr</span>&nbsp;<span class="op" id="3436802">:=</span>&nbsp;<span class="builtinfunc" id="3436805">len</span><span class="op" id="3436808">(</span><span class="ident" id="3436809">xk</span><span class="op" id="3436811">)</span><span class="op" id="3436812">/</span><span class="num" id="3436813">4</span>&nbsp;<span class="op" id="3436815">-</span>&nbsp;<span class="num" id="3436817">2</span>&nbsp;<span class="comment" id="3436819">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436854">k</span>&nbsp;<span class="op" id="3436856">:=</span>&nbsp;<span class="num" id="3436859">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436862">for</span>&nbsp;<span class="ident" id="3436866">r</span>&nbsp;<span class="op" id="3436868">:=</span>&nbsp;<span class="num" id="3436871">0</span><span class="op" id="3436872">;</span>&nbsp;<span class="ident" id="3436874">r</span>&nbsp;<span class="op" id="3436876">&lt;</span>&nbsp;<span class="ident" id="3436878">nr</span><span class="op" id="3436880">;</span>&nbsp;<span class="ident" id="3436882">r</span><span class="op" id="3436883">++</span>&nbsp;<span class="op" id="3436886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436890">t0</span>&nbsp;<span class="op" id="3436893">=</span>&nbsp;<span class="ident" id="3436895">xk</span><span class="op" id="3436897">[</span><span class="ident" id="3436898">k</span><span class="op" id="3436899">+</span><span class="num" id="3436900">0</span><span class="op" id="3436901">]</span>&nbsp;<span class="op" id="3436903">^</span>&nbsp;<span class="ident" id="3436905">td0</span><span class="op" id="3436908">[</span><span class="builtintype" id="3436909">uint8</span><span class="op" id="3436914">(</span><span class="ident" id="3436915">s0</span><span class="op" id="3436917">&gt;&gt;</span><span class="num" id="3436919">24</span><span class="op" id="3436921">)</span><span class="op" id="3436922">]</span>&nbsp;<span class="op" id="3436924">^</span>&nbsp;<span class="ident" id="3436926">td1</span><span class="op" id="3436929">[</span><span class="builtintype" id="3436930">uint8</span><span class="op" id="3436935">(</span><span class="ident" id="3436936">s3</span><span class="op" id="3436938">&gt;&gt;</span><span class="num" id="3436940">16</span><span class="op" id="3436942">)</span><span class="op" id="3436943">]</span>&nbsp;<span class="op" id="3436945">^</span>&nbsp;<span class="ident" id="3436947">td2</span><span class="op" id="3436950">[</span><span class="builtintype" id="3436951">uint8</span><span class="op" id="3436956">(</span><span class="ident" id="3436957">s2</span><span class="op" id="3436959">&gt;&gt;</span><span class="num" id="3436961">8</span><span class="op" id="3436962">)</span><span class="op" id="3436963">]</span>&nbsp;<span class="op" id="3436965">^</span>&nbsp;<span class="ident" id="3436967">td3</span><span class="op" id="3436970">[</span><span class="builtintype" id="3436971">uint8</span><span class="op" id="3436976">(</span><span class="ident" id="3436977">s1</span><span class="op" id="3436979">)</span><span class="op" id="3436980">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436984">t1</span>&nbsp;<span class="op" id="3436987">=</span>&nbsp;<span class="ident" id="3436989">xk</span><span class="op" id="3436991">[</span><span class="ident" id="3436992">k</span><span class="op" id="3436993">+</span><span class="num" id="3436994">1</span><span class="op" id="3436995">]</span>&nbsp;<span class="op" id="3436997">^</span>&nbsp;<span class="ident" id="3436999">td0</span><span class="op" id="3437002">[</span><span class="builtintype" id="3437003">uint8</span><span class="op" id="3437008">(</span><span class="ident" id="3437009">s1</span><span class="op" id="3437011">&gt;&gt;</span><span class="num" id="3437013">24</span><span class="op" id="3437015">)</span><span class="op" id="3437016">]</span>&nbsp;<span class="op" id="3437018">^</span>&nbsp;<span class="ident" id="3437020">td1</span><span class="op" id="3437023">[</span><span class="builtintype" id="3437024">uint8</span><span class="op" id="3437029">(</span><span class="ident" id="3437030">s0</span><span class="op" id="3437032">&gt;&gt;</span><span class="num" id="3437034">16</span><span class="op" id="3437036">)</span><span class="op" id="3437037">]</span>&nbsp;<span class="op" id="3437039">^</span>&nbsp;<span class="ident" id="3437041">td2</span><span class="op" id="3437044">[</span><span class="builtintype" id="3437045">uint8</span><span class="op" id="3437050">(</span><span class="ident" id="3437051">s3</span><span class="op" id="3437053">&gt;&gt;</span><span class="num" id="3437055">8</span><span class="op" id="3437056">)</span><span class="op" id="3437057">]</span>&nbsp;<span class="op" id="3437059">^</span>&nbsp;<span class="ident" id="3437061">td3</span><span class="op" id="3437064">[</span><span class="builtintype" id="3437065">uint8</span><span class="op" id="3437070">(</span><span class="ident" id="3437071">s2</span><span class="op" id="3437073">)</span><span class="op" id="3437074">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437078">t2</span>&nbsp;<span class="op" id="3437081">=</span>&nbsp;<span class="ident" id="3437083">xk</span><span class="op" id="3437085">[</span><span class="ident" id="3437086">k</span><span class="op" id="3437087">+</span><span class="num" id="3437088">2</span><span class="op" id="3437089">]</span>&nbsp;<span class="op" id="3437091">^</span>&nbsp;<span class="ident" id="3437093">td0</span><span class="op" id="3437096">[</span><span class="builtintype" id="3437097">uint8</span><span class="op" id="3437102">(</span><span class="ident" id="3437103">s2</span><span class="op" id="3437105">&gt;&gt;</span><span class="num" id="3437107">24</span><span class="op" id="3437109">)</span><span class="op" id="3437110">]</span>&nbsp;<span class="op" id="3437112">^</span>&nbsp;<span class="ident" id="3437114">td1</span><span class="op" id="3437117">[</span><span class="builtintype" id="3437118">uint8</span><span class="op" id="3437123">(</span><span class="ident" id="3437124">s1</span><span class="op" id="3437126">&gt;&gt;</span><span class="num" id="3437128">16</span><span class="op" id="3437130">)</span><span class="op" id="3437131">]</span>&nbsp;<span class="op" id="3437133">^</span>&nbsp;<span class="ident" id="3437135">td2</span><span class="op" id="3437138">[</span><span class="builtintype" id="3437139">uint8</span><span class="op" id="3437144">(</span><span class="ident" id="3437145">s0</span><span class="op" id="3437147">&gt;&gt;</span><span class="num" id="3437149">8</span><span class="op" id="3437150">)</span><span class="op" id="3437151">]</span>&nbsp;<span class="op" id="3437153">^</span>&nbsp;<span class="ident" id="3437155">td3</span><span class="op" id="3437158">[</span><span class="builtintype" id="3437159">uint8</span><span class="op" id="3437164">(</span><span class="ident" id="3437165">s3</span><span class="op" id="3437167">)</span><span class="op" id="3437168">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437172">t3</span>&nbsp;<span class="op" id="3437175">=</span>&nbsp;<span class="ident" id="3437177">xk</span><span class="op" id="3437179">[</span><span class="ident" id="3437180">k</span><span class="op" id="3437181">+</span><span class="num" id="3437182">3</span><span class="op" id="3437183">]</span>&nbsp;<span class="op" id="3437185">^</span>&nbsp;<span class="ident" id="3437187">td0</span><span class="op" id="3437190">[</span><span class="builtintype" id="3437191">uint8</span><span class="op" id="3437196">(</span><span class="ident" id="3437197">s3</span><span class="op" id="3437199">&gt;&gt;</span><span class="num" id="3437201">24</span><span class="op" id="3437203">)</span><span class="op" id="3437204">]</span>&nbsp;<span class="op" id="3437206">^</span>&nbsp;<span class="ident" id="3437208">td1</span><span class="op" id="3437211">[</span><span class="builtintype" id="3437212">uint8</span><span class="op" id="3437217">(</span><span class="ident" id="3437218">s2</span><span class="op" id="3437220">&gt;&gt;</span><span class="num" id="3437222">16</span><span class="op" id="3437224">)</span><span class="op" id="3437225">]</span>&nbsp;<span class="op" id="3437227">^</span>&nbsp;<span class="ident" id="3437229">td2</span><span class="op" id="3437232">[</span><span class="builtintype" id="3437233">uint8</span><span class="op" id="3437238">(</span><span class="ident" id="3437239">s1</span><span class="op" id="3437241">&gt;&gt;</span><span class="num" id="3437243">8</span><span class="op" id="3437244">)</span><span class="op" id="3437245">]</span>&nbsp;<span class="op" id="3437247">^</span>&nbsp;<span class="ident" id="3437249">td3</span><span class="op" id="3437252">[</span><span class="builtintype" id="3437253">uint8</span><span class="op" id="3437258">(</span><span class="ident" id="3437259">s0</span><span class="op" id="3437261">)</span><span class="op" id="3437262">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437266">k</span>&nbsp;<span class="op" id="3437268">+=</span>&nbsp;<span class="num" id="3437271">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437275">s0</span><span class="op" id="3437277">,</span>&nbsp;<span class="ident" id="3437279">s1</span><span class="op" id="3437281">,</span>&nbsp;<span class="ident" id="3437283">s2</span><span class="op" id="3437285">,</span>&nbsp;<span class="ident" id="3437287">s3</span>&nbsp;<span class="op" id="3437290">=</span>&nbsp;<span class="ident" id="3437292">t0</span><span class="op" id="3437294">,</span>&nbsp;<span class="ident" id="3437296">t1</span><span class="op" id="3437298">,</span>&nbsp;<span class="ident" id="3437300">t2</span><span class="op" id="3437302">,</span>&nbsp;<span class="ident" id="3437304">t3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3437308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3437312">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437375">s0</span>&nbsp;<span class="op" id="3437378">=</span>&nbsp;<span class="builtintype" id="3437380">uint32</span><span class="op" id="3437386">(</span><span class="ident" id="3437387">sbox1</span><span class="op" id="3437392">[</span><span class="ident" id="3437393">t0</span><span class="op" id="3437395">&gt;&gt;</span><span class="num" id="3437397">24</span><span class="op" id="3437399">]</span><span class="op" id="3437400">)</span><span class="op" id="3437401">&lt;&lt;</span><span class="num" id="3437403">24</span>&nbsp;<span class="op" id="3437406">|</span>&nbsp;<span class="builtintype" id="3437408">uint32</span><span class="op" id="3437414">(</span><span class="ident" id="3437415">sbox1</span><span class="op" id="3437420">[</span><span class="ident" id="3437421">t3</span><span class="op" id="3437423">&gt;&gt;</span><span class="num" id="3437425">16</span><span class="op" id="3437427">&amp;</span><span class="num" id="3437428">0xff</span><span class="op" id="3437432">]</span><span class="op" id="3437433">)</span><span class="op" id="3437434">&lt;&lt;</span><span class="num" id="3437436">16</span>&nbsp;<span class="op" id="3437439">|</span>&nbsp;<span class="builtintype" id="3437441">uint32</span><span class="op" id="3437447">(</span><span class="ident" id="3437448">sbox1</span><span class="op" id="3437453">[</span><span class="ident" id="3437454">t2</span><span class="op" id="3437456">&gt;&gt;</span><span class="num" id="3437458">8</span><span class="op" id="3437459">&amp;</span><span class="num" id="3437460">0xff</span><span class="op" id="3437464">]</span><span class="op" id="3437465">)</span><span class="op" id="3437466">&lt;&lt;</span><span class="num" id="3437468">8</span>&nbsp;<span class="op" id="3437470">|</span>&nbsp;<span class="builtintype" id="3437472">uint32</span><span class="op" id="3437478">(</span><span class="ident" id="3437479">sbox1</span><span class="op" id="3437484">[</span><span class="ident" id="3437485">t1</span><span class="op" id="3437487">&amp;</span><span class="num" id="3437488">0xff</span><span class="op" id="3437492">]</span><span class="op" id="3437493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437496">s1</span>&nbsp;<span class="op" id="3437499">=</span>&nbsp;<span class="builtintype" id="3437501">uint32</span><span class="op" id="3437507">(</span><span class="ident" id="3437508">sbox1</span><span class="op" id="3437513">[</span><span class="ident" id="3437514">t1</span><span class="op" id="3437516">&gt;&gt;</span><span class="num" id="3437518">24</span><span class="op" id="3437520">]</span><span class="op" id="3437521">)</span><span class="op" id="3437522">&lt;&lt;</span><span class="num" id="3437524">24</span>&nbsp;<span class="op" id="3437527">|</span>&nbsp;<span class="builtintype" id="3437529">uint32</span><span class="op" id="3437535">(</span><span class="ident" id="3437536">sbox1</span><span class="op" id="3437541">[</span><span class="ident" id="3437542">t0</span><span class="op" id="3437544">&gt;&gt;</span><span class="num" id="3437546">16</span><span class="op" id="3437548">&amp;</span><span class="num" id="3437549">0xff</span><span class="op" id="3437553">]</span><span class="op" id="3437554">)</span><span class="op" id="3437555">&lt;&lt;</span><span class="num" id="3437557">16</span>&nbsp;<span class="op" id="3437560">|</span>&nbsp;<span class="builtintype" id="3437562">uint32</span><span class="op" id="3437568">(</span><span class="ident" id="3437569">sbox1</span><span class="op" id="3437574">[</span><span class="ident" id="3437575">t3</span><span class="op" id="3437577">&gt;&gt;</span><span class="num" id="3437579">8</span><span class="op" id="3437580">&amp;</span><span class="num" id="3437581">0xff</span><span class="op" id="3437585">]</span><span class="op" id="3437586">)</span><span class="op" id="3437587">&lt;&lt;</span><span class="num" id="3437589">8</span>&nbsp;<span class="op" id="3437591">|</span>&nbsp;<span class="builtintype" id="3437593">uint32</span><span class="op" id="3437599">(</span><span class="ident" id="3437600">sbox1</span><span class="op" id="3437605">[</span><span class="ident" id="3437606">t2</span><span class="op" id="3437608">&amp;</span><span class="num" id="3437609">0xff</span><span class="op" id="3437613">]</span><span class="op" id="3437614">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437617">s2</span>&nbsp;<span class="op" id="3437620">=</span>&nbsp;<span class="builtintype" id="3437622">uint32</span><span class="op" id="3437628">(</span><span class="ident" id="3437629">sbox1</span><span class="op" id="3437634">[</span><span class="ident" id="3437635">t2</span><span class="op" id="3437637">&gt;&gt;</span><span class="num" id="3437639">24</span><span class="op" id="3437641">]</span><span class="op" id="3437642">)</span><span class="op" id="3437643">&lt;&lt;</span><span class="num" id="3437645">24</span>&nbsp;<span class="op" id="3437648">|</span>&nbsp;<span class="builtintype" id="3437650">uint32</span><span class="op" id="3437656">(</span><span class="ident" id="3437657">sbox1</span><span class="op" id="3437662">[</span><span class="ident" id="3437663">t1</span><span class="op" id="3437665">&gt;&gt;</span><span class="num" id="3437667">16</span><span class="op" id="3437669">&amp;</span><span class="num" id="3437670">0xff</span><span class="op" id="3437674">]</span><span class="op" id="3437675">)</span><span class="op" id="3437676">&lt;&lt;</span><span class="num" id="3437678">16</span>&nbsp;<span class="op" id="3437681">|</span>&nbsp;<span class="builtintype" id="3437683">uint32</span><span class="op" id="3437689">(</span><span class="ident" id="3437690">sbox1</span><span class="op" id="3437695">[</span><span class="ident" id="3437696">t0</span><span class="op" id="3437698">&gt;&gt;</span><span class="num" id="3437700">8</span><span class="op" id="3437701">&amp;</span><span class="num" id="3437702">0xff</span><span class="op" id="3437706">]</span><span class="op" id="3437707">)</span><span class="op" id="3437708">&lt;&lt;</span><span class="num" id="3437710">8</span>&nbsp;<span class="op" id="3437712">|</span>&nbsp;<span class="builtintype" id="3437714">uint32</span><span class="op" id="3437720">(</span><span class="ident" id="3437721">sbox1</span><span class="op" id="3437726">[</span><span class="ident" id="3437727">t3</span><span class="op" id="3437729">&amp;</span><span class="num" id="3437730">0xff</span><span class="op" id="3437734">]</span><span class="op" id="3437735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437738">s3</span>&nbsp;<span class="op" id="3437741">=</span>&nbsp;<span class="builtintype" id="3437743">uint32</span><span class="op" id="3437749">(</span><span class="ident" id="3437750">sbox1</span><span class="op" id="3437755">[</span><span class="ident" id="3437756">t3</span><span class="op" id="3437758">&gt;&gt;</span><span class="num" id="3437760">24</span><span class="op" id="3437762">]</span><span class="op" id="3437763">)</span><span class="op" id="3437764">&lt;&lt;</span><span class="num" id="3437766">24</span>&nbsp;<span class="op" id="3437769">|</span>&nbsp;<span class="builtintype" id="3437771">uint32</span><span class="op" id="3437777">(</span><span class="ident" id="3437778">sbox1</span><span class="op" id="3437783">[</span><span class="ident" id="3437784">t2</span><span class="op" id="3437786">&gt;&gt;</span><span class="num" id="3437788">16</span><span class="op" id="3437790">&amp;</span><span class="num" id="3437791">0xff</span><span class="op" id="3437795">]</span><span class="op" id="3437796">)</span><span class="op" id="3437797">&lt;&lt;</span><span class="num" id="3437799">16</span>&nbsp;<span class="op" id="3437802">|</span>&nbsp;<span class="builtintype" id="3437804">uint32</span><span class="op" id="3437810">(</span><span class="ident" id="3437811">sbox1</span><span class="op" id="3437816">[</span><span class="ident" id="3437817">t1</span><span class="op" id="3437819">&gt;&gt;</span><span class="num" id="3437821">8</span><span class="op" id="3437822">&amp;</span><span class="num" id="3437823">0xff</span><span class="op" id="3437827">]</span><span class="op" id="3437828">)</span><span class="op" id="3437829">&lt;&lt;</span><span class="num" id="3437831">8</span>&nbsp;<span class="op" id="3437833">|</span>&nbsp;<span class="builtintype" id="3437835">uint32</span><span class="op" id="3437841">(</span><span class="ident" id="3437842">sbox1</span><span class="op" id="3437847">[</span><span class="ident" id="3437848">t0</span><span class="op" id="3437850">&amp;</span><span class="num" id="3437851">0xff</span><span class="op" id="3437855">]</span><span class="op" id="3437856">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437860">s0</span>&nbsp;<span class="op" id="3437863">^=</span>&nbsp;<span class="ident" id="3437866">xk</span><span class="op" id="3437868">[</span><span class="ident" id="3437869">k</span><span class="op" id="3437870">+</span><span class="num" id="3437871">0</span><span class="op" id="3437872">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437875">s1</span>&nbsp;<span class="op" id="3437878">^=</span>&nbsp;<span class="ident" id="3437881">xk</span><span class="op" id="3437883">[</span><span class="ident" id="3437884">k</span><span class="op" id="3437885">+</span><span class="num" id="3437886">1</span><span class="op" id="3437887">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437890">s2</span>&nbsp;<span class="op" id="3437893">^=</span>&nbsp;<span class="ident" id="3437896">xk</span><span class="op" id="3437898">[</span><span class="ident" id="3437899">k</span><span class="op" id="3437900">+</span><span class="num" id="3437901">2</span><span class="op" id="3437902">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437905">s3</span>&nbsp;<span class="op" id="3437908">^=</span>&nbsp;<span class="ident" id="3437911">xk</span><span class="op" id="3437913">[</span><span class="ident" id="3437914">k</span><span class="op" id="3437915">+</span><span class="num" id="3437916">3</span><span class="op" id="3437917">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3437921">dst</span><span class="op" id="3437924">[</span><span class="num" id="3437925">0</span><span class="op" id="3437926">]</span><span class="op" id="3437927">,</span>&nbsp;<span class="ident" id="3437929">dst</span><span class="op" id="3437932">[</span><span class="num" id="3437933">1</span><span class="op" id="3437934">]</span><span class="op" id="3437935">,</span>&nbsp;<span class="ident" id="3437937">dst</span><span class="op" id="3437940">[</span><span class="num" id="3437941">2</span><span class="op" id="3437942">]</span><span class="op" id="3437943">,</span>&nbsp;<span class="ident" id="3437945">dst</span><span class="op" id="3437948">[</span><span class="num" id="3437949">3</span><span class="op" id="3437950">]</span>&nbsp;<span class="op" id="3437952">=</span>&nbsp;<span class="builtintype" id="3437954">byte</span><span class="op" id="3437958">(</span><span class="ident" id="3437959">s0</span><span class="op" id="3437961">&gt;&gt;</span><span class="num" id="3437963">24</span><span class="op" id="3437965">)</span><span class="op" id="3437966">,</span>&nbsp;<span class="builtintype" id="3437968">byte</span><span class="op" id="3437972">(</span><span class="ident" id="3437973">s0</span><span class="op" id="3437975">&gt;&gt;</span><span class="num" id="3437977">16</span><span class="op" id="3437979">)</span><span class="op" id="3437980">,</span>&nbsp;<span class="builtintype" id="3437982">byte</span><span class="op" id="3437986">(</span><span class="ident" id="3437987">s0</span><span class="op" id="3437989">&gt;&gt;</span><span class="num" id="3437991">8</span><span class="op" id="3437992">)</span><span class="op" id="3437993">,</span>&nbsp;<span class="builtintype" id="3437995">byte</span><span class="op" id="3437999">(</span><span class="ident" id="3438000">s0</span><span class="op" id="3438002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438005">dst</span><span class="op" id="3438008">[</span><span class="num" id="3438009">4</span><span class="op" id="3438010">]</span><span class="op" id="3438011">,</span>&nbsp;<span class="ident" id="3438013">dst</span><span class="op" id="3438016">[</span><span class="num" id="3438017">5</span><span class="op" id="3438018">]</span><span class="op" id="3438019">,</span>&nbsp;<span class="ident" id="3438021">dst</span><span class="op" id="3438024">[</span><span class="num" id="3438025">6</span><span class="op" id="3438026">]</span><span class="op" id="3438027">,</span>&nbsp;<span class="ident" id="3438029">dst</span><span class="op" id="3438032">[</span><span class="num" id="3438033">7</span><span class="op" id="3438034">]</span>&nbsp;<span class="op" id="3438036">=</span>&nbsp;<span class="builtintype" id="3438038">byte</span><span class="op" id="3438042">(</span><span class="ident" id="3438043">s1</span><span class="op" id="3438045">&gt;&gt;</span><span class="num" id="3438047">24</span><span class="op" id="3438049">)</span><span class="op" id="3438050">,</span>&nbsp;<span class="builtintype" id="3438052">byte</span><span class="op" id="3438056">(</span><span class="ident" id="3438057">s1</span><span class="op" id="3438059">&gt;&gt;</span><span class="num" id="3438061">16</span><span class="op" id="3438063">)</span><span class="op" id="3438064">,</span>&nbsp;<span class="builtintype" id="3438066">byte</span><span class="op" id="3438070">(</span><span class="ident" id="3438071">s1</span><span class="op" id="3438073">&gt;&gt;</span><span class="num" id="3438075">8</span><span class="op" id="3438076">)</span><span class="op" id="3438077">,</span>&nbsp;<span class="builtintype" id="3438079">byte</span><span class="op" id="3438083">(</span><span class="ident" id="3438084">s1</span><span class="op" id="3438086">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438089">dst</span><span class="op" id="3438092">[</span><span class="num" id="3438093">8</span><span class="op" id="3438094">]</span><span class="op" id="3438095">,</span>&nbsp;<span class="ident" id="3438097">dst</span><span class="op" id="3438100">[</span><span class="num" id="3438101">9</span><span class="op" id="3438102">]</span><span class="op" id="3438103">,</span>&nbsp;<span class="ident" id="3438105">dst</span><span class="op" id="3438108">[</span><span class="num" id="3438109">10</span><span class="op" id="3438111">]</span><span class="op" id="3438112">,</span>&nbsp;<span class="ident" id="3438114">dst</span><span class="op" id="3438117">[</span><span class="num" id="3438118">11</span><span class="op" id="3438120">]</span>&nbsp;<span class="op" id="3438122">=</span>&nbsp;<span class="builtintype" id="3438124">byte</span><span class="op" id="3438128">(</span><span class="ident" id="3438129">s2</span><span class="op" id="3438131">&gt;&gt;</span><span class="num" id="3438133">24</span><span class="op" id="3438135">)</span><span class="op" id="3438136">,</span>&nbsp;<span class="builtintype" id="3438138">byte</span><span class="op" id="3438142">(</span><span class="ident" id="3438143">s2</span><span class="op" id="3438145">&gt;&gt;</span><span class="num" id="3438147">16</span><span class="op" id="3438149">)</span><span class="op" id="3438150">,</span>&nbsp;<span class="builtintype" id="3438152">byte</span><span class="op" id="3438156">(</span><span class="ident" id="3438157">s2</span><span class="op" id="3438159">&gt;&gt;</span><span class="num" id="3438161">8</span><span class="op" id="3438162">)</span><span class="op" id="3438163">,</span>&nbsp;<span class="builtintype" id="3438165">byte</span><span class="op" id="3438169">(</span><span class="ident" id="3438170">s2</span><span class="op" id="3438172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438175">dst</span><span class="op" id="3438178">[</span><span class="num" id="3438179">12</span><span class="op" id="3438181">]</span><span class="op" id="3438182">,</span>&nbsp;<span class="ident" id="3438184">dst</span><span class="op" id="3438187">[</span><span class="num" id="3438188">13</span><span class="op" id="3438190">]</span><span class="op" id="3438191">,</span>&nbsp;<span class="ident" id="3438193">dst</span><span class="op" id="3438196">[</span><span class="num" id="3438197">14</span><span class="op" id="3438199">]</span><span class="op" id="3438200">,</span>&nbsp;<span class="ident" id="3438202">dst</span><span class="op" id="3438205">[</span><span class="num" id="3438206">15</span><span class="op" id="3438208">]</span>&nbsp;<span class="op" id="3438210">=</span>&nbsp;<span class="builtintype" id="3438212">byte</span><span class="op" id="3438216">(</span><span class="ident" id="3438217">s3</span><span class="op" id="3438219">&gt;&gt;</span><span class="num" id="3438221">24</span><span class="op" id="3438223">)</span><span class="op" id="3438224">,</span>&nbsp;<span class="builtintype" id="3438226">byte</span><span class="op" id="3438230">(</span><span class="ident" id="3438231">s3</span><span class="op" id="3438233">&gt;&gt;</span><span class="num" id="3438235">16</span><span class="op" id="3438237">)</span><span class="op" id="3438238">,</span>&nbsp;<span class="builtintype" id="3438240">byte</span><span class="op" id="3438244">(</span><span class="ident" id="3438245">s3</span><span class="op" id="3438247">&gt;&gt;</span><span class="num" id="3438249">8</span><span class="op" id="3438250">)</span><span class="op" id="3438251">,</span>&nbsp;<span class="builtintype" id="3438253">byte</span><span class="op" id="3438257">(</span><span class="ident" id="3438258">s3</span><span class="op" id="3438260">)</span><br>
<span class="lineno"></span><span class="op" id="3438262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3438265">//&nbsp;Apply&nbsp;sbox0&nbsp;to&nbsp;each&nbsp;byte&nbsp;in&nbsp;w.</span><br>
<span class="lineno">130</span><span class="keyword" id="3438299">func</span>&nbsp;<span class="ident" id="3438304">subw</span><span class="op" id="3438308">(</span><span class="ident" id="3438309">w</span>&nbsp;<span class="builtintype" id="3438311">uint32</span><span class="op" id="3438317">)</span>&nbsp;<span class="builtintype" id="3438319">uint32</span>&nbsp;<span class="op" id="3438326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438329">return</span>&nbsp;<span class="builtintype" id="3438336">uint32</span><span class="op" id="3438342">(</span><span class="ident" id="3438343">sbox0</span><span class="op" id="3438348">[</span><span class="ident" id="3438349">w</span><span class="op" id="3438350">&gt;&gt;</span><span class="num" id="3438352">24</span><span class="op" id="3438354">]</span><span class="op" id="3438355">)</span><span class="op" id="3438356">&lt;&lt;</span><span class="num" id="3438358">24</span>&nbsp;<span class="op" id="3438361">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3438365">uint32</span><span class="op" id="3438371">(</span><span class="ident" id="3438372">sbox0</span><span class="op" id="3438377">[</span><span class="ident" id="3438378">w</span><span class="op" id="3438379">&gt;&gt;</span><span class="num" id="3438381">16</span><span class="op" id="3438383">&amp;</span><span class="num" id="3438384">0xff</span><span class="op" id="3438388">]</span><span class="op" id="3438389">)</span><span class="op" id="3438390">&lt;&lt;</span><span class="num" id="3438392">16</span>&nbsp;<span class="op" id="3438395">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3438399">uint32</span><span class="op" id="3438405">(</span><span class="ident" id="3438406">sbox0</span><span class="op" id="3438411">[</span><span class="ident" id="3438412">w</span><span class="op" id="3438413">&gt;&gt;</span><span class="num" id="3438415">8</span><span class="op" id="3438416">&amp;</span><span class="num" id="3438417">0xff</span><span class="op" id="3438421">]</span><span class="op" id="3438422">)</span><span class="op" id="3438423">&lt;&lt;</span><span class="num" id="3438425">8</span>&nbsp;<span class="op" id="3438427">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3438431">uint32</span><span class="op" id="3438437">(</span><span class="ident" id="3438438">sbox0</span><span class="op" id="3438443">[</span><span class="ident" id="3438444">w</span><span class="op" id="3438445">&amp;</span><span class="num" id="3438446">0xff</span><span class="op" id="3438450">]</span><span class="op" id="3438451">)</span><br>
<span class="lineno">135</span><span class="op" id="3438453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3438456">//&nbsp;Rotate</span><br>
<span class="lineno"></span><span class="keyword" id="3438466">func</span>&nbsp;<span class="ident" id="3438471">rotw</span><span class="op" id="3438475">(</span><span class="ident" id="3438476">w</span>&nbsp;<span class="builtintype" id="3438478">uint32</span><span class="op" id="3438484">)</span>&nbsp;<span class="builtintype" id="3438486">uint32</span>&nbsp;<span class="op" id="3438493">{</span>&nbsp;<span class="keyword" id="3438495">return</span>&nbsp;<span class="ident" id="3438502">w</span><span class="op" id="3438503">&lt;&lt;</span><span class="num" id="3438505">8</span>&nbsp;<span class="op" id="3438507">|</span>&nbsp;<span class="ident" id="3438509">w</span><span class="op" id="3438510">&gt;&gt;</span><span class="num" id="3438512">24</span>&nbsp;<span class="op" id="3438515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3438518">//&nbsp;Key&nbsp;expansion&nbsp;algorithm.&nbsp;&nbsp;See&nbsp;FIPS-197,&nbsp;Figure&nbsp;11.</span><br>
<span class="lineno"></span><span class="comment" id="3438572">//&nbsp;Their&nbsp;rcon[i]&nbsp;is&nbsp;our&nbsp;powx[i-1]&nbsp;&lt;&lt;&nbsp;24.</span><br>
<span class="lineno"></span><span class="keyword" id="3438613">func</span>&nbsp;<span class="ident" id="3438618">expandKeyGo</span><span class="op" id="3438629">(</span><span class="ident" id="3438630">key</span>&nbsp;<span class="op" id="3438634">[</span><span class="op" id="3438635">]</span><span class="builtintype" id="3438636">byte</span><span class="op" id="3438640">,</span>&nbsp;<span class="ident" id="3438642">enc</span><span class="op" id="3438645">,</span>&nbsp;<span class="ident" id="3438647">dec</span>&nbsp;<span class="op" id="3438651">[</span><span class="op" id="3438652">]</span><span class="builtintype" id="3438653">uint32</span><span class="op" id="3438659">)</span>&nbsp;<span class="op" id="3438661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3438664">//&nbsp;Encryption&nbsp;key&nbsp;setup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438690">var</span>&nbsp;<span class="ident" id="3438694">i</span>&nbsp;<span class="builtintype" id="3438696">int</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438701">nk</span>&nbsp;<span class="op" id="3438704">:=</span>&nbsp;<span class="builtinfunc" id="3438707">len</span><span class="op" id="3438710">(</span><span class="ident" id="3438711">key</span><span class="op" id="3438714">)</span>&nbsp;<span class="op" id="3438716">/</span>&nbsp;<span class="num" id="3438718">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438721">for</span>&nbsp;<span class="ident" id="3438725">i</span>&nbsp;<span class="op" id="3438727">=</span>&nbsp;<span class="num" id="3438729">0</span><span class="op" id="3438730">;</span>&nbsp;<span class="ident" id="3438732">i</span>&nbsp;<span class="op" id="3438734">&lt;</span>&nbsp;<span class="ident" id="3438736">nk</span><span class="op" id="3438738">;</span>&nbsp;<span class="ident" id="3438740">i</span><span class="op" id="3438741">++</span>&nbsp;<span class="op" id="3438744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438748">enc</span><span class="op" id="3438751">[</span><span class="ident" id="3438752">i</span><span class="op" id="3438753">]</span>&nbsp;<span class="op" id="3438755">=</span>&nbsp;<span class="builtintype" id="3438757">uint32</span><span class="op" id="3438763">(</span><span class="ident" id="3438764">key</span><span class="op" id="3438767">[</span><span class="num" id="3438768">4</span><span class="op" id="3438769">*</span><span class="ident" id="3438770">i</span><span class="op" id="3438771">]</span><span class="op" id="3438772">)</span><span class="op" id="3438773">&lt;&lt;</span><span class="num" id="3438775">24</span>&nbsp;<span class="op" id="3438778">|</span>&nbsp;<span class="builtintype" id="3438780">uint32</span><span class="op" id="3438786">(</span><span class="ident" id="3438787">key</span><span class="op" id="3438790">[</span><span class="num" id="3438791">4</span><span class="op" id="3438792">*</span><span class="ident" id="3438793">i</span><span class="op" id="3438794">+</span><span class="num" id="3438795">1</span><span class="op" id="3438796">]</span><span class="op" id="3438797">)</span><span class="op" id="3438798">&lt;&lt;</span><span class="num" id="3438800">16</span>&nbsp;<span class="op" id="3438803">|</span>&nbsp;<span class="builtintype" id="3438805">uint32</span><span class="op" id="3438811">(</span><span class="ident" id="3438812">key</span><span class="op" id="3438815">[</span><span class="num" id="3438816">4</span><span class="op" id="3438817">*</span><span class="ident" id="3438818">i</span><span class="op" id="3438819">+</span><span class="num" id="3438820">2</span><span class="op" id="3438821">]</span><span class="op" id="3438822">)</span><span class="op" id="3438823">&lt;&lt;</span><span class="num" id="3438825">8</span>&nbsp;<span class="op" id="3438827">|</span>&nbsp;<span class="builtintype" id="3438829">uint32</span><span class="op" id="3438835">(</span><span class="ident" id="3438836">key</span><span class="op" id="3438839">[</span><span class="num" id="3438840">4</span><span class="op" id="3438841">*</span><span class="ident" id="3438842">i</span><span class="op" id="3438843">+</span><span class="num" id="3438844">3</span><span class="op" id="3438845">]</span><span class="op" id="3438846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3438849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438852">for</span>&nbsp;<span class="op" id="3438856">;</span>&nbsp;<span class="ident" id="3438858">i</span>&nbsp;<span class="op" id="3438860">&lt;</span>&nbsp;<span class="builtinfunc" id="3438862">len</span><span class="op" id="3438865">(</span><span class="ident" id="3438866">enc</span><span class="op" id="3438869">)</span><span class="op" id="3438870">;</span>&nbsp;<span class="ident" id="3438872">i</span><span class="op" id="3438873">++</span>&nbsp;<span class="op" id="3438876">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438880">t</span>&nbsp;<span class="op" id="3438882">:=</span>&nbsp;<span class="ident" id="3438885">enc</span><span class="op" id="3438888">[</span><span class="ident" id="3438889">i</span><span class="op" id="3438890">-</span><span class="num" id="3438891">1</span><span class="op" id="3438892">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3438896">if</span>&nbsp;<span class="ident" id="3438899">i</span><span class="op" id="3438900">%</span><span class="ident" id="3438901">nk</span>&nbsp;<span class="op" id="3438904">==</span>&nbsp;<span class="num" id="3438907">0</span>&nbsp;<span class="op" id="3438909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3438914">t</span>&nbsp;<span class="op" id="3438916">=</span>&nbsp;<span class="ident" id="3438918">subw</span><span class="op" id="3438922">(</span><span class="ident" id="3438923">rotw</span><span class="op" id="3438927">(</span><span class="ident" id="3438928">t</span><span class="op" id="3438929">)</span><span class="op" id="3438930">)</span>&nbsp;<span class="op" id="3438932">^</span>&nbsp;<span class="op" id="3438934">(</span><span class="builtintype" id="3438935">uint32</span><span class="op" id="3438941">(</span><span class="ident" id="3438942">powx</span><span class="op" id="3438946">[</span><span class="ident" id="3438947">i</span><span class="op" id="3438948">/</span><span class="ident" id="3438949">nk</span><span class="op" id="3438951">-</span><span class="num" id="3438952">1</span><span class="op" id="3438953">]</span><span class="op" id="3438954">)</span>&nbsp;<span class="op" id="3438956">&lt;&lt;</span>&nbsp;<span class="num" id="3438959">24</span><span class="op" id="3438961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3438965">}</span>&nbsp;<span class="keyword" id="3438967">else</span>&nbsp;<span class="keyword" id="3438972">if</span>&nbsp;<span class="ident" id="3438975">nk</span>&nbsp;<span class="op" id="3438978">&gt;</span>&nbsp;<span class="num" id="3438980">6</span>&nbsp;<span class="op" id="3438982">&amp;&amp;</span>&nbsp;<span class="ident" id="3438985">i</span><span class="op" id="3438986">%</span><span class="ident" id="3438987">nk</span>&nbsp;<span class="op" id="3438990">==</span>&nbsp;<span class="num" id="3438993">4</span>&nbsp;<span class="op" id="3438995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439000">t</span>&nbsp;<span class="op" id="3439002">=</span>&nbsp;<span class="ident" id="3439004">subw</span><span class="op" id="3439008">(</span><span class="ident" id="3439009">t</span><span class="op" id="3439010">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439018">enc</span><span class="op" id="3439021">[</span><span class="ident" id="3439022">i</span><span class="op" id="3439023">]</span>&nbsp;<span class="op" id="3439025">=</span>&nbsp;<span class="ident" id="3439027">enc</span><span class="op" id="3439030">[</span><span class="ident" id="3439031">i</span><span class="op" id="3439032">-</span><span class="ident" id="3439033">nk</span><span class="op" id="3439035">]</span>&nbsp;<span class="op" id="3439037">^</span>&nbsp;<span class="ident" id="3439039">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3439046">//&nbsp;Derive&nbsp;decryption&nbsp;key&nbsp;from&nbsp;encryption&nbsp;key.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3439093">//&nbsp;Reverse&nbsp;the&nbsp;4-word&nbsp;round&nbsp;key&nbsp;sets&nbsp;from&nbsp;enc&nbsp;to&nbsp;produce&nbsp;dec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3439156">//&nbsp;All&nbsp;sets&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;get&nbsp;the&nbsp;MixColumn&nbsp;transform&nbsp;applied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439229">if</span>&nbsp;<span class="ident" id="3439232">dec</span>&nbsp;<span class="op" id="3439236">==</span>&nbsp;<span class="ident" id="3439239">nil</span>&nbsp;<span class="op" id="3439243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439247">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439255">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439258">n</span>&nbsp;<span class="op" id="3439260">:=</span>&nbsp;<span class="builtinfunc" id="3439263">len</span><span class="op" id="3439266">(</span><span class="ident" id="3439267">enc</span><span class="op" id="3439270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439273">for</span>&nbsp;<span class="ident" id="3439277">i</span>&nbsp;<span class="op" id="3439279">:=</span>&nbsp;<span class="num" id="3439282">0</span><span class="op" id="3439283">;</span>&nbsp;<span class="ident" id="3439285">i</span>&nbsp;<span class="op" id="3439287">&lt;</span>&nbsp;<span class="ident" id="3439289">n</span><span class="op" id="3439290">;</span>&nbsp;<span class="ident" id="3439292">i</span>&nbsp;<span class="op" id="3439294">+=</span>&nbsp;<span class="num" id="3439297">4</span>&nbsp;<span class="op" id="3439299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439303">ei</span>&nbsp;<span class="op" id="3439306">:=</span>&nbsp;<span class="ident" id="3439309">n</span>&nbsp;<span class="op" id="3439311">-</span>&nbsp;<span class="ident" id="3439313">i</span>&nbsp;<span class="op" id="3439315">-</span>&nbsp;<span class="num" id="3439317">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439321">for</span>&nbsp;<span class="ident" id="3439325">j</span>&nbsp;<span class="op" id="3439327">:=</span>&nbsp;<span class="num" id="3439330">0</span><span class="op" id="3439331">;</span>&nbsp;<span class="ident" id="3439333">j</span>&nbsp;<span class="op" id="3439335">&lt;</span>&nbsp;<span class="num" id="3439337">4</span><span class="op" id="3439338">;</span>&nbsp;<span class="ident" id="3439340">j</span><span class="op" id="3439341">++</span>&nbsp;<span class="op" id="3439344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439349">x</span>&nbsp;<span class="op" id="3439351">:=</span>&nbsp;<span class="ident" id="3439354">enc</span><span class="op" id="3439357">[</span><span class="ident" id="3439358">ei</span><span class="op" id="3439360">+</span><span class="ident" id="3439361">j</span><span class="op" id="3439362">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439367">if</span>&nbsp;<span class="ident" id="3439370">i</span>&nbsp;<span class="op" id="3439372">&gt;</span>&nbsp;<span class="num" id="3439374">0</span>&nbsp;<span class="op" id="3439376">&amp;&amp;</span>&nbsp;<span class="ident" id="3439379">i</span><span class="op" id="3439380">+</span><span class="num" id="3439381">4</span>&nbsp;<span class="op" id="3439383">&lt;</span>&nbsp;<span class="ident" id="3439385">n</span>&nbsp;<span class="op" id="3439387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439393">x</span>&nbsp;<span class="op" id="3439395">=</span>&nbsp;<span class="ident" id="3439397">td0</span><span class="op" id="3439400">[</span><span class="ident" id="3439401">sbox0</span><span class="op" id="3439406">[</span><span class="ident" id="3439407">x</span><span class="op" id="3439408">&gt;&gt;</span><span class="num" id="3439410">24</span><span class="op" id="3439412">]</span><span class="op" id="3439413">]</span>&nbsp;<span class="op" id="3439415">^</span>&nbsp;<span class="ident" id="3439417">td1</span><span class="op" id="3439420">[</span><span class="ident" id="3439421">sbox0</span><span class="op" id="3439426">[</span><span class="ident" id="3439427">x</span><span class="op" id="3439428">&gt;&gt;</span><span class="num" id="3439430">16</span><span class="op" id="3439432">&amp;</span><span class="num" id="3439433">0xff</span><span class="op" id="3439437">]</span><span class="op" id="3439438">]</span>&nbsp;<span class="op" id="3439440">^</span>&nbsp;<span class="ident" id="3439442">td2</span><span class="op" id="3439445">[</span><span class="ident" id="3439446">sbox0</span><span class="op" id="3439451">[</span><span class="ident" id="3439452">x</span><span class="op" id="3439453">&gt;&gt;</span><span class="num" id="3439455">8</span><span class="op" id="3439456">&amp;</span><span class="num" id="3439457">0xff</span><span class="op" id="3439461">]</span><span class="op" id="3439462">]</span>&nbsp;<span class="op" id="3439464">^</span>&nbsp;<span class="ident" id="3439466">td3</span><span class="op" id="3439469">[</span><span class="ident" id="3439470">sbox0</span><span class="op" id="3439475">[</span><span class="ident" id="3439476">x</span><span class="op" id="3439477">&amp;</span><span class="num" id="3439478">0xff</span><span class="op" id="3439482">]</span><span class="op" id="3439483">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439493">dec</span><span class="op" id="3439496">[</span><span class="ident" id="3439497">i</span><span class="op" id="3439498">+</span><span class="ident" id="3439499">j</span><span class="op" id="3439500">]</span>&nbsp;<span class="op" id="3439502">=</span>&nbsp;<span class="ident" id="3439504">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439508">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3439511">}</span><br>
<span class="lineno"></span><span class="op" id="3439513">}</span>
</div>
</body>
</html>
