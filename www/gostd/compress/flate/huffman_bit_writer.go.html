<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html" class="current">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5010806">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5010861">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5010915">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5010966">package</span>&nbsp;<span class="ident" id="5010974">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5010981">import</span>&nbsp;<span class="op" id="5010988">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5010991">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5010997">&#34;math&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5011004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5011007">const</span>&nbsp;<span class="op" id="5011013">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011016">//&nbsp;The&nbsp;largest&nbsp;offset&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011045">offsetCodeCount</span>&nbsp;<span class="op" id="5011061">=</span>&nbsp;<span class="num" id="5011063">30</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011068">//&nbsp;The&nbsp;special&nbsp;code&nbsp;used&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011122">endBlockMarker</span>&nbsp;<span class="op" id="5011137">=</span>&nbsp;<span class="num" id="5011139">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011145">//&nbsp;The&nbsp;first&nbsp;length&nbsp;code.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011172">lengthCodesStart</span>&nbsp;<span class="op" id="5011189">=</span>&nbsp;<span class="num" id="5011191">257</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011197">//&nbsp;The&nbsp;number&nbsp;of&nbsp;codegen&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011230">codegenCodeCount</span>&nbsp;<span class="op" id="5011247">=</span>&nbsp;<span class="num" id="5011249">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011253">badCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011270">=</span>&nbsp;<span class="num" id="5011272">255</span><br>
<span class="lineno">25</span><span class="op" id="5011276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5011279">//&nbsp;The&nbsp;number&nbsp;of&nbsp;extra&nbsp;bits&nbsp;needed&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="5011353">var</span>&nbsp;<span class="ident" id="5011357">lengthExtraBits</span>&nbsp;<span class="op" id="5011373">=</span>&nbsp;<span class="op" id="5011375">[</span><span class="op" id="5011376">]</span><span class="builtintype" id="5011377">int8</span><span class="op" id="5011381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011384">/*&nbsp;257&nbsp;*/</span>&nbsp;<span class="num" id="5011394">0</span><span class="op" id="5011395">,</span>&nbsp;<span class="num" id="5011397">0</span><span class="op" id="5011398">,</span>&nbsp;<span class="num" id="5011400">0</span><span class="op" id="5011401">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011404">/*&nbsp;260&nbsp;*/</span>&nbsp;<span class="num" id="5011414">0</span><span class="op" id="5011415">,</span>&nbsp;<span class="num" id="5011417">0</span><span class="op" id="5011418">,</span>&nbsp;<span class="num" id="5011420">0</span><span class="op" id="5011421">,</span>&nbsp;<span class="num" id="5011423">0</span><span class="op" id="5011424">,</span>&nbsp;<span class="num" id="5011426">0</span><span class="op" id="5011427">,</span>&nbsp;<span class="num" id="5011429">1</span><span class="op" id="5011430">,</span>&nbsp;<span class="num" id="5011432">1</span><span class="op" id="5011433">,</span>&nbsp;<span class="num" id="5011435">1</span><span class="op" id="5011436">,</span>&nbsp;<span class="num" id="5011438">1</span><span class="op" id="5011439">,</span>&nbsp;<span class="num" id="5011441">2</span><span class="op" id="5011442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011445">/*&nbsp;270&nbsp;*/</span>&nbsp;<span class="num" id="5011455">2</span><span class="op" id="5011456">,</span>&nbsp;<span class="num" id="5011458">2</span><span class="op" id="5011459">,</span>&nbsp;<span class="num" id="5011461">2</span><span class="op" id="5011462">,</span>&nbsp;<span class="num" id="5011464">3</span><span class="op" id="5011465">,</span>&nbsp;<span class="num" id="5011467">3</span><span class="op" id="5011468">,</span>&nbsp;<span class="num" id="5011470">3</span><span class="op" id="5011471">,</span>&nbsp;<span class="num" id="5011473">3</span><span class="op" id="5011474">,</span>&nbsp;<span class="num" id="5011476">4</span><span class="op" id="5011477">,</span>&nbsp;<span class="num" id="5011479">4</span><span class="op" id="5011480">,</span>&nbsp;<span class="num" id="5011482">4</span><span class="op" id="5011483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011486">/*&nbsp;280&nbsp;*/</span>&nbsp;<span class="num" id="5011496">4</span><span class="op" id="5011497">,</span>&nbsp;<span class="num" id="5011499">5</span><span class="op" id="5011500">,</span>&nbsp;<span class="num" id="5011502">5</span><span class="op" id="5011503">,</span>&nbsp;<span class="num" id="5011505">5</span><span class="op" id="5011506">,</span>&nbsp;<span class="num" id="5011508">5</span><span class="op" id="5011509">,</span>&nbsp;<span class="num" id="5011511">0</span><span class="op" id="5011512">,</span><br>
<span class="lineno"></span><span class="op" id="5011514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5011517">//&nbsp;The&nbsp;length&nbsp;indicated&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="5011580">var</span>&nbsp;<span class="ident" id="5011584">lengthBase</span>&nbsp;<span class="op" id="5011595">=</span>&nbsp;<span class="op" id="5011597">[</span><span class="op" id="5011598">]</span><span class="builtintype" id="5011599">uint32</span><span class="op" id="5011605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5011608">0</span><span class="op" id="5011609">,</span>&nbsp;<span class="num" id="5011611">1</span><span class="op" id="5011612">,</span>&nbsp;<span class="num" id="5011614">2</span><span class="op" id="5011615">,</span>&nbsp;<span class="num" id="5011617">3</span><span class="op" id="5011618">,</span>&nbsp;<span class="num" id="5011620">4</span><span class="op" id="5011621">,</span>&nbsp;<span class="num" id="5011623">5</span><span class="op" id="5011624">,</span>&nbsp;<span class="num" id="5011626">6</span><span class="op" id="5011627">,</span>&nbsp;<span class="num" id="5011629">7</span><span class="op" id="5011630">,</span>&nbsp;<span class="num" id="5011632">8</span><span class="op" id="5011633">,</span>&nbsp;<span class="num" id="5011635">10</span><span class="op" id="5011637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5011640">12</span><span class="op" id="5011642">,</span>&nbsp;<span class="num" id="5011644">14</span><span class="op" id="5011646">,</span>&nbsp;<span class="num" id="5011648">16</span><span class="op" id="5011650">,</span>&nbsp;<span class="num" id="5011652">20</span><span class="op" id="5011654">,</span>&nbsp;<span class="num" id="5011656">24</span><span class="op" id="5011658">,</span>&nbsp;<span class="num" id="5011660">28</span><span class="op" id="5011662">,</span>&nbsp;<span class="num" id="5011664">32</span><span class="op" id="5011666">,</span>&nbsp;<span class="num" id="5011668">40</span><span class="op" id="5011670">,</span>&nbsp;<span class="num" id="5011672">48</span><span class="op" id="5011674">,</span>&nbsp;<span class="num" id="5011676">56</span><span class="op" id="5011678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5011681">64</span><span class="op" id="5011683">,</span>&nbsp;<span class="num" id="5011685">80</span><span class="op" id="5011687">,</span>&nbsp;<span class="num" id="5011689">96</span><span class="op" id="5011691">,</span>&nbsp;<span class="num" id="5011693">112</span><span class="op" id="5011696">,</span>&nbsp;<span class="num" id="5011698">128</span><span class="op" id="5011701">,</span>&nbsp;<span class="num" id="5011703">160</span><span class="op" id="5011706">,</span>&nbsp;<span class="num" id="5011708">192</span><span class="op" id="5011711">,</span>&nbsp;<span class="num" id="5011713">224</span><span class="op" id="5011716">,</span>&nbsp;<span class="num" id="5011718">255</span><span class="op" id="5011721">,</span><br>
<span class="lineno">40</span><span class="op" id="5011723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5011726">//&nbsp;offset&nbsp;code&nbsp;word&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5011758">var</span>&nbsp;<span class="ident" id="5011762">offsetExtraBits</span>&nbsp;<span class="op" id="5011778">=</span>&nbsp;<span class="op" id="5011780">[</span><span class="op" id="5011781">]</span><span class="builtintype" id="5011782">int8</span><span class="op" id="5011786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5011789">0</span><span class="op" id="5011790">,</span>&nbsp;<span class="num" id="5011792">0</span><span class="op" id="5011793">,</span>&nbsp;<span class="num" id="5011795">0</span><span class="op" id="5011796">,</span>&nbsp;<span class="num" id="5011798">0</span><span class="op" id="5011799">,</span>&nbsp;<span class="num" id="5011801">1</span><span class="op" id="5011802">,</span>&nbsp;<span class="num" id="5011804">1</span><span class="op" id="5011805">,</span>&nbsp;<span class="num" id="5011807">2</span><span class="op" id="5011808">,</span>&nbsp;<span class="num" id="5011810">2</span><span class="op" id="5011811">,</span>&nbsp;<span class="num" id="5011813">3</span><span class="op" id="5011814">,</span>&nbsp;<span class="num" id="5011816">3</span><span class="op" id="5011817">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5011820">4</span><span class="op" id="5011821">,</span>&nbsp;<span class="num" id="5011823">4</span><span class="op" id="5011824">,</span>&nbsp;<span class="num" id="5011826">5</span><span class="op" id="5011827">,</span>&nbsp;<span class="num" id="5011829">5</span><span class="op" id="5011830">,</span>&nbsp;<span class="num" id="5011832">6</span><span class="op" id="5011833">,</span>&nbsp;<span class="num" id="5011835">6</span><span class="op" id="5011836">,</span>&nbsp;<span class="num" id="5011838">7</span><span class="op" id="5011839">,</span>&nbsp;<span class="num" id="5011841">7</span><span class="op" id="5011842">,</span>&nbsp;<span class="num" id="5011844">8</span><span class="op" id="5011845">,</span>&nbsp;<span class="num" id="5011847">8</span><span class="op" id="5011848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5011851">9</span><span class="op" id="5011852">,</span>&nbsp;<span class="num" id="5011854">9</span><span class="op" id="5011855">,</span>&nbsp;<span class="num" id="5011857">10</span><span class="op" id="5011859">,</span>&nbsp;<span class="num" id="5011861">10</span><span class="op" id="5011863">,</span>&nbsp;<span class="num" id="5011865">11</span><span class="op" id="5011867">,</span>&nbsp;<span class="num" id="5011869">11</span><span class="op" id="5011871">,</span>&nbsp;<span class="num" id="5011873">12</span><span class="op" id="5011875">,</span>&nbsp;<span class="num" id="5011877">12</span><span class="op" id="5011879">,</span>&nbsp;<span class="num" id="5011881">13</span><span class="op" id="5011883">,</span>&nbsp;<span class="num" id="5011885">13</span><span class="op" id="5011887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011890">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5011913">14</span><span class="op" id="5011915">,</span>&nbsp;<span class="num" id="5011917">14</span><span class="op" id="5011919">,</span>&nbsp;<span class="num" id="5011921">15</span><span class="op" id="5011923">,</span>&nbsp;<span class="num" id="5011925">15</span><span class="op" id="5011927">,</span>&nbsp;<span class="num" id="5011929">16</span><span class="op" id="5011931">,</span>&nbsp;<span class="num" id="5011933">16</span><span class="op" id="5011935">,</span>&nbsp;<span class="num" id="5011937">17</span><span class="op" id="5011939">,</span>&nbsp;<span class="num" id="5011941">17</span><span class="op" id="5011943">,</span>&nbsp;<span class="num" id="5011945">18</span><span class="op" id="5011947">,</span>&nbsp;<span class="num" id="5011949">18</span><span class="op" id="5011951">,</span>&nbsp;<span class="num" id="5011953">19</span><span class="op" id="5011955">,</span>&nbsp;<span class="num" id="5011957">19</span><span class="op" id="5011959">,</span>&nbsp;<span class="num" id="5011961">20</span><span class="op" id="5011963">,</span>&nbsp;<span class="num" id="5011965">20</span><span class="op" id="5011967">,</span><br>
<span class="lineno"></span><span class="op" id="5011969">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5011972">var</span>&nbsp;<span class="ident" id="5011976">offsetBase</span>&nbsp;<span class="op" id="5011987">=</span>&nbsp;<span class="op" id="5011989">[</span><span class="op" id="5011990">]</span><span class="builtintype" id="5011991">uint32</span><span class="op" id="5011997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012000">/*&nbsp;normal&nbsp;deflate&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5012022">0x000000</span><span class="op" id="5012030">,</span>&nbsp;<span class="num" id="5012032">0x000001</span><span class="op" id="5012040">,</span>&nbsp;<span class="num" id="5012042">0x000002</span><span class="op" id="5012050">,</span>&nbsp;<span class="num" id="5012052">0x000003</span><span class="op" id="5012060">,</span>&nbsp;<span class="num" id="5012062">0x000004</span><span class="op" id="5012070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5012073">0x000006</span><span class="op" id="5012081">,</span>&nbsp;<span class="num" id="5012083">0x000008</span><span class="op" id="5012091">,</span>&nbsp;<span class="num" id="5012093">0x00000c</span><span class="op" id="5012101">,</span>&nbsp;<span class="num" id="5012103">0x000010</span><span class="op" id="5012111">,</span>&nbsp;<span class="num" id="5012113">0x000018</span><span class="op" id="5012121">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5012124">0x000020</span><span class="op" id="5012132">,</span>&nbsp;<span class="num" id="5012134">0x000030</span><span class="op" id="5012142">,</span>&nbsp;<span class="num" id="5012144">0x000040</span><span class="op" id="5012152">,</span>&nbsp;<span class="num" id="5012154">0x000060</span><span class="op" id="5012162">,</span>&nbsp;<span class="num" id="5012164">0x000080</span><span class="op" id="5012172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5012175">0x0000c0</span><span class="op" id="5012183">,</span>&nbsp;<span class="num" id="5012185">0x000100</span><span class="op" id="5012193">,</span>&nbsp;<span class="num" id="5012195">0x000180</span><span class="op" id="5012203">,</span>&nbsp;<span class="num" id="5012205">0x000200</span><span class="op" id="5012213">,</span>&nbsp;<span class="num" id="5012215">0x000300</span><span class="op" id="5012223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5012226">0x000400</span><span class="op" id="5012234">,</span>&nbsp;<span class="num" id="5012236">0x000600</span><span class="op" id="5012244">,</span>&nbsp;<span class="num" id="5012246">0x000800</span><span class="op" id="5012254">,</span>&nbsp;<span class="num" id="5012256">0x000c00</span><span class="op" id="5012264">,</span>&nbsp;<span class="num" id="5012266">0x001000</span><span class="op" id="5012274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5012277">0x001800</span><span class="op" id="5012285">,</span>&nbsp;<span class="num" id="5012287">0x002000</span><span class="op" id="5012295">,</span>&nbsp;<span class="num" id="5012297">0x003000</span><span class="op" id="5012305">,</span>&nbsp;<span class="num" id="5012307">0x004000</span><span class="op" id="5012315">,</span>&nbsp;<span class="num" id="5012317">0x006000</span><span class="op" id="5012325">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012329">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5012352">0x008000</span><span class="op" id="5012360">,</span>&nbsp;<span class="num" id="5012362">0x00c000</span><span class="op" id="5012370">,</span>&nbsp;<span class="num" id="5012372">0x010000</span><span class="op" id="5012380">,</span>&nbsp;<span class="num" id="5012382">0x018000</span><span class="op" id="5012390">,</span>&nbsp;<span class="num" id="5012392">0x020000</span><span class="op" id="5012400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5012403">0x030000</span><span class="op" id="5012411">,</span>&nbsp;<span class="num" id="5012413">0x040000</span><span class="op" id="5012421">,</span>&nbsp;<span class="num" id="5012423">0x060000</span><span class="op" id="5012431">,</span>&nbsp;<span class="num" id="5012433">0x080000</span><span class="op" id="5012441">,</span>&nbsp;<span class="num" id="5012443">0x0c0000</span><span class="op" id="5012451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5012454">0x100000</span><span class="op" id="5012462">,</span>&nbsp;<span class="num" id="5012464">0x180000</span><span class="op" id="5012472">,</span>&nbsp;<span class="num" id="5012474">0x200000</span><span class="op" id="5012482">,</span>&nbsp;<span class="num" id="5012484">0x300000</span><span class="op" id="5012492">,</span><br>
<span class="lineno"></span><span class="op" id="5012494">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5012497">//&nbsp;The&nbsp;odd&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;codegen&nbsp;code&nbsp;sizes&nbsp;are&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="5012559">var</span>&nbsp;<span class="ident" id="5012563">codegenOrder</span>&nbsp;<span class="op" id="5012576">=</span>&nbsp;<span class="op" id="5012578">[</span><span class="op" id="5012579">]</span><span class="builtintype" id="5012580">uint32</span><span class="op" id="5012586">{</span><span class="num" id="5012587">16</span><span class="op" id="5012589">,</span>&nbsp;<span class="num" id="5012591">17</span><span class="op" id="5012593">,</span>&nbsp;<span class="num" id="5012595">18</span><span class="op" id="5012597">,</span>&nbsp;<span class="num" id="5012599">0</span><span class="op" id="5012600">,</span>&nbsp;<span class="num" id="5012602">8</span><span class="op" id="5012603">,</span>&nbsp;<span class="num" id="5012605">7</span><span class="op" id="5012606">,</span>&nbsp;<span class="num" id="5012608">9</span><span class="op" id="5012609">,</span>&nbsp;<span class="num" id="5012611">6</span><span class="op" id="5012612">,</span>&nbsp;<span class="num" id="5012614">10</span><span class="op" id="5012616">,</span>&nbsp;<span class="num" id="5012618">5</span><span class="op" id="5012619">,</span>&nbsp;<span class="num" id="5012621">11</span><span class="op" id="5012623">,</span>&nbsp;<span class="num" id="5012625">4</span><span class="op" id="5012626">,</span>&nbsp;<span class="num" id="5012628">12</span><span class="op" id="5012630">,</span>&nbsp;<span class="num" id="5012632">3</span><span class="op" id="5012633">,</span>&nbsp;<span class="num" id="5012635">13</span><span class="op" id="5012637">,</span>&nbsp;<span class="num" id="5012639">2</span><span class="op" id="5012640">,</span>&nbsp;<span class="num" id="5012642">14</span><span class="op" id="5012644">,</span>&nbsp;<span class="num" id="5012646">1</span><span class="op" id="5012647">,</span>&nbsp;<span class="num" id="5012649">15</span><span class="op" id="5012651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5012654">type</span>&nbsp;<span class="ident" id="5012659">huffmanBitWriter</span>&nbsp;<span class="keyword" id="5012676">struct</span>&nbsp;<span class="op" id="5012683">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012686">w</span>&nbsp;<span class="ident" id="5012688">io</span><span class="op" id="5012690">.</span><span class="ident" id="5012691">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012699">//&nbsp;Data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;written&nbsp;is&nbsp;bytes[0:nbytes]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012749">//&nbsp;and&nbsp;then&nbsp;the&nbsp;low&nbsp;nbits&nbsp;of&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012785">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5012801">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012809">nbits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5012825">uint32</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012833">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5012849">[</span><span class="num" id="5012850">64</span><span class="op" id="5012852">]</span><span class="builtintype" id="5012853">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012859">nbytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5012875">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012880">literalFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5012896">[</span><span class="op" id="5012897">]</span><span class="builtintype" id="5012898">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012905">offsetFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5012921">[</span><span class="op" id="5012922">]</span><span class="builtintype" id="5012923">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012930">codegen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5012946">[</span><span class="op" id="5012947">]</span><span class="builtintype" id="5012948">uint8</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012955">codegenFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5012971">[</span><span class="op" id="5012972">]</span><span class="builtintype" id="5012973">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012980">literalEncoding</span>&nbsp;<span class="op" id="5012996">*</span><span class="ident" id="5012997">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013013">offsetEncoding</span>&nbsp;&nbsp;<span class="op" id="5013029">*</span><span class="ident" id="5013030">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013046">codegenEncoding</span>&nbsp;<span class="op" id="5013062">*</span><span class="ident" id="5013063">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013079">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5013095">error</span><br>
<span class="lineno">85</span><span class="op" id="5013101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5013104">func</span>&nbsp;<span class="ident" id="5013109">newHuffmanBitWriter</span><span class="op" id="5013128">(</span><span class="ident" id="5013129">w</span>&nbsp;<span class="ident" id="5013131">io</span><span class="op" id="5013133">.</span><span class="ident" id="5013134">Writer</span><span class="op" id="5013140">)</span>&nbsp;<span class="op" id="5013142">*</span><span class="ident" id="5013143">huffmanBitWriter</span>&nbsp;<span class="op" id="5013160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013163">return</span>&nbsp;<span class="op" id="5013170">&amp;</span><span class="ident" id="5013171">huffmanBitWriter</span><span class="op" id="5013187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013191">w</span><span class="op" id="5013192">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013208">w</span><span class="op" id="5013209">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013213">literalFreq</span><span class="op" id="5013224">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5013230">make</span><span class="op" id="5013234">(</span><span class="op" id="5013235">[</span><span class="op" id="5013236">]</span><span class="builtintype" id="5013237">int32</span><span class="op" id="5013242">,</span>&nbsp;<span class="ident" id="5013244">maxLit</span><span class="op" id="5013250">)</span><span class="op" id="5013251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013255">offsetFreq</span><span class="op" id="5013265">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5013272">make</span><span class="op" id="5013276">(</span><span class="op" id="5013277">[</span><span class="op" id="5013278">]</span><span class="builtintype" id="5013279">int32</span><span class="op" id="5013284">,</span>&nbsp;<span class="ident" id="5013286">offsetCodeCount</span><span class="op" id="5013301">)</span><span class="op" id="5013302">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013306">codegen</span><span class="op" id="5013313">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5013323">make</span><span class="op" id="5013327">(</span><span class="op" id="5013328">[</span><span class="op" id="5013329">]</span><span class="builtintype" id="5013330">uint8</span><span class="op" id="5013335">,</span>&nbsp;<span class="ident" id="5013337">maxLit</span><span class="op" id="5013343">+</span><span class="ident" id="5013344">offsetCodeCount</span><span class="op" id="5013359">+</span><span class="num" id="5013360">1</span><span class="op" id="5013361">)</span><span class="op" id="5013362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013366">codegenFreq</span><span class="op" id="5013377">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5013383">make</span><span class="op" id="5013387">(</span><span class="op" id="5013388">[</span><span class="op" id="5013389">]</span><span class="builtintype" id="5013390">int32</span><span class="op" id="5013395">,</span>&nbsp;<span class="ident" id="5013397">codegenCodeCount</span><span class="op" id="5013413">)</span><span class="op" id="5013414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013418">literalEncoding</span><span class="op" id="5013433">:</span>&nbsp;<span class="ident" id="5013435">newHuffmanEncoder</span><span class="op" id="5013452">(</span><span class="ident" id="5013453">maxLit</span><span class="op" id="5013459">)</span><span class="op" id="5013460">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013464">offsetEncoding</span><span class="op" id="5013478">:</span>&nbsp;&nbsp;<span class="ident" id="5013481">newHuffmanEncoder</span><span class="op" id="5013498">(</span><span class="ident" id="5013499">offsetCodeCount</span><span class="op" id="5013514">)</span><span class="op" id="5013515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013519">codegenEncoding</span><span class="op" id="5013534">:</span>&nbsp;<span class="ident" id="5013536">newHuffmanEncoder</span><span class="op" id="5013553">(</span><span class="ident" id="5013554">codegenCodeCount</span><span class="op" id="5013570">)</span><span class="op" id="5013571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013574">}</span><br>
<span class="lineno"></span><span class="op" id="5013576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5013579">func</span>&nbsp;<span class="op" id="5013584">(</span><span class="ident" id="5013585">w</span>&nbsp;<span class="op" id="5013587">*</span><span class="ident" id="5013588">huffmanBitWriter</span><span class="op" id="5013604">)</span>&nbsp;<span class="ident" id="5013606">reset</span><span class="op" id="5013611">(</span><span class="ident" id="5013612">writer</span>&nbsp;<span class="ident" id="5013619">io</span><span class="op" id="5013621">.</span><span class="ident" id="5013622">Writer</span><span class="op" id="5013628">)</span>&nbsp;<span class="op" id="5013630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013633">w</span><span class="op" id="5013634">.</span><span class="ident" id="5013635">w</span>&nbsp;<span class="op" id="5013637">=</span>&nbsp;<span class="ident" id="5013639">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013647">w</span><span class="op" id="5013648">.</span><span class="ident" id="5013649">bits</span><span class="op" id="5013653">,</span>&nbsp;<span class="ident" id="5013655">w</span><span class="op" id="5013656">.</span><span class="ident" id="5013657">nbits</span><span class="op" id="5013662">,</span>&nbsp;<span class="ident" id="5013664">w</span><span class="op" id="5013665">.</span><span class="ident" id="5013666">nbytes</span><span class="op" id="5013672">,</span>&nbsp;<span class="ident" id="5013674">w</span><span class="op" id="5013675">.</span><span class="ident" id="5013676">err</span>&nbsp;<span class="op" id="5013680">=</span>&nbsp;<span class="num" id="5013682">0</span><span class="op" id="5013683">,</span>&nbsp;<span class="num" id="5013685">0</span><span class="op" id="5013686">,</span>&nbsp;<span class="num" id="5013688">0</span><span class="op" id="5013689">,</span>&nbsp;<span class="ident" id="5013691">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013696">w</span><span class="op" id="5013697">.</span><span class="ident" id="5013698">bytes</span>&nbsp;<span class="op" id="5013704">=</span>&nbsp;<span class="op" id="5013706">[</span><span class="num" id="5013707">64</span><span class="op" id="5013709">]</span><span class="builtintype" id="5013710">byte</span><span class="op" id="5013714">{</span><span class="op" id="5013715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013718">for</span>&nbsp;<span class="ident" id="5013722">i</span>&nbsp;<span class="op" id="5013724">:=</span>&nbsp;<span class="keyword" id="5013727">range</span>&nbsp;<span class="ident" id="5013733">w</span><span class="op" id="5013734">.</span><span class="ident" id="5013735">codegen</span>&nbsp;<span class="op" id="5013743">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013747">w</span><span class="op" id="5013748">.</span><span class="ident" id="5013749">codegen</span><span class="op" id="5013756">[</span><span class="ident" id="5013757">i</span><span class="op" id="5013758">]</span>&nbsp;<span class="op" id="5013760">=</span>&nbsp;<span class="num" id="5013762">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013768">for</span>&nbsp;<span class="ident" id="5013772">_</span><span class="op" id="5013773">,</span>&nbsp;<span class="ident" id="5013775">s</span>&nbsp;<span class="op" id="5013777">:=</span>&nbsp;<span class="keyword" id="5013780">range</span>&nbsp;<span class="op" id="5013786">[</span><span class="op" id="5013787">...</span><span class="op" id="5013790">]</span><span class="op" id="5013791">[</span><span class="op" id="5013792">]</span><span class="builtintype" id="5013793">int32</span><span class="op" id="5013798">{</span><span class="ident" id="5013799">w</span><span class="op" id="5013800">.</span><span class="ident" id="5013801">literalFreq</span><span class="op" id="5013812">,</span>&nbsp;<span class="ident" id="5013814">w</span><span class="op" id="5013815">.</span><span class="ident" id="5013816">offsetFreq</span><span class="op" id="5013826">,</span>&nbsp;<span class="ident" id="5013828">w</span><span class="op" id="5013829">.</span><span class="ident" id="5013830">codegenFreq</span><span class="op" id="5013841">}</span>&nbsp;<span class="op" id="5013843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013847">for</span>&nbsp;<span class="ident" id="5013851">i</span>&nbsp;<span class="op" id="5013853">:=</span>&nbsp;<span class="keyword" id="5013856">range</span>&nbsp;<span class="ident" id="5013862">s</span>&nbsp;<span class="op" id="5013864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013869">s</span><span class="op" id="5013870">[</span><span class="ident" id="5013871">i</span><span class="op" id="5013872">]</span>&nbsp;<span class="op" id="5013874">=</span>&nbsp;<span class="num" id="5013876">0</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013886">for</span>&nbsp;<span class="ident" id="5013890">_</span><span class="op" id="5013891">,</span>&nbsp;<span class="ident" id="5013893">enc</span>&nbsp;<span class="op" id="5013897">:=</span>&nbsp;<span class="keyword" id="5013900">range</span>&nbsp;<span class="op" id="5013906">[</span><span class="op" id="5013907">...</span><span class="op" id="5013910">]</span><span class="op" id="5013911">*</span><span class="ident" id="5013912">huffmanEncoder</span><span class="op" id="5013926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013930">w</span><span class="op" id="5013931">.</span><span class="ident" id="5013932">literalEncoding</span><span class="op" id="5013947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013951">w</span><span class="op" id="5013952">.</span><span class="ident" id="5013953">offsetEncoding</span><span class="op" id="5013967">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013971">w</span><span class="op" id="5013972">.</span><span class="ident" id="5013973">codegenEncoding</span><span class="op" id="5013988">}</span>&nbsp;<span class="op" id="5013990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013994">for</span>&nbsp;<span class="ident" id="5013998">i</span>&nbsp;<span class="op" id="5014000">:=</span>&nbsp;<span class="keyword" id="5014003">range</span>&nbsp;<span class="ident" id="5014009">enc</span><span class="op" id="5014012">.</span><span class="ident" id="5014013">code</span>&nbsp;<span class="op" id="5014018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014023">enc</span><span class="op" id="5014026">.</span><span class="ident" id="5014027">code</span><span class="op" id="5014031">[</span><span class="ident" id="5014032">i</span><span class="op" id="5014033">]</span>&nbsp;<span class="op" id="5014035">=</span>&nbsp;<span class="num" id="5014037">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014045">for</span>&nbsp;<span class="ident" id="5014049">i</span>&nbsp;<span class="op" id="5014051">:=</span>&nbsp;<span class="keyword" id="5014054">range</span>&nbsp;<span class="ident" id="5014060">enc</span><span class="op" id="5014063">.</span><span class="ident" id="5014064">codeBits</span>&nbsp;<span class="op" id="5014073">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014078">enc</span><span class="op" id="5014081">.</span><span class="ident" id="5014082">codeBits</span><span class="op" id="5014090">[</span><span class="ident" id="5014091">i</span><span class="op" id="5014092">]</span>&nbsp;<span class="op" id="5014094">=</span>&nbsp;<span class="num" id="5014096">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014103">}</span><br>
<span class="lineno"></span><span class="op" id="5014105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5014108">func</span>&nbsp;<span class="op" id="5014113">(</span><span class="ident" id="5014114">w</span>&nbsp;<span class="op" id="5014116">*</span><span class="ident" id="5014117">huffmanBitWriter</span><span class="op" id="5014133">)</span>&nbsp;<span class="ident" id="5014135">flushBits</span><span class="op" id="5014144">(</span><span class="op" id="5014145">)</span>&nbsp;<span class="op" id="5014147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014150">if</span>&nbsp;<span class="ident" id="5014153">w</span><span class="op" id="5014154">.</span><span class="ident" id="5014155">err</span>&nbsp;<span class="op" id="5014159">!=</span>&nbsp;<span class="ident" id="5014162">nil</span>&nbsp;<span class="op" id="5014166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014170">w</span><span class="op" id="5014171">.</span><span class="ident" id="5014172">nbits</span>&nbsp;<span class="op" id="5014178">=</span>&nbsp;<span class="num" id="5014180">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014184">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014192">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014195">bits</span>&nbsp;<span class="op" id="5014200">:=</span>&nbsp;<span class="ident" id="5014203">w</span><span class="op" id="5014204">.</span><span class="ident" id="5014205">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014211">w</span><span class="op" id="5014212">.</span><span class="ident" id="5014213">bits</span>&nbsp;<span class="op" id="5014218">&gt;&gt;=</span>&nbsp;<span class="num" id="5014222">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014226">w</span><span class="op" id="5014227">.</span><span class="ident" id="5014228">nbits</span>&nbsp;<span class="op" id="5014234">-=</span>&nbsp;<span class="num" id="5014237">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014241">n</span>&nbsp;<span class="op" id="5014243">:=</span>&nbsp;<span class="ident" id="5014246">w</span><span class="op" id="5014247">.</span><span class="ident" id="5014248">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014256">w</span><span class="op" id="5014257">.</span><span class="ident" id="5014258">bytes</span><span class="op" id="5014263">[</span><span class="ident" id="5014264">n</span><span class="op" id="5014265">]</span>&nbsp;<span class="op" id="5014267">=</span>&nbsp;<span class="builtintype" id="5014269">byte</span><span class="op" id="5014273">(</span><span class="ident" id="5014274">bits</span><span class="op" id="5014278">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014281">w</span><span class="op" id="5014282">.</span><span class="ident" id="5014283">bytes</span><span class="op" id="5014288">[</span><span class="ident" id="5014289">n</span><span class="op" id="5014290">+</span><span class="num" id="5014291">1</span><span class="op" id="5014292">]</span>&nbsp;<span class="op" id="5014294">=</span>&nbsp;<span class="builtintype" id="5014296">byte</span><span class="op" id="5014300">(</span><span class="ident" id="5014301">bits</span>&nbsp;<span class="op" id="5014306">&gt;&gt;</span>&nbsp;<span class="num" id="5014309">8</span><span class="op" id="5014310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014313">if</span>&nbsp;<span class="ident" id="5014316">n</span>&nbsp;<span class="op" id="5014318">+=</span>&nbsp;<span class="num" id="5014321">2</span><span class="op" id="5014322">;</span>&nbsp;<span class="ident" id="5014324">n</span>&nbsp;<span class="op" id="5014326">&gt;=</span>&nbsp;<span class="builtinfunc" id="5014329">len</span><span class="op" id="5014332">(</span><span class="ident" id="5014333">w</span><span class="op" id="5014334">.</span><span class="ident" id="5014335">bytes</span><span class="op" id="5014340">)</span>&nbsp;<span class="op" id="5014342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014346">_</span><span class="op" id="5014347">,</span>&nbsp;<span class="ident" id="5014349">w</span><span class="op" id="5014350">.</span><span class="ident" id="5014351">err</span>&nbsp;<span class="op" id="5014355">=</span>&nbsp;<span class="ident" id="5014357">w</span><span class="op" id="5014358">.</span><span class="ident" id="5014359">w</span><span class="op" id="5014360">.</span><span class="ident" id="5014361">Write</span><span class="op" id="5014366">(</span><span class="ident" id="5014367">w</span><span class="op" id="5014368">.</span><span class="ident" id="5014369">bytes</span><span class="op" id="5014374">[</span><span class="num" id="5014375">0</span><span class="op" id="5014376">:</span><span class="op" id="5014377">]</span><span class="op" id="5014378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014382">n</span>&nbsp;<span class="op" id="5014384">=</span>&nbsp;<span class="num" id="5014386">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014389">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014392">w</span><span class="op" id="5014393">.</span><span class="ident" id="5014394">nbytes</span>&nbsp;<span class="op" id="5014401">=</span>&nbsp;<span class="ident" id="5014403">n</span><br>
<span class="lineno"></span><span class="op" id="5014405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5014408">func</span>&nbsp;<span class="op" id="5014413">(</span><span class="ident" id="5014414">w</span>&nbsp;<span class="op" id="5014416">*</span><span class="ident" id="5014417">huffmanBitWriter</span><span class="op" id="5014433">)</span>&nbsp;<span class="ident" id="5014435">flush</span><span class="op" id="5014440">(</span><span class="op" id="5014441">)</span>&nbsp;<span class="op" id="5014443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014446">if</span>&nbsp;<span class="ident" id="5014449">w</span><span class="op" id="5014450">.</span><span class="ident" id="5014451">err</span>&nbsp;<span class="op" id="5014455">!=</span>&nbsp;<span class="ident" id="5014458">nil</span>&nbsp;<span class="op" id="5014462">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014466">w</span><span class="op" id="5014467">.</span><span class="ident" id="5014468">nbits</span>&nbsp;<span class="op" id="5014474">=</span>&nbsp;<span class="num" id="5014476">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014480">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014491">n</span>&nbsp;<span class="op" id="5014493">:=</span>&nbsp;<span class="ident" id="5014496">w</span><span class="op" id="5014497">.</span><span class="ident" id="5014498">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014506">if</span>&nbsp;<span class="ident" id="5014509">w</span><span class="op" id="5014510">.</span><span class="ident" id="5014511">nbits</span>&nbsp;<span class="op" id="5014517">&gt;</span>&nbsp;<span class="num" id="5014519">8</span>&nbsp;<span class="op" id="5014521">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014525">w</span><span class="op" id="5014526">.</span><span class="ident" id="5014527">bytes</span><span class="op" id="5014532">[</span><span class="ident" id="5014533">n</span><span class="op" id="5014534">]</span>&nbsp;<span class="op" id="5014536">=</span>&nbsp;<span class="builtintype" id="5014538">byte</span><span class="op" id="5014542">(</span><span class="ident" id="5014543">w</span><span class="op" id="5014544">.</span><span class="ident" id="5014545">bits</span><span class="op" id="5014549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014553">w</span><span class="op" id="5014554">.</span><span class="ident" id="5014555">bits</span>&nbsp;<span class="op" id="5014560">&gt;&gt;=</span>&nbsp;<span class="num" id="5014564">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014568">w</span><span class="op" id="5014569">.</span><span class="ident" id="5014570">nbits</span>&nbsp;<span class="op" id="5014576">-=</span>&nbsp;<span class="num" id="5014579">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014583">n</span><span class="op" id="5014584">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014588">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014591">if</span>&nbsp;<span class="ident" id="5014594">w</span><span class="op" id="5014595">.</span><span class="ident" id="5014596">nbits</span>&nbsp;<span class="op" id="5014602">&gt;</span>&nbsp;<span class="num" id="5014604">0</span>&nbsp;<span class="op" id="5014606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014610">w</span><span class="op" id="5014611">.</span><span class="ident" id="5014612">bytes</span><span class="op" id="5014617">[</span><span class="ident" id="5014618">n</span><span class="op" id="5014619">]</span>&nbsp;<span class="op" id="5014621">=</span>&nbsp;<span class="builtintype" id="5014623">byte</span><span class="op" id="5014627">(</span><span class="ident" id="5014628">w</span><span class="op" id="5014629">.</span><span class="ident" id="5014630">bits</span><span class="op" id="5014634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014638">w</span><span class="op" id="5014639">.</span><span class="ident" id="5014640">nbits</span>&nbsp;<span class="op" id="5014646">=</span>&nbsp;<span class="num" id="5014648">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014652">n</span><span class="op" id="5014653">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014657">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014660">w</span><span class="op" id="5014661">.</span><span class="ident" id="5014662">bits</span>&nbsp;<span class="op" id="5014667">=</span>&nbsp;<span class="num" id="5014669">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014672">_</span><span class="op" id="5014673">,</span>&nbsp;<span class="ident" id="5014675">w</span><span class="op" id="5014676">.</span><span class="ident" id="5014677">err</span>&nbsp;<span class="op" id="5014681">=</span>&nbsp;<span class="ident" id="5014683">w</span><span class="op" id="5014684">.</span><span class="ident" id="5014685">w</span><span class="op" id="5014686">.</span><span class="ident" id="5014687">Write</span><span class="op" id="5014692">(</span><span class="ident" id="5014693">w</span><span class="op" id="5014694">.</span><span class="ident" id="5014695">bytes</span><span class="op" id="5014700">[</span><span class="num" id="5014701">0</span><span class="op" id="5014702">:</span><span class="ident" id="5014703">n</span><span class="op" id="5014704">]</span><span class="op" id="5014705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014708">w</span><span class="op" id="5014709">.</span><span class="ident" id="5014710">nbytes</span>&nbsp;<span class="op" id="5014717">=</span>&nbsp;<span class="num" id="5014719">0</span><br>
<span class="lineno"></span><span class="op" id="5014721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="5014724">func</span>&nbsp;<span class="op" id="5014729">(</span><span class="ident" id="5014730">w</span>&nbsp;<span class="op" id="5014732">*</span><span class="ident" id="5014733">huffmanBitWriter</span><span class="op" id="5014749">)</span>&nbsp;<span class="ident" id="5014751">writeBits</span><span class="op" id="5014760">(</span><span class="ident" id="5014761">b</span><span class="op" id="5014762">,</span>&nbsp;<span class="ident" id="5014764">nb</span>&nbsp;<span class="builtintype" id="5014767">int32</span><span class="op" id="5014772">)</span>&nbsp;<span class="op" id="5014774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014777">w</span><span class="op" id="5014778">.</span><span class="ident" id="5014779">bits</span>&nbsp;<span class="op" id="5014784">|=</span>&nbsp;<span class="builtintype" id="5014787">uint32</span><span class="op" id="5014793">(</span><span class="ident" id="5014794">b</span><span class="op" id="5014795">)</span>&nbsp;<span class="op" id="5014797">&lt;&lt;</span>&nbsp;<span class="ident" id="5014800">w</span><span class="op" id="5014801">.</span><span class="ident" id="5014802">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014809">if</span>&nbsp;<span class="ident" id="5014812">w</span><span class="op" id="5014813">.</span><span class="ident" id="5014814">nbits</span>&nbsp;<span class="op" id="5014820">+=</span>&nbsp;<span class="builtintype" id="5014823">uint32</span><span class="op" id="5014829">(</span><span class="ident" id="5014830">nb</span><span class="op" id="5014832">)</span><span class="op" id="5014833">;</span>&nbsp;<span class="ident" id="5014835">w</span><span class="op" id="5014836">.</span><span class="ident" id="5014837">nbits</span>&nbsp;<span class="op" id="5014843">&gt;=</span>&nbsp;<span class="num" id="5014846">16</span>&nbsp;<span class="op" id="5014849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014853">w</span><span class="op" id="5014854">.</span><span class="ident" id="5014855">flushBits</span><span class="op" id="5014864">(</span><span class="op" id="5014865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014868">}</span><br>
<span class="lineno">170</span><span class="op" id="5014870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5014873">func</span>&nbsp;<span class="op" id="5014878">(</span><span class="ident" id="5014879">w</span>&nbsp;<span class="op" id="5014881">*</span><span class="ident" id="5014882">huffmanBitWriter</span><span class="op" id="5014898">)</span>&nbsp;<span class="ident" id="5014900">writeBytes</span><span class="op" id="5014910">(</span><span class="ident" id="5014911">bytes</span>&nbsp;<span class="op" id="5014917">[</span><span class="op" id="5014918">]</span><span class="builtintype" id="5014919">byte</span><span class="op" id="5014923">)</span>&nbsp;<span class="op" id="5014925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014928">if</span>&nbsp;<span class="ident" id="5014931">w</span><span class="op" id="5014932">.</span><span class="ident" id="5014933">err</span>&nbsp;<span class="op" id="5014937">!=</span>&nbsp;<span class="ident" id="5014940">nil</span>&nbsp;<span class="op" id="5014944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014948">return</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014959">n</span>&nbsp;<span class="op" id="5014961">:=</span>&nbsp;<span class="ident" id="5014964">w</span><span class="op" id="5014965">.</span><span class="ident" id="5014966">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014974">if</span>&nbsp;<span class="ident" id="5014977">w</span><span class="op" id="5014978">.</span><span class="ident" id="5014979">nbits</span>&nbsp;<span class="op" id="5014985">==</span>&nbsp;<span class="num" id="5014988">8</span>&nbsp;<span class="op" id="5014990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014994">w</span><span class="op" id="5014995">.</span><span class="ident" id="5014996">bytes</span><span class="op" id="5015001">[</span><span class="ident" id="5015002">n</span><span class="op" id="5015003">]</span>&nbsp;<span class="op" id="5015005">=</span>&nbsp;<span class="builtintype" id="5015007">byte</span><span class="op" id="5015011">(</span><span class="ident" id="5015012">w</span><span class="op" id="5015013">.</span><span class="ident" id="5015014">bits</span><span class="op" id="5015018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015022">w</span><span class="op" id="5015023">.</span><span class="ident" id="5015024">nbits</span>&nbsp;<span class="op" id="5015030">=</span>&nbsp;<span class="num" id="5015032">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015036">n</span><span class="op" id="5015037">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015044">if</span>&nbsp;<span class="ident" id="5015047">w</span><span class="op" id="5015048">.</span><span class="ident" id="5015049">nbits</span>&nbsp;<span class="op" id="5015055">!=</span>&nbsp;<span class="num" id="5015058">0</span>&nbsp;<span class="op" id="5015060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015064">w</span><span class="op" id="5015065">.</span><span class="ident" id="5015066">err</span>&nbsp;<span class="op" id="5015070">=</span>&nbsp;<span class="ident" id="5015072">InternalError</span><span class="op" id="5015085">(</span><span class="string" id="5015086">&#34;writeBytes&nbsp;with&nbsp;unfinished&nbsp;bits&#34;</span><span class="op" id="5015119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015123">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015134">if</span>&nbsp;<span class="ident" id="5015137">n</span>&nbsp;<span class="op" id="5015139">!=</span>&nbsp;<span class="num" id="5015142">0</span>&nbsp;<span class="op" id="5015144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015148">_</span><span class="op" id="5015149">,</span>&nbsp;<span class="ident" id="5015151">w</span><span class="op" id="5015152">.</span><span class="ident" id="5015153">err</span>&nbsp;<span class="op" id="5015157">=</span>&nbsp;<span class="ident" id="5015159">w</span><span class="op" id="5015160">.</span><span class="ident" id="5015161">w</span><span class="op" id="5015162">.</span><span class="ident" id="5015163">Write</span><span class="op" id="5015168">(</span><span class="ident" id="5015169">w</span><span class="op" id="5015170">.</span><span class="ident" id="5015171">bytes</span><span class="op" id="5015176">[</span><span class="num" id="5015177">0</span><span class="op" id="5015178">:</span><span class="ident" id="5015179">n</span><span class="op" id="5015180">]</span><span class="op" id="5015181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015185">if</span>&nbsp;<span class="ident" id="5015188">w</span><span class="op" id="5015189">.</span><span class="ident" id="5015190">err</span>&nbsp;<span class="op" id="5015194">!=</span>&nbsp;<span class="ident" id="5015197">nil</span>&nbsp;<span class="op" id="5015201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015206">return</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015221">w</span><span class="op" id="5015222">.</span><span class="ident" id="5015223">nbytes</span>&nbsp;<span class="op" id="5015230">=</span>&nbsp;<span class="num" id="5015232">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015235">_</span><span class="op" id="5015236">,</span>&nbsp;<span class="ident" id="5015238">w</span><span class="op" id="5015239">.</span><span class="ident" id="5015240">err</span>&nbsp;<span class="op" id="5015244">=</span>&nbsp;<span class="ident" id="5015246">w</span><span class="op" id="5015247">.</span><span class="ident" id="5015248">w</span><span class="op" id="5015249">.</span><span class="ident" id="5015250">Write</span><span class="op" id="5015255">(</span><span class="ident" id="5015256">bytes</span><span class="op" id="5015261">)</span><br>
<span class="lineno"></span><span class="op" id="5015263">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="5015266">//&nbsp;RFC&nbsp;1951&nbsp;3.2.7&nbsp;specifies&nbsp;a&nbsp;special&nbsp;run-length&nbsp;encoding&nbsp;for&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="5015339">//&nbsp;the&nbsp;literal&nbsp;and&nbsp;offset&nbsp;lengths&nbsp;arrays&nbsp;(which&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="5015418">//&nbsp;array).&nbsp;&nbsp;This&nbsp;method&nbsp;generates&nbsp;that&nbsp;run-length&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="5015478">//</span><br>
<span class="lineno">200</span><span class="comment" id="5015481">//&nbsp;The&nbsp;result&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegen&nbsp;array,&nbsp;and&nbsp;the&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="5015550">//&nbsp;of&nbsp;each&nbsp;code&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegenFreq&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="5015605">//&nbsp;Codes&nbsp;0-15&nbsp;are&nbsp;single&nbsp;byte&nbsp;codes.&nbsp;Codes&nbsp;16-18&nbsp;are&nbsp;followed&nbsp;by&nbsp;additional</span><br>
<span class="lineno"></span><span class="comment" id="5015681">//&nbsp;information.&nbsp;&nbsp;Code&nbsp;badCode&nbsp;is&nbsp;an&nbsp;end&nbsp;marker</span><br>
<span class="lineno"></span><span class="comment" id="5015728">//</span><br>
<span class="lineno">205</span><span class="comment" id="5015731">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;in&nbsp;literalEncoding</span><br>
<span class="lineno"></span><span class="comment" id="5015794">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;in&nbsp;offsetEncoding</span><br>
<span class="lineno"></span><span class="keyword" id="5015855">func</span>&nbsp;<span class="op" id="5015860">(</span><span class="ident" id="5015861">w</span>&nbsp;<span class="op" id="5015863">*</span><span class="ident" id="5015864">huffmanBitWriter</span><span class="op" id="5015880">)</span>&nbsp;<span class="ident" id="5015882">generateCodegen</span><span class="op" id="5015897">(</span><span class="ident" id="5015898">numLiterals</span>&nbsp;<span class="builtintype" id="5015910">int</span><span class="op" id="5015913">,</span>&nbsp;<span class="ident" id="5015915">numOffsets</span>&nbsp;<span class="builtintype" id="5015926">int</span><span class="op" id="5015929">)</span>&nbsp;<span class="op" id="5015931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015934">for</span>&nbsp;<span class="ident" id="5015938">i</span>&nbsp;<span class="op" id="5015940">:=</span>&nbsp;<span class="keyword" id="5015943">range</span>&nbsp;<span class="ident" id="5015949">w</span><span class="op" id="5015950">.</span><span class="ident" id="5015951">codegenFreq</span>&nbsp;<span class="op" id="5015963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015967">w</span><span class="op" id="5015968">.</span><span class="ident" id="5015969">codegenFreq</span><span class="op" id="5015980">[</span><span class="ident" id="5015981">i</span><span class="op" id="5015982">]</span>&nbsp;<span class="op" id="5015984">=</span>&nbsp;<span class="num" id="5015986">0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015992">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;codegen&nbsp;both&nbsp;as&nbsp;a&nbsp;temporary&nbsp;variable&nbsp;for&nbsp;holding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016068">//&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;frequencies,&nbsp;and&nbsp;as&nbsp;the&nbsp;place&nbsp;where&nbsp;we&nbsp;put&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016141">//&nbsp;This&nbsp;is&nbsp;fine&nbsp;because&nbsp;the&nbsp;output&nbsp;is&nbsp;always&nbsp;shorter&nbsp;than&nbsp;the&nbsp;input&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016215">//&nbsp;so&nbsp;far.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016227">codegen</span>&nbsp;<span class="op" id="5016235">:=</span>&nbsp;<span class="ident" id="5016238">w</span><span class="op" id="5016239">.</span><span class="ident" id="5016240">codegen</span>&nbsp;<span class="comment" id="5016248">//&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016258">//&nbsp;Copy&nbsp;the&nbsp;concatenated&nbsp;code&nbsp;sizes&nbsp;to&nbsp;codegen.&nbsp;&nbsp;Put&nbsp;a&nbsp;marker&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5016333">copy</span><span class="op" id="5016337">(</span><span class="ident" id="5016338">codegen</span><span class="op" id="5016345">[</span><span class="num" id="5016346">0</span><span class="op" id="5016347">:</span><span class="ident" id="5016348">numLiterals</span><span class="op" id="5016359">]</span><span class="op" id="5016360">,</span>&nbsp;<span class="ident" id="5016362">w</span><span class="op" id="5016363">.</span><span class="ident" id="5016364">literalEncoding</span><span class="op" id="5016379">.</span><span class="ident" id="5016380">codeBits</span><span class="op" id="5016388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5016391">copy</span><span class="op" id="5016395">(</span><span class="ident" id="5016396">codegen</span><span class="op" id="5016403">[</span><span class="ident" id="5016404">numLiterals</span><span class="op" id="5016415">:</span><span class="ident" id="5016416">numLiterals</span><span class="op" id="5016427">+</span><span class="ident" id="5016428">numOffsets</span><span class="op" id="5016438">]</span><span class="op" id="5016439">,</span>&nbsp;<span class="ident" id="5016441">w</span><span class="op" id="5016442">.</span><span class="ident" id="5016443">offsetEncoding</span><span class="op" id="5016457">.</span><span class="ident" id="5016458">codeBits</span><span class="op" id="5016466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016469">codegen</span><span class="op" id="5016476">[</span><span class="ident" id="5016477">numLiterals</span><span class="op" id="5016488">+</span><span class="ident" id="5016489">numOffsets</span><span class="op" id="5016499">]</span>&nbsp;<span class="op" id="5016501">=</span>&nbsp;<span class="ident" id="5016503">badCode</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016513">size</span>&nbsp;<span class="op" id="5016518">:=</span>&nbsp;<span class="ident" id="5016521">codegen</span><span class="op" id="5016528">[</span><span class="num" id="5016529">0</span><span class="op" id="5016530">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016533">count</span>&nbsp;<span class="op" id="5016539">:=</span>&nbsp;<span class="num" id="5016542">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016545">outIndex</span>&nbsp;<span class="op" id="5016554">:=</span>&nbsp;<span class="num" id="5016557">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016560">for</span>&nbsp;<span class="ident" id="5016564">inIndex</span>&nbsp;<span class="op" id="5016572">:=</span>&nbsp;<span class="num" id="5016575">1</span><span class="op" id="5016576">;</span>&nbsp;<span class="ident" id="5016578">size</span>&nbsp;<span class="op" id="5016583">!=</span>&nbsp;<span class="ident" id="5016586">badCode</span><span class="op" id="5016593">;</span>&nbsp;<span class="ident" id="5016595">inIndex</span><span class="op" id="5016602">++</span>&nbsp;<span class="op" id="5016605">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016609">//&nbsp;INVARIANT:&nbsp;We&nbsp;have&nbsp;seen&nbsp;&#34;count&#34;&nbsp;copies&nbsp;of&nbsp;size&nbsp;that&nbsp;have&nbsp;not&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016679">//&nbsp;had&nbsp;output&nbsp;generated&nbsp;for&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016715">nextSize</span>&nbsp;<span class="op" id="5016724">:=</span>&nbsp;<span class="ident" id="5016727">codegen</span><span class="op" id="5016734">[</span><span class="ident" id="5016735">inIndex</span><span class="op" id="5016742">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016746">if</span>&nbsp;<span class="ident" id="5016749">nextSize</span>&nbsp;<span class="op" id="5016758">==</span>&nbsp;<span class="ident" id="5016761">size</span>&nbsp;<span class="op" id="5016766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016771">count</span><span class="op" id="5016776">++</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016782">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016797">//&nbsp;We&nbsp;need&nbsp;to&nbsp;generate&nbsp;codegen&nbsp;indicating&nbsp;&#34;count&#34;&nbsp;of&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016858">if</span>&nbsp;<span class="ident" id="5016861">size</span>&nbsp;<span class="op" id="5016866">!=</span>&nbsp;<span class="num" id="5016869">0</span>&nbsp;<span class="op" id="5016871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016876">codegen</span><span class="op" id="5016883">[</span><span class="ident" id="5016884">outIndex</span><span class="op" id="5016892">]</span>&nbsp;<span class="op" id="5016894">=</span>&nbsp;<span class="ident" id="5016896">size</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016904">outIndex</span><span class="op" id="5016912">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016918">w</span><span class="op" id="5016919">.</span><span class="ident" id="5016920">codegenFreq</span><span class="op" id="5016931">[</span><span class="ident" id="5016932">size</span><span class="op" id="5016936">]</span><span class="op" id="5016937">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016943">count</span><span class="op" id="5016948">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016954">for</span>&nbsp;<span class="ident" id="5016958">count</span>&nbsp;<span class="op" id="5016964">&gt;=</span>&nbsp;<span class="num" id="5016967">3</span>&nbsp;<span class="op" id="5016969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016975">n</span>&nbsp;<span class="op" id="5016977">:=</span>&nbsp;<span class="num" id="5016980">6</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016986">if</span>&nbsp;<span class="ident" id="5016989">n</span>&nbsp;<span class="op" id="5016991">&gt;</span>&nbsp;<span class="ident" id="5016993">count</span>&nbsp;<span class="op" id="5016999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017006">n</span>&nbsp;<span class="op" id="5017008">=</span>&nbsp;<span class="ident" id="5017010">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017026">codegen</span><span class="op" id="5017033">[</span><span class="ident" id="5017034">outIndex</span><span class="op" id="5017042">]</span>&nbsp;<span class="op" id="5017044">=</span>&nbsp;<span class="num" id="5017046">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017053">outIndex</span><span class="op" id="5017061">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017068">codegen</span><span class="op" id="5017075">[</span><span class="ident" id="5017076">outIndex</span><span class="op" id="5017084">]</span>&nbsp;<span class="op" id="5017086">=</span>&nbsp;<span class="builtintype" id="5017088">uint8</span><span class="op" id="5017093">(</span><span class="ident" id="5017094">n</span>&nbsp;<span class="op" id="5017096">-</span>&nbsp;<span class="num" id="5017098">3</span><span class="op" id="5017099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017105">outIndex</span><span class="op" id="5017113">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017120">w</span><span class="op" id="5017121">.</span><span class="ident" id="5017122">codegenFreq</span><span class="op" id="5017133">[</span><span class="num" id="5017134">16</span><span class="op" id="5017136">]</span><span class="op" id="5017137">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017144">count</span>&nbsp;<span class="op" id="5017150">-=</span>&nbsp;<span class="ident" id="5017153">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017158">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017162">}</span>&nbsp;<span class="keyword" id="5017164">else</span>&nbsp;<span class="op" id="5017169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017174">for</span>&nbsp;<span class="ident" id="5017178">count</span>&nbsp;<span class="op" id="5017184">&gt;=</span>&nbsp;<span class="num" id="5017187">11</span>&nbsp;<span class="op" id="5017190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017196">n</span>&nbsp;<span class="op" id="5017198">:=</span>&nbsp;<span class="num" id="5017201">138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017209">if</span>&nbsp;<span class="ident" id="5017212">n</span>&nbsp;<span class="op" id="5017214">&gt;</span>&nbsp;<span class="ident" id="5017216">count</span>&nbsp;<span class="op" id="5017222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017229">n</span>&nbsp;<span class="op" id="5017231">=</span>&nbsp;<span class="ident" id="5017233">count</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017249">codegen</span><span class="op" id="5017256">[</span><span class="ident" id="5017257">outIndex</span><span class="op" id="5017265">]</span>&nbsp;<span class="op" id="5017267">=</span>&nbsp;<span class="num" id="5017269">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017276">outIndex</span><span class="op" id="5017284">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017291">codegen</span><span class="op" id="5017298">[</span><span class="ident" id="5017299">outIndex</span><span class="op" id="5017307">]</span>&nbsp;<span class="op" id="5017309">=</span>&nbsp;<span class="builtintype" id="5017311">uint8</span><span class="op" id="5017316">(</span><span class="ident" id="5017317">n</span>&nbsp;<span class="op" id="5017319">-</span>&nbsp;<span class="num" id="5017321">11</span><span class="op" id="5017323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017329">outIndex</span><span class="op" id="5017337">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017344">w</span><span class="op" id="5017345">.</span><span class="ident" id="5017346">codegenFreq</span><span class="op" id="5017357">[</span><span class="num" id="5017358">18</span><span class="op" id="5017360">]</span><span class="op" id="5017361">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017368">count</span>&nbsp;<span class="op" id="5017374">-=</span>&nbsp;<span class="ident" id="5017377">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017387">if</span>&nbsp;<span class="ident" id="5017390">count</span>&nbsp;<span class="op" id="5017396">&gt;=</span>&nbsp;<span class="num" id="5017399">3</span>&nbsp;<span class="op" id="5017401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017407">//&nbsp;count&nbsp;&gt;=&nbsp;3&nbsp;&amp;&amp;&nbsp;count&nbsp;&lt;=&nbsp;10</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017440">codegen</span><span class="op" id="5017447">[</span><span class="ident" id="5017448">outIndex</span><span class="op" id="5017456">]</span>&nbsp;<span class="op" id="5017458">=</span>&nbsp;<span class="num" id="5017460">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017467">outIndex</span><span class="op" id="5017475">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017482">codegen</span><span class="op" id="5017489">[</span><span class="ident" id="5017490">outIndex</span><span class="op" id="5017498">]</span>&nbsp;<span class="op" id="5017500">=</span>&nbsp;<span class="builtintype" id="5017502">uint8</span><span class="op" id="5017507">(</span><span class="ident" id="5017508">count</span>&nbsp;<span class="op" id="5017514">-</span>&nbsp;<span class="num" id="5017516">3</span><span class="op" id="5017517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017523">outIndex</span><span class="op" id="5017531">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017538">w</span><span class="op" id="5017539">.</span><span class="ident" id="5017540">codegenFreq</span><span class="op" id="5017551">[</span><span class="num" id="5017552">17</span><span class="op" id="5017554">]</span><span class="op" id="5017555">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017562">count</span>&nbsp;<span class="op" id="5017568">=</span>&nbsp;<span class="num" id="5017570">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017583">count</span><span class="op" id="5017588">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017593">for</span>&nbsp;<span class="op" id="5017597">;</span>&nbsp;<span class="ident" id="5017599">count</span>&nbsp;<span class="op" id="5017605">&gt;=</span>&nbsp;<span class="num" id="5017608">0</span><span class="op" id="5017609">;</span>&nbsp;<span class="ident" id="5017611">count</span><span class="op" id="5017616">--</span>&nbsp;<span class="op" id="5017619">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017624">codegen</span><span class="op" id="5017631">[</span><span class="ident" id="5017632">outIndex</span><span class="op" id="5017640">]</span>&nbsp;<span class="op" id="5017642">=</span>&nbsp;<span class="ident" id="5017644">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017652">outIndex</span><span class="op" id="5017660">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017666">w</span><span class="op" id="5017667">.</span><span class="ident" id="5017668">codegenFreq</span><span class="op" id="5017679">[</span><span class="ident" id="5017680">size</span><span class="op" id="5017684">]</span><span class="op" id="5017685">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017694">//&nbsp;Set&nbsp;up&nbsp;invariant&nbsp;for&nbsp;next&nbsp;time&nbsp;through&nbsp;the&nbsp;loop.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017748">size</span>&nbsp;<span class="op" id="5017753">=</span>&nbsp;<span class="ident" id="5017755">nextSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017766">count</span>&nbsp;<span class="op" id="5017772">=</span>&nbsp;<span class="num" id="5017774">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017780">//&nbsp;Marker&nbsp;indicating&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;codegen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017826">codegen</span><span class="op" id="5017833">[</span><span class="ident" id="5017834">outIndex</span><span class="op" id="5017842">]</span>&nbsp;<span class="op" id="5017844">=</span>&nbsp;<span class="ident" id="5017846">badCode</span><br>
<span class="lineno">285</span><span class="op" id="5017854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5017857">func</span>&nbsp;<span class="op" id="5017862">(</span><span class="ident" id="5017863">w</span>&nbsp;<span class="op" id="5017865">*</span><span class="ident" id="5017866">huffmanBitWriter</span><span class="op" id="5017882">)</span>&nbsp;<span class="ident" id="5017884">writeCode</span><span class="op" id="5017893">(</span><span class="ident" id="5017894">code</span>&nbsp;<span class="op" id="5017899">*</span><span class="ident" id="5017900">huffmanEncoder</span><span class="op" id="5017914">,</span>&nbsp;<span class="ident" id="5017916">literal</span>&nbsp;<span class="builtintype" id="5017924">uint32</span><span class="op" id="5017930">)</span>&nbsp;<span class="op" id="5017932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017935">if</span>&nbsp;<span class="ident" id="5017938">w</span><span class="op" id="5017939">.</span><span class="ident" id="5017940">err</span>&nbsp;<span class="op" id="5017944">!=</span>&nbsp;<span class="ident" id="5017947">nil</span>&nbsp;<span class="op" id="5017951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017955">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017966">w</span><span class="op" id="5017967">.</span><span class="ident" id="5017968">writeBits</span><span class="op" id="5017977">(</span><span class="builtintype" id="5017978">int32</span><span class="op" id="5017983">(</span><span class="ident" id="5017984">code</span><span class="op" id="5017988">.</span><span class="ident" id="5017989">code</span><span class="op" id="5017993">[</span><span class="ident" id="5017994">literal</span><span class="op" id="5018001">]</span><span class="op" id="5018002">)</span><span class="op" id="5018003">,</span>&nbsp;<span class="builtintype" id="5018005">int32</span><span class="op" id="5018010">(</span><span class="ident" id="5018011">code</span><span class="op" id="5018015">.</span><span class="ident" id="5018016">codeBits</span><span class="op" id="5018024">[</span><span class="ident" id="5018025">literal</span><span class="op" id="5018032">]</span><span class="op" id="5018033">)</span><span class="op" id="5018034">)</span><br>
<span class="lineno"></span><span class="op" id="5018036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5018039">//&nbsp;Write&nbsp;the&nbsp;header&nbsp;of&nbsp;a&nbsp;dynamic&nbsp;Huffman&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">295</span><span class="comment" id="5018108">//</span><br>
<span class="lineno"></span><span class="comment" id="5018111">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="5018172">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="5018232">//&nbsp;&nbsp;numCodegens&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;codegens&nbsp;used&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="keyword" id="5018288">func</span>&nbsp;<span class="op" id="5018293">(</span><span class="ident" id="5018294">w</span>&nbsp;<span class="op" id="5018296">*</span><span class="ident" id="5018297">huffmanBitWriter</span><span class="op" id="5018313">)</span>&nbsp;<span class="ident" id="5018315">writeDynamicHeader</span><span class="op" id="5018333">(</span><span class="ident" id="5018334">numLiterals</span>&nbsp;<span class="builtintype" id="5018346">int</span><span class="op" id="5018349">,</span>&nbsp;<span class="ident" id="5018351">numOffsets</span>&nbsp;<span class="builtintype" id="5018362">int</span><span class="op" id="5018365">,</span>&nbsp;<span class="ident" id="5018367">numCodegens</span>&nbsp;<span class="builtintype" id="5018379">int</span><span class="op" id="5018382">,</span>&nbsp;<span class="ident" id="5018384">isEof</span>&nbsp;<span class="builtintype" id="5018390">bool</span><span class="op" id="5018394">)</span>&nbsp;<span class="op" id="5018396">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018399">if</span>&nbsp;<span class="ident" id="5018402">w</span><span class="op" id="5018403">.</span><span class="ident" id="5018404">err</span>&nbsp;<span class="op" id="5018408">!=</span>&nbsp;<span class="ident" id="5018411">nil</span>&nbsp;<span class="op" id="5018415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018419">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018430">var</span>&nbsp;<span class="ident" id="5018434">firstBits</span>&nbsp;<span class="builtintype" id="5018444">int32</span>&nbsp;<span class="op" id="5018450">=</span>&nbsp;<span class="num" id="5018452">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018455">if</span>&nbsp;<span class="ident" id="5018458">isEof</span>&nbsp;<span class="op" id="5018464">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018468">firstBits</span>&nbsp;<span class="op" id="5018478">=</span>&nbsp;<span class="num" id="5018480">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018486">w</span><span class="op" id="5018487">.</span><span class="ident" id="5018488">writeBits</span><span class="op" id="5018497">(</span><span class="ident" id="5018498">firstBits</span><span class="op" id="5018507">,</span>&nbsp;<span class="num" id="5018509">3</span><span class="op" id="5018510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018513">w</span><span class="op" id="5018514">.</span><span class="ident" id="5018515">writeBits</span><span class="op" id="5018524">(</span><span class="builtintype" id="5018525">int32</span><span class="op" id="5018530">(</span><span class="ident" id="5018531">numLiterals</span><span class="op" id="5018542">-</span><span class="num" id="5018543">257</span><span class="op" id="5018546">)</span><span class="op" id="5018547">,</span>&nbsp;<span class="num" id="5018549">5</span><span class="op" id="5018550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018553">w</span><span class="op" id="5018554">.</span><span class="ident" id="5018555">writeBits</span><span class="op" id="5018564">(</span><span class="builtintype" id="5018565">int32</span><span class="op" id="5018570">(</span><span class="ident" id="5018571">numOffsets</span><span class="op" id="5018581">-</span><span class="num" id="5018582">1</span><span class="op" id="5018583">)</span><span class="op" id="5018584">,</span>&nbsp;<span class="num" id="5018586">5</span><span class="op" id="5018587">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018590">w</span><span class="op" id="5018591">.</span><span class="ident" id="5018592">writeBits</span><span class="op" id="5018601">(</span><span class="builtintype" id="5018602">int32</span><span class="op" id="5018607">(</span><span class="ident" id="5018608">numCodegens</span><span class="op" id="5018619">-</span><span class="num" id="5018620">4</span><span class="op" id="5018621">)</span><span class="op" id="5018622">,</span>&nbsp;<span class="num" id="5018624">4</span><span class="op" id="5018625">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018629">for</span>&nbsp;<span class="ident" id="5018633">i</span>&nbsp;<span class="op" id="5018635">:=</span>&nbsp;<span class="num" id="5018638">0</span><span class="op" id="5018639">;</span>&nbsp;<span class="ident" id="5018641">i</span>&nbsp;<span class="op" id="5018643">&lt;</span>&nbsp;<span class="ident" id="5018645">numCodegens</span><span class="op" id="5018656">;</span>&nbsp;<span class="ident" id="5018658">i</span><span class="op" id="5018659">++</span>&nbsp;<span class="op" id="5018662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018666">value</span>&nbsp;<span class="op" id="5018672">:=</span>&nbsp;<span class="ident" id="5018675">w</span><span class="op" id="5018676">.</span><span class="ident" id="5018677">codegenEncoding</span><span class="op" id="5018692">.</span><span class="ident" id="5018693">codeBits</span><span class="op" id="5018701">[</span><span class="ident" id="5018702">codegenOrder</span><span class="op" id="5018714">[</span><span class="ident" id="5018715">i</span><span class="op" id="5018716">]</span><span class="op" id="5018717">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018721">w</span><span class="op" id="5018722">.</span><span class="ident" id="5018723">writeBits</span><span class="op" id="5018732">(</span><span class="builtintype" id="5018733">int32</span><span class="op" id="5018738">(</span><span class="ident" id="5018739">value</span><span class="op" id="5018744">)</span><span class="op" id="5018745">,</span>&nbsp;<span class="num" id="5018747">3</span><span class="op" id="5018748">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018755">i</span>&nbsp;<span class="op" id="5018757">:=</span>&nbsp;<span class="num" id="5018760">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018763">for</span>&nbsp;<span class="op" id="5018767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018771">var</span>&nbsp;<span class="ident" id="5018775">codeWord</span>&nbsp;<span class="builtintype" id="5018784">int</span>&nbsp;<span class="op" id="5018788">=</span>&nbsp;<span class="builtintype" id="5018790">int</span><span class="op" id="5018793">(</span><span class="ident" id="5018794">w</span><span class="op" id="5018795">.</span><span class="ident" id="5018796">codegen</span><span class="op" id="5018803">[</span><span class="ident" id="5018804">i</span><span class="op" id="5018805">]</span><span class="op" id="5018806">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018810">i</span><span class="op" id="5018811">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018816">if</span>&nbsp;<span class="ident" id="5018819">codeWord</span>&nbsp;<span class="op" id="5018828">==</span>&nbsp;<span class="ident" id="5018831">badCode</span>&nbsp;<span class="op" id="5018839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018844">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018856">//&nbsp;The&nbsp;low&nbsp;byte&nbsp;contains&nbsp;the&nbsp;actual&nbsp;code&nbsp;to&nbsp;generate.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018912">w</span><span class="op" id="5018913">.</span><span class="ident" id="5018914">writeCode</span><span class="op" id="5018923">(</span><span class="ident" id="5018924">w</span><span class="op" id="5018925">.</span><span class="ident" id="5018926">codegenEncoding</span><span class="op" id="5018941">,</span>&nbsp;<span class="builtintype" id="5018943">uint32</span><span class="op" id="5018949">(</span><span class="ident" id="5018950">codeWord</span><span class="op" id="5018958">)</span><span class="op" id="5018959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018964">switch</span>&nbsp;<span class="ident" id="5018971">codeWord</span>&nbsp;<span class="op" id="5018980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018984">case</span>&nbsp;<span class="num" id="5018989">16</span><span class="op" id="5018991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018996">w</span><span class="op" id="5018997">.</span><span class="ident" id="5018998">writeBits</span><span class="op" id="5019007">(</span><span class="builtintype" id="5019008">int32</span><span class="op" id="5019013">(</span><span class="ident" id="5019014">w</span><span class="op" id="5019015">.</span><span class="ident" id="5019016">codegen</span><span class="op" id="5019023">[</span><span class="ident" id="5019024">i</span><span class="op" id="5019025">]</span><span class="op" id="5019026">)</span><span class="op" id="5019027">,</span>&nbsp;<span class="num" id="5019029">2</span><span class="op" id="5019030">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019035">i</span><span class="op" id="5019036">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019042">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019050">case</span>&nbsp;<span class="num" id="5019055">17</span><span class="op" id="5019057">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019062">w</span><span class="op" id="5019063">.</span><span class="ident" id="5019064">writeBits</span><span class="op" id="5019073">(</span><span class="builtintype" id="5019074">int32</span><span class="op" id="5019079">(</span><span class="ident" id="5019080">w</span><span class="op" id="5019081">.</span><span class="ident" id="5019082">codegen</span><span class="op" id="5019089">[</span><span class="ident" id="5019090">i</span><span class="op" id="5019091">]</span><span class="op" id="5019092">)</span><span class="op" id="5019093">,</span>&nbsp;<span class="num" id="5019095">3</span><span class="op" id="5019096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019101">i</span><span class="op" id="5019102">++</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019108">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019116">case</span>&nbsp;<span class="num" id="5019121">18</span><span class="op" id="5019123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019128">w</span><span class="op" id="5019129">.</span><span class="ident" id="5019130">writeBits</span><span class="op" id="5019139">(</span><span class="builtintype" id="5019140">int32</span><span class="op" id="5019145">(</span><span class="ident" id="5019146">w</span><span class="op" id="5019147">.</span><span class="ident" id="5019148">codegen</span><span class="op" id="5019155">[</span><span class="ident" id="5019156">i</span><span class="op" id="5019157">]</span><span class="op" id="5019158">)</span><span class="op" id="5019159">,</span>&nbsp;<span class="num" id="5019161">7</span><span class="op" id="5019162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019167">i</span><span class="op" id="5019168">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019174">break</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019185">}</span><br>
<span class="lineno"></span><span class="op" id="5019187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5019190">func</span>&nbsp;<span class="op" id="5019195">(</span><span class="ident" id="5019196">w</span>&nbsp;<span class="op" id="5019198">*</span><span class="ident" id="5019199">huffmanBitWriter</span><span class="op" id="5019215">)</span>&nbsp;<span class="ident" id="5019217">writeStoredHeader</span><span class="op" id="5019234">(</span><span class="ident" id="5019235">length</span>&nbsp;<span class="builtintype" id="5019242">int</span><span class="op" id="5019245">,</span>&nbsp;<span class="ident" id="5019247">isEof</span>&nbsp;<span class="builtintype" id="5019253">bool</span><span class="op" id="5019257">)</span>&nbsp;<span class="op" id="5019259">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019262">if</span>&nbsp;<span class="ident" id="5019265">w</span><span class="op" id="5019266">.</span><span class="ident" id="5019267">err</span>&nbsp;<span class="op" id="5019271">!=</span>&nbsp;<span class="ident" id="5019274">nil</span>&nbsp;<span class="op" id="5019278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019282">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019293">var</span>&nbsp;<span class="ident" id="5019297">flag</span>&nbsp;<span class="builtintype" id="5019302">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019309">if</span>&nbsp;<span class="ident" id="5019312">isEof</span>&nbsp;<span class="op" id="5019318">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019322">flag</span>&nbsp;<span class="op" id="5019327">=</span>&nbsp;<span class="num" id="5019329">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019335">w</span><span class="op" id="5019336">.</span><span class="ident" id="5019337">writeBits</span><span class="op" id="5019346">(</span><span class="ident" id="5019347">flag</span><span class="op" id="5019351">,</span>&nbsp;<span class="num" id="5019353">3</span><span class="op" id="5019354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019357">w</span><span class="op" id="5019358">.</span><span class="ident" id="5019359">flush</span><span class="op" id="5019364">(</span><span class="op" id="5019365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019368">w</span><span class="op" id="5019369">.</span><span class="ident" id="5019370">writeBits</span><span class="op" id="5019379">(</span><span class="builtintype" id="5019380">int32</span><span class="op" id="5019385">(</span><span class="ident" id="5019386">length</span><span class="op" id="5019392">)</span><span class="op" id="5019393">,</span>&nbsp;<span class="num" id="5019395">16</span><span class="op" id="5019397">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019400">w</span><span class="op" id="5019401">.</span><span class="ident" id="5019402">writeBits</span><span class="op" id="5019411">(</span><span class="builtintype" id="5019412">int32</span><span class="op" id="5019417">(</span><span class="op" id="5019418">^</span><span class="builtintype" id="5019419">uint16</span><span class="op" id="5019425">(</span><span class="ident" id="5019426">length</span><span class="op" id="5019432">)</span><span class="op" id="5019433">)</span><span class="op" id="5019434">,</span>&nbsp;<span class="num" id="5019436">16</span><span class="op" id="5019438">)</span><br>
<span class="lineno"></span><span class="op" id="5019440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5019443">func</span>&nbsp;<span class="op" id="5019448">(</span><span class="ident" id="5019449">w</span>&nbsp;<span class="op" id="5019451">*</span><span class="ident" id="5019452">huffmanBitWriter</span><span class="op" id="5019468">)</span>&nbsp;<span class="ident" id="5019470">writeFixedHeader</span><span class="op" id="5019486">(</span><span class="ident" id="5019487">isEof</span>&nbsp;<span class="builtintype" id="5019493">bool</span><span class="op" id="5019497">)</span>&nbsp;<span class="op" id="5019499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019502">if</span>&nbsp;<span class="ident" id="5019505">w</span><span class="op" id="5019506">.</span><span class="ident" id="5019507">err</span>&nbsp;<span class="op" id="5019511">!=</span>&nbsp;<span class="ident" id="5019514">nil</span>&nbsp;<span class="op" id="5019518">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019522">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019533">//&nbsp;Indicate&nbsp;that&nbsp;we&nbsp;are&nbsp;a&nbsp;fixed&nbsp;Huffman&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019580">var</span>&nbsp;<span class="ident" id="5019584">value</span>&nbsp;<span class="builtintype" id="5019590">int32</span>&nbsp;<span class="op" id="5019596">=</span>&nbsp;<span class="num" id="5019598">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019601">if</span>&nbsp;<span class="ident" id="5019604">isEof</span>&nbsp;<span class="op" id="5019610">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019614">value</span>&nbsp;<span class="op" id="5019620">=</span>&nbsp;<span class="num" id="5019622">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019628">w</span><span class="op" id="5019629">.</span><span class="ident" id="5019630">writeBits</span><span class="op" id="5019639">(</span><span class="ident" id="5019640">value</span><span class="op" id="5019645">,</span>&nbsp;<span class="num" id="5019647">3</span><span class="op" id="5019648">)</span><br>
<span class="lineno"></span><span class="op" id="5019650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="5019653">func</span>&nbsp;<span class="op" id="5019658">(</span><span class="ident" id="5019659">w</span>&nbsp;<span class="op" id="5019661">*</span><span class="ident" id="5019662">huffmanBitWriter</span><span class="op" id="5019678">)</span>&nbsp;<span class="ident" id="5019680">writeBlock</span><span class="op" id="5019690">(</span><span class="ident" id="5019691">tokens</span>&nbsp;<span class="op" id="5019698">[</span><span class="op" id="5019699">]</span><span class="ident" id="5019700">token</span><span class="op" id="5019705">,</span>&nbsp;<span class="ident" id="5019707">eof</span>&nbsp;<span class="builtintype" id="5019711">bool</span><span class="op" id="5019715">,</span>&nbsp;<span class="ident" id="5019717">input</span>&nbsp;<span class="op" id="5019723">[</span><span class="op" id="5019724">]</span><span class="builtintype" id="5019725">byte</span><span class="op" id="5019729">)</span>&nbsp;<span class="op" id="5019731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019734">if</span>&nbsp;<span class="ident" id="5019737">w</span><span class="op" id="5019738">.</span><span class="ident" id="5019739">err</span>&nbsp;<span class="op" id="5019743">!=</span>&nbsp;<span class="ident" id="5019746">nil</span>&nbsp;<span class="op" id="5019750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019754">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019765">for</span>&nbsp;<span class="ident" id="5019769">i</span>&nbsp;<span class="op" id="5019771">:=</span>&nbsp;<span class="keyword" id="5019774">range</span>&nbsp;<span class="ident" id="5019780">w</span><span class="op" id="5019781">.</span><span class="ident" id="5019782">literalFreq</span>&nbsp;<span class="op" id="5019794">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019798">w</span><span class="op" id="5019799">.</span><span class="ident" id="5019800">literalFreq</span><span class="op" id="5019811">[</span><span class="ident" id="5019812">i</span><span class="op" id="5019813">]</span>&nbsp;<span class="op" id="5019815">=</span>&nbsp;<span class="num" id="5019817">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019823">for</span>&nbsp;<span class="ident" id="5019827">i</span>&nbsp;<span class="op" id="5019829">:=</span>&nbsp;<span class="keyword" id="5019832">range</span>&nbsp;<span class="ident" id="5019838">w</span><span class="op" id="5019839">.</span><span class="ident" id="5019840">offsetFreq</span>&nbsp;<span class="op" id="5019851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019855">w</span><span class="op" id="5019856">.</span><span class="ident" id="5019857">offsetFreq</span><span class="op" id="5019867">[</span><span class="ident" id="5019868">i</span><span class="op" id="5019869">]</span>&nbsp;<span class="op" id="5019871">=</span>&nbsp;<span class="num" id="5019873">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019876">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019880">n</span>&nbsp;<span class="op" id="5019882">:=</span>&nbsp;<span class="builtinfunc" id="5019885">len</span><span class="op" id="5019888">(</span><span class="ident" id="5019889">tokens</span><span class="op" id="5019895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019898">tokens</span>&nbsp;<span class="op" id="5019905">=</span>&nbsp;<span class="ident" id="5019907">tokens</span><span class="op" id="5019913">[</span><span class="num" id="5019914">0</span>&nbsp;<span class="op" id="5019916">:</span>&nbsp;<span class="ident" id="5019918">n</span><span class="op" id="5019919">+</span><span class="num" id="5019920">1</span><span class="op" id="5019921">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019924">tokens</span><span class="op" id="5019930">[</span><span class="ident" id="5019931">n</span><span class="op" id="5019932">]</span>&nbsp;<span class="op" id="5019934">=</span>&nbsp;<span class="ident" id="5019936">endBlockMarker</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019953">for</span>&nbsp;<span class="ident" id="5019957">_</span><span class="op" id="5019958">,</span>&nbsp;<span class="ident" id="5019960">t</span>&nbsp;<span class="op" id="5019962">:=</span>&nbsp;<span class="keyword" id="5019965">range</span>&nbsp;<span class="ident" id="5019971">tokens</span>&nbsp;<span class="op" id="5019978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019982">switch</span>&nbsp;<span class="ident" id="5019989">t</span><span class="op" id="5019990">.</span><span class="ident" id="5019991">typ</span><span class="op" id="5019994">(</span><span class="op" id="5019995">)</span>&nbsp;<span class="op" id="5019997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020001">case</span>&nbsp;<span class="ident" id="5020006">literalType</span><span class="op" id="5020017">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020022">w</span><span class="op" id="5020023">.</span><span class="ident" id="5020024">literalFreq</span><span class="op" id="5020035">[</span><span class="ident" id="5020036">t</span><span class="op" id="5020037">.</span><span class="ident" id="5020038">literal</span><span class="op" id="5020045">(</span><span class="op" id="5020046">)</span><span class="op" id="5020047">]</span><span class="op" id="5020048">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020053">case</span>&nbsp;<span class="ident" id="5020058">matchType</span><span class="op" id="5020067">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020072">length</span>&nbsp;<span class="op" id="5020079">:=</span>&nbsp;<span class="ident" id="5020082">t</span><span class="op" id="5020083">.</span><span class="ident" id="5020084">length</span><span class="op" id="5020090">(</span><span class="op" id="5020091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020096">offset</span>&nbsp;<span class="op" id="5020103">:=</span>&nbsp;<span class="ident" id="5020106">t</span><span class="op" id="5020107">.</span><span class="ident" id="5020108">offset</span><span class="op" id="5020114">(</span><span class="op" id="5020115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020120">w</span><span class="op" id="5020121">.</span><span class="ident" id="5020122">literalFreq</span><span class="op" id="5020133">[</span><span class="ident" id="5020134">lengthCodesStart</span><span class="op" id="5020150">+</span><span class="ident" id="5020151">lengthCode</span><span class="op" id="5020161">(</span><span class="ident" id="5020162">length</span><span class="op" id="5020168">)</span><span class="op" id="5020169">]</span><span class="op" id="5020170">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020176">w</span><span class="op" id="5020177">.</span><span class="ident" id="5020178">offsetFreq</span><span class="op" id="5020188">[</span><span class="ident" id="5020189">offsetCode</span><span class="op" id="5020199">(</span><span class="ident" id="5020200">offset</span><span class="op" id="5020206">)</span><span class="op" id="5020207">]</span><span class="op" id="5020208">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020213">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020220">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020251">numLiterals</span>&nbsp;<span class="op" id="5020263">:=</span>&nbsp;<span class="builtinfunc" id="5020266">len</span><span class="op" id="5020269">(</span><span class="ident" id="5020270">w</span><span class="op" id="5020271">.</span><span class="ident" id="5020272">literalFreq</span><span class="op" id="5020283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020286">for</span>&nbsp;<span class="ident" id="5020290">w</span><span class="op" id="5020291">.</span><span class="ident" id="5020292">literalFreq</span><span class="op" id="5020303">[</span><span class="ident" id="5020304">numLiterals</span><span class="op" id="5020315">-</span><span class="num" id="5020316">1</span><span class="op" id="5020317">]</span>&nbsp;<span class="op" id="5020319">==</span>&nbsp;<span class="num" id="5020322">0</span>&nbsp;<span class="op" id="5020324">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020328">numLiterals</span><span class="op" id="5020339">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020346">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020376">numOffsets</span>&nbsp;<span class="op" id="5020387">:=</span>&nbsp;<span class="builtinfunc" id="5020390">len</span><span class="op" id="5020393">(</span><span class="ident" id="5020394">w</span><span class="op" id="5020395">.</span><span class="ident" id="5020396">offsetFreq</span><span class="op" id="5020406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020409">for</span>&nbsp;<span class="ident" id="5020413">numOffsets</span>&nbsp;<span class="op" id="5020424">&gt;</span>&nbsp;<span class="num" id="5020426">0</span>&nbsp;<span class="op" id="5020428">&amp;&amp;</span>&nbsp;<span class="ident" id="5020431">w</span><span class="op" id="5020432">.</span><span class="ident" id="5020433">offsetFreq</span><span class="op" id="5020443">[</span><span class="ident" id="5020444">numOffsets</span><span class="op" id="5020454">-</span><span class="num" id="5020455">1</span><span class="op" id="5020456">]</span>&nbsp;<span class="op" id="5020458">==</span>&nbsp;<span class="num" id="5020461">0</span>&nbsp;<span class="op" id="5020463">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020467">numOffsets</span><span class="op" id="5020477">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020484">if</span>&nbsp;<span class="ident" id="5020487">numOffsets</span>&nbsp;<span class="op" id="5020498">==</span>&nbsp;<span class="num" id="5020501">0</span>&nbsp;<span class="op" id="5020503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020507">//&nbsp;We&nbsp;haven&#39;t&nbsp;found&nbsp;a&nbsp;single&nbsp;match.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;with&nbsp;the&nbsp;dynamic&nbsp;encoding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020589">//&nbsp;we&nbsp;should&nbsp;count&nbsp;at&nbsp;least&nbsp;one&nbsp;offset&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;offset&nbsp;huffman&nbsp;tree&nbsp;could&nbsp;be&nbsp;encoded.</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020688">w</span><span class="op" id="5020689">.</span><span class="ident" id="5020690">offsetFreq</span><span class="op" id="5020700">[</span><span class="num" id="5020701">0</span><span class="op" id="5020702">]</span>&nbsp;<span class="op" id="5020704">=</span>&nbsp;<span class="num" id="5020706">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020710">numOffsets</span>&nbsp;<span class="op" id="5020721">=</span>&nbsp;<span class="num" id="5020723">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020730">w</span><span class="op" id="5020731">.</span><span class="ident" id="5020732">literalEncoding</span><span class="op" id="5020747">.</span><span class="ident" id="5020748">generate</span><span class="op" id="5020756">(</span><span class="ident" id="5020757">w</span><span class="op" id="5020758">.</span><span class="ident" id="5020759">literalFreq</span><span class="op" id="5020770">,</span>&nbsp;<span class="num" id="5020772">15</span><span class="op" id="5020774">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020777">w</span><span class="op" id="5020778">.</span><span class="ident" id="5020779">offsetEncoding</span><span class="op" id="5020793">.</span><span class="ident" id="5020794">generate</span><span class="op" id="5020802">(</span><span class="ident" id="5020803">w</span><span class="op" id="5020804">.</span><span class="ident" id="5020805">offsetFreq</span><span class="op" id="5020815">,</span>&nbsp;<span class="num" id="5020817">15</span><span class="op" id="5020819">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020823">storedBytes</span>&nbsp;<span class="op" id="5020835">:=</span>&nbsp;<span class="num" id="5020838">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020841">if</span>&nbsp;<span class="ident" id="5020844">input</span>&nbsp;<span class="op" id="5020850">!=</span>&nbsp;<span class="ident" id="5020853">nil</span>&nbsp;<span class="op" id="5020857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020861">storedBytes</span>&nbsp;<span class="op" id="5020873">=</span>&nbsp;<span class="builtinfunc" id="5020875">len</span><span class="op" id="5020878">(</span><span class="ident" id="5020879">input</span><span class="op" id="5020884">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020890">var</span>&nbsp;<span class="ident" id="5020894">extraBits</span>&nbsp;<span class="ident" id="5020904">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020911">var</span>&nbsp;<span class="ident" id="5020915">storedSize</span>&nbsp;<span class="ident" id="5020926">int64</span>&nbsp;<span class="op" id="5020932">=</span>&nbsp;<span class="ident" id="5020934">math</span><span class="op" id="5020938">.</span><span class="ident" id="5020939">MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020949">if</span>&nbsp;<span class="ident" id="5020952">storedBytes</span>&nbsp;<span class="op" id="5020964">&lt;=</span>&nbsp;<span class="ident" id="5020967">maxStoreBlockSize</span>&nbsp;<span class="op" id="5020985">&amp;&amp;</span>&nbsp;<span class="ident" id="5020988">input</span>&nbsp;<span class="op" id="5020994">!=</span>&nbsp;<span class="ident" id="5020997">nil</span>&nbsp;<span class="op" id="5021001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021005">storedSize</span>&nbsp;<span class="op" id="5021016">=</span>&nbsp;<span class="ident" id="5021018">int64</span><span class="op" id="5021023">(</span><span class="op" id="5021024">(</span><span class="ident" id="5021025">storedBytes</span>&nbsp;<span class="op" id="5021037">+</span>&nbsp;<span class="num" id="5021039">5</span><span class="op" id="5021040">)</span>&nbsp;<span class="op" id="5021042">*</span>&nbsp;<span class="num" id="5021044">8</span><span class="op" id="5021045">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021049">//&nbsp;We&nbsp;only&nbsp;bother&nbsp;calculating&nbsp;the&nbsp;costs&nbsp;of&nbsp;the&nbsp;extra&nbsp;bits&nbsp;required&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021121">//&nbsp;the&nbsp;length&nbsp;of&nbsp;offset&nbsp;fields&nbsp;(which&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;for&nbsp;both&nbsp;fixed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021193">//&nbsp;and&nbsp;dynamic&nbsp;encoding),&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;compare&nbsp;those&nbsp;two&nbsp;encodings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021263">//&nbsp;against&nbsp;stored&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021293">for</span>&nbsp;<span class="ident" id="5021297">lengthCode</span>&nbsp;<span class="op" id="5021308">:=</span>&nbsp;<span class="ident" id="5021311">lengthCodesStart</span>&nbsp;<span class="op" id="5021328">+</span>&nbsp;<span class="num" id="5021330">8</span><span class="op" id="5021331">;</span>&nbsp;<span class="ident" id="5021333">lengthCode</span>&nbsp;<span class="op" id="5021344">&lt;</span>&nbsp;<span class="ident" id="5021346">numLiterals</span><span class="op" id="5021357">;</span>&nbsp;<span class="ident" id="5021359">lengthCode</span><span class="op" id="5021369">++</span>&nbsp;<span class="op" id="5021372">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021377">//&nbsp;First&nbsp;eight&nbsp;length&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021429">extraBits</span>&nbsp;<span class="op" id="5021439">+=</span>&nbsp;<span class="ident" id="5021442">int64</span><span class="op" id="5021447">(</span><span class="ident" id="5021448">w</span><span class="op" id="5021449">.</span><span class="ident" id="5021450">literalFreq</span><span class="op" id="5021461">[</span><span class="ident" id="5021462">lengthCode</span><span class="op" id="5021472">]</span><span class="op" id="5021473">)</span>&nbsp;<span class="op" id="5021475">*</span>&nbsp;<span class="ident" id="5021477">int64</span><span class="op" id="5021482">(</span><span class="ident" id="5021483">lengthExtraBits</span><span class="op" id="5021498">[</span><span class="ident" id="5021499">lengthCode</span><span class="op" id="5021509">-</span><span class="ident" id="5021510">lengthCodesStart</span><span class="op" id="5021526">]</span><span class="op" id="5021527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021535">for</span>&nbsp;<span class="ident" id="5021539">offsetCode</span>&nbsp;<span class="op" id="5021550">:=</span>&nbsp;<span class="num" id="5021553">4</span><span class="op" id="5021554">;</span>&nbsp;<span class="ident" id="5021556">offsetCode</span>&nbsp;<span class="op" id="5021567">&lt;</span>&nbsp;<span class="ident" id="5021569">numOffsets</span><span class="op" id="5021579">;</span>&nbsp;<span class="ident" id="5021581">offsetCode</span><span class="op" id="5021591">++</span>&nbsp;<span class="op" id="5021594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021599">//&nbsp;First&nbsp;four&nbsp;offset&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021650">extraBits</span>&nbsp;<span class="op" id="5021660">+=</span>&nbsp;<span class="ident" id="5021663">int64</span><span class="op" id="5021668">(</span><span class="ident" id="5021669">w</span><span class="op" id="5021670">.</span><span class="ident" id="5021671">offsetFreq</span><span class="op" id="5021681">[</span><span class="ident" id="5021682">offsetCode</span><span class="op" id="5021692">]</span><span class="op" id="5021693">)</span>&nbsp;<span class="op" id="5021695">*</span>&nbsp;<span class="ident" id="5021697">int64</span><span class="op" id="5021702">(</span><span class="ident" id="5021703">offsetExtraBits</span><span class="op" id="5021718">[</span><span class="ident" id="5021719">offsetCode</span><span class="op" id="5021729">]</span><span class="op" id="5021730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021741">//&nbsp;Figure&nbsp;out&nbsp;smallest&nbsp;code.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021771">//&nbsp;Fixed&nbsp;Huffman&nbsp;baseline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021799">var</span>&nbsp;<span class="ident" id="5021803">size</span>&nbsp;<span class="op" id="5021808">=</span>&nbsp;<span class="ident" id="5021810">int64</span><span class="op" id="5021815">(</span><span class="num" id="5021816">3</span><span class="op" id="5021817">)</span>&nbsp;<span class="op" id="5021819">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021823">fixedLiteralEncoding</span><span class="op" id="5021843">.</span><span class="ident" id="5021844">bitLength</span><span class="op" id="5021853">(</span><span class="ident" id="5021854">w</span><span class="op" id="5021855">.</span><span class="ident" id="5021856">literalFreq</span><span class="op" id="5021867">)</span>&nbsp;<span class="op" id="5021869">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021873">fixedOffsetEncoding</span><span class="op" id="5021892">.</span><span class="ident" id="5021893">bitLength</span><span class="op" id="5021902">(</span><span class="ident" id="5021903">w</span><span class="op" id="5021904">.</span><span class="ident" id="5021905">offsetFreq</span><span class="op" id="5021915">)</span>&nbsp;<span class="op" id="5021917">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021921">extraBits</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021932">var</span>&nbsp;<span class="ident" id="5021936">literalEncoding</span>&nbsp;<span class="op" id="5021952">=</span>&nbsp;<span class="ident" id="5021954">fixedLiteralEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021976">var</span>&nbsp;<span class="ident" id="5021980">offsetEncoding</span>&nbsp;<span class="op" id="5021995">=</span>&nbsp;<span class="ident" id="5021997">fixedOffsetEncoding</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022019">//&nbsp;Dynamic&nbsp;Huffman?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022040">var</span>&nbsp;<span class="ident" id="5022044">numCodegens</span>&nbsp;<span class="builtintype" id="5022056">int</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022062">//&nbsp;Generate&nbsp;codegen&nbsp;and&nbsp;codegenFrequencies,&nbsp;which&nbsp;indicates&nbsp;how&nbsp;to&nbsp;encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022137">//&nbsp;the&nbsp;literalEncoding&nbsp;and&nbsp;the&nbsp;offsetEncoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022185">w</span><span class="op" id="5022186">.</span><span class="ident" id="5022187">generateCodegen</span><span class="op" id="5022202">(</span><span class="ident" id="5022203">numLiterals</span><span class="op" id="5022214">,</span>&nbsp;<span class="ident" id="5022216">numOffsets</span><span class="op" id="5022226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022229">w</span><span class="op" id="5022230">.</span><span class="ident" id="5022231">codegenEncoding</span><span class="op" id="5022246">.</span><span class="ident" id="5022247">generate</span><span class="op" id="5022255">(</span><span class="ident" id="5022256">w</span><span class="op" id="5022257">.</span><span class="ident" id="5022258">codegenFreq</span><span class="op" id="5022269">,</span>&nbsp;<span class="num" id="5022271">7</span><span class="op" id="5022272">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022275">numCodegens</span>&nbsp;<span class="op" id="5022287">=</span>&nbsp;<span class="builtinfunc" id="5022289">len</span><span class="op" id="5022292">(</span><span class="ident" id="5022293">w</span><span class="op" id="5022294">.</span><span class="ident" id="5022295">codegenFreq</span><span class="op" id="5022306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022309">for</span>&nbsp;<span class="ident" id="5022313">numCodegens</span>&nbsp;<span class="op" id="5022325">&gt;</span>&nbsp;<span class="num" id="5022327">4</span>&nbsp;<span class="op" id="5022329">&amp;&amp;</span>&nbsp;<span class="ident" id="5022332">w</span><span class="op" id="5022333">.</span><span class="ident" id="5022334">codegenFreq</span><span class="op" id="5022345">[</span><span class="ident" id="5022346">codegenOrder</span><span class="op" id="5022358">[</span><span class="ident" id="5022359">numCodegens</span><span class="op" id="5022370">-</span><span class="num" id="5022371">1</span><span class="op" id="5022372">]</span><span class="op" id="5022373">]</span>&nbsp;<span class="op" id="5022375">==</span>&nbsp;<span class="num" id="5022378">0</span>&nbsp;<span class="op" id="5022380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022384">numCodegens</span><span class="op" id="5022395">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022402">dynamicHeader</span>&nbsp;<span class="op" id="5022416">:=</span>&nbsp;<span class="ident" id="5022419">int64</span><span class="op" id="5022424">(</span><span class="num" id="5022425">3</span><span class="op" id="5022426">+</span><span class="num" id="5022427">5</span><span class="op" id="5022428">+</span><span class="num" id="5022429">5</span><span class="op" id="5022430">+</span><span class="num" id="5022431">4</span><span class="op" id="5022432">+</span><span class="op" id="5022433">(</span><span class="num" id="5022434">3</span><span class="op" id="5022435">*</span><span class="ident" id="5022436">numCodegens</span><span class="op" id="5022447">)</span><span class="op" id="5022448">)</span>&nbsp;<span class="op" id="5022450">+</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022454">w</span><span class="op" id="5022455">.</span><span class="ident" id="5022456">codegenEncoding</span><span class="op" id="5022471">.</span><span class="ident" id="5022472">bitLength</span><span class="op" id="5022481">(</span><span class="ident" id="5022482">w</span><span class="op" id="5022483">.</span><span class="ident" id="5022484">codegenFreq</span><span class="op" id="5022495">)</span>&nbsp;<span class="op" id="5022497">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022501">int64</span><span class="op" id="5022506">(</span><span class="ident" id="5022507">extraBits</span><span class="op" id="5022516">)</span>&nbsp;<span class="op" id="5022518">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022522">int64</span><span class="op" id="5022527">(</span><span class="ident" id="5022528">w</span><span class="op" id="5022529">.</span><span class="ident" id="5022530">codegenFreq</span><span class="op" id="5022541">[</span><span class="num" id="5022542">16</span><span class="op" id="5022544">]</span><span class="op" id="5022545">*</span><span class="num" id="5022546">2</span><span class="op" id="5022547">)</span>&nbsp;<span class="op" id="5022549">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022553">int64</span><span class="op" id="5022558">(</span><span class="ident" id="5022559">w</span><span class="op" id="5022560">.</span><span class="ident" id="5022561">codegenFreq</span><span class="op" id="5022572">[</span><span class="num" id="5022573">17</span><span class="op" id="5022575">]</span><span class="op" id="5022576">*</span><span class="num" id="5022577">3</span><span class="op" id="5022578">)</span>&nbsp;<span class="op" id="5022580">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022584">int64</span><span class="op" id="5022589">(</span><span class="ident" id="5022590">w</span><span class="op" id="5022591">.</span><span class="ident" id="5022592">codegenFreq</span><span class="op" id="5022603">[</span><span class="num" id="5022604">18</span><span class="op" id="5022606">]</span><span class="op" id="5022607">*</span><span class="num" id="5022608">7</span><span class="op" id="5022609">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022612">dynamicSize</span>&nbsp;<span class="op" id="5022624">:=</span>&nbsp;<span class="ident" id="5022627">dynamicHeader</span>&nbsp;<span class="op" id="5022641">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022645">w</span><span class="op" id="5022646">.</span><span class="ident" id="5022647">literalEncoding</span><span class="op" id="5022662">.</span><span class="ident" id="5022663">bitLength</span><span class="op" id="5022672">(</span><span class="ident" id="5022673">w</span><span class="op" id="5022674">.</span><span class="ident" id="5022675">literalFreq</span><span class="op" id="5022686">)</span>&nbsp;<span class="op" id="5022688">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022692">w</span><span class="op" id="5022693">.</span><span class="ident" id="5022694">offsetEncoding</span><span class="op" id="5022708">.</span><span class="ident" id="5022709">bitLength</span><span class="op" id="5022718">(</span><span class="ident" id="5022719">w</span><span class="op" id="5022720">.</span><span class="ident" id="5022721">offsetFreq</span><span class="op" id="5022731">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022735">if</span>&nbsp;<span class="ident" id="5022738">dynamicSize</span>&nbsp;<span class="op" id="5022750">&lt;</span>&nbsp;<span class="ident" id="5022752">size</span>&nbsp;<span class="op" id="5022757">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022761">size</span>&nbsp;<span class="op" id="5022766">=</span>&nbsp;<span class="ident" id="5022768">dynamicSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022782">literalEncoding</span>&nbsp;<span class="op" id="5022798">=</span>&nbsp;<span class="ident" id="5022800">w</span><span class="op" id="5022801">.</span><span class="ident" id="5022802">literalEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022820">offsetEncoding</span>&nbsp;<span class="op" id="5022835">=</span>&nbsp;<span class="ident" id="5022837">w</span><span class="op" id="5022838">.</span><span class="ident" id="5022839">offsetEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022859">//&nbsp;Stored&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022877">if</span>&nbsp;<span class="ident" id="5022880">storedSize</span>&nbsp;<span class="op" id="5022891">&lt;</span>&nbsp;<span class="ident" id="5022893">size</span>&nbsp;<span class="op" id="5022898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022902">w</span><span class="op" id="5022903">.</span><span class="ident" id="5022904">writeStoredHeader</span><span class="op" id="5022921">(</span><span class="ident" id="5022922">storedBytes</span><span class="op" id="5022933">,</span>&nbsp;<span class="ident" id="5022935">eof</span><span class="op" id="5022938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022942">w</span><span class="op" id="5022943">.</span><span class="ident" id="5022944">writeBytes</span><span class="op" id="5022954">(</span><span class="ident" id="5022955">input</span><span class="op" id="5022960">[</span><span class="num" id="5022961">0</span><span class="op" id="5022962">:</span><span class="ident" id="5022963">storedBytes</span><span class="op" id="5022974">]</span><span class="op" id="5022975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022979">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022991">//&nbsp;Huffman.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023004">if</span>&nbsp;<span class="ident" id="5023007">literalEncoding</span>&nbsp;<span class="op" id="5023023">==</span>&nbsp;<span class="ident" id="5023026">fixedLiteralEncoding</span>&nbsp;<span class="op" id="5023047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023051">w</span><span class="op" id="5023052">.</span><span class="ident" id="5023053">writeFixedHeader</span><span class="op" id="5023069">(</span><span class="ident" id="5023070">eof</span><span class="op" id="5023073">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023076">}</span>&nbsp;<span class="keyword" id="5023078">else</span>&nbsp;<span class="op" id="5023083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023087">w</span><span class="op" id="5023088">.</span><span class="ident" id="5023089">writeDynamicHeader</span><span class="op" id="5023107">(</span><span class="ident" id="5023108">numLiterals</span><span class="op" id="5023119">,</span>&nbsp;<span class="ident" id="5023121">numOffsets</span><span class="op" id="5023131">,</span>&nbsp;<span class="ident" id="5023133">numCodegens</span><span class="op" id="5023144">,</span>&nbsp;<span class="ident" id="5023146">eof</span><span class="op" id="5023149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023155">for</span>&nbsp;<span class="ident" id="5023159">_</span><span class="op" id="5023160">,</span>&nbsp;<span class="ident" id="5023162">t</span>&nbsp;<span class="op" id="5023164">:=</span>&nbsp;<span class="keyword" id="5023167">range</span>&nbsp;<span class="ident" id="5023173">tokens</span>&nbsp;<span class="op" id="5023180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023184">switch</span>&nbsp;<span class="ident" id="5023191">t</span><span class="op" id="5023192">.</span><span class="ident" id="5023193">typ</span><span class="op" id="5023196">(</span><span class="op" id="5023197">)</span>&nbsp;<span class="op" id="5023199">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023203">case</span>&nbsp;<span class="ident" id="5023208">literalType</span><span class="op" id="5023219">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023224">w</span><span class="op" id="5023225">.</span><span class="ident" id="5023226">writeCode</span><span class="op" id="5023235">(</span><span class="ident" id="5023236">literalEncoding</span><span class="op" id="5023251">,</span>&nbsp;<span class="ident" id="5023253">t</span><span class="op" id="5023254">.</span><span class="ident" id="5023255">literal</span><span class="op" id="5023262">(</span><span class="op" id="5023263">)</span><span class="op" id="5023264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023269">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023277">case</span>&nbsp;<span class="ident" id="5023282">matchType</span><span class="op" id="5023291">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023296">//&nbsp;Write&nbsp;the&nbsp;length</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023319">length</span>&nbsp;<span class="op" id="5023326">:=</span>&nbsp;<span class="ident" id="5023329">t</span><span class="op" id="5023330">.</span><span class="ident" id="5023331">length</span><span class="op" id="5023337">(</span><span class="op" id="5023338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023343">lengthCode</span>&nbsp;<span class="op" id="5023354">:=</span>&nbsp;<span class="ident" id="5023357">lengthCode</span><span class="op" id="5023367">(</span><span class="ident" id="5023368">length</span><span class="op" id="5023374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023379">w</span><span class="op" id="5023380">.</span><span class="ident" id="5023381">writeCode</span><span class="op" id="5023390">(</span><span class="ident" id="5023391">literalEncoding</span><span class="op" id="5023406">,</span>&nbsp;<span class="ident" id="5023408">lengthCode</span><span class="op" id="5023418">+</span><span class="ident" id="5023419">lengthCodesStart</span><span class="op" id="5023435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023440">extraLengthBits</span>&nbsp;<span class="op" id="5023456">:=</span>&nbsp;<span class="builtintype" id="5023459">int32</span><span class="op" id="5023464">(</span><span class="ident" id="5023465">lengthExtraBits</span><span class="op" id="5023480">[</span><span class="ident" id="5023481">lengthCode</span><span class="op" id="5023491">]</span><span class="op" id="5023492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023497">if</span>&nbsp;<span class="ident" id="5023500">extraLengthBits</span>&nbsp;<span class="op" id="5023516">&gt;</span>&nbsp;<span class="num" id="5023518">0</span>&nbsp;<span class="op" id="5023520">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023526">extraLength</span>&nbsp;<span class="op" id="5023538">:=</span>&nbsp;<span class="builtintype" id="5023541">int32</span><span class="op" id="5023546">(</span><span class="ident" id="5023547">length</span>&nbsp;<span class="op" id="5023554">-</span>&nbsp;<span class="ident" id="5023556">lengthBase</span><span class="op" id="5023566">[</span><span class="ident" id="5023567">lengthCode</span><span class="op" id="5023577">]</span><span class="op" id="5023578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023584">w</span><span class="op" id="5023585">.</span><span class="ident" id="5023586">writeBits</span><span class="op" id="5023595">(</span><span class="ident" id="5023596">extraLength</span><span class="op" id="5023607">,</span>&nbsp;<span class="ident" id="5023609">extraLengthBits</span><span class="op" id="5023624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023634">//&nbsp;Write&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023657">offset</span>&nbsp;<span class="op" id="5023664">:=</span>&nbsp;<span class="ident" id="5023667">t</span><span class="op" id="5023668">.</span><span class="ident" id="5023669">offset</span><span class="op" id="5023675">(</span><span class="op" id="5023676">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023681">offsetCode</span>&nbsp;<span class="op" id="5023692">:=</span>&nbsp;<span class="ident" id="5023695">offsetCode</span><span class="op" id="5023705">(</span><span class="ident" id="5023706">offset</span><span class="op" id="5023712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023717">w</span><span class="op" id="5023718">.</span><span class="ident" id="5023719">writeCode</span><span class="op" id="5023728">(</span><span class="ident" id="5023729">offsetEncoding</span><span class="op" id="5023743">,</span>&nbsp;<span class="ident" id="5023745">offsetCode</span><span class="op" id="5023755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023760">extraOffsetBits</span>&nbsp;<span class="op" id="5023776">:=</span>&nbsp;<span class="builtintype" id="5023779">int32</span><span class="op" id="5023784">(</span><span class="ident" id="5023785">offsetExtraBits</span><span class="op" id="5023800">[</span><span class="ident" id="5023801">offsetCode</span><span class="op" id="5023811">]</span><span class="op" id="5023812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023817">if</span>&nbsp;<span class="ident" id="5023820">extraOffsetBits</span>&nbsp;<span class="op" id="5023836">&gt;</span>&nbsp;<span class="num" id="5023838">0</span>&nbsp;<span class="op" id="5023840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023846">extraOffset</span>&nbsp;<span class="op" id="5023858">:=</span>&nbsp;<span class="builtintype" id="5023861">int32</span><span class="op" id="5023866">(</span><span class="ident" id="5023867">offset</span>&nbsp;<span class="op" id="5023874">-</span>&nbsp;<span class="ident" id="5023876">offsetBase</span><span class="op" id="5023886">[</span><span class="ident" id="5023887">offsetCode</span><span class="op" id="5023897">]</span><span class="op" id="5023898">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023904">w</span><span class="op" id="5023905">.</span><span class="ident" id="5023906">writeBits</span><span class="op" id="5023915">(</span><span class="ident" id="5023916">extraOffset</span><span class="op" id="5023927">,</span>&nbsp;<span class="ident" id="5023929">extraOffsetBits</span><span class="op" id="5023944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023954">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023962">default</span><span class="op" id="5023969">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5023974">panic</span><span class="op" id="5023979">(</span><span class="string" id="5023980">&#34;unknown&nbsp;token&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="5024003">+</span>&nbsp;<span class="builtintype" id="5024005">string</span><span class="op" id="5024011">(</span><span class="ident" id="5024012">t</span><span class="op" id="5024013">)</span><span class="op" id="5024014">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024021">}</span><br>
<span class="lineno"></span><span class="op" id="5024023">}</span>
</div>
</body>
</html>
