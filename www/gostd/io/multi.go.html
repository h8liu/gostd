<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1424253">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1424308">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1424362">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1424413">package</span>&nbsp;<span class="ident" id="1424421">io</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1424425">type</span>&nbsp;<span class="ident" id="1424430">multiReader</span>&nbsp;<span class="keyword" id="1424442">struct</span>&nbsp;<span class="op" id="1424449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424452">readers</span>&nbsp;<span class="op" id="1424460">[</span><span class="op" id="1424461">]</span><span class="ident" id="1424462">Reader</span><br>
<span class="lineno"></span><span class="op" id="1424469">}</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1424472">func</span>&nbsp;<span class="op" id="1424477">(</span><span class="ident" id="1424478">mr</span>&nbsp;<span class="op" id="1424481">*</span><span class="ident" id="1424482">multiReader</span><span class="op" id="1424493">)</span>&nbsp;<span class="ident" id="1424495">Read</span><span class="op" id="1424499">(</span><span class="ident" id="1424500">p</span>&nbsp;<span class="op" id="1424502">[</span><span class="op" id="1424503">]</span><span class="builtintype" id="1424504">byte</span><span class="op" id="1424508">)</span>&nbsp;<span class="op" id="1424510">(</span><span class="ident" id="1424511">n</span>&nbsp;<span class="builtintype" id="1424513">int</span><span class="op" id="1424516">,</span>&nbsp;<span class="ident" id="1424518">err</span>&nbsp;<span class="builtintype" id="1424522">error</span><span class="op" id="1424527">)</span>&nbsp;<span class="op" id="1424529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424532">for</span>&nbsp;<span class="builtinfunc" id="1424536">len</span><span class="op" id="1424539">(</span><span class="ident" id="1424540">mr</span><span class="op" id="1424542">.</span><span class="ident" id="1424543">readers</span><span class="op" id="1424550">)</span>&nbsp;<span class="op" id="1424552">&gt;</span>&nbsp;<span class="num" id="1424554">0</span>&nbsp;<span class="op" id="1424556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424560">n</span><span class="op" id="1424561">,</span>&nbsp;<span class="ident" id="1424563">err</span>&nbsp;<span class="op" id="1424567">=</span>&nbsp;<span class="ident" id="1424569">mr</span><span class="op" id="1424571">.</span><span class="ident" id="1424572">readers</span><span class="op" id="1424579">[</span><span class="num" id="1424580">0</span><span class="op" id="1424581">]</span><span class="op" id="1424582">.</span><span class="ident" id="1424583">Read</span><span class="op" id="1424587">(</span><span class="ident" id="1424588">p</span><span class="op" id="1424589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424593">if</span>&nbsp;<span class="ident" id="1424596">n</span>&nbsp;<span class="op" id="1424598">&gt;</span>&nbsp;<span class="num" id="1424600">0</span>&nbsp;<span class="op" id="1424602">||</span>&nbsp;<span class="ident" id="1424605">err</span>&nbsp;<span class="op" id="1424609">!=</span>&nbsp;<span class="ident" id="1424612">EOF</span>&nbsp;<span class="op" id="1424616">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424621">if</span>&nbsp;<span class="ident" id="1424624">err</span>&nbsp;<span class="op" id="1424628">==</span>&nbsp;<span class="ident" id="1424631">EOF</span>&nbsp;<span class="op" id="1424635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1424641">//&nbsp;Don&#39;t&nbsp;return&nbsp;EOF&nbsp;yet.&nbsp;There&nbsp;may&nbsp;be&nbsp;more&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1424694">//&nbsp;in&nbsp;the&nbsp;remaining&nbsp;readers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424727">err</span>&nbsp;<span class="op" id="1424731">=</span>&nbsp;<span class="ident" id="1424733">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424740">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424745">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1424758">mr</span><span class="op" id="1424760">.</span><span class="ident" id="1424761">readers</span>&nbsp;<span class="op" id="1424769">=</span>&nbsp;<span class="ident" id="1424771">mr</span><span class="op" id="1424773">.</span><span class="ident" id="1424774">readers</span><span class="op" id="1424781">[</span><span class="num" id="1424782">1</span><span class="op" id="1424783">:</span><span class="op" id="1424784">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1424787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1424790">return</span>&nbsp;<span class="num" id="1424797">0</span><span class="op" id="1424798">,</span>&nbsp;<span class="ident" id="1424800">EOF</span><br>
<span class="lineno">25</span><span class="op" id="1424804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424807">//&nbsp;MultiReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&#39;s&nbsp;the&nbsp;logical&nbsp;concatenation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1424875">//&nbsp;the&nbsp;provided&nbsp;input&nbsp;readers.&nbsp;&nbsp;They&#39;re&nbsp;read&nbsp;sequentially.&nbsp;&nbsp;Once&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="1424944">//&nbsp;inputs&nbsp;have&nbsp;returned&nbsp;EOF,&nbsp;Read&nbsp;will&nbsp;return&nbsp;EOF.&nbsp;&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;readers</span><br>
<span class="lineno">30</span><span class="comment" id="1425018">//&nbsp;return&nbsp;a&nbsp;non-nil,&nbsp;non-EOF&nbsp;error,&nbsp;Read&nbsp;will&nbsp;return&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="1425083">func</span>&nbsp;<span class="ident" id="1425088">MultiReader</span><span class="op" id="1425099">(</span><span class="ident" id="1425100">readers</span>&nbsp;<span class="op" id="1425108">...</span><span class="ident" id="1425111">Reader</span><span class="op" id="1425117">)</span>&nbsp;<span class="ident" id="1425119">Reader</span>&nbsp;<span class="op" id="1425126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425129">r</span>&nbsp;<span class="op" id="1425131">:=</span>&nbsp;<span class="builtinfunc" id="1425134">make</span><span class="op" id="1425138">(</span><span class="op" id="1425139">[</span><span class="op" id="1425140">]</span><span class="ident" id="1425141">Reader</span><span class="op" id="1425147">,</span>&nbsp;<span class="builtinfunc" id="1425149">len</span><span class="op" id="1425152">(</span><span class="ident" id="1425153">readers</span><span class="op" id="1425160">)</span><span class="op" id="1425161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1425164">copy</span><span class="op" id="1425168">(</span><span class="ident" id="1425169">r</span><span class="op" id="1425170">,</span>&nbsp;<span class="ident" id="1425172">readers</span><span class="op" id="1425179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425182">return</span>&nbsp;<span class="op" id="1425189">&amp;</span><span class="ident" id="1425190">multiReader</span><span class="op" id="1425201">{</span><span class="ident" id="1425202">r</span><span class="op" id="1425203">}</span><br>
<span class="lineno">35</span><span class="op" id="1425205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1425208">type</span>&nbsp;<span class="ident" id="1425213">multiWriter</span>&nbsp;<span class="keyword" id="1425225">struct</span>&nbsp;<span class="op" id="1425232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425235">writers</span>&nbsp;<span class="op" id="1425243">[</span><span class="op" id="1425244">]</span><span class="ident" id="1425245">Writer</span><br>
<span class="lineno"></span><span class="op" id="1425252">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1425255">func</span>&nbsp;<span class="op" id="1425260">(</span><span class="ident" id="1425261">t</span>&nbsp;<span class="op" id="1425263">*</span><span class="ident" id="1425264">multiWriter</span><span class="op" id="1425275">)</span>&nbsp;<span class="ident" id="1425277">Write</span><span class="op" id="1425282">(</span><span class="ident" id="1425283">p</span>&nbsp;<span class="op" id="1425285">[</span><span class="op" id="1425286">]</span><span class="builtintype" id="1425287">byte</span><span class="op" id="1425291">)</span>&nbsp;<span class="op" id="1425293">(</span><span class="ident" id="1425294">n</span>&nbsp;<span class="builtintype" id="1425296">int</span><span class="op" id="1425299">,</span>&nbsp;<span class="ident" id="1425301">err</span>&nbsp;<span class="builtintype" id="1425305">error</span><span class="op" id="1425310">)</span>&nbsp;<span class="op" id="1425312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425315">for</span>&nbsp;<span class="ident" id="1425319">_</span><span class="op" id="1425320">,</span>&nbsp;<span class="ident" id="1425322">w</span>&nbsp;<span class="op" id="1425324">:=</span>&nbsp;<span class="keyword" id="1425327">range</span>&nbsp;<span class="ident" id="1425333">t</span><span class="op" id="1425334">.</span><span class="ident" id="1425335">writers</span>&nbsp;<span class="op" id="1425343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425347">n</span><span class="op" id="1425348">,</span>&nbsp;<span class="ident" id="1425350">err</span>&nbsp;<span class="op" id="1425354">=</span>&nbsp;<span class="ident" id="1425356">w</span><span class="op" id="1425357">.</span><span class="ident" id="1425358">Write</span><span class="op" id="1425363">(</span><span class="ident" id="1425364">p</span><span class="op" id="1425365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425369">if</span>&nbsp;<span class="ident" id="1425372">err</span>&nbsp;<span class="op" id="1425376">!=</span>&nbsp;<span class="ident" id="1425379">nil</span>&nbsp;<span class="op" id="1425383">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425388">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1425397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425401">if</span>&nbsp;<span class="ident" id="1425404">n</span>&nbsp;<span class="op" id="1425406">!=</span>&nbsp;<span class="builtinfunc" id="1425409">len</span><span class="op" id="1425412">(</span><span class="ident" id="1425413">p</span><span class="op" id="1425414">)</span>&nbsp;<span class="op" id="1425416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425421">err</span>&nbsp;<span class="op" id="1425425">=</span>&nbsp;<span class="ident" id="1425427">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425444">return</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1425453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1425456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425459">return</span>&nbsp;<span class="builtinfunc" id="1425466">len</span><span class="op" id="1425469">(</span><span class="ident" id="1425470">p</span><span class="op" id="1425471">)</span><span class="op" id="1425472">,</span>&nbsp;<span class="ident" id="1425474">nil</span><br>
<span class="lineno"></span><span class="op" id="1425478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1425481">//&nbsp;MultiWriter&nbsp;creates&nbsp;a&nbsp;writer&nbsp;that&nbsp;duplicates&nbsp;its&nbsp;writes&nbsp;to&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1425551">//&nbsp;provided&nbsp;writers,&nbsp;similar&nbsp;to&nbsp;the&nbsp;Unix&nbsp;tee(1)&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="1425608">func</span>&nbsp;<span class="ident" id="1425613">MultiWriter</span><span class="op" id="1425624">(</span><span class="ident" id="1425625">writers</span>&nbsp;<span class="op" id="1425633">...</span><span class="ident" id="1425636">Writer</span><span class="op" id="1425642">)</span>&nbsp;<span class="ident" id="1425644">Writer</span>&nbsp;<span class="op" id="1425651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425654">w</span>&nbsp;<span class="op" id="1425656">:=</span>&nbsp;<span class="builtinfunc" id="1425659">make</span><span class="op" id="1425663">(</span><span class="op" id="1425664">[</span><span class="op" id="1425665">]</span><span class="ident" id="1425666">Writer</span><span class="op" id="1425672">,</span>&nbsp;<span class="builtinfunc" id="1425674">len</span><span class="op" id="1425677">(</span><span class="ident" id="1425678">writers</span><span class="op" id="1425685">)</span><span class="op" id="1425686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1425689">copy</span><span class="op" id="1425693">(</span><span class="ident" id="1425694">w</span><span class="op" id="1425695">,</span>&nbsp;<span class="ident" id="1425697">writers</span><span class="op" id="1425704">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425707">return</span>&nbsp;<span class="op" id="1425714">&amp;</span><span class="ident" id="1425715">multiWriter</span><span class="op" id="1425726">{</span><span class="ident" id="1425727">w</span><span class="op" id="1425728">}</span><br>
<span class="lineno"></span><span class="op" id="1425730">}</span>
</div>
</body>
</html>
