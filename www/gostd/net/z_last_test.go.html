<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html" class="current">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8168613">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8168668">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8168722">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8168773">package</span>&nbsp;<span class="ident" id="8168781">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8168786">import</span>&nbsp;<span class="op" id="8168793">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8168796">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8168804">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8168811">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8168822">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8168829">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8168832">var</span>&nbsp;<span class="ident" id="8168836">testDNSFlood</span>&nbsp;<span class="op" id="8168849">=</span>&nbsp;<span class="ident" id="8168851">flag</span><span class="op" id="8168855">.</span><span class="ident" id="8168856">Bool</span><span class="op" id="8168860">(</span><span class="string" id="8168861">&#34;dnsflood&#34;</span><span class="op" id="8168871">,</span>&nbsp;<span class="builtintype" id="8168873">false</span><span class="op" id="8168878">,</span>&nbsp;<span class="string" id="8168880">&#34;whether&nbsp;to&nbsp;test&nbsp;dns&nbsp;query&nbsp;flooding&#34;</span><span class="op" id="8168916">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8168919">func</span>&nbsp;<span class="ident" id="8168924">TestDNSThreadLimit</span><span class="op" id="8168942">(</span><span class="ident" id="8168943">t</span>&nbsp;<span class="op" id="8168945">*</span><span class="ident" id="8168946">testing</span><span class="op" id="8168953">.</span><span class="ident" id="8168954">T</span><span class="op" id="8168955">)</span>&nbsp;<span class="op" id="8168957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8168960">if</span>&nbsp;<span class="op" id="8168963">!</span><span class="op" id="8168964">*</span><span class="ident" id="8168965">testDNSFlood</span>&nbsp;<span class="op" id="8168978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8168982">t</span><span class="op" id="8168983">.</span><span class="ident" id="8168984">Skip</span><span class="op" id="8168988">(</span><span class="string" id="8168989">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="8169029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8169032">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8169036">const</span>&nbsp;<span class="ident" id="8169042">N</span>&nbsp;<span class="op" id="8169044">=</span>&nbsp;<span class="num" id="8169046">10000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169053">c</span>&nbsp;<span class="op" id="8169055">:=</span>&nbsp;<span class="builtinfunc" id="8169058">make</span><span class="op" id="8169062">(</span><span class="keyword" id="8169063">chan</span>&nbsp;<span class="builtintype" id="8169068">int</span><span class="op" id="8169071">,</span>&nbsp;<span class="ident" id="8169073">N</span><span class="op" id="8169074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8169077">for</span>&nbsp;<span class="ident" id="8169081">i</span>&nbsp;<span class="op" id="8169083">:=</span>&nbsp;<span class="num" id="8169086">0</span><span class="op" id="8169087">;</span>&nbsp;<span class="ident" id="8169089">i</span>&nbsp;<span class="op" id="8169091">&lt;</span>&nbsp;<span class="ident" id="8169093">N</span><span class="op" id="8169094">;</span>&nbsp;<span class="ident" id="8169096">i</span><span class="op" id="8169097">++</span>&nbsp;<span class="op" id="8169100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8169104">go</span>&nbsp;<span class="keyword" id="8169107">func</span><span class="op" id="8169111">(</span><span class="ident" id="8169112">i</span>&nbsp;<span class="builtintype" id="8169114">int</span><span class="op" id="8169117">)</span>&nbsp;<span class="op" id="8169119">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169124">LookupIP</span><span class="op" id="8169132">(</span><span class="ident" id="8169133">fmt</span><span class="op" id="8169136">.</span><span class="ident" id="8169137">Sprintf</span><span class="op" id="8169144">(</span><span class="string" id="8169145">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="8169169">,</span>&nbsp;<span class="ident" id="8169171">i</span><span class="op" id="8169172">)</span><span class="op" id="8169173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169178">c</span>&nbsp;<span class="op" id="8169180">&lt;-</span>&nbsp;<span class="num" id="8169183">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8169187">}</span><span class="op" id="8169188">(</span><span class="ident" id="8169189">i</span><span class="op" id="8169190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8169193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8169196">//&nbsp;Don&#39;t&nbsp;bother&nbsp;waiting&nbsp;for&nbsp;the&nbsp;stragglers;&nbsp;stop&nbsp;at&nbsp;0.9&nbsp;N.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8169256">for</span>&nbsp;<span class="ident" id="8169260">i</span>&nbsp;<span class="op" id="8169262">:=</span>&nbsp;<span class="num" id="8169265">0</span><span class="op" id="8169266">;</span>&nbsp;<span class="ident" id="8169268">i</span>&nbsp;<span class="op" id="8169270">&lt;</span>&nbsp;<span class="ident" id="8169272">N</span><span class="op" id="8169273">*</span><span class="num" id="8169274">9</span><span class="op" id="8169275">/</span><span class="num" id="8169276">10</span><span class="op" id="8169278">;</span>&nbsp;<span class="ident" id="8169280">i</span><span class="op" id="8169281">++</span>&nbsp;<span class="op" id="8169284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8169288">if</span>&nbsp;<span class="ident" id="8169291">i</span><span class="op" id="8169292">%</span><span class="num" id="8169293">100</span>&nbsp;<span class="op" id="8169297">==</span>&nbsp;<span class="num" id="8169300">0</span>&nbsp;<span class="op" id="8169302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8169307">//println(&#34;TestDNSThreadLimit:&#34;,&nbsp;i)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8169345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8169349">&lt;-</span><span class="ident" id="8169351">c</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8169354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8169358">//&nbsp;If&nbsp;we&#39;re&nbsp;still&nbsp;here,&nbsp;it&nbsp;worked.</span><br>
<span class="lineno"></span><span class="op" id="8169393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="8169396">func</span>&nbsp;<span class="ident" id="8169401">TestLookupIPDeadline</span><span class="op" id="8169421">(</span><span class="ident" id="8169422">t</span>&nbsp;<span class="op" id="8169424">*</span><span class="ident" id="8169425">testing</span><span class="op" id="8169432">.</span><span class="ident" id="8169433">T</span><span class="op" id="8169434">)</span>&nbsp;<span class="op" id="8169436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8169439">if</span>&nbsp;<span class="op" id="8169442">!</span><span class="op" id="8169443">*</span><span class="ident" id="8169444">testDNSFlood</span>&nbsp;<span class="op" id="8169457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169461">t</span><span class="op" id="8169462">.</span><span class="ident" id="8169463">Skip</span><span class="op" id="8169467">(</span><span class="string" id="8169468">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="8169508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8169511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8169515">const</span>&nbsp;<span class="ident" id="8169521">N</span>&nbsp;<span class="op" id="8169523">=</span>&nbsp;<span class="num" id="8169525">5000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8169531">const</span>&nbsp;<span class="ident" id="8169537">timeout</span>&nbsp;<span class="op" id="8169545">=</span>&nbsp;<span class="num" id="8169547">3</span>&nbsp;<span class="op" id="8169549">*</span>&nbsp;<span class="ident" id="8169551">time</span><span class="op" id="8169555">.</span><span class="ident" id="8169556">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169564">c</span>&nbsp;<span class="op" id="8169566">:=</span>&nbsp;<span class="builtinfunc" id="8169569">make</span><span class="op" id="8169573">(</span><span class="keyword" id="8169574">chan</span>&nbsp;<span class="builtintype" id="8169579">error</span><span class="op" id="8169584">,</span>&nbsp;<span class="num" id="8169586">2</span><span class="op" id="8169587">*</span><span class="ident" id="8169588">N</span><span class="op" id="8169589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8169592">for</span>&nbsp;<span class="ident" id="8169596">i</span>&nbsp;<span class="op" id="8169598">:=</span>&nbsp;<span class="num" id="8169601">0</span><span class="op" id="8169602">;</span>&nbsp;<span class="ident" id="8169604">i</span>&nbsp;<span class="op" id="8169606">&lt;</span>&nbsp;<span class="ident" id="8169608">N</span><span class="op" id="8169609">;</span>&nbsp;<span class="ident" id="8169611">i</span><span class="op" id="8169612">++</span>&nbsp;<span class="op" id="8169615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169619">name</span>&nbsp;<span class="op" id="8169624">:=</span>&nbsp;<span class="ident" id="8169627">fmt</span><span class="op" id="8169630">.</span><span class="ident" id="8169631">Sprintf</span><span class="op" id="8169638">(</span><span class="string" id="8169639">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="8169663">,</span>&nbsp;<span class="ident" id="8169665">i</span><span class="op" id="8169666">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8169670">go</span>&nbsp;<span class="keyword" id="8169673">func</span><span class="op" id="8169677">(</span><span class="op" id="8169678">)</span>&nbsp;<span class="op" id="8169680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169685">_</span><span class="op" id="8169686">,</span>&nbsp;<span class="ident" id="8169688">err</span>&nbsp;<span class="op" id="8169692">:=</span>&nbsp;<span class="ident" id="8169695">lookupIPDeadline</span><span class="op" id="8169711">(</span><span class="ident" id="8169712">name</span><span class="op" id="8169716">,</span>&nbsp;<span class="ident" id="8169718">time</span><span class="op" id="8169722">.</span><span class="ident" id="8169723">Now</span><span class="op" id="8169726">(</span><span class="op" id="8169727">)</span><span class="op" id="8169728">.</span><span class="ident" id="8169729">Add</span><span class="op" id="8169732">(</span><span class="ident" id="8169733">timeout</span><span class="op" id="8169740">/</span><span class="num" id="8169741">2</span><span class="op" id="8169742">)</span><span class="op" id="8169743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169748">c</span>&nbsp;<span class="op" id="8169750">&lt;-</span>&nbsp;<span class="ident" id="8169753">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8169759">}</span><span class="op" id="8169760">(</span><span class="op" id="8169761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8169765">go</span>&nbsp;<span class="keyword" id="8169768">func</span><span class="op" id="8169772">(</span><span class="op" id="8169773">)</span>&nbsp;<span class="op" id="8169775">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169780">_</span><span class="op" id="8169781">,</span>&nbsp;<span class="ident" id="8169783">err</span>&nbsp;<span class="op" id="8169787">:=</span>&nbsp;<span class="ident" id="8169790">lookupIPDeadline</span><span class="op" id="8169806">(</span><span class="ident" id="8169807">name</span><span class="op" id="8169811">,</span>&nbsp;<span class="ident" id="8169813">time</span><span class="op" id="8169817">.</span><span class="ident" id="8169818">Now</span><span class="op" id="8169821">(</span><span class="op" id="8169822">)</span><span class="op" id="8169823">.</span><span class="ident" id="8169824">Add</span><span class="op" id="8169827">(</span><span class="ident" id="8169828">timeout</span><span class="op" id="8169835">)</span><span class="op" id="8169836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169841">c</span>&nbsp;<span class="op" id="8169843">&lt;-</span>&nbsp;<span class="ident" id="8169846">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8169852">}</span><span class="op" id="8169853">(</span><span class="op" id="8169854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8169857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169860">qstats</span>&nbsp;<span class="op" id="8169867">:=</span>&nbsp;<span class="keyword" id="8169870">struct</span>&nbsp;<span class="op" id="8169877">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169881">succeeded</span><span class="op" id="8169890">,</span>&nbsp;<span class="ident" id="8169892">failed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8169907">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169913">timeout</span><span class="op" id="8169920">,</span>&nbsp;<span class="ident" id="8169922">temporary</span><span class="op" id="8169931">,</span>&nbsp;<span class="ident" id="8169933">other</span>&nbsp;<span class="builtintype" id="8169939">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169945">unknown</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8169971">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8169976">}</span><span class="op" id="8169977">{</span><span class="op" id="8169978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169981">deadline</span>&nbsp;<span class="op" id="8169990">:=</span>&nbsp;<span class="ident" id="8169993">time</span><span class="op" id="8169997">.</span><span class="ident" id="8169998">After</span><span class="op" id="8170003">(</span><span class="ident" id="8170004">timeout</span>&nbsp;<span class="op" id="8170012">+</span>&nbsp;<span class="ident" id="8170014">time</span><span class="op" id="8170018">.</span><span class="ident" id="8170019">Second</span><span class="op" id="8170025">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8170028">for</span>&nbsp;<span class="ident" id="8170032">i</span>&nbsp;<span class="op" id="8170034">:=</span>&nbsp;<span class="num" id="8170037">0</span><span class="op" id="8170038">;</span>&nbsp;<span class="ident" id="8170040">i</span>&nbsp;<span class="op" id="8170042">&lt;</span>&nbsp;<span class="num" id="8170044">2</span><span class="op" id="8170045">*</span><span class="ident" id="8170046">N</span><span class="op" id="8170047">;</span>&nbsp;<span class="ident" id="8170049">i</span><span class="op" id="8170050">++</span>&nbsp;<span class="op" id="8170053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8170057">select</span>&nbsp;<span class="op" id="8170064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8170068">case</span>&nbsp;<span class="op" id="8170073">&lt;-</span><span class="ident" id="8170075">deadline</span><span class="op" id="8170083">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8170088">t</span><span class="op" id="8170089">.</span><span class="ident" id="8170090">Fatal</span><span class="op" id="8170095">(</span><span class="string" id="8170096">&#34;deadline&nbsp;exceeded&#34;</span><span class="op" id="8170115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8170119">case</span>&nbsp;<span class="ident" id="8170124">err</span>&nbsp;<span class="op" id="8170128">:=</span>&nbsp;<span class="op" id="8170131">&lt;-</span><span class="ident" id="8170133">c</span><span class="op" id="8170134">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8170139">switch</span>&nbsp;<span class="ident" id="8170146">err</span>&nbsp;<span class="op" id="8170150">:=</span>&nbsp;<span class="ident" id="8170153">err</span><span class="op" id="8170156">.</span><span class="op" id="8170157">(</span><span class="keyword" id="8170158">type</span><span class="op" id="8170162">)</span>&nbsp;<span class="op" id="8170164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8170169">case</span>&nbsp;<span class="ident" id="8170174">nil</span><span class="op" id="8170177">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8170183">qstats</span><span class="op" id="8170189">.</span><span class="ident" id="8170190">succeeded</span><span class="op" id="8170199">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8170205">case</span>&nbsp;<span class="ident" id="8170210">Error</span><span class="op" id="8170215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8170221">qstats</span><span class="op" id="8170227">.</span><span class="ident" id="8170228">failed</span><span class="op" id="8170234">++</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8170241">if</span>&nbsp;<span class="ident" id="8170244">err</span><span class="op" id="8170247">.</span><span class="ident" id="8170248">Timeout</span><span class="op" id="8170255">(</span><span class="op" id="8170256">)</span>&nbsp;<span class="op" id="8170258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8170265">qstats</span><span class="op" id="8170271">.</span><span class="ident" id="8170272">timeout</span><span class="op" id="8170279">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8170286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8170292">if</span>&nbsp;<span class="ident" id="8170295">err</span><span class="op" id="8170298">.</span><span class="ident" id="8170299">Temporary</span><span class="op" id="8170308">(</span><span class="op" id="8170309">)</span>&nbsp;<span class="op" id="8170311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8170318">qstats</span><span class="op" id="8170324">.</span><span class="ident" id="8170325">temporary</span><span class="op" id="8170334">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8170341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8170347">if</span>&nbsp;<span class="op" id="8170350">!</span><span class="ident" id="8170351">err</span><span class="op" id="8170354">.</span><span class="ident" id="8170355">Timeout</span><span class="op" id="8170362">(</span><span class="op" id="8170363">)</span>&nbsp;<span class="op" id="8170365">&amp;&amp;</span>&nbsp;<span class="op" id="8170368">!</span><span class="ident" id="8170369">err</span><span class="op" id="8170372">.</span><span class="ident" id="8170373">Temporary</span><span class="op" id="8170382">(</span><span class="op" id="8170383">)</span>&nbsp;<span class="op" id="8170385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8170392">qstats</span><span class="op" id="8170398">.</span><span class="ident" id="8170399">other</span><span class="op" id="8170404">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8170411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8170416">default</span><span class="op" id="8170423">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8170429">qstats</span><span class="op" id="8170435">.</span><span class="ident" id="8170436">failed</span><span class="op" id="8170442">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8170449">qstats</span><span class="op" id="8170455">.</span><span class="ident" id="8170456">unknown</span><span class="op" id="8170463">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8170469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8170473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8170476">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8170480">//&nbsp;A&nbsp;high&nbsp;volume&nbsp;of&nbsp;DNS&nbsp;queries&nbsp;for&nbsp;sub-domain&nbsp;of&nbsp;golang.org</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8170542">//&nbsp;would&nbsp;be&nbsp;coordinated&nbsp;by&nbsp;authoritative&nbsp;or&nbsp;recursive&nbsp;server,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8170605">//&nbsp;or&nbsp;stub&nbsp;resolver&nbsp;which&nbsp;implements&nbsp;query-response&nbsp;rate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8170663">//&nbsp;limitation,&nbsp;so&nbsp;we&nbsp;can&nbsp;expect&nbsp;some&nbsp;query&nbsp;successes&nbsp;and&nbsp;more</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8170726">//&nbsp;failures&nbsp;including&nbsp;timeout,&nbsp;temporary&nbsp;and&nbsp;other&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8170784">//&nbsp;As&nbsp;a&nbsp;rule,&nbsp;unknown&nbsp;must&nbsp;not&nbsp;be&nbsp;shown&nbsp;but&nbsp;it&nbsp;might&nbsp;possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8170847">//&nbsp;happen&nbsp;due&nbsp;to&nbsp;issue&nbsp;4856&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8170885">t</span><span class="op" id="8170886">.</span><span class="ident" id="8170887">Logf</span><span class="op" id="8170891">(</span><span class="string" id="8170892">&#34;%v&nbsp;succeeded,&nbsp;%v&nbsp;failed&nbsp;(%v&nbsp;timeout,&nbsp;%v&nbsp;temporary,&nbsp;%v&nbsp;other,&nbsp;%v&nbsp;unknown)&#34;</span><span class="op" id="8170966">,</span>&nbsp;<span class="ident" id="8170968">qstats</span><span class="op" id="8170974">.</span><span class="ident" id="8170975">succeeded</span><span class="op" id="8170984">,</span>&nbsp;<span class="ident" id="8170986">qstats</span><span class="op" id="8170992">.</span><span class="ident" id="8170993">failed</span><span class="op" id="8170999">,</span>&nbsp;<span class="ident" id="8171001">qstats</span><span class="op" id="8171007">.</span><span class="ident" id="8171008">timeout</span><span class="op" id="8171015">,</span>&nbsp;<span class="ident" id="8171017">qstats</span><span class="op" id="8171023">.</span><span class="ident" id="8171024">temporary</span><span class="op" id="8171033">,</span>&nbsp;<span class="ident" id="8171035">qstats</span><span class="op" id="8171041">.</span><span class="ident" id="8171042">other</span><span class="op" id="8171047">,</span>&nbsp;<span class="ident" id="8171049">qstats</span><span class="op" id="8171055">.</span><span class="ident" id="8171056">unknown</span><span class="op" id="8171063">)</span><br>
<span class="lineno"></span><span class="op" id="8171065">}</span>
</div>
</body>
</html>
