<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1403382">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1403438">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1403492">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1403543">//&nbsp;Cgo&nbsp;call&nbsp;and&nbsp;callback&nbsp;support.</span><br>
<span class="lineno"></span><span class="comment" id="1403577">//</span><br>
<span class="lineno"></span><span class="comment" id="1403580">//&nbsp;To&nbsp;call&nbsp;into&nbsp;the&nbsp;C&nbsp;function&nbsp;f&nbsp;from&nbsp;Go,&nbsp;the&nbsp;cgo-generated&nbsp;code&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1403651">//&nbsp;runtime.cgocall(_cgo_Cfunc_f,&nbsp;frame),&nbsp;where&nbsp;_cgo_Cfunc_f&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1403716">//&nbsp;gcc-compiled&nbsp;function&nbsp;written&nbsp;by&nbsp;cgo.</span><br>
<span class="lineno">10</span><span class="comment" id="1403757">//</span><br>
<span class="lineno"></span><span class="comment" id="1403760">//&nbsp;runtime.cgocall&nbsp;(below)&nbsp;locks&nbsp;g&nbsp;to&nbsp;m,&nbsp;calls&nbsp;entersyscall</span><br>
<span class="lineno"></span><span class="comment" id="1403820">//&nbsp;so&nbsp;as&nbsp;not&nbsp;to&nbsp;block&nbsp;other&nbsp;goroutines&nbsp;or&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span><span class="comment" id="1403885">//&nbsp;and&nbsp;then&nbsp;calls&nbsp;runtime.asmcgocall(_cgo_Cfunc_f,&nbsp;frame).</span><br>
<span class="lineno"></span><span class="comment" id="1403944">//</span><br>
<span class="lineno">15</span><span class="comment" id="1403947">//&nbsp;runtime.asmcgocall&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;to&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1404016">//&nbsp;(assumed&nbsp;to&nbsp;be&nbsp;an&nbsp;operating&nbsp;system-allocated&nbsp;stack,&nbsp;so&nbsp;safe&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="1404086">//&nbsp;gcc-compiled&nbsp;code&nbsp;on)&nbsp;and&nbsp;calls&nbsp;_cgo_Cfunc_f(frame).</span><br>
<span class="lineno"></span><span class="comment" id="1404142">//</span><br>
<span class="lineno"></span><span class="comment" id="1404145">//&nbsp;_cgo_Cfunc_f&nbsp;invokes&nbsp;the&nbsp;actual&nbsp;C&nbsp;function&nbsp;f&nbsp;with&nbsp;arguments</span><br>
<span class="lineno">20</span><span class="comment" id="1404208">//&nbsp;taken&nbsp;from&nbsp;the&nbsp;frame&nbsp;structure,&nbsp;records&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;frame,</span><br>
<span class="lineno"></span><span class="comment" id="1404277">//&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.asmcgocall.</span><br>
<span class="lineno"></span><span class="comment" id="1404315">//</span><br>
<span class="lineno"></span><span class="comment" id="1404318">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.asmcgocall&nbsp;switches&nbsp;back&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1404387">//&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocall.</span><br>
<span class="lineno">25</span><span class="comment" id="1404451">//</span><br>
<span class="lineno"></span><span class="comment" id="1404454">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocall&nbsp;calls&nbsp;exitsyscall,&nbsp;which&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="1404531">//&nbsp;until&nbsp;this&nbsp;m&nbsp;can&nbsp;run&nbsp;Go&nbsp;code&nbsp;without&nbsp;violating&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit,</span><br>
<span class="lineno"></span><span class="comment" id="1404604">//&nbsp;and&nbsp;then&nbsp;unlocks&nbsp;g&nbsp;from&nbsp;m.</span><br>
<span class="lineno"></span><span class="comment" id="1404634">//</span><br>
<span class="lineno">30</span><span class="comment" id="1404637">//&nbsp;The&nbsp;above&nbsp;description&nbsp;skipped&nbsp;over&nbsp;the&nbsp;possibility&nbsp;of&nbsp;the&nbsp;gcc-compiled</span><br>
<span class="lineno"></span><span class="comment" id="1404711">//&nbsp;function&nbsp;f&nbsp;calling&nbsp;back&nbsp;into&nbsp;Go.&nbsp;&nbsp;If&nbsp;that&nbsp;happens,&nbsp;we&nbsp;continue&nbsp;down</span><br>
<span class="lineno"></span><span class="comment" id="1404782">//&nbsp;the&nbsp;rabbit&nbsp;hole&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1404828">//</span><br>
<span class="lineno"></span><span class="comment" id="1404831">//&nbsp;To&nbsp;make&nbsp;it&nbsp;possible&nbsp;for&nbsp;gcc-compiled&nbsp;C&nbsp;code&nbsp;to&nbsp;call&nbsp;a&nbsp;Go&nbsp;function&nbsp;p.GoF,</span><br>
<span class="lineno">35</span><span class="comment" id="1404907">//&nbsp;cgo&nbsp;writes&nbsp;a&nbsp;gcc-compiled&nbsp;function&nbsp;named&nbsp;GoF&nbsp;(not&nbsp;p.GoF,&nbsp;since&nbsp;gcc&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1404985">//&nbsp;know&nbsp;about&nbsp;packages).&nbsp;&nbsp;The&nbsp;gcc-compiled&nbsp;C&nbsp;function&nbsp;f&nbsp;calls&nbsp;GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1405052">//</span><br>
<span class="lineno"></span><span class="comment" id="1405055">//&nbsp;GoF&nbsp;calls&nbsp;crosscall2(_cgoexp_GoF,&nbsp;frame,&nbsp;framesize).&nbsp;&nbsp;Crosscall2</span><br>
<span class="lineno"></span><span class="comment" id="1405123">//&nbsp;(in&nbsp;cgo/gcc_$GOARCH.S,&nbsp;a&nbsp;gcc-compiled&nbsp;assembly&nbsp;file)&nbsp;is&nbsp;a&nbsp;two-argument</span><br>
<span class="lineno">40</span><span class="comment" id="1405197">//&nbsp;adapter&nbsp;from&nbsp;the&nbsp;gcc&nbsp;function&nbsp;call&nbsp;ABI&nbsp;to&nbsp;the&nbsp;6c&nbsp;function&nbsp;call&nbsp;ABI.</span><br>
<span class="lineno"></span><span class="comment" id="1405268">//&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;gcc&nbsp;to&nbsp;call&nbsp;6c&nbsp;functions.&nbsp;&nbsp;In&nbsp;this&nbsp;case&nbsp;it&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1405338">//&nbsp;_cgoexp_GoF(frame,&nbsp;framesize),&nbsp;still&nbsp;running&nbsp;on&nbsp;m-&gt;g0&#39;s&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1405403">//&nbsp;and&nbsp;outside&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit.&nbsp;&nbsp;Thus,&nbsp;this&nbsp;code&nbsp;cannot&nbsp;yet</span><br>
<span class="lineno"></span><span class="comment" id="1405469">//&nbsp;call&nbsp;arbitrary&nbsp;Go&nbsp;code&nbsp;directly&nbsp;and&nbsp;must&nbsp;be&nbsp;careful&nbsp;not&nbsp;to&nbsp;allocate</span><br>
<span class="lineno">45</span><span class="comment" id="1405540">//&nbsp;memory&nbsp;or&nbsp;use&nbsp;up&nbsp;m-&gt;g0&#39;s&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1405575">//</span><br>
<span class="lineno"></span><span class="comment" id="1405578">//&nbsp;_cgoexp_GoF&nbsp;calls&nbsp;runtime.cgocallback(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1405645">//&nbsp;(The&nbsp;reason&nbsp;for&nbsp;having&nbsp;_cgoexp_GoF&nbsp;instead&nbsp;of&nbsp;writing&nbsp;a&nbsp;crosscall3</span><br>
<span class="lineno"></span><span class="comment" id="1405715">//&nbsp;to&nbsp;make&nbsp;this&nbsp;call&nbsp;directly&nbsp;is&nbsp;that&nbsp;_cgoexp_GoF,&nbsp;because&nbsp;it&nbsp;is&nbsp;compiled</span><br>
<span class="lineno">50</span><span class="comment" id="1405789">//&nbsp;with&nbsp;6c&nbsp;instead&nbsp;of&nbsp;gcc,&nbsp;can&nbsp;refer&nbsp;to&nbsp;dotted&nbsp;names&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="1405847">//&nbsp;runtime.cgocallback&nbsp;and&nbsp;p.GoF.)</span><br>
<span class="lineno"></span><span class="comment" id="1405882">//</span><br>
<span class="lineno"></span><span class="comment" id="1405885">//&nbsp;runtime.cgocallback&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;from&nbsp;m-&gt;g0&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1405949">//&nbsp;stack&nbsp;to&nbsp;the&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack,&nbsp;on&nbsp;which&nbsp;it&nbsp;calls</span><br>
<span class="lineno">55</span><span class="comment" id="1406013">//&nbsp;runtime.cgocallbackg(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1406063">//&nbsp;As&nbsp;part&nbsp;of&nbsp;the&nbsp;stack&nbsp;switch,&nbsp;runtime.cgocallback&nbsp;saves&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="1406133">//&nbsp;SP&nbsp;as&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;so&nbsp;that&nbsp;any&nbsp;use&nbsp;of&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1406203">//&nbsp;execution&nbsp;of&nbsp;the&nbsp;callback&nbsp;will&nbsp;be&nbsp;done&nbsp;below&nbsp;the&nbsp;existing&nbsp;stack&nbsp;frames.</span><br>
<span class="lineno"></span><span class="comment" id="1406278">//&nbsp;Before&nbsp;overwriting&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;it&nbsp;pushes&nbsp;the&nbsp;old&nbsp;value&nbsp;on&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="1406348">//&nbsp;m-&gt;g0&nbsp;stack,&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;restored&nbsp;later.</span><br>
<span class="lineno"></span><span class="comment" id="1406398">//</span><br>
<span class="lineno"></span><span class="comment" id="1406401">//&nbsp;runtime.cgocallbackg&nbsp;(below)&nbsp;is&nbsp;now&nbsp;running&nbsp;on&nbsp;a&nbsp;real&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1406468">//&nbsp;stack&nbsp;(not&nbsp;an&nbsp;m-&gt;g0&nbsp;stack).&nbsp;&nbsp;First&nbsp;it&nbsp;calls&nbsp;runtime.exitsyscall,&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="1406547">//&nbsp;block&nbsp;until&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit&nbsp;allows&nbsp;running&nbsp;this&nbsp;goroutine.</span><br>
<span class="lineno">65</span><span class="comment" id="1406615">//&nbsp;Once&nbsp;exitsyscall&nbsp;has&nbsp;returned,&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;call&nbsp;the&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="1406694">//&nbsp;allocator&nbsp;or&nbsp;invoke&nbsp;the&nbsp;Go&nbsp;callback&nbsp;function&nbsp;p.GoF.&nbsp;&nbsp;runtime.cgocallbackg</span><br>
<span class="lineno"></span><span class="comment" id="1406771">//&nbsp;first&nbsp;defers&nbsp;a&nbsp;function&nbsp;to&nbsp;unwind&nbsp;m-&gt;g0.sched.sp,&nbsp;so&nbsp;that&nbsp;if&nbsp;p.GoF</span><br>
<span class="lineno"></span><span class="comment" id="1406841">//&nbsp;panics,&nbsp;m-&gt;g0.sched.sp&nbsp;will&nbsp;be&nbsp;restored&nbsp;to&nbsp;its&nbsp;old&nbsp;value:&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1406918">//&nbsp;and&nbsp;the&nbsp;m-&gt;curg&nbsp;stack&nbsp;will&nbsp;be&nbsp;unwound&nbsp;in&nbsp;lock&nbsp;step.</span><br>
<span class="lineno">70</span><span class="comment" id="1406973">//&nbsp;Then&nbsp;it&nbsp;calls&nbsp;p.GoF.&nbsp;&nbsp;Finally&nbsp;it&nbsp;pops&nbsp;but&nbsp;does&nbsp;not&nbsp;execute&nbsp;the&nbsp;deferred</span><br>
<span class="lineno"></span><span class="comment" id="1407048">//&nbsp;function,&nbsp;calls&nbsp;runtime.entersyscall,&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocallback.</span><br>
<span class="lineno"></span><span class="comment" id="1407125">//</span><br>
<span class="lineno"></span><span class="comment" id="1407128">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocallback&nbsp;switches&nbsp;back&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1407194">//&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;(the&nbsp;pointer&nbsp;is&nbsp;still&nbsp;in&nbsp;m-&gt;g0.sched.sp),&nbsp;restores&nbsp;the&nbsp;old</span><br>
<span class="lineno">75</span><span class="comment" id="1407270">//&nbsp;m-&gt;g0.sched.sp&nbsp;value&nbsp;from&nbsp;the&nbsp;stack,&nbsp;and&nbsp;returns&nbsp;to&nbsp;_cgoexp_GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1407338">//</span><br>
<span class="lineno"></span><span class="comment" id="1407341">//&nbsp;_cgoexp_GoF&nbsp;immediately&nbsp;returns&nbsp;to&nbsp;crosscall2,&nbsp;which&nbsp;restores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1407410">//&nbsp;callee-save&nbsp;registers&nbsp;for&nbsp;gcc&nbsp;and&nbsp;returns&nbsp;to&nbsp;GoF,&nbsp;which&nbsp;returns&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1407484">package</span>&nbsp;<span class="ident" id="1407492">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1407501">import</span>&nbsp;<span class="string" id="1407508">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1407518">//&nbsp;Call&nbsp;from&nbsp;Go&nbsp;to&nbsp;C.</span><br>
<span class="lineno">85</span><span class="comment" id="1407540">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1407553">func</span>&nbsp;<span class="ident" id="1407558">cgocall</span><span class="op" id="1407565">(</span><span class="ident" id="1407566">fn</span><span class="op" id="1407568">,</span>&nbsp;<span class="ident" id="1407570">arg</span>&nbsp;<span class="ident" id="1407574">unsafe</span><span class="op" id="1407580">.</span><span class="ident" id="1407581">Pointer</span><span class="op" id="1407588">)</span>&nbsp;<span class="op" id="1407590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407593">cgocall_errno</span><span class="op" id="1407606">(</span><span class="ident" id="1407607">fn</span><span class="op" id="1407609">,</span>&nbsp;<span class="ident" id="1407611">arg</span><span class="op" id="1407614">)</span><br>
<span class="lineno"></span><span class="op" id="1407616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="1407619">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1407632">func</span>&nbsp;<span class="ident" id="1407637">cgocall_errno</span><span class="op" id="1407650">(</span><span class="ident" id="1407651">fn</span><span class="op" id="1407653">,</span>&nbsp;<span class="ident" id="1407655">arg</span>&nbsp;<span class="ident" id="1407659">unsafe</span><span class="op" id="1407665">.</span><span class="ident" id="1407666">Pointer</span><span class="op" id="1407673">)</span>&nbsp;<span class="builtintype" id="1407675">int32</span>&nbsp;<span class="op" id="1407681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407684">if</span>&nbsp;<span class="op" id="1407687">!</span><span class="ident" id="1407688">iscgo</span>&nbsp;<span class="op" id="1407694">&amp;&amp;</span>&nbsp;<span class="ident" id="1407697">GOOS</span>&nbsp;<span class="op" id="1407702">!=</span>&nbsp;<span class="string" id="1407705">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1407715">&amp;&amp;</span>&nbsp;<span class="ident" id="1407718">GOOS</span>&nbsp;<span class="op" id="1407723">!=</span>&nbsp;<span class="string" id="1407726">&#34;windows&#34;</span>&nbsp;<span class="op" id="1407736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407740">gothrow</span><span class="op" id="1407747">(</span><span class="string" id="1407748">&#34;cgocall&nbsp;unavailable&#34;</span><span class="op" id="1407769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407772">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407776">if</span>&nbsp;<span class="ident" id="1407779">fn</span>&nbsp;<span class="op" id="1407782">==</span>&nbsp;<span class="ident" id="1407785">nil</span>&nbsp;<span class="op" id="1407789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407793">gothrow</span><span class="op" id="1407800">(</span><span class="string" id="1407801">&#34;cgocall&nbsp;nil&#34;</span><span class="op" id="1407814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407821">if</span>&nbsp;<span class="ident" id="1407824">raceenabled</span>&nbsp;<span class="op" id="1407836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407840">racereleasemerge</span><span class="op" id="1407856">(</span><span class="ident" id="1407857">unsafe</span><span class="op" id="1407863">.</span><span class="ident" id="1407864">Pointer</span><span class="op" id="1407871">(</span><span class="op" id="1407872">&amp;</span><span class="ident" id="1407873">racecgosync</span><span class="op" id="1407884">)</span><span class="op" id="1407885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1407892">//&nbsp;Create&nbsp;an&nbsp;extra&nbsp;M&nbsp;for&nbsp;callbacks&nbsp;on&nbsp;threads&nbsp;not&nbsp;created&nbsp;by&nbsp;Go&nbsp;on&nbsp;first&nbsp;cgo&nbsp;call.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407976">if</span>&nbsp;<span class="ident" id="1407979">needextram</span>&nbsp;<span class="op" id="1407990">==</span>&nbsp;<span class="num" id="1407993">1</span>&nbsp;<span class="op" id="1407995">&amp;&amp;</span>&nbsp;<span class="ident" id="1407998">cas</span><span class="op" id="1408001">(</span><span class="op" id="1408002">&amp;</span><span class="ident" id="1408003">needextram</span><span class="op" id="1408013">,</span>&nbsp;<span class="num" id="1408015">1</span><span class="op" id="1408016">,</span>&nbsp;<span class="num" id="1408018">0</span><span class="op" id="1408019">)</span>&nbsp;<span class="op" id="1408021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408025">onM</span><span class="op" id="1408028">(</span><span class="ident" id="1408029">newextram</span><span class="op" id="1408038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1408041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1408045">/*<br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Lock&nbsp;g&nbsp;to&nbsp;m&nbsp;to&nbsp;ensure&nbsp;we&nbsp;stay&nbsp;on&nbsp;the&nbsp;same&nbsp;stack&nbsp;if&nbsp;we&nbsp;do&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;cgo&nbsp;callback.&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408178">lockOSThread</span><span class="op" id="1408190">(</span><span class="op" id="1408191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408194">mp</span>&nbsp;<span class="op" id="1408197">:=</span>&nbsp;<span class="ident" id="1408200">getg</span><span class="op" id="1408204">(</span><span class="op" id="1408205">)</span><span class="op" id="1408206">.</span><span class="ident" id="1408207">m</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408210">mp</span><span class="op" id="1408212">.</span><span class="ident" id="1408213">ncgocall</span><span class="op" id="1408221">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408225">mp</span><span class="op" id="1408227">.</span><span class="ident" id="1408228">ncgo</span><span class="op" id="1408232">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408236">defer</span>&nbsp;<span class="ident" id="1408242">endcgo</span><span class="op" id="1408248">(</span><span class="ident" id="1408249">mp</span><span class="op" id="1408251">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1408255">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Announce&nbsp;we&nbsp;are&nbsp;entering&nbsp;a&nbsp;system&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;so&nbsp;that&nbsp;the&nbsp;scheduler&nbsp;knows&nbsp;to&nbsp;create&nbsp;another<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;M&nbsp;to&nbsp;run&nbsp;goroutines&nbsp;while&nbsp;we&nbsp;are&nbsp;in&nbsp;the<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;foreign&nbsp;code.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;The&nbsp;call&nbsp;to&nbsp;asmcgocall&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;split&nbsp;the&nbsp;stack&nbsp;and&nbsp;does&nbsp;not&nbsp;allocate&nbsp;memory,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;so&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;while&nbsp;&#34;in&nbsp;a&nbsp;system&nbsp;call&#34;,&nbsp;outside<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;the&nbsp;$GOMAXPROCS&nbsp;accounting.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408613">entersyscall</span><span class="op" id="1408625">(</span><span class="op" id="1408626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408629">errno</span>&nbsp;<span class="op" id="1408635">:=</span>&nbsp;<span class="ident" id="1408638">asmcgocall_errno</span><span class="op" id="1408654">(</span><span class="ident" id="1408655">fn</span><span class="op" id="1408657">,</span>&nbsp;<span class="ident" id="1408659">arg</span><span class="op" id="1408662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408665">exitsyscall</span><span class="op" id="1408676">(</span><span class="op" id="1408677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408681">return</span>&nbsp;<span class="ident" id="1408688">errno</span><br>
<span class="lineno">135</span><span class="op" id="1408694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1408697">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1408710">func</span>&nbsp;<span class="ident" id="1408715">endcgo</span><span class="op" id="1408721">(</span><span class="ident" id="1408722">mp</span>&nbsp;<span class="op" id="1408725">*</span><span class="ident" id="1408726">m</span><span class="op" id="1408727">)</span>&nbsp;<span class="op" id="1408729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408732">mp</span><span class="op" id="1408734">.</span><span class="ident" id="1408735">ncgo</span><span class="op" id="1408739">--</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408743">if</span>&nbsp;<span class="ident" id="1408746">mp</span><span class="op" id="1408748">.</span><span class="ident" id="1408749">ncgo</span>&nbsp;<span class="op" id="1408754">==</span>&nbsp;<span class="num" id="1408757">0</span>&nbsp;<span class="op" id="1408759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1408763">//&nbsp;We&nbsp;are&nbsp;going&nbsp;back&nbsp;to&nbsp;Go&nbsp;and&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;recursive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1408819">//&nbsp;call.&nbsp;&nbsp;Let&nbsp;the&nbsp;GC&nbsp;collect&nbsp;any&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1408875">//&nbsp;_cgo_allocate&nbsp;that&nbsp;is&nbsp;no&nbsp;longer&nbsp;referenced.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408924">mp</span><span class="op" id="1408926">.</span><span class="ident" id="1408927">cgomal</span>&nbsp;<span class="op" id="1408934">=</span>&nbsp;<span class="ident" id="1408936">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1408941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408945">if</span>&nbsp;<span class="ident" id="1408948">raceenabled</span>&nbsp;<span class="op" id="1408960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408964">raceacquire</span><span class="op" id="1408975">(</span><span class="ident" id="1408976">unsafe</span><span class="op" id="1408982">.</span><span class="ident" id="1408983">Pointer</span><span class="op" id="1408990">(</span><span class="op" id="1408991">&amp;</span><span class="ident" id="1408992">racecgosync</span><span class="op" id="1409003">)</span><span class="op" id="1409004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409007">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409011">unlockOSThread</span><span class="op" id="1409025">(</span><span class="op" id="1409026">)</span>&nbsp;<span class="comment" id="1409028">//&nbsp;invalidates&nbsp;mp</span><br>
<span class="lineno"></span><span class="op" id="1409046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1409049">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;cgo&nbsp;code.</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="1409084">//&nbsp;Filled&nbsp;by&nbsp;schedinit&nbsp;from&nbsp;corresponding&nbsp;C&nbsp;variables,</span><br>
<span class="lineno"></span><span class="comment" id="1409139">//&nbsp;which&nbsp;are&nbsp;in&nbsp;turn&nbsp;filled&nbsp;in&nbsp;by&nbsp;dynamic&nbsp;linker&nbsp;when&nbsp;Cgo&nbsp;is&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="1409211">var</span>&nbsp;<span class="ident" id="1409215">cgoMalloc</span><span class="op" id="1409224">,</span>&nbsp;<span class="ident" id="1409226">cgoFree</span>&nbsp;<span class="ident" id="1409234">unsafe</span><span class="op" id="1409240">.</span><span class="ident" id="1409241">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1409250">func</span>&nbsp;<span class="ident" id="1409255">cmalloc</span><span class="op" id="1409262">(</span><span class="ident" id="1409263">n</span>&nbsp;<span class="builtintype" id="1409265">uintptr</span><span class="op" id="1409272">)</span>&nbsp;<span class="ident" id="1409274">unsafe</span><span class="op" id="1409280">.</span><span class="ident" id="1409281">Pointer</span>&nbsp;<span class="op" id="1409289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409292">var</span>&nbsp;<span class="ident" id="1409296">args</span>&nbsp;<span class="keyword" id="1409301">struct</span>&nbsp;<span class="op" id="1409308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409312">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1409316">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409325">ret</span>&nbsp;<span class="ident" id="1409329">unsafe</span><span class="op" id="1409335">.</span><span class="ident" id="1409336">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409345">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409348">args</span><span class="op" id="1409352">.</span><span class="ident" id="1409353">n</span>&nbsp;<span class="op" id="1409355">=</span>&nbsp;<span class="ident" id="1409357">uint64</span><span class="op" id="1409363">(</span><span class="ident" id="1409364">n</span><span class="op" id="1409365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409368">cgocall</span><span class="op" id="1409375">(</span><span class="ident" id="1409376">cgoMalloc</span><span class="op" id="1409385">,</span>&nbsp;<span class="ident" id="1409387">unsafe</span><span class="op" id="1409393">.</span><span class="ident" id="1409394">Pointer</span><span class="op" id="1409401">(</span><span class="op" id="1409402">&amp;</span><span class="ident" id="1409403">args</span><span class="op" id="1409407">)</span><span class="op" id="1409408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409411">if</span>&nbsp;<span class="ident" id="1409414">args</span><span class="op" id="1409418">.</span><span class="ident" id="1409419">ret</span>&nbsp;<span class="op" id="1409423">==</span>&nbsp;<span class="ident" id="1409426">nil</span>&nbsp;<span class="op" id="1409430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409434">gothrow</span><span class="op" id="1409441">(</span><span class="string" id="1409442">&#34;C&nbsp;malloc&nbsp;failed&#34;</span><span class="op" id="1409459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409462">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409465">return</span>&nbsp;<span class="ident" id="1409472">args</span><span class="op" id="1409476">.</span><span class="ident" id="1409477">ret</span><br>
<span class="lineno"></span><span class="op" id="1409481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1409484">func</span>&nbsp;<span class="ident" id="1409489">cfree</span><span class="op" id="1409494">(</span><span class="ident" id="1409495">p</span>&nbsp;<span class="ident" id="1409497">unsafe</span><span class="op" id="1409503">.</span><span class="ident" id="1409504">Pointer</span><span class="op" id="1409511">)</span>&nbsp;<span class="op" id="1409513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409516">cgocall</span><span class="op" id="1409523">(</span><span class="ident" id="1409524">cgoFree</span><span class="op" id="1409531">,</span>&nbsp;<span class="ident" id="1409533">p</span><span class="op" id="1409534">)</span><br>
<span class="lineno">175</span><span class="op" id="1409536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1409539">//&nbsp;Call&nbsp;from&nbsp;C&nbsp;back&nbsp;to&nbsp;Go.</span><br>
<span class="lineno"></span><span class="comment" id="1409566">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1409579">func</span>&nbsp;<span class="ident" id="1409584">cgocallbackg</span><span class="op" id="1409596">(</span><span class="op" id="1409597">)</span>&nbsp;<span class="op" id="1409599">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409602">gp</span>&nbsp;<span class="op" id="1409605">:=</span>&nbsp;<span class="ident" id="1409608">getg</span><span class="op" id="1409612">(</span><span class="op" id="1409613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409616">if</span>&nbsp;<span class="ident" id="1409619">gp</span>&nbsp;<span class="op" id="1409622">!=</span>&nbsp;<span class="ident" id="1409625">gp</span><span class="op" id="1409627">.</span><span class="ident" id="1409628">m</span><span class="op" id="1409629">.</span><span class="ident" id="1409630">curg</span>&nbsp;<span class="op" id="1409635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1409639">println</span><span class="op" id="1409646">(</span><span class="string" id="1409647">&#34;runtime:&nbsp;bad&nbsp;g&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1409678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409682">exit</span><span class="op" id="1409686">(</span><span class="num" id="1409687">2</span><span class="op" id="1409688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409691">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1409695">//&nbsp;entersyscall&nbsp;saves&nbsp;the&nbsp;caller&#39;s&nbsp;SP&nbsp;to&nbsp;allow&nbsp;the&nbsp;GC&nbsp;to&nbsp;trace&nbsp;the&nbsp;Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1409766">//&nbsp;stack.&nbsp;However,&nbsp;since&nbsp;we&#39;re&nbsp;returning&nbsp;to&nbsp;an&nbsp;earlier&nbsp;stack&nbsp;frame&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1409838">//&nbsp;need&nbsp;to&nbsp;pair&nbsp;with&nbsp;the&nbsp;entersyscall()&nbsp;call&nbsp;made&nbsp;by&nbsp;cgocall,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1409909">//&nbsp;save&nbsp;syscall*&nbsp;and&nbsp;let&nbsp;reentersyscall&nbsp;restore&nbsp;them.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409964">savedsp</span>&nbsp;<span class="op" id="1409972">:=</span>&nbsp;<span class="ident" id="1409975">unsafe</span><span class="op" id="1409981">.</span><span class="ident" id="1409982">Pointer</span><span class="op" id="1409989">(</span><span class="ident" id="1409990">gp</span><span class="op" id="1409992">.</span><span class="ident" id="1409993">syscallsp</span><span class="op" id="1410002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410005">savedpc</span>&nbsp;<span class="op" id="1410013">:=</span>&nbsp;<span class="ident" id="1410016">gp</span><span class="op" id="1410018">.</span><span class="ident" id="1410019">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410030">exitsyscall</span><span class="op" id="1410041">(</span><span class="op" id="1410042">)</span>&nbsp;<span class="comment" id="1410044">//&nbsp;coming&nbsp;out&nbsp;of&nbsp;cgo&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410071">cgocallbackg1</span><span class="op" id="1410084">(</span><span class="op" id="1410085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410088">//&nbsp;going&nbsp;back&nbsp;to&nbsp;cgo&nbsp;call</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410115">reentersyscall</span><span class="op" id="1410129">(</span><span class="ident" id="1410130">savedpc</span><span class="op" id="1410137">,</span>&nbsp;<span class="ident" id="1410139">savedsp</span><span class="op" id="1410146">)</span><br>
<span class="lineno"></span><span class="op" id="1410148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1410151">func</span>&nbsp;<span class="ident" id="1410156">cgocallbackg1</span><span class="op" id="1410169">(</span><span class="op" id="1410170">)</span>&nbsp;<span class="op" id="1410172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410175">gp</span>&nbsp;<span class="op" id="1410178">:=</span>&nbsp;<span class="ident" id="1410181">getg</span><span class="op" id="1410185">(</span><span class="op" id="1410186">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410189">if</span>&nbsp;<span class="ident" id="1410192">gp</span><span class="op" id="1410194">.</span><span class="ident" id="1410195">m</span><span class="op" id="1410196">.</span><span class="ident" id="1410197">needextram</span>&nbsp;<span class="op" id="1410208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410212">gp</span><span class="op" id="1410214">.</span><span class="ident" id="1410215">m</span><span class="op" id="1410216">.</span><span class="ident" id="1410217">needextram</span>&nbsp;<span class="op" id="1410228">=</span>&nbsp;<span class="builtintype" id="1410230">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410238">onM</span><span class="op" id="1410241">(</span><span class="ident" id="1410242">newextram</span><span class="op" id="1410251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410258">//&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410305">restore</span>&nbsp;<span class="op" id="1410313">:=</span>&nbsp;<span class="builtintype" id="1410316">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410322">defer</span>&nbsp;<span class="ident" id="1410328">unwindm</span><span class="op" id="1410335">(</span><span class="op" id="1410336">&amp;</span><span class="ident" id="1410337">restore</span><span class="op" id="1410344">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410348">if</span>&nbsp;<span class="ident" id="1410351">raceenabled</span>&nbsp;<span class="op" id="1410363">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410367">raceacquire</span><span class="op" id="1410378">(</span><span class="ident" id="1410379">unsafe</span><span class="op" id="1410385">.</span><span class="ident" id="1410386">Pointer</span><span class="op" id="1410393">(</span><span class="op" id="1410394">&amp;</span><span class="ident" id="1410395">racecgosync</span><span class="op" id="1410406">)</span><span class="op" id="1410407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410414">type</span>&nbsp;<span class="ident" id="1410419">args</span>&nbsp;<span class="keyword" id="1410424">struct</span>&nbsp;<span class="op" id="1410431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410435">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1410443">*</span><span class="ident" id="1410444">funcval</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410454">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1410462">unsafe</span><span class="op" id="1410468">.</span><span class="ident" id="1410469">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410479">argsize</span>&nbsp;<span class="builtintype" id="1410487">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410499">var</span>&nbsp;<span class="ident" id="1410503">cb</span>&nbsp;<span class="op" id="1410506">*</span><span class="ident" id="1410507">args</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410514">//&nbsp;Location&nbsp;of&nbsp;callback&nbsp;arguments&nbsp;depends&nbsp;on&nbsp;stack&nbsp;frame&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410579">//&nbsp;and&nbsp;size&nbsp;of&nbsp;stack&nbsp;frame&nbsp;of&nbsp;cgocallback_gofunc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410630">sp</span>&nbsp;<span class="op" id="1410633">:=</span>&nbsp;<span class="ident" id="1410636">gp</span><span class="op" id="1410638">.</span><span class="ident" id="1410639">m</span><span class="op" id="1410640">.</span><span class="ident" id="1410641">g0</span><span class="op" id="1410643">.</span><span class="ident" id="1410644">sched</span><span class="op" id="1410649">.</span><span class="ident" id="1410650">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410654">switch</span>&nbsp;<span class="ident" id="1410661">GOARCH</span>&nbsp;<span class="op" id="1410668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410671">default</span><span class="op" id="1410678">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410682">gothrow</span><span class="op" id="1410689">(</span><span class="string" id="1410690">&#34;cgocallbackg&nbsp;is&nbsp;unimplemented&nbsp;on&nbsp;arch&#34;</span><span class="op" id="1410729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410732">case</span>&nbsp;<span class="string" id="1410737">&#34;arm&#34;</span><span class="op" id="1410742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410746">//&nbsp;On&nbsp;arm,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;two&nbsp;words&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;saved&nbsp;LR&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410815">//&nbsp;SP&nbsp;and&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;between&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;the&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410890">cb</span>&nbsp;<span class="op" id="1410893">=</span>&nbsp;<span class="op" id="1410895">(</span><span class="op" id="1410896">*</span><span class="ident" id="1410897">args</span><span class="op" id="1410901">)</span><span class="op" id="1410902">(</span><span class="ident" id="1410903">unsafe</span><span class="op" id="1410909">.</span><span class="ident" id="1410910">Pointer</span><span class="op" id="1410917">(</span><span class="ident" id="1410918">sp</span>&nbsp;<span class="op" id="1410921">+</span>&nbsp;<span class="num" id="1410923">4</span><span class="op" id="1410924">*</span><span class="ident" id="1410925">ptrSize</span><span class="op" id="1410932">)</span><span class="op" id="1410933">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410936">case</span>&nbsp;<span class="string" id="1410941">&#34;amd64&#34;</span><span class="op" id="1410948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410952">//&nbsp;On&nbsp;amd64,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;one&nbsp;word,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411008">cb</span>&nbsp;<span class="op" id="1411011">=</span>&nbsp;<span class="op" id="1411013">(</span><span class="op" id="1411014">*</span><span class="ident" id="1411015">args</span><span class="op" id="1411019">)</span><span class="op" id="1411020">(</span><span class="ident" id="1411021">unsafe</span><span class="op" id="1411027">.</span><span class="ident" id="1411028">Pointer</span><span class="op" id="1411035">(</span><span class="ident" id="1411036">sp</span>&nbsp;<span class="op" id="1411039">+</span>&nbsp;<span class="num" id="1411041">2</span><span class="op" id="1411042">*</span><span class="ident" id="1411043">ptrSize</span><span class="op" id="1411050">)</span><span class="op" id="1411051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1411054">case</span>&nbsp;<span class="string" id="1411059">&#34;386&#34;</span><span class="op" id="1411064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411068">//&nbsp;On&nbsp;386,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;three&nbsp;words,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411125">cb</span>&nbsp;<span class="op" id="1411128">=</span>&nbsp;<span class="op" id="1411130">(</span><span class="op" id="1411131">*</span><span class="ident" id="1411132">args</span><span class="op" id="1411136">)</span><span class="op" id="1411137">(</span><span class="ident" id="1411138">unsafe</span><span class="op" id="1411144">.</span><span class="ident" id="1411145">Pointer</span><span class="op" id="1411152">(</span><span class="ident" id="1411153">sp</span>&nbsp;<span class="op" id="1411156">+</span>&nbsp;<span class="num" id="1411158">4</span><span class="op" id="1411159">*</span><span class="ident" id="1411160">ptrSize</span><span class="op" id="1411167">)</span><span class="op" id="1411168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1411171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411175">//&nbsp;Invoke&nbsp;callback.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411196">reflectcall</span><span class="op" id="1411207">(</span><span class="ident" id="1411208">unsafe</span><span class="op" id="1411214">.</span><span class="ident" id="1411215">Pointer</span><span class="op" id="1411222">(</span><span class="ident" id="1411223">cb</span><span class="op" id="1411225">.</span><span class="ident" id="1411226">fn</span><span class="op" id="1411228">)</span><span class="op" id="1411229">,</span>&nbsp;<span class="ident" id="1411231">unsafe</span><span class="op" id="1411237">.</span><span class="ident" id="1411238">Pointer</span><span class="op" id="1411245">(</span><span class="ident" id="1411246">cb</span><span class="op" id="1411248">.</span><span class="ident" id="1411249">arg</span><span class="op" id="1411252">)</span><span class="op" id="1411253">,</span>&nbsp;<span class="builtintype" id="1411255">uint32</span><span class="op" id="1411261">(</span><span class="ident" id="1411262">cb</span><span class="op" id="1411264">.</span><span class="ident" id="1411265">argsize</span><span class="op" id="1411272">)</span><span class="op" id="1411273">,</span>&nbsp;<span class="num" id="1411275">0</span><span class="op" id="1411276">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1411280">if</span>&nbsp;<span class="ident" id="1411283">raceenabled</span>&nbsp;<span class="op" id="1411295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411299">racereleasemerge</span><span class="op" id="1411315">(</span><span class="ident" id="1411316">unsafe</span><span class="op" id="1411322">.</span><span class="ident" id="1411323">Pointer</span><span class="op" id="1411330">(</span><span class="op" id="1411331">&amp;</span><span class="ident" id="1411332">racecgosync</span><span class="op" id="1411343">)</span><span class="op" id="1411344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1411347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411351">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;m-&gt;g0-&gt;sched.sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411386">//&nbsp;Our&nbsp;caller,&nbsp;cgocallback,&nbsp;will&nbsp;do&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411429">restore</span>&nbsp;<span class="op" id="1411437">=</span>&nbsp;<span class="builtintype" id="1411439">false</span><br>
<span class="lineno"></span><span class="op" id="1411445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="1411448">func</span>&nbsp;<span class="ident" id="1411453">unwindm</span><span class="op" id="1411460">(</span><span class="ident" id="1411461">restore</span>&nbsp;<span class="op" id="1411469">*</span><span class="builtintype" id="1411470">bool</span><span class="op" id="1411474">)</span>&nbsp;<span class="op" id="1411476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1411479">if</span>&nbsp;<span class="op" id="1411482">!</span><span class="op" id="1411483">*</span><span class="ident" id="1411484">restore</span>&nbsp;<span class="op" id="1411492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1411496">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1411504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411507">//&nbsp;Restore&nbsp;sp&nbsp;saved&nbsp;by&nbsp;cgocallback&nbsp;during</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1411550">//&nbsp;unwind&nbsp;of&nbsp;g&#39;s&nbsp;stack&nbsp;(see&nbsp;comment&nbsp;at&nbsp;top&nbsp;of&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411604">mp</span>&nbsp;<span class="op" id="1411607">:=</span>&nbsp;<span class="ident" id="1411610">acquirem</span><span class="op" id="1411618">(</span><span class="op" id="1411619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411622">sched</span>&nbsp;<span class="op" id="1411628">:=</span>&nbsp;<span class="op" id="1411631">&amp;</span><span class="ident" id="1411632">mp</span><span class="op" id="1411634">.</span><span class="ident" id="1411635">g0</span><span class="op" id="1411637">.</span><span class="ident" id="1411638">sched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1411645">switch</span>&nbsp;<span class="ident" id="1411652">GOARCH</span>&nbsp;<span class="op" id="1411659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1411662">default</span><span class="op" id="1411669">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411673">gothrow</span><span class="op" id="1411680">(</span><span class="string" id="1411681">&#34;unwindm&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1411706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1411709">case</span>&nbsp;<span class="string" id="1411714">&#34;386&#34;</span><span class="op" id="1411719">,</span>&nbsp;<span class="string" id="1411721">&#34;amd64&#34;</span><span class="op" id="1411728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411732">sched</span><span class="op" id="1411737">.</span><span class="ident" id="1411738">sp</span>&nbsp;<span class="op" id="1411741">=</span>&nbsp;<span class="op" id="1411743">*</span><span class="op" id="1411744">(</span><span class="op" id="1411745">*</span><span class="builtintype" id="1411746">uintptr</span><span class="op" id="1411753">)</span><span class="op" id="1411754">(</span><span class="ident" id="1411755">unsafe</span><span class="op" id="1411761">.</span><span class="ident" id="1411762">Pointer</span><span class="op" id="1411769">(</span><span class="ident" id="1411770">sched</span><span class="op" id="1411775">.</span><span class="ident" id="1411776">sp</span><span class="op" id="1411778">)</span><span class="op" id="1411779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1411782">case</span>&nbsp;<span class="string" id="1411787">&#34;arm&#34;</span><span class="op" id="1411792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411796">sched</span><span class="op" id="1411801">.</span><span class="ident" id="1411802">sp</span>&nbsp;<span class="op" id="1411805">=</span>&nbsp;<span class="op" id="1411807">*</span><span class="op" id="1411808">(</span><span class="op" id="1411809">*</span><span class="builtintype" id="1411810">uintptr</span><span class="op" id="1411817">)</span><span class="op" id="1411818">(</span><span class="ident" id="1411819">unsafe</span><span class="op" id="1411825">.</span><span class="ident" id="1411826">Pointer</span><span class="op" id="1411833">(</span><span class="ident" id="1411834">sched</span><span class="op" id="1411839">.</span><span class="ident" id="1411840">sp</span>&nbsp;<span class="op" id="1411843">+</span>&nbsp;<span class="num" id="1411845">4</span><span class="op" id="1411846">)</span><span class="op" id="1411847">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1411850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411853">releasem</span><span class="op" id="1411861">(</span><span class="ident" id="1411862">mp</span><span class="op" id="1411864">)</span><br>
<span class="lineno"></span><span class="op" id="1411866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1411869">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno">270</span><span class="keyword" id="1411893">func</span>&nbsp;<span class="ident" id="1411898">badcgocallback</span><span class="op" id="1411912">(</span><span class="op" id="1411913">)</span>&nbsp;<span class="op" id="1411915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1411918">gothrow</span><span class="op" id="1411925">(</span><span class="string" id="1411926">&#34;misaligned&nbsp;stack&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1411959">)</span><br>
<span class="lineno"></span><span class="op" id="1411961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1411964">//&nbsp;called&nbsp;from&nbsp;(incomplete)&nbsp;assembly</span><br>
<span class="lineno">275</span><span class="keyword" id="1412001">func</span>&nbsp;<span class="ident" id="1412006">cgounimpl</span><span class="op" id="1412015">(</span><span class="op" id="1412016">)</span>&nbsp;<span class="op" id="1412018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1412021">gothrow</span><span class="op" id="1412028">(</span><span class="string" id="1412029">&#34;cgo&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1412050">)</span><br>
<span class="lineno"></span><span class="op" id="1412052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1412055">var</span>&nbsp;<span class="ident" id="1412059">racecgosync</span>&nbsp;<span class="ident" id="1412071">uint64</span>&nbsp;<span class="comment" id="1412078">//&nbsp;represents&nbsp;possible&nbsp;synchronization&nbsp;in&nbsp;C&nbsp;code</span>
</div>
</body>
</html>
