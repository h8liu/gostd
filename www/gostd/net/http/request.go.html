<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html" class="current">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4095651">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4095706">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4095760">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4095811">//&nbsp;HTTP&nbsp;Request&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4095849">package</span>&nbsp;<span class="ident" id="4095857">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4095863">import</span>&nbsp;<span class="op" id="4095870">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4095873">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4095882">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4095891">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4095905">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4095924">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4095934">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4095941">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4095947">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4095960">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4095968">&#34;mime/multipart&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4095986">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4096003">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4096014">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4096025">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4096036">&#34;sync&#34;</span><br>
<span class="lineno">25</span><span class="op" id="4096043">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4096046">const</span>&nbsp;<span class="op" id="4096052">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096055">maxValueLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4096072">=</span>&nbsp;<span class="num" id="4096074">4096</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096080">maxHeaderLines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4096097">=</span>&nbsp;<span class="num" id="4096099">1024</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096105">chunkSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4096122">=</span>&nbsp;<span class="num" id="4096124">4</span>&nbsp;<span class="op" id="4096126">&lt;&lt;</span>&nbsp;<span class="num" id="4096129">10</span>&nbsp;&nbsp;<span class="comment" id="4096133">//&nbsp;4&nbsp;KB&nbsp;chunks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096149">defaultMaxMemory</span>&nbsp;<span class="op" id="4096166">=</span>&nbsp;<span class="num" id="4096168">32</span>&nbsp;<span class="op" id="4096171">&lt;&lt;</span>&nbsp;<span class="num" id="4096174">20</span>&nbsp;<span class="comment" id="4096177">//&nbsp;32&nbsp;MB</span><br>
<span class="lineno"></span><span class="op" id="4096186">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4096189">//&nbsp;ErrMissingFile&nbsp;is&nbsp;returned&nbsp;by&nbsp;FormFile&nbsp;when&nbsp;the&nbsp;provided&nbsp;file&nbsp;field&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="4096265">//&nbsp;is&nbsp;either&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;request&nbsp;or&nbsp;not&nbsp;a&nbsp;file&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="4096326">var</span>&nbsp;<span class="ident" id="4096330">ErrMissingFile</span>&nbsp;<span class="op" id="4096345">=</span>&nbsp;<span class="ident" id="4096347">errors</span><span class="op" id="4096353">.</span><span class="ident" id="4096354">New</span><span class="op" id="4096357">(</span><span class="string" id="4096358">&#34;http:&nbsp;no&nbsp;such&nbsp;file&#34;</span><span class="op" id="4096378">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4096381">//&nbsp;HTTP&nbsp;request&nbsp;parsing&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="4096413">type</span>&nbsp;<span class="ident" id="4096418">ProtocolError</span>&nbsp;<span class="keyword" id="4096432">struct</span>&nbsp;<span class="op" id="4096439">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096442">ErrorString</span>&nbsp;<span class="builtintype" id="4096454">string</span><br>
<span class="lineno"></span><span class="op" id="4096461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4096464">func</span>&nbsp;<span class="op" id="4096469">(</span><span class="ident" id="4096470">err</span>&nbsp;<span class="op" id="4096474">*</span><span class="ident" id="4096475">ProtocolError</span><span class="op" id="4096488">)</span>&nbsp;<span class="ident" id="4096490">Error</span><span class="op" id="4096495">(</span><span class="op" id="4096496">)</span>&nbsp;<span class="builtintype" id="4096498">string</span>&nbsp;<span class="op" id="4096505">{</span>&nbsp;<span class="keyword" id="4096507">return</span>&nbsp;<span class="ident" id="4096514">err</span><span class="op" id="4096517">.</span><span class="ident" id="4096518">ErrorString</span>&nbsp;<span class="op" id="4096530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4096533">var</span>&nbsp;<span class="op" id="4096537">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096540">ErrHeaderTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4096564">=</span>&nbsp;<span class="op" id="4096566">&amp;</span><span class="ident" id="4096567">ProtocolError</span><span class="op" id="4096580">{</span><span class="string" id="4096581">&#34;header&nbsp;too&nbsp;long&#34;</span><span class="op" id="4096598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096601">ErrShortBody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4096625">=</span>&nbsp;<span class="op" id="4096627">&amp;</span><span class="ident" id="4096628">ProtocolError</span><span class="op" id="4096641">{</span><span class="string" id="4096642">&#34;entity&nbsp;body&nbsp;too&nbsp;short&#34;</span><span class="op" id="4096665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096668">ErrNotSupported</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4096692">=</span>&nbsp;<span class="op" id="4096694">&amp;</span><span class="ident" id="4096695">ProtocolError</span><span class="op" id="4096708">{</span><span class="string" id="4096709">&#34;feature&nbsp;not&nbsp;supported&#34;</span><span class="op" id="4096732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096735">ErrUnexpectedTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4096759">=</span>&nbsp;<span class="op" id="4096761">&amp;</span><span class="ident" id="4096762">ProtocolError</span><span class="op" id="4096775">{</span><span class="string" id="4096776">&#34;trailer&nbsp;header&nbsp;without&nbsp;chunked&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="4096826">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096829">ErrMissingContentLength</span>&nbsp;<span class="op" id="4096853">=</span>&nbsp;<span class="op" id="4096855">&amp;</span><span class="ident" id="4096856">ProtocolError</span><span class="op" id="4096869">{</span><span class="string" id="4096870">&#34;missing&nbsp;ContentLength&nbsp;in&nbsp;HEAD&nbsp;response&#34;</span><span class="op" id="4096910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096913">ErrNotMultipart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4096937">=</span>&nbsp;<span class="op" id="4096939">&amp;</span><span class="ident" id="4096940">ProtocolError</span><span class="op" id="4096953">{</span><span class="string" id="4096954">&#34;request&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;multipart/form-data&#34;</span><span class="op" id="4097002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4097005">ErrMissingBoundary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4097029">=</span>&nbsp;<span class="op" id="4097031">&amp;</span><span class="ident" id="4097032">ProtocolError</span><span class="op" id="4097045">{</span><span class="string" id="4097046">&#34;no&nbsp;multipart&nbsp;boundary&nbsp;param&nbsp;in&nbsp;Content-Type&#34;</span><span class="op" id="4097091">}</span><br>
<span class="lineno"></span><span class="op" id="4097093">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4097096">type</span>&nbsp;<span class="ident" id="4097101">badStringError</span>&nbsp;<span class="keyword" id="4097116">struct</span>&nbsp;<span class="op" id="4097123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4097126">what</span>&nbsp;<span class="builtintype" id="4097131">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4097139">str</span>&nbsp;&nbsp;<span class="builtintype" id="4097144">string</span><br>
<span class="lineno"></span><span class="op" id="4097151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="4097154">func</span>&nbsp;<span class="op" id="4097159">(</span><span class="ident" id="4097160">e</span>&nbsp;<span class="op" id="4097162">*</span><span class="ident" id="4097163">badStringError</span><span class="op" id="4097177">)</span>&nbsp;<span class="ident" id="4097179">Error</span><span class="op" id="4097184">(</span><span class="op" id="4097185">)</span>&nbsp;<span class="builtintype" id="4097187">string</span>&nbsp;<span class="op" id="4097194">{</span>&nbsp;<span class="keyword" id="4097196">return</span>&nbsp;<span class="ident" id="4097203">fmt</span><span class="op" id="4097206">.</span><span class="ident" id="4097207">Sprintf</span><span class="op" id="4097214">(</span><span class="string" id="4097215">&#34;%s&nbsp;%q&#34;</span><span class="op" id="4097222">,</span>&nbsp;<span class="ident" id="4097224">e</span><span class="op" id="4097225">.</span><span class="ident" id="4097226">what</span><span class="op" id="4097230">,</span>&nbsp;<span class="ident" id="4097232">e</span><span class="op" id="4097233">.</span><span class="ident" id="4097234">str</span><span class="op" id="4097237">)</span>&nbsp;<span class="op" id="4097239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4097242">//&nbsp;Headers&nbsp;that&nbsp;Request.Write&nbsp;handles&nbsp;itself&nbsp;and&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="4097310">var</span>&nbsp;<span class="ident" id="4097314">reqWriteExcludeHeader</span>&nbsp;<span class="op" id="4097336">=</span>&nbsp;<span class="keyword" id="4097338">map</span><span class="op" id="4097341">[</span><span class="builtintype" id="4097342">string</span><span class="op" id="4097348">]</span><span class="builtintype" id="4097349">bool</span><span class="op" id="4097353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4097356">&#34;Host&#34;</span><span class="op" id="4097362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4097377">true</span><span class="op" id="4097381">,</span>&nbsp;<span class="comment" id="4097383">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4097412">&#34;User-Agent&#34;</span><span class="op" id="4097424">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4097433">true</span><span class="op" id="4097437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4097440">&#34;Content-Length&#34;</span><span class="op" id="4097456">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4097461">true</span><span class="op" id="4097465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4097468">&#34;Transfer-Encoding&#34;</span><span class="op" id="4097487">:</span>&nbsp;<span class="builtintype" id="4097489">true</span><span class="op" id="4097493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4097496">&#34;Trailer&#34;</span><span class="op" id="4097505">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4097517">true</span><span class="op" id="4097521">,</span><br>
<span class="lineno"></span><span class="op" id="4097523">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="4097526">//&nbsp;A&nbsp;Request&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;received&nbsp;by&nbsp;a&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="4097587">//&nbsp;or&nbsp;to&nbsp;be&nbsp;sent&nbsp;by&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="4097617">//</span><br>
<span class="lineno"></span><span class="comment" id="4097620">//&nbsp;The&nbsp;field&nbsp;semantics&nbsp;differ&nbsp;slightly&nbsp;between&nbsp;client&nbsp;and&nbsp;server</span><br>
<span class="lineno">75</span><span class="comment" id="4097685">//&nbsp;usage.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;notes&nbsp;on&nbsp;the&nbsp;fields&nbsp;below,&nbsp;see&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4097749">//&nbsp;documentation&nbsp;for&nbsp;Request.Write&nbsp;and&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="keyword" id="4097802">type</span>&nbsp;<span class="ident" id="4097807">Request</span>&nbsp;<span class="keyword" id="4097815">struct</span>&nbsp;<span class="op" id="4097822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4097825">//&nbsp;Method&nbsp;specifies&nbsp;the&nbsp;HTTP&nbsp;method&nbsp;(GET,&nbsp;POST,&nbsp;PUT,&nbsp;etc.).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4097886">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;an&nbsp;empty&nbsp;string&nbsp;means&nbsp;GET.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4097937">Method</span>&nbsp;<span class="builtintype" id="4097944">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4097953">//&nbsp;URL&nbsp;specifies&nbsp;either&nbsp;the&nbsp;URI&nbsp;being&nbsp;requested&nbsp;(for&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098014">//&nbsp;requests)&nbsp;or&nbsp;the&nbsp;URL&nbsp;to&nbsp;access&nbsp;(for&nbsp;client&nbsp;requests).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098072">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098076">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;URL&nbsp;is&nbsp;parsed&nbsp;from&nbsp;the&nbsp;URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098131">//&nbsp;supplied&nbsp;on&nbsp;the&nbsp;Request-Line&nbsp;as&nbsp;stored&nbsp;in&nbsp;RequestURI.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098194">//&nbsp;most&nbsp;requests,&nbsp;fields&nbsp;other&nbsp;than&nbsp;Path&nbsp;and&nbsp;RawQuery&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098257">//&nbsp;empty.&nbsp;(See&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;5.1.2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098298">//</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098302">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;the&nbsp;URL&#39;s&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;server&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098366">//&nbsp;connect&nbsp;to,&nbsp;while&nbsp;the&nbsp;Request&#39;s&nbsp;Host&nbsp;field&nbsp;optionally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098424">//&nbsp;specifies&nbsp;the&nbsp;Host&nbsp;header&nbsp;value&nbsp;to&nbsp;send&nbsp;in&nbsp;the&nbsp;HTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098480">//&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098493">URL</span>&nbsp;<span class="op" id="4098497">*</span><span class="ident" id="4098498">url</span><span class="op" id="4098501">.</span><span class="ident" id="4098502">URL</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098508">//&nbsp;The&nbsp;protocol&nbsp;version&nbsp;for&nbsp;incoming&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098556">//&nbsp;Client&nbsp;requests&nbsp;always&nbsp;use&nbsp;HTTP/1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098597">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4098608">string</span>&nbsp;<span class="comment" id="4098615">//&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098630">ProtoMajor</span>&nbsp;<span class="builtintype" id="4098641">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098648">//&nbsp;1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098654">ProtoMinor</span>&nbsp;<span class="builtintype" id="4098665">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098672">//&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098679">//&nbsp;A&nbsp;header&nbsp;maps&nbsp;request&nbsp;lines&nbsp;to&nbsp;their&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098728">//&nbsp;If&nbsp;the&nbsp;header&nbsp;says</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098751">//</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098755">//&nbsp;&nbsp;&nbsp;&nbsp;accept-encoding:&nbsp;gzip,&nbsp;deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098790">//&nbsp;&nbsp;&nbsp;&nbsp;Accept-Language:&nbsp;en-us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098817">//&nbsp;&nbsp;&nbsp;&nbsp;Connection:&nbsp;keep-alive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098844">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098848">//&nbsp;then</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098857">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098861">//&nbsp;&nbsp;&nbsp;&nbsp;Header&nbsp;=&nbsp;map[string][]string{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098895">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Accept-Encoding&#34;:&nbsp;{&#34;gzip,&nbsp;deflate&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098938">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Accept-Language&#34;:&nbsp;{&#34;en-us&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098973">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Connection&#34;:&nbsp;{&#34;keep-alive&#34;},</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099008">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099014">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099018">//&nbsp;HTTP&nbsp;defines&nbsp;that&nbsp;header&nbsp;names&nbsp;are&nbsp;case-insensitive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099075">//&nbsp;The&nbsp;request&nbsp;parser&nbsp;implements&nbsp;this&nbsp;by&nbsp;canonicalizing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099136">//&nbsp;name,&nbsp;making&nbsp;the&nbsp;first&nbsp;character&nbsp;and&nbsp;any&nbsp;characters</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099192">//&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;uppercase&nbsp;and&nbsp;the&nbsp;rest&nbsp;lowercase.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099249">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099253">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;certain&nbsp;headers&nbsp;are&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099311">//&nbsp;added&nbsp;and&nbsp;may&nbsp;override&nbsp;values&nbsp;in&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099356">//</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099360">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Request.Write&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099416">Header</span>&nbsp;<span class="ident" id="4099423">Header</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099432">//&nbsp;Body&nbsp;is&nbsp;the&nbsp;request&#39;s&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099464">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099468">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;a&nbsp;nil&nbsp;body&nbsp;means&nbsp;the&nbsp;request&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099528">//&nbsp;body,&nbsp;such&nbsp;as&nbsp;a&nbsp;GET&nbsp;request.&nbsp;The&nbsp;HTTP&nbsp;Client&#39;s&nbsp;Transport</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099589">//&nbsp;is&nbsp;responsible&nbsp;for&nbsp;calling&nbsp;the&nbsp;Close&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099638">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099642">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Request&nbsp;Body&nbsp;is&nbsp;always&nbsp;non-nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099701">//&nbsp;but&nbsp;will&nbsp;return&nbsp;EOF&nbsp;immediately&nbsp;when&nbsp;no&nbsp;body&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099762">//&nbsp;The&nbsp;Server&nbsp;will&nbsp;close&nbsp;the&nbsp;request&nbsp;body.&nbsp;The&nbsp;ServeHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099820">//&nbsp;Handler&nbsp;does&nbsp;not&nbsp;need&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099850">Body</span>&nbsp;<span class="ident" id="4099855">io</span><span class="op" id="4099857">.</span><span class="ident" id="4099858">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099871">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099935">//&nbsp;The&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099990">//&nbsp;Values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100050">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100073">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;means&nbsp;unknown&nbsp;if&nbsp;Body&nbsp;is&nbsp;not&nbsp;nil.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100145">ContentLength</span>&nbsp;<span class="ident" id="4100159">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100167">//&nbsp;TransferEncoding&nbsp;lists&nbsp;the&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outermost&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100235">//&nbsp;innermost.&nbsp;An&nbsp;empty&nbsp;list&nbsp;denotes&nbsp;the&nbsp;&#34;identity&#34;&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100297">//&nbsp;TransferEncoding&nbsp;can&nbsp;usually&nbsp;be&nbsp;ignored;&nbsp;chunked&nbsp;encoding&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100362">//&nbsp;automatically&nbsp;added&nbsp;and&nbsp;removed&nbsp;as&nbsp;necessary&nbsp;when&nbsp;sending&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100428">//&nbsp;receiving&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100452">TransferEncoding</span>&nbsp;<span class="op" id="4100469">[</span><span class="op" id="4100470">]</span><span class="builtintype" id="4100471">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100480">//&nbsp;Close&nbsp;indicates&nbsp;whether&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;after</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100538">//&nbsp;replying&nbsp;to&nbsp;this&nbsp;request&nbsp;(for&nbsp;servers)&nbsp;or&nbsp;after&nbsp;sending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100598">//&nbsp;the&nbsp;request&nbsp;(for&nbsp;clients).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100629">Close</span>&nbsp;<span class="builtintype" id="4100635">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100642">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;host&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100703">//&nbsp;URL&nbsp;is&nbsp;sought.&nbsp;Per&nbsp;RFC&nbsp;2616,&nbsp;this&nbsp;is&nbsp;either&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100764">//&nbsp;the&nbsp;&#34;Host&#34;&nbsp;header&nbsp;or&nbsp;the&nbsp;host&nbsp;name&nbsp;given&nbsp;in&nbsp;the&nbsp;URL&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100828">//&nbsp;It&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100867">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100871">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Host&nbsp;optionally&nbsp;overrides&nbsp;the&nbsp;Host</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100930">//&nbsp;header&nbsp;to&nbsp;send.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;Request.Write&nbsp;method&nbsp;uses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100990">//&nbsp;the&nbsp;value&nbsp;of&nbsp;URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101017">Host</span>&nbsp;<span class="builtintype" id="4101022">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101031">//&nbsp;Form&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data,&nbsp;including&nbsp;both&nbsp;the&nbsp;URL</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101094">//&nbsp;field&#39;s&nbsp;query&nbsp;parameters&nbsp;and&nbsp;the&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;form&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101154">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101214">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;Form&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101270">Form</span>&nbsp;<span class="ident" id="4101275">url</span><span class="op" id="4101278">.</span><span class="ident" id="4101279">Values</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101288">//&nbsp;PostForm&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data&nbsp;from&nbsp;POST&nbsp;or&nbsp;PUT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101348">//&nbsp;body&nbsp;parameters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101369">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101429">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;PostForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101489">PostForm</span>&nbsp;<span class="ident" id="4101498">url</span><span class="op" id="4101501">.</span><span class="ident" id="4101502">Values</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101511">//&nbsp;MultipartForm&nbsp;is&nbsp;the&nbsp;parsed&nbsp;multipart&nbsp;form,&nbsp;including&nbsp;file&nbsp;uploads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101583">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseMultipartForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101652">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;MultipartForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101717">MultipartForm</span>&nbsp;<span class="op" id="4101731">*</span><span class="ident" id="4101732">multipart</span><span class="op" id="4101741">.</span><span class="ident" id="4101742">Form</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101749">//&nbsp;Trailer&nbsp;specifies&nbsp;additional&nbsp;headers&nbsp;that&nbsp;are&nbsp;sent&nbsp;after&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101822">//&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101832">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101836">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Trailer&nbsp;map&nbsp;initially&nbsp;contains&nbsp;only&nbsp;the</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101904">//&nbsp;trailer&nbsp;keys,&nbsp;with&nbsp;nil&nbsp;values.&nbsp;(The&nbsp;client&nbsp;declares&nbsp;which&nbsp;trailers&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101978">//&nbsp;will&nbsp;later&nbsp;send.)&nbsp;&nbsp;While&nbsp;the&nbsp;handler&nbsp;is&nbsp;reading&nbsp;from&nbsp;Body,&nbsp;it&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102049">//&nbsp;not&nbsp;reference&nbsp;Trailer.&nbsp;After&nbsp;reading&nbsp;from&nbsp;Body&nbsp;returns&nbsp;EOF,&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102121">//&nbsp;can&nbsp;be&nbsp;read&nbsp;again&nbsp;and&nbsp;will&nbsp;contain&nbsp;non-nil&nbsp;values,&nbsp;if&nbsp;they&nbsp;were&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102194">//&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102213">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102217">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Trailer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;map&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102289">//&nbsp;the&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;later&nbsp;send.&nbsp;The&nbsp;values&nbsp;may&nbsp;be&nbsp;nil&nbsp;or&nbsp;their&nbsp;final</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102362">//&nbsp;values.&nbsp;The&nbsp;ContentLength&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;-1,&nbsp;to&nbsp;send&nbsp;a&nbsp;chunked&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102436">//&nbsp;After&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;is&nbsp;sent&nbsp;the&nbsp;map&nbsp;values&nbsp;can&nbsp;be&nbsp;updated&nbsp;while</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102507">//&nbsp;the&nbsp;request&nbsp;body&nbsp;is&nbsp;read.&nbsp;Once&nbsp;the&nbsp;body&nbsp;returns&nbsp;EOF,&nbsp;the&nbsp;caller&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102580">//&nbsp;not&nbsp;mutate&nbsp;Trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102604">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102608">//&nbsp;Few&nbsp;HTTP&nbsp;clients,&nbsp;servers,&nbsp;or&nbsp;proxies&nbsp;support&nbsp;HTTP&nbsp;trailers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4102673">Trailer</span>&nbsp;<span class="ident" id="4102681">Header</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102690">//&nbsp;RemoteAddr&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102754">//&nbsp;the&nbsp;network&nbsp;address&nbsp;that&nbsp;sent&nbsp;the&nbsp;request,&nbsp;usually&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102813">//&nbsp;logging.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102873">//&nbsp;has&nbsp;no&nbsp;defined&nbsp;format.&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102932">//&nbsp;sets&nbsp;RemoteAddr&nbsp;to&nbsp;an&nbsp;&#34;IP:port&#34;&nbsp;address&nbsp;before&nbsp;invoking&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102994">//&nbsp;handler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103007">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4103053">RemoteAddr</span>&nbsp;<span class="builtintype" id="4103064">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103073">//&nbsp;RequestURI&nbsp;is&nbsp;the&nbsp;unmodified&nbsp;Request-URI&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103125">//&nbsp;Request-Line&nbsp;(RFC&nbsp;2616,&nbsp;Section&nbsp;5.1)&nbsp;as&nbsp;sent&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103188">//&nbsp;to&nbsp;a&nbsp;server.&nbsp;Usually&nbsp;the&nbsp;URL&nbsp;field&nbsp;should&nbsp;be&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103251">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;set&nbsp;this&nbsp;field&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4103315">RequestURI</span>&nbsp;<span class="builtintype" id="4103326">string</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103335">//&nbsp;TLS&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103392">//&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103454">//&nbsp;was&nbsp;received.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103516">//&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package&nbsp;sets&nbsp;the&nbsp;field&nbsp;for</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103571">//&nbsp;TLS-enabled&nbsp;connections&nbsp;before&nbsp;invoking&nbsp;a&nbsp;handler;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103626">//&nbsp;otherwise&nbsp;it&nbsp;leaves&nbsp;the&nbsp;field&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103665">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4103711">TLS</span>&nbsp;<span class="op" id="4103715">*</span><span class="ident" id="4103716">tls</span><span class="op" id="4103719">.</span><span class="ident" id="4103720">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="4103736">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="4103739">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4103794">//&nbsp;in&nbsp;the&nbsp;request&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="4103837">func</span>&nbsp;<span class="op" id="4103842">(</span><span class="ident" id="4103843">r</span>&nbsp;<span class="op" id="4103845">*</span><span class="ident" id="4103846">Request</span><span class="op" id="4103853">)</span>&nbsp;<span class="ident" id="4103855">ProtoAtLeast</span><span class="op" id="4103867">(</span><span class="ident" id="4103868">major</span><span class="op" id="4103873">,</span>&nbsp;<span class="ident" id="4103875">minor</span>&nbsp;<span class="builtintype" id="4103881">int</span><span class="op" id="4103884">)</span>&nbsp;<span class="builtintype" id="4103886">bool</span>&nbsp;<span class="op" id="4103891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4103894">return</span>&nbsp;<span class="ident" id="4103901">r</span><span class="op" id="4103902">.</span><span class="ident" id="4103903">ProtoMajor</span>&nbsp;<span class="op" id="4103914">&gt;</span>&nbsp;<span class="ident" id="4103916">major</span>&nbsp;<span class="op" id="4103922">||</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4103927">r</span><span class="op" id="4103928">.</span><span class="ident" id="4103929">ProtoMajor</span>&nbsp;<span class="op" id="4103940">==</span>&nbsp;<span class="ident" id="4103943">major</span>&nbsp;<span class="op" id="4103949">&amp;&amp;</span>&nbsp;<span class="ident" id="4103952">r</span><span class="op" id="4103953">.</span><span class="ident" id="4103954">ProtoMinor</span>&nbsp;<span class="op" id="4103965">&gt;=</span>&nbsp;<span class="ident" id="4103968">minor</span><br>
<span class="lineno"></span><span class="op" id="4103974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4103977">//&nbsp;UserAgent&nbsp;returns&nbsp;the&nbsp;client&#39;s&nbsp;User-Agent,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="4104047">func</span>&nbsp;<span class="op" id="4104052">(</span><span class="ident" id="4104053">r</span>&nbsp;<span class="op" id="4104055">*</span><span class="ident" id="4104056">Request</span><span class="op" id="4104063">)</span>&nbsp;<span class="ident" id="4104065">UserAgent</span><span class="op" id="4104074">(</span><span class="op" id="4104075">)</span>&nbsp;<span class="builtintype" id="4104077">string</span>&nbsp;<span class="op" id="4104084">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104087">return</span>&nbsp;<span class="ident" id="4104094">r</span><span class="op" id="4104095">.</span><span class="ident" id="4104096">Header</span><span class="op" id="4104102">.</span><span class="ident" id="4104103">Get</span><span class="op" id="4104106">(</span><span class="string" id="4104107">&#34;User-Agent&#34;</span><span class="op" id="4104119">)</span><br>
<span class="lineno"></span><span class="op" id="4104121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4104124">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;cookies&nbsp;sent&nbsp;with&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="4104194">func</span>&nbsp;<span class="op" id="4104199">(</span><span class="ident" id="4104200">r</span>&nbsp;<span class="op" id="4104202">*</span><span class="ident" id="4104203">Request</span><span class="op" id="4104210">)</span>&nbsp;<span class="ident" id="4104212">Cookies</span><span class="op" id="4104219">(</span><span class="op" id="4104220">)</span>&nbsp;<span class="op" id="4104222">[</span><span class="op" id="4104223">]</span><span class="op" id="4104224">*</span><span class="ident" id="4104225">Cookie</span>&nbsp;<span class="op" id="4104232">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104235">return</span>&nbsp;<span class="ident" id="4104242">readCookies</span><span class="op" id="4104253">(</span><span class="ident" id="4104254">r</span><span class="op" id="4104255">.</span><span class="ident" id="4104256">Header</span><span class="op" id="4104262">,</span>&nbsp;<span class="string" id="4104264">&#34;&#34;</span><span class="op" id="4104266">)</span><br>
<span class="lineno"></span><span class="op" id="4104268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4104271">var</span>&nbsp;<span class="ident" id="4104275">ErrNoCookie</span>&nbsp;<span class="op" id="4104287">=</span>&nbsp;<span class="ident" id="4104289">errors</span><span class="op" id="4104295">.</span><span class="ident" id="4104296">New</span><span class="op" id="4104299">(</span><span class="string" id="4104300">&#34;http:&nbsp;named&nbsp;cookie&nbsp;not&nbsp;present&#34;</span><span class="op" id="4104332">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="4104335">//&nbsp;Cookie&nbsp;returns&nbsp;the&nbsp;named&nbsp;cookie&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4104397">//&nbsp;ErrNoCookie&nbsp;if&nbsp;not&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4104426">func</span>&nbsp;<span class="op" id="4104431">(</span><span class="ident" id="4104432">r</span>&nbsp;<span class="op" id="4104434">*</span><span class="ident" id="4104435">Request</span><span class="op" id="4104442">)</span>&nbsp;<span class="ident" id="4104444">Cookie</span><span class="op" id="4104450">(</span><span class="ident" id="4104451">name</span>&nbsp;<span class="builtintype" id="4104456">string</span><span class="op" id="4104462">)</span>&nbsp;<span class="op" id="4104464">(</span><span class="op" id="4104465">*</span><span class="ident" id="4104466">Cookie</span><span class="op" id="4104472">,</span>&nbsp;<span class="builtintype" id="4104474">error</span><span class="op" id="4104479">)</span>&nbsp;<span class="op" id="4104481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104484">for</span>&nbsp;<span class="ident" id="4104488">_</span><span class="op" id="4104489">,</span>&nbsp;<span class="ident" id="4104491">c</span>&nbsp;<span class="op" id="4104493">:=</span>&nbsp;<span class="keyword" id="4104496">range</span>&nbsp;<span class="ident" id="4104502">readCookies</span><span class="op" id="4104513">(</span><span class="ident" id="4104514">r</span><span class="op" id="4104515">.</span><span class="ident" id="4104516">Header</span><span class="op" id="4104522">,</span>&nbsp;<span class="ident" id="4104524">name</span><span class="op" id="4104528">)</span>&nbsp;<span class="op" id="4104530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104534">return</span>&nbsp;<span class="ident" id="4104541">c</span><span class="op" id="4104542">,</span>&nbsp;<span class="builtintype" id="4104544">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4104549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104552">return</span>&nbsp;<span class="builtintype" id="4104559">nil</span><span class="op" id="4104562">,</span>&nbsp;<span class="ident" id="4104564">ErrNoCookie</span><br>
<span class="lineno"></span><span class="op" id="4104576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4104579">//&nbsp;AddCookie&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;to&nbsp;the&nbsp;request.&nbsp;&nbsp;Per&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.4,</span><br>
<span class="lineno">260</span><span class="comment" id="4104649">//&nbsp;AddCookie&nbsp;does&nbsp;not&nbsp;attach&nbsp;more&nbsp;than&nbsp;one&nbsp;Cookie&nbsp;header&nbsp;field.&nbsp;&nbsp;That</span><br>
<span class="lineno"></span><span class="comment" id="4104719">//&nbsp;means&nbsp;all&nbsp;cookies,&nbsp;if&nbsp;any,&nbsp;are&nbsp;written&nbsp;into&nbsp;the&nbsp;same&nbsp;line,</span><br>
<span class="lineno"></span><span class="comment" id="4104781">//&nbsp;separated&nbsp;by&nbsp;semicolon.</span><br>
<span class="lineno"></span><span class="keyword" id="4104808">func</span>&nbsp;<span class="op" id="4104813">(</span><span class="ident" id="4104814">r</span>&nbsp;<span class="op" id="4104816">*</span><span class="ident" id="4104817">Request</span><span class="op" id="4104824">)</span>&nbsp;<span class="ident" id="4104826">AddCookie</span><span class="op" id="4104835">(</span><span class="ident" id="4104836">c</span>&nbsp;<span class="op" id="4104838">*</span><span class="ident" id="4104839">Cookie</span><span class="op" id="4104845">)</span>&nbsp;<span class="op" id="4104847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104850">s</span>&nbsp;<span class="op" id="4104852">:=</span>&nbsp;<span class="ident" id="4104855">fmt</span><span class="op" id="4104858">.</span><span class="ident" id="4104859">Sprintf</span><span class="op" id="4104866">(</span><span class="string" id="4104867">&#34;%s=%s&#34;</span><span class="op" id="4104874">,</span>&nbsp;<span class="ident" id="4104876">sanitizeCookieName</span><span class="op" id="4104894">(</span><span class="ident" id="4104895">c</span><span class="op" id="4104896">.</span><span class="ident" id="4104897">Name</span><span class="op" id="4104901">)</span><span class="op" id="4104902">,</span>&nbsp;<span class="ident" id="4104904">sanitizeCookieValue</span><span class="op" id="4104923">(</span><span class="ident" id="4104924">c</span><span class="op" id="4104925">.</span><span class="ident" id="4104926">Value</span><span class="op" id="4104931">)</span><span class="op" id="4104932">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104935">if</span>&nbsp;<span class="ident" id="4104938">c</span>&nbsp;<span class="op" id="4104940">:=</span>&nbsp;<span class="ident" id="4104943">r</span><span class="op" id="4104944">.</span><span class="ident" id="4104945">Header</span><span class="op" id="4104951">.</span><span class="ident" id="4104952">Get</span><span class="op" id="4104955">(</span><span class="string" id="4104956">&#34;Cookie&#34;</span><span class="op" id="4104964">)</span><span class="op" id="4104965">;</span>&nbsp;<span class="ident" id="4104967">c</span>&nbsp;<span class="op" id="4104969">!=</span>&nbsp;<span class="string" id="4104972">&#34;&#34;</span>&nbsp;<span class="op" id="4104975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104979">r</span><span class="op" id="4104980">.</span><span class="ident" id="4104981">Header</span><span class="op" id="4104987">.</span><span class="ident" id="4104988">Set</span><span class="op" id="4104991">(</span><span class="string" id="4104992">&#34;Cookie&#34;</span><span class="op" id="4105000">,</span>&nbsp;<span class="ident" id="4105002">c</span><span class="op" id="4105003">+</span><span class="string" id="4105004">&#34;;&nbsp;&#34;</span><span class="op" id="4105008">+</span><span class="ident" id="4105009">s</span><span class="op" id="4105010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4105013">}</span>&nbsp;<span class="keyword" id="4105015">else</span>&nbsp;<span class="op" id="4105020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105024">r</span><span class="op" id="4105025">.</span><span class="ident" id="4105026">Header</span><span class="op" id="4105032">.</span><span class="ident" id="4105033">Set</span><span class="op" id="4105036">(</span><span class="string" id="4105037">&#34;Cookie&#34;</span><span class="op" id="4105045">,</span>&nbsp;<span class="ident" id="4105047">s</span><span class="op" id="4105048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4105051">}</span><br>
<span class="lineno">270</span><span class="op" id="4105053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4105056">//&nbsp;Referer&nbsp;returns&nbsp;the&nbsp;referring&nbsp;URL,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="4105118">//</span><br>
<span class="lineno"></span><span class="comment" id="4105121">//&nbsp;Referer&nbsp;is&nbsp;misspelled&nbsp;as&nbsp;in&nbsp;the&nbsp;request&nbsp;itself,&nbsp;a&nbsp;mistake&nbsp;from&nbsp;the</span><br>
<span class="lineno">275</span><span class="comment" id="4105191">//&nbsp;earliest&nbsp;days&nbsp;of&nbsp;HTTP.&nbsp;&nbsp;This&nbsp;value&nbsp;can&nbsp;also&nbsp;be&nbsp;fetched&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4105258">//&nbsp;Header&nbsp;map&nbsp;as&nbsp;Header[&#34;Referer&#34;];&nbsp;the&nbsp;benefit&nbsp;of&nbsp;making&nbsp;it&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="4105329">//&nbsp;as&nbsp;a&nbsp;method&nbsp;is&nbsp;that&nbsp;the&nbsp;compiler&nbsp;can&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4105400">//&nbsp;alternate&nbsp;(correct&nbsp;English)&nbsp;spelling&nbsp;req.Referrer()&nbsp;but&nbsp;cannot</span><br>
<span class="lineno"></span><span class="comment" id="4105466">//&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;Header[&#34;Referrer&#34;].</span><br>
<span class="lineno">280</span><span class="keyword" id="4105516">func</span>&nbsp;<span class="op" id="4105521">(</span><span class="ident" id="4105522">r</span>&nbsp;<span class="op" id="4105524">*</span><span class="ident" id="4105525">Request</span><span class="op" id="4105532">)</span>&nbsp;<span class="ident" id="4105534">Referer</span><span class="op" id="4105541">(</span><span class="op" id="4105542">)</span>&nbsp;<span class="builtintype" id="4105544">string</span>&nbsp;<span class="op" id="4105551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105554">return</span>&nbsp;<span class="ident" id="4105561">r</span><span class="op" id="4105562">.</span><span class="ident" id="4105563">Header</span><span class="op" id="4105569">.</span><span class="ident" id="4105570">Get</span><span class="op" id="4105573">(</span><span class="string" id="4105574">&#34;Referer&#34;</span><span class="op" id="4105583">)</span><br>
<span class="lineno"></span><span class="op" id="4105585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4105588">//&nbsp;multipartByReader&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno">285</span><span class="comment" id="4105630">//&nbsp;Its&nbsp;presence&nbsp;in&nbsp;Request.MultipartForm&nbsp;indicates&nbsp;that&nbsp;parsing&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="4105709">//&nbsp;body&nbsp;has&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;a&nbsp;MultipartReader&nbsp;instead&nbsp;of&nbsp;ParseMultipartFrom.</span><br>
<span class="lineno"></span><span class="keyword" id="4105789">var</span>&nbsp;<span class="ident" id="4105793">multipartByReader</span>&nbsp;<span class="op" id="4105811">=</span>&nbsp;<span class="op" id="4105813">&amp;</span><span class="ident" id="4105814">multipart</span><span class="op" id="4105823">.</span><span class="ident" id="4105824">Form</span><span class="op" id="4105828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105831">Value</span><span class="op" id="4105836">:</span>&nbsp;<span class="builtinfunc" id="4105838">make</span><span class="op" id="4105842">(</span><span class="keyword" id="4105843">map</span><span class="op" id="4105846">[</span><span class="builtintype" id="4105847">string</span><span class="op" id="4105853">]</span><span class="op" id="4105854">[</span><span class="op" id="4105855">]</span><span class="builtintype" id="4105856">string</span><span class="op" id="4105862">)</span><span class="op" id="4105863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105866">File</span><span class="op" id="4105870">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="4105873">make</span><span class="op" id="4105877">(</span><span class="keyword" id="4105878">map</span><span class="op" id="4105881">[</span><span class="builtintype" id="4105882">string</span><span class="op" id="4105888">]</span><span class="op" id="4105889">[</span><span class="op" id="4105890">]</span><span class="op" id="4105891">*</span><span class="ident" id="4105892">multipart</span><span class="op" id="4105901">.</span><span class="ident" id="4105902">FileHeader</span><span class="op" id="4105912">)</span><span class="op" id="4105913">,</span><br>
<span class="lineno">290</span><span class="op" id="4105915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4105918">//&nbsp;MultipartReader&nbsp;returns&nbsp;a&nbsp;MIME&nbsp;multipart&nbsp;reader&nbsp;if&nbsp;this&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4105982">//&nbsp;multipart/form-data&nbsp;POST&nbsp;request,&nbsp;else&nbsp;returns&nbsp;nil&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4106050">//&nbsp;Use&nbsp;this&nbsp;function&nbsp;instead&nbsp;of&nbsp;ParseMultipartForm&nbsp;to</span><br>
<span class="lineno">295</span><span class="comment" id="4106104">//&nbsp;process&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="4106145">func</span>&nbsp;<span class="op" id="4106150">(</span><span class="ident" id="4106151">r</span>&nbsp;<span class="op" id="4106153">*</span><span class="ident" id="4106154">Request</span><span class="op" id="4106161">)</span>&nbsp;<span class="ident" id="4106163">MultipartReader</span><span class="op" id="4106178">(</span><span class="op" id="4106179">)</span>&nbsp;<span class="op" id="4106181">(</span><span class="op" id="4106182">*</span><span class="ident" id="4106183">multipart</span><span class="op" id="4106192">.</span><span class="ident" id="4106193">Reader</span><span class="op" id="4106199">,</span>&nbsp;<span class="builtintype" id="4106201">error</span><span class="op" id="4106206">)</span>&nbsp;<span class="op" id="4106208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106211">if</span>&nbsp;<span class="ident" id="4106214">r</span><span class="op" id="4106215">.</span><span class="ident" id="4106216">MultipartForm</span>&nbsp;<span class="op" id="4106230">==</span>&nbsp;<span class="ident" id="4106233">multipartByReader</span>&nbsp;<span class="op" id="4106251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106255">return</span>&nbsp;<span class="builtintype" id="4106262">nil</span><span class="op" id="4106265">,</span>&nbsp;<span class="ident" id="4106267">errors</span><span class="op" id="4106273">.</span><span class="ident" id="4106274">New</span><span class="op" id="4106277">(</span><span class="string" id="4106278">&#34;http:&nbsp;MultipartReader&nbsp;called&nbsp;twice&#34;</span><span class="op" id="4106314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4106317">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106320">if</span>&nbsp;<span class="ident" id="4106323">r</span><span class="op" id="4106324">.</span><span class="ident" id="4106325">MultipartForm</span>&nbsp;<span class="op" id="4106339">!=</span>&nbsp;<span class="builtintype" id="4106342">nil</span>&nbsp;<span class="op" id="4106346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106350">return</span>&nbsp;<span class="builtintype" id="4106357">nil</span><span class="op" id="4106360">,</span>&nbsp;<span class="ident" id="4106362">errors</span><span class="op" id="4106368">.</span><span class="ident" id="4106369">New</span><span class="op" id="4106372">(</span><span class="string" id="4106373">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&#34;</span><span class="op" id="4106420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4106423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106426">r</span><span class="op" id="4106427">.</span><span class="ident" id="4106428">MultipartForm</span>&nbsp;<span class="op" id="4106442">=</span>&nbsp;<span class="ident" id="4106444">multipartByReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106463">return</span>&nbsp;<span class="ident" id="4106470">r</span><span class="op" id="4106471">.</span><span class="ident" id="4106472">multipartReader</span><span class="op" id="4106487">(</span><span class="op" id="4106488">)</span><br>
<span class="lineno">305</span><span class="op" id="4106490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4106493">func</span>&nbsp;<span class="op" id="4106498">(</span><span class="ident" id="4106499">r</span>&nbsp;<span class="op" id="4106501">*</span><span class="ident" id="4106502">Request</span><span class="op" id="4106509">)</span>&nbsp;<span class="ident" id="4106511">multipartReader</span><span class="op" id="4106526">(</span><span class="op" id="4106527">)</span>&nbsp;<span class="op" id="4106529">(</span><span class="op" id="4106530">*</span><span class="ident" id="4106531">multipart</span><span class="op" id="4106540">.</span><span class="ident" id="4106541">Reader</span><span class="op" id="4106547">,</span>&nbsp;<span class="builtintype" id="4106549">error</span><span class="op" id="4106554">)</span>&nbsp;<span class="op" id="4106556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106559">v</span>&nbsp;<span class="op" id="4106561">:=</span>&nbsp;<span class="ident" id="4106564">r</span><span class="op" id="4106565">.</span><span class="ident" id="4106566">Header</span><span class="op" id="4106572">.</span><span class="ident" id="4106573">Get</span><span class="op" id="4106576">(</span><span class="string" id="4106577">&#34;Content-Type&#34;</span><span class="op" id="4106591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106594">if</span>&nbsp;<span class="ident" id="4106597">v</span>&nbsp;<span class="op" id="4106599">==</span>&nbsp;<span class="string" id="4106602">&#34;&#34;</span>&nbsp;<span class="op" id="4106605">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106609">return</span>&nbsp;<span class="builtintype" id="4106616">nil</span><span class="op" id="4106619">,</span>&nbsp;<span class="ident" id="4106621">ErrNotMultipart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4106638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106641">d</span><span class="op" id="4106642">,</span>&nbsp;<span class="ident" id="4106644">params</span><span class="op" id="4106650">,</span>&nbsp;<span class="ident" id="4106652">err</span>&nbsp;<span class="op" id="4106656">:=</span>&nbsp;<span class="ident" id="4106659">mime</span><span class="op" id="4106663">.</span><span class="ident" id="4106664">ParseMediaType</span><span class="op" id="4106678">(</span><span class="ident" id="4106679">v</span><span class="op" id="4106680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106683">if</span>&nbsp;<span class="ident" id="4106686">err</span>&nbsp;<span class="op" id="4106690">!=</span>&nbsp;<span class="builtintype" id="4106693">nil</span>&nbsp;<span class="op" id="4106697">||</span>&nbsp;<span class="ident" id="4106700">d</span>&nbsp;<span class="op" id="4106702">!=</span>&nbsp;<span class="string" id="4106705">&#34;multipart/form-data&#34;</span>&nbsp;<span class="op" id="4106727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106731">return</span>&nbsp;<span class="builtintype" id="4106738">nil</span><span class="op" id="4106741">,</span>&nbsp;<span class="ident" id="4106743">ErrNotMultipart</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4106760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106763">boundary</span><span class="op" id="4106771">,</span>&nbsp;<span class="ident" id="4106773">ok</span>&nbsp;<span class="op" id="4106776">:=</span>&nbsp;<span class="ident" id="4106779">params</span><span class="op" id="4106785">[</span><span class="string" id="4106786">&#34;boundary&#34;</span><span class="op" id="4106796">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106799">if</span>&nbsp;<span class="op" id="4106802">!</span><span class="ident" id="4106803">ok</span>&nbsp;<span class="op" id="4106806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106810">return</span>&nbsp;<span class="builtintype" id="4106817">nil</span><span class="op" id="4106820">,</span>&nbsp;<span class="ident" id="4106822">ErrMissingBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4106842">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106845">return</span>&nbsp;<span class="ident" id="4106852">multipart</span><span class="op" id="4106861">.</span><span class="ident" id="4106862">NewReader</span><span class="op" id="4106871">(</span><span class="ident" id="4106872">r</span><span class="op" id="4106873">.</span><span class="ident" id="4106874">Body</span><span class="op" id="4106878">,</span>&nbsp;<span class="ident" id="4106880">boundary</span><span class="op" id="4106888">)</span><span class="op" id="4106889">,</span>&nbsp;<span class="builtintype" id="4106891">nil</span><br>
<span class="lineno"></span><span class="op" id="4106895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4106898">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="4106942">func</span>&nbsp;<span class="ident" id="4106947">valueOrDefault</span><span class="op" id="4106961">(</span><span class="ident" id="4106962">value</span><span class="op" id="4106967">,</span>&nbsp;<span class="ident" id="4106969">def</span>&nbsp;<span class="builtintype" id="4106973">string</span><span class="op" id="4106979">)</span>&nbsp;<span class="builtintype" id="4106981">string</span>&nbsp;<span class="op" id="4106988">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106991">if</span>&nbsp;<span class="ident" id="4106994">value</span>&nbsp;<span class="op" id="4107000">!=</span>&nbsp;<span class="string" id="4107003">&#34;&#34;</span>&nbsp;<span class="op" id="4107006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107010">return</span>&nbsp;<span class="ident" id="4107017">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4107024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107027">return</span>&nbsp;<span class="ident" id="4107034">def</span><br>
<span class="lineno"></span><span class="op" id="4107038">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="4107041">//&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;reflect&nbsp;the&nbsp;actual&nbsp;Go&nbsp;version&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="4107116">//&nbsp;It&nbsp;was&nbsp;changed&nbsp;from&nbsp;&#34;Go&nbsp;http&nbsp;package&#34;&nbsp;to&nbsp;&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4107189">//&nbsp;time&nbsp;of&nbsp;the&nbsp;Go&nbsp;1.1&nbsp;release&nbsp;because&nbsp;the&nbsp;former&nbsp;User-Agent&nbsp;had&nbsp;ended&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="4107262">//&nbsp;on&nbsp;a&nbsp;blacklist&nbsp;for&nbsp;some&nbsp;intrusion&nbsp;detection&nbsp;systems.</span><br>
<span class="lineno">335</span><span class="comment" id="4107318">//&nbsp;See&nbsp;https://codereview.appspot.com/7532043.</span><br>
<span class="lineno"></span><span class="keyword" id="4107365">const</span>&nbsp;<span class="ident" id="4107371">defaultUserAgent</span>&nbsp;<span class="op" id="4107388">=</span>&nbsp;<span class="string" id="4107390">&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4107413">//&nbsp;Write&nbsp;writes&nbsp;an&nbsp;HTTP/1.1&nbsp;request&nbsp;--&nbsp;header&nbsp;and&nbsp;body&nbsp;--&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="4107487">//&nbsp;This&nbsp;method&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;request:</span><br>
<span class="lineno">340</span><span class="comment" id="4107548">//&nbsp;&nbsp;&nbsp;&nbsp;Host</span><br>
<span class="lineno"></span><span class="comment" id="4107556">//&nbsp;&nbsp;&nbsp;&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="4107563">//&nbsp;&nbsp;&nbsp;&nbsp;Method&nbsp;(defaults&nbsp;to&nbsp;&#34;GET&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="4107593">//&nbsp;&nbsp;&nbsp;&nbsp;Header</span><br>
<span class="lineno"></span><span class="comment" id="4107603">//&nbsp;&nbsp;&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">345</span><span class="comment" id="4107620">//&nbsp;&nbsp;&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4107640">//&nbsp;&nbsp;&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="4107648">//</span><br>
<span class="lineno"></span><span class="comment" id="4107651">//&nbsp;If&nbsp;Body&nbsp;is&nbsp;present,&nbsp;Content-Length&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;and&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4107718">//&nbsp;hasn&#39;t&nbsp;been&nbsp;set&nbsp;to&nbsp;&#34;identity&#34;,&nbsp;Write&nbsp;adds&nbsp;&#34;Transfer-Encoding:</span><br>
<span class="lineno">350</span><span class="comment" id="4107783">//&nbsp;chunked&#34;&nbsp;to&nbsp;the&nbsp;header.&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="4107843">func</span>&nbsp;<span class="op" id="4107848">(</span><span class="ident" id="4107849">r</span>&nbsp;<span class="op" id="4107851">*</span><span class="ident" id="4107852">Request</span><span class="op" id="4107859">)</span>&nbsp;<span class="ident" id="4107861">Write</span><span class="op" id="4107866">(</span><span class="ident" id="4107867">w</span>&nbsp;<span class="ident" id="4107869">io</span><span class="op" id="4107871">.</span><span class="ident" id="4107872">Writer</span><span class="op" id="4107878">)</span>&nbsp;<span class="builtintype" id="4107880">error</span>&nbsp;<span class="op" id="4107886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107889">return</span>&nbsp;<span class="ident" id="4107896">r</span><span class="op" id="4107897">.</span><span class="ident" id="4107898">write</span><span class="op" id="4107903">(</span><span class="ident" id="4107904">w</span><span class="op" id="4107905">,</span>&nbsp;<span class="builtintype" id="4107907">false</span><span class="op" id="4107912">,</span>&nbsp;<span class="builtintype" id="4107914">nil</span><span class="op" id="4107917">)</span><br>
<span class="lineno"></span><span class="op" id="4107919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="4107922">//&nbsp;WriteProxy&nbsp;is&nbsp;like&nbsp;Write&nbsp;but&nbsp;writes&nbsp;the&nbsp;request&nbsp;in&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="4107985">//&nbsp;expected&nbsp;by&nbsp;an&nbsp;HTTP&nbsp;proxy.&nbsp;&nbsp;In&nbsp;particular,&nbsp;WriteProxy&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4108053">//&nbsp;initial&nbsp;Request-URI&nbsp;line&nbsp;of&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;absolute&nbsp;URI,&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="4108122">//&nbsp;section&nbsp;5.1.2&nbsp;of&nbsp;RFC&nbsp;2616,&nbsp;including&nbsp;the&nbsp;scheme&nbsp;and&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="4108183">//&nbsp;In&nbsp;either&nbsp;case,&nbsp;WriteProxy&nbsp;also&nbsp;writes&nbsp;a&nbsp;Host&nbsp;header,&nbsp;using</span><br>
<span class="lineno">360</span><span class="comment" id="4108246">//&nbsp;either&nbsp;r.Host&nbsp;or&nbsp;r.URL.Host.</span><br>
<span class="lineno"></span><span class="keyword" id="4108278">func</span>&nbsp;<span class="op" id="4108283">(</span><span class="ident" id="4108284">r</span>&nbsp;<span class="op" id="4108286">*</span><span class="ident" id="4108287">Request</span><span class="op" id="4108294">)</span>&nbsp;<span class="ident" id="4108296">WriteProxy</span><span class="op" id="4108306">(</span><span class="ident" id="4108307">w</span>&nbsp;<span class="ident" id="4108309">io</span><span class="op" id="4108311">.</span><span class="ident" id="4108312">Writer</span><span class="op" id="4108318">)</span>&nbsp;<span class="builtintype" id="4108320">error</span>&nbsp;<span class="op" id="4108326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108329">return</span>&nbsp;<span class="ident" id="4108336">r</span><span class="op" id="4108337">.</span><span class="ident" id="4108338">write</span><span class="op" id="4108343">(</span><span class="ident" id="4108344">w</span><span class="op" id="4108345">,</span>&nbsp;<span class="builtintype" id="4108347">true</span><span class="op" id="4108351">,</span>&nbsp;<span class="builtintype" id="4108353">nil</span><span class="op" id="4108356">)</span><br>
<span class="lineno"></span><span class="op" id="4108358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4108361">//&nbsp;extraHeaders&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span><span class="keyword" id="4108388">func</span>&nbsp;<span class="op" id="4108393">(</span><span class="ident" id="4108394">req</span>&nbsp;<span class="op" id="4108398">*</span><span class="ident" id="4108399">Request</span><span class="op" id="4108406">)</span>&nbsp;<span class="ident" id="4108408">write</span><span class="op" id="4108413">(</span><span class="ident" id="4108414">w</span>&nbsp;<span class="ident" id="4108416">io</span><span class="op" id="4108418">.</span><span class="ident" id="4108419">Writer</span><span class="op" id="4108425">,</span>&nbsp;<span class="ident" id="4108427">usingProxy</span>&nbsp;<span class="builtintype" id="4108438">bool</span><span class="op" id="4108442">,</span>&nbsp;<span class="ident" id="4108444">extraHeaders</span>&nbsp;<span class="ident" id="4108457">Header</span><span class="op" id="4108463">)</span>&nbsp;<span class="builtintype" id="4108465">error</span>&nbsp;<span class="op" id="4108471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108474">host</span>&nbsp;<span class="op" id="4108479">:=</span>&nbsp;<span class="ident" id="4108482">req</span><span class="op" id="4108485">.</span><span class="ident" id="4108486">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108492">if</span>&nbsp;<span class="ident" id="4108495">host</span>&nbsp;<span class="op" id="4108500">==</span>&nbsp;<span class="string" id="4108503">&#34;&#34;</span>&nbsp;<span class="op" id="4108506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108510">if</span>&nbsp;<span class="ident" id="4108513">req</span><span class="op" id="4108516">.</span><span class="ident" id="4108517">URL</span>&nbsp;<span class="op" id="4108521">==</span>&nbsp;<span class="builtintype" id="4108524">nil</span>&nbsp;<span class="op" id="4108528">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108533">return</span>&nbsp;<span class="ident" id="4108540">errors</span><span class="op" id="4108546">.</span><span class="ident" id="4108547">New</span><span class="op" id="4108550">(</span><span class="string" id="4108551">&#34;http:&nbsp;Request.Write&nbsp;on&nbsp;Request&nbsp;with&nbsp;no&nbsp;Host&nbsp;or&nbsp;URL&nbsp;set&#34;</span><span class="op" id="4108607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4108611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108615">host</span>&nbsp;<span class="op" id="4108620">=</span>&nbsp;<span class="ident" id="4108622">req</span><span class="op" id="4108625">.</span><span class="ident" id="4108626">URL</span><span class="op" id="4108629">.</span><span class="ident" id="4108630">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4108636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108640">ruri</span>&nbsp;<span class="op" id="4108645">:=</span>&nbsp;<span class="ident" id="4108648">req</span><span class="op" id="4108651">.</span><span class="ident" id="4108652">URL</span><span class="op" id="4108655">.</span><span class="ident" id="4108656">RequestURI</span><span class="op" id="4108666">(</span><span class="op" id="4108667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108670">if</span>&nbsp;<span class="ident" id="4108673">usingProxy</span>&nbsp;<span class="op" id="4108684">&amp;&amp;</span>&nbsp;<span class="ident" id="4108687">req</span><span class="op" id="4108690">.</span><span class="ident" id="4108691">URL</span><span class="op" id="4108694">.</span><span class="ident" id="4108695">Scheme</span>&nbsp;<span class="op" id="4108702">!=</span>&nbsp;<span class="string" id="4108705">&#34;&#34;</span>&nbsp;<span class="op" id="4108708">&amp;&amp;</span>&nbsp;<span class="ident" id="4108711">req</span><span class="op" id="4108714">.</span><span class="ident" id="4108715">URL</span><span class="op" id="4108718">.</span><span class="ident" id="4108719">Opaque</span>&nbsp;<span class="op" id="4108726">==</span>&nbsp;<span class="string" id="4108729">&#34;&#34;</span>&nbsp;<span class="op" id="4108732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108736">ruri</span>&nbsp;<span class="op" id="4108741">=</span>&nbsp;<span class="ident" id="4108743">req</span><span class="op" id="4108746">.</span><span class="ident" id="4108747">URL</span><span class="op" id="4108750">.</span><span class="ident" id="4108751">Scheme</span>&nbsp;<span class="op" id="4108758">+</span>&nbsp;<span class="string" id="4108760">&#34;://&#34;</span>&nbsp;<span class="op" id="4108766">+</span>&nbsp;<span class="ident" id="4108768">host</span>&nbsp;<span class="op" id="4108773">+</span>&nbsp;<span class="ident" id="4108775">ruri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4108781">}</span>&nbsp;<span class="keyword" id="4108783">else</span>&nbsp;<span class="keyword" id="4108788">if</span>&nbsp;<span class="ident" id="4108791">req</span><span class="op" id="4108794">.</span><span class="ident" id="4108795">Method</span>&nbsp;<span class="op" id="4108802">==</span>&nbsp;<span class="string" id="4108805">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="4108815">&amp;&amp;</span>&nbsp;<span class="ident" id="4108818">req</span><span class="op" id="4108821">.</span><span class="ident" id="4108822">URL</span><span class="op" id="4108825">.</span><span class="ident" id="4108826">Path</span>&nbsp;<span class="op" id="4108831">==</span>&nbsp;<span class="string" id="4108834">&#34;&#34;</span>&nbsp;<span class="op" id="4108837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4108841">//&nbsp;CONNECT&nbsp;requests&nbsp;normally&nbsp;give&nbsp;just&nbsp;the&nbsp;host&nbsp;and&nbsp;port,&nbsp;not&nbsp;a&nbsp;full&nbsp;URL.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108917">ruri</span>&nbsp;<span class="op" id="4108922">=</span>&nbsp;<span class="ident" id="4108924">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4108930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4108933">//&nbsp;TODO(bradfitz):&nbsp;escape&nbsp;at&nbsp;least&nbsp;newlines&nbsp;in&nbsp;ruri?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4108988">//&nbsp;Wrap&nbsp;the&nbsp;writer&nbsp;in&nbsp;a&nbsp;bufio&nbsp;Writer&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;already&nbsp;buffered.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109056">//&nbsp;Don&#39;t&nbsp;always&nbsp;call&nbsp;NewWriter,&nbsp;as&nbsp;that&nbsp;forces&nbsp;a&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109119">//&nbsp;and&nbsp;other&nbsp;small&nbsp;bufio&nbsp;Writers&nbsp;to&nbsp;have&nbsp;a&nbsp;minimum&nbsp;4k&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109181">//&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109191">var</span>&nbsp;<span class="ident" id="4109195">bw</span>&nbsp;<span class="op" id="4109198">*</span><span class="ident" id="4109199">bufio</span><span class="op" id="4109204">.</span><span class="ident" id="4109205">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109213">if</span>&nbsp;<span class="ident" id="4109216">_</span><span class="op" id="4109217">,</span>&nbsp;<span class="ident" id="4109219">ok</span>&nbsp;<span class="op" id="4109222">:=</span>&nbsp;<span class="ident" id="4109225">w</span><span class="op" id="4109226">.</span><span class="op" id="4109227">(</span><span class="ident" id="4109228">io</span><span class="op" id="4109230">.</span><span class="ident" id="4109231">ByteWriter</span><span class="op" id="4109241">)</span><span class="op" id="4109242">;</span>&nbsp;<span class="op" id="4109244">!</span><span class="ident" id="4109245">ok</span>&nbsp;<span class="op" id="4109248">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109252">bw</span>&nbsp;<span class="op" id="4109255">=</span>&nbsp;<span class="ident" id="4109257">bufio</span><span class="op" id="4109262">.</span><span class="ident" id="4109263">NewWriter</span><span class="op" id="4109272">(</span><span class="ident" id="4109273">w</span><span class="op" id="4109274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109278">w</span>&nbsp;<span class="op" id="4109280">=</span>&nbsp;<span class="ident" id="4109282">bw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109290">_</span><span class="op" id="4109291">,</span>&nbsp;<span class="ident" id="4109293">err</span>&nbsp;<span class="op" id="4109297">:=</span>&nbsp;<span class="ident" id="4109300">fmt</span><span class="op" id="4109303">.</span><span class="ident" id="4109304">Fprintf</span><span class="op" id="4109311">(</span><span class="ident" id="4109312">w</span><span class="op" id="4109313">,</span>&nbsp;<span class="string" id="4109315">&#34;%s&nbsp;%s&nbsp;HTTP/1.1\r\n&#34;</span><span class="op" id="4109335">,</span>&nbsp;<span class="ident" id="4109337">valueOrDefault</span><span class="op" id="4109351">(</span><span class="ident" id="4109352">req</span><span class="op" id="4109355">.</span><span class="ident" id="4109356">Method</span><span class="op" id="4109362">,</span>&nbsp;<span class="string" id="4109364">&#34;GET&#34;</span><span class="op" id="4109369">)</span><span class="op" id="4109370">,</span>&nbsp;<span class="ident" id="4109372">ruri</span><span class="op" id="4109376">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109379">if</span>&nbsp;<span class="ident" id="4109382">err</span>&nbsp;<span class="op" id="4109386">!=</span>&nbsp;<span class="builtintype" id="4109389">nil</span>&nbsp;<span class="op" id="4109393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109397">return</span>&nbsp;<span class="ident" id="4109404">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109413">//&nbsp;Header&nbsp;lines</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109430">_</span><span class="op" id="4109431">,</span>&nbsp;<span class="ident" id="4109433">err</span>&nbsp;<span class="op" id="4109437">=</span>&nbsp;<span class="ident" id="4109439">fmt</span><span class="op" id="4109442">.</span><span class="ident" id="4109443">Fprintf</span><span class="op" id="4109450">(</span><span class="ident" id="4109451">w</span><span class="op" id="4109452">,</span>&nbsp;<span class="string" id="4109454">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="4109468">,</span>&nbsp;<span class="ident" id="4109470">host</span><span class="op" id="4109474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109477">if</span>&nbsp;<span class="ident" id="4109480">err</span>&nbsp;<span class="op" id="4109484">!=</span>&nbsp;<span class="builtintype" id="4109487">nil</span>&nbsp;<span class="op" id="4109491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109495">return</span>&nbsp;<span class="ident" id="4109502">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109511">//&nbsp;Use&nbsp;the&nbsp;defaultUserAgent&nbsp;unless&nbsp;the&nbsp;Header&nbsp;contains&nbsp;one,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109578">//&nbsp;may&nbsp;be&nbsp;blank&nbsp;to&nbsp;not&nbsp;send&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109619">userAgent</span>&nbsp;<span class="op" id="4109629">:=</span>&nbsp;<span class="ident" id="4109632">defaultUserAgent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109650">if</span>&nbsp;<span class="ident" id="4109653">req</span><span class="op" id="4109656">.</span><span class="ident" id="4109657">Header</span>&nbsp;<span class="op" id="4109664">!=</span>&nbsp;<span class="builtintype" id="4109667">nil</span>&nbsp;<span class="op" id="4109671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109675">if</span>&nbsp;<span class="ident" id="4109678">ua</span>&nbsp;<span class="op" id="4109681">:=</span>&nbsp;<span class="ident" id="4109684">req</span><span class="op" id="4109687">.</span><span class="ident" id="4109688">Header</span><span class="op" id="4109694">[</span><span class="string" id="4109695">&#34;User-Agent&#34;</span><span class="op" id="4109707">]</span><span class="op" id="4109708">;</span>&nbsp;<span class="builtinfunc" id="4109710">len</span><span class="op" id="4109713">(</span><span class="ident" id="4109714">ua</span><span class="op" id="4109716">)</span>&nbsp;<span class="op" id="4109718">&gt;</span>&nbsp;<span class="num" id="4109720">0</span>&nbsp;<span class="op" id="4109722">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109727">userAgent</span>&nbsp;<span class="op" id="4109737">=</span>&nbsp;<span class="ident" id="4109739">ua</span><span class="op" id="4109741">[</span><span class="num" id="4109742">0</span><span class="op" id="4109743">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109753">if</span>&nbsp;<span class="ident" id="4109756">userAgent</span>&nbsp;<span class="op" id="4109766">!=</span>&nbsp;<span class="string" id="4109769">&#34;&#34;</span>&nbsp;<span class="op" id="4109772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109776">_</span><span class="op" id="4109777">,</span>&nbsp;<span class="ident" id="4109779">err</span>&nbsp;<span class="op" id="4109783">=</span>&nbsp;<span class="ident" id="4109785">fmt</span><span class="op" id="4109788">.</span><span class="ident" id="4109789">Fprintf</span><span class="op" id="4109796">(</span><span class="ident" id="4109797">w</span><span class="op" id="4109798">,</span>&nbsp;<span class="string" id="4109800">&#34;User-Agent:&nbsp;%s\r\n&#34;</span><span class="op" id="4109820">,</span>&nbsp;<span class="ident" id="4109822">userAgent</span><span class="op" id="4109831">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109835">if</span>&nbsp;<span class="ident" id="4109838">err</span>&nbsp;<span class="op" id="4109842">!=</span>&nbsp;<span class="builtintype" id="4109845">nil</span>&nbsp;<span class="op" id="4109849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109854">return</span>&nbsp;<span class="ident" id="4109861">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109874">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109919">tw</span><span class="op" id="4109921">,</span>&nbsp;<span class="ident" id="4109923">err</span>&nbsp;<span class="op" id="4109927">:=</span>&nbsp;<span class="ident" id="4109930">newTransferWriter</span><span class="op" id="4109947">(</span><span class="ident" id="4109948">req</span><span class="op" id="4109951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109954">if</span>&nbsp;<span class="ident" id="4109957">err</span>&nbsp;<span class="op" id="4109961">!=</span>&nbsp;<span class="builtintype" id="4109964">nil</span>&nbsp;<span class="op" id="4109968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109972">return</span>&nbsp;<span class="ident" id="4109979">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109984">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109987">err</span>&nbsp;<span class="op" id="4109991">=</span>&nbsp;<span class="ident" id="4109993">tw</span><span class="op" id="4109995">.</span><span class="ident" id="4109996">WriteHeader</span><span class="op" id="4110007">(</span><span class="ident" id="4110008">w</span><span class="op" id="4110009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110012">if</span>&nbsp;<span class="ident" id="4110015">err</span>&nbsp;<span class="op" id="4110019">!=</span>&nbsp;<span class="builtintype" id="4110022">nil</span>&nbsp;<span class="op" id="4110026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110030">return</span>&nbsp;<span class="ident" id="4110037">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110046">err</span>&nbsp;<span class="op" id="4110050">=</span>&nbsp;<span class="ident" id="4110052">req</span><span class="op" id="4110055">.</span><span class="ident" id="4110056">Header</span><span class="op" id="4110062">.</span><span class="ident" id="4110063">WriteSubset</span><span class="op" id="4110074">(</span><span class="ident" id="4110075">w</span><span class="op" id="4110076">,</span>&nbsp;<span class="ident" id="4110078">reqWriteExcludeHeader</span><span class="op" id="4110099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110102">if</span>&nbsp;<span class="ident" id="4110105">err</span>&nbsp;<span class="op" id="4110109">!=</span>&nbsp;<span class="builtintype" id="4110112">nil</span>&nbsp;<span class="op" id="4110116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110120">return</span>&nbsp;<span class="ident" id="4110127">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110136">if</span>&nbsp;<span class="ident" id="4110139">extraHeaders</span>&nbsp;<span class="op" id="4110152">!=</span>&nbsp;<span class="builtintype" id="4110155">nil</span>&nbsp;<span class="op" id="4110159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110163">err</span>&nbsp;<span class="op" id="4110167">=</span>&nbsp;<span class="ident" id="4110169">extraHeaders</span><span class="op" id="4110181">.</span><span class="ident" id="4110182">Write</span><span class="op" id="4110187">(</span><span class="ident" id="4110188">w</span><span class="op" id="4110189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110193">if</span>&nbsp;<span class="ident" id="4110196">err</span>&nbsp;<span class="op" id="4110200">!=</span>&nbsp;<span class="builtintype" id="4110203">nil</span>&nbsp;<span class="op" id="4110207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110212">return</span>&nbsp;<span class="ident" id="4110219">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110225">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110232">_</span><span class="op" id="4110233">,</span>&nbsp;<span class="ident" id="4110235">err</span>&nbsp;<span class="op" id="4110239">=</span>&nbsp;<span class="ident" id="4110241">io</span><span class="op" id="4110243">.</span><span class="ident" id="4110244">WriteString</span><span class="op" id="4110255">(</span><span class="ident" id="4110256">w</span><span class="op" id="4110257">,</span>&nbsp;<span class="string" id="4110259">&#34;\r\n&#34;</span><span class="op" id="4110265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110268">if</span>&nbsp;<span class="ident" id="4110271">err</span>&nbsp;<span class="op" id="4110275">!=</span>&nbsp;<span class="builtintype" id="4110278">nil</span>&nbsp;<span class="op" id="4110282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110286">return</span>&nbsp;<span class="ident" id="4110293">err</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4110302">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110329">err</span>&nbsp;<span class="op" id="4110333">=</span>&nbsp;<span class="ident" id="4110335">tw</span><span class="op" id="4110337">.</span><span class="ident" id="4110338">WriteBody</span><span class="op" id="4110347">(</span><span class="ident" id="4110348">w</span><span class="op" id="4110349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110352">if</span>&nbsp;<span class="ident" id="4110355">err</span>&nbsp;<span class="op" id="4110359">!=</span>&nbsp;<span class="builtintype" id="4110362">nil</span>&nbsp;<span class="op" id="4110366">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110370">return</span>&nbsp;<span class="ident" id="4110377">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110386">if</span>&nbsp;<span class="ident" id="4110389">bw</span>&nbsp;<span class="op" id="4110392">!=</span>&nbsp;<span class="builtintype" id="4110395">nil</span>&nbsp;<span class="op" id="4110399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110403">return</span>&nbsp;<span class="ident" id="4110410">bw</span><span class="op" id="4110412">.</span><span class="ident" id="4110413">Flush</span><span class="op" id="4110418">(</span><span class="op" id="4110419">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110425">return</span>&nbsp;<span class="builtintype" id="4110432">nil</span><br>
<span class="lineno"></span><span class="op" id="4110436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4110439">//&nbsp;ParseHTTPVersion&nbsp;parses&nbsp;a&nbsp;HTTP&nbsp;version&nbsp;string.</span><br>
<span class="lineno">460</span><span class="comment" id="4110489">//&nbsp;&#34;HTTP/1.0&#34;&nbsp;returns&nbsp;(1,&nbsp;0,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="4110525">func</span>&nbsp;<span class="ident" id="4110530">ParseHTTPVersion</span><span class="op" id="4110546">(</span><span class="ident" id="4110547">vers</span>&nbsp;<span class="builtintype" id="4110552">string</span><span class="op" id="4110558">)</span>&nbsp;<span class="op" id="4110560">(</span><span class="ident" id="4110561">major</span><span class="op" id="4110566">,</span>&nbsp;<span class="ident" id="4110568">minor</span>&nbsp;<span class="builtintype" id="4110574">int</span><span class="op" id="4110577">,</span>&nbsp;<span class="ident" id="4110579">ok</span>&nbsp;<span class="builtintype" id="4110582">bool</span><span class="op" id="4110586">)</span>&nbsp;<span class="op" id="4110588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110591">const</span>&nbsp;<span class="ident" id="4110597">Big</span>&nbsp;<span class="op" id="4110601">=</span>&nbsp;<span class="num" id="4110603">1000000</span>&nbsp;<span class="comment" id="4110611">//&nbsp;arbitrary&nbsp;upper&nbsp;bound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110637">switch</span>&nbsp;<span class="ident" id="4110644">vers</span>&nbsp;<span class="op" id="4110649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110652">case</span>&nbsp;<span class="string" id="4110657">&#34;HTTP/1.1&#34;</span><span class="op" id="4110667">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110671">return</span>&nbsp;<span class="num" id="4110678">1</span><span class="op" id="4110679">,</span>&nbsp;<span class="num" id="4110681">1</span><span class="op" id="4110682">,</span>&nbsp;<span class="builtintype" id="4110684">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110690">case</span>&nbsp;<span class="string" id="4110695">&#34;HTTP/1.0&#34;</span><span class="op" id="4110705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110709">return</span>&nbsp;<span class="num" id="4110716">1</span><span class="op" id="4110717">,</span>&nbsp;<span class="num" id="4110719">0</span><span class="op" id="4110720">,</span>&nbsp;<span class="builtintype" id="4110722">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110731">if</span>&nbsp;<span class="op" id="4110734">!</span><span class="ident" id="4110735">strings</span><span class="op" id="4110742">.</span><span class="ident" id="4110743">HasPrefix</span><span class="op" id="4110752">(</span><span class="ident" id="4110753">vers</span><span class="op" id="4110757">,</span>&nbsp;<span class="string" id="4110759">&#34;HTTP/&#34;</span><span class="op" id="4110766">)</span>&nbsp;<span class="op" id="4110768">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110772">return</span>&nbsp;<span class="num" id="4110779">0</span><span class="op" id="4110780">,</span>&nbsp;<span class="num" id="4110782">0</span><span class="op" id="4110783">,</span>&nbsp;<span class="builtintype" id="4110785">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110795">dot</span>&nbsp;<span class="op" id="4110799">:=</span>&nbsp;<span class="ident" id="4110802">strings</span><span class="op" id="4110809">.</span><span class="ident" id="4110810">Index</span><span class="op" id="4110815">(</span><span class="ident" id="4110816">vers</span><span class="op" id="4110820">,</span>&nbsp;<span class="string" id="4110822">&#34;.&#34;</span><span class="op" id="4110825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110828">if</span>&nbsp;<span class="ident" id="4110831">dot</span>&nbsp;<span class="op" id="4110835">&lt;</span>&nbsp;<span class="num" id="4110837">0</span>&nbsp;<span class="op" id="4110839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110843">return</span>&nbsp;<span class="num" id="4110850">0</span><span class="op" id="4110851">,</span>&nbsp;<span class="num" id="4110853">0</span><span class="op" id="4110854">,</span>&nbsp;<span class="builtintype" id="4110856">false</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110866">major</span><span class="op" id="4110871">,</span>&nbsp;<span class="ident" id="4110873">err</span>&nbsp;<span class="op" id="4110877">:=</span>&nbsp;<span class="ident" id="4110880">strconv</span><span class="op" id="4110887">.</span><span class="ident" id="4110888">Atoi</span><span class="op" id="4110892">(</span><span class="ident" id="4110893">vers</span><span class="op" id="4110897">[</span><span class="num" id="4110898">5</span><span class="op" id="4110899">:</span><span class="ident" id="4110900">dot</span><span class="op" id="4110903">]</span><span class="op" id="4110904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110907">if</span>&nbsp;<span class="ident" id="4110910">err</span>&nbsp;<span class="op" id="4110914">!=</span>&nbsp;<span class="builtintype" id="4110917">nil</span>&nbsp;<span class="op" id="4110921">||</span>&nbsp;<span class="ident" id="4110924">major</span>&nbsp;<span class="op" id="4110930">&lt;</span>&nbsp;<span class="num" id="4110932">0</span>&nbsp;<span class="op" id="4110934">||</span>&nbsp;<span class="ident" id="4110937">major</span>&nbsp;<span class="op" id="4110943">&gt;</span>&nbsp;<span class="ident" id="4110945">Big</span>&nbsp;<span class="op" id="4110949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110953">return</span>&nbsp;<span class="num" id="4110960">0</span><span class="op" id="4110961">,</span>&nbsp;<span class="num" id="4110963">0</span><span class="op" id="4110964">,</span>&nbsp;<span class="builtintype" id="4110966">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110973">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110976">minor</span><span class="op" id="4110981">,</span>&nbsp;<span class="ident" id="4110983">err</span>&nbsp;<span class="op" id="4110987">=</span>&nbsp;<span class="ident" id="4110989">strconv</span><span class="op" id="4110996">.</span><span class="ident" id="4110997">Atoi</span><span class="op" id="4111001">(</span><span class="ident" id="4111002">vers</span><span class="op" id="4111006">[</span><span class="ident" id="4111007">dot</span><span class="op" id="4111010">+</span><span class="num" id="4111011">1</span><span class="op" id="4111012">:</span><span class="op" id="4111013">]</span><span class="op" id="4111014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111017">if</span>&nbsp;<span class="ident" id="4111020">err</span>&nbsp;<span class="op" id="4111024">!=</span>&nbsp;<span class="builtintype" id="4111027">nil</span>&nbsp;<span class="op" id="4111031">||</span>&nbsp;<span class="ident" id="4111034">minor</span>&nbsp;<span class="op" id="4111040">&lt;</span>&nbsp;<span class="num" id="4111042">0</span>&nbsp;<span class="op" id="4111044">||</span>&nbsp;<span class="ident" id="4111047">minor</span>&nbsp;<span class="op" id="4111053">&gt;</span>&nbsp;<span class="ident" id="4111055">Big</span>&nbsp;<span class="op" id="4111059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111063">return</span>&nbsp;<span class="num" id="4111070">0</span><span class="op" id="4111071">,</span>&nbsp;<span class="num" id="4111073">0</span><span class="op" id="4111074">,</span>&nbsp;<span class="builtintype" id="4111076">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111086">return</span>&nbsp;<span class="ident" id="4111093">major</span><span class="op" id="4111098">,</span>&nbsp;<span class="ident" id="4111100">minor</span><span class="op" id="4111105">,</span>&nbsp;<span class="builtintype" id="4111107">true</span><br>
<span class="lineno">485</span><span class="op" id="4111112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4111115">//&nbsp;NewRequest&nbsp;returns&nbsp;a&nbsp;new&nbsp;Request&nbsp;given&nbsp;a&nbsp;method,&nbsp;URL,&nbsp;and&nbsp;optional&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="4111191">//</span><br>
<span class="lineno"></span><span class="comment" id="4111194">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;the&nbsp;returned</span><br>
<span class="lineno">490</span><span class="comment" id="4111253">//&nbsp;Request.Body&nbsp;is&nbsp;set&nbsp;to&nbsp;body&nbsp;and&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;Client</span><br>
<span class="lineno"></span><span class="comment" id="4111317">//&nbsp;methods&nbsp;Do,&nbsp;Post,&nbsp;and&nbsp;PostForm,&nbsp;and&nbsp;Transport.RoundTrip.</span><br>
<span class="lineno"></span><span class="keyword" id="4111377">func</span>&nbsp;<span class="ident" id="4111382">NewRequest</span><span class="op" id="4111392">(</span><span class="ident" id="4111393">method</span><span class="op" id="4111399">,</span>&nbsp;<span class="ident" id="4111401">urlStr</span>&nbsp;<span class="builtintype" id="4111408">string</span><span class="op" id="4111414">,</span>&nbsp;<span class="ident" id="4111416">body</span>&nbsp;<span class="ident" id="4111421">io</span><span class="op" id="4111423">.</span><span class="ident" id="4111424">Reader</span><span class="op" id="4111430">)</span>&nbsp;<span class="op" id="4111432">(</span><span class="op" id="4111433">*</span><span class="ident" id="4111434">Request</span><span class="op" id="4111441">,</span>&nbsp;<span class="builtintype" id="4111443">error</span><span class="op" id="4111448">)</span>&nbsp;<span class="op" id="4111450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111453">u</span><span class="op" id="4111454">,</span>&nbsp;<span class="ident" id="4111456">err</span>&nbsp;<span class="op" id="4111460">:=</span>&nbsp;<span class="ident" id="4111463">url</span><span class="op" id="4111466">.</span><span class="ident" id="4111467">Parse</span><span class="op" id="4111472">(</span><span class="ident" id="4111473">urlStr</span><span class="op" id="4111479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111482">if</span>&nbsp;<span class="ident" id="4111485">err</span>&nbsp;<span class="op" id="4111489">!=</span>&nbsp;<span class="builtintype" id="4111492">nil</span>&nbsp;<span class="op" id="4111496">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111500">return</span>&nbsp;<span class="builtintype" id="4111507">nil</span><span class="op" id="4111510">,</span>&nbsp;<span class="ident" id="4111512">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111520">rc</span><span class="op" id="4111522">,</span>&nbsp;<span class="ident" id="4111524">ok</span>&nbsp;<span class="op" id="4111527">:=</span>&nbsp;<span class="ident" id="4111530">body</span><span class="op" id="4111534">.</span><span class="op" id="4111535">(</span><span class="ident" id="4111536">io</span><span class="op" id="4111538">.</span><span class="ident" id="4111539">ReadCloser</span><span class="op" id="4111549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111552">if</span>&nbsp;<span class="op" id="4111555">!</span><span class="ident" id="4111556">ok</span>&nbsp;<span class="op" id="4111559">&amp;&amp;</span>&nbsp;<span class="ident" id="4111562">body</span>&nbsp;<span class="op" id="4111567">!=</span>&nbsp;<span class="builtintype" id="4111570">nil</span>&nbsp;<span class="op" id="4111574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111578">rc</span>&nbsp;<span class="op" id="4111581">=</span>&nbsp;<span class="ident" id="4111583">ioutil</span><span class="op" id="4111589">.</span><span class="ident" id="4111590">NopCloser</span><span class="op" id="4111599">(</span><span class="ident" id="4111600">body</span><span class="op" id="4111604">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111610">req</span>&nbsp;<span class="op" id="4111614">:=</span>&nbsp;<span class="op" id="4111617">&amp;</span><span class="ident" id="4111618">Request</span><span class="op" id="4111625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111629">Method</span><span class="op" id="4111635">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111641">method</span><span class="op" id="4111647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111651">URL</span><span class="op" id="4111654">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111663">u</span><span class="op" id="4111664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111668">Proto</span><span class="op" id="4111673">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4111680">&#34;HTTP/1.1&#34;</span><span class="op" id="4111690">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111694">ProtoMajor</span><span class="op" id="4111704">:</span>&nbsp;<span class="num" id="4111706">1</span><span class="op" id="4111707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111711">ProtoMinor</span><span class="op" id="4111721">:</span>&nbsp;<span class="num" id="4111723">1</span><span class="op" id="4111724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111728">Header</span><span class="op" id="4111734">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4111740">make</span><span class="op" id="4111744">(</span><span class="ident" id="4111745">Header</span><span class="op" id="4111751">)</span><span class="op" id="4111752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111756">Body</span><span class="op" id="4111760">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111768">rc</span><span class="op" id="4111770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111774">Host</span><span class="op" id="4111778">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111786">u</span><span class="op" id="4111787">.</span><span class="ident" id="4111788">Host</span><span class="op" id="4111792">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111798">if</span>&nbsp;<span class="ident" id="4111801">body</span>&nbsp;<span class="op" id="4111806">!=</span>&nbsp;<span class="builtintype" id="4111809">nil</span>&nbsp;<span class="op" id="4111813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111817">switch</span>&nbsp;<span class="ident" id="4111824">v</span>&nbsp;<span class="op" id="4111826">:=</span>&nbsp;<span class="ident" id="4111829">body</span><span class="op" id="4111833">.</span><span class="op" id="4111834">(</span><span class="keyword" id="4111835">type</span><span class="op" id="4111839">)</span>&nbsp;<span class="op" id="4111841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111845">case</span>&nbsp;<span class="op" id="4111850">*</span><span class="ident" id="4111851">bytes</span><span class="op" id="4111856">.</span><span class="ident" id="4111857">Buffer</span><span class="op" id="4111863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111868">req</span><span class="op" id="4111871">.</span><span class="ident" id="4111872">ContentLength</span>&nbsp;<span class="op" id="4111886">=</span>&nbsp;<span class="ident" id="4111888">int64</span><span class="op" id="4111893">(</span><span class="ident" id="4111894">v</span><span class="op" id="4111895">.</span><span class="ident" id="4111896">Len</span><span class="op" id="4111899">(</span><span class="op" id="4111900">)</span><span class="op" id="4111901">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111905">case</span>&nbsp;<span class="op" id="4111910">*</span><span class="ident" id="4111911">bytes</span><span class="op" id="4111916">.</span><span class="ident" id="4111917">Reader</span><span class="op" id="4111923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111928">req</span><span class="op" id="4111931">.</span><span class="ident" id="4111932">ContentLength</span>&nbsp;<span class="op" id="4111946">=</span>&nbsp;<span class="ident" id="4111948">int64</span><span class="op" id="4111953">(</span><span class="ident" id="4111954">v</span><span class="op" id="4111955">.</span><span class="ident" id="4111956">Len</span><span class="op" id="4111959">(</span><span class="op" id="4111960">)</span><span class="op" id="4111961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111965">case</span>&nbsp;<span class="op" id="4111970">*</span><span class="ident" id="4111971">strings</span><span class="op" id="4111978">.</span><span class="ident" id="4111979">Reader</span><span class="op" id="4111985">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111990">req</span><span class="op" id="4111993">.</span><span class="ident" id="4111994">ContentLength</span>&nbsp;<span class="op" id="4112008">=</span>&nbsp;<span class="ident" id="4112010">int64</span><span class="op" id="4112015">(</span><span class="ident" id="4112016">v</span><span class="op" id="4112017">.</span><span class="ident" id="4112018">Len</span><span class="op" id="4112021">(</span><span class="op" id="4112022">)</span><span class="op" id="4112023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112027">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112034">return</span>&nbsp;<span class="ident" id="4112041">req</span><span class="op" id="4112044">,</span>&nbsp;<span class="builtintype" id="4112046">nil</span><br>
<span class="lineno"></span><span class="op" id="4112050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="4112053">//&nbsp;BasicAuth&nbsp;returns&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4112126">//&nbsp;Authorization&nbsp;header,&nbsp;if&nbsp;the&nbsp;request&nbsp;uses&nbsp;HTTP&nbsp;Basic&nbsp;Authentication.</span><br>
<span class="lineno"></span><span class="comment" id="4112198">//&nbsp;See&nbsp;RFC&nbsp;2617,&nbsp;Section&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4112226">func</span>&nbsp;<span class="op" id="4112231">(</span><span class="ident" id="4112232">r</span>&nbsp;<span class="op" id="4112234">*</span><span class="ident" id="4112235">Request</span><span class="op" id="4112242">)</span>&nbsp;<span class="ident" id="4112244">BasicAuth</span><span class="op" id="4112253">(</span><span class="op" id="4112254">)</span>&nbsp;<span class="op" id="4112256">(</span><span class="ident" id="4112257">username</span><span class="op" id="4112265">,</span>&nbsp;<span class="ident" id="4112267">password</span>&nbsp;<span class="builtintype" id="4112276">string</span><span class="op" id="4112282">,</span>&nbsp;<span class="ident" id="4112284">ok</span>&nbsp;<span class="builtintype" id="4112287">bool</span><span class="op" id="4112291">)</span>&nbsp;<span class="op" id="4112293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112296">auth</span>&nbsp;<span class="op" id="4112301">:=</span>&nbsp;<span class="ident" id="4112304">r</span><span class="op" id="4112305">.</span><span class="ident" id="4112306">Header</span><span class="op" id="4112312">.</span><span class="ident" id="4112313">Get</span><span class="op" id="4112316">(</span><span class="string" id="4112317">&#34;Authorization&#34;</span><span class="op" id="4112332">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112335">if</span>&nbsp;<span class="ident" id="4112338">auth</span>&nbsp;<span class="op" id="4112343">==</span>&nbsp;<span class="string" id="4112346">&#34;&#34;</span>&nbsp;<span class="op" id="4112349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112353">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112364">return</span>&nbsp;<span class="ident" id="4112371">parseBasicAuth</span><span class="op" id="4112385">(</span><span class="ident" id="4112386">auth</span><span class="op" id="4112390">)</span><br>
<span class="lineno"></span><span class="op" id="4112392">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="4112395">//&nbsp;parseBasicAuth&nbsp;parses&nbsp;an&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="4112457">//&nbsp;&#34;Basic&nbsp;QWxhZGRpbjpvcGVuIHNlc2FtZQ==&#34;&nbsp;returns&nbsp;(&#34;Aladdin&#34;,&nbsp;&#34;open&nbsp;sesame&#34;,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="4112539">func</span>&nbsp;<span class="ident" id="4112544">parseBasicAuth</span><span class="op" id="4112558">(</span><span class="ident" id="4112559">auth</span>&nbsp;<span class="builtintype" id="4112564">string</span><span class="op" id="4112570">)</span>&nbsp;<span class="op" id="4112572">(</span><span class="ident" id="4112573">username</span><span class="op" id="4112581">,</span>&nbsp;<span class="ident" id="4112583">password</span>&nbsp;<span class="builtintype" id="4112592">string</span><span class="op" id="4112598">,</span>&nbsp;<span class="ident" id="4112600">ok</span>&nbsp;<span class="builtintype" id="4112603">bool</span><span class="op" id="4112607">)</span>&nbsp;<span class="op" id="4112609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112612">if</span>&nbsp;<span class="op" id="4112615">!</span><span class="ident" id="4112616">strings</span><span class="op" id="4112623">.</span><span class="ident" id="4112624">HasPrefix</span><span class="op" id="4112633">(</span><span class="ident" id="4112634">auth</span><span class="op" id="4112638">,</span>&nbsp;<span class="string" id="4112640">&#34;Basic&nbsp;&#34;</span><span class="op" id="4112648">)</span>&nbsp;<span class="op" id="4112650">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112654">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112665">c</span><span class="op" id="4112666">,</span>&nbsp;<span class="ident" id="4112668">err</span>&nbsp;<span class="op" id="4112672">:=</span>&nbsp;<span class="ident" id="4112675">base64</span><span class="op" id="4112681">.</span><span class="ident" id="4112682">StdEncoding</span><span class="op" id="4112693">.</span><span class="ident" id="4112694">DecodeString</span><span class="op" id="4112706">(</span><span class="ident" id="4112707">strings</span><span class="op" id="4112714">.</span><span class="ident" id="4112715">TrimPrefix</span><span class="op" id="4112725">(</span><span class="ident" id="4112726">auth</span><span class="op" id="4112730">,</span>&nbsp;<span class="string" id="4112732">&#34;Basic&nbsp;&#34;</span><span class="op" id="4112740">)</span><span class="op" id="4112741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112744">if</span>&nbsp;<span class="ident" id="4112747">err</span>&nbsp;<span class="op" id="4112751">!=</span>&nbsp;<span class="builtintype" id="4112754">nil</span>&nbsp;<span class="op" id="4112758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112762">return</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112773">cs</span>&nbsp;<span class="op" id="4112776">:=</span>&nbsp;<span class="builtintype" id="4112779">string</span><span class="op" id="4112785">(</span><span class="ident" id="4112786">c</span><span class="op" id="4112787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112790">s</span>&nbsp;<span class="op" id="4112792">:=</span>&nbsp;<span class="ident" id="4112795">strings</span><span class="op" id="4112802">.</span><span class="ident" id="4112803">IndexByte</span><span class="op" id="4112812">(</span><span class="ident" id="4112813">cs</span><span class="op" id="4112815">,</span>&nbsp;<span class="string" id="4112817">&#39;:&#39;</span><span class="op" id="4112820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112823">if</span>&nbsp;<span class="ident" id="4112826">s</span>&nbsp;<span class="op" id="4112828">&lt;</span>&nbsp;<span class="num" id="4112830">0</span>&nbsp;<span class="op" id="4112832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112836">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112847">return</span>&nbsp;<span class="ident" id="4112854">cs</span><span class="op" id="4112856">[</span><span class="op" id="4112857">:</span><span class="ident" id="4112858">s</span><span class="op" id="4112859">]</span><span class="op" id="4112860">,</span>&nbsp;<span class="ident" id="4112862">cs</span><span class="op" id="4112864">[</span><span class="ident" id="4112865">s</span><span class="op" id="4112866">+</span><span class="num" id="4112867">1</span><span class="op" id="4112868">:</span><span class="op" id="4112869">]</span><span class="op" id="4112870">,</span>&nbsp;<span class="builtintype" id="4112872">true</span><br>
<span class="lineno"></span><span class="op" id="4112877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4112880">//&nbsp;SetBasicAuth&nbsp;sets&nbsp;the&nbsp;request&#39;s&nbsp;Authorization&nbsp;header&nbsp;to&nbsp;use&nbsp;HTTP</span><br>
<span class="lineno">555</span><span class="comment" id="4112948">//&nbsp;Basic&nbsp;Authentication&nbsp;with&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="4113013">//</span><br>
<span class="lineno"></span><span class="comment" id="4113016">//&nbsp;With&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="4113085">//&nbsp;are&nbsp;not&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="4113107">func</span>&nbsp;<span class="op" id="4113112">(</span><span class="ident" id="4113113">r</span>&nbsp;<span class="op" id="4113115">*</span><span class="ident" id="4113116">Request</span><span class="op" id="4113123">)</span>&nbsp;<span class="ident" id="4113125">SetBasicAuth</span><span class="op" id="4113137">(</span><span class="ident" id="4113138">username</span><span class="op" id="4113146">,</span>&nbsp;<span class="ident" id="4113148">password</span>&nbsp;<span class="builtintype" id="4113157">string</span><span class="op" id="4113163">)</span>&nbsp;<span class="op" id="4113165">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113168">r</span><span class="op" id="4113169">.</span><span class="ident" id="4113170">Header</span><span class="op" id="4113176">.</span><span class="ident" id="4113177">Set</span><span class="op" id="4113180">(</span><span class="string" id="4113181">&#34;Authorization&#34;</span><span class="op" id="4113196">,</span>&nbsp;<span class="string" id="4113198">&#34;Basic&nbsp;&#34;</span><span class="op" id="4113206">+</span><span class="ident" id="4113207">basicAuth</span><span class="op" id="4113216">(</span><span class="ident" id="4113217">username</span><span class="op" id="4113225">,</span>&nbsp;<span class="ident" id="4113227">password</span><span class="op" id="4113235">)</span><span class="op" id="4113236">)</span><br>
<span class="lineno"></span><span class="op" id="4113238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4113241">//&nbsp;parseRequestLine&nbsp;parses&nbsp;&#34;GET&nbsp;/foo&nbsp;HTTP/1.1&#34;&nbsp;into&nbsp;its&nbsp;three&nbsp;parts.</span><br>
<span class="lineno"></span><span class="keyword" id="4113310">func</span>&nbsp;<span class="ident" id="4113315">parseRequestLine</span><span class="op" id="4113331">(</span><span class="ident" id="4113332">line</span>&nbsp;<span class="builtintype" id="4113337">string</span><span class="op" id="4113343">)</span>&nbsp;<span class="op" id="4113345">(</span><span class="ident" id="4113346">method</span><span class="op" id="4113352">,</span>&nbsp;<span class="ident" id="4113354">requestURI</span><span class="op" id="4113364">,</span>&nbsp;<span class="ident" id="4113366">proto</span>&nbsp;<span class="builtintype" id="4113372">string</span><span class="op" id="4113378">,</span>&nbsp;<span class="ident" id="4113380">ok</span>&nbsp;<span class="builtintype" id="4113383">bool</span><span class="op" id="4113387">)</span>&nbsp;<span class="op" id="4113389">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113392">s1</span>&nbsp;<span class="op" id="4113395">:=</span>&nbsp;<span class="ident" id="4113398">strings</span><span class="op" id="4113405">.</span><span class="ident" id="4113406">Index</span><span class="op" id="4113411">(</span><span class="ident" id="4113412">line</span><span class="op" id="4113416">,</span>&nbsp;<span class="string" id="4113418">&#34;&nbsp;&#34;</span><span class="op" id="4113421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113424">s2</span>&nbsp;<span class="op" id="4113427">:=</span>&nbsp;<span class="ident" id="4113430">strings</span><span class="op" id="4113437">.</span><span class="ident" id="4113438">Index</span><span class="op" id="4113443">(</span><span class="ident" id="4113444">line</span><span class="op" id="4113448">[</span><span class="ident" id="4113449">s1</span><span class="op" id="4113451">+</span><span class="num" id="4113452">1</span><span class="op" id="4113453">:</span><span class="op" id="4113454">]</span><span class="op" id="4113455">,</span>&nbsp;<span class="string" id="4113457">&#34;&nbsp;&#34;</span><span class="op" id="4113460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113463">if</span>&nbsp;<span class="ident" id="4113466">s1</span>&nbsp;<span class="op" id="4113469">&lt;</span>&nbsp;<span class="num" id="4113471">0</span>&nbsp;<span class="op" id="4113473">||</span>&nbsp;<span class="ident" id="4113476">s2</span>&nbsp;<span class="op" id="4113479">&lt;</span>&nbsp;<span class="num" id="4113481">0</span>&nbsp;<span class="op" id="4113483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113487">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4113495">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113498">s2</span>&nbsp;<span class="op" id="4113501">+=</span>&nbsp;<span class="ident" id="4113504">s1</span>&nbsp;<span class="op" id="4113507">+</span>&nbsp;<span class="num" id="4113509">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113512">return</span>&nbsp;<span class="ident" id="4113519">line</span><span class="op" id="4113523">[</span><span class="op" id="4113524">:</span><span class="ident" id="4113525">s1</span><span class="op" id="4113527">]</span><span class="op" id="4113528">,</span>&nbsp;<span class="ident" id="4113530">line</span><span class="op" id="4113534">[</span><span class="ident" id="4113535">s1</span><span class="op" id="4113537">+</span><span class="num" id="4113538">1</span>&nbsp;<span class="op" id="4113540">:</span>&nbsp;<span class="ident" id="4113542">s2</span><span class="op" id="4113544">]</span><span class="op" id="4113545">,</span>&nbsp;<span class="ident" id="4113547">line</span><span class="op" id="4113551">[</span><span class="ident" id="4113552">s2</span><span class="op" id="4113554">+</span><span class="num" id="4113555">1</span><span class="op" id="4113556">:</span><span class="op" id="4113557">]</span><span class="op" id="4113558">,</span>&nbsp;<span class="builtintype" id="4113560">true</span><br>
<span class="lineno"></span><span class="op" id="4113565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4113568">var</span>&nbsp;<span class="ident" id="4113572">textprotoReaderPool</span>&nbsp;<span class="ident" id="4113592">sync</span><span class="op" id="4113596">.</span><span class="ident" id="4113597">Pool</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="keyword" id="4113603">func</span>&nbsp;<span class="ident" id="4113608">newTextprotoReader</span><span class="op" id="4113626">(</span><span class="ident" id="4113627">br</span>&nbsp;<span class="op" id="4113630">*</span><span class="ident" id="4113631">bufio</span><span class="op" id="4113636">.</span><span class="ident" id="4113637">Reader</span><span class="op" id="4113643">)</span>&nbsp;<span class="op" id="4113645">*</span><span class="ident" id="4113646">textproto</span><span class="op" id="4113655">.</span><span class="ident" id="4113656">Reader</span>&nbsp;<span class="op" id="4113663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113666">if</span>&nbsp;<span class="ident" id="4113669">v</span>&nbsp;<span class="op" id="4113671">:=</span>&nbsp;<span class="ident" id="4113674">textprotoReaderPool</span><span class="op" id="4113693">.</span><span class="ident" id="4113694">Get</span><span class="op" id="4113697">(</span><span class="op" id="4113698">)</span><span class="op" id="4113699">;</span>&nbsp;<span class="ident" id="4113701">v</span>&nbsp;<span class="op" id="4113703">!=</span>&nbsp;<span class="builtintype" id="4113706">nil</span>&nbsp;<span class="op" id="4113710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113714">tr</span>&nbsp;<span class="op" id="4113717">:=</span>&nbsp;<span class="ident" id="4113720">v</span><span class="op" id="4113721">.</span><span class="op" id="4113722">(</span><span class="op" id="4113723">*</span><span class="ident" id="4113724">textproto</span><span class="op" id="4113733">.</span><span class="ident" id="4113734">Reader</span><span class="op" id="4113740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113744">tr</span><span class="op" id="4113746">.</span><span class="ident" id="4113747">R</span>&nbsp;<span class="op" id="4113749">=</span>&nbsp;<span class="ident" id="4113751">br</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113756">return</span>&nbsp;<span class="ident" id="4113763">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4113767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113770">return</span>&nbsp;<span class="ident" id="4113777">textproto</span><span class="op" id="4113786">.</span><span class="ident" id="4113787">NewReader</span><span class="op" id="4113796">(</span><span class="ident" id="4113797">br</span><span class="op" id="4113799">)</span><br>
<span class="lineno"></span><span class="op" id="4113801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="4113804">func</span>&nbsp;<span class="ident" id="4113809">putTextprotoReader</span><span class="op" id="4113827">(</span><span class="ident" id="4113828">r</span>&nbsp;<span class="op" id="4113830">*</span><span class="ident" id="4113831">textproto</span><span class="op" id="4113840">.</span><span class="ident" id="4113841">Reader</span><span class="op" id="4113847">)</span>&nbsp;<span class="op" id="4113849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113852">r</span><span class="op" id="4113853">.</span><span class="ident" id="4113854">R</span>&nbsp;<span class="op" id="4113856">=</span>&nbsp;<span class="builtintype" id="4113858">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113863">textprotoReaderPool</span><span class="op" id="4113882">.</span><span class="ident" id="4113883">Put</span><span class="op" id="4113886">(</span><span class="ident" id="4113887">r</span><span class="op" id="4113888">)</span><br>
<span class="lineno"></span><span class="op" id="4113890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4113893">//&nbsp;ReadRequest&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;request&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4113943">func</span>&nbsp;<span class="ident" id="4113948">ReadRequest</span><span class="op" id="4113959">(</span><span class="ident" id="4113960">b</span>&nbsp;<span class="op" id="4113962">*</span><span class="ident" id="4113963">bufio</span><span class="op" id="4113968">.</span><span class="ident" id="4113969">Reader</span><span class="op" id="4113975">)</span>&nbsp;<span class="op" id="4113977">(</span><span class="ident" id="4113978">req</span>&nbsp;<span class="op" id="4113982">*</span><span class="ident" id="4113983">Request</span><span class="op" id="4113990">,</span>&nbsp;<span class="ident" id="4113992">err</span>&nbsp;<span class="builtintype" id="4113996">error</span><span class="op" id="4114001">)</span>&nbsp;<span class="op" id="4114003">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114007">tp</span>&nbsp;<span class="op" id="4114010">:=</span>&nbsp;<span class="ident" id="4114013">newTextprotoReader</span><span class="op" id="4114031">(</span><span class="ident" id="4114032">b</span><span class="op" id="4114033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114036">req</span>&nbsp;<span class="op" id="4114040">=</span>&nbsp;<span class="builtinfunc" id="4114042">new</span><span class="op" id="4114045">(</span><span class="ident" id="4114046">Request</span><span class="op" id="4114053">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114057">//&nbsp;First&nbsp;line:&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114098">var</span>&nbsp;<span class="ident" id="4114102">s</span>&nbsp;<span class="builtintype" id="4114104">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114112">if</span>&nbsp;<span class="ident" id="4114115">s</span><span class="op" id="4114116">,</span>&nbsp;<span class="ident" id="4114118">err</span>&nbsp;<span class="op" id="4114122">=</span>&nbsp;<span class="ident" id="4114124">tp</span><span class="op" id="4114126">.</span><span class="ident" id="4114127">ReadLine</span><span class="op" id="4114135">(</span><span class="op" id="4114136">)</span><span class="op" id="4114137">;</span>&nbsp;<span class="ident" id="4114139">err</span>&nbsp;<span class="op" id="4114143">!=</span>&nbsp;<span class="builtintype" id="4114146">nil</span>&nbsp;<span class="op" id="4114150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114154">return</span>&nbsp;<span class="builtintype" id="4114161">nil</span><span class="op" id="4114164">,</span>&nbsp;<span class="ident" id="4114166">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114174">defer</span>&nbsp;<span class="keyword" id="4114180">func</span><span class="op" id="4114184">(</span><span class="op" id="4114185">)</span>&nbsp;<span class="op" id="4114187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114191">putTextprotoReader</span><span class="op" id="4114209">(</span><span class="ident" id="4114210">tp</span><span class="op" id="4114212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114216">if</span>&nbsp;<span class="ident" id="4114219">err</span>&nbsp;<span class="op" id="4114223">==</span>&nbsp;<span class="ident" id="4114226">io</span><span class="op" id="4114228">.</span><span class="ident" id="4114229">EOF</span>&nbsp;<span class="op" id="4114233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114238">err</span>&nbsp;<span class="op" id="4114242">=</span>&nbsp;<span class="ident" id="4114244">io</span><span class="op" id="4114246">.</span><span class="ident" id="4114247">ErrUnexpectedEOF</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114269">}</span><span class="op" id="4114270">(</span><span class="op" id="4114271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114275">var</span>&nbsp;<span class="ident" id="4114279">ok</span>&nbsp;<span class="builtintype" id="4114282">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114288">req</span><span class="op" id="4114291">.</span><span class="ident" id="4114292">Method</span><span class="op" id="4114298">,</span>&nbsp;<span class="ident" id="4114300">req</span><span class="op" id="4114303">.</span><span class="ident" id="4114304">RequestURI</span><span class="op" id="4114314">,</span>&nbsp;<span class="ident" id="4114316">req</span><span class="op" id="4114319">.</span><span class="ident" id="4114320">Proto</span><span class="op" id="4114325">,</span>&nbsp;<span class="ident" id="4114327">ok</span>&nbsp;<span class="op" id="4114330">=</span>&nbsp;<span class="ident" id="4114332">parseRequestLine</span><span class="op" id="4114348">(</span><span class="ident" id="4114349">s</span><span class="op" id="4114350">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114353">if</span>&nbsp;<span class="op" id="4114356">!</span><span class="ident" id="4114357">ok</span>&nbsp;<span class="op" id="4114360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114364">return</span>&nbsp;<span class="builtintype" id="4114371">nil</span><span class="op" id="4114374">,</span>&nbsp;<span class="op" id="4114376">&amp;</span><span class="ident" id="4114377">badStringError</span><span class="op" id="4114391">{</span><span class="string" id="4114392">&#34;malformed&nbsp;HTTP&nbsp;request&#34;</span><span class="op" id="4114416">,</span>&nbsp;<span class="ident" id="4114418">s</span><span class="op" id="4114419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114425">rawurl</span>&nbsp;<span class="op" id="4114432">:=</span>&nbsp;<span class="ident" id="4114435">req</span><span class="op" id="4114438">.</span><span class="ident" id="4114439">RequestURI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114451">if</span>&nbsp;<span class="ident" id="4114454">req</span><span class="op" id="4114457">.</span><span class="ident" id="4114458">ProtoMajor</span><span class="op" id="4114468">,</span>&nbsp;<span class="ident" id="4114470">req</span><span class="op" id="4114473">.</span><span class="ident" id="4114474">ProtoMinor</span><span class="op" id="4114484">,</span>&nbsp;<span class="ident" id="4114486">ok</span>&nbsp;<span class="op" id="4114489">=</span>&nbsp;<span class="ident" id="4114491">ParseHTTPVersion</span><span class="op" id="4114507">(</span><span class="ident" id="4114508">req</span><span class="op" id="4114511">.</span><span class="ident" id="4114512">Proto</span><span class="op" id="4114517">)</span><span class="op" id="4114518">;</span>&nbsp;<span class="op" id="4114520">!</span><span class="ident" id="4114521">ok</span>&nbsp;<span class="op" id="4114524">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114528">return</span>&nbsp;<span class="builtintype" id="4114535">nil</span><span class="op" id="4114538">,</span>&nbsp;<span class="op" id="4114540">&amp;</span><span class="ident" id="4114541">badStringError</span><span class="op" id="4114555">{</span><span class="string" id="4114556">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="4114580">,</span>&nbsp;<span class="ident" id="4114582">req</span><span class="op" id="4114585">.</span><span class="ident" id="4114586">Proto</span><span class="op" id="4114591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114598">//&nbsp;CONNECT&nbsp;requests&nbsp;are&nbsp;used&nbsp;two&nbsp;different&nbsp;ways,&nbsp;and&nbsp;neither&nbsp;uses&nbsp;a&nbsp;full&nbsp;URL:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114677">//&nbsp;The&nbsp;standard&nbsp;use&nbsp;is&nbsp;to&nbsp;tunnel&nbsp;HTTPS&nbsp;through&nbsp;an&nbsp;HTTP&nbsp;proxy.</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114740">//&nbsp;It&nbsp;looks&nbsp;like&nbsp;&#34;CONNECT&nbsp;www.google.com:443&nbsp;HTTP/1.1&#34;,&nbsp;and&nbsp;the&nbsp;parameter&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114818">//&nbsp;just&nbsp;the&nbsp;authority&nbsp;section&nbsp;of&nbsp;a&nbsp;URL.&nbsp;This&nbsp;information&nbsp;should&nbsp;go&nbsp;in&nbsp;req.URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114903">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114907">//&nbsp;The&nbsp;net/rpc&nbsp;package&nbsp;also&nbsp;uses&nbsp;CONNECT,&nbsp;but&nbsp;there&nbsp;the&nbsp;parameter&nbsp;is&nbsp;a&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114984">//&nbsp;that&nbsp;starts&nbsp;with&nbsp;a&nbsp;slash.&nbsp;It&nbsp;can&nbsp;be&nbsp;parsed&nbsp;with&nbsp;the&nbsp;regular&nbsp;URL&nbsp;parser,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115060">//&nbsp;and&nbsp;the&nbsp;path&nbsp;will&nbsp;end&nbsp;up&nbsp;in&nbsp;req.URL.Path,&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;order&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115140">//&nbsp;RPC&nbsp;to&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115157">justAuthority</span>&nbsp;<span class="op" id="4115171">:=</span>&nbsp;<span class="ident" id="4115174">req</span><span class="op" id="4115177">.</span><span class="ident" id="4115178">Method</span>&nbsp;<span class="op" id="4115185">==</span>&nbsp;<span class="string" id="4115188">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="4115198">&amp;&amp;</span>&nbsp;<span class="op" id="4115201">!</span><span class="ident" id="4115202">strings</span><span class="op" id="4115209">.</span><span class="ident" id="4115210">HasPrefix</span><span class="op" id="4115219">(</span><span class="ident" id="4115220">rawurl</span><span class="op" id="4115226">,</span>&nbsp;<span class="string" id="4115228">&#34;/&#34;</span><span class="op" id="4115231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115234">if</span>&nbsp;<span class="ident" id="4115237">justAuthority</span>&nbsp;<span class="op" id="4115251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115255">rawurl</span>&nbsp;<span class="op" id="4115262">=</span>&nbsp;<span class="string" id="4115264">&#34;http://&#34;</span>&nbsp;<span class="op" id="4115274">+</span>&nbsp;<span class="ident" id="4115276">rawurl</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115288">if</span>&nbsp;<span class="ident" id="4115291">req</span><span class="op" id="4115294">.</span><span class="ident" id="4115295">URL</span><span class="op" id="4115298">,</span>&nbsp;<span class="ident" id="4115300">err</span>&nbsp;<span class="op" id="4115304">=</span>&nbsp;<span class="ident" id="4115306">url</span><span class="op" id="4115309">.</span><span class="ident" id="4115310">ParseRequestURI</span><span class="op" id="4115325">(</span><span class="ident" id="4115326">rawurl</span><span class="op" id="4115332">)</span><span class="op" id="4115333">;</span>&nbsp;<span class="ident" id="4115335">err</span>&nbsp;<span class="op" id="4115339">!=</span>&nbsp;<span class="builtintype" id="4115342">nil</span>&nbsp;<span class="op" id="4115346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115350">return</span>&nbsp;<span class="builtintype" id="4115357">nil</span><span class="op" id="4115360">,</span>&nbsp;<span class="ident" id="4115362">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115367">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115371">if</span>&nbsp;<span class="ident" id="4115374">justAuthority</span>&nbsp;<span class="op" id="4115388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115392">//&nbsp;Strip&nbsp;the&nbsp;bogus&nbsp;&#34;http://&#34;&nbsp;back&nbsp;off.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115433">req</span><span class="op" id="4115436">.</span><span class="ident" id="4115437">URL</span><span class="op" id="4115440">.</span><span class="ident" id="4115441">Scheme</span>&nbsp;<span class="op" id="4115448">=</span>&nbsp;<span class="string" id="4115450">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115454">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115458">//&nbsp;Subsequent&nbsp;lines:&nbsp;Key:&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115492">mimeHeader</span><span class="op" id="4115502">,</span>&nbsp;<span class="ident" id="4115504">err</span>&nbsp;<span class="op" id="4115508">:=</span>&nbsp;<span class="ident" id="4115511">tp</span><span class="op" id="4115513">.</span><span class="ident" id="4115514">ReadMIMEHeader</span><span class="op" id="4115528">(</span><span class="op" id="4115529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115532">if</span>&nbsp;<span class="ident" id="4115535">err</span>&nbsp;<span class="op" id="4115539">!=</span>&nbsp;<span class="builtintype" id="4115542">nil</span>&nbsp;<span class="op" id="4115546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115550">return</span>&nbsp;<span class="builtintype" id="4115557">nil</span><span class="op" id="4115560">,</span>&nbsp;<span class="ident" id="4115562">err</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115570">req</span><span class="op" id="4115573">.</span><span class="ident" id="4115574">Header</span>&nbsp;<span class="op" id="4115581">=</span>&nbsp;<span class="ident" id="4115583">Header</span><span class="op" id="4115589">(</span><span class="ident" id="4115590">mimeHeader</span><span class="op" id="4115600">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115604">//&nbsp;RFC2616:&nbsp;Must&nbsp;treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115628">//&nbsp;&nbsp;&nbsp;&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115657">//&nbsp;&nbsp;&nbsp;&nbsp;Host:&nbsp;www.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115682">//&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115690">//&nbsp;&nbsp;&nbsp;&nbsp;GET&nbsp;http://www.google.com/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115740">//&nbsp;&nbsp;&nbsp;&nbsp;Host:&nbsp;doesntmatter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115763">//&nbsp;the&nbsp;same.&nbsp;&nbsp;In&nbsp;the&nbsp;second&nbsp;case,&nbsp;any&nbsp;Host&nbsp;line&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115824">req</span><span class="op" id="4115827">.</span><span class="ident" id="4115828">Host</span>&nbsp;<span class="op" id="4115833">=</span>&nbsp;<span class="ident" id="4115835">req</span><span class="op" id="4115838">.</span><span class="ident" id="4115839">URL</span><span class="op" id="4115842">.</span><span class="ident" id="4115843">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115849">if</span>&nbsp;<span class="ident" id="4115852">req</span><span class="op" id="4115855">.</span><span class="ident" id="4115856">Host</span>&nbsp;<span class="op" id="4115861">==</span>&nbsp;<span class="string" id="4115864">&#34;&#34;</span>&nbsp;<span class="op" id="4115867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115871">req</span><span class="op" id="4115874">.</span><span class="ident" id="4115875">Host</span>&nbsp;<span class="op" id="4115880">=</span>&nbsp;<span class="ident" id="4115882">req</span><span class="op" id="4115885">.</span><span class="ident" id="4115886">Header</span><span class="op" id="4115892">.</span><span class="ident" id="4115893">get</span><span class="op" id="4115896">(</span><span class="string" id="4115897">&#34;Host&#34;</span><span class="op" id="4115903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4115909">delete</span><span class="op" id="4115915">(</span><span class="ident" id="4115916">req</span><span class="op" id="4115919">.</span><span class="ident" id="4115920">Header</span><span class="op" id="4115926">,</span>&nbsp;<span class="string" id="4115928">&#34;Host&#34;</span><span class="op" id="4115934">)</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115938">fixPragmaCacheControl</span><span class="op" id="4115959">(</span><span class="ident" id="4115960">req</span><span class="op" id="4115963">.</span><span class="ident" id="4115964">Header</span><span class="op" id="4115970">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115974">err</span>&nbsp;<span class="op" id="4115978">=</span>&nbsp;<span class="ident" id="4115980">readTransfer</span><span class="op" id="4115992">(</span><span class="ident" id="4115993">req</span><span class="op" id="4115996">,</span>&nbsp;<span class="ident" id="4115998">b</span><span class="op" id="4115999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116002">if</span>&nbsp;<span class="ident" id="4116005">err</span>&nbsp;<span class="op" id="4116009">!=</span>&nbsp;<span class="builtintype" id="4116012">nil</span>&nbsp;<span class="op" id="4116016">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116020">return</span>&nbsp;<span class="builtintype" id="4116027">nil</span><span class="op" id="4116030">,</span>&nbsp;<span class="ident" id="4116032">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4116037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116041">req</span><span class="op" id="4116044">.</span><span class="ident" id="4116045">Close</span>&nbsp;<span class="op" id="4116051">=</span>&nbsp;<span class="ident" id="4116053">shouldClose</span><span class="op" id="4116064">(</span><span class="ident" id="4116065">req</span><span class="op" id="4116068">.</span><span class="ident" id="4116069">ProtoMajor</span><span class="op" id="4116079">,</span>&nbsp;<span class="ident" id="4116081">req</span><span class="op" id="4116084">.</span><span class="ident" id="4116085">ProtoMinor</span><span class="op" id="4116095">,</span>&nbsp;<span class="ident" id="4116097">req</span><span class="op" id="4116100">.</span><span class="ident" id="4116101">Header</span><span class="op" id="4116107">,</span>&nbsp;<span class="builtintype" id="4116109">false</span><span class="op" id="4116114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116117">return</span>&nbsp;<span class="ident" id="4116124">req</span><span class="op" id="4116127">,</span>&nbsp;<span class="builtintype" id="4116129">nil</span><br>
<span class="lineno">670</span><span class="op" id="4116133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4116136">//&nbsp;MaxBytesReader&nbsp;is&nbsp;similar&nbsp;to&nbsp;io.LimitReader&nbsp;but&nbsp;is&nbsp;intended&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4116203">//&nbsp;limiting&nbsp;the&nbsp;size&nbsp;of&nbsp;incoming&nbsp;request&nbsp;bodies.&nbsp;In&nbsp;contrast&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4116267">//&nbsp;io.LimitReader,&nbsp;MaxBytesReader&#39;s&nbsp;result&nbsp;is&nbsp;a&nbsp;ReadCloser,&nbsp;returns&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="4116337">//&nbsp;non-EOF&nbsp;error&nbsp;for&nbsp;a&nbsp;Read&nbsp;beyond&nbsp;the&nbsp;limit,&nbsp;and&nbsp;Closes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4116398">//&nbsp;underlying&nbsp;reader&nbsp;when&nbsp;its&nbsp;Close&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="comment" id="4116452">//</span><br>
<span class="lineno"></span><span class="comment" id="4116455">//&nbsp;MaxBytesReader&nbsp;prevents&nbsp;clients&nbsp;from&nbsp;accidentally&nbsp;or&nbsp;maliciously</span><br>
<span class="lineno"></span><span class="comment" id="4116523">//&nbsp;sending&nbsp;a&nbsp;large&nbsp;request&nbsp;and&nbsp;wasting&nbsp;server&nbsp;resources.</span><br>
<span class="lineno">680</span><span class="keyword" id="4116580">func</span>&nbsp;<span class="ident" id="4116585">MaxBytesReader</span><span class="op" id="4116599">(</span><span class="ident" id="4116600">w</span>&nbsp;<span class="ident" id="4116602">ResponseWriter</span><span class="op" id="4116616">,</span>&nbsp;<span class="ident" id="4116618">r</span>&nbsp;<span class="ident" id="4116620">io</span><span class="op" id="4116622">.</span><span class="ident" id="4116623">ReadCloser</span><span class="op" id="4116633">,</span>&nbsp;<span class="ident" id="4116635">n</span>&nbsp;<span class="ident" id="4116637">int64</span><span class="op" id="4116642">)</span>&nbsp;<span class="ident" id="4116644">io</span><span class="op" id="4116646">.</span><span class="ident" id="4116647">ReadCloser</span>&nbsp;<span class="op" id="4116658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116661">return</span>&nbsp;<span class="op" id="4116668">&amp;</span><span class="ident" id="4116669">maxBytesReader</span><span class="op" id="4116683">{</span><span class="ident" id="4116684">w</span><span class="op" id="4116685">:</span>&nbsp;<span class="ident" id="4116687">w</span><span class="op" id="4116688">,</span>&nbsp;<span class="ident" id="4116690">r</span><span class="op" id="4116691">:</span>&nbsp;<span class="ident" id="4116693">r</span><span class="op" id="4116694">,</span>&nbsp;<span class="ident" id="4116696">n</span><span class="op" id="4116697">:</span>&nbsp;<span class="ident" id="4116699">n</span><span class="op" id="4116700">}</span><br>
<span class="lineno"></span><span class="op" id="4116702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4116705">type</span>&nbsp;<span class="ident" id="4116710">maxBytesReader</span>&nbsp;<span class="keyword" id="4116725">struct</span>&nbsp;<span class="op" id="4116732">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116735">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116743">ResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116759">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116767">io</span><span class="op" id="4116769">.</span><span class="ident" id="4116770">ReadCloser</span>&nbsp;<span class="comment" id="4116781">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116803">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116811">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4116825">//&nbsp;max&nbsp;bytes&nbsp;remaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116849">stopped</span>&nbsp;<span class="builtintype" id="4116857">bool</span><br>
<span class="lineno"></span><span class="op" id="4116862">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4116865">func</span>&nbsp;<span class="op" id="4116870">(</span><span class="ident" id="4116871">l</span>&nbsp;<span class="op" id="4116873">*</span><span class="ident" id="4116874">maxBytesReader</span><span class="op" id="4116888">)</span>&nbsp;<span class="ident" id="4116890">Read</span><span class="op" id="4116894">(</span><span class="ident" id="4116895">p</span>&nbsp;<span class="op" id="4116897">[</span><span class="op" id="4116898">]</span><span class="builtintype" id="4116899">byte</span><span class="op" id="4116903">)</span>&nbsp;<span class="op" id="4116905">(</span><span class="ident" id="4116906">n</span>&nbsp;<span class="builtintype" id="4116908">int</span><span class="op" id="4116911">,</span>&nbsp;<span class="ident" id="4116913">err</span>&nbsp;<span class="builtintype" id="4116917">error</span><span class="op" id="4116922">)</span>&nbsp;<span class="op" id="4116924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116927">if</span>&nbsp;<span class="ident" id="4116930">l</span><span class="op" id="4116931">.</span><span class="ident" id="4116932">n</span>&nbsp;<span class="op" id="4116934">&lt;=</span>&nbsp;<span class="num" id="4116937">0</span>&nbsp;<span class="op" id="4116939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116943">if</span>&nbsp;<span class="op" id="4116946">!</span><span class="ident" id="4116947">l</span><span class="op" id="4116948">.</span><span class="ident" id="4116949">stopped</span>&nbsp;<span class="op" id="4116957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116962">l</span><span class="op" id="4116963">.</span><span class="ident" id="4116964">stopped</span>&nbsp;<span class="op" id="4116972">=</span>&nbsp;<span class="builtintype" id="4116974">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116982">if</span>&nbsp;<span class="ident" id="4116985">res</span><span class="op" id="4116988">,</span>&nbsp;<span class="ident" id="4116990">ok</span>&nbsp;<span class="op" id="4116993">:=</span>&nbsp;<span class="ident" id="4116996">l</span><span class="op" id="4116997">.</span><span class="ident" id="4116998">w</span><span class="op" id="4116999">.</span><span class="op" id="4117000">(</span><span class="op" id="4117001">*</span><span class="ident" id="4117002">response</span><span class="op" id="4117010">)</span><span class="op" id="4117011">;</span>&nbsp;<span class="ident" id="4117013">ok</span>&nbsp;<span class="op" id="4117016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117022">res</span><span class="op" id="4117025">.</span><span class="ident" id="4117026">requestTooLarge</span><span class="op" id="4117041">(</span><span class="op" id="4117042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117055">return</span>&nbsp;<span class="num" id="4117062">0</span><span class="op" id="4117063">,</span>&nbsp;<span class="ident" id="4117065">errors</span><span class="op" id="4117071">.</span><span class="ident" id="4117072">New</span><span class="op" id="4117075">(</span><span class="string" id="4117076">&#34;http:&nbsp;request&nbsp;body&nbsp;too&nbsp;large&#34;</span><span class="op" id="4117106">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117112">if</span>&nbsp;<span class="ident" id="4117115">int64</span><span class="op" id="4117120">(</span><span class="builtinfunc" id="4117121">len</span><span class="op" id="4117124">(</span><span class="ident" id="4117125">p</span><span class="op" id="4117126">)</span><span class="op" id="4117127">)</span>&nbsp;<span class="op" id="4117129">&gt;</span>&nbsp;<span class="ident" id="4117131">l</span><span class="op" id="4117132">.</span><span class="ident" id="4117133">n</span>&nbsp;<span class="op" id="4117135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117139">p</span>&nbsp;<span class="op" id="4117141">=</span>&nbsp;<span class="ident" id="4117143">p</span><span class="op" id="4117144">[</span><span class="op" id="4117145">:</span><span class="ident" id="4117146">l</span><span class="op" id="4117147">.</span><span class="ident" id="4117148">n</span><span class="op" id="4117149">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117155">n</span><span class="op" id="4117156">,</span>&nbsp;<span class="ident" id="4117158">err</span>&nbsp;<span class="op" id="4117162">=</span>&nbsp;<span class="ident" id="4117164">l</span><span class="op" id="4117165">.</span><span class="ident" id="4117166">r</span><span class="op" id="4117167">.</span><span class="ident" id="4117168">Read</span><span class="op" id="4117172">(</span><span class="ident" id="4117173">p</span><span class="op" id="4117174">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117177">l</span><span class="op" id="4117178">.</span><span class="ident" id="4117179">n</span>&nbsp;<span class="op" id="4117181">-=</span>&nbsp;<span class="ident" id="4117184">int64</span><span class="op" id="4117189">(</span><span class="ident" id="4117190">n</span><span class="op" id="4117191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117194">return</span><br>
<span class="lineno"></span><span class="op" id="4117201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4117204">func</span>&nbsp;<span class="op" id="4117209">(</span><span class="ident" id="4117210">l</span>&nbsp;<span class="op" id="4117212">*</span><span class="ident" id="4117213">maxBytesReader</span><span class="op" id="4117227">)</span>&nbsp;<span class="ident" id="4117229">Close</span><span class="op" id="4117234">(</span><span class="op" id="4117235">)</span>&nbsp;<span class="builtintype" id="4117237">error</span>&nbsp;<span class="op" id="4117243">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117246">return</span>&nbsp;<span class="ident" id="4117253">l</span><span class="op" id="4117254">.</span><span class="ident" id="4117255">r</span><span class="op" id="4117256">.</span><span class="ident" id="4117257">Close</span><span class="op" id="4117262">(</span><span class="op" id="4117263">)</span><br>
<span class="lineno"></span><span class="op" id="4117265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4117268">func</span>&nbsp;<span class="ident" id="4117273">copyValues</span><span class="op" id="4117283">(</span><span class="ident" id="4117284">dst</span><span class="op" id="4117287">,</span>&nbsp;<span class="ident" id="4117289">src</span>&nbsp;<span class="ident" id="4117293">url</span><span class="op" id="4117296">.</span><span class="ident" id="4117297">Values</span><span class="op" id="4117303">)</span>&nbsp;<span class="op" id="4117305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117308">for</span>&nbsp;<span class="ident" id="4117312">k</span><span class="op" id="4117313">,</span>&nbsp;<span class="ident" id="4117315">vs</span>&nbsp;<span class="op" id="4117318">:=</span>&nbsp;<span class="keyword" id="4117321">range</span>&nbsp;<span class="ident" id="4117327">src</span>&nbsp;<span class="op" id="4117331">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117335">for</span>&nbsp;<span class="ident" id="4117339">_</span><span class="op" id="4117340">,</span>&nbsp;<span class="ident" id="4117342">value</span>&nbsp;<span class="op" id="4117348">:=</span>&nbsp;<span class="keyword" id="4117351">range</span>&nbsp;<span class="ident" id="4117357">vs</span>&nbsp;<span class="op" id="4117360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117365">dst</span><span class="op" id="4117368">.</span><span class="ident" id="4117369">Add</span><span class="op" id="4117372">(</span><span class="ident" id="4117373">k</span><span class="op" id="4117374">,</span>&nbsp;<span class="ident" id="4117376">value</span><span class="op" id="4117381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117388">}</span><br>
<span class="lineno"></span><span class="op" id="4117390">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="keyword" id="4117393">func</span>&nbsp;<span class="ident" id="4117398">parsePostForm</span><span class="op" id="4117411">(</span><span class="ident" id="4117412">r</span>&nbsp;<span class="op" id="4117414">*</span><span class="ident" id="4117415">Request</span><span class="op" id="4117422">)</span>&nbsp;<span class="op" id="4117424">(</span><span class="ident" id="4117425">vs</span>&nbsp;<span class="ident" id="4117428">url</span><span class="op" id="4117431">.</span><span class="ident" id="4117432">Values</span><span class="op" id="4117438">,</span>&nbsp;<span class="ident" id="4117440">err</span>&nbsp;<span class="builtintype" id="4117444">error</span><span class="op" id="4117449">)</span>&nbsp;<span class="op" id="4117451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117454">if</span>&nbsp;<span class="ident" id="4117457">r</span><span class="op" id="4117458">.</span><span class="ident" id="4117459">Body</span>&nbsp;<span class="op" id="4117464">==</span>&nbsp;<span class="builtintype" id="4117467">nil</span>&nbsp;<span class="op" id="4117471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117475">err</span>&nbsp;<span class="op" id="4117479">=</span>&nbsp;<span class="ident" id="4117481">errors</span><span class="op" id="4117487">.</span><span class="ident" id="4117488">New</span><span class="op" id="4117491">(</span><span class="string" id="4117492">&#34;missing&nbsp;form&nbsp;body&#34;</span><span class="op" id="4117511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117515">return</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117526">ct</span>&nbsp;<span class="op" id="4117529">:=</span>&nbsp;<span class="ident" id="4117532">r</span><span class="op" id="4117533">.</span><span class="ident" id="4117534">Header</span><span class="op" id="4117540">.</span><span class="ident" id="4117541">Get</span><span class="op" id="4117544">(</span><span class="string" id="4117545">&#34;Content-Type&#34;</span><span class="op" id="4117559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4117562">//&nbsp;RFC&nbsp;2616,&nbsp;section&nbsp;7.2.1&nbsp;-&nbsp;empty&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4117603">//&nbsp;&nbsp;&nbsp;SHOULD&nbsp;be&nbsp;treated&nbsp;as&nbsp;application/octet-stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117655">if</span>&nbsp;<span class="ident" id="4117658">ct</span>&nbsp;<span class="op" id="4117661">==</span>&nbsp;<span class="string" id="4117664">&#34;&#34;</span>&nbsp;<span class="op" id="4117667">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117671">ct</span>&nbsp;<span class="op" id="4117674">=</span>&nbsp;<span class="string" id="4117676">&#34;application/octet-stream&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117707">ct</span><span class="op" id="4117709">,</span>&nbsp;<span class="ident" id="4117711">_</span><span class="op" id="4117712">,</span>&nbsp;<span class="ident" id="4117714">err</span>&nbsp;<span class="op" id="4117718">=</span>&nbsp;<span class="ident" id="4117720">mime</span><span class="op" id="4117724">.</span><span class="ident" id="4117725">ParseMediaType</span><span class="op" id="4117739">(</span><span class="ident" id="4117740">ct</span><span class="op" id="4117742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117745">switch</span>&nbsp;<span class="op" id="4117752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117755">case</span>&nbsp;<span class="ident" id="4117760">ct</span>&nbsp;<span class="op" id="4117763">==</span>&nbsp;<span class="string" id="4117766">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="4117801">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117805">var</span>&nbsp;<span class="ident" id="4117809">reader</span>&nbsp;<span class="ident" id="4117816">io</span><span class="op" id="4117818">.</span><span class="ident" id="4117819">Reader</span>&nbsp;<span class="op" id="4117826">=</span>&nbsp;<span class="ident" id="4117828">r</span><span class="op" id="4117829">.</span><span class="ident" id="4117830">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117837">maxFormSize</span>&nbsp;<span class="op" id="4117849">:=</span>&nbsp;<span class="ident" id="4117852">int64</span><span class="op" id="4117857">(</span><span class="num" id="4117858">1</span><span class="op" id="4117859">&lt;&lt;</span><span class="num" id="4117861">63</span>&nbsp;<span class="op" id="4117864">-</span>&nbsp;<span class="num" id="4117866">1</span><span class="op" id="4117867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117871">if</span>&nbsp;<span class="ident" id="4117874">_</span><span class="op" id="4117875">,</span>&nbsp;<span class="ident" id="4117877">ok</span>&nbsp;<span class="op" id="4117880">:=</span>&nbsp;<span class="ident" id="4117883">r</span><span class="op" id="4117884">.</span><span class="ident" id="4117885">Body</span><span class="op" id="4117889">.</span><span class="op" id="4117890">(</span><span class="op" id="4117891">*</span><span class="ident" id="4117892">maxBytesReader</span><span class="op" id="4117906">)</span><span class="op" id="4117907">;</span>&nbsp;<span class="op" id="4117909">!</span><span class="ident" id="4117910">ok</span>&nbsp;<span class="op" id="4117913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117918">maxFormSize</span>&nbsp;<span class="op" id="4117930">=</span>&nbsp;<span class="ident" id="4117932">int64</span><span class="op" id="4117937">(</span><span class="num" id="4117938">10</span>&nbsp;<span class="op" id="4117941">&lt;&lt;</span>&nbsp;<span class="num" id="4117944">20</span><span class="op" id="4117946">)</span>&nbsp;<span class="comment" id="4117948">//&nbsp;10&nbsp;MB&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117978">reader</span>&nbsp;<span class="op" id="4117985">=</span>&nbsp;<span class="ident" id="4117987">io</span><span class="op" id="4117989">.</span><span class="ident" id="4117990">LimitReader</span><span class="op" id="4118001">(</span><span class="ident" id="4118002">r</span><span class="op" id="4118003">.</span><span class="ident" id="4118004">Body</span><span class="op" id="4118008">,</span>&nbsp;<span class="ident" id="4118010">maxFormSize</span><span class="op" id="4118021">+</span><span class="num" id="4118022">1</span><span class="op" id="4118023">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4118027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118031">b</span><span class="op" id="4118032">,</span>&nbsp;<span class="ident" id="4118034">e</span>&nbsp;<span class="op" id="4118036">:=</span>&nbsp;<span class="ident" id="4118039">ioutil</span><span class="op" id="4118045">.</span><span class="ident" id="4118046">ReadAll</span><span class="op" id="4118053">(</span><span class="ident" id="4118054">reader</span><span class="op" id="4118060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118064">if</span>&nbsp;<span class="ident" id="4118067">e</span>&nbsp;<span class="op" id="4118069">!=</span>&nbsp;<span class="builtintype" id="4118072">nil</span>&nbsp;<span class="op" id="4118076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118081">if</span>&nbsp;<span class="ident" id="4118084">err</span>&nbsp;<span class="op" id="4118088">==</span>&nbsp;<span class="builtintype" id="4118091">nil</span>&nbsp;<span class="op" id="4118095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118101">err</span>&nbsp;<span class="op" id="4118105">=</span>&nbsp;<span class="ident" id="4118107">e</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4118112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118117">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4118125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118129">if</span>&nbsp;<span class="ident" id="4118132">int64</span><span class="op" id="4118137">(</span><span class="builtinfunc" id="4118138">len</span><span class="op" id="4118141">(</span><span class="ident" id="4118142">b</span><span class="op" id="4118143">)</span><span class="op" id="4118144">)</span>&nbsp;<span class="op" id="4118146">&gt;</span>&nbsp;<span class="ident" id="4118148">maxFormSize</span>&nbsp;<span class="op" id="4118160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118165">err</span>&nbsp;<span class="op" id="4118169">=</span>&nbsp;<span class="ident" id="4118171">errors</span><span class="op" id="4118177">.</span><span class="ident" id="4118178">New</span><span class="op" id="4118181">(</span><span class="string" id="4118182">&#34;http:&nbsp;POST&nbsp;too&nbsp;large&#34;</span><span class="op" id="4118204">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118209">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4118218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118222">vs</span><span class="op" id="4118224">,</span>&nbsp;<span class="ident" id="4118226">e</span>&nbsp;<span class="op" id="4118228">=</span>&nbsp;<span class="ident" id="4118230">url</span><span class="op" id="4118233">.</span><span class="ident" id="4118234">ParseQuery</span><span class="op" id="4118244">(</span><span class="builtintype" id="4118245">string</span><span class="op" id="4118251">(</span><span class="ident" id="4118252">b</span><span class="op" id="4118253">)</span><span class="op" id="4118254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118258">if</span>&nbsp;<span class="ident" id="4118261">err</span>&nbsp;<span class="op" id="4118265">==</span>&nbsp;<span class="builtintype" id="4118268">nil</span>&nbsp;<span class="op" id="4118272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118277">err</span>&nbsp;<span class="op" id="4118281">=</span>&nbsp;<span class="ident" id="4118283">e</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4118287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118290">case</span>&nbsp;<span class="ident" id="4118295">ct</span>&nbsp;<span class="op" id="4118298">==</span>&nbsp;<span class="string" id="4118301">&#34;multipart/form-data&#34;</span><span class="op" id="4118322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118326">//&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&nbsp;(which&nbsp;is&nbsp;calling&nbsp;us,&nbsp;or&nbsp;should&nbsp;be)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118397">//&nbsp;TODO(bradfitz):&nbsp;there&nbsp;are&nbsp;too&nbsp;many&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118446">//&nbsp;orders&nbsp;to&nbsp;call&nbsp;too&nbsp;many&nbsp;functions&nbsp;here.</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118491">//&nbsp;Clean&nbsp;this&nbsp;up&nbsp;and&nbsp;write&nbsp;more&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118532">//&nbsp;request_test.go&nbsp;contains&nbsp;the&nbsp;start&nbsp;of&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118581">//&nbsp;in&nbsp;TestParseMultipartFormOrder&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4118628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118631">return</span><br>
<span class="lineno">765</span><span class="op" id="4118638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4118641">//&nbsp;ParseForm&nbsp;parses&nbsp;the&nbsp;raw&nbsp;query&nbsp;from&nbsp;the&nbsp;URL&nbsp;and&nbsp;updates&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="4118708">//</span><br>
<span class="lineno"></span><span class="comment" id="4118711">//&nbsp;For&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;requests,&nbsp;it&nbsp;also&nbsp;parses&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;form&nbsp;and</span><br>
<span class="lineno">770</span><span class="comment" id="4118786">//&nbsp;put&nbsp;the&nbsp;results&nbsp;into&nbsp;both&nbsp;r.PostForm&nbsp;and&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="4118838">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4118915">//&nbsp;in&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="4118929">//</span><br>
<span class="lineno"></span><span class="comment" id="4118932">//&nbsp;If&nbsp;the&nbsp;request&nbsp;Body&#39;s&nbsp;size&nbsp;has&nbsp;not&nbsp;already&nbsp;been&nbsp;limited&nbsp;by&nbsp;MaxBytesReader,</span><br>
<span class="lineno">775</span><span class="comment" id="4119010">//&nbsp;the&nbsp;size&nbsp;is&nbsp;capped&nbsp;at&nbsp;10MB.</span><br>
<span class="lineno"></span><span class="comment" id="4119041">//</span><br>
<span class="lineno"></span><span class="comment" id="4119044">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="comment" id="4119097">//&nbsp;It&nbsp;is&nbsp;idempotent.</span><br>
<span class="lineno"></span><span class="keyword" id="4119118">func</span>&nbsp;<span class="op" id="4119123">(</span><span class="ident" id="4119124">r</span>&nbsp;<span class="op" id="4119126">*</span><span class="ident" id="4119127">Request</span><span class="op" id="4119134">)</span>&nbsp;<span class="ident" id="4119136">ParseForm</span><span class="op" id="4119145">(</span><span class="op" id="4119146">)</span>&nbsp;<span class="builtintype" id="4119148">error</span>&nbsp;<span class="op" id="4119154">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119157">var</span>&nbsp;<span class="ident" id="4119161">err</span>&nbsp;<span class="builtintype" id="4119165">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119172">if</span>&nbsp;<span class="ident" id="4119175">r</span><span class="op" id="4119176">.</span><span class="ident" id="4119177">PostForm</span>&nbsp;<span class="op" id="4119186">==</span>&nbsp;<span class="builtintype" id="4119189">nil</span>&nbsp;<span class="op" id="4119193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119197">if</span>&nbsp;<span class="ident" id="4119200">r</span><span class="op" id="4119201">.</span><span class="ident" id="4119202">Method</span>&nbsp;<span class="op" id="4119209">==</span>&nbsp;<span class="string" id="4119212">&#34;POST&#34;</span>&nbsp;<span class="op" id="4119219">||</span>&nbsp;<span class="ident" id="4119222">r</span><span class="op" id="4119223">.</span><span class="ident" id="4119224">Method</span>&nbsp;<span class="op" id="4119231">==</span>&nbsp;<span class="string" id="4119234">&#34;PUT&#34;</span>&nbsp;<span class="op" id="4119240">||</span>&nbsp;<span class="ident" id="4119243">r</span><span class="op" id="4119244">.</span><span class="ident" id="4119245">Method</span>&nbsp;<span class="op" id="4119252">==</span>&nbsp;<span class="string" id="4119255">&#34;PATCH&#34;</span>&nbsp;<span class="op" id="4119263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119268">r</span><span class="op" id="4119269">.</span><span class="ident" id="4119270">PostForm</span><span class="op" id="4119278">,</span>&nbsp;<span class="ident" id="4119280">err</span>&nbsp;<span class="op" id="4119284">=</span>&nbsp;<span class="ident" id="4119286">parsePostForm</span><span class="op" id="4119299">(</span><span class="ident" id="4119300">r</span><span class="op" id="4119301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119305">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119309">if</span>&nbsp;<span class="ident" id="4119312">r</span><span class="op" id="4119313">.</span><span class="ident" id="4119314">PostForm</span>&nbsp;<span class="op" id="4119323">==</span>&nbsp;<span class="builtintype" id="4119326">nil</span>&nbsp;<span class="op" id="4119330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119335">r</span><span class="op" id="4119336">.</span><span class="ident" id="4119337">PostForm</span>&nbsp;<span class="op" id="4119346">=</span>&nbsp;<span class="builtinfunc" id="4119348">make</span><span class="op" id="4119352">(</span><span class="ident" id="4119353">url</span><span class="op" id="4119356">.</span><span class="ident" id="4119357">Values</span><span class="op" id="4119363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119373">if</span>&nbsp;<span class="ident" id="4119376">r</span><span class="op" id="4119377">.</span><span class="ident" id="4119378">Form</span>&nbsp;<span class="op" id="4119383">==</span>&nbsp;<span class="builtintype" id="4119386">nil</span>&nbsp;<span class="op" id="4119390">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119394">if</span>&nbsp;<span class="builtinfunc" id="4119397">len</span><span class="op" id="4119400">(</span><span class="ident" id="4119401">r</span><span class="op" id="4119402">.</span><span class="ident" id="4119403">PostForm</span><span class="op" id="4119411">)</span>&nbsp;<span class="op" id="4119413">&gt;</span>&nbsp;<span class="num" id="4119415">0</span>&nbsp;<span class="op" id="4119417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119422">r</span><span class="op" id="4119423">.</span><span class="ident" id="4119424">Form</span>&nbsp;<span class="op" id="4119429">=</span>&nbsp;<span class="builtinfunc" id="4119431">make</span><span class="op" id="4119435">(</span><span class="ident" id="4119436">url</span><span class="op" id="4119439">.</span><span class="ident" id="4119440">Values</span><span class="op" id="4119446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119451">copyValues</span><span class="op" id="4119461">(</span><span class="ident" id="4119462">r</span><span class="op" id="4119463">.</span><span class="ident" id="4119464">Form</span><span class="op" id="4119468">,</span>&nbsp;<span class="ident" id="4119470">r</span><span class="op" id="4119471">.</span><span class="ident" id="4119472">PostForm</span><span class="op" id="4119480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119488">var</span>&nbsp;<span class="ident" id="4119492">newValues</span>&nbsp;<span class="ident" id="4119502">url</span><span class="op" id="4119505">.</span><span class="ident" id="4119506">Values</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119515">if</span>&nbsp;<span class="ident" id="4119518">r</span><span class="op" id="4119519">.</span><span class="ident" id="4119520">URL</span>&nbsp;<span class="op" id="4119524">!=</span>&nbsp;<span class="builtintype" id="4119527">nil</span>&nbsp;<span class="op" id="4119531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119536">var</span>&nbsp;<span class="ident" id="4119540">e</span>&nbsp;<span class="builtintype" id="4119542">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119551">newValues</span><span class="op" id="4119560">,</span>&nbsp;<span class="ident" id="4119562">e</span>&nbsp;<span class="op" id="4119564">=</span>&nbsp;<span class="ident" id="4119566">url</span><span class="op" id="4119569">.</span><span class="ident" id="4119570">ParseQuery</span><span class="op" id="4119580">(</span><span class="ident" id="4119581">r</span><span class="op" id="4119582">.</span><span class="ident" id="4119583">URL</span><span class="op" id="4119586">.</span><span class="ident" id="4119587">RawQuery</span><span class="op" id="4119595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119600">if</span>&nbsp;<span class="ident" id="4119603">err</span>&nbsp;<span class="op" id="4119607">==</span>&nbsp;<span class="builtintype" id="4119610">nil</span>&nbsp;<span class="op" id="4119614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119620">err</span>&nbsp;<span class="op" id="4119624">=</span>&nbsp;<span class="ident" id="4119626">e</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119639">if</span>&nbsp;<span class="ident" id="4119642">newValues</span>&nbsp;<span class="op" id="4119652">==</span>&nbsp;<span class="builtintype" id="4119655">nil</span>&nbsp;<span class="op" id="4119659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119664">newValues</span>&nbsp;<span class="op" id="4119674">=</span>&nbsp;<span class="builtinfunc" id="4119676">make</span><span class="op" id="4119680">(</span><span class="ident" id="4119681">url</span><span class="op" id="4119684">.</span><span class="ident" id="4119685">Values</span><span class="op" id="4119691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119695">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119699">if</span>&nbsp;<span class="ident" id="4119702">r</span><span class="op" id="4119703">.</span><span class="ident" id="4119704">Form</span>&nbsp;<span class="op" id="4119709">==</span>&nbsp;<span class="builtintype" id="4119712">nil</span>&nbsp;<span class="op" id="4119716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119721">r</span><span class="op" id="4119722">.</span><span class="ident" id="4119723">Form</span>&nbsp;<span class="op" id="4119728">=</span>&nbsp;<span class="ident" id="4119730">newValues</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119742">}</span>&nbsp;<span class="keyword" id="4119744">else</span>&nbsp;<span class="op" id="4119749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119754">copyValues</span><span class="op" id="4119764">(</span><span class="ident" id="4119765">r</span><span class="op" id="4119766">.</span><span class="ident" id="4119767">Form</span><span class="op" id="4119771">,</span>&nbsp;<span class="ident" id="4119773">newValues</span><span class="op" id="4119782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119786">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119792">return</span>&nbsp;<span class="ident" id="4119799">err</span><br>
<span class="lineno"></span><span class="op" id="4119803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4119806">//&nbsp;ParseMultipartForm&nbsp;parses&nbsp;a&nbsp;request&nbsp;body&nbsp;as&nbsp;multipart/form-data.</span><br>
<span class="lineno">815</span><span class="comment" id="4119874">//&nbsp;The&nbsp;whole&nbsp;request&nbsp;body&nbsp;is&nbsp;parsed&nbsp;and&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;of&nbsp;maxMemory&nbsp;bytes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4119950">//&nbsp;its&nbsp;file&nbsp;parts&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory,&nbsp;with&nbsp;the&nbsp;remainder&nbsp;stored&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="4120019">//&nbsp;disk&nbsp;in&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4120047">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="comment" id="4120099">//&nbsp;After&nbsp;one&nbsp;call&nbsp;to&nbsp;ParseMultipartForm,&nbsp;subsequent&nbsp;calls&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">820</span><span class="keyword" id="4120173">func</span>&nbsp;<span class="op" id="4120178">(</span><span class="ident" id="4120179">r</span>&nbsp;<span class="op" id="4120181">*</span><span class="ident" id="4120182">Request</span><span class="op" id="4120189">)</span>&nbsp;<span class="ident" id="4120191">ParseMultipartForm</span><span class="op" id="4120209">(</span><span class="ident" id="4120210">maxMemory</span>&nbsp;<span class="ident" id="4120220">int64</span><span class="op" id="4120225">)</span>&nbsp;<span class="builtintype" id="4120227">error</span>&nbsp;<span class="op" id="4120233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120236">if</span>&nbsp;<span class="ident" id="4120239">r</span><span class="op" id="4120240">.</span><span class="ident" id="4120241">MultipartForm</span>&nbsp;<span class="op" id="4120255">==</span>&nbsp;<span class="ident" id="4120258">multipartByReader</span>&nbsp;<span class="op" id="4120276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120280">return</span>&nbsp;<span class="ident" id="4120287">errors</span><span class="op" id="4120293">.</span><span class="ident" id="4120294">New</span><span class="op" id="4120297">(</span><span class="string" id="4120298">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="4120342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120348">if</span>&nbsp;<span class="ident" id="4120351">r</span><span class="op" id="4120352">.</span><span class="ident" id="4120353">Form</span>&nbsp;<span class="op" id="4120358">==</span>&nbsp;<span class="builtintype" id="4120361">nil</span>&nbsp;<span class="op" id="4120365">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120369">err</span>&nbsp;<span class="op" id="4120373">:=</span>&nbsp;<span class="ident" id="4120376">r</span><span class="op" id="4120377">.</span><span class="ident" id="4120378">ParseForm</span><span class="op" id="4120387">(</span><span class="op" id="4120388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120392">if</span>&nbsp;<span class="ident" id="4120395">err</span>&nbsp;<span class="op" id="4120399">!=</span>&nbsp;<span class="builtintype" id="4120402">nil</span>&nbsp;<span class="op" id="4120406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120411">return</span>&nbsp;<span class="ident" id="4120418">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120427">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120430">if</span>&nbsp;<span class="ident" id="4120433">r</span><span class="op" id="4120434">.</span><span class="ident" id="4120435">MultipartForm</span>&nbsp;<span class="op" id="4120449">!=</span>&nbsp;<span class="builtintype" id="4120452">nil</span>&nbsp;<span class="op" id="4120456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120460">return</span>&nbsp;<span class="builtintype" id="4120467">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120476">mr</span><span class="op" id="4120478">,</span>&nbsp;<span class="ident" id="4120480">err</span>&nbsp;<span class="op" id="4120484">:=</span>&nbsp;<span class="ident" id="4120487">r</span><span class="op" id="4120488">.</span><span class="ident" id="4120489">multipartReader</span><span class="op" id="4120504">(</span><span class="op" id="4120505">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120508">if</span>&nbsp;<span class="ident" id="4120511">err</span>&nbsp;<span class="op" id="4120515">!=</span>&nbsp;<span class="builtintype" id="4120518">nil</span>&nbsp;<span class="op" id="4120522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120526">return</span>&nbsp;<span class="ident" id="4120533">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120542">f</span><span class="op" id="4120543">,</span>&nbsp;<span class="ident" id="4120545">err</span>&nbsp;<span class="op" id="4120549">:=</span>&nbsp;<span class="ident" id="4120552">mr</span><span class="op" id="4120554">.</span><span class="ident" id="4120555">ReadForm</span><span class="op" id="4120563">(</span><span class="ident" id="4120564">maxMemory</span><span class="op" id="4120573">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120576">if</span>&nbsp;<span class="ident" id="4120579">err</span>&nbsp;<span class="op" id="4120583">!=</span>&nbsp;<span class="builtintype" id="4120586">nil</span>&nbsp;<span class="op" id="4120590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120594">return</span>&nbsp;<span class="ident" id="4120601">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120609">for</span>&nbsp;<span class="ident" id="4120613">k</span><span class="op" id="4120614">,</span>&nbsp;<span class="ident" id="4120616">v</span>&nbsp;<span class="op" id="4120618">:=</span>&nbsp;<span class="keyword" id="4120621">range</span>&nbsp;<span class="ident" id="4120627">f</span><span class="op" id="4120628">.</span><span class="ident" id="4120629">Value</span>&nbsp;<span class="op" id="4120635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120639">r</span><span class="op" id="4120640">.</span><span class="ident" id="4120641">Form</span><span class="op" id="4120645">[</span><span class="ident" id="4120646">k</span><span class="op" id="4120647">]</span>&nbsp;<span class="op" id="4120649">=</span>&nbsp;<span class="builtinfunc" id="4120651">append</span><span class="op" id="4120657">(</span><span class="ident" id="4120658">r</span><span class="op" id="4120659">.</span><span class="ident" id="4120660">Form</span><span class="op" id="4120664">[</span><span class="ident" id="4120665">k</span><span class="op" id="4120666">]</span><span class="op" id="4120667">,</span>&nbsp;<span class="ident" id="4120669">v</span><span class="op" id="4120670">...</span><span class="op" id="4120673">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120679">r</span><span class="op" id="4120680">.</span><span class="ident" id="4120681">MultipartForm</span>&nbsp;<span class="op" id="4120695">=</span>&nbsp;<span class="ident" id="4120697">f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120701">return</span>&nbsp;<span class="builtintype" id="4120708">nil</span><br>
<span class="lineno"></span><span class="op" id="4120712">}</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span><span class="comment" id="4120715">//&nbsp;FormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="comment" id="4120790">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="4120868">//&nbsp;FormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno"></span><span class="comment" id="4120945">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno">855</span><span class="comment" id="4120988">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;key,&nbsp;call&nbsp;ParseForm&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4121053">//&nbsp;then&nbsp;inspect&nbsp;Request.Form&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4121092">func</span>&nbsp;<span class="op" id="4121097">(</span><span class="ident" id="4121098">r</span>&nbsp;<span class="op" id="4121100">*</span><span class="ident" id="4121101">Request</span><span class="op" id="4121108">)</span>&nbsp;<span class="ident" id="4121110">FormValue</span><span class="op" id="4121119">(</span><span class="ident" id="4121120">key</span>&nbsp;<span class="builtintype" id="4121124">string</span><span class="op" id="4121130">)</span>&nbsp;<span class="builtintype" id="4121132">string</span>&nbsp;<span class="op" id="4121139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121142">if</span>&nbsp;<span class="ident" id="4121145">r</span><span class="op" id="4121146">.</span><span class="ident" id="4121147">Form</span>&nbsp;<span class="op" id="4121152">==</span>&nbsp;<span class="builtintype" id="4121155">nil</span>&nbsp;<span class="op" id="4121159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121163">r</span><span class="op" id="4121164">.</span><span class="ident" id="4121165">ParseMultipartForm</span><span class="op" id="4121183">(</span><span class="ident" id="4121184">defaultMaxMemory</span><span class="op" id="4121200">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121206">if</span>&nbsp;<span class="ident" id="4121209">vs</span>&nbsp;<span class="op" id="4121212">:=</span>&nbsp;<span class="ident" id="4121215">r</span><span class="op" id="4121216">.</span><span class="ident" id="4121217">Form</span><span class="op" id="4121221">[</span><span class="ident" id="4121222">key</span><span class="op" id="4121225">]</span><span class="op" id="4121226">;</span>&nbsp;<span class="builtinfunc" id="4121228">len</span><span class="op" id="4121231">(</span><span class="ident" id="4121232">vs</span><span class="op" id="4121234">)</span>&nbsp;<span class="op" id="4121236">&gt;</span>&nbsp;<span class="num" id="4121238">0</span>&nbsp;<span class="op" id="4121240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121244">return</span>&nbsp;<span class="ident" id="4121251">vs</span><span class="op" id="4121253">[</span><span class="num" id="4121254">0</span><span class="op" id="4121255">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121261">return</span>&nbsp;<span class="string" id="4121268">&#34;&#34;</span><br>
<span class="lineno">865</span><span class="op" id="4121271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4121274">//&nbsp;PostFormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;POST</span><br>
<span class="lineno"></span><span class="comment" id="4121351">//&nbsp;or&nbsp;PUT&nbsp;request&nbsp;body.&nbsp;URL&nbsp;query&nbsp;parameters&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4121409">//&nbsp;PostFormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno">870</span><span class="comment" id="4121490">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno"></span><span class="keyword" id="4121533">func</span>&nbsp;<span class="op" id="4121538">(</span><span class="ident" id="4121539">r</span>&nbsp;<span class="op" id="4121541">*</span><span class="ident" id="4121542">Request</span><span class="op" id="4121549">)</span>&nbsp;<span class="ident" id="4121551">PostFormValue</span><span class="op" id="4121564">(</span><span class="ident" id="4121565">key</span>&nbsp;<span class="builtintype" id="4121569">string</span><span class="op" id="4121575">)</span>&nbsp;<span class="builtintype" id="4121577">string</span>&nbsp;<span class="op" id="4121584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121587">if</span>&nbsp;<span class="ident" id="4121590">r</span><span class="op" id="4121591">.</span><span class="ident" id="4121592">PostForm</span>&nbsp;<span class="op" id="4121601">==</span>&nbsp;<span class="builtintype" id="4121604">nil</span>&nbsp;<span class="op" id="4121608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121612">r</span><span class="op" id="4121613">.</span><span class="ident" id="4121614">ParseMultipartForm</span><span class="op" id="4121632">(</span><span class="ident" id="4121633">defaultMaxMemory</span><span class="op" id="4121649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121652">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121655">if</span>&nbsp;<span class="ident" id="4121658">vs</span>&nbsp;<span class="op" id="4121661">:=</span>&nbsp;<span class="ident" id="4121664">r</span><span class="op" id="4121665">.</span><span class="ident" id="4121666">PostForm</span><span class="op" id="4121674">[</span><span class="ident" id="4121675">key</span><span class="op" id="4121678">]</span><span class="op" id="4121679">;</span>&nbsp;<span class="builtinfunc" id="4121681">len</span><span class="op" id="4121684">(</span><span class="ident" id="4121685">vs</span><span class="op" id="4121687">)</span>&nbsp;<span class="op" id="4121689">&gt;</span>&nbsp;<span class="num" id="4121691">0</span>&nbsp;<span class="op" id="4121693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121697">return</span>&nbsp;<span class="ident" id="4121704">vs</span><span class="op" id="4121706">[</span><span class="num" id="4121707">0</span><span class="op" id="4121708">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121714">return</span>&nbsp;<span class="string" id="4121721">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4121724">}</span><br>
<span class="lineno">880</span><br>
<span class="lineno"></span><span class="comment" id="4121727">//&nbsp;FormFile&nbsp;returns&nbsp;the&nbsp;first&nbsp;file&nbsp;for&nbsp;the&nbsp;provided&nbsp;form&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4121789">//&nbsp;FormFile&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="4121854">func</span>&nbsp;<span class="op" id="4121859">(</span><span class="ident" id="4121860">r</span>&nbsp;<span class="op" id="4121862">*</span><span class="ident" id="4121863">Request</span><span class="op" id="4121870">)</span>&nbsp;<span class="ident" id="4121872">FormFile</span><span class="op" id="4121880">(</span><span class="ident" id="4121881">key</span>&nbsp;<span class="builtintype" id="4121885">string</span><span class="op" id="4121891">)</span>&nbsp;<span class="op" id="4121893">(</span><span class="ident" id="4121894">multipart</span><span class="op" id="4121903">.</span><span class="ident" id="4121904">File</span><span class="op" id="4121908">,</span>&nbsp;<span class="op" id="4121910">*</span><span class="ident" id="4121911">multipart</span><span class="op" id="4121920">.</span><span class="ident" id="4121921">FileHeader</span><span class="op" id="4121931">,</span>&nbsp;<span class="builtintype" id="4121933">error</span><span class="op" id="4121938">)</span>&nbsp;<span class="op" id="4121940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121943">if</span>&nbsp;<span class="ident" id="4121946">r</span><span class="op" id="4121947">.</span><span class="ident" id="4121948">MultipartForm</span>&nbsp;<span class="op" id="4121962">==</span>&nbsp;<span class="ident" id="4121965">multipartByReader</span>&nbsp;<span class="op" id="4121983">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121987">return</span>&nbsp;<span class="builtintype" id="4121994">nil</span><span class="op" id="4121997">,</span>&nbsp;<span class="builtintype" id="4121999">nil</span><span class="op" id="4122002">,</span>&nbsp;<span class="ident" id="4122004">errors</span><span class="op" id="4122010">.</span><span class="ident" id="4122011">New</span><span class="op" id="4122014">(</span><span class="string" id="4122015">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="4122059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4122062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122065">if</span>&nbsp;<span class="ident" id="4122068">r</span><span class="op" id="4122069">.</span><span class="ident" id="4122070">MultipartForm</span>&nbsp;<span class="op" id="4122084">==</span>&nbsp;<span class="builtintype" id="4122087">nil</span>&nbsp;<span class="op" id="4122091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122095">err</span>&nbsp;<span class="op" id="4122099">:=</span>&nbsp;<span class="ident" id="4122102">r</span><span class="op" id="4122103">.</span><span class="ident" id="4122104">ParseMultipartForm</span><span class="op" id="4122122">(</span><span class="ident" id="4122123">defaultMaxMemory</span><span class="op" id="4122139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122143">if</span>&nbsp;<span class="ident" id="4122146">err</span>&nbsp;<span class="op" id="4122150">!=</span>&nbsp;<span class="builtintype" id="4122153">nil</span>&nbsp;<span class="op" id="4122157">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122162">return</span>&nbsp;<span class="builtintype" id="4122169">nil</span><span class="op" id="4122172">,</span>&nbsp;<span class="builtintype" id="4122174">nil</span><span class="op" id="4122177">,</span>&nbsp;<span class="ident" id="4122179">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4122185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4122188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122191">if</span>&nbsp;<span class="ident" id="4122194">r</span><span class="op" id="4122195">.</span><span class="ident" id="4122196">MultipartForm</span>&nbsp;<span class="op" id="4122210">!=</span>&nbsp;<span class="builtintype" id="4122213">nil</span>&nbsp;<span class="op" id="4122217">&amp;&amp;</span>&nbsp;<span class="ident" id="4122220">r</span><span class="op" id="4122221">.</span><span class="ident" id="4122222">MultipartForm</span><span class="op" id="4122235">.</span><span class="ident" id="4122236">File</span>&nbsp;<span class="op" id="4122241">!=</span>&nbsp;<span class="builtintype" id="4122244">nil</span>&nbsp;<span class="op" id="4122248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122252">if</span>&nbsp;<span class="ident" id="4122255">fhs</span>&nbsp;<span class="op" id="4122259">:=</span>&nbsp;<span class="ident" id="4122262">r</span><span class="op" id="4122263">.</span><span class="ident" id="4122264">MultipartForm</span><span class="op" id="4122277">.</span><span class="ident" id="4122278">File</span><span class="op" id="4122282">[</span><span class="ident" id="4122283">key</span><span class="op" id="4122286">]</span><span class="op" id="4122287">;</span>&nbsp;<span class="builtinfunc" id="4122289">len</span><span class="op" id="4122292">(</span><span class="ident" id="4122293">fhs</span><span class="op" id="4122296">)</span>&nbsp;<span class="op" id="4122298">&gt;</span>&nbsp;<span class="num" id="4122300">0</span>&nbsp;<span class="op" id="4122302">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122307">f</span><span class="op" id="4122308">,</span>&nbsp;<span class="ident" id="4122310">err</span>&nbsp;<span class="op" id="4122314">:=</span>&nbsp;<span class="ident" id="4122317">fhs</span><span class="op" id="4122320">[</span><span class="num" id="4122321">0</span><span class="op" id="4122322">]</span><span class="op" id="4122323">.</span><span class="ident" id="4122324">Open</span><span class="op" id="4122328">(</span><span class="op" id="4122329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122334">return</span>&nbsp;<span class="ident" id="4122341">f</span><span class="op" id="4122342">,</span>&nbsp;<span class="ident" id="4122344">fhs</span><span class="op" id="4122347">[</span><span class="num" id="4122348">0</span><span class="op" id="4122349">]</span><span class="op" id="4122350">,</span>&nbsp;<span class="ident" id="4122352">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4122358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4122361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122364">return</span>&nbsp;<span class="builtintype" id="4122371">nil</span><span class="op" id="4122374">,</span>&nbsp;<span class="builtintype" id="4122376">nil</span><span class="op" id="4122379">,</span>&nbsp;<span class="ident" id="4122381">ErrMissingFile</span><br>
<span class="lineno">900</span><span class="op" id="4122396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4122399">func</span>&nbsp;<span class="op" id="4122404">(</span><span class="ident" id="4122405">r</span>&nbsp;<span class="op" id="4122407">*</span><span class="ident" id="4122408">Request</span><span class="op" id="4122415">)</span>&nbsp;<span class="ident" id="4122417">expectsContinue</span><span class="op" id="4122432">(</span><span class="op" id="4122433">)</span>&nbsp;<span class="builtintype" id="4122435">bool</span>&nbsp;<span class="op" id="4122440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122443">return</span>&nbsp;<span class="ident" id="4122450">hasToken</span><span class="op" id="4122458">(</span><span class="ident" id="4122459">r</span><span class="op" id="4122460">.</span><span class="ident" id="4122461">Header</span><span class="op" id="4122467">.</span><span class="ident" id="4122468">get</span><span class="op" id="4122471">(</span><span class="string" id="4122472">&#34;Expect&#34;</span><span class="op" id="4122480">)</span><span class="op" id="4122481">,</span>&nbsp;<span class="string" id="4122483">&#34;100-continue&#34;</span><span class="op" id="4122497">)</span><br>
<span class="lineno"></span><span class="op" id="4122499">}</span><br>
<span class="lineno">905</span><br>
<span class="lineno"></span><span class="keyword" id="4122502">func</span>&nbsp;<span class="op" id="4122507">(</span><span class="ident" id="4122508">r</span>&nbsp;<span class="op" id="4122510">*</span><span class="ident" id="4122511">Request</span><span class="op" id="4122518">)</span>&nbsp;<span class="ident" id="4122520">wantsHttp10KeepAlive</span><span class="op" id="4122540">(</span><span class="op" id="4122541">)</span>&nbsp;<span class="builtintype" id="4122543">bool</span>&nbsp;<span class="op" id="4122548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122551">if</span>&nbsp;<span class="ident" id="4122554">r</span><span class="op" id="4122555">.</span><span class="ident" id="4122556">ProtoMajor</span>&nbsp;<span class="op" id="4122567">!=</span>&nbsp;<span class="num" id="4122570">1</span>&nbsp;<span class="op" id="4122572">||</span>&nbsp;<span class="ident" id="4122575">r</span><span class="op" id="4122576">.</span><span class="ident" id="4122577">ProtoMinor</span>&nbsp;<span class="op" id="4122588">!=</span>&nbsp;<span class="num" id="4122591">0</span>&nbsp;<span class="op" id="4122593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122597">return</span>&nbsp;<span class="builtintype" id="4122604">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4122611">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122614">return</span>&nbsp;<span class="ident" id="4122621">hasToken</span><span class="op" id="4122629">(</span><span class="ident" id="4122630">r</span><span class="op" id="4122631">.</span><span class="ident" id="4122632">Header</span><span class="op" id="4122638">.</span><span class="ident" id="4122639">get</span><span class="op" id="4122642">(</span><span class="string" id="4122643">&#34;Connection&#34;</span><span class="op" id="4122655">)</span><span class="op" id="4122656">,</span>&nbsp;<span class="string" id="4122658">&#34;keep-alive&#34;</span><span class="op" id="4122670">)</span><br>
<span class="lineno"></span><span class="op" id="4122672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4122675">func</span>&nbsp;<span class="op" id="4122680">(</span><span class="ident" id="4122681">r</span>&nbsp;<span class="op" id="4122683">*</span><span class="ident" id="4122684">Request</span><span class="op" id="4122691">)</span>&nbsp;<span class="ident" id="4122693">wantsClose</span><span class="op" id="4122703">(</span><span class="op" id="4122704">)</span>&nbsp;<span class="builtintype" id="4122706">bool</span>&nbsp;<span class="op" id="4122711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122714">return</span>&nbsp;<span class="ident" id="4122721">hasToken</span><span class="op" id="4122729">(</span><span class="ident" id="4122730">r</span><span class="op" id="4122731">.</span><span class="ident" id="4122732">Header</span><span class="op" id="4122738">.</span><span class="ident" id="4122739">get</span><span class="op" id="4122742">(</span><span class="string" id="4122743">&#34;Connection&#34;</span><span class="op" id="4122755">)</span><span class="op" id="4122756">,</span>&nbsp;<span class="string" id="4122758">&#34;close&#34;</span><span class="op" id="4122765">)</span><br>
<span class="lineno">915</span><span class="op" id="4122767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4122770">func</span>&nbsp;<span class="op" id="4122775">(</span><span class="ident" id="4122776">r</span>&nbsp;<span class="op" id="4122778">*</span><span class="ident" id="4122779">Request</span><span class="op" id="4122786">)</span>&nbsp;<span class="ident" id="4122788">closeBody</span><span class="op" id="4122797">(</span><span class="op" id="4122798">)</span>&nbsp;<span class="op" id="4122800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122803">if</span>&nbsp;<span class="ident" id="4122806">r</span><span class="op" id="4122807">.</span><span class="ident" id="4122808">Body</span>&nbsp;<span class="op" id="4122813">!=</span>&nbsp;<span class="builtintype" id="4122816">nil</span>&nbsp;<span class="op" id="4122820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122824">r</span><span class="op" id="4122825">.</span><span class="ident" id="4122826">Body</span><span class="op" id="4122830">.</span><span class="ident" id="4122831">Close</span><span class="op" id="4122836">(</span><span class="op" id="4122837">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4122840">}</span><br>
<span class="lineno"></span><span class="op" id="4122842">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
