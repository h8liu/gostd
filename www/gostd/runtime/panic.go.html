<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html" class="current">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1821393">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1821448">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1821502">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1821553">package</span>&nbsp;<span class="ident" id="1821561">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1821570">import</span>&nbsp;<span class="string" id="1821577">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1821587">var</span>&nbsp;<span class="ident" id="1821591">indexError</span>&nbsp;<span class="op" id="1821602">=</span>&nbsp;<span class="builtintype" id="1821604">error</span><span class="op" id="1821609">(</span><span class="ident" id="1821610">errorString</span><span class="op" id="1821621">(</span><span class="string" id="1821622">&#34;index&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1821642">)</span><span class="op" id="1821643">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1821646">func</span>&nbsp;<span class="ident" id="1821651">panicindex</span><span class="op" id="1821661">(</span><span class="op" id="1821662">)</span>&nbsp;<span class="op" id="1821664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1821667">panic</span><span class="op" id="1821672">(</span><span class="ident" id="1821673">indexError</span><span class="op" id="1821683">)</span><br>
<span class="lineno"></span><span class="op" id="1821685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="1821688">var</span>&nbsp;<span class="ident" id="1821692">sliceError</span>&nbsp;<span class="op" id="1821703">=</span>&nbsp;<span class="builtintype" id="1821705">error</span><span class="op" id="1821710">(</span><span class="ident" id="1821711">errorString</span><span class="op" id="1821722">(</span><span class="string" id="1821723">&#34;slice&nbsp;bounds&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1821750">)</span><span class="op" id="1821751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1821754">func</span>&nbsp;<span class="ident" id="1821759">panicslice</span><span class="op" id="1821769">(</span><span class="op" id="1821770">)</span>&nbsp;<span class="op" id="1821772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1821775">panic</span><span class="op" id="1821780">(</span><span class="ident" id="1821781">sliceError</span><span class="op" id="1821791">)</span><br>
<span class="lineno"></span><span class="op" id="1821793">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1821796">var</span>&nbsp;<span class="ident" id="1821800">divideError</span>&nbsp;<span class="op" id="1821812">=</span>&nbsp;<span class="builtintype" id="1821814">error</span><span class="op" id="1821819">(</span><span class="ident" id="1821820">errorString</span><span class="op" id="1821831">(</span><span class="string" id="1821832">&#34;integer&nbsp;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1821856">)</span><span class="op" id="1821857">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1821860">func</span>&nbsp;<span class="ident" id="1821865">panicdivide</span><span class="op" id="1821876">(</span><span class="op" id="1821877">)</span>&nbsp;<span class="op" id="1821879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1821882">panic</span><span class="op" id="1821887">(</span><span class="ident" id="1821888">divideError</span><span class="op" id="1821899">)</span><br>
<span class="lineno">25</span><span class="op" id="1821901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1821904">var</span>&nbsp;<span class="ident" id="1821908">overflowError</span>&nbsp;<span class="op" id="1821922">=</span>&nbsp;<span class="builtintype" id="1821924">error</span><span class="op" id="1821929">(</span><span class="ident" id="1821930">errorString</span><span class="op" id="1821941">(</span><span class="string" id="1821942">&#34;integer&nbsp;overflow&#34;</span><span class="op" id="1821960">)</span><span class="op" id="1821961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1821964">func</span>&nbsp;<span class="ident" id="1821969">panicoverflow</span><span class="op" id="1821982">(</span><span class="op" id="1821983">)</span>&nbsp;<span class="op" id="1821985">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1821988">panic</span><span class="op" id="1821993">(</span><span class="ident" id="1821994">overflowError</span><span class="op" id="1822007">)</span><br>
<span class="lineno"></span><span class="op" id="1822009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1822012">var</span>&nbsp;<span class="ident" id="1822016">floatError</span>&nbsp;<span class="op" id="1822027">=</span>&nbsp;<span class="builtintype" id="1822029">error</span><span class="op" id="1822034">(</span><span class="ident" id="1822035">errorString</span><span class="op" id="1822046">(</span><span class="string" id="1822047">&#34;floating&nbsp;point&nbsp;error&#34;</span><span class="op" id="1822069">)</span><span class="op" id="1822070">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1822073">func</span>&nbsp;<span class="ident" id="1822078">panicfloat</span><span class="op" id="1822088">(</span><span class="op" id="1822089">)</span>&nbsp;<span class="op" id="1822091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1822094">panic</span><span class="op" id="1822099">(</span><span class="ident" id="1822100">floatError</span><span class="op" id="1822110">)</span><br>
<span class="lineno"></span><span class="op" id="1822112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1822115">var</span>&nbsp;<span class="ident" id="1822119">memoryError</span>&nbsp;<span class="op" id="1822131">=</span>&nbsp;<span class="builtintype" id="1822133">error</span><span class="op" id="1822138">(</span><span class="ident" id="1822139">errorString</span><span class="op" id="1822150">(</span><span class="string" id="1822151">&#34;invalid&nbsp;memory&nbsp;address&nbsp;or&nbsp;nil&nbsp;pointer&nbsp;dereference&#34;</span><span class="op" id="1822202">)</span><span class="op" id="1822203">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1822206">func</span>&nbsp;<span class="ident" id="1822211">panicmem</span><span class="op" id="1822219">(</span><span class="op" id="1822220">)</span>&nbsp;<span class="op" id="1822222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1822225">panic</span><span class="op" id="1822230">(</span><span class="ident" id="1822231">memoryError</span><span class="op" id="1822242">)</span><br>
<span class="lineno"></span><span class="op" id="1822244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1822247">func</span>&nbsp;<span class="ident" id="1822252">throwreturn</span><span class="op" id="1822263">(</span><span class="op" id="1822264">)</span>&nbsp;<span class="op" id="1822266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822269">gothrow</span><span class="op" id="1822276">(</span><span class="string" id="1822277">&#34;no&nbsp;return&nbsp;at&nbsp;end&nbsp;of&nbsp;a&nbsp;typed&nbsp;function&nbsp;-&nbsp;compiler&nbsp;is&nbsp;broken&#34;</span><span class="op" id="1822336">)</span><br>
<span class="lineno"></span><span class="op" id="1822338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1822341">func</span>&nbsp;<span class="ident" id="1822346">throwinit</span><span class="op" id="1822355">(</span><span class="op" id="1822356">)</span>&nbsp;<span class="op" id="1822358">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822361">gothrow</span><span class="op" id="1822368">(</span><span class="string" id="1822369">&#34;recursive&nbsp;call&nbsp;during&nbsp;initialization&nbsp;-&nbsp;linker&nbsp;skew&#34;</span><span class="op" id="1822421">)</span><br>
<span class="lineno"></span><span class="op" id="1822423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1822426">//&nbsp;Create&nbsp;a&nbsp;new&nbsp;deferred&nbsp;function&nbsp;fn&nbsp;with&nbsp;siz&nbsp;bytes&nbsp;of&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1822492">//&nbsp;The&nbsp;compiler&nbsp;turns&nbsp;a&nbsp;defer&nbsp;statement&nbsp;into&nbsp;a&nbsp;call&nbsp;to&nbsp;this.</span><br>
<span class="lineno">55</span><span class="comment" id="1822553">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1822566">func</span>&nbsp;<span class="ident" id="1822571">deferproc</span><span class="op" id="1822580">(</span><span class="ident" id="1822581">siz</span>&nbsp;<span class="builtintype" id="1822585">int32</span><span class="op" id="1822590">,</span>&nbsp;<span class="ident" id="1822592">fn</span>&nbsp;<span class="op" id="1822595">*</span><span class="ident" id="1822596">funcval</span><span class="op" id="1822603">)</span>&nbsp;<span class="op" id="1822605">{</span>&nbsp;<span class="comment" id="1822607">//&nbsp;arguments&nbsp;of&nbsp;fn&nbsp;follow&nbsp;fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1822637">//&nbsp;the&nbsp;arguments&nbsp;of&nbsp;fn&nbsp;are&nbsp;in&nbsp;a&nbsp;perilous&nbsp;state.&nbsp;&nbsp;The&nbsp;stack&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1822701">//&nbsp;for&nbsp;deferproc&nbsp;does&nbsp;not&nbsp;describe&nbsp;them.&nbsp;&nbsp;So&nbsp;we&nbsp;can&#39;t&nbsp;let&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1822768">//&nbsp;collection&nbsp;or&nbsp;stack&nbsp;copying&nbsp;trigger&nbsp;until&nbsp;we&#39;ve&nbsp;copied&nbsp;them&nbsp;out</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1822836">//&nbsp;to&nbsp;somewhere&nbsp;safe.&nbsp;&nbsp;deferproc_m&nbsp;does&nbsp;that.&nbsp;&nbsp;Until&nbsp;deferproc_m,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1822903">//&nbsp;we&nbsp;can&nbsp;only&nbsp;call&nbsp;nosplit&nbsp;routines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822942">argp</span>&nbsp;<span class="op" id="1822947">:=</span>&nbsp;<span class="builtintype" id="1822950">uintptr</span><span class="op" id="1822957">(</span><span class="ident" id="1822958">unsafe</span><span class="op" id="1822964">.</span><span class="ident" id="1822965">Pointer</span><span class="op" id="1822972">(</span><span class="op" id="1822973">&amp;</span><span class="ident" id="1822974">fn</span><span class="op" id="1822976">)</span><span class="op" id="1822977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822980">argp</span>&nbsp;<span class="op" id="1822985">+=</span>&nbsp;<span class="ident" id="1822988">unsafe</span><span class="op" id="1822994">.</span><span class="ident" id="1822995">Sizeof</span><span class="op" id="1823001">(</span><span class="ident" id="1823002">fn</span><span class="op" id="1823004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1823007">if</span>&nbsp;<span class="ident" id="1823010">GOARCH</span>&nbsp;<span class="op" id="1823017">==</span>&nbsp;<span class="string" id="1823020">&#34;arm&#34;</span>&nbsp;<span class="op" id="1823026">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823030">argp</span>&nbsp;<span class="op" id="1823035">+=</span>&nbsp;<span class="ident" id="1823038">ptrSize</span>&nbsp;<span class="comment" id="1823046">//&nbsp;skip&nbsp;caller&#39;s&nbsp;saved&nbsp;link&nbsp;register</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823087">mp</span>&nbsp;<span class="op" id="1823090">:=</span>&nbsp;<span class="ident" id="1823093">acquirem</span><span class="op" id="1823101">(</span><span class="op" id="1823102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823105">mp</span><span class="op" id="1823107">.</span><span class="ident" id="1823108">scalararg</span><span class="op" id="1823117">[</span><span class="num" id="1823118">0</span><span class="op" id="1823119">]</span>&nbsp;<span class="op" id="1823121">=</span>&nbsp;<span class="builtintype" id="1823123">uintptr</span><span class="op" id="1823130">(</span><span class="ident" id="1823131">siz</span><span class="op" id="1823134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823137">mp</span><span class="op" id="1823139">.</span><span class="ident" id="1823140">ptrarg</span><span class="op" id="1823146">[</span><span class="num" id="1823147">0</span><span class="op" id="1823148">]</span>&nbsp;<span class="op" id="1823150">=</span>&nbsp;<span class="ident" id="1823152">unsafe</span><span class="op" id="1823158">.</span><span class="ident" id="1823159">Pointer</span><span class="op" id="1823166">(</span><span class="ident" id="1823167">fn</span><span class="op" id="1823169">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823172">mp</span><span class="op" id="1823174">.</span><span class="ident" id="1823175">scalararg</span><span class="op" id="1823184">[</span><span class="num" id="1823185">1</span><span class="op" id="1823186">]</span>&nbsp;<span class="op" id="1823188">=</span>&nbsp;<span class="ident" id="1823190">argp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823196">mp</span><span class="op" id="1823198">.</span><span class="ident" id="1823199">scalararg</span><span class="op" id="1823208">[</span><span class="num" id="1823209">2</span><span class="op" id="1823210">]</span>&nbsp;<span class="op" id="1823212">=</span>&nbsp;<span class="ident" id="1823214">getcallerpc</span><span class="op" id="1823225">(</span><span class="ident" id="1823226">unsafe</span><span class="op" id="1823232">.</span><span class="ident" id="1823233">Pointer</span><span class="op" id="1823240">(</span><span class="op" id="1823241">&amp;</span><span class="ident" id="1823242">siz</span><span class="op" id="1823245">)</span><span class="op" id="1823246">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1823250">if</span>&nbsp;<span class="ident" id="1823253">mp</span><span class="op" id="1823255">.</span><span class="ident" id="1823256">curg</span>&nbsp;<span class="op" id="1823261">!=</span>&nbsp;<span class="ident" id="1823264">getg</span><span class="op" id="1823268">(</span><span class="op" id="1823269">)</span>&nbsp;<span class="op" id="1823271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823275">//&nbsp;go&nbsp;code&nbsp;on&nbsp;the&nbsp;m&nbsp;stack&nbsp;can&#39;t&nbsp;defer</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823315">gothrow</span><span class="op" id="1823322">(</span><span class="string" id="1823323">&#34;defer&nbsp;on&nbsp;m&#34;</span><span class="op" id="1823335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823342">onM</span><span class="op" id="1823345">(</span><span class="ident" id="1823346">deferproc_m</span><span class="op" id="1823357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823361">releasem</span><span class="op" id="1823369">(</span><span class="ident" id="1823370">mp</span><span class="op" id="1823372">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823376">//&nbsp;deferproc&nbsp;returns&nbsp;0&nbsp;normally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823410">//&nbsp;a&nbsp;deferred&nbsp;func&nbsp;that&nbsp;stops&nbsp;a&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823449">//&nbsp;makes&nbsp;the&nbsp;deferproc&nbsp;return&nbsp;1.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823483">//&nbsp;the&nbsp;code&nbsp;the&nbsp;compiler&nbsp;generates&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823526">//&nbsp;checks&nbsp;the&nbsp;return&nbsp;value&nbsp;and&nbsp;jumps&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823571">//&nbsp;end&nbsp;of&nbsp;the&nbsp;function&nbsp;if&nbsp;deferproc&nbsp;returns&nbsp;!=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823622">return0</span><span class="op" id="1823629">(</span><span class="op" id="1823630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823633">//&nbsp;No&nbsp;code&nbsp;can&nbsp;go&nbsp;here&nbsp;-&nbsp;the&nbsp;C&nbsp;return&nbsp;register&nbsp;has</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823685">//&nbsp;been&nbsp;set&nbsp;and&nbsp;must&nbsp;not&nbsp;be&nbsp;clobbered.</span><br>
<span class="lineno"></span><span class="op" id="1823724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1823727">//&nbsp;Small&nbsp;malloc&nbsp;size&nbsp;classes&nbsp;&gt;=&nbsp;16&nbsp;are&nbsp;the&nbsp;multiples&nbsp;of&nbsp;16:&nbsp;16,&nbsp;32,&nbsp;48,&nbsp;64,&nbsp;80,&nbsp;96,&nbsp;112,&nbsp;128,&nbsp;144,&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1823830">//&nbsp;Each&nbsp;P&nbsp;holds&nbsp;a&nbsp;pool&nbsp;for&nbsp;defers&nbsp;with&nbsp;small&nbsp;arg&nbsp;sizes.</span><br>
<span class="lineno">95</span><span class="comment" id="1823886">//&nbsp;Assign&nbsp;defer&nbsp;allocations&nbsp;to&nbsp;pools&nbsp;by&nbsp;rounding&nbsp;to&nbsp;16,&nbsp;to&nbsp;match&nbsp;malloc&nbsp;size&nbsp;classes.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1823973">const</span>&nbsp;<span class="op" id="1823979">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823982">deferHeaderSize</span>&nbsp;<span class="op" id="1823998">=</span>&nbsp;<span class="ident" id="1824000">unsafe</span><span class="op" id="1824006">.</span><span class="ident" id="1824007">Sizeof</span><span class="op" id="1824013">(</span><span class="ident" id="1824014">_defer</span><span class="op" id="1824020">{</span><span class="op" id="1824021">}</span><span class="op" id="1824022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824025">minDeferAlloc</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1824041">=</span>&nbsp;<span class="op" id="1824043">(</span><span class="ident" id="1824044">deferHeaderSize</span>&nbsp;<span class="op" id="1824060">+</span>&nbsp;<span class="num" id="1824062">15</span><span class="op" id="1824064">)</span>&nbsp;<span class="op" id="1824066">&amp;^</span>&nbsp;<span class="num" id="1824069">15</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824073">minDeferArgs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1824089">=</span>&nbsp;<span class="ident" id="1824091">minDeferAlloc</span>&nbsp;<span class="op" id="1824105">-</span>&nbsp;<span class="ident" id="1824107">deferHeaderSize</span><br>
<span class="lineno"></span><span class="op" id="1824123">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1824126">//&nbsp;defer&nbsp;size&nbsp;class&nbsp;for&nbsp;arg&nbsp;size&nbsp;sz</span><br>
<span class="lineno"></span><span class="comment" id="1824162">//go:nosplit</span><br>
<span class="lineno">105</span><span class="keyword" id="1824175">func</span>&nbsp;<span class="ident" id="1824180">deferclass</span><span class="op" id="1824190">(</span><span class="ident" id="1824191">siz</span>&nbsp;<span class="builtintype" id="1824195">uintptr</span><span class="op" id="1824202">)</span>&nbsp;<span class="builtintype" id="1824204">uintptr</span>&nbsp;<span class="op" id="1824212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824215">if</span>&nbsp;<span class="ident" id="1824218">siz</span>&nbsp;<span class="op" id="1824222">&lt;=</span>&nbsp;<span class="ident" id="1824225">minDeferArgs</span>&nbsp;<span class="op" id="1824238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824242">return</span>&nbsp;<span class="num" id="1824249">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824255">return</span>&nbsp;<span class="op" id="1824262">(</span><span class="ident" id="1824263">siz</span>&nbsp;<span class="op" id="1824267">-</span>&nbsp;<span class="ident" id="1824269">minDeferArgs</span>&nbsp;<span class="op" id="1824282">+</span>&nbsp;<span class="num" id="1824284">15</span><span class="op" id="1824286">)</span>&nbsp;<span class="op" id="1824288">/</span>&nbsp;<span class="num" id="1824290">16</span><br>
<span class="lineno">110</span><span class="op" id="1824293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1824296">//&nbsp;total&nbsp;size&nbsp;of&nbsp;memory&nbsp;block&nbsp;for&nbsp;defer&nbsp;with&nbsp;arg&nbsp;size&nbsp;sz</span><br>
<span class="lineno"></span><span class="keyword" id="1824353">func</span>&nbsp;<span class="ident" id="1824358">totaldefersize</span><span class="op" id="1824372">(</span><span class="ident" id="1824373">siz</span>&nbsp;<span class="builtintype" id="1824377">uintptr</span><span class="op" id="1824384">)</span>&nbsp;<span class="builtintype" id="1824386">uintptr</span>&nbsp;<span class="op" id="1824394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824397">if</span>&nbsp;<span class="ident" id="1824400">siz</span>&nbsp;<span class="op" id="1824404">&lt;=</span>&nbsp;<span class="ident" id="1824407">minDeferArgs</span>&nbsp;<span class="op" id="1824420">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824424">return</span>&nbsp;<span class="ident" id="1824431">minDeferAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824449">return</span>&nbsp;<span class="ident" id="1824456">deferHeaderSize</span>&nbsp;<span class="op" id="1824472">+</span>&nbsp;<span class="ident" id="1824474">siz</span><br>
<span class="lineno"></span><span class="op" id="1824478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="1824481">//&nbsp;Ensure&nbsp;that&nbsp;defer&nbsp;arg&nbsp;sizes&nbsp;that&nbsp;map&nbsp;to&nbsp;the&nbsp;same&nbsp;defer&nbsp;size&nbsp;class</span><br>
<span class="lineno"></span><span class="comment" id="1824550">//&nbsp;also&nbsp;map&nbsp;to&nbsp;the&nbsp;same&nbsp;malloc&nbsp;size&nbsp;class.</span><br>
<span class="lineno"></span><span class="keyword" id="1824593">func</span>&nbsp;<span class="ident" id="1824598">testdefersizes</span><span class="op" id="1824612">(</span><span class="op" id="1824613">)</span>&nbsp;<span class="op" id="1824615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824618">var</span>&nbsp;<span class="ident" id="1824622">m</span>&nbsp;<span class="op" id="1824624">[</span><span class="builtinfunc" id="1824625">len</span><span class="op" id="1824628">(</span><span class="ident" id="1824629">p</span><span class="op" id="1824630">{</span><span class="op" id="1824631">}</span><span class="op" id="1824632">.</span><span class="ident" id="1824633">deferpool</span><span class="op" id="1824642">)</span><span class="op" id="1824643">]</span><span class="builtintype" id="1824644">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824652">for</span>&nbsp;<span class="ident" id="1824656">i</span>&nbsp;<span class="op" id="1824658">:=</span>&nbsp;<span class="keyword" id="1824661">range</span>&nbsp;<span class="ident" id="1824667">m</span>&nbsp;<span class="op" id="1824669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824673">m</span><span class="op" id="1824674">[</span><span class="ident" id="1824675">i</span><span class="op" id="1824676">]</span>&nbsp;<span class="op" id="1824678">=</span>&nbsp;<span class="op" id="1824680">-</span><span class="num" id="1824681">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824687">for</span>&nbsp;<span class="ident" id="1824691">i</span>&nbsp;<span class="op" id="1824693">:=</span>&nbsp;<span class="builtintype" id="1824696">uintptr</span><span class="op" id="1824703">(</span><span class="num" id="1824704">0</span><span class="op" id="1824705">)</span><span class="op" id="1824706">;</span>&nbsp;<span class="op" id="1824708">;</span>&nbsp;<span class="ident" id="1824710">i</span><span class="op" id="1824711">++</span>&nbsp;<span class="op" id="1824714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824718">defersc</span>&nbsp;<span class="op" id="1824726">:=</span>&nbsp;<span class="ident" id="1824729">deferclass</span><span class="op" id="1824739">(</span><span class="ident" id="1824740">i</span><span class="op" id="1824741">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824745">if</span>&nbsp;<span class="ident" id="1824748">defersc</span>&nbsp;<span class="op" id="1824756">&gt;=</span>&nbsp;<span class="builtintype" id="1824759">uintptr</span><span class="op" id="1824766">(</span><span class="builtinfunc" id="1824767">len</span><span class="op" id="1824770">(</span><span class="ident" id="1824771">m</span><span class="op" id="1824772">)</span><span class="op" id="1824773">)</span>&nbsp;<span class="op" id="1824775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824780">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824792">siz</span>&nbsp;<span class="op" id="1824796">:=</span>&nbsp;<span class="ident" id="1824799">goroundupsize</span><span class="op" id="1824812">(</span><span class="ident" id="1824813">totaldefersize</span><span class="op" id="1824827">(</span><span class="ident" id="1824828">i</span><span class="op" id="1824829">)</span><span class="op" id="1824830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824834">if</span>&nbsp;<span class="ident" id="1824837">m</span><span class="op" id="1824838">[</span><span class="ident" id="1824839">defersc</span><span class="op" id="1824846">]</span>&nbsp;<span class="op" id="1824848">&lt;</span>&nbsp;<span class="num" id="1824850">0</span>&nbsp;<span class="op" id="1824852">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824857">m</span><span class="op" id="1824858">[</span><span class="ident" id="1824859">defersc</span><span class="op" id="1824866">]</span>&nbsp;<span class="op" id="1824868">=</span>&nbsp;<span class="builtintype" id="1824870">int32</span><span class="op" id="1824875">(</span><span class="ident" id="1824876">siz</span><span class="op" id="1824879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824884">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824899">if</span>&nbsp;<span class="ident" id="1824902">m</span><span class="op" id="1824903">[</span><span class="ident" id="1824904">defersc</span><span class="op" id="1824911">]</span>&nbsp;<span class="op" id="1824913">!=</span>&nbsp;<span class="builtintype" id="1824916">int32</span><span class="op" id="1824921">(</span><span class="ident" id="1824922">siz</span><span class="op" id="1824925">)</span>&nbsp;<span class="op" id="1824927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1824932">print</span><span class="op" id="1824937">(</span><span class="string" id="1824938">&#34;bad&nbsp;defer&nbsp;size&nbsp;class:&nbsp;i=&#34;</span><span class="op" id="1824964">,</span>&nbsp;<span class="ident" id="1824966">i</span><span class="op" id="1824967">,</span>&nbsp;<span class="string" id="1824969">&#34;&nbsp;siz=&#34;</span><span class="op" id="1824976">,</span>&nbsp;<span class="ident" id="1824978">siz</span><span class="op" id="1824981">,</span>&nbsp;<span class="string" id="1824983">&#34;&nbsp;defersc=&#34;</span><span class="op" id="1824994">,</span>&nbsp;<span class="ident" id="1824996">defersc</span><span class="op" id="1825003">,</span>&nbsp;<span class="string" id="1825005">&#34;\n&#34;</span><span class="op" id="1825009">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825014">gothrow</span><span class="op" id="1825021">(</span><span class="string" id="1825022">&#34;bad&nbsp;defer&nbsp;size&nbsp;class&#34;</span><span class="op" id="1825044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825051">}</span><br>
<span class="lineno"></span><span class="op" id="1825053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="1825056">//&nbsp;The&nbsp;arguments&nbsp;associated&nbsp;with&nbsp;a&nbsp;deferred&nbsp;call&nbsp;are&nbsp;stored</span><br>
<span class="lineno"></span><span class="comment" id="1825116">//&nbsp;immediately&nbsp;after&nbsp;the&nbsp;_defer&nbsp;header&nbsp;in&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1825166">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1825179">func</span>&nbsp;<span class="ident" id="1825184">deferArgs</span><span class="op" id="1825193">(</span><span class="ident" id="1825194">d</span>&nbsp;<span class="op" id="1825196">*</span><span class="ident" id="1825197">_defer</span><span class="op" id="1825203">)</span>&nbsp;<span class="ident" id="1825205">unsafe</span><span class="op" id="1825211">.</span><span class="ident" id="1825212">Pointer</span>&nbsp;<span class="op" id="1825220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825223">return</span>&nbsp;<span class="ident" id="1825230">add</span><span class="op" id="1825233">(</span><span class="ident" id="1825234">unsafe</span><span class="op" id="1825240">.</span><span class="ident" id="1825241">Pointer</span><span class="op" id="1825248">(</span><span class="ident" id="1825249">d</span><span class="op" id="1825250">)</span><span class="op" id="1825251">,</span>&nbsp;<span class="ident" id="1825253">unsafe</span><span class="op" id="1825259">.</span><span class="ident" id="1825260">Sizeof</span><span class="op" id="1825266">(</span><span class="op" id="1825267">*</span><span class="ident" id="1825268">d</span><span class="op" id="1825269">)</span><span class="op" id="1825270">)</span><br>
<span class="lineno">150</span><span class="op" id="1825272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1825275">var</span>&nbsp;<span class="ident" id="1825279">deferType</span>&nbsp;<span class="op" id="1825289">*</span><span class="ident" id="1825290">_type</span>&nbsp;<span class="comment" id="1825296">//&nbsp;type&nbsp;of&nbsp;_defer&nbsp;struct</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1825322">func</span>&nbsp;<span class="ident" id="1825327">init</span><span class="op" id="1825331">(</span><span class="op" id="1825332">)</span>&nbsp;<span class="op" id="1825334">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825337">var</span>&nbsp;<span class="ident" id="1825341">x</span>&nbsp;<span class="keyword" id="1825343">interface</span><span class="op" id="1825352">{</span><span class="op" id="1825353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825356">x</span>&nbsp;<span class="op" id="1825358">=</span>&nbsp;<span class="op" id="1825360">(</span><span class="op" id="1825361">*</span><span class="ident" id="1825362">_defer</span><span class="op" id="1825368">)</span><span class="op" id="1825369">(</span><span class="ident" id="1825370">nil</span><span class="op" id="1825373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825376">deferType</span>&nbsp;<span class="op" id="1825386">=</span>&nbsp;<span class="op" id="1825388">(</span><span class="op" id="1825389">*</span><span class="op" id="1825390">(</span><span class="op" id="1825391">*</span><span class="op" id="1825392">*</span><span class="ident" id="1825393">ptrtype</span><span class="op" id="1825400">)</span><span class="op" id="1825401">(</span><span class="ident" id="1825402">unsafe</span><span class="op" id="1825408">.</span><span class="ident" id="1825409">Pointer</span><span class="op" id="1825416">(</span><span class="op" id="1825417">&amp;</span><span class="ident" id="1825418">x</span><span class="op" id="1825419">)</span><span class="op" id="1825420">)</span><span class="op" id="1825421">)</span><span class="op" id="1825422">.</span><span class="ident" id="1825423">elem</span><br>
<span class="lineno"></span><span class="op" id="1825428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="1825431">//&nbsp;Allocate&nbsp;a&nbsp;Defer,&nbsp;usually&nbsp;using&nbsp;per-P&nbsp;pool.</span><br>
<span class="lineno"></span><span class="comment" id="1825478">//&nbsp;Each&nbsp;defer&nbsp;must&nbsp;be&nbsp;released&nbsp;with&nbsp;freedefer.</span><br>
<span class="lineno"></span><span class="comment" id="1825525">//&nbsp;Note:&nbsp;runs&nbsp;on&nbsp;M&nbsp;stack</span><br>
<span class="lineno"></span><span class="keyword" id="1825550">func</span>&nbsp;<span class="ident" id="1825555">newdefer</span><span class="op" id="1825563">(</span><span class="ident" id="1825564">siz</span>&nbsp;<span class="builtintype" id="1825568">int32</span><span class="op" id="1825573">)</span>&nbsp;<span class="op" id="1825575">*</span><span class="ident" id="1825576">_defer</span>&nbsp;<span class="op" id="1825583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825586">var</span>&nbsp;<span class="ident" id="1825590">d</span>&nbsp;<span class="op" id="1825592">*</span><span class="ident" id="1825593">_defer</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825601">sc</span>&nbsp;<span class="op" id="1825604">:=</span>&nbsp;<span class="ident" id="1825607">deferclass</span><span class="op" id="1825617">(</span><span class="builtintype" id="1825618">uintptr</span><span class="op" id="1825625">(</span><span class="ident" id="1825626">siz</span><span class="op" id="1825629">)</span><span class="op" id="1825630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825633">mp</span>&nbsp;<span class="op" id="1825636">:=</span>&nbsp;<span class="ident" id="1825639">acquirem</span><span class="op" id="1825647">(</span><span class="op" id="1825648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825651">if</span>&nbsp;<span class="ident" id="1825654">sc</span>&nbsp;<span class="op" id="1825657">&lt;</span>&nbsp;<span class="builtintype" id="1825659">uintptr</span><span class="op" id="1825666">(</span><span class="builtinfunc" id="1825667">len</span><span class="op" id="1825670">(</span><span class="ident" id="1825671">p</span><span class="op" id="1825672">{</span><span class="op" id="1825673">}</span><span class="op" id="1825674">.</span><span class="ident" id="1825675">deferpool</span><span class="op" id="1825684">)</span><span class="op" id="1825685">)</span>&nbsp;<span class="op" id="1825687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825691">pp</span>&nbsp;<span class="op" id="1825694">:=</span>&nbsp;<span class="ident" id="1825697">mp</span><span class="op" id="1825699">.</span><span class="ident" id="1825700">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825704">d</span>&nbsp;<span class="op" id="1825706">=</span>&nbsp;<span class="ident" id="1825708">pp</span><span class="op" id="1825710">.</span><span class="ident" id="1825711">deferpool</span><span class="op" id="1825720">[</span><span class="ident" id="1825721">sc</span><span class="op" id="1825723">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825727">if</span>&nbsp;<span class="ident" id="1825730">d</span>&nbsp;<span class="op" id="1825732">!=</span>&nbsp;<span class="ident" id="1825735">nil</span>&nbsp;<span class="op" id="1825739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825744">pp</span><span class="op" id="1825746">.</span><span class="ident" id="1825747">deferpool</span><span class="op" id="1825756">[</span><span class="ident" id="1825757">sc</span><span class="op" id="1825759">]</span>&nbsp;<span class="op" id="1825761">=</span>&nbsp;<span class="ident" id="1825763">d</span><span class="op" id="1825764">.</span><span class="ident" id="1825765">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825778">if</span>&nbsp;<span class="ident" id="1825781">d</span>&nbsp;<span class="op" id="1825783">==</span>&nbsp;<span class="ident" id="1825786">nil</span>&nbsp;<span class="op" id="1825790">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1825794">//&nbsp;Allocate&nbsp;new&nbsp;defer+args.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825824">total</span>&nbsp;<span class="op" id="1825830">:=</span>&nbsp;<span class="ident" id="1825833">goroundupsize</span><span class="op" id="1825846">(</span><span class="ident" id="1825847">totaldefersize</span><span class="op" id="1825861">(</span><span class="builtintype" id="1825862">uintptr</span><span class="op" id="1825869">(</span><span class="ident" id="1825870">siz</span><span class="op" id="1825873">)</span><span class="op" id="1825874">)</span><span class="op" id="1825875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825879">d</span>&nbsp;<span class="op" id="1825881">=</span>&nbsp;<span class="op" id="1825883">(</span><span class="op" id="1825884">*</span><span class="ident" id="1825885">_defer</span><span class="op" id="1825891">)</span><span class="op" id="1825892">(</span><span class="ident" id="1825893">mallocgc</span><span class="op" id="1825901">(</span><span class="ident" id="1825902">total</span><span class="op" id="1825907">,</span>&nbsp;<span class="ident" id="1825909">deferType</span><span class="op" id="1825918">,</span>&nbsp;<span class="num" id="1825920">0</span><span class="op" id="1825921">)</span><span class="op" id="1825922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825928">d</span><span class="op" id="1825929">.</span><span class="ident" id="1825930">siz</span>&nbsp;<span class="op" id="1825934">=</span>&nbsp;<span class="ident" id="1825936">siz</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825941">gp</span>&nbsp;<span class="op" id="1825944">:=</span>&nbsp;<span class="ident" id="1825947">mp</span><span class="op" id="1825949">.</span><span class="ident" id="1825950">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825956">d</span><span class="op" id="1825957">.</span><span class="ident" id="1825958">link</span>&nbsp;<span class="op" id="1825963">=</span>&nbsp;<span class="ident" id="1825965">gp</span><span class="op" id="1825967">.</span><span class="ident" id="1825968">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825976">gp</span><span class="op" id="1825978">.</span><span class="ident" id="1825979">_defer</span>&nbsp;<span class="op" id="1825986">=</span>&nbsp;<span class="ident" id="1825988">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825991">releasem</span><span class="op" id="1825999">(</span><span class="ident" id="1826000">mp</span><span class="op" id="1826002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1826005">return</span>&nbsp;<span class="ident" id="1826012">d</span><br>
<span class="lineno">185</span><span class="op" id="1826014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1826017">//&nbsp;Free&nbsp;the&nbsp;given&nbsp;defer.</span><br>
<span class="lineno"></span><span class="comment" id="1826042">//&nbsp;The&nbsp;defer&nbsp;cannot&nbsp;be&nbsp;used&nbsp;after&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="1826087">//go:nosplit</span><br>
<span class="lineno">190</span><span class="keyword" id="1826100">func</span>&nbsp;<span class="ident" id="1826105">freedefer</span><span class="op" id="1826114">(</span><span class="ident" id="1826115">d</span>&nbsp;<span class="op" id="1826117">*</span><span class="ident" id="1826118">_defer</span><span class="op" id="1826124">)</span>&nbsp;<span class="op" id="1826126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1826129">if</span>&nbsp;<span class="ident" id="1826132">d</span><span class="op" id="1826133">.</span><span class="ident" id="1826134">_panic</span>&nbsp;<span class="op" id="1826141">!=</span>&nbsp;<span class="ident" id="1826144">nil</span>&nbsp;<span class="op" id="1826148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826152">freedeferpanic</span><span class="op" id="1826166">(</span><span class="op" id="1826167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1826170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1826173">if</span>&nbsp;<span class="ident" id="1826176">d</span><span class="op" id="1826177">.</span><span class="ident" id="1826178">fn</span>&nbsp;<span class="op" id="1826181">!=</span>&nbsp;<span class="ident" id="1826184">nil</span>&nbsp;<span class="op" id="1826188">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826192">freedeferfn</span><span class="op" id="1826203">(</span><span class="op" id="1826204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1826207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826210">sc</span>&nbsp;<span class="op" id="1826213">:=</span>&nbsp;<span class="ident" id="1826216">deferclass</span><span class="op" id="1826226">(</span><span class="builtintype" id="1826227">uintptr</span><span class="op" id="1826234">(</span><span class="ident" id="1826235">d</span><span class="op" id="1826236">.</span><span class="ident" id="1826237">siz</span><span class="op" id="1826240">)</span><span class="op" id="1826241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1826244">if</span>&nbsp;<span class="ident" id="1826247">sc</span>&nbsp;<span class="op" id="1826250">&lt;</span>&nbsp;<span class="builtintype" id="1826252">uintptr</span><span class="op" id="1826259">(</span><span class="builtinfunc" id="1826260">len</span><span class="op" id="1826263">(</span><span class="ident" id="1826264">p</span><span class="op" id="1826265">{</span><span class="op" id="1826266">}</span><span class="op" id="1826267">.</span><span class="ident" id="1826268">deferpool</span><span class="op" id="1826277">)</span><span class="op" id="1826278">)</span>&nbsp;<span class="op" id="1826280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826284">mp</span>&nbsp;<span class="op" id="1826287">:=</span>&nbsp;<span class="ident" id="1826290">acquirem</span><span class="op" id="1826298">(</span><span class="op" id="1826299">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826303">pp</span>&nbsp;<span class="op" id="1826306">:=</span>&nbsp;<span class="ident" id="1826309">mp</span><span class="op" id="1826311">.</span><span class="ident" id="1826312">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1826316">*</span><span class="ident" id="1826317">d</span>&nbsp;<span class="op" id="1826319">=</span>&nbsp;<span class="ident" id="1826321">_defer</span><span class="op" id="1826327">{</span><span class="op" id="1826328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826332">d</span><span class="op" id="1826333">.</span><span class="ident" id="1826334">link</span>&nbsp;<span class="op" id="1826339">=</span>&nbsp;<span class="ident" id="1826341">pp</span><span class="op" id="1826343">.</span><span class="ident" id="1826344">deferpool</span><span class="op" id="1826353">[</span><span class="ident" id="1826354">sc</span><span class="op" id="1826356">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826360">pp</span><span class="op" id="1826362">.</span><span class="ident" id="1826363">deferpool</span><span class="op" id="1826372">[</span><span class="ident" id="1826373">sc</span><span class="op" id="1826375">]</span>&nbsp;<span class="op" id="1826377">=</span>&nbsp;<span class="ident" id="1826379">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826383">releasem</span><span class="op" id="1826391">(</span><span class="ident" id="1826392">mp</span><span class="op" id="1826394">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1826397">}</span><br>
<span class="lineno"></span><span class="op" id="1826399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1826402">//&nbsp;Separate&nbsp;function&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;split&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1826451">//&nbsp;Windows&nbsp;otherwise&nbsp;runs&nbsp;out&nbsp;of&nbsp;stack&nbsp;space.</span><br>
<span class="lineno">210</span><span class="keyword" id="1826497">func</span>&nbsp;<span class="ident" id="1826502">freedeferpanic</span><span class="op" id="1826516">(</span><span class="op" id="1826517">)</span>&nbsp;<span class="op" id="1826519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1826522">//&nbsp;_panic&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;d&nbsp;is&nbsp;unlinked&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826579">gothrow</span><span class="op" id="1826586">(</span><span class="string" id="1826587">&#34;freedefer&nbsp;with&nbsp;d._panic&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="1826619">)</span><br>
<span class="lineno"></span><span class="op" id="1826621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1826624">func</span>&nbsp;<span class="ident" id="1826629">freedeferfn</span><span class="op" id="1826640">(</span><span class="op" id="1826641">)</span>&nbsp;<span class="op" id="1826643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1826646">//&nbsp;fn&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;d&nbsp;is&nbsp;unlinked&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826699">gothrow</span><span class="op" id="1826706">(</span><span class="string" id="1826707">&#34;freedefer&nbsp;with&nbsp;d.fn&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="1826735">)</span><br>
<span class="lineno"></span><span class="op" id="1826737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="1826740">//&nbsp;Run&nbsp;a&nbsp;deferred&nbsp;function&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span><span class="comment" id="1826784">//&nbsp;The&nbsp;compiler&nbsp;inserts&nbsp;a&nbsp;call&nbsp;to&nbsp;this&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="1826841">//&nbsp;function&nbsp;which&nbsp;calls&nbsp;defer.</span><br>
<span class="lineno"></span><span class="comment" id="1826872">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;deferred&nbsp;function,&nbsp;this&nbsp;will&nbsp;call&nbsp;runtimejmpdefer,</span><br>
<span class="lineno"></span><span class="comment" id="1826942">//&nbsp;which&nbsp;will&nbsp;jump&nbsp;to&nbsp;the&nbsp;deferred&nbsp;function&nbsp;such&nbsp;that&nbsp;it&nbsp;appears</span><br>
<span class="lineno">225</span><span class="comment" id="1827007">//&nbsp;to&nbsp;have&nbsp;been&nbsp;called&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;deferreturn&nbsp;at&nbsp;the&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="1827072">//&nbsp;just&nbsp;before&nbsp;deferreturn&nbsp;was&nbsp;called.&nbsp;&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;deferreturn</span><br>
<span class="lineno"></span><span class="comment" id="1827143">//&nbsp;is&nbsp;called&nbsp;again&nbsp;and&nbsp;again&nbsp;until&nbsp;there&nbsp;are&nbsp;no&nbsp;more&nbsp;deferred&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="1827216">//&nbsp;Cannot&nbsp;split&nbsp;the&nbsp;stack&nbsp;because&nbsp;we&nbsp;reuse&nbsp;the&nbsp;caller&#39;s&nbsp;frame&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1827281">//&nbsp;call&nbsp;the&nbsp;deferred&nbsp;function.</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="1827313">//&nbsp;The&nbsp;single&nbsp;argument&nbsp;isn&#39;t&nbsp;actually&nbsp;used&nbsp;-&nbsp;it&nbsp;just&nbsp;has&nbsp;its&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="1827382">//&nbsp;taken&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;matched&nbsp;against&nbsp;pending&nbsp;defers.</span><br>
<span class="lineno"></span><span class="comment" id="1827436">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1827449">func</span>&nbsp;<span class="ident" id="1827454">deferreturn</span><span class="op" id="1827465">(</span><span class="ident" id="1827466">arg0</span>&nbsp;<span class="builtintype" id="1827471">uintptr</span><span class="op" id="1827478">)</span>&nbsp;<span class="op" id="1827480">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827483">gp</span>&nbsp;<span class="op" id="1827486">:=</span>&nbsp;<span class="ident" id="1827489">getg</span><span class="op" id="1827493">(</span><span class="op" id="1827494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827497">d</span>&nbsp;<span class="op" id="1827499">:=</span>&nbsp;<span class="ident" id="1827502">gp</span><span class="op" id="1827504">.</span><span class="ident" id="1827505">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827513">if</span>&nbsp;<span class="ident" id="1827516">d</span>&nbsp;<span class="op" id="1827518">==</span>&nbsp;<span class="ident" id="1827521">nil</span>&nbsp;<span class="op" id="1827525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827529">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827537">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827540">argp</span>&nbsp;<span class="op" id="1827545">:=</span>&nbsp;<span class="builtintype" id="1827548">uintptr</span><span class="op" id="1827555">(</span><span class="ident" id="1827556">unsafe</span><span class="op" id="1827562">.</span><span class="ident" id="1827563">Pointer</span><span class="op" id="1827570">(</span><span class="op" id="1827571">&amp;</span><span class="ident" id="1827572">arg0</span><span class="op" id="1827576">)</span><span class="op" id="1827577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827580">if</span>&nbsp;<span class="ident" id="1827583">d</span><span class="op" id="1827584">.</span><span class="ident" id="1827585">argp</span>&nbsp;<span class="op" id="1827590">!=</span>&nbsp;<span class="ident" id="1827593">argp</span>&nbsp;<span class="op" id="1827598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827602">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827614">//&nbsp;Moving&nbsp;arguments&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827643">//&nbsp;Do&nbsp;not&nbsp;allow&nbsp;preemption&nbsp;here,&nbsp;because&nbsp;the&nbsp;garbage&nbsp;collector</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827707">//&nbsp;won&#39;t&nbsp;know&nbsp;the&nbsp;form&nbsp;of&nbsp;the&nbsp;arguments&nbsp;until&nbsp;the&nbsp;jmpdefer&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827771">//&nbsp;flip&nbsp;the&nbsp;PC&nbsp;over&nbsp;to&nbsp;fn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827799">mp</span>&nbsp;<span class="op" id="1827802">:=</span>&nbsp;<span class="ident" id="1827805">acquirem</span><span class="op" id="1827813">(</span><span class="op" id="1827814">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827817">memmove</span><span class="op" id="1827824">(</span><span class="ident" id="1827825">unsafe</span><span class="op" id="1827831">.</span><span class="ident" id="1827832">Pointer</span><span class="op" id="1827839">(</span><span class="ident" id="1827840">argp</span><span class="op" id="1827844">)</span><span class="op" id="1827845">,</span>&nbsp;<span class="ident" id="1827847">deferArgs</span><span class="op" id="1827856">(</span><span class="ident" id="1827857">d</span><span class="op" id="1827858">)</span><span class="op" id="1827859">,</span>&nbsp;<span class="builtintype" id="1827861">uintptr</span><span class="op" id="1827868">(</span><span class="ident" id="1827869">d</span><span class="op" id="1827870">.</span><span class="ident" id="1827871">siz</span><span class="op" id="1827874">)</span><span class="op" id="1827875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827878">fn</span>&nbsp;<span class="op" id="1827881">:=</span>&nbsp;<span class="ident" id="1827884">d</span><span class="op" id="1827885">.</span><span class="ident" id="1827886">fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827890">d</span><span class="op" id="1827891">.</span><span class="ident" id="1827892">fn</span>&nbsp;<span class="op" id="1827895">=</span>&nbsp;<span class="ident" id="1827897">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827902">gp</span><span class="op" id="1827904">.</span><span class="ident" id="1827905">_defer</span>&nbsp;<span class="op" id="1827912">=</span>&nbsp;<span class="ident" id="1827914">d</span><span class="op" id="1827915">.</span><span class="ident" id="1827916">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827922">freedefer</span><span class="op" id="1827931">(</span><span class="ident" id="1827932">d</span><span class="op" id="1827933">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827936">releasem</span><span class="op" id="1827944">(</span><span class="ident" id="1827945">mp</span><span class="op" id="1827947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827950">jmpdefer</span><span class="op" id="1827958">(</span><span class="ident" id="1827959">fn</span><span class="op" id="1827961">,</span>&nbsp;<span class="ident" id="1827963">argp</span><span class="op" id="1827967">)</span><br>
<span class="lineno"></span><span class="op" id="1827969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1827972">//&nbsp;Goexit&nbsp;terminates&nbsp;the&nbsp;goroutine&nbsp;that&nbsp;calls&nbsp;it.&nbsp;&nbsp;No&nbsp;other&nbsp;goroutine&nbsp;is&nbsp;affected.</span><br>
<span class="lineno">260</span><span class="comment" id="1828055">//&nbsp;Goexit&nbsp;runs&nbsp;all&nbsp;deferred&nbsp;calls&nbsp;before&nbsp;terminating&nbsp;the&nbsp;goroutine.&nbsp;&nbsp;Because&nbsp;Goexit</span><br>
<span class="lineno"></span><span class="comment" id="1828139">//&nbsp;is&nbsp;not&nbsp;panic,&nbsp;however,&nbsp;any&nbsp;recover&nbsp;calls&nbsp;in&nbsp;those&nbsp;deferred&nbsp;functions&nbsp;will&nbsp;return&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1828228">//</span><br>
<span class="lineno"></span><span class="comment" id="1828231">//&nbsp;Calling&nbsp;Goexit&nbsp;from&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;terminates&nbsp;that&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1828299">//&nbsp;without&nbsp;func&nbsp;main&nbsp;returning.&nbsp;Since&nbsp;func&nbsp;main&nbsp;has&nbsp;not&nbsp;returned,</span><br>
<span class="lineno">265</span><span class="comment" id="1828365">//&nbsp;the&nbsp;program&nbsp;continues&nbsp;execution&nbsp;of&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="1828421">//&nbsp;If&nbsp;all&nbsp;other&nbsp;goroutines&nbsp;exit,&nbsp;the&nbsp;program&nbsp;crashes.</span><br>
<span class="lineno"></span><span class="keyword" id="1828475">func</span>&nbsp;<span class="ident" id="1828480">Goexit</span><span class="op" id="1828486">(</span><span class="op" id="1828487">)</span>&nbsp;<span class="op" id="1828489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828492">//&nbsp;Run&nbsp;all&nbsp;deferred&nbsp;functions&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828550">//&nbsp;This&nbsp;code&nbsp;is&nbsp;similar&nbsp;to&nbsp;gopanic,&nbsp;see&nbsp;that&nbsp;implementation</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828611">//&nbsp;for&nbsp;detailed&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828638">gp</span>&nbsp;<span class="op" id="1828641">:=</span>&nbsp;<span class="ident" id="1828644">getg</span><span class="op" id="1828648">(</span><span class="op" id="1828649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828652">for</span>&nbsp;<span class="op" id="1828656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828660">d</span>&nbsp;<span class="op" id="1828662">:=</span>&nbsp;<span class="ident" id="1828665">gp</span><span class="op" id="1828667">.</span><span class="ident" id="1828668">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828677">if</span>&nbsp;<span class="ident" id="1828680">d</span>&nbsp;<span class="op" id="1828682">==</span>&nbsp;<span class="ident" id="1828685">nil</span>&nbsp;<span class="op" id="1828689">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828694">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828706">if</span>&nbsp;<span class="ident" id="1828709">d</span><span class="op" id="1828710">.</span><span class="ident" id="1828711">started</span>&nbsp;<span class="op" id="1828719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828724">if</span>&nbsp;<span class="ident" id="1828727">d</span><span class="op" id="1828728">.</span><span class="ident" id="1828729">_panic</span>&nbsp;<span class="op" id="1828736">!=</span>&nbsp;<span class="ident" id="1828739">nil</span>&nbsp;<span class="op" id="1828743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828749">d</span><span class="op" id="1828750">.</span><span class="ident" id="1828751">_panic</span><span class="op" id="1828757">.</span><span class="ident" id="1828758">aborted</span>&nbsp;<span class="op" id="1828766">=</span>&nbsp;<span class="builtintype" id="1828768">true</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828777">d</span><span class="op" id="1828778">.</span><span class="ident" id="1828779">_panic</span>&nbsp;<span class="op" id="1828786">=</span>&nbsp;<span class="ident" id="1828788">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828800">d</span><span class="op" id="1828801">.</span><span class="ident" id="1828802">fn</span>&nbsp;<span class="op" id="1828805">=</span>&nbsp;<span class="ident" id="1828807">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828814">gp</span><span class="op" id="1828816">.</span><span class="ident" id="1828817">_defer</span>&nbsp;<span class="op" id="1828824">=</span>&nbsp;<span class="ident" id="1828826">d</span><span class="op" id="1828827">.</span><span class="ident" id="1828828">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828836">freedefer</span><span class="op" id="1828845">(</span><span class="ident" id="1828846">d</span><span class="op" id="1828847">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828852">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828867">d</span><span class="op" id="1828868">.</span><span class="ident" id="1828869">started</span>&nbsp;<span class="op" id="1828877">=</span>&nbsp;<span class="builtintype" id="1828879">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828886">reflectcall</span><span class="op" id="1828897">(</span><span class="ident" id="1828898">unsafe</span><span class="op" id="1828904">.</span><span class="ident" id="1828905">Pointer</span><span class="op" id="1828912">(</span><span class="ident" id="1828913">d</span><span class="op" id="1828914">.</span><span class="ident" id="1828915">fn</span><span class="op" id="1828917">)</span><span class="op" id="1828918">,</span>&nbsp;<span class="ident" id="1828920">deferArgs</span><span class="op" id="1828929">(</span><span class="ident" id="1828930">d</span><span class="op" id="1828931">)</span><span class="op" id="1828932">,</span>&nbsp;<span class="builtintype" id="1828934">uint32</span><span class="op" id="1828940">(</span><span class="ident" id="1828941">d</span><span class="op" id="1828942">.</span><span class="ident" id="1828943">siz</span><span class="op" id="1828946">)</span><span class="op" id="1828947">,</span>&nbsp;<span class="builtintype" id="1828949">uint32</span><span class="op" id="1828955">(</span><span class="ident" id="1828956">d</span><span class="op" id="1828957">.</span><span class="ident" id="1828958">siz</span><span class="op" id="1828961">)</span><span class="op" id="1828962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828966">if</span>&nbsp;<span class="ident" id="1828969">gp</span><span class="op" id="1828971">.</span><span class="ident" id="1828972">_defer</span>&nbsp;<span class="op" id="1828979">!=</span>&nbsp;<span class="ident" id="1828982">d</span>&nbsp;<span class="op" id="1828984">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828989">gothrow</span><span class="op" id="1828996">(</span><span class="string" id="1828997">&#34;bad&nbsp;defer&nbsp;entry&nbsp;in&nbsp;Goexit&#34;</span><span class="op" id="1829024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1829028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829032">d</span><span class="op" id="1829033">.</span><span class="ident" id="1829034">_panic</span>&nbsp;<span class="op" id="1829041">=</span>&nbsp;<span class="ident" id="1829043">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829049">d</span><span class="op" id="1829050">.</span><span class="ident" id="1829051">fn</span>&nbsp;<span class="op" id="1829054">=</span>&nbsp;<span class="ident" id="1829056">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829062">gp</span><span class="op" id="1829064">.</span><span class="ident" id="1829065">_defer</span>&nbsp;<span class="op" id="1829072">=</span>&nbsp;<span class="ident" id="1829074">d</span><span class="op" id="1829075">.</span><span class="ident" id="1829076">link</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829083">freedefer</span><span class="op" id="1829092">(</span><span class="ident" id="1829093">d</span><span class="op" id="1829094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829098">//&nbsp;Note:&nbsp;we&nbsp;ignore&nbsp;recovers&nbsp;here&nbsp;because&nbsp;Goexit&nbsp;isn&#39;t&nbsp;a&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1829161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829164">goexit</span><span class="op" id="1829170">(</span><span class="op" id="1829171">)</span><br>
<span class="lineno"></span><span class="op" id="1829173">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="keyword" id="1829176">func</span>&nbsp;<span class="ident" id="1829181">canpanic</span><span class="op" id="1829189">(</span><span class="op" id="1829190">*</span><span class="ident" id="1829191">g</span><span class="op" id="1829192">)</span>&nbsp;<span class="builtintype" id="1829194">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1829200">//&nbsp;Print&nbsp;all&nbsp;currently&nbsp;active&nbsp;panics.&nbsp;&nbsp;Used&nbsp;when&nbsp;crashing.</span><br>
<span class="lineno"></span><span class="keyword" id="1829259">func</span>&nbsp;<span class="ident" id="1829264">printpanics</span><span class="op" id="1829275">(</span><span class="ident" id="1829276">p</span>&nbsp;<span class="op" id="1829278">*</span><span class="ident" id="1829279">_panic</span><span class="op" id="1829285">)</span>&nbsp;<span class="op" id="1829287">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829290">if</span>&nbsp;<span class="ident" id="1829293">p</span><span class="op" id="1829294">.</span><span class="ident" id="1829295">link</span>&nbsp;<span class="op" id="1829300">!=</span>&nbsp;<span class="ident" id="1829303">nil</span>&nbsp;<span class="op" id="1829307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829311">printpanics</span><span class="op" id="1829322">(</span><span class="ident" id="1829323">p</span><span class="op" id="1829324">.</span><span class="ident" id="1829325">link</span><span class="op" id="1829329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1829333">print</span><span class="op" id="1829338">(</span><span class="string" id="1829339">&#34;\t&#34;</span><span class="op" id="1829343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1829346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1829349">print</span><span class="op" id="1829354">(</span><span class="string" id="1829355">&#34;panic:&nbsp;&#34;</span><span class="op" id="1829364">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829367">printany</span><span class="op" id="1829375">(</span><span class="ident" id="1829376">p</span><span class="op" id="1829377">.</span><span class="ident" id="1829378">arg</span><span class="op" id="1829381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829384">if</span>&nbsp;<span class="ident" id="1829387">p</span><span class="op" id="1829388">.</span><span class="ident" id="1829389">recovered</span>&nbsp;<span class="op" id="1829399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1829403">print</span><span class="op" id="1829408">(</span><span class="string" id="1829409">&#34;&nbsp;[recovered]&#34;</span><span class="op" id="1829423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1829426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1829429">print</span><span class="op" id="1829434">(</span><span class="string" id="1829435">&#34;\n&#34;</span><span class="op" id="1829439">)</span><br>
<span class="lineno">315</span><span class="op" id="1829441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1829444">//&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;predeclared&nbsp;function&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="1829501">func</span>&nbsp;<span class="ident" id="1829506">gopanic</span><span class="op" id="1829513">(</span><span class="ident" id="1829514">e</span>&nbsp;<span class="keyword" id="1829516">interface</span><span class="op" id="1829525">{</span><span class="op" id="1829526">}</span><span class="op" id="1829527">)</span>&nbsp;<span class="op" id="1829529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829532">gp</span>&nbsp;<span class="op" id="1829535">:=</span>&nbsp;<span class="ident" id="1829538">getg</span><span class="op" id="1829542">(</span><span class="op" id="1829543">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829546">if</span>&nbsp;<span class="ident" id="1829549">gp</span><span class="op" id="1829551">.</span><span class="ident" id="1829552">m</span><span class="op" id="1829553">.</span><span class="ident" id="1829554">curg</span>&nbsp;<span class="op" id="1829559">!=</span>&nbsp;<span class="ident" id="1829562">gp</span>&nbsp;<span class="op" id="1829565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829569">gothrow</span><span class="op" id="1829576">(</span><span class="string" id="1829577">&#34;panic&nbsp;on&nbsp;m&nbsp;stack&#34;</span><span class="op" id="1829595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1829598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829602">//&nbsp;m.softfloat&nbsp;is&nbsp;set&nbsp;during&nbsp;software&nbsp;floating&nbsp;point.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829657">//&nbsp;It&nbsp;increments&nbsp;m.locks&nbsp;to&nbsp;avoid&nbsp;preemption.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829704">//&nbsp;We&nbsp;moved&nbsp;the&nbsp;memory&nbsp;loads&nbsp;out,&nbsp;so&nbsp;there&nbsp;shouldn&#39;t&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829761">//&nbsp;any&nbsp;reason&nbsp;for&nbsp;it&nbsp;to&nbsp;panic&nbsp;anymore.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829801">if</span>&nbsp;<span class="ident" id="1829804">gp</span><span class="op" id="1829806">.</span><span class="ident" id="1829807">m</span><span class="op" id="1829808">.</span><span class="ident" id="1829809">softfloat</span>&nbsp;<span class="op" id="1829819">!=</span>&nbsp;<span class="num" id="1829822">0</span>&nbsp;<span class="op" id="1829824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829828">gp</span><span class="op" id="1829830">.</span><span class="ident" id="1829831">m</span><span class="op" id="1829832">.</span><span class="ident" id="1829833">locks</span><span class="op" id="1829838">--</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829843">gp</span><span class="op" id="1829845">.</span><span class="ident" id="1829846">m</span><span class="op" id="1829847">.</span><span class="ident" id="1829848">softfloat</span>&nbsp;<span class="op" id="1829858">=</span>&nbsp;<span class="num" id="1829860">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829864">gothrow</span><span class="op" id="1829871">(</span><span class="string" id="1829872">&#34;panic&nbsp;during&nbsp;softfloat&#34;</span><span class="op" id="1829896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1829899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829902">if</span>&nbsp;<span class="ident" id="1829905">gp</span><span class="op" id="1829907">.</span><span class="ident" id="1829908">m</span><span class="op" id="1829909">.</span><span class="ident" id="1829910">mallocing</span>&nbsp;<span class="op" id="1829920">!=</span>&nbsp;<span class="num" id="1829923">0</span>&nbsp;<span class="op" id="1829925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1829929">print</span><span class="op" id="1829934">(</span><span class="string" id="1829935">&#34;panic:&nbsp;&#34;</span><span class="op" id="1829944">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829948">printany</span><span class="op" id="1829956">(</span><span class="ident" id="1829957">e</span><span class="op" id="1829958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1829962">print</span><span class="op" id="1829967">(</span><span class="string" id="1829968">&#34;\n&#34;</span><span class="op" id="1829972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829976">gothrow</span><span class="op" id="1829983">(</span><span class="string" id="1829984">&#34;panic&nbsp;during&nbsp;malloc&#34;</span><span class="op" id="1830005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830011">if</span>&nbsp;<span class="ident" id="1830014">gp</span><span class="op" id="1830016">.</span><span class="ident" id="1830017">m</span><span class="op" id="1830018">.</span><span class="ident" id="1830019">gcing</span>&nbsp;<span class="op" id="1830025">!=</span>&nbsp;<span class="num" id="1830028">0</span>&nbsp;<span class="op" id="1830030">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1830034">print</span><span class="op" id="1830039">(</span><span class="string" id="1830040">&#34;panic:&nbsp;&#34;</span><span class="op" id="1830049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830053">printany</span><span class="op" id="1830061">(</span><span class="ident" id="1830062">e</span><span class="op" id="1830063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1830067">print</span><span class="op" id="1830072">(</span><span class="string" id="1830073">&#34;\n&#34;</span><span class="op" id="1830077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830081">gothrow</span><span class="op" id="1830088">(</span><span class="string" id="1830089">&#34;panic&nbsp;during&nbsp;gc&#34;</span><span class="op" id="1830106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830109">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830112">if</span>&nbsp;<span class="ident" id="1830115">gp</span><span class="op" id="1830117">.</span><span class="ident" id="1830118">m</span><span class="op" id="1830119">.</span><span class="ident" id="1830120">locks</span>&nbsp;<span class="op" id="1830126">!=</span>&nbsp;<span class="num" id="1830129">0</span>&nbsp;<span class="op" id="1830131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1830135">print</span><span class="op" id="1830140">(</span><span class="string" id="1830141">&#34;panic:&nbsp;&#34;</span><span class="op" id="1830150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830154">printany</span><span class="op" id="1830162">(</span><span class="ident" id="1830163">e</span><span class="op" id="1830164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1830168">print</span><span class="op" id="1830173">(</span><span class="string" id="1830174">&#34;\n&#34;</span><span class="op" id="1830178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830182">gothrow</span><span class="op" id="1830189">(</span><span class="string" id="1830190">&#34;panic&nbsp;holding&nbsp;locks&#34;</span><span class="op" id="1830211">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830218">var</span>&nbsp;<span class="ident" id="1830222">p</span>&nbsp;<span class="ident" id="1830224">_panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830232">p</span><span class="op" id="1830233">.</span><span class="ident" id="1830234">arg</span>&nbsp;<span class="op" id="1830238">=</span>&nbsp;<span class="ident" id="1830240">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830243">p</span><span class="op" id="1830244">.</span><span class="ident" id="1830245">link</span>&nbsp;<span class="op" id="1830250">=</span>&nbsp;<span class="ident" id="1830252">gp</span><span class="op" id="1830254">.</span><span class="ident" id="1830255">_panic</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830263">gp</span><span class="op" id="1830265">.</span><span class="ident" id="1830266">_panic</span>&nbsp;<span class="op" id="1830273">=</span>&nbsp;<span class="op" id="1830275">(</span><span class="op" id="1830276">*</span><span class="ident" id="1830277">_panic</span><span class="op" id="1830283">)</span><span class="op" id="1830284">(</span><span class="ident" id="1830285">noescape</span><span class="op" id="1830293">(</span><span class="ident" id="1830294">unsafe</span><span class="op" id="1830300">.</span><span class="ident" id="1830301">Pointer</span><span class="op" id="1830308">(</span><span class="op" id="1830309">&amp;</span><span class="ident" id="1830310">p</span><span class="op" id="1830311">)</span><span class="op" id="1830312">)</span><span class="op" id="1830313">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830317">for</span>&nbsp;<span class="op" id="1830321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830325">d</span>&nbsp;<span class="op" id="1830327">:=</span>&nbsp;<span class="ident" id="1830330">gp</span><span class="op" id="1830332">.</span><span class="ident" id="1830333">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830342">if</span>&nbsp;<span class="ident" id="1830345">d</span>&nbsp;<span class="op" id="1830347">==</span>&nbsp;<span class="ident" id="1830350">nil</span>&nbsp;<span class="op" id="1830354">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830359">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830372">//&nbsp;If&nbsp;defer&nbsp;was&nbsp;started&nbsp;by&nbsp;earlier&nbsp;panic&nbsp;or&nbsp;Goexit&nbsp;(and,&nbsp;since&nbsp;we&#39;re&nbsp;back&nbsp;here,&nbsp;that&nbsp;triggered&nbsp;a&nbsp;new&nbsp;panic),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830483">//&nbsp;take&nbsp;defer&nbsp;off&nbsp;list.&nbsp;The&nbsp;earlier&nbsp;panic&nbsp;or&nbsp;Goexit&nbsp;will&nbsp;not&nbsp;continue&nbsp;running.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830564">if</span>&nbsp;<span class="ident" id="1830567">d</span><span class="op" id="1830568">.</span><span class="ident" id="1830569">started</span>&nbsp;<span class="op" id="1830577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830582">if</span>&nbsp;<span class="ident" id="1830585">d</span><span class="op" id="1830586">.</span><span class="ident" id="1830587">_panic</span>&nbsp;<span class="op" id="1830594">!=</span>&nbsp;<span class="ident" id="1830597">nil</span>&nbsp;<span class="op" id="1830601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830607">d</span><span class="op" id="1830608">.</span><span class="ident" id="1830609">_panic</span><span class="op" id="1830615">.</span><span class="ident" id="1830616">aborted</span>&nbsp;<span class="op" id="1830624">=</span>&nbsp;<span class="builtintype" id="1830626">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830639">d</span><span class="op" id="1830640">.</span><span class="ident" id="1830641">_panic</span>&nbsp;<span class="op" id="1830648">=</span>&nbsp;<span class="ident" id="1830650">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830657">d</span><span class="op" id="1830658">.</span><span class="ident" id="1830659">fn</span>&nbsp;<span class="op" id="1830662">=</span>&nbsp;<span class="ident" id="1830664">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830671">gp</span><span class="op" id="1830673">.</span><span class="ident" id="1830674">_defer</span>&nbsp;<span class="op" id="1830681">=</span>&nbsp;<span class="ident" id="1830683">d</span><span class="op" id="1830684">.</span><span class="ident" id="1830685">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830693">freedefer</span><span class="op" id="1830702">(</span><span class="ident" id="1830703">d</span><span class="op" id="1830704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830709">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830720">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830725">//&nbsp;Mark&nbsp;defer&nbsp;as&nbsp;started,&nbsp;but&nbsp;keep&nbsp;on&nbsp;list,&nbsp;so&nbsp;that&nbsp;traceback</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830789">//&nbsp;can&nbsp;find&nbsp;and&nbsp;update&nbsp;the&nbsp;defer&#39;s&nbsp;argument&nbsp;frame&nbsp;if&nbsp;stack&nbsp;growth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830857">//&nbsp;or&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;hapens&nbsp;before&nbsp;reflectcall&nbsp;starts&nbsp;executing&nbsp;d.fn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830935">d</span><span class="op" id="1830936">.</span><span class="ident" id="1830937">started</span>&nbsp;<span class="op" id="1830945">=</span>&nbsp;<span class="builtintype" id="1830947">true</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830955">//&nbsp;Record&nbsp;the&nbsp;panic&nbsp;that&nbsp;is&nbsp;running&nbsp;the&nbsp;defer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831004">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;new&nbsp;panic&nbsp;during&nbsp;the&nbsp;deferred&nbsp;call,&nbsp;that&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831070">//&nbsp;will&nbsp;find&nbsp;d&nbsp;in&nbsp;the&nbsp;list&nbsp;and&nbsp;will&nbsp;mark&nbsp;d._panic&nbsp;(this&nbsp;panic)&nbsp;aborted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831144">d</span><span class="op" id="1831145">.</span><span class="ident" id="1831146">_panic</span>&nbsp;<span class="op" id="1831153">=</span>&nbsp;<span class="op" id="1831155">(</span><span class="op" id="1831156">*</span><span class="ident" id="1831157">_panic</span><span class="op" id="1831163">)</span><span class="op" id="1831164">(</span><span class="ident" id="1831165">noescape</span><span class="op" id="1831173">(</span><span class="op" id="1831174">(</span><span class="ident" id="1831175">unsafe</span><span class="op" id="1831181">.</span><span class="ident" id="1831182">Pointer</span><span class="op" id="1831189">)</span><span class="op" id="1831190">(</span><span class="op" id="1831191">&amp;</span><span class="ident" id="1831192">p</span><span class="op" id="1831193">)</span><span class="op" id="1831194">)</span><span class="op" id="1831195">)</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831200">p</span><span class="op" id="1831201">.</span><span class="ident" id="1831202">argp</span>&nbsp;<span class="op" id="1831207">=</span>&nbsp;<span class="ident" id="1831209">unsafe</span><span class="op" id="1831215">.</span><span class="ident" id="1831216">Pointer</span><span class="op" id="1831223">(</span><span class="ident" id="1831224">getargp</span><span class="op" id="1831231">(</span><span class="num" id="1831232">0</span><span class="op" id="1831233">)</span><span class="op" id="1831234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831238">reflectcall</span><span class="op" id="1831249">(</span><span class="ident" id="1831250">unsafe</span><span class="op" id="1831256">.</span><span class="ident" id="1831257">Pointer</span><span class="op" id="1831264">(</span><span class="ident" id="1831265">d</span><span class="op" id="1831266">.</span><span class="ident" id="1831267">fn</span><span class="op" id="1831269">)</span><span class="op" id="1831270">,</span>&nbsp;<span class="ident" id="1831272">deferArgs</span><span class="op" id="1831281">(</span><span class="ident" id="1831282">d</span><span class="op" id="1831283">)</span><span class="op" id="1831284">,</span>&nbsp;<span class="builtintype" id="1831286">uint32</span><span class="op" id="1831292">(</span><span class="ident" id="1831293">d</span><span class="op" id="1831294">.</span><span class="ident" id="1831295">siz</span><span class="op" id="1831298">)</span><span class="op" id="1831299">,</span>&nbsp;<span class="builtintype" id="1831301">uint32</span><span class="op" id="1831307">(</span><span class="ident" id="1831308">d</span><span class="op" id="1831309">.</span><span class="ident" id="1831310">siz</span><span class="op" id="1831313">)</span><span class="op" id="1831314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831318">p</span><span class="op" id="1831319">.</span><span class="ident" id="1831320">argp</span>&nbsp;<span class="op" id="1831325">=</span>&nbsp;<span class="ident" id="1831327">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831334">//&nbsp;reflectcall&nbsp;did&nbsp;not&nbsp;panic.&nbsp;Remove&nbsp;d.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1831376">if</span>&nbsp;<span class="ident" id="1831379">gp</span><span class="op" id="1831381">.</span><span class="ident" id="1831382">_defer</span>&nbsp;<span class="op" id="1831389">!=</span>&nbsp;<span class="ident" id="1831392">d</span>&nbsp;<span class="op" id="1831394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831399">gothrow</span><span class="op" id="1831406">(</span><span class="string" id="1831407">&#34;bad&nbsp;defer&nbsp;entry&nbsp;in&nbsp;panic&#34;</span><span class="op" id="1831433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1831437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831441">d</span><span class="op" id="1831442">.</span><span class="ident" id="1831443">_panic</span>&nbsp;<span class="op" id="1831450">=</span>&nbsp;<span class="ident" id="1831452">nil</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831458">d</span><span class="op" id="1831459">.</span><span class="ident" id="1831460">fn</span>&nbsp;<span class="op" id="1831463">=</span>&nbsp;<span class="ident" id="1831465">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831471">gp</span><span class="op" id="1831473">.</span><span class="ident" id="1831474">_defer</span>&nbsp;<span class="op" id="1831481">=</span>&nbsp;<span class="ident" id="1831483">d</span><span class="op" id="1831484">.</span><span class="ident" id="1831485">link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831493">//&nbsp;trigger&nbsp;shrinkage&nbsp;to&nbsp;test&nbsp;stack&nbsp;copy.&nbsp;&nbsp;See&nbsp;stack_test.go:TestStackPanic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831570">//GC()</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831580">pc</span>&nbsp;<span class="op" id="1831583">:=</span>&nbsp;<span class="ident" id="1831586">d</span><span class="op" id="1831587">.</span><span class="ident" id="1831588">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831593">argp</span>&nbsp;<span class="op" id="1831598">:=</span>&nbsp;<span class="ident" id="1831601">unsafe</span><span class="op" id="1831607">.</span><span class="ident" id="1831608">Pointer</span><span class="op" id="1831615">(</span><span class="ident" id="1831616">d</span><span class="op" id="1831617">.</span><span class="ident" id="1831618">argp</span><span class="op" id="1831622">)</span>&nbsp;<span class="comment" id="1831624">//&nbsp;must&nbsp;be&nbsp;pointer&nbsp;so&nbsp;it&nbsp;gets&nbsp;adjusted&nbsp;during&nbsp;stack&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831683">freedefer</span><span class="op" id="1831692">(</span><span class="ident" id="1831693">d</span><span class="op" id="1831694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1831698">if</span>&nbsp;<span class="ident" id="1831701">p</span><span class="op" id="1831702">.</span><span class="ident" id="1831703">recovered</span>&nbsp;<span class="op" id="1831713">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831718">gp</span><span class="op" id="1831720">.</span><span class="ident" id="1831721">_panic</span>&nbsp;<span class="op" id="1831728">=</span>&nbsp;<span class="ident" id="1831730">p</span><span class="op" id="1831731">.</span><span class="ident" id="1831732">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831740">//&nbsp;Aborted&nbsp;panics&nbsp;are&nbsp;marked&nbsp;but&nbsp;remain&nbsp;on&nbsp;the&nbsp;g.panic&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831804">//&nbsp;Remove&nbsp;them&nbsp;from&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1831837">for</span>&nbsp;<span class="ident" id="1831841">gp</span><span class="op" id="1831843">.</span><span class="ident" id="1831844">_panic</span>&nbsp;<span class="op" id="1831851">!=</span>&nbsp;<span class="ident" id="1831854">nil</span>&nbsp;<span class="op" id="1831858">&amp;&amp;</span>&nbsp;<span class="ident" id="1831861">gp</span><span class="op" id="1831863">.</span><span class="ident" id="1831864">_panic</span><span class="op" id="1831870">.</span><span class="ident" id="1831871">aborted</span>&nbsp;<span class="op" id="1831879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831885">gp</span><span class="op" id="1831887">.</span><span class="ident" id="1831888">_panic</span>&nbsp;<span class="op" id="1831895">=</span>&nbsp;<span class="ident" id="1831897">gp</span><span class="op" id="1831899">.</span><span class="ident" id="1831900">_panic</span><span class="op" id="1831906">.</span><span class="ident" id="1831907">link</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1831915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1831920">if</span>&nbsp;<span class="ident" id="1831923">gp</span><span class="op" id="1831925">.</span><span class="ident" id="1831926">_panic</span>&nbsp;<span class="op" id="1831933">==</span>&nbsp;<span class="ident" id="1831936">nil</span>&nbsp;<span class="op" id="1831940">{</span>&nbsp;<span class="comment" id="1831942">//&nbsp;must&nbsp;be&nbsp;done&nbsp;with&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831974">gp</span><span class="op" id="1831976">.</span><span class="ident" id="1831977">sig</span>&nbsp;<span class="op" id="1831981">=</span>&nbsp;<span class="num" id="1831983">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1831988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831993">//&nbsp;Pass&nbsp;information&nbsp;about&nbsp;recovering&nbsp;frame&nbsp;to&nbsp;recovery.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832052">gp</span><span class="op" id="1832054">.</span><span class="ident" id="1832055">sigcode0</span>&nbsp;<span class="op" id="1832064">=</span>&nbsp;<span class="builtintype" id="1832066">uintptr</span><span class="op" id="1832073">(</span><span class="ident" id="1832074">argp</span><span class="op" id="1832078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832083">gp</span><span class="op" id="1832085">.</span><span class="ident" id="1832086">sigcode1</span>&nbsp;<span class="op" id="1832095">=</span>&nbsp;<span class="ident" id="1832097">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832103">mcall</span><span class="op" id="1832108">(</span><span class="ident" id="1832109">recovery_m</span><span class="op" id="1832119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832124">gothrow</span><span class="op" id="1832131">(</span><span class="string" id="1832132">&#34;recovery&nbsp;failed&#34;</span><span class="op" id="1832149">)</span>&nbsp;<span class="comment" id="1832151">//&nbsp;mcall&nbsp;should&nbsp;not&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1832180">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1832183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832187">//&nbsp;ran&nbsp;out&nbsp;of&nbsp;deferred&nbsp;calls&nbsp;-&nbsp;old-school&nbsp;panic&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832240">startpanic</span><span class="op" id="1832250">(</span><span class="op" id="1832251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832254">printpanics</span><span class="op" id="1832265">(</span><span class="ident" id="1832266">gp</span><span class="op" id="1832268">.</span><span class="ident" id="1832269">_panic</span><span class="op" id="1832275">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832278">dopanic</span><span class="op" id="1832285">(</span><span class="num" id="1832286">0</span><span class="op" id="1832287">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1832295">//&nbsp;should&nbsp;not&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1832317">*</span><span class="op" id="1832318">(</span><span class="op" id="1832319">*</span><span class="builtintype" id="1832320">int</span><span class="op" id="1832323">)</span><span class="op" id="1832324">(</span><span class="ident" id="1832325">nil</span><span class="op" id="1832328">)</span>&nbsp;<span class="op" id="1832330">=</span>&nbsp;<span class="num" id="1832332">0</span>&nbsp;<span class="comment" id="1832334">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno"></span><span class="op" id="1832349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1832352">//&nbsp;getargp&nbsp;returns&nbsp;the&nbsp;location&nbsp;where&nbsp;the&nbsp;caller</span><br>
<span class="lineno">430</span><span class="comment" id="1832401">//&nbsp;writes&nbsp;outgoing&nbsp;function&nbsp;call&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1832445">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1832458">func</span>&nbsp;<span class="ident" id="1832463">getargp</span><span class="op" id="1832470">(</span><span class="ident" id="1832471">x</span>&nbsp;<span class="builtintype" id="1832473">int</span><span class="op" id="1832476">)</span>&nbsp;<span class="builtintype" id="1832478">uintptr</span>&nbsp;<span class="op" id="1832486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832489">//&nbsp;x&nbsp;is&nbsp;an&nbsp;argument&nbsp;mainly&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;return&nbsp;its&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832552">//&nbsp;However,&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;the&nbsp;function&nbsp;complex&nbsp;enough</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832609">//&nbsp;that&nbsp;it&nbsp;won&#39;t&nbsp;be&nbsp;inlined.&nbsp;We&nbsp;always&nbsp;pass&nbsp;x&nbsp;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832674">//&nbsp;does&nbsp;nothing&nbsp;other&nbsp;than&nbsp;keep&nbsp;the&nbsp;compiler&nbsp;from&nbsp;thinking</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832734">//&nbsp;the&nbsp;function&nbsp;is&nbsp;simple&nbsp;enough&nbsp;to&nbsp;inline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832779">if</span>&nbsp;<span class="ident" id="1832782">x</span>&nbsp;<span class="op" id="1832784">&gt;</span>&nbsp;<span class="num" id="1832786">0</span>&nbsp;<span class="op" id="1832788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832792">return</span>&nbsp;<span class="ident" id="1832799">getcallersp</span><span class="op" id="1832810">(</span><span class="ident" id="1832811">unsafe</span><span class="op" id="1832817">.</span><span class="ident" id="1832818">Pointer</span><span class="op" id="1832825">(</span><span class="op" id="1832826">&amp;</span><span class="ident" id="1832827">x</span><span class="op" id="1832828">)</span><span class="op" id="1832829">)</span>&nbsp;<span class="op" id="1832831">*</span>&nbsp;<span class="num" id="1832833">0</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1832836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832839">return</span>&nbsp;<span class="builtintype" id="1832846">uintptr</span><span class="op" id="1832853">(</span><span class="ident" id="1832854">noescape</span><span class="op" id="1832862">(</span><span class="ident" id="1832863">unsafe</span><span class="op" id="1832869">.</span><span class="ident" id="1832870">Pointer</span><span class="op" id="1832877">(</span><span class="op" id="1832878">&amp;</span><span class="ident" id="1832879">x</span><span class="op" id="1832880">)</span><span class="op" id="1832881">)</span><span class="op" id="1832882">)</span><br>
<span class="lineno"></span><span class="op" id="1832884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1832887">//&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;predeclared&nbsp;function&nbsp;recover.</span><br>
<span class="lineno">445</span><span class="comment" id="1832946">//&nbsp;Cannot&nbsp;split&nbsp;the&nbsp;stack&nbsp;because&nbsp;it&nbsp;needs&nbsp;to&nbsp;reliably</span><br>
<span class="lineno"></span><span class="comment" id="1833001">//&nbsp;find&nbsp;the&nbsp;stack&nbsp;segment&nbsp;of&nbsp;its&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="1833042">//</span><br>
<span class="lineno"></span><span class="comment" id="1833045">//&nbsp;TODO(rsc):&nbsp;Once&nbsp;we&nbsp;commit&nbsp;to&nbsp;CopyStackAlways,</span><br>
<span class="lineno"></span><span class="comment" id="1833094">//&nbsp;this&nbsp;doesn&#39;t&nbsp;need&nbsp;to&nbsp;be&nbsp;nosplit.</span><br>
<span class="lineno">450</span><span class="comment" id="1833130">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1833143">func</span>&nbsp;<span class="ident" id="1833148">gorecover</span><span class="op" id="1833157">(</span><span class="ident" id="1833158">argp</span>&nbsp;<span class="builtintype" id="1833163">uintptr</span><span class="op" id="1833170">)</span>&nbsp;<span class="keyword" id="1833172">interface</span><span class="op" id="1833181">{</span><span class="op" id="1833182">}</span>&nbsp;<span class="op" id="1833184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1833187">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;a&nbsp;function&nbsp;running&nbsp;as&nbsp;part&nbsp;of&nbsp;a&nbsp;deferred&nbsp;call&nbsp;during&nbsp;the&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1833266">//&nbsp;Must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;topmost&nbsp;function&nbsp;of&nbsp;the&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1833323">//&nbsp;(the&nbsp;function&nbsp;used&nbsp;in&nbsp;the&nbsp;defer&nbsp;statement).</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1833371">//&nbsp;p.argp&nbsp;is&nbsp;the&nbsp;argument&nbsp;pointer&nbsp;of&nbsp;that&nbsp;topmost&nbsp;deferred&nbsp;function&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1833446">//&nbsp;Compare&nbsp;against&nbsp;argp&nbsp;reported&nbsp;by&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1833491">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;the&nbsp;caller&nbsp;is&nbsp;the&nbsp;one&nbsp;who&nbsp;can&nbsp;recover.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833549">gp</span>&nbsp;<span class="op" id="1833552">:=</span>&nbsp;<span class="ident" id="1833555">getg</span><span class="op" id="1833559">(</span><span class="op" id="1833560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833563">p</span>&nbsp;<span class="op" id="1833565">:=</span>&nbsp;<span class="ident" id="1833568">gp</span><span class="op" id="1833570">.</span><span class="ident" id="1833571">_panic</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833579">if</span>&nbsp;<span class="ident" id="1833582">p</span>&nbsp;<span class="op" id="1833584">!=</span>&nbsp;<span class="ident" id="1833587">nil</span>&nbsp;<span class="op" id="1833591">&amp;&amp;</span>&nbsp;<span class="op" id="1833594">!</span><span class="ident" id="1833595">p</span><span class="op" id="1833596">.</span><span class="ident" id="1833597">recovered</span>&nbsp;<span class="op" id="1833607">&amp;&amp;</span>&nbsp;<span class="ident" id="1833610">argp</span>&nbsp;<span class="op" id="1833615">==</span>&nbsp;<span class="builtintype" id="1833618">uintptr</span><span class="op" id="1833625">(</span><span class="ident" id="1833626">p</span><span class="op" id="1833627">.</span><span class="ident" id="1833628">argp</span><span class="op" id="1833632">)</span>&nbsp;<span class="op" id="1833634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833638">p</span><span class="op" id="1833639">.</span><span class="ident" id="1833640">recovered</span>&nbsp;<span class="op" id="1833650">=</span>&nbsp;<span class="builtintype" id="1833652">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833659">return</span>&nbsp;<span class="ident" id="1833666">p</span><span class="op" id="1833667">.</span><span class="ident" id="1833668">arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1833673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833676">return</span>&nbsp;<span class="ident" id="1833683">nil</span><br>
<span class="lineno">465</span><span class="op" id="1833687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1833690">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1833703">func</span>&nbsp;<span class="ident" id="1833708">startpanic</span><span class="op" id="1833718">(</span><span class="op" id="1833719">)</span>&nbsp;<span class="op" id="1833721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833724">onM_signalok</span><span class="op" id="1833736">(</span><span class="ident" id="1833737">startpanic_m</span><span class="op" id="1833749">)</span><br>
<span class="lineno">470</span><span class="op" id="1833751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1833754">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1833767">func</span>&nbsp;<span class="ident" id="1833772">dopanic</span><span class="op" id="1833779">(</span><span class="ident" id="1833780">unused</span>&nbsp;<span class="builtintype" id="1833787">int</span><span class="op" id="1833790">)</span>&nbsp;<span class="op" id="1833792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833795">gp</span>&nbsp;<span class="op" id="1833798">:=</span>&nbsp;<span class="ident" id="1833801">getg</span><span class="op" id="1833805">(</span><span class="op" id="1833806">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833809">mp</span>&nbsp;<span class="op" id="1833812">:=</span>&nbsp;<span class="ident" id="1833815">acquirem</span><span class="op" id="1833823">(</span><span class="op" id="1833824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833827">mp</span><span class="op" id="1833829">.</span><span class="ident" id="1833830">ptrarg</span><span class="op" id="1833836">[</span><span class="num" id="1833837">0</span><span class="op" id="1833838">]</span>&nbsp;<span class="op" id="1833840">=</span>&nbsp;<span class="ident" id="1833842">unsafe</span><span class="op" id="1833848">.</span><span class="ident" id="1833849">Pointer</span><span class="op" id="1833856">(</span><span class="ident" id="1833857">gp</span><span class="op" id="1833859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833862">mp</span><span class="op" id="1833864">.</span><span class="ident" id="1833865">scalararg</span><span class="op" id="1833874">[</span><span class="num" id="1833875">0</span><span class="op" id="1833876">]</span>&nbsp;<span class="op" id="1833878">=</span>&nbsp;<span class="ident" id="1833880">getcallerpc</span><span class="op" id="1833891">(</span><span class="op" id="1833892">(</span><span class="ident" id="1833893">unsafe</span><span class="op" id="1833899">.</span><span class="ident" id="1833900">Pointer</span><span class="op" id="1833907">)</span><span class="op" id="1833908">(</span><span class="op" id="1833909">&amp;</span><span class="ident" id="1833910">unused</span><span class="op" id="1833916">)</span><span class="op" id="1833917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833920">mp</span><span class="op" id="1833922">.</span><span class="ident" id="1833923">scalararg</span><span class="op" id="1833932">[</span><span class="num" id="1833933">1</span><span class="op" id="1833934">]</span>&nbsp;<span class="op" id="1833936">=</span>&nbsp;<span class="ident" id="1833938">getcallersp</span><span class="op" id="1833949">(</span><span class="op" id="1833950">(</span><span class="ident" id="1833951">unsafe</span><span class="op" id="1833957">.</span><span class="ident" id="1833958">Pointer</span><span class="op" id="1833965">)</span><span class="op" id="1833966">(</span><span class="op" id="1833967">&amp;</span><span class="ident" id="1833968">unused</span><span class="op" id="1833974">)</span><span class="op" id="1833975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833978">onM_signalok</span><span class="op" id="1833990">(</span><span class="ident" id="1833991">dopanic_m</span><span class="op" id="1834000">)</span>&nbsp;<span class="comment" id="1834002">//&nbsp;should&nbsp;never&nbsp;return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1834026">*</span><span class="op" id="1834027">(</span><span class="op" id="1834028">*</span><span class="builtintype" id="1834029">int</span><span class="op" id="1834032">)</span><span class="op" id="1834033">(</span><span class="ident" id="1834034">nil</span><span class="op" id="1834037">)</span>&nbsp;<span class="op" id="1834039">=</span>&nbsp;<span class="num" id="1834041">0</span><br>
<span class="lineno"></span><span class="op" id="1834043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1834046">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1834059">func</span>&nbsp;<span class="ident" id="1834064">throw</span><span class="op" id="1834069">(</span><span class="ident" id="1834070">s</span>&nbsp;<span class="op" id="1834072">*</span><span class="builtintype" id="1834073">byte</span><span class="op" id="1834077">)</span>&nbsp;<span class="op" id="1834079">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834082">gp</span>&nbsp;<span class="op" id="1834085">:=</span>&nbsp;<span class="ident" id="1834088">getg</span><span class="op" id="1834092">(</span><span class="op" id="1834093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1834096">if</span>&nbsp;<span class="ident" id="1834099">gp</span><span class="op" id="1834101">.</span><span class="ident" id="1834102">m</span><span class="op" id="1834103">.</span><span class="ident" id="1834104">throwing</span>&nbsp;<span class="op" id="1834113">==</span>&nbsp;<span class="num" id="1834116">0</span>&nbsp;<span class="op" id="1834118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834122">gp</span><span class="op" id="1834124">.</span><span class="ident" id="1834125">m</span><span class="op" id="1834126">.</span><span class="ident" id="1834127">throwing</span>&nbsp;<span class="op" id="1834136">=</span>&nbsp;<span class="num" id="1834138">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1834141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834144">startpanic</span><span class="op" id="1834154">(</span><span class="op" id="1834155">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1834158">print</span><span class="op" id="1834163">(</span><span class="string" id="1834164">&#34;fatal&nbsp;error:&nbsp;&#34;</span><span class="op" id="1834179">,</span>&nbsp;<span class="ident" id="1834181">gostringnocopy</span><span class="op" id="1834195">(</span><span class="ident" id="1834196">s</span><span class="op" id="1834197">)</span><span class="op" id="1834198">,</span>&nbsp;<span class="string" id="1834200">&#34;\n&#34;</span><span class="op" id="1834204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834207">dopanic</span><span class="op" id="1834214">(</span><span class="num" id="1834215">0</span><span class="op" id="1834216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1834219">*</span><span class="op" id="1834220">(</span><span class="op" id="1834221">*</span><span class="builtintype" id="1834222">int</span><span class="op" id="1834225">)</span><span class="op" id="1834226">(</span><span class="ident" id="1834227">nil</span><span class="op" id="1834230">)</span>&nbsp;<span class="op" id="1834232">=</span>&nbsp;<span class="num" id="1834234">0</span>&nbsp;<span class="comment" id="1834236">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno"></span><span class="op" id="1834251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="1834254">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1834267">func</span>&nbsp;<span class="ident" id="1834272">gothrow</span><span class="op" id="1834279">(</span><span class="ident" id="1834280">s</span>&nbsp;<span class="builtintype" id="1834282">string</span><span class="op" id="1834288">)</span>&nbsp;<span class="op" id="1834290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834293">gp</span>&nbsp;<span class="op" id="1834296">:=</span>&nbsp;<span class="ident" id="1834299">getg</span><span class="op" id="1834303">(</span><span class="op" id="1834304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1834307">if</span>&nbsp;<span class="ident" id="1834310">gp</span><span class="op" id="1834312">.</span><span class="ident" id="1834313">m</span><span class="op" id="1834314">.</span><span class="ident" id="1834315">throwing</span>&nbsp;<span class="op" id="1834324">==</span>&nbsp;<span class="num" id="1834327">0</span>&nbsp;<span class="op" id="1834329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834333">gp</span><span class="op" id="1834335">.</span><span class="ident" id="1834336">m</span><span class="op" id="1834337">.</span><span class="ident" id="1834338">throwing</span>&nbsp;<span class="op" id="1834347">=</span>&nbsp;<span class="num" id="1834349">1</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1834352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834355">startpanic</span><span class="op" id="1834365">(</span><span class="op" id="1834366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1834369">print</span><span class="op" id="1834374">(</span><span class="string" id="1834375">&#34;fatal&nbsp;error:&nbsp;&#34;</span><span class="op" id="1834390">,</span>&nbsp;<span class="ident" id="1834392">s</span><span class="op" id="1834393">,</span>&nbsp;<span class="string" id="1834395">&#34;\n&#34;</span><span class="op" id="1834399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834402">dopanic</span><span class="op" id="1834409">(</span><span class="num" id="1834410">0</span><span class="op" id="1834411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1834414">*</span><span class="op" id="1834415">(</span><span class="op" id="1834416">*</span><span class="builtintype" id="1834417">int</span><span class="op" id="1834420">)</span><span class="op" id="1834421">(</span><span class="ident" id="1834422">nil</span><span class="op" id="1834425">)</span>&nbsp;<span class="op" id="1834427">=</span>&nbsp;<span class="num" id="1834429">0</span>&nbsp;<span class="comment" id="1834431">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno">505</span><span class="op" id="1834446">}</span>
</div>
</body>
</html>
