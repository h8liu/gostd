<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2627321">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2627377">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2627431">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2627482">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2627519">package</span>&nbsp;<span class="ident" id="2627527">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2627532">import</span>&nbsp;<span class="op" id="2627539">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2627542">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2627552">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="2627559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2627562">var</span>&nbsp;<span class="op" id="2627566">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2627569">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2627629">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2627659">supportsIPv4</span>&nbsp;<span class="builtintype" id="2627672">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2627679">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2627739">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2627769">supportsIPv6</span>&nbsp;<span class="builtintype" id="2627782">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2627789">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2627847">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2627911">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2627970">supportsIPv4map</span>&nbsp;<span class="builtintype" id="2627986">bool</span><br>
<span class="lineno"></span><span class="op" id="2627991">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2627994">func</span>&nbsp;<span class="ident" id="2627999">init</span><span class="op" id="2628003">(</span><span class="op" id="2628004">)</span>&nbsp;<span class="op" id="2628006">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2628009"><a href="/net/fd_unix.go.html#2575714">sysInit</a></span><span class="op" id="2628016">(</span><span class="op" id="2628017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2628020"><a href="/net/ipsock.go.html#2627659">supportsIPv4</a></span>&nbsp;<span class="op" id="2628033">=</span>&nbsp;<span class="ident" id="2628035"><a href="/net/ipsock_posix.go.html#2635886">probeIPv4Stack</a></span><span class="op" id="2628049">(</span><span class="op" id="2628050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2628053"><a href="/net/ipsock.go.html#2627769">supportsIPv6</a></span><span class="op" id="2628065">,</span>&nbsp;<span class="ident" id="2628067"><a href="/net/ipsock.go.html#2627970">supportsIPv4map</a></span>&nbsp;<span class="op" id="2628083">=</span>&nbsp;<span class="ident" id="2628085"><a href="/net/ipsock_posix.go.html#2636876">probeIPv6Stack</a></span><span class="op" id="2628099">(</span><span class="op" id="2628100">)</span><br>
<span class="lineno"></span><span class="op" id="2628102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="2628105">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2628169">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="2628200">type</span>&nbsp;<span class="ident" id="2628205">netaddr</span>&nbsp;<span class="keyword" id="2628213">interface</span>&nbsp;<span class="op" id="2628223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2628226">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2628288">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2628344">toAddr</span><span class="op" id="2628350">(</span><span class="op" id="2628351">)</span>&nbsp;<span class="ident" id="2628353"><a href="/net/net.go.html#2652238">Addr</a></span><br>
<span class="lineno"></span><span class="op" id="2628358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2628361">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="2628425">type</span>&nbsp;<span class="ident" id="2628430">addrList</span>&nbsp;<span class="op" id="2628439">[</span><span class="op" id="2628440">]</span><span class="ident" id="2628441"><a href="/net/ipsock.go.html#2628205">netaddr</a></span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="2628450">func</span>&nbsp;<span class="op" id="2628455">(</span><span class="ident" id="2628456">al</span>&nbsp;<span class="ident" id="2628459"><a href="/net/ipsock.go.html#2628430">addrList</a></span><span class="op" id="2628467">)</span>&nbsp;<span class="ident" id="2628469">toAddr</span><span class="op" id="2628475">(</span><span class="op" id="2628476">)</span>&nbsp;<span class="ident" id="2628478"><a href="/net/net.go.html#2652238">Addr</a></span>&nbsp;<span class="op" id="2628483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2628486">switch</span>&nbsp;<span class="builtinfunc" id="2628493">len</span><span class="op" id="2628496">(</span><span class="ident" id="2628497"><a href="/net/ipsock.go.html#2628456">al</a></span><span class="op" id="2628499">)</span>&nbsp;<span class="op" id="2628501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2628504">case</span>&nbsp;<span class="num" id="2628509">0</span><span class="op" id="2628510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2628514">return</span>&nbsp;<span class="ident" id="2628521">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2628526">case</span>&nbsp;<span class="num" id="2628531">1</span><span class="op" id="2628532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2628536">return</span>&nbsp;<span class="ident" id="2628543"><a href="/net/ipsock.go.html#2628456">al</a></span><span class="op" id="2628545">[</span><span class="num" id="2628546">0</span><span class="op" id="2628547">]</span><span class="op" id="2628548">.</span><span class="ident" id="2628549">toAddr</span><span class="op" id="2628555">(</span><span class="op" id="2628556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2628559">default</span><span class="op" id="2628566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2628570">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2628621">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2628675">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2628729">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2628747">return</span>&nbsp;<span class="ident" id="2628754"><a href="/net/ipsock.go.html#2628456">al</a></span><span class="op" id="2628756">[</span><span class="num" id="2628757">0</span><span class="op" id="2628758">]</span><span class="op" id="2628759">.</span><span class="ident" id="2628760">toAddr</span><span class="op" id="2628766">(</span><span class="op" id="2628767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2628770">}</span><br>
<span class="lineno"></span><span class="op" id="2628772">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="2628775">var</span>&nbsp;<span class="ident" id="2628779">errNoSuitableAddress</span>&nbsp;<span class="op" id="2628800">=</span>&nbsp;<span class="ident" id="2628802"><a href="/net/ipsock.go.html#2627542">errors</a></span><span class="op" id="2628808">.</span><span class="ident" id="2628809">New</span><span class="op" id="2628812">(</span><span class="string" id="2628813">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="2628840">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2628843">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2628911">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="2628979">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="2629050">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2629102">func</span>&nbsp;<span class="ident" id="2629107">firstFavoriteAddr</span><span class="op" id="2629124">(</span><span class="ident" id="2629125">filter</span>&nbsp;<span class="keyword" id="2629132">func</span><span class="op" id="2629136">(</span><span class="ident" id="2629137"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2629139">)</span>&nbsp;<span class="ident" id="2629141"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2629143">,</span>&nbsp;<span class="ident" id="2629145">ips</span>&nbsp;<span class="op" id="2629149">[</span><span class="op" id="2629150">]</span><span class="ident" id="2629151"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2629153">,</span>&nbsp;<span class="ident" id="2629155">inetaddr</span>&nbsp;<span class="keyword" id="2629164">func</span><span class="op" id="2629168">(</span><span class="ident" id="2629169"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2629171">)</span>&nbsp;<span class="ident" id="2629173"><a href="/net/ipsock.go.html#2628205">netaddr</a></span><span class="op" id="2629180">)</span>&nbsp;<span class="op" id="2629182">(</span><span class="ident" id="2629183"><a href="/net/ipsock.go.html#2628205">netaddr</a></span><span class="op" id="2629190">,</span>&nbsp;<span class="builtintype" id="2629192">error</span><span class="op" id="2629197">)</span>&nbsp;<span class="op" id="2629199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2629202">if</span>&nbsp;<span class="ident" id="2629205"><a href="/net/ipsock.go.html#2629125">filter</a></span>&nbsp;<span class="op" id="2629212">!=</span>&nbsp;<span class="ident" id="2629215">nil</span>&nbsp;<span class="op" id="2629219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2629223">return</span>&nbsp;<span class="ident" id="2629230"><a href="/net/ipsock.go.html#2630153">firstSupportedAddr</a></span><span class="op" id="2629248">(</span><span class="ident" id="2629249"><a href="/net/ipsock.go.html#2629125">filter</a></span><span class="op" id="2629255">,</span>&nbsp;<span class="ident" id="2629257"><a href="/net/ipsock.go.html#2629145">ips</a></span><span class="op" id="2629260">,</span>&nbsp;<span class="ident" id="2629262"><a href="/net/ipsock.go.html#2629155">inetaddr</a></span><span class="op" id="2629270">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2629273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2629276">var</span>&nbsp;<span class="op" id="2629280">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2629284">ipv4</span><span class="op" id="2629288">,</span>&nbsp;<span class="ident" id="2629290">ipv6</span><span class="op" id="2629294">,</span>&nbsp;<span class="ident" id="2629296">swap</span>&nbsp;<span class="builtintype" id="2629301">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2629308">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2629325"><a href="/net/ipsock.go.html#2628430">addrList</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2629335">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2629338">for</span>&nbsp;<span class="ident" id="2629342">_</span><span class="op" id="2629343">,</span>&nbsp;<span class="ident" id="2629345">ip</span>&nbsp;<span class="op" id="2629348">:=</span>&nbsp;<span class="keyword" id="2629351">range</span>&nbsp;<span class="ident" id="2629357"><a href="/net/ipsock.go.html#2629145">ips</a></span>&nbsp;<span class="op" id="2629361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2629365">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2629419">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2629465">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2629516">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2629572">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2629627">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2629679">if</span>&nbsp;<span class="ident" id="2629682">ip4</span>&nbsp;<span class="op" id="2629686">:=</span>&nbsp;<span class="ident" id="2629689"><a href="/net/ipsock.go.html#2630557">ipv4only</a></span><span class="op" id="2629697">(</span><span class="ident" id="2629698"><a href="/net/ipsock.go.html#2629345">ip</a></span><span class="op" id="2629700">)</span><span class="op" id="2629701">;</span>&nbsp;<span class="ident" id="2629703"><a href="/net/ipsock.go.html#2629682">ip4</a></span>&nbsp;<span class="op" id="2629707">!=</span>&nbsp;<span class="ident" id="2629710">nil</span>&nbsp;<span class="op" id="2629714">&amp;&amp;</span>&nbsp;<span class="op" id="2629717">!</span><span class="ident" id="2629718"><a href="/net/ipsock.go.html#2629284">ipv4</a></span>&nbsp;<span class="op" id="2629723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2629728"><a href="/net/ipsock.go.html#2629308">list</a></span>&nbsp;<span class="op" id="2629733">=</span>&nbsp;<span class="builtinfunc" id="2629735">append</span><span class="op" id="2629741">(</span><span class="ident" id="2629742"><a href="/net/ipsock.go.html#2629308">list</a></span><span class="op" id="2629746">,</span>&nbsp;<span class="ident" id="2629748"><a href="/net/ipsock.go.html#2629155">inetaddr</a></span><span class="op" id="2629756">(</span><span class="ident" id="2629757"><a href="/net/ipsock.go.html#2629682">ip4</a></span><span class="op" id="2629760">)</span><span class="op" id="2629761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2629766"><a href="/net/ipsock.go.html#2629284">ipv4</a></span>&nbsp;<span class="op" id="2629771">=</span>&nbsp;<span class="ident" id="2629773">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2629781">if</span>&nbsp;<span class="ident" id="2629784"><a href="/net/ipsock.go.html#2629290">ipv6</a></span>&nbsp;<span class="op" id="2629789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2629795"><a href="/net/ipsock.go.html#2629296">swap</a></span>&nbsp;<span class="op" id="2629800">=</span>&nbsp;<span class="ident" id="2629802">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2629810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2629814">}</span>&nbsp;<span class="keyword" id="2629816">else</span>&nbsp;<span class="keyword" id="2629821">if</span>&nbsp;<span class="ident" id="2629824">ip6</span>&nbsp;<span class="op" id="2629828">:=</span>&nbsp;<span class="ident" id="2629831"><a href="/net/ipsock.go.html#2630852">ipv6only</a></span><span class="op" id="2629839">(</span><span class="ident" id="2629840"><a href="/net/ipsock.go.html#2629345">ip</a></span><span class="op" id="2629842">)</span><span class="op" id="2629843">;</span>&nbsp;<span class="ident" id="2629845"><a href="/net/ipsock.go.html#2629824">ip6</a></span>&nbsp;<span class="op" id="2629849">!=</span>&nbsp;<span class="ident" id="2629852">nil</span>&nbsp;<span class="op" id="2629856">&amp;&amp;</span>&nbsp;<span class="op" id="2629859">!</span><span class="ident" id="2629860"><a href="/net/ipsock.go.html#2629290">ipv6</a></span>&nbsp;<span class="op" id="2629865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2629870"><a href="/net/ipsock.go.html#2629308">list</a></span>&nbsp;<span class="op" id="2629875">=</span>&nbsp;<span class="builtinfunc" id="2629877">append</span><span class="op" id="2629883">(</span><span class="ident" id="2629884"><a href="/net/ipsock.go.html#2629308">list</a></span><span class="op" id="2629888">,</span>&nbsp;<span class="ident" id="2629890"><a href="/net/ipsock.go.html#2629155">inetaddr</a></span><span class="op" id="2629898">(</span><span class="ident" id="2629899"><a href="/net/ipsock.go.html#2629824">ip6</a></span><span class="op" id="2629902">)</span><span class="op" id="2629903">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2629908"><a href="/net/ipsock.go.html#2629290">ipv6</a></span>&nbsp;<span class="op" id="2629913">=</span>&nbsp;<span class="ident" id="2629915">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2629922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2629926">if</span>&nbsp;<span class="ident" id="2629929"><a href="/net/ipsock.go.html#2629284">ipv4</a></span>&nbsp;<span class="op" id="2629934">&amp;&amp;</span>&nbsp;<span class="ident" id="2629937"><a href="/net/ipsock.go.html#2629290">ipv6</a></span>&nbsp;<span class="op" id="2629942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2629947">if</span>&nbsp;<span class="ident" id="2629950"><a href="/net/ipsock.go.html#2629296">swap</a></span>&nbsp;<span class="op" id="2629955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2629961"><a href="/net/ipsock.go.html#2629308">list</a></span><span class="op" id="2629965">[</span><span class="num" id="2629966">0</span><span class="op" id="2629967">]</span><span class="op" id="2629968">,</span>&nbsp;<span class="ident" id="2629970"><a href="/net/ipsock.go.html#2629308">list</a></span><span class="op" id="2629974">[</span><span class="num" id="2629975">1</span><span class="op" id="2629976">]</span>&nbsp;<span class="op" id="2629978">=</span>&nbsp;<span class="ident" id="2629980"><a href="/net/ipsock.go.html#2629308">list</a></span><span class="op" id="2629984">[</span><span class="num" id="2629985">1</span><span class="op" id="2629986">]</span><span class="op" id="2629987">,</span>&nbsp;<span class="ident" id="2629989"><a href="/net/ipsock.go.html#2629308">list</a></span><span class="op" id="2629993">[</span><span class="num" id="2629994">0</span><span class="op" id="2629995">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2630000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630005">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2630013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2630016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630019">switch</span>&nbsp;<span class="builtinfunc" id="2630026">len</span><span class="op" id="2630029">(</span><span class="ident" id="2630030"><a href="/net/ipsock.go.html#2629308">list</a></span><span class="op" id="2630034">)</span>&nbsp;<span class="op" id="2630036">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630039">case</span>&nbsp;<span class="num" id="2630044">0</span><span class="op" id="2630045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630049">return</span>&nbsp;<span class="ident" id="2630056">nil</span><span class="op" id="2630059">,</span>&nbsp;<span class="ident" id="2630061"><a href="/net/ipsock.go.html#2628779">errNoSuitableAddress</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630083">case</span>&nbsp;<span class="num" id="2630088">1</span><span class="op" id="2630089">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630093">return</span>&nbsp;<span class="ident" id="2630100"><a href="/net/ipsock.go.html#2629308">list</a></span><span class="op" id="2630104">[</span><span class="num" id="2630105">0</span><span class="op" id="2630106">]</span><span class="op" id="2630107">,</span>&nbsp;<span class="ident" id="2630109">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630114">default</span><span class="op" id="2630121">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630125">return</span>&nbsp;<span class="ident" id="2630132"><a href="/net/ipsock.go.html#2629308">list</a></span><span class="op" id="2630136">,</span>&nbsp;<span class="ident" id="2630138">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2630143">}</span><br>
<span class="lineno"></span><span class="op" id="2630145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2630148">func</span>&nbsp;<span class="ident" id="2630153">firstSupportedAddr</span><span class="op" id="2630171">(</span><span class="ident" id="2630172">filter</span>&nbsp;<span class="keyword" id="2630179">func</span><span class="op" id="2630183">(</span><span class="ident" id="2630184"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2630186">)</span>&nbsp;<span class="ident" id="2630188"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2630190">,</span>&nbsp;<span class="ident" id="2630192">ips</span>&nbsp;<span class="op" id="2630196">[</span><span class="op" id="2630197">]</span><span class="ident" id="2630198"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2630200">,</span>&nbsp;<span class="ident" id="2630202">inetaddr</span>&nbsp;<span class="keyword" id="2630211">func</span><span class="op" id="2630215">(</span><span class="ident" id="2630216"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2630218">)</span>&nbsp;<span class="ident" id="2630220"><a href="/net/ipsock.go.html#2628205">netaddr</a></span><span class="op" id="2630227">)</span>&nbsp;<span class="op" id="2630229">(</span><span class="ident" id="2630230"><a href="/net/ipsock.go.html#2628205">netaddr</a></span><span class="op" id="2630237">,</span>&nbsp;<span class="builtintype" id="2630239">error</span><span class="op" id="2630244">)</span>&nbsp;<span class="op" id="2630246">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630249">for</span>&nbsp;<span class="ident" id="2630253">_</span><span class="op" id="2630254">,</span>&nbsp;<span class="ident" id="2630256">ip</span>&nbsp;<span class="op" id="2630259">:=</span>&nbsp;<span class="keyword" id="2630262">range</span>&nbsp;<span class="ident" id="2630268"><a href="/net/ipsock.go.html#2630192">ips</a></span>&nbsp;<span class="op" id="2630272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630276">if</span>&nbsp;<span class="ident" id="2630279">ip</span>&nbsp;<span class="op" id="2630282">:=</span>&nbsp;<span class="ident" id="2630285"><a href="/net/ipsock.go.html#2630172">filter</a></span><span class="op" id="2630291">(</span><span class="ident" id="2630292"><a href="/net/ipsock.go.html#2630256">ip</a></span><span class="op" id="2630294">)</span><span class="op" id="2630295">;</span>&nbsp;<span class="ident" id="2630297"><a href="/net/ipsock.go.html#2630279">ip</a></span>&nbsp;<span class="op" id="2630300">!=</span>&nbsp;<span class="ident" id="2630303">nil</span>&nbsp;<span class="op" id="2630307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630312">return</span>&nbsp;<span class="ident" id="2630319"><a href="/net/ipsock.go.html#2630202">inetaddr</a></span><span class="op" id="2630327">(</span><span class="ident" id="2630328"><a href="/net/ipsock.go.html#2630279">ip</a></span><span class="op" id="2630330">)</span><span class="op" id="2630331">,</span>&nbsp;<span class="ident" id="2630333">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2630339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2630342">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630345">return</span>&nbsp;<span class="ident" id="2630352">nil</span><span class="op" id="2630355">,</span>&nbsp;<span class="ident" id="2630357"><a href="/net/ipsock.go.html#2628779">errNoSuitableAddress</a></span><br>
<span class="lineno"></span><span class="op" id="2630378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2630381">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="2630450">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="2630523">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2630552">func</span>&nbsp;<span class="ident" id="2630557">ipv4only</span><span class="op" id="2630565">(</span><span class="ident" id="2630566">ip</span>&nbsp;<span class="ident" id="2630569"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2630571">)</span>&nbsp;<span class="ident" id="2630573"><a href="/net/ip.go.html#2604330">IP</a></span>&nbsp;<span class="op" id="2630576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630579">if</span>&nbsp;<span class="ident" id="2630582"><a href="/net/ipsock.go.html#2627659">supportsIPv4</a></span>&nbsp;<span class="op" id="2630595">&amp;&amp;</span>&nbsp;<span class="ident" id="2630598"><a href="/net/ipsock.go.html#2630566">ip</a></span><span class="op" id="2630600">.</span><span class="ident" id="2630601">To4</span><span class="op" id="2630604">(</span><span class="op" id="2630605">)</span>&nbsp;<span class="op" id="2630607">!=</span>&nbsp;<span class="ident" id="2630610">nil</span>&nbsp;<span class="op" id="2630614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630618">return</span>&nbsp;<span class="ident" id="2630625"><a href="/net/ipsock.go.html#2630566">ip</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2630629">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630632">return</span>&nbsp;<span class="ident" id="2630639">nil</span><br>
<span class="lineno"></span><span class="op" id="2630643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2630646">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="2630715">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="2630783">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="2630847">func</span>&nbsp;<span class="ident" id="2630852">ipv6only</span><span class="op" id="2630860">(</span><span class="ident" id="2630861">ip</span>&nbsp;<span class="ident" id="2630864"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2630866">)</span>&nbsp;<span class="ident" id="2630868"><a href="/net/ip.go.html#2604330">IP</a></span>&nbsp;<span class="op" id="2630871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630874">if</span>&nbsp;<span class="ident" id="2630877"><a href="/net/ipsock.go.html#2627769">supportsIPv6</a></span>&nbsp;<span class="op" id="2630890">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2630893">len</span><span class="op" id="2630896">(</span><span class="ident" id="2630897"><a href="/net/ipsock.go.html#2630861">ip</a></span><span class="op" id="2630899">)</span>&nbsp;<span class="op" id="2630901">==</span>&nbsp;<span class="ident" id="2630904"><a href="/net/ip.go.html#2603923">IPv6len</a></span>&nbsp;<span class="op" id="2630912">&amp;&amp;</span>&nbsp;<span class="ident" id="2630915"><a href="/net/ipsock.go.html#2630861">ip</a></span><span class="op" id="2630917">.</span><span class="ident" id="2630918">To4</span><span class="op" id="2630921">(</span><span class="op" id="2630922">)</span>&nbsp;<span class="op" id="2630924">==</span>&nbsp;<span class="ident" id="2630927">nil</span>&nbsp;<span class="op" id="2630931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630935">return</span>&nbsp;<span class="ident" id="2630942"><a href="/net/ipsock.go.html#2630861">ip</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2630946">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2630949">return</span>&nbsp;<span class="ident" id="2630956">nil</span><br>
<span class="lineno"></span><span class="op" id="2630960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2630963">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="2631030">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="2631087">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="2631156">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="2631214">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="2631262">func</span>&nbsp;<span class="ident" id="2631267">SplitHostPort</span><span class="op" id="2631280">(</span><span class="ident" id="2631281">hostport</span>&nbsp;<span class="builtintype" id="2631290">string</span><span class="op" id="2631296">)</span>&nbsp;<span class="op" id="2631298">(</span><span class="ident" id="2631299">host</span><span class="op" id="2631303">,</span>&nbsp;<span class="ident" id="2631305">port</span>&nbsp;<span class="builtintype" id="2631310">string</span><span class="op" id="2631316">,</span>&nbsp;<span class="ident" id="2631318">err</span>&nbsp;<span class="builtintype" id="2631322">error</span><span class="op" id="2631327">)</span>&nbsp;<span class="op" id="2631329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2631332">j</span><span class="op" id="2631333">,</span>&nbsp;<span class="ident" id="2631335">k</span>&nbsp;<span class="op" id="2631337">:=</span>&nbsp;<span class="num" id="2631340">0</span><span class="op" id="2631341">,</span>&nbsp;<span class="num" id="2631343">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2631347">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2631389">i</span>&nbsp;<span class="op" id="2631391">:=</span>&nbsp;<span class="ident" id="2631394"><a href="/net/parse.go.html#2667199">last</a></span><span class="op" id="2631398">(</span><span class="ident" id="2631399"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2631407">,</span>&nbsp;<span class="string" id="2631409">&#39;:&#39;</span><span class="op" id="2631412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631415">if</span>&nbsp;<span class="ident" id="2631418"><a href="/net/ipsock.go.html#2631389">i</a></span>&nbsp;<span class="op" id="2631420">&lt;</span>&nbsp;<span class="num" id="2631422">0</span>&nbsp;<span class="op" id="2631424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631428">goto</span>&nbsp;<span class="ident" id="2631433">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2631446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631450">if</span>&nbsp;<span class="ident" id="2631453"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2631461">[</span><span class="num" id="2631462">0</span><span class="op" id="2631463">]</span>&nbsp;<span class="op" id="2631465">==</span>&nbsp;<span class="string" id="2631468">&#39;[&#39;</span>&nbsp;<span class="op" id="2631472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2631476">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2631528">end</span>&nbsp;<span class="op" id="2631532">:=</span>&nbsp;<span class="ident" id="2631535"><a href="/net/parse.go.html#2664110">byteIndex</a></span><span class="op" id="2631544">(</span><span class="ident" id="2631545"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2631553">,</span>&nbsp;<span class="string" id="2631555">&#39;]&#39;</span><span class="op" id="2631558">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631562">if</span>&nbsp;<span class="ident" id="2631565"><a href="/net/ipsock.go.html#2631528">end</a></span>&nbsp;<span class="op" id="2631569">&lt;</span>&nbsp;<span class="num" id="2631571">0</span>&nbsp;<span class="op" id="2631573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2631578"><a href="/net/ipsock.go.html#2631318">err</a></span>&nbsp;<span class="op" id="2631582">=</span>&nbsp;<span class="op" id="2631584">&amp;</span><span class="ident" id="2631585"><a href="/net/net.go.html#2660706">AddrError</a></span><span class="op" id="2631594">{</span><span class="string" id="2631595">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="2631619">,</span>&nbsp;<span class="ident" id="2631621"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2631629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631634">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2631643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631647">switch</span>&nbsp;<span class="ident" id="2631654"><a href="/net/ipsock.go.html#2631528">end</a></span>&nbsp;<span class="op" id="2631658">+</span>&nbsp;<span class="num" id="2631660">1</span>&nbsp;<span class="op" id="2631662">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631666">case</span>&nbsp;<span class="builtinfunc" id="2631671">len</span><span class="op" id="2631674">(</span><span class="ident" id="2631675"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2631683">)</span><span class="op" id="2631684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2631689">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631736">goto</span>&nbsp;<span class="ident" id="2631741">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631755">case</span>&nbsp;<span class="ident" id="2631760"><a href="/net/ipsock.go.html#2631389">i</a></span><span class="op" id="2631761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2631766">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631792">default</span><span class="op" id="2631799">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2631804">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2631857">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631909">if</span>&nbsp;<span class="ident" id="2631912"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2631920">[</span><span class="ident" id="2631921"><a href="/net/ipsock.go.html#2631528">end</a></span><span class="op" id="2631924">+</span><span class="num" id="2631925">1</span><span class="op" id="2631926">]</span>&nbsp;<span class="op" id="2631928">==</span>&nbsp;<span class="string" id="2631931">&#39;:&#39;</span>&nbsp;<span class="op" id="2631935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631941">goto</span>&nbsp;<span class="ident" id="2631946">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2631963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2631968">goto</span>&nbsp;<span class="ident" id="2631973">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2631987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2631991"><a href="/net/ipsock.go.html#2631299">host</a></span>&nbsp;<span class="op" id="2631996">=</span>&nbsp;<span class="ident" id="2631998"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2632006">[</span><span class="num" id="2632007">1</span><span class="op" id="2632008">:</span><span class="ident" id="2632009"><a href="/net/ipsock.go.html#2631528">end</a></span><span class="op" id="2632012">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2632016"><a href="/net/ipsock.go.html#2631332">j</a></span><span class="op" id="2632017">,</span>&nbsp;<span class="ident" id="2632019"><a href="/net/ipsock.go.html#2631335">k</a></span>&nbsp;<span class="op" id="2632021">=</span>&nbsp;<span class="num" id="2632023">1</span><span class="op" id="2632024">,</span>&nbsp;<span class="ident" id="2632026"><a href="/net/ipsock.go.html#2631528">end</a></span><span class="op" id="2632029">+</span><span class="num" id="2632030">1</span>&nbsp;<span class="comment" id="2632032">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2632090">}</span>&nbsp;<span class="keyword" id="2632092">else</span>&nbsp;<span class="op" id="2632097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2632101"><a href="/net/ipsock.go.html#2631299">host</a></span>&nbsp;<span class="op" id="2632106">=</span>&nbsp;<span class="ident" id="2632108"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2632116">[</span><span class="op" id="2632117">:</span><span class="ident" id="2632118"><a href="/net/ipsock.go.html#2631389">i</a></span><span class="op" id="2632119">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632123">if</span>&nbsp;<span class="ident" id="2632126"><a href="/net/parse.go.html#2664110">byteIndex</a></span><span class="op" id="2632135">(</span><span class="ident" id="2632136"><a href="/net/ipsock.go.html#2631299">host</a></span><span class="op" id="2632140">,</span>&nbsp;<span class="string" id="2632142">&#39;:&#39;</span><span class="op" id="2632145">)</span>&nbsp;<span class="op" id="2632147">&gt;=</span>&nbsp;<span class="num" id="2632150">0</span>&nbsp;<span class="op" id="2632152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632157">goto</span>&nbsp;<span class="ident" id="2632162">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2632178">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632182">if</span>&nbsp;<span class="ident" id="2632185"><a href="/net/parse.go.html#2664110">byteIndex</a></span><span class="op" id="2632194">(</span><span class="ident" id="2632195"><a href="/net/ipsock.go.html#2631299">host</a></span><span class="op" id="2632199">,</span>&nbsp;<span class="string" id="2632201">&#39;%&#39;</span><span class="op" id="2632204">)</span>&nbsp;<span class="op" id="2632206">&gt;=</span>&nbsp;<span class="num" id="2632209">0</span>&nbsp;<span class="op" id="2632211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632216">goto</span>&nbsp;<span class="ident" id="2632221">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2632239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2632242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632245">if</span>&nbsp;<span class="ident" id="2632248"><a href="/net/parse.go.html#2664110">byteIndex</a></span><span class="op" id="2632257">(</span><span class="ident" id="2632258"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2632266">[</span><span class="ident" id="2632267"><a href="/net/ipsock.go.html#2631332">j</a></span><span class="op" id="2632268">:</span><span class="op" id="2632269">]</span><span class="op" id="2632270">,</span>&nbsp;<span class="string" id="2632272">&#39;[&#39;</span><span class="op" id="2632275">)</span>&nbsp;<span class="op" id="2632277">&gt;=</span>&nbsp;<span class="num" id="2632280">0</span>&nbsp;<span class="op" id="2632282">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2632286"><a href="/net/ipsock.go.html#2631318">err</a></span>&nbsp;<span class="op" id="2632290">=</span>&nbsp;<span class="op" id="2632292">&amp;</span><span class="ident" id="2632293"><a href="/net/net.go.html#2660706">AddrError</a></span><span class="op" id="2632302">{</span><span class="string" id="2632303">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="2632330">,</span>&nbsp;<span class="ident" id="2632332"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2632340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632344">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2632352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632355">if</span>&nbsp;<span class="ident" id="2632358"><a href="/net/parse.go.html#2664110">byteIndex</a></span><span class="op" id="2632367">(</span><span class="ident" id="2632368"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2632376">[</span><span class="ident" id="2632377"><a href="/net/ipsock.go.html#2631335">k</a></span><span class="op" id="2632378">:</span><span class="op" id="2632379">]</span><span class="op" id="2632380">,</span>&nbsp;<span class="string" id="2632382">&#39;]&#39;</span><span class="op" id="2632385">)</span>&nbsp;<span class="op" id="2632387">&gt;=</span>&nbsp;<span class="num" id="2632390">0</span>&nbsp;<span class="op" id="2632392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2632396"><a href="/net/ipsock.go.html#2631318">err</a></span>&nbsp;<span class="op" id="2632400">=</span>&nbsp;<span class="op" id="2632402">&amp;</span><span class="ident" id="2632403"><a href="/net/net.go.html#2660706">AddrError</a></span><span class="op" id="2632412">{</span><span class="string" id="2632413">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="2632440">,</span>&nbsp;<span class="ident" id="2632442"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2632450">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632454">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2632462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2632466"><a href="/net/ipsock.go.html#2631305">port</a></span>&nbsp;<span class="op" id="2632471">=</span>&nbsp;<span class="ident" id="2632473"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2632481">[</span><span class="ident" id="2632482"><a href="/net/ipsock.go.html#2631389">i</a></span><span class="op" id="2632483">+</span><span class="num" id="2632484">1</span><span class="op" id="2632485">:</span><span class="op" id="2632486">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632489">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="2632497">missingPort</span><span class="op" id="2632508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2632511"><a href="/net/ipsock.go.html#2631318">err</a></span>&nbsp;<span class="op" id="2632515">=</span>&nbsp;<span class="op" id="2632517">&amp;</span><span class="ident" id="2632518"><a href="/net/net.go.html#2660706">AddrError</a></span><span class="op" id="2632527">{</span><span class="string" id="2632528">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="2632553">,</span>&nbsp;<span class="ident" id="2632555"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2632563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632566">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="2632574">tooManyColons</span><span class="op" id="2632587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2632590"><a href="/net/ipsock.go.html#2631318">err</a></span>&nbsp;<span class="op" id="2632594">=</span>&nbsp;<span class="op" id="2632596">&amp;</span><span class="ident" id="2632597"><a href="/net/net.go.html#2660706">AddrError</a></span><span class="op" id="2632606">{</span><span class="string" id="2632607">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="2632635">,</span>&nbsp;<span class="ident" id="2632637"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2632645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632648">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="2632656">missingBrackets</span><span class="op" id="2632671">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2632674"><a href="/net/ipsock.go.html#2631318">err</a></span>&nbsp;<span class="op" id="2632678">=</span>&nbsp;<span class="op" id="2632680">&amp;</span><span class="ident" id="2632681"><a href="/net/net.go.html#2660706">AddrError</a></span><span class="op" id="2632690">{</span><span class="string" id="2632691">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="2632720">,</span>&nbsp;<span class="ident" id="2632722"><a href="/net/ipsock.go.html#2631281">hostport</a></span><span class="op" id="2632730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632733">return</span><br>
<span class="lineno"></span><span class="op" id="2632740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2632743">func</span>&nbsp;<span class="ident" id="2632748">splitHostZone</span><span class="op" id="2632761">(</span><span class="ident" id="2632762">s</span>&nbsp;<span class="builtintype" id="2632764">string</span><span class="op" id="2632770">)</span>&nbsp;<span class="op" id="2632772">(</span><span class="ident" id="2632773">host</span><span class="op" id="2632777">,</span>&nbsp;<span class="ident" id="2632779">zone</span>&nbsp;<span class="builtintype" id="2632784">string</span><span class="op" id="2632790">)</span>&nbsp;<span class="op" id="2632792">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2632795">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2632859">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632882">if</span>&nbsp;<span class="ident" id="2632885">i</span>&nbsp;<span class="op" id="2632887">:=</span>&nbsp;<span class="ident" id="2632890"><a href="/net/parse.go.html#2667199">last</a></span><span class="op" id="2632894">(</span><span class="ident" id="2632895"><a href="/net/ipsock.go.html#2632762">s</a></span><span class="op" id="2632896">,</span>&nbsp;<span class="string" id="2632898">&#39;%&#39;</span><span class="op" id="2632901">)</span><span class="op" id="2632902">;</span>&nbsp;<span class="ident" id="2632904"><a href="/net/ipsock.go.html#2632885">i</a></span>&nbsp;<span class="op" id="2632906">&gt;</span>&nbsp;<span class="num" id="2632908">0</span>&nbsp;<span class="op" id="2632910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2632914"><a href="/net/ipsock.go.html#2632773">host</a></span><span class="op" id="2632918">,</span>&nbsp;<span class="ident" id="2632920"><a href="/net/ipsock.go.html#2632779">zone</a></span>&nbsp;<span class="op" id="2632925">=</span>&nbsp;<span class="ident" id="2632927"><a href="/net/ipsock.go.html#2632762">s</a></span><span class="op" id="2632928">[</span><span class="op" id="2632929">:</span><span class="ident" id="2632930"><a href="/net/ipsock.go.html#2632885">i</a></span><span class="op" id="2632931">]</span><span class="op" id="2632932">,</span>&nbsp;<span class="ident" id="2632934"><a href="/net/ipsock.go.html#2632762">s</a></span><span class="op" id="2632935">[</span><span class="ident" id="2632936"><a href="/net/ipsock.go.html#2632885">i</a></span><span class="op" id="2632937">+</span><span class="num" id="2632938">1</span><span class="op" id="2632939">:</span><span class="op" id="2632940">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2632943">}</span>&nbsp;<span class="keyword" id="2632945">else</span>&nbsp;<span class="op" id="2632950">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2632954"><a href="/net/ipsock.go.html#2632773">host</a></span>&nbsp;<span class="op" id="2632959">=</span>&nbsp;<span class="ident" id="2632961"><a href="/net/ipsock.go.html#2632762">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2632964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2632967">return</span><br>
<span class="lineno"></span><span class="op" id="2632974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="2632977">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2633046">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="2633114">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="2633132">func</span>&nbsp;<span class="ident" id="2633137">JoinHostPort</span><span class="op" id="2633149">(</span><span class="ident" id="2633150">host</span><span class="op" id="2633154">,</span>&nbsp;<span class="ident" id="2633156">port</span>&nbsp;<span class="builtintype" id="2633161">string</span><span class="op" id="2633167">)</span>&nbsp;<span class="builtintype" id="2633169">string</span>&nbsp;<span class="op" id="2633176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2633179">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2633241">if</span>&nbsp;<span class="ident" id="2633244"><a href="/net/parse.go.html#2664110">byteIndex</a></span><span class="op" id="2633253">(</span><span class="ident" id="2633254"><a href="/net/ipsock.go.html#2633150">host</a></span><span class="op" id="2633258">,</span>&nbsp;<span class="string" id="2633260">&#39;:&#39;</span><span class="op" id="2633263">)</span>&nbsp;<span class="op" id="2633265">&gt;=</span>&nbsp;<span class="num" id="2633268">0</span>&nbsp;<span class="op" id="2633270">||</span>&nbsp;<span class="ident" id="2633273"><a href="/net/parse.go.html#2664110">byteIndex</a></span><span class="op" id="2633282">(</span><span class="ident" id="2633283"><a href="/net/ipsock.go.html#2633150">host</a></span><span class="op" id="2633287">,</span>&nbsp;<span class="string" id="2633289">&#39;%&#39;</span><span class="op" id="2633292">)</span>&nbsp;<span class="op" id="2633294">&gt;=</span>&nbsp;<span class="num" id="2633297">0</span>&nbsp;<span class="op" id="2633299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2633303">return</span>&nbsp;<span class="string" id="2633310">&#34;[&#34;</span>&nbsp;<span class="op" id="2633314">+</span>&nbsp;<span class="ident" id="2633316"><a href="/net/ipsock.go.html#2633150">host</a></span>&nbsp;<span class="op" id="2633321">+</span>&nbsp;<span class="string" id="2633323">&#34;]:&#34;</span>&nbsp;<span class="op" id="2633328">+</span>&nbsp;<span class="ident" id="2633330"><a href="/net/ipsock.go.html#2633156">port</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2633336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2633339">return</span>&nbsp;<span class="ident" id="2633346"><a href="/net/ipsock.go.html#2633150">host</a></span>&nbsp;<span class="op" id="2633351">+</span>&nbsp;<span class="string" id="2633353">&#34;:&#34;</span>&nbsp;<span class="op" id="2633357">+</span>&nbsp;<span class="ident" id="2633359"><a href="/net/ipsock.go.html#2633156">port</a></span><br>
<span class="lineno"></span><span class="op" id="2633364">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="2633367">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="2633432">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="2633497">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="2633561">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="2633630">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="2633699">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2633729">func</span>&nbsp;<span class="ident" id="2633734">resolveInternetAddr</span><span class="op" id="2633753">(</span><span class="ident" id="2633754">net</span><span class="op" id="2633757">,</span>&nbsp;<span class="ident" id="2633759">addr</span>&nbsp;<span class="builtintype" id="2633764">string</span><span class="op" id="2633770">,</span>&nbsp;<span class="ident" id="2633772">deadline</span>&nbsp;<span class="ident" id="2633781"><a href="/net/ipsock.go.html#2627552">time</a></span><span class="op" id="2633785">.</span><span class="ident" id="2633786">Time</span><span class="op" id="2633790">)</span>&nbsp;<span class="op" id="2633792">(</span><span class="ident" id="2633793"><a href="/net/ipsock.go.html#2628205">netaddr</a></span><span class="op" id="2633800">,</span>&nbsp;<span class="builtintype" id="2633802">error</span><span class="op" id="2633807">)</span>&nbsp;<span class="op" id="2633809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2633812">var</span>&nbsp;<span class="op" id="2633816">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2633820">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2633837">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2633845">host</span><span class="op" id="2633849">,</span>&nbsp;<span class="ident" id="2633851">port</span><span class="op" id="2633855">,</span>&nbsp;<span class="ident" id="2633857">zone</span>&nbsp;<span class="builtintype" id="2633862">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2633871">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2633888">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2633893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2633896">switch</span>&nbsp;<span class="ident" id="2633903"><a href="/net/ipsock.go.html#2633754">net</a></span>&nbsp;<span class="op" id="2633907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2633910">case</span>&nbsp;<span class="string" id="2633915">&#34;tcp&#34;</span><span class="op" id="2633920">,</span>&nbsp;<span class="string" id="2633922">&#34;tcp4&#34;</span><span class="op" id="2633928">,</span>&nbsp;<span class="string" id="2633930">&#34;tcp6&#34;</span><span class="op" id="2633936">,</span>&nbsp;<span class="string" id="2633938">&#34;udp&#34;</span><span class="op" id="2633943">,</span>&nbsp;<span class="string" id="2633945">&#34;udp4&#34;</span><span class="op" id="2633951">,</span>&nbsp;<span class="string" id="2633953">&#34;udp6&#34;</span><span class="op" id="2633959">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2633963">if</span>&nbsp;<span class="ident" id="2633966"><a href="/net/ipsock.go.html#2633759">addr</a></span>&nbsp;<span class="op" id="2633971">!=</span>&nbsp;<span class="string" id="2633974">&#34;&#34;</span>&nbsp;<span class="op" id="2633977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2633982">if</span>&nbsp;<span class="ident" id="2633985"><a href="/net/ipsock.go.html#2633845">host</a></span><span class="op" id="2633989">,</span>&nbsp;<span class="ident" id="2633991"><a href="/net/ipsock.go.html#2633851">port</a></span><span class="op" id="2633995">,</span>&nbsp;<span class="ident" id="2633997"><a href="/net/ipsock.go.html#2633820">err</a></span>&nbsp;<span class="op" id="2634001">=</span>&nbsp;<span class="ident" id="2634003"><a href="/net/ipsock.go.html#2631267">SplitHostPort</a></span><span class="op" id="2634016">(</span><span class="ident" id="2634017"><a href="/net/ipsock.go.html#2633759">addr</a></span><span class="op" id="2634021">)</span><span class="op" id="2634022">;</span>&nbsp;<span class="ident" id="2634024"><a href="/net/ipsock.go.html#2633820">err</a></span>&nbsp;<span class="op" id="2634028">!=</span>&nbsp;<span class="ident" id="2634031">nil</span>&nbsp;<span class="op" id="2634035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634041">return</span>&nbsp;<span class="ident" id="2634048">nil</span><span class="op" id="2634051">,</span>&nbsp;<span class="ident" id="2634053"><a href="/net/ipsock.go.html#2633820">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2634060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634065">if</span>&nbsp;<span class="ident" id="2634068"><a href="/net/ipsock.go.html#2633871">portnum</a></span><span class="op" id="2634075">,</span>&nbsp;<span class="ident" id="2634077"><a href="/net/ipsock.go.html#2633820">err</a></span>&nbsp;<span class="op" id="2634081">=</span>&nbsp;<span class="ident" id="2634083"><a href="/net/port.go.html#2668951">parsePort</a></span><span class="op" id="2634092">(</span><span class="ident" id="2634093"><a href="/net/ipsock.go.html#2633754">net</a></span><span class="op" id="2634096">,</span>&nbsp;<span class="ident" id="2634098"><a href="/net/ipsock.go.html#2633851">port</a></span><span class="op" id="2634102">)</span><span class="op" id="2634103">;</span>&nbsp;<span class="ident" id="2634105"><a href="/net/ipsock.go.html#2633820">err</a></span>&nbsp;<span class="op" id="2634109">!=</span>&nbsp;<span class="ident" id="2634112">nil</span>&nbsp;<span class="op" id="2634116">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634122">return</span>&nbsp;<span class="ident" id="2634129">nil</span><span class="op" id="2634132">,</span>&nbsp;<span class="ident" id="2634134"><a href="/net/ipsock.go.html#2633820">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2634141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2634145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634148">case</span>&nbsp;<span class="string" id="2634153">&#34;ip&#34;</span><span class="op" id="2634157">,</span>&nbsp;<span class="string" id="2634159">&#34;ip4&#34;</span><span class="op" id="2634164">,</span>&nbsp;<span class="string" id="2634166">&#34;ip6&#34;</span><span class="op" id="2634171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634175">if</span>&nbsp;<span class="ident" id="2634178"><a href="/net/ipsock.go.html#2633759">addr</a></span>&nbsp;<span class="op" id="2634183">!=</span>&nbsp;<span class="string" id="2634186">&#34;&#34;</span>&nbsp;<span class="op" id="2634189">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2634194"><a href="/net/ipsock.go.html#2633845">host</a></span>&nbsp;<span class="op" id="2634199">=</span>&nbsp;<span class="ident" id="2634201"><a href="/net/ipsock.go.html#2633759">addr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2634208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634211">default</span><span class="op" id="2634218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634222">return</span>&nbsp;<span class="ident" id="2634229">nil</span><span class="op" id="2634232">,</span>&nbsp;<span class="ident" id="2634234"><a href="/net/net.go.html#2661008">UnknownNetworkError</a></span><span class="op" id="2634253">(</span><span class="ident" id="2634254"><a href="/net/ipsock.go.html#2633754">net</a></span><span class="op" id="2634257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2634260">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2634263">inetaddr</span>&nbsp;<span class="op" id="2634272">:=</span>&nbsp;<span class="keyword" id="2634275">func</span><span class="op" id="2634279">(</span><span class="ident" id="2634280">ip</span>&nbsp;<span class="ident" id="2634283"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2634285">)</span>&nbsp;<span class="ident" id="2634287"><a href="/net/ipsock.go.html#2628205">netaddr</a></span>&nbsp;<span class="op" id="2634295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634299">switch</span>&nbsp;<span class="ident" id="2634306"><a href="/net/ipsock.go.html#2633754">net</a></span>&nbsp;<span class="op" id="2634310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634314">case</span>&nbsp;<span class="string" id="2634319">&#34;tcp&#34;</span><span class="op" id="2634324">,</span>&nbsp;<span class="string" id="2634326">&#34;tcp4&#34;</span><span class="op" id="2634332">,</span>&nbsp;<span class="string" id="2634334">&#34;tcp6&#34;</span><span class="op" id="2634340">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634345">return</span>&nbsp;<span class="op" id="2634352">&amp;</span><span class="ident" id="2634353"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="2634360">{</span><span class="ident" id="2634361">IP</span><span class="op" id="2634363">:</span>&nbsp;<span class="ident" id="2634365"><a href="/net/ipsock.go.html#2634280">ip</a></span><span class="op" id="2634367">,</span>&nbsp;<span class="ident" id="2634369">Port</span><span class="op" id="2634373">:</span>&nbsp;<span class="ident" id="2634375"><a href="/net/ipsock.go.html#2633871">portnum</a></span><span class="op" id="2634382">,</span>&nbsp;<span class="ident" id="2634384">Zone</span><span class="op" id="2634388">:</span>&nbsp;<span class="ident" id="2634390"><a href="/net/ipsock.go.html#2633857">zone</a></span><span class="op" id="2634394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634398">case</span>&nbsp;<span class="string" id="2634403">&#34;udp&#34;</span><span class="op" id="2634408">,</span>&nbsp;<span class="string" id="2634410">&#34;udp4&#34;</span><span class="op" id="2634416">,</span>&nbsp;<span class="string" id="2634418">&#34;udp6&#34;</span><span class="op" id="2634424">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634429">return</span>&nbsp;<span class="op" id="2634436">&amp;</span><span class="ident" id="2634437"><a href="/net/udpsock.go.html#2703901">UDPAddr</a></span><span class="op" id="2634444">{</span><span class="ident" id="2634445">IP</span><span class="op" id="2634447">:</span>&nbsp;<span class="ident" id="2634449"><a href="/net/ipsock.go.html#2634280">ip</a></span><span class="op" id="2634451">,</span>&nbsp;<span class="ident" id="2634453">Port</span><span class="op" id="2634457">:</span>&nbsp;<span class="ident" id="2634459"><a href="/net/ipsock.go.html#2633871">portnum</a></span><span class="op" id="2634466">,</span>&nbsp;<span class="ident" id="2634468">Zone</span><span class="op" id="2634472">:</span>&nbsp;<span class="ident" id="2634474"><a href="/net/ipsock.go.html#2633857">zone</a></span><span class="op" id="2634478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634482">case</span>&nbsp;<span class="string" id="2634487">&#34;ip&#34;</span><span class="op" id="2634491">,</span>&nbsp;<span class="string" id="2634493">&#34;ip4&#34;</span><span class="op" id="2634498">,</span>&nbsp;<span class="string" id="2634500">&#34;ip6&#34;</span><span class="op" id="2634505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634510">return</span>&nbsp;<span class="op" id="2634517">&amp;</span><span class="ident" id="2634518"><a href="/net/iprawsock.go.html#2619177">IPAddr</a></span><span class="op" id="2634524">{</span><span class="ident" id="2634525">IP</span><span class="op" id="2634527">:</span>&nbsp;<span class="ident" id="2634529"><a href="/net/ipsock.go.html#2634280">ip</a></span><span class="op" id="2634531">,</span>&nbsp;<span class="ident" id="2634533">Zone</span><span class="op" id="2634537">:</span>&nbsp;<span class="ident" id="2634539"><a href="/net/ipsock.go.html#2633857">zone</a></span><span class="op" id="2634543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634547">default</span><span class="op" id="2634554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2634559">panic</span><span class="op" id="2634564">(</span><span class="string" id="2634565">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="2634588">+</span>&nbsp;<span class="ident" id="2634590"><a href="/net/ipsock.go.html#2633754">net</a></span><span class="op" id="2634593">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2634597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2634600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634603">if</span>&nbsp;<span class="ident" id="2634606"><a href="/net/ipsock.go.html#2633845">host</a></span>&nbsp;<span class="op" id="2634611">==</span>&nbsp;<span class="string" id="2634614">&#34;&#34;</span>&nbsp;<span class="op" id="2634617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634621">return</span>&nbsp;<span class="ident" id="2634628"><a href="/net/ipsock.go.html#2634263">inetaddr</a></span><span class="op" id="2634636">(</span><span class="ident" id="2634637">nil</span><span class="op" id="2634640">)</span><span class="op" id="2634641">,</span>&nbsp;<span class="ident" id="2634643">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2634648">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2634651">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634684">var</span>&nbsp;<span class="ident" id="2634688">ip</span>&nbsp;<span class="ident" id="2634691"><a href="/net/ip.go.html#2604330">IP</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634695">if</span>&nbsp;<span class="ident" id="2634698"><a href="/net/ipsock.go.html#2634688">ip</a></span>&nbsp;<span class="op" id="2634701">=</span>&nbsp;<span class="ident" id="2634703"><a href="/net/ip.go.html#2614866">parseIPv4</a></span><span class="op" id="2634712">(</span><span class="ident" id="2634713"><a href="/net/ipsock.go.html#2633845">host</a></span><span class="op" id="2634717">)</span><span class="op" id="2634718">;</span>&nbsp;<span class="ident" id="2634720"><a href="/net/ipsock.go.html#2634688">ip</a></span>&nbsp;<span class="op" id="2634723">!=</span>&nbsp;<span class="ident" id="2634726">nil</span>&nbsp;<span class="op" id="2634730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634734">return</span>&nbsp;<span class="ident" id="2634741"><a href="/net/ipsock.go.html#2634263">inetaddr</a></span><span class="op" id="2634749">(</span><span class="ident" id="2634750"><a href="/net/ipsock.go.html#2634688">ip</a></span><span class="op" id="2634752">)</span><span class="op" id="2634753">,</span>&nbsp;<span class="ident" id="2634755">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2634760">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634763">if</span>&nbsp;<span class="ident" id="2634766"><a href="/net/ipsock.go.html#2634688">ip</a></span><span class="op" id="2634768">,</span>&nbsp;<span class="ident" id="2634770"><a href="/net/ipsock.go.html#2633857">zone</a></span>&nbsp;<span class="op" id="2634775">=</span>&nbsp;<span class="ident" id="2634777"><a href="/net/ip.go.html#2615492">parseIPv6</a></span><span class="op" id="2634786">(</span><span class="ident" id="2634787"><a href="/net/ipsock.go.html#2633845">host</a></span><span class="op" id="2634791">,</span>&nbsp;<span class="ident" id="2634793">true</span><span class="op" id="2634797">)</span><span class="op" id="2634798">;</span>&nbsp;<span class="ident" id="2634800"><a href="/net/ipsock.go.html#2634688">ip</a></span>&nbsp;<span class="op" id="2634803">!=</span>&nbsp;<span class="ident" id="2634806">nil</span>&nbsp;<span class="op" id="2634810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634814">return</span>&nbsp;<span class="ident" id="2634821"><a href="/net/ipsock.go.html#2634263">inetaddr</a></span><span class="op" id="2634829">(</span><span class="ident" id="2634830"><a href="/net/ipsock.go.html#2634688">ip</a></span><span class="op" id="2634832">)</span><span class="op" id="2634833">,</span>&nbsp;<span class="ident" id="2634835">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2634840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2634843">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2634866"><a href="/net/ipsock.go.html#2633845">host</a></span><span class="op" id="2634870">,</span>&nbsp;<span class="ident" id="2634872"><a href="/net/ipsock.go.html#2633857">zone</a></span>&nbsp;<span class="op" id="2634877">=</span>&nbsp;<span class="ident" id="2634879"><a href="/net/ipsock.go.html#2632748">splitHostZone</a></span><span class="op" id="2634892">(</span><span class="ident" id="2634893"><a href="/net/ipsock.go.html#2633845">host</a></span><span class="op" id="2634897">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2634900">ips</span><span class="op" id="2634903">,</span>&nbsp;<span class="ident" id="2634905"><a href="/net/ipsock.go.html#2633820">err</a></span>&nbsp;<span class="op" id="2634909">:=</span>&nbsp;<span class="ident" id="2634912"><a href="/net/lookup.go.html#2643004">lookupIPDeadline</a></span><span class="op" id="2634928">(</span><span class="ident" id="2634929"><a href="/net/ipsock.go.html#2633845">host</a></span><span class="op" id="2634933">,</span>&nbsp;<span class="ident" id="2634935"><a href="/net/ipsock.go.html#2633772">deadline</a></span><span class="op" id="2634943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634946">if</span>&nbsp;<span class="ident" id="2634949"><a href="/net/ipsock.go.html#2633820">err</a></span>&nbsp;<span class="op" id="2634953">!=</span>&nbsp;<span class="ident" id="2634956">nil</span>&nbsp;<span class="op" id="2634960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634964">return</span>&nbsp;<span class="ident" id="2634971">nil</span><span class="op" id="2634974">,</span>&nbsp;<span class="ident" id="2634976"><a href="/net/ipsock.go.html#2633820">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2634981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2634984">var</span>&nbsp;<span class="ident" id="2634988">filter</span>&nbsp;<span class="keyword" id="2634995">func</span><span class="op" id="2634999">(</span><span class="ident" id="2635000"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2635002">)</span>&nbsp;<span class="ident" id="2635004"><a href="/net/ip.go.html#2604330">IP</a></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635008">if</span>&nbsp;<span class="ident" id="2635011"><a href="/net/ipsock.go.html#2633754">net</a></span>&nbsp;<span class="op" id="2635015">!=</span>&nbsp;<span class="string" id="2635018">&#34;&#34;</span>&nbsp;<span class="op" id="2635021">&amp;&amp;</span>&nbsp;<span class="ident" id="2635024"><a href="/net/ipsock.go.html#2633754">net</a></span><span class="op" id="2635027">[</span><span class="builtinfunc" id="2635028">len</span><span class="op" id="2635031">(</span><span class="ident" id="2635032"><a href="/net/ipsock.go.html#2633754">net</a></span><span class="op" id="2635035">)</span><span class="op" id="2635036">-</span><span class="num" id="2635037">1</span><span class="op" id="2635038">]</span>&nbsp;<span class="op" id="2635040">==</span>&nbsp;<span class="string" id="2635043">&#39;4&#39;</span>&nbsp;<span class="op" id="2635047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2635051"><a href="/net/ipsock.go.html#2634988">filter</a></span>&nbsp;<span class="op" id="2635058">=</span>&nbsp;<span class="ident" id="2635060"><a href="/net/ipsock.go.html#2630557">ipv4only</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2635070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635073">if</span>&nbsp;<span class="ident" id="2635076"><a href="/net/ipsock.go.html#2633754">net</a></span>&nbsp;<span class="op" id="2635080">!=</span>&nbsp;<span class="string" id="2635083">&#34;&#34;</span>&nbsp;<span class="op" id="2635086">&amp;&amp;</span>&nbsp;<span class="ident" id="2635089"><a href="/net/ipsock.go.html#2633754">net</a></span><span class="op" id="2635092">[</span><span class="builtinfunc" id="2635093">len</span><span class="op" id="2635096">(</span><span class="ident" id="2635097"><a href="/net/ipsock.go.html#2633754">net</a></span><span class="op" id="2635100">)</span><span class="op" id="2635101">-</span><span class="num" id="2635102">1</span><span class="op" id="2635103">]</span>&nbsp;<span class="op" id="2635105">==</span>&nbsp;<span class="string" id="2635108">&#39;6&#39;</span>&nbsp;<span class="op" id="2635112">||</span>&nbsp;<span class="ident" id="2635115"><a href="/net/ipsock.go.html#2633857">zone</a></span>&nbsp;<span class="op" id="2635120">!=</span>&nbsp;<span class="string" id="2635123">&#34;&#34;</span>&nbsp;<span class="op" id="2635126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2635130"><a href="/net/ipsock.go.html#2634988">filter</a></span>&nbsp;<span class="op" id="2635137">=</span>&nbsp;<span class="ident" id="2635139"><a href="/net/ipsock.go.html#2630852">ipv6only</a></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2635149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635152">return</span>&nbsp;<span class="ident" id="2635159"><a href="/net/ipsock.go.html#2629107">firstFavoriteAddr</a></span><span class="op" id="2635176">(</span><span class="ident" id="2635177"><a href="/net/ipsock.go.html#2634988">filter</a></span><span class="op" id="2635183">,</span>&nbsp;<span class="ident" id="2635185"><a href="/net/ipsock.go.html#2634900">ips</a></span><span class="op" id="2635188">,</span>&nbsp;<span class="ident" id="2635190"><a href="/net/ipsock.go.html#2634263">inetaddr</a></span><span class="op" id="2635198">)</span><br>
<span class="lineno"></span><span class="op" id="2635200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2635203">func</span>&nbsp;<span class="ident" id="2635208">zoneToString</span><span class="op" id="2635220">(</span><span class="ident" id="2635221">zone</span>&nbsp;<span class="builtintype" id="2635226">int</span><span class="op" id="2635229">)</span>&nbsp;<span class="builtintype" id="2635231">string</span>&nbsp;<span class="op" id="2635238">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635241">if</span>&nbsp;<span class="ident" id="2635244"><a href="/net/ipsock.go.html#2635221">zone</a></span>&nbsp;<span class="op" id="2635249">==</span>&nbsp;<span class="num" id="2635252">0</span>&nbsp;<span class="op" id="2635254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635258">return</span>&nbsp;<span class="string" id="2635265">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2635269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635272">if</span>&nbsp;<span class="ident" id="2635275">ifi</span><span class="op" id="2635278">,</span>&nbsp;<span class="ident" id="2635280">err</span>&nbsp;<span class="op" id="2635284">:=</span>&nbsp;<span class="ident" id="2635287"><a href="/net/interface.go.html#2595390">InterfaceByIndex</a></span><span class="op" id="2635303">(</span><span class="ident" id="2635304"><a href="/net/ipsock.go.html#2635221">zone</a></span><span class="op" id="2635308">)</span><span class="op" id="2635309">;</span>&nbsp;<span class="ident" id="2635311"><a href="/net/ipsock.go.html#2635280">err</a></span>&nbsp;<span class="op" id="2635315">==</span>&nbsp;<span class="ident" id="2635318">nil</span>&nbsp;<span class="op" id="2635322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635326">return</span>&nbsp;<span class="ident" id="2635333"><a href="/net/ipsock.go.html#2635275">ifi</a></span><span class="op" id="2635336">.</span><span class="ident" id="2635337">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2635343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635346">return</span>&nbsp;<span class="ident" id="2635353"><a href="/net/parse.go.html#2666508">itod</a></span><span class="op" id="2635357">(</span><span class="builtintype" id="2635358">uint</span><span class="op" id="2635362">(</span><span class="ident" id="2635363"><a href="/net/ipsock.go.html#2635221">zone</a></span><span class="op" id="2635367">)</span><span class="op" id="2635368">)</span><br>
<span class="lineno"></span><span class="op" id="2635370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2635373">func</span>&nbsp;<span class="ident" id="2635378">zoneToInt</span><span class="op" id="2635387">(</span><span class="ident" id="2635388">zone</span>&nbsp;<span class="builtintype" id="2635393">string</span><span class="op" id="2635399">)</span>&nbsp;<span class="builtintype" id="2635401">int</span>&nbsp;<span class="op" id="2635405">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635408">if</span>&nbsp;<span class="ident" id="2635411"><a href="/net/ipsock.go.html#2635388">zone</a></span>&nbsp;<span class="op" id="2635416">==</span>&nbsp;<span class="string" id="2635419">&#34;&#34;</span>&nbsp;<span class="op" id="2635422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635426">return</span>&nbsp;<span class="num" id="2635433">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2635436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635439">if</span>&nbsp;<span class="ident" id="2635442">ifi</span><span class="op" id="2635445">,</span>&nbsp;<span class="ident" id="2635447">err</span>&nbsp;<span class="op" id="2635451">:=</span>&nbsp;<span class="ident" id="2635454"><a href="/net/interface.go.html#2595864">InterfaceByName</a></span><span class="op" id="2635469">(</span><span class="ident" id="2635470"><a href="/net/ipsock.go.html#2635388">zone</a></span><span class="op" id="2635474">)</span><span class="op" id="2635475">;</span>&nbsp;<span class="ident" id="2635477"><a href="/net/ipsock.go.html#2635447">err</a></span>&nbsp;<span class="op" id="2635481">==</span>&nbsp;<span class="ident" id="2635484">nil</span>&nbsp;<span class="op" id="2635488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635492">return</span>&nbsp;<span class="ident" id="2635499"><a href="/net/ipsock.go.html#2635442">ifi</a></span><span class="op" id="2635502">.</span><span class="ident" id="2635503">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2635510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2635513">n</span><span class="op" id="2635514">,</span>&nbsp;<span class="ident" id="2635516">_</span><span class="op" id="2635517">,</span>&nbsp;<span class="ident" id="2635519">_</span>&nbsp;<span class="op" id="2635521">:=</span>&nbsp;<span class="ident" id="2635524"><a href="/net/parse.go.html#2665011">dtoi</a></span><span class="op" id="2635528">(</span><span class="ident" id="2635529"><a href="/net/ipsock.go.html#2635388">zone</a></span><span class="op" id="2635533">,</span>&nbsp;<span class="num" id="2635535">0</span><span class="op" id="2635536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2635539">return</span>&nbsp;<span class="ident" id="2635546"><a href="/net/ipsock.go.html#2635513">n</a></span><br>
<span class="lineno"></span><span class="op" id="2635548">}</span>
</div>
</body>
</html>
