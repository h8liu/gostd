<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2737798">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2737853">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2737907">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2737958">//&nbsp;Package&nbsp;strings&nbsp;implements&nbsp;simple&nbsp;functions&nbsp;to&nbsp;manipulate&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="2738028">package</span>&nbsp;<span class="ident" id="2738036">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2738045">import</span>&nbsp;<span class="op" id="2738052">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2738055">&#34;unicode&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2738066">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2738081">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2738084">//&nbsp;explode&nbsp;splits&nbsp;s&nbsp;into&nbsp;an&nbsp;array&nbsp;of&nbsp;UTF-8&nbsp;sequences,&nbsp;one&nbsp;per&nbsp;Unicode&nbsp;character&nbsp;(still&nbsp;strings)&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;n&nbsp;(n&nbsp;&lt;&nbsp;0&nbsp;means&nbsp;no&nbsp;limit).</span><br>
<span class="lineno"></span><span class="comment" id="2738225">//&nbsp;Invalid&nbsp;UTF-8&nbsp;sequences&nbsp;become&nbsp;correct&nbsp;encodings&nbsp;of&nbsp;U+FFF8.</span><br>
<span class="lineno">15</span><span class="keyword" id="2738288">func</span>&nbsp;<span class="ident" id="2738293">explode</span><span class="op" id="2738300">(</span><span class="ident" id="2738301">s</span>&nbsp;<span class="builtintype" id="2738303">string</span><span class="op" id="2738309">,</span>&nbsp;<span class="ident" id="2738311">n</span>&nbsp;<span class="builtintype" id="2738313">int</span><span class="op" id="2738316">)</span>&nbsp;<span class="op" id="2738318">[</span><span class="op" id="2738319">]</span><span class="builtintype" id="2738320">string</span>&nbsp;<span class="op" id="2738327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738330">if</span>&nbsp;<span class="ident" id="2738333">n</span>&nbsp;<span class="op" id="2738335">==</span>&nbsp;<span class="num" id="2738338">0</span>&nbsp;<span class="op" id="2738340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738344">return</span>&nbsp;<span class="ident" id="2738351">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2738356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738359">l</span>&nbsp;<span class="op" id="2738361">:=</span>&nbsp;<span class="ident" id="2738364">utf8</span><span class="op" id="2738368">.</span><span class="ident" id="2738369">RuneCountInString</span><span class="op" id="2738386">(</span><span class="ident" id="2738387">s</span><span class="op" id="2738388">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738391">if</span>&nbsp;<span class="ident" id="2738394">n</span>&nbsp;<span class="op" id="2738396">&lt;=</span>&nbsp;<span class="num" id="2738399">0</span>&nbsp;<span class="op" id="2738401">||</span>&nbsp;<span class="ident" id="2738404">n</span>&nbsp;<span class="op" id="2738406">&gt;</span>&nbsp;<span class="ident" id="2738408">l</span>&nbsp;<span class="op" id="2738410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738414">n</span>&nbsp;<span class="op" id="2738416">=</span>&nbsp;<span class="ident" id="2738418">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2738421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738424">a</span>&nbsp;<span class="op" id="2738426">:=</span>&nbsp;<span class="builtinfunc" id="2738429">make</span><span class="op" id="2738433">(</span><span class="op" id="2738434">[</span><span class="op" id="2738435">]</span><span class="builtintype" id="2738436">string</span><span class="op" id="2738442">,</span>&nbsp;<span class="ident" id="2738444">n</span><span class="op" id="2738445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738448">var</span>&nbsp;<span class="ident" id="2738452">size</span>&nbsp;<span class="builtintype" id="2738457">int</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738462">var</span>&nbsp;<span class="ident" id="2738466">ch</span>&nbsp;<span class="builtintype" id="2738469">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738475">i</span><span class="op" id="2738476">,</span>&nbsp;<span class="ident" id="2738478">cur</span>&nbsp;<span class="op" id="2738482">:=</span>&nbsp;<span class="num" id="2738485">0</span><span class="op" id="2738486">,</span>&nbsp;<span class="num" id="2738488">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738491">for</span>&nbsp;<span class="op" id="2738495">;</span>&nbsp;<span class="ident" id="2738497">i</span><span class="op" id="2738498">+</span><span class="num" id="2738499">1</span>&nbsp;<span class="op" id="2738501">&lt;</span>&nbsp;<span class="ident" id="2738503">n</span><span class="op" id="2738504">;</span>&nbsp;<span class="ident" id="2738506">i</span><span class="op" id="2738507">++</span>&nbsp;<span class="op" id="2738510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738514">ch</span><span class="op" id="2738516">,</span>&nbsp;<span class="ident" id="2738518">size</span>&nbsp;<span class="op" id="2738523">=</span>&nbsp;<span class="ident" id="2738525">utf8</span><span class="op" id="2738529">.</span><span class="ident" id="2738530">DecodeRuneInString</span><span class="op" id="2738548">(</span><span class="ident" id="2738549">s</span><span class="op" id="2738550">[</span><span class="ident" id="2738551">cur</span><span class="op" id="2738554">:</span><span class="op" id="2738555">]</span><span class="op" id="2738556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738560">if</span>&nbsp;<span class="ident" id="2738563">ch</span>&nbsp;<span class="op" id="2738566">==</span>&nbsp;<span class="ident" id="2738569">utf8</span><span class="op" id="2738573">.</span><span class="ident" id="2738574">RuneError</span>&nbsp;<span class="op" id="2738584">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738589">a</span><span class="op" id="2738590">[</span><span class="ident" id="2738591">i</span><span class="op" id="2738592">]</span>&nbsp;<span class="op" id="2738594">=</span>&nbsp;<span class="builtintype" id="2738596">string</span><span class="op" id="2738602">(</span><span class="ident" id="2738603">utf8</span><span class="op" id="2738607">.</span><span class="ident" id="2738608">RuneError</span><span class="op" id="2738617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2738621">}</span>&nbsp;<span class="keyword" id="2738623">else</span>&nbsp;<span class="op" id="2738628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738633">a</span><span class="op" id="2738634">[</span><span class="ident" id="2738635">i</span><span class="op" id="2738636">]</span>&nbsp;<span class="op" id="2738638">=</span>&nbsp;<span class="ident" id="2738640">s</span><span class="op" id="2738641">[</span><span class="ident" id="2738642">cur</span>&nbsp;<span class="op" id="2738646">:</span>&nbsp;<span class="ident" id="2738648">cur</span><span class="op" id="2738651">+</span><span class="ident" id="2738652">size</span><span class="op" id="2738656">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2738660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738664">cur</span>&nbsp;<span class="op" id="2738668">+=</span>&nbsp;<span class="ident" id="2738671">size</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2738677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2738680">//&nbsp;add&nbsp;the&nbsp;rest,&nbsp;if&nbsp;there&nbsp;is&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738714">if</span>&nbsp;<span class="ident" id="2738717">cur</span>&nbsp;<span class="op" id="2738721">&lt;</span>&nbsp;<span class="builtinfunc" id="2738723">len</span><span class="op" id="2738726">(</span><span class="ident" id="2738727">s</span><span class="op" id="2738728">)</span>&nbsp;<span class="op" id="2738730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738734">a</span><span class="op" id="2738735">[</span><span class="ident" id="2738736">i</span><span class="op" id="2738737">]</span>&nbsp;<span class="op" id="2738739">=</span>&nbsp;<span class="ident" id="2738741">s</span><span class="op" id="2738742">[</span><span class="ident" id="2738743">cur</span><span class="op" id="2738746">:</span><span class="op" id="2738747">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2738750">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738753">return</span>&nbsp;<span class="ident" id="2738760">a</span><br>
<span class="lineno"></span><span class="op" id="2738762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2738765">//&nbsp;primeRK&nbsp;is&nbsp;the&nbsp;prime&nbsp;base&nbsp;used&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2738824">const</span>&nbsp;<span class="ident" id="2738830">primeRK</span>&nbsp;<span class="op" id="2738838">=</span>&nbsp;<span class="num" id="2738840">16777619</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2738850">//&nbsp;hashStr&nbsp;returns&nbsp;the&nbsp;hash&nbsp;and&nbsp;the&nbsp;appropriate&nbsp;multiplicative</span><br>
<span class="lineno"></span><span class="comment" id="2738913">//&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2738956">func</span>&nbsp;<span class="ident" id="2738961">hashStr</span><span class="op" id="2738968">(</span><span class="ident" id="2738969">sep</span>&nbsp;<span class="builtintype" id="2738973">string</span><span class="op" id="2738979">)</span>&nbsp;<span class="op" id="2738981">(</span><span class="builtintype" id="2738982">uint32</span><span class="op" id="2738988">,</span>&nbsp;<span class="builtintype" id="2738990">uint32</span><span class="op" id="2738996">)</span>&nbsp;<span class="op" id="2738998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2739001">hash</span>&nbsp;<span class="op" id="2739006">:=</span>&nbsp;<span class="builtintype" id="2739009">uint32</span><span class="op" id="2739015">(</span><span class="num" id="2739016">0</span><span class="op" id="2739017">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739020">for</span>&nbsp;<span class="ident" id="2739024">i</span>&nbsp;<span class="op" id="2739026">:=</span>&nbsp;<span class="num" id="2739029">0</span><span class="op" id="2739030">;</span>&nbsp;<span class="ident" id="2739032">i</span>&nbsp;<span class="op" id="2739034">&lt;</span>&nbsp;<span class="builtinfunc" id="2739036">len</span><span class="op" id="2739039">(</span><span class="ident" id="2739040">sep</span><span class="op" id="2739043">)</span><span class="op" id="2739044">;</span>&nbsp;<span class="ident" id="2739046">i</span><span class="op" id="2739047">++</span>&nbsp;<span class="op" id="2739050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2739054">hash</span>&nbsp;<span class="op" id="2739059">=</span>&nbsp;<span class="ident" id="2739061">hash</span><span class="op" id="2739065">*</span><span class="ident" id="2739066">primeRK</span>&nbsp;<span class="op" id="2739074">+</span>&nbsp;<span class="builtintype" id="2739076">uint32</span><span class="op" id="2739082">(</span><span class="ident" id="2739083">sep</span><span class="op" id="2739086">[</span><span class="ident" id="2739087">i</span><span class="op" id="2739088">]</span><span class="op" id="2739089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2739092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739095">var</span>&nbsp;<span class="ident" id="2739099">pow</span><span class="op" id="2739102">,</span>&nbsp;<span class="ident" id="2739104">sq</span>&nbsp;<span class="builtintype" id="2739107">uint32</span>&nbsp;<span class="op" id="2739114">=</span>&nbsp;<span class="num" id="2739116">1</span><span class="op" id="2739117">,</span>&nbsp;<span class="ident" id="2739119">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739128">for</span>&nbsp;<span class="ident" id="2739132">i</span>&nbsp;<span class="op" id="2739134">:=</span>&nbsp;<span class="builtinfunc" id="2739137">len</span><span class="op" id="2739140">(</span><span class="ident" id="2739141">sep</span><span class="op" id="2739144">)</span><span class="op" id="2739145">;</span>&nbsp;<span class="ident" id="2739147">i</span>&nbsp;<span class="op" id="2739149">&gt;</span>&nbsp;<span class="num" id="2739151">0</span><span class="op" id="2739152">;</span>&nbsp;<span class="ident" id="2739154">i</span>&nbsp;<span class="op" id="2739156">&gt;&gt;=</span>&nbsp;<span class="num" id="2739160">1</span>&nbsp;<span class="op" id="2739162">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739166">if</span>&nbsp;<span class="ident" id="2739169">i</span><span class="op" id="2739170">&amp;</span><span class="num" id="2739171">1</span>&nbsp;<span class="op" id="2739173">!=</span>&nbsp;<span class="num" id="2739176">0</span>&nbsp;<span class="op" id="2739178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2739183">pow</span>&nbsp;<span class="op" id="2739187">*=</span>&nbsp;<span class="ident" id="2739190">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2739195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2739199">sq</span>&nbsp;<span class="op" id="2739202">*=</span>&nbsp;<span class="ident" id="2739205">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2739209">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739212">return</span>&nbsp;<span class="ident" id="2739219">hash</span><span class="op" id="2739223">,</span>&nbsp;<span class="ident" id="2739225">pow</span><br>
<span class="lineno"></span><span class="op" id="2739229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2739232">//&nbsp;hashStrRev&nbsp;returns&nbsp;the&nbsp;hash&nbsp;of&nbsp;the&nbsp;reverse&nbsp;of&nbsp;sep&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2739293">//&nbsp;appropriate&nbsp;multiplicative&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno">65</span><span class="keyword" id="2739363">func</span>&nbsp;<span class="ident" id="2739368">hashStrRev</span><span class="op" id="2739378">(</span><span class="ident" id="2739379">sep</span>&nbsp;<span class="builtintype" id="2739383">string</span><span class="op" id="2739389">)</span>&nbsp;<span class="op" id="2739391">(</span><span class="builtintype" id="2739392">uint32</span><span class="op" id="2739398">,</span>&nbsp;<span class="builtintype" id="2739400">uint32</span><span class="op" id="2739406">)</span>&nbsp;<span class="op" id="2739408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2739411">hash</span>&nbsp;<span class="op" id="2739416">:=</span>&nbsp;<span class="builtintype" id="2739419">uint32</span><span class="op" id="2739425">(</span><span class="num" id="2739426">0</span><span class="op" id="2739427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739430">for</span>&nbsp;<span class="ident" id="2739434">i</span>&nbsp;<span class="op" id="2739436">:=</span>&nbsp;<span class="builtinfunc" id="2739439">len</span><span class="op" id="2739442">(</span><span class="ident" id="2739443">sep</span><span class="op" id="2739446">)</span>&nbsp;<span class="op" id="2739448">-</span>&nbsp;<span class="num" id="2739450">1</span><span class="op" id="2739451">;</span>&nbsp;<span class="ident" id="2739453">i</span>&nbsp;<span class="op" id="2739455">&gt;=</span>&nbsp;<span class="num" id="2739458">0</span><span class="op" id="2739459">;</span>&nbsp;<span class="ident" id="2739461">i</span><span class="op" id="2739462">--</span>&nbsp;<span class="op" id="2739465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2739469">hash</span>&nbsp;<span class="op" id="2739474">=</span>&nbsp;<span class="ident" id="2739476">hash</span><span class="op" id="2739480">*</span><span class="ident" id="2739481">primeRK</span>&nbsp;<span class="op" id="2739489">+</span>&nbsp;<span class="builtintype" id="2739491">uint32</span><span class="op" id="2739497">(</span><span class="ident" id="2739498">sep</span><span class="op" id="2739501">[</span><span class="ident" id="2739502">i</span><span class="op" id="2739503">]</span><span class="op" id="2739504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2739507">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739510">var</span>&nbsp;<span class="ident" id="2739514">pow</span><span class="op" id="2739517">,</span>&nbsp;<span class="ident" id="2739519">sq</span>&nbsp;<span class="builtintype" id="2739522">uint32</span>&nbsp;<span class="op" id="2739529">=</span>&nbsp;<span class="num" id="2739531">1</span><span class="op" id="2739532">,</span>&nbsp;<span class="ident" id="2739534">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739543">for</span>&nbsp;<span class="ident" id="2739547">i</span>&nbsp;<span class="op" id="2739549">:=</span>&nbsp;<span class="builtinfunc" id="2739552">len</span><span class="op" id="2739555">(</span><span class="ident" id="2739556">sep</span><span class="op" id="2739559">)</span><span class="op" id="2739560">;</span>&nbsp;<span class="ident" id="2739562">i</span>&nbsp;<span class="op" id="2739564">&gt;</span>&nbsp;<span class="num" id="2739566">0</span><span class="op" id="2739567">;</span>&nbsp;<span class="ident" id="2739569">i</span>&nbsp;<span class="op" id="2739571">&gt;&gt;=</span>&nbsp;<span class="num" id="2739575">1</span>&nbsp;<span class="op" id="2739577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739581">if</span>&nbsp;<span class="ident" id="2739584">i</span><span class="op" id="2739585">&amp;</span><span class="num" id="2739586">1</span>&nbsp;<span class="op" id="2739588">!=</span>&nbsp;<span class="num" id="2739591">0</span>&nbsp;<span class="op" id="2739593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2739598">pow</span>&nbsp;<span class="op" id="2739602">*=</span>&nbsp;<span class="ident" id="2739605">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2739610">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2739614">sq</span>&nbsp;<span class="op" id="2739617">*=</span>&nbsp;<span class="ident" id="2739620">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2739624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739627">return</span>&nbsp;<span class="ident" id="2739634">hash</span><span class="op" id="2739638">,</span>&nbsp;<span class="ident" id="2739640">pow</span><br>
<span class="lineno"></span><span class="op" id="2739644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2739647">//&nbsp;Count&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;sep&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2739716">func</span>&nbsp;<span class="ident" id="2739721">Count</span><span class="op" id="2739726">(</span><span class="ident" id="2739727">s</span><span class="op" id="2739728">,</span>&nbsp;<span class="ident" id="2739730">sep</span>&nbsp;<span class="builtintype" id="2739734">string</span><span class="op" id="2739740">)</span>&nbsp;<span class="builtintype" id="2739742">int</span>&nbsp;<span class="op" id="2739746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2739749">n</span>&nbsp;<span class="op" id="2739751">:=</span>&nbsp;<span class="num" id="2739754">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2739757">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739775">switch</span>&nbsp;<span class="op" id="2739782">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739785">case</span>&nbsp;<span class="builtinfunc" id="2739790">len</span><span class="op" id="2739793">(</span><span class="ident" id="2739794">sep</span><span class="op" id="2739797">)</span>&nbsp;<span class="op" id="2739799">==</span>&nbsp;<span class="num" id="2739802">0</span><span class="op" id="2739803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739807">return</span>&nbsp;<span class="ident" id="2739814">utf8</span><span class="op" id="2739818">.</span><span class="ident" id="2739819">RuneCountInString</span><span class="op" id="2739836">(</span><span class="ident" id="2739837">s</span><span class="op" id="2739838">)</span>&nbsp;<span class="op" id="2739840">+</span>&nbsp;<span class="num" id="2739842">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739845">case</span>&nbsp;<span class="builtinfunc" id="2739850">len</span><span class="op" id="2739853">(</span><span class="ident" id="2739854">sep</span><span class="op" id="2739857">)</span>&nbsp;<span class="op" id="2739859">==</span>&nbsp;<span class="num" id="2739862">1</span><span class="op" id="2739863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2739867">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2739903">c</span>&nbsp;<span class="op" id="2739905">:=</span>&nbsp;<span class="ident" id="2739908">sep</span><span class="op" id="2739911">[</span><span class="num" id="2739912">0</span><span class="op" id="2739913">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739917">for</span>&nbsp;<span class="ident" id="2739921">i</span>&nbsp;<span class="op" id="2739923">:=</span>&nbsp;<span class="num" id="2739926">0</span><span class="op" id="2739927">;</span>&nbsp;<span class="ident" id="2739929">i</span>&nbsp;<span class="op" id="2739931">&lt;</span>&nbsp;<span class="builtinfunc" id="2739933">len</span><span class="op" id="2739936">(</span><span class="ident" id="2739937">s</span><span class="op" id="2739938">)</span><span class="op" id="2739939">;</span>&nbsp;<span class="ident" id="2739941">i</span><span class="op" id="2739942">++</span>&nbsp;<span class="op" id="2739945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739950">if</span>&nbsp;<span class="ident" id="2739953">s</span><span class="op" id="2739954">[</span><span class="ident" id="2739955">i</span><span class="op" id="2739956">]</span>&nbsp;<span class="op" id="2739958">==</span>&nbsp;<span class="ident" id="2739961">c</span>&nbsp;<span class="op" id="2739963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2739969">n</span><span class="op" id="2739970">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2739976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2739980">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739984">return</span>&nbsp;<span class="ident" id="2739991">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2739994">case</span>&nbsp;<span class="builtinfunc" id="2739999">len</span><span class="op" id="2740002">(</span><span class="ident" id="2740003">sep</span><span class="op" id="2740006">)</span>&nbsp;<span class="op" id="2740008">&gt;</span>&nbsp;<span class="builtinfunc" id="2740010">len</span><span class="op" id="2740013">(</span><span class="ident" id="2740014">s</span><span class="op" id="2740015">)</span><span class="op" id="2740016">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740020">return</span>&nbsp;<span class="num" id="2740027">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740030">case</span>&nbsp;<span class="builtinfunc" id="2740035">len</span><span class="op" id="2740038">(</span><span class="ident" id="2740039">sep</span><span class="op" id="2740042">)</span>&nbsp;<span class="op" id="2740044">==</span>&nbsp;<span class="builtinfunc" id="2740047">len</span><span class="op" id="2740050">(</span><span class="ident" id="2740051">s</span><span class="op" id="2740052">)</span><span class="op" id="2740053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740057">if</span>&nbsp;<span class="ident" id="2740060">sep</span>&nbsp;<span class="op" id="2740064">==</span>&nbsp;<span class="ident" id="2740067">s</span>&nbsp;<span class="op" id="2740069">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740074">return</span>&nbsp;<span class="num" id="2740081">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2740085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740089">return</span>&nbsp;<span class="num" id="2740096">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2740099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2740102">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740124">hashsep</span><span class="op" id="2740131">,</span>&nbsp;<span class="ident" id="2740133">pow</span>&nbsp;<span class="op" id="2740137">:=</span>&nbsp;<span class="ident" id="2740140">hashStr</span><span class="op" id="2740147">(</span><span class="ident" id="2740148">sep</span><span class="op" id="2740151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740154">h</span>&nbsp;<span class="op" id="2740156">:=</span>&nbsp;<span class="builtintype" id="2740159">uint32</span><span class="op" id="2740165">(</span><span class="num" id="2740166">0</span><span class="op" id="2740167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740170">for</span>&nbsp;<span class="ident" id="2740174">i</span>&nbsp;<span class="op" id="2740176">:=</span>&nbsp;<span class="num" id="2740179">0</span><span class="op" id="2740180">;</span>&nbsp;<span class="ident" id="2740182">i</span>&nbsp;<span class="op" id="2740184">&lt;</span>&nbsp;<span class="builtinfunc" id="2740186">len</span><span class="op" id="2740189">(</span><span class="ident" id="2740190">sep</span><span class="op" id="2740193">)</span><span class="op" id="2740194">;</span>&nbsp;<span class="ident" id="2740196">i</span><span class="op" id="2740197">++</span>&nbsp;<span class="op" id="2740200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740204">h</span>&nbsp;<span class="op" id="2740206">=</span>&nbsp;<span class="ident" id="2740208">h</span><span class="op" id="2740209">*</span><span class="ident" id="2740210">primeRK</span>&nbsp;<span class="op" id="2740218">+</span>&nbsp;<span class="builtintype" id="2740220">uint32</span><span class="op" id="2740226">(</span><span class="ident" id="2740227">s</span><span class="op" id="2740228">[</span><span class="ident" id="2740229">i</span><span class="op" id="2740230">]</span><span class="op" id="2740231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2740234">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740237">lastmatch</span>&nbsp;<span class="op" id="2740247">:=</span>&nbsp;<span class="num" id="2740250">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740253">if</span>&nbsp;<span class="ident" id="2740256">h</span>&nbsp;<span class="op" id="2740258">==</span>&nbsp;<span class="ident" id="2740261">hashsep</span>&nbsp;<span class="op" id="2740269">&amp;&amp;</span>&nbsp;<span class="ident" id="2740272">s</span><span class="op" id="2740273">[</span><span class="op" id="2740274">:</span><span class="builtinfunc" id="2740275">len</span><span class="op" id="2740278">(</span><span class="ident" id="2740279">sep</span><span class="op" id="2740282">)</span><span class="op" id="2740283">]</span>&nbsp;<span class="op" id="2740285">==</span>&nbsp;<span class="ident" id="2740288">sep</span>&nbsp;<span class="op" id="2740292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740296">n</span><span class="op" id="2740297">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740302">lastmatch</span>&nbsp;<span class="op" id="2740312">=</span>&nbsp;<span class="builtinfunc" id="2740314">len</span><span class="op" id="2740317">(</span><span class="ident" id="2740318">sep</span><span class="op" id="2740321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2740324">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740327">for</span>&nbsp;<span class="ident" id="2740331">i</span>&nbsp;<span class="op" id="2740333">:=</span>&nbsp;<span class="builtinfunc" id="2740336">len</span><span class="op" id="2740339">(</span><span class="ident" id="2740340">sep</span><span class="op" id="2740343">)</span><span class="op" id="2740344">;</span>&nbsp;<span class="ident" id="2740346">i</span>&nbsp;<span class="op" id="2740348">&lt;</span>&nbsp;<span class="builtinfunc" id="2740350">len</span><span class="op" id="2740353">(</span><span class="ident" id="2740354">s</span><span class="op" id="2740355">)</span><span class="op" id="2740356">;</span>&nbsp;<span class="op" id="2740358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740362">h</span>&nbsp;<span class="op" id="2740364">*=</span>&nbsp;<span class="ident" id="2740367">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740377">h</span>&nbsp;<span class="op" id="2740379">+=</span>&nbsp;<span class="builtintype" id="2740382">uint32</span><span class="op" id="2740388">(</span><span class="ident" id="2740389">s</span><span class="op" id="2740390">[</span><span class="ident" id="2740391">i</span><span class="op" id="2740392">]</span><span class="op" id="2740393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740397">h</span>&nbsp;<span class="op" id="2740399">-=</span>&nbsp;<span class="ident" id="2740402">pow</span>&nbsp;<span class="op" id="2740406">*</span>&nbsp;<span class="builtintype" id="2740408">uint32</span><span class="op" id="2740414">(</span><span class="ident" id="2740415">s</span><span class="op" id="2740416">[</span><span class="ident" id="2740417">i</span><span class="op" id="2740418">-</span><span class="builtinfunc" id="2740419">len</span><span class="op" id="2740422">(</span><span class="ident" id="2740423">sep</span><span class="op" id="2740426">)</span><span class="op" id="2740427">]</span><span class="op" id="2740428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740432">i</span><span class="op" id="2740433">++</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740438">if</span>&nbsp;<span class="ident" id="2740441">h</span>&nbsp;<span class="op" id="2740443">==</span>&nbsp;<span class="ident" id="2740446">hashsep</span>&nbsp;<span class="op" id="2740454">&amp;&amp;</span>&nbsp;<span class="ident" id="2740457">lastmatch</span>&nbsp;<span class="op" id="2740467">&lt;=</span>&nbsp;<span class="ident" id="2740470">i</span><span class="op" id="2740471">-</span><span class="builtinfunc" id="2740472">len</span><span class="op" id="2740475">(</span><span class="ident" id="2740476">sep</span><span class="op" id="2740479">)</span>&nbsp;<span class="op" id="2740481">&amp;&amp;</span>&nbsp;<span class="ident" id="2740484">s</span><span class="op" id="2740485">[</span><span class="ident" id="2740486">i</span><span class="op" id="2740487">-</span><span class="builtinfunc" id="2740488">len</span><span class="op" id="2740491">(</span><span class="ident" id="2740492">sep</span><span class="op" id="2740495">)</span><span class="op" id="2740496">:</span><span class="ident" id="2740497">i</span><span class="op" id="2740498">]</span>&nbsp;<span class="op" id="2740500">==</span>&nbsp;<span class="ident" id="2740503">sep</span>&nbsp;<span class="op" id="2740507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740512">n</span><span class="op" id="2740513">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740519">lastmatch</span>&nbsp;<span class="op" id="2740529">=</span>&nbsp;<span class="ident" id="2740531">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2740535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2740538">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740541">return</span>&nbsp;<span class="ident" id="2740548">n</span><br>
<span class="lineno"></span><span class="op" id="2740550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2740553">//&nbsp;Contains&nbsp;returns&nbsp;true&nbsp;if&nbsp;substr&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2740601">func</span>&nbsp;<span class="ident" id="2740606">Contains</span><span class="op" id="2740614">(</span><span class="ident" id="2740615">s</span><span class="op" id="2740616">,</span>&nbsp;<span class="ident" id="2740618">substr</span>&nbsp;<span class="builtintype" id="2740625">string</span><span class="op" id="2740631">)</span>&nbsp;<span class="builtintype" id="2740633">bool</span>&nbsp;<span class="op" id="2740638">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740641">return</span>&nbsp;<span class="ident" id="2740648">Index</span><span class="op" id="2740653">(</span><span class="ident" id="2740654">s</span><span class="op" id="2740655">,</span>&nbsp;<span class="ident" id="2740657">substr</span><span class="op" id="2740663">)</span>&nbsp;<span class="op" id="2740665">&gt;=</span>&nbsp;<span class="num" id="2740668">0</span><br>
<span class="lineno"></span><span class="op" id="2740670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2740673">//&nbsp;ContainsAny&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;in&nbsp;chars&nbsp;are&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2740751">func</span>&nbsp;<span class="ident" id="2740756">ContainsAny</span><span class="op" id="2740767">(</span><span class="ident" id="2740768">s</span><span class="op" id="2740769">,</span>&nbsp;<span class="ident" id="2740771">chars</span>&nbsp;<span class="builtintype" id="2740777">string</span><span class="op" id="2740783">)</span>&nbsp;<span class="builtintype" id="2740785">bool</span>&nbsp;<span class="op" id="2740790">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740793">return</span>&nbsp;<span class="ident" id="2740800">IndexAny</span><span class="op" id="2740808">(</span><span class="ident" id="2740809">s</span><span class="op" id="2740810">,</span>&nbsp;<span class="ident" id="2740812">chars</span><span class="op" id="2740817">)</span>&nbsp;<span class="op" id="2740819">&gt;=</span>&nbsp;<span class="num" id="2740822">0</span><br>
<span class="lineno"></span><span class="op" id="2740824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2740827">//&nbsp;ContainsRune&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2740897">func</span>&nbsp;<span class="ident" id="2740902">ContainsRune</span><span class="op" id="2740914">(</span><span class="ident" id="2740915">s</span>&nbsp;<span class="builtintype" id="2740917">string</span><span class="op" id="2740923">,</span>&nbsp;<span class="ident" id="2740925">r</span>&nbsp;<span class="builtintype" id="2740927">rune</span><span class="op" id="2740931">)</span>&nbsp;<span class="builtintype" id="2740933">bool</span>&nbsp;<span class="op" id="2740938">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2740941">return</span>&nbsp;<span class="ident" id="2740948">IndexRune</span><span class="op" id="2740957">(</span><span class="ident" id="2740958">s</span><span class="op" id="2740959">,</span>&nbsp;<span class="ident" id="2740961">r</span><span class="op" id="2740962">)</span>&nbsp;<span class="op" id="2740964">&gt;=</span>&nbsp;<span class="num" id="2740967">0</span><br>
<span class="lineno"></span><span class="op" id="2740969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2740972">//&nbsp;Index&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2741068">func</span>&nbsp;<span class="ident" id="2741073">Index</span><span class="op" id="2741078">(</span><span class="ident" id="2741079">s</span><span class="op" id="2741080">,</span>&nbsp;<span class="ident" id="2741082">sep</span>&nbsp;<span class="builtintype" id="2741086">string</span><span class="op" id="2741092">)</span>&nbsp;<span class="builtintype" id="2741094">int</span>&nbsp;<span class="op" id="2741098">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741101">n</span>&nbsp;<span class="op" id="2741103">:=</span>&nbsp;<span class="builtinfunc" id="2741106">len</span><span class="op" id="2741109">(</span><span class="ident" id="2741110">sep</span><span class="op" id="2741113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741116">switch</span>&nbsp;<span class="op" id="2741123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741126">case</span>&nbsp;<span class="ident" id="2741131">n</span>&nbsp;<span class="op" id="2741133">==</span>&nbsp;<span class="num" id="2741136">0</span><span class="op" id="2741137">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741141">return</span>&nbsp;<span class="num" id="2741148">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741151">case</span>&nbsp;<span class="ident" id="2741156">n</span>&nbsp;<span class="op" id="2741158">==</span>&nbsp;<span class="num" id="2741161">1</span><span class="op" id="2741162">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741166">return</span>&nbsp;<span class="ident" id="2741173">IndexByte</span><span class="op" id="2741182">(</span><span class="ident" id="2741183">s</span><span class="op" id="2741184">,</span>&nbsp;<span class="ident" id="2741186">sep</span><span class="op" id="2741189">[</span><span class="num" id="2741190">0</span><span class="op" id="2741191">]</span><span class="op" id="2741192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741195">case</span>&nbsp;<span class="ident" id="2741200">n</span>&nbsp;<span class="op" id="2741202">==</span>&nbsp;<span class="builtinfunc" id="2741205">len</span><span class="op" id="2741208">(</span><span class="ident" id="2741209">s</span><span class="op" id="2741210">)</span><span class="op" id="2741211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741215">if</span>&nbsp;<span class="ident" id="2741218">sep</span>&nbsp;<span class="op" id="2741222">==</span>&nbsp;<span class="ident" id="2741225">s</span>&nbsp;<span class="op" id="2741227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741232">return</span>&nbsp;<span class="num" id="2741239">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2741243">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741247">return</span>&nbsp;<span class="op" id="2741254">-</span><span class="num" id="2741255">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741258">case</span>&nbsp;<span class="ident" id="2741263">n</span>&nbsp;<span class="op" id="2741265">&gt;</span>&nbsp;<span class="builtinfunc" id="2741267">len</span><span class="op" id="2741270">(</span><span class="ident" id="2741271">s</span><span class="op" id="2741272">)</span><span class="op" id="2741273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741277">return</span>&nbsp;<span class="op" id="2741284">-</span><span class="num" id="2741285">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2741288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2741291">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741313">hashsep</span><span class="op" id="2741320">,</span>&nbsp;<span class="ident" id="2741322">pow</span>&nbsp;<span class="op" id="2741326">:=</span>&nbsp;<span class="ident" id="2741329">hashStr</span><span class="op" id="2741336">(</span><span class="ident" id="2741337">sep</span><span class="op" id="2741340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741343">var</span>&nbsp;<span class="ident" id="2741347">h</span>&nbsp;<span class="builtintype" id="2741349">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741357">for</span>&nbsp;<span class="ident" id="2741361">i</span>&nbsp;<span class="op" id="2741363">:=</span>&nbsp;<span class="num" id="2741366">0</span><span class="op" id="2741367">;</span>&nbsp;<span class="ident" id="2741369">i</span>&nbsp;<span class="op" id="2741371">&lt;</span>&nbsp;<span class="ident" id="2741373">n</span><span class="op" id="2741374">;</span>&nbsp;<span class="ident" id="2741376">i</span><span class="op" id="2741377">++</span>&nbsp;<span class="op" id="2741380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741384">h</span>&nbsp;<span class="op" id="2741386">=</span>&nbsp;<span class="ident" id="2741388">h</span><span class="op" id="2741389">*</span><span class="ident" id="2741390">primeRK</span>&nbsp;<span class="op" id="2741398">+</span>&nbsp;<span class="builtintype" id="2741400">uint32</span><span class="op" id="2741406">(</span><span class="ident" id="2741407">s</span><span class="op" id="2741408">[</span><span class="ident" id="2741409">i</span><span class="op" id="2741410">]</span><span class="op" id="2741411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2741414">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741417">if</span>&nbsp;<span class="ident" id="2741420">h</span>&nbsp;<span class="op" id="2741422">==</span>&nbsp;<span class="ident" id="2741425">hashsep</span>&nbsp;<span class="op" id="2741433">&amp;&amp;</span>&nbsp;<span class="ident" id="2741436">s</span><span class="op" id="2741437">[</span><span class="op" id="2741438">:</span><span class="ident" id="2741439">n</span><span class="op" id="2741440">]</span>&nbsp;<span class="op" id="2741442">==</span>&nbsp;<span class="ident" id="2741445">sep</span>&nbsp;<span class="op" id="2741449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741453">return</span>&nbsp;<span class="num" id="2741460">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2741463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741466">for</span>&nbsp;<span class="ident" id="2741470">i</span>&nbsp;<span class="op" id="2741472">:=</span>&nbsp;<span class="ident" id="2741475">n</span><span class="op" id="2741476">;</span>&nbsp;<span class="ident" id="2741478">i</span>&nbsp;<span class="op" id="2741480">&lt;</span>&nbsp;<span class="builtinfunc" id="2741482">len</span><span class="op" id="2741485">(</span><span class="ident" id="2741486">s</span><span class="op" id="2741487">)</span><span class="op" id="2741488">;</span>&nbsp;<span class="op" id="2741490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741494">h</span>&nbsp;<span class="op" id="2741496">*=</span>&nbsp;<span class="ident" id="2741499">primeRK</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741509">h</span>&nbsp;<span class="op" id="2741511">+=</span>&nbsp;<span class="builtintype" id="2741514">uint32</span><span class="op" id="2741520">(</span><span class="ident" id="2741521">s</span><span class="op" id="2741522">[</span><span class="ident" id="2741523">i</span><span class="op" id="2741524">]</span><span class="op" id="2741525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741529">h</span>&nbsp;<span class="op" id="2741531">-=</span>&nbsp;<span class="ident" id="2741534">pow</span>&nbsp;<span class="op" id="2741538">*</span>&nbsp;<span class="builtintype" id="2741540">uint32</span><span class="op" id="2741546">(</span><span class="ident" id="2741547">s</span><span class="op" id="2741548">[</span><span class="ident" id="2741549">i</span><span class="op" id="2741550">-</span><span class="ident" id="2741551">n</span><span class="op" id="2741552">]</span><span class="op" id="2741553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741557">i</span><span class="op" id="2741558">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741563">if</span>&nbsp;<span class="ident" id="2741566">h</span>&nbsp;<span class="op" id="2741568">==</span>&nbsp;<span class="ident" id="2741571">hashsep</span>&nbsp;<span class="op" id="2741579">&amp;&amp;</span>&nbsp;<span class="ident" id="2741582">s</span><span class="op" id="2741583">[</span><span class="ident" id="2741584">i</span><span class="op" id="2741585">-</span><span class="ident" id="2741586">n</span><span class="op" id="2741587">:</span><span class="ident" id="2741588">i</span><span class="op" id="2741589">]</span>&nbsp;<span class="op" id="2741591">==</span>&nbsp;<span class="ident" id="2741594">sep</span>&nbsp;<span class="op" id="2741598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741603">return</span>&nbsp;<span class="ident" id="2741610">i</span>&nbsp;<span class="op" id="2741612">-</span>&nbsp;<span class="ident" id="2741614">n</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2741618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2741621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741624">return</span>&nbsp;<span class="op" id="2741631">-</span><span class="num" id="2741632">1</span><br>
<span class="lineno"></span><span class="op" id="2741634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="2741637">//&nbsp;LastIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2741736">func</span>&nbsp;<span class="ident" id="2741741">LastIndex</span><span class="op" id="2741750">(</span><span class="ident" id="2741751">s</span><span class="op" id="2741752">,</span>&nbsp;<span class="ident" id="2741754">sep</span>&nbsp;<span class="builtintype" id="2741758">string</span><span class="op" id="2741764">)</span>&nbsp;<span class="builtintype" id="2741766">int</span>&nbsp;<span class="op" id="2741770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741773">n</span>&nbsp;<span class="op" id="2741775">:=</span>&nbsp;<span class="builtinfunc" id="2741778">len</span><span class="op" id="2741781">(</span><span class="ident" id="2741782">sep</span><span class="op" id="2741785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741788">switch</span>&nbsp;<span class="op" id="2741795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741798">case</span>&nbsp;<span class="ident" id="2741803">n</span>&nbsp;<span class="op" id="2741805">==</span>&nbsp;<span class="num" id="2741808">0</span><span class="op" id="2741809">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741813">return</span>&nbsp;<span class="builtinfunc" id="2741820">len</span><span class="op" id="2741823">(</span><span class="ident" id="2741824">s</span><span class="op" id="2741825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741828">case</span>&nbsp;<span class="ident" id="2741833">n</span>&nbsp;<span class="op" id="2741835">==</span>&nbsp;<span class="num" id="2741838">1</span><span class="op" id="2741839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2741843">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741879">c</span>&nbsp;<span class="op" id="2741881">:=</span>&nbsp;<span class="ident" id="2741884">sep</span><span class="op" id="2741887">[</span><span class="num" id="2741888">0</span><span class="op" id="2741889">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741893">for</span>&nbsp;<span class="ident" id="2741897">i</span>&nbsp;<span class="op" id="2741899">:=</span>&nbsp;<span class="builtinfunc" id="2741902">len</span><span class="op" id="2741905">(</span><span class="ident" id="2741906">s</span><span class="op" id="2741907">)</span>&nbsp;<span class="op" id="2741909">-</span>&nbsp;<span class="num" id="2741911">1</span><span class="op" id="2741912">;</span>&nbsp;<span class="ident" id="2741914">i</span>&nbsp;<span class="op" id="2741916">&gt;=</span>&nbsp;<span class="num" id="2741919">0</span><span class="op" id="2741920">;</span>&nbsp;<span class="ident" id="2741922">i</span><span class="op" id="2741923">--</span>&nbsp;<span class="op" id="2741926">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741931">if</span>&nbsp;<span class="ident" id="2741934">s</span><span class="op" id="2741935">[</span><span class="ident" id="2741936">i</span><span class="op" id="2741937">]</span>&nbsp;<span class="op" id="2741939">==</span>&nbsp;<span class="ident" id="2741942">c</span>&nbsp;<span class="op" id="2741944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741950">return</span>&nbsp;<span class="ident" id="2741957">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2741962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2741966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741970">return</span>&nbsp;<span class="op" id="2741977">-</span><span class="num" id="2741978">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741981">case</span>&nbsp;<span class="ident" id="2741986">n</span>&nbsp;<span class="op" id="2741988">==</span>&nbsp;<span class="builtinfunc" id="2741991">len</span><span class="op" id="2741994">(</span><span class="ident" id="2741995">s</span><span class="op" id="2741996">)</span><span class="op" id="2741997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742001">if</span>&nbsp;<span class="ident" id="2742004">sep</span>&nbsp;<span class="op" id="2742008">==</span>&nbsp;<span class="ident" id="2742011">s</span>&nbsp;<span class="op" id="2742013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742018">return</span>&nbsp;<span class="num" id="2742025">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2742029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742033">return</span>&nbsp;<span class="op" id="2742040">-</span><span class="num" id="2742041">1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742044">case</span>&nbsp;<span class="ident" id="2742049">n</span>&nbsp;<span class="op" id="2742051">&gt;</span>&nbsp;<span class="builtinfunc" id="2742053">len</span><span class="op" id="2742056">(</span><span class="ident" id="2742057">s</span><span class="op" id="2742058">)</span><span class="op" id="2742059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742063">return</span>&nbsp;<span class="op" id="2742070">-</span><span class="num" id="2742071">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2742074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2742077">//&nbsp;Rabin-Karp&nbsp;search&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2742126">hashsep</span><span class="op" id="2742133">,</span>&nbsp;<span class="ident" id="2742135">pow</span>&nbsp;<span class="op" id="2742139">:=</span>&nbsp;<span class="ident" id="2742142">hashStrRev</span><span class="op" id="2742152">(</span><span class="ident" id="2742153">sep</span><span class="op" id="2742156">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2742159">last</span>&nbsp;<span class="op" id="2742164">:=</span>&nbsp;<span class="builtinfunc" id="2742167">len</span><span class="op" id="2742170">(</span><span class="ident" id="2742171">s</span><span class="op" id="2742172">)</span>&nbsp;<span class="op" id="2742174">-</span>&nbsp;<span class="ident" id="2742176">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742179">var</span>&nbsp;<span class="ident" id="2742183">h</span>&nbsp;<span class="builtintype" id="2742185">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742193">for</span>&nbsp;<span class="ident" id="2742197">i</span>&nbsp;<span class="op" id="2742199">:=</span>&nbsp;<span class="builtinfunc" id="2742202">len</span><span class="op" id="2742205">(</span><span class="ident" id="2742206">s</span><span class="op" id="2742207">)</span>&nbsp;<span class="op" id="2742209">-</span>&nbsp;<span class="num" id="2742211">1</span><span class="op" id="2742212">;</span>&nbsp;<span class="ident" id="2742214">i</span>&nbsp;<span class="op" id="2742216">&gt;=</span>&nbsp;<span class="ident" id="2742219">last</span><span class="op" id="2742223">;</span>&nbsp;<span class="ident" id="2742225">i</span><span class="op" id="2742226">--</span>&nbsp;<span class="op" id="2742229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2742233">h</span>&nbsp;<span class="op" id="2742235">=</span>&nbsp;<span class="ident" id="2742237">h</span><span class="op" id="2742238">*</span><span class="ident" id="2742239">primeRK</span>&nbsp;<span class="op" id="2742247">+</span>&nbsp;<span class="builtintype" id="2742249">uint32</span><span class="op" id="2742255">(</span><span class="ident" id="2742256">s</span><span class="op" id="2742257">[</span><span class="ident" id="2742258">i</span><span class="op" id="2742259">]</span><span class="op" id="2742260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2742263">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742266">if</span>&nbsp;<span class="ident" id="2742269">h</span>&nbsp;<span class="op" id="2742271">==</span>&nbsp;<span class="ident" id="2742274">hashsep</span>&nbsp;<span class="op" id="2742282">&amp;&amp;</span>&nbsp;<span class="ident" id="2742285">s</span><span class="op" id="2742286">[</span><span class="ident" id="2742287">last</span><span class="op" id="2742291">:</span><span class="op" id="2742292">]</span>&nbsp;<span class="op" id="2742294">==</span>&nbsp;<span class="ident" id="2742297">sep</span>&nbsp;<span class="op" id="2742301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742305">return</span>&nbsp;<span class="ident" id="2742312">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2742318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742321">for</span>&nbsp;<span class="ident" id="2742325">i</span>&nbsp;<span class="op" id="2742327">:=</span>&nbsp;<span class="ident" id="2742330">last</span>&nbsp;<span class="op" id="2742335">-</span>&nbsp;<span class="num" id="2742337">1</span><span class="op" id="2742338">;</span>&nbsp;<span class="ident" id="2742340">i</span>&nbsp;<span class="op" id="2742342">&gt;=</span>&nbsp;<span class="num" id="2742345">0</span><span class="op" id="2742346">;</span>&nbsp;<span class="ident" id="2742348">i</span><span class="op" id="2742349">--</span>&nbsp;<span class="op" id="2742352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2742356">h</span>&nbsp;<span class="op" id="2742358">*=</span>&nbsp;<span class="ident" id="2742361">primeRK</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2742371">h</span>&nbsp;<span class="op" id="2742373">+=</span>&nbsp;<span class="builtintype" id="2742376">uint32</span><span class="op" id="2742382">(</span><span class="ident" id="2742383">s</span><span class="op" id="2742384">[</span><span class="ident" id="2742385">i</span><span class="op" id="2742386">]</span><span class="op" id="2742387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2742391">h</span>&nbsp;<span class="op" id="2742393">-=</span>&nbsp;<span class="ident" id="2742396">pow</span>&nbsp;<span class="op" id="2742400">*</span>&nbsp;<span class="builtintype" id="2742402">uint32</span><span class="op" id="2742408">(</span><span class="ident" id="2742409">s</span><span class="op" id="2742410">[</span><span class="ident" id="2742411">i</span><span class="op" id="2742412">+</span><span class="ident" id="2742413">n</span><span class="op" id="2742414">]</span><span class="op" id="2742415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742419">if</span>&nbsp;<span class="ident" id="2742422">h</span>&nbsp;<span class="op" id="2742424">==</span>&nbsp;<span class="ident" id="2742427">hashsep</span>&nbsp;<span class="op" id="2742435">&amp;&amp;</span>&nbsp;<span class="ident" id="2742438">s</span><span class="op" id="2742439">[</span><span class="ident" id="2742440">i</span><span class="op" id="2742441">:</span><span class="ident" id="2742442">i</span><span class="op" id="2742443">+</span><span class="ident" id="2742444">n</span><span class="op" id="2742445">]</span>&nbsp;<span class="op" id="2742447">==</span>&nbsp;<span class="ident" id="2742450">sep</span>&nbsp;<span class="op" id="2742454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742459">return</span>&nbsp;<span class="ident" id="2742466">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2742470">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2742473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742476">return</span>&nbsp;<span class="op" id="2742483">-</span><span class="num" id="2742484">1</span><br>
<span class="lineno"></span><span class="op" id="2742486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2742489">//&nbsp;IndexRune&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno">225</span><span class="comment" id="2742568">//&nbsp;r,&nbsp;or&nbsp;-1&nbsp;if&nbsp;rune&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2742609">func</span>&nbsp;<span class="ident" id="2742614">IndexRune</span><span class="op" id="2742623">(</span><span class="ident" id="2742624">s</span>&nbsp;<span class="builtintype" id="2742626">string</span><span class="op" id="2742632">,</span>&nbsp;<span class="ident" id="2742634">r</span>&nbsp;<span class="builtintype" id="2742636">rune</span><span class="op" id="2742640">)</span>&nbsp;<span class="builtintype" id="2742642">int</span>&nbsp;<span class="op" id="2742646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742649">switch</span>&nbsp;<span class="op" id="2742656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742659">case</span>&nbsp;<span class="ident" id="2742664">r</span>&nbsp;<span class="op" id="2742666">&lt;</span>&nbsp;<span class="ident" id="2742668">utf8</span><span class="op" id="2742672">.</span><span class="ident" id="2742673">RuneSelf</span><span class="op" id="2742681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742685">return</span>&nbsp;<span class="ident" id="2742692">IndexByte</span><span class="op" id="2742701">(</span><span class="ident" id="2742702">s</span><span class="op" id="2742703">,</span>&nbsp;<span class="builtintype" id="2742705">byte</span><span class="op" id="2742709">(</span><span class="ident" id="2742710">r</span><span class="op" id="2742711">)</span><span class="op" id="2742712">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742715">default</span><span class="op" id="2742722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742726">for</span>&nbsp;<span class="ident" id="2742730">i</span><span class="op" id="2742731">,</span>&nbsp;<span class="ident" id="2742733">c</span>&nbsp;<span class="op" id="2742735">:=</span>&nbsp;<span class="keyword" id="2742738">range</span>&nbsp;<span class="ident" id="2742744">s</span>&nbsp;<span class="op" id="2742746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742751">if</span>&nbsp;<span class="ident" id="2742754">c</span>&nbsp;<span class="op" id="2742756">==</span>&nbsp;<span class="ident" id="2742759">r</span>&nbsp;<span class="op" id="2742761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742767">return</span>&nbsp;<span class="ident" id="2742774">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2742779">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2742783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2742786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742789">return</span>&nbsp;<span class="op" id="2742796">-</span><span class="num" id="2742797">1</span><br>
<span class="lineno"></span><span class="op" id="2742799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="2742802">//&nbsp;IndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="2742880">//&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2742959">func</span>&nbsp;<span class="ident" id="2742964">IndexAny</span><span class="op" id="2742972">(</span><span class="ident" id="2742973">s</span><span class="op" id="2742974">,</span>&nbsp;<span class="ident" id="2742976">chars</span>&nbsp;<span class="builtintype" id="2742982">string</span><span class="op" id="2742988">)</span>&nbsp;<span class="builtintype" id="2742990">int</span>&nbsp;<span class="op" id="2742994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2742997">if</span>&nbsp;<span class="builtinfunc" id="2743000">len</span><span class="op" id="2743003">(</span><span class="ident" id="2743004">chars</span><span class="op" id="2743009">)</span>&nbsp;<span class="op" id="2743011">&gt;</span>&nbsp;<span class="num" id="2743013">0</span>&nbsp;<span class="op" id="2743015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743019">for</span>&nbsp;<span class="ident" id="2743023">i</span><span class="op" id="2743024">,</span>&nbsp;<span class="ident" id="2743026">c</span>&nbsp;<span class="op" id="2743028">:=</span>&nbsp;<span class="keyword" id="2743031">range</span>&nbsp;<span class="ident" id="2743037">s</span>&nbsp;<span class="op" id="2743039">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743044">for</span>&nbsp;<span class="ident" id="2743048">_</span><span class="op" id="2743049">,</span>&nbsp;<span class="ident" id="2743051">m</span>&nbsp;<span class="op" id="2743053">:=</span>&nbsp;<span class="keyword" id="2743056">range</span>&nbsp;<span class="ident" id="2743062">chars</span>&nbsp;<span class="op" id="2743068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743074">if</span>&nbsp;<span class="ident" id="2743077">c</span>&nbsp;<span class="op" id="2743079">==</span>&nbsp;<span class="ident" id="2743082">m</span>&nbsp;<span class="op" id="2743084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743091">return</span>&nbsp;<span class="ident" id="2743098">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2743104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2743109">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2743113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2743116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743119">return</span>&nbsp;<span class="op" id="2743126">-</span><span class="num" id="2743127">1</span><br>
<span class="lineno"></span><span class="op" id="2743129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="2743132">//&nbsp;LastIndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="2743207">//&nbsp;point&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2743278">//&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2743295">func</span>&nbsp;<span class="ident" id="2743300">LastIndexAny</span><span class="op" id="2743312">(</span><span class="ident" id="2743313">s</span><span class="op" id="2743314">,</span>&nbsp;<span class="ident" id="2743316">chars</span>&nbsp;<span class="builtintype" id="2743322">string</span><span class="op" id="2743328">)</span>&nbsp;<span class="builtintype" id="2743330">int</span>&nbsp;<span class="op" id="2743334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743337">if</span>&nbsp;<span class="builtinfunc" id="2743340">len</span><span class="op" id="2743343">(</span><span class="ident" id="2743344">chars</span><span class="op" id="2743349">)</span>&nbsp;<span class="op" id="2743351">&gt;</span>&nbsp;<span class="num" id="2743353">0</span>&nbsp;<span class="op" id="2743355">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743359">for</span>&nbsp;<span class="ident" id="2743363">i</span>&nbsp;<span class="op" id="2743365">:=</span>&nbsp;<span class="builtinfunc" id="2743368">len</span><span class="op" id="2743371">(</span><span class="ident" id="2743372">s</span><span class="op" id="2743373">)</span><span class="op" id="2743374">;</span>&nbsp;<span class="ident" id="2743376">i</span>&nbsp;<span class="op" id="2743378">&gt;</span>&nbsp;<span class="num" id="2743380">0</span><span class="op" id="2743381">;</span>&nbsp;<span class="op" id="2743383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2743388">rune</span><span class="op" id="2743392">,</span>&nbsp;<span class="ident" id="2743394">size</span>&nbsp;<span class="op" id="2743399">:=</span>&nbsp;<span class="ident" id="2743402">utf8</span><span class="op" id="2743406">.</span><span class="ident" id="2743407">DecodeLastRuneInString</span><span class="op" id="2743429">(</span><span class="ident" id="2743430">s</span><span class="op" id="2743431">[</span><span class="num" id="2743432">0</span><span class="op" id="2743433">:</span><span class="ident" id="2743434">i</span><span class="op" id="2743435">]</span><span class="op" id="2743436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2743441">i</span>&nbsp;<span class="op" id="2743443">-=</span>&nbsp;<span class="ident" id="2743446">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743454">for</span>&nbsp;<span class="ident" id="2743458">_</span><span class="op" id="2743459">,</span>&nbsp;<span class="ident" id="2743461">m</span>&nbsp;<span class="op" id="2743463">:=</span>&nbsp;<span class="keyword" id="2743466">range</span>&nbsp;<span class="ident" id="2743472">chars</span>&nbsp;<span class="op" id="2743478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743484">if</span>&nbsp;<span class="builtintype" id="2743487">rune</span>&nbsp;<span class="op" id="2743492">==</span>&nbsp;<span class="ident" id="2743495">m</span>&nbsp;<span class="op" id="2743497">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743504">return</span>&nbsp;<span class="ident" id="2743511">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2743517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2743522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2743526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2743529">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743532">return</span>&nbsp;<span class="op" id="2743539">-</span><span class="num" id="2743540">1</span><br>
<span class="lineno"></span><span class="op" id="2743542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2743545">//&nbsp;Generic&nbsp;split:&nbsp;splits&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep,</span><br>
<span class="lineno"></span><span class="comment" id="2743598">//&nbsp;including&nbsp;sepSave&nbsp;bytes&nbsp;of&nbsp;sep&nbsp;in&nbsp;the&nbsp;subarrays.</span><br>
<span class="lineno">275</span><span class="keyword" id="2743650">func</span>&nbsp;<span class="ident" id="2743655">genSplit</span><span class="op" id="2743663">(</span><span class="ident" id="2743664">s</span><span class="op" id="2743665">,</span>&nbsp;<span class="ident" id="2743667">sep</span>&nbsp;<span class="builtintype" id="2743671">string</span><span class="op" id="2743677">,</span>&nbsp;<span class="ident" id="2743679">sepSave</span><span class="op" id="2743686">,</span>&nbsp;<span class="ident" id="2743688">n</span>&nbsp;<span class="builtintype" id="2743690">int</span><span class="op" id="2743693">)</span>&nbsp;<span class="op" id="2743695">[</span><span class="op" id="2743696">]</span><span class="builtintype" id="2743697">string</span>&nbsp;<span class="op" id="2743704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743707">if</span>&nbsp;<span class="ident" id="2743710">n</span>&nbsp;<span class="op" id="2743712">==</span>&nbsp;<span class="num" id="2743715">0</span>&nbsp;<span class="op" id="2743717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743721">return</span>&nbsp;<span class="ident" id="2743728">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2743733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743736">if</span>&nbsp;<span class="ident" id="2743739">sep</span>&nbsp;<span class="op" id="2743743">==</span>&nbsp;<span class="string" id="2743746">&#34;&#34;</span>&nbsp;<span class="op" id="2743749">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743753">return</span>&nbsp;<span class="ident" id="2743760">explode</span><span class="op" id="2743767">(</span><span class="ident" id="2743768">s</span><span class="op" id="2743769">,</span>&nbsp;<span class="ident" id="2743771">n</span><span class="op" id="2743772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2743775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743778">if</span>&nbsp;<span class="ident" id="2743781">n</span>&nbsp;<span class="op" id="2743783">&lt;</span>&nbsp;<span class="num" id="2743785">0</span>&nbsp;<span class="op" id="2743787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2743791">n</span>&nbsp;<span class="op" id="2743793">=</span>&nbsp;<span class="ident" id="2743795">Count</span><span class="op" id="2743800">(</span><span class="ident" id="2743801">s</span><span class="op" id="2743802">,</span>&nbsp;<span class="ident" id="2743804">sep</span><span class="op" id="2743807">)</span>&nbsp;<span class="op" id="2743809">+</span>&nbsp;<span class="num" id="2743811">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2743814">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2743817">c</span>&nbsp;<span class="op" id="2743819">:=</span>&nbsp;<span class="ident" id="2743822">sep</span><span class="op" id="2743825">[</span><span class="num" id="2743826">0</span><span class="op" id="2743827">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2743830">start</span>&nbsp;<span class="op" id="2743836">:=</span>&nbsp;<span class="num" id="2743839">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2743842">a</span>&nbsp;<span class="op" id="2743844">:=</span>&nbsp;<span class="builtinfunc" id="2743847">make</span><span class="op" id="2743851">(</span><span class="op" id="2743852">[</span><span class="op" id="2743853">]</span><span class="builtintype" id="2743854">string</span><span class="op" id="2743860">,</span>&nbsp;<span class="ident" id="2743862">n</span><span class="op" id="2743863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2743866">na</span>&nbsp;<span class="op" id="2743869">:=</span>&nbsp;<span class="num" id="2743872">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743875">for</span>&nbsp;<span class="ident" id="2743879">i</span>&nbsp;<span class="op" id="2743881">:=</span>&nbsp;<span class="num" id="2743884">0</span><span class="op" id="2743885">;</span>&nbsp;<span class="ident" id="2743887">i</span><span class="op" id="2743888">+</span><span class="builtinfunc" id="2743889">len</span><span class="op" id="2743892">(</span><span class="ident" id="2743893">sep</span><span class="op" id="2743896">)</span>&nbsp;<span class="op" id="2743898">&lt;=</span>&nbsp;<span class="builtinfunc" id="2743901">len</span><span class="op" id="2743904">(</span><span class="ident" id="2743905">s</span><span class="op" id="2743906">)</span>&nbsp;<span class="op" id="2743908">&amp;&amp;</span>&nbsp;<span class="ident" id="2743911">na</span><span class="op" id="2743913">+</span><span class="num" id="2743914">1</span>&nbsp;<span class="op" id="2743916">&lt;</span>&nbsp;<span class="ident" id="2743918">n</span><span class="op" id="2743919">;</span>&nbsp;<span class="ident" id="2743921">i</span><span class="op" id="2743922">++</span>&nbsp;<span class="op" id="2743925">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2743929">if</span>&nbsp;<span class="ident" id="2743932">s</span><span class="op" id="2743933">[</span><span class="ident" id="2743934">i</span><span class="op" id="2743935">]</span>&nbsp;<span class="op" id="2743937">==</span>&nbsp;<span class="ident" id="2743940">c</span>&nbsp;<span class="op" id="2743942">&amp;&amp;</span>&nbsp;<span class="op" id="2743945">(</span><span class="builtinfunc" id="2743946">len</span><span class="op" id="2743949">(</span><span class="ident" id="2743950">sep</span><span class="op" id="2743953">)</span>&nbsp;<span class="op" id="2743955">==</span>&nbsp;<span class="num" id="2743958">1</span>&nbsp;<span class="op" id="2743960">||</span>&nbsp;<span class="ident" id="2743963">s</span><span class="op" id="2743964">[</span><span class="ident" id="2743965">i</span><span class="op" id="2743966">:</span><span class="ident" id="2743967">i</span><span class="op" id="2743968">+</span><span class="builtinfunc" id="2743969">len</span><span class="op" id="2743972">(</span><span class="ident" id="2743973">sep</span><span class="op" id="2743976">)</span><span class="op" id="2743977">]</span>&nbsp;<span class="op" id="2743979">==</span>&nbsp;<span class="ident" id="2743982">sep</span><span class="op" id="2743985">)</span>&nbsp;<span class="op" id="2743987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2743992">a</span><span class="op" id="2743993">[</span><span class="ident" id="2743994">na</span><span class="op" id="2743996">]</span>&nbsp;<span class="op" id="2743998">=</span>&nbsp;<span class="ident" id="2744000">s</span><span class="op" id="2744001">[</span><span class="ident" id="2744002">start</span>&nbsp;<span class="op" id="2744008">:</span>&nbsp;<span class="ident" id="2744010">i</span><span class="op" id="2744011">+</span><span class="ident" id="2744012">sepSave</span><span class="op" id="2744019">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2744024">na</span><span class="op" id="2744026">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2744032">start</span>&nbsp;<span class="op" id="2744038">=</span>&nbsp;<span class="ident" id="2744040">i</span>&nbsp;<span class="op" id="2744042">+</span>&nbsp;<span class="builtinfunc" id="2744044">len</span><span class="op" id="2744047">(</span><span class="ident" id="2744048">sep</span><span class="op" id="2744051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2744056">i</span>&nbsp;<span class="op" id="2744058">+=</span>&nbsp;<span class="builtinfunc" id="2744061">len</span><span class="op" id="2744064">(</span><span class="ident" id="2744065">sep</span><span class="op" id="2744068">)</span>&nbsp;<span class="op" id="2744070">-</span>&nbsp;<span class="num" id="2744072">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2744076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2744079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2744082">a</span><span class="op" id="2744083">[</span><span class="ident" id="2744084">na</span><span class="op" id="2744086">]</span>&nbsp;<span class="op" id="2744088">=</span>&nbsp;<span class="ident" id="2744090">s</span><span class="op" id="2744091">[</span><span class="ident" id="2744092">start</span><span class="op" id="2744097">:</span><span class="op" id="2744098">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2744101">return</span>&nbsp;<span class="ident" id="2744108">a</span><span class="op" id="2744109">[</span><span class="num" id="2744110">0</span>&nbsp;<span class="op" id="2744112">:</span>&nbsp;<span class="ident" id="2744114">na</span><span class="op" id="2744116">+</span><span class="num" id="2744117">1</span><span class="op" id="2744118">]</span><br>
<span class="lineno"></span><span class="op" id="2744120">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="2744123">//&nbsp;SplitN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2744198">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2744242">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2744303">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">305</span><span class="comment" id="2744363">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="2744447">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2744496">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2744523">func</span>&nbsp;<span class="ident" id="2744528">SplitN</span><span class="op" id="2744534">(</span><span class="ident" id="2744535">s</span><span class="op" id="2744536">,</span>&nbsp;<span class="ident" id="2744538">sep</span>&nbsp;<span class="builtintype" id="2744542">string</span><span class="op" id="2744548">,</span>&nbsp;<span class="ident" id="2744550">n</span>&nbsp;<span class="builtintype" id="2744552">int</span><span class="op" id="2744555">)</span>&nbsp;<span class="op" id="2744557">[</span><span class="op" id="2744558">]</span><span class="builtintype" id="2744559">string</span>&nbsp;<span class="op" id="2744566">{</span>&nbsp;<span class="keyword" id="2744568">return</span>&nbsp;<span class="ident" id="2744575">genSplit</span><span class="op" id="2744583">(</span><span class="ident" id="2744584">s</span><span class="op" id="2744585">,</span>&nbsp;<span class="ident" id="2744587">sep</span><span class="op" id="2744590">,</span>&nbsp;<span class="num" id="2744592">0</span><span class="op" id="2744593">,</span>&nbsp;<span class="ident" id="2744595">n</span><span class="op" id="2744596">)</span>&nbsp;<span class="op" id="2744598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="2744601">//&nbsp;SplitAfterN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2744672">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2744712">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfterN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2744778">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno"></span><span class="comment" id="2744838">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno">315</span><span class="comment" id="2744922">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2744971">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2744998">func</span>&nbsp;<span class="ident" id="2745003">SplitAfterN</span><span class="op" id="2745014">(</span><span class="ident" id="2745015">s</span><span class="op" id="2745016">,</span>&nbsp;<span class="ident" id="2745018">sep</span>&nbsp;<span class="builtintype" id="2745022">string</span><span class="op" id="2745028">,</span>&nbsp;<span class="ident" id="2745030">n</span>&nbsp;<span class="builtintype" id="2745032">int</span><span class="op" id="2745035">)</span>&nbsp;<span class="op" id="2745037">[</span><span class="op" id="2745038">]</span><span class="builtintype" id="2745039">string</span>&nbsp;<span class="op" id="2745046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2745049">return</span>&nbsp;<span class="ident" id="2745056">genSplit</span><span class="op" id="2745064">(</span><span class="ident" id="2745065">s</span><span class="op" id="2745066">,</span>&nbsp;<span class="ident" id="2745068">sep</span><span class="op" id="2745071">,</span>&nbsp;<span class="builtinfunc" id="2745073">len</span><span class="op" id="2745076">(</span><span class="ident" id="2745077">sep</span><span class="op" id="2745080">)</span><span class="op" id="2745081">,</span>&nbsp;<span class="ident" id="2745083">n</span><span class="op" id="2745084">)</span><br>
<span class="lineno"></span><span class="op" id="2745086">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2745089">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2745167">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2745211">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;Split&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2745271">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno">325</span><span class="keyword" id="2745321">func</span>&nbsp;<span class="ident" id="2745326">Split</span><span class="op" id="2745331">(</span><span class="ident" id="2745332">s</span><span class="op" id="2745333">,</span>&nbsp;<span class="ident" id="2745335">sep</span>&nbsp;<span class="builtintype" id="2745339">string</span><span class="op" id="2745345">)</span>&nbsp;<span class="op" id="2745347">[</span><span class="op" id="2745348">]</span><span class="builtintype" id="2745349">string</span>&nbsp;<span class="op" id="2745356">{</span>&nbsp;<span class="keyword" id="2745358">return</span>&nbsp;<span class="ident" id="2745365">genSplit</span><span class="op" id="2745373">(</span><span class="ident" id="2745374">s</span><span class="op" id="2745375">,</span>&nbsp;<span class="ident" id="2745377">sep</span><span class="op" id="2745380">,</span>&nbsp;<span class="num" id="2745382">0</span><span class="op" id="2745383">,</span>&nbsp;<span class="op" id="2745385">-</span><span class="num" id="2745386">1</span><span class="op" id="2745387">)</span>&nbsp;<span class="op" id="2745389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2745392">//&nbsp;SplitAfter&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2745466">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2745506">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfter&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno">330</span><span class="comment" id="2745571">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitAfterN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2745626">func</span>&nbsp;<span class="ident" id="2745631">SplitAfter</span><span class="op" id="2745641">(</span><span class="ident" id="2745642">s</span><span class="op" id="2745643">,</span>&nbsp;<span class="ident" id="2745645">sep</span>&nbsp;<span class="builtintype" id="2745649">string</span><span class="op" id="2745655">)</span>&nbsp;<span class="op" id="2745657">[</span><span class="op" id="2745658">]</span><span class="builtintype" id="2745659">string</span>&nbsp;<span class="op" id="2745666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2745669">return</span>&nbsp;<span class="ident" id="2745676">genSplit</span><span class="op" id="2745684">(</span><span class="ident" id="2745685">s</span><span class="op" id="2745686">,</span>&nbsp;<span class="ident" id="2745688">sep</span><span class="op" id="2745691">,</span>&nbsp;<span class="builtinfunc" id="2745693">len</span><span class="op" id="2745696">(</span><span class="ident" id="2745697">sep</span><span class="op" id="2745700">)</span><span class="op" id="2745701">,</span>&nbsp;<span class="op" id="2745703">-</span><span class="num" id="2745704">1</span><span class="op" id="2745705">)</span><br>
<span class="lineno"></span><span class="op" id="2745707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="2745710">//&nbsp;Fields&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="2745800">//&nbsp;characters,&nbsp;as&nbsp;defined&nbsp;by&nbsp;unicode.IsSpace,&nbsp;returning&nbsp;an&nbsp;array&nbsp;of&nbsp;substrings&nbsp;of&nbsp;s&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2745890">//&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="2745936">func</span>&nbsp;<span class="ident" id="2745941">Fields</span><span class="op" id="2745947">(</span><span class="ident" id="2745948">s</span>&nbsp;<span class="builtintype" id="2745950">string</span><span class="op" id="2745956">)</span>&nbsp;<span class="op" id="2745958">[</span><span class="op" id="2745959">]</span><span class="builtintype" id="2745960">string</span>&nbsp;<span class="op" id="2745967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2745970">return</span>&nbsp;<span class="ident" id="2745977">FieldsFunc</span><span class="op" id="2745987">(</span><span class="ident" id="2745988">s</span><span class="op" id="2745989">,</span>&nbsp;<span class="ident" id="2745991">unicode</span><span class="op" id="2745998">.</span><span class="ident" id="2745999">IsSpace</span><span class="op" id="2746006">)</span><br>
<span class="lineno">340</span><span class="op" id="2746008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2746011">//&nbsp;FieldsFunc&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;at&nbsp;each&nbsp;run&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)</span><br>
<span class="lineno"></span><span class="comment" id="2746098">//&nbsp;and&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;slices&nbsp;of&nbsp;s.&nbsp;If&nbsp;all&nbsp;code&nbsp;points&nbsp;in&nbsp;s&nbsp;satisfy&nbsp;f(c)&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2746182">//&nbsp;string&nbsp;is&nbsp;empty,&nbsp;an&nbsp;empty&nbsp;slice&nbsp;is&nbsp;returned.</span><br>
<span class="lineno">345</span><span class="comment" id="2746230">//&nbsp;FieldsFunc&nbsp;makes&nbsp;no&nbsp;guarantees&nbsp;about&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;it&nbsp;calls&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="comment" id="2746304">//&nbsp;If&nbsp;f&nbsp;does&nbsp;not&nbsp;return&nbsp;consistent&nbsp;results&nbsp;for&nbsp;a&nbsp;given&nbsp;c,&nbsp;FieldsFunc&nbsp;may&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="2746384">func</span>&nbsp;<span class="ident" id="2746389">FieldsFunc</span><span class="op" id="2746399">(</span><span class="ident" id="2746400">s</span>&nbsp;<span class="builtintype" id="2746402">string</span><span class="op" id="2746408">,</span>&nbsp;<span class="ident" id="2746410">f</span>&nbsp;<span class="keyword" id="2746412">func</span><span class="op" id="2746416">(</span><span class="builtintype" id="2746417">rune</span><span class="op" id="2746421">)</span>&nbsp;<span class="builtintype" id="2746423">bool</span><span class="op" id="2746427">)</span>&nbsp;<span class="op" id="2746429">[</span><span class="op" id="2746430">]</span><span class="builtintype" id="2746431">string</span>&nbsp;<span class="op" id="2746438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2746441">//&nbsp;First&nbsp;count&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746469">n</span>&nbsp;<span class="op" id="2746471">:=</span>&nbsp;<span class="num" id="2746474">0</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746477">inField</span>&nbsp;<span class="op" id="2746485">:=</span>&nbsp;<span class="ident" id="2746488">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2746495">for</span>&nbsp;<span class="ident" id="2746499">_</span><span class="op" id="2746500">,</span>&nbsp;<span class="builtintype" id="2746502">rune</span>&nbsp;<span class="op" id="2746507">:=</span>&nbsp;<span class="keyword" id="2746510">range</span>&nbsp;<span class="ident" id="2746516">s</span>&nbsp;<span class="op" id="2746518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746522">wasInField</span>&nbsp;<span class="op" id="2746533">:=</span>&nbsp;<span class="ident" id="2746536">inField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746546">inField</span>&nbsp;<span class="op" id="2746554">=</span>&nbsp;<span class="op" id="2746556">!</span><span class="ident" id="2746557">f</span><span class="op" id="2746558">(</span><span class="builtintype" id="2746559">rune</span><span class="op" id="2746563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2746567">if</span>&nbsp;<span class="ident" id="2746570">inField</span>&nbsp;<span class="op" id="2746578">&amp;&amp;</span>&nbsp;<span class="op" id="2746581">!</span><span class="ident" id="2746582">wasInField</span>&nbsp;<span class="op" id="2746593">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746598">n</span><span class="op" id="2746599">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2746604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2746607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2746611">//&nbsp;Now&nbsp;create&nbsp;them.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746632">a</span>&nbsp;<span class="op" id="2746634">:=</span>&nbsp;<span class="builtinfunc" id="2746637">make</span><span class="op" id="2746641">(</span><span class="op" id="2746642">[</span><span class="op" id="2746643">]</span><span class="builtintype" id="2746644">string</span><span class="op" id="2746650">,</span>&nbsp;<span class="ident" id="2746652">n</span><span class="op" id="2746653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746656">na</span>&nbsp;<span class="op" id="2746659">:=</span>&nbsp;<span class="num" id="2746662">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746665">fieldStart</span>&nbsp;<span class="op" id="2746676">:=</span>&nbsp;<span class="op" id="2746679">-</span><span class="num" id="2746680">1</span>&nbsp;<span class="comment" id="2746682">//&nbsp;Set&nbsp;to&nbsp;-1&nbsp;when&nbsp;looking&nbsp;for&nbsp;start&nbsp;of&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2746729">for</span>&nbsp;<span class="ident" id="2746733">i</span><span class="op" id="2746734">,</span>&nbsp;<span class="builtintype" id="2746736">rune</span>&nbsp;<span class="op" id="2746741">:=</span>&nbsp;<span class="keyword" id="2746744">range</span>&nbsp;<span class="ident" id="2746750">s</span>&nbsp;<span class="op" id="2746752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2746756">if</span>&nbsp;<span class="ident" id="2746759">f</span><span class="op" id="2746760">(</span><span class="builtintype" id="2746761">rune</span><span class="op" id="2746765">)</span>&nbsp;<span class="op" id="2746767">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2746772">if</span>&nbsp;<span class="ident" id="2746775">fieldStart</span>&nbsp;<span class="op" id="2746786">&gt;=</span>&nbsp;<span class="num" id="2746789">0</span>&nbsp;<span class="op" id="2746791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746797">a</span><span class="op" id="2746798">[</span><span class="ident" id="2746799">na</span><span class="op" id="2746801">]</span>&nbsp;<span class="op" id="2746803">=</span>&nbsp;<span class="ident" id="2746805">s</span><span class="op" id="2746806">[</span><span class="ident" id="2746807">fieldStart</span><span class="op" id="2746817">:</span><span class="ident" id="2746818">i</span><span class="op" id="2746819">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746825">na</span><span class="op" id="2746827">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746834">fieldStart</span>&nbsp;<span class="op" id="2746845">=</span>&nbsp;<span class="op" id="2746847">-</span><span class="num" id="2746848">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2746853">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2746857">}</span>&nbsp;<span class="keyword" id="2746859">else</span>&nbsp;<span class="keyword" id="2746864">if</span>&nbsp;<span class="ident" id="2746867">fieldStart</span>&nbsp;<span class="op" id="2746878">==</span>&nbsp;<span class="op" id="2746881">-</span><span class="num" id="2746882">1</span>&nbsp;<span class="op" id="2746884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746889">fieldStart</span>&nbsp;<span class="op" id="2746900">=</span>&nbsp;<span class="ident" id="2746902">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2746906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2746909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2746912">if</span>&nbsp;<span class="ident" id="2746915">fieldStart</span>&nbsp;<span class="op" id="2746926">&gt;=</span>&nbsp;<span class="num" id="2746929">0</span>&nbsp;<span class="op" id="2746931">{</span>&nbsp;<span class="comment" id="2746933">//&nbsp;Last&nbsp;field&nbsp;might&nbsp;end&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2746967">a</span><span class="op" id="2746968">[</span><span class="ident" id="2746969">na</span><span class="op" id="2746971">]</span>&nbsp;<span class="op" id="2746973">=</span>&nbsp;<span class="ident" id="2746975">s</span><span class="op" id="2746976">[</span><span class="ident" id="2746977">fieldStart</span><span class="op" id="2746987">:</span><span class="op" id="2746988">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2746991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2746994">return</span>&nbsp;<span class="ident" id="2747001">a</span><br>
<span class="lineno"></span><span class="op" id="2747003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="comment" id="2747006">//&nbsp;Join&nbsp;concatenates&nbsp;the&nbsp;elements&nbsp;of&nbsp;a&nbsp;to&nbsp;create&nbsp;a&nbsp;single&nbsp;string.&nbsp;&nbsp;&nbsp;The&nbsp;separator&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2747095">//&nbsp;sep&nbsp;is&nbsp;placed&nbsp;between&nbsp;elements&nbsp;in&nbsp;the&nbsp;resulting&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2747154">func</span>&nbsp;<span class="ident" id="2747159">Join</span><span class="op" id="2747163">(</span><span class="ident" id="2747164">a</span>&nbsp;<span class="op" id="2747166">[</span><span class="op" id="2747167">]</span><span class="builtintype" id="2747168">string</span><span class="op" id="2747174">,</span>&nbsp;<span class="ident" id="2747176">sep</span>&nbsp;<span class="builtintype" id="2747180">string</span><span class="op" id="2747186">)</span>&nbsp;<span class="builtintype" id="2747188">string</span>&nbsp;<span class="op" id="2747195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2747198">if</span>&nbsp;<span class="builtinfunc" id="2747201">len</span><span class="op" id="2747204">(</span><span class="ident" id="2747205">a</span><span class="op" id="2747206">)</span>&nbsp;<span class="op" id="2747208">==</span>&nbsp;<span class="num" id="2747211">0</span>&nbsp;<span class="op" id="2747213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2747217">return</span>&nbsp;<span class="string" id="2747224">&#34;&#34;</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2747228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2747231">if</span>&nbsp;<span class="builtinfunc" id="2747234">len</span><span class="op" id="2747237">(</span><span class="ident" id="2747238">a</span><span class="op" id="2747239">)</span>&nbsp;<span class="op" id="2747241">==</span>&nbsp;<span class="num" id="2747244">1</span>&nbsp;<span class="op" id="2747246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2747250">return</span>&nbsp;<span class="ident" id="2747257">a</span><span class="op" id="2747258">[</span><span class="num" id="2747259">0</span><span class="op" id="2747260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2747263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2747266">n</span>&nbsp;<span class="op" id="2747268">:=</span>&nbsp;<span class="builtinfunc" id="2747271">len</span><span class="op" id="2747274">(</span><span class="ident" id="2747275">sep</span><span class="op" id="2747278">)</span>&nbsp;<span class="op" id="2747280">*</span>&nbsp;<span class="op" id="2747282">(</span><span class="builtinfunc" id="2747283">len</span><span class="op" id="2747286">(</span><span class="ident" id="2747287">a</span><span class="op" id="2747288">)</span>&nbsp;<span class="op" id="2747290">-</span>&nbsp;<span class="num" id="2747292">1</span><span class="op" id="2747293">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2747296">for</span>&nbsp;<span class="ident" id="2747300">i</span>&nbsp;<span class="op" id="2747302">:=</span>&nbsp;<span class="num" id="2747305">0</span><span class="op" id="2747306">;</span>&nbsp;<span class="ident" id="2747308">i</span>&nbsp;<span class="op" id="2747310">&lt;</span>&nbsp;<span class="builtinfunc" id="2747312">len</span><span class="op" id="2747315">(</span><span class="ident" id="2747316">a</span><span class="op" id="2747317">)</span><span class="op" id="2747318">;</span>&nbsp;<span class="ident" id="2747320">i</span><span class="op" id="2747321">++</span>&nbsp;<span class="op" id="2747324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2747328">n</span>&nbsp;<span class="op" id="2747330">+=</span>&nbsp;<span class="builtinfunc" id="2747333">len</span><span class="op" id="2747336">(</span><span class="ident" id="2747337">a</span><span class="op" id="2747338">[</span><span class="ident" id="2747339">i</span><span class="op" id="2747340">]</span><span class="op" id="2747341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2747344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2747348">b</span>&nbsp;<span class="op" id="2747350">:=</span>&nbsp;<span class="builtinfunc" id="2747353">make</span><span class="op" id="2747357">(</span><span class="op" id="2747358">[</span><span class="op" id="2747359">]</span><span class="builtintype" id="2747360">byte</span><span class="op" id="2747364">,</span>&nbsp;<span class="ident" id="2747366">n</span><span class="op" id="2747367">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2747370">bp</span>&nbsp;<span class="op" id="2747373">:=</span>&nbsp;<span class="builtinfunc" id="2747376">copy</span><span class="op" id="2747380">(</span><span class="ident" id="2747381">b</span><span class="op" id="2747382">,</span>&nbsp;<span class="ident" id="2747384">a</span><span class="op" id="2747385">[</span><span class="num" id="2747386">0</span><span class="op" id="2747387">]</span><span class="op" id="2747388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2747391">for</span>&nbsp;<span class="ident" id="2747395">_</span><span class="op" id="2747396">,</span>&nbsp;<span class="ident" id="2747398">s</span>&nbsp;<span class="op" id="2747400">:=</span>&nbsp;<span class="keyword" id="2747403">range</span>&nbsp;<span class="ident" id="2747409">a</span><span class="op" id="2747410">[</span><span class="num" id="2747411">1</span><span class="op" id="2747412">:</span><span class="op" id="2747413">]</span>&nbsp;<span class="op" id="2747415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2747419">bp</span>&nbsp;<span class="op" id="2747422">+=</span>&nbsp;<span class="builtinfunc" id="2747425">copy</span><span class="op" id="2747429">(</span><span class="ident" id="2747430">b</span><span class="op" id="2747431">[</span><span class="ident" id="2747432">bp</span><span class="op" id="2747434">:</span><span class="op" id="2747435">]</span><span class="op" id="2747436">,</span>&nbsp;<span class="ident" id="2747438">sep</span><span class="op" id="2747441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2747445">bp</span>&nbsp;<span class="op" id="2747448">+=</span>&nbsp;<span class="builtinfunc" id="2747451">copy</span><span class="op" id="2747455">(</span><span class="ident" id="2747456">b</span><span class="op" id="2747457">[</span><span class="ident" id="2747458">bp</span><span class="op" id="2747460">:</span><span class="op" id="2747461">]</span><span class="op" id="2747462">,</span>&nbsp;<span class="ident" id="2747464">s</span><span class="op" id="2747465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2747468">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2747471">return</span>&nbsp;<span class="builtintype" id="2747478">string</span><span class="op" id="2747484">(</span><span class="ident" id="2747485">b</span><span class="op" id="2747486">)</span><br>
<span class="lineno"></span><span class="op" id="2747488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2747491">//&nbsp;HasPrefix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;begins&nbsp;with&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="2747551">func</span>&nbsp;<span class="ident" id="2747556">HasPrefix</span><span class="op" id="2747565">(</span><span class="ident" id="2747566">s</span><span class="op" id="2747567">,</span>&nbsp;<span class="ident" id="2747569">prefix</span>&nbsp;<span class="builtintype" id="2747576">string</span><span class="op" id="2747582">)</span>&nbsp;<span class="builtintype" id="2747584">bool</span>&nbsp;<span class="op" id="2747589">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2747592">return</span>&nbsp;<span class="builtinfunc" id="2747599">len</span><span class="op" id="2747602">(</span><span class="ident" id="2747603">s</span><span class="op" id="2747604">)</span>&nbsp;<span class="op" id="2747606">&gt;=</span>&nbsp;<span class="builtinfunc" id="2747609">len</span><span class="op" id="2747612">(</span><span class="ident" id="2747613">prefix</span><span class="op" id="2747619">)</span>&nbsp;<span class="op" id="2747621">&amp;&amp;</span>&nbsp;<span class="ident" id="2747624">s</span><span class="op" id="2747625">[</span><span class="num" id="2747626">0</span><span class="op" id="2747627">:</span><span class="builtinfunc" id="2747628">len</span><span class="op" id="2747631">(</span><span class="ident" id="2747632">prefix</span><span class="op" id="2747638">)</span><span class="op" id="2747639">]</span>&nbsp;<span class="op" id="2747641">==</span>&nbsp;<span class="ident" id="2747644">prefix</span><br>
<span class="lineno"></span><span class="op" id="2747651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2747654">//&nbsp;HasSuffix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;ends&nbsp;with&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="2747712">func</span>&nbsp;<span class="ident" id="2747717">HasSuffix</span><span class="op" id="2747726">(</span><span class="ident" id="2747727">s</span><span class="op" id="2747728">,</span>&nbsp;<span class="ident" id="2747730">suffix</span>&nbsp;<span class="builtintype" id="2747737">string</span><span class="op" id="2747743">)</span>&nbsp;<span class="builtintype" id="2747745">bool</span>&nbsp;<span class="op" id="2747750">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2747753">return</span>&nbsp;<span class="builtinfunc" id="2747760">len</span><span class="op" id="2747763">(</span><span class="ident" id="2747764">s</span><span class="op" id="2747765">)</span>&nbsp;<span class="op" id="2747767">&gt;=</span>&nbsp;<span class="builtinfunc" id="2747770">len</span><span class="op" id="2747773">(</span><span class="ident" id="2747774">suffix</span><span class="op" id="2747780">)</span>&nbsp;<span class="op" id="2747782">&amp;&amp;</span>&nbsp;<span class="ident" id="2747785">s</span><span class="op" id="2747786">[</span><span class="builtinfunc" id="2747787">len</span><span class="op" id="2747790">(</span><span class="ident" id="2747791">s</span><span class="op" id="2747792">)</span><span class="op" id="2747793">-</span><span class="builtinfunc" id="2747794">len</span><span class="op" id="2747797">(</span><span class="ident" id="2747798">suffix</span><span class="op" id="2747804">)</span><span class="op" id="2747805">:</span><span class="op" id="2747806">]</span>&nbsp;<span class="op" id="2747808">==</span>&nbsp;<span class="ident" id="2747811">suffix</span><br>
<span class="lineno"></span><span class="op" id="2747818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2747821">//&nbsp;Map&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;its&nbsp;characters&nbsp;modified</span><br>
<span class="lineno"></span><span class="comment" id="2747892">//&nbsp;according&nbsp;to&nbsp;the&nbsp;mapping&nbsp;function.&nbsp;If&nbsp;mapping&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value,&nbsp;the&nbsp;character&nbsp;is</span><br>
<span class="lineno">415</span><span class="comment" id="2747984">//&nbsp;dropped&nbsp;from&nbsp;the&nbsp;string&nbsp;with&nbsp;no&nbsp;replacement.</span><br>
<span class="lineno"></span><span class="keyword" id="2748032">func</span>&nbsp;<span class="ident" id="2748037">Map</span><span class="op" id="2748040">(</span><span class="ident" id="2748041">mapping</span>&nbsp;<span class="keyword" id="2748049">func</span><span class="op" id="2748053">(</span><span class="builtintype" id="2748054">rune</span><span class="op" id="2748058">)</span>&nbsp;<span class="builtintype" id="2748060">rune</span><span class="op" id="2748064">,</span>&nbsp;<span class="ident" id="2748066">s</span>&nbsp;<span class="builtintype" id="2748068">string</span><span class="op" id="2748074">)</span>&nbsp;<span class="builtintype" id="2748076">string</span>&nbsp;<span class="op" id="2748083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2748086">//&nbsp;In&nbsp;the&nbsp;worst&nbsp;case,&nbsp;the&nbsp;string&nbsp;can&nbsp;grow&nbsp;when&nbsp;mapped,&nbsp;making</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2748149">//&nbsp;things&nbsp;unpleasant.&nbsp;&nbsp;But&nbsp;it&#39;s&nbsp;so&nbsp;rare&nbsp;we&nbsp;barge&nbsp;in&nbsp;assuming&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2748216">//&nbsp;fine.&nbsp;&nbsp;It&nbsp;could&nbsp;also&nbsp;shrink&nbsp;but&nbsp;that&nbsp;falls&nbsp;out&nbsp;naturally.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2748278">maxbytes</span>&nbsp;<span class="op" id="2748287">:=</span>&nbsp;<span class="builtinfunc" id="2748290">len</span><span class="op" id="2748293">(</span><span class="ident" id="2748294">s</span><span class="op" id="2748295">)</span>&nbsp;<span class="comment" id="2748297">//&nbsp;length&nbsp;of&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2748313">nbytes</span>&nbsp;<span class="op" id="2748320">:=</span>&nbsp;<span class="num" id="2748323">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2748332">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;encoded&nbsp;in&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2748365">//&nbsp;The&nbsp;output&nbsp;buffer&nbsp;b&nbsp;is&nbsp;initialized&nbsp;on&nbsp;demand,&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2748425">//&nbsp;time&nbsp;a&nbsp;character&nbsp;differs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2748455">var</span>&nbsp;<span class="ident" id="2748459">b</span>&nbsp;<span class="op" id="2748461">[</span><span class="op" id="2748462">]</span><span class="builtintype" id="2748463">byte</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2748470">for</span>&nbsp;<span class="ident" id="2748474">i</span><span class="op" id="2748475">,</span>&nbsp;<span class="ident" id="2748477">c</span>&nbsp;<span class="op" id="2748479">:=</span>&nbsp;<span class="keyword" id="2748482">range</span>&nbsp;<span class="ident" id="2748488">s</span>&nbsp;<span class="op" id="2748490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2748494">r</span>&nbsp;<span class="op" id="2748496">:=</span>&nbsp;<span class="ident" id="2748499">mapping</span><span class="op" id="2748506">(</span><span class="ident" id="2748507">c</span><span class="op" id="2748508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2748512">if</span>&nbsp;<span class="ident" id="2748515">b</span>&nbsp;<span class="op" id="2748517">==</span>&nbsp;<span class="ident" id="2748520">nil</span>&nbsp;<span class="op" id="2748524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2748529">if</span>&nbsp;<span class="ident" id="2748532">r</span>&nbsp;<span class="op" id="2748534">==</span>&nbsp;<span class="ident" id="2748537">c</span>&nbsp;<span class="op" id="2748539">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2748545">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2748557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2748562">b</span>&nbsp;<span class="op" id="2748564">=</span>&nbsp;<span class="builtinfunc" id="2748566">make</span><span class="op" id="2748570">(</span><span class="op" id="2748571">[</span><span class="op" id="2748572">]</span><span class="builtintype" id="2748573">byte</span><span class="op" id="2748577">,</span>&nbsp;<span class="ident" id="2748579">maxbytes</span><span class="op" id="2748587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2748592">nbytes</span>&nbsp;<span class="op" id="2748599">=</span>&nbsp;<span class="builtinfunc" id="2748601">copy</span><span class="op" id="2748605">(</span><span class="ident" id="2748606">b</span><span class="op" id="2748607">,</span>&nbsp;<span class="ident" id="2748609">s</span><span class="op" id="2748610">[</span><span class="op" id="2748611">:</span><span class="ident" id="2748612">i</span><span class="op" id="2748613">]</span><span class="op" id="2748614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2748618">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2748622">if</span>&nbsp;<span class="ident" id="2748625">r</span>&nbsp;<span class="op" id="2748627">&gt;=</span>&nbsp;<span class="num" id="2748630">0</span>&nbsp;<span class="op" id="2748632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2748637">wid</span>&nbsp;<span class="op" id="2748641">:=</span>&nbsp;<span class="num" id="2748644">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2748649">if</span>&nbsp;<span class="ident" id="2748652">r</span>&nbsp;<span class="op" id="2748654">&gt;=</span>&nbsp;<span class="ident" id="2748657">utf8</span><span class="op" id="2748661">.</span><span class="ident" id="2748662">RuneSelf</span>&nbsp;<span class="op" id="2748671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2748677">wid</span>&nbsp;<span class="op" id="2748681">=</span>&nbsp;<span class="ident" id="2748683">utf8</span><span class="op" id="2748687">.</span><span class="ident" id="2748688">RuneLen</span><span class="op" id="2748695">(</span><span class="ident" id="2748696">r</span><span class="op" id="2748697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2748702">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2748707">if</span>&nbsp;<span class="ident" id="2748710">nbytes</span><span class="op" id="2748716">+</span><span class="ident" id="2748717">wid</span>&nbsp;<span class="op" id="2748721">&gt;</span>&nbsp;<span class="ident" id="2748723">maxbytes</span>&nbsp;<span class="op" id="2748732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2748738">//&nbsp;Grow&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2748762">maxbytes</span>&nbsp;<span class="op" id="2748771">=</span>&nbsp;<span class="ident" id="2748773">maxbytes</span><span class="op" id="2748781">*</span><span class="num" id="2748782">2</span>&nbsp;<span class="op" id="2748784">+</span>&nbsp;<span class="ident" id="2748786">utf8</span><span class="op" id="2748790">.</span><span class="ident" id="2748791">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2748802">nb</span>&nbsp;<span class="op" id="2748805">:=</span>&nbsp;<span class="builtinfunc" id="2748808">make</span><span class="op" id="2748812">(</span><span class="op" id="2748813">[</span><span class="op" id="2748814">]</span><span class="builtintype" id="2748815">byte</span><span class="op" id="2748819">,</span>&nbsp;<span class="ident" id="2748821">maxbytes</span><span class="op" id="2748829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2748835">copy</span><span class="op" id="2748839">(</span><span class="ident" id="2748840">nb</span><span class="op" id="2748842">,</span>&nbsp;<span class="ident" id="2748844">b</span><span class="op" id="2748845">[</span><span class="num" id="2748846">0</span><span class="op" id="2748847">:</span><span class="ident" id="2748848">nbytes</span><span class="op" id="2748854">]</span><span class="op" id="2748855">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2748861">b</span>&nbsp;<span class="op" id="2748863">=</span>&nbsp;<span class="ident" id="2748865">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2748871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2748876">nbytes</span>&nbsp;<span class="op" id="2748883">+=</span>&nbsp;<span class="ident" id="2748886">utf8</span><span class="op" id="2748890">.</span><span class="ident" id="2748891">EncodeRune</span><span class="op" id="2748901">(</span><span class="ident" id="2748902">b</span><span class="op" id="2748903">[</span><span class="ident" id="2748904">nbytes</span><span class="op" id="2748910">:</span><span class="ident" id="2748911">maxbytes</span><span class="op" id="2748919">]</span><span class="op" id="2748920">,</span>&nbsp;<span class="ident" id="2748922">r</span><span class="op" id="2748923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2748927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2748930">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2748933">if</span>&nbsp;<span class="ident" id="2748936">b</span>&nbsp;<span class="op" id="2748938">==</span>&nbsp;<span class="ident" id="2748941">nil</span>&nbsp;<span class="op" id="2748945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2748949">return</span>&nbsp;<span class="ident" id="2748956">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2748959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2748962">return</span>&nbsp;<span class="builtintype" id="2748969">string</span><span class="op" id="2748975">(</span><span class="ident" id="2748976">b</span><span class="op" id="2748977">[</span><span class="num" id="2748978">0</span><span class="op" id="2748979">:</span><span class="ident" id="2748980">nbytes</span><span class="op" id="2748986">]</span><span class="op" id="2748987">)</span><br>
<span class="lineno"></span><span class="op" id="2748989">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="2748992">//&nbsp;Repeat&nbsp;returns&nbsp;a&nbsp;new&nbsp;string&nbsp;consisting&nbsp;of&nbsp;count&nbsp;copies&nbsp;of&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2749067">func</span>&nbsp;<span class="ident" id="2749072">Repeat</span><span class="op" id="2749078">(</span><span class="ident" id="2749079">s</span>&nbsp;<span class="builtintype" id="2749081">string</span><span class="op" id="2749087">,</span>&nbsp;<span class="ident" id="2749089">count</span>&nbsp;<span class="builtintype" id="2749095">int</span><span class="op" id="2749098">)</span>&nbsp;<span class="builtintype" id="2749100">string</span>&nbsp;<span class="op" id="2749107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2749110">b</span>&nbsp;<span class="op" id="2749112">:=</span>&nbsp;<span class="builtinfunc" id="2749115">make</span><span class="op" id="2749119">(</span><span class="op" id="2749120">[</span><span class="op" id="2749121">]</span><span class="builtintype" id="2749122">byte</span><span class="op" id="2749126">,</span>&nbsp;<span class="builtinfunc" id="2749128">len</span><span class="op" id="2749131">(</span><span class="ident" id="2749132">s</span><span class="op" id="2749133">)</span><span class="op" id="2749134">*</span><span class="ident" id="2749135">count</span><span class="op" id="2749140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2749143">bp</span>&nbsp;<span class="op" id="2749146">:=</span>&nbsp;<span class="builtinfunc" id="2749149">copy</span><span class="op" id="2749153">(</span><span class="ident" id="2749154">b</span><span class="op" id="2749155">,</span>&nbsp;<span class="ident" id="2749157">s</span><span class="op" id="2749158">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2749161">for</span>&nbsp;<span class="ident" id="2749165">bp</span>&nbsp;<span class="op" id="2749168">&lt;</span>&nbsp;<span class="builtinfunc" id="2749170">len</span><span class="op" id="2749173">(</span><span class="ident" id="2749174">b</span><span class="op" id="2749175">)</span>&nbsp;<span class="op" id="2749177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2749181">copy</span><span class="op" id="2749185">(</span><span class="ident" id="2749186">b</span><span class="op" id="2749187">[</span><span class="ident" id="2749188">bp</span><span class="op" id="2749190">:</span><span class="op" id="2749191">]</span><span class="op" id="2749192">,</span>&nbsp;<span class="ident" id="2749194">b</span><span class="op" id="2749195">[</span><span class="op" id="2749196">:</span><span class="ident" id="2749197">bp</span><span class="op" id="2749199">]</span><span class="op" id="2749200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2749204">bp</span>&nbsp;<span class="op" id="2749207">*=</span>&nbsp;<span class="num" id="2749210">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2749213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2749216">return</span>&nbsp;<span class="builtintype" id="2749223">string</span><span class="op" id="2749229">(</span><span class="ident" id="2749230">b</span><span class="op" id="2749231">)</span><br>
<span class="lineno">465</span><span class="op" id="2749233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2749236">//&nbsp;ToUpper&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2749331">func</span>&nbsp;<span class="ident" id="2749336">ToUpper</span><span class="op" id="2749343">(</span><span class="ident" id="2749344">s</span>&nbsp;<span class="builtintype" id="2749346">string</span><span class="op" id="2749352">)</span>&nbsp;<span class="builtintype" id="2749354">string</span>&nbsp;<span class="op" id="2749361">{</span>&nbsp;<span class="keyword" id="2749363">return</span>&nbsp;<span class="ident" id="2749370">Map</span><span class="op" id="2749373">(</span><span class="ident" id="2749374">unicode</span><span class="op" id="2749381">.</span><span class="ident" id="2749382">ToUpper</span><span class="op" id="2749389">,</span>&nbsp;<span class="ident" id="2749391">s</span><span class="op" id="2749392">)</span>&nbsp;<span class="op" id="2749394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="2749397">//&nbsp;ToLower&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2749492">func</span>&nbsp;<span class="ident" id="2749497">ToLower</span><span class="op" id="2749504">(</span><span class="ident" id="2749505">s</span>&nbsp;<span class="builtintype" id="2749507">string</span><span class="op" id="2749513">)</span>&nbsp;<span class="builtintype" id="2749515">string</span>&nbsp;<span class="op" id="2749522">{</span>&nbsp;<span class="keyword" id="2749524">return</span>&nbsp;<span class="ident" id="2749531">Map</span><span class="op" id="2749534">(</span><span class="ident" id="2749535">unicode</span><span class="op" id="2749542">.</span><span class="ident" id="2749543">ToLower</span><span class="op" id="2749550">,</span>&nbsp;<span class="ident" id="2749552">s</span><span class="op" id="2749553">)</span>&nbsp;<span class="op" id="2749555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2749558">//&nbsp;ToTitle&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2749653">func</span>&nbsp;<span class="ident" id="2749658">ToTitle</span><span class="op" id="2749665">(</span><span class="ident" id="2749666">s</span>&nbsp;<span class="builtintype" id="2749668">string</span><span class="op" id="2749674">)</span>&nbsp;<span class="builtintype" id="2749676">string</span>&nbsp;<span class="op" id="2749683">{</span>&nbsp;<span class="keyword" id="2749685">return</span>&nbsp;<span class="ident" id="2749692">Map</span><span class="op" id="2749695">(</span><span class="ident" id="2749696">unicode</span><span class="op" id="2749703">.</span><span class="ident" id="2749704">ToTitle</span><span class="op" id="2749711">,</span>&nbsp;<span class="ident" id="2749713">s</span><span class="op" id="2749714">)</span>&nbsp;<span class="op" id="2749716">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="2749719">//&nbsp;ToUpperSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2749809">//&nbsp;upper&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2749869">func</span>&nbsp;<span class="ident" id="2749874">ToUpperSpecial</span><span class="op" id="2749888">(</span><span class="ident" id="2749889">_case</span>&nbsp;<span class="ident" id="2749895">unicode</span><span class="op" id="2749902">.</span><span class="ident" id="2749903">SpecialCase</span><span class="op" id="2749914">,</span>&nbsp;<span class="ident" id="2749916">s</span>&nbsp;<span class="builtintype" id="2749918">string</span><span class="op" id="2749924">)</span>&nbsp;<span class="builtintype" id="2749926">string</span>&nbsp;<span class="op" id="2749933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2749936">return</span>&nbsp;<span class="ident" id="2749943">Map</span><span class="op" id="2749946">(</span><span class="keyword" id="2749947">func</span><span class="op" id="2749951">(</span><span class="ident" id="2749952">r</span>&nbsp;<span class="builtintype" id="2749954">rune</span><span class="op" id="2749958">)</span>&nbsp;<span class="builtintype" id="2749960">rune</span>&nbsp;<span class="op" id="2749965">{</span>&nbsp;<span class="keyword" id="2749967">return</span>&nbsp;<span class="ident" id="2749974">_case</span><span class="op" id="2749979">.</span><span class="ident" id="2749980">ToUpper</span><span class="op" id="2749987">(</span><span class="ident" id="2749988">r</span><span class="op" id="2749989">)</span>&nbsp;<span class="op" id="2749991">}</span><span class="op" id="2749992">,</span>&nbsp;<span class="ident" id="2749994">s</span><span class="op" id="2749995">)</span><br>
<span class="lineno">480</span><span class="op" id="2749997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2750000">//&nbsp;ToLowerSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2750090">//&nbsp;lower&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2750150">func</span>&nbsp;<span class="ident" id="2750155">ToLowerSpecial</span><span class="op" id="2750169">(</span><span class="ident" id="2750170">_case</span>&nbsp;<span class="ident" id="2750176">unicode</span><span class="op" id="2750183">.</span><span class="ident" id="2750184">SpecialCase</span><span class="op" id="2750195">,</span>&nbsp;<span class="ident" id="2750197">s</span>&nbsp;<span class="builtintype" id="2750199">string</span><span class="op" id="2750205">)</span>&nbsp;<span class="builtintype" id="2750207">string</span>&nbsp;<span class="op" id="2750214">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750217">return</span>&nbsp;<span class="ident" id="2750224">Map</span><span class="op" id="2750227">(</span><span class="keyword" id="2750228">func</span><span class="op" id="2750232">(</span><span class="ident" id="2750233">r</span>&nbsp;<span class="builtintype" id="2750235">rune</span><span class="op" id="2750239">)</span>&nbsp;<span class="builtintype" id="2750241">rune</span>&nbsp;<span class="op" id="2750246">{</span>&nbsp;<span class="keyword" id="2750248">return</span>&nbsp;<span class="ident" id="2750255">_case</span><span class="op" id="2750260">.</span><span class="ident" id="2750261">ToLower</span><span class="op" id="2750268">(</span><span class="ident" id="2750269">r</span><span class="op" id="2750270">)</span>&nbsp;<span class="op" id="2750272">}</span><span class="op" id="2750273">,</span>&nbsp;<span class="ident" id="2750275">s</span><span class="op" id="2750276">)</span><br>
<span class="lineno"></span><span class="op" id="2750278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2750281">//&nbsp;ToTitleSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2750371">//&nbsp;title&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno">490</span><span class="keyword" id="2750431">func</span>&nbsp;<span class="ident" id="2750436">ToTitleSpecial</span><span class="op" id="2750450">(</span><span class="ident" id="2750451">_case</span>&nbsp;<span class="ident" id="2750457">unicode</span><span class="op" id="2750464">.</span><span class="ident" id="2750465">SpecialCase</span><span class="op" id="2750476">,</span>&nbsp;<span class="ident" id="2750478">s</span>&nbsp;<span class="builtintype" id="2750480">string</span><span class="op" id="2750486">)</span>&nbsp;<span class="builtintype" id="2750488">string</span>&nbsp;<span class="op" id="2750495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750498">return</span>&nbsp;<span class="ident" id="2750505">Map</span><span class="op" id="2750508">(</span><span class="keyword" id="2750509">func</span><span class="op" id="2750513">(</span><span class="ident" id="2750514">r</span>&nbsp;<span class="builtintype" id="2750516">rune</span><span class="op" id="2750520">)</span>&nbsp;<span class="builtintype" id="2750522">rune</span>&nbsp;<span class="op" id="2750527">{</span>&nbsp;<span class="keyword" id="2750529">return</span>&nbsp;<span class="ident" id="2750536">_case</span><span class="op" id="2750541">.</span><span class="ident" id="2750542">ToTitle</span><span class="op" id="2750549">(</span><span class="ident" id="2750550">r</span><span class="op" id="2750551">)</span>&nbsp;<span class="op" id="2750553">}</span><span class="op" id="2750554">,</span>&nbsp;<span class="ident" id="2750556">s</span><span class="op" id="2750557">)</span><br>
<span class="lineno"></span><span class="op" id="2750559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2750562">//&nbsp;isSeparator&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;could&nbsp;mark&nbsp;a&nbsp;word&nbsp;boundary.</span><br>
<span class="lineno">495</span><span class="comment" id="2750630">//&nbsp;TODO:&nbsp;update&nbsp;when&nbsp;package&nbsp;unicode&nbsp;captures&nbsp;more&nbsp;of&nbsp;the&nbsp;properties.</span><br>
<span class="lineno"></span><span class="keyword" id="2750700">func</span>&nbsp;<span class="ident" id="2750705">isSeparator</span><span class="op" id="2750716">(</span><span class="ident" id="2750717">r</span>&nbsp;<span class="builtintype" id="2750719">rune</span><span class="op" id="2750723">)</span>&nbsp;<span class="builtintype" id="2750725">bool</span>&nbsp;<span class="op" id="2750730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2750733">//&nbsp;ASCII&nbsp;alphanumerics&nbsp;and&nbsp;underscore&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750791">if</span>&nbsp;<span class="ident" id="2750794">r</span>&nbsp;<span class="op" id="2750796">&lt;=</span>&nbsp;<span class="num" id="2750799">0x7F</span>&nbsp;<span class="op" id="2750804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750808">switch</span>&nbsp;<span class="op" id="2750815">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750819">case</span>&nbsp;<span class="string" id="2750824">&#39;0&#39;</span>&nbsp;<span class="op" id="2750828">&lt;=</span>&nbsp;<span class="ident" id="2750831">r</span>&nbsp;<span class="op" id="2750833">&amp;&amp;</span>&nbsp;<span class="ident" id="2750836">r</span>&nbsp;<span class="op" id="2750838">&lt;=</span>&nbsp;<span class="string" id="2750841">&#39;9&#39;</span><span class="op" id="2750844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750849">return</span>&nbsp;<span class="ident" id="2750856">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750864">case</span>&nbsp;<span class="string" id="2750869">&#39;a&#39;</span>&nbsp;<span class="op" id="2750873">&lt;=</span>&nbsp;<span class="ident" id="2750876">r</span>&nbsp;<span class="op" id="2750878">&amp;&amp;</span>&nbsp;<span class="ident" id="2750881">r</span>&nbsp;<span class="op" id="2750883">&lt;=</span>&nbsp;<span class="string" id="2750886">&#39;z&#39;</span><span class="op" id="2750889">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750894">return</span>&nbsp;<span class="ident" id="2750901">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750909">case</span>&nbsp;<span class="string" id="2750914">&#39;A&#39;</span>&nbsp;<span class="op" id="2750918">&lt;=</span>&nbsp;<span class="ident" id="2750921">r</span>&nbsp;<span class="op" id="2750923">&amp;&amp;</span>&nbsp;<span class="ident" id="2750926">r</span>&nbsp;<span class="op" id="2750928">&lt;=</span>&nbsp;<span class="string" id="2750931">&#39;Z&#39;</span><span class="op" id="2750934">:</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750939">return</span>&nbsp;<span class="ident" id="2750946">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750954">case</span>&nbsp;<span class="ident" id="2750959">r</span>&nbsp;<span class="op" id="2750961">==</span>&nbsp;<span class="string" id="2750964">&#39;_&#39;</span><span class="op" id="2750967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750972">return</span>&nbsp;<span class="ident" id="2750979">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2750987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2750991">return</span>&nbsp;<span class="ident" id="2750998">true</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2751004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2751007">//&nbsp;Letters&nbsp;and&nbsp;digits&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2751049">if</span>&nbsp;<span class="ident" id="2751052">unicode</span><span class="op" id="2751059">.</span><span class="ident" id="2751060">IsLetter</span><span class="op" id="2751068">(</span><span class="ident" id="2751069">r</span><span class="op" id="2751070">)</span>&nbsp;<span class="op" id="2751072">||</span>&nbsp;<span class="ident" id="2751075">unicode</span><span class="op" id="2751082">.</span><span class="ident" id="2751083">IsDigit</span><span class="op" id="2751090">(</span><span class="ident" id="2751091">r</span><span class="op" id="2751092">)</span>&nbsp;<span class="op" id="2751094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2751098">return</span>&nbsp;<span class="ident" id="2751105">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2751112">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2751115">//&nbsp;Otherwise,&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;for&nbsp;now&nbsp;is&nbsp;treat&nbsp;spaces&nbsp;as&nbsp;separators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2751183">return</span>&nbsp;<span class="ident" id="2751190">unicode</span><span class="op" id="2751197">.</span><span class="ident" id="2751198">IsSpace</span><span class="op" id="2751205">(</span><span class="ident" id="2751206">r</span><span class="op" id="2751207">)</span><br>
<span class="lineno"></span><span class="op" id="2751209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2751212">//&nbsp;Title&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;that&nbsp;begin&nbsp;words</span><br>
<span class="lineno">520</span><span class="comment" id="2751294">//&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="comment" id="2751325">//</span><br>
<span class="lineno"></span><span class="comment" id="2751328">//&nbsp;BUG:&nbsp;The&nbsp;rule&nbsp;Title&nbsp;uses&nbsp;for&nbsp;word&nbsp;boundaries&nbsp;does&nbsp;not&nbsp;handle&nbsp;Unicode&nbsp;punctuation&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2751422">func</span>&nbsp;<span class="ident" id="2751427">Title</span><span class="op" id="2751432">(</span><span class="ident" id="2751433">s</span>&nbsp;<span class="builtintype" id="2751435">string</span><span class="op" id="2751441">)</span>&nbsp;<span class="builtintype" id="2751443">string</span>&nbsp;<span class="op" id="2751450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2751453">//&nbsp;Use&nbsp;a&nbsp;closure&nbsp;here&nbsp;to&nbsp;remember&nbsp;state.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2751495">//&nbsp;Hackish&nbsp;but&nbsp;effective.&nbsp;Depends&nbsp;on&nbsp;Map&nbsp;scanning&nbsp;in&nbsp;order&nbsp;and&nbsp;calling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2751567">//&nbsp;the&nbsp;closure&nbsp;once&nbsp;per&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2751598">prev</span>&nbsp;<span class="op" id="2751603">:=</span>&nbsp;<span class="string" id="2751606">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2751611">return</span>&nbsp;<span class="ident" id="2751618">Map</span><span class="op" id="2751621">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2751625">func</span><span class="op" id="2751629">(</span><span class="ident" id="2751630">r</span>&nbsp;<span class="builtintype" id="2751632">rune</span><span class="op" id="2751636">)</span>&nbsp;<span class="builtintype" id="2751638">rune</span>&nbsp;<span class="op" id="2751643">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2751648">if</span>&nbsp;<span class="ident" id="2751651">isSeparator</span><span class="op" id="2751662">(</span><span class="ident" id="2751663">prev</span><span class="op" id="2751667">)</span>&nbsp;<span class="op" id="2751669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2751675">prev</span>&nbsp;<span class="op" id="2751680">=</span>&nbsp;<span class="ident" id="2751682">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2751688">return</span>&nbsp;<span class="ident" id="2751695">unicode</span><span class="op" id="2751702">.</span><span class="ident" id="2751703">ToTitle</span><span class="op" id="2751710">(</span><span class="ident" id="2751711">r</span><span class="op" id="2751712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2751717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2751722">prev</span>&nbsp;<span class="op" id="2751727">=</span>&nbsp;<span class="ident" id="2751729">r</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2751734">return</span>&nbsp;<span class="ident" id="2751741">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2751745">}</span><span class="op" id="2751746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2751750">s</span><span class="op" id="2751751">)</span><br>
<span class="lineno"></span><span class="op" id="2751753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="2751756">//&nbsp;TrimLeftFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2751821">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2751871">func</span>&nbsp;<span class="ident" id="2751876">TrimLeftFunc</span><span class="op" id="2751888">(</span><span class="ident" id="2751889">s</span>&nbsp;<span class="builtintype" id="2751891">string</span><span class="op" id="2751897">,</span>&nbsp;<span class="ident" id="2751899">f</span>&nbsp;<span class="keyword" id="2751901">func</span><span class="op" id="2751905">(</span><span class="builtintype" id="2751906">rune</span><span class="op" id="2751910">)</span>&nbsp;<span class="builtintype" id="2751912">bool</span><span class="op" id="2751916">)</span>&nbsp;<span class="builtintype" id="2751918">string</span>&nbsp;<span class="op" id="2751925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2751928">i</span>&nbsp;<span class="op" id="2751930">:=</span>&nbsp;<span class="ident" id="2751933">indexFunc</span><span class="op" id="2751942">(</span><span class="ident" id="2751943">s</span><span class="op" id="2751944">,</span>&nbsp;<span class="ident" id="2751946">f</span><span class="op" id="2751947">,</span>&nbsp;<span class="ident" id="2751949">false</span><span class="op" id="2751954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2751957">if</span>&nbsp;<span class="ident" id="2751960">i</span>&nbsp;<span class="op" id="2751962">==</span>&nbsp;<span class="op" id="2751965">-</span><span class="num" id="2751966">1</span>&nbsp;<span class="op" id="2751968">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2751972">return</span>&nbsp;<span class="string" id="2751979">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2751983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2751986">return</span>&nbsp;<span class="ident" id="2751993">s</span><span class="op" id="2751994">[</span><span class="ident" id="2751995">i</span><span class="op" id="2751996">:</span><span class="op" id="2751997">]</span><br>
<span class="lineno"></span><span class="op" id="2751999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span><span class="comment" id="2752002">//&nbsp;TrimRightFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2752069">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2752119">func</span>&nbsp;<span class="ident" id="2752124">TrimRightFunc</span><span class="op" id="2752137">(</span><span class="ident" id="2752138">s</span>&nbsp;<span class="builtintype" id="2752140">string</span><span class="op" id="2752146">,</span>&nbsp;<span class="ident" id="2752148">f</span>&nbsp;<span class="keyword" id="2752150">func</span><span class="op" id="2752154">(</span><span class="builtintype" id="2752155">rune</span><span class="op" id="2752159">)</span>&nbsp;<span class="builtintype" id="2752161">bool</span><span class="op" id="2752165">)</span>&nbsp;<span class="builtintype" id="2752167">string</span>&nbsp;<span class="op" id="2752174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2752177">i</span>&nbsp;<span class="op" id="2752179">:=</span>&nbsp;<span class="ident" id="2752182">lastIndexFunc</span><span class="op" id="2752195">(</span><span class="ident" id="2752196">s</span><span class="op" id="2752197">,</span>&nbsp;<span class="ident" id="2752199">f</span><span class="op" id="2752200">,</span>&nbsp;<span class="ident" id="2752202">false</span><span class="op" id="2752207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2752210">if</span>&nbsp;<span class="ident" id="2752213">i</span>&nbsp;<span class="op" id="2752215">&gt;=</span>&nbsp;<span class="num" id="2752218">0</span>&nbsp;<span class="op" id="2752220">&amp;&amp;</span>&nbsp;<span class="ident" id="2752223">s</span><span class="op" id="2752224">[</span><span class="ident" id="2752225">i</span><span class="op" id="2752226">]</span>&nbsp;<span class="op" id="2752228">&gt;=</span>&nbsp;<span class="ident" id="2752231">utf8</span><span class="op" id="2752235">.</span><span class="ident" id="2752236">RuneSelf</span>&nbsp;<span class="op" id="2752245">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2752249">_</span><span class="op" id="2752250">,</span>&nbsp;<span class="ident" id="2752252">wid</span>&nbsp;<span class="op" id="2752256">:=</span>&nbsp;<span class="ident" id="2752259">utf8</span><span class="op" id="2752263">.</span><span class="ident" id="2752264">DecodeRuneInString</span><span class="op" id="2752282">(</span><span class="ident" id="2752283">s</span><span class="op" id="2752284">[</span><span class="ident" id="2752285">i</span><span class="op" id="2752286">:</span><span class="op" id="2752287">]</span><span class="op" id="2752288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2752292">i</span>&nbsp;<span class="op" id="2752294">+=</span>&nbsp;<span class="ident" id="2752297">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2752302">}</span>&nbsp;<span class="keyword" id="2752304">else</span>&nbsp;<span class="op" id="2752309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2752313">i</span><span class="op" id="2752314">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2752318">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2752321">return</span>&nbsp;<span class="ident" id="2752328">s</span><span class="op" id="2752329">[</span><span class="num" id="2752330">0</span><span class="op" id="2752331">:</span><span class="ident" id="2752332">i</span><span class="op" id="2752333">]</span><br>
<span class="lineno"></span><span class="op" id="2752335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2752338">//&nbsp;TrimFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2752399">//&nbsp;and&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno">565</span><span class="keyword" id="2752462">func</span>&nbsp;<span class="ident" id="2752467">TrimFunc</span><span class="op" id="2752475">(</span><span class="ident" id="2752476">s</span>&nbsp;<span class="builtintype" id="2752478">string</span><span class="op" id="2752484">,</span>&nbsp;<span class="ident" id="2752486">f</span>&nbsp;<span class="keyword" id="2752488">func</span><span class="op" id="2752492">(</span><span class="builtintype" id="2752493">rune</span><span class="op" id="2752497">)</span>&nbsp;<span class="builtintype" id="2752499">bool</span><span class="op" id="2752503">)</span>&nbsp;<span class="builtintype" id="2752505">string</span>&nbsp;<span class="op" id="2752512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2752515">return</span>&nbsp;<span class="ident" id="2752522">TrimRightFunc</span><span class="op" id="2752535">(</span><span class="ident" id="2752536">TrimLeftFunc</span><span class="op" id="2752548">(</span><span class="ident" id="2752549">s</span><span class="op" id="2752550">,</span>&nbsp;<span class="ident" id="2752552">f</span><span class="op" id="2752553">)</span><span class="op" id="2752554">,</span>&nbsp;<span class="ident" id="2752556">f</span><span class="op" id="2752557">)</span><br>
<span class="lineno"></span><span class="op" id="2752559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2752562">//&nbsp;IndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;first&nbsp;Unicode</span><br>
<span class="lineno">570</span><span class="comment" id="2752621">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2752670">func</span>&nbsp;<span class="ident" id="2752675">IndexFunc</span><span class="op" id="2752684">(</span><span class="ident" id="2752685">s</span>&nbsp;<span class="builtintype" id="2752687">string</span><span class="op" id="2752693">,</span>&nbsp;<span class="ident" id="2752695">f</span>&nbsp;<span class="keyword" id="2752697">func</span><span class="op" id="2752701">(</span><span class="builtintype" id="2752702">rune</span><span class="op" id="2752706">)</span>&nbsp;<span class="builtintype" id="2752708">bool</span><span class="op" id="2752712">)</span>&nbsp;<span class="builtintype" id="2752714">int</span>&nbsp;<span class="op" id="2752718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2752721">return</span>&nbsp;<span class="ident" id="2752728">indexFunc</span><span class="op" id="2752737">(</span><span class="ident" id="2752738">s</span><span class="op" id="2752739">,</span>&nbsp;<span class="ident" id="2752741">f</span><span class="op" id="2752742">,</span>&nbsp;<span class="ident" id="2752744">true</span><span class="op" id="2752748">)</span><br>
<span class="lineno"></span><span class="op" id="2752750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="2752753">//&nbsp;LastIndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span><span class="comment" id="2752807">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2752864">func</span>&nbsp;<span class="ident" id="2752869">LastIndexFunc</span><span class="op" id="2752882">(</span><span class="ident" id="2752883">s</span>&nbsp;<span class="builtintype" id="2752885">string</span><span class="op" id="2752891">,</span>&nbsp;<span class="ident" id="2752893">f</span>&nbsp;<span class="keyword" id="2752895">func</span><span class="op" id="2752899">(</span><span class="builtintype" id="2752900">rune</span><span class="op" id="2752904">)</span>&nbsp;<span class="builtintype" id="2752906">bool</span><span class="op" id="2752910">)</span>&nbsp;<span class="builtintype" id="2752912">int</span>&nbsp;<span class="op" id="2752916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2752919">return</span>&nbsp;<span class="ident" id="2752926">lastIndexFunc</span><span class="op" id="2752939">(</span><span class="ident" id="2752940">s</span><span class="op" id="2752941">,</span>&nbsp;<span class="ident" id="2752943">f</span><span class="op" id="2752944">,</span>&nbsp;<span class="ident" id="2752946">true</span><span class="op" id="2752950">)</span><br>
<span class="lineno"></span><span class="op" id="2752952">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span><span class="comment" id="2752955">//&nbsp;indexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;IndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2753008">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2753064">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2753077">func</span>&nbsp;<span class="ident" id="2753082">indexFunc</span><span class="op" id="2753091">(</span><span class="ident" id="2753092">s</span>&nbsp;<span class="builtintype" id="2753094">string</span><span class="op" id="2753100">,</span>&nbsp;<span class="ident" id="2753102">f</span>&nbsp;<span class="keyword" id="2753104">func</span><span class="op" id="2753108">(</span><span class="builtintype" id="2753109">rune</span><span class="op" id="2753113">)</span>&nbsp;<span class="builtintype" id="2753115">bool</span><span class="op" id="2753119">,</span>&nbsp;<span class="ident" id="2753121">truth</span>&nbsp;<span class="builtintype" id="2753127">bool</span><span class="op" id="2753131">)</span>&nbsp;<span class="builtintype" id="2753133">int</span>&nbsp;<span class="op" id="2753137">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2753140">start</span>&nbsp;<span class="op" id="2753146">:=</span>&nbsp;<span class="num" id="2753149">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2753152">for</span>&nbsp;<span class="ident" id="2753156">start</span>&nbsp;<span class="op" id="2753162">&lt;</span>&nbsp;<span class="builtinfunc" id="2753164">len</span><span class="op" id="2753167">(</span><span class="ident" id="2753168">s</span><span class="op" id="2753169">)</span>&nbsp;<span class="op" id="2753171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2753175">wid</span>&nbsp;<span class="op" id="2753179">:=</span>&nbsp;<span class="num" id="2753182">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2753186">r</span>&nbsp;<span class="op" id="2753188">:=</span>&nbsp;<span class="builtintype" id="2753191">rune</span><span class="op" id="2753195">(</span><span class="ident" id="2753196">s</span><span class="op" id="2753197">[</span><span class="ident" id="2753198">start</span><span class="op" id="2753203">]</span><span class="op" id="2753204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2753208">if</span>&nbsp;<span class="ident" id="2753211">r</span>&nbsp;<span class="op" id="2753213">&gt;=</span>&nbsp;<span class="ident" id="2753216">utf8</span><span class="op" id="2753220">.</span><span class="ident" id="2753221">RuneSelf</span>&nbsp;<span class="op" id="2753230">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2753235">r</span><span class="op" id="2753236">,</span>&nbsp;<span class="ident" id="2753238">wid</span>&nbsp;<span class="op" id="2753242">=</span>&nbsp;<span class="ident" id="2753244">utf8</span><span class="op" id="2753248">.</span><span class="ident" id="2753249">DecodeRuneInString</span><span class="op" id="2753267">(</span><span class="ident" id="2753268">s</span><span class="op" id="2753269">[</span><span class="ident" id="2753270">start</span><span class="op" id="2753275">:</span><span class="op" id="2753276">]</span><span class="op" id="2753277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2753281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2753285">if</span>&nbsp;<span class="ident" id="2753288">f</span><span class="op" id="2753289">(</span><span class="ident" id="2753290">r</span><span class="op" id="2753291">)</span>&nbsp;<span class="op" id="2753293">==</span>&nbsp;<span class="ident" id="2753296">truth</span>&nbsp;<span class="op" id="2753302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2753307">return</span>&nbsp;<span class="ident" id="2753314">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2753322">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2753326">start</span>&nbsp;<span class="op" id="2753332">+=</span>&nbsp;<span class="ident" id="2753335">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2753340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2753343">return</span>&nbsp;<span class="op" id="2753350">-</span><span class="num" id="2753351">1</span><br>
<span class="lineno"></span><span class="op" id="2753353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="2753356">//&nbsp;lastIndexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;LastIndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2753417">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2753473">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2753486">func</span>&nbsp;<span class="ident" id="2753491">lastIndexFunc</span><span class="op" id="2753504">(</span><span class="ident" id="2753505">s</span>&nbsp;<span class="builtintype" id="2753507">string</span><span class="op" id="2753513">,</span>&nbsp;<span class="ident" id="2753515">f</span>&nbsp;<span class="keyword" id="2753517">func</span><span class="op" id="2753521">(</span><span class="builtintype" id="2753522">rune</span><span class="op" id="2753526">)</span>&nbsp;<span class="builtintype" id="2753528">bool</span><span class="op" id="2753532">,</span>&nbsp;<span class="ident" id="2753534">truth</span>&nbsp;<span class="builtintype" id="2753540">bool</span><span class="op" id="2753544">)</span>&nbsp;<span class="builtintype" id="2753546">int</span>&nbsp;<span class="op" id="2753550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2753553">for</span>&nbsp;<span class="ident" id="2753557">i</span>&nbsp;<span class="op" id="2753559">:=</span>&nbsp;<span class="builtinfunc" id="2753562">len</span><span class="op" id="2753565">(</span><span class="ident" id="2753566">s</span><span class="op" id="2753567">)</span><span class="op" id="2753568">;</span>&nbsp;<span class="ident" id="2753570">i</span>&nbsp;<span class="op" id="2753572">&gt;</span>&nbsp;<span class="num" id="2753574">0</span><span class="op" id="2753575">;</span>&nbsp;<span class="op" id="2753577">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2753581">r</span><span class="op" id="2753582">,</span>&nbsp;<span class="ident" id="2753584">size</span>&nbsp;<span class="op" id="2753589">:=</span>&nbsp;<span class="ident" id="2753592">utf8</span><span class="op" id="2753596">.</span><span class="ident" id="2753597">DecodeLastRuneInString</span><span class="op" id="2753619">(</span><span class="ident" id="2753620">s</span><span class="op" id="2753621">[</span><span class="num" id="2753622">0</span><span class="op" id="2753623">:</span><span class="ident" id="2753624">i</span><span class="op" id="2753625">]</span><span class="op" id="2753626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2753630">i</span>&nbsp;<span class="op" id="2753632">-=</span>&nbsp;<span class="ident" id="2753635">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2753642">if</span>&nbsp;<span class="ident" id="2753645">f</span><span class="op" id="2753646">(</span><span class="ident" id="2753647">r</span><span class="op" id="2753648">)</span>&nbsp;<span class="op" id="2753650">==</span>&nbsp;<span class="ident" id="2753653">truth</span>&nbsp;<span class="op" id="2753659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2753664">return</span>&nbsp;<span class="ident" id="2753671">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2753675">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2753678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2753681">return</span>&nbsp;<span class="op" id="2753688">-</span><span class="num" id="2753689">1</span><br>
<span class="lineno"></span><span class="op" id="2753691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2753694">func</span>&nbsp;<span class="ident" id="2753699">makeCutsetFunc</span><span class="op" id="2753713">(</span><span class="ident" id="2753714">cutset</span>&nbsp;<span class="builtintype" id="2753721">string</span><span class="op" id="2753727">)</span>&nbsp;<span class="keyword" id="2753729">func</span><span class="op" id="2753733">(</span><span class="builtintype" id="2753734">rune</span><span class="op" id="2753738">)</span>&nbsp;<span class="builtintype" id="2753740">bool</span>&nbsp;<span class="op" id="2753745">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2753748">return</span>&nbsp;<span class="keyword" id="2753755">func</span><span class="op" id="2753759">(</span><span class="ident" id="2753760">r</span>&nbsp;<span class="builtintype" id="2753762">rune</span><span class="op" id="2753766">)</span>&nbsp;<span class="builtintype" id="2753768">bool</span>&nbsp;<span class="op" id="2753773">{</span>&nbsp;<span class="keyword" id="2753775">return</span>&nbsp;<span class="ident" id="2753782">IndexRune</span><span class="op" id="2753791">(</span><span class="ident" id="2753792">cutset</span><span class="op" id="2753798">,</span>&nbsp;<span class="ident" id="2753800">r</span><span class="op" id="2753801">)</span>&nbsp;<span class="op" id="2753803">&gt;=</span>&nbsp;<span class="num" id="2753806">0</span>&nbsp;<span class="op" id="2753808">}</span><br>
<span class="lineno"></span><span class="op" id="2753810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2753813">//&nbsp;Trim&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2753874">//&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno">620</span><span class="keyword" id="2753935">func</span>&nbsp;<span class="ident" id="2753940">Trim</span><span class="op" id="2753944">(</span><span class="ident" id="2753945">s</span>&nbsp;<span class="builtintype" id="2753947">string</span><span class="op" id="2753953">,</span>&nbsp;<span class="ident" id="2753955">cutset</span>&nbsp;<span class="builtintype" id="2753962">string</span><span class="op" id="2753968">)</span>&nbsp;<span class="builtintype" id="2753970">string</span>&nbsp;<span class="op" id="2753977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2753980">if</span>&nbsp;<span class="ident" id="2753983">s</span>&nbsp;<span class="op" id="2753985">==</span>&nbsp;<span class="string" id="2753988">&#34;&#34;</span>&nbsp;<span class="op" id="2753991">||</span>&nbsp;<span class="ident" id="2753994">cutset</span>&nbsp;<span class="op" id="2754001">==</span>&nbsp;<span class="string" id="2754004">&#34;&#34;</span>&nbsp;<span class="op" id="2754007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2754011">return</span>&nbsp;<span class="ident" id="2754018">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2754021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2754024">return</span>&nbsp;<span class="ident" id="2754031">TrimFunc</span><span class="op" id="2754039">(</span><span class="ident" id="2754040">s</span><span class="op" id="2754041">,</span>&nbsp;<span class="ident" id="2754043">makeCutsetFunc</span><span class="op" id="2754057">(</span><span class="ident" id="2754058">cutset</span><span class="op" id="2754064">)</span><span class="op" id="2754065">)</span><br>
<span class="lineno">625</span><span class="op" id="2754067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2754070">//&nbsp;TrimLeft&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2754131">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2754183">func</span>&nbsp;<span class="ident" id="2754188">TrimLeft</span><span class="op" id="2754196">(</span><span class="ident" id="2754197">s</span>&nbsp;<span class="builtintype" id="2754199">string</span><span class="op" id="2754205">,</span>&nbsp;<span class="ident" id="2754207">cutset</span>&nbsp;<span class="builtintype" id="2754214">string</span><span class="op" id="2754220">)</span>&nbsp;<span class="builtintype" id="2754222">string</span>&nbsp;<span class="op" id="2754229">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2754232">if</span>&nbsp;<span class="ident" id="2754235">s</span>&nbsp;<span class="op" id="2754237">==</span>&nbsp;<span class="string" id="2754240">&#34;&#34;</span>&nbsp;<span class="op" id="2754243">||</span>&nbsp;<span class="ident" id="2754246">cutset</span>&nbsp;<span class="op" id="2754253">==</span>&nbsp;<span class="string" id="2754256">&#34;&#34;</span>&nbsp;<span class="op" id="2754259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2754263">return</span>&nbsp;<span class="ident" id="2754270">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2754273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2754276">return</span>&nbsp;<span class="ident" id="2754283">TrimLeftFunc</span><span class="op" id="2754295">(</span><span class="ident" id="2754296">s</span><span class="op" id="2754297">,</span>&nbsp;<span class="ident" id="2754299">makeCutsetFunc</span><span class="op" id="2754313">(</span><span class="ident" id="2754314">cutset</span><span class="op" id="2754320">)</span><span class="op" id="2754321">)</span><br>
<span class="lineno"></span><span class="op" id="2754323">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span><span class="comment" id="2754326">//&nbsp;TrimRight&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2754390">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2754442">func</span>&nbsp;<span class="ident" id="2754447">TrimRight</span><span class="op" id="2754456">(</span><span class="ident" id="2754457">s</span>&nbsp;<span class="builtintype" id="2754459">string</span><span class="op" id="2754465">,</span>&nbsp;<span class="ident" id="2754467">cutset</span>&nbsp;<span class="builtintype" id="2754474">string</span><span class="op" id="2754480">)</span>&nbsp;<span class="builtintype" id="2754482">string</span>&nbsp;<span class="op" id="2754489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2754492">if</span>&nbsp;<span class="ident" id="2754495">s</span>&nbsp;<span class="op" id="2754497">==</span>&nbsp;<span class="string" id="2754500">&#34;&#34;</span>&nbsp;<span class="op" id="2754503">||</span>&nbsp;<span class="ident" id="2754506">cutset</span>&nbsp;<span class="op" id="2754513">==</span>&nbsp;<span class="string" id="2754516">&#34;&#34;</span>&nbsp;<span class="op" id="2754519">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2754523">return</span>&nbsp;<span class="ident" id="2754530">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2754533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2754536">return</span>&nbsp;<span class="ident" id="2754543">TrimRightFunc</span><span class="op" id="2754556">(</span><span class="ident" id="2754557">s</span><span class="op" id="2754558">,</span>&nbsp;<span class="ident" id="2754560">makeCutsetFunc</span><span class="op" id="2754574">(</span><span class="ident" id="2754575">cutset</span><span class="op" id="2754581">)</span><span class="op" id="2754582">)</span><br>
<span class="lineno"></span><span class="op" id="2754584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span><span class="comment" id="2754587">//&nbsp;TrimSpace&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2754650">//&nbsp;and&nbsp;trailing&nbsp;white&nbsp;space&nbsp;removed,&nbsp;as&nbsp;defined&nbsp;by&nbsp;Unicode.</span><br>
<span class="lineno"></span><span class="keyword" id="2754710">func</span>&nbsp;<span class="ident" id="2754715">TrimSpace</span><span class="op" id="2754724">(</span><span class="ident" id="2754725">s</span>&nbsp;<span class="builtintype" id="2754727">string</span><span class="op" id="2754733">)</span>&nbsp;<span class="builtintype" id="2754735">string</span>&nbsp;<span class="op" id="2754742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2754745">return</span>&nbsp;<span class="ident" id="2754752">TrimFunc</span><span class="op" id="2754760">(</span><span class="ident" id="2754761">s</span><span class="op" id="2754762">,</span>&nbsp;<span class="ident" id="2754764">unicode</span><span class="op" id="2754771">.</span><span class="ident" id="2754772">IsSpace</span><span class="op" id="2754779">)</span><br>
<span class="lineno"></span><span class="op" id="2754781">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span><span class="comment" id="2754784">//&nbsp;TrimPrefix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;leading&nbsp;prefix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2754852">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;start&nbsp;with&nbsp;prefix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2754912">func</span>&nbsp;<span class="ident" id="2754917">TrimPrefix</span><span class="op" id="2754927">(</span><span class="ident" id="2754928">s</span><span class="op" id="2754929">,</span>&nbsp;<span class="ident" id="2754931">prefix</span>&nbsp;<span class="builtintype" id="2754938">string</span><span class="op" id="2754944">)</span>&nbsp;<span class="builtintype" id="2754946">string</span>&nbsp;<span class="op" id="2754953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2754956">if</span>&nbsp;<span class="ident" id="2754959">HasPrefix</span><span class="op" id="2754968">(</span><span class="ident" id="2754969">s</span><span class="op" id="2754970">,</span>&nbsp;<span class="ident" id="2754972">prefix</span><span class="op" id="2754978">)</span>&nbsp;<span class="op" id="2754980">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2754984">return</span>&nbsp;<span class="ident" id="2754991">s</span><span class="op" id="2754992">[</span><span class="builtinfunc" id="2754993">len</span><span class="op" id="2754996">(</span><span class="ident" id="2754997">prefix</span><span class="op" id="2755003">)</span><span class="op" id="2755004">:</span><span class="op" id="2755005">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2755008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2755011">return</span>&nbsp;<span class="ident" id="2755018">s</span><br>
<span class="lineno"></span><span class="op" id="2755020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="2755023">//&nbsp;TrimSuffix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;trailing&nbsp;suffix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2755092">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;end&nbsp;with&nbsp;suffix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2755150">func</span>&nbsp;<span class="ident" id="2755155">TrimSuffix</span><span class="op" id="2755165">(</span><span class="ident" id="2755166">s</span><span class="op" id="2755167">,</span>&nbsp;<span class="ident" id="2755169">suffix</span>&nbsp;<span class="builtintype" id="2755176">string</span><span class="op" id="2755182">)</span>&nbsp;<span class="builtintype" id="2755184">string</span>&nbsp;<span class="op" id="2755191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2755194">if</span>&nbsp;<span class="ident" id="2755197">HasSuffix</span><span class="op" id="2755206">(</span><span class="ident" id="2755207">s</span><span class="op" id="2755208">,</span>&nbsp;<span class="ident" id="2755210">suffix</span><span class="op" id="2755216">)</span>&nbsp;<span class="op" id="2755218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2755222">return</span>&nbsp;<span class="ident" id="2755229">s</span><span class="op" id="2755230">[</span><span class="op" id="2755231">:</span><span class="builtinfunc" id="2755232">len</span><span class="op" id="2755235">(</span><span class="ident" id="2755236">s</span><span class="op" id="2755237">)</span><span class="op" id="2755238">-</span><span class="builtinfunc" id="2755239">len</span><span class="op" id="2755242">(</span><span class="ident" id="2755243">suffix</span><span class="op" id="2755249">)</span><span class="op" id="2755250">]</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2755253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2755256">return</span>&nbsp;<span class="ident" id="2755263">s</span><br>
<span class="lineno"></span><span class="op" id="2755265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2755268">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;the&nbsp;first&nbsp;n</span><br>
<span class="lineno">670</span><span class="comment" id="2755327">//&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;old&nbsp;replaced&nbsp;by&nbsp;new.</span><br>
<span class="lineno"></span><span class="comment" id="2755380">//&nbsp;If&nbsp;old&nbsp;is&nbsp;empty,&nbsp;it&nbsp;matches&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2755442">//&nbsp;and&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence,&nbsp;yielding&nbsp;up&nbsp;to&nbsp;k+1&nbsp;replacements</span><br>
<span class="lineno"></span><span class="comment" id="2755508">//&nbsp;for&nbsp;a&nbsp;k-rune&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2755532">//&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno">675</span><span class="keyword" id="2755594">func</span>&nbsp;<span class="ident" id="2755599">Replace</span><span class="op" id="2755606">(</span><span class="ident" id="2755607">s</span><span class="op" id="2755608">,</span>&nbsp;<span class="ident" id="2755610">old</span><span class="op" id="2755613">,</span>&nbsp;<span class="builtinfunc" id="2755615">new</span>&nbsp;<span class="builtintype" id="2755619">string</span><span class="op" id="2755625">,</span>&nbsp;<span class="ident" id="2755627">n</span>&nbsp;<span class="builtintype" id="2755629">int</span><span class="op" id="2755632">)</span>&nbsp;<span class="builtintype" id="2755634">string</span>&nbsp;<span class="op" id="2755641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2755644">if</span>&nbsp;<span class="ident" id="2755647">old</span>&nbsp;<span class="op" id="2755651">==</span>&nbsp;<span class="builtinfunc" id="2755654">new</span>&nbsp;<span class="op" id="2755658">||</span>&nbsp;<span class="ident" id="2755661">n</span>&nbsp;<span class="op" id="2755663">==</span>&nbsp;<span class="num" id="2755666">0</span>&nbsp;<span class="op" id="2755668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2755672">return</span>&nbsp;<span class="ident" id="2755679">s</span>&nbsp;<span class="comment" id="2755681">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2755702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2755706">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2755742">if</span>&nbsp;<span class="ident" id="2755745">m</span>&nbsp;<span class="op" id="2755747">:=</span>&nbsp;<span class="ident" id="2755750">Count</span><span class="op" id="2755755">(</span><span class="ident" id="2755756">s</span><span class="op" id="2755757">,</span>&nbsp;<span class="ident" id="2755759">old</span><span class="op" id="2755762">)</span><span class="op" id="2755763">;</span>&nbsp;<span class="ident" id="2755765">m</span>&nbsp;<span class="op" id="2755767">==</span>&nbsp;<span class="num" id="2755770">0</span>&nbsp;<span class="op" id="2755772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2755776">return</span>&nbsp;<span class="ident" id="2755783">s</span>&nbsp;<span class="comment" id="2755785">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2755806">}</span>&nbsp;<span class="keyword" id="2755808">else</span>&nbsp;<span class="keyword" id="2755813">if</span>&nbsp;<span class="ident" id="2755816">n</span>&nbsp;<span class="op" id="2755818">&lt;</span>&nbsp;<span class="num" id="2755820">0</span>&nbsp;<span class="op" id="2755822">||</span>&nbsp;<span class="ident" id="2755825">m</span>&nbsp;<span class="op" id="2755827">&lt;</span>&nbsp;<span class="ident" id="2755829">n</span>&nbsp;<span class="op" id="2755831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2755835">n</span>&nbsp;<span class="op" id="2755837">=</span>&nbsp;<span class="ident" id="2755839">m</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2755842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2755846">//&nbsp;Apply&nbsp;replacements&nbsp;to&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2755880">t</span>&nbsp;<span class="op" id="2755882">:=</span>&nbsp;<span class="builtinfunc" id="2755885">make</span><span class="op" id="2755889">(</span><span class="op" id="2755890">[</span><span class="op" id="2755891">]</span><span class="builtintype" id="2755892">byte</span><span class="op" id="2755896">,</span>&nbsp;<span class="builtinfunc" id="2755898">len</span><span class="op" id="2755901">(</span><span class="ident" id="2755902">s</span><span class="op" id="2755903">)</span><span class="op" id="2755904">+</span><span class="ident" id="2755905">n</span><span class="op" id="2755906">*</span><span class="op" id="2755907">(</span><span class="builtinfunc" id="2755908">len</span><span class="op" id="2755911">(</span><span class="builtinfunc" id="2755912">new</span><span class="op" id="2755915">)</span><span class="op" id="2755916">-</span><span class="builtinfunc" id="2755917">len</span><span class="op" id="2755920">(</span><span class="ident" id="2755921">old</span><span class="op" id="2755924">)</span><span class="op" id="2755925">)</span><span class="op" id="2755926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2755929">w</span>&nbsp;<span class="op" id="2755931">:=</span>&nbsp;<span class="num" id="2755934">0</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2755937">start</span>&nbsp;<span class="op" id="2755943">:=</span>&nbsp;<span class="num" id="2755946">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2755949">for</span>&nbsp;<span class="ident" id="2755953">i</span>&nbsp;<span class="op" id="2755955">:=</span>&nbsp;<span class="num" id="2755958">0</span><span class="op" id="2755959">;</span>&nbsp;<span class="ident" id="2755961">i</span>&nbsp;<span class="op" id="2755963">&lt;</span>&nbsp;<span class="ident" id="2755965">n</span><span class="op" id="2755966">;</span>&nbsp;<span class="ident" id="2755968">i</span><span class="op" id="2755969">++</span>&nbsp;<span class="op" id="2755972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2755976">j</span>&nbsp;<span class="op" id="2755978">:=</span>&nbsp;<span class="ident" id="2755981">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2755989">if</span>&nbsp;<span class="builtinfunc" id="2755992">len</span><span class="op" id="2755995">(</span><span class="ident" id="2755996">old</span><span class="op" id="2755999">)</span>&nbsp;<span class="op" id="2756001">==</span>&nbsp;<span class="num" id="2756004">0</span>&nbsp;<span class="op" id="2756006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2756011">if</span>&nbsp;<span class="ident" id="2756014">i</span>&nbsp;<span class="op" id="2756016">&gt;</span>&nbsp;<span class="num" id="2756018">0</span>&nbsp;<span class="op" id="2756020">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756026">_</span><span class="op" id="2756027">,</span>&nbsp;<span class="ident" id="2756029">wid</span>&nbsp;<span class="op" id="2756033">:=</span>&nbsp;<span class="ident" id="2756036">utf8</span><span class="op" id="2756040">.</span><span class="ident" id="2756041">DecodeRuneInString</span><span class="op" id="2756059">(</span><span class="ident" id="2756060">s</span><span class="op" id="2756061">[</span><span class="ident" id="2756062">start</span><span class="op" id="2756067">:</span><span class="op" id="2756068">]</span><span class="op" id="2756069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756075">j</span>&nbsp;<span class="op" id="2756077">+=</span>&nbsp;<span class="ident" id="2756080">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2756087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2756091">}</span>&nbsp;<span class="keyword" id="2756093">else</span>&nbsp;<span class="op" id="2756098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756103">j</span>&nbsp;<span class="op" id="2756105">+=</span>&nbsp;<span class="ident" id="2756108">Index</span><span class="op" id="2756113">(</span><span class="ident" id="2756114">s</span><span class="op" id="2756115">[</span><span class="ident" id="2756116">start</span><span class="op" id="2756121">:</span><span class="op" id="2756122">]</span><span class="op" id="2756123">,</span>&nbsp;<span class="ident" id="2756125">old</span><span class="op" id="2756128">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2756132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756136">w</span>&nbsp;<span class="op" id="2756138">+=</span>&nbsp;<span class="builtinfunc" id="2756141">copy</span><span class="op" id="2756145">(</span><span class="ident" id="2756146">t</span><span class="op" id="2756147">[</span><span class="ident" id="2756148">w</span><span class="op" id="2756149">:</span><span class="op" id="2756150">]</span><span class="op" id="2756151">,</span>&nbsp;<span class="ident" id="2756153">s</span><span class="op" id="2756154">[</span><span class="ident" id="2756155">start</span><span class="op" id="2756160">:</span><span class="ident" id="2756161">j</span><span class="op" id="2756162">]</span><span class="op" id="2756163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756167">w</span>&nbsp;<span class="op" id="2756169">+=</span>&nbsp;<span class="builtinfunc" id="2756172">copy</span><span class="op" id="2756176">(</span><span class="ident" id="2756177">t</span><span class="op" id="2756178">[</span><span class="ident" id="2756179">w</span><span class="op" id="2756180">:</span><span class="op" id="2756181">]</span><span class="op" id="2756182">,</span>&nbsp;<span class="builtinfunc" id="2756184">new</span><span class="op" id="2756187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756191">start</span>&nbsp;<span class="op" id="2756197">=</span>&nbsp;<span class="ident" id="2756199">j</span>&nbsp;<span class="op" id="2756201">+</span>&nbsp;<span class="builtinfunc" id="2756203">len</span><span class="op" id="2756206">(</span><span class="ident" id="2756207">old</span><span class="op" id="2756210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2756213">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756216">w</span>&nbsp;<span class="op" id="2756218">+=</span>&nbsp;<span class="builtinfunc" id="2756221">copy</span><span class="op" id="2756225">(</span><span class="ident" id="2756226">t</span><span class="op" id="2756227">[</span><span class="ident" id="2756228">w</span><span class="op" id="2756229">:</span><span class="op" id="2756230">]</span><span class="op" id="2756231">,</span>&nbsp;<span class="ident" id="2756233">s</span><span class="op" id="2756234">[</span><span class="ident" id="2756235">start</span><span class="op" id="2756240">:</span><span class="op" id="2756241">]</span><span class="op" id="2756242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2756245">return</span>&nbsp;<span class="builtintype" id="2756252">string</span><span class="op" id="2756258">(</span><span class="ident" id="2756259">t</span><span class="op" id="2756260">[</span><span class="num" id="2756261">0</span><span class="op" id="2756262">:</span><span class="ident" id="2756263">w</span><span class="op" id="2756264">]</span><span class="op" id="2756265">)</span><br>
<span class="lineno"></span><span class="op" id="2756267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2756270">//&nbsp;EqualFold&nbsp;reports&nbsp;whether&nbsp;s&nbsp;and&nbsp;t,&nbsp;interpreted&nbsp;as&nbsp;UTF-8&nbsp;strings,</span><br>
<span class="lineno">710</span><span class="comment" id="2756338">//&nbsp;are&nbsp;equal&nbsp;under&nbsp;Unicode&nbsp;case-folding.</span><br>
<span class="lineno"></span><span class="keyword" id="2756379">func</span>&nbsp;<span class="ident" id="2756384">EqualFold</span><span class="op" id="2756393">(</span><span class="ident" id="2756394">s</span><span class="op" id="2756395">,</span>&nbsp;<span class="ident" id="2756397">t</span>&nbsp;<span class="builtintype" id="2756399">string</span><span class="op" id="2756405">)</span>&nbsp;<span class="builtintype" id="2756407">bool</span>&nbsp;<span class="op" id="2756412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2756415">for</span>&nbsp;<span class="ident" id="2756419">s</span>&nbsp;<span class="op" id="2756421">!=</span>&nbsp;<span class="string" id="2756424">&#34;&#34;</span>&nbsp;<span class="op" id="2756427">&amp;&amp;</span>&nbsp;<span class="ident" id="2756430">t</span>&nbsp;<span class="op" id="2756432">!=</span>&nbsp;<span class="string" id="2756435">&#34;&#34;</span>&nbsp;<span class="op" id="2756438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2756442">//&nbsp;Extract&nbsp;first&nbsp;rune&nbsp;from&nbsp;each&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2756484">var</span>&nbsp;<span class="ident" id="2756488">sr</span><span class="op" id="2756490">,</span>&nbsp;<span class="ident" id="2756492">tr</span>&nbsp;<span class="builtintype" id="2756495">rune</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2756502">if</span>&nbsp;<span class="ident" id="2756505">s</span><span class="op" id="2756506">[</span><span class="num" id="2756507">0</span><span class="op" id="2756508">]</span>&nbsp;<span class="op" id="2756510">&lt;</span>&nbsp;<span class="ident" id="2756512">utf8</span><span class="op" id="2756516">.</span><span class="ident" id="2756517">RuneSelf</span>&nbsp;<span class="op" id="2756526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756531">sr</span><span class="op" id="2756533">,</span>&nbsp;<span class="ident" id="2756535">s</span>&nbsp;<span class="op" id="2756537">=</span>&nbsp;<span class="builtintype" id="2756539">rune</span><span class="op" id="2756543">(</span><span class="ident" id="2756544">s</span><span class="op" id="2756545">[</span><span class="num" id="2756546">0</span><span class="op" id="2756547">]</span><span class="op" id="2756548">)</span><span class="op" id="2756549">,</span>&nbsp;<span class="ident" id="2756551">s</span><span class="op" id="2756552">[</span><span class="num" id="2756553">1</span><span class="op" id="2756554">:</span><span class="op" id="2756555">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2756559">}</span>&nbsp;<span class="keyword" id="2756561">else</span>&nbsp;<span class="op" id="2756566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756571">r</span><span class="op" id="2756572">,</span>&nbsp;<span class="ident" id="2756574">size</span>&nbsp;<span class="op" id="2756579">:=</span>&nbsp;<span class="ident" id="2756582">utf8</span><span class="op" id="2756586">.</span><span class="ident" id="2756587">DecodeRuneInString</span><span class="op" id="2756605">(</span><span class="ident" id="2756606">s</span><span class="op" id="2756607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756612">sr</span><span class="op" id="2756614">,</span>&nbsp;<span class="ident" id="2756616">s</span>&nbsp;<span class="op" id="2756618">=</span>&nbsp;<span class="ident" id="2756620">r</span><span class="op" id="2756621">,</span>&nbsp;<span class="ident" id="2756623">s</span><span class="op" id="2756624">[</span><span class="ident" id="2756625">size</span><span class="op" id="2756629">:</span><span class="op" id="2756630">]</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2756634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2756638">if</span>&nbsp;<span class="ident" id="2756641">t</span><span class="op" id="2756642">[</span><span class="num" id="2756643">0</span><span class="op" id="2756644">]</span>&nbsp;<span class="op" id="2756646">&lt;</span>&nbsp;<span class="ident" id="2756648">utf8</span><span class="op" id="2756652">.</span><span class="ident" id="2756653">RuneSelf</span>&nbsp;<span class="op" id="2756662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756667">tr</span><span class="op" id="2756669">,</span>&nbsp;<span class="ident" id="2756671">t</span>&nbsp;<span class="op" id="2756673">=</span>&nbsp;<span class="builtintype" id="2756675">rune</span><span class="op" id="2756679">(</span><span class="ident" id="2756680">t</span><span class="op" id="2756681">[</span><span class="num" id="2756682">0</span><span class="op" id="2756683">]</span><span class="op" id="2756684">)</span><span class="op" id="2756685">,</span>&nbsp;<span class="ident" id="2756687">t</span><span class="op" id="2756688">[</span><span class="num" id="2756689">1</span><span class="op" id="2756690">:</span><span class="op" id="2756691">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2756695">}</span>&nbsp;<span class="keyword" id="2756697">else</span>&nbsp;<span class="op" id="2756702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756707">r</span><span class="op" id="2756708">,</span>&nbsp;<span class="ident" id="2756710">size</span>&nbsp;<span class="op" id="2756715">:=</span>&nbsp;<span class="ident" id="2756718">utf8</span><span class="op" id="2756722">.</span><span class="ident" id="2756723">DecodeRuneInString</span><span class="op" id="2756741">(</span><span class="ident" id="2756742">t</span><span class="op" id="2756743">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756748">tr</span><span class="op" id="2756750">,</span>&nbsp;<span class="ident" id="2756752">t</span>&nbsp;<span class="op" id="2756754">=</span>&nbsp;<span class="ident" id="2756756">r</span><span class="op" id="2756757">,</span>&nbsp;<span class="ident" id="2756759">t</span><span class="op" id="2756760">[</span><span class="ident" id="2756761">size</span><span class="op" id="2756765">:</span><span class="op" id="2756766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2756770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2756775">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;keep&nbsp;going;&nbsp;if&nbsp;not,&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2756830">//&nbsp;Easy&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2756846">if</span>&nbsp;<span class="ident" id="2756849">tr</span>&nbsp;<span class="op" id="2756852">==</span>&nbsp;<span class="ident" id="2756855">sr</span>&nbsp;<span class="op" id="2756858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2756863">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2756874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2756879">//&nbsp;Make&nbsp;sr&nbsp;&lt;&nbsp;tr&nbsp;to&nbsp;simplify&nbsp;what&nbsp;follows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2756923">if</span>&nbsp;<span class="ident" id="2756926">tr</span>&nbsp;<span class="op" id="2756929">&lt;</span>&nbsp;<span class="ident" id="2756931">sr</span>&nbsp;<span class="op" id="2756934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2756939">tr</span><span class="op" id="2756941">,</span>&nbsp;<span class="ident" id="2756943">sr</span>&nbsp;<span class="op" id="2756946">=</span>&nbsp;<span class="ident" id="2756948">sr</span><span class="op" id="2756950">,</span>&nbsp;<span class="ident" id="2756952">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2756957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2756961">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;ASCII.</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2756988">if</span>&nbsp;<span class="ident" id="2756991">tr</span>&nbsp;<span class="op" id="2756994">&lt;</span>&nbsp;<span class="ident" id="2756996">utf8</span><span class="op" id="2757000">.</span><span class="ident" id="2757001">RuneSelf</span>&nbsp;<span class="op" id="2757010">&amp;&amp;</span>&nbsp;<span class="string" id="2757013">&#39;A&#39;</span>&nbsp;<span class="op" id="2757017">&lt;=</span>&nbsp;<span class="ident" id="2757020">sr</span>&nbsp;<span class="op" id="2757023">&amp;&amp;</span>&nbsp;<span class="ident" id="2757026">sr</span>&nbsp;<span class="op" id="2757029">&lt;=</span>&nbsp;<span class="string" id="2757032">&#39;Z&#39;</span>&nbsp;<span class="op" id="2757036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2757041">//&nbsp;ASCII,&nbsp;and&nbsp;sr&nbsp;is&nbsp;upper&nbsp;case.&nbsp;&nbsp;tr&nbsp;must&nbsp;be&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2757100">if</span>&nbsp;<span class="ident" id="2757103">tr</span>&nbsp;<span class="op" id="2757106">==</span>&nbsp;<span class="ident" id="2757109">sr</span><span class="op" id="2757111">+</span><span class="string" id="2757112">&#39;a&#39;</span><span class="op" id="2757115">-</span><span class="string" id="2757116">&#39;A&#39;</span>&nbsp;<span class="op" id="2757120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2757126">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2757138">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2757143">return</span>&nbsp;<span class="ident" id="2757150">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2757158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2757163">//&nbsp;General&nbsp;case.&nbsp;&nbsp;SimpleFold(x)&nbsp;returns&nbsp;the&nbsp;next&nbsp;equivalent&nbsp;rune&nbsp;&gt;&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2757234">//&nbsp;or&nbsp;wraps&nbsp;around&nbsp;to&nbsp;smaller&nbsp;values.</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2757274">r</span>&nbsp;<span class="op" id="2757276">:=</span>&nbsp;<span class="ident" id="2757279">unicode</span><span class="op" id="2757286">.</span><span class="ident" id="2757287">SimpleFold</span><span class="op" id="2757297">(</span><span class="ident" id="2757298">sr</span><span class="op" id="2757300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2757304">for</span>&nbsp;<span class="ident" id="2757308">r</span>&nbsp;<span class="op" id="2757310">!=</span>&nbsp;<span class="ident" id="2757313">sr</span>&nbsp;<span class="op" id="2757316">&amp;&amp;</span>&nbsp;<span class="ident" id="2757319">r</span>&nbsp;<span class="op" id="2757321">&lt;</span>&nbsp;<span class="ident" id="2757323">tr</span>&nbsp;<span class="op" id="2757326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2757331">r</span>&nbsp;<span class="op" id="2757333">=</span>&nbsp;<span class="ident" id="2757335">unicode</span><span class="op" id="2757342">.</span><span class="ident" id="2757343">SimpleFold</span><span class="op" id="2757353">(</span><span class="ident" id="2757354">r</span><span class="op" id="2757355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2757359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2757363">if</span>&nbsp;<span class="ident" id="2757366">r</span>&nbsp;<span class="op" id="2757368">==</span>&nbsp;<span class="ident" id="2757371">tr</span>&nbsp;<span class="op" id="2757374">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2757379">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2757390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2757394">return</span>&nbsp;<span class="ident" id="2757401">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2757408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2757412">//&nbsp;One&nbsp;string&nbsp;is&nbsp;empty.&nbsp;&nbsp;Are&nbsp;both?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2757448">return</span>&nbsp;<span class="ident" id="2757455">s</span>&nbsp;<span class="op" id="2757457">==</span>&nbsp;<span class="ident" id="2757460">t</span><br>
<span class="lineno"></span><span class="op" id="2757462">}</span>
</div>
</body>
</html>
