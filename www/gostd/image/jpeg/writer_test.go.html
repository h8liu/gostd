<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6879476">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6879531">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6879585">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6879636">package</span>&nbsp;<span class="ident" id="6879644">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6879650">import</span>&nbsp;<span class="op" id="6879657">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6879660">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6879669">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6879676">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6879685">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6879700">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6879713">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6879726">&#34;math/rand&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6879739">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6879745">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6879755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6879758">//&nbsp;zigzag&nbsp;maps&nbsp;from&nbsp;the&nbsp;natural&nbsp;ordering&nbsp;to&nbsp;the&nbsp;zig-zag&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno">20</span><span class="comment" id="6879837">//&nbsp;zigzag[0*8&nbsp;+&nbsp;3]&nbsp;is&nbsp;the&nbsp;zig-zag&nbsp;sequence&nbsp;number&nbsp;of&nbsp;the&nbsp;element&nbsp;in&nbsp;the&nbsp;fourth</span><br>
<span class="lineno"></span><span class="comment" id="6879916">//&nbsp;column&nbsp;and&nbsp;first&nbsp;row.</span><br>
<span class="lineno"></span><span class="keyword" id="6879941">var</span>&nbsp;<span class="ident" id="6879945">zigzag</span>&nbsp;<span class="op" id="6879952">=</span>&nbsp;<span class="op" id="6879954">[</span><span class="ident" id="6879955">blockSize</span><span class="op" id="6879964">]</span><span class="builtintype" id="6879965">int</span><span class="op" id="6879968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6879971">0</span><span class="op" id="6879972">,</span>&nbsp;<span class="num" id="6879974">1</span><span class="op" id="6879975">,</span>&nbsp;<span class="num" id="6879977">5</span><span class="op" id="6879978">,</span>&nbsp;<span class="num" id="6879980">6</span><span class="op" id="6879981">,</span>&nbsp;<span class="num" id="6879983">14</span><span class="op" id="6879985">,</span>&nbsp;<span class="num" id="6879987">15</span><span class="op" id="6879989">,</span>&nbsp;<span class="num" id="6879991">27</span><span class="op" id="6879993">,</span>&nbsp;<span class="num" id="6879995">28</span><span class="op" id="6879997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880000">2</span><span class="op" id="6880001">,</span>&nbsp;<span class="num" id="6880003">4</span><span class="op" id="6880004">,</span>&nbsp;<span class="num" id="6880006">7</span><span class="op" id="6880007">,</span>&nbsp;<span class="num" id="6880009">13</span><span class="op" id="6880011">,</span>&nbsp;<span class="num" id="6880013">16</span><span class="op" id="6880015">,</span>&nbsp;<span class="num" id="6880017">26</span><span class="op" id="6880019">,</span>&nbsp;<span class="num" id="6880021">29</span><span class="op" id="6880023">,</span>&nbsp;<span class="num" id="6880025">42</span><span class="op" id="6880027">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880030">3</span><span class="op" id="6880031">,</span>&nbsp;<span class="num" id="6880033">8</span><span class="op" id="6880034">,</span>&nbsp;<span class="num" id="6880036">12</span><span class="op" id="6880038">,</span>&nbsp;<span class="num" id="6880040">17</span><span class="op" id="6880042">,</span>&nbsp;<span class="num" id="6880044">25</span><span class="op" id="6880046">,</span>&nbsp;<span class="num" id="6880048">30</span><span class="op" id="6880050">,</span>&nbsp;<span class="num" id="6880052">41</span><span class="op" id="6880054">,</span>&nbsp;<span class="num" id="6880056">43</span><span class="op" id="6880058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880061">9</span><span class="op" id="6880062">,</span>&nbsp;<span class="num" id="6880064">11</span><span class="op" id="6880066">,</span>&nbsp;<span class="num" id="6880068">18</span><span class="op" id="6880070">,</span>&nbsp;<span class="num" id="6880072">24</span><span class="op" id="6880074">,</span>&nbsp;<span class="num" id="6880076">31</span><span class="op" id="6880078">,</span>&nbsp;<span class="num" id="6880080">40</span><span class="op" id="6880082">,</span>&nbsp;<span class="num" id="6880084">44</span><span class="op" id="6880086">,</span>&nbsp;<span class="num" id="6880088">53</span><span class="op" id="6880090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880093">10</span><span class="op" id="6880095">,</span>&nbsp;<span class="num" id="6880097">19</span><span class="op" id="6880099">,</span>&nbsp;<span class="num" id="6880101">23</span><span class="op" id="6880103">,</span>&nbsp;<span class="num" id="6880105">32</span><span class="op" id="6880107">,</span>&nbsp;<span class="num" id="6880109">39</span><span class="op" id="6880111">,</span>&nbsp;<span class="num" id="6880113">45</span><span class="op" id="6880115">,</span>&nbsp;<span class="num" id="6880117">52</span><span class="op" id="6880119">,</span>&nbsp;<span class="num" id="6880121">54</span><span class="op" id="6880123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880126">20</span><span class="op" id="6880128">,</span>&nbsp;<span class="num" id="6880130">22</span><span class="op" id="6880132">,</span>&nbsp;<span class="num" id="6880134">33</span><span class="op" id="6880136">,</span>&nbsp;<span class="num" id="6880138">38</span><span class="op" id="6880140">,</span>&nbsp;<span class="num" id="6880142">46</span><span class="op" id="6880144">,</span>&nbsp;<span class="num" id="6880146">51</span><span class="op" id="6880148">,</span>&nbsp;<span class="num" id="6880150">55</span><span class="op" id="6880152">,</span>&nbsp;<span class="num" id="6880154">60</span><span class="op" id="6880156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880159">21</span><span class="op" id="6880161">,</span>&nbsp;<span class="num" id="6880163">34</span><span class="op" id="6880165">,</span>&nbsp;<span class="num" id="6880167">37</span><span class="op" id="6880169">,</span>&nbsp;<span class="num" id="6880171">47</span><span class="op" id="6880173">,</span>&nbsp;<span class="num" id="6880175">50</span><span class="op" id="6880177">,</span>&nbsp;<span class="num" id="6880179">56</span><span class="op" id="6880181">,</span>&nbsp;<span class="num" id="6880183">59</span><span class="op" id="6880185">,</span>&nbsp;<span class="num" id="6880187">61</span><span class="op" id="6880189">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880192">35</span><span class="op" id="6880194">,</span>&nbsp;<span class="num" id="6880196">36</span><span class="op" id="6880198">,</span>&nbsp;<span class="num" id="6880200">48</span><span class="op" id="6880202">,</span>&nbsp;<span class="num" id="6880204">49</span><span class="op" id="6880206">,</span>&nbsp;<span class="num" id="6880208">57</span><span class="op" id="6880210">,</span>&nbsp;<span class="num" id="6880212">58</span><span class="op" id="6880214">,</span>&nbsp;<span class="num" id="6880216">62</span><span class="op" id="6880218">,</span>&nbsp;<span class="num" id="6880220">63</span><span class="op" id="6880222">,</span><br>
<span class="lineno"></span><span class="op" id="6880224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6880227">func</span>&nbsp;<span class="ident" id="6880232">TestZigUnzig</span><span class="op" id="6880244">(</span><span class="ident" id="6880245">t</span>&nbsp;<span class="op" id="6880247">*</span><span class="ident" id="6880248">testing</span><span class="op" id="6880255">.</span><span class="ident" id="6880256">T</span><span class="op" id="6880257">)</span>&nbsp;<span class="op" id="6880259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6880262">for</span>&nbsp;<span class="ident" id="6880266">i</span>&nbsp;<span class="op" id="6880268">:=</span>&nbsp;<span class="num" id="6880271">0</span><span class="op" id="6880272">;</span>&nbsp;<span class="ident" id="6880274">i</span>&nbsp;<span class="op" id="6880276">&lt;</span>&nbsp;<span class="ident" id="6880278">blockSize</span><span class="op" id="6880287">;</span>&nbsp;<span class="ident" id="6880289">i</span><span class="op" id="6880290">++</span>&nbsp;<span class="op" id="6880293">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6880297">if</span>&nbsp;<span class="ident" id="6880300">unzig</span><span class="op" id="6880305">[</span><span class="ident" id="6880306">zigzag</span><span class="op" id="6880312">[</span><span class="ident" id="6880313">i</span><span class="op" id="6880314">]</span><span class="op" id="6880315">]</span>&nbsp;<span class="op" id="6880317">!=</span>&nbsp;<span class="ident" id="6880320">i</span>&nbsp;<span class="op" id="6880322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6880327">t</span><span class="op" id="6880328">.</span><span class="ident" id="6880329">Errorf</span><span class="op" id="6880335">(</span><span class="string" id="6880336">&#34;unzig[zigzag[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="6880361">,</span>&nbsp;<span class="ident" id="6880363">i</span><span class="op" id="6880364">,</span>&nbsp;<span class="ident" id="6880366">unzig</span><span class="op" id="6880371">[</span><span class="ident" id="6880372">zigzag</span><span class="op" id="6880378">[</span><span class="ident" id="6880379">i</span><span class="op" id="6880380">]</span><span class="op" id="6880381">]</span><span class="op" id="6880382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6880386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6880390">if</span>&nbsp;<span class="ident" id="6880393">zigzag</span><span class="op" id="6880399">[</span><span class="ident" id="6880400">unzig</span><span class="op" id="6880405">[</span><span class="ident" id="6880406">i</span><span class="op" id="6880407">]</span><span class="op" id="6880408">]</span>&nbsp;<span class="op" id="6880410">!=</span>&nbsp;<span class="ident" id="6880413">i</span>&nbsp;<span class="op" id="6880415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6880420">t</span><span class="op" id="6880421">.</span><span class="ident" id="6880422">Errorf</span><span class="op" id="6880428">(</span><span class="string" id="6880429">&#34;zigzag[unzig[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="6880454">,</span>&nbsp;<span class="ident" id="6880456">i</span><span class="op" id="6880457">,</span>&nbsp;<span class="ident" id="6880459">zigzag</span><span class="op" id="6880465">[</span><span class="ident" id="6880466">unzig</span><span class="op" id="6880471">[</span><span class="ident" id="6880472">i</span><span class="op" id="6880473">]</span><span class="op" id="6880474">]</span><span class="op" id="6880475">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6880479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6880482">}</span><br>
<span class="lineno"></span><span class="op" id="6880484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6880487">//&nbsp;unscaledQuantInNaturalOrder&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in</span><br>
<span class="lineno">45</span><span class="comment" id="6880558">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;K.1.</span><br>
<span class="lineno"></span><span class="keyword" id="6880619">var</span>&nbsp;<span class="ident" id="6880623">unscaledQuantInNaturalOrder</span>&nbsp;<span class="op" id="6880651">=</span>&nbsp;<span class="op" id="6880653">[</span><span class="ident" id="6880654">nQuantIndex</span><span class="op" id="6880665">]</span><span class="op" id="6880666">[</span><span class="ident" id="6880667">blockSize</span><span class="op" id="6880676">]</span><span class="builtintype" id="6880677">byte</span><span class="op" id="6880681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6880684">//&nbsp;Luminance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6880699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880703">16</span><span class="op" id="6880705">,</span>&nbsp;<span class="num" id="6880707">11</span><span class="op" id="6880709">,</span>&nbsp;<span class="num" id="6880711">10</span><span class="op" id="6880713">,</span>&nbsp;<span class="num" id="6880715">16</span><span class="op" id="6880717">,</span>&nbsp;<span class="num" id="6880719">24</span><span class="op" id="6880721">,</span>&nbsp;<span class="num" id="6880723">40</span><span class="op" id="6880725">,</span>&nbsp;<span class="num" id="6880727">51</span><span class="op" id="6880729">,</span>&nbsp;<span class="num" id="6880731">61</span><span class="op" id="6880733">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880737">12</span><span class="op" id="6880739">,</span>&nbsp;<span class="num" id="6880741">12</span><span class="op" id="6880743">,</span>&nbsp;<span class="num" id="6880745">14</span><span class="op" id="6880747">,</span>&nbsp;<span class="num" id="6880749">19</span><span class="op" id="6880751">,</span>&nbsp;<span class="num" id="6880753">26</span><span class="op" id="6880755">,</span>&nbsp;<span class="num" id="6880757">58</span><span class="op" id="6880759">,</span>&nbsp;<span class="num" id="6880761">60</span><span class="op" id="6880763">,</span>&nbsp;<span class="num" id="6880765">55</span><span class="op" id="6880767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880771">14</span><span class="op" id="6880773">,</span>&nbsp;<span class="num" id="6880775">13</span><span class="op" id="6880777">,</span>&nbsp;<span class="num" id="6880779">16</span><span class="op" id="6880781">,</span>&nbsp;<span class="num" id="6880783">24</span><span class="op" id="6880785">,</span>&nbsp;<span class="num" id="6880787">40</span><span class="op" id="6880789">,</span>&nbsp;<span class="num" id="6880791">57</span><span class="op" id="6880793">,</span>&nbsp;<span class="num" id="6880795">69</span><span class="op" id="6880797">,</span>&nbsp;<span class="num" id="6880799">56</span><span class="op" id="6880801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880805">14</span><span class="op" id="6880807">,</span>&nbsp;<span class="num" id="6880809">17</span><span class="op" id="6880811">,</span>&nbsp;<span class="num" id="6880813">22</span><span class="op" id="6880815">,</span>&nbsp;<span class="num" id="6880817">29</span><span class="op" id="6880819">,</span>&nbsp;<span class="num" id="6880821">51</span><span class="op" id="6880823">,</span>&nbsp;<span class="num" id="6880825">87</span><span class="op" id="6880827">,</span>&nbsp;<span class="num" id="6880829">80</span><span class="op" id="6880831">,</span>&nbsp;<span class="num" id="6880833">62</span><span class="op" id="6880835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880839">18</span><span class="op" id="6880841">,</span>&nbsp;<span class="num" id="6880843">22</span><span class="op" id="6880845">,</span>&nbsp;<span class="num" id="6880847">37</span><span class="op" id="6880849">,</span>&nbsp;<span class="num" id="6880851">56</span><span class="op" id="6880853">,</span>&nbsp;<span class="num" id="6880855">68</span><span class="op" id="6880857">,</span>&nbsp;<span class="num" id="6880859">109</span><span class="op" id="6880862">,</span>&nbsp;<span class="num" id="6880864">103</span><span class="op" id="6880867">,</span>&nbsp;<span class="num" id="6880869">77</span><span class="op" id="6880871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880875">24</span><span class="op" id="6880877">,</span>&nbsp;<span class="num" id="6880879">35</span><span class="op" id="6880881">,</span>&nbsp;<span class="num" id="6880883">55</span><span class="op" id="6880885">,</span>&nbsp;<span class="num" id="6880887">64</span><span class="op" id="6880889">,</span>&nbsp;<span class="num" id="6880891">81</span><span class="op" id="6880893">,</span>&nbsp;<span class="num" id="6880895">104</span><span class="op" id="6880898">,</span>&nbsp;<span class="num" id="6880900">113</span><span class="op" id="6880903">,</span>&nbsp;<span class="num" id="6880905">92</span><span class="op" id="6880907">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880911">49</span><span class="op" id="6880913">,</span>&nbsp;<span class="num" id="6880915">64</span><span class="op" id="6880917">,</span>&nbsp;<span class="num" id="6880919">78</span><span class="op" id="6880921">,</span>&nbsp;<span class="num" id="6880923">87</span><span class="op" id="6880925">,</span>&nbsp;<span class="num" id="6880927">103</span><span class="op" id="6880930">,</span>&nbsp;<span class="num" id="6880932">121</span><span class="op" id="6880935">,</span>&nbsp;<span class="num" id="6880937">120</span><span class="op" id="6880940">,</span>&nbsp;<span class="num" id="6880942">101</span><span class="op" id="6880945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6880949">72</span><span class="op" id="6880951">,</span>&nbsp;<span class="num" id="6880953">92</span><span class="op" id="6880955">,</span>&nbsp;<span class="num" id="6880957">95</span><span class="op" id="6880959">,</span>&nbsp;<span class="num" id="6880961">98</span><span class="op" id="6880963">,</span>&nbsp;<span class="num" id="6880965">112</span><span class="op" id="6880968">,</span>&nbsp;<span class="num" id="6880970">100</span><span class="op" id="6880973">,</span>&nbsp;<span class="num" id="6880975">103</span><span class="op" id="6880978">,</span>&nbsp;<span class="num" id="6880980">99</span><span class="op" id="6880982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6880985">}</span><span class="op" id="6880986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6880989">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6881006">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6881010">17</span><span class="op" id="6881012">,</span>&nbsp;<span class="num" id="6881014">18</span><span class="op" id="6881016">,</span>&nbsp;<span class="num" id="6881018">24</span><span class="op" id="6881020">,</span>&nbsp;<span class="num" id="6881022">47</span><span class="op" id="6881024">,</span>&nbsp;<span class="num" id="6881026">99</span><span class="op" id="6881028">,</span>&nbsp;<span class="num" id="6881030">99</span><span class="op" id="6881032">,</span>&nbsp;<span class="num" id="6881034">99</span><span class="op" id="6881036">,</span>&nbsp;<span class="num" id="6881038">99</span><span class="op" id="6881040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6881044">18</span><span class="op" id="6881046">,</span>&nbsp;<span class="num" id="6881048">21</span><span class="op" id="6881050">,</span>&nbsp;<span class="num" id="6881052">26</span><span class="op" id="6881054">,</span>&nbsp;<span class="num" id="6881056">66</span><span class="op" id="6881058">,</span>&nbsp;<span class="num" id="6881060">99</span><span class="op" id="6881062">,</span>&nbsp;<span class="num" id="6881064">99</span><span class="op" id="6881066">,</span>&nbsp;<span class="num" id="6881068">99</span><span class="op" id="6881070">,</span>&nbsp;<span class="num" id="6881072">99</span><span class="op" id="6881074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6881078">24</span><span class="op" id="6881080">,</span>&nbsp;<span class="num" id="6881082">26</span><span class="op" id="6881084">,</span>&nbsp;<span class="num" id="6881086">56</span><span class="op" id="6881088">,</span>&nbsp;<span class="num" id="6881090">99</span><span class="op" id="6881092">,</span>&nbsp;<span class="num" id="6881094">99</span><span class="op" id="6881096">,</span>&nbsp;<span class="num" id="6881098">99</span><span class="op" id="6881100">,</span>&nbsp;<span class="num" id="6881102">99</span><span class="op" id="6881104">,</span>&nbsp;<span class="num" id="6881106">99</span><span class="op" id="6881108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6881112">47</span><span class="op" id="6881114">,</span>&nbsp;<span class="num" id="6881116">66</span><span class="op" id="6881118">,</span>&nbsp;<span class="num" id="6881120">99</span><span class="op" id="6881122">,</span>&nbsp;<span class="num" id="6881124">99</span><span class="op" id="6881126">,</span>&nbsp;<span class="num" id="6881128">99</span><span class="op" id="6881130">,</span>&nbsp;<span class="num" id="6881132">99</span><span class="op" id="6881134">,</span>&nbsp;<span class="num" id="6881136">99</span><span class="op" id="6881138">,</span>&nbsp;<span class="num" id="6881140">99</span><span class="op" id="6881142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6881146">99</span><span class="op" id="6881148">,</span>&nbsp;<span class="num" id="6881150">99</span><span class="op" id="6881152">,</span>&nbsp;<span class="num" id="6881154">99</span><span class="op" id="6881156">,</span>&nbsp;<span class="num" id="6881158">99</span><span class="op" id="6881160">,</span>&nbsp;<span class="num" id="6881162">99</span><span class="op" id="6881164">,</span>&nbsp;<span class="num" id="6881166">99</span><span class="op" id="6881168">,</span>&nbsp;<span class="num" id="6881170">99</span><span class="op" id="6881172">,</span>&nbsp;<span class="num" id="6881174">99</span><span class="op" id="6881176">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6881180">99</span><span class="op" id="6881182">,</span>&nbsp;<span class="num" id="6881184">99</span><span class="op" id="6881186">,</span>&nbsp;<span class="num" id="6881188">99</span><span class="op" id="6881190">,</span>&nbsp;<span class="num" id="6881192">99</span><span class="op" id="6881194">,</span>&nbsp;<span class="num" id="6881196">99</span><span class="op" id="6881198">,</span>&nbsp;<span class="num" id="6881200">99</span><span class="op" id="6881202">,</span>&nbsp;<span class="num" id="6881204">99</span><span class="op" id="6881206">,</span>&nbsp;<span class="num" id="6881208">99</span><span class="op" id="6881210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6881214">99</span><span class="op" id="6881216">,</span>&nbsp;<span class="num" id="6881218">99</span><span class="op" id="6881220">,</span>&nbsp;<span class="num" id="6881222">99</span><span class="op" id="6881224">,</span>&nbsp;<span class="num" id="6881226">99</span><span class="op" id="6881228">,</span>&nbsp;<span class="num" id="6881230">99</span><span class="op" id="6881232">,</span>&nbsp;<span class="num" id="6881234">99</span><span class="op" id="6881236">,</span>&nbsp;<span class="num" id="6881238">99</span><span class="op" id="6881240">,</span>&nbsp;<span class="num" id="6881242">99</span><span class="op" id="6881244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6881248">99</span><span class="op" id="6881250">,</span>&nbsp;<span class="num" id="6881252">99</span><span class="op" id="6881254">,</span>&nbsp;<span class="num" id="6881256">99</span><span class="op" id="6881258">,</span>&nbsp;<span class="num" id="6881260">99</span><span class="op" id="6881262">,</span>&nbsp;<span class="num" id="6881264">99</span><span class="op" id="6881266">,</span>&nbsp;<span class="num" id="6881268">99</span><span class="op" id="6881270">,</span>&nbsp;<span class="num" id="6881272">99</span><span class="op" id="6881274">,</span>&nbsp;<span class="num" id="6881276">99</span><span class="op" id="6881278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6881281">}</span><span class="op" id="6881282">,</span><br>
<span class="lineno"></span><span class="op" id="6881284">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="6881287">func</span>&nbsp;<span class="ident" id="6881292">TestUnscaledQuant</span><span class="op" id="6881309">(</span><span class="ident" id="6881310">t</span>&nbsp;<span class="op" id="6881312">*</span><span class="ident" id="6881313">testing</span><span class="op" id="6881320">.</span><span class="ident" id="6881321">T</span><span class="op" id="6881322">)</span>&nbsp;<span class="op" id="6881324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6881327">bad</span>&nbsp;<span class="op" id="6881331">:=</span>&nbsp;<span class="builtintype" id="6881334">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6881341">for</span>&nbsp;<span class="ident" id="6881345">i</span>&nbsp;<span class="op" id="6881347">:=</span>&nbsp;<span class="ident" id="6881350">quantIndex</span><span class="op" id="6881360">(</span><span class="num" id="6881361">0</span><span class="op" id="6881362">)</span><span class="op" id="6881363">;</span>&nbsp;<span class="ident" id="6881365">i</span>&nbsp;<span class="op" id="6881367">&lt;</span>&nbsp;<span class="ident" id="6881369">nQuantIndex</span><span class="op" id="6881380">;</span>&nbsp;<span class="ident" id="6881382">i</span><span class="op" id="6881383">++</span>&nbsp;<span class="op" id="6881386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6881390">for</span>&nbsp;<span class="ident" id="6881394">zig</span>&nbsp;<span class="op" id="6881398">:=</span>&nbsp;<span class="num" id="6881401">0</span><span class="op" id="6881402">;</span>&nbsp;<span class="ident" id="6881404">zig</span>&nbsp;<span class="op" id="6881408">&lt;</span>&nbsp;<span class="ident" id="6881410">blockSize</span><span class="op" id="6881419">;</span>&nbsp;<span class="ident" id="6881421">zig</span><span class="op" id="6881424">++</span>&nbsp;<span class="op" id="6881427">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6881432">got</span>&nbsp;<span class="op" id="6881436">:=</span>&nbsp;<span class="ident" id="6881439">unscaledQuant</span><span class="op" id="6881452">[</span><span class="ident" id="6881453">i</span><span class="op" id="6881454">]</span><span class="op" id="6881455">[</span><span class="ident" id="6881456">zig</span><span class="op" id="6881459">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6881464">want</span>&nbsp;<span class="op" id="6881469">:=</span>&nbsp;<span class="ident" id="6881472">unscaledQuantInNaturalOrder</span><span class="op" id="6881499">[</span><span class="ident" id="6881500">i</span><span class="op" id="6881501">]</span><span class="op" id="6881502">[</span><span class="ident" id="6881503">unzig</span><span class="op" id="6881508">[</span><span class="ident" id="6881509">zig</span><span class="op" id="6881512">]</span><span class="op" id="6881513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6881518">if</span>&nbsp;<span class="ident" id="6881521">got</span>&nbsp;<span class="op" id="6881525">!=</span>&nbsp;<span class="ident" id="6881528">want</span>&nbsp;<span class="op" id="6881533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6881539">t</span><span class="op" id="6881540">.</span><span class="ident" id="6881541">Errorf</span><span class="op" id="6881547">(</span><span class="string" id="6881548">&#34;i=%d,&nbsp;zig=%d:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6881579">,</span>&nbsp;<span class="ident" id="6881581">i</span><span class="op" id="6881582">,</span>&nbsp;<span class="ident" id="6881584">zig</span><span class="op" id="6881587">,</span>&nbsp;<span class="ident" id="6881589">got</span><span class="op" id="6881592">,</span>&nbsp;<span class="ident" id="6881594">want</span><span class="op" id="6881598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6881604">bad</span>&nbsp;<span class="op" id="6881608">=</span>&nbsp;<span class="builtintype" id="6881610">true</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6881618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6881622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6881625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6881628">if</span>&nbsp;<span class="ident" id="6881631">bad</span>&nbsp;<span class="op" id="6881635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6881639">names</span>&nbsp;<span class="op" id="6881645">:=</span>&nbsp;<span class="op" id="6881648">[</span><span class="ident" id="6881649">nQuantIndex</span><span class="op" id="6881660">]</span><span class="builtintype" id="6881661">string</span><span class="op" id="6881667">{</span><span class="string" id="6881668">&#34;Luminance&#34;</span><span class="op" id="6881679">,</span>&nbsp;<span class="string" id="6881681">&#34;Chrominance&#34;</span><span class="op" id="6881694">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6881698">buf</span>&nbsp;<span class="op" id="6881702">:=</span>&nbsp;<span class="op" id="6881705">&amp;</span><span class="ident" id="6881706">bytes</span><span class="op" id="6881711">.</span><span class="ident" id="6881712">Buffer</span><span class="op" id="6881718">{</span><span class="op" id="6881719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6881723">for</span>&nbsp;<span class="ident" id="6881727">i</span><span class="op" id="6881728">,</span>&nbsp;<span class="ident" id="6881730">name</span>&nbsp;<span class="op" id="6881735">:=</span>&nbsp;<span class="keyword" id="6881738">range</span>&nbsp;<span class="ident" id="6881744">names</span>&nbsp;<span class="op" id="6881750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6881755">fmt</span><span class="op" id="6881758">.</span><span class="ident" id="6881759">Fprintf</span><span class="op" id="6881766">(</span><span class="ident" id="6881767">buf</span><span class="op" id="6881770">,</span>&nbsp;<span class="string" id="6881772">&#34;//&nbsp;%s.\n{\n&#34;</span><span class="op" id="6881785">,</span>&nbsp;<span class="ident" id="6881787">name</span><span class="op" id="6881791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6881796">for</span>&nbsp;<span class="ident" id="6881800">zig</span>&nbsp;<span class="op" id="6881804">:=</span>&nbsp;<span class="num" id="6881807">0</span><span class="op" id="6881808">;</span>&nbsp;<span class="ident" id="6881810">zig</span>&nbsp;<span class="op" id="6881814">&lt;</span>&nbsp;<span class="ident" id="6881816">blockSize</span><span class="op" id="6881825">;</span>&nbsp;<span class="ident" id="6881827">zig</span><span class="op" id="6881830">++</span>&nbsp;<span class="op" id="6881833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6881839">fmt</span><span class="op" id="6881842">.</span><span class="ident" id="6881843">Fprintf</span><span class="op" id="6881850">(</span><span class="ident" id="6881851">buf</span><span class="op" id="6881854">,</span>&nbsp;<span class="string" id="6881856">&#34;%d,&nbsp;&#34;</span><span class="op" id="6881862">,</span>&nbsp;<span class="ident" id="6881864">unscaledQuantInNaturalOrder</span><span class="op" id="6881891">[</span><span class="ident" id="6881892">i</span><span class="op" id="6881893">]</span><span class="op" id="6881894">[</span><span class="ident" id="6881895">unzig</span><span class="op" id="6881900">[</span><span class="ident" id="6881901">zig</span><span class="op" id="6881904">]</span><span class="op" id="6881905">]</span><span class="op" id="6881906">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6881912">if</span>&nbsp;<span class="ident" id="6881915">zig</span><span class="op" id="6881918">%</span><span class="num" id="6881919">8</span>&nbsp;<span class="op" id="6881921">==</span>&nbsp;<span class="num" id="6881924">7</span>&nbsp;<span class="op" id="6881926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6881933">buf</span><span class="op" id="6881936">.</span><span class="ident" id="6881937">WriteString</span><span class="op" id="6881948">(</span><span class="string" id="6881949">&#34;\n&#34;</span><span class="op" id="6881953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6881959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6881964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6881969">buf</span><span class="op" id="6881972">.</span><span class="ident" id="6881973">WriteString</span><span class="op" id="6881984">(</span><span class="string" id="6881985">&#34;},\n&#34;</span><span class="op" id="6881991">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6881995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6881999">t</span><span class="op" id="6882000">.</span><span class="ident" id="6882001">Logf</span><span class="op" id="6882005">(</span><span class="string" id="6882006">&#34;expected&nbsp;unscaledQuant&nbsp;values:\n%s&#34;</span><span class="op" id="6882042">,</span>&nbsp;<span class="ident" id="6882044">buf</span><span class="op" id="6882047">.</span><span class="ident" id="6882048">String</span><span class="op" id="6882054">(</span><span class="op" id="6882055">)</span><span class="op" id="6882056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6882059">}</span><br>
<span class="lineno"></span><span class="op" id="6882061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="6882064">var</span>&nbsp;<span class="ident" id="6882068">testCase</span>&nbsp;<span class="op" id="6882077">=</span>&nbsp;<span class="op" id="6882079">[</span><span class="op" id="6882080">]</span><span class="keyword" id="6882081">struct</span>&nbsp;<span class="op" id="6882088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6882091">filename</span>&nbsp;&nbsp;<span class="builtintype" id="6882101">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6882109">quality</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6882119">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6882124">tolerance</span>&nbsp;<span class="ident" id="6882134">int64</span><br>
<span class="lineno"></span><span class="op" id="6882140">}</span><span class="op" id="6882141">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6882144">{</span><span class="string" id="6882145">&#34;../testdata/video-001.png&#34;</span><span class="op" id="6882172">,</span>&nbsp;<span class="num" id="6882174">1</span><span class="op" id="6882175">,</span>&nbsp;<span class="num" id="6882177">24</span>&nbsp;<span class="op" id="6882180">&lt;&lt;</span>&nbsp;<span class="num" id="6882183">8</span><span class="op" id="6882184">}</span><span class="op" id="6882185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6882188">{</span><span class="string" id="6882189">&#34;../testdata/video-001.png&#34;</span><span class="op" id="6882216">,</span>&nbsp;<span class="num" id="6882218">20</span><span class="op" id="6882220">,</span>&nbsp;<span class="num" id="6882222">12</span>&nbsp;<span class="op" id="6882225">&lt;&lt;</span>&nbsp;<span class="num" id="6882228">8</span><span class="op" id="6882229">}</span><span class="op" id="6882230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6882233">{</span><span class="string" id="6882234">&#34;../testdata/video-001.png&#34;</span><span class="op" id="6882261">,</span>&nbsp;<span class="num" id="6882263">60</span><span class="op" id="6882265">,</span>&nbsp;<span class="num" id="6882267">8</span>&nbsp;<span class="op" id="6882269">&lt;&lt;</span>&nbsp;<span class="num" id="6882272">8</span><span class="op" id="6882273">}</span><span class="op" id="6882274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6882277">{</span><span class="string" id="6882278">&#34;../testdata/video-001.png&#34;</span><span class="op" id="6882305">,</span>&nbsp;<span class="num" id="6882307">80</span><span class="op" id="6882309">,</span>&nbsp;<span class="num" id="6882311">6</span>&nbsp;<span class="op" id="6882313">&lt;&lt;</span>&nbsp;<span class="num" id="6882316">8</span><span class="op" id="6882317">}</span><span class="op" id="6882318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6882321">{</span><span class="string" id="6882322">&#34;../testdata/video-001.png&#34;</span><span class="op" id="6882349">,</span>&nbsp;<span class="num" id="6882351">90</span><span class="op" id="6882353">,</span>&nbsp;<span class="num" id="6882355">4</span>&nbsp;<span class="op" id="6882357">&lt;&lt;</span>&nbsp;<span class="num" id="6882360">8</span><span class="op" id="6882361">}</span><span class="op" id="6882362">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6882365">{</span><span class="string" id="6882366">&#34;../testdata/video-001.png&#34;</span><span class="op" id="6882393">,</span>&nbsp;<span class="num" id="6882395">100</span><span class="op" id="6882398">,</span>&nbsp;<span class="num" id="6882400">2</span>&nbsp;<span class="op" id="6882402">&lt;&lt;</span>&nbsp;<span class="num" id="6882405">8</span><span class="op" id="6882406">}</span><span class="op" id="6882407">,</span><br>
<span class="lineno"></span><span class="op" id="6882409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6882412">func</span>&nbsp;<span class="ident" id="6882417">delta</span><span class="op" id="6882422">(</span><span class="ident" id="6882423">u0</span><span class="op" id="6882425">,</span>&nbsp;<span class="ident" id="6882427">u1</span>&nbsp;<span class="builtintype" id="6882430">uint32</span><span class="op" id="6882436">)</span>&nbsp;<span class="ident" id="6882438">int64</span>&nbsp;<span class="op" id="6882444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6882447">d</span>&nbsp;<span class="op" id="6882449">:=</span>&nbsp;<span class="ident" id="6882452">int64</span><span class="op" id="6882457">(</span><span class="ident" id="6882458">u0</span><span class="op" id="6882460">)</span>&nbsp;<span class="op" id="6882462">-</span>&nbsp;<span class="ident" id="6882464">int64</span><span class="op" id="6882469">(</span><span class="ident" id="6882470">u1</span><span class="op" id="6882472">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6882475">if</span>&nbsp;<span class="ident" id="6882478">d</span>&nbsp;<span class="op" id="6882480">&lt;</span>&nbsp;<span class="num" id="6882482">0</span>&nbsp;<span class="op" id="6882484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6882488">return</span>&nbsp;<span class="op" id="6882495">-</span><span class="ident" id="6882496">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6882499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6882502">return</span>&nbsp;<span class="ident" id="6882509">d</span><br>
<span class="lineno"></span><span class="op" id="6882511">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="6882514">func</span>&nbsp;<span class="ident" id="6882519">readPng</span><span class="op" id="6882526">(</span><span class="ident" id="6882527">filename</span>&nbsp;<span class="builtintype" id="6882536">string</span><span class="op" id="6882542">)</span>&nbsp;<span class="op" id="6882544">(</span><span class="ident" id="6882545">image</span><span class="op" id="6882550">.</span><span class="ident" id="6882551">Image</span><span class="op" id="6882556">,</span>&nbsp;<span class="builtintype" id="6882558">error</span><span class="op" id="6882563">)</span>&nbsp;<span class="op" id="6882565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6882568">f</span><span class="op" id="6882569">,</span>&nbsp;<span class="ident" id="6882571">err</span>&nbsp;<span class="op" id="6882575">:=</span>&nbsp;<span class="ident" id="6882578">os</span><span class="op" id="6882580">.</span><span class="ident" id="6882581">Open</span><span class="op" id="6882585">(</span><span class="ident" id="6882586">filename</span><span class="op" id="6882594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6882597">if</span>&nbsp;<span class="ident" id="6882600">err</span>&nbsp;<span class="op" id="6882604">!=</span>&nbsp;<span class="ident" id="6882607">nil</span>&nbsp;<span class="op" id="6882611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6882615">return</span>&nbsp;<span class="ident" id="6882622">nil</span><span class="op" id="6882625">,</span>&nbsp;<span class="ident" id="6882627">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6882632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6882635">defer</span>&nbsp;<span class="ident" id="6882641">f</span><span class="op" id="6882642">.</span><span class="ident" id="6882643">Close</span><span class="op" id="6882648">(</span><span class="op" id="6882649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6882652">return</span>&nbsp;<span class="ident" id="6882659">png</span><span class="op" id="6882662">.</span><span class="ident" id="6882663">Decode</span><span class="op" id="6882669">(</span><span class="ident" id="6882670">f</span><span class="op" id="6882671">)</span><br>
<span class="lineno"></span><span class="op" id="6882673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6882676">func</span>&nbsp;<span class="ident" id="6882681">TestWriter</span><span class="op" id="6882691">(</span><span class="ident" id="6882692">t</span>&nbsp;<span class="op" id="6882694">*</span><span class="ident" id="6882695">testing</span><span class="op" id="6882702">.</span><span class="ident" id="6882703">T</span><span class="op" id="6882704">)</span>&nbsp;<span class="op" id="6882706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6882709">for</span>&nbsp;<span class="ident" id="6882713">_</span><span class="op" id="6882714">,</span>&nbsp;<span class="ident" id="6882716">tc</span>&nbsp;<span class="op" id="6882719">:=</span>&nbsp;<span class="keyword" id="6882722">range</span>&nbsp;<span class="ident" id="6882728">testCase</span>&nbsp;<span class="op" id="6882737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6882741">//&nbsp;Read&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6882762">m0</span><span class="op" id="6882764">,</span>&nbsp;<span class="ident" id="6882766">err</span>&nbsp;<span class="op" id="6882770">:=</span>&nbsp;<span class="ident" id="6882773">readPng</span><span class="op" id="6882780">(</span><span class="ident" id="6882781">tc</span><span class="op" id="6882783">.</span><span class="ident" id="6882784">filename</span><span class="op" id="6882792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6882796">if</span>&nbsp;<span class="ident" id="6882799">err</span>&nbsp;<span class="op" id="6882803">!=</span>&nbsp;<span class="ident" id="6882806">nil</span>&nbsp;<span class="op" id="6882810">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6882815">t</span><span class="op" id="6882816">.</span><span class="ident" id="6882817">Error</span><span class="op" id="6882822">(</span><span class="ident" id="6882823">tc</span><span class="op" id="6882825">.</span><span class="ident" id="6882826">filename</span><span class="op" id="6882834">,</span>&nbsp;<span class="ident" id="6882836">err</span><span class="op" id="6882839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6882844">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6882855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6882859">//&nbsp;Encode&nbsp;that&nbsp;image&nbsp;as&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6882891">var</span>&nbsp;<span class="ident" id="6882895">buf</span>&nbsp;<span class="ident" id="6882899">bytes</span><span class="op" id="6882904">.</span><span class="ident" id="6882905">Buffer</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6882914">err</span>&nbsp;<span class="op" id="6882918">=</span>&nbsp;<span class="ident" id="6882920">Encode</span><span class="op" id="6882926">(</span><span class="op" id="6882927">&amp;</span><span class="ident" id="6882928">buf</span><span class="op" id="6882931">,</span>&nbsp;<span class="ident" id="6882933">m0</span><span class="op" id="6882935">,</span>&nbsp;<span class="op" id="6882937">&amp;</span><span class="ident" id="6882938">Options</span><span class="op" id="6882945">{</span><span class="ident" id="6882946">Quality</span><span class="op" id="6882953">:</span>&nbsp;<span class="ident" id="6882955">tc</span><span class="op" id="6882957">.</span><span class="ident" id="6882958">quality</span><span class="op" id="6882965">}</span><span class="op" id="6882966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6882970">if</span>&nbsp;<span class="ident" id="6882973">err</span>&nbsp;<span class="op" id="6882977">!=</span>&nbsp;<span class="ident" id="6882980">nil</span>&nbsp;<span class="op" id="6882984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6882989">t</span><span class="op" id="6882990">.</span><span class="ident" id="6882991">Error</span><span class="op" id="6882996">(</span><span class="ident" id="6882997">tc</span><span class="op" id="6882999">.</span><span class="ident" id="6883000">filename</span><span class="op" id="6883008">,</span>&nbsp;<span class="ident" id="6883010">err</span><span class="op" id="6883013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883018">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883029">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6883033">//&nbsp;Decode&nbsp;that&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883056">m1</span><span class="op" id="6883058">,</span>&nbsp;<span class="ident" id="6883060">err</span>&nbsp;<span class="op" id="6883064">:=</span>&nbsp;<span class="ident" id="6883067">Decode</span><span class="op" id="6883073">(</span><span class="op" id="6883074">&amp;</span><span class="ident" id="6883075">buf</span><span class="op" id="6883078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883082">if</span>&nbsp;<span class="ident" id="6883085">err</span>&nbsp;<span class="op" id="6883089">!=</span>&nbsp;<span class="ident" id="6883092">nil</span>&nbsp;<span class="op" id="6883096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883101">t</span><span class="op" id="6883102">.</span><span class="ident" id="6883103">Error</span><span class="op" id="6883108">(</span><span class="ident" id="6883109">tc</span><span class="op" id="6883111">.</span><span class="ident" id="6883112">filename</span><span class="op" id="6883120">,</span>&nbsp;<span class="ident" id="6883122">err</span><span class="op" id="6883125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883130">continue</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883145">if</span>&nbsp;<span class="ident" id="6883148">m0</span><span class="op" id="6883150">.</span><span class="ident" id="6883151">Bounds</span><span class="op" id="6883157">(</span><span class="op" id="6883158">)</span>&nbsp;<span class="op" id="6883160">!=</span>&nbsp;<span class="ident" id="6883163">m1</span><span class="op" id="6883165">.</span><span class="ident" id="6883166">Bounds</span><span class="op" id="6883172">(</span><span class="op" id="6883173">)</span>&nbsp;<span class="op" id="6883175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883180">t</span><span class="op" id="6883181">.</span><span class="ident" id="6883182">Errorf</span><span class="op" id="6883188">(</span><span class="string" id="6883189">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="6883219">,</span>&nbsp;<span class="ident" id="6883221">tc</span><span class="op" id="6883223">.</span><span class="ident" id="6883224">filename</span><span class="op" id="6883232">,</span>&nbsp;<span class="ident" id="6883234">m0</span><span class="op" id="6883236">.</span><span class="ident" id="6883237">Bounds</span><span class="op" id="6883243">(</span><span class="op" id="6883244">)</span><span class="op" id="6883245">,</span>&nbsp;<span class="ident" id="6883247">m1</span><span class="op" id="6883249">.</span><span class="ident" id="6883250">Bounds</span><span class="op" id="6883256">(</span><span class="op" id="6883257">)</span><span class="op" id="6883258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883263">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883274">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6883278">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883333">if</span>&nbsp;<span class="ident" id="6883336">averageDelta</span><span class="op" id="6883348">(</span><span class="ident" id="6883349">m0</span><span class="op" id="6883351">,</span>&nbsp;<span class="ident" id="6883353">m1</span><span class="op" id="6883355">)</span>&nbsp;<span class="op" id="6883357">&gt;</span>&nbsp;<span class="ident" id="6883359">tc</span><span class="op" id="6883361">.</span><span class="ident" id="6883362">tolerance</span>&nbsp;<span class="op" id="6883372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883377">t</span><span class="op" id="6883378">.</span><span class="ident" id="6883379">Errorf</span><span class="op" id="6883385">(</span><span class="string" id="6883386">&#34;%s,&nbsp;quality=%d:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high&#34;</span><span class="op" id="6883429">,</span>&nbsp;<span class="ident" id="6883431">tc</span><span class="op" id="6883433">.</span><span class="ident" id="6883434">filename</span><span class="op" id="6883442">,</span>&nbsp;<span class="ident" id="6883444">tc</span><span class="op" id="6883446">.</span><span class="ident" id="6883447">quality</span><span class="op" id="6883454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883459">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883470">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883473">}</span><br>
<span class="lineno"></span><span class="op" id="6883475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6883478">//&nbsp;TestWriteGrayscale&nbsp;tests&nbsp;that&nbsp;a&nbsp;grayscale&nbsp;images&nbsp;survives&nbsp;a&nbsp;round-trip</span><br>
<span class="lineno"></span><span class="comment" id="6883552">//&nbsp;through&nbsp;encode/decode&nbsp;cycle.</span><br>
<span class="lineno">165</span><span class="keyword" id="6883584">func</span>&nbsp;<span class="ident" id="6883589">TestWriteGrayscale</span><span class="op" id="6883607">(</span><span class="ident" id="6883608">t</span>&nbsp;<span class="op" id="6883610">*</span><span class="ident" id="6883611">testing</span><span class="op" id="6883618">.</span><span class="ident" id="6883619">T</span><span class="op" id="6883620">)</span>&nbsp;<span class="op" id="6883622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883625">m0</span>&nbsp;<span class="op" id="6883628">:=</span>&nbsp;<span class="ident" id="6883631">image</span><span class="op" id="6883636">.</span><span class="ident" id="6883637">NewGray</span><span class="op" id="6883644">(</span><span class="ident" id="6883645">image</span><span class="op" id="6883650">.</span><span class="ident" id="6883651">Rect</span><span class="op" id="6883655">(</span><span class="num" id="6883656">0</span><span class="op" id="6883657">,</span>&nbsp;<span class="num" id="6883659">0</span><span class="op" id="6883660">,</span>&nbsp;<span class="num" id="6883662">32</span><span class="op" id="6883664">,</span>&nbsp;<span class="num" id="6883666">32</span><span class="op" id="6883668">)</span><span class="op" id="6883669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883672">for</span>&nbsp;<span class="ident" id="6883676">i</span>&nbsp;<span class="op" id="6883678">:=</span>&nbsp;<span class="keyword" id="6883681">range</span>&nbsp;<span class="ident" id="6883687">m0</span><span class="op" id="6883689">.</span><span class="ident" id="6883690">Pix</span>&nbsp;<span class="op" id="6883694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883698">m0</span><span class="op" id="6883700">.</span><span class="ident" id="6883701">Pix</span><span class="op" id="6883704">[</span><span class="ident" id="6883705">i</span><span class="op" id="6883706">]</span>&nbsp;<span class="op" id="6883708">=</span>&nbsp;<span class="builtintype" id="6883710">uint8</span><span class="op" id="6883715">(</span><span class="ident" id="6883716">i</span><span class="op" id="6883717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883720">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883723">var</span>&nbsp;<span class="ident" id="6883727">buf</span>&nbsp;<span class="ident" id="6883731">bytes</span><span class="op" id="6883736">.</span><span class="ident" id="6883737">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883745">if</span>&nbsp;<span class="ident" id="6883748">err</span>&nbsp;<span class="op" id="6883752">:=</span>&nbsp;<span class="ident" id="6883755">Encode</span><span class="op" id="6883761">(</span><span class="op" id="6883762">&amp;</span><span class="ident" id="6883763">buf</span><span class="op" id="6883766">,</span>&nbsp;<span class="ident" id="6883768">m0</span><span class="op" id="6883770">,</span>&nbsp;<span class="ident" id="6883772">nil</span><span class="op" id="6883775">)</span><span class="op" id="6883776">;</span>&nbsp;<span class="ident" id="6883778">err</span>&nbsp;<span class="op" id="6883782">!=</span>&nbsp;<span class="ident" id="6883785">nil</span>&nbsp;<span class="op" id="6883789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883793">t</span><span class="op" id="6883794">.</span><span class="ident" id="6883795">Fatal</span><span class="op" id="6883800">(</span><span class="ident" id="6883801">err</span><span class="op" id="6883804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883810">m1</span><span class="op" id="6883812">,</span>&nbsp;<span class="ident" id="6883814">err</span>&nbsp;<span class="op" id="6883818">:=</span>&nbsp;<span class="ident" id="6883821">Decode</span><span class="op" id="6883827">(</span><span class="op" id="6883828">&amp;</span><span class="ident" id="6883829">buf</span><span class="op" id="6883832">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883835">if</span>&nbsp;<span class="ident" id="6883838">err</span>&nbsp;<span class="op" id="6883842">!=</span>&nbsp;<span class="ident" id="6883845">nil</span>&nbsp;<span class="op" id="6883849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883853">t</span><span class="op" id="6883854">.</span><span class="ident" id="6883855">Fatal</span><span class="op" id="6883860">(</span><span class="ident" id="6883861">err</span><span class="op" id="6883864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883870">if</span>&nbsp;<span class="ident" id="6883873">m0</span><span class="op" id="6883875">.</span><span class="ident" id="6883876">Bounds</span><span class="op" id="6883882">(</span><span class="op" id="6883883">)</span>&nbsp;<span class="op" id="6883885">!=</span>&nbsp;<span class="ident" id="6883888">m1</span><span class="op" id="6883890">.</span><span class="ident" id="6883891">Bounds</span><span class="op" id="6883897">(</span><span class="op" id="6883898">)</span>&nbsp;<span class="op" id="6883900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883904">t</span><span class="op" id="6883905">.</span><span class="ident" id="6883906">Fatalf</span><span class="op" id="6883912">(</span><span class="string" id="6883913">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="6883939">,</span>&nbsp;<span class="ident" id="6883941">m0</span><span class="op" id="6883943">.</span><span class="ident" id="6883944">Bounds</span><span class="op" id="6883950">(</span><span class="op" id="6883951">)</span><span class="op" id="6883952">,</span>&nbsp;<span class="ident" id="6883954">m1</span><span class="op" id="6883956">.</span><span class="ident" id="6883957">Bounds</span><span class="op" id="6883963">(</span><span class="op" id="6883964">)</span><span class="op" id="6883965">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6883971">if</span>&nbsp;<span class="ident" id="6883974">_</span><span class="op" id="6883975">,</span>&nbsp;<span class="ident" id="6883977">ok</span>&nbsp;<span class="op" id="6883980">:=</span>&nbsp;<span class="ident" id="6883983">m1</span><span class="op" id="6883985">.</span><span class="op" id="6883986">(</span><span class="op" id="6883987">*</span><span class="ident" id="6883988">image</span><span class="op" id="6883993">.</span><span class="ident" id="6883994">Gray</span><span class="op" id="6883998">)</span><span class="op" id="6883999">;</span>&nbsp;<span class="op" id="6884001">!</span><span class="ident" id="6884002">ok</span>&nbsp;<span class="op" id="6884005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884009">t</span><span class="op" id="6884010">.</span><span class="ident" id="6884011">Errorf</span><span class="op" id="6884017">(</span><span class="string" id="6884018">&#34;got&nbsp;%T,&nbsp;want&nbsp;*image.Gray&#34;</span><span class="op" id="6884044">,</span>&nbsp;<span class="ident" id="6884046">m1</span><span class="op" id="6884048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6884054">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884108">want</span>&nbsp;<span class="op" id="6884113">:=</span>&nbsp;<span class="ident" id="6884116">int64</span><span class="op" id="6884121">(</span><span class="num" id="6884122">2</span>&nbsp;<span class="op" id="6884124">&lt;&lt;</span>&nbsp;<span class="num" id="6884127">8</span><span class="op" id="6884128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6884131">if</span>&nbsp;<span class="ident" id="6884134">got</span>&nbsp;<span class="op" id="6884138">:=</span>&nbsp;<span class="ident" id="6884141">averageDelta</span><span class="op" id="6884153">(</span><span class="ident" id="6884154">m0</span><span class="op" id="6884156">,</span>&nbsp;<span class="ident" id="6884158">m1</span><span class="op" id="6884160">)</span><span class="op" id="6884161">;</span>&nbsp;<span class="ident" id="6884163">got</span>&nbsp;<span class="op" id="6884167">&gt;</span>&nbsp;<span class="ident" id="6884169">want</span>&nbsp;<span class="op" id="6884174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884178">t</span><span class="op" id="6884179">.</span><span class="ident" id="6884180">Errorf</span><span class="op" id="6884186">(</span><span class="string" id="6884187">&#34;average&nbsp;delta&nbsp;too&nbsp;high;&nbsp;got&nbsp;%d,&nbsp;want&nbsp;&lt;=&nbsp;%d&#34;</span><span class="op" id="6884231">,</span>&nbsp;<span class="ident" id="6884233">got</span><span class="op" id="6884236">,</span>&nbsp;<span class="ident" id="6884238">want</span><span class="op" id="6884242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884245">}</span><br>
<span class="lineno"></span><span class="op" id="6884247">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="6884250">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="6884326">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="6884351">func</span>&nbsp;<span class="ident" id="6884356">averageDelta</span><span class="op" id="6884368">(</span><span class="ident" id="6884369">m0</span><span class="op" id="6884371">,</span>&nbsp;<span class="ident" id="6884373">m1</span>&nbsp;<span class="ident" id="6884376">image</span><span class="op" id="6884381">.</span><span class="ident" id="6884382">Image</span><span class="op" id="6884387">)</span>&nbsp;<span class="ident" id="6884389">int64</span>&nbsp;<span class="op" id="6884395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884398">b</span>&nbsp;<span class="op" id="6884400">:=</span>&nbsp;<span class="ident" id="6884403">m0</span><span class="op" id="6884405">.</span><span class="ident" id="6884406">Bounds</span><span class="op" id="6884412">(</span><span class="op" id="6884413">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6884416">var</span>&nbsp;<span class="ident" id="6884420">sum</span><span class="op" id="6884423">,</span>&nbsp;<span class="ident" id="6884425">n</span>&nbsp;<span class="ident" id="6884427">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6884434">for</span>&nbsp;<span class="ident" id="6884438">y</span>&nbsp;<span class="op" id="6884440">:=</span>&nbsp;<span class="ident" id="6884443">b</span><span class="op" id="6884444">.</span><span class="ident" id="6884445">Min</span><span class="op" id="6884448">.</span><span class="ident" id="6884449">Y</span><span class="op" id="6884450">;</span>&nbsp;<span class="ident" id="6884452">y</span>&nbsp;<span class="op" id="6884454">&lt;</span>&nbsp;<span class="ident" id="6884456">b</span><span class="op" id="6884457">.</span><span class="ident" id="6884458">Max</span><span class="op" id="6884461">.</span><span class="ident" id="6884462">Y</span><span class="op" id="6884463">;</span>&nbsp;<span class="ident" id="6884465">y</span><span class="op" id="6884466">++</span>&nbsp;<span class="op" id="6884469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6884473">for</span>&nbsp;<span class="ident" id="6884477">x</span>&nbsp;<span class="op" id="6884479">:=</span>&nbsp;<span class="ident" id="6884482">b</span><span class="op" id="6884483">.</span><span class="ident" id="6884484">Min</span><span class="op" id="6884487">.</span><span class="ident" id="6884488">X</span><span class="op" id="6884489">;</span>&nbsp;<span class="ident" id="6884491">x</span>&nbsp;<span class="op" id="6884493">&lt;</span>&nbsp;<span class="ident" id="6884495">b</span><span class="op" id="6884496">.</span><span class="ident" id="6884497">Max</span><span class="op" id="6884500">.</span><span class="ident" id="6884501">X</span><span class="op" id="6884502">;</span>&nbsp;<span class="ident" id="6884504">x</span><span class="op" id="6884505">++</span>&nbsp;<span class="op" id="6884508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884513">c0</span>&nbsp;<span class="op" id="6884516">:=</span>&nbsp;<span class="ident" id="6884519">m0</span><span class="op" id="6884521">.</span><span class="ident" id="6884522">At</span><span class="op" id="6884524">(</span><span class="ident" id="6884525">x</span><span class="op" id="6884526">,</span>&nbsp;<span class="ident" id="6884528">y</span><span class="op" id="6884529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884534">c1</span>&nbsp;<span class="op" id="6884537">:=</span>&nbsp;<span class="ident" id="6884540">m1</span><span class="op" id="6884542">.</span><span class="ident" id="6884543">At</span><span class="op" id="6884545">(</span><span class="ident" id="6884546">x</span><span class="op" id="6884547">,</span>&nbsp;<span class="ident" id="6884549">y</span><span class="op" id="6884550">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884555">r0</span><span class="op" id="6884557">,</span>&nbsp;<span class="ident" id="6884559">g0</span><span class="op" id="6884561">,</span>&nbsp;<span class="ident" id="6884563">b0</span><span class="op" id="6884565">,</span>&nbsp;<span class="ident" id="6884567">_</span>&nbsp;<span class="op" id="6884569">:=</span>&nbsp;<span class="ident" id="6884572">c0</span><span class="op" id="6884574">.</span><span class="ident" id="6884575">RGBA</span><span class="op" id="6884579">(</span><span class="op" id="6884580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884585">r1</span><span class="op" id="6884587">,</span>&nbsp;<span class="ident" id="6884589">g1</span><span class="op" id="6884591">,</span>&nbsp;<span class="ident" id="6884593">b1</span><span class="op" id="6884595">,</span>&nbsp;<span class="ident" id="6884597">_</span>&nbsp;<span class="op" id="6884599">:=</span>&nbsp;<span class="ident" id="6884602">c1</span><span class="op" id="6884604">.</span><span class="ident" id="6884605">RGBA</span><span class="op" id="6884609">(</span><span class="op" id="6884610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884615">sum</span>&nbsp;<span class="op" id="6884619">+=</span>&nbsp;<span class="ident" id="6884622">delta</span><span class="op" id="6884627">(</span><span class="ident" id="6884628">r0</span><span class="op" id="6884630">,</span>&nbsp;<span class="ident" id="6884632">r1</span><span class="op" id="6884634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884639">sum</span>&nbsp;<span class="op" id="6884643">+=</span>&nbsp;<span class="ident" id="6884646">delta</span><span class="op" id="6884651">(</span><span class="ident" id="6884652">g0</span><span class="op" id="6884654">,</span>&nbsp;<span class="ident" id="6884656">g1</span><span class="op" id="6884658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884663">sum</span>&nbsp;<span class="op" id="6884667">+=</span>&nbsp;<span class="ident" id="6884670">delta</span><span class="op" id="6884675">(</span><span class="ident" id="6884676">b0</span><span class="op" id="6884678">,</span>&nbsp;<span class="ident" id="6884680">b1</span><span class="op" id="6884682">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884687">n</span>&nbsp;<span class="op" id="6884689">+=</span>&nbsp;<span class="num" id="6884692">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6884702">return</span>&nbsp;<span class="ident" id="6884709">sum</span>&nbsp;<span class="op" id="6884713">/</span>&nbsp;<span class="ident" id="6884715">n</span><br>
<span class="lineno"></span><span class="op" id="6884717">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="6884720">func</span>&nbsp;<span class="ident" id="6884725">BenchmarkEncode</span><span class="op" id="6884740">(</span><span class="ident" id="6884741">b</span>&nbsp;<span class="op" id="6884743">*</span><span class="ident" id="6884744">testing</span><span class="op" id="6884751">.</span><span class="ident" id="6884752">B</span><span class="op" id="6884753">)</span>&nbsp;<span class="op" id="6884755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884758">b</span><span class="op" id="6884759">.</span><span class="ident" id="6884760">StopTimer</span><span class="op" id="6884769">(</span><span class="op" id="6884770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884773">img</span>&nbsp;<span class="op" id="6884777">:=</span>&nbsp;<span class="ident" id="6884780">image</span><span class="op" id="6884785">.</span><span class="ident" id="6884786">NewRGBA</span><span class="op" id="6884793">(</span><span class="ident" id="6884794">image</span><span class="op" id="6884799">.</span><span class="ident" id="6884800">Rect</span><span class="op" id="6884804">(</span><span class="num" id="6884805">0</span><span class="op" id="6884806">,</span>&nbsp;<span class="num" id="6884808">0</span><span class="op" id="6884809">,</span>&nbsp;<span class="num" id="6884811">640</span><span class="op" id="6884814">,</span>&nbsp;<span class="num" id="6884816">480</span><span class="op" id="6884819">)</span><span class="op" id="6884820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884823">bo</span>&nbsp;<span class="op" id="6884826">:=</span>&nbsp;<span class="ident" id="6884829">img</span><span class="op" id="6884832">.</span><span class="ident" id="6884833">Bounds</span><span class="op" id="6884839">(</span><span class="op" id="6884840">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884843">rnd</span>&nbsp;<span class="op" id="6884847">:=</span>&nbsp;<span class="ident" id="6884850">rand</span><span class="op" id="6884854">.</span><span class="ident" id="6884855">New</span><span class="op" id="6884858">(</span><span class="ident" id="6884859">rand</span><span class="op" id="6884863">.</span><span class="ident" id="6884864">NewSource</span><span class="op" id="6884873">(</span><span class="num" id="6884874">123</span><span class="op" id="6884877">)</span><span class="op" id="6884878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6884881">for</span>&nbsp;<span class="ident" id="6884885">y</span>&nbsp;<span class="op" id="6884887">:=</span>&nbsp;<span class="ident" id="6884890">bo</span><span class="op" id="6884892">.</span><span class="ident" id="6884893">Min</span><span class="op" id="6884896">.</span><span class="ident" id="6884897">Y</span><span class="op" id="6884898">;</span>&nbsp;<span class="ident" id="6884900">y</span>&nbsp;<span class="op" id="6884902">&lt;</span>&nbsp;<span class="ident" id="6884904">bo</span><span class="op" id="6884906">.</span><span class="ident" id="6884907">Max</span><span class="op" id="6884910">.</span><span class="ident" id="6884911">Y</span><span class="op" id="6884912">;</span>&nbsp;<span class="ident" id="6884914">y</span><span class="op" id="6884915">++</span>&nbsp;<span class="op" id="6884918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6884922">for</span>&nbsp;<span class="ident" id="6884926">x</span>&nbsp;<span class="op" id="6884928">:=</span>&nbsp;<span class="ident" id="6884931">bo</span><span class="op" id="6884933">.</span><span class="ident" id="6884934">Min</span><span class="op" id="6884937">.</span><span class="ident" id="6884938">X</span><span class="op" id="6884939">;</span>&nbsp;<span class="ident" id="6884941">x</span>&nbsp;<span class="op" id="6884943">&lt;</span>&nbsp;<span class="ident" id="6884945">bo</span><span class="op" id="6884947">.</span><span class="ident" id="6884948">Max</span><span class="op" id="6884951">.</span><span class="ident" id="6884952">X</span><span class="op" id="6884953">;</span>&nbsp;<span class="ident" id="6884955">x</span><span class="op" id="6884956">++</span>&nbsp;<span class="op" id="6884959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884964">img</span><span class="op" id="6884967">.</span><span class="ident" id="6884968">SetRGBA</span><span class="op" id="6884975">(</span><span class="ident" id="6884976">x</span><span class="op" id="6884977">,</span>&nbsp;<span class="ident" id="6884979">y</span><span class="op" id="6884980">,</span>&nbsp;<span class="ident" id="6884982">color</span><span class="op" id="6884987">.</span><span class="ident" id="6884988">RGBA</span><span class="op" id="6884992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6884998">uint8</span><span class="op" id="6885003">(</span><span class="ident" id="6885004">rnd</span><span class="op" id="6885007">.</span><span class="ident" id="6885008">Intn</span><span class="op" id="6885012">(</span><span class="num" id="6885013">256</span><span class="op" id="6885016">)</span><span class="op" id="6885017">)</span><span class="op" id="6885018">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6885024">uint8</span><span class="op" id="6885029">(</span><span class="ident" id="6885030">rnd</span><span class="op" id="6885033">.</span><span class="ident" id="6885034">Intn</span><span class="op" id="6885038">(</span><span class="num" id="6885039">256</span><span class="op" id="6885042">)</span><span class="op" id="6885043">)</span><span class="op" id="6885044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6885050">uint8</span><span class="op" id="6885055">(</span><span class="ident" id="6885056">rnd</span><span class="op" id="6885059">.</span><span class="ident" id="6885060">Intn</span><span class="op" id="6885064">(</span><span class="num" id="6885065">256</span><span class="op" id="6885068">)</span><span class="op" id="6885069">)</span><span class="op" id="6885070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6885076">255</span><span class="op" id="6885079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885084">}</span><span class="op" id="6885085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885089">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885095">b</span><span class="op" id="6885096">.</span><span class="ident" id="6885097">SetBytes</span><span class="op" id="6885105">(</span><span class="num" id="6885106">640</span>&nbsp;<span class="op" id="6885110">*</span>&nbsp;<span class="num" id="6885112">480</span>&nbsp;<span class="op" id="6885116">*</span>&nbsp;<span class="num" id="6885118">4</span><span class="op" id="6885119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885122">b</span><span class="op" id="6885123">.</span><span class="ident" id="6885124">StartTimer</span><span class="op" id="6885134">(</span><span class="op" id="6885135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885138">options</span>&nbsp;<span class="op" id="6885146">:=</span>&nbsp;<span class="op" id="6885149">&amp;</span><span class="ident" id="6885150">Options</span><span class="op" id="6885157">{</span><span class="ident" id="6885158">Quality</span><span class="op" id="6885165">:</span>&nbsp;<span class="num" id="6885167">90</span><span class="op" id="6885169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885172">for</span>&nbsp;<span class="ident" id="6885176">i</span>&nbsp;<span class="op" id="6885178">:=</span>&nbsp;<span class="num" id="6885181">0</span><span class="op" id="6885182">;</span>&nbsp;<span class="ident" id="6885184">i</span>&nbsp;<span class="op" id="6885186">&lt;</span>&nbsp;<span class="ident" id="6885188">b</span><span class="op" id="6885189">.</span><span class="ident" id="6885190">N</span><span class="op" id="6885191">;</span>&nbsp;<span class="ident" id="6885193">i</span><span class="op" id="6885194">++</span>&nbsp;<span class="op" id="6885197">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885201">Encode</span><span class="op" id="6885207">(</span><span class="ident" id="6885208">ioutil</span><span class="op" id="6885214">.</span><span class="ident" id="6885215">Discard</span><span class="op" id="6885222">,</span>&nbsp;<span class="ident" id="6885224">img</span><span class="op" id="6885227">,</span>&nbsp;<span class="ident" id="6885229">options</span><span class="op" id="6885236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885239">}</span><br>
<span class="lineno"></span><span class="op" id="6885241">}</span>
</div>
</body>
</html>
