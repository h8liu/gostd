<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2205288">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2205343">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2205397">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2205448">//&nbsp;Package&nbsp;strings&nbsp;implements&nbsp;simple&nbsp;functions&nbsp;to&nbsp;manipulate&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="2205518">package</span>&nbsp;<span class="ident" id="2205526">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2205535">import</span>&nbsp;<span class="op" id="2205542">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2205545">&#34;unicode&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2205556">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2205571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2205574">//&nbsp;explode&nbsp;splits&nbsp;s&nbsp;into&nbsp;an&nbsp;array&nbsp;of&nbsp;UTF-8&nbsp;sequences,&nbsp;one&nbsp;per&nbsp;Unicode&nbsp;character&nbsp;(still&nbsp;strings)&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;n&nbsp;(n&nbsp;&lt;&nbsp;0&nbsp;means&nbsp;no&nbsp;limit).</span><br>
<span class="lineno"></span><span class="comment" id="2205715">//&nbsp;Invalid&nbsp;UTF-8&nbsp;sequences&nbsp;become&nbsp;correct&nbsp;encodings&nbsp;of&nbsp;U+FFF8.</span><br>
<span class="lineno">15</span><span class="keyword" id="2205778">func</span>&nbsp;<span class="ident" id="2205783">explode</span><span class="op" id="2205790">(</span><span class="ident" id="2205791">s</span>&nbsp;<span class="builtintype" id="2205793">string</span><span class="op" id="2205799">,</span>&nbsp;<span class="ident" id="2205801">n</span>&nbsp;<span class="builtintype" id="2205803">int</span><span class="op" id="2205806">)</span>&nbsp;<span class="op" id="2205808">[</span><span class="op" id="2205809">]</span><span class="builtintype" id="2205810">string</span>&nbsp;<span class="op" id="2205817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205820">if</span>&nbsp;<span class="ident" id="2205823">n</span>&nbsp;<span class="op" id="2205825">==</span>&nbsp;<span class="num" id="2205828">0</span>&nbsp;<span class="op" id="2205830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205834">return</span>&nbsp;<span class="ident" id="2205841">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205849">l</span>&nbsp;<span class="op" id="2205851">:=</span>&nbsp;<span class="ident" id="2205854">utf8</span><span class="op" id="2205858">.</span><span class="ident" id="2205859">RuneCountInString</span><span class="op" id="2205876">(</span><span class="ident" id="2205877">s</span><span class="op" id="2205878">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205881">if</span>&nbsp;<span class="ident" id="2205884">n</span>&nbsp;<span class="op" id="2205886">&lt;=</span>&nbsp;<span class="num" id="2205889">0</span>&nbsp;<span class="op" id="2205891">||</span>&nbsp;<span class="ident" id="2205894">n</span>&nbsp;<span class="op" id="2205896">&gt;</span>&nbsp;<span class="ident" id="2205898">l</span>&nbsp;<span class="op" id="2205900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205904">n</span>&nbsp;<span class="op" id="2205906">=</span>&nbsp;<span class="ident" id="2205908">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205914">a</span>&nbsp;<span class="op" id="2205916">:=</span>&nbsp;<span class="builtinfunc" id="2205919">make</span><span class="op" id="2205923">(</span><span class="op" id="2205924">[</span><span class="op" id="2205925">]</span><span class="builtintype" id="2205926">string</span><span class="op" id="2205932">,</span>&nbsp;<span class="ident" id="2205934">n</span><span class="op" id="2205935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205938">var</span>&nbsp;<span class="ident" id="2205942">size</span>&nbsp;<span class="builtintype" id="2205947">int</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205952">var</span>&nbsp;<span class="ident" id="2205956">ch</span>&nbsp;<span class="builtintype" id="2205959">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205965">i</span><span class="op" id="2205966">,</span>&nbsp;<span class="ident" id="2205968">cur</span>&nbsp;<span class="op" id="2205972">:=</span>&nbsp;<span class="num" id="2205975">0</span><span class="op" id="2205976">,</span>&nbsp;<span class="num" id="2205978">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205981">for</span>&nbsp;<span class="op" id="2205985">;</span>&nbsp;<span class="ident" id="2205987">i</span><span class="op" id="2205988">+</span><span class="num" id="2205989">1</span>&nbsp;<span class="op" id="2205991">&lt;</span>&nbsp;<span class="ident" id="2205993">n</span><span class="op" id="2205994">;</span>&nbsp;<span class="ident" id="2205996">i</span><span class="op" id="2205997">++</span>&nbsp;<span class="op" id="2206000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206004">ch</span><span class="op" id="2206006">,</span>&nbsp;<span class="ident" id="2206008">size</span>&nbsp;<span class="op" id="2206013">=</span>&nbsp;<span class="ident" id="2206015">utf8</span><span class="op" id="2206019">.</span><span class="ident" id="2206020">DecodeRuneInString</span><span class="op" id="2206038">(</span><span class="ident" id="2206039">s</span><span class="op" id="2206040">[</span><span class="ident" id="2206041">cur</span><span class="op" id="2206044">:</span><span class="op" id="2206045">]</span><span class="op" id="2206046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206050">if</span>&nbsp;<span class="ident" id="2206053">ch</span>&nbsp;<span class="op" id="2206056">==</span>&nbsp;<span class="ident" id="2206059">utf8</span><span class="op" id="2206063">.</span><span class="ident" id="2206064">RuneError</span>&nbsp;<span class="op" id="2206074">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206079">a</span><span class="op" id="2206080">[</span><span class="ident" id="2206081">i</span><span class="op" id="2206082">]</span>&nbsp;<span class="op" id="2206084">=</span>&nbsp;<span class="builtintype" id="2206086">string</span><span class="op" id="2206092">(</span><span class="ident" id="2206093">utf8</span><span class="op" id="2206097">.</span><span class="ident" id="2206098">RuneError</span><span class="op" id="2206107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2206111">}</span>&nbsp;<span class="keyword" id="2206113">else</span>&nbsp;<span class="op" id="2206118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206123">a</span><span class="op" id="2206124">[</span><span class="ident" id="2206125">i</span><span class="op" id="2206126">]</span>&nbsp;<span class="op" id="2206128">=</span>&nbsp;<span class="ident" id="2206130">s</span><span class="op" id="2206131">[</span><span class="ident" id="2206132">cur</span>&nbsp;<span class="op" id="2206136">:</span>&nbsp;<span class="ident" id="2206138">cur</span><span class="op" id="2206141">+</span><span class="ident" id="2206142">size</span><span class="op" id="2206146">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2206150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206154">cur</span>&nbsp;<span class="op" id="2206158">+=</span>&nbsp;<span class="ident" id="2206161">size</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2206167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2206170">//&nbsp;add&nbsp;the&nbsp;rest,&nbsp;if&nbsp;there&nbsp;is&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206204">if</span>&nbsp;<span class="ident" id="2206207">cur</span>&nbsp;<span class="op" id="2206211">&lt;</span>&nbsp;<span class="builtinfunc" id="2206213">len</span><span class="op" id="2206216">(</span><span class="ident" id="2206217">s</span><span class="op" id="2206218">)</span>&nbsp;<span class="op" id="2206220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206224">a</span><span class="op" id="2206225">[</span><span class="ident" id="2206226">i</span><span class="op" id="2206227">]</span>&nbsp;<span class="op" id="2206229">=</span>&nbsp;<span class="ident" id="2206231">s</span><span class="op" id="2206232">[</span><span class="ident" id="2206233">cur</span><span class="op" id="2206236">:</span><span class="op" id="2206237">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2206240">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206243">return</span>&nbsp;<span class="ident" id="2206250">a</span><br>
<span class="lineno"></span><span class="op" id="2206252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2206255">//&nbsp;primeRK&nbsp;is&nbsp;the&nbsp;prime&nbsp;base&nbsp;used&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2206314">const</span>&nbsp;<span class="ident" id="2206320">primeRK</span>&nbsp;<span class="op" id="2206328">=</span>&nbsp;<span class="num" id="2206330">16777619</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2206340">//&nbsp;hashStr&nbsp;returns&nbsp;the&nbsp;hash&nbsp;and&nbsp;the&nbsp;appropriate&nbsp;multiplicative</span><br>
<span class="lineno"></span><span class="comment" id="2206403">//&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2206446">func</span>&nbsp;<span class="ident" id="2206451">hashStr</span><span class="op" id="2206458">(</span><span class="ident" id="2206459">sep</span>&nbsp;<span class="builtintype" id="2206463">string</span><span class="op" id="2206469">)</span>&nbsp;<span class="op" id="2206471">(</span><span class="builtintype" id="2206472">uint32</span><span class="op" id="2206478">,</span>&nbsp;<span class="builtintype" id="2206480">uint32</span><span class="op" id="2206486">)</span>&nbsp;<span class="op" id="2206488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206491">hash</span>&nbsp;<span class="op" id="2206496">:=</span>&nbsp;<span class="builtintype" id="2206499">uint32</span><span class="op" id="2206505">(</span><span class="num" id="2206506">0</span><span class="op" id="2206507">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206510">for</span>&nbsp;<span class="ident" id="2206514">i</span>&nbsp;<span class="op" id="2206516">:=</span>&nbsp;<span class="num" id="2206519">0</span><span class="op" id="2206520">;</span>&nbsp;<span class="ident" id="2206522">i</span>&nbsp;<span class="op" id="2206524">&lt;</span>&nbsp;<span class="builtinfunc" id="2206526">len</span><span class="op" id="2206529">(</span><span class="ident" id="2206530">sep</span><span class="op" id="2206533">)</span><span class="op" id="2206534">;</span>&nbsp;<span class="ident" id="2206536">i</span><span class="op" id="2206537">++</span>&nbsp;<span class="op" id="2206540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206544">hash</span>&nbsp;<span class="op" id="2206549">=</span>&nbsp;<span class="ident" id="2206551">hash</span><span class="op" id="2206555">*</span><span class="ident" id="2206556">primeRK</span>&nbsp;<span class="op" id="2206564">+</span>&nbsp;<span class="builtintype" id="2206566">uint32</span><span class="op" id="2206572">(</span><span class="ident" id="2206573">sep</span><span class="op" id="2206576">[</span><span class="ident" id="2206577">i</span><span class="op" id="2206578">]</span><span class="op" id="2206579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2206582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206585">var</span>&nbsp;<span class="ident" id="2206589">pow</span><span class="op" id="2206592">,</span>&nbsp;<span class="ident" id="2206594">sq</span>&nbsp;<span class="builtintype" id="2206597">uint32</span>&nbsp;<span class="op" id="2206604">=</span>&nbsp;<span class="num" id="2206606">1</span><span class="op" id="2206607">,</span>&nbsp;<span class="ident" id="2206609">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206618">for</span>&nbsp;<span class="ident" id="2206622">i</span>&nbsp;<span class="op" id="2206624">:=</span>&nbsp;<span class="builtinfunc" id="2206627">len</span><span class="op" id="2206630">(</span><span class="ident" id="2206631">sep</span><span class="op" id="2206634">)</span><span class="op" id="2206635">;</span>&nbsp;<span class="ident" id="2206637">i</span>&nbsp;<span class="op" id="2206639">&gt;</span>&nbsp;<span class="num" id="2206641">0</span><span class="op" id="2206642">;</span>&nbsp;<span class="ident" id="2206644">i</span>&nbsp;<span class="op" id="2206646">&gt;&gt;=</span>&nbsp;<span class="num" id="2206650">1</span>&nbsp;<span class="op" id="2206652">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206656">if</span>&nbsp;<span class="ident" id="2206659">i</span><span class="op" id="2206660">&amp;</span><span class="num" id="2206661">1</span>&nbsp;<span class="op" id="2206663">!=</span>&nbsp;<span class="num" id="2206666">0</span>&nbsp;<span class="op" id="2206668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206673">pow</span>&nbsp;<span class="op" id="2206677">*=</span>&nbsp;<span class="ident" id="2206680">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2206685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206689">sq</span>&nbsp;<span class="op" id="2206692">*=</span>&nbsp;<span class="ident" id="2206695">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2206699">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206702">return</span>&nbsp;<span class="ident" id="2206709">hash</span><span class="op" id="2206713">,</span>&nbsp;<span class="ident" id="2206715">pow</span><br>
<span class="lineno"></span><span class="op" id="2206719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2206722">//&nbsp;hashStrRev&nbsp;returns&nbsp;the&nbsp;hash&nbsp;of&nbsp;the&nbsp;reverse&nbsp;of&nbsp;sep&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2206783">//&nbsp;appropriate&nbsp;multiplicative&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno">65</span><span class="keyword" id="2206853">func</span>&nbsp;<span class="ident" id="2206858">hashStrRev</span><span class="op" id="2206868">(</span><span class="ident" id="2206869">sep</span>&nbsp;<span class="builtintype" id="2206873">string</span><span class="op" id="2206879">)</span>&nbsp;<span class="op" id="2206881">(</span><span class="builtintype" id="2206882">uint32</span><span class="op" id="2206888">,</span>&nbsp;<span class="builtintype" id="2206890">uint32</span><span class="op" id="2206896">)</span>&nbsp;<span class="op" id="2206898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206901">hash</span>&nbsp;<span class="op" id="2206906">:=</span>&nbsp;<span class="builtintype" id="2206909">uint32</span><span class="op" id="2206915">(</span><span class="num" id="2206916">0</span><span class="op" id="2206917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206920">for</span>&nbsp;<span class="ident" id="2206924">i</span>&nbsp;<span class="op" id="2206926">:=</span>&nbsp;<span class="builtinfunc" id="2206929">len</span><span class="op" id="2206932">(</span><span class="ident" id="2206933">sep</span><span class="op" id="2206936">)</span>&nbsp;<span class="op" id="2206938">-</span>&nbsp;<span class="num" id="2206940">1</span><span class="op" id="2206941">;</span>&nbsp;<span class="ident" id="2206943">i</span>&nbsp;<span class="op" id="2206945">&gt;=</span>&nbsp;<span class="num" id="2206948">0</span><span class="op" id="2206949">;</span>&nbsp;<span class="ident" id="2206951">i</span><span class="op" id="2206952">--</span>&nbsp;<span class="op" id="2206955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206959">hash</span>&nbsp;<span class="op" id="2206964">=</span>&nbsp;<span class="ident" id="2206966">hash</span><span class="op" id="2206970">*</span><span class="ident" id="2206971">primeRK</span>&nbsp;<span class="op" id="2206979">+</span>&nbsp;<span class="builtintype" id="2206981">uint32</span><span class="op" id="2206987">(</span><span class="ident" id="2206988">sep</span><span class="op" id="2206991">[</span><span class="ident" id="2206992">i</span><span class="op" id="2206993">]</span><span class="op" id="2206994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2206997">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207000">var</span>&nbsp;<span class="ident" id="2207004">pow</span><span class="op" id="2207007">,</span>&nbsp;<span class="ident" id="2207009">sq</span>&nbsp;<span class="builtintype" id="2207012">uint32</span>&nbsp;<span class="op" id="2207019">=</span>&nbsp;<span class="num" id="2207021">1</span><span class="op" id="2207022">,</span>&nbsp;<span class="ident" id="2207024">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207033">for</span>&nbsp;<span class="ident" id="2207037">i</span>&nbsp;<span class="op" id="2207039">:=</span>&nbsp;<span class="builtinfunc" id="2207042">len</span><span class="op" id="2207045">(</span><span class="ident" id="2207046">sep</span><span class="op" id="2207049">)</span><span class="op" id="2207050">;</span>&nbsp;<span class="ident" id="2207052">i</span>&nbsp;<span class="op" id="2207054">&gt;</span>&nbsp;<span class="num" id="2207056">0</span><span class="op" id="2207057">;</span>&nbsp;<span class="ident" id="2207059">i</span>&nbsp;<span class="op" id="2207061">&gt;&gt;=</span>&nbsp;<span class="num" id="2207065">1</span>&nbsp;<span class="op" id="2207067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207071">if</span>&nbsp;<span class="ident" id="2207074">i</span><span class="op" id="2207075">&amp;</span><span class="num" id="2207076">1</span>&nbsp;<span class="op" id="2207078">!=</span>&nbsp;<span class="num" id="2207081">0</span>&nbsp;<span class="op" id="2207083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207088">pow</span>&nbsp;<span class="op" id="2207092">*=</span>&nbsp;<span class="ident" id="2207095">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207100">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207104">sq</span>&nbsp;<span class="op" id="2207107">*=</span>&nbsp;<span class="ident" id="2207110">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207117">return</span>&nbsp;<span class="ident" id="2207124">hash</span><span class="op" id="2207128">,</span>&nbsp;<span class="ident" id="2207130">pow</span><br>
<span class="lineno"></span><span class="op" id="2207134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2207137">//&nbsp;Count&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;sep&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2207206">func</span>&nbsp;<span class="ident" id="2207211">Count</span><span class="op" id="2207216">(</span><span class="ident" id="2207217">s</span><span class="op" id="2207218">,</span>&nbsp;<span class="ident" id="2207220">sep</span>&nbsp;<span class="builtintype" id="2207224">string</span><span class="op" id="2207230">)</span>&nbsp;<span class="builtintype" id="2207232">int</span>&nbsp;<span class="op" id="2207236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207239">n</span>&nbsp;<span class="op" id="2207241">:=</span>&nbsp;<span class="num" id="2207244">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2207247">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207265">switch</span>&nbsp;<span class="op" id="2207272">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207275">case</span>&nbsp;<span class="builtinfunc" id="2207280">len</span><span class="op" id="2207283">(</span><span class="ident" id="2207284">sep</span><span class="op" id="2207287">)</span>&nbsp;<span class="op" id="2207289">==</span>&nbsp;<span class="num" id="2207292">0</span><span class="op" id="2207293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207297">return</span>&nbsp;<span class="ident" id="2207304">utf8</span><span class="op" id="2207308">.</span><span class="ident" id="2207309">RuneCountInString</span><span class="op" id="2207326">(</span><span class="ident" id="2207327">s</span><span class="op" id="2207328">)</span>&nbsp;<span class="op" id="2207330">+</span>&nbsp;<span class="num" id="2207332">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207335">case</span>&nbsp;<span class="builtinfunc" id="2207340">len</span><span class="op" id="2207343">(</span><span class="ident" id="2207344">sep</span><span class="op" id="2207347">)</span>&nbsp;<span class="op" id="2207349">==</span>&nbsp;<span class="num" id="2207352">1</span><span class="op" id="2207353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2207357">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207393">c</span>&nbsp;<span class="op" id="2207395">:=</span>&nbsp;<span class="ident" id="2207398">sep</span><span class="op" id="2207401">[</span><span class="num" id="2207402">0</span><span class="op" id="2207403">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207407">for</span>&nbsp;<span class="ident" id="2207411">i</span>&nbsp;<span class="op" id="2207413">:=</span>&nbsp;<span class="num" id="2207416">0</span><span class="op" id="2207417">;</span>&nbsp;<span class="ident" id="2207419">i</span>&nbsp;<span class="op" id="2207421">&lt;</span>&nbsp;<span class="builtinfunc" id="2207423">len</span><span class="op" id="2207426">(</span><span class="ident" id="2207427">s</span><span class="op" id="2207428">)</span><span class="op" id="2207429">;</span>&nbsp;<span class="ident" id="2207431">i</span><span class="op" id="2207432">++</span>&nbsp;<span class="op" id="2207435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207440">if</span>&nbsp;<span class="ident" id="2207443">s</span><span class="op" id="2207444">[</span><span class="ident" id="2207445">i</span><span class="op" id="2207446">]</span>&nbsp;<span class="op" id="2207448">==</span>&nbsp;<span class="ident" id="2207451">c</span>&nbsp;<span class="op" id="2207453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207459">n</span><span class="op" id="2207460">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207470">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207474">return</span>&nbsp;<span class="ident" id="2207481">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207484">case</span>&nbsp;<span class="builtinfunc" id="2207489">len</span><span class="op" id="2207492">(</span><span class="ident" id="2207493">sep</span><span class="op" id="2207496">)</span>&nbsp;<span class="op" id="2207498">&gt;</span>&nbsp;<span class="builtinfunc" id="2207500">len</span><span class="op" id="2207503">(</span><span class="ident" id="2207504">s</span><span class="op" id="2207505">)</span><span class="op" id="2207506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207510">return</span>&nbsp;<span class="num" id="2207517">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207520">case</span>&nbsp;<span class="builtinfunc" id="2207525">len</span><span class="op" id="2207528">(</span><span class="ident" id="2207529">sep</span><span class="op" id="2207532">)</span>&nbsp;<span class="op" id="2207534">==</span>&nbsp;<span class="builtinfunc" id="2207537">len</span><span class="op" id="2207540">(</span><span class="ident" id="2207541">s</span><span class="op" id="2207542">)</span><span class="op" id="2207543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207547">if</span>&nbsp;<span class="ident" id="2207550">sep</span>&nbsp;<span class="op" id="2207554">==</span>&nbsp;<span class="ident" id="2207557">s</span>&nbsp;<span class="op" id="2207559">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207564">return</span>&nbsp;<span class="num" id="2207571">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207579">return</span>&nbsp;<span class="num" id="2207586">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2207592">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207614">hashsep</span><span class="op" id="2207621">,</span>&nbsp;<span class="ident" id="2207623">pow</span>&nbsp;<span class="op" id="2207627">:=</span>&nbsp;<span class="ident" id="2207630">hashStr</span><span class="op" id="2207637">(</span><span class="ident" id="2207638">sep</span><span class="op" id="2207641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207644">h</span>&nbsp;<span class="op" id="2207646">:=</span>&nbsp;<span class="builtintype" id="2207649">uint32</span><span class="op" id="2207655">(</span><span class="num" id="2207656">0</span><span class="op" id="2207657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207660">for</span>&nbsp;<span class="ident" id="2207664">i</span>&nbsp;<span class="op" id="2207666">:=</span>&nbsp;<span class="num" id="2207669">0</span><span class="op" id="2207670">;</span>&nbsp;<span class="ident" id="2207672">i</span>&nbsp;<span class="op" id="2207674">&lt;</span>&nbsp;<span class="builtinfunc" id="2207676">len</span><span class="op" id="2207679">(</span><span class="ident" id="2207680">sep</span><span class="op" id="2207683">)</span><span class="op" id="2207684">;</span>&nbsp;<span class="ident" id="2207686">i</span><span class="op" id="2207687">++</span>&nbsp;<span class="op" id="2207690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207694">h</span>&nbsp;<span class="op" id="2207696">=</span>&nbsp;<span class="ident" id="2207698">h</span><span class="op" id="2207699">*</span><span class="ident" id="2207700">primeRK</span>&nbsp;<span class="op" id="2207708">+</span>&nbsp;<span class="builtintype" id="2207710">uint32</span><span class="op" id="2207716">(</span><span class="ident" id="2207717">s</span><span class="op" id="2207718">[</span><span class="ident" id="2207719">i</span><span class="op" id="2207720">]</span><span class="op" id="2207721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207724">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207727">lastmatch</span>&nbsp;<span class="op" id="2207737">:=</span>&nbsp;<span class="num" id="2207740">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207743">if</span>&nbsp;<span class="ident" id="2207746">h</span>&nbsp;<span class="op" id="2207748">==</span>&nbsp;<span class="ident" id="2207751">hashsep</span>&nbsp;<span class="op" id="2207759">&amp;&amp;</span>&nbsp;<span class="ident" id="2207762">s</span><span class="op" id="2207763">[</span><span class="op" id="2207764">:</span><span class="builtinfunc" id="2207765">len</span><span class="op" id="2207768">(</span><span class="ident" id="2207769">sep</span><span class="op" id="2207772">)</span><span class="op" id="2207773">]</span>&nbsp;<span class="op" id="2207775">==</span>&nbsp;<span class="ident" id="2207778">sep</span>&nbsp;<span class="op" id="2207782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207786">n</span><span class="op" id="2207787">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207792">lastmatch</span>&nbsp;<span class="op" id="2207802">=</span>&nbsp;<span class="builtinfunc" id="2207804">len</span><span class="op" id="2207807">(</span><span class="ident" id="2207808">sep</span><span class="op" id="2207811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207814">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207817">for</span>&nbsp;<span class="ident" id="2207821">i</span>&nbsp;<span class="op" id="2207823">:=</span>&nbsp;<span class="builtinfunc" id="2207826">len</span><span class="op" id="2207829">(</span><span class="ident" id="2207830">sep</span><span class="op" id="2207833">)</span><span class="op" id="2207834">;</span>&nbsp;<span class="ident" id="2207836">i</span>&nbsp;<span class="op" id="2207838">&lt;</span>&nbsp;<span class="builtinfunc" id="2207840">len</span><span class="op" id="2207843">(</span><span class="ident" id="2207844">s</span><span class="op" id="2207845">)</span><span class="op" id="2207846">;</span>&nbsp;<span class="op" id="2207848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207852">h</span>&nbsp;<span class="op" id="2207854">*=</span>&nbsp;<span class="ident" id="2207857">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207867">h</span>&nbsp;<span class="op" id="2207869">+=</span>&nbsp;<span class="builtintype" id="2207872">uint32</span><span class="op" id="2207878">(</span><span class="ident" id="2207879">s</span><span class="op" id="2207880">[</span><span class="ident" id="2207881">i</span><span class="op" id="2207882">]</span><span class="op" id="2207883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207887">h</span>&nbsp;<span class="op" id="2207889">-=</span>&nbsp;<span class="ident" id="2207892">pow</span>&nbsp;<span class="op" id="2207896">*</span>&nbsp;<span class="builtintype" id="2207898">uint32</span><span class="op" id="2207904">(</span><span class="ident" id="2207905">s</span><span class="op" id="2207906">[</span><span class="ident" id="2207907">i</span><span class="op" id="2207908">-</span><span class="builtinfunc" id="2207909">len</span><span class="op" id="2207912">(</span><span class="ident" id="2207913">sep</span><span class="op" id="2207916">)</span><span class="op" id="2207917">]</span><span class="op" id="2207918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207922">i</span><span class="op" id="2207923">++</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207928">if</span>&nbsp;<span class="ident" id="2207931">h</span>&nbsp;<span class="op" id="2207933">==</span>&nbsp;<span class="ident" id="2207936">hashsep</span>&nbsp;<span class="op" id="2207944">&amp;&amp;</span>&nbsp;<span class="ident" id="2207947">lastmatch</span>&nbsp;<span class="op" id="2207957">&lt;=</span>&nbsp;<span class="ident" id="2207960">i</span><span class="op" id="2207961">-</span><span class="builtinfunc" id="2207962">len</span><span class="op" id="2207965">(</span><span class="ident" id="2207966">sep</span><span class="op" id="2207969">)</span>&nbsp;<span class="op" id="2207971">&amp;&amp;</span>&nbsp;<span class="ident" id="2207974">s</span><span class="op" id="2207975">[</span><span class="ident" id="2207976">i</span><span class="op" id="2207977">-</span><span class="builtinfunc" id="2207978">len</span><span class="op" id="2207981">(</span><span class="ident" id="2207982">sep</span><span class="op" id="2207985">)</span><span class="op" id="2207986">:</span><span class="ident" id="2207987">i</span><span class="op" id="2207988">]</span>&nbsp;<span class="op" id="2207990">==</span>&nbsp;<span class="ident" id="2207993">sep</span>&nbsp;<span class="op" id="2207997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208002">n</span><span class="op" id="2208003">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208009">lastmatch</span>&nbsp;<span class="op" id="2208019">=</span>&nbsp;<span class="ident" id="2208021">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2208025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2208028">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208031">return</span>&nbsp;<span class="ident" id="2208038">n</span><br>
<span class="lineno"></span><span class="op" id="2208040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2208043">//&nbsp;Contains&nbsp;returns&nbsp;true&nbsp;if&nbsp;substr&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2208091">func</span>&nbsp;<span class="ident" id="2208096">Contains</span><span class="op" id="2208104">(</span><span class="ident" id="2208105">s</span><span class="op" id="2208106">,</span>&nbsp;<span class="ident" id="2208108">substr</span>&nbsp;<span class="builtintype" id="2208115">string</span><span class="op" id="2208121">)</span>&nbsp;<span class="builtintype" id="2208123">bool</span>&nbsp;<span class="op" id="2208128">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208131">return</span>&nbsp;<span class="ident" id="2208138">Index</span><span class="op" id="2208143">(</span><span class="ident" id="2208144">s</span><span class="op" id="2208145">,</span>&nbsp;<span class="ident" id="2208147">substr</span><span class="op" id="2208153">)</span>&nbsp;<span class="op" id="2208155">&gt;=</span>&nbsp;<span class="num" id="2208158">0</span><br>
<span class="lineno"></span><span class="op" id="2208160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2208163">//&nbsp;ContainsAny&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;in&nbsp;chars&nbsp;are&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2208241">func</span>&nbsp;<span class="ident" id="2208246">ContainsAny</span><span class="op" id="2208257">(</span><span class="ident" id="2208258">s</span><span class="op" id="2208259">,</span>&nbsp;<span class="ident" id="2208261">chars</span>&nbsp;<span class="builtintype" id="2208267">string</span><span class="op" id="2208273">)</span>&nbsp;<span class="builtintype" id="2208275">bool</span>&nbsp;<span class="op" id="2208280">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208283">return</span>&nbsp;<span class="ident" id="2208290">IndexAny</span><span class="op" id="2208298">(</span><span class="ident" id="2208299">s</span><span class="op" id="2208300">,</span>&nbsp;<span class="ident" id="2208302">chars</span><span class="op" id="2208307">)</span>&nbsp;<span class="op" id="2208309">&gt;=</span>&nbsp;<span class="num" id="2208312">0</span><br>
<span class="lineno"></span><span class="op" id="2208314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2208317">//&nbsp;ContainsRune&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2208387">func</span>&nbsp;<span class="ident" id="2208392">ContainsRune</span><span class="op" id="2208404">(</span><span class="ident" id="2208405">s</span>&nbsp;<span class="builtintype" id="2208407">string</span><span class="op" id="2208413">,</span>&nbsp;<span class="ident" id="2208415">r</span>&nbsp;<span class="builtintype" id="2208417">rune</span><span class="op" id="2208421">)</span>&nbsp;<span class="builtintype" id="2208423">bool</span>&nbsp;<span class="op" id="2208428">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208431">return</span>&nbsp;<span class="ident" id="2208438">IndexRune</span><span class="op" id="2208447">(</span><span class="ident" id="2208448">s</span><span class="op" id="2208449">,</span>&nbsp;<span class="ident" id="2208451">r</span><span class="op" id="2208452">)</span>&nbsp;<span class="op" id="2208454">&gt;=</span>&nbsp;<span class="num" id="2208457">0</span><br>
<span class="lineno"></span><span class="op" id="2208459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2208462">//&nbsp;Index&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2208558">func</span>&nbsp;<span class="ident" id="2208563">Index</span><span class="op" id="2208568">(</span><span class="ident" id="2208569">s</span><span class="op" id="2208570">,</span>&nbsp;<span class="ident" id="2208572">sep</span>&nbsp;<span class="builtintype" id="2208576">string</span><span class="op" id="2208582">)</span>&nbsp;<span class="builtintype" id="2208584">int</span>&nbsp;<span class="op" id="2208588">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208591">n</span>&nbsp;<span class="op" id="2208593">:=</span>&nbsp;<span class="builtinfunc" id="2208596">len</span><span class="op" id="2208599">(</span><span class="ident" id="2208600">sep</span><span class="op" id="2208603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208606">switch</span>&nbsp;<span class="op" id="2208613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208616">case</span>&nbsp;<span class="ident" id="2208621">n</span>&nbsp;<span class="op" id="2208623">==</span>&nbsp;<span class="num" id="2208626">0</span><span class="op" id="2208627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208631">return</span>&nbsp;<span class="num" id="2208638">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208641">case</span>&nbsp;<span class="ident" id="2208646">n</span>&nbsp;<span class="op" id="2208648">==</span>&nbsp;<span class="num" id="2208651">1</span><span class="op" id="2208652">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208656">return</span>&nbsp;<span class="ident" id="2208663">IndexByte</span><span class="op" id="2208672">(</span><span class="ident" id="2208673">s</span><span class="op" id="2208674">,</span>&nbsp;<span class="ident" id="2208676">sep</span><span class="op" id="2208679">[</span><span class="num" id="2208680">0</span><span class="op" id="2208681">]</span><span class="op" id="2208682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208685">case</span>&nbsp;<span class="ident" id="2208690">n</span>&nbsp;<span class="op" id="2208692">==</span>&nbsp;<span class="builtinfunc" id="2208695">len</span><span class="op" id="2208698">(</span><span class="ident" id="2208699">s</span><span class="op" id="2208700">)</span><span class="op" id="2208701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208705">if</span>&nbsp;<span class="ident" id="2208708">sep</span>&nbsp;<span class="op" id="2208712">==</span>&nbsp;<span class="ident" id="2208715">s</span>&nbsp;<span class="op" id="2208717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208722">return</span>&nbsp;<span class="num" id="2208729">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2208733">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208737">return</span>&nbsp;<span class="op" id="2208744">-</span><span class="num" id="2208745">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208748">case</span>&nbsp;<span class="ident" id="2208753">n</span>&nbsp;<span class="op" id="2208755">&gt;</span>&nbsp;<span class="builtinfunc" id="2208757">len</span><span class="op" id="2208760">(</span><span class="ident" id="2208761">s</span><span class="op" id="2208762">)</span><span class="op" id="2208763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208767">return</span>&nbsp;<span class="op" id="2208774">-</span><span class="num" id="2208775">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2208778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2208781">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208803">hashsep</span><span class="op" id="2208810">,</span>&nbsp;<span class="ident" id="2208812">pow</span>&nbsp;<span class="op" id="2208816">:=</span>&nbsp;<span class="ident" id="2208819">hashStr</span><span class="op" id="2208826">(</span><span class="ident" id="2208827">sep</span><span class="op" id="2208830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208833">var</span>&nbsp;<span class="ident" id="2208837">h</span>&nbsp;<span class="builtintype" id="2208839">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208847">for</span>&nbsp;<span class="ident" id="2208851">i</span>&nbsp;<span class="op" id="2208853">:=</span>&nbsp;<span class="num" id="2208856">0</span><span class="op" id="2208857">;</span>&nbsp;<span class="ident" id="2208859">i</span>&nbsp;<span class="op" id="2208861">&lt;</span>&nbsp;<span class="ident" id="2208863">n</span><span class="op" id="2208864">;</span>&nbsp;<span class="ident" id="2208866">i</span><span class="op" id="2208867">++</span>&nbsp;<span class="op" id="2208870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208874">h</span>&nbsp;<span class="op" id="2208876">=</span>&nbsp;<span class="ident" id="2208878">h</span><span class="op" id="2208879">*</span><span class="ident" id="2208880">primeRK</span>&nbsp;<span class="op" id="2208888">+</span>&nbsp;<span class="builtintype" id="2208890">uint32</span><span class="op" id="2208896">(</span><span class="ident" id="2208897">s</span><span class="op" id="2208898">[</span><span class="ident" id="2208899">i</span><span class="op" id="2208900">]</span><span class="op" id="2208901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2208904">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208907">if</span>&nbsp;<span class="ident" id="2208910">h</span>&nbsp;<span class="op" id="2208912">==</span>&nbsp;<span class="ident" id="2208915">hashsep</span>&nbsp;<span class="op" id="2208923">&amp;&amp;</span>&nbsp;<span class="ident" id="2208926">s</span><span class="op" id="2208927">[</span><span class="op" id="2208928">:</span><span class="ident" id="2208929">n</span><span class="op" id="2208930">]</span>&nbsp;<span class="op" id="2208932">==</span>&nbsp;<span class="ident" id="2208935">sep</span>&nbsp;<span class="op" id="2208939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208943">return</span>&nbsp;<span class="num" id="2208950">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2208953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208956">for</span>&nbsp;<span class="ident" id="2208960">i</span>&nbsp;<span class="op" id="2208962">:=</span>&nbsp;<span class="ident" id="2208965">n</span><span class="op" id="2208966">;</span>&nbsp;<span class="ident" id="2208968">i</span>&nbsp;<span class="op" id="2208970">&lt;</span>&nbsp;<span class="builtinfunc" id="2208972">len</span><span class="op" id="2208975">(</span><span class="ident" id="2208976">s</span><span class="op" id="2208977">)</span><span class="op" id="2208978">;</span>&nbsp;<span class="op" id="2208980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208984">h</span>&nbsp;<span class="op" id="2208986">*=</span>&nbsp;<span class="ident" id="2208989">primeRK</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208999">h</span>&nbsp;<span class="op" id="2209001">+=</span>&nbsp;<span class="builtintype" id="2209004">uint32</span><span class="op" id="2209010">(</span><span class="ident" id="2209011">s</span><span class="op" id="2209012">[</span><span class="ident" id="2209013">i</span><span class="op" id="2209014">]</span><span class="op" id="2209015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209019">h</span>&nbsp;<span class="op" id="2209021">-=</span>&nbsp;<span class="ident" id="2209024">pow</span>&nbsp;<span class="op" id="2209028">*</span>&nbsp;<span class="builtintype" id="2209030">uint32</span><span class="op" id="2209036">(</span><span class="ident" id="2209037">s</span><span class="op" id="2209038">[</span><span class="ident" id="2209039">i</span><span class="op" id="2209040">-</span><span class="ident" id="2209041">n</span><span class="op" id="2209042">]</span><span class="op" id="2209043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209047">i</span><span class="op" id="2209048">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209053">if</span>&nbsp;<span class="ident" id="2209056">h</span>&nbsp;<span class="op" id="2209058">==</span>&nbsp;<span class="ident" id="2209061">hashsep</span>&nbsp;<span class="op" id="2209069">&amp;&amp;</span>&nbsp;<span class="ident" id="2209072">s</span><span class="op" id="2209073">[</span><span class="ident" id="2209074">i</span><span class="op" id="2209075">-</span><span class="ident" id="2209076">n</span><span class="op" id="2209077">:</span><span class="ident" id="2209078">i</span><span class="op" id="2209079">]</span>&nbsp;<span class="op" id="2209081">==</span>&nbsp;<span class="ident" id="2209084">sep</span>&nbsp;<span class="op" id="2209088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209093">return</span>&nbsp;<span class="ident" id="2209100">i</span>&nbsp;<span class="op" id="2209102">-</span>&nbsp;<span class="ident" id="2209104">n</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209114">return</span>&nbsp;<span class="op" id="2209121">-</span><span class="num" id="2209122">1</span><br>
<span class="lineno"></span><span class="op" id="2209124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="2209127">//&nbsp;LastIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2209226">func</span>&nbsp;<span class="ident" id="2209231">LastIndex</span><span class="op" id="2209240">(</span><span class="ident" id="2209241">s</span><span class="op" id="2209242">,</span>&nbsp;<span class="ident" id="2209244">sep</span>&nbsp;<span class="builtintype" id="2209248">string</span><span class="op" id="2209254">)</span>&nbsp;<span class="builtintype" id="2209256">int</span>&nbsp;<span class="op" id="2209260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209263">n</span>&nbsp;<span class="op" id="2209265">:=</span>&nbsp;<span class="builtinfunc" id="2209268">len</span><span class="op" id="2209271">(</span><span class="ident" id="2209272">sep</span><span class="op" id="2209275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209278">switch</span>&nbsp;<span class="op" id="2209285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209288">case</span>&nbsp;<span class="ident" id="2209293">n</span>&nbsp;<span class="op" id="2209295">==</span>&nbsp;<span class="num" id="2209298">0</span><span class="op" id="2209299">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209303">return</span>&nbsp;<span class="builtinfunc" id="2209310">len</span><span class="op" id="2209313">(</span><span class="ident" id="2209314">s</span><span class="op" id="2209315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209318">case</span>&nbsp;<span class="ident" id="2209323">n</span>&nbsp;<span class="op" id="2209325">==</span>&nbsp;<span class="num" id="2209328">1</span><span class="op" id="2209329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2209333">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209369">c</span>&nbsp;<span class="op" id="2209371">:=</span>&nbsp;<span class="ident" id="2209374">sep</span><span class="op" id="2209377">[</span><span class="num" id="2209378">0</span><span class="op" id="2209379">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209383">for</span>&nbsp;<span class="ident" id="2209387">i</span>&nbsp;<span class="op" id="2209389">:=</span>&nbsp;<span class="builtinfunc" id="2209392">len</span><span class="op" id="2209395">(</span><span class="ident" id="2209396">s</span><span class="op" id="2209397">)</span>&nbsp;<span class="op" id="2209399">-</span>&nbsp;<span class="num" id="2209401">1</span><span class="op" id="2209402">;</span>&nbsp;<span class="ident" id="2209404">i</span>&nbsp;<span class="op" id="2209406">&gt;=</span>&nbsp;<span class="num" id="2209409">0</span><span class="op" id="2209410">;</span>&nbsp;<span class="ident" id="2209412">i</span><span class="op" id="2209413">--</span>&nbsp;<span class="op" id="2209416">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209421">if</span>&nbsp;<span class="ident" id="2209424">s</span><span class="op" id="2209425">[</span><span class="ident" id="2209426">i</span><span class="op" id="2209427">]</span>&nbsp;<span class="op" id="2209429">==</span>&nbsp;<span class="ident" id="2209432">c</span>&nbsp;<span class="op" id="2209434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209440">return</span>&nbsp;<span class="ident" id="2209447">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209460">return</span>&nbsp;<span class="op" id="2209467">-</span><span class="num" id="2209468">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209471">case</span>&nbsp;<span class="ident" id="2209476">n</span>&nbsp;<span class="op" id="2209478">==</span>&nbsp;<span class="builtinfunc" id="2209481">len</span><span class="op" id="2209484">(</span><span class="ident" id="2209485">s</span><span class="op" id="2209486">)</span><span class="op" id="2209487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209491">if</span>&nbsp;<span class="ident" id="2209494">sep</span>&nbsp;<span class="op" id="2209498">==</span>&nbsp;<span class="ident" id="2209501">s</span>&nbsp;<span class="op" id="2209503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209508">return</span>&nbsp;<span class="num" id="2209515">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209523">return</span>&nbsp;<span class="op" id="2209530">-</span><span class="num" id="2209531">1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209534">case</span>&nbsp;<span class="ident" id="2209539">n</span>&nbsp;<span class="op" id="2209541">&gt;</span>&nbsp;<span class="builtinfunc" id="2209543">len</span><span class="op" id="2209546">(</span><span class="ident" id="2209547">s</span><span class="op" id="2209548">)</span><span class="op" id="2209549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209553">return</span>&nbsp;<span class="op" id="2209560">-</span><span class="num" id="2209561">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2209567">//&nbsp;Rabin-Karp&nbsp;search&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209616">hashsep</span><span class="op" id="2209623">,</span>&nbsp;<span class="ident" id="2209625">pow</span>&nbsp;<span class="op" id="2209629">:=</span>&nbsp;<span class="ident" id="2209632">hashStrRev</span><span class="op" id="2209642">(</span><span class="ident" id="2209643">sep</span><span class="op" id="2209646">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209649">last</span>&nbsp;<span class="op" id="2209654">:=</span>&nbsp;<span class="builtinfunc" id="2209657">len</span><span class="op" id="2209660">(</span><span class="ident" id="2209661">s</span><span class="op" id="2209662">)</span>&nbsp;<span class="op" id="2209664">-</span>&nbsp;<span class="ident" id="2209666">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209669">var</span>&nbsp;<span class="ident" id="2209673">h</span>&nbsp;<span class="builtintype" id="2209675">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209683">for</span>&nbsp;<span class="ident" id="2209687">i</span>&nbsp;<span class="op" id="2209689">:=</span>&nbsp;<span class="builtinfunc" id="2209692">len</span><span class="op" id="2209695">(</span><span class="ident" id="2209696">s</span><span class="op" id="2209697">)</span>&nbsp;<span class="op" id="2209699">-</span>&nbsp;<span class="num" id="2209701">1</span><span class="op" id="2209702">;</span>&nbsp;<span class="ident" id="2209704">i</span>&nbsp;<span class="op" id="2209706">&gt;=</span>&nbsp;<span class="ident" id="2209709">last</span><span class="op" id="2209713">;</span>&nbsp;<span class="ident" id="2209715">i</span><span class="op" id="2209716">--</span>&nbsp;<span class="op" id="2209719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209723">h</span>&nbsp;<span class="op" id="2209725">=</span>&nbsp;<span class="ident" id="2209727">h</span><span class="op" id="2209728">*</span><span class="ident" id="2209729">primeRK</span>&nbsp;<span class="op" id="2209737">+</span>&nbsp;<span class="builtintype" id="2209739">uint32</span><span class="op" id="2209745">(</span><span class="ident" id="2209746">s</span><span class="op" id="2209747">[</span><span class="ident" id="2209748">i</span><span class="op" id="2209749">]</span><span class="op" id="2209750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209753">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209756">if</span>&nbsp;<span class="ident" id="2209759">h</span>&nbsp;<span class="op" id="2209761">==</span>&nbsp;<span class="ident" id="2209764">hashsep</span>&nbsp;<span class="op" id="2209772">&amp;&amp;</span>&nbsp;<span class="ident" id="2209775">s</span><span class="op" id="2209776">[</span><span class="ident" id="2209777">last</span><span class="op" id="2209781">:</span><span class="op" id="2209782">]</span>&nbsp;<span class="op" id="2209784">==</span>&nbsp;<span class="ident" id="2209787">sep</span>&nbsp;<span class="op" id="2209791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209795">return</span>&nbsp;<span class="ident" id="2209802">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209811">for</span>&nbsp;<span class="ident" id="2209815">i</span>&nbsp;<span class="op" id="2209817">:=</span>&nbsp;<span class="ident" id="2209820">last</span>&nbsp;<span class="op" id="2209825">-</span>&nbsp;<span class="num" id="2209827">1</span><span class="op" id="2209828">;</span>&nbsp;<span class="ident" id="2209830">i</span>&nbsp;<span class="op" id="2209832">&gt;=</span>&nbsp;<span class="num" id="2209835">0</span><span class="op" id="2209836">;</span>&nbsp;<span class="ident" id="2209838">i</span><span class="op" id="2209839">--</span>&nbsp;<span class="op" id="2209842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209846">h</span>&nbsp;<span class="op" id="2209848">*=</span>&nbsp;<span class="ident" id="2209851">primeRK</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209861">h</span>&nbsp;<span class="op" id="2209863">+=</span>&nbsp;<span class="builtintype" id="2209866">uint32</span><span class="op" id="2209872">(</span><span class="ident" id="2209873">s</span><span class="op" id="2209874">[</span><span class="ident" id="2209875">i</span><span class="op" id="2209876">]</span><span class="op" id="2209877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209881">h</span>&nbsp;<span class="op" id="2209883">-=</span>&nbsp;<span class="ident" id="2209886">pow</span>&nbsp;<span class="op" id="2209890">*</span>&nbsp;<span class="builtintype" id="2209892">uint32</span><span class="op" id="2209898">(</span><span class="ident" id="2209899">s</span><span class="op" id="2209900">[</span><span class="ident" id="2209901">i</span><span class="op" id="2209902">+</span><span class="ident" id="2209903">n</span><span class="op" id="2209904">]</span><span class="op" id="2209905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209909">if</span>&nbsp;<span class="ident" id="2209912">h</span>&nbsp;<span class="op" id="2209914">==</span>&nbsp;<span class="ident" id="2209917">hashsep</span>&nbsp;<span class="op" id="2209925">&amp;&amp;</span>&nbsp;<span class="ident" id="2209928">s</span><span class="op" id="2209929">[</span><span class="ident" id="2209930">i</span><span class="op" id="2209931">:</span><span class="ident" id="2209932">i</span><span class="op" id="2209933">+</span><span class="ident" id="2209934">n</span><span class="op" id="2209935">]</span>&nbsp;<span class="op" id="2209937">==</span>&nbsp;<span class="ident" id="2209940">sep</span>&nbsp;<span class="op" id="2209944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209949">return</span>&nbsp;<span class="ident" id="2209956">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209960">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209966">return</span>&nbsp;<span class="op" id="2209973">-</span><span class="num" id="2209974">1</span><br>
<span class="lineno"></span><span class="op" id="2209976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2209979">//&nbsp;IndexRune&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno">225</span><span class="comment" id="2210058">//&nbsp;r,&nbsp;or&nbsp;-1&nbsp;if&nbsp;rune&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2210099">func</span>&nbsp;<span class="ident" id="2210104">IndexRune</span><span class="op" id="2210113">(</span><span class="ident" id="2210114">s</span>&nbsp;<span class="builtintype" id="2210116">string</span><span class="op" id="2210122">,</span>&nbsp;<span class="ident" id="2210124">r</span>&nbsp;<span class="builtintype" id="2210126">rune</span><span class="op" id="2210130">)</span>&nbsp;<span class="builtintype" id="2210132">int</span>&nbsp;<span class="op" id="2210136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210139">switch</span>&nbsp;<span class="op" id="2210146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210149">case</span>&nbsp;<span class="ident" id="2210154">r</span>&nbsp;<span class="op" id="2210156">&lt;</span>&nbsp;<span class="ident" id="2210158">utf8</span><span class="op" id="2210162">.</span><span class="ident" id="2210163">RuneSelf</span><span class="op" id="2210171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210175">return</span>&nbsp;<span class="ident" id="2210182">IndexByte</span><span class="op" id="2210191">(</span><span class="ident" id="2210192">s</span><span class="op" id="2210193">,</span>&nbsp;<span class="builtintype" id="2210195">byte</span><span class="op" id="2210199">(</span><span class="ident" id="2210200">r</span><span class="op" id="2210201">)</span><span class="op" id="2210202">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210205">default</span><span class="op" id="2210212">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210216">for</span>&nbsp;<span class="ident" id="2210220">i</span><span class="op" id="2210221">,</span>&nbsp;<span class="ident" id="2210223">c</span>&nbsp;<span class="op" id="2210225">:=</span>&nbsp;<span class="keyword" id="2210228">range</span>&nbsp;<span class="ident" id="2210234">s</span>&nbsp;<span class="op" id="2210236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210241">if</span>&nbsp;<span class="ident" id="2210244">c</span>&nbsp;<span class="op" id="2210246">==</span>&nbsp;<span class="ident" id="2210249">r</span>&nbsp;<span class="op" id="2210251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210257">return</span>&nbsp;<span class="ident" id="2210264">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210269">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210279">return</span>&nbsp;<span class="op" id="2210286">-</span><span class="num" id="2210287">1</span><br>
<span class="lineno"></span><span class="op" id="2210289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="2210292">//&nbsp;IndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="2210370">//&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2210449">func</span>&nbsp;<span class="ident" id="2210454">IndexAny</span><span class="op" id="2210462">(</span><span class="ident" id="2210463">s</span><span class="op" id="2210464">,</span>&nbsp;<span class="ident" id="2210466">chars</span>&nbsp;<span class="builtintype" id="2210472">string</span><span class="op" id="2210478">)</span>&nbsp;<span class="builtintype" id="2210480">int</span>&nbsp;<span class="op" id="2210484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210487">if</span>&nbsp;<span class="builtinfunc" id="2210490">len</span><span class="op" id="2210493">(</span><span class="ident" id="2210494">chars</span><span class="op" id="2210499">)</span>&nbsp;<span class="op" id="2210501">&gt;</span>&nbsp;<span class="num" id="2210503">0</span>&nbsp;<span class="op" id="2210505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210509">for</span>&nbsp;<span class="ident" id="2210513">i</span><span class="op" id="2210514">,</span>&nbsp;<span class="ident" id="2210516">c</span>&nbsp;<span class="op" id="2210518">:=</span>&nbsp;<span class="keyword" id="2210521">range</span>&nbsp;<span class="ident" id="2210527">s</span>&nbsp;<span class="op" id="2210529">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210534">for</span>&nbsp;<span class="ident" id="2210538">_</span><span class="op" id="2210539">,</span>&nbsp;<span class="ident" id="2210541">m</span>&nbsp;<span class="op" id="2210543">:=</span>&nbsp;<span class="keyword" id="2210546">range</span>&nbsp;<span class="ident" id="2210552">chars</span>&nbsp;<span class="op" id="2210558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210564">if</span>&nbsp;<span class="ident" id="2210567">c</span>&nbsp;<span class="op" id="2210569">==</span>&nbsp;<span class="ident" id="2210572">m</span>&nbsp;<span class="op" id="2210574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210581">return</span>&nbsp;<span class="ident" id="2210588">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210599">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210609">return</span>&nbsp;<span class="op" id="2210616">-</span><span class="num" id="2210617">1</span><br>
<span class="lineno"></span><span class="op" id="2210619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="2210622">//&nbsp;LastIndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="2210697">//&nbsp;point&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2210768">//&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2210785">func</span>&nbsp;<span class="ident" id="2210790">LastIndexAny</span><span class="op" id="2210802">(</span><span class="ident" id="2210803">s</span><span class="op" id="2210804">,</span>&nbsp;<span class="ident" id="2210806">chars</span>&nbsp;<span class="builtintype" id="2210812">string</span><span class="op" id="2210818">)</span>&nbsp;<span class="builtintype" id="2210820">int</span>&nbsp;<span class="op" id="2210824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210827">if</span>&nbsp;<span class="builtinfunc" id="2210830">len</span><span class="op" id="2210833">(</span><span class="ident" id="2210834">chars</span><span class="op" id="2210839">)</span>&nbsp;<span class="op" id="2210841">&gt;</span>&nbsp;<span class="num" id="2210843">0</span>&nbsp;<span class="op" id="2210845">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210849">for</span>&nbsp;<span class="ident" id="2210853">i</span>&nbsp;<span class="op" id="2210855">:=</span>&nbsp;<span class="builtinfunc" id="2210858">len</span><span class="op" id="2210861">(</span><span class="ident" id="2210862">s</span><span class="op" id="2210863">)</span><span class="op" id="2210864">;</span>&nbsp;<span class="ident" id="2210866">i</span>&nbsp;<span class="op" id="2210868">&gt;</span>&nbsp;<span class="num" id="2210870">0</span><span class="op" id="2210871">;</span>&nbsp;<span class="op" id="2210873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2210878">rune</span><span class="op" id="2210882">,</span>&nbsp;<span class="ident" id="2210884">size</span>&nbsp;<span class="op" id="2210889">:=</span>&nbsp;<span class="ident" id="2210892">utf8</span><span class="op" id="2210896">.</span><span class="ident" id="2210897">DecodeLastRuneInString</span><span class="op" id="2210919">(</span><span class="ident" id="2210920">s</span><span class="op" id="2210921">[</span><span class="num" id="2210922">0</span><span class="op" id="2210923">:</span><span class="ident" id="2210924">i</span><span class="op" id="2210925">]</span><span class="op" id="2210926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210931">i</span>&nbsp;<span class="op" id="2210933">-=</span>&nbsp;<span class="ident" id="2210936">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210944">for</span>&nbsp;<span class="ident" id="2210948">_</span><span class="op" id="2210949">,</span>&nbsp;<span class="ident" id="2210951">m</span>&nbsp;<span class="op" id="2210953">:=</span>&nbsp;<span class="keyword" id="2210956">range</span>&nbsp;<span class="ident" id="2210962">chars</span>&nbsp;<span class="op" id="2210968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210974">if</span>&nbsp;<span class="builtintype" id="2210977">rune</span>&nbsp;<span class="op" id="2210982">==</span>&nbsp;<span class="ident" id="2210985">m</span>&nbsp;<span class="op" id="2210987">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210994">return</span>&nbsp;<span class="ident" id="2211001">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211019">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211022">return</span>&nbsp;<span class="op" id="2211029">-</span><span class="num" id="2211030">1</span><br>
<span class="lineno"></span><span class="op" id="2211032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2211035">//&nbsp;Generic&nbsp;split:&nbsp;splits&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep,</span><br>
<span class="lineno"></span><span class="comment" id="2211088">//&nbsp;including&nbsp;sepSave&nbsp;bytes&nbsp;of&nbsp;sep&nbsp;in&nbsp;the&nbsp;subarrays.</span><br>
<span class="lineno">275</span><span class="keyword" id="2211140">func</span>&nbsp;<span class="ident" id="2211145">genSplit</span><span class="op" id="2211153">(</span><span class="ident" id="2211154">s</span><span class="op" id="2211155">,</span>&nbsp;<span class="ident" id="2211157">sep</span>&nbsp;<span class="builtintype" id="2211161">string</span><span class="op" id="2211167">,</span>&nbsp;<span class="ident" id="2211169">sepSave</span><span class="op" id="2211176">,</span>&nbsp;<span class="ident" id="2211178">n</span>&nbsp;<span class="builtintype" id="2211180">int</span><span class="op" id="2211183">)</span>&nbsp;<span class="op" id="2211185">[</span><span class="op" id="2211186">]</span><span class="builtintype" id="2211187">string</span>&nbsp;<span class="op" id="2211194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211197">if</span>&nbsp;<span class="ident" id="2211200">n</span>&nbsp;<span class="op" id="2211202">==</span>&nbsp;<span class="num" id="2211205">0</span>&nbsp;<span class="op" id="2211207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211211">return</span>&nbsp;<span class="ident" id="2211218">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211226">if</span>&nbsp;<span class="ident" id="2211229">sep</span>&nbsp;<span class="op" id="2211233">==</span>&nbsp;<span class="string" id="2211236">&#34;&#34;</span>&nbsp;<span class="op" id="2211239">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211243">return</span>&nbsp;<span class="ident" id="2211250">explode</span><span class="op" id="2211257">(</span><span class="ident" id="2211258">s</span><span class="op" id="2211259">,</span>&nbsp;<span class="ident" id="2211261">n</span><span class="op" id="2211262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211268">if</span>&nbsp;<span class="ident" id="2211271">n</span>&nbsp;<span class="op" id="2211273">&lt;</span>&nbsp;<span class="num" id="2211275">0</span>&nbsp;<span class="op" id="2211277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211281">n</span>&nbsp;<span class="op" id="2211283">=</span>&nbsp;<span class="ident" id="2211285">Count</span><span class="op" id="2211290">(</span><span class="ident" id="2211291">s</span><span class="op" id="2211292">,</span>&nbsp;<span class="ident" id="2211294">sep</span><span class="op" id="2211297">)</span>&nbsp;<span class="op" id="2211299">+</span>&nbsp;<span class="num" id="2211301">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211304">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211307">c</span>&nbsp;<span class="op" id="2211309">:=</span>&nbsp;<span class="ident" id="2211312">sep</span><span class="op" id="2211315">[</span><span class="num" id="2211316">0</span><span class="op" id="2211317">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211320">start</span>&nbsp;<span class="op" id="2211326">:=</span>&nbsp;<span class="num" id="2211329">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211332">a</span>&nbsp;<span class="op" id="2211334">:=</span>&nbsp;<span class="builtinfunc" id="2211337">make</span><span class="op" id="2211341">(</span><span class="op" id="2211342">[</span><span class="op" id="2211343">]</span><span class="builtintype" id="2211344">string</span><span class="op" id="2211350">,</span>&nbsp;<span class="ident" id="2211352">n</span><span class="op" id="2211353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211356">na</span>&nbsp;<span class="op" id="2211359">:=</span>&nbsp;<span class="num" id="2211362">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211365">for</span>&nbsp;<span class="ident" id="2211369">i</span>&nbsp;<span class="op" id="2211371">:=</span>&nbsp;<span class="num" id="2211374">0</span><span class="op" id="2211375">;</span>&nbsp;<span class="ident" id="2211377">i</span><span class="op" id="2211378">+</span><span class="builtinfunc" id="2211379">len</span><span class="op" id="2211382">(</span><span class="ident" id="2211383">sep</span><span class="op" id="2211386">)</span>&nbsp;<span class="op" id="2211388">&lt;=</span>&nbsp;<span class="builtinfunc" id="2211391">len</span><span class="op" id="2211394">(</span><span class="ident" id="2211395">s</span><span class="op" id="2211396">)</span>&nbsp;<span class="op" id="2211398">&amp;&amp;</span>&nbsp;<span class="ident" id="2211401">na</span><span class="op" id="2211403">+</span><span class="num" id="2211404">1</span>&nbsp;<span class="op" id="2211406">&lt;</span>&nbsp;<span class="ident" id="2211408">n</span><span class="op" id="2211409">;</span>&nbsp;<span class="ident" id="2211411">i</span><span class="op" id="2211412">++</span>&nbsp;<span class="op" id="2211415">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211419">if</span>&nbsp;<span class="ident" id="2211422">s</span><span class="op" id="2211423">[</span><span class="ident" id="2211424">i</span><span class="op" id="2211425">]</span>&nbsp;<span class="op" id="2211427">==</span>&nbsp;<span class="ident" id="2211430">c</span>&nbsp;<span class="op" id="2211432">&amp;&amp;</span>&nbsp;<span class="op" id="2211435">(</span><span class="builtinfunc" id="2211436">len</span><span class="op" id="2211439">(</span><span class="ident" id="2211440">sep</span><span class="op" id="2211443">)</span>&nbsp;<span class="op" id="2211445">==</span>&nbsp;<span class="num" id="2211448">1</span>&nbsp;<span class="op" id="2211450">||</span>&nbsp;<span class="ident" id="2211453">s</span><span class="op" id="2211454">[</span><span class="ident" id="2211455">i</span><span class="op" id="2211456">:</span><span class="ident" id="2211457">i</span><span class="op" id="2211458">+</span><span class="builtinfunc" id="2211459">len</span><span class="op" id="2211462">(</span><span class="ident" id="2211463">sep</span><span class="op" id="2211466">)</span><span class="op" id="2211467">]</span>&nbsp;<span class="op" id="2211469">==</span>&nbsp;<span class="ident" id="2211472">sep</span><span class="op" id="2211475">)</span>&nbsp;<span class="op" id="2211477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211482">a</span><span class="op" id="2211483">[</span><span class="ident" id="2211484">na</span><span class="op" id="2211486">]</span>&nbsp;<span class="op" id="2211488">=</span>&nbsp;<span class="ident" id="2211490">s</span><span class="op" id="2211491">[</span><span class="ident" id="2211492">start</span>&nbsp;<span class="op" id="2211498">:</span>&nbsp;<span class="ident" id="2211500">i</span><span class="op" id="2211501">+</span><span class="ident" id="2211502">sepSave</span><span class="op" id="2211509">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211514">na</span><span class="op" id="2211516">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211522">start</span>&nbsp;<span class="op" id="2211528">=</span>&nbsp;<span class="ident" id="2211530">i</span>&nbsp;<span class="op" id="2211532">+</span>&nbsp;<span class="builtinfunc" id="2211534">len</span><span class="op" id="2211537">(</span><span class="ident" id="2211538">sep</span><span class="op" id="2211541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211546">i</span>&nbsp;<span class="op" id="2211548">+=</span>&nbsp;<span class="builtinfunc" id="2211551">len</span><span class="op" id="2211554">(</span><span class="ident" id="2211555">sep</span><span class="op" id="2211558">)</span>&nbsp;<span class="op" id="2211560">-</span>&nbsp;<span class="num" id="2211562">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211572">a</span><span class="op" id="2211573">[</span><span class="ident" id="2211574">na</span><span class="op" id="2211576">]</span>&nbsp;<span class="op" id="2211578">=</span>&nbsp;<span class="ident" id="2211580">s</span><span class="op" id="2211581">[</span><span class="ident" id="2211582">start</span><span class="op" id="2211587">:</span><span class="op" id="2211588">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211591">return</span>&nbsp;<span class="ident" id="2211598">a</span><span class="op" id="2211599">[</span><span class="num" id="2211600">0</span>&nbsp;<span class="op" id="2211602">:</span>&nbsp;<span class="ident" id="2211604">na</span><span class="op" id="2211606">+</span><span class="num" id="2211607">1</span><span class="op" id="2211608">]</span><br>
<span class="lineno"></span><span class="op" id="2211610">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="2211613">//&nbsp;SplitN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2211688">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2211732">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2211793">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">305</span><span class="comment" id="2211853">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="2211937">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2211986">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2212013">func</span>&nbsp;<span class="ident" id="2212018">SplitN</span><span class="op" id="2212024">(</span><span class="ident" id="2212025">s</span><span class="op" id="2212026">,</span>&nbsp;<span class="ident" id="2212028">sep</span>&nbsp;<span class="builtintype" id="2212032">string</span><span class="op" id="2212038">,</span>&nbsp;<span class="ident" id="2212040">n</span>&nbsp;<span class="builtintype" id="2212042">int</span><span class="op" id="2212045">)</span>&nbsp;<span class="op" id="2212047">[</span><span class="op" id="2212048">]</span><span class="builtintype" id="2212049">string</span>&nbsp;<span class="op" id="2212056">{</span>&nbsp;<span class="keyword" id="2212058">return</span>&nbsp;<span class="ident" id="2212065">genSplit</span><span class="op" id="2212073">(</span><span class="ident" id="2212074">s</span><span class="op" id="2212075">,</span>&nbsp;<span class="ident" id="2212077">sep</span><span class="op" id="2212080">,</span>&nbsp;<span class="num" id="2212082">0</span><span class="op" id="2212083">,</span>&nbsp;<span class="ident" id="2212085">n</span><span class="op" id="2212086">)</span>&nbsp;<span class="op" id="2212088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="2212091">//&nbsp;SplitAfterN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2212162">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2212202">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfterN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2212268">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno"></span><span class="comment" id="2212328">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno">315</span><span class="comment" id="2212412">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2212461">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2212488">func</span>&nbsp;<span class="ident" id="2212493">SplitAfterN</span><span class="op" id="2212504">(</span><span class="ident" id="2212505">s</span><span class="op" id="2212506">,</span>&nbsp;<span class="ident" id="2212508">sep</span>&nbsp;<span class="builtintype" id="2212512">string</span><span class="op" id="2212518">,</span>&nbsp;<span class="ident" id="2212520">n</span>&nbsp;<span class="builtintype" id="2212522">int</span><span class="op" id="2212525">)</span>&nbsp;<span class="op" id="2212527">[</span><span class="op" id="2212528">]</span><span class="builtintype" id="2212529">string</span>&nbsp;<span class="op" id="2212536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212539">return</span>&nbsp;<span class="ident" id="2212546">genSplit</span><span class="op" id="2212554">(</span><span class="ident" id="2212555">s</span><span class="op" id="2212556">,</span>&nbsp;<span class="ident" id="2212558">sep</span><span class="op" id="2212561">,</span>&nbsp;<span class="builtinfunc" id="2212563">len</span><span class="op" id="2212566">(</span><span class="ident" id="2212567">sep</span><span class="op" id="2212570">)</span><span class="op" id="2212571">,</span>&nbsp;<span class="ident" id="2212573">n</span><span class="op" id="2212574">)</span><br>
<span class="lineno"></span><span class="op" id="2212576">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2212579">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2212657">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2212701">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;Split&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2212761">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno">325</span><span class="keyword" id="2212811">func</span>&nbsp;<span class="ident" id="2212816">Split</span><span class="op" id="2212821">(</span><span class="ident" id="2212822">s</span><span class="op" id="2212823">,</span>&nbsp;<span class="ident" id="2212825">sep</span>&nbsp;<span class="builtintype" id="2212829">string</span><span class="op" id="2212835">)</span>&nbsp;<span class="op" id="2212837">[</span><span class="op" id="2212838">]</span><span class="builtintype" id="2212839">string</span>&nbsp;<span class="op" id="2212846">{</span>&nbsp;<span class="keyword" id="2212848">return</span>&nbsp;<span class="ident" id="2212855">genSplit</span><span class="op" id="2212863">(</span><span class="ident" id="2212864">s</span><span class="op" id="2212865">,</span>&nbsp;<span class="ident" id="2212867">sep</span><span class="op" id="2212870">,</span>&nbsp;<span class="num" id="2212872">0</span><span class="op" id="2212873">,</span>&nbsp;<span class="op" id="2212875">-</span><span class="num" id="2212876">1</span><span class="op" id="2212877">)</span>&nbsp;<span class="op" id="2212879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2212882">//&nbsp;SplitAfter&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2212956">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2212996">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfter&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno">330</span><span class="comment" id="2213061">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitAfterN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2213116">func</span>&nbsp;<span class="ident" id="2213121">SplitAfter</span><span class="op" id="2213131">(</span><span class="ident" id="2213132">s</span><span class="op" id="2213133">,</span>&nbsp;<span class="ident" id="2213135">sep</span>&nbsp;<span class="builtintype" id="2213139">string</span><span class="op" id="2213145">)</span>&nbsp;<span class="op" id="2213147">[</span><span class="op" id="2213148">]</span><span class="builtintype" id="2213149">string</span>&nbsp;<span class="op" id="2213156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213159">return</span>&nbsp;<span class="ident" id="2213166">genSplit</span><span class="op" id="2213174">(</span><span class="ident" id="2213175">s</span><span class="op" id="2213176">,</span>&nbsp;<span class="ident" id="2213178">sep</span><span class="op" id="2213181">,</span>&nbsp;<span class="builtinfunc" id="2213183">len</span><span class="op" id="2213186">(</span><span class="ident" id="2213187">sep</span><span class="op" id="2213190">)</span><span class="op" id="2213191">,</span>&nbsp;<span class="op" id="2213193">-</span><span class="num" id="2213194">1</span><span class="op" id="2213195">)</span><br>
<span class="lineno"></span><span class="op" id="2213197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="2213200">//&nbsp;Fields&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="2213290">//&nbsp;characters,&nbsp;as&nbsp;defined&nbsp;by&nbsp;unicode.IsSpace,&nbsp;returning&nbsp;an&nbsp;array&nbsp;of&nbsp;substrings&nbsp;of&nbsp;s&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2213380">//&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="2213426">func</span>&nbsp;<span class="ident" id="2213431">Fields</span><span class="op" id="2213437">(</span><span class="ident" id="2213438">s</span>&nbsp;<span class="builtintype" id="2213440">string</span><span class="op" id="2213446">)</span>&nbsp;<span class="op" id="2213448">[</span><span class="op" id="2213449">]</span><span class="builtintype" id="2213450">string</span>&nbsp;<span class="op" id="2213457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213460">return</span>&nbsp;<span class="ident" id="2213467">FieldsFunc</span><span class="op" id="2213477">(</span><span class="ident" id="2213478">s</span><span class="op" id="2213479">,</span>&nbsp;<span class="ident" id="2213481">unicode</span><span class="op" id="2213488">.</span><span class="ident" id="2213489">IsSpace</span><span class="op" id="2213496">)</span><br>
<span class="lineno">340</span><span class="op" id="2213498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2213501">//&nbsp;FieldsFunc&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;at&nbsp;each&nbsp;run&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)</span><br>
<span class="lineno"></span><span class="comment" id="2213588">//&nbsp;and&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;slices&nbsp;of&nbsp;s.&nbsp;If&nbsp;all&nbsp;code&nbsp;points&nbsp;in&nbsp;s&nbsp;satisfy&nbsp;f(c)&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2213672">//&nbsp;string&nbsp;is&nbsp;empty,&nbsp;an&nbsp;empty&nbsp;slice&nbsp;is&nbsp;returned.</span><br>
<span class="lineno">345</span><span class="comment" id="2213720">//&nbsp;FieldsFunc&nbsp;makes&nbsp;no&nbsp;guarantees&nbsp;about&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;it&nbsp;calls&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="comment" id="2213794">//&nbsp;If&nbsp;f&nbsp;does&nbsp;not&nbsp;return&nbsp;consistent&nbsp;results&nbsp;for&nbsp;a&nbsp;given&nbsp;c,&nbsp;FieldsFunc&nbsp;may&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="2213874">func</span>&nbsp;<span class="ident" id="2213879">FieldsFunc</span><span class="op" id="2213889">(</span><span class="ident" id="2213890">s</span>&nbsp;<span class="builtintype" id="2213892">string</span><span class="op" id="2213898">,</span>&nbsp;<span class="ident" id="2213900">f</span>&nbsp;<span class="keyword" id="2213902">func</span><span class="op" id="2213906">(</span><span class="builtintype" id="2213907">rune</span><span class="op" id="2213911">)</span>&nbsp;<span class="builtintype" id="2213913">bool</span><span class="op" id="2213917">)</span>&nbsp;<span class="op" id="2213919">[</span><span class="op" id="2213920">]</span><span class="builtintype" id="2213921">string</span>&nbsp;<span class="op" id="2213928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2213931">//&nbsp;First&nbsp;count&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2213959">n</span>&nbsp;<span class="op" id="2213961">:=</span>&nbsp;<span class="num" id="2213964">0</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2213967">inField</span>&nbsp;<span class="op" id="2213975">:=</span>&nbsp;<span class="builtintype" id="2213978">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213985">for</span>&nbsp;<span class="ident" id="2213989">_</span><span class="op" id="2213990">,</span>&nbsp;<span class="builtintype" id="2213992">rune</span>&nbsp;<span class="op" id="2213997">:=</span>&nbsp;<span class="keyword" id="2214000">range</span>&nbsp;<span class="ident" id="2214006">s</span>&nbsp;<span class="op" id="2214008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214012">wasInField</span>&nbsp;<span class="op" id="2214023">:=</span>&nbsp;<span class="ident" id="2214026">inField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214036">inField</span>&nbsp;<span class="op" id="2214044">=</span>&nbsp;<span class="op" id="2214046">!</span><span class="ident" id="2214047">f</span><span class="op" id="2214048">(</span><span class="builtintype" id="2214049">rune</span><span class="op" id="2214053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214057">if</span>&nbsp;<span class="ident" id="2214060">inField</span>&nbsp;<span class="op" id="2214068">&amp;&amp;</span>&nbsp;<span class="op" id="2214071">!</span><span class="ident" id="2214072">wasInField</span>&nbsp;<span class="op" id="2214083">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214088">n</span><span class="op" id="2214089">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2214101">//&nbsp;Now&nbsp;create&nbsp;them.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214122">a</span>&nbsp;<span class="op" id="2214124">:=</span>&nbsp;<span class="builtinfunc" id="2214127">make</span><span class="op" id="2214131">(</span><span class="op" id="2214132">[</span><span class="op" id="2214133">]</span><span class="builtintype" id="2214134">string</span><span class="op" id="2214140">,</span>&nbsp;<span class="ident" id="2214142">n</span><span class="op" id="2214143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214146">na</span>&nbsp;<span class="op" id="2214149">:=</span>&nbsp;<span class="num" id="2214152">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214155">fieldStart</span>&nbsp;<span class="op" id="2214166">:=</span>&nbsp;<span class="op" id="2214169">-</span><span class="num" id="2214170">1</span>&nbsp;<span class="comment" id="2214172">//&nbsp;Set&nbsp;to&nbsp;-1&nbsp;when&nbsp;looking&nbsp;for&nbsp;start&nbsp;of&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214219">for</span>&nbsp;<span class="ident" id="2214223">i</span><span class="op" id="2214224">,</span>&nbsp;<span class="builtintype" id="2214226">rune</span>&nbsp;<span class="op" id="2214231">:=</span>&nbsp;<span class="keyword" id="2214234">range</span>&nbsp;<span class="ident" id="2214240">s</span>&nbsp;<span class="op" id="2214242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214246">if</span>&nbsp;<span class="ident" id="2214249">f</span><span class="op" id="2214250">(</span><span class="builtintype" id="2214251">rune</span><span class="op" id="2214255">)</span>&nbsp;<span class="op" id="2214257">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214262">if</span>&nbsp;<span class="ident" id="2214265">fieldStart</span>&nbsp;<span class="op" id="2214276">&gt;=</span>&nbsp;<span class="num" id="2214279">0</span>&nbsp;<span class="op" id="2214281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214287">a</span><span class="op" id="2214288">[</span><span class="ident" id="2214289">na</span><span class="op" id="2214291">]</span>&nbsp;<span class="op" id="2214293">=</span>&nbsp;<span class="ident" id="2214295">s</span><span class="op" id="2214296">[</span><span class="ident" id="2214297">fieldStart</span><span class="op" id="2214307">:</span><span class="ident" id="2214308">i</span><span class="op" id="2214309">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214315">na</span><span class="op" id="2214317">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214324">fieldStart</span>&nbsp;<span class="op" id="2214335">=</span>&nbsp;<span class="op" id="2214337">-</span><span class="num" id="2214338">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214343">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214347">}</span>&nbsp;<span class="keyword" id="2214349">else</span>&nbsp;<span class="keyword" id="2214354">if</span>&nbsp;<span class="ident" id="2214357">fieldStart</span>&nbsp;<span class="op" id="2214368">==</span>&nbsp;<span class="op" id="2214371">-</span><span class="num" id="2214372">1</span>&nbsp;<span class="op" id="2214374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214379">fieldStart</span>&nbsp;<span class="op" id="2214390">=</span>&nbsp;<span class="ident" id="2214392">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214402">if</span>&nbsp;<span class="ident" id="2214405">fieldStart</span>&nbsp;<span class="op" id="2214416">&gt;=</span>&nbsp;<span class="num" id="2214419">0</span>&nbsp;<span class="op" id="2214421">{</span>&nbsp;<span class="comment" id="2214423">//&nbsp;Last&nbsp;field&nbsp;might&nbsp;end&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214457">a</span><span class="op" id="2214458">[</span><span class="ident" id="2214459">na</span><span class="op" id="2214461">]</span>&nbsp;<span class="op" id="2214463">=</span>&nbsp;<span class="ident" id="2214465">s</span><span class="op" id="2214466">[</span><span class="ident" id="2214467">fieldStart</span><span class="op" id="2214477">:</span><span class="op" id="2214478">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214484">return</span>&nbsp;<span class="ident" id="2214491">a</span><br>
<span class="lineno"></span><span class="op" id="2214493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="comment" id="2214496">//&nbsp;Join&nbsp;concatenates&nbsp;the&nbsp;elements&nbsp;of&nbsp;a&nbsp;to&nbsp;create&nbsp;a&nbsp;single&nbsp;string.&nbsp;&nbsp;&nbsp;The&nbsp;separator&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2214585">//&nbsp;sep&nbsp;is&nbsp;placed&nbsp;between&nbsp;elements&nbsp;in&nbsp;the&nbsp;resulting&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2214644">func</span>&nbsp;<span class="ident" id="2214649">Join</span><span class="op" id="2214653">(</span><span class="ident" id="2214654">a</span>&nbsp;<span class="op" id="2214656">[</span><span class="op" id="2214657">]</span><span class="builtintype" id="2214658">string</span><span class="op" id="2214664">,</span>&nbsp;<span class="ident" id="2214666">sep</span>&nbsp;<span class="builtintype" id="2214670">string</span><span class="op" id="2214676">)</span>&nbsp;<span class="builtintype" id="2214678">string</span>&nbsp;<span class="op" id="2214685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214688">if</span>&nbsp;<span class="builtinfunc" id="2214691">len</span><span class="op" id="2214694">(</span><span class="ident" id="2214695">a</span><span class="op" id="2214696">)</span>&nbsp;<span class="op" id="2214698">==</span>&nbsp;<span class="num" id="2214701">0</span>&nbsp;<span class="op" id="2214703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214707">return</span>&nbsp;<span class="string" id="2214714">&#34;&#34;</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214721">if</span>&nbsp;<span class="builtinfunc" id="2214724">len</span><span class="op" id="2214727">(</span><span class="ident" id="2214728">a</span><span class="op" id="2214729">)</span>&nbsp;<span class="op" id="2214731">==</span>&nbsp;<span class="num" id="2214734">1</span>&nbsp;<span class="op" id="2214736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214740">return</span>&nbsp;<span class="ident" id="2214747">a</span><span class="op" id="2214748">[</span><span class="num" id="2214749">0</span><span class="op" id="2214750">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214756">n</span>&nbsp;<span class="op" id="2214758">:=</span>&nbsp;<span class="builtinfunc" id="2214761">len</span><span class="op" id="2214764">(</span><span class="ident" id="2214765">sep</span><span class="op" id="2214768">)</span>&nbsp;<span class="op" id="2214770">*</span>&nbsp;<span class="op" id="2214772">(</span><span class="builtinfunc" id="2214773">len</span><span class="op" id="2214776">(</span><span class="ident" id="2214777">a</span><span class="op" id="2214778">)</span>&nbsp;<span class="op" id="2214780">-</span>&nbsp;<span class="num" id="2214782">1</span><span class="op" id="2214783">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214786">for</span>&nbsp;<span class="ident" id="2214790">i</span>&nbsp;<span class="op" id="2214792">:=</span>&nbsp;<span class="num" id="2214795">0</span><span class="op" id="2214796">;</span>&nbsp;<span class="ident" id="2214798">i</span>&nbsp;<span class="op" id="2214800">&lt;</span>&nbsp;<span class="builtinfunc" id="2214802">len</span><span class="op" id="2214805">(</span><span class="ident" id="2214806">a</span><span class="op" id="2214807">)</span><span class="op" id="2214808">;</span>&nbsp;<span class="ident" id="2214810">i</span><span class="op" id="2214811">++</span>&nbsp;<span class="op" id="2214814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214818">n</span>&nbsp;<span class="op" id="2214820">+=</span>&nbsp;<span class="builtinfunc" id="2214823">len</span><span class="op" id="2214826">(</span><span class="ident" id="2214827">a</span><span class="op" id="2214828">[</span><span class="ident" id="2214829">i</span><span class="op" id="2214830">]</span><span class="op" id="2214831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214838">b</span>&nbsp;<span class="op" id="2214840">:=</span>&nbsp;<span class="builtinfunc" id="2214843">make</span><span class="op" id="2214847">(</span><span class="op" id="2214848">[</span><span class="op" id="2214849">]</span><span class="builtintype" id="2214850">byte</span><span class="op" id="2214854">,</span>&nbsp;<span class="ident" id="2214856">n</span><span class="op" id="2214857">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214860">bp</span>&nbsp;<span class="op" id="2214863">:=</span>&nbsp;<span class="builtinfunc" id="2214866">copy</span><span class="op" id="2214870">(</span><span class="ident" id="2214871">b</span><span class="op" id="2214872">,</span>&nbsp;<span class="ident" id="2214874">a</span><span class="op" id="2214875">[</span><span class="num" id="2214876">0</span><span class="op" id="2214877">]</span><span class="op" id="2214878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214881">for</span>&nbsp;<span class="ident" id="2214885">_</span><span class="op" id="2214886">,</span>&nbsp;<span class="ident" id="2214888">s</span>&nbsp;<span class="op" id="2214890">:=</span>&nbsp;<span class="keyword" id="2214893">range</span>&nbsp;<span class="ident" id="2214899">a</span><span class="op" id="2214900">[</span><span class="num" id="2214901">1</span><span class="op" id="2214902">:</span><span class="op" id="2214903">]</span>&nbsp;<span class="op" id="2214905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214909">bp</span>&nbsp;<span class="op" id="2214912">+=</span>&nbsp;<span class="builtinfunc" id="2214915">copy</span><span class="op" id="2214919">(</span><span class="ident" id="2214920">b</span><span class="op" id="2214921">[</span><span class="ident" id="2214922">bp</span><span class="op" id="2214924">:</span><span class="op" id="2214925">]</span><span class="op" id="2214926">,</span>&nbsp;<span class="ident" id="2214928">sep</span><span class="op" id="2214931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214935">bp</span>&nbsp;<span class="op" id="2214938">+=</span>&nbsp;<span class="builtinfunc" id="2214941">copy</span><span class="op" id="2214945">(</span><span class="ident" id="2214946">b</span><span class="op" id="2214947">[</span><span class="ident" id="2214948">bp</span><span class="op" id="2214950">:</span><span class="op" id="2214951">]</span><span class="op" id="2214952">,</span>&nbsp;<span class="ident" id="2214954">s</span><span class="op" id="2214955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214958">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214961">return</span>&nbsp;<span class="builtintype" id="2214968">string</span><span class="op" id="2214974">(</span><span class="ident" id="2214975">b</span><span class="op" id="2214976">)</span><br>
<span class="lineno"></span><span class="op" id="2214978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2214981">//&nbsp;HasPrefix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;begins&nbsp;with&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="2215041">func</span>&nbsp;<span class="ident" id="2215046">HasPrefix</span><span class="op" id="2215055">(</span><span class="ident" id="2215056">s</span><span class="op" id="2215057">,</span>&nbsp;<span class="ident" id="2215059">prefix</span>&nbsp;<span class="builtintype" id="2215066">string</span><span class="op" id="2215072">)</span>&nbsp;<span class="builtintype" id="2215074">bool</span>&nbsp;<span class="op" id="2215079">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215082">return</span>&nbsp;<span class="builtinfunc" id="2215089">len</span><span class="op" id="2215092">(</span><span class="ident" id="2215093">s</span><span class="op" id="2215094">)</span>&nbsp;<span class="op" id="2215096">&gt;=</span>&nbsp;<span class="builtinfunc" id="2215099">len</span><span class="op" id="2215102">(</span><span class="ident" id="2215103">prefix</span><span class="op" id="2215109">)</span>&nbsp;<span class="op" id="2215111">&amp;&amp;</span>&nbsp;<span class="ident" id="2215114">s</span><span class="op" id="2215115">[</span><span class="num" id="2215116">0</span><span class="op" id="2215117">:</span><span class="builtinfunc" id="2215118">len</span><span class="op" id="2215121">(</span><span class="ident" id="2215122">prefix</span><span class="op" id="2215128">)</span><span class="op" id="2215129">]</span>&nbsp;<span class="op" id="2215131">==</span>&nbsp;<span class="ident" id="2215134">prefix</span><br>
<span class="lineno"></span><span class="op" id="2215141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2215144">//&nbsp;HasSuffix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;ends&nbsp;with&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="2215202">func</span>&nbsp;<span class="ident" id="2215207">HasSuffix</span><span class="op" id="2215216">(</span><span class="ident" id="2215217">s</span><span class="op" id="2215218">,</span>&nbsp;<span class="ident" id="2215220">suffix</span>&nbsp;<span class="builtintype" id="2215227">string</span><span class="op" id="2215233">)</span>&nbsp;<span class="builtintype" id="2215235">bool</span>&nbsp;<span class="op" id="2215240">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215243">return</span>&nbsp;<span class="builtinfunc" id="2215250">len</span><span class="op" id="2215253">(</span><span class="ident" id="2215254">s</span><span class="op" id="2215255">)</span>&nbsp;<span class="op" id="2215257">&gt;=</span>&nbsp;<span class="builtinfunc" id="2215260">len</span><span class="op" id="2215263">(</span><span class="ident" id="2215264">suffix</span><span class="op" id="2215270">)</span>&nbsp;<span class="op" id="2215272">&amp;&amp;</span>&nbsp;<span class="ident" id="2215275">s</span><span class="op" id="2215276">[</span><span class="builtinfunc" id="2215277">len</span><span class="op" id="2215280">(</span><span class="ident" id="2215281">s</span><span class="op" id="2215282">)</span><span class="op" id="2215283">-</span><span class="builtinfunc" id="2215284">len</span><span class="op" id="2215287">(</span><span class="ident" id="2215288">suffix</span><span class="op" id="2215294">)</span><span class="op" id="2215295">:</span><span class="op" id="2215296">]</span>&nbsp;<span class="op" id="2215298">==</span>&nbsp;<span class="ident" id="2215301">suffix</span><br>
<span class="lineno"></span><span class="op" id="2215308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2215311">//&nbsp;Map&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;its&nbsp;characters&nbsp;modified</span><br>
<span class="lineno"></span><span class="comment" id="2215382">//&nbsp;according&nbsp;to&nbsp;the&nbsp;mapping&nbsp;function.&nbsp;If&nbsp;mapping&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value,&nbsp;the&nbsp;character&nbsp;is</span><br>
<span class="lineno">415</span><span class="comment" id="2215474">//&nbsp;dropped&nbsp;from&nbsp;the&nbsp;string&nbsp;with&nbsp;no&nbsp;replacement.</span><br>
<span class="lineno"></span><span class="keyword" id="2215522">func</span>&nbsp;<span class="ident" id="2215527">Map</span><span class="op" id="2215530">(</span><span class="ident" id="2215531">mapping</span>&nbsp;<span class="keyword" id="2215539">func</span><span class="op" id="2215543">(</span><span class="builtintype" id="2215544">rune</span><span class="op" id="2215548">)</span>&nbsp;<span class="builtintype" id="2215550">rune</span><span class="op" id="2215554">,</span>&nbsp;<span class="ident" id="2215556">s</span>&nbsp;<span class="builtintype" id="2215558">string</span><span class="op" id="2215564">)</span>&nbsp;<span class="builtintype" id="2215566">string</span>&nbsp;<span class="op" id="2215573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2215576">//&nbsp;In&nbsp;the&nbsp;worst&nbsp;case,&nbsp;the&nbsp;string&nbsp;can&nbsp;grow&nbsp;when&nbsp;mapped,&nbsp;making</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2215639">//&nbsp;things&nbsp;unpleasant.&nbsp;&nbsp;But&nbsp;it&#39;s&nbsp;so&nbsp;rare&nbsp;we&nbsp;barge&nbsp;in&nbsp;assuming&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2215706">//&nbsp;fine.&nbsp;&nbsp;It&nbsp;could&nbsp;also&nbsp;shrink&nbsp;but&nbsp;that&nbsp;falls&nbsp;out&nbsp;naturally.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215768">maxbytes</span>&nbsp;<span class="op" id="2215777">:=</span>&nbsp;<span class="builtinfunc" id="2215780">len</span><span class="op" id="2215783">(</span><span class="ident" id="2215784">s</span><span class="op" id="2215785">)</span>&nbsp;<span class="comment" id="2215787">//&nbsp;length&nbsp;of&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215803">nbytes</span>&nbsp;<span class="op" id="2215810">:=</span>&nbsp;<span class="num" id="2215813">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2215822">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;encoded&nbsp;in&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2215855">//&nbsp;The&nbsp;output&nbsp;buffer&nbsp;b&nbsp;is&nbsp;initialized&nbsp;on&nbsp;demand,&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2215915">//&nbsp;time&nbsp;a&nbsp;character&nbsp;differs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215945">var</span>&nbsp;<span class="ident" id="2215949">b</span>&nbsp;<span class="op" id="2215951">[</span><span class="op" id="2215952">]</span><span class="builtintype" id="2215953">byte</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215960">for</span>&nbsp;<span class="ident" id="2215964">i</span><span class="op" id="2215965">,</span>&nbsp;<span class="ident" id="2215967">c</span>&nbsp;<span class="op" id="2215969">:=</span>&nbsp;<span class="keyword" id="2215972">range</span>&nbsp;<span class="ident" id="2215978">s</span>&nbsp;<span class="op" id="2215980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215984">r</span>&nbsp;<span class="op" id="2215986">:=</span>&nbsp;<span class="ident" id="2215989">mapping</span><span class="op" id="2215996">(</span><span class="ident" id="2215997">c</span><span class="op" id="2215998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216002">if</span>&nbsp;<span class="ident" id="2216005">b</span>&nbsp;<span class="op" id="2216007">==</span>&nbsp;<span class="ident" id="2216010">nil</span>&nbsp;<span class="op" id="2216014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216019">if</span>&nbsp;<span class="ident" id="2216022">r</span>&nbsp;<span class="op" id="2216024">==</span>&nbsp;<span class="ident" id="2216027">c</span>&nbsp;<span class="op" id="2216029">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216035">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216052">b</span>&nbsp;<span class="op" id="2216054">=</span>&nbsp;<span class="builtinfunc" id="2216056">make</span><span class="op" id="2216060">(</span><span class="op" id="2216061">[</span><span class="op" id="2216062">]</span><span class="builtintype" id="2216063">byte</span><span class="op" id="2216067">,</span>&nbsp;<span class="ident" id="2216069">maxbytes</span><span class="op" id="2216077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216082">nbytes</span>&nbsp;<span class="op" id="2216089">=</span>&nbsp;<span class="builtinfunc" id="2216091">copy</span><span class="op" id="2216095">(</span><span class="ident" id="2216096">b</span><span class="op" id="2216097">,</span>&nbsp;<span class="ident" id="2216099">s</span><span class="op" id="2216100">[</span><span class="op" id="2216101">:</span><span class="ident" id="2216102">i</span><span class="op" id="2216103">]</span><span class="op" id="2216104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216108">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216112">if</span>&nbsp;<span class="ident" id="2216115">r</span>&nbsp;<span class="op" id="2216117">&gt;=</span>&nbsp;<span class="num" id="2216120">0</span>&nbsp;<span class="op" id="2216122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216127">wid</span>&nbsp;<span class="op" id="2216131">:=</span>&nbsp;<span class="num" id="2216134">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216139">if</span>&nbsp;<span class="ident" id="2216142">r</span>&nbsp;<span class="op" id="2216144">&gt;=</span>&nbsp;<span class="ident" id="2216147">utf8</span><span class="op" id="2216151">.</span><span class="ident" id="2216152">RuneSelf</span>&nbsp;<span class="op" id="2216161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216167">wid</span>&nbsp;<span class="op" id="2216171">=</span>&nbsp;<span class="ident" id="2216173">utf8</span><span class="op" id="2216177">.</span><span class="ident" id="2216178">RuneLen</span><span class="op" id="2216185">(</span><span class="ident" id="2216186">r</span><span class="op" id="2216187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216192">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216197">if</span>&nbsp;<span class="ident" id="2216200">nbytes</span><span class="op" id="2216206">+</span><span class="ident" id="2216207">wid</span>&nbsp;<span class="op" id="2216211">&gt;</span>&nbsp;<span class="ident" id="2216213">maxbytes</span>&nbsp;<span class="op" id="2216222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2216228">//&nbsp;Grow&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216252">maxbytes</span>&nbsp;<span class="op" id="2216261">=</span>&nbsp;<span class="ident" id="2216263">maxbytes</span><span class="op" id="2216271">*</span><span class="num" id="2216272">2</span>&nbsp;<span class="op" id="2216274">+</span>&nbsp;<span class="ident" id="2216276">utf8</span><span class="op" id="2216280">.</span><span class="ident" id="2216281">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216292">nb</span>&nbsp;<span class="op" id="2216295">:=</span>&nbsp;<span class="builtinfunc" id="2216298">make</span><span class="op" id="2216302">(</span><span class="op" id="2216303">[</span><span class="op" id="2216304">]</span><span class="builtintype" id="2216305">byte</span><span class="op" id="2216309">,</span>&nbsp;<span class="ident" id="2216311">maxbytes</span><span class="op" id="2216319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2216325">copy</span><span class="op" id="2216329">(</span><span class="ident" id="2216330">nb</span><span class="op" id="2216332">,</span>&nbsp;<span class="ident" id="2216334">b</span><span class="op" id="2216335">[</span><span class="num" id="2216336">0</span><span class="op" id="2216337">:</span><span class="ident" id="2216338">nbytes</span><span class="op" id="2216344">]</span><span class="op" id="2216345">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216351">b</span>&nbsp;<span class="op" id="2216353">=</span>&nbsp;<span class="ident" id="2216355">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216366">nbytes</span>&nbsp;<span class="op" id="2216373">+=</span>&nbsp;<span class="ident" id="2216376">utf8</span><span class="op" id="2216380">.</span><span class="ident" id="2216381">EncodeRune</span><span class="op" id="2216391">(</span><span class="ident" id="2216392">b</span><span class="op" id="2216393">[</span><span class="ident" id="2216394">nbytes</span><span class="op" id="2216400">:</span><span class="ident" id="2216401">maxbytes</span><span class="op" id="2216409">]</span><span class="op" id="2216410">,</span>&nbsp;<span class="ident" id="2216412">r</span><span class="op" id="2216413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216420">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216423">if</span>&nbsp;<span class="ident" id="2216426">b</span>&nbsp;<span class="op" id="2216428">==</span>&nbsp;<span class="ident" id="2216431">nil</span>&nbsp;<span class="op" id="2216435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216439">return</span>&nbsp;<span class="ident" id="2216446">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216452">return</span>&nbsp;<span class="builtintype" id="2216459">string</span><span class="op" id="2216465">(</span><span class="ident" id="2216466">b</span><span class="op" id="2216467">[</span><span class="num" id="2216468">0</span><span class="op" id="2216469">:</span><span class="ident" id="2216470">nbytes</span><span class="op" id="2216476">]</span><span class="op" id="2216477">)</span><br>
<span class="lineno"></span><span class="op" id="2216479">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="2216482">//&nbsp;Repeat&nbsp;returns&nbsp;a&nbsp;new&nbsp;string&nbsp;consisting&nbsp;of&nbsp;count&nbsp;copies&nbsp;of&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2216557">func</span>&nbsp;<span class="ident" id="2216562">Repeat</span><span class="op" id="2216568">(</span><span class="ident" id="2216569">s</span>&nbsp;<span class="builtintype" id="2216571">string</span><span class="op" id="2216577">,</span>&nbsp;<span class="ident" id="2216579">count</span>&nbsp;<span class="builtintype" id="2216585">int</span><span class="op" id="2216588">)</span>&nbsp;<span class="builtintype" id="2216590">string</span>&nbsp;<span class="op" id="2216597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216600">b</span>&nbsp;<span class="op" id="2216602">:=</span>&nbsp;<span class="builtinfunc" id="2216605">make</span><span class="op" id="2216609">(</span><span class="op" id="2216610">[</span><span class="op" id="2216611">]</span><span class="builtintype" id="2216612">byte</span><span class="op" id="2216616">,</span>&nbsp;<span class="builtinfunc" id="2216618">len</span><span class="op" id="2216621">(</span><span class="ident" id="2216622">s</span><span class="op" id="2216623">)</span><span class="op" id="2216624">*</span><span class="ident" id="2216625">count</span><span class="op" id="2216630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216633">bp</span>&nbsp;<span class="op" id="2216636">:=</span>&nbsp;<span class="builtinfunc" id="2216639">copy</span><span class="op" id="2216643">(</span><span class="ident" id="2216644">b</span><span class="op" id="2216645">,</span>&nbsp;<span class="ident" id="2216647">s</span><span class="op" id="2216648">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216651">for</span>&nbsp;<span class="ident" id="2216655">bp</span>&nbsp;<span class="op" id="2216658">&lt;</span>&nbsp;<span class="builtinfunc" id="2216660">len</span><span class="op" id="2216663">(</span><span class="ident" id="2216664">b</span><span class="op" id="2216665">)</span>&nbsp;<span class="op" id="2216667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2216671">copy</span><span class="op" id="2216675">(</span><span class="ident" id="2216676">b</span><span class="op" id="2216677">[</span><span class="ident" id="2216678">bp</span><span class="op" id="2216680">:</span><span class="op" id="2216681">]</span><span class="op" id="2216682">,</span>&nbsp;<span class="ident" id="2216684">b</span><span class="op" id="2216685">[</span><span class="op" id="2216686">:</span><span class="ident" id="2216687">bp</span><span class="op" id="2216689">]</span><span class="op" id="2216690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216694">bp</span>&nbsp;<span class="op" id="2216697">*=</span>&nbsp;<span class="num" id="2216700">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216706">return</span>&nbsp;<span class="builtintype" id="2216713">string</span><span class="op" id="2216719">(</span><span class="ident" id="2216720">b</span><span class="op" id="2216721">)</span><br>
<span class="lineno">465</span><span class="op" id="2216723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2216726">//&nbsp;ToUpper&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2216821">func</span>&nbsp;<span class="ident" id="2216826">ToUpper</span><span class="op" id="2216833">(</span><span class="ident" id="2216834">s</span>&nbsp;<span class="builtintype" id="2216836">string</span><span class="op" id="2216842">)</span>&nbsp;<span class="builtintype" id="2216844">string</span>&nbsp;<span class="op" id="2216851">{</span>&nbsp;<span class="keyword" id="2216853">return</span>&nbsp;<span class="ident" id="2216860">Map</span><span class="op" id="2216863">(</span><span class="ident" id="2216864">unicode</span><span class="op" id="2216871">.</span><span class="ident" id="2216872">ToUpper</span><span class="op" id="2216879">,</span>&nbsp;<span class="ident" id="2216881">s</span><span class="op" id="2216882">)</span>&nbsp;<span class="op" id="2216884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="2216887">//&nbsp;ToLower&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2216982">func</span>&nbsp;<span class="ident" id="2216987">ToLower</span><span class="op" id="2216994">(</span><span class="ident" id="2216995">s</span>&nbsp;<span class="builtintype" id="2216997">string</span><span class="op" id="2217003">)</span>&nbsp;<span class="builtintype" id="2217005">string</span>&nbsp;<span class="op" id="2217012">{</span>&nbsp;<span class="keyword" id="2217014">return</span>&nbsp;<span class="ident" id="2217021">Map</span><span class="op" id="2217024">(</span><span class="ident" id="2217025">unicode</span><span class="op" id="2217032">.</span><span class="ident" id="2217033">ToLower</span><span class="op" id="2217040">,</span>&nbsp;<span class="ident" id="2217042">s</span><span class="op" id="2217043">)</span>&nbsp;<span class="op" id="2217045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2217048">//&nbsp;ToTitle&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2217143">func</span>&nbsp;<span class="ident" id="2217148">ToTitle</span><span class="op" id="2217155">(</span><span class="ident" id="2217156">s</span>&nbsp;<span class="builtintype" id="2217158">string</span><span class="op" id="2217164">)</span>&nbsp;<span class="builtintype" id="2217166">string</span>&nbsp;<span class="op" id="2217173">{</span>&nbsp;<span class="keyword" id="2217175">return</span>&nbsp;<span class="ident" id="2217182">Map</span><span class="op" id="2217185">(</span><span class="ident" id="2217186">unicode</span><span class="op" id="2217193">.</span><span class="ident" id="2217194">ToTitle</span><span class="op" id="2217201">,</span>&nbsp;<span class="ident" id="2217203">s</span><span class="op" id="2217204">)</span>&nbsp;<span class="op" id="2217206">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="2217209">//&nbsp;ToUpperSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2217299">//&nbsp;upper&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2217359">func</span>&nbsp;<span class="ident" id="2217364">ToUpperSpecial</span><span class="op" id="2217378">(</span><span class="ident" id="2217379">_case</span>&nbsp;<span class="ident" id="2217385">unicode</span><span class="op" id="2217392">.</span><span class="ident" id="2217393">SpecialCase</span><span class="op" id="2217404">,</span>&nbsp;<span class="ident" id="2217406">s</span>&nbsp;<span class="builtintype" id="2217408">string</span><span class="op" id="2217414">)</span>&nbsp;<span class="builtintype" id="2217416">string</span>&nbsp;<span class="op" id="2217423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217426">return</span>&nbsp;<span class="ident" id="2217433">Map</span><span class="op" id="2217436">(</span><span class="keyword" id="2217437">func</span><span class="op" id="2217441">(</span><span class="ident" id="2217442">r</span>&nbsp;<span class="builtintype" id="2217444">rune</span><span class="op" id="2217448">)</span>&nbsp;<span class="builtintype" id="2217450">rune</span>&nbsp;<span class="op" id="2217455">{</span>&nbsp;<span class="keyword" id="2217457">return</span>&nbsp;<span class="ident" id="2217464">_case</span><span class="op" id="2217469">.</span><span class="ident" id="2217470">ToUpper</span><span class="op" id="2217477">(</span><span class="ident" id="2217478">r</span><span class="op" id="2217479">)</span>&nbsp;<span class="op" id="2217481">}</span><span class="op" id="2217482">,</span>&nbsp;<span class="ident" id="2217484">s</span><span class="op" id="2217485">)</span><br>
<span class="lineno">480</span><span class="op" id="2217487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2217490">//&nbsp;ToLowerSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2217580">//&nbsp;lower&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2217640">func</span>&nbsp;<span class="ident" id="2217645">ToLowerSpecial</span><span class="op" id="2217659">(</span><span class="ident" id="2217660">_case</span>&nbsp;<span class="ident" id="2217666">unicode</span><span class="op" id="2217673">.</span><span class="ident" id="2217674">SpecialCase</span><span class="op" id="2217685">,</span>&nbsp;<span class="ident" id="2217687">s</span>&nbsp;<span class="builtintype" id="2217689">string</span><span class="op" id="2217695">)</span>&nbsp;<span class="builtintype" id="2217697">string</span>&nbsp;<span class="op" id="2217704">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217707">return</span>&nbsp;<span class="ident" id="2217714">Map</span><span class="op" id="2217717">(</span><span class="keyword" id="2217718">func</span><span class="op" id="2217722">(</span><span class="ident" id="2217723">r</span>&nbsp;<span class="builtintype" id="2217725">rune</span><span class="op" id="2217729">)</span>&nbsp;<span class="builtintype" id="2217731">rune</span>&nbsp;<span class="op" id="2217736">{</span>&nbsp;<span class="keyword" id="2217738">return</span>&nbsp;<span class="ident" id="2217745">_case</span><span class="op" id="2217750">.</span><span class="ident" id="2217751">ToLower</span><span class="op" id="2217758">(</span><span class="ident" id="2217759">r</span><span class="op" id="2217760">)</span>&nbsp;<span class="op" id="2217762">}</span><span class="op" id="2217763">,</span>&nbsp;<span class="ident" id="2217765">s</span><span class="op" id="2217766">)</span><br>
<span class="lineno"></span><span class="op" id="2217768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2217771">//&nbsp;ToTitleSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2217861">//&nbsp;title&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno">490</span><span class="keyword" id="2217921">func</span>&nbsp;<span class="ident" id="2217926">ToTitleSpecial</span><span class="op" id="2217940">(</span><span class="ident" id="2217941">_case</span>&nbsp;<span class="ident" id="2217947">unicode</span><span class="op" id="2217954">.</span><span class="ident" id="2217955">SpecialCase</span><span class="op" id="2217966">,</span>&nbsp;<span class="ident" id="2217968">s</span>&nbsp;<span class="builtintype" id="2217970">string</span><span class="op" id="2217976">)</span>&nbsp;<span class="builtintype" id="2217978">string</span>&nbsp;<span class="op" id="2217985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217988">return</span>&nbsp;<span class="ident" id="2217995">Map</span><span class="op" id="2217998">(</span><span class="keyword" id="2217999">func</span><span class="op" id="2218003">(</span><span class="ident" id="2218004">r</span>&nbsp;<span class="builtintype" id="2218006">rune</span><span class="op" id="2218010">)</span>&nbsp;<span class="builtintype" id="2218012">rune</span>&nbsp;<span class="op" id="2218017">{</span>&nbsp;<span class="keyword" id="2218019">return</span>&nbsp;<span class="ident" id="2218026">_case</span><span class="op" id="2218031">.</span><span class="ident" id="2218032">ToTitle</span><span class="op" id="2218039">(</span><span class="ident" id="2218040">r</span><span class="op" id="2218041">)</span>&nbsp;<span class="op" id="2218043">}</span><span class="op" id="2218044">,</span>&nbsp;<span class="ident" id="2218046">s</span><span class="op" id="2218047">)</span><br>
<span class="lineno"></span><span class="op" id="2218049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2218052">//&nbsp;isSeparator&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;could&nbsp;mark&nbsp;a&nbsp;word&nbsp;boundary.</span><br>
<span class="lineno">495</span><span class="comment" id="2218120">//&nbsp;TODO:&nbsp;update&nbsp;when&nbsp;package&nbsp;unicode&nbsp;captures&nbsp;more&nbsp;of&nbsp;the&nbsp;properties.</span><br>
<span class="lineno"></span><span class="keyword" id="2218190">func</span>&nbsp;<span class="ident" id="2218195">isSeparator</span><span class="op" id="2218206">(</span><span class="ident" id="2218207">r</span>&nbsp;<span class="builtintype" id="2218209">rune</span><span class="op" id="2218213">)</span>&nbsp;<span class="builtintype" id="2218215">bool</span>&nbsp;<span class="op" id="2218220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2218223">//&nbsp;ASCII&nbsp;alphanumerics&nbsp;and&nbsp;underscore&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218281">if</span>&nbsp;<span class="ident" id="2218284">r</span>&nbsp;<span class="op" id="2218286">&lt;=</span>&nbsp;<span class="num" id="2218289">0x7F</span>&nbsp;<span class="op" id="2218294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218298">switch</span>&nbsp;<span class="op" id="2218305">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218309">case</span>&nbsp;<span class="string" id="2218314">&#39;0&#39;</span>&nbsp;<span class="op" id="2218318">&lt;=</span>&nbsp;<span class="ident" id="2218321">r</span>&nbsp;<span class="op" id="2218323">&amp;&amp;</span>&nbsp;<span class="ident" id="2218326">r</span>&nbsp;<span class="op" id="2218328">&lt;=</span>&nbsp;<span class="string" id="2218331">&#39;9&#39;</span><span class="op" id="2218334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218339">return</span>&nbsp;<span class="builtintype" id="2218346">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218354">case</span>&nbsp;<span class="string" id="2218359">&#39;a&#39;</span>&nbsp;<span class="op" id="2218363">&lt;=</span>&nbsp;<span class="ident" id="2218366">r</span>&nbsp;<span class="op" id="2218368">&amp;&amp;</span>&nbsp;<span class="ident" id="2218371">r</span>&nbsp;<span class="op" id="2218373">&lt;=</span>&nbsp;<span class="string" id="2218376">&#39;z&#39;</span><span class="op" id="2218379">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218384">return</span>&nbsp;<span class="builtintype" id="2218391">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218399">case</span>&nbsp;<span class="string" id="2218404">&#39;A&#39;</span>&nbsp;<span class="op" id="2218408">&lt;=</span>&nbsp;<span class="ident" id="2218411">r</span>&nbsp;<span class="op" id="2218413">&amp;&amp;</span>&nbsp;<span class="ident" id="2218416">r</span>&nbsp;<span class="op" id="2218418">&lt;=</span>&nbsp;<span class="string" id="2218421">&#39;Z&#39;</span><span class="op" id="2218424">:</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218429">return</span>&nbsp;<span class="builtintype" id="2218436">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218444">case</span>&nbsp;<span class="ident" id="2218449">r</span>&nbsp;<span class="op" id="2218451">==</span>&nbsp;<span class="string" id="2218454">&#39;_&#39;</span><span class="op" id="2218457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218462">return</span>&nbsp;<span class="builtintype" id="2218469">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2218477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218481">return</span>&nbsp;<span class="builtintype" id="2218488">true</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2218494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2218497">//&nbsp;Letters&nbsp;and&nbsp;digits&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218539">if</span>&nbsp;<span class="ident" id="2218542">unicode</span><span class="op" id="2218549">.</span><span class="ident" id="2218550">IsLetter</span><span class="op" id="2218558">(</span><span class="ident" id="2218559">r</span><span class="op" id="2218560">)</span>&nbsp;<span class="op" id="2218562">||</span>&nbsp;<span class="ident" id="2218565">unicode</span><span class="op" id="2218572">.</span><span class="ident" id="2218573">IsDigit</span><span class="op" id="2218580">(</span><span class="ident" id="2218581">r</span><span class="op" id="2218582">)</span>&nbsp;<span class="op" id="2218584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218588">return</span>&nbsp;<span class="builtintype" id="2218595">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2218602">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2218605">//&nbsp;Otherwise,&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;for&nbsp;now&nbsp;is&nbsp;treat&nbsp;spaces&nbsp;as&nbsp;separators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218673">return</span>&nbsp;<span class="ident" id="2218680">unicode</span><span class="op" id="2218687">.</span><span class="ident" id="2218688">IsSpace</span><span class="op" id="2218695">(</span><span class="ident" id="2218696">r</span><span class="op" id="2218697">)</span><br>
<span class="lineno"></span><span class="op" id="2218699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2218702">//&nbsp;Title&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;that&nbsp;begin&nbsp;words</span><br>
<span class="lineno">520</span><span class="comment" id="2218784">//&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="comment" id="2218815">//</span><br>
<span class="lineno"></span><span class="comment" id="2218818">//&nbsp;BUG:&nbsp;The&nbsp;rule&nbsp;Title&nbsp;uses&nbsp;for&nbsp;word&nbsp;boundaries&nbsp;does&nbsp;not&nbsp;handle&nbsp;Unicode&nbsp;punctuation&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2218912">func</span>&nbsp;<span class="ident" id="2218917">Title</span><span class="op" id="2218922">(</span><span class="ident" id="2218923">s</span>&nbsp;<span class="builtintype" id="2218925">string</span><span class="op" id="2218931">)</span>&nbsp;<span class="builtintype" id="2218933">string</span>&nbsp;<span class="op" id="2218940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2218943">//&nbsp;Use&nbsp;a&nbsp;closure&nbsp;here&nbsp;to&nbsp;remember&nbsp;state.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2218985">//&nbsp;Hackish&nbsp;but&nbsp;effective.&nbsp;Depends&nbsp;on&nbsp;Map&nbsp;scanning&nbsp;in&nbsp;order&nbsp;and&nbsp;calling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2219057">//&nbsp;the&nbsp;closure&nbsp;once&nbsp;per&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219088">prev</span>&nbsp;<span class="op" id="2219093">:=</span>&nbsp;<span class="string" id="2219096">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219101">return</span>&nbsp;<span class="ident" id="2219108">Map</span><span class="op" id="2219111">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219115">func</span><span class="op" id="2219119">(</span><span class="ident" id="2219120">r</span>&nbsp;<span class="builtintype" id="2219122">rune</span><span class="op" id="2219126">)</span>&nbsp;<span class="builtintype" id="2219128">rune</span>&nbsp;<span class="op" id="2219133">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219138">if</span>&nbsp;<span class="ident" id="2219141">isSeparator</span><span class="op" id="2219152">(</span><span class="ident" id="2219153">prev</span><span class="op" id="2219157">)</span>&nbsp;<span class="op" id="2219159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219165">prev</span>&nbsp;<span class="op" id="2219170">=</span>&nbsp;<span class="ident" id="2219172">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219178">return</span>&nbsp;<span class="ident" id="2219185">unicode</span><span class="op" id="2219192">.</span><span class="ident" id="2219193">ToTitle</span><span class="op" id="2219200">(</span><span class="ident" id="2219201">r</span><span class="op" id="2219202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2219207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219212">prev</span>&nbsp;<span class="op" id="2219217">=</span>&nbsp;<span class="ident" id="2219219">r</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219224">return</span>&nbsp;<span class="ident" id="2219231">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2219235">}</span><span class="op" id="2219236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219240">s</span><span class="op" id="2219241">)</span><br>
<span class="lineno"></span><span class="op" id="2219243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="2219246">//&nbsp;TrimLeftFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2219311">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2219361">func</span>&nbsp;<span class="ident" id="2219366">TrimLeftFunc</span><span class="op" id="2219378">(</span><span class="ident" id="2219379">s</span>&nbsp;<span class="builtintype" id="2219381">string</span><span class="op" id="2219387">,</span>&nbsp;<span class="ident" id="2219389">f</span>&nbsp;<span class="keyword" id="2219391">func</span><span class="op" id="2219395">(</span><span class="builtintype" id="2219396">rune</span><span class="op" id="2219400">)</span>&nbsp;<span class="builtintype" id="2219402">bool</span><span class="op" id="2219406">)</span>&nbsp;<span class="builtintype" id="2219408">string</span>&nbsp;<span class="op" id="2219415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219418">i</span>&nbsp;<span class="op" id="2219420">:=</span>&nbsp;<span class="ident" id="2219423">indexFunc</span><span class="op" id="2219432">(</span><span class="ident" id="2219433">s</span><span class="op" id="2219434">,</span>&nbsp;<span class="ident" id="2219436">f</span><span class="op" id="2219437">,</span>&nbsp;<span class="builtintype" id="2219439">false</span><span class="op" id="2219444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219447">if</span>&nbsp;<span class="ident" id="2219450">i</span>&nbsp;<span class="op" id="2219452">==</span>&nbsp;<span class="op" id="2219455">-</span><span class="num" id="2219456">1</span>&nbsp;<span class="op" id="2219458">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219462">return</span>&nbsp;<span class="string" id="2219469">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2219473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219476">return</span>&nbsp;<span class="ident" id="2219483">s</span><span class="op" id="2219484">[</span><span class="ident" id="2219485">i</span><span class="op" id="2219486">:</span><span class="op" id="2219487">]</span><br>
<span class="lineno"></span><span class="op" id="2219489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span><span class="comment" id="2219492">//&nbsp;TrimRightFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2219559">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2219609">func</span>&nbsp;<span class="ident" id="2219614">TrimRightFunc</span><span class="op" id="2219627">(</span><span class="ident" id="2219628">s</span>&nbsp;<span class="builtintype" id="2219630">string</span><span class="op" id="2219636">,</span>&nbsp;<span class="ident" id="2219638">f</span>&nbsp;<span class="keyword" id="2219640">func</span><span class="op" id="2219644">(</span><span class="builtintype" id="2219645">rune</span><span class="op" id="2219649">)</span>&nbsp;<span class="builtintype" id="2219651">bool</span><span class="op" id="2219655">)</span>&nbsp;<span class="builtintype" id="2219657">string</span>&nbsp;<span class="op" id="2219664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219667">i</span>&nbsp;<span class="op" id="2219669">:=</span>&nbsp;<span class="ident" id="2219672">lastIndexFunc</span><span class="op" id="2219685">(</span><span class="ident" id="2219686">s</span><span class="op" id="2219687">,</span>&nbsp;<span class="ident" id="2219689">f</span><span class="op" id="2219690">,</span>&nbsp;<span class="builtintype" id="2219692">false</span><span class="op" id="2219697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219700">if</span>&nbsp;<span class="ident" id="2219703">i</span>&nbsp;<span class="op" id="2219705">&gt;=</span>&nbsp;<span class="num" id="2219708">0</span>&nbsp;<span class="op" id="2219710">&amp;&amp;</span>&nbsp;<span class="ident" id="2219713">s</span><span class="op" id="2219714">[</span><span class="ident" id="2219715">i</span><span class="op" id="2219716">]</span>&nbsp;<span class="op" id="2219718">&gt;=</span>&nbsp;<span class="ident" id="2219721">utf8</span><span class="op" id="2219725">.</span><span class="ident" id="2219726">RuneSelf</span>&nbsp;<span class="op" id="2219735">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219739">_</span><span class="op" id="2219740">,</span>&nbsp;<span class="ident" id="2219742">wid</span>&nbsp;<span class="op" id="2219746">:=</span>&nbsp;<span class="ident" id="2219749">utf8</span><span class="op" id="2219753">.</span><span class="ident" id="2219754">DecodeRuneInString</span><span class="op" id="2219772">(</span><span class="ident" id="2219773">s</span><span class="op" id="2219774">[</span><span class="ident" id="2219775">i</span><span class="op" id="2219776">:</span><span class="op" id="2219777">]</span><span class="op" id="2219778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219782">i</span>&nbsp;<span class="op" id="2219784">+=</span>&nbsp;<span class="ident" id="2219787">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2219792">}</span>&nbsp;<span class="keyword" id="2219794">else</span>&nbsp;<span class="op" id="2219799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219803">i</span><span class="op" id="2219804">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2219808">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219811">return</span>&nbsp;<span class="ident" id="2219818">s</span><span class="op" id="2219819">[</span><span class="num" id="2219820">0</span><span class="op" id="2219821">:</span><span class="ident" id="2219822">i</span><span class="op" id="2219823">]</span><br>
<span class="lineno"></span><span class="op" id="2219825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2219828">//&nbsp;TrimFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2219889">//&nbsp;and&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno">565</span><span class="keyword" id="2219952">func</span>&nbsp;<span class="ident" id="2219957">TrimFunc</span><span class="op" id="2219965">(</span><span class="ident" id="2219966">s</span>&nbsp;<span class="builtintype" id="2219968">string</span><span class="op" id="2219974">,</span>&nbsp;<span class="ident" id="2219976">f</span>&nbsp;<span class="keyword" id="2219978">func</span><span class="op" id="2219982">(</span><span class="builtintype" id="2219983">rune</span><span class="op" id="2219987">)</span>&nbsp;<span class="builtintype" id="2219989">bool</span><span class="op" id="2219993">)</span>&nbsp;<span class="builtintype" id="2219995">string</span>&nbsp;<span class="op" id="2220002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2220005">return</span>&nbsp;<span class="ident" id="2220012">TrimRightFunc</span><span class="op" id="2220025">(</span><span class="ident" id="2220026">TrimLeftFunc</span><span class="op" id="2220038">(</span><span class="ident" id="2220039">s</span><span class="op" id="2220040">,</span>&nbsp;<span class="ident" id="2220042">f</span><span class="op" id="2220043">)</span><span class="op" id="2220044">,</span>&nbsp;<span class="ident" id="2220046">f</span><span class="op" id="2220047">)</span><br>
<span class="lineno"></span><span class="op" id="2220049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2220052">//&nbsp;IndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;first&nbsp;Unicode</span><br>
<span class="lineno">570</span><span class="comment" id="2220111">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2220160">func</span>&nbsp;<span class="ident" id="2220165">IndexFunc</span><span class="op" id="2220174">(</span><span class="ident" id="2220175">s</span>&nbsp;<span class="builtintype" id="2220177">string</span><span class="op" id="2220183">,</span>&nbsp;<span class="ident" id="2220185">f</span>&nbsp;<span class="keyword" id="2220187">func</span><span class="op" id="2220191">(</span><span class="builtintype" id="2220192">rune</span><span class="op" id="2220196">)</span>&nbsp;<span class="builtintype" id="2220198">bool</span><span class="op" id="2220202">)</span>&nbsp;<span class="builtintype" id="2220204">int</span>&nbsp;<span class="op" id="2220208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2220211">return</span>&nbsp;<span class="ident" id="2220218">indexFunc</span><span class="op" id="2220227">(</span><span class="ident" id="2220228">s</span><span class="op" id="2220229">,</span>&nbsp;<span class="ident" id="2220231">f</span><span class="op" id="2220232">,</span>&nbsp;<span class="builtintype" id="2220234">true</span><span class="op" id="2220238">)</span><br>
<span class="lineno"></span><span class="op" id="2220240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="2220243">//&nbsp;LastIndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span><span class="comment" id="2220297">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2220354">func</span>&nbsp;<span class="ident" id="2220359">LastIndexFunc</span><span class="op" id="2220372">(</span><span class="ident" id="2220373">s</span>&nbsp;<span class="builtintype" id="2220375">string</span><span class="op" id="2220381">,</span>&nbsp;<span class="ident" id="2220383">f</span>&nbsp;<span class="keyword" id="2220385">func</span><span class="op" id="2220389">(</span><span class="builtintype" id="2220390">rune</span><span class="op" id="2220394">)</span>&nbsp;<span class="builtintype" id="2220396">bool</span><span class="op" id="2220400">)</span>&nbsp;<span class="builtintype" id="2220402">int</span>&nbsp;<span class="op" id="2220406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2220409">return</span>&nbsp;<span class="ident" id="2220416">lastIndexFunc</span><span class="op" id="2220429">(</span><span class="ident" id="2220430">s</span><span class="op" id="2220431">,</span>&nbsp;<span class="ident" id="2220433">f</span><span class="op" id="2220434">,</span>&nbsp;<span class="builtintype" id="2220436">true</span><span class="op" id="2220440">)</span><br>
<span class="lineno"></span><span class="op" id="2220442">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span><span class="comment" id="2220445">//&nbsp;indexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;IndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2220498">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2220554">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2220567">func</span>&nbsp;<span class="ident" id="2220572">indexFunc</span><span class="op" id="2220581">(</span><span class="ident" id="2220582">s</span>&nbsp;<span class="builtintype" id="2220584">string</span><span class="op" id="2220590">,</span>&nbsp;<span class="ident" id="2220592">f</span>&nbsp;<span class="keyword" id="2220594">func</span><span class="op" id="2220598">(</span><span class="builtintype" id="2220599">rune</span><span class="op" id="2220603">)</span>&nbsp;<span class="builtintype" id="2220605">bool</span><span class="op" id="2220609">,</span>&nbsp;<span class="ident" id="2220611">truth</span>&nbsp;<span class="builtintype" id="2220617">bool</span><span class="op" id="2220621">)</span>&nbsp;<span class="builtintype" id="2220623">int</span>&nbsp;<span class="op" id="2220627">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2220630">start</span>&nbsp;<span class="op" id="2220636">:=</span>&nbsp;<span class="num" id="2220639">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2220642">for</span>&nbsp;<span class="ident" id="2220646">start</span>&nbsp;<span class="op" id="2220652">&lt;</span>&nbsp;<span class="builtinfunc" id="2220654">len</span><span class="op" id="2220657">(</span><span class="ident" id="2220658">s</span><span class="op" id="2220659">)</span>&nbsp;<span class="op" id="2220661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2220665">wid</span>&nbsp;<span class="op" id="2220669">:=</span>&nbsp;<span class="num" id="2220672">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2220676">r</span>&nbsp;<span class="op" id="2220678">:=</span>&nbsp;<span class="builtintype" id="2220681">rune</span><span class="op" id="2220685">(</span><span class="ident" id="2220686">s</span><span class="op" id="2220687">[</span><span class="ident" id="2220688">start</span><span class="op" id="2220693">]</span><span class="op" id="2220694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2220698">if</span>&nbsp;<span class="ident" id="2220701">r</span>&nbsp;<span class="op" id="2220703">&gt;=</span>&nbsp;<span class="ident" id="2220706">utf8</span><span class="op" id="2220710">.</span><span class="ident" id="2220711">RuneSelf</span>&nbsp;<span class="op" id="2220720">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2220725">r</span><span class="op" id="2220726">,</span>&nbsp;<span class="ident" id="2220728">wid</span>&nbsp;<span class="op" id="2220732">=</span>&nbsp;<span class="ident" id="2220734">utf8</span><span class="op" id="2220738">.</span><span class="ident" id="2220739">DecodeRuneInString</span><span class="op" id="2220757">(</span><span class="ident" id="2220758">s</span><span class="op" id="2220759">[</span><span class="ident" id="2220760">start</span><span class="op" id="2220765">:</span><span class="op" id="2220766">]</span><span class="op" id="2220767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2220771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2220775">if</span>&nbsp;<span class="ident" id="2220778">f</span><span class="op" id="2220779">(</span><span class="ident" id="2220780">r</span><span class="op" id="2220781">)</span>&nbsp;<span class="op" id="2220783">==</span>&nbsp;<span class="ident" id="2220786">truth</span>&nbsp;<span class="op" id="2220792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2220797">return</span>&nbsp;<span class="ident" id="2220804">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2220812">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2220816">start</span>&nbsp;<span class="op" id="2220822">+=</span>&nbsp;<span class="ident" id="2220825">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2220830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2220833">return</span>&nbsp;<span class="op" id="2220840">-</span><span class="num" id="2220841">1</span><br>
<span class="lineno"></span><span class="op" id="2220843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="2220846">//&nbsp;lastIndexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;LastIndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2220907">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2220963">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2220976">func</span>&nbsp;<span class="ident" id="2220981">lastIndexFunc</span><span class="op" id="2220994">(</span><span class="ident" id="2220995">s</span>&nbsp;<span class="builtintype" id="2220997">string</span><span class="op" id="2221003">,</span>&nbsp;<span class="ident" id="2221005">f</span>&nbsp;<span class="keyword" id="2221007">func</span><span class="op" id="2221011">(</span><span class="builtintype" id="2221012">rune</span><span class="op" id="2221016">)</span>&nbsp;<span class="builtintype" id="2221018">bool</span><span class="op" id="2221022">,</span>&nbsp;<span class="ident" id="2221024">truth</span>&nbsp;<span class="builtintype" id="2221030">bool</span><span class="op" id="2221034">)</span>&nbsp;<span class="builtintype" id="2221036">int</span>&nbsp;<span class="op" id="2221040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221043">for</span>&nbsp;<span class="ident" id="2221047">i</span>&nbsp;<span class="op" id="2221049">:=</span>&nbsp;<span class="builtinfunc" id="2221052">len</span><span class="op" id="2221055">(</span><span class="ident" id="2221056">s</span><span class="op" id="2221057">)</span><span class="op" id="2221058">;</span>&nbsp;<span class="ident" id="2221060">i</span>&nbsp;<span class="op" id="2221062">&gt;</span>&nbsp;<span class="num" id="2221064">0</span><span class="op" id="2221065">;</span>&nbsp;<span class="op" id="2221067">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2221071">r</span><span class="op" id="2221072">,</span>&nbsp;<span class="ident" id="2221074">size</span>&nbsp;<span class="op" id="2221079">:=</span>&nbsp;<span class="ident" id="2221082">utf8</span><span class="op" id="2221086">.</span><span class="ident" id="2221087">DecodeLastRuneInString</span><span class="op" id="2221109">(</span><span class="ident" id="2221110">s</span><span class="op" id="2221111">[</span><span class="num" id="2221112">0</span><span class="op" id="2221113">:</span><span class="ident" id="2221114">i</span><span class="op" id="2221115">]</span><span class="op" id="2221116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2221120">i</span>&nbsp;<span class="op" id="2221122">-=</span>&nbsp;<span class="ident" id="2221125">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221132">if</span>&nbsp;<span class="ident" id="2221135">f</span><span class="op" id="2221136">(</span><span class="ident" id="2221137">r</span><span class="op" id="2221138">)</span>&nbsp;<span class="op" id="2221140">==</span>&nbsp;<span class="ident" id="2221143">truth</span>&nbsp;<span class="op" id="2221149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221154">return</span>&nbsp;<span class="ident" id="2221161">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2221165">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2221168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221171">return</span>&nbsp;<span class="op" id="2221178">-</span><span class="num" id="2221179">1</span><br>
<span class="lineno"></span><span class="op" id="2221181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2221184">func</span>&nbsp;<span class="ident" id="2221189">makeCutsetFunc</span><span class="op" id="2221203">(</span><span class="ident" id="2221204">cutset</span>&nbsp;<span class="builtintype" id="2221211">string</span><span class="op" id="2221217">)</span>&nbsp;<span class="keyword" id="2221219">func</span><span class="op" id="2221223">(</span><span class="builtintype" id="2221224">rune</span><span class="op" id="2221228">)</span>&nbsp;<span class="builtintype" id="2221230">bool</span>&nbsp;<span class="op" id="2221235">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221238">return</span>&nbsp;<span class="keyword" id="2221245">func</span><span class="op" id="2221249">(</span><span class="ident" id="2221250">r</span>&nbsp;<span class="builtintype" id="2221252">rune</span><span class="op" id="2221256">)</span>&nbsp;<span class="builtintype" id="2221258">bool</span>&nbsp;<span class="op" id="2221263">{</span>&nbsp;<span class="keyword" id="2221265">return</span>&nbsp;<span class="ident" id="2221272">IndexRune</span><span class="op" id="2221281">(</span><span class="ident" id="2221282">cutset</span><span class="op" id="2221288">,</span>&nbsp;<span class="ident" id="2221290">r</span><span class="op" id="2221291">)</span>&nbsp;<span class="op" id="2221293">&gt;=</span>&nbsp;<span class="num" id="2221296">0</span>&nbsp;<span class="op" id="2221298">}</span><br>
<span class="lineno"></span><span class="op" id="2221300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2221303">//&nbsp;Trim&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2221364">//&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno">620</span><span class="keyword" id="2221425">func</span>&nbsp;<span class="ident" id="2221430">Trim</span><span class="op" id="2221434">(</span><span class="ident" id="2221435">s</span>&nbsp;<span class="builtintype" id="2221437">string</span><span class="op" id="2221443">,</span>&nbsp;<span class="ident" id="2221445">cutset</span>&nbsp;<span class="builtintype" id="2221452">string</span><span class="op" id="2221458">)</span>&nbsp;<span class="builtintype" id="2221460">string</span>&nbsp;<span class="op" id="2221467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221470">if</span>&nbsp;<span class="ident" id="2221473">s</span>&nbsp;<span class="op" id="2221475">==</span>&nbsp;<span class="string" id="2221478">&#34;&#34;</span>&nbsp;<span class="op" id="2221481">||</span>&nbsp;<span class="ident" id="2221484">cutset</span>&nbsp;<span class="op" id="2221491">==</span>&nbsp;<span class="string" id="2221494">&#34;&#34;</span>&nbsp;<span class="op" id="2221497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221501">return</span>&nbsp;<span class="ident" id="2221508">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2221511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221514">return</span>&nbsp;<span class="ident" id="2221521">TrimFunc</span><span class="op" id="2221529">(</span><span class="ident" id="2221530">s</span><span class="op" id="2221531">,</span>&nbsp;<span class="ident" id="2221533">makeCutsetFunc</span><span class="op" id="2221547">(</span><span class="ident" id="2221548">cutset</span><span class="op" id="2221554">)</span><span class="op" id="2221555">)</span><br>
<span class="lineno">625</span><span class="op" id="2221557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2221560">//&nbsp;TrimLeft&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2221621">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2221673">func</span>&nbsp;<span class="ident" id="2221678">TrimLeft</span><span class="op" id="2221686">(</span><span class="ident" id="2221687">s</span>&nbsp;<span class="builtintype" id="2221689">string</span><span class="op" id="2221695">,</span>&nbsp;<span class="ident" id="2221697">cutset</span>&nbsp;<span class="builtintype" id="2221704">string</span><span class="op" id="2221710">)</span>&nbsp;<span class="builtintype" id="2221712">string</span>&nbsp;<span class="op" id="2221719">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221722">if</span>&nbsp;<span class="ident" id="2221725">s</span>&nbsp;<span class="op" id="2221727">==</span>&nbsp;<span class="string" id="2221730">&#34;&#34;</span>&nbsp;<span class="op" id="2221733">||</span>&nbsp;<span class="ident" id="2221736">cutset</span>&nbsp;<span class="op" id="2221743">==</span>&nbsp;<span class="string" id="2221746">&#34;&#34;</span>&nbsp;<span class="op" id="2221749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221753">return</span>&nbsp;<span class="ident" id="2221760">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2221763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221766">return</span>&nbsp;<span class="ident" id="2221773">TrimLeftFunc</span><span class="op" id="2221785">(</span><span class="ident" id="2221786">s</span><span class="op" id="2221787">,</span>&nbsp;<span class="ident" id="2221789">makeCutsetFunc</span><span class="op" id="2221803">(</span><span class="ident" id="2221804">cutset</span><span class="op" id="2221810">)</span><span class="op" id="2221811">)</span><br>
<span class="lineno"></span><span class="op" id="2221813">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span><span class="comment" id="2221816">//&nbsp;TrimRight&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2221880">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2221932">func</span>&nbsp;<span class="ident" id="2221937">TrimRight</span><span class="op" id="2221946">(</span><span class="ident" id="2221947">s</span>&nbsp;<span class="builtintype" id="2221949">string</span><span class="op" id="2221955">,</span>&nbsp;<span class="ident" id="2221957">cutset</span>&nbsp;<span class="builtintype" id="2221964">string</span><span class="op" id="2221970">)</span>&nbsp;<span class="builtintype" id="2221972">string</span>&nbsp;<span class="op" id="2221979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221982">if</span>&nbsp;<span class="ident" id="2221985">s</span>&nbsp;<span class="op" id="2221987">==</span>&nbsp;<span class="string" id="2221990">&#34;&#34;</span>&nbsp;<span class="op" id="2221993">||</span>&nbsp;<span class="ident" id="2221996">cutset</span>&nbsp;<span class="op" id="2222003">==</span>&nbsp;<span class="string" id="2222006">&#34;&#34;</span>&nbsp;<span class="op" id="2222009">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222013">return</span>&nbsp;<span class="ident" id="2222020">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2222023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222026">return</span>&nbsp;<span class="ident" id="2222033">TrimRightFunc</span><span class="op" id="2222046">(</span><span class="ident" id="2222047">s</span><span class="op" id="2222048">,</span>&nbsp;<span class="ident" id="2222050">makeCutsetFunc</span><span class="op" id="2222064">(</span><span class="ident" id="2222065">cutset</span><span class="op" id="2222071">)</span><span class="op" id="2222072">)</span><br>
<span class="lineno"></span><span class="op" id="2222074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span><span class="comment" id="2222077">//&nbsp;TrimSpace&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2222140">//&nbsp;and&nbsp;trailing&nbsp;white&nbsp;space&nbsp;removed,&nbsp;as&nbsp;defined&nbsp;by&nbsp;Unicode.</span><br>
<span class="lineno"></span><span class="keyword" id="2222200">func</span>&nbsp;<span class="ident" id="2222205">TrimSpace</span><span class="op" id="2222214">(</span><span class="ident" id="2222215">s</span>&nbsp;<span class="builtintype" id="2222217">string</span><span class="op" id="2222223">)</span>&nbsp;<span class="builtintype" id="2222225">string</span>&nbsp;<span class="op" id="2222232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222235">return</span>&nbsp;<span class="ident" id="2222242">TrimFunc</span><span class="op" id="2222250">(</span><span class="ident" id="2222251">s</span><span class="op" id="2222252">,</span>&nbsp;<span class="ident" id="2222254">unicode</span><span class="op" id="2222261">.</span><span class="ident" id="2222262">IsSpace</span><span class="op" id="2222269">)</span><br>
<span class="lineno"></span><span class="op" id="2222271">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span><span class="comment" id="2222274">//&nbsp;TrimPrefix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;leading&nbsp;prefix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2222342">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;start&nbsp;with&nbsp;prefix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2222402">func</span>&nbsp;<span class="ident" id="2222407">TrimPrefix</span><span class="op" id="2222417">(</span><span class="ident" id="2222418">s</span><span class="op" id="2222419">,</span>&nbsp;<span class="ident" id="2222421">prefix</span>&nbsp;<span class="builtintype" id="2222428">string</span><span class="op" id="2222434">)</span>&nbsp;<span class="builtintype" id="2222436">string</span>&nbsp;<span class="op" id="2222443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222446">if</span>&nbsp;<span class="ident" id="2222449">HasPrefix</span><span class="op" id="2222458">(</span><span class="ident" id="2222459">s</span><span class="op" id="2222460">,</span>&nbsp;<span class="ident" id="2222462">prefix</span><span class="op" id="2222468">)</span>&nbsp;<span class="op" id="2222470">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222474">return</span>&nbsp;<span class="ident" id="2222481">s</span><span class="op" id="2222482">[</span><span class="builtinfunc" id="2222483">len</span><span class="op" id="2222486">(</span><span class="ident" id="2222487">prefix</span><span class="op" id="2222493">)</span><span class="op" id="2222494">:</span><span class="op" id="2222495">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2222498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222501">return</span>&nbsp;<span class="ident" id="2222508">s</span><br>
<span class="lineno"></span><span class="op" id="2222510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="2222513">//&nbsp;TrimSuffix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;trailing&nbsp;suffix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2222582">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;end&nbsp;with&nbsp;suffix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2222640">func</span>&nbsp;<span class="ident" id="2222645">TrimSuffix</span><span class="op" id="2222655">(</span><span class="ident" id="2222656">s</span><span class="op" id="2222657">,</span>&nbsp;<span class="ident" id="2222659">suffix</span>&nbsp;<span class="builtintype" id="2222666">string</span><span class="op" id="2222672">)</span>&nbsp;<span class="builtintype" id="2222674">string</span>&nbsp;<span class="op" id="2222681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222684">if</span>&nbsp;<span class="ident" id="2222687">HasSuffix</span><span class="op" id="2222696">(</span><span class="ident" id="2222697">s</span><span class="op" id="2222698">,</span>&nbsp;<span class="ident" id="2222700">suffix</span><span class="op" id="2222706">)</span>&nbsp;<span class="op" id="2222708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222712">return</span>&nbsp;<span class="ident" id="2222719">s</span><span class="op" id="2222720">[</span><span class="op" id="2222721">:</span><span class="builtinfunc" id="2222722">len</span><span class="op" id="2222725">(</span><span class="ident" id="2222726">s</span><span class="op" id="2222727">)</span><span class="op" id="2222728">-</span><span class="builtinfunc" id="2222729">len</span><span class="op" id="2222732">(</span><span class="ident" id="2222733">suffix</span><span class="op" id="2222739">)</span><span class="op" id="2222740">]</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2222743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2222746">return</span>&nbsp;<span class="ident" id="2222753">s</span><br>
<span class="lineno"></span><span class="op" id="2222755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2222758">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;the&nbsp;first&nbsp;n</span><br>
<span class="lineno">670</span><span class="comment" id="2222817">//&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;old&nbsp;replaced&nbsp;by&nbsp;new.</span><br>
<span class="lineno"></span><span class="comment" id="2222870">//&nbsp;If&nbsp;old&nbsp;is&nbsp;empty,&nbsp;it&nbsp;matches&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2222932">//&nbsp;and&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence,&nbsp;yielding&nbsp;up&nbsp;to&nbsp;k+1&nbsp;replacements</span><br>
<span class="lineno"></span><span class="comment" id="2222998">//&nbsp;for&nbsp;a&nbsp;k-rune&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2223022">//&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno">675</span><span class="keyword" id="2223084">func</span>&nbsp;<span class="ident" id="2223089">Replace</span><span class="op" id="2223096">(</span><span class="ident" id="2223097">s</span><span class="op" id="2223098">,</span>&nbsp;<span class="ident" id="2223100">old</span><span class="op" id="2223103">,</span>&nbsp;<span class="builtinfunc" id="2223105">new</span>&nbsp;<span class="builtintype" id="2223109">string</span><span class="op" id="2223115">,</span>&nbsp;<span class="ident" id="2223117">n</span>&nbsp;<span class="builtintype" id="2223119">int</span><span class="op" id="2223122">)</span>&nbsp;<span class="builtintype" id="2223124">string</span>&nbsp;<span class="op" id="2223131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223134">if</span>&nbsp;<span class="ident" id="2223137">old</span>&nbsp;<span class="op" id="2223141">==</span>&nbsp;<span class="builtinfunc" id="2223144">new</span>&nbsp;<span class="op" id="2223148">||</span>&nbsp;<span class="ident" id="2223151">n</span>&nbsp;<span class="op" id="2223153">==</span>&nbsp;<span class="num" id="2223156">0</span>&nbsp;<span class="op" id="2223158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223162">return</span>&nbsp;<span class="ident" id="2223169">s</span>&nbsp;<span class="comment" id="2223171">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2223192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2223196">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223232">if</span>&nbsp;<span class="ident" id="2223235">m</span>&nbsp;<span class="op" id="2223237">:=</span>&nbsp;<span class="ident" id="2223240">Count</span><span class="op" id="2223245">(</span><span class="ident" id="2223246">s</span><span class="op" id="2223247">,</span>&nbsp;<span class="ident" id="2223249">old</span><span class="op" id="2223252">)</span><span class="op" id="2223253">;</span>&nbsp;<span class="ident" id="2223255">m</span>&nbsp;<span class="op" id="2223257">==</span>&nbsp;<span class="num" id="2223260">0</span>&nbsp;<span class="op" id="2223262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223266">return</span>&nbsp;<span class="ident" id="2223273">s</span>&nbsp;<span class="comment" id="2223275">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2223296">}</span>&nbsp;<span class="keyword" id="2223298">else</span>&nbsp;<span class="keyword" id="2223303">if</span>&nbsp;<span class="ident" id="2223306">n</span>&nbsp;<span class="op" id="2223308">&lt;</span>&nbsp;<span class="num" id="2223310">0</span>&nbsp;<span class="op" id="2223312">||</span>&nbsp;<span class="ident" id="2223315">m</span>&nbsp;<span class="op" id="2223317">&lt;</span>&nbsp;<span class="ident" id="2223319">n</span>&nbsp;<span class="op" id="2223321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223325">n</span>&nbsp;<span class="op" id="2223327">=</span>&nbsp;<span class="ident" id="2223329">m</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2223332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2223336">//&nbsp;Apply&nbsp;replacements&nbsp;to&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223370">t</span>&nbsp;<span class="op" id="2223372">:=</span>&nbsp;<span class="builtinfunc" id="2223375">make</span><span class="op" id="2223379">(</span><span class="op" id="2223380">[</span><span class="op" id="2223381">]</span><span class="builtintype" id="2223382">byte</span><span class="op" id="2223386">,</span>&nbsp;<span class="builtinfunc" id="2223388">len</span><span class="op" id="2223391">(</span><span class="ident" id="2223392">s</span><span class="op" id="2223393">)</span><span class="op" id="2223394">+</span><span class="ident" id="2223395">n</span><span class="op" id="2223396">*</span><span class="op" id="2223397">(</span><span class="builtinfunc" id="2223398">len</span><span class="op" id="2223401">(</span><span class="builtinfunc" id="2223402">new</span><span class="op" id="2223405">)</span><span class="op" id="2223406">-</span><span class="builtinfunc" id="2223407">len</span><span class="op" id="2223410">(</span><span class="ident" id="2223411">old</span><span class="op" id="2223414">)</span><span class="op" id="2223415">)</span><span class="op" id="2223416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223419">w</span>&nbsp;<span class="op" id="2223421">:=</span>&nbsp;<span class="num" id="2223424">0</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223427">start</span>&nbsp;<span class="op" id="2223433">:=</span>&nbsp;<span class="num" id="2223436">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223439">for</span>&nbsp;<span class="ident" id="2223443">i</span>&nbsp;<span class="op" id="2223445">:=</span>&nbsp;<span class="num" id="2223448">0</span><span class="op" id="2223449">;</span>&nbsp;<span class="ident" id="2223451">i</span>&nbsp;<span class="op" id="2223453">&lt;</span>&nbsp;<span class="ident" id="2223455">n</span><span class="op" id="2223456">;</span>&nbsp;<span class="ident" id="2223458">i</span><span class="op" id="2223459">++</span>&nbsp;<span class="op" id="2223462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223466">j</span>&nbsp;<span class="op" id="2223468">:=</span>&nbsp;<span class="ident" id="2223471">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223479">if</span>&nbsp;<span class="builtinfunc" id="2223482">len</span><span class="op" id="2223485">(</span><span class="ident" id="2223486">old</span><span class="op" id="2223489">)</span>&nbsp;<span class="op" id="2223491">==</span>&nbsp;<span class="num" id="2223494">0</span>&nbsp;<span class="op" id="2223496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223501">if</span>&nbsp;<span class="ident" id="2223504">i</span>&nbsp;<span class="op" id="2223506">&gt;</span>&nbsp;<span class="num" id="2223508">0</span>&nbsp;<span class="op" id="2223510">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223516">_</span><span class="op" id="2223517">,</span>&nbsp;<span class="ident" id="2223519">wid</span>&nbsp;<span class="op" id="2223523">:=</span>&nbsp;<span class="ident" id="2223526">utf8</span><span class="op" id="2223530">.</span><span class="ident" id="2223531">DecodeRuneInString</span><span class="op" id="2223549">(</span><span class="ident" id="2223550">s</span><span class="op" id="2223551">[</span><span class="ident" id="2223552">start</span><span class="op" id="2223557">:</span><span class="op" id="2223558">]</span><span class="op" id="2223559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223565">j</span>&nbsp;<span class="op" id="2223567">+=</span>&nbsp;<span class="ident" id="2223570">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2223577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2223581">}</span>&nbsp;<span class="keyword" id="2223583">else</span>&nbsp;<span class="op" id="2223588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223593">j</span>&nbsp;<span class="op" id="2223595">+=</span>&nbsp;<span class="ident" id="2223598">Index</span><span class="op" id="2223603">(</span><span class="ident" id="2223604">s</span><span class="op" id="2223605">[</span><span class="ident" id="2223606">start</span><span class="op" id="2223611">:</span><span class="op" id="2223612">]</span><span class="op" id="2223613">,</span>&nbsp;<span class="ident" id="2223615">old</span><span class="op" id="2223618">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2223622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223626">w</span>&nbsp;<span class="op" id="2223628">+=</span>&nbsp;<span class="builtinfunc" id="2223631">copy</span><span class="op" id="2223635">(</span><span class="ident" id="2223636">t</span><span class="op" id="2223637">[</span><span class="ident" id="2223638">w</span><span class="op" id="2223639">:</span><span class="op" id="2223640">]</span><span class="op" id="2223641">,</span>&nbsp;<span class="ident" id="2223643">s</span><span class="op" id="2223644">[</span><span class="ident" id="2223645">start</span><span class="op" id="2223650">:</span><span class="ident" id="2223651">j</span><span class="op" id="2223652">]</span><span class="op" id="2223653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223657">w</span>&nbsp;<span class="op" id="2223659">+=</span>&nbsp;<span class="builtinfunc" id="2223662">copy</span><span class="op" id="2223666">(</span><span class="ident" id="2223667">t</span><span class="op" id="2223668">[</span><span class="ident" id="2223669">w</span><span class="op" id="2223670">:</span><span class="op" id="2223671">]</span><span class="op" id="2223672">,</span>&nbsp;<span class="builtinfunc" id="2223674">new</span><span class="op" id="2223677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223681">start</span>&nbsp;<span class="op" id="2223687">=</span>&nbsp;<span class="ident" id="2223689">j</span>&nbsp;<span class="op" id="2223691">+</span>&nbsp;<span class="builtinfunc" id="2223693">len</span><span class="op" id="2223696">(</span><span class="ident" id="2223697">old</span><span class="op" id="2223700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2223703">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223706">w</span>&nbsp;<span class="op" id="2223708">+=</span>&nbsp;<span class="builtinfunc" id="2223711">copy</span><span class="op" id="2223715">(</span><span class="ident" id="2223716">t</span><span class="op" id="2223717">[</span><span class="ident" id="2223718">w</span><span class="op" id="2223719">:</span><span class="op" id="2223720">]</span><span class="op" id="2223721">,</span>&nbsp;<span class="ident" id="2223723">s</span><span class="op" id="2223724">[</span><span class="ident" id="2223725">start</span><span class="op" id="2223730">:</span><span class="op" id="2223731">]</span><span class="op" id="2223732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223735">return</span>&nbsp;<span class="builtintype" id="2223742">string</span><span class="op" id="2223748">(</span><span class="ident" id="2223749">t</span><span class="op" id="2223750">[</span><span class="num" id="2223751">0</span><span class="op" id="2223752">:</span><span class="ident" id="2223753">w</span><span class="op" id="2223754">]</span><span class="op" id="2223755">)</span><br>
<span class="lineno"></span><span class="op" id="2223757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2223760">//&nbsp;EqualFold&nbsp;reports&nbsp;whether&nbsp;s&nbsp;and&nbsp;t,&nbsp;interpreted&nbsp;as&nbsp;UTF-8&nbsp;strings,</span><br>
<span class="lineno">710</span><span class="comment" id="2223828">//&nbsp;are&nbsp;equal&nbsp;under&nbsp;Unicode&nbsp;case-folding.</span><br>
<span class="lineno"></span><span class="keyword" id="2223869">func</span>&nbsp;<span class="ident" id="2223874">EqualFold</span><span class="op" id="2223883">(</span><span class="ident" id="2223884">s</span><span class="op" id="2223885">,</span>&nbsp;<span class="ident" id="2223887">t</span>&nbsp;<span class="builtintype" id="2223889">string</span><span class="op" id="2223895">)</span>&nbsp;<span class="builtintype" id="2223897">bool</span>&nbsp;<span class="op" id="2223902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223905">for</span>&nbsp;<span class="ident" id="2223909">s</span>&nbsp;<span class="op" id="2223911">!=</span>&nbsp;<span class="string" id="2223914">&#34;&#34;</span>&nbsp;<span class="op" id="2223917">&amp;&amp;</span>&nbsp;<span class="ident" id="2223920">t</span>&nbsp;<span class="op" id="2223922">!=</span>&nbsp;<span class="string" id="2223925">&#34;&#34;</span>&nbsp;<span class="op" id="2223928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2223932">//&nbsp;Extract&nbsp;first&nbsp;rune&nbsp;from&nbsp;each&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223974">var</span>&nbsp;<span class="ident" id="2223978">sr</span><span class="op" id="2223980">,</span>&nbsp;<span class="ident" id="2223982">tr</span>&nbsp;<span class="builtintype" id="2223985">rune</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223992">if</span>&nbsp;<span class="ident" id="2223995">s</span><span class="op" id="2223996">[</span><span class="num" id="2223997">0</span><span class="op" id="2223998">]</span>&nbsp;<span class="op" id="2224000">&lt;</span>&nbsp;<span class="ident" id="2224002">utf8</span><span class="op" id="2224006">.</span><span class="ident" id="2224007">RuneSelf</span>&nbsp;<span class="op" id="2224016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224021">sr</span><span class="op" id="2224023">,</span>&nbsp;<span class="ident" id="2224025">s</span>&nbsp;<span class="op" id="2224027">=</span>&nbsp;<span class="builtintype" id="2224029">rune</span><span class="op" id="2224033">(</span><span class="ident" id="2224034">s</span><span class="op" id="2224035">[</span><span class="num" id="2224036">0</span><span class="op" id="2224037">]</span><span class="op" id="2224038">)</span><span class="op" id="2224039">,</span>&nbsp;<span class="ident" id="2224041">s</span><span class="op" id="2224042">[</span><span class="num" id="2224043">1</span><span class="op" id="2224044">:</span><span class="op" id="2224045">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224049">}</span>&nbsp;<span class="keyword" id="2224051">else</span>&nbsp;<span class="op" id="2224056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224061">r</span><span class="op" id="2224062">,</span>&nbsp;<span class="ident" id="2224064">size</span>&nbsp;<span class="op" id="2224069">:=</span>&nbsp;<span class="ident" id="2224072">utf8</span><span class="op" id="2224076">.</span><span class="ident" id="2224077">DecodeRuneInString</span><span class="op" id="2224095">(</span><span class="ident" id="2224096">s</span><span class="op" id="2224097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224102">sr</span><span class="op" id="2224104">,</span>&nbsp;<span class="ident" id="2224106">s</span>&nbsp;<span class="op" id="2224108">=</span>&nbsp;<span class="ident" id="2224110">r</span><span class="op" id="2224111">,</span>&nbsp;<span class="ident" id="2224113">s</span><span class="op" id="2224114">[</span><span class="ident" id="2224115">size</span><span class="op" id="2224119">:</span><span class="op" id="2224120">]</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224128">if</span>&nbsp;<span class="ident" id="2224131">t</span><span class="op" id="2224132">[</span><span class="num" id="2224133">0</span><span class="op" id="2224134">]</span>&nbsp;<span class="op" id="2224136">&lt;</span>&nbsp;<span class="ident" id="2224138">utf8</span><span class="op" id="2224142">.</span><span class="ident" id="2224143">RuneSelf</span>&nbsp;<span class="op" id="2224152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224157">tr</span><span class="op" id="2224159">,</span>&nbsp;<span class="ident" id="2224161">t</span>&nbsp;<span class="op" id="2224163">=</span>&nbsp;<span class="builtintype" id="2224165">rune</span><span class="op" id="2224169">(</span><span class="ident" id="2224170">t</span><span class="op" id="2224171">[</span><span class="num" id="2224172">0</span><span class="op" id="2224173">]</span><span class="op" id="2224174">)</span><span class="op" id="2224175">,</span>&nbsp;<span class="ident" id="2224177">t</span><span class="op" id="2224178">[</span><span class="num" id="2224179">1</span><span class="op" id="2224180">:</span><span class="op" id="2224181">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224185">}</span>&nbsp;<span class="keyword" id="2224187">else</span>&nbsp;<span class="op" id="2224192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224197">r</span><span class="op" id="2224198">,</span>&nbsp;<span class="ident" id="2224200">size</span>&nbsp;<span class="op" id="2224205">:=</span>&nbsp;<span class="ident" id="2224208">utf8</span><span class="op" id="2224212">.</span><span class="ident" id="2224213">DecodeRuneInString</span><span class="op" id="2224231">(</span><span class="ident" id="2224232">t</span><span class="op" id="2224233">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224238">tr</span><span class="op" id="2224240">,</span>&nbsp;<span class="ident" id="2224242">t</span>&nbsp;<span class="op" id="2224244">=</span>&nbsp;<span class="ident" id="2224246">r</span><span class="op" id="2224247">,</span>&nbsp;<span class="ident" id="2224249">t</span><span class="op" id="2224250">[</span><span class="ident" id="2224251">size</span><span class="op" id="2224255">:</span><span class="op" id="2224256">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224265">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;keep&nbsp;going;&nbsp;if&nbsp;not,&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224320">//&nbsp;Easy&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224336">if</span>&nbsp;<span class="ident" id="2224339">tr</span>&nbsp;<span class="op" id="2224342">==</span>&nbsp;<span class="ident" id="2224345">sr</span>&nbsp;<span class="op" id="2224348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224353">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224369">//&nbsp;Make&nbsp;sr&nbsp;&lt;&nbsp;tr&nbsp;to&nbsp;simplify&nbsp;what&nbsp;follows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224413">if</span>&nbsp;<span class="ident" id="2224416">tr</span>&nbsp;<span class="op" id="2224419">&lt;</span>&nbsp;<span class="ident" id="2224421">sr</span>&nbsp;<span class="op" id="2224424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224429">tr</span><span class="op" id="2224431">,</span>&nbsp;<span class="ident" id="2224433">sr</span>&nbsp;<span class="op" id="2224436">=</span>&nbsp;<span class="ident" id="2224438">sr</span><span class="op" id="2224440">,</span>&nbsp;<span class="ident" id="2224442">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224451">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;ASCII.</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224478">if</span>&nbsp;<span class="ident" id="2224481">tr</span>&nbsp;<span class="op" id="2224484">&lt;</span>&nbsp;<span class="ident" id="2224486">utf8</span><span class="op" id="2224490">.</span><span class="ident" id="2224491">RuneSelf</span>&nbsp;<span class="op" id="2224500">&amp;&amp;</span>&nbsp;<span class="string" id="2224503">&#39;A&#39;</span>&nbsp;<span class="op" id="2224507">&lt;=</span>&nbsp;<span class="ident" id="2224510">sr</span>&nbsp;<span class="op" id="2224513">&amp;&amp;</span>&nbsp;<span class="ident" id="2224516">sr</span>&nbsp;<span class="op" id="2224519">&lt;=</span>&nbsp;<span class="string" id="2224522">&#39;Z&#39;</span>&nbsp;<span class="op" id="2224526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224531">//&nbsp;ASCII,&nbsp;and&nbsp;sr&nbsp;is&nbsp;upper&nbsp;case.&nbsp;&nbsp;tr&nbsp;must&nbsp;be&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224590">if</span>&nbsp;<span class="ident" id="2224593">tr</span>&nbsp;<span class="op" id="2224596">==</span>&nbsp;<span class="ident" id="2224599">sr</span><span class="op" id="2224601">+</span><span class="string" id="2224602">&#39;a&#39;</span><span class="op" id="2224605">-</span><span class="string" id="2224606">&#39;A&#39;</span>&nbsp;<span class="op" id="2224610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224616">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224628">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224633">return</span>&nbsp;<span class="builtintype" id="2224640">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224653">//&nbsp;General&nbsp;case.&nbsp;&nbsp;SimpleFold(x)&nbsp;returns&nbsp;the&nbsp;next&nbsp;equivalent&nbsp;rune&nbsp;&gt;&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224724">//&nbsp;or&nbsp;wraps&nbsp;around&nbsp;to&nbsp;smaller&nbsp;values.</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224764">r</span>&nbsp;<span class="op" id="2224766">:=</span>&nbsp;<span class="ident" id="2224769">unicode</span><span class="op" id="2224776">.</span><span class="ident" id="2224777">SimpleFold</span><span class="op" id="2224787">(</span><span class="ident" id="2224788">sr</span><span class="op" id="2224790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224794">for</span>&nbsp;<span class="ident" id="2224798">r</span>&nbsp;<span class="op" id="2224800">!=</span>&nbsp;<span class="ident" id="2224803">sr</span>&nbsp;<span class="op" id="2224806">&amp;&amp;</span>&nbsp;<span class="ident" id="2224809">r</span>&nbsp;<span class="op" id="2224811">&lt;</span>&nbsp;<span class="ident" id="2224813">tr</span>&nbsp;<span class="op" id="2224816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224821">r</span>&nbsp;<span class="op" id="2224823">=</span>&nbsp;<span class="ident" id="2224825">unicode</span><span class="op" id="2224832">.</span><span class="ident" id="2224833">SimpleFold</span><span class="op" id="2224843">(</span><span class="ident" id="2224844">r</span><span class="op" id="2224845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224853">if</span>&nbsp;<span class="ident" id="2224856">r</span>&nbsp;<span class="op" id="2224858">==</span>&nbsp;<span class="ident" id="2224861">tr</span>&nbsp;<span class="op" id="2224864">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224869">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224884">return</span>&nbsp;<span class="builtintype" id="2224891">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224902">//&nbsp;One&nbsp;string&nbsp;is&nbsp;empty.&nbsp;&nbsp;Are&nbsp;both?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224938">return</span>&nbsp;<span class="ident" id="2224945">s</span>&nbsp;<span class="op" id="2224947">==</span>&nbsp;<span class="ident" id="2224950">t</span><br>
<span class="lineno"></span><span class="op" id="2224952">}</span>
</div>
</body>
</html>
