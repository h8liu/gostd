<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html" class="current">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3377412">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3377468">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3377522">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3377573">//&nbsp;Package&nbsp;json&nbsp;implements&nbsp;encoding&nbsp;and&nbsp;decoding&nbsp;of&nbsp;JSON&nbsp;objects&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3377652">//&nbsp;RFC&nbsp;4627.&nbsp;The&nbsp;mapping&nbsp;between&nbsp;JSON&nbsp;objects&nbsp;and&nbsp;Go&nbsp;values&nbsp;is&nbsp;described</span><br>
<span class="lineno"></span><span class="comment" id="3377725">//&nbsp;in&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Marshal&nbsp;and&nbsp;Unmarshal&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="3377790">//</span><br>
<span class="lineno"></span><span class="comment" id="3377793">//&nbsp;See&nbsp;&#34;JSON&nbsp;and&nbsp;Go&#34;&nbsp;for&nbsp;an&nbsp;introduction&nbsp;to&nbsp;this&nbsp;package:</span><br>
<span class="lineno">10</span><span class="comment" id="3377851">//&nbsp;http://golang.org/doc/articles/json_and_go.html</span><br>
<span class="lineno"></span><span class="keyword" id="3377902">package</span>&nbsp;<span class="ident" id="3377910">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3377916">import</span>&nbsp;<span class="op" id="3377923">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3377926">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3377935">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3377947">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3377966">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3377974">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3377985">&#34;runtime&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3377996">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3378004">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3378015">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3378026">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3378034">&#34;unicode&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3378045">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3378060">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3378063">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="3378106">//</span><br>
<span class="lineno">30</span><span class="comment" id="3378109">//&nbsp;Marshal&nbsp;traverses&nbsp;the&nbsp;value&nbsp;v&nbsp;recursively.</span><br>
<span class="lineno"></span><span class="comment" id="3378155">//&nbsp;If&nbsp;an&nbsp;encountered&nbsp;value&nbsp;implements&nbsp;the&nbsp;Marshaler&nbsp;interface</span><br>
<span class="lineno"></span><span class="comment" id="3378217">//&nbsp;and&nbsp;is&nbsp;not&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;Marshal&nbsp;calls&nbsp;its&nbsp;MarshalJSON&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="3378283">//&nbsp;to&nbsp;produce&nbsp;JSON.&nbsp;&nbsp;The&nbsp;nil&nbsp;pointer&nbsp;exception&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary</span><br>
<span class="lineno"></span><span class="comment" id="3378356">//&nbsp;but&nbsp;mimics&nbsp;a&nbsp;similar,&nbsp;necessary&nbsp;exception&nbsp;in&nbsp;the&nbsp;behavior&nbsp;of</span><br>
<span class="lineno">35</span><span class="comment" id="3378420">//&nbsp;UnmarshalJSON.</span><br>
<span class="lineno"></span><span class="comment" id="3378438">//</span><br>
<span class="lineno"></span><span class="comment" id="3378441">//&nbsp;Otherwise,&nbsp;Marshal&nbsp;uses&nbsp;the&nbsp;following&nbsp;type-dependent&nbsp;default&nbsp;encodings:</span><br>
<span class="lineno"></span><span class="comment" id="3378516">//</span><br>
<span class="lineno"></span><span class="comment" id="3378519">//&nbsp;Boolean&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;booleans.</span><br>
<span class="lineno">40</span><span class="comment" id="3378562">//</span><br>
<span class="lineno"></span><span class="comment" id="3378565">//&nbsp;Floating&nbsp;point,&nbsp;integer,&nbsp;and&nbsp;Number&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;numbers.</span><br>
<span class="lineno"></span><span class="comment" id="3378635">//</span><br>
<span class="lineno"></span><span class="comment" id="3378638">//&nbsp;String&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;strings&nbsp;coerced&nbsp;to&nbsp;valid&nbsp;UTF-8,</span><br>
<span class="lineno"></span><span class="comment" id="3378702">//&nbsp;replacing&nbsp;invalid&nbsp;bytes&nbsp;with&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;rune.</span><br>
<span class="lineno">45</span><span class="comment" id="3378764">//&nbsp;The&nbsp;angle&nbsp;brackets&nbsp;&#34;&lt;&#34;&nbsp;and&nbsp;&#34;&gt;&#34;&nbsp;are&nbsp;escaped&nbsp;to&nbsp;&#34;\u003c&#34;&nbsp;and&nbsp;&#34;\u003e&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3378835">//&nbsp;to&nbsp;keep&nbsp;some&nbsp;browsers&nbsp;from&nbsp;misinterpreting&nbsp;JSON&nbsp;output&nbsp;as&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="3378902">//&nbsp;Ampersand&nbsp;&#34;&amp;&#34;&nbsp;is&nbsp;also&nbsp;escaped&nbsp;to&nbsp;&#34;\u0026&#34;&nbsp;for&nbsp;the&nbsp;same&nbsp;reason.</span><br>
<span class="lineno"></span><span class="comment" id="3378968">//</span><br>
<span class="lineno"></span><span class="comment" id="3378971">//&nbsp;Array&nbsp;and&nbsp;slice&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;arrays,&nbsp;except&nbsp;that</span><br>
<span class="lineno">50</span><span class="comment" id="3379032">//&nbsp;[]byte&nbsp;encodes&nbsp;as&nbsp;a&nbsp;base64-encoded&nbsp;string,&nbsp;and&nbsp;a&nbsp;nil&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3379094">//&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="3379130">//</span><br>
<span class="lineno"></span><span class="comment" id="3379133">//&nbsp;Struct&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;objects.&nbsp;Each&nbsp;exported&nbsp;struct&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="3379201">//&nbsp;becomes&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;object&nbsp;unless</span><br>
<span class="lineno">55</span><span class="comment" id="3379242">//&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;field&#39;s&nbsp;tag&nbsp;is&nbsp;&#34;-&#34;,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3379276">//&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;field&nbsp;is&nbsp;empty&nbsp;and&nbsp;its&nbsp;tag&nbsp;specifies&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option.</span><br>
<span class="lineno"></span><span class="comment" id="3379348">//&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="3379386">//&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or&nbsp;string&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3379461">//&nbsp;length&nbsp;zero.&nbsp;The&nbsp;object&#39;s&nbsp;default&nbsp;key&nbsp;string&nbsp;is&nbsp;the&nbsp;struct&nbsp;field&nbsp;name</span><br>
<span class="lineno">60</span><span class="comment" id="3379534">//&nbsp;but&nbsp;can&nbsp;be&nbsp;specified&nbsp;in&nbsp;the&nbsp;struct&nbsp;field&#39;s&nbsp;tag&nbsp;value.&nbsp;The&nbsp;&#34;json&#34;&nbsp;key&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3379609">//&nbsp;the&nbsp;struct&nbsp;field&#39;s&nbsp;tag&nbsp;value&nbsp;is&nbsp;the&nbsp;key&nbsp;name,&nbsp;followed&nbsp;by&nbsp;an&nbsp;optional&nbsp;comma</span><br>
<span class="lineno"></span><span class="comment" id="3379688">//&nbsp;and&nbsp;options.&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3379714">//</span><br>
<span class="lineno"></span><span class="comment" id="3379717">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;this&nbsp;package.</span><br>
<span class="lineno">65</span><span class="comment" id="3379759">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="3379785">//</span><br>
<span class="lineno"></span><span class="comment" id="3379788">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;myName&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3379835">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;myName&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="3379866">//</span><br>
<span class="lineno">70</span><span class="comment" id="3379869">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;myName&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3379919">//&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;field&nbsp;is&nbsp;omitted&nbsp;from&nbsp;the&nbsp;object&nbsp;if&nbsp;its&nbsp;value&nbsp;is&nbsp;empty,</span><br>
<span class="lineno"></span><span class="comment" id="3379987">//&nbsp;&nbsp;&nbsp;//&nbsp;as&nbsp;defined&nbsp;above.</span><br>
<span class="lineno"></span><span class="comment" id="3380013">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;myName,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="3380054">//</span><br>
<span class="lineno">75</span><span class="comment" id="3380057">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;Field&#34;&nbsp;(the&nbsp;default),&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="3380121">//&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;field&nbsp;is&nbsp;skipped&nbsp;if&nbsp;empty.</span><br>
<span class="lineno"></span><span class="comment" id="3380160">//&nbsp;&nbsp;&nbsp;//&nbsp;Note&nbsp;the&nbsp;leading&nbsp;comma.</span><br>
<span class="lineno"></span><span class="comment" id="3380192">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="3380227">//</span><br>
<span class="lineno">80</span><span class="comment" id="3380230">//&nbsp;The&nbsp;&#34;string&#34;&nbsp;option&nbsp;signals&nbsp;that&nbsp;a&nbsp;field&nbsp;is&nbsp;stored&nbsp;as&nbsp;JSON&nbsp;inside&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3380301">//&nbsp;JSON-encoded&nbsp;string.&nbsp;It&nbsp;applies&nbsp;only&nbsp;to&nbsp;fields&nbsp;of&nbsp;string,&nbsp;floating&nbsp;point,</span><br>
<span class="lineno"></span><span class="comment" id="3380378">//&nbsp;or&nbsp;integer&nbsp;types.&nbsp;This&nbsp;extra&nbsp;level&nbsp;of&nbsp;encoding&nbsp;is&nbsp;sometimes&nbsp;used&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3380451">//&nbsp;communicating&nbsp;with&nbsp;JavaScript&nbsp;programs:</span><br>
<span class="lineno"></span><span class="comment" id="3380494">//</span><br>
<span class="lineno">85</span><span class="comment" id="3380497">//&nbsp;&nbsp;&nbsp;&nbsp;Int64String&nbsp;int64&nbsp;`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="3380538">//</span><br>
<span class="lineno"></span><span class="comment" id="3380541">//&nbsp;The&nbsp;key&nbsp;name&nbsp;will&nbsp;be&nbsp;used&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;non-empty&nbsp;string&nbsp;consisting&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3380611">//&nbsp;only&nbsp;Unicode&nbsp;letters,&nbsp;digits,&nbsp;dollar&nbsp;signs,&nbsp;percent&nbsp;signs,&nbsp;hyphens,</span><br>
<span class="lineno"></span><span class="comment" id="3380682">//&nbsp;underscores&nbsp;and&nbsp;slashes.</span><br>
<span class="lineno">90</span><span class="comment" id="3380710">//</span><br>
<span class="lineno"></span><span class="comment" id="3380713">//&nbsp;Anonymous&nbsp;struct&nbsp;fields&nbsp;are&nbsp;usually&nbsp;marshaled&nbsp;as&nbsp;if&nbsp;their&nbsp;inner&nbsp;exported&nbsp;fields</span><br>
<span class="lineno"></span><span class="comment" id="3380796">//&nbsp;were&nbsp;fields&nbsp;in&nbsp;the&nbsp;outer&nbsp;struct,&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;Go&nbsp;visibility&nbsp;rules&nbsp;amended</span><br>
<span class="lineno"></span><span class="comment" id="3380881">//&nbsp;as&nbsp;described&nbsp;in&nbsp;the&nbsp;next&nbsp;paragraph.</span><br>
<span class="lineno"></span><span class="comment" id="3380920">//&nbsp;An&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;given&nbsp;in&nbsp;its&nbsp;JSON&nbsp;tag&nbsp;is&nbsp;treated&nbsp;as</span><br>
<span class="lineno">95</span><span class="comment" id="3380997">//&nbsp;having&nbsp;that&nbsp;name,&nbsp;rather&nbsp;than&nbsp;being&nbsp;anonymous.</span><br>
<span class="lineno"></span><span class="comment" id="3381047">//&nbsp;An&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;of&nbsp;interface&nbsp;type&nbsp;is&nbsp;treated&nbsp;the&nbsp;same&nbsp;as&nbsp;having</span><br>
<span class="lineno"></span><span class="comment" id="3381124">//&nbsp;that&nbsp;type&nbsp;as&nbsp;its&nbsp;name,&nbsp;rather&nbsp;than&nbsp;being&nbsp;anonymous.</span><br>
<span class="lineno"></span><span class="comment" id="3381179">//</span><br>
<span class="lineno"></span><span class="comment" id="3381182">//&nbsp;The&nbsp;Go&nbsp;visibility&nbsp;rules&nbsp;for&nbsp;struct&nbsp;fields&nbsp;are&nbsp;amended&nbsp;for&nbsp;JSON&nbsp;when</span><br>
<span class="lineno">100</span><span class="comment" id="3381253">//&nbsp;deciding&nbsp;which&nbsp;field&nbsp;to&nbsp;marshal&nbsp;or&nbsp;unmarshal.&nbsp;If&nbsp;there&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3381315">//&nbsp;multiple&nbsp;fields&nbsp;at&nbsp;the&nbsp;same&nbsp;level,&nbsp;and&nbsp;that&nbsp;level&nbsp;is&nbsp;the&nbsp;least</span><br>
<span class="lineno"></span><span class="comment" id="3381381">//&nbsp;nested&nbsp;(and&nbsp;would&nbsp;therefore&nbsp;be&nbsp;the&nbsp;nesting&nbsp;level&nbsp;selected&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3381449">//&nbsp;usual&nbsp;Go&nbsp;rules),&nbsp;the&nbsp;following&nbsp;extra&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="3381502">//</span><br>
<span class="lineno">105</span><span class="comment" id="3381505">//&nbsp;1)&nbsp;Of&nbsp;those&nbsp;fields,&nbsp;if&nbsp;any&nbsp;are&nbsp;JSON-tagged,&nbsp;only&nbsp;tagged&nbsp;fields&nbsp;are&nbsp;considered,</span><br>
<span class="lineno"></span><span class="comment" id="3381587">//&nbsp;even&nbsp;if&nbsp;there&nbsp;are&nbsp;multiple&nbsp;untagged&nbsp;fields&nbsp;that&nbsp;would&nbsp;otherwise&nbsp;conflict.</span><br>
<span class="lineno"></span><span class="comment" id="3381664">//&nbsp;2)&nbsp;If&nbsp;there&nbsp;is&nbsp;exactly&nbsp;one&nbsp;field&nbsp;(tagged&nbsp;or&nbsp;not&nbsp;according&nbsp;to&nbsp;the&nbsp;first&nbsp;rule),&nbsp;that&nbsp;is&nbsp;selected.</span><br>
<span class="lineno"></span><span class="comment" id="3381763">//&nbsp;3)&nbsp;Otherwise&nbsp;there&nbsp;are&nbsp;multiple&nbsp;fields,&nbsp;and&nbsp;all&nbsp;are&nbsp;ignored;&nbsp;no&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="comment" id="3381844">//</span><br>
<span class="lineno">110</span><span class="comment" id="3381847">//&nbsp;Handling&nbsp;of&nbsp;anonymous&nbsp;struct&nbsp;fields&nbsp;is&nbsp;new&nbsp;in&nbsp;Go&nbsp;1.1.</span><br>
<span class="lineno"></span><span class="comment" id="3381904">//&nbsp;Prior&nbsp;to&nbsp;Go&nbsp;1.1,&nbsp;anonymous&nbsp;struct&nbsp;fields&nbsp;were&nbsp;ignored.&nbsp;To&nbsp;force&nbsp;ignoring&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3381983">//&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;in&nbsp;both&nbsp;current&nbsp;and&nbsp;earlier&nbsp;versions,&nbsp;give&nbsp;the&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="3382065">//&nbsp;a&nbsp;JSON&nbsp;tag&nbsp;of&nbsp;&#34;-&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3382087">//</span><br>
<span class="lineno">115</span><span class="comment" id="3382090">//&nbsp;Map&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;objects.</span><br>
<span class="lineno"></span><span class="comment" id="3382128">//&nbsp;The&nbsp;map&#39;s&nbsp;key&nbsp;type&nbsp;must&nbsp;be&nbsp;string;&nbsp;the&nbsp;object&nbsp;keys&nbsp;are&nbsp;used&nbsp;directly</span><br>
<span class="lineno"></span><span class="comment" id="3382200">//&nbsp;as&nbsp;map&nbsp;keys.</span><br>
<span class="lineno"></span><span class="comment" id="3382216">//</span><br>
<span class="lineno"></span><span class="comment" id="3382219">//&nbsp;Pointer&nbsp;values&nbsp;encode&nbsp;as&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to.</span><br>
<span class="lineno">120</span><span class="comment" id="3382269">//&nbsp;A&nbsp;nil&nbsp;pointer&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="3382319">//</span><br>
<span class="lineno"></span><span class="comment" id="3382322">//&nbsp;Interface&nbsp;values&nbsp;encode&nbsp;as&nbsp;the&nbsp;value&nbsp;contained&nbsp;in&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="3382390">//&nbsp;A&nbsp;nil&nbsp;interface&nbsp;value&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="3382448">//</span><br>
<span class="lineno">125</span><span class="comment" id="3382451">//&nbsp;Channel,&nbsp;complex,&nbsp;and&nbsp;function&nbsp;values&nbsp;cannot&nbsp;be&nbsp;encoded&nbsp;in&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="comment" id="3382519">//&nbsp;Attempting&nbsp;to&nbsp;encode&nbsp;such&nbsp;a&nbsp;value&nbsp;causes&nbsp;Marshal&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3382581">//&nbsp;an&nbsp;UnsupportedTypeError.</span><br>
<span class="lineno"></span><span class="comment" id="3382609">//</span><br>
<span class="lineno"></span><span class="comment" id="3382612">//&nbsp;JSON&nbsp;cannot&nbsp;represent&nbsp;cyclic&nbsp;data&nbsp;structures&nbsp;and&nbsp;Marshal&nbsp;does&nbsp;not</span><br>
<span class="lineno">130</span><span class="comment" id="3382681">//&nbsp;handle&nbsp;them.&nbsp;&nbsp;Passing&nbsp;cyclic&nbsp;structures&nbsp;to&nbsp;Marshal&nbsp;will&nbsp;result&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3382750">//&nbsp;an&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span><span class="comment" id="3382776">//</span><br>
<span class="lineno"></span><span class="keyword" id="3382779">func</span>&nbsp;<span class="ident" id="3382784">Marshal</span><span class="op" id="3382791">(</span><span class="ident" id="3382792">v</span>&nbsp;<span class="keyword" id="3382794">interface</span><span class="op" id="3382803">{</span><span class="op" id="3382804">}</span><span class="op" id="3382805">)</span>&nbsp;<span class="op" id="3382807">(</span><span class="op" id="3382808">[</span><span class="op" id="3382809">]</span><span class="builtintype" id="3382810">byte</span><span class="op" id="3382814">,</span>&nbsp;<span class="builtintype" id="3382816">error</span><span class="op" id="3382821">)</span>&nbsp;<span class="op" id="3382823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3382826">e</span>&nbsp;<span class="op" id="3382828">:=</span>&nbsp;<span class="op" id="3382831">&amp;</span><span class="ident" id="3382832">encodeState</span><span class="op" id="3382843">{</span><span class="op" id="3382844">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3382847">err</span>&nbsp;<span class="op" id="3382851">:=</span>&nbsp;<span class="ident" id="3382854">e</span><span class="op" id="3382855">.</span><span class="ident" id="3382856">marshal</span><span class="op" id="3382863">(</span><span class="ident" id="3382864">v</span><span class="op" id="3382865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382868">if</span>&nbsp;<span class="ident" id="3382871">err</span>&nbsp;<span class="op" id="3382875">!=</span>&nbsp;<span class="builtintype" id="3382878">nil</span>&nbsp;<span class="op" id="3382882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382886">return</span>&nbsp;<span class="builtintype" id="3382893">nil</span><span class="op" id="3382896">,</span>&nbsp;<span class="ident" id="3382898">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3382903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3382906">return</span>&nbsp;<span class="ident" id="3382913">e</span><span class="op" id="3382914">.</span><span class="ident" id="3382915">Bytes</span><span class="op" id="3382920">(</span><span class="op" id="3382921">)</span><span class="op" id="3382922">,</span>&nbsp;<span class="builtintype" id="3382924">nil</span><br>
<span class="lineno">140</span><span class="op" id="3382928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3382931">//&nbsp;MarshalIndent&nbsp;is&nbsp;like&nbsp;Marshal&nbsp;but&nbsp;applies&nbsp;Indent&nbsp;to&nbsp;format&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="3383005">func</span>&nbsp;<span class="ident" id="3383010">MarshalIndent</span><span class="op" id="3383023">(</span><span class="ident" id="3383024">v</span>&nbsp;<span class="keyword" id="3383026">interface</span><span class="op" id="3383035">{</span><span class="op" id="3383036">}</span><span class="op" id="3383037">,</span>&nbsp;<span class="ident" id="3383039">prefix</span><span class="op" id="3383045">,</span>&nbsp;<span class="ident" id="3383047">indent</span>&nbsp;<span class="builtintype" id="3383054">string</span><span class="op" id="3383060">)</span>&nbsp;<span class="op" id="3383062">(</span><span class="op" id="3383063">[</span><span class="op" id="3383064">]</span><span class="builtintype" id="3383065">byte</span><span class="op" id="3383069">,</span>&nbsp;<span class="builtintype" id="3383071">error</span><span class="op" id="3383076">)</span>&nbsp;<span class="op" id="3383078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3383081">b</span><span class="op" id="3383082">,</span>&nbsp;<span class="ident" id="3383084">err</span>&nbsp;<span class="op" id="3383088">:=</span>&nbsp;<span class="ident" id="3383091">Marshal</span><span class="op" id="3383098">(</span><span class="ident" id="3383099">v</span><span class="op" id="3383100">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3383103">if</span>&nbsp;<span class="ident" id="3383106">err</span>&nbsp;<span class="op" id="3383110">!=</span>&nbsp;<span class="builtintype" id="3383113">nil</span>&nbsp;<span class="op" id="3383117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3383121">return</span>&nbsp;<span class="builtintype" id="3383128">nil</span><span class="op" id="3383131">,</span>&nbsp;<span class="ident" id="3383133">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3383138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3383141">var</span>&nbsp;<span class="ident" id="3383145">buf</span>&nbsp;<span class="ident" id="3383149">bytes</span><span class="op" id="3383154">.</span><span class="ident" id="3383155">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3383163">err</span>&nbsp;<span class="op" id="3383167">=</span>&nbsp;<span class="ident" id="3383169">Indent</span><span class="op" id="3383175">(</span><span class="op" id="3383176">&amp;</span><span class="ident" id="3383177">buf</span><span class="op" id="3383180">,</span>&nbsp;<span class="ident" id="3383182">b</span><span class="op" id="3383183">,</span>&nbsp;<span class="ident" id="3383185">prefix</span><span class="op" id="3383191">,</span>&nbsp;<span class="ident" id="3383193">indent</span><span class="op" id="3383199">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3383202">if</span>&nbsp;<span class="ident" id="3383205">err</span>&nbsp;<span class="op" id="3383209">!=</span>&nbsp;<span class="builtintype" id="3383212">nil</span>&nbsp;<span class="op" id="3383216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3383220">return</span>&nbsp;<span class="builtintype" id="3383227">nil</span><span class="op" id="3383230">,</span>&nbsp;<span class="ident" id="3383232">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3383237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3383240">return</span>&nbsp;<span class="ident" id="3383247">buf</span><span class="op" id="3383250">.</span><span class="ident" id="3383251">Bytes</span><span class="op" id="3383256">(</span><span class="op" id="3383257">)</span><span class="op" id="3383258">,</span>&nbsp;<span class="builtintype" id="3383260">nil</span><br>
<span class="lineno"></span><span class="op" id="3383264">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="3383267">//&nbsp;HTMLEscape&nbsp;appends&nbsp;to&nbsp;dst&nbsp;the&nbsp;JSON-encoded&nbsp;src&nbsp;with&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;U+2028&nbsp;and&nbsp;U+2029</span><br>
<span class="lineno"></span><span class="comment" id="3383349">//&nbsp;characters&nbsp;inside&nbsp;string&nbsp;literals&nbsp;changed&nbsp;to&nbsp;\u003c,&nbsp;\u003e,&nbsp;\u0026,&nbsp;\u2028,&nbsp;\u2029</span><br>
<span class="lineno"></span><span class="comment" id="3383436">//&nbsp;so&nbsp;that&nbsp;the&nbsp;JSON&nbsp;will&nbsp;be&nbsp;safe&nbsp;to&nbsp;embed&nbsp;inside&nbsp;HTML&nbsp;&lt;script&gt;&nbsp;tags.</span><br>
<span class="lineno"></span><span class="comment" id="3383505">//&nbsp;For&nbsp;historical&nbsp;reasons,&nbsp;web&nbsp;browsers&nbsp;don&#39;t&nbsp;honor&nbsp;standard&nbsp;HTML</span><br>
<span class="lineno">160</span><span class="comment" id="3383571">//&nbsp;escaping&nbsp;within&nbsp;&lt;script&gt;&nbsp;tags,&nbsp;so&nbsp;an&nbsp;alternative&nbsp;JSON&nbsp;encoding&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="3383642">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3383654">func</span>&nbsp;<span class="ident" id="3383659">HTMLEscape</span><span class="op" id="3383669">(</span><span class="ident" id="3383670">dst</span>&nbsp;<span class="op" id="3383674">*</span><span class="ident" id="3383675">bytes</span><span class="op" id="3383680">.</span><span class="ident" id="3383681">Buffer</span><span class="op" id="3383687">,</span>&nbsp;<span class="ident" id="3383689">src</span>&nbsp;<span class="op" id="3383693">[</span><span class="op" id="3383694">]</span><span class="builtintype" id="3383695">byte</span><span class="op" id="3383699">)</span>&nbsp;<span class="op" id="3383701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3383704">//&nbsp;The&nbsp;characters&nbsp;can&nbsp;only&nbsp;appear&nbsp;in&nbsp;string&nbsp;literals,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3383759">//&nbsp;so&nbsp;just&nbsp;scan&nbsp;the&nbsp;string&nbsp;one&nbsp;byte&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3383807">start</span>&nbsp;<span class="op" id="3383813">:=</span>&nbsp;<span class="num" id="3383816">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3383819">for</span>&nbsp;<span class="ident" id="3383823">i</span><span class="op" id="3383824">,</span>&nbsp;<span class="ident" id="3383826">c</span>&nbsp;<span class="op" id="3383828">:=</span>&nbsp;<span class="keyword" id="3383831">range</span>&nbsp;<span class="ident" id="3383837">src</span>&nbsp;<span class="op" id="3383841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3383845">if</span>&nbsp;<span class="ident" id="3383848">c</span>&nbsp;<span class="op" id="3383850">==</span>&nbsp;<span class="string" id="3383853">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="3383857">||</span>&nbsp;<span class="ident" id="3383860">c</span>&nbsp;<span class="op" id="3383862">==</span>&nbsp;<span class="string" id="3383865">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="3383869">||</span>&nbsp;<span class="ident" id="3383872">c</span>&nbsp;<span class="op" id="3383874">==</span>&nbsp;<span class="string" id="3383877">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="3383881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3383886">if</span>&nbsp;<span class="ident" id="3383889">start</span>&nbsp;<span class="op" id="3383895">&lt;</span>&nbsp;<span class="ident" id="3383897">i</span>&nbsp;<span class="op" id="3383899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3383905">dst</span><span class="op" id="3383908">.</span><span class="ident" id="3383909">Write</span><span class="op" id="3383914">(</span><span class="ident" id="3383915">src</span><span class="op" id="3383918">[</span><span class="ident" id="3383919">start</span><span class="op" id="3383924">:</span><span class="ident" id="3383925">i</span><span class="op" id="3383926">]</span><span class="op" id="3383927">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3383932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3383937">dst</span><span class="op" id="3383940">.</span><span class="ident" id="3383941">WriteString</span><span class="op" id="3383952">(</span><span class="string" id="3383953">`\u00`</span><span class="op" id="3383959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3383964">dst</span><span class="op" id="3383967">.</span><span class="ident" id="3383968">WriteByte</span><span class="op" id="3383977">(</span><span class="ident" id="3383978">hex</span><span class="op" id="3383981">[</span><span class="ident" id="3383982">c</span><span class="op" id="3383983">&gt;&gt;</span><span class="num" id="3383985">4</span><span class="op" id="3383986">]</span><span class="op" id="3383987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3383992">dst</span><span class="op" id="3383995">.</span><span class="ident" id="3383996">WriteByte</span><span class="op" id="3384005">(</span><span class="ident" id="3384006">hex</span><span class="op" id="3384009">[</span><span class="ident" id="3384010">c</span><span class="op" id="3384011">&amp;</span><span class="num" id="3384012">0xF</span><span class="op" id="3384015">]</span><span class="op" id="3384016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384021">start</span>&nbsp;<span class="op" id="3384027">=</span>&nbsp;<span class="ident" id="3384029">i</span>&nbsp;<span class="op" id="3384031">+</span>&nbsp;<span class="num" id="3384033">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3384041">//&nbsp;Convert&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;(E2&nbsp;80&nbsp;A8&nbsp;and&nbsp;E2&nbsp;80&nbsp;A9).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384097">if</span>&nbsp;<span class="ident" id="3384100">c</span>&nbsp;<span class="op" id="3384102">==</span>&nbsp;<span class="num" id="3384105">0xE2</span>&nbsp;<span class="op" id="3384110">&amp;&amp;</span>&nbsp;<span class="ident" id="3384113">i</span><span class="op" id="3384114">+</span><span class="num" id="3384115">2</span>&nbsp;<span class="op" id="3384117">&lt;</span>&nbsp;<span class="builtinfunc" id="3384119">len</span><span class="op" id="3384122">(</span><span class="ident" id="3384123">src</span><span class="op" id="3384126">)</span>&nbsp;<span class="op" id="3384128">&amp;&amp;</span>&nbsp;<span class="ident" id="3384131">src</span><span class="op" id="3384134">[</span><span class="ident" id="3384135">i</span><span class="op" id="3384136">+</span><span class="num" id="3384137">1</span><span class="op" id="3384138">]</span>&nbsp;<span class="op" id="3384140">==</span>&nbsp;<span class="num" id="3384143">0x80</span>&nbsp;<span class="op" id="3384148">&amp;&amp;</span>&nbsp;<span class="ident" id="3384151">src</span><span class="op" id="3384154">[</span><span class="ident" id="3384155">i</span><span class="op" id="3384156">+</span><span class="num" id="3384157">2</span><span class="op" id="3384158">]</span><span class="op" id="3384159">&amp;^</span><span class="num" id="3384161">1</span>&nbsp;<span class="op" id="3384163">==</span>&nbsp;<span class="num" id="3384166">0xA8</span>&nbsp;<span class="op" id="3384171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384176">if</span>&nbsp;<span class="ident" id="3384179">start</span>&nbsp;<span class="op" id="3384185">&lt;</span>&nbsp;<span class="ident" id="3384187">i</span>&nbsp;<span class="op" id="3384189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384195">dst</span><span class="op" id="3384198">.</span><span class="ident" id="3384199">Write</span><span class="op" id="3384204">(</span><span class="ident" id="3384205">src</span><span class="op" id="3384208">[</span><span class="ident" id="3384209">start</span><span class="op" id="3384214">:</span><span class="ident" id="3384215">i</span><span class="op" id="3384216">]</span><span class="op" id="3384217">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384227">dst</span><span class="op" id="3384230">.</span><span class="ident" id="3384231">WriteString</span><span class="op" id="3384242">(</span><span class="string" id="3384243">`\u202`</span><span class="op" id="3384250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384255">dst</span><span class="op" id="3384258">.</span><span class="ident" id="3384259">WriteByte</span><span class="op" id="3384268">(</span><span class="ident" id="3384269">hex</span><span class="op" id="3384272">[</span><span class="ident" id="3384273">src</span><span class="op" id="3384276">[</span><span class="ident" id="3384277">i</span><span class="op" id="3384278">+</span><span class="num" id="3384279">2</span><span class="op" id="3384280">]</span><span class="op" id="3384281">&amp;</span><span class="num" id="3384282">0xF</span><span class="op" id="3384285">]</span><span class="op" id="3384286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384291">start</span>&nbsp;<span class="op" id="3384297">=</span>&nbsp;<span class="ident" id="3384299">i</span>&nbsp;<span class="op" id="3384301">+</span>&nbsp;<span class="num" id="3384303">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384307">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384313">if</span>&nbsp;<span class="ident" id="3384316">start</span>&nbsp;<span class="op" id="3384322">&lt;</span>&nbsp;<span class="builtinfunc" id="3384324">len</span><span class="op" id="3384327">(</span><span class="ident" id="3384328">src</span><span class="op" id="3384331">)</span>&nbsp;<span class="op" id="3384333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384337">dst</span><span class="op" id="3384340">.</span><span class="ident" id="3384341">Write</span><span class="op" id="3384346">(</span><span class="ident" id="3384347">src</span><span class="op" id="3384350">[</span><span class="ident" id="3384351">start</span><span class="op" id="3384356">:</span><span class="op" id="3384357">]</span><span class="op" id="3384358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384361">}</span><br>
<span class="lineno"></span><span class="op" id="3384363">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="3384366">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3384424">//&nbsp;can&nbsp;marshal&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="3384467">type</span>&nbsp;<span class="ident" id="3384472">Marshaler</span>&nbsp;<span class="keyword" id="3384482">interface</span>&nbsp;<span class="op" id="3384492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384495">MarshalJSON</span><span class="op" id="3384506">(</span><span class="op" id="3384507">)</span>&nbsp;<span class="op" id="3384509">(</span><span class="op" id="3384510">[</span><span class="op" id="3384511">]</span><span class="builtintype" id="3384512">byte</span><span class="op" id="3384516">,</span>&nbsp;<span class="builtintype" id="3384518">error</span><span class="op" id="3384523">)</span><br>
<span class="lineno">195</span><span class="op" id="3384525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3384528">//&nbsp;An&nbsp;UnsupportedTypeError&nbsp;is&nbsp;returned&nbsp;by&nbsp;Marshal&nbsp;when&nbsp;attempting</span><br>
<span class="lineno"></span><span class="comment" id="3384594">//&nbsp;to&nbsp;encode&nbsp;an&nbsp;unsupported&nbsp;value&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3384634">type</span>&nbsp;<span class="ident" id="3384639">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="3384660">struct</span>&nbsp;<span class="op" id="3384667">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384670">Type</span>&nbsp;<span class="ident" id="3384675">reflect</span><span class="op" id="3384682">.</span><span class="ident" id="3384683">Type</span><br>
<span class="lineno"></span><span class="op" id="3384688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3384691">func</span>&nbsp;<span class="op" id="3384696">(</span><span class="ident" id="3384697">e</span>&nbsp;<span class="op" id="3384699">*</span><span class="ident" id="3384700">UnsupportedTypeError</span><span class="op" id="3384720">)</span>&nbsp;<span class="ident" id="3384722">Error</span><span class="op" id="3384727">(</span><span class="op" id="3384728">)</span>&nbsp;<span class="builtintype" id="3384730">string</span>&nbsp;<span class="op" id="3384737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384740">return</span>&nbsp;<span class="string" id="3384747">&#34;json:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="3384774">+</span>&nbsp;<span class="ident" id="3384776">e</span><span class="op" id="3384777">.</span><span class="ident" id="3384778">Type</span><span class="op" id="3384782">.</span><span class="ident" id="3384783">String</span><span class="op" id="3384789">(</span><span class="op" id="3384790">)</span><br>
<span class="lineno">205</span><span class="op" id="3384792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3384795">type</span>&nbsp;<span class="ident" id="3384800">UnsupportedValueError</span>&nbsp;<span class="keyword" id="3384822">struct</span>&nbsp;<span class="op" id="3384829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384832">Value</span>&nbsp;<span class="ident" id="3384838">reflect</span><span class="op" id="3384845">.</span><span class="ident" id="3384846">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384853">Str</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3384859">string</span><br>
<span class="lineno">210</span><span class="op" id="3384866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3384869">func</span>&nbsp;<span class="op" id="3384874">(</span><span class="ident" id="3384875">e</span>&nbsp;<span class="op" id="3384877">*</span><span class="ident" id="3384878">UnsupportedValueError</span><span class="op" id="3384899">)</span>&nbsp;<span class="ident" id="3384901">Error</span><span class="op" id="3384906">(</span><span class="op" id="3384907">)</span>&nbsp;<span class="builtintype" id="3384909">string</span>&nbsp;<span class="op" id="3384916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384919">return</span>&nbsp;<span class="string" id="3384926">&#34;json:&nbsp;unsupported&nbsp;value:&nbsp;&#34;</span>&nbsp;<span class="op" id="3384954">+</span>&nbsp;<span class="ident" id="3384956">e</span><span class="op" id="3384957">.</span><span class="ident" id="3384958">Str</span><br>
<span class="lineno"></span><span class="op" id="3384962">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="3384965">//&nbsp;Before&nbsp;Go&nbsp;1.2,&nbsp;an&nbsp;InvalidUTF8Error&nbsp;was&nbsp;returned&nbsp;by&nbsp;Marshal&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3385032">//&nbsp;attempting&nbsp;to&nbsp;encode&nbsp;a&nbsp;string&nbsp;value&nbsp;with&nbsp;invalid&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="comment" id="3385101">//&nbsp;As&nbsp;of&nbsp;Go&nbsp;1.2,&nbsp;Marshal&nbsp;instead&nbsp;coerces&nbsp;the&nbsp;string&nbsp;to&nbsp;valid&nbsp;UTF-8&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3385171">//&nbsp;replacing&nbsp;invalid&nbsp;bytes&nbsp;with&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;rune&nbsp;U+FFFD.</span><br>
<span class="lineno">220</span><span class="comment" id="3385240">//&nbsp;This&nbsp;error&nbsp;is&nbsp;no&nbsp;longer&nbsp;generated&nbsp;but&nbsp;is&nbsp;kept&nbsp;for&nbsp;backwards&nbsp;compatibility</span><br>
<span class="lineno"></span><span class="comment" id="3385317">//&nbsp;with&nbsp;programs&nbsp;that&nbsp;might&nbsp;mention&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3385357">type</span>&nbsp;<span class="ident" id="3385362">InvalidUTF8Error</span>&nbsp;<span class="keyword" id="3385379">struct</span>&nbsp;<span class="op" id="3385386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3385389">S</span>&nbsp;<span class="builtintype" id="3385391">string</span>&nbsp;<span class="comment" id="3385398">//&nbsp;the&nbsp;whole&nbsp;string&nbsp;value&nbsp;that&nbsp;caused&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="3385446">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="3385449">func</span>&nbsp;<span class="op" id="3385454">(</span><span class="ident" id="3385455">e</span>&nbsp;<span class="op" id="3385457">*</span><span class="ident" id="3385458">InvalidUTF8Error</span><span class="op" id="3385474">)</span>&nbsp;<span class="ident" id="3385476">Error</span><span class="op" id="3385481">(</span><span class="op" id="3385482">)</span>&nbsp;<span class="builtintype" id="3385484">string</span>&nbsp;<span class="op" id="3385491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385494">return</span>&nbsp;<span class="string" id="3385501">&#34;json:&nbsp;invalid&nbsp;UTF-8&nbsp;in&nbsp;string:&nbsp;&#34;</span>&nbsp;<span class="op" id="3385535">+</span>&nbsp;<span class="ident" id="3385537">strconv</span><span class="op" id="3385544">.</span><span class="ident" id="3385545">Quote</span><span class="op" id="3385550">(</span><span class="ident" id="3385551">e</span><span class="op" id="3385552">.</span><span class="ident" id="3385553">S</span><span class="op" id="3385554">)</span><br>
<span class="lineno"></span><span class="op" id="3385556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="3385559">type</span>&nbsp;<span class="ident" id="3385564">MarshalerError</span>&nbsp;<span class="keyword" id="3385579">struct</span>&nbsp;<span class="op" id="3385586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3385589">Type</span>&nbsp;<span class="ident" id="3385594">reflect</span><span class="op" id="3385601">.</span><span class="ident" id="3385602">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3385608">Err</span>&nbsp;&nbsp;<span class="builtintype" id="3385613">error</span><br>
<span class="lineno"></span><span class="op" id="3385619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="3385622">func</span>&nbsp;<span class="op" id="3385627">(</span><span class="ident" id="3385628">e</span>&nbsp;<span class="op" id="3385630">*</span><span class="ident" id="3385631">MarshalerError</span><span class="op" id="3385645">)</span>&nbsp;<span class="ident" id="3385647">Error</span><span class="op" id="3385652">(</span><span class="op" id="3385653">)</span>&nbsp;<span class="builtintype" id="3385655">string</span>&nbsp;<span class="op" id="3385662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385665">return</span>&nbsp;<span class="string" id="3385672">&#34;json:&nbsp;error&nbsp;calling&nbsp;MarshalJSON&nbsp;for&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3385716">+</span>&nbsp;<span class="ident" id="3385718">e</span><span class="op" id="3385719">.</span><span class="ident" id="3385720">Type</span><span class="op" id="3385724">.</span><span class="ident" id="3385725">String</span><span class="op" id="3385731">(</span><span class="op" id="3385732">)</span>&nbsp;<span class="op" id="3385734">+</span>&nbsp;<span class="string" id="3385736">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3385741">+</span>&nbsp;<span class="ident" id="3385743">e</span><span class="op" id="3385744">.</span><span class="ident" id="3385745">Err</span><span class="op" id="3385748">.</span><span class="ident" id="3385749">Error</span><span class="op" id="3385754">(</span><span class="op" id="3385755">)</span><br>
<span class="lineno"></span><span class="op" id="3385757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385760">var</span>&nbsp;<span class="ident" id="3385764">hex</span>&nbsp;<span class="op" id="3385768">=</span>&nbsp;<span class="string" id="3385770">&#34;0123456789abcdef&#34;</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3385790">//&nbsp;An&nbsp;encodeState&nbsp;encodes&nbsp;JSON&nbsp;into&nbsp;a&nbsp;bytes.Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3385842">type</span>&nbsp;<span class="ident" id="3385847">encodeState</span>&nbsp;<span class="keyword" id="3385859">struct</span>&nbsp;<span class="op" id="3385866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3385869">bytes</span><span class="op" id="3385874">.</span><span class="ident" id="3385875">Buffer</span>&nbsp;<span class="comment" id="3385882">//&nbsp;accumulated&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3385905">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3385918">[</span><span class="num" id="3385919">64</span><span class="op" id="3385921">]</span><span class="builtintype" id="3385922">byte</span><br>
<span class="lineno">245</span><span class="op" id="3385927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385930">var</span>&nbsp;<span class="ident" id="3385934">encodeStatePool</span>&nbsp;<span class="ident" id="3385950">sync</span><span class="op" id="3385954">.</span><span class="ident" id="3385955">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385961">func</span>&nbsp;<span class="ident" id="3385966">newEncodeState</span><span class="op" id="3385980">(</span><span class="op" id="3385981">)</span>&nbsp;<span class="op" id="3385983">*</span><span class="ident" id="3385984">encodeState</span>&nbsp;<span class="op" id="3385996">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385999">if</span>&nbsp;<span class="ident" id="3386002">v</span>&nbsp;<span class="op" id="3386004">:=</span>&nbsp;<span class="ident" id="3386007">encodeStatePool</span><span class="op" id="3386022">.</span><span class="ident" id="3386023">Get</span><span class="op" id="3386026">(</span><span class="op" id="3386027">)</span><span class="op" id="3386028">;</span>&nbsp;<span class="ident" id="3386030">v</span>&nbsp;<span class="op" id="3386032">!=</span>&nbsp;<span class="builtintype" id="3386035">nil</span>&nbsp;<span class="op" id="3386039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3386043">e</span>&nbsp;<span class="op" id="3386045">:=</span>&nbsp;<span class="ident" id="3386048">v</span><span class="op" id="3386049">.</span><span class="op" id="3386050">(</span><span class="op" id="3386051">*</span><span class="ident" id="3386052">encodeState</span><span class="op" id="3386063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3386067">e</span><span class="op" id="3386068">.</span><span class="ident" id="3386069">Reset</span><span class="op" id="3386074">(</span><span class="op" id="3386075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386079">return</span>&nbsp;<span class="ident" id="3386086">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3386089">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386092">return</span>&nbsp;<span class="builtinfunc" id="3386099">new</span><span class="op" id="3386102">(</span><span class="ident" id="3386103">encodeState</span><span class="op" id="3386114">)</span><br>
<span class="lineno"></span><span class="op" id="3386116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3386119">func</span>&nbsp;<span class="op" id="3386124">(</span><span class="ident" id="3386125">e</span>&nbsp;<span class="op" id="3386127">*</span><span class="ident" id="3386128">encodeState</span><span class="op" id="3386139">)</span>&nbsp;<span class="ident" id="3386141">marshal</span><span class="op" id="3386148">(</span><span class="ident" id="3386149">v</span>&nbsp;<span class="keyword" id="3386151">interface</span><span class="op" id="3386160">{</span><span class="op" id="3386161">}</span><span class="op" id="3386162">)</span>&nbsp;<span class="op" id="3386164">(</span><span class="ident" id="3386165">err</span>&nbsp;<span class="builtintype" id="3386169">error</span><span class="op" id="3386174">)</span>&nbsp;<span class="op" id="3386176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386179">defer</span>&nbsp;<span class="keyword" id="3386185">func</span><span class="op" id="3386189">(</span><span class="op" id="3386190">)</span>&nbsp;<span class="op" id="3386192">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386196">if</span>&nbsp;<span class="ident" id="3386199">r</span>&nbsp;<span class="op" id="3386201">:=</span>&nbsp;<span class="builtinfunc" id="3386204">recover</span><span class="op" id="3386211">(</span><span class="op" id="3386212">)</span><span class="op" id="3386213">;</span>&nbsp;<span class="ident" id="3386215">r</span>&nbsp;<span class="op" id="3386217">!=</span>&nbsp;<span class="builtintype" id="3386220">nil</span>&nbsp;<span class="op" id="3386224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386229">if</span>&nbsp;<span class="ident" id="3386232">_</span><span class="op" id="3386233">,</span>&nbsp;<span class="ident" id="3386235">ok</span>&nbsp;<span class="op" id="3386238">:=</span>&nbsp;<span class="ident" id="3386241">r</span><span class="op" id="3386242">.</span><span class="op" id="3386243">(</span><span class="ident" id="3386244">runtime</span><span class="op" id="3386251">.</span><span class="ident" id="3386252">Error</span><span class="op" id="3386257">)</span><span class="op" id="3386258">;</span>&nbsp;<span class="ident" id="3386260">ok</span>&nbsp;<span class="op" id="3386263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3386269">panic</span><span class="op" id="3386274">(</span><span class="ident" id="3386275">r</span><span class="op" id="3386276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3386281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386286">if</span>&nbsp;<span class="ident" id="3386289">s</span><span class="op" id="3386290">,</span>&nbsp;<span class="ident" id="3386292">ok</span>&nbsp;<span class="op" id="3386295">:=</span>&nbsp;<span class="ident" id="3386298">r</span><span class="op" id="3386299">.</span><span class="op" id="3386300">(</span><span class="builtintype" id="3386301">string</span><span class="op" id="3386307">)</span><span class="op" id="3386308">;</span>&nbsp;<span class="ident" id="3386310">ok</span>&nbsp;<span class="op" id="3386313">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3386319">panic</span><span class="op" id="3386324">(</span><span class="ident" id="3386325">s</span><span class="op" id="3386326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3386331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3386336">err</span>&nbsp;<span class="op" id="3386340">=</span>&nbsp;<span class="ident" id="3386342">r</span><span class="op" id="3386343">.</span><span class="op" id="3386344">(</span><span class="builtintype" id="3386345">error</span><span class="op" id="3386350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3386354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3386357">}</span><span class="op" id="3386358">(</span><span class="op" id="3386359">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3386362">e</span><span class="op" id="3386363">.</span><span class="ident" id="3386364">reflectValue</span><span class="op" id="3386376">(</span><span class="ident" id="3386377">reflect</span><span class="op" id="3386384">.</span><span class="ident" id="3386385">ValueOf</span><span class="op" id="3386392">(</span><span class="ident" id="3386393">v</span><span class="op" id="3386394">)</span><span class="op" id="3386395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386398">return</span>&nbsp;<span class="builtintype" id="3386405">nil</span><br>
<span class="lineno"></span><span class="op" id="3386409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3386412">func</span>&nbsp;<span class="op" id="3386417">(</span><span class="ident" id="3386418">e</span>&nbsp;<span class="op" id="3386420">*</span><span class="ident" id="3386421">encodeState</span><span class="op" id="3386432">)</span>&nbsp;<span class="builtintype" id="3386434">error</span><span class="op" id="3386439">(</span><span class="ident" id="3386440">err</span>&nbsp;<span class="builtintype" id="3386444">error</span><span class="op" id="3386449">)</span>&nbsp;<span class="op" id="3386451">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3386454">panic</span><span class="op" id="3386459">(</span><span class="ident" id="3386460">err</span><span class="op" id="3386463">)</span><br>
<span class="lineno"></span><span class="op" id="3386465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3386468">var</span>&nbsp;<span class="ident" id="3386472">byteSliceType</span>&nbsp;<span class="op" id="3386486">=</span>&nbsp;<span class="ident" id="3386488">reflect</span><span class="op" id="3386495">.</span><span class="ident" id="3386496">TypeOf</span><span class="op" id="3386502">(</span><span class="op" id="3386503">[</span><span class="op" id="3386504">]</span><span class="builtintype" id="3386505">byte</span><span class="op" id="3386509">(</span><span class="builtintype" id="3386510">nil</span><span class="op" id="3386513">)</span><span class="op" id="3386514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="3386517">func</span>&nbsp;<span class="ident" id="3386522">isEmptyValue</span><span class="op" id="3386534">(</span><span class="ident" id="3386535">v</span>&nbsp;<span class="ident" id="3386537">reflect</span><span class="op" id="3386544">.</span><span class="ident" id="3386545">Value</span><span class="op" id="3386550">)</span>&nbsp;<span class="builtintype" id="3386552">bool</span>&nbsp;<span class="op" id="3386557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386560">switch</span>&nbsp;<span class="ident" id="3386567">v</span><span class="op" id="3386568">.</span><span class="ident" id="3386569">Kind</span><span class="op" id="3386573">(</span><span class="op" id="3386574">)</span>&nbsp;<span class="op" id="3386576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386579">case</span>&nbsp;<span class="ident" id="3386584">reflect</span><span class="op" id="3386591">.</span><span class="ident" id="3386592">Array</span><span class="op" id="3386597">,</span>&nbsp;<span class="ident" id="3386599">reflect</span><span class="op" id="3386606">.</span><span class="ident" id="3386607">Map</span><span class="op" id="3386610">,</span>&nbsp;<span class="ident" id="3386612">reflect</span><span class="op" id="3386619">.</span><span class="ident" id="3386620">Slice</span><span class="op" id="3386625">,</span>&nbsp;<span class="ident" id="3386627">reflect</span><span class="op" id="3386634">.</span><span class="ident" id="3386635">String</span><span class="op" id="3386641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386645">return</span>&nbsp;<span class="ident" id="3386652">v</span><span class="op" id="3386653">.</span><span class="ident" id="3386654">Len</span><span class="op" id="3386657">(</span><span class="op" id="3386658">)</span>&nbsp;<span class="op" id="3386660">==</span>&nbsp;<span class="num" id="3386663">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386666">case</span>&nbsp;<span class="ident" id="3386671">reflect</span><span class="op" id="3386678">.</span><span class="ident" id="3386679">Bool</span><span class="op" id="3386683">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386687">return</span>&nbsp;<span class="op" id="3386694">!</span><span class="ident" id="3386695">v</span><span class="op" id="3386696">.</span><span class="ident" id="3386697">Bool</span><span class="op" id="3386701">(</span><span class="op" id="3386702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386705">case</span>&nbsp;<span class="ident" id="3386710">reflect</span><span class="op" id="3386717">.</span><span class="ident" id="3386718">Int</span><span class="op" id="3386721">,</span>&nbsp;<span class="ident" id="3386723">reflect</span><span class="op" id="3386730">.</span><span class="ident" id="3386731">Int8</span><span class="op" id="3386735">,</span>&nbsp;<span class="ident" id="3386737">reflect</span><span class="op" id="3386744">.</span><span class="ident" id="3386745">Int16</span><span class="op" id="3386750">,</span>&nbsp;<span class="ident" id="3386752">reflect</span><span class="op" id="3386759">.</span><span class="ident" id="3386760">Int32</span><span class="op" id="3386765">,</span>&nbsp;<span class="ident" id="3386767">reflect</span><span class="op" id="3386774">.</span><span class="ident" id="3386775">Int64</span><span class="op" id="3386780">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386784">return</span>&nbsp;<span class="ident" id="3386791">v</span><span class="op" id="3386792">.</span><span class="ident" id="3386793">Int</span><span class="op" id="3386796">(</span><span class="op" id="3386797">)</span>&nbsp;<span class="op" id="3386799">==</span>&nbsp;<span class="num" id="3386802">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386805">case</span>&nbsp;<span class="ident" id="3386810">reflect</span><span class="op" id="3386817">.</span><span class="ident" id="3386818">Uint</span><span class="op" id="3386822">,</span>&nbsp;<span class="ident" id="3386824">reflect</span><span class="op" id="3386831">.</span><span class="ident" id="3386832">Uint8</span><span class="op" id="3386837">,</span>&nbsp;<span class="ident" id="3386839">reflect</span><span class="op" id="3386846">.</span><span class="ident" id="3386847">Uint16</span><span class="op" id="3386853">,</span>&nbsp;<span class="ident" id="3386855">reflect</span><span class="op" id="3386862">.</span><span class="ident" id="3386863">Uint32</span><span class="op" id="3386869">,</span>&nbsp;<span class="ident" id="3386871">reflect</span><span class="op" id="3386878">.</span><span class="ident" id="3386879">Uint64</span><span class="op" id="3386885">,</span>&nbsp;<span class="ident" id="3386887">reflect</span><span class="op" id="3386894">.</span><span class="ident" id="3386895">Uintptr</span><span class="op" id="3386902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386906">return</span>&nbsp;<span class="ident" id="3386913">v</span><span class="op" id="3386914">.</span><span class="ident" id="3386915">Uint</span><span class="op" id="3386919">(</span><span class="op" id="3386920">)</span>&nbsp;<span class="op" id="3386922">==</span>&nbsp;<span class="num" id="3386925">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386928">case</span>&nbsp;<span class="ident" id="3386933">reflect</span><span class="op" id="3386940">.</span><span class="ident" id="3386941">Float32</span><span class="op" id="3386948">,</span>&nbsp;<span class="ident" id="3386950">reflect</span><span class="op" id="3386957">.</span><span class="ident" id="3386958">Float64</span><span class="op" id="3386965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386969">return</span>&nbsp;<span class="ident" id="3386976">v</span><span class="op" id="3386977">.</span><span class="ident" id="3386978">Float</span><span class="op" id="3386983">(</span><span class="op" id="3386984">)</span>&nbsp;<span class="op" id="3386986">==</span>&nbsp;<span class="num" id="3386989">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386992">case</span>&nbsp;<span class="ident" id="3386997">reflect</span><span class="op" id="3387004">.</span><span class="ident" id="3387005">Interface</span><span class="op" id="3387014">,</span>&nbsp;<span class="ident" id="3387016">reflect</span><span class="op" id="3387023">.</span><span class="ident" id="3387024">Ptr</span><span class="op" id="3387027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387031">return</span>&nbsp;<span class="ident" id="3387038">v</span><span class="op" id="3387039">.</span><span class="ident" id="3387040">IsNil</span><span class="op" id="3387045">(</span><span class="op" id="3387046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3387049">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387052">return</span>&nbsp;<span class="builtintype" id="3387059">false</span><br>
<span class="lineno"></span><span class="op" id="3387065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3387068">func</span>&nbsp;<span class="op" id="3387073">(</span><span class="ident" id="3387074">e</span>&nbsp;<span class="op" id="3387076">*</span><span class="ident" id="3387077">encodeState</span><span class="op" id="3387088">)</span>&nbsp;<span class="ident" id="3387090">reflectValue</span><span class="op" id="3387102">(</span><span class="ident" id="3387103">v</span>&nbsp;<span class="ident" id="3387105">reflect</span><span class="op" id="3387112">.</span><span class="ident" id="3387113">Value</span><span class="op" id="3387118">)</span>&nbsp;<span class="op" id="3387120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387123">valueEncoder</span><span class="op" id="3387135">(</span><span class="ident" id="3387136">v</span><span class="op" id="3387137">)</span><span class="op" id="3387138">(</span><span class="ident" id="3387139">e</span><span class="op" id="3387140">,</span>&nbsp;<span class="ident" id="3387142">v</span><span class="op" id="3387143">,</span>&nbsp;<span class="builtintype" id="3387145">false</span><span class="op" id="3387150">)</span><br>
<span class="lineno">300</span><span class="op" id="3387152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3387155">type</span>&nbsp;<span class="ident" id="3387160">encoderFunc</span>&nbsp;<span class="keyword" id="3387172">func</span><span class="op" id="3387176">(</span><span class="ident" id="3387177">e</span>&nbsp;<span class="op" id="3387179">*</span><span class="ident" id="3387180">encodeState</span><span class="op" id="3387191">,</span>&nbsp;<span class="ident" id="3387193">v</span>&nbsp;<span class="ident" id="3387195">reflect</span><span class="op" id="3387202">.</span><span class="ident" id="3387203">Value</span><span class="op" id="3387208">,</span>&nbsp;<span class="ident" id="3387210">quoted</span>&nbsp;<span class="builtintype" id="3387217">bool</span><span class="op" id="3387221">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3387224">var</span>&nbsp;<span class="ident" id="3387228">encoderCache</span>&nbsp;<span class="keyword" id="3387241">struct</span>&nbsp;<span class="op" id="3387248">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387251">sync</span><span class="op" id="3387255">.</span><span class="ident" id="3387256">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387265">m</span>&nbsp;<span class="keyword" id="3387267">map</span><span class="op" id="3387270">[</span><span class="ident" id="3387271">reflect</span><span class="op" id="3387278">.</span><span class="ident" id="3387279">Type</span><span class="op" id="3387283">]</span><span class="ident" id="3387284">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="3387296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3387299">func</span>&nbsp;<span class="ident" id="3387304">valueEncoder</span><span class="op" id="3387316">(</span><span class="ident" id="3387317">v</span>&nbsp;<span class="ident" id="3387319">reflect</span><span class="op" id="3387326">.</span><span class="ident" id="3387327">Value</span><span class="op" id="3387332">)</span>&nbsp;<span class="ident" id="3387334">encoderFunc</span>&nbsp;<span class="op" id="3387346">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387349">if</span>&nbsp;<span class="op" id="3387352">!</span><span class="ident" id="3387353">v</span><span class="op" id="3387354">.</span><span class="ident" id="3387355">IsValid</span><span class="op" id="3387362">(</span><span class="op" id="3387363">)</span>&nbsp;<span class="op" id="3387365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387369">return</span>&nbsp;<span class="ident" id="3387376">invalidValueEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3387397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387400">return</span>&nbsp;<span class="ident" id="3387407">typeEncoder</span><span class="op" id="3387418">(</span><span class="ident" id="3387419">v</span><span class="op" id="3387420">.</span><span class="ident" id="3387421">Type</span><span class="op" id="3387425">(</span><span class="op" id="3387426">)</span><span class="op" id="3387427">)</span><br>
<span class="lineno"></span><span class="op" id="3387429">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="3387432">func</span>&nbsp;<span class="ident" id="3387437">typeEncoder</span><span class="op" id="3387448">(</span><span class="ident" id="3387449">t</span>&nbsp;<span class="ident" id="3387451">reflect</span><span class="op" id="3387458">.</span><span class="ident" id="3387459">Type</span><span class="op" id="3387463">)</span>&nbsp;<span class="ident" id="3387465">encoderFunc</span>&nbsp;<span class="op" id="3387477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387480">encoderCache</span><span class="op" id="3387492">.</span><span class="ident" id="3387493">RLock</span><span class="op" id="3387498">(</span><span class="op" id="3387499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387502">f</span>&nbsp;<span class="op" id="3387504">:=</span>&nbsp;<span class="ident" id="3387507">encoderCache</span><span class="op" id="3387519">.</span><span class="ident" id="3387520">m</span><span class="op" id="3387521">[</span><span class="ident" id="3387522">t</span><span class="op" id="3387523">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387526">encoderCache</span><span class="op" id="3387538">.</span><span class="ident" id="3387539">RUnlock</span><span class="op" id="3387546">(</span><span class="op" id="3387547">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387550">if</span>&nbsp;<span class="ident" id="3387553">f</span>&nbsp;<span class="op" id="3387555">!=</span>&nbsp;<span class="builtintype" id="3387558">nil</span>&nbsp;<span class="op" id="3387562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387566">return</span>&nbsp;<span class="ident" id="3387573">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3387576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3387580">//&nbsp;To&nbsp;deal&nbsp;with&nbsp;recursive&nbsp;types,&nbsp;populate&nbsp;the&nbsp;map&nbsp;with&nbsp;an</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3387639">//&nbsp;indirect&nbsp;func&nbsp;before&nbsp;we&nbsp;build&nbsp;it.&nbsp;This&nbsp;type&nbsp;waits&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3387700">//&nbsp;real&nbsp;func&nbsp;(f)&nbsp;to&nbsp;be&nbsp;ready&nbsp;and&nbsp;then&nbsp;calls&nbsp;it.&nbsp;&nbsp;This&nbsp;indirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3387764">//&nbsp;func&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;recursive&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387807">encoderCache</span><span class="op" id="3387819">.</span><span class="ident" id="3387820">Lock</span><span class="op" id="3387824">(</span><span class="op" id="3387825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387828">if</span>&nbsp;<span class="ident" id="3387831">encoderCache</span><span class="op" id="3387843">.</span><span class="ident" id="3387844">m</span>&nbsp;<span class="op" id="3387846">==</span>&nbsp;<span class="builtintype" id="3387849">nil</span>&nbsp;<span class="op" id="3387853">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387857">encoderCache</span><span class="op" id="3387869">.</span><span class="ident" id="3387870">m</span>&nbsp;<span class="op" id="3387872">=</span>&nbsp;<span class="builtinfunc" id="3387874">make</span><span class="op" id="3387878">(</span><span class="keyword" id="3387879">map</span><span class="op" id="3387882">[</span><span class="ident" id="3387883">reflect</span><span class="op" id="3387890">.</span><span class="ident" id="3387891">Type</span><span class="op" id="3387895">]</span><span class="ident" id="3387896">encoderFunc</span><span class="op" id="3387907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3387910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387913">var</span>&nbsp;<span class="ident" id="3387917">wg</span>&nbsp;<span class="ident" id="3387920">sync</span><span class="op" id="3387924">.</span><span class="ident" id="3387925">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387936">wg</span><span class="op" id="3387938">.</span><span class="ident" id="3387939">Add</span><span class="op" id="3387942">(</span><span class="num" id="3387943">1</span><span class="op" id="3387944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387947">encoderCache</span><span class="op" id="3387959">.</span><span class="ident" id="3387960">m</span><span class="op" id="3387961">[</span><span class="ident" id="3387962">t</span><span class="op" id="3387963">]</span>&nbsp;<span class="op" id="3387965">=</span>&nbsp;<span class="keyword" id="3387967">func</span><span class="op" id="3387971">(</span><span class="ident" id="3387972">e</span>&nbsp;<span class="op" id="3387974">*</span><span class="ident" id="3387975">encodeState</span><span class="op" id="3387986">,</span>&nbsp;<span class="ident" id="3387988">v</span>&nbsp;<span class="ident" id="3387990">reflect</span><span class="op" id="3387997">.</span><span class="ident" id="3387998">Value</span><span class="op" id="3388003">,</span>&nbsp;<span class="ident" id="3388005">quoted</span>&nbsp;<span class="builtintype" id="3388012">bool</span><span class="op" id="3388016">)</span>&nbsp;<span class="op" id="3388018">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3388022">wg</span><span class="op" id="3388024">.</span><span class="ident" id="3388025">Wait</span><span class="op" id="3388029">(</span><span class="op" id="3388030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3388034">f</span><span class="op" id="3388035">(</span><span class="ident" id="3388036">e</span><span class="op" id="3388037">,</span>&nbsp;<span class="ident" id="3388039">v</span><span class="op" id="3388040">,</span>&nbsp;<span class="ident" id="3388042">quoted</span><span class="op" id="3388048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3388051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3388054">encoderCache</span><span class="op" id="3388066">.</span><span class="ident" id="3388067">Unlock</span><span class="op" id="3388073">(</span><span class="op" id="3388074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3388078">//&nbsp;Compute&nbsp;fields&nbsp;without&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3388111">//&nbsp;Might&nbsp;duplicate&nbsp;effort&nbsp;but&nbsp;won&#39;t&nbsp;hold&nbsp;other&nbsp;computations&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3388178">f</span>&nbsp;<span class="op" id="3388180">=</span>&nbsp;<span class="ident" id="3388182">newTypeEncoder</span><span class="op" id="3388196">(</span><span class="ident" id="3388197">t</span><span class="op" id="3388198">,</span>&nbsp;<span class="builtintype" id="3388200">true</span><span class="op" id="3388204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3388207">wg</span><span class="op" id="3388209">.</span><span class="ident" id="3388210">Done</span><span class="op" id="3388214">(</span><span class="op" id="3388215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3388218">encoderCache</span><span class="op" id="3388230">.</span><span class="ident" id="3388231">Lock</span><span class="op" id="3388235">(</span><span class="op" id="3388236">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3388239">encoderCache</span><span class="op" id="3388251">.</span><span class="ident" id="3388252">m</span><span class="op" id="3388253">[</span><span class="ident" id="3388254">t</span><span class="op" id="3388255">]</span>&nbsp;<span class="op" id="3388257">=</span>&nbsp;<span class="ident" id="3388259">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3388262">encoderCache</span><span class="op" id="3388274">.</span><span class="ident" id="3388275">Unlock</span><span class="op" id="3388281">(</span><span class="op" id="3388282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388285">return</span>&nbsp;<span class="ident" id="3388292">f</span><br>
<span class="lineno"></span><span class="op" id="3388294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="3388297">var</span>&nbsp;<span class="op" id="3388301">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3388304">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3388322">=</span>&nbsp;<span class="ident" id="3388324">reflect</span><span class="op" id="3388331">.</span><span class="ident" id="3388332">TypeOf</span><span class="op" id="3388338">(</span><span class="builtinfunc" id="3388339">new</span><span class="op" id="3388342">(</span><span class="ident" id="3388343">Marshaler</span><span class="op" id="3388352">)</span><span class="op" id="3388353">)</span><span class="op" id="3388354">.</span><span class="ident" id="3388355">Elem</span><span class="op" id="3388359">(</span><span class="op" id="3388360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3388363">textMarshalerType</span>&nbsp;<span class="op" id="3388381">=</span>&nbsp;<span class="ident" id="3388383">reflect</span><span class="op" id="3388390">.</span><span class="ident" id="3388391">TypeOf</span><span class="op" id="3388397">(</span><span class="builtinfunc" id="3388398">new</span><span class="op" id="3388401">(</span><span class="ident" id="3388402">encoding</span><span class="op" id="3388410">.</span><span class="ident" id="3388411">TextMarshaler</span><span class="op" id="3388424">)</span><span class="op" id="3388425">)</span><span class="op" id="3388426">.</span><span class="ident" id="3388427">Elem</span><span class="op" id="3388431">(</span><span class="op" id="3388432">)</span><br>
<span class="lineno"></span><span class="op" id="3388434">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="3388437">//&nbsp;newTypeEncoder&nbsp;constructs&nbsp;an&nbsp;encoderFunc&nbsp;for&nbsp;a&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="3388493">//&nbsp;The&nbsp;returned&nbsp;encoder&nbsp;only&nbsp;checks&nbsp;CanAddr&nbsp;when&nbsp;allowAddr&nbsp;is&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="3388561">func</span>&nbsp;<span class="ident" id="3388566">newTypeEncoder</span><span class="op" id="3388580">(</span><span class="ident" id="3388581">t</span>&nbsp;<span class="ident" id="3388583">reflect</span><span class="op" id="3388590">.</span><span class="ident" id="3388591">Type</span><span class="op" id="3388595">,</span>&nbsp;<span class="ident" id="3388597">allowAddr</span>&nbsp;<span class="builtintype" id="3388607">bool</span><span class="op" id="3388611">)</span>&nbsp;<span class="ident" id="3388613">encoderFunc</span>&nbsp;<span class="op" id="3388625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388628">if</span>&nbsp;<span class="ident" id="3388631">t</span><span class="op" id="3388632">.</span><span class="ident" id="3388633">Implements</span><span class="op" id="3388643">(</span><span class="ident" id="3388644">marshalerType</span><span class="op" id="3388657">)</span>&nbsp;<span class="op" id="3388659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388663">return</span>&nbsp;<span class="ident" id="3388670">marshalerEncoder</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3388688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388691">if</span>&nbsp;<span class="ident" id="3388694">t</span><span class="op" id="3388695">.</span><span class="ident" id="3388696">Kind</span><span class="op" id="3388700">(</span><span class="op" id="3388701">)</span>&nbsp;<span class="op" id="3388703">!=</span>&nbsp;<span class="ident" id="3388706">reflect</span><span class="op" id="3388713">.</span><span class="ident" id="3388714">Ptr</span>&nbsp;<span class="op" id="3388718">&amp;&amp;</span>&nbsp;<span class="ident" id="3388721">allowAddr</span>&nbsp;<span class="op" id="3388731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388735">if</span>&nbsp;<span class="ident" id="3388738">reflect</span><span class="op" id="3388745">.</span><span class="ident" id="3388746">PtrTo</span><span class="op" id="3388751">(</span><span class="ident" id="3388752">t</span><span class="op" id="3388753">)</span><span class="op" id="3388754">.</span><span class="ident" id="3388755">Implements</span><span class="op" id="3388765">(</span><span class="ident" id="3388766">marshalerType</span><span class="op" id="3388779">)</span>&nbsp;<span class="op" id="3388781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388786">return</span>&nbsp;<span class="ident" id="3388793">newCondAddrEncoder</span><span class="op" id="3388811">(</span><span class="ident" id="3388812">addrMarshalerEncoder</span><span class="op" id="3388832">,</span>&nbsp;<span class="ident" id="3388834">newTypeEncoder</span><span class="op" id="3388848">(</span><span class="ident" id="3388849">t</span><span class="op" id="3388850">,</span>&nbsp;<span class="builtintype" id="3388852">false</span><span class="op" id="3388857">)</span><span class="op" id="3388858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3388862">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3388865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388869">if</span>&nbsp;<span class="ident" id="3388872">t</span><span class="op" id="3388873">.</span><span class="ident" id="3388874">Implements</span><span class="op" id="3388884">(</span><span class="ident" id="3388885">textMarshalerType</span><span class="op" id="3388902">)</span>&nbsp;<span class="op" id="3388904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388908">return</span>&nbsp;<span class="ident" id="3388915">textMarshalerEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3388937">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388940">if</span>&nbsp;<span class="ident" id="3388943">t</span><span class="op" id="3388944">.</span><span class="ident" id="3388945">Kind</span><span class="op" id="3388949">(</span><span class="op" id="3388950">)</span>&nbsp;<span class="op" id="3388952">!=</span>&nbsp;<span class="ident" id="3388955">reflect</span><span class="op" id="3388962">.</span><span class="ident" id="3388963">Ptr</span>&nbsp;<span class="op" id="3388967">&amp;&amp;</span>&nbsp;<span class="ident" id="3388970">allowAddr</span>&nbsp;<span class="op" id="3388980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388984">if</span>&nbsp;<span class="ident" id="3388987">reflect</span><span class="op" id="3388994">.</span><span class="ident" id="3388995">PtrTo</span><span class="op" id="3389000">(</span><span class="ident" id="3389001">t</span><span class="op" id="3389002">)</span><span class="op" id="3389003">.</span><span class="ident" id="3389004">Implements</span><span class="op" id="3389014">(</span><span class="ident" id="3389015">textMarshalerType</span><span class="op" id="3389032">)</span>&nbsp;<span class="op" id="3389034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389039">return</span>&nbsp;<span class="ident" id="3389046">newCondAddrEncoder</span><span class="op" id="3389064">(</span><span class="ident" id="3389065">addrTextMarshalerEncoder</span><span class="op" id="3389089">,</span>&nbsp;<span class="ident" id="3389091">newTypeEncoder</span><span class="op" id="3389105">(</span><span class="ident" id="3389106">t</span><span class="op" id="3389107">,</span>&nbsp;<span class="builtintype" id="3389109">false</span><span class="op" id="3389114">)</span><span class="op" id="3389115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3389119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3389122">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389126">switch</span>&nbsp;<span class="ident" id="3389133">t</span><span class="op" id="3389134">.</span><span class="ident" id="3389135">Kind</span><span class="op" id="3389139">(</span><span class="op" id="3389140">)</span>&nbsp;<span class="op" id="3389142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389145">case</span>&nbsp;<span class="ident" id="3389150">reflect</span><span class="op" id="3389157">.</span><span class="ident" id="3389158">Bool</span><span class="op" id="3389162">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389166">return</span>&nbsp;<span class="ident" id="3389173">boolEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389186">case</span>&nbsp;<span class="ident" id="3389191">reflect</span><span class="op" id="3389198">.</span><span class="ident" id="3389199">Int</span><span class="op" id="3389202">,</span>&nbsp;<span class="ident" id="3389204">reflect</span><span class="op" id="3389211">.</span><span class="ident" id="3389212">Int8</span><span class="op" id="3389216">,</span>&nbsp;<span class="ident" id="3389218">reflect</span><span class="op" id="3389225">.</span><span class="ident" id="3389226">Int16</span><span class="op" id="3389231">,</span>&nbsp;<span class="ident" id="3389233">reflect</span><span class="op" id="3389240">.</span><span class="ident" id="3389241">Int32</span><span class="op" id="3389246">,</span>&nbsp;<span class="ident" id="3389248">reflect</span><span class="op" id="3389255">.</span><span class="ident" id="3389256">Int64</span><span class="op" id="3389261">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389265">return</span>&nbsp;<span class="ident" id="3389272">intEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389284">case</span>&nbsp;<span class="ident" id="3389289">reflect</span><span class="op" id="3389296">.</span><span class="ident" id="3389297">Uint</span><span class="op" id="3389301">,</span>&nbsp;<span class="ident" id="3389303">reflect</span><span class="op" id="3389310">.</span><span class="ident" id="3389311">Uint8</span><span class="op" id="3389316">,</span>&nbsp;<span class="ident" id="3389318">reflect</span><span class="op" id="3389325">.</span><span class="ident" id="3389326">Uint16</span><span class="op" id="3389332">,</span>&nbsp;<span class="ident" id="3389334">reflect</span><span class="op" id="3389341">.</span><span class="ident" id="3389342">Uint32</span><span class="op" id="3389348">,</span>&nbsp;<span class="ident" id="3389350">reflect</span><span class="op" id="3389357">.</span><span class="ident" id="3389358">Uint64</span><span class="op" id="3389364">,</span>&nbsp;<span class="ident" id="3389366">reflect</span><span class="op" id="3389373">.</span><span class="ident" id="3389374">Uintptr</span><span class="op" id="3389381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389385">return</span>&nbsp;<span class="ident" id="3389392">uintEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389405">case</span>&nbsp;<span class="ident" id="3389410">reflect</span><span class="op" id="3389417">.</span><span class="ident" id="3389418">Float32</span><span class="op" id="3389425">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389429">return</span>&nbsp;<span class="ident" id="3389436">float32Encoder</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389452">case</span>&nbsp;<span class="ident" id="3389457">reflect</span><span class="op" id="3389464">.</span><span class="ident" id="3389465">Float64</span><span class="op" id="3389472">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389476">return</span>&nbsp;<span class="ident" id="3389483">float64Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389499">case</span>&nbsp;<span class="ident" id="3389504">reflect</span><span class="op" id="3389511">.</span><span class="ident" id="3389512">String</span><span class="op" id="3389518">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389522">return</span>&nbsp;<span class="ident" id="3389529">stringEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389544">case</span>&nbsp;<span class="ident" id="3389549">reflect</span><span class="op" id="3389556">.</span><span class="ident" id="3389557">Interface</span><span class="op" id="3389566">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389570">return</span>&nbsp;<span class="ident" id="3389577">interfaceEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389595">case</span>&nbsp;<span class="ident" id="3389600">reflect</span><span class="op" id="3389607">.</span><span class="ident" id="3389608">Struct</span><span class="op" id="3389614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389618">return</span>&nbsp;<span class="ident" id="3389625">newStructEncoder</span><span class="op" id="3389641">(</span><span class="ident" id="3389642">t</span><span class="op" id="3389643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389646">case</span>&nbsp;<span class="ident" id="3389651">reflect</span><span class="op" id="3389658">.</span><span class="ident" id="3389659">Map</span><span class="op" id="3389662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389666">return</span>&nbsp;<span class="ident" id="3389673">newMapEncoder</span><span class="op" id="3389686">(</span><span class="ident" id="3389687">t</span><span class="op" id="3389688">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389691">case</span>&nbsp;<span class="ident" id="3389696">reflect</span><span class="op" id="3389703">.</span><span class="ident" id="3389704">Slice</span><span class="op" id="3389709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389713">return</span>&nbsp;<span class="ident" id="3389720">newSliceEncoder</span><span class="op" id="3389735">(</span><span class="ident" id="3389736">t</span><span class="op" id="3389737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389740">case</span>&nbsp;<span class="ident" id="3389745">reflect</span><span class="op" id="3389752">.</span><span class="ident" id="3389753">Array</span><span class="op" id="3389758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389762">return</span>&nbsp;<span class="ident" id="3389769">newArrayEncoder</span><span class="op" id="3389784">(</span><span class="ident" id="3389785">t</span><span class="op" id="3389786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389789">case</span>&nbsp;<span class="ident" id="3389794">reflect</span><span class="op" id="3389801">.</span><span class="ident" id="3389802">Ptr</span><span class="op" id="3389805">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389809">return</span>&nbsp;<span class="ident" id="3389816">newPtrEncoder</span><span class="op" id="3389829">(</span><span class="ident" id="3389830">t</span><span class="op" id="3389831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389834">default</span><span class="op" id="3389841">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389845">return</span>&nbsp;<span class="ident" id="3389852">unsupportedTypeEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3389876">}</span><br>
<span class="lineno"></span><span class="op" id="3389878">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="3389881">func</span>&nbsp;<span class="ident" id="3389886">invalidValueEncoder</span><span class="op" id="3389905">(</span><span class="ident" id="3389906">e</span>&nbsp;<span class="op" id="3389908">*</span><span class="ident" id="3389909">encodeState</span><span class="op" id="3389920">,</span>&nbsp;<span class="ident" id="3389922">v</span>&nbsp;<span class="ident" id="3389924">reflect</span><span class="op" id="3389931">.</span><span class="ident" id="3389932">Value</span><span class="op" id="3389937">,</span>&nbsp;<span class="ident" id="3389939">quoted</span>&nbsp;<span class="builtintype" id="3389946">bool</span><span class="op" id="3389950">)</span>&nbsp;<span class="op" id="3389952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3389955">e</span><span class="op" id="3389956">.</span><span class="ident" id="3389957">WriteString</span><span class="op" id="3389968">(</span><span class="string" id="3389969">&#34;null&#34;</span><span class="op" id="3389975">)</span><br>
<span class="lineno"></span><span class="op" id="3389977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="keyword" id="3389980">func</span>&nbsp;<span class="ident" id="3389985">marshalerEncoder</span><span class="op" id="3390001">(</span><span class="ident" id="3390002">e</span>&nbsp;<span class="op" id="3390004">*</span><span class="ident" id="3390005">encodeState</span><span class="op" id="3390016">,</span>&nbsp;<span class="ident" id="3390018">v</span>&nbsp;<span class="ident" id="3390020">reflect</span><span class="op" id="3390027">.</span><span class="ident" id="3390028">Value</span><span class="op" id="3390033">,</span>&nbsp;<span class="ident" id="3390035">quoted</span>&nbsp;<span class="builtintype" id="3390042">bool</span><span class="op" id="3390046">)</span>&nbsp;<span class="op" id="3390048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390051">if</span>&nbsp;<span class="ident" id="3390054">v</span><span class="op" id="3390055">.</span><span class="ident" id="3390056">Kind</span><span class="op" id="3390060">(</span><span class="op" id="3390061">)</span>&nbsp;<span class="op" id="3390063">==</span>&nbsp;<span class="ident" id="3390066">reflect</span><span class="op" id="3390073">.</span><span class="ident" id="3390074">Ptr</span>&nbsp;<span class="op" id="3390078">&amp;&amp;</span>&nbsp;<span class="ident" id="3390081">v</span><span class="op" id="3390082">.</span><span class="ident" id="3390083">IsNil</span><span class="op" id="3390088">(</span><span class="op" id="3390089">)</span>&nbsp;<span class="op" id="3390091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390095">e</span><span class="op" id="3390096">.</span><span class="ident" id="3390097">WriteString</span><span class="op" id="3390108">(</span><span class="string" id="3390109">&#34;null&#34;</span><span class="op" id="3390115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390119">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3390127">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390130">m</span>&nbsp;<span class="op" id="3390132">:=</span>&nbsp;<span class="ident" id="3390135">v</span><span class="op" id="3390136">.</span><span class="ident" id="3390137">Interface</span><span class="op" id="3390146">(</span><span class="op" id="3390147">)</span><span class="op" id="3390148">.</span><span class="op" id="3390149">(</span><span class="ident" id="3390150">Marshaler</span><span class="op" id="3390159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390162">b</span><span class="op" id="3390163">,</span>&nbsp;<span class="ident" id="3390165">err</span>&nbsp;<span class="op" id="3390169">:=</span>&nbsp;<span class="ident" id="3390172">m</span><span class="op" id="3390173">.</span><span class="ident" id="3390174">MarshalJSON</span><span class="op" id="3390185">(</span><span class="op" id="3390186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390189">if</span>&nbsp;<span class="ident" id="3390192">err</span>&nbsp;<span class="op" id="3390196">==</span>&nbsp;<span class="builtintype" id="3390199">nil</span>&nbsp;<span class="op" id="3390203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3390207">//&nbsp;copy&nbsp;JSON&nbsp;into&nbsp;buffer,&nbsp;checking&nbsp;validity.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390254">err</span>&nbsp;<span class="op" id="3390258">=</span>&nbsp;<span class="ident" id="3390260">compact</span><span class="op" id="3390267">(</span><span class="op" id="3390268">&amp;</span><span class="ident" id="3390269">e</span><span class="op" id="3390270">.</span><span class="ident" id="3390271">Buffer</span><span class="op" id="3390277">,</span>&nbsp;<span class="ident" id="3390279">b</span><span class="op" id="3390280">,</span>&nbsp;<span class="builtintype" id="3390282">true</span><span class="op" id="3390286">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3390289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390292">if</span>&nbsp;<span class="ident" id="3390295">err</span>&nbsp;<span class="op" id="3390299">!=</span>&nbsp;<span class="builtintype" id="3390302">nil</span>&nbsp;<span class="op" id="3390306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390310">e</span><span class="op" id="3390311">.</span><span class="builtintype" id="3390312">error</span><span class="op" id="3390317">(</span><span class="op" id="3390318">&amp;</span><span class="ident" id="3390319">MarshalerError</span><span class="op" id="3390333">{</span><span class="ident" id="3390334">v</span><span class="op" id="3390335">.</span><span class="ident" id="3390336">Type</span><span class="op" id="3390340">(</span><span class="op" id="3390341">)</span><span class="op" id="3390342">,</span>&nbsp;<span class="ident" id="3390344">err</span><span class="op" id="3390347">}</span><span class="op" id="3390348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3390351">}</span><br>
<span class="lineno"></span><span class="op" id="3390353">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="3390356">func</span>&nbsp;<span class="ident" id="3390361">addrMarshalerEncoder</span><span class="op" id="3390381">(</span><span class="ident" id="3390382">e</span>&nbsp;<span class="op" id="3390384">*</span><span class="ident" id="3390385">encodeState</span><span class="op" id="3390396">,</span>&nbsp;<span class="ident" id="3390398">v</span>&nbsp;<span class="ident" id="3390400">reflect</span><span class="op" id="3390407">.</span><span class="ident" id="3390408">Value</span><span class="op" id="3390413">,</span>&nbsp;<span class="ident" id="3390415">quoted</span>&nbsp;<span class="builtintype" id="3390422">bool</span><span class="op" id="3390426">)</span>&nbsp;<span class="op" id="3390428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390431">va</span>&nbsp;<span class="op" id="3390434">:=</span>&nbsp;<span class="ident" id="3390437">v</span><span class="op" id="3390438">.</span><span class="ident" id="3390439">Addr</span><span class="op" id="3390443">(</span><span class="op" id="3390444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390447">if</span>&nbsp;<span class="ident" id="3390450">va</span><span class="op" id="3390452">.</span><span class="ident" id="3390453">IsNil</span><span class="op" id="3390458">(</span><span class="op" id="3390459">)</span>&nbsp;<span class="op" id="3390461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390465">e</span><span class="op" id="3390466">.</span><span class="ident" id="3390467">WriteString</span><span class="op" id="3390478">(</span><span class="string" id="3390479">&#34;null&#34;</span><span class="op" id="3390485">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390489">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3390497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390500">m</span>&nbsp;<span class="op" id="3390502">:=</span>&nbsp;<span class="ident" id="3390505">va</span><span class="op" id="3390507">.</span><span class="ident" id="3390508">Interface</span><span class="op" id="3390517">(</span><span class="op" id="3390518">)</span><span class="op" id="3390519">.</span><span class="op" id="3390520">(</span><span class="ident" id="3390521">Marshaler</span><span class="op" id="3390530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390533">b</span><span class="op" id="3390534">,</span>&nbsp;<span class="ident" id="3390536">err</span>&nbsp;<span class="op" id="3390540">:=</span>&nbsp;<span class="ident" id="3390543">m</span><span class="op" id="3390544">.</span><span class="ident" id="3390545">MarshalJSON</span><span class="op" id="3390556">(</span><span class="op" id="3390557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390560">if</span>&nbsp;<span class="ident" id="3390563">err</span>&nbsp;<span class="op" id="3390567">==</span>&nbsp;<span class="builtintype" id="3390570">nil</span>&nbsp;<span class="op" id="3390574">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3390578">//&nbsp;copy&nbsp;JSON&nbsp;into&nbsp;buffer,&nbsp;checking&nbsp;validity.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390625">err</span>&nbsp;<span class="op" id="3390629">=</span>&nbsp;<span class="ident" id="3390631">compact</span><span class="op" id="3390638">(</span><span class="op" id="3390639">&amp;</span><span class="ident" id="3390640">e</span><span class="op" id="3390641">.</span><span class="ident" id="3390642">Buffer</span><span class="op" id="3390648">,</span>&nbsp;<span class="ident" id="3390650">b</span><span class="op" id="3390651">,</span>&nbsp;<span class="builtintype" id="3390653">true</span><span class="op" id="3390657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3390660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390663">if</span>&nbsp;<span class="ident" id="3390666">err</span>&nbsp;<span class="op" id="3390670">!=</span>&nbsp;<span class="builtintype" id="3390673">nil</span>&nbsp;<span class="op" id="3390677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390681">e</span><span class="op" id="3390682">.</span><span class="builtintype" id="3390683">error</span><span class="op" id="3390688">(</span><span class="op" id="3390689">&amp;</span><span class="ident" id="3390690">MarshalerError</span><span class="op" id="3390704">{</span><span class="ident" id="3390705">v</span><span class="op" id="3390706">.</span><span class="ident" id="3390707">Type</span><span class="op" id="3390711">(</span><span class="op" id="3390712">)</span><span class="op" id="3390713">,</span>&nbsp;<span class="ident" id="3390715">err</span><span class="op" id="3390718">}</span><span class="op" id="3390719">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3390722">}</span><br>
<span class="lineno"></span><span class="op" id="3390724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3390727">func</span>&nbsp;<span class="ident" id="3390732">textMarshalerEncoder</span><span class="op" id="3390752">(</span><span class="ident" id="3390753">e</span>&nbsp;<span class="op" id="3390755">*</span><span class="ident" id="3390756">encodeState</span><span class="op" id="3390767">,</span>&nbsp;<span class="ident" id="3390769">v</span>&nbsp;<span class="ident" id="3390771">reflect</span><span class="op" id="3390778">.</span><span class="ident" id="3390779">Value</span><span class="op" id="3390784">,</span>&nbsp;<span class="ident" id="3390786">quoted</span>&nbsp;<span class="builtintype" id="3390793">bool</span><span class="op" id="3390797">)</span>&nbsp;<span class="op" id="3390799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390802">if</span>&nbsp;<span class="ident" id="3390805">v</span><span class="op" id="3390806">.</span><span class="ident" id="3390807">Kind</span><span class="op" id="3390811">(</span><span class="op" id="3390812">)</span>&nbsp;<span class="op" id="3390814">==</span>&nbsp;<span class="ident" id="3390817">reflect</span><span class="op" id="3390824">.</span><span class="ident" id="3390825">Ptr</span>&nbsp;<span class="op" id="3390829">&amp;&amp;</span>&nbsp;<span class="ident" id="3390832">v</span><span class="op" id="3390833">.</span><span class="ident" id="3390834">IsNil</span><span class="op" id="3390839">(</span><span class="op" id="3390840">)</span>&nbsp;<span class="op" id="3390842">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390846">e</span><span class="op" id="3390847">.</span><span class="ident" id="3390848">WriteString</span><span class="op" id="3390859">(</span><span class="string" id="3390860">&#34;null&#34;</span><span class="op" id="3390866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390870">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3390878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390881">m</span>&nbsp;<span class="op" id="3390883">:=</span>&nbsp;<span class="ident" id="3390886">v</span><span class="op" id="3390887">.</span><span class="ident" id="3390888">Interface</span><span class="op" id="3390897">(</span><span class="op" id="3390898">)</span><span class="op" id="3390899">.</span><span class="op" id="3390900">(</span><span class="ident" id="3390901">encoding</span><span class="op" id="3390909">.</span><span class="ident" id="3390910">TextMarshaler</span><span class="op" id="3390923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390926">b</span><span class="op" id="3390927">,</span>&nbsp;<span class="ident" id="3390929">err</span>&nbsp;<span class="op" id="3390933">:=</span>&nbsp;<span class="ident" id="3390936">m</span><span class="op" id="3390937">.</span><span class="ident" id="3390938">MarshalText</span><span class="op" id="3390949">(</span><span class="op" id="3390950">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390953">if</span>&nbsp;<span class="ident" id="3390956">err</span>&nbsp;<span class="op" id="3390960">==</span>&nbsp;<span class="builtintype" id="3390963">nil</span>&nbsp;<span class="op" id="3390967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390971">_</span><span class="op" id="3390972">,</span>&nbsp;<span class="ident" id="3390974">err</span>&nbsp;<span class="op" id="3390978">=</span>&nbsp;<span class="ident" id="3390980">e</span><span class="op" id="3390981">.</span><span class="ident" id="3390982">stringBytes</span><span class="op" id="3390993">(</span><span class="ident" id="3390994">b</span><span class="op" id="3390995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3390998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391001">if</span>&nbsp;<span class="ident" id="3391004">err</span>&nbsp;<span class="op" id="3391008">!=</span>&nbsp;<span class="builtintype" id="3391011">nil</span>&nbsp;<span class="op" id="3391015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391019">e</span><span class="op" id="3391020">.</span><span class="builtintype" id="3391021">error</span><span class="op" id="3391026">(</span><span class="op" id="3391027">&amp;</span><span class="ident" id="3391028">MarshalerError</span><span class="op" id="3391042">{</span><span class="ident" id="3391043">v</span><span class="op" id="3391044">.</span><span class="ident" id="3391045">Type</span><span class="op" id="3391049">(</span><span class="op" id="3391050">)</span><span class="op" id="3391051">,</span>&nbsp;<span class="ident" id="3391053">err</span><span class="op" id="3391056">}</span><span class="op" id="3391057">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391060">}</span><br>
<span class="lineno"></span><span class="op" id="3391062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3391065">func</span>&nbsp;<span class="ident" id="3391070">addrTextMarshalerEncoder</span><span class="op" id="3391094">(</span><span class="ident" id="3391095">e</span>&nbsp;<span class="op" id="3391097">*</span><span class="ident" id="3391098">encodeState</span><span class="op" id="3391109">,</span>&nbsp;<span class="ident" id="3391111">v</span>&nbsp;<span class="ident" id="3391113">reflect</span><span class="op" id="3391120">.</span><span class="ident" id="3391121">Value</span><span class="op" id="3391126">,</span>&nbsp;<span class="ident" id="3391128">quoted</span>&nbsp;<span class="builtintype" id="3391135">bool</span><span class="op" id="3391139">)</span>&nbsp;<span class="op" id="3391141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391144">va</span>&nbsp;<span class="op" id="3391147">:=</span>&nbsp;<span class="ident" id="3391150">v</span><span class="op" id="3391151">.</span><span class="ident" id="3391152">Addr</span><span class="op" id="3391156">(</span><span class="op" id="3391157">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391160">if</span>&nbsp;<span class="ident" id="3391163">va</span><span class="op" id="3391165">.</span><span class="ident" id="3391166">IsNil</span><span class="op" id="3391171">(</span><span class="op" id="3391172">)</span>&nbsp;<span class="op" id="3391174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391178">e</span><span class="op" id="3391179">.</span><span class="ident" id="3391180">WriteString</span><span class="op" id="3391191">(</span><span class="string" id="3391192">&#34;null&#34;</span><span class="op" id="3391198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391202">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391213">m</span>&nbsp;<span class="op" id="3391215">:=</span>&nbsp;<span class="ident" id="3391218">va</span><span class="op" id="3391220">.</span><span class="ident" id="3391221">Interface</span><span class="op" id="3391230">(</span><span class="op" id="3391231">)</span><span class="op" id="3391232">.</span><span class="op" id="3391233">(</span><span class="ident" id="3391234">encoding</span><span class="op" id="3391242">.</span><span class="ident" id="3391243">TextMarshaler</span><span class="op" id="3391256">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391259">b</span><span class="op" id="3391260">,</span>&nbsp;<span class="ident" id="3391262">err</span>&nbsp;<span class="op" id="3391266">:=</span>&nbsp;<span class="ident" id="3391269">m</span><span class="op" id="3391270">.</span><span class="ident" id="3391271">MarshalText</span><span class="op" id="3391282">(</span><span class="op" id="3391283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391286">if</span>&nbsp;<span class="ident" id="3391289">err</span>&nbsp;<span class="op" id="3391293">==</span>&nbsp;<span class="builtintype" id="3391296">nil</span>&nbsp;<span class="op" id="3391300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391304">_</span><span class="op" id="3391305">,</span>&nbsp;<span class="ident" id="3391307">err</span>&nbsp;<span class="op" id="3391311">=</span>&nbsp;<span class="ident" id="3391313">e</span><span class="op" id="3391314">.</span><span class="ident" id="3391315">stringBytes</span><span class="op" id="3391326">(</span><span class="ident" id="3391327">b</span><span class="op" id="3391328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391334">if</span>&nbsp;<span class="ident" id="3391337">err</span>&nbsp;<span class="op" id="3391341">!=</span>&nbsp;<span class="builtintype" id="3391344">nil</span>&nbsp;<span class="op" id="3391348">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391352">e</span><span class="op" id="3391353">.</span><span class="builtintype" id="3391354">error</span><span class="op" id="3391359">(</span><span class="op" id="3391360">&amp;</span><span class="ident" id="3391361">MarshalerError</span><span class="op" id="3391375">{</span><span class="ident" id="3391376">v</span><span class="op" id="3391377">.</span><span class="ident" id="3391378">Type</span><span class="op" id="3391382">(</span><span class="op" id="3391383">)</span><span class="op" id="3391384">,</span>&nbsp;<span class="ident" id="3391386">err</span><span class="op" id="3391389">}</span><span class="op" id="3391390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391393">}</span><br>
<span class="lineno"></span><span class="op" id="3391395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3391398">func</span>&nbsp;<span class="ident" id="3391403">boolEncoder</span><span class="op" id="3391414">(</span><span class="ident" id="3391415">e</span>&nbsp;<span class="op" id="3391417">*</span><span class="ident" id="3391418">encodeState</span><span class="op" id="3391429">,</span>&nbsp;<span class="ident" id="3391431">v</span>&nbsp;<span class="ident" id="3391433">reflect</span><span class="op" id="3391440">.</span><span class="ident" id="3391441">Value</span><span class="op" id="3391446">,</span>&nbsp;<span class="ident" id="3391448">quoted</span>&nbsp;<span class="builtintype" id="3391455">bool</span><span class="op" id="3391459">)</span>&nbsp;<span class="op" id="3391461">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391464">if</span>&nbsp;<span class="ident" id="3391467">quoted</span>&nbsp;<span class="op" id="3391474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391478">e</span><span class="op" id="3391479">.</span><span class="ident" id="3391480">WriteByte</span><span class="op" id="3391489">(</span><span class="string" id="3391490">&#39;&#34;&#39;</span><span class="op" id="3391493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391499">if</span>&nbsp;<span class="ident" id="3391502">v</span><span class="op" id="3391503">.</span><span class="ident" id="3391504">Bool</span><span class="op" id="3391508">(</span><span class="op" id="3391509">)</span>&nbsp;<span class="op" id="3391511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391515">e</span><span class="op" id="3391516">.</span><span class="ident" id="3391517">WriteString</span><span class="op" id="3391528">(</span><span class="string" id="3391529">&#34;true&#34;</span><span class="op" id="3391535">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391538">}</span>&nbsp;<span class="keyword" id="3391540">else</span>&nbsp;<span class="op" id="3391545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391549">e</span><span class="op" id="3391550">.</span><span class="ident" id="3391551">WriteString</span><span class="op" id="3391562">(</span><span class="string" id="3391563">&#34;false&#34;</span><span class="op" id="3391570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391576">if</span>&nbsp;<span class="ident" id="3391579">quoted</span>&nbsp;<span class="op" id="3391586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391590">e</span><span class="op" id="3391591">.</span><span class="ident" id="3391592">WriteByte</span><span class="op" id="3391601">(</span><span class="string" id="3391602">&#39;&#34;&#39;</span><span class="op" id="3391605">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391608">}</span><br>
<span class="lineno"></span><span class="op" id="3391610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3391613">func</span>&nbsp;<span class="ident" id="3391618">intEncoder</span><span class="op" id="3391628">(</span><span class="ident" id="3391629">e</span>&nbsp;<span class="op" id="3391631">*</span><span class="ident" id="3391632">encodeState</span><span class="op" id="3391643">,</span>&nbsp;<span class="ident" id="3391645">v</span>&nbsp;<span class="ident" id="3391647">reflect</span><span class="op" id="3391654">.</span><span class="ident" id="3391655">Value</span><span class="op" id="3391660">,</span>&nbsp;<span class="ident" id="3391662">quoted</span>&nbsp;<span class="builtintype" id="3391669">bool</span><span class="op" id="3391673">)</span>&nbsp;<span class="op" id="3391675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391678">b</span>&nbsp;<span class="op" id="3391680">:=</span>&nbsp;<span class="ident" id="3391683">strconv</span><span class="op" id="3391690">.</span><span class="ident" id="3391691">AppendInt</span><span class="op" id="3391700">(</span><span class="ident" id="3391701">e</span><span class="op" id="3391702">.</span><span class="ident" id="3391703">scratch</span><span class="op" id="3391710">[</span><span class="op" id="3391711">:</span><span class="num" id="3391712">0</span><span class="op" id="3391713">]</span><span class="op" id="3391714">,</span>&nbsp;<span class="ident" id="3391716">v</span><span class="op" id="3391717">.</span><span class="ident" id="3391718">Int</span><span class="op" id="3391721">(</span><span class="op" id="3391722">)</span><span class="op" id="3391723">,</span>&nbsp;<span class="num" id="3391725">10</span><span class="op" id="3391727">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391730">if</span>&nbsp;<span class="ident" id="3391733">quoted</span>&nbsp;<span class="op" id="3391740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391744">e</span><span class="op" id="3391745">.</span><span class="ident" id="3391746">WriteByte</span><span class="op" id="3391755">(</span><span class="string" id="3391756">&#39;&#34;&#39;</span><span class="op" id="3391759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391765">e</span><span class="op" id="3391766">.</span><span class="ident" id="3391767">Write</span><span class="op" id="3391772">(</span><span class="ident" id="3391773">b</span><span class="op" id="3391774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391777">if</span>&nbsp;<span class="ident" id="3391780">quoted</span>&nbsp;<span class="op" id="3391787">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391791">e</span><span class="op" id="3391792">.</span><span class="ident" id="3391793">WriteByte</span><span class="op" id="3391802">(</span><span class="string" id="3391803">&#39;&#34;&#39;</span><span class="op" id="3391806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391809">}</span><br>
<span class="lineno"></span><span class="op" id="3391811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3391814">func</span>&nbsp;<span class="ident" id="3391819">uintEncoder</span><span class="op" id="3391830">(</span><span class="ident" id="3391831">e</span>&nbsp;<span class="op" id="3391833">*</span><span class="ident" id="3391834">encodeState</span><span class="op" id="3391845">,</span>&nbsp;<span class="ident" id="3391847">v</span>&nbsp;<span class="ident" id="3391849">reflect</span><span class="op" id="3391856">.</span><span class="ident" id="3391857">Value</span><span class="op" id="3391862">,</span>&nbsp;<span class="ident" id="3391864">quoted</span>&nbsp;<span class="builtintype" id="3391871">bool</span><span class="op" id="3391875">)</span>&nbsp;<span class="op" id="3391877">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391880">b</span>&nbsp;<span class="op" id="3391882">:=</span>&nbsp;<span class="ident" id="3391885">strconv</span><span class="op" id="3391892">.</span><span class="ident" id="3391893">AppendUint</span><span class="op" id="3391903">(</span><span class="ident" id="3391904">e</span><span class="op" id="3391905">.</span><span class="ident" id="3391906">scratch</span><span class="op" id="3391913">[</span><span class="op" id="3391914">:</span><span class="num" id="3391915">0</span><span class="op" id="3391916">]</span><span class="op" id="3391917">,</span>&nbsp;<span class="ident" id="3391919">v</span><span class="op" id="3391920">.</span><span class="ident" id="3391921">Uint</span><span class="op" id="3391925">(</span><span class="op" id="3391926">)</span><span class="op" id="3391927">,</span>&nbsp;<span class="num" id="3391929">10</span><span class="op" id="3391931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391934">if</span>&nbsp;<span class="ident" id="3391937">quoted</span>&nbsp;<span class="op" id="3391944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391948">e</span><span class="op" id="3391949">.</span><span class="ident" id="3391950">WriteByte</span><span class="op" id="3391959">(</span><span class="string" id="3391960">&#39;&#34;&#39;</span><span class="op" id="3391963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391969">e</span><span class="op" id="3391970">.</span><span class="ident" id="3391971">Write</span><span class="op" id="3391976">(</span><span class="ident" id="3391977">b</span><span class="op" id="3391978">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391981">if</span>&nbsp;<span class="ident" id="3391984">quoted</span>&nbsp;<span class="op" id="3391991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391995">e</span><span class="op" id="3391996">.</span><span class="ident" id="3391997">WriteByte</span><span class="op" id="3392006">(</span><span class="string" id="3392007">&#39;&#34;&#39;</span><span class="op" id="3392010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392013">}</span><br>
<span class="lineno"></span><span class="op" id="3392015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="keyword" id="3392018">type</span>&nbsp;<span class="ident" id="3392023">floatEncoder</span>&nbsp;<span class="builtintype" id="3392036">int</span>&nbsp;<span class="comment" id="3392040">//&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3392059">func</span>&nbsp;<span class="op" id="3392064">(</span><span class="ident" id="3392065">bits</span>&nbsp;<span class="ident" id="3392070">floatEncoder</span><span class="op" id="3392082">)</span>&nbsp;<span class="ident" id="3392084">encode</span><span class="op" id="3392090">(</span><span class="ident" id="3392091">e</span>&nbsp;<span class="op" id="3392093">*</span><span class="ident" id="3392094">encodeState</span><span class="op" id="3392105">,</span>&nbsp;<span class="ident" id="3392107">v</span>&nbsp;<span class="ident" id="3392109">reflect</span><span class="op" id="3392116">.</span><span class="ident" id="3392117">Value</span><span class="op" id="3392122">,</span>&nbsp;<span class="ident" id="3392124">quoted</span>&nbsp;<span class="builtintype" id="3392131">bool</span><span class="op" id="3392135">)</span>&nbsp;<span class="op" id="3392137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392140">f</span>&nbsp;<span class="op" id="3392142">:=</span>&nbsp;<span class="ident" id="3392145">v</span><span class="op" id="3392146">.</span><span class="ident" id="3392147">Float</span><span class="op" id="3392152">(</span><span class="op" id="3392153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392156">if</span>&nbsp;<span class="ident" id="3392159">math</span><span class="op" id="3392163">.</span><span class="ident" id="3392164">IsInf</span><span class="op" id="3392169">(</span><span class="ident" id="3392170">f</span><span class="op" id="3392171">,</span>&nbsp;<span class="num" id="3392173">0</span><span class="op" id="3392174">)</span>&nbsp;<span class="op" id="3392176">||</span>&nbsp;<span class="ident" id="3392179">math</span><span class="op" id="3392183">.</span><span class="ident" id="3392184">IsNaN</span><span class="op" id="3392189">(</span><span class="ident" id="3392190">f</span><span class="op" id="3392191">)</span>&nbsp;<span class="op" id="3392193">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392197">e</span><span class="op" id="3392198">.</span><span class="builtintype" id="3392199">error</span><span class="op" id="3392204">(</span><span class="op" id="3392205">&amp;</span><span class="ident" id="3392206">UnsupportedValueError</span><span class="op" id="3392227">{</span><span class="ident" id="3392228">v</span><span class="op" id="3392229">,</span>&nbsp;<span class="ident" id="3392231">strconv</span><span class="op" id="3392238">.</span><span class="ident" id="3392239">FormatFloat</span><span class="op" id="3392250">(</span><span class="ident" id="3392251">f</span><span class="op" id="3392252">,</span>&nbsp;<span class="string" id="3392254">&#39;g&#39;</span><span class="op" id="3392257">,</span>&nbsp;<span class="op" id="3392259">-</span><span class="num" id="3392260">1</span><span class="op" id="3392261">,</span>&nbsp;<span class="builtintype" id="3392263">int</span><span class="op" id="3392266">(</span><span class="ident" id="3392267">bits</span><span class="op" id="3392271">)</span><span class="op" id="3392272">)</span><span class="op" id="3392273">}</span><span class="op" id="3392274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392280">b</span>&nbsp;<span class="op" id="3392282">:=</span>&nbsp;<span class="ident" id="3392285">strconv</span><span class="op" id="3392292">.</span><span class="ident" id="3392293">AppendFloat</span><span class="op" id="3392304">(</span><span class="ident" id="3392305">e</span><span class="op" id="3392306">.</span><span class="ident" id="3392307">scratch</span><span class="op" id="3392314">[</span><span class="op" id="3392315">:</span><span class="num" id="3392316">0</span><span class="op" id="3392317">]</span><span class="op" id="3392318">,</span>&nbsp;<span class="ident" id="3392320">f</span><span class="op" id="3392321">,</span>&nbsp;<span class="string" id="3392323">&#39;g&#39;</span><span class="op" id="3392326">,</span>&nbsp;<span class="op" id="3392328">-</span><span class="num" id="3392329">1</span><span class="op" id="3392330">,</span>&nbsp;<span class="builtintype" id="3392332">int</span><span class="op" id="3392335">(</span><span class="ident" id="3392336">bits</span><span class="op" id="3392340">)</span><span class="op" id="3392341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392344">if</span>&nbsp;<span class="ident" id="3392347">quoted</span>&nbsp;<span class="op" id="3392354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392358">e</span><span class="op" id="3392359">.</span><span class="ident" id="3392360">WriteByte</span><span class="op" id="3392369">(</span><span class="string" id="3392370">&#39;&#34;&#39;</span><span class="op" id="3392373">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392379">e</span><span class="op" id="3392380">.</span><span class="ident" id="3392381">Write</span><span class="op" id="3392386">(</span><span class="ident" id="3392387">b</span><span class="op" id="3392388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392391">if</span>&nbsp;<span class="ident" id="3392394">quoted</span>&nbsp;<span class="op" id="3392401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392405">e</span><span class="op" id="3392406">.</span><span class="ident" id="3392407">WriteByte</span><span class="op" id="3392416">(</span><span class="string" id="3392417">&#39;&#34;&#39;</span><span class="op" id="3392420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392423">}</span><br>
<span class="lineno">525</span><span class="op" id="3392425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3392428">var</span>&nbsp;<span class="op" id="3392432">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392435">float32Encoder</span>&nbsp;<span class="op" id="3392450">=</span>&nbsp;<span class="op" id="3392452">(</span><span class="ident" id="3392453">floatEncoder</span><span class="op" id="3392465">(</span><span class="num" id="3392466">32</span><span class="op" id="3392468">)</span><span class="op" id="3392469">)</span><span class="op" id="3392470">.</span><span class="ident" id="3392471">encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392479">float64Encoder</span>&nbsp;<span class="op" id="3392494">=</span>&nbsp;<span class="op" id="3392496">(</span><span class="ident" id="3392497">floatEncoder</span><span class="op" id="3392509">(</span><span class="num" id="3392510">64</span><span class="op" id="3392512">)</span><span class="op" id="3392513">)</span><span class="op" id="3392514">.</span><span class="ident" id="3392515">encode</span><br>
<span class="lineno">530</span><span class="op" id="3392522">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3392525">func</span>&nbsp;<span class="ident" id="3392530">stringEncoder</span><span class="op" id="3392543">(</span><span class="ident" id="3392544">e</span>&nbsp;<span class="op" id="3392546">*</span><span class="ident" id="3392547">encodeState</span><span class="op" id="3392558">,</span>&nbsp;<span class="ident" id="3392560">v</span>&nbsp;<span class="ident" id="3392562">reflect</span><span class="op" id="3392569">.</span><span class="ident" id="3392570">Value</span><span class="op" id="3392575">,</span>&nbsp;<span class="ident" id="3392577">quoted</span>&nbsp;<span class="builtintype" id="3392584">bool</span><span class="op" id="3392588">)</span>&nbsp;<span class="op" id="3392590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392593">if</span>&nbsp;<span class="ident" id="3392596">v</span><span class="op" id="3392597">.</span><span class="ident" id="3392598">Type</span><span class="op" id="3392602">(</span><span class="op" id="3392603">)</span>&nbsp;<span class="op" id="3392605">==</span>&nbsp;<span class="ident" id="3392608">numberType</span>&nbsp;<span class="op" id="3392619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392623">numStr</span>&nbsp;<span class="op" id="3392630">:=</span>&nbsp;<span class="ident" id="3392633">v</span><span class="op" id="3392634">.</span><span class="ident" id="3392635">String</span><span class="op" id="3392641">(</span><span class="op" id="3392642">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392646">if</span>&nbsp;<span class="ident" id="3392649">numStr</span>&nbsp;<span class="op" id="3392656">==</span>&nbsp;<span class="string" id="3392659">&#34;&#34;</span>&nbsp;<span class="op" id="3392662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392667">numStr</span>&nbsp;<span class="op" id="3392674">=</span>&nbsp;<span class="string" id="3392676">&#34;0&#34;</span>&nbsp;<span class="comment" id="3392680">//&nbsp;Number&#39;s&nbsp;zero-val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392707">e</span><span class="op" id="3392708">.</span><span class="ident" id="3392709">WriteString</span><span class="op" id="3392720">(</span><span class="ident" id="3392721">numStr</span><span class="op" id="3392727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392731">return</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392742">if</span>&nbsp;<span class="ident" id="3392745">quoted</span>&nbsp;<span class="op" id="3392752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392756">sb</span><span class="op" id="3392758">,</span>&nbsp;<span class="ident" id="3392760">err</span>&nbsp;<span class="op" id="3392764">:=</span>&nbsp;<span class="ident" id="3392767">Marshal</span><span class="op" id="3392774">(</span><span class="ident" id="3392775">v</span><span class="op" id="3392776">.</span><span class="ident" id="3392777">String</span><span class="op" id="3392783">(</span><span class="op" id="3392784">)</span><span class="op" id="3392785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392789">if</span>&nbsp;<span class="ident" id="3392792">err</span>&nbsp;<span class="op" id="3392796">!=</span>&nbsp;<span class="builtintype" id="3392799">nil</span>&nbsp;<span class="op" id="3392803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392808">e</span><span class="op" id="3392809">.</span><span class="builtintype" id="3392810">error</span><span class="op" id="3392815">(</span><span class="ident" id="3392816">err</span><span class="op" id="3392819">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392827">e</span><span class="op" id="3392828">.</span><span class="builtintype" id="3392829">string</span><span class="op" id="3392835">(</span><span class="builtintype" id="3392836">string</span><span class="op" id="3392842">(</span><span class="ident" id="3392843">sb</span><span class="op" id="3392845">)</span><span class="op" id="3392846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392849">}</span>&nbsp;<span class="keyword" id="3392851">else</span>&nbsp;<span class="op" id="3392856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392860">e</span><span class="op" id="3392861">.</span><span class="builtintype" id="3392862">string</span><span class="op" id="3392868">(</span><span class="ident" id="3392869">v</span><span class="op" id="3392870">.</span><span class="ident" id="3392871">String</span><span class="op" id="3392877">(</span><span class="op" id="3392878">)</span><span class="op" id="3392879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392882">}</span><br>
<span class="lineno">550</span><span class="op" id="3392884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3392887">func</span>&nbsp;<span class="ident" id="3392892">interfaceEncoder</span><span class="op" id="3392908">(</span><span class="ident" id="3392909">e</span>&nbsp;<span class="op" id="3392911">*</span><span class="ident" id="3392912">encodeState</span><span class="op" id="3392923">,</span>&nbsp;<span class="ident" id="3392925">v</span>&nbsp;<span class="ident" id="3392927">reflect</span><span class="op" id="3392934">.</span><span class="ident" id="3392935">Value</span><span class="op" id="3392940">,</span>&nbsp;<span class="ident" id="3392942">quoted</span>&nbsp;<span class="builtintype" id="3392949">bool</span><span class="op" id="3392953">)</span>&nbsp;<span class="op" id="3392955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392958">if</span>&nbsp;<span class="ident" id="3392961">v</span><span class="op" id="3392962">.</span><span class="ident" id="3392963">IsNil</span><span class="op" id="3392968">(</span><span class="op" id="3392969">)</span>&nbsp;<span class="op" id="3392971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392975">e</span><span class="op" id="3392976">.</span><span class="ident" id="3392977">WriteString</span><span class="op" id="3392988">(</span><span class="string" id="3392989">&#34;null&#34;</span><span class="op" id="3392995">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392999">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393010">e</span><span class="op" id="3393011">.</span><span class="ident" id="3393012">reflectValue</span><span class="op" id="3393024">(</span><span class="ident" id="3393025">v</span><span class="op" id="3393026">.</span><span class="ident" id="3393027">Elem</span><span class="op" id="3393031">(</span><span class="op" id="3393032">)</span><span class="op" id="3393033">)</span><br>
<span class="lineno"></span><span class="op" id="3393035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span><span class="keyword" id="3393038">func</span>&nbsp;<span class="ident" id="3393043">unsupportedTypeEncoder</span><span class="op" id="3393065">(</span><span class="ident" id="3393066">e</span>&nbsp;<span class="op" id="3393068">*</span><span class="ident" id="3393069">encodeState</span><span class="op" id="3393080">,</span>&nbsp;<span class="ident" id="3393082">v</span>&nbsp;<span class="ident" id="3393084">reflect</span><span class="op" id="3393091">.</span><span class="ident" id="3393092">Value</span><span class="op" id="3393097">,</span>&nbsp;<span class="ident" id="3393099">quoted</span>&nbsp;<span class="builtintype" id="3393106">bool</span><span class="op" id="3393110">)</span>&nbsp;<span class="op" id="3393112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393115">e</span><span class="op" id="3393116">.</span><span class="builtintype" id="3393117">error</span><span class="op" id="3393122">(</span><span class="op" id="3393123">&amp;</span><span class="ident" id="3393124">UnsupportedTypeError</span><span class="op" id="3393144">{</span><span class="ident" id="3393145">v</span><span class="op" id="3393146">.</span><span class="ident" id="3393147">Type</span><span class="op" id="3393151">(</span><span class="op" id="3393152">)</span><span class="op" id="3393153">}</span><span class="op" id="3393154">)</span><br>
<span class="lineno"></span><span class="op" id="3393156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3393159">type</span>&nbsp;<span class="ident" id="3393164">structEncoder</span>&nbsp;<span class="keyword" id="3393178">struct</span>&nbsp;<span class="op" id="3393185">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393188">fields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393198">[</span><span class="op" id="3393199">]</span><span class="ident" id="3393200">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393207">fieldEncs</span>&nbsp;<span class="op" id="3393217">[</span><span class="op" id="3393218">]</span><span class="ident" id="3393219">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="3393231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3393234">func</span>&nbsp;<span class="op" id="3393239">(</span><span class="ident" id="3393240">se</span>&nbsp;<span class="op" id="3393243">*</span><span class="ident" id="3393244">structEncoder</span><span class="op" id="3393257">)</span>&nbsp;<span class="ident" id="3393259">encode</span><span class="op" id="3393265">(</span><span class="ident" id="3393266">e</span>&nbsp;<span class="op" id="3393268">*</span><span class="ident" id="3393269">encodeState</span><span class="op" id="3393280">,</span>&nbsp;<span class="ident" id="3393282">v</span>&nbsp;<span class="ident" id="3393284">reflect</span><span class="op" id="3393291">.</span><span class="ident" id="3393292">Value</span><span class="op" id="3393297">,</span>&nbsp;<span class="ident" id="3393299">quoted</span>&nbsp;<span class="builtintype" id="3393306">bool</span><span class="op" id="3393310">)</span>&nbsp;<span class="op" id="3393312">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393315">e</span><span class="op" id="3393316">.</span><span class="ident" id="3393317">WriteByte</span><span class="op" id="3393326">(</span><span class="string" id="3393327">&#39;{&#39;</span><span class="op" id="3393330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393333">first</span>&nbsp;<span class="op" id="3393339">:=</span>&nbsp;<span class="builtintype" id="3393342">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393348">for</span>&nbsp;<span class="ident" id="3393352">i</span><span class="op" id="3393353">,</span>&nbsp;<span class="ident" id="3393355">f</span>&nbsp;<span class="op" id="3393357">:=</span>&nbsp;<span class="keyword" id="3393360">range</span>&nbsp;<span class="ident" id="3393366">se</span><span class="op" id="3393368">.</span><span class="ident" id="3393369">fields</span>&nbsp;<span class="op" id="3393376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393380">fv</span>&nbsp;<span class="op" id="3393383">:=</span>&nbsp;<span class="ident" id="3393386">fieldByIndex</span><span class="op" id="3393398">(</span><span class="ident" id="3393399">v</span><span class="op" id="3393400">,</span>&nbsp;<span class="ident" id="3393402">f</span><span class="op" id="3393403">.</span><span class="ident" id="3393404">index</span><span class="op" id="3393409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393413">if</span>&nbsp;<span class="op" id="3393416">!</span><span class="ident" id="3393417">fv</span><span class="op" id="3393419">.</span><span class="ident" id="3393420">IsValid</span><span class="op" id="3393427">(</span><span class="op" id="3393428">)</span>&nbsp;<span class="op" id="3393430">||</span>&nbsp;<span class="ident" id="3393433">f</span><span class="op" id="3393434">.</span><span class="ident" id="3393435">omitEmpty</span>&nbsp;<span class="op" id="3393445">&amp;&amp;</span>&nbsp;<span class="ident" id="3393448">isEmptyValue</span><span class="op" id="3393460">(</span><span class="ident" id="3393461">fv</span><span class="op" id="3393463">)</span>&nbsp;<span class="op" id="3393465">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393470">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393485">if</span>&nbsp;<span class="ident" id="3393488">first</span>&nbsp;<span class="op" id="3393494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393499">first</span>&nbsp;<span class="op" id="3393505">=</span>&nbsp;<span class="builtintype" id="3393507">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393515">}</span>&nbsp;<span class="keyword" id="3393517">else</span>&nbsp;<span class="op" id="3393522">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393527">e</span><span class="op" id="3393528">.</span><span class="ident" id="3393529">WriteByte</span><span class="op" id="3393538">(</span><span class="string" id="3393539">&#39;,&#39;</span><span class="op" id="3393542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393550">e</span><span class="op" id="3393551">.</span><span class="builtintype" id="3393552">string</span><span class="op" id="3393558">(</span><span class="ident" id="3393559">f</span><span class="op" id="3393560">.</span><span class="ident" id="3393561">name</span><span class="op" id="3393565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393569">e</span><span class="op" id="3393570">.</span><span class="ident" id="3393571">WriteByte</span><span class="op" id="3393580">(</span><span class="string" id="3393581">&#39;:&#39;</span><span class="op" id="3393584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393588">se</span><span class="op" id="3393590">.</span><span class="ident" id="3393591">fieldEncs</span><span class="op" id="3393600">[</span><span class="ident" id="3393601">i</span><span class="op" id="3393602">]</span><span class="op" id="3393603">(</span><span class="ident" id="3393604">e</span><span class="op" id="3393605">,</span>&nbsp;<span class="ident" id="3393607">fv</span><span class="op" id="3393609">,</span>&nbsp;<span class="ident" id="3393611">f</span><span class="op" id="3393612">.</span><span class="ident" id="3393613">quoted</span><span class="op" id="3393619">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393625">e</span><span class="op" id="3393626">.</span><span class="ident" id="3393627">WriteByte</span><span class="op" id="3393636">(</span><span class="string" id="3393637">&#39;}&#39;</span><span class="op" id="3393640">)</span><br>
<span class="lineno"></span><span class="op" id="3393642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3393645">func</span>&nbsp;<span class="ident" id="3393650">newStructEncoder</span><span class="op" id="3393666">(</span><span class="ident" id="3393667">t</span>&nbsp;<span class="ident" id="3393669">reflect</span><span class="op" id="3393676">.</span><span class="ident" id="3393677">Type</span><span class="op" id="3393681">)</span>&nbsp;<span class="ident" id="3393683">encoderFunc</span>&nbsp;<span class="op" id="3393695">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393698">fields</span>&nbsp;<span class="op" id="3393705">:=</span>&nbsp;<span class="ident" id="3393708">cachedTypeFields</span><span class="op" id="3393724">(</span><span class="ident" id="3393725">t</span><span class="op" id="3393726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393729">se</span>&nbsp;<span class="op" id="3393732">:=</span>&nbsp;<span class="op" id="3393735">&amp;</span><span class="ident" id="3393736">structEncoder</span><span class="op" id="3393749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393753">fields</span><span class="op" id="3393759">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393764">fields</span><span class="op" id="3393770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393774">fieldEncs</span><span class="op" id="3393783">:</span>&nbsp;<span class="builtinfunc" id="3393785">make</span><span class="op" id="3393789">(</span><span class="op" id="3393790">[</span><span class="op" id="3393791">]</span><span class="ident" id="3393792">encoderFunc</span><span class="op" id="3393803">,</span>&nbsp;<span class="builtinfunc" id="3393805">len</span><span class="op" id="3393808">(</span><span class="ident" id="3393809">fields</span><span class="op" id="3393815">)</span><span class="op" id="3393816">)</span><span class="op" id="3393817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393820">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393823">for</span>&nbsp;<span class="ident" id="3393827">i</span><span class="op" id="3393828">,</span>&nbsp;<span class="ident" id="3393830">f</span>&nbsp;<span class="op" id="3393832">:=</span>&nbsp;<span class="keyword" id="3393835">range</span>&nbsp;<span class="ident" id="3393841">fields</span>&nbsp;<span class="op" id="3393848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393852">se</span><span class="op" id="3393854">.</span><span class="ident" id="3393855">fieldEncs</span><span class="op" id="3393864">[</span><span class="ident" id="3393865">i</span><span class="op" id="3393866">]</span>&nbsp;<span class="op" id="3393868">=</span>&nbsp;<span class="ident" id="3393870">typeEncoder</span><span class="op" id="3393881">(</span><span class="ident" id="3393882">typeByIndex</span><span class="op" id="3393893">(</span><span class="ident" id="3393894">t</span><span class="op" id="3393895">,</span>&nbsp;<span class="ident" id="3393897">f</span><span class="op" id="3393898">.</span><span class="ident" id="3393899">index</span><span class="op" id="3393904">)</span><span class="op" id="3393905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393911">return</span>&nbsp;<span class="ident" id="3393918">se</span><span class="op" id="3393920">.</span><span class="ident" id="3393921">encode</span><br>
<span class="lineno"></span><span class="op" id="3393928">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="3393931">type</span>&nbsp;<span class="ident" id="3393936">mapEncoder</span>&nbsp;<span class="keyword" id="3393947">struct</span>&nbsp;<span class="op" id="3393954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393957">elemEnc</span>&nbsp;<span class="ident" id="3393965">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="3393977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="keyword" id="3393980">func</span>&nbsp;<span class="op" id="3393985">(</span><span class="ident" id="3393986">me</span>&nbsp;<span class="op" id="3393989">*</span><span class="ident" id="3393990">mapEncoder</span><span class="op" id="3394000">)</span>&nbsp;<span class="ident" id="3394002">encode</span><span class="op" id="3394008">(</span><span class="ident" id="3394009">e</span>&nbsp;<span class="op" id="3394011">*</span><span class="ident" id="3394012">encodeState</span><span class="op" id="3394023">,</span>&nbsp;<span class="ident" id="3394025">v</span>&nbsp;<span class="ident" id="3394027">reflect</span><span class="op" id="3394034">.</span><span class="ident" id="3394035">Value</span><span class="op" id="3394040">,</span>&nbsp;<span class="ident" id="3394042">_</span>&nbsp;<span class="builtintype" id="3394044">bool</span><span class="op" id="3394048">)</span>&nbsp;<span class="op" id="3394050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394053">if</span>&nbsp;<span class="ident" id="3394056">v</span><span class="op" id="3394057">.</span><span class="ident" id="3394058">IsNil</span><span class="op" id="3394063">(</span><span class="op" id="3394064">)</span>&nbsp;<span class="op" id="3394066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394070">e</span><span class="op" id="3394071">.</span><span class="ident" id="3394072">WriteString</span><span class="op" id="3394083">(</span><span class="string" id="3394084">&#34;null&#34;</span><span class="op" id="3394090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394094">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394102">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394105">e</span><span class="op" id="3394106">.</span><span class="ident" id="3394107">WriteByte</span><span class="op" id="3394116">(</span><span class="string" id="3394117">&#39;{&#39;</span><span class="op" id="3394120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394123">var</span>&nbsp;<span class="ident" id="3394127">sv</span>&nbsp;<span class="ident" id="3394130">stringValues</span>&nbsp;<span class="op" id="3394143">=</span>&nbsp;<span class="ident" id="3394145">v</span><span class="op" id="3394146">.</span><span class="ident" id="3394147">MapKeys</span><span class="op" id="3394154">(</span><span class="op" id="3394155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394158">sort</span><span class="op" id="3394162">.</span><span class="ident" id="3394163">Sort</span><span class="op" id="3394167">(</span><span class="ident" id="3394168">sv</span><span class="op" id="3394170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394173">for</span>&nbsp;<span class="ident" id="3394177">i</span><span class="op" id="3394178">,</span>&nbsp;<span class="ident" id="3394180">k</span>&nbsp;<span class="op" id="3394182">:=</span>&nbsp;<span class="keyword" id="3394185">range</span>&nbsp;<span class="ident" id="3394191">sv</span>&nbsp;<span class="op" id="3394194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394198">if</span>&nbsp;<span class="ident" id="3394201">i</span>&nbsp;<span class="op" id="3394203">&gt;</span>&nbsp;<span class="num" id="3394205">0</span>&nbsp;<span class="op" id="3394207">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394212">e</span><span class="op" id="3394213">.</span><span class="ident" id="3394214">WriteByte</span><span class="op" id="3394223">(</span><span class="string" id="3394224">&#39;,&#39;</span><span class="op" id="3394227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394235">e</span><span class="op" id="3394236">.</span><span class="builtintype" id="3394237">string</span><span class="op" id="3394243">(</span><span class="ident" id="3394244">k</span><span class="op" id="3394245">.</span><span class="ident" id="3394246">String</span><span class="op" id="3394252">(</span><span class="op" id="3394253">)</span><span class="op" id="3394254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394258">e</span><span class="op" id="3394259">.</span><span class="ident" id="3394260">WriteByte</span><span class="op" id="3394269">(</span><span class="string" id="3394270">&#39;:&#39;</span><span class="op" id="3394273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394277">me</span><span class="op" id="3394279">.</span><span class="ident" id="3394280">elemEnc</span><span class="op" id="3394287">(</span><span class="ident" id="3394288">e</span><span class="op" id="3394289">,</span>&nbsp;<span class="ident" id="3394291">v</span><span class="op" id="3394292">.</span><span class="ident" id="3394293">MapIndex</span><span class="op" id="3394301">(</span><span class="ident" id="3394302">k</span><span class="op" id="3394303">)</span><span class="op" id="3394304">,</span>&nbsp;<span class="builtintype" id="3394306">false</span><span class="op" id="3394311">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394317">e</span><span class="op" id="3394318">.</span><span class="ident" id="3394319">WriteByte</span><span class="op" id="3394328">(</span><span class="string" id="3394329">&#39;}&#39;</span><span class="op" id="3394332">)</span><br>
<span class="lineno"></span><span class="op" id="3394334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3394337">func</span>&nbsp;<span class="ident" id="3394342">newMapEncoder</span><span class="op" id="3394355">(</span><span class="ident" id="3394356">t</span>&nbsp;<span class="ident" id="3394358">reflect</span><span class="op" id="3394365">.</span><span class="ident" id="3394366">Type</span><span class="op" id="3394370">)</span>&nbsp;<span class="ident" id="3394372">encoderFunc</span>&nbsp;<span class="op" id="3394384">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394387">if</span>&nbsp;<span class="ident" id="3394390">t</span><span class="op" id="3394391">.</span><span class="ident" id="3394392">Key</span><span class="op" id="3394395">(</span><span class="op" id="3394396">)</span><span class="op" id="3394397">.</span><span class="ident" id="3394398">Kind</span><span class="op" id="3394402">(</span><span class="op" id="3394403">)</span>&nbsp;<span class="op" id="3394405">!=</span>&nbsp;<span class="ident" id="3394408">reflect</span><span class="op" id="3394415">.</span><span class="ident" id="3394416">String</span>&nbsp;<span class="op" id="3394423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394427">return</span>&nbsp;<span class="ident" id="3394434">unsupportedTypeEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394461">me</span>&nbsp;<span class="op" id="3394464">:=</span>&nbsp;<span class="op" id="3394467">&amp;</span><span class="ident" id="3394468">mapEncoder</span><span class="op" id="3394478">{</span><span class="ident" id="3394479">typeEncoder</span><span class="op" id="3394490">(</span><span class="ident" id="3394491">t</span><span class="op" id="3394492">.</span><span class="ident" id="3394493">Elem</span><span class="op" id="3394497">(</span><span class="op" id="3394498">)</span><span class="op" id="3394499">)</span><span class="op" id="3394500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394503">return</span>&nbsp;<span class="ident" id="3394510">me</span><span class="op" id="3394512">.</span><span class="ident" id="3394513">encode</span><br>
<span class="lineno">630</span><span class="op" id="3394520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3394523">func</span>&nbsp;<span class="ident" id="3394528">encodeByteSlice</span><span class="op" id="3394543">(</span><span class="ident" id="3394544">e</span>&nbsp;<span class="op" id="3394546">*</span><span class="ident" id="3394547">encodeState</span><span class="op" id="3394558">,</span>&nbsp;<span class="ident" id="3394560">v</span>&nbsp;<span class="ident" id="3394562">reflect</span><span class="op" id="3394569">.</span><span class="ident" id="3394570">Value</span><span class="op" id="3394575">,</span>&nbsp;<span class="ident" id="3394577">_</span>&nbsp;<span class="builtintype" id="3394579">bool</span><span class="op" id="3394583">)</span>&nbsp;<span class="op" id="3394585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394588">if</span>&nbsp;<span class="ident" id="3394591">v</span><span class="op" id="3394592">.</span><span class="ident" id="3394593">IsNil</span><span class="op" id="3394598">(</span><span class="op" id="3394599">)</span>&nbsp;<span class="op" id="3394601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394605">e</span><span class="op" id="3394606">.</span><span class="ident" id="3394607">WriteString</span><span class="op" id="3394618">(</span><span class="string" id="3394619">&#34;null&#34;</span><span class="op" id="3394625">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394629">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394640">s</span>&nbsp;<span class="op" id="3394642">:=</span>&nbsp;<span class="ident" id="3394645">v</span><span class="op" id="3394646">.</span><span class="ident" id="3394647">Bytes</span><span class="op" id="3394652">(</span><span class="op" id="3394653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394656">e</span><span class="op" id="3394657">.</span><span class="ident" id="3394658">WriteByte</span><span class="op" id="3394667">(</span><span class="string" id="3394668">&#39;&#34;&#39;</span><span class="op" id="3394671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394674">if</span>&nbsp;<span class="builtinfunc" id="3394677">len</span><span class="op" id="3394680">(</span><span class="ident" id="3394681">s</span><span class="op" id="3394682">)</span>&nbsp;<span class="op" id="3394684">&lt;</span>&nbsp;<span class="num" id="3394686">1024</span>&nbsp;<span class="op" id="3394691">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3394695">//&nbsp;for&nbsp;small&nbsp;buffers,&nbsp;using&nbsp;Encode&nbsp;directly&nbsp;is&nbsp;much&nbsp;faster.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394757">dst</span>&nbsp;<span class="op" id="3394761">:=</span>&nbsp;<span class="builtinfunc" id="3394764">make</span><span class="op" id="3394768">(</span><span class="op" id="3394769">[</span><span class="op" id="3394770">]</span><span class="builtintype" id="3394771">byte</span><span class="op" id="3394775">,</span>&nbsp;<span class="ident" id="3394777">base64</span><span class="op" id="3394783">.</span><span class="ident" id="3394784">StdEncoding</span><span class="op" id="3394795">.</span><span class="ident" id="3394796">EncodedLen</span><span class="op" id="3394806">(</span><span class="builtinfunc" id="3394807">len</span><span class="op" id="3394810">(</span><span class="ident" id="3394811">s</span><span class="op" id="3394812">)</span><span class="op" id="3394813">)</span><span class="op" id="3394814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394818">base64</span><span class="op" id="3394824">.</span><span class="ident" id="3394825">StdEncoding</span><span class="op" id="3394836">.</span><span class="ident" id="3394837">Encode</span><span class="op" id="3394843">(</span><span class="ident" id="3394844">dst</span><span class="op" id="3394847">,</span>&nbsp;<span class="ident" id="3394849">s</span><span class="op" id="3394850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394854">e</span><span class="op" id="3394855">.</span><span class="ident" id="3394856">Write</span><span class="op" id="3394861">(</span><span class="ident" id="3394862">dst</span><span class="op" id="3394865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394868">}</span>&nbsp;<span class="keyword" id="3394870">else</span>&nbsp;<span class="op" id="3394875">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3394879">//&nbsp;for&nbsp;large&nbsp;buffers,&nbsp;avoid&nbsp;unnecessary&nbsp;extra&nbsp;temporary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3394937">//&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394956">enc</span>&nbsp;<span class="op" id="3394960">:=</span>&nbsp;<span class="ident" id="3394963">base64</span><span class="op" id="3394969">.</span><span class="ident" id="3394970">NewEncoder</span><span class="op" id="3394980">(</span><span class="ident" id="3394981">base64</span><span class="op" id="3394987">.</span><span class="ident" id="3394988">StdEncoding</span><span class="op" id="3394999">,</span>&nbsp;<span class="ident" id="3395001">e</span><span class="op" id="3395002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395006">enc</span><span class="op" id="3395009">.</span><span class="ident" id="3395010">Write</span><span class="op" id="3395015">(</span><span class="ident" id="3395016">s</span><span class="op" id="3395017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395021">enc</span><span class="op" id="3395024">.</span><span class="ident" id="3395025">Close</span><span class="op" id="3395030">(</span><span class="op" id="3395031">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395037">e</span><span class="op" id="3395038">.</span><span class="ident" id="3395039">WriteByte</span><span class="op" id="3395048">(</span><span class="string" id="3395049">&#39;&#34;&#39;</span><span class="op" id="3395052">)</span><br>
<span class="lineno"></span><span class="op" id="3395054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3395057">//&nbsp;sliceEncoder&nbsp;just&nbsp;wraps&nbsp;an&nbsp;arrayEncoder,&nbsp;checking&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;value&nbsp;isn&#39;t&nbsp;nil.</span><br>
<span class="lineno">655</span><span class="keyword" id="3395144">type</span>&nbsp;<span class="ident" id="3395149">sliceEncoder</span>&nbsp;<span class="keyword" id="3395162">struct</span>&nbsp;<span class="op" id="3395169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395172">arrayEnc</span>&nbsp;<span class="ident" id="3395181">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="3395193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3395196">func</span>&nbsp;<span class="op" id="3395201">(</span><span class="ident" id="3395202">se</span>&nbsp;<span class="op" id="3395205">*</span><span class="ident" id="3395206">sliceEncoder</span><span class="op" id="3395218">)</span>&nbsp;<span class="ident" id="3395220">encode</span><span class="op" id="3395226">(</span><span class="ident" id="3395227">e</span>&nbsp;<span class="op" id="3395229">*</span><span class="ident" id="3395230">encodeState</span><span class="op" id="3395241">,</span>&nbsp;<span class="ident" id="3395243">v</span>&nbsp;<span class="ident" id="3395245">reflect</span><span class="op" id="3395252">.</span><span class="ident" id="3395253">Value</span><span class="op" id="3395258">,</span>&nbsp;<span class="ident" id="3395260">_</span>&nbsp;<span class="builtintype" id="3395262">bool</span><span class="op" id="3395266">)</span>&nbsp;<span class="op" id="3395268">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395271">if</span>&nbsp;<span class="ident" id="3395274">v</span><span class="op" id="3395275">.</span><span class="ident" id="3395276">IsNil</span><span class="op" id="3395281">(</span><span class="op" id="3395282">)</span>&nbsp;<span class="op" id="3395284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395288">e</span><span class="op" id="3395289">.</span><span class="ident" id="3395290">WriteString</span><span class="op" id="3395301">(</span><span class="string" id="3395302">&#34;null&#34;</span><span class="op" id="3395308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395312">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395323">se</span><span class="op" id="3395325">.</span><span class="ident" id="3395326">arrayEnc</span><span class="op" id="3395334">(</span><span class="ident" id="3395335">e</span><span class="op" id="3395336">,</span>&nbsp;<span class="ident" id="3395338">v</span><span class="op" id="3395339">,</span>&nbsp;<span class="builtintype" id="3395341">false</span><span class="op" id="3395346">)</span><br>
<span class="lineno">665</span><span class="op" id="3395348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3395351">func</span>&nbsp;<span class="ident" id="3395356">newSliceEncoder</span><span class="op" id="3395371">(</span><span class="ident" id="3395372">t</span>&nbsp;<span class="ident" id="3395374">reflect</span><span class="op" id="3395381">.</span><span class="ident" id="3395382">Type</span><span class="op" id="3395386">)</span>&nbsp;<span class="ident" id="3395388">encoderFunc</span>&nbsp;<span class="op" id="3395400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3395403">//&nbsp;Byte&nbsp;slices&nbsp;get&nbsp;special&nbsp;treatment;&nbsp;arrays&nbsp;don&#39;t.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395456">if</span>&nbsp;<span class="ident" id="3395459">t</span><span class="op" id="3395460">.</span><span class="ident" id="3395461">Elem</span><span class="op" id="3395465">(</span><span class="op" id="3395466">)</span><span class="op" id="3395467">.</span><span class="ident" id="3395468">Kind</span><span class="op" id="3395472">(</span><span class="op" id="3395473">)</span>&nbsp;<span class="op" id="3395475">==</span>&nbsp;<span class="ident" id="3395478">reflect</span><span class="op" id="3395485">.</span><span class="ident" id="3395486">Uint8</span>&nbsp;<span class="op" id="3395492">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395496">return</span>&nbsp;<span class="ident" id="3395503">encodeByteSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395523">enc</span>&nbsp;<span class="op" id="3395527">:=</span>&nbsp;<span class="op" id="3395530">&amp;</span><span class="ident" id="3395531">sliceEncoder</span><span class="op" id="3395543">{</span><span class="ident" id="3395544">newArrayEncoder</span><span class="op" id="3395559">(</span><span class="ident" id="3395560">t</span><span class="op" id="3395561">)</span><span class="op" id="3395562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395565">return</span>&nbsp;<span class="ident" id="3395572">enc</span><span class="op" id="3395575">.</span><span class="ident" id="3395576">encode</span><br>
<span class="lineno"></span><span class="op" id="3395583">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="3395586">type</span>&nbsp;<span class="ident" id="3395591">arrayEncoder</span>&nbsp;<span class="keyword" id="3395604">struct</span>&nbsp;<span class="op" id="3395611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395614">elemEnc</span>&nbsp;<span class="ident" id="3395622">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="3395634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span><span class="keyword" id="3395637">func</span>&nbsp;<span class="op" id="3395642">(</span><span class="ident" id="3395643">ae</span>&nbsp;<span class="op" id="3395646">*</span><span class="ident" id="3395647">arrayEncoder</span><span class="op" id="3395659">)</span>&nbsp;<span class="ident" id="3395661">encode</span><span class="op" id="3395667">(</span><span class="ident" id="3395668">e</span>&nbsp;<span class="op" id="3395670">*</span><span class="ident" id="3395671">encodeState</span><span class="op" id="3395682">,</span>&nbsp;<span class="ident" id="3395684">v</span>&nbsp;<span class="ident" id="3395686">reflect</span><span class="op" id="3395693">.</span><span class="ident" id="3395694">Value</span><span class="op" id="3395699">,</span>&nbsp;<span class="ident" id="3395701">_</span>&nbsp;<span class="builtintype" id="3395703">bool</span><span class="op" id="3395707">)</span>&nbsp;<span class="op" id="3395709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395712">e</span><span class="op" id="3395713">.</span><span class="ident" id="3395714">WriteByte</span><span class="op" id="3395723">(</span><span class="string" id="3395724">&#39;[&#39;</span><span class="op" id="3395727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395730">n</span>&nbsp;<span class="op" id="3395732">:=</span>&nbsp;<span class="ident" id="3395735">v</span><span class="op" id="3395736">.</span><span class="ident" id="3395737">Len</span><span class="op" id="3395740">(</span><span class="op" id="3395741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395744">for</span>&nbsp;<span class="ident" id="3395748">i</span>&nbsp;<span class="op" id="3395750">:=</span>&nbsp;<span class="num" id="3395753">0</span><span class="op" id="3395754">;</span>&nbsp;<span class="ident" id="3395756">i</span>&nbsp;<span class="op" id="3395758">&lt;</span>&nbsp;<span class="ident" id="3395760">n</span><span class="op" id="3395761">;</span>&nbsp;<span class="ident" id="3395763">i</span><span class="op" id="3395764">++</span>&nbsp;<span class="op" id="3395767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395771">if</span>&nbsp;<span class="ident" id="3395774">i</span>&nbsp;<span class="op" id="3395776">&gt;</span>&nbsp;<span class="num" id="3395778">0</span>&nbsp;<span class="op" id="3395780">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395785">e</span><span class="op" id="3395786">.</span><span class="ident" id="3395787">WriteByte</span><span class="op" id="3395796">(</span><span class="string" id="3395797">&#39;,&#39;</span><span class="op" id="3395800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395808">ae</span><span class="op" id="3395810">.</span><span class="ident" id="3395811">elemEnc</span><span class="op" id="3395818">(</span><span class="ident" id="3395819">e</span><span class="op" id="3395820">,</span>&nbsp;<span class="ident" id="3395822">v</span><span class="op" id="3395823">.</span><span class="ident" id="3395824">Index</span><span class="op" id="3395829">(</span><span class="ident" id="3395830">i</span><span class="op" id="3395831">)</span><span class="op" id="3395832">,</span>&nbsp;<span class="builtintype" id="3395834">false</span><span class="op" id="3395839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395845">e</span><span class="op" id="3395846">.</span><span class="ident" id="3395847">WriteByte</span><span class="op" id="3395856">(</span><span class="string" id="3395857">&#39;]&#39;</span><span class="op" id="3395860">)</span><br>
<span class="lineno">690</span><span class="op" id="3395862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3395865">func</span>&nbsp;<span class="ident" id="3395870">newArrayEncoder</span><span class="op" id="3395885">(</span><span class="ident" id="3395886">t</span>&nbsp;<span class="ident" id="3395888">reflect</span><span class="op" id="3395895">.</span><span class="ident" id="3395896">Type</span><span class="op" id="3395900">)</span>&nbsp;<span class="ident" id="3395902">encoderFunc</span>&nbsp;<span class="op" id="3395914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395917">enc</span>&nbsp;<span class="op" id="3395921">:=</span>&nbsp;<span class="op" id="3395924">&amp;</span><span class="ident" id="3395925">arrayEncoder</span><span class="op" id="3395937">{</span><span class="ident" id="3395938">typeEncoder</span><span class="op" id="3395949">(</span><span class="ident" id="3395950">t</span><span class="op" id="3395951">.</span><span class="ident" id="3395952">Elem</span><span class="op" id="3395956">(</span><span class="op" id="3395957">)</span><span class="op" id="3395958">)</span><span class="op" id="3395959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395962">return</span>&nbsp;<span class="ident" id="3395969">enc</span><span class="op" id="3395972">.</span><span class="ident" id="3395973">encode</span><br>
<span class="lineno">695</span><span class="op" id="3395980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3395983">type</span>&nbsp;<span class="ident" id="3395988">ptrEncoder</span>&nbsp;<span class="keyword" id="3395999">struct</span>&nbsp;<span class="op" id="3396006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396009">elemEnc</span>&nbsp;<span class="ident" id="3396017">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="3396029">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="3396032">func</span>&nbsp;<span class="op" id="3396037">(</span><span class="ident" id="3396038">pe</span>&nbsp;<span class="op" id="3396041">*</span><span class="ident" id="3396042">ptrEncoder</span><span class="op" id="3396052">)</span>&nbsp;<span class="ident" id="3396054">encode</span><span class="op" id="3396060">(</span><span class="ident" id="3396061">e</span>&nbsp;<span class="op" id="3396063">*</span><span class="ident" id="3396064">encodeState</span><span class="op" id="3396075">,</span>&nbsp;<span class="ident" id="3396077">v</span>&nbsp;<span class="ident" id="3396079">reflect</span><span class="op" id="3396086">.</span><span class="ident" id="3396087">Value</span><span class="op" id="3396092">,</span>&nbsp;<span class="ident" id="3396094">quoted</span>&nbsp;<span class="builtintype" id="3396101">bool</span><span class="op" id="3396105">)</span>&nbsp;<span class="op" id="3396107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396110">if</span>&nbsp;<span class="ident" id="3396113">v</span><span class="op" id="3396114">.</span><span class="ident" id="3396115">IsNil</span><span class="op" id="3396120">(</span><span class="op" id="3396121">)</span>&nbsp;<span class="op" id="3396123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396127">e</span><span class="op" id="3396128">.</span><span class="ident" id="3396129">WriteString</span><span class="op" id="3396140">(</span><span class="string" id="3396141">&#34;null&#34;</span><span class="op" id="3396147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396151">return</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396162">pe</span><span class="op" id="3396164">.</span><span class="ident" id="3396165">elemEnc</span><span class="op" id="3396172">(</span><span class="ident" id="3396173">e</span><span class="op" id="3396174">,</span>&nbsp;<span class="ident" id="3396176">v</span><span class="op" id="3396177">.</span><span class="ident" id="3396178">Elem</span><span class="op" id="3396182">(</span><span class="op" id="3396183">)</span><span class="op" id="3396184">,</span>&nbsp;<span class="ident" id="3396186">quoted</span><span class="op" id="3396192">)</span><br>
<span class="lineno"></span><span class="op" id="3396194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3396197">func</span>&nbsp;<span class="ident" id="3396202">newPtrEncoder</span><span class="op" id="3396215">(</span><span class="ident" id="3396216">t</span>&nbsp;<span class="ident" id="3396218">reflect</span><span class="op" id="3396225">.</span><span class="ident" id="3396226">Type</span><span class="op" id="3396230">)</span>&nbsp;<span class="ident" id="3396232">encoderFunc</span>&nbsp;<span class="op" id="3396244">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396247">enc</span>&nbsp;<span class="op" id="3396251">:=</span>&nbsp;<span class="op" id="3396254">&amp;</span><span class="ident" id="3396255">ptrEncoder</span><span class="op" id="3396265">{</span><span class="ident" id="3396266">typeEncoder</span><span class="op" id="3396277">(</span><span class="ident" id="3396278">t</span><span class="op" id="3396279">.</span><span class="ident" id="3396280">Elem</span><span class="op" id="3396284">(</span><span class="op" id="3396285">)</span><span class="op" id="3396286">)</span><span class="op" id="3396287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396290">return</span>&nbsp;<span class="ident" id="3396297">enc</span><span class="op" id="3396300">.</span><span class="ident" id="3396301">encode</span><br>
<span class="lineno"></span><span class="op" id="3396308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3396311">type</span>&nbsp;<span class="ident" id="3396316">condAddrEncoder</span>&nbsp;<span class="keyword" id="3396332">struct</span>&nbsp;<span class="op" id="3396339">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396342">canAddrEnc</span><span class="op" id="3396352">,</span>&nbsp;<span class="ident" id="3396354">elseEnc</span>&nbsp;<span class="ident" id="3396362">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="3396374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3396377">func</span>&nbsp;<span class="op" id="3396382">(</span><span class="ident" id="3396383">ce</span>&nbsp;<span class="op" id="3396386">*</span><span class="ident" id="3396387">condAddrEncoder</span><span class="op" id="3396402">)</span>&nbsp;<span class="ident" id="3396404">encode</span><span class="op" id="3396410">(</span><span class="ident" id="3396411">e</span>&nbsp;<span class="op" id="3396413">*</span><span class="ident" id="3396414">encodeState</span><span class="op" id="3396425">,</span>&nbsp;<span class="ident" id="3396427">v</span>&nbsp;<span class="ident" id="3396429">reflect</span><span class="op" id="3396436">.</span><span class="ident" id="3396437">Value</span><span class="op" id="3396442">,</span>&nbsp;<span class="ident" id="3396444">quoted</span>&nbsp;<span class="builtintype" id="3396451">bool</span><span class="op" id="3396455">)</span>&nbsp;<span class="op" id="3396457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396460">if</span>&nbsp;<span class="ident" id="3396463">v</span><span class="op" id="3396464">.</span><span class="ident" id="3396465">CanAddr</span><span class="op" id="3396472">(</span><span class="op" id="3396473">)</span>&nbsp;<span class="op" id="3396475">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396479">ce</span><span class="op" id="3396481">.</span><span class="ident" id="3396482">canAddrEnc</span><span class="op" id="3396492">(</span><span class="ident" id="3396493">e</span><span class="op" id="3396494">,</span>&nbsp;<span class="ident" id="3396496">v</span><span class="op" id="3396497">,</span>&nbsp;<span class="ident" id="3396499">quoted</span><span class="op" id="3396505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396508">}</span>&nbsp;<span class="keyword" id="3396510">else</span>&nbsp;<span class="op" id="3396515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396519">ce</span><span class="op" id="3396521">.</span><span class="ident" id="3396522">elseEnc</span><span class="op" id="3396529">(</span><span class="ident" id="3396530">e</span><span class="op" id="3396531">,</span>&nbsp;<span class="ident" id="3396533">v</span><span class="op" id="3396534">,</span>&nbsp;<span class="ident" id="3396536">quoted</span><span class="op" id="3396542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396545">}</span><br>
<span class="lineno"></span><span class="op" id="3396547">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="3396550">//&nbsp;newCondAddrEncoder&nbsp;returns&nbsp;an&nbsp;encoder&nbsp;that&nbsp;checks&nbsp;whether&nbsp;its&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3396621">//&nbsp;CanAddr&nbsp;and&nbsp;delegates&nbsp;to&nbsp;canAddrEnc&nbsp;if&nbsp;so,&nbsp;else&nbsp;to&nbsp;elseEnc.</span><br>
<span class="lineno"></span><span class="keyword" id="3396684">func</span>&nbsp;<span class="ident" id="3396689">newCondAddrEncoder</span><span class="op" id="3396707">(</span><span class="ident" id="3396708">canAddrEnc</span><span class="op" id="3396718">,</span>&nbsp;<span class="ident" id="3396720">elseEnc</span>&nbsp;<span class="ident" id="3396728">encoderFunc</span><span class="op" id="3396739">)</span>&nbsp;<span class="ident" id="3396741">encoderFunc</span>&nbsp;<span class="op" id="3396753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396756">enc</span>&nbsp;<span class="op" id="3396760">:=</span>&nbsp;<span class="op" id="3396763">&amp;</span><span class="ident" id="3396764">condAddrEncoder</span><span class="op" id="3396779">{</span><span class="ident" id="3396780">canAddrEnc</span><span class="op" id="3396790">:</span>&nbsp;<span class="ident" id="3396792">canAddrEnc</span><span class="op" id="3396802">,</span>&nbsp;<span class="ident" id="3396804">elseEnc</span><span class="op" id="3396811">:</span>&nbsp;<span class="ident" id="3396813">elseEnc</span><span class="op" id="3396820">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396823">return</span>&nbsp;<span class="ident" id="3396830">enc</span><span class="op" id="3396833">.</span><span class="ident" id="3396834">encode</span><br>
<span class="lineno"></span><span class="op" id="3396841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3396844">func</span>&nbsp;<span class="ident" id="3396849">isValidTag</span><span class="op" id="3396859">(</span><span class="ident" id="3396860">s</span>&nbsp;<span class="builtintype" id="3396862">string</span><span class="op" id="3396868">)</span>&nbsp;<span class="builtintype" id="3396870">bool</span>&nbsp;<span class="op" id="3396875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396878">if</span>&nbsp;<span class="ident" id="3396881">s</span>&nbsp;<span class="op" id="3396883">==</span>&nbsp;<span class="string" id="3396886">&#34;&#34;</span>&nbsp;<span class="op" id="3396889">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396893">return</span>&nbsp;<span class="builtintype" id="3396900">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396910">for</span>&nbsp;<span class="ident" id="3396914">_</span><span class="op" id="3396915">,</span>&nbsp;<span class="ident" id="3396917">c</span>&nbsp;<span class="op" id="3396919">:=</span>&nbsp;<span class="keyword" id="3396922">range</span>&nbsp;<span class="ident" id="3396928">s</span>&nbsp;<span class="op" id="3396930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396934">switch</span>&nbsp;<span class="op" id="3396941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396945">case</span>&nbsp;<span class="ident" id="3396950">strings</span><span class="op" id="3396957">.</span><span class="ident" id="3396958">ContainsRune</span><span class="op" id="3396970">(</span><span class="string" id="3396971">&#34;!#$%&amp;()*+-./:&lt;=&gt;?@[]^_{|}~&nbsp;&#34;</span><span class="op" id="3397000">,</span>&nbsp;<span class="ident" id="3397002">c</span><span class="op" id="3397003">)</span><span class="op" id="3397004">:</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3397009">//&nbsp;Backslash&nbsp;and&nbsp;quote&nbsp;chars&nbsp;are&nbsp;reserved,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3397059">//&nbsp;otherwise&nbsp;any&nbsp;punctuation&nbsp;chars&nbsp;are&nbsp;allowed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3397109">//&nbsp;in&nbsp;a&nbsp;tag&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397129">default</span><span class="op" id="3397136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397141">if</span>&nbsp;<span class="op" id="3397144">!</span><span class="ident" id="3397145">unicode</span><span class="op" id="3397152">.</span><span class="ident" id="3397153">IsLetter</span><span class="op" id="3397161">(</span><span class="ident" id="3397162">c</span><span class="op" id="3397163">)</span>&nbsp;<span class="op" id="3397165">&amp;&amp;</span>&nbsp;<span class="op" id="3397168">!</span><span class="ident" id="3397169">unicode</span><span class="op" id="3397176">.</span><span class="ident" id="3397177">IsDigit</span><span class="op" id="3397184">(</span><span class="ident" id="3397185">c</span><span class="op" id="3397186">)</span>&nbsp;<span class="op" id="3397188">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397194">return</span>&nbsp;<span class="builtintype" id="3397201">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397220">return</span>&nbsp;<span class="builtintype" id="3397227">true</span><br>
<span class="lineno">750</span><span class="op" id="3397232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3397235">func</span>&nbsp;<span class="ident" id="3397240">fieldByIndex</span><span class="op" id="3397252">(</span><span class="ident" id="3397253">v</span>&nbsp;<span class="ident" id="3397255">reflect</span><span class="op" id="3397262">.</span><span class="ident" id="3397263">Value</span><span class="op" id="3397268">,</span>&nbsp;<span class="ident" id="3397270">index</span>&nbsp;<span class="op" id="3397276">[</span><span class="op" id="3397277">]</span><span class="builtintype" id="3397278">int</span><span class="op" id="3397281">)</span>&nbsp;<span class="ident" id="3397283">reflect</span><span class="op" id="3397290">.</span><span class="ident" id="3397291">Value</span>&nbsp;<span class="op" id="3397297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397300">for</span>&nbsp;<span class="ident" id="3397304">_</span><span class="op" id="3397305">,</span>&nbsp;<span class="ident" id="3397307">i</span>&nbsp;<span class="op" id="3397309">:=</span>&nbsp;<span class="keyword" id="3397312">range</span>&nbsp;<span class="ident" id="3397318">index</span>&nbsp;<span class="op" id="3397324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397328">if</span>&nbsp;<span class="ident" id="3397331">v</span><span class="op" id="3397332">.</span><span class="ident" id="3397333">Kind</span><span class="op" id="3397337">(</span><span class="op" id="3397338">)</span>&nbsp;<span class="op" id="3397340">==</span>&nbsp;<span class="ident" id="3397343">reflect</span><span class="op" id="3397350">.</span><span class="ident" id="3397351">Ptr</span>&nbsp;<span class="op" id="3397355">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397360">if</span>&nbsp;<span class="ident" id="3397363">v</span><span class="op" id="3397364">.</span><span class="ident" id="3397365">IsNil</span><span class="op" id="3397370">(</span><span class="op" id="3397371">)</span>&nbsp;<span class="op" id="3397373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397379">return</span>&nbsp;<span class="ident" id="3397386">reflect</span><span class="op" id="3397393">.</span><span class="ident" id="3397394">Value</span><span class="op" id="3397399">{</span><span class="op" id="3397400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397410">v</span>&nbsp;<span class="op" id="3397412">=</span>&nbsp;<span class="ident" id="3397414">v</span><span class="op" id="3397415">.</span><span class="ident" id="3397416">Elem</span><span class="op" id="3397420">(</span><span class="op" id="3397421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397425">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397429">v</span>&nbsp;<span class="op" id="3397431">=</span>&nbsp;<span class="ident" id="3397433">v</span><span class="op" id="3397434">.</span><span class="ident" id="3397435">Field</span><span class="op" id="3397440">(</span><span class="ident" id="3397441">i</span><span class="op" id="3397442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397448">return</span>&nbsp;<span class="ident" id="3397455">v</span><br>
<span class="lineno"></span><span class="op" id="3397457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span><span class="keyword" id="3397460">func</span>&nbsp;<span class="ident" id="3397465">typeByIndex</span><span class="op" id="3397476">(</span><span class="ident" id="3397477">t</span>&nbsp;<span class="ident" id="3397479">reflect</span><span class="op" id="3397486">.</span><span class="ident" id="3397487">Type</span><span class="op" id="3397491">,</span>&nbsp;<span class="ident" id="3397493">index</span>&nbsp;<span class="op" id="3397499">[</span><span class="op" id="3397500">]</span><span class="builtintype" id="3397501">int</span><span class="op" id="3397504">)</span>&nbsp;<span class="ident" id="3397506">reflect</span><span class="op" id="3397513">.</span><span class="ident" id="3397514">Type</span>&nbsp;<span class="op" id="3397519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397522">for</span>&nbsp;<span class="ident" id="3397526">_</span><span class="op" id="3397527">,</span>&nbsp;<span class="ident" id="3397529">i</span>&nbsp;<span class="op" id="3397531">:=</span>&nbsp;<span class="keyword" id="3397534">range</span>&nbsp;<span class="ident" id="3397540">index</span>&nbsp;<span class="op" id="3397546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397550">if</span>&nbsp;<span class="ident" id="3397553">t</span><span class="op" id="3397554">.</span><span class="ident" id="3397555">Kind</span><span class="op" id="3397559">(</span><span class="op" id="3397560">)</span>&nbsp;<span class="op" id="3397562">==</span>&nbsp;<span class="ident" id="3397565">reflect</span><span class="op" id="3397572">.</span><span class="ident" id="3397573">Ptr</span>&nbsp;<span class="op" id="3397577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397582">t</span>&nbsp;<span class="op" id="3397584">=</span>&nbsp;<span class="ident" id="3397586">t</span><span class="op" id="3397587">.</span><span class="ident" id="3397588">Elem</span><span class="op" id="3397592">(</span><span class="op" id="3397593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397597">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397601">t</span>&nbsp;<span class="op" id="3397603">=</span>&nbsp;<span class="ident" id="3397605">t</span><span class="op" id="3397606">.</span><span class="ident" id="3397607">Field</span><span class="op" id="3397612">(</span><span class="ident" id="3397613">i</span><span class="op" id="3397614">)</span><span class="op" id="3397615">.</span><span class="ident" id="3397616">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397625">return</span>&nbsp;<span class="ident" id="3397632">t</span><br>
<span class="lineno"></span><span class="op" id="3397634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">775</span><span class="comment" id="3397637">//&nbsp;stringValues&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;reflect.Value&nbsp;holding&nbsp;*reflect.StringValue.</span><br>
<span class="lineno"></span><span class="comment" id="3397711">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;methods&nbsp;to&nbsp;sort&nbsp;by&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3397759">type</span>&nbsp;<span class="ident" id="3397764">stringValues</span>&nbsp;<span class="op" id="3397777">[</span><span class="op" id="3397778">]</span><span class="ident" id="3397779">reflect</span><span class="op" id="3397786">.</span><span class="ident" id="3397787">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3397794">func</span>&nbsp;<span class="op" id="3397799">(</span><span class="ident" id="3397800">sv</span>&nbsp;<span class="ident" id="3397803">stringValues</span><span class="op" id="3397815">)</span>&nbsp;<span class="ident" id="3397817">Len</span><span class="op" id="3397820">(</span><span class="op" id="3397821">)</span>&nbsp;<span class="builtintype" id="3397823">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397837">{</span>&nbsp;<span class="keyword" id="3397839">return</span>&nbsp;<span class="builtinfunc" id="3397846">len</span><span class="op" id="3397849">(</span><span class="ident" id="3397850">sv</span><span class="op" id="3397852">)</span>&nbsp;<span class="op" id="3397854">}</span><br>
<span class="lineno">780</span><span class="keyword" id="3397856">func</span>&nbsp;<span class="op" id="3397861">(</span><span class="ident" id="3397862">sv</span>&nbsp;<span class="ident" id="3397865">stringValues</span><span class="op" id="3397877">)</span>&nbsp;<span class="ident" id="3397879">Swap</span><span class="op" id="3397883">(</span><span class="ident" id="3397884">i</span><span class="op" id="3397885">,</span>&nbsp;<span class="ident" id="3397887">j</span>&nbsp;<span class="builtintype" id="3397889">int</span><span class="op" id="3397892">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397899">{</span>&nbsp;<span class="ident" id="3397901">sv</span><span class="op" id="3397903">[</span><span class="ident" id="3397904">i</span><span class="op" id="3397905">]</span><span class="op" id="3397906">,</span>&nbsp;<span class="ident" id="3397908">sv</span><span class="op" id="3397910">[</span><span class="ident" id="3397911">j</span><span class="op" id="3397912">]</span>&nbsp;<span class="op" id="3397914">=</span>&nbsp;<span class="ident" id="3397916">sv</span><span class="op" id="3397918">[</span><span class="ident" id="3397919">j</span><span class="op" id="3397920">]</span><span class="op" id="3397921">,</span>&nbsp;<span class="ident" id="3397923">sv</span><span class="op" id="3397925">[</span><span class="ident" id="3397926">i</span><span class="op" id="3397927">]</span>&nbsp;<span class="op" id="3397929">}</span><br>
<span class="lineno"></span><span class="keyword" id="3397931">func</span>&nbsp;<span class="op" id="3397936">(</span><span class="ident" id="3397937">sv</span>&nbsp;<span class="ident" id="3397940">stringValues</span><span class="op" id="3397952">)</span>&nbsp;<span class="ident" id="3397954">Less</span><span class="op" id="3397958">(</span><span class="ident" id="3397959">i</span><span class="op" id="3397960">,</span>&nbsp;<span class="ident" id="3397962">j</span>&nbsp;<span class="builtintype" id="3397964">int</span><span class="op" id="3397967">)</span>&nbsp;<span class="builtintype" id="3397969">bool</span>&nbsp;<span class="op" id="3397974">{</span>&nbsp;<span class="keyword" id="3397976">return</span>&nbsp;<span class="ident" id="3397983">sv</span><span class="op" id="3397985">.</span><span class="ident" id="3397986">get</span><span class="op" id="3397989">(</span><span class="ident" id="3397990">i</span><span class="op" id="3397991">)</span>&nbsp;<span class="op" id="3397993">&lt;</span>&nbsp;<span class="ident" id="3397995">sv</span><span class="op" id="3397997">.</span><span class="ident" id="3397998">get</span><span class="op" id="3398001">(</span><span class="ident" id="3398002">j</span><span class="op" id="3398003">)</span>&nbsp;<span class="op" id="3398005">}</span><br>
<span class="lineno"></span><span class="keyword" id="3398007">func</span>&nbsp;<span class="op" id="3398012">(</span><span class="ident" id="3398013">sv</span>&nbsp;<span class="ident" id="3398016">stringValues</span><span class="op" id="3398028">)</span>&nbsp;<span class="ident" id="3398030">get</span><span class="op" id="3398033">(</span><span class="ident" id="3398034">i</span>&nbsp;<span class="builtintype" id="3398036">int</span><span class="op" id="3398039">)</span>&nbsp;<span class="builtintype" id="3398041">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3398050">{</span>&nbsp;<span class="keyword" id="3398052">return</span>&nbsp;<span class="ident" id="3398059">sv</span><span class="op" id="3398061">[</span><span class="ident" id="3398062">i</span><span class="op" id="3398063">]</span><span class="op" id="3398064">.</span><span class="ident" id="3398065">String</span><span class="op" id="3398071">(</span><span class="op" id="3398072">)</span>&nbsp;<span class="op" id="3398074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3398077">//&nbsp;NOTE:&nbsp;keep&nbsp;in&nbsp;sync&nbsp;with&nbsp;stringBytes&nbsp;below.</span><br>
<span class="lineno">785</span><span class="keyword" id="3398123">func</span>&nbsp;<span class="op" id="3398128">(</span><span class="ident" id="3398129">e</span>&nbsp;<span class="op" id="3398131">*</span><span class="ident" id="3398132">encodeState</span><span class="op" id="3398143">)</span>&nbsp;<span class="builtintype" id="3398145">string</span><span class="op" id="3398151">(</span><span class="ident" id="3398152">s</span>&nbsp;<span class="builtintype" id="3398154">string</span><span class="op" id="3398160">)</span>&nbsp;<span class="op" id="3398162">(</span><span class="builtintype" id="3398163">int</span><span class="op" id="3398166">,</span>&nbsp;<span class="builtintype" id="3398168">error</span><span class="op" id="3398173">)</span>&nbsp;<span class="op" id="3398175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398178">len0</span>&nbsp;<span class="op" id="3398183">:=</span>&nbsp;<span class="ident" id="3398186">e</span><span class="op" id="3398187">.</span><span class="ident" id="3398188">Len</span><span class="op" id="3398191">(</span><span class="op" id="3398192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398195">e</span><span class="op" id="3398196">.</span><span class="ident" id="3398197">WriteByte</span><span class="op" id="3398206">(</span><span class="string" id="3398207">&#39;&#34;&#39;</span><span class="op" id="3398210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398213">start</span>&nbsp;<span class="op" id="3398219">:=</span>&nbsp;<span class="num" id="3398222">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398225">for</span>&nbsp;<span class="ident" id="3398229">i</span>&nbsp;<span class="op" id="3398231">:=</span>&nbsp;<span class="num" id="3398234">0</span><span class="op" id="3398235">;</span>&nbsp;<span class="ident" id="3398237">i</span>&nbsp;<span class="op" id="3398239">&lt;</span>&nbsp;<span class="builtinfunc" id="3398241">len</span><span class="op" id="3398244">(</span><span class="ident" id="3398245">s</span><span class="op" id="3398246">)</span><span class="op" id="3398247">;</span>&nbsp;<span class="op" id="3398249">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398253">if</span>&nbsp;<span class="ident" id="3398256">b</span>&nbsp;<span class="op" id="3398258">:=</span>&nbsp;<span class="ident" id="3398261">s</span><span class="op" id="3398262">[</span><span class="ident" id="3398263">i</span><span class="op" id="3398264">]</span><span class="op" id="3398265">;</span>&nbsp;<span class="ident" id="3398267">b</span>&nbsp;<span class="op" id="3398269">&lt;</span>&nbsp;<span class="ident" id="3398271">utf8</span><span class="op" id="3398275">.</span><span class="ident" id="3398276">RuneSelf</span>&nbsp;<span class="op" id="3398285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398290">if</span>&nbsp;<span class="num" id="3398293">0x20</span>&nbsp;<span class="op" id="3398298">&lt;=</span>&nbsp;<span class="ident" id="3398301">b</span>&nbsp;<span class="op" id="3398303">&amp;&amp;</span>&nbsp;<span class="ident" id="3398306">b</span>&nbsp;<span class="op" id="3398308">!=</span>&nbsp;<span class="string" id="3398311">&#39;\\&#39;</span>&nbsp;<span class="op" id="3398316">&amp;&amp;</span>&nbsp;<span class="ident" id="3398319">b</span>&nbsp;<span class="op" id="3398321">!=</span>&nbsp;<span class="string" id="3398324">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3398328">&amp;&amp;</span>&nbsp;<span class="ident" id="3398331">b</span>&nbsp;<span class="op" id="3398333">!=</span>&nbsp;<span class="string" id="3398336">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="3398340">&amp;&amp;</span>&nbsp;<span class="ident" id="3398343">b</span>&nbsp;<span class="op" id="3398345">!=</span>&nbsp;<span class="string" id="3398348">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="3398352">&amp;&amp;</span>&nbsp;<span class="ident" id="3398355">b</span>&nbsp;<span class="op" id="3398357">!=</span>&nbsp;<span class="string" id="3398360">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="3398364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398370">i</span><span class="op" id="3398371">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398378">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3398390">}</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398395">if</span>&nbsp;<span class="ident" id="3398398">start</span>&nbsp;<span class="op" id="3398404">&lt;</span>&nbsp;<span class="ident" id="3398406">i</span>&nbsp;<span class="op" id="3398408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398414">e</span><span class="op" id="3398415">.</span><span class="ident" id="3398416">WriteString</span><span class="op" id="3398427">(</span><span class="ident" id="3398428">s</span><span class="op" id="3398429">[</span><span class="ident" id="3398430">start</span><span class="op" id="3398435">:</span><span class="ident" id="3398436">i</span><span class="op" id="3398437">]</span><span class="op" id="3398438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3398443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398448">switch</span>&nbsp;<span class="ident" id="3398455">b</span>&nbsp;<span class="op" id="3398457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398462">case</span>&nbsp;<span class="string" id="3398467">&#39;\\&#39;</span><span class="op" id="3398471">,</span>&nbsp;<span class="string" id="3398473">&#39;&#34;&#39;</span><span class="op" id="3398476">:</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398482">e</span><span class="op" id="3398483">.</span><span class="ident" id="3398484">WriteByte</span><span class="op" id="3398493">(</span><span class="string" id="3398494">&#39;\\&#39;</span><span class="op" id="3398498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398504">e</span><span class="op" id="3398505">.</span><span class="ident" id="3398506">WriteByte</span><span class="op" id="3398515">(</span><span class="ident" id="3398516">b</span><span class="op" id="3398517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398522">case</span>&nbsp;<span class="string" id="3398527">&#39;\n&#39;</span><span class="op" id="3398531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398537">e</span><span class="op" id="3398538">.</span><span class="ident" id="3398539">WriteByte</span><span class="op" id="3398548">(</span><span class="string" id="3398549">&#39;\\&#39;</span><span class="op" id="3398553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398559">e</span><span class="op" id="3398560">.</span><span class="ident" id="3398561">WriteByte</span><span class="op" id="3398570">(</span><span class="string" id="3398571">&#39;n&#39;</span><span class="op" id="3398574">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398579">case</span>&nbsp;<span class="string" id="3398584">&#39;\r&#39;</span><span class="op" id="3398588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398594">e</span><span class="op" id="3398595">.</span><span class="ident" id="3398596">WriteByte</span><span class="op" id="3398605">(</span><span class="string" id="3398606">&#39;\\&#39;</span><span class="op" id="3398610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398616">e</span><span class="op" id="3398617">.</span><span class="ident" id="3398618">WriteByte</span><span class="op" id="3398627">(</span><span class="string" id="3398628">&#39;r&#39;</span><span class="op" id="3398631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398636">case</span>&nbsp;<span class="string" id="3398641">&#39;\t&#39;</span><span class="op" id="3398645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398651">e</span><span class="op" id="3398652">.</span><span class="ident" id="3398653">WriteByte</span><span class="op" id="3398662">(</span><span class="string" id="3398663">&#39;\\&#39;</span><span class="op" id="3398667">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398673">e</span><span class="op" id="3398674">.</span><span class="ident" id="3398675">WriteByte</span><span class="op" id="3398684">(</span><span class="string" id="3398685">&#39;t&#39;</span><span class="op" id="3398688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398693">default</span><span class="op" id="3398700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3398706">//&nbsp;This&nbsp;encodes&nbsp;bytes&nbsp;&lt;&nbsp;0x20&nbsp;except&nbsp;for&nbsp;\n&nbsp;and&nbsp;\r,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3398761">//&nbsp;as&nbsp;well&nbsp;as&nbsp;&lt;,&nbsp;&gt;&nbsp;and&nbsp;&amp;.&nbsp;The&nbsp;latter&nbsp;are&nbsp;escaped&nbsp;because&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3398827">//&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;when&nbsp;user-controlled&nbsp;strings</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3398890">//&nbsp;are&nbsp;rendered&nbsp;into&nbsp;JSON&nbsp;and&nbsp;served&nbsp;to&nbsp;some&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398949">e</span><span class="op" id="3398950">.</span><span class="ident" id="3398951">WriteString</span><span class="op" id="3398962">(</span><span class="string" id="3398963">`\u00`</span><span class="op" id="3398969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398975">e</span><span class="op" id="3398976">.</span><span class="ident" id="3398977">WriteByte</span><span class="op" id="3398986">(</span><span class="ident" id="3398987">hex</span><span class="op" id="3398990">[</span><span class="ident" id="3398991">b</span><span class="op" id="3398992">&gt;&gt;</span><span class="num" id="3398994">4</span><span class="op" id="3398995">]</span><span class="op" id="3398996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399002">e</span><span class="op" id="3399003">.</span><span class="ident" id="3399004">WriteByte</span><span class="op" id="3399013">(</span><span class="ident" id="3399014">hex</span><span class="op" id="3399017">[</span><span class="ident" id="3399018">b</span><span class="op" id="3399019">&amp;</span><span class="num" id="3399020">0xF</span><span class="op" id="3399023">]</span><span class="op" id="3399024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399029">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399034">i</span><span class="op" id="3399035">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399041">start</span>&nbsp;<span class="op" id="3399047">=</span>&nbsp;<span class="ident" id="3399049">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399054">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399069">c</span><span class="op" id="3399070">,</span>&nbsp;<span class="ident" id="3399072">size</span>&nbsp;<span class="op" id="3399077">:=</span>&nbsp;<span class="ident" id="3399080">utf8</span><span class="op" id="3399084">.</span><span class="ident" id="3399085">DecodeRuneInString</span><span class="op" id="3399103">(</span><span class="ident" id="3399104">s</span><span class="op" id="3399105">[</span><span class="ident" id="3399106">i</span><span class="op" id="3399107">:</span><span class="op" id="3399108">]</span><span class="op" id="3399109">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399113">if</span>&nbsp;<span class="ident" id="3399116">c</span>&nbsp;<span class="op" id="3399118">==</span>&nbsp;<span class="ident" id="3399121">utf8</span><span class="op" id="3399125">.</span><span class="ident" id="3399126">RuneError</span>&nbsp;<span class="op" id="3399136">&amp;&amp;</span>&nbsp;<span class="ident" id="3399139">size</span>&nbsp;<span class="op" id="3399144">==</span>&nbsp;<span class="num" id="3399147">1</span>&nbsp;<span class="op" id="3399149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399154">if</span>&nbsp;<span class="ident" id="3399157">start</span>&nbsp;<span class="op" id="3399163">&lt;</span>&nbsp;<span class="ident" id="3399165">i</span>&nbsp;<span class="op" id="3399167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399173">e</span><span class="op" id="3399174">.</span><span class="ident" id="3399175">WriteString</span><span class="op" id="3399186">(</span><span class="ident" id="3399187">s</span><span class="op" id="3399188">[</span><span class="ident" id="3399189">start</span><span class="op" id="3399194">:</span><span class="ident" id="3399195">i</span><span class="op" id="3399196">]</span><span class="op" id="3399197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399207">e</span><span class="op" id="3399208">.</span><span class="ident" id="3399209">WriteString</span><span class="op" id="3399220">(</span><span class="string" id="3399221">`\ufffd`</span><span class="op" id="3399229">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399234">i</span>&nbsp;<span class="op" id="3399236">+=</span>&nbsp;<span class="ident" id="3399239">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399247">start</span>&nbsp;<span class="op" id="3399253">=</span>&nbsp;<span class="ident" id="3399255">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399260">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3399275">//&nbsp;U+2028&nbsp;is&nbsp;LINE&nbsp;SEPARATOR.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3399306">//&nbsp;U+2029&nbsp;is&nbsp;PARAGRAPH&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3399342">//&nbsp;They&nbsp;are&nbsp;both&nbsp;technically&nbsp;valid&nbsp;characters&nbsp;in&nbsp;JSON&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3399407">//&nbsp;but&nbsp;don&#39;t&nbsp;work&nbsp;in&nbsp;JSONP,&nbsp;which&nbsp;has&nbsp;to&nbsp;be&nbsp;evaluated&nbsp;as&nbsp;JavaScript,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3399478">//&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;there.&nbsp;It&nbsp;is&nbsp;valid&nbsp;JSON&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3399541">//&nbsp;escape&nbsp;them,&nbsp;so&nbsp;we&nbsp;do&nbsp;so&nbsp;unconditionally.</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3399588">//&nbsp;See&nbsp;http://timelessrepo.com/json-isnt-a-javascript-subset&nbsp;for&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399667">if</span>&nbsp;<span class="ident" id="3399670">c</span>&nbsp;<span class="op" id="3399672">==</span>&nbsp;<span class="string" id="3399675">&#39;\u2028&#39;</span>&nbsp;<span class="op" id="3399684">||</span>&nbsp;<span class="ident" id="3399687">c</span>&nbsp;<span class="op" id="3399689">==</span>&nbsp;<span class="string" id="3399692">&#39;\u2029&#39;</span>&nbsp;<span class="op" id="3399701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399706">if</span>&nbsp;<span class="ident" id="3399709">start</span>&nbsp;<span class="op" id="3399715">&lt;</span>&nbsp;<span class="ident" id="3399717">i</span>&nbsp;<span class="op" id="3399719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399725">e</span><span class="op" id="3399726">.</span><span class="ident" id="3399727">WriteString</span><span class="op" id="3399738">(</span><span class="ident" id="3399739">s</span><span class="op" id="3399740">[</span><span class="ident" id="3399741">start</span><span class="op" id="3399746">:</span><span class="ident" id="3399747">i</span><span class="op" id="3399748">]</span><span class="op" id="3399749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399754">}</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399759">e</span><span class="op" id="3399760">.</span><span class="ident" id="3399761">WriteString</span><span class="op" id="3399772">(</span><span class="string" id="3399773">`\u202`</span><span class="op" id="3399780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399785">e</span><span class="op" id="3399786">.</span><span class="ident" id="3399787">WriteByte</span><span class="op" id="3399796">(</span><span class="ident" id="3399797">hex</span><span class="op" id="3399800">[</span><span class="ident" id="3399801">c</span><span class="op" id="3399802">&amp;</span><span class="num" id="3399803">0xF</span><span class="op" id="3399806">]</span><span class="op" id="3399807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399812">i</span>&nbsp;<span class="op" id="3399814">+=</span>&nbsp;<span class="ident" id="3399817">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399825">start</span>&nbsp;<span class="op" id="3399831">=</span>&nbsp;<span class="ident" id="3399833">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399838">continue</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399853">i</span>&nbsp;<span class="op" id="3399855">+=</span>&nbsp;<span class="ident" id="3399858">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399867">if</span>&nbsp;<span class="ident" id="3399870">start</span>&nbsp;<span class="op" id="3399876">&lt;</span>&nbsp;<span class="builtinfunc" id="3399878">len</span><span class="op" id="3399881">(</span><span class="ident" id="3399882">s</span><span class="op" id="3399883">)</span>&nbsp;<span class="op" id="3399885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399889">e</span><span class="op" id="3399890">.</span><span class="ident" id="3399891">WriteString</span><span class="op" id="3399902">(</span><span class="ident" id="3399903">s</span><span class="op" id="3399904">[</span><span class="ident" id="3399905">start</span><span class="op" id="3399910">:</span><span class="op" id="3399911">]</span><span class="op" id="3399912">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399918">e</span><span class="op" id="3399919">.</span><span class="ident" id="3399920">WriteByte</span><span class="op" id="3399929">(</span><span class="string" id="3399930">&#39;&#34;&#39;</span><span class="op" id="3399933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399936">return</span>&nbsp;<span class="ident" id="3399943">e</span><span class="op" id="3399944">.</span><span class="ident" id="3399945">Len</span><span class="op" id="3399948">(</span><span class="op" id="3399949">)</span>&nbsp;<span class="op" id="3399951">-</span>&nbsp;<span class="ident" id="3399953">len0</span><span class="op" id="3399957">,</span>&nbsp;<span class="builtintype" id="3399959">nil</span><br>
<span class="lineno"></span><span class="op" id="3399963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">860</span><span class="comment" id="3399966">//&nbsp;NOTE:&nbsp;keep&nbsp;in&nbsp;sync&nbsp;with&nbsp;string&nbsp;above.</span><br>
<span class="lineno"></span><span class="keyword" id="3400007">func</span>&nbsp;<span class="op" id="3400012">(</span><span class="ident" id="3400013">e</span>&nbsp;<span class="op" id="3400015">*</span><span class="ident" id="3400016">encodeState</span><span class="op" id="3400027">)</span>&nbsp;<span class="ident" id="3400029">stringBytes</span><span class="op" id="3400040">(</span><span class="ident" id="3400041">s</span>&nbsp;<span class="op" id="3400043">[</span><span class="op" id="3400044">]</span><span class="builtintype" id="3400045">byte</span><span class="op" id="3400049">)</span>&nbsp;<span class="op" id="3400051">(</span><span class="builtintype" id="3400052">int</span><span class="op" id="3400055">,</span>&nbsp;<span class="builtintype" id="3400057">error</span><span class="op" id="3400062">)</span>&nbsp;<span class="op" id="3400064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400067">len0</span>&nbsp;<span class="op" id="3400072">:=</span>&nbsp;<span class="ident" id="3400075">e</span><span class="op" id="3400076">.</span><span class="ident" id="3400077">Len</span><span class="op" id="3400080">(</span><span class="op" id="3400081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400084">e</span><span class="op" id="3400085">.</span><span class="ident" id="3400086">WriteByte</span><span class="op" id="3400095">(</span><span class="string" id="3400096">&#39;&#34;&#39;</span><span class="op" id="3400099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400102">start</span>&nbsp;<span class="op" id="3400108">:=</span>&nbsp;<span class="num" id="3400111">0</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400114">for</span>&nbsp;<span class="ident" id="3400118">i</span>&nbsp;<span class="op" id="3400120">:=</span>&nbsp;<span class="num" id="3400123">0</span><span class="op" id="3400124">;</span>&nbsp;<span class="ident" id="3400126">i</span>&nbsp;<span class="op" id="3400128">&lt;</span>&nbsp;<span class="builtinfunc" id="3400130">len</span><span class="op" id="3400133">(</span><span class="ident" id="3400134">s</span><span class="op" id="3400135">)</span><span class="op" id="3400136">;</span>&nbsp;<span class="op" id="3400138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400142">if</span>&nbsp;<span class="ident" id="3400145">b</span>&nbsp;<span class="op" id="3400147">:=</span>&nbsp;<span class="ident" id="3400150">s</span><span class="op" id="3400151">[</span><span class="ident" id="3400152">i</span><span class="op" id="3400153">]</span><span class="op" id="3400154">;</span>&nbsp;<span class="ident" id="3400156">b</span>&nbsp;<span class="op" id="3400158">&lt;</span>&nbsp;<span class="ident" id="3400160">utf8</span><span class="op" id="3400164">.</span><span class="ident" id="3400165">RuneSelf</span>&nbsp;<span class="op" id="3400174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400179">if</span>&nbsp;<span class="num" id="3400182">0x20</span>&nbsp;<span class="op" id="3400187">&lt;=</span>&nbsp;<span class="ident" id="3400190">b</span>&nbsp;<span class="op" id="3400192">&amp;&amp;</span>&nbsp;<span class="ident" id="3400195">b</span>&nbsp;<span class="op" id="3400197">!=</span>&nbsp;<span class="string" id="3400200">&#39;\\&#39;</span>&nbsp;<span class="op" id="3400205">&amp;&amp;</span>&nbsp;<span class="ident" id="3400208">b</span>&nbsp;<span class="op" id="3400210">!=</span>&nbsp;<span class="string" id="3400213">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3400217">&amp;&amp;</span>&nbsp;<span class="ident" id="3400220">b</span>&nbsp;<span class="op" id="3400222">!=</span>&nbsp;<span class="string" id="3400225">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="3400229">&amp;&amp;</span>&nbsp;<span class="ident" id="3400232">b</span>&nbsp;<span class="op" id="3400234">!=</span>&nbsp;<span class="string" id="3400237">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="3400241">&amp;&amp;</span>&nbsp;<span class="ident" id="3400244">b</span>&nbsp;<span class="op" id="3400246">!=</span>&nbsp;<span class="string" id="3400249">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="3400253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400259">i</span><span class="op" id="3400260">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400267">continue</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3400279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400284">if</span>&nbsp;<span class="ident" id="3400287">start</span>&nbsp;<span class="op" id="3400293">&lt;</span>&nbsp;<span class="ident" id="3400295">i</span>&nbsp;<span class="op" id="3400297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400303">e</span><span class="op" id="3400304">.</span><span class="ident" id="3400305">Write</span><span class="op" id="3400310">(</span><span class="ident" id="3400311">s</span><span class="op" id="3400312">[</span><span class="ident" id="3400313">start</span><span class="op" id="3400318">:</span><span class="ident" id="3400319">i</span><span class="op" id="3400320">]</span><span class="op" id="3400321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3400326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400331">switch</span>&nbsp;<span class="ident" id="3400338">b</span>&nbsp;<span class="op" id="3400340">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400345">case</span>&nbsp;<span class="string" id="3400350">&#39;\\&#39;</span><span class="op" id="3400354">,</span>&nbsp;<span class="string" id="3400356">&#39;&#34;&#39;</span><span class="op" id="3400359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400365">e</span><span class="op" id="3400366">.</span><span class="ident" id="3400367">WriteByte</span><span class="op" id="3400376">(</span><span class="string" id="3400377">&#39;\\&#39;</span><span class="op" id="3400381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400387">e</span><span class="op" id="3400388">.</span><span class="ident" id="3400389">WriteByte</span><span class="op" id="3400398">(</span><span class="ident" id="3400399">b</span><span class="op" id="3400400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400405">case</span>&nbsp;<span class="string" id="3400410">&#39;\n&#39;</span><span class="op" id="3400414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400420">e</span><span class="op" id="3400421">.</span><span class="ident" id="3400422">WriteByte</span><span class="op" id="3400431">(</span><span class="string" id="3400432">&#39;\\&#39;</span><span class="op" id="3400436">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400442">e</span><span class="op" id="3400443">.</span><span class="ident" id="3400444">WriteByte</span><span class="op" id="3400453">(</span><span class="string" id="3400454">&#39;n&#39;</span><span class="op" id="3400457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400462">case</span>&nbsp;<span class="string" id="3400467">&#39;\r&#39;</span><span class="op" id="3400471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400477">e</span><span class="op" id="3400478">.</span><span class="ident" id="3400479">WriteByte</span><span class="op" id="3400488">(</span><span class="string" id="3400489">&#39;\\&#39;</span><span class="op" id="3400493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400499">e</span><span class="op" id="3400500">.</span><span class="ident" id="3400501">WriteByte</span><span class="op" id="3400510">(</span><span class="string" id="3400511">&#39;r&#39;</span><span class="op" id="3400514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400519">case</span>&nbsp;<span class="string" id="3400524">&#39;\t&#39;</span><span class="op" id="3400528">:</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400534">e</span><span class="op" id="3400535">.</span><span class="ident" id="3400536">WriteByte</span><span class="op" id="3400545">(</span><span class="string" id="3400546">&#39;\\&#39;</span><span class="op" id="3400550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400556">e</span><span class="op" id="3400557">.</span><span class="ident" id="3400558">WriteByte</span><span class="op" id="3400567">(</span><span class="string" id="3400568">&#39;t&#39;</span><span class="op" id="3400571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400576">default</span><span class="op" id="3400583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3400589">//&nbsp;This&nbsp;encodes&nbsp;bytes&nbsp;&lt;&nbsp;0x20&nbsp;except&nbsp;for&nbsp;\n&nbsp;and&nbsp;\r,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3400644">//&nbsp;as&nbsp;well&nbsp;as&nbsp;&lt;,&nbsp;&gt;,&nbsp;and&nbsp;&amp;.&nbsp;The&nbsp;latter&nbsp;are&nbsp;escaped&nbsp;because&nbsp;they</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3400711">//&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;when&nbsp;user-controlled&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3400774">//&nbsp;are&nbsp;rendered&nbsp;into&nbsp;JSON&nbsp;and&nbsp;served&nbsp;to&nbsp;some&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400833">e</span><span class="op" id="3400834">.</span><span class="ident" id="3400835">WriteString</span><span class="op" id="3400846">(</span><span class="string" id="3400847">`\u00`</span><span class="op" id="3400853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400859">e</span><span class="op" id="3400860">.</span><span class="ident" id="3400861">WriteByte</span><span class="op" id="3400870">(</span><span class="ident" id="3400871">hex</span><span class="op" id="3400874">[</span><span class="ident" id="3400875">b</span><span class="op" id="3400876">&gt;&gt;</span><span class="num" id="3400878">4</span><span class="op" id="3400879">]</span><span class="op" id="3400880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400886">e</span><span class="op" id="3400887">.</span><span class="ident" id="3400888">WriteByte</span><span class="op" id="3400897">(</span><span class="ident" id="3400898">hex</span><span class="op" id="3400901">[</span><span class="ident" id="3400902">b</span><span class="op" id="3400903">&amp;</span><span class="num" id="3400904">0xF</span><span class="op" id="3400907">]</span><span class="op" id="3400908">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3400913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400918">i</span><span class="op" id="3400919">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400925">start</span>&nbsp;<span class="op" id="3400931">=</span>&nbsp;<span class="ident" id="3400933">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400938">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3400949">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400953">c</span><span class="op" id="3400954">,</span>&nbsp;<span class="ident" id="3400956">size</span>&nbsp;<span class="op" id="3400961">:=</span>&nbsp;<span class="ident" id="3400964">utf8</span><span class="op" id="3400968">.</span><span class="ident" id="3400969">DecodeRune</span><span class="op" id="3400979">(</span><span class="ident" id="3400980">s</span><span class="op" id="3400981">[</span><span class="ident" id="3400982">i</span><span class="op" id="3400983">:</span><span class="op" id="3400984">]</span><span class="op" id="3400985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400989">if</span>&nbsp;<span class="ident" id="3400992">c</span>&nbsp;<span class="op" id="3400994">==</span>&nbsp;<span class="ident" id="3400997">utf8</span><span class="op" id="3401001">.</span><span class="ident" id="3401002">RuneError</span>&nbsp;<span class="op" id="3401012">&amp;&amp;</span>&nbsp;<span class="ident" id="3401015">size</span>&nbsp;<span class="op" id="3401020">==</span>&nbsp;<span class="num" id="3401023">1</span>&nbsp;<span class="op" id="3401025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401030">if</span>&nbsp;<span class="ident" id="3401033">start</span>&nbsp;<span class="op" id="3401039">&lt;</span>&nbsp;<span class="ident" id="3401041">i</span>&nbsp;<span class="op" id="3401043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401049">e</span><span class="op" id="3401050">.</span><span class="ident" id="3401051">Write</span><span class="op" id="3401056">(</span><span class="ident" id="3401057">s</span><span class="op" id="3401058">[</span><span class="ident" id="3401059">start</span><span class="op" id="3401064">:</span><span class="ident" id="3401065">i</span><span class="op" id="3401066">]</span><span class="op" id="3401067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401072">}</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401077">e</span><span class="op" id="3401078">.</span><span class="ident" id="3401079">WriteString</span><span class="op" id="3401090">(</span><span class="string" id="3401091">`\ufffd`</span><span class="op" id="3401099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401104">i</span>&nbsp;<span class="op" id="3401106">+=</span>&nbsp;<span class="ident" id="3401109">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401117">start</span>&nbsp;<span class="op" id="3401123">=</span>&nbsp;<span class="ident" id="3401125">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401130">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401141">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3401145">//&nbsp;U+2028&nbsp;is&nbsp;LINE&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3401176">//&nbsp;U+2029&nbsp;is&nbsp;PARAGRAPH&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3401212">//&nbsp;They&nbsp;are&nbsp;both&nbsp;technically&nbsp;valid&nbsp;characters&nbsp;in&nbsp;JSON&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3401277">//&nbsp;but&nbsp;don&#39;t&nbsp;work&nbsp;in&nbsp;JSONP,&nbsp;which&nbsp;has&nbsp;to&nbsp;be&nbsp;evaluated&nbsp;as&nbsp;JavaScript,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3401348">//&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;there.&nbsp;It&nbsp;is&nbsp;valid&nbsp;JSON&nbsp;to</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3401411">//&nbsp;escape&nbsp;them,&nbsp;so&nbsp;we&nbsp;do&nbsp;so&nbsp;unconditionally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3401458">//&nbsp;See&nbsp;http://timelessrepo.com/json-isnt-a-javascript-subset&nbsp;for&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401537">if</span>&nbsp;<span class="ident" id="3401540">c</span>&nbsp;<span class="op" id="3401542">==</span>&nbsp;<span class="string" id="3401545">&#39;\u2028&#39;</span>&nbsp;<span class="op" id="3401554">||</span>&nbsp;<span class="ident" id="3401557">c</span>&nbsp;<span class="op" id="3401559">==</span>&nbsp;<span class="string" id="3401562">&#39;\u2029&#39;</span>&nbsp;<span class="op" id="3401571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401576">if</span>&nbsp;<span class="ident" id="3401579">start</span>&nbsp;<span class="op" id="3401585">&lt;</span>&nbsp;<span class="ident" id="3401587">i</span>&nbsp;<span class="op" id="3401589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401595">e</span><span class="op" id="3401596">.</span><span class="ident" id="3401597">Write</span><span class="op" id="3401602">(</span><span class="ident" id="3401603">s</span><span class="op" id="3401604">[</span><span class="ident" id="3401605">start</span><span class="op" id="3401610">:</span><span class="ident" id="3401611">i</span><span class="op" id="3401612">]</span><span class="op" id="3401613">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401623">e</span><span class="op" id="3401624">.</span><span class="ident" id="3401625">WriteString</span><span class="op" id="3401636">(</span><span class="string" id="3401637">`\u202`</span><span class="op" id="3401644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401649">e</span><span class="op" id="3401650">.</span><span class="ident" id="3401651">WriteByte</span><span class="op" id="3401660">(</span><span class="ident" id="3401661">hex</span><span class="op" id="3401664">[</span><span class="ident" id="3401665">c</span><span class="op" id="3401666">&amp;</span><span class="num" id="3401667">0xF</span><span class="op" id="3401670">]</span><span class="op" id="3401671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401676">i</span>&nbsp;<span class="op" id="3401678">+=</span>&nbsp;<span class="ident" id="3401681">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401689">start</span>&nbsp;<span class="op" id="3401695">=</span>&nbsp;<span class="ident" id="3401697">i</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401702">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401717">i</span>&nbsp;<span class="op" id="3401719">+=</span>&nbsp;<span class="ident" id="3401722">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401731">if</span>&nbsp;<span class="ident" id="3401734">start</span>&nbsp;<span class="op" id="3401740">&lt;</span>&nbsp;<span class="builtinfunc" id="3401742">len</span><span class="op" id="3401745">(</span><span class="ident" id="3401746">s</span><span class="op" id="3401747">)</span>&nbsp;<span class="op" id="3401749">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401753">e</span><span class="op" id="3401754">.</span><span class="ident" id="3401755">Write</span><span class="op" id="3401760">(</span><span class="ident" id="3401761">s</span><span class="op" id="3401762">[</span><span class="ident" id="3401763">start</span><span class="op" id="3401768">:</span><span class="op" id="3401769">]</span><span class="op" id="3401770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401776">e</span><span class="op" id="3401777">.</span><span class="ident" id="3401778">WriteByte</span><span class="op" id="3401787">(</span><span class="string" id="3401788">&#39;&#34;&#39;</span><span class="op" id="3401791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401794">return</span>&nbsp;<span class="ident" id="3401801">e</span><span class="op" id="3401802">.</span><span class="ident" id="3401803">Len</span><span class="op" id="3401806">(</span><span class="op" id="3401807">)</span>&nbsp;<span class="op" id="3401809">-</span>&nbsp;<span class="ident" id="3401811">len0</span><span class="op" id="3401815">,</span>&nbsp;<span class="builtintype" id="3401817">nil</span><br>
<span class="lineno"></span><span class="op" id="3401821">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="3401824">//&nbsp;A&nbsp;field&nbsp;represents&nbsp;a&nbsp;single&nbsp;field&nbsp;found&nbsp;in&nbsp;a&nbsp;struct.</span><br>
<span class="lineno"></span><span class="keyword" id="3401880">type</span>&nbsp;<span class="ident" id="3401885">field</span>&nbsp;<span class="keyword" id="3401891">struct</span>&nbsp;<span class="op" id="3401898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401901">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3401911">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401919">nameBytes</span>&nbsp;<span class="op" id="3401929">[</span><span class="op" id="3401930">]</span><span class="builtintype" id="3401931">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3401952">//&nbsp;[]byte(name)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401969">equalFold</span>&nbsp;<span class="keyword" id="3401979">func</span><span class="op" id="3401983">(</span><span class="ident" id="3401984">s</span><span class="op" id="3401985">,</span>&nbsp;<span class="ident" id="3401987">t</span>&nbsp;<span class="op" id="3401989">[</span><span class="op" id="3401990">]</span><span class="builtintype" id="3401991">byte</span><span class="op" id="3401995">)</span>&nbsp;<span class="builtintype" id="3401997">bool</span>&nbsp;<span class="comment" id="3402002">//&nbsp;bytes.EqualFold&nbsp;or&nbsp;equivalent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3402037">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3402047">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3402053">index</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3402063">[</span><span class="op" id="3402064">]</span><span class="builtintype" id="3402065">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3402070">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3402080">reflect</span><span class="op" id="3402087">.</span><span class="ident" id="3402088">Type</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3402094">omitEmpty</span>&nbsp;<span class="builtintype" id="3402104">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3402110">quoted</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3402120">bool</span><br>
<span class="lineno"></span><span class="op" id="3402125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3402128">func</span>&nbsp;<span class="ident" id="3402133">fillField</span><span class="op" id="3402142">(</span><span class="ident" id="3402143">f</span>&nbsp;<span class="ident" id="3402145">field</span><span class="op" id="3402150">)</span>&nbsp;<span class="ident" id="3402152">field</span>&nbsp;<span class="op" id="3402158">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3402161">f</span><span class="op" id="3402162">.</span><span class="ident" id="3402163">nameBytes</span>&nbsp;<span class="op" id="3402173">=</span>&nbsp;<span class="op" id="3402175">[</span><span class="op" id="3402176">]</span><span class="builtintype" id="3402177">byte</span><span class="op" id="3402181">(</span><span class="ident" id="3402182">f</span><span class="op" id="3402183">.</span><span class="ident" id="3402184">name</span><span class="op" id="3402188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3402191">f</span><span class="op" id="3402192">.</span><span class="ident" id="3402193">equalFold</span>&nbsp;<span class="op" id="3402203">=</span>&nbsp;<span class="ident" id="3402205">foldFunc</span><span class="op" id="3402213">(</span><span class="ident" id="3402214">f</span><span class="op" id="3402215">.</span><span class="ident" id="3402216">nameBytes</span><span class="op" id="3402225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402228">return</span>&nbsp;<span class="ident" id="3402235">f</span><br>
<span class="lineno"></span><span class="op" id="3402237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span><span class="comment" id="3402240">//&nbsp;byName&nbsp;sorts&nbsp;field&nbsp;by&nbsp;name,&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;depth,</span><br>
<span class="lineno"></span><span class="comment" id="3402297">//&nbsp;then&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;&#34;name&nbsp;came&nbsp;from&nbsp;json&nbsp;tag&#34;,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="3402356">//&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="keyword" id="3402394">type</span>&nbsp;<span class="ident" id="3402399">byName</span>&nbsp;<span class="op" id="3402406">[</span><span class="op" id="3402407">]</span><span class="ident" id="3402408">field</span><br>
<span class="lineno"></span><br>
<span class="lineno">960</span><span class="keyword" id="3402415">func</span>&nbsp;<span class="op" id="3402420">(</span><span class="ident" id="3402421">x</span>&nbsp;<span class="ident" id="3402423">byName</span><span class="op" id="3402429">)</span>&nbsp;<span class="ident" id="3402431">Len</span><span class="op" id="3402434">(</span><span class="op" id="3402435">)</span>&nbsp;<span class="builtintype" id="3402437">int</span>&nbsp;<span class="op" id="3402441">{</span>&nbsp;<span class="keyword" id="3402443">return</span>&nbsp;<span class="builtinfunc" id="3402450">len</span><span class="op" id="3402453">(</span><span class="ident" id="3402454">x</span><span class="op" id="3402455">)</span>&nbsp;<span class="op" id="3402457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3402460">func</span>&nbsp;<span class="op" id="3402465">(</span><span class="ident" id="3402466">x</span>&nbsp;<span class="ident" id="3402468">byName</span><span class="op" id="3402474">)</span>&nbsp;<span class="ident" id="3402476">Swap</span><span class="op" id="3402480">(</span><span class="ident" id="3402481">i</span><span class="op" id="3402482">,</span>&nbsp;<span class="ident" id="3402484">j</span>&nbsp;<span class="builtintype" id="3402486">int</span><span class="op" id="3402489">)</span>&nbsp;<span class="op" id="3402491">{</span>&nbsp;<span class="ident" id="3402493">x</span><span class="op" id="3402494">[</span><span class="ident" id="3402495">i</span><span class="op" id="3402496">]</span><span class="op" id="3402497">,</span>&nbsp;<span class="ident" id="3402499">x</span><span class="op" id="3402500">[</span><span class="ident" id="3402501">j</span><span class="op" id="3402502">]</span>&nbsp;<span class="op" id="3402504">=</span>&nbsp;<span class="ident" id="3402506">x</span><span class="op" id="3402507">[</span><span class="ident" id="3402508">j</span><span class="op" id="3402509">]</span><span class="op" id="3402510">,</span>&nbsp;<span class="ident" id="3402512">x</span><span class="op" id="3402513">[</span><span class="ident" id="3402514">i</span><span class="op" id="3402515">]</span>&nbsp;<span class="op" id="3402517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3402520">func</span>&nbsp;<span class="op" id="3402525">(</span><span class="ident" id="3402526">x</span>&nbsp;<span class="ident" id="3402528">byName</span><span class="op" id="3402534">)</span>&nbsp;<span class="ident" id="3402536">Less</span><span class="op" id="3402540">(</span><span class="ident" id="3402541">i</span><span class="op" id="3402542">,</span>&nbsp;<span class="ident" id="3402544">j</span>&nbsp;<span class="builtintype" id="3402546">int</span><span class="op" id="3402549">)</span>&nbsp;<span class="builtintype" id="3402551">bool</span>&nbsp;<span class="op" id="3402556">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402559">if</span>&nbsp;<span class="ident" id="3402562">x</span><span class="op" id="3402563">[</span><span class="ident" id="3402564">i</span><span class="op" id="3402565">]</span><span class="op" id="3402566">.</span><span class="ident" id="3402567">name</span>&nbsp;<span class="op" id="3402572">!=</span>&nbsp;<span class="ident" id="3402575">x</span><span class="op" id="3402576">[</span><span class="ident" id="3402577">j</span><span class="op" id="3402578">]</span><span class="op" id="3402579">.</span><span class="ident" id="3402580">name</span>&nbsp;<span class="op" id="3402585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402589">return</span>&nbsp;<span class="ident" id="3402596">x</span><span class="op" id="3402597">[</span><span class="ident" id="3402598">i</span><span class="op" id="3402599">]</span><span class="op" id="3402600">.</span><span class="ident" id="3402601">name</span>&nbsp;<span class="op" id="3402606">&lt;</span>&nbsp;<span class="ident" id="3402608">x</span><span class="op" id="3402609">[</span><span class="ident" id="3402610">j</span><span class="op" id="3402611">]</span><span class="op" id="3402612">.</span><span class="ident" id="3402613">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3402619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402622">if</span>&nbsp;<span class="builtinfunc" id="3402625">len</span><span class="op" id="3402628">(</span><span class="ident" id="3402629">x</span><span class="op" id="3402630">[</span><span class="ident" id="3402631">i</span><span class="op" id="3402632">]</span><span class="op" id="3402633">.</span><span class="ident" id="3402634">index</span><span class="op" id="3402639">)</span>&nbsp;<span class="op" id="3402641">!=</span>&nbsp;<span class="builtinfunc" id="3402644">len</span><span class="op" id="3402647">(</span><span class="ident" id="3402648">x</span><span class="op" id="3402649">[</span><span class="ident" id="3402650">j</span><span class="op" id="3402651">]</span><span class="op" id="3402652">.</span><span class="ident" id="3402653">index</span><span class="op" id="3402658">)</span>&nbsp;<span class="op" id="3402660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402664">return</span>&nbsp;<span class="builtinfunc" id="3402671">len</span><span class="op" id="3402674">(</span><span class="ident" id="3402675">x</span><span class="op" id="3402676">[</span><span class="ident" id="3402677">i</span><span class="op" id="3402678">]</span><span class="op" id="3402679">.</span><span class="ident" id="3402680">index</span><span class="op" id="3402685">)</span>&nbsp;<span class="op" id="3402687">&lt;</span>&nbsp;<span class="builtinfunc" id="3402689">len</span><span class="op" id="3402692">(</span><span class="ident" id="3402693">x</span><span class="op" id="3402694">[</span><span class="ident" id="3402695">j</span><span class="op" id="3402696">]</span><span class="op" id="3402697">.</span><span class="ident" id="3402698">index</span><span class="op" id="3402703">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3402706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402709">if</span>&nbsp;<span class="ident" id="3402712">x</span><span class="op" id="3402713">[</span><span class="ident" id="3402714">i</span><span class="op" id="3402715">]</span><span class="op" id="3402716">.</span><span class="ident" id="3402717">tag</span>&nbsp;<span class="op" id="3402721">!=</span>&nbsp;<span class="ident" id="3402724">x</span><span class="op" id="3402725">[</span><span class="ident" id="3402726">j</span><span class="op" id="3402727">]</span><span class="op" id="3402728">.</span><span class="ident" id="3402729">tag</span>&nbsp;<span class="op" id="3402733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402737">return</span>&nbsp;<span class="ident" id="3402744">x</span><span class="op" id="3402745">[</span><span class="ident" id="3402746">i</span><span class="op" id="3402747">]</span><span class="op" id="3402748">.</span><span class="ident" id="3402749">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3402754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402757">return</span>&nbsp;<span class="ident" id="3402764">byIndex</span><span class="op" id="3402771">(</span><span class="ident" id="3402772">x</span><span class="op" id="3402773">)</span><span class="op" id="3402774">.</span><span class="ident" id="3402775">Less</span><span class="op" id="3402779">(</span><span class="ident" id="3402780">i</span><span class="op" id="3402781">,</span>&nbsp;<span class="ident" id="3402783">j</span><span class="op" id="3402784">)</span><br>
<span class="lineno">975</span><span class="op" id="3402786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3402789">//&nbsp;byIndex&nbsp;sorts&nbsp;field&nbsp;by&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="keyword" id="3402831">type</span>&nbsp;<span class="ident" id="3402836">byIndex</span>&nbsp;<span class="op" id="3402844">[</span><span class="op" id="3402845">]</span><span class="ident" id="3402846">field</span><br>
<span class="lineno"></span><br>
<span class="lineno">980</span><span class="keyword" id="3402853">func</span>&nbsp;<span class="op" id="3402858">(</span><span class="ident" id="3402859">x</span>&nbsp;<span class="ident" id="3402861">byIndex</span><span class="op" id="3402868">)</span>&nbsp;<span class="ident" id="3402870">Len</span><span class="op" id="3402873">(</span><span class="op" id="3402874">)</span>&nbsp;<span class="builtintype" id="3402876">int</span>&nbsp;<span class="op" id="3402880">{</span>&nbsp;<span class="keyword" id="3402882">return</span>&nbsp;<span class="builtinfunc" id="3402889">len</span><span class="op" id="3402892">(</span><span class="ident" id="3402893">x</span><span class="op" id="3402894">)</span>&nbsp;<span class="op" id="3402896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3402899">func</span>&nbsp;<span class="op" id="3402904">(</span><span class="ident" id="3402905">x</span>&nbsp;<span class="ident" id="3402907">byIndex</span><span class="op" id="3402914">)</span>&nbsp;<span class="ident" id="3402916">Swap</span><span class="op" id="3402920">(</span><span class="ident" id="3402921">i</span><span class="op" id="3402922">,</span>&nbsp;<span class="ident" id="3402924">j</span>&nbsp;<span class="builtintype" id="3402926">int</span><span class="op" id="3402929">)</span>&nbsp;<span class="op" id="3402931">{</span>&nbsp;<span class="ident" id="3402933">x</span><span class="op" id="3402934">[</span><span class="ident" id="3402935">i</span><span class="op" id="3402936">]</span><span class="op" id="3402937">,</span>&nbsp;<span class="ident" id="3402939">x</span><span class="op" id="3402940">[</span><span class="ident" id="3402941">j</span><span class="op" id="3402942">]</span>&nbsp;<span class="op" id="3402944">=</span>&nbsp;<span class="ident" id="3402946">x</span><span class="op" id="3402947">[</span><span class="ident" id="3402948">j</span><span class="op" id="3402949">]</span><span class="op" id="3402950">,</span>&nbsp;<span class="ident" id="3402952">x</span><span class="op" id="3402953">[</span><span class="ident" id="3402954">i</span><span class="op" id="3402955">]</span>&nbsp;<span class="op" id="3402957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3402960">func</span>&nbsp;<span class="op" id="3402965">(</span><span class="ident" id="3402966">x</span>&nbsp;<span class="ident" id="3402968">byIndex</span><span class="op" id="3402975">)</span>&nbsp;<span class="ident" id="3402977">Less</span><span class="op" id="3402981">(</span><span class="ident" id="3402982">i</span><span class="op" id="3402983">,</span>&nbsp;<span class="ident" id="3402985">j</span>&nbsp;<span class="builtintype" id="3402987">int</span><span class="op" id="3402990">)</span>&nbsp;<span class="builtintype" id="3402992">bool</span>&nbsp;<span class="op" id="3402997">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3403000">for</span>&nbsp;<span class="ident" id="3403004">k</span><span class="op" id="3403005">,</span>&nbsp;<span class="ident" id="3403007">xik</span>&nbsp;<span class="op" id="3403011">:=</span>&nbsp;<span class="keyword" id="3403014">range</span>&nbsp;<span class="ident" id="3403020">x</span><span class="op" id="3403021">[</span><span class="ident" id="3403022">i</span><span class="op" id="3403023">]</span><span class="op" id="3403024">.</span><span class="ident" id="3403025">index</span>&nbsp;<span class="op" id="3403031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3403035">if</span>&nbsp;<span class="ident" id="3403038">k</span>&nbsp;<span class="op" id="3403040">&gt;=</span>&nbsp;<span class="builtinfunc" id="3403043">len</span><span class="op" id="3403046">(</span><span class="ident" id="3403047">x</span><span class="op" id="3403048">[</span><span class="ident" id="3403049">j</span><span class="op" id="3403050">]</span><span class="op" id="3403051">.</span><span class="ident" id="3403052">index</span><span class="op" id="3403057">)</span>&nbsp;<span class="op" id="3403059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3403064">return</span>&nbsp;<span class="builtintype" id="3403071">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3403079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3403083">if</span>&nbsp;<span class="ident" id="3403086">xik</span>&nbsp;<span class="op" id="3403090">!=</span>&nbsp;<span class="ident" id="3403093">x</span><span class="op" id="3403094">[</span><span class="ident" id="3403095">j</span><span class="op" id="3403096">]</span><span class="op" id="3403097">.</span><span class="ident" id="3403098">index</span><span class="op" id="3403103">[</span><span class="ident" id="3403104">k</span><span class="op" id="3403105">]</span>&nbsp;<span class="op" id="3403107">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3403112">return</span>&nbsp;<span class="ident" id="3403119">xik</span>&nbsp;<span class="op" id="3403123">&lt;</span>&nbsp;<span class="ident" id="3403125">x</span><span class="op" id="3403126">[</span><span class="ident" id="3403127">j</span><span class="op" id="3403128">]</span><span class="op" id="3403129">.</span><span class="ident" id="3403130">index</span><span class="op" id="3403135">[</span><span class="ident" id="3403136">k</span><span class="op" id="3403137">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3403141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3403144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3403147">return</span>&nbsp;<span class="builtinfunc" id="3403154">len</span><span class="op" id="3403157">(</span><span class="ident" id="3403158">x</span><span class="op" id="3403159">[</span><span class="ident" id="3403160">i</span><span class="op" id="3403161">]</span><span class="op" id="3403162">.</span><span class="ident" id="3403163">index</span><span class="op" id="3403168">)</span>&nbsp;<span class="op" id="3403170">&lt;</span>&nbsp;<span class="builtinfunc" id="3403172">len</span><span class="op" id="3403175">(</span><span class="ident" id="3403176">x</span><span class="op" id="3403177">[</span><span class="ident" id="3403178">j</span><span class="op" id="3403179">]</span><span class="op" id="3403180">.</span><span class="ident" id="3403181">index</span><span class="op" id="3403186">)</span><br>
<span class="lineno"></span><span class="op" id="3403188">}</span><br>
<span class="lineno">995</span><br>
<span class="lineno"></span><span class="comment" id="3403191">//&nbsp;typeFields&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;fields&nbsp;that&nbsp;JSON&nbsp;should&nbsp;recognize&nbsp;for&nbsp;the&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="3403277">//&nbsp;The&nbsp;algorithm&nbsp;is&nbsp;breadth-first&nbsp;search&nbsp;over&nbsp;the&nbsp;set&nbsp;of&nbsp;structs&nbsp;to&nbsp;include&nbsp;-&nbsp;the&nbsp;top&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="3403370">//&nbsp;and&nbsp;then&nbsp;any&nbsp;reachable&nbsp;anonymous&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="3403415">func</span>&nbsp;<span class="ident" id="3403420">typeFields</span><span class="op" id="3403430">(</span><span class="ident" id="3403431">t</span>&nbsp;<span class="ident" id="3403433">reflect</span><span class="op" id="3403440">.</span><span class="ident" id="3403441">Type</span><span class="op" id="3403445">)</span>&nbsp;<span class="op" id="3403447">[</span><span class="op" id="3403448">]</span><span class="ident" id="3403449">field</span>&nbsp;<span class="op" id="3403455">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3403458">//&nbsp;Anonymous&nbsp;fields&nbsp;to&nbsp;explore&nbsp;at&nbsp;the&nbsp;current&nbsp;level&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3403525">current</span>&nbsp;<span class="op" id="3403533">:=</span>&nbsp;<span class="op" id="3403536">[</span><span class="op" id="3403537">]</span><span class="ident" id="3403538">field</span><span class="op" id="3403543">{</span><span class="op" id="3403544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3403547">next</span>&nbsp;<span class="op" id="3403552">:=</span>&nbsp;<span class="op" id="3403555">[</span><span class="op" id="3403556">]</span><span class="ident" id="3403557">field</span><span class="op" id="3403562">{</span><span class="op" id="3403563">{</span><span class="ident" id="3403564">typ</span><span class="op" id="3403567">:</span>&nbsp;<span class="ident" id="3403569">t</span><span class="op" id="3403570">}</span><span class="op" id="3403571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3403575">//&nbsp;Count&nbsp;of&nbsp;queued&nbsp;names&nbsp;for&nbsp;current&nbsp;level&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3403633">count</span>&nbsp;<span class="op" id="3403639">:=</span>&nbsp;<span class="keyword" id="3403642">map</span><span class="op" id="3403645">[</span><span class="ident" id="3403646">reflect</span><span class="op" id="3403653">.</span><span class="ident" id="3403654">Type</span><span class="op" id="3403658">]</span><span class="builtintype" id="3403659">int</span><span class="op" id="3403662">{</span><span class="op" id="3403663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3403666">nextCount</span>&nbsp;<span class="op" id="3403676">:=</span>&nbsp;<span class="keyword" id="3403679">map</span><span class="op" id="3403682">[</span><span class="ident" id="3403683">reflect</span><span class="op" id="3403690">.</span><span class="ident" id="3403691">Type</span><span class="op" id="3403695">]</span><span class="builtintype" id="3403696">int</span><span class="op" id="3403699">{</span><span class="op" id="3403700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3403704">//&nbsp;Types&nbsp;already&nbsp;visited&nbsp;at&nbsp;an&nbsp;earlier&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3403751">visited</span>&nbsp;<span class="op" id="3403759">:=</span>&nbsp;<span class="keyword" id="3403762">map</span><span class="op" id="3403765">[</span><span class="ident" id="3403766">reflect</span><span class="op" id="3403773">.</span><span class="ident" id="3403774">Type</span><span class="op" id="3403778">]</span><span class="builtintype" id="3403779">bool</span><span class="op" id="3403783">{</span><span class="op" id="3403784">}</span><br>
<span class="lineno">1010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3403788">//&nbsp;Fields&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3403806">var</span>&nbsp;<span class="ident" id="3403810">fields</span>&nbsp;<span class="op" id="3403817">[</span><span class="op" id="3403818">]</span><span class="ident" id="3403819">field</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3403827">for</span>&nbsp;<span class="builtinfunc" id="3403831">len</span><span class="op" id="3403834">(</span><span class="ident" id="3403835">next</span><span class="op" id="3403839">)</span>&nbsp;<span class="op" id="3403841">&gt;</span>&nbsp;<span class="num" id="3403843">0</span>&nbsp;<span class="op" id="3403845">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3403849">current</span><span class="op" id="3403856">,</span>&nbsp;<span class="ident" id="3403858">next</span>&nbsp;<span class="op" id="3403863">=</span>&nbsp;<span class="ident" id="3403865">next</span><span class="op" id="3403869">,</span>&nbsp;<span class="ident" id="3403871">current</span><span class="op" id="3403878">[</span><span class="op" id="3403879">:</span><span class="num" id="3403880">0</span><span class="op" id="3403881">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3403885">count</span><span class="op" id="3403890">,</span>&nbsp;<span class="ident" id="3403892">nextCount</span>&nbsp;<span class="op" id="3403902">=</span>&nbsp;<span class="ident" id="3403904">nextCount</span><span class="op" id="3403913">,</span>&nbsp;<span class="keyword" id="3403915">map</span><span class="op" id="3403918">[</span><span class="ident" id="3403919">reflect</span><span class="op" id="3403926">.</span><span class="ident" id="3403927">Type</span><span class="op" id="3403931">]</span><span class="builtintype" id="3403932">int</span><span class="op" id="3403935">{</span><span class="op" id="3403936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3403941">for</span>&nbsp;<span class="ident" id="3403945">_</span><span class="op" id="3403946">,</span>&nbsp;<span class="ident" id="3403948">f</span>&nbsp;<span class="op" id="3403950">:=</span>&nbsp;<span class="keyword" id="3403953">range</span>&nbsp;<span class="ident" id="3403959">current</span>&nbsp;<span class="op" id="3403967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3403972">if</span>&nbsp;<span class="ident" id="3403975">visited</span><span class="op" id="3403982">[</span><span class="ident" id="3403983">f</span><span class="op" id="3403984">.</span><span class="ident" id="3403985">typ</span><span class="op" id="3403988">]</span>&nbsp;<span class="op" id="3403990">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3403996">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3404008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404013">visited</span><span class="op" id="3404020">[</span><span class="ident" id="3404021">f</span><span class="op" id="3404022">.</span><span class="ident" id="3404023">typ</span><span class="op" id="3404026">]</span>&nbsp;<span class="op" id="3404028">=</span>&nbsp;<span class="builtintype" id="3404030">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3404039">//&nbsp;Scan&nbsp;f.typ&nbsp;for&nbsp;fields&nbsp;to&nbsp;include.</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3404079">for</span>&nbsp;<span class="ident" id="3404083">i</span>&nbsp;<span class="op" id="3404085">:=</span>&nbsp;<span class="num" id="3404088">0</span><span class="op" id="3404089">;</span>&nbsp;<span class="ident" id="3404091">i</span>&nbsp;<span class="op" id="3404093">&lt;</span>&nbsp;<span class="ident" id="3404095">f</span><span class="op" id="3404096">.</span><span class="ident" id="3404097">typ</span><span class="op" id="3404100">.</span><span class="ident" id="3404101">NumField</span><span class="op" id="3404109">(</span><span class="op" id="3404110">)</span><span class="op" id="3404111">;</span>&nbsp;<span class="ident" id="3404113">i</span><span class="op" id="3404114">++</span>&nbsp;<span class="op" id="3404117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404123">sf</span>&nbsp;<span class="op" id="3404126">:=</span>&nbsp;<span class="ident" id="3404129">f</span><span class="op" id="3404130">.</span><span class="ident" id="3404131">typ</span><span class="op" id="3404134">.</span><span class="ident" id="3404135">Field</span><span class="op" id="3404140">(</span><span class="ident" id="3404141">i</span><span class="op" id="3404142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3404148">if</span>&nbsp;<span class="ident" id="3404151">sf</span><span class="op" id="3404153">.</span><span class="ident" id="3404154">PkgPath</span>&nbsp;<span class="op" id="3404162">!=</span>&nbsp;<span class="string" id="3404165">&#34;&#34;</span>&nbsp;<span class="op" id="3404168">{</span>&nbsp;<span class="comment" id="3404170">//&nbsp;unexported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3404189">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3404202">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404208">tag</span>&nbsp;<span class="op" id="3404212">:=</span>&nbsp;<span class="ident" id="3404215">sf</span><span class="op" id="3404217">.</span><span class="ident" id="3404218">Tag</span><span class="op" id="3404221">.</span><span class="ident" id="3404222">Get</span><span class="op" id="3404225">(</span><span class="string" id="3404226">&#34;json&#34;</span><span class="op" id="3404232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3404238">if</span>&nbsp;<span class="ident" id="3404241">tag</span>&nbsp;<span class="op" id="3404245">==</span>&nbsp;<span class="string" id="3404248">&#34;-&#34;</span>&nbsp;<span class="op" id="3404252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3404259">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3404272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404278">name</span><span class="op" id="3404282">,</span>&nbsp;<span class="ident" id="3404284">opts</span>&nbsp;<span class="op" id="3404289">:=</span>&nbsp;<span class="ident" id="3404292">parseTag</span><span class="op" id="3404300">(</span><span class="ident" id="3404301">tag</span><span class="op" id="3404304">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3404310">if</span>&nbsp;<span class="op" id="3404313">!</span><span class="ident" id="3404314">isValidTag</span><span class="op" id="3404324">(</span><span class="ident" id="3404325">name</span><span class="op" id="3404329">)</span>&nbsp;<span class="op" id="3404331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404338">name</span>&nbsp;<span class="op" id="3404343">=</span>&nbsp;<span class="string" id="3404345">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3404352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404358">index</span>&nbsp;<span class="op" id="3404364">:=</span>&nbsp;<span class="builtinfunc" id="3404367">make</span><span class="op" id="3404371">(</span><span class="op" id="3404372">[</span><span class="op" id="3404373">]</span><span class="builtintype" id="3404374">int</span><span class="op" id="3404377">,</span>&nbsp;<span class="builtinfunc" id="3404379">len</span><span class="op" id="3404382">(</span><span class="ident" id="3404383">f</span><span class="op" id="3404384">.</span><span class="ident" id="3404385">index</span><span class="op" id="3404390">)</span><span class="op" id="3404391">+</span><span class="num" id="3404392">1</span><span class="op" id="3404393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3404399">copy</span><span class="op" id="3404403">(</span><span class="ident" id="3404404">index</span><span class="op" id="3404409">,</span>&nbsp;<span class="ident" id="3404411">f</span><span class="op" id="3404412">.</span><span class="ident" id="3404413">index</span><span class="op" id="3404418">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404424">index</span><span class="op" id="3404429">[</span><span class="builtinfunc" id="3404430">len</span><span class="op" id="3404433">(</span><span class="ident" id="3404434">f</span><span class="op" id="3404435">.</span><span class="ident" id="3404436">index</span><span class="op" id="3404441">)</span><span class="op" id="3404442">]</span>&nbsp;<span class="op" id="3404444">=</span>&nbsp;<span class="ident" id="3404446">i</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404453">ft</span>&nbsp;<span class="op" id="3404456">:=</span>&nbsp;<span class="ident" id="3404459">sf</span><span class="op" id="3404461">.</span><span class="ident" id="3404462">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3404471">if</span>&nbsp;<span class="ident" id="3404474">ft</span><span class="op" id="3404476">.</span><span class="ident" id="3404477">Name</span><span class="op" id="3404481">(</span><span class="op" id="3404482">)</span>&nbsp;<span class="op" id="3404484">==</span>&nbsp;<span class="string" id="3404487">&#34;&#34;</span>&nbsp;<span class="op" id="3404490">&amp;&amp;</span>&nbsp;<span class="ident" id="3404493">ft</span><span class="op" id="3404495">.</span><span class="ident" id="3404496">Kind</span><span class="op" id="3404500">(</span><span class="op" id="3404501">)</span>&nbsp;<span class="op" id="3404503">==</span>&nbsp;<span class="ident" id="3404506">reflect</span><span class="op" id="3404513">.</span><span class="ident" id="3404514">Ptr</span>&nbsp;<span class="op" id="3404518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3404525">//&nbsp;Follow&nbsp;pointer.</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404549">ft</span>&nbsp;<span class="op" id="3404552">=</span>&nbsp;<span class="ident" id="3404554">ft</span><span class="op" id="3404556">.</span><span class="ident" id="3404557">Elem</span><span class="op" id="3404561">(</span><span class="op" id="3404562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3404568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3404575">//&nbsp;Record&nbsp;found&nbsp;field&nbsp;and&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3404621">if</span>&nbsp;<span class="ident" id="3404624">name</span>&nbsp;<span class="op" id="3404629">!=</span>&nbsp;<span class="string" id="3404632">&#34;&#34;</span>&nbsp;<span class="op" id="3404635">||</span>&nbsp;<span class="op" id="3404638">!</span><span class="ident" id="3404639">sf</span><span class="op" id="3404641">.</span><span class="ident" id="3404642">Anonymous</span>&nbsp;<span class="op" id="3404652">||</span>&nbsp;<span class="ident" id="3404655">ft</span><span class="op" id="3404657">.</span><span class="ident" id="3404658">Kind</span><span class="op" id="3404662">(</span><span class="op" id="3404663">)</span>&nbsp;<span class="op" id="3404665">!=</span>&nbsp;<span class="ident" id="3404668">reflect</span><span class="op" id="3404675">.</span><span class="ident" id="3404676">Struct</span>&nbsp;<span class="op" id="3404683">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404690">tagged</span>&nbsp;<span class="op" id="3404697">:=</span>&nbsp;<span class="ident" id="3404700">name</span>&nbsp;<span class="op" id="3404705">!=</span>&nbsp;<span class="string" id="3404708">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3404716">if</span>&nbsp;<span class="ident" id="3404719">name</span>&nbsp;<span class="op" id="3404724">==</span>&nbsp;<span class="string" id="3404727">&#34;&#34;</span>&nbsp;<span class="op" id="3404730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404738">name</span>&nbsp;<span class="op" id="3404743">=</span>&nbsp;<span class="ident" id="3404745">sf</span><span class="op" id="3404747">.</span><span class="ident" id="3404748">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3404758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404765">fields</span>&nbsp;<span class="op" id="3404772">=</span>&nbsp;<span class="builtinfunc" id="3404774">append</span><span class="op" id="3404780">(</span><span class="ident" id="3404781">fields</span><span class="op" id="3404787">,</span>&nbsp;<span class="ident" id="3404789">fillField</span><span class="op" id="3404798">(</span><span class="ident" id="3404799">field</span><span class="op" id="3404804">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404812">name</span><span class="op" id="3404816">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404823">name</span><span class="op" id="3404827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404835">tag</span><span class="op" id="3404838">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404846">tagged</span><span class="op" id="3404852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404860">index</span><span class="op" id="3404865">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404871">index</span><span class="op" id="3404876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404884">typ</span><span class="op" id="3404887">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404895">ft</span><span class="op" id="3404897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404905">omitEmpty</span><span class="op" id="3404914">:</span>&nbsp;<span class="ident" id="3404916">opts</span><span class="op" id="3404920">.</span><span class="ident" id="3404921">Contains</span><span class="op" id="3404929">(</span><span class="string" id="3404930">&#34;omitempty&#34;</span><span class="op" id="3404941">)</span><span class="op" id="3404942">,</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404950">quoted</span><span class="op" id="3404956">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3404961">opts</span><span class="op" id="3404965">.</span><span class="ident" id="3404966">Contains</span><span class="op" id="3404974">(</span><span class="string" id="3404975">&#34;string&#34;</span><span class="op" id="3404983">)</span><span class="op" id="3404984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3404991">}</span><span class="op" id="3404992">)</span><span class="op" id="3404993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3405000">if</span>&nbsp;<span class="ident" id="3405003">count</span><span class="op" id="3405008">[</span><span class="ident" id="3405009">f</span><span class="op" id="3405010">.</span><span class="ident" id="3405011">typ</span><span class="op" id="3405014">]</span>&nbsp;<span class="op" id="3405016">&gt;</span>&nbsp;<span class="num" id="3405018">1</span>&nbsp;<span class="op" id="3405020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3405028">//&nbsp;If&nbsp;there&nbsp;were&nbsp;multiple&nbsp;instances,&nbsp;add&nbsp;a&nbsp;second,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3405085">//&nbsp;so&nbsp;that&nbsp;the&nbsp;annihilation&nbsp;code&nbsp;will&nbsp;see&nbsp;a&nbsp;duplicate.</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3405146">//&nbsp;It&nbsp;only&nbsp;cares&nbsp;about&nbsp;the&nbsp;distinction&nbsp;between&nbsp;1&nbsp;or&nbsp;2,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3405207">//&nbsp;so&nbsp;don&#39;t&nbsp;bother&nbsp;generating&nbsp;any&nbsp;more&nbsp;copies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3405260">fields</span>&nbsp;<span class="op" id="3405267">=</span>&nbsp;<span class="builtinfunc" id="3405269">append</span><span class="op" id="3405275">(</span><span class="ident" id="3405276">fields</span><span class="op" id="3405282">,</span>&nbsp;<span class="ident" id="3405284">fields</span><span class="op" id="3405290">[</span><span class="builtinfunc" id="3405291">len</span><span class="op" id="3405294">(</span><span class="ident" id="3405295">fields</span><span class="op" id="3405301">)</span><span class="op" id="3405302">-</span><span class="num" id="3405303">1</span><span class="op" id="3405304">]</span><span class="op" id="3405305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3405312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3405319">continue</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3405332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3405339">//&nbsp;Record&nbsp;new&nbsp;anonymous&nbsp;struct&nbsp;to&nbsp;explore&nbsp;in&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3405400">nextCount</span><span class="op" id="3405409">[</span><span class="ident" id="3405410">ft</span><span class="op" id="3405412">]</span><span class="op" id="3405413">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3405420">if</span>&nbsp;<span class="ident" id="3405423">nextCount</span><span class="op" id="3405432">[</span><span class="ident" id="3405433">ft</span><span class="op" id="3405435">]</span>&nbsp;<span class="op" id="3405437">==</span>&nbsp;<span class="num" id="3405440">1</span>&nbsp;<span class="op" id="3405442">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3405449">next</span>&nbsp;<span class="op" id="3405454">=</span>&nbsp;<span class="builtinfunc" id="3405456">append</span><span class="op" id="3405462">(</span><span class="ident" id="3405463">next</span><span class="op" id="3405467">,</span>&nbsp;<span class="ident" id="3405469">fillField</span><span class="op" id="3405478">(</span><span class="ident" id="3405479">field</span><span class="op" id="3405484">{</span><span class="ident" id="3405485">name</span><span class="op" id="3405489">:</span>&nbsp;<span class="ident" id="3405491">ft</span><span class="op" id="3405493">.</span><span class="ident" id="3405494">Name</span><span class="op" id="3405498">(</span><span class="op" id="3405499">)</span><span class="op" id="3405500">,</span>&nbsp;<span class="ident" id="3405502">index</span><span class="op" id="3405507">:</span>&nbsp;<span class="ident" id="3405509">index</span><span class="op" id="3405514">,</span>&nbsp;<span class="ident" id="3405516">typ</span><span class="op" id="3405519">:</span>&nbsp;<span class="ident" id="3405521">ft</span><span class="op" id="3405523">}</span><span class="op" id="3405524">)</span><span class="op" id="3405525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3405531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3405536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3405540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3405543">}</span><br>
<span class="lineno">1080</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3405547">sort</span><span class="op" id="3405551">.</span><span class="ident" id="3405552">Sort</span><span class="op" id="3405556">(</span><span class="ident" id="3405557">byName</span><span class="op" id="3405563">(</span><span class="ident" id="3405564">fields</span><span class="op" id="3405570">)</span><span class="op" id="3405571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3405575">//&nbsp;Delete&nbsp;all&nbsp;fields&nbsp;that&nbsp;are&nbsp;hidden&nbsp;by&nbsp;the&nbsp;Go&nbsp;rules&nbsp;for&nbsp;embedded&nbsp;fields,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3405650">//&nbsp;except&nbsp;that&nbsp;fields&nbsp;with&nbsp;JSON&nbsp;tags&nbsp;are&nbsp;promoted.</span><br>
<span class="lineno">1085</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3405703">//&nbsp;The&nbsp;fields&nbsp;are&nbsp;sorted&nbsp;in&nbsp;primary&nbsp;order&nbsp;of&nbsp;name,&nbsp;secondary&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3405771">//&nbsp;of&nbsp;field&nbsp;index&nbsp;length.&nbsp;Loop&nbsp;over&nbsp;names;&nbsp;for&nbsp;each&nbsp;name,&nbsp;delete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3405837">//&nbsp;hidden&nbsp;fields&nbsp;by&nbsp;choosing&nbsp;the&nbsp;one&nbsp;dominant&nbsp;field&nbsp;that&nbsp;survives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3405905">out</span>&nbsp;<span class="op" id="3405909">:=</span>&nbsp;<span class="ident" id="3405912">fields</span><span class="op" id="3405918">[</span><span class="op" id="3405919">:</span><span class="num" id="3405920">0</span><span class="op" id="3405921">]</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3405924">for</span>&nbsp;<span class="ident" id="3405928">advance</span><span class="op" id="3405935">,</span>&nbsp;<span class="ident" id="3405937">i</span>&nbsp;<span class="op" id="3405939">:=</span>&nbsp;<span class="num" id="3405942">0</span><span class="op" id="3405943">,</span>&nbsp;<span class="num" id="3405945">0</span><span class="op" id="3405946">;</span>&nbsp;<span class="ident" id="3405948">i</span>&nbsp;<span class="op" id="3405950">&lt;</span>&nbsp;<span class="builtinfunc" id="3405952">len</span><span class="op" id="3405955">(</span><span class="ident" id="3405956">fields</span><span class="op" id="3405962">)</span><span class="op" id="3405963">;</span>&nbsp;<span class="ident" id="3405965">i</span>&nbsp;<span class="op" id="3405967">+=</span>&nbsp;<span class="ident" id="3405970">advance</span>&nbsp;<span class="op" id="3405978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3405982">//&nbsp;One&nbsp;iteration&nbsp;per&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3406011">//&nbsp;Find&nbsp;the&nbsp;sequence&nbsp;of&nbsp;fields&nbsp;with&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3406079">fi</span>&nbsp;<span class="op" id="3406082">:=</span>&nbsp;<span class="ident" id="3406085">fields</span><span class="op" id="3406091">[</span><span class="ident" id="3406092">i</span><span class="op" id="3406093">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3406097">name</span>&nbsp;<span class="op" id="3406102">:=</span>&nbsp;<span class="ident" id="3406105">fi</span><span class="op" id="3406107">.</span><span class="ident" id="3406108">name</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3406115">for</span>&nbsp;<span class="ident" id="3406119">advance</span>&nbsp;<span class="op" id="3406127">=</span>&nbsp;<span class="num" id="3406129">1</span><span class="op" id="3406130">;</span>&nbsp;<span class="ident" id="3406132">i</span><span class="op" id="3406133">+</span><span class="ident" id="3406134">advance</span>&nbsp;<span class="op" id="3406142">&lt;</span>&nbsp;<span class="builtinfunc" id="3406144">len</span><span class="op" id="3406147">(</span><span class="ident" id="3406148">fields</span><span class="op" id="3406154">)</span><span class="op" id="3406155">;</span>&nbsp;<span class="ident" id="3406157">advance</span><span class="op" id="3406164">++</span>&nbsp;<span class="op" id="3406167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3406172">fj</span>&nbsp;<span class="op" id="3406175">:=</span>&nbsp;<span class="ident" id="3406178">fields</span><span class="op" id="3406184">[</span><span class="ident" id="3406185">i</span><span class="op" id="3406186">+</span><span class="ident" id="3406187">advance</span><span class="op" id="3406194">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3406199">if</span>&nbsp;<span class="ident" id="3406202">fj</span><span class="op" id="3406204">.</span><span class="ident" id="3406205">name</span>&nbsp;<span class="op" id="3406210">!=</span>&nbsp;<span class="ident" id="3406213">name</span>&nbsp;<span class="op" id="3406218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3406224">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3406233">}</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3406237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3406241">if</span>&nbsp;<span class="ident" id="3406244">advance</span>&nbsp;<span class="op" id="3406252">==</span>&nbsp;<span class="num" id="3406255">1</span>&nbsp;<span class="op" id="3406257">{</span>&nbsp;<span class="comment" id="3406259">//&nbsp;Only&nbsp;one&nbsp;field&nbsp;with&nbsp;this&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3406295">out</span>&nbsp;<span class="op" id="3406299">=</span>&nbsp;<span class="builtinfunc" id="3406301">append</span><span class="op" id="3406307">(</span><span class="ident" id="3406308">out</span><span class="op" id="3406311">,</span>&nbsp;<span class="ident" id="3406313">fi</span><span class="op" id="3406315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3406320">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3406331">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3406335">dominant</span><span class="op" id="3406343">,</span>&nbsp;<span class="ident" id="3406345">ok</span>&nbsp;<span class="op" id="3406348">:=</span>&nbsp;<span class="ident" id="3406351">dominantField</span><span class="op" id="3406364">(</span><span class="ident" id="3406365">fields</span><span class="op" id="3406371">[</span><span class="ident" id="3406372">i</span>&nbsp;<span class="op" id="3406374">:</span>&nbsp;<span class="ident" id="3406376">i</span><span class="op" id="3406377">+</span><span class="ident" id="3406378">advance</span><span class="op" id="3406385">]</span><span class="op" id="3406386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3406390">if</span>&nbsp;<span class="ident" id="3406393">ok</span>&nbsp;<span class="op" id="3406396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3406401">out</span>&nbsp;<span class="op" id="3406405">=</span>&nbsp;<span class="builtinfunc" id="3406407">append</span><span class="op" id="3406413">(</span><span class="ident" id="3406414">out</span><span class="op" id="3406417">,</span>&nbsp;<span class="ident" id="3406419">dominant</span><span class="op" id="3406427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3406431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3406434">}</span><br>
<span class="lineno">1110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3406438">fields</span>&nbsp;<span class="op" id="3406445">=</span>&nbsp;<span class="ident" id="3406447">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3406452">sort</span><span class="op" id="3406456">.</span><span class="ident" id="3406457">Sort</span><span class="op" id="3406461">(</span><span class="ident" id="3406462">byIndex</span><span class="op" id="3406469">(</span><span class="ident" id="3406470">fields</span><span class="op" id="3406476">)</span><span class="op" id="3406477">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3406481">return</span>&nbsp;<span class="ident" id="3406488">fields</span><br>
<span class="lineno">1115</span><span class="op" id="3406495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3406498">//&nbsp;dominantField&nbsp;looks&nbsp;through&nbsp;the&nbsp;fields,&nbsp;all&nbsp;of&nbsp;which&nbsp;are&nbsp;known&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3406567">//&nbsp;have&nbsp;the&nbsp;same&nbsp;name,&nbsp;to&nbsp;find&nbsp;the&nbsp;single&nbsp;field&nbsp;that&nbsp;dominates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3406634">//&nbsp;others&nbsp;using&nbsp;Go&#39;s&nbsp;embedding&nbsp;rules,&nbsp;modified&nbsp;by&nbsp;the&nbsp;presence&nbsp;of</span><br>
<span class="lineno">1120</span><span class="comment" id="3406700">//&nbsp;JSON&nbsp;tags.&nbsp;If&nbsp;there&nbsp;are&nbsp;multiple&nbsp;top-level&nbsp;fields,&nbsp;the&nbsp;boolean</span><br>
<span class="lineno"></span><span class="comment" id="3406766">//&nbsp;will&nbsp;be&nbsp;false:&nbsp;This&nbsp;condition&nbsp;is&nbsp;an&nbsp;error&nbsp;in&nbsp;Go&nbsp;and&nbsp;we&nbsp;skip&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="3406833">//&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="3406848">func</span>&nbsp;<span class="ident" id="3406853">dominantField</span><span class="op" id="3406866">(</span><span class="ident" id="3406867">fields</span>&nbsp;<span class="op" id="3406874">[</span><span class="op" id="3406875">]</span><span class="ident" id="3406876">field</span><span class="op" id="3406881">)</span>&nbsp;<span class="op" id="3406883">(</span><span class="ident" id="3406884">field</span><span class="op" id="3406889">,</span>&nbsp;<span class="builtintype" id="3406891">bool</span><span class="op" id="3406895">)</span>&nbsp;<span class="op" id="3406897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3406900">//&nbsp;The&nbsp;fields&nbsp;are&nbsp;sorted&nbsp;in&nbsp;increasing&nbsp;index-length&nbsp;order.&nbsp;The&nbsp;winner</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3406971">//&nbsp;must&nbsp;therefore&nbsp;be&nbsp;one&nbsp;with&nbsp;the&nbsp;shortest&nbsp;index&nbsp;length.&nbsp;Drop&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3407038">//&nbsp;longer&nbsp;entries,&nbsp;which&nbsp;is&nbsp;easy:&nbsp;just&nbsp;truncate&nbsp;the&nbsp;slice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407098">length</span>&nbsp;<span class="op" id="3407105">:=</span>&nbsp;<span class="builtinfunc" id="3407108">len</span><span class="op" id="3407111">(</span><span class="ident" id="3407112">fields</span><span class="op" id="3407118">[</span><span class="num" id="3407119">0</span><span class="op" id="3407120">]</span><span class="op" id="3407121">.</span><span class="ident" id="3407122">index</span><span class="op" id="3407127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407130">tagged</span>&nbsp;<span class="op" id="3407137">:=</span>&nbsp;<span class="op" id="3407140">-</span><span class="num" id="3407141">1</span>&nbsp;<span class="comment" id="3407143">//&nbsp;Index&nbsp;of&nbsp;first&nbsp;tagged&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407176">for</span>&nbsp;<span class="ident" id="3407180">i</span><span class="op" id="3407181">,</span>&nbsp;<span class="ident" id="3407183">f</span>&nbsp;<span class="op" id="3407185">:=</span>&nbsp;<span class="keyword" id="3407188">range</span>&nbsp;<span class="ident" id="3407194">fields</span>&nbsp;<span class="op" id="3407201">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407205">if</span>&nbsp;<span class="builtinfunc" id="3407208">len</span><span class="op" id="3407211">(</span><span class="ident" id="3407212">f</span><span class="op" id="3407213">.</span><span class="ident" id="3407214">index</span><span class="op" id="3407219">)</span>&nbsp;<span class="op" id="3407221">&gt;</span>&nbsp;<span class="ident" id="3407223">length</span>&nbsp;<span class="op" id="3407230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407235">fields</span>&nbsp;<span class="op" id="3407242">=</span>&nbsp;<span class="ident" id="3407244">fields</span><span class="op" id="3407250">[</span><span class="op" id="3407251">:</span><span class="ident" id="3407252">i</span><span class="op" id="3407253">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407258">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3407266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407270">if</span>&nbsp;<span class="ident" id="3407273">f</span><span class="op" id="3407274">.</span><span class="ident" id="3407275">tag</span>&nbsp;<span class="op" id="3407279">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407284">if</span>&nbsp;<span class="ident" id="3407287">tagged</span>&nbsp;<span class="op" id="3407294">&gt;=</span>&nbsp;<span class="num" id="3407297">0</span>&nbsp;<span class="op" id="3407299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3407305">//&nbsp;Multiple&nbsp;tagged&nbsp;fields&nbsp;at&nbsp;the&nbsp;same&nbsp;level:&nbsp;conflict.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3407364">//&nbsp;Return&nbsp;no&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407388">return</span>&nbsp;<span class="ident" id="3407395">field</span><span class="op" id="3407400">{</span><span class="op" id="3407401">}</span><span class="op" id="3407402">,</span>&nbsp;<span class="builtintype" id="3407404">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3407413">}</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407418">tagged</span>&nbsp;<span class="op" id="3407425">=</span>&nbsp;<span class="ident" id="3407427">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3407431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3407434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407437">if</span>&nbsp;<span class="ident" id="3407440">tagged</span>&nbsp;<span class="op" id="3407447">&gt;=</span>&nbsp;<span class="num" id="3407450">0</span>&nbsp;<span class="op" id="3407452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407456">return</span>&nbsp;<span class="ident" id="3407463">fields</span><span class="op" id="3407469">[</span><span class="ident" id="3407470">tagged</span><span class="op" id="3407476">]</span><span class="op" id="3407477">,</span>&nbsp;<span class="builtintype" id="3407479">true</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3407485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3407488">//&nbsp;All&nbsp;remaining&nbsp;fields&nbsp;have&nbsp;the&nbsp;same&nbsp;length.&nbsp;If&nbsp;there&#39;s&nbsp;more&nbsp;than&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3407561">//&nbsp;we&nbsp;have&nbsp;a&nbsp;conflict&nbsp;(two&nbsp;fields&nbsp;named&nbsp;&#34;X&#34;&nbsp;at&nbsp;the&nbsp;same&nbsp;level)&nbsp;and&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3407632">//&nbsp;return&nbsp;no&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407653">if</span>&nbsp;<span class="builtinfunc" id="3407656">len</span><span class="op" id="3407659">(</span><span class="ident" id="3407660">fields</span><span class="op" id="3407666">)</span>&nbsp;<span class="op" id="3407668">&gt;</span>&nbsp;<span class="num" id="3407670">1</span>&nbsp;<span class="op" id="3407672">{</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407676">return</span>&nbsp;<span class="ident" id="3407683">field</span><span class="op" id="3407688">{</span><span class="op" id="3407689">}</span><span class="op" id="3407690">,</span>&nbsp;<span class="builtintype" id="3407692">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3407699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407702">return</span>&nbsp;<span class="ident" id="3407709">fields</span><span class="op" id="3407715">[</span><span class="num" id="3407716">0</span><span class="op" id="3407717">]</span><span class="op" id="3407718">,</span>&nbsp;<span class="builtintype" id="3407720">true</span><br>
<span class="lineno"></span><span class="op" id="3407725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1155</span><span class="keyword" id="3407728">var</span>&nbsp;<span class="ident" id="3407732">fieldCache</span>&nbsp;<span class="keyword" id="3407743">struct</span>&nbsp;<span class="op" id="3407750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407753">sync</span><span class="op" id="3407757">.</span><span class="ident" id="3407758">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407767">m</span>&nbsp;<span class="keyword" id="3407769">map</span><span class="op" id="3407772">[</span><span class="ident" id="3407773">reflect</span><span class="op" id="3407780">.</span><span class="ident" id="3407781">Type</span><span class="op" id="3407785">]</span><span class="op" id="3407786">[</span><span class="op" id="3407787">]</span><span class="ident" id="3407788">field</span><br>
<span class="lineno"></span><span class="op" id="3407794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="comment" id="3407797">//&nbsp;cachedTypeFields&nbsp;is&nbsp;like&nbsp;typeFields&nbsp;but&nbsp;uses&nbsp;a&nbsp;cache&nbsp;to&nbsp;avoid&nbsp;repeated&nbsp;work.</span><br>
<span class="lineno"></span><span class="keyword" id="3407877">func</span>&nbsp;<span class="ident" id="3407882">cachedTypeFields</span><span class="op" id="3407898">(</span><span class="ident" id="3407899">t</span>&nbsp;<span class="ident" id="3407901">reflect</span><span class="op" id="3407908">.</span><span class="ident" id="3407909">Type</span><span class="op" id="3407913">)</span>&nbsp;<span class="op" id="3407915">[</span><span class="op" id="3407916">]</span><span class="ident" id="3407917">field</span>&nbsp;<span class="op" id="3407923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407926">fieldCache</span><span class="op" id="3407936">.</span><span class="ident" id="3407937">RLock</span><span class="op" id="3407942">(</span><span class="op" id="3407943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407946">f</span>&nbsp;<span class="op" id="3407948">:=</span>&nbsp;<span class="ident" id="3407951">fieldCache</span><span class="op" id="3407961">.</span><span class="ident" id="3407962">m</span><span class="op" id="3407963">[</span><span class="ident" id="3407964">t</span><span class="op" id="3407965">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407968">fieldCache</span><span class="op" id="3407978">.</span><span class="ident" id="3407979">RUnlock</span><span class="op" id="3407986">(</span><span class="op" id="3407987">)</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407990">if</span>&nbsp;<span class="ident" id="3407993">f</span>&nbsp;<span class="op" id="3407995">!=</span>&nbsp;<span class="builtintype" id="3407998">nil</span>&nbsp;<span class="op" id="3408002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3408006">return</span>&nbsp;<span class="ident" id="3408013">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3408016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3408020">//&nbsp;Compute&nbsp;fields&nbsp;without&nbsp;lock.</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3408053">//&nbsp;Might&nbsp;duplicate&nbsp;effort&nbsp;but&nbsp;won&#39;t&nbsp;hold&nbsp;other&nbsp;computations&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408120">f</span>&nbsp;<span class="op" id="3408122">=</span>&nbsp;<span class="ident" id="3408124">typeFields</span><span class="op" id="3408134">(</span><span class="ident" id="3408135">t</span><span class="op" id="3408136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3408139">if</span>&nbsp;<span class="ident" id="3408142">f</span>&nbsp;<span class="op" id="3408144">==</span>&nbsp;<span class="builtintype" id="3408147">nil</span>&nbsp;<span class="op" id="3408151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408155">f</span>&nbsp;<span class="op" id="3408157">=</span>&nbsp;<span class="op" id="3408159">[</span><span class="op" id="3408160">]</span><span class="ident" id="3408161">field</span><span class="op" id="3408166">{</span><span class="op" id="3408167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3408170">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408174">fieldCache</span><span class="op" id="3408184">.</span><span class="ident" id="3408185">Lock</span><span class="op" id="3408189">(</span><span class="op" id="3408190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3408193">if</span>&nbsp;<span class="ident" id="3408196">fieldCache</span><span class="op" id="3408206">.</span><span class="ident" id="3408207">m</span>&nbsp;<span class="op" id="3408209">==</span>&nbsp;<span class="builtintype" id="3408212">nil</span>&nbsp;<span class="op" id="3408216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408220">fieldCache</span><span class="op" id="3408230">.</span><span class="ident" id="3408231">m</span>&nbsp;<span class="op" id="3408233">=</span>&nbsp;<span class="keyword" id="3408235">map</span><span class="op" id="3408238">[</span><span class="ident" id="3408239">reflect</span><span class="op" id="3408246">.</span><span class="ident" id="3408247">Type</span><span class="op" id="3408251">]</span><span class="op" id="3408252">[</span><span class="op" id="3408253">]</span><span class="ident" id="3408254">field</span><span class="op" id="3408259">{</span><span class="op" id="3408260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3408263">}</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408266">fieldCache</span><span class="op" id="3408276">.</span><span class="ident" id="3408277">m</span><span class="op" id="3408278">[</span><span class="ident" id="3408279">t</span><span class="op" id="3408280">]</span>&nbsp;<span class="op" id="3408282">=</span>&nbsp;<span class="ident" id="3408284">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408287">fieldCache</span><span class="op" id="3408297">.</span><span class="ident" id="3408298">Unlock</span><span class="op" id="3408304">(</span><span class="op" id="3408305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3408308">return</span>&nbsp;<span class="ident" id="3408315">f</span><br>
<span class="lineno"></span><span class="op" id="3408317">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
