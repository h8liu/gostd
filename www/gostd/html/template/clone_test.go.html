<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8039118">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8039173">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8039227">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8039278">package</span>&nbsp;<span class="ident" id="8039286">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8039296">import</span>&nbsp;<span class="op" id="8039303">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8039306">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8039315">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8039325">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8039338">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8039349">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="8039371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8039374">func</span>&nbsp;<span class="ident" id="8039379">TestAddParseTree</span><span class="op" id="8039395">(</span><span class="ident" id="8039396">t</span>&nbsp;<span class="op" id="8039398">*</span><span class="ident" id="8039399">testing</span><span class="op" id="8039406">.</span><span class="ident" id="8039407">T</span><span class="op" id="8039408">)</span>&nbsp;<span class="op" id="8039410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8039413">root</span>&nbsp;<span class="op" id="8039418">:=</span>&nbsp;<span class="ident" id="8039421">Must</span><span class="op" id="8039425">(</span><span class="ident" id="8039426">New</span><span class="op" id="8039429">(</span><span class="string" id="8039430">&#34;root&#34;</span><span class="op" id="8039436">)</span><span class="op" id="8039437">.</span><span class="ident" id="8039438">Parse</span><span class="op" id="8039443">(</span><span class="string" id="8039444">`{{define&nbsp;&#34;a&#34;}}&nbsp;{{.}}&nbsp;{{template&nbsp;&#34;b&#34;}}&nbsp;{{.}}&nbsp;&#34;&gt;&lt;/a&gt;{{end}}`</span><span class="op" id="8039503">)</span><span class="op" id="8039504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8039507">tree</span><span class="op" id="8039511">,</span>&nbsp;<span class="ident" id="8039513">err</span>&nbsp;<span class="op" id="8039517">:=</span>&nbsp;<span class="ident" id="8039520">parse</span><span class="op" id="8039525">.</span><span class="ident" id="8039526">Parse</span><span class="op" id="8039531">(</span><span class="string" id="8039532">&#34;t&#34;</span><span class="op" id="8039535">,</span>&nbsp;<span class="string" id="8039537">`{{define&nbsp;&#34;b&#34;}}&lt;a&nbsp;href=&#34;{{end}}`</span><span class="op" id="8039569">,</span>&nbsp;<span class="string" id="8039571">&#34;&#34;</span><span class="op" id="8039573">,</span>&nbsp;<span class="string" id="8039575">&#34;&#34;</span><span class="op" id="8039577">,</span>&nbsp;<span class="ident" id="8039579">nil</span><span class="op" id="8039582">,</span>&nbsp;<span class="ident" id="8039584">nil</span><span class="op" id="8039587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8039590">if</span>&nbsp;<span class="ident" id="8039593">err</span>&nbsp;<span class="op" id="8039597">!=</span>&nbsp;<span class="ident" id="8039600">nil</span>&nbsp;<span class="op" id="8039604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8039608">t</span><span class="op" id="8039609">.</span><span class="ident" id="8039610">Fatal</span><span class="op" id="8039615">(</span><span class="ident" id="8039616">err</span><span class="op" id="8039619">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8039622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8039625">added</span>&nbsp;<span class="op" id="8039631">:=</span>&nbsp;<span class="ident" id="8039634">Must</span><span class="op" id="8039638">(</span><span class="ident" id="8039639">root</span><span class="op" id="8039643">.</span><span class="ident" id="8039644">AddParseTree</span><span class="op" id="8039656">(</span><span class="string" id="8039657">&#34;b&#34;</span><span class="op" id="8039660">,</span>&nbsp;<span class="ident" id="8039662">tree</span><span class="op" id="8039666">[</span><span class="string" id="8039667">&#34;b&#34;</span><span class="op" id="8039670">]</span><span class="op" id="8039671">)</span><span class="op" id="8039672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8039675">b</span>&nbsp;<span class="op" id="8039677">:=</span>&nbsp;<span class="builtinfunc" id="8039680">new</span><span class="op" id="8039683">(</span><span class="ident" id="8039684">bytes</span><span class="op" id="8039689">.</span><span class="ident" id="8039690">Buffer</span><span class="op" id="8039696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8039699">err</span>&nbsp;<span class="op" id="8039703">=</span>&nbsp;<span class="ident" id="8039705">added</span><span class="op" id="8039710">.</span><span class="ident" id="8039711">ExecuteTemplate</span><span class="op" id="8039726">(</span><span class="ident" id="8039727">b</span><span class="op" id="8039728">,</span>&nbsp;<span class="string" id="8039730">&#34;a&#34;</span><span class="op" id="8039733">,</span>&nbsp;<span class="string" id="8039735">&#34;1&gt;0&#34;</span><span class="op" id="8039740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8039743">if</span>&nbsp;<span class="ident" id="8039746">err</span>&nbsp;<span class="op" id="8039750">!=</span>&nbsp;<span class="ident" id="8039753">nil</span>&nbsp;<span class="op" id="8039757">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8039761">t</span><span class="op" id="8039762">.</span><span class="ident" id="8039763">Fatal</span><span class="op" id="8039768">(</span><span class="ident" id="8039769">err</span><span class="op" id="8039772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8039775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8039778">if</span>&nbsp;<span class="ident" id="8039781">got</span><span class="op" id="8039784">,</span>&nbsp;<span class="ident" id="8039786">want</span>&nbsp;<span class="op" id="8039791">:=</span>&nbsp;<span class="ident" id="8039794">b</span><span class="op" id="8039795">.</span><span class="ident" id="8039796">String</span><span class="op" id="8039802">(</span><span class="op" id="8039803">)</span><span class="op" id="8039804">,</span>&nbsp;<span class="string" id="8039806">`&nbsp;1&amp;gt;0&nbsp;&lt;a&nbsp;href=&#34;&nbsp;1%3e0&nbsp;&#34;&gt;&lt;/a&gt;`</span><span class="op" id="8039838">;</span>&nbsp;<span class="ident" id="8039840">got</span>&nbsp;<span class="op" id="8039844">!=</span>&nbsp;<span class="ident" id="8039847">want</span>&nbsp;<span class="op" id="8039852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8039856">t</span><span class="op" id="8039857">.</span><span class="ident" id="8039858">Errorf</span><span class="op" id="8039864">(</span><span class="string" id="8039865">&#34;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8039881">,</span>&nbsp;<span class="ident" id="8039883">got</span><span class="op" id="8039886">,</span>&nbsp;<span class="ident" id="8039888">want</span><span class="op" id="8039892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8039895">}</span><br>
<span class="lineno">30</span><span class="op" id="8039897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8039900">func</span>&nbsp;<span class="ident" id="8039905">TestClone</span><span class="op" id="8039914">(</span><span class="ident" id="8039915">t</span>&nbsp;<span class="op" id="8039917">*</span><span class="ident" id="8039918">testing</span><span class="op" id="8039925">.</span><span class="ident" id="8039926">T</span><span class="op" id="8039927">)</span>&nbsp;<span class="op" id="8039929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8039932">//&nbsp;The&nbsp;{{.}}&nbsp;will&nbsp;be&nbsp;executed&nbsp;with&nbsp;data&nbsp;&#34;&lt;i&gt;*/&#34;&nbsp;in&nbsp;different&nbsp;contexts.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8040004">//&nbsp;In&nbsp;the&nbsp;t0&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;text&nbsp;context.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8040058">//&nbsp;In&nbsp;the&nbsp;t1&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;URL&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8040111">//&nbsp;In&nbsp;the&nbsp;t2&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;JavaScript&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8040171">//&nbsp;In&nbsp;the&nbsp;t3&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;CSS&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8040224">const</span>&nbsp;<span class="ident" id="8040230">tmpl</span>&nbsp;<span class="op" id="8040235">=</span>&nbsp;<span class="string" id="8040237">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8040303">b</span>&nbsp;<span class="op" id="8040305">:=</span>&nbsp;<span class="builtinfunc" id="8040308">new</span><span class="op" id="8040311">(</span><span class="ident" id="8040312">bytes</span><span class="op" id="8040317">.</span><span class="ident" id="8040318">Buffer</span><span class="op" id="8040324">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8040328">//&nbsp;Create&nbsp;an&nbsp;incomplete&nbsp;template&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8040366">t0</span>&nbsp;<span class="op" id="8040369">:=</span>&nbsp;<span class="ident" id="8040372">Must</span><span class="op" id="8040376">(</span><span class="ident" id="8040377">New</span><span class="op" id="8040380">(</span><span class="string" id="8040381">&#34;t0&#34;</span><span class="op" id="8040385">)</span><span class="op" id="8040386">.</span><span class="ident" id="8040387">Parse</span><span class="op" id="8040392">(</span><span class="ident" id="8040393">tmpl</span><span class="op" id="8040397">)</span><span class="op" id="8040398">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8040402">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t1.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8040422">t1</span>&nbsp;<span class="op" id="8040425">:=</span>&nbsp;<span class="ident" id="8040428">Must</span><span class="op" id="8040432">(</span><span class="ident" id="8040433">t0</span><span class="op" id="8040435">.</span><span class="ident" id="8040436">Clone</span><span class="op" id="8040441">(</span><span class="op" id="8040442">)</span><span class="op" id="8040443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8040446">Must</span><span class="op" id="8040450">(</span><span class="ident" id="8040451">t1</span><span class="op" id="8040453">.</span><span class="ident" id="8040454">Parse</span><span class="op" id="8040459">(</span><span class="string" id="8040460">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}`</span><span class="op" id="8040496">)</span><span class="op" id="8040497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8040500">Must</span><span class="op" id="8040504">(</span><span class="ident" id="8040505">t1</span><span class="op" id="8040507">.</span><span class="ident" id="8040508">Parse</span><span class="op" id="8040513">(</span><span class="string" id="8040514">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><span class="op" id="8040547">)</span><span class="op" id="8040548">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8040552">//&nbsp;Execute&nbsp;t1.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8040568">b</span><span class="op" id="8040569">.</span><span class="ident" id="8040570">Reset</span><span class="op" id="8040575">(</span><span class="op" id="8040576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8040579">if</span>&nbsp;<span class="ident" id="8040582">err</span>&nbsp;<span class="op" id="8040586">:=</span>&nbsp;<span class="ident" id="8040589">t1</span><span class="op" id="8040591">.</span><span class="ident" id="8040592">ExecuteTemplate</span><span class="op" id="8040607">(</span><span class="ident" id="8040608">b</span><span class="op" id="8040609">,</span>&nbsp;<span class="string" id="8040611">&#34;a&#34;</span><span class="op" id="8040614">,</span>&nbsp;<span class="string" id="8040616">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="8040623">)</span><span class="op" id="8040624">;</span>&nbsp;<span class="ident" id="8040626">err</span>&nbsp;<span class="op" id="8040630">!=</span>&nbsp;<span class="ident" id="8040633">nil</span>&nbsp;<span class="op" id="8040637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8040641">t</span><span class="op" id="8040642">.</span><span class="ident" id="8040643">Fatal</span><span class="op" id="8040648">(</span><span class="ident" id="8040649">err</span><span class="op" id="8040652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8040655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8040658">if</span>&nbsp;<span class="ident" id="8040661">got</span><span class="op" id="8040664">,</span>&nbsp;<span class="ident" id="8040666">want</span>&nbsp;<span class="op" id="8040671">:=</span>&nbsp;<span class="ident" id="8040674">b</span><span class="op" id="8040675">.</span><span class="ident" id="8040676">String</span><span class="op" id="8040682">(</span><span class="op" id="8040683">)</span><span class="op" id="8040684">,</span>&nbsp;<span class="string" id="8040686">`&nbsp;&lt;a&nbsp;href=&#34;&nbsp;%3ci%3e*/&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;`</span><span class="op" id="8040716">;</span>&nbsp;<span class="ident" id="8040718">got</span>&nbsp;<span class="op" id="8040722">!=</span>&nbsp;<span class="ident" id="8040725">want</span>&nbsp;<span class="op" id="8040730">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8040734">t</span><span class="op" id="8040735">.</span><span class="ident" id="8040736">Errorf</span><span class="op" id="8040742">(</span><span class="string" id="8040743">&#34;t1:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8040763">,</span>&nbsp;<span class="ident" id="8040765">got</span><span class="op" id="8040768">,</span>&nbsp;<span class="ident" id="8040770">want</span><span class="op" id="8040774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8040777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8040781">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8040801">t2</span>&nbsp;<span class="op" id="8040804">:=</span>&nbsp;<span class="ident" id="8040807">Must</span><span class="op" id="8040811">(</span><span class="ident" id="8040812">t0</span><span class="op" id="8040814">.</span><span class="ident" id="8040815">Clone</span><span class="op" id="8040820">(</span><span class="op" id="8040821">)</span><span class="op" id="8040822">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8040825">Must</span><span class="op" id="8040829">(</span><span class="ident" id="8040830">t2</span><span class="op" id="8040832">.</span><span class="ident" id="8040833">Parse</span><span class="op" id="8040838">(</span><span class="string" id="8040839">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;{{end}}`</span><span class="op" id="8040889">)</span><span class="op" id="8040890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8040893">Must</span><span class="op" id="8040897">(</span><span class="ident" id="8040898">t2</span><span class="op" id="8040900">.</span><span class="ident" id="8040901">Parse</span><span class="op" id="8040906">(</span><span class="string" id="8040907">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;{{end}}`</span><span class="op" id="8040940">)</span><span class="op" id="8040941">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8040945">//&nbsp;Execute&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8040961">b</span><span class="op" id="8040962">.</span><span class="ident" id="8040963">Reset</span><span class="op" id="8040968">(</span><span class="op" id="8040969">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8040972">if</span>&nbsp;<span class="ident" id="8040975">err</span>&nbsp;<span class="op" id="8040979">:=</span>&nbsp;<span class="ident" id="8040982">t2</span><span class="op" id="8040984">.</span><span class="ident" id="8040985">ExecuteTemplate</span><span class="op" id="8041000">(</span><span class="ident" id="8041001">b</span><span class="op" id="8041002">,</span>&nbsp;<span class="string" id="8041004">&#34;a&#34;</span><span class="op" id="8041007">,</span>&nbsp;<span class="string" id="8041009">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="8041016">)</span><span class="op" id="8041017">;</span>&nbsp;<span class="ident" id="8041019">err</span>&nbsp;<span class="op" id="8041023">!=</span>&nbsp;<span class="ident" id="8041026">nil</span>&nbsp;<span class="op" id="8041030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8041034">t</span><span class="op" id="8041035">.</span><span class="ident" id="8041036">Fatal</span><span class="op" id="8041041">(</span><span class="ident" id="8041042">err</span><span class="op" id="8041045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8041048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8041051">if</span>&nbsp;<span class="ident" id="8041054">got</span><span class="op" id="8041057">,</span>&nbsp;<span class="ident" id="8041059">want</span>&nbsp;<span class="op" id="8041064">:=</span>&nbsp;<span class="ident" id="8041067">b</span><span class="op" id="8041068">.</span><span class="ident" id="8041069">String</span><span class="op" id="8041075">(</span><span class="op" id="8041076">)</span><span class="op" id="8041077">,</span>&nbsp;<span class="string" id="8041079">`&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;&amp;#34;\u003ci\u003e*/&amp;#34;&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;`</span><span class="op" id="8041139">;</span>&nbsp;<span class="ident" id="8041141">got</span>&nbsp;<span class="op" id="8041145">!=</span>&nbsp;<span class="ident" id="8041148">want</span>&nbsp;<span class="op" id="8041153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8041157">t</span><span class="op" id="8041158">.</span><span class="ident" id="8041159">Errorf</span><span class="op" id="8041165">(</span><span class="string" id="8041166">&#34;t2:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8041186">,</span>&nbsp;<span class="ident" id="8041188">got</span><span class="op" id="8041191">,</span>&nbsp;<span class="ident" id="8041193">want</span><span class="op" id="8041197">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8041200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8041204">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t3,&nbsp;but&nbsp;do&nbsp;not&nbsp;execute&nbsp;t3&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8041251">t3</span>&nbsp;<span class="op" id="8041254">:=</span>&nbsp;<span class="ident" id="8041257">Must</span><span class="op" id="8041261">(</span><span class="ident" id="8041262">t0</span><span class="op" id="8041264">.</span><span class="ident" id="8041265">Clone</span><span class="op" id="8041270">(</span><span class="op" id="8041271">)</span><span class="op" id="8041272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8041275">Must</span><span class="op" id="8041279">(</span><span class="ident" id="8041280">t3</span><span class="op" id="8041282">.</span><span class="ident" id="8041283">Parse</span><span class="op" id="8041288">(</span><span class="string" id="8041289">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;style&gt;&nbsp;{{end}}`</span><span class="op" id="8041323">)</span><span class="op" id="8041324">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8041327">Must</span><span class="op" id="8041331">(</span><span class="ident" id="8041332">t3</span><span class="op" id="8041334">.</span><span class="ident" id="8041335">Parse</span><span class="op" id="8041340">(</span><span class="string" id="8041341">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&lt;/style&gt;&nbsp;{{end}}`</span><span class="op" id="8041376">)</span><span class="op" id="8041377">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8041381">//&nbsp;Complete&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8041398">Must</span><span class="op" id="8041402">(</span><span class="ident" id="8041403">t0</span><span class="op" id="8041405">.</span><span class="ident" id="8041406">Parse</span><span class="op" id="8041411">(</span><span class="string" id="8041412">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;(&nbsp;{{end}}`</span><span class="op" id="8041440">)</span><span class="op" id="8041441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8041444">Must</span><span class="op" id="8041448">(</span><span class="ident" id="8041449">t0</span><span class="op" id="8041451">.</span><span class="ident" id="8041452">Parse</span><span class="op" id="8041457">(</span><span class="string" id="8041458">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;)&nbsp;{{end}}`</span><span class="op" id="8041486">)</span><span class="op" id="8041487">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8041491">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t4.&nbsp;Redefining&nbsp;the&nbsp;&#34;lhs&#34;&nbsp;template&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8041554">t4</span>&nbsp;<span class="op" id="8041557">:=</span>&nbsp;<span class="ident" id="8041560">Must</span><span class="op" id="8041564">(</span><span class="ident" id="8041565">t0</span><span class="op" id="8041567">.</span><span class="ident" id="8041568">Clone</span><span class="op" id="8041573">(</span><span class="op" id="8041574">)</span><span class="op" id="8041575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8041578">if</span>&nbsp;<span class="ident" id="8041581">_</span><span class="op" id="8041582">,</span>&nbsp;<span class="ident" id="8041584">err</span>&nbsp;<span class="op" id="8041588">:=</span>&nbsp;<span class="ident" id="8041591">t4</span><span class="op" id="8041593">.</span><span class="ident" id="8041594">Parse</span><span class="op" id="8041599">(</span><span class="string" id="8041600">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;FAIL&nbsp;{{end}}`</span><span class="op" id="8041631">)</span><span class="op" id="8041632">;</span>&nbsp;<span class="ident" id="8041634">err</span>&nbsp;<span class="op" id="8041638">==</span>&nbsp;<span class="ident" id="8041641">nil</span>&nbsp;<span class="op" id="8041645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8041649">t</span><span class="op" id="8041650">.</span><span class="ident" id="8041651">Error</span><span class="op" id="8041656">(</span><span class="string" id="8041657">`redefine&nbsp;&#34;lhs&#34;:&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="8041699">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8041702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8041706">//&nbsp;Execute&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8041722">b</span><span class="op" id="8041723">.</span><span class="ident" id="8041724">Reset</span><span class="op" id="8041729">(</span><span class="op" id="8041730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8041733">if</span>&nbsp;<span class="ident" id="8041736">err</span>&nbsp;<span class="op" id="8041740">:=</span>&nbsp;<span class="ident" id="8041743">t0</span><span class="op" id="8041745">.</span><span class="ident" id="8041746">ExecuteTemplate</span><span class="op" id="8041761">(</span><span class="ident" id="8041762">b</span><span class="op" id="8041763">,</span>&nbsp;<span class="string" id="8041765">&#34;a&#34;</span><span class="op" id="8041768">,</span>&nbsp;<span class="string" id="8041770">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="8041777">)</span><span class="op" id="8041778">;</span>&nbsp;<span class="ident" id="8041780">err</span>&nbsp;<span class="op" id="8041784">!=</span>&nbsp;<span class="ident" id="8041787">nil</span>&nbsp;<span class="op" id="8041791">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8041795">t</span><span class="op" id="8041796">.</span><span class="ident" id="8041797">Fatal</span><span class="op" id="8041802">(</span><span class="ident" id="8041803">err</span><span class="op" id="8041806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8041809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8041812">if</span>&nbsp;<span class="ident" id="8041815">got</span><span class="op" id="8041818">,</span>&nbsp;<span class="ident" id="8041820">want</span>&nbsp;<span class="op" id="8041825">:=</span>&nbsp;<span class="ident" id="8041828">b</span><span class="op" id="8041829">.</span><span class="ident" id="8041830">String</span><span class="op" id="8041836">(</span><span class="op" id="8041837">)</span><span class="op" id="8041838">,</span>&nbsp;<span class="string" id="8041840">`&nbsp;(&nbsp;&amp;lt;i&amp;gt;*/&nbsp;)&nbsp;`</span><span class="op" id="8041859">;</span>&nbsp;<span class="ident" id="8041861">got</span>&nbsp;<span class="op" id="8041865">!=</span>&nbsp;<span class="ident" id="8041868">want</span>&nbsp;<span class="op" id="8041873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8041877">t</span><span class="op" id="8041878">.</span><span class="ident" id="8041879">Errorf</span><span class="op" id="8041885">(</span><span class="string" id="8041886">&#34;t0:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8041906">,</span>&nbsp;<span class="ident" id="8041908">got</span><span class="op" id="8041911">,</span>&nbsp;<span class="ident" id="8041913">want</span><span class="op" id="8041917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8041920">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8041924">//&nbsp;Clone&nbsp;t0.&nbsp;This&nbsp;should&nbsp;fail,&nbsp;as&nbsp;t0&nbsp;has&nbsp;already&nbsp;executed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8041984">if</span>&nbsp;<span class="ident" id="8041987">_</span><span class="op" id="8041988">,</span>&nbsp;<span class="ident" id="8041990">err</span>&nbsp;<span class="op" id="8041994">:=</span>&nbsp;<span class="ident" id="8041997">t0</span><span class="op" id="8041999">.</span><span class="ident" id="8042000">Clone</span><span class="op" id="8042005">(</span><span class="op" id="8042006">)</span><span class="op" id="8042007">;</span>&nbsp;<span class="ident" id="8042009">err</span>&nbsp;<span class="op" id="8042013">==</span>&nbsp;<span class="ident" id="8042016">nil</span>&nbsp;<span class="op" id="8042020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042024">t</span><span class="op" id="8042025">.</span><span class="ident" id="8042026">Error</span><span class="op" id="8042031">(</span><span class="string" id="8042032">`t0.Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="8042070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8042073">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8042077">//&nbsp;Similarly,&nbsp;cloning&nbsp;sub-templates&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8042127">if</span>&nbsp;<span class="ident" id="8042130">_</span><span class="op" id="8042131">,</span>&nbsp;<span class="ident" id="8042133">err</span>&nbsp;<span class="op" id="8042137">:=</span>&nbsp;<span class="ident" id="8042140">t0</span><span class="op" id="8042142">.</span><span class="ident" id="8042143">Lookup</span><span class="op" id="8042149">(</span><span class="string" id="8042150">&#34;a&#34;</span><span class="op" id="8042153">)</span><span class="op" id="8042154">.</span><span class="ident" id="8042155">Clone</span><span class="op" id="8042160">(</span><span class="op" id="8042161">)</span><span class="op" id="8042162">;</span>&nbsp;<span class="ident" id="8042164">err</span>&nbsp;<span class="op" id="8042168">==</span>&nbsp;<span class="ident" id="8042171">nil</span>&nbsp;<span class="op" id="8042175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042179">t</span><span class="op" id="8042180">.</span><span class="ident" id="8042181">Error</span><span class="op" id="8042186">(</span><span class="string" id="8042187">`t0.Lookup(&#34;a&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="8042237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8042240">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8042243">if</span>&nbsp;<span class="ident" id="8042246">_</span><span class="op" id="8042247">,</span>&nbsp;<span class="ident" id="8042249">err</span>&nbsp;<span class="op" id="8042253">:=</span>&nbsp;<span class="ident" id="8042256">t0</span><span class="op" id="8042258">.</span><span class="ident" id="8042259">Lookup</span><span class="op" id="8042265">(</span><span class="string" id="8042266">&#34;lhs&#34;</span><span class="op" id="8042271">)</span><span class="op" id="8042272">.</span><span class="ident" id="8042273">Clone</span><span class="op" id="8042278">(</span><span class="op" id="8042279">)</span><span class="op" id="8042280">;</span>&nbsp;<span class="ident" id="8042282">err</span>&nbsp;<span class="op" id="8042286">==</span>&nbsp;<span class="ident" id="8042289">nil</span>&nbsp;<span class="op" id="8042293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042297">t</span><span class="op" id="8042298">.</span><span class="ident" id="8042299">Error</span><span class="op" id="8042304">(</span><span class="string" id="8042305">`t0.Lookup(&#34;lhs&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="8042357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8042360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8042364">//&nbsp;Execute&nbsp;t3.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042380">b</span><span class="op" id="8042381">.</span><span class="ident" id="8042382">Reset</span><span class="op" id="8042387">(</span><span class="op" id="8042388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8042391">if</span>&nbsp;<span class="ident" id="8042394">err</span>&nbsp;<span class="op" id="8042398">:=</span>&nbsp;<span class="ident" id="8042401">t3</span><span class="op" id="8042403">.</span><span class="ident" id="8042404">ExecuteTemplate</span><span class="op" id="8042419">(</span><span class="ident" id="8042420">b</span><span class="op" id="8042421">,</span>&nbsp;<span class="string" id="8042423">&#34;a&#34;</span><span class="op" id="8042426">,</span>&nbsp;<span class="string" id="8042428">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="8042435">)</span><span class="op" id="8042436">;</span>&nbsp;<span class="ident" id="8042438">err</span>&nbsp;<span class="op" id="8042442">!=</span>&nbsp;<span class="ident" id="8042445">nil</span>&nbsp;<span class="op" id="8042449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042453">t</span><span class="op" id="8042454">.</span><span class="ident" id="8042455">Fatal</span><span class="op" id="8042460">(</span><span class="ident" id="8042461">err</span><span class="op" id="8042464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8042467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8042470">if</span>&nbsp;<span class="ident" id="8042473">got</span><span class="op" id="8042476">,</span>&nbsp;<span class="ident" id="8042478">want</span>&nbsp;<span class="op" id="8042483">:=</span>&nbsp;<span class="ident" id="8042486">b</span><span class="op" id="8042487">.</span><span class="ident" id="8042488">String</span><span class="op" id="8042494">(</span><span class="op" id="8042495">)</span><span class="op" id="8042496">,</span>&nbsp;<span class="string" id="8042498">`&nbsp;&lt;style&gt;&nbsp;ZgotmplZ&nbsp;&lt;/style&gt;&nbsp;`</span><span class="op" id="8042527">;</span>&nbsp;<span class="ident" id="8042529">got</span>&nbsp;<span class="op" id="8042533">!=</span>&nbsp;<span class="ident" id="8042536">want</span>&nbsp;<span class="op" id="8042541">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042545">t</span><span class="op" id="8042546">.</span><span class="ident" id="8042547">Errorf</span><span class="op" id="8042553">(</span><span class="string" id="8042554">&#34;t3:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8042574">,</span>&nbsp;<span class="ident" id="8042576">got</span><span class="op" id="8042579">,</span>&nbsp;<span class="ident" id="8042581">want</span><span class="op" id="8042585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8042588">}</span><br>
<span class="lineno"></span><span class="op" id="8042590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8042593">func</span>&nbsp;<span class="ident" id="8042598">TestTemplates</span><span class="op" id="8042611">(</span><span class="ident" id="8042612">t</span>&nbsp;<span class="op" id="8042614">*</span><span class="ident" id="8042615">testing</span><span class="op" id="8042622">.</span><span class="ident" id="8042623">T</span><span class="op" id="8042624">)</span>&nbsp;<span class="op" id="8042626">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042629">names</span>&nbsp;<span class="op" id="8042635">:=</span>&nbsp;<span class="op" id="8042638">[</span><span class="op" id="8042639">]</span><span class="builtintype" id="8042640">string</span><span class="op" id="8042646">{</span><span class="string" id="8042647">&#34;t0&#34;</span><span class="op" id="8042651">,</span>&nbsp;<span class="string" id="8042653">&#34;a&#34;</span><span class="op" id="8042656">,</span>&nbsp;<span class="string" id="8042658">&#34;lhs&#34;</span><span class="op" id="8042663">,</span>&nbsp;<span class="string" id="8042665">&#34;rhs&#34;</span><span class="op" id="8042670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8042673">//&nbsp;Some&nbsp;template&nbsp;definitions&nbsp;borrowed&nbsp;from&nbsp;TestClone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8042728">const</span>&nbsp;<span class="ident" id="8042734">tmpl</span>&nbsp;<span class="op" id="8042739">=</span>&nbsp;<span class="string" id="8042741">`<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042881">t0</span>&nbsp;<span class="op" id="8042884">:=</span>&nbsp;<span class="ident" id="8042887">Must</span><span class="op" id="8042891">(</span><span class="ident" id="8042892">New</span><span class="op" id="8042895">(</span><span class="string" id="8042896">&#34;t0&#34;</span><span class="op" id="8042900">)</span><span class="op" id="8042901">.</span><span class="ident" id="8042902">Parse</span><span class="op" id="8042907">(</span><span class="ident" id="8042908">tmpl</span><span class="op" id="8042912">)</span><span class="op" id="8042913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042916">templates</span>&nbsp;<span class="op" id="8042926">:=</span>&nbsp;<span class="ident" id="8042929">t0</span><span class="op" id="8042931">.</span><span class="ident" id="8042932">Templates</span><span class="op" id="8042941">(</span><span class="op" id="8042942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8042945">if</span>&nbsp;<span class="builtinfunc" id="8042948">len</span><span class="op" id="8042951">(</span><span class="ident" id="8042952">templates</span><span class="op" id="8042961">)</span>&nbsp;<span class="op" id="8042963">!=</span>&nbsp;<span class="builtinfunc" id="8042966">len</span><span class="op" id="8042969">(</span><span class="ident" id="8042970">names</span><span class="op" id="8042975">)</span>&nbsp;<span class="op" id="8042977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042981">t</span><span class="op" id="8042982">.</span><span class="ident" id="8042983">Errorf</span><span class="op" id="8042989">(</span><span class="string" id="8042990">&#34;expected&nbsp;%d&nbsp;templates;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8043021">,</span>&nbsp;<span class="builtinfunc" id="8043023">len</span><span class="op" id="8043026">(</span><span class="ident" id="8043027">names</span><span class="op" id="8043032">)</span><span class="op" id="8043033">,</span>&nbsp;<span class="builtinfunc" id="8043035">len</span><span class="op" id="8043038">(</span><span class="ident" id="8043039">templates</span><span class="op" id="8043048">)</span><span class="op" id="8043049">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8043052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8043055">for</span>&nbsp;<span class="ident" id="8043059">_</span><span class="op" id="8043060">,</span>&nbsp;<span class="ident" id="8043062">name</span>&nbsp;<span class="op" id="8043067">:=</span>&nbsp;<span class="keyword" id="8043070">range</span>&nbsp;<span class="ident" id="8043076">names</span>&nbsp;<span class="op" id="8043082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043086">found</span>&nbsp;<span class="op" id="8043092">:=</span>&nbsp;<span class="builtintype" id="8043095">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8043103">for</span>&nbsp;<span class="ident" id="8043107">_</span><span class="op" id="8043108">,</span>&nbsp;<span class="ident" id="8043110">tmpl</span>&nbsp;<span class="op" id="8043115">:=</span>&nbsp;<span class="keyword" id="8043118">range</span>&nbsp;<span class="ident" id="8043124">templates</span>&nbsp;<span class="op" id="8043134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8043139">if</span>&nbsp;<span class="ident" id="8043142">name</span>&nbsp;<span class="op" id="8043147">==</span>&nbsp;<span class="ident" id="8043150">tmpl</span><span class="op" id="8043154">.</span><span class="ident" id="8043155">text</span><span class="op" id="8043159">.</span><span class="ident" id="8043160">Name</span><span class="op" id="8043164">(</span><span class="op" id="8043165">)</span>&nbsp;<span class="op" id="8043167">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043173">found</span>&nbsp;<span class="op" id="8043179">=</span>&nbsp;<span class="builtintype" id="8043181">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8043190">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8043199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8043203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8043207">if</span>&nbsp;<span class="op" id="8043210">!</span><span class="ident" id="8043211">found</span>&nbsp;<span class="op" id="8043217">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043222">t</span><span class="op" id="8043223">.</span><span class="ident" id="8043224">Error</span><span class="op" id="8043229">(</span><span class="string" id="8043230">&#34;could&nbsp;not&nbsp;find&nbsp;template&#34;</span><span class="op" id="8043255">,</span>&nbsp;<span class="ident" id="8043257">name</span><span class="op" id="8043261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8043265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8043268">}</span><br>
<span class="lineno"></span><span class="op" id="8043270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="8043273">//&nbsp;This&nbsp;used&nbsp;to&nbsp;crash;&nbsp;http://golang.org/issue/3281</span><br>
<span class="lineno"></span><span class="keyword" id="8043325">func</span>&nbsp;<span class="ident" id="8043330">TestCloneCrash</span><span class="op" id="8043344">(</span><span class="ident" id="8043345">t</span>&nbsp;<span class="op" id="8043347">*</span><span class="ident" id="8043348">testing</span><span class="op" id="8043355">.</span><span class="ident" id="8043356">T</span><span class="op" id="8043357">)</span>&nbsp;<span class="op" id="8043359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043362">t1</span>&nbsp;<span class="op" id="8043365">:=</span>&nbsp;<span class="ident" id="8043368">New</span><span class="op" id="8043371">(</span><span class="string" id="8043372">&#34;all&#34;</span><span class="op" id="8043377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043380">Must</span><span class="op" id="8043384">(</span><span class="ident" id="8043385">t1</span><span class="op" id="8043387">.</span><span class="ident" id="8043388">New</span><span class="op" id="8043391">(</span><span class="string" id="8043392">&#34;t1&#34;</span><span class="op" id="8043396">)</span><span class="op" id="8043397">.</span><span class="ident" id="8043398">Parse</span><span class="op" id="8043403">(</span><span class="string" id="8043404">`{{define&nbsp;&#34;foo&#34;}}foo{{end}}`</span><span class="op" id="8043432">)</span><span class="op" id="8043433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043436">t1</span><span class="op" id="8043438">.</span><span class="ident" id="8043439">Clone</span><span class="op" id="8043444">(</span><span class="op" id="8043445">)</span><br>
<span class="lineno">150</span><span class="op" id="8043447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8043450">//&nbsp;Ensure&nbsp;that&nbsp;this&nbsp;guarantee&nbsp;from&nbsp;the&nbsp;docs&nbsp;is&nbsp;upheld:</span><br>
<span class="lineno"></span><span class="comment" id="8043505">//&nbsp;&#34;Further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="8043563">//&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&#34;</span><br>
<span class="lineno">155</span><span class="keyword" id="8043604">func</span>&nbsp;<span class="ident" id="8043609">TestCloneThenParse</span><span class="op" id="8043627">(</span><span class="ident" id="8043628">t</span>&nbsp;<span class="op" id="8043630">*</span><span class="ident" id="8043631">testing</span><span class="op" id="8043638">.</span><span class="ident" id="8043639">T</span><span class="op" id="8043640">)</span>&nbsp;<span class="op" id="8043642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043645">t0</span>&nbsp;<span class="op" id="8043648">:=</span>&nbsp;<span class="ident" id="8043651">Must</span><span class="op" id="8043655">(</span><span class="ident" id="8043656">New</span><span class="op" id="8043659">(</span><span class="string" id="8043660">&#34;t0&#34;</span><span class="op" id="8043664">)</span><span class="op" id="8043665">.</span><span class="ident" id="8043666">Parse</span><span class="op" id="8043671">(</span><span class="string" id="8043672">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;embedded&#34;}}{{end}}`</span><span class="op" id="8043718">)</span><span class="op" id="8043719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043722">t1</span>&nbsp;<span class="op" id="8043725">:=</span>&nbsp;<span class="ident" id="8043728">Must</span><span class="op" id="8043732">(</span><span class="ident" id="8043733">t0</span><span class="op" id="8043735">.</span><span class="ident" id="8043736">Clone</span><span class="op" id="8043741">(</span><span class="op" id="8043742">)</span><span class="op" id="8043743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043746">Must</span><span class="op" id="8043750">(</span><span class="ident" id="8043751">t1</span><span class="op" id="8043753">.</span><span class="ident" id="8043754">Parse</span><span class="op" id="8043759">(</span><span class="string" id="8043760">`{{define&nbsp;&#34;embedded&#34;}}t1{{end}}`</span><span class="op" id="8043792">)</span><span class="op" id="8043793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8043796">if</span>&nbsp;<span class="builtinfunc" id="8043799">len</span><span class="op" id="8043802">(</span><span class="ident" id="8043803">t0</span><span class="op" id="8043805">.</span><span class="ident" id="8043806">Templates</span><span class="op" id="8043815">(</span><span class="op" id="8043816">)</span><span class="op" id="8043817">)</span><span class="op" id="8043818">+</span><span class="num" id="8043819">1</span>&nbsp;<span class="op" id="8043821">!=</span>&nbsp;<span class="builtinfunc" id="8043824">len</span><span class="op" id="8043827">(</span><span class="ident" id="8043828">t1</span><span class="op" id="8043830">.</span><span class="ident" id="8043831">Templates</span><span class="op" id="8043840">(</span><span class="op" id="8043841">)</span><span class="op" id="8043842">)</span>&nbsp;<span class="op" id="8043844">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043848">t</span><span class="op" id="8043849">.</span><span class="ident" id="8043850">Error</span><span class="op" id="8043855">(</span><span class="string" id="8043856">&#34;adding&nbsp;a&nbsp;template&nbsp;to&nbsp;a&nbsp;clone&nbsp;added&nbsp;it&nbsp;to&nbsp;the&nbsp;original&#34;</span><span class="op" id="8043911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8043914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8043917">//&nbsp;double&nbsp;check&nbsp;that&nbsp;the&nbsp;embedded&nbsp;template&nbsp;isn&#39;t&nbsp;available&nbsp;in&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043993">err</span>&nbsp;<span class="op" id="8043997">:=</span>&nbsp;<span class="ident" id="8044000">t0</span><span class="op" id="8044002">.</span><span class="ident" id="8044003">ExecuteTemplate</span><span class="op" id="8044018">(</span><span class="ident" id="8044019">ioutil</span><span class="op" id="8044025">.</span><span class="ident" id="8044026">Discard</span><span class="op" id="8044033">,</span>&nbsp;<span class="string" id="8044035">&#34;a&#34;</span><span class="op" id="8044038">,</span>&nbsp;<span class="ident" id="8044040">nil</span><span class="op" id="8044043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8044046">if</span>&nbsp;<span class="ident" id="8044049">err</span>&nbsp;<span class="op" id="8044053">==</span>&nbsp;<span class="ident" id="8044056">nil</span>&nbsp;<span class="op" id="8044060">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8044064">t</span><span class="op" id="8044065">.</span><span class="ident" id="8044066">Error</span><span class="op" id="8044071">(</span><span class="string" id="8044072">&#34;expected&nbsp;&#39;no&nbsp;such&nbsp;template&#39;&nbsp;error&#34;</span><span class="op" id="8044107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8044110">}</span><br>
<span class="lineno"></span><span class="op" id="8044112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8044115">//&nbsp;https://code.google.com/p/go/issues/detail?id=5980</span><br>
<span class="lineno">170</span><span class="keyword" id="8044169">func</span>&nbsp;<span class="ident" id="8044174">TestFuncMapWorksAfterClone</span><span class="op" id="8044200">(</span><span class="ident" id="8044201">t</span>&nbsp;<span class="op" id="8044203">*</span><span class="ident" id="8044204">testing</span><span class="op" id="8044211">.</span><span class="ident" id="8044212">T</span><span class="op" id="8044213">)</span>&nbsp;<span class="op" id="8044215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8044218">funcs</span>&nbsp;<span class="op" id="8044224">:=</span>&nbsp;<span class="ident" id="8044227">FuncMap</span><span class="op" id="8044234">{</span><span class="string" id="8044235">&#34;customFunc&#34;</span><span class="op" id="8044247">:</span>&nbsp;<span class="keyword" id="8044249">func</span><span class="op" id="8044253">(</span><span class="op" id="8044254">)</span>&nbsp;<span class="op" id="8044256">(</span><span class="builtintype" id="8044257">string</span><span class="op" id="8044263">,</span>&nbsp;<span class="builtintype" id="8044265">error</span><span class="op" id="8044270">)</span>&nbsp;<span class="op" id="8044272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8044276">return</span>&nbsp;<span class="string" id="8044283">&#34;&#34;</span><span class="op" id="8044285">,</span>&nbsp;<span class="ident" id="8044287">errors</span><span class="op" id="8044293">.</span><span class="ident" id="8044294">New</span><span class="op" id="8044297">(</span><span class="string" id="8044298">&#34;issue5980&#34;</span><span class="op" id="8044309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8044312">}</span><span class="op" id="8044313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8044317">//&nbsp;get&nbsp;the&nbsp;expected&nbsp;error&nbsp;output&nbsp;(no&nbsp;clone)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8044362">uncloned</span>&nbsp;<span class="op" id="8044371">:=</span>&nbsp;<span class="ident" id="8044374">Must</span><span class="op" id="8044378">(</span><span class="ident" id="8044379">New</span><span class="op" id="8044382">(</span><span class="string" id="8044383">&#34;&#34;</span><span class="op" id="8044385">)</span><span class="op" id="8044386">.</span><span class="ident" id="8044387">Funcs</span><span class="op" id="8044392">(</span><span class="ident" id="8044393">funcs</span><span class="op" id="8044398">)</span><span class="op" id="8044399">.</span><span class="ident" id="8044400">Parse</span><span class="op" id="8044405">(</span><span class="string" id="8044406">&#34;{{customFunc}}&#34;</span><span class="op" id="8044422">)</span><span class="op" id="8044423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8044426">wantErr</span>&nbsp;<span class="op" id="8044434">:=</span>&nbsp;<span class="ident" id="8044437">uncloned</span><span class="op" id="8044445">.</span><span class="ident" id="8044446">Execute</span><span class="op" id="8044453">(</span><span class="ident" id="8044454">ioutil</span><span class="op" id="8044460">.</span><span class="ident" id="8044461">Discard</span><span class="op" id="8044468">,</span>&nbsp;<span class="ident" id="8044470">nil</span><span class="op" id="8044473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8044477">//&nbsp;toClone&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;uncloned.&nbsp;It&nbsp;has&nbsp;to&nbsp;be&nbsp;recreated&nbsp;from&nbsp;scratch,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8044556">//&nbsp;since&nbsp;cloning&nbsp;cannot&nbsp;occur&nbsp;after&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8044604">toClone</span>&nbsp;<span class="op" id="8044612">:=</span>&nbsp;<span class="ident" id="8044615">Must</span><span class="op" id="8044619">(</span><span class="ident" id="8044620">New</span><span class="op" id="8044623">(</span><span class="string" id="8044624">&#34;&#34;</span><span class="op" id="8044626">)</span><span class="op" id="8044627">.</span><span class="ident" id="8044628">Funcs</span><span class="op" id="8044633">(</span><span class="ident" id="8044634">funcs</span><span class="op" id="8044639">)</span><span class="op" id="8044640">.</span><span class="ident" id="8044641">Parse</span><span class="op" id="8044646">(</span><span class="string" id="8044647">&#34;{{customFunc}}&#34;</span><span class="op" id="8044663">)</span><span class="op" id="8044664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8044667">cloned</span>&nbsp;<span class="op" id="8044674">:=</span>&nbsp;<span class="ident" id="8044677">Must</span><span class="op" id="8044681">(</span><span class="ident" id="8044682">toClone</span><span class="op" id="8044689">.</span><span class="ident" id="8044690">Clone</span><span class="op" id="8044695">(</span><span class="op" id="8044696">)</span><span class="op" id="8044697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8044700">gotErr</span>&nbsp;<span class="op" id="8044707">:=</span>&nbsp;<span class="ident" id="8044710">cloned</span><span class="op" id="8044716">.</span><span class="ident" id="8044717">Execute</span><span class="op" id="8044724">(</span><span class="ident" id="8044725">ioutil</span><span class="op" id="8044731">.</span><span class="ident" id="8044732">Discard</span><span class="op" id="8044739">,</span>&nbsp;<span class="ident" id="8044741">nil</span><span class="op" id="8044744">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8044748">if</span>&nbsp;<span class="ident" id="8044751">wantErr</span><span class="op" id="8044758">.</span><span class="ident" id="8044759">Error</span><span class="op" id="8044764">(</span><span class="op" id="8044765">)</span>&nbsp;<span class="op" id="8044767">!=</span>&nbsp;<span class="ident" id="8044770">gotErr</span><span class="op" id="8044776">.</span><span class="ident" id="8044777">Error</span><span class="op" id="8044782">(</span><span class="op" id="8044783">)</span>&nbsp;<span class="op" id="8044785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8044789">t</span><span class="op" id="8044790">.</span><span class="ident" id="8044791">Errorf</span><span class="op" id="8044797">(</span><span class="string" id="8044798">&#34;clone&nbsp;error&nbsp;message&nbsp;mismatch&nbsp;want&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8044843">,</span>&nbsp;<span class="ident" id="8044845">wantErr</span><span class="op" id="8044852">,</span>&nbsp;<span class="ident" id="8044854">gotErr</span><span class="op" id="8044860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8044863">}</span><br>
<span class="lineno"></span><span class="op" id="8044865">}</span>
</div>
</body>
</html>
