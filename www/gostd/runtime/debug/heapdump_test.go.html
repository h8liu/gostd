<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html" class="current">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8164795">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8164850">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8164904">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8164955">package</span>&nbsp;<span class="ident" id="8164963">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8164970">import</span>&nbsp;<span class="op" id="8164977">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8164980">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8164993">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8164999">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8165010">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8165020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8165023">func</span>&nbsp;<span class="ident" id="8165028">TestWriteHeapDumpNonempty</span><span class="op" id="8165053">(</span><span class="ident" id="8165054">t</span>&nbsp;<span class="op" id="8165056">*</span><span class="ident" id="8165057">testing</span><span class="op" id="8165064">.</span><span class="ident" id="8165065">T</span><span class="op" id="8165066">)</span>&nbsp;<span class="op" id="8165068">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165071">if</span>&nbsp;<span class="ident" id="8165074">runtime</span><span class="op" id="8165081">.</span><span class="ident" id="8165082">GOOS</span>&nbsp;<span class="op" id="8165087">==</span>&nbsp;<span class="string" id="8165090">&#34;nacl&#34;</span>&nbsp;<span class="op" id="8165097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165101">t</span><span class="op" id="8165102">.</span><span class="ident" id="8165103">Skip</span><span class="op" id="8165107">(</span><span class="string" id="8165108">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="8165149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165155">f</span><span class="op" id="8165156">,</span>&nbsp;<span class="ident" id="8165158">err</span>&nbsp;<span class="op" id="8165162">:=</span>&nbsp;<span class="ident" id="8165165">ioutil</span><span class="op" id="8165171">.</span><span class="ident" id="8165172">TempFile</span><span class="op" id="8165180">(</span><span class="string" id="8165181">&#34;&#34;</span><span class="op" id="8165183">,</span>&nbsp;<span class="string" id="8165185">&#34;heapdumptest&#34;</span><span class="op" id="8165199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165202">if</span>&nbsp;<span class="ident" id="8165205">err</span>&nbsp;<span class="op" id="8165209">!=</span>&nbsp;<span class="ident" id="8165212">nil</span>&nbsp;<span class="op" id="8165216">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165220">t</span><span class="op" id="8165221">.</span><span class="ident" id="8165222">Fatalf</span><span class="op" id="8165228">(</span><span class="string" id="8165229">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8165250">,</span>&nbsp;<span class="ident" id="8165252">err</span><span class="op" id="8165255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165261">defer</span>&nbsp;<span class="ident" id="8165267">os</span><span class="op" id="8165269">.</span><span class="ident" id="8165270">Remove</span><span class="op" id="8165276">(</span><span class="ident" id="8165277">f</span><span class="op" id="8165278">.</span><span class="ident" id="8165279">Name</span><span class="op" id="8165283">(</span><span class="op" id="8165284">)</span><span class="op" id="8165285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165288">defer</span>&nbsp;<span class="ident" id="8165294">f</span><span class="op" id="8165295">.</span><span class="ident" id="8165296">Close</span><span class="op" id="8165301">(</span><span class="op" id="8165302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165305">WriteHeapDump</span><span class="op" id="8165318">(</span><span class="ident" id="8165319">f</span><span class="op" id="8165320">.</span><span class="ident" id="8165321">Fd</span><span class="op" id="8165323">(</span><span class="op" id="8165324">)</span><span class="op" id="8165325">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165328">fi</span><span class="op" id="8165330">,</span>&nbsp;<span class="ident" id="8165332">err</span>&nbsp;<span class="op" id="8165336">:=</span>&nbsp;<span class="ident" id="8165339">f</span><span class="op" id="8165340">.</span><span class="ident" id="8165341">Stat</span><span class="op" id="8165345">(</span><span class="op" id="8165346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165349">if</span>&nbsp;<span class="ident" id="8165352">err</span>&nbsp;<span class="op" id="8165356">!=</span>&nbsp;<span class="ident" id="8165359">nil</span>&nbsp;<span class="op" id="8165363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165367">t</span><span class="op" id="8165368">.</span><span class="ident" id="8165369">Fatalf</span><span class="op" id="8165375">(</span><span class="string" id="8165376">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8165393">,</span>&nbsp;<span class="ident" id="8165395">err</span><span class="op" id="8165398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165404">const</span>&nbsp;<span class="ident" id="8165410">minSize</span>&nbsp;<span class="op" id="8165418">=</span>&nbsp;<span class="num" id="8165420">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165423">if</span>&nbsp;<span class="ident" id="8165426">size</span>&nbsp;<span class="op" id="8165431">:=</span>&nbsp;<span class="ident" id="8165434">fi</span><span class="op" id="8165436">.</span><span class="ident" id="8165437">Size</span><span class="op" id="8165441">(</span><span class="op" id="8165442">)</span><span class="op" id="8165443">;</span>&nbsp;<span class="ident" id="8165445">size</span>&nbsp;<span class="op" id="8165450">&lt;</span>&nbsp;<span class="ident" id="8165452">minSize</span>&nbsp;<span class="op" id="8165460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165464">t</span><span class="op" id="8165465">.</span><span class="ident" id="8165466">Fatalf</span><span class="op" id="8165472">(</span><span class="string" id="8165473">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8165526">,</span>&nbsp;<span class="ident" id="8165528">size</span><span class="op" id="8165532">,</span>&nbsp;<span class="ident" id="8165534">minSize</span><span class="op" id="8165541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165544">}</span><br>
<span class="lineno"></span><span class="op" id="8165546">}</span>
</div>
</body>
</html>
