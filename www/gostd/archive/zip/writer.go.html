<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6321807">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6321862">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6321916">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6321967">package</span>&nbsp;<span class="ident" id="6321975">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6321980">import</span>&nbsp;<span class="op" id="6321987">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6321990">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6321999">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6322018">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6322028">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6322036">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6322050">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6322055">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6322058">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="6322098">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6322146">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="6322186">type</span>&nbsp;<span class="ident" id="6322191">Writer</span>&nbsp;<span class="keyword" id="6322198">struct</span>&nbsp;<span class="op" id="6322205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322208">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6322215">*</span><span class="ident" id="6322216">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322229">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6322236">[</span><span class="op" id="6322237">]</span><span class="op" id="6322238">*</span><span class="ident" id="6322239">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322247">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6322254">*</span><span class="ident" id="6322255">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322267">closed</span>&nbsp;<span class="builtintype" id="6322274">bool</span><br>
<span class="lineno">25</span><span class="op" id="6322279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6322282">type</span>&nbsp;<span class="ident" id="6322287">header</span>&nbsp;<span class="keyword" id="6322294">struct</span>&nbsp;<span class="op" id="6322301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322304">*</span><span class="ident" id="6322305">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322317">offset</span>&nbsp;<span class="ident" id="6322324">uint64</span><br>
<span class="lineno">30</span><span class="op" id="6322331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6322334">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6322393">func</span>&nbsp;<span class="ident" id="6322398">NewWriter</span><span class="op" id="6322407">(</span><span class="ident" id="6322408">w</span>&nbsp;<span class="ident" id="6322410">io</span><span class="op" id="6322412">.</span><span class="ident" id="6322413">Writer</span><span class="op" id="6322419">)</span>&nbsp;<span class="op" id="6322421">*</span><span class="ident" id="6322422">Writer</span>&nbsp;<span class="op" id="6322429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322432">return</span>&nbsp;<span class="op" id="6322439">&amp;</span><span class="ident" id="6322440">Writer</span><span class="op" id="6322446">{</span><span class="ident" id="6322447">cw</span><span class="op" id="6322449">:</span>&nbsp;<span class="op" id="6322451">&amp;</span><span class="ident" id="6322452">countWriter</span><span class="op" id="6322463">{</span><span class="ident" id="6322464">w</span><span class="op" id="6322465">:</span>&nbsp;<span class="ident" id="6322467">bufio</span><span class="op" id="6322472">.</span><span class="ident" id="6322473">NewWriter</span><span class="op" id="6322482">(</span><span class="ident" id="6322483">w</span><span class="op" id="6322484">)</span><span class="op" id="6322485">}</span><span class="op" id="6322486">}</span><br>
<span class="lineno">35</span><span class="op" id="6322488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6322491">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="6322552">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="6322625">func</span>&nbsp;<span class="op" id="6322630">(</span><span class="ident" id="6322631">w</span>&nbsp;<span class="op" id="6322633">*</span><span class="ident" id="6322634">Writer</span><span class="op" id="6322640">)</span>&nbsp;<span class="ident" id="6322642">Flush</span><span class="op" id="6322647">(</span><span class="op" id="6322648">)</span>&nbsp;<span class="builtintype" id="6322650">error</span>&nbsp;<span class="op" id="6322656">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322659">return</span>&nbsp;<span class="ident" id="6322666">w</span><span class="op" id="6322667">.</span><span class="ident" id="6322668">cw</span><span class="op" id="6322670">.</span><span class="ident" id="6322671">w</span><span class="op" id="6322672">.</span><span class="op" id="6322673">(</span><span class="op" id="6322674">*</span><span class="ident" id="6322675">bufio</span><span class="op" id="6322680">.</span><span class="ident" id="6322681">Writer</span><span class="op" id="6322687">)</span><span class="op" id="6322688">.</span><span class="ident" id="6322689">Flush</span><span class="op" id="6322694">(</span><span class="op" id="6322695">)</span><br>
<span class="lineno"></span><span class="op" id="6322697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6322700">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="6322773">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="6322831">func</span>&nbsp;<span class="op" id="6322836">(</span><span class="ident" id="6322837">w</span>&nbsp;<span class="op" id="6322839">*</span><span class="ident" id="6322840">Writer</span><span class="op" id="6322846">)</span>&nbsp;<span class="ident" id="6322848">Close</span><span class="op" id="6322853">(</span><span class="op" id="6322854">)</span>&nbsp;<span class="builtintype" id="6322856">error</span>&nbsp;<span class="op" id="6322862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322865">if</span>&nbsp;<span class="ident" id="6322868">w</span><span class="op" id="6322869">.</span><span class="ident" id="6322870">last</span>&nbsp;<span class="op" id="6322875">!=</span>&nbsp;<span class="ident" id="6322878">nil</span>&nbsp;<span class="op" id="6322882">&amp;&amp;</span>&nbsp;<span class="op" id="6322885">!</span><span class="ident" id="6322886">w</span><span class="op" id="6322887">.</span><span class="ident" id="6322888">last</span><span class="op" id="6322892">.</span><span class="ident" id="6322893">closed</span>&nbsp;<span class="op" id="6322900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322904">if</span>&nbsp;<span class="ident" id="6322907">err</span>&nbsp;<span class="op" id="6322911">:=</span>&nbsp;<span class="ident" id="6322914">w</span><span class="op" id="6322915">.</span><span class="ident" id="6322916">last</span><span class="op" id="6322920">.</span><span class="builtinfunc" id="6322921">close</span><span class="op" id="6322926">(</span><span class="op" id="6322927">)</span><span class="op" id="6322928">;</span>&nbsp;<span class="ident" id="6322930">err</span>&nbsp;<span class="op" id="6322934">!=</span>&nbsp;<span class="ident" id="6322937">nil</span>&nbsp;<span class="op" id="6322941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322946">return</span>&nbsp;<span class="ident" id="6322953">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322959">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322963">w</span><span class="op" id="6322964">.</span><span class="ident" id="6322965">last</span>&nbsp;<span class="op" id="6322970">=</span>&nbsp;<span class="ident" id="6322972">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322980">if</span>&nbsp;<span class="ident" id="6322983">w</span><span class="op" id="6322984">.</span><span class="ident" id="6322985">closed</span>&nbsp;<span class="op" id="6322992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322996">return</span>&nbsp;<span class="ident" id="6323003">errors</span><span class="op" id="6323009">.</span><span class="ident" id="6323010">New</span><span class="op" id="6323013">(</span><span class="string" id="6323014">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="6323040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323043">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323046">w</span><span class="op" id="6323047">.</span><span class="ident" id="6323048">closed</span>&nbsp;<span class="op" id="6323055">=</span>&nbsp;<span class="builtintype" id="6323057">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323064">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323092">start</span>&nbsp;<span class="op" id="6323098">:=</span>&nbsp;<span class="ident" id="6323101">w</span><span class="op" id="6323102">.</span><span class="ident" id="6323103">cw</span><span class="op" id="6323105">.</span><span class="ident" id="6323106">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323113">for</span>&nbsp;<span class="ident" id="6323117">_</span><span class="op" id="6323118">,</span>&nbsp;<span class="ident" id="6323120">h</span>&nbsp;<span class="op" id="6323122">:=</span>&nbsp;<span class="keyword" id="6323125">range</span>&nbsp;<span class="ident" id="6323131">w</span><span class="op" id="6323132">.</span><span class="ident" id="6323133">dir</span>&nbsp;<span class="op" id="6323137">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323141">var</span>&nbsp;<span class="ident" id="6323145">buf</span>&nbsp;<span class="op" id="6323149">[</span><span class="ident" id="6323150">directoryHeaderLen</span><span class="op" id="6323168">]</span><span class="builtintype" id="6323169">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323176">b</span>&nbsp;<span class="op" id="6323178">:=</span>&nbsp;<span class="ident" id="6323181">writeBuf</span><span class="op" id="6323189">(</span><span class="ident" id="6323190">buf</span><span class="op" id="6323193">[</span><span class="op" id="6323194">:</span><span class="op" id="6323195">]</span><span class="op" id="6323196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323200">b</span><span class="op" id="6323201">.</span><span class="builtintype" id="6323202">uint32</span><span class="op" id="6323208">(</span><span class="builtintype" id="6323209">uint32</span><span class="op" id="6323215">(</span><span class="ident" id="6323216">directoryHeaderSignature</span><span class="op" id="6323240">)</span><span class="op" id="6323241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323245">b</span><span class="op" id="6323246">.</span><span class="builtintype" id="6323247">uint16</span><span class="op" id="6323253">(</span><span class="ident" id="6323254">h</span><span class="op" id="6323255">.</span><span class="ident" id="6323256">CreatorVersion</span><span class="op" id="6323270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323274">b</span><span class="op" id="6323275">.</span><span class="builtintype" id="6323276">uint16</span><span class="op" id="6323282">(</span><span class="ident" id="6323283">h</span><span class="op" id="6323284">.</span><span class="ident" id="6323285">ReaderVersion</span><span class="op" id="6323298">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323302">b</span><span class="op" id="6323303">.</span><span class="builtintype" id="6323304">uint16</span><span class="op" id="6323310">(</span><span class="ident" id="6323311">h</span><span class="op" id="6323312">.</span><span class="ident" id="6323313">Flags</span><span class="op" id="6323318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323322">b</span><span class="op" id="6323323">.</span><span class="builtintype" id="6323324">uint16</span><span class="op" id="6323330">(</span><span class="ident" id="6323331">h</span><span class="op" id="6323332">.</span><span class="ident" id="6323333">Method</span><span class="op" id="6323339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323343">b</span><span class="op" id="6323344">.</span><span class="builtintype" id="6323345">uint16</span><span class="op" id="6323351">(</span><span class="ident" id="6323352">h</span><span class="op" id="6323353">.</span><span class="ident" id="6323354">ModifiedTime</span><span class="op" id="6323366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323370">b</span><span class="op" id="6323371">.</span><span class="builtintype" id="6323372">uint16</span><span class="op" id="6323378">(</span><span class="ident" id="6323379">h</span><span class="op" id="6323380">.</span><span class="ident" id="6323381">ModifiedDate</span><span class="op" id="6323393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323397">b</span><span class="op" id="6323398">.</span><span class="builtintype" id="6323399">uint32</span><span class="op" id="6323405">(</span><span class="ident" id="6323406">h</span><span class="op" id="6323407">.</span><span class="ident" id="6323408">CRC32</span><span class="op" id="6323413">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323417">if</span>&nbsp;<span class="ident" id="6323420">h</span><span class="op" id="6323421">.</span><span class="ident" id="6323422">isZip64</span><span class="op" id="6323429">(</span><span class="op" id="6323430">)</span>&nbsp;<span class="op" id="6323432">||</span>&nbsp;<span class="ident" id="6323435">h</span><span class="op" id="6323436">.</span><span class="ident" id="6323437">offset</span>&nbsp;<span class="op" id="6323444">&gt;</span>&nbsp;<span class="ident" id="6323446">uint32max</span>&nbsp;<span class="op" id="6323456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323461">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323519">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323582">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323623">b</span><span class="op" id="6323624">.</span><span class="builtintype" id="6323625">uint32</span><span class="op" id="6323631">(</span><span class="ident" id="6323632">uint32max</span><span class="op" id="6323641">)</span>&nbsp;<span class="comment" id="6323643">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323665">b</span><span class="op" id="6323666">.</span><span class="builtintype" id="6323667">uint32</span><span class="op" id="6323673">(</span><span class="ident" id="6323674">uint32max</span><span class="op" id="6323683">)</span>&nbsp;<span class="comment" id="6323685">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323710">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323752">var</span>&nbsp;<span class="ident" id="6323756">buf</span>&nbsp;<span class="op" id="6323760">[</span><span class="num" id="6323761">28</span><span class="op" id="6323763">]</span><span class="builtintype" id="6323764">byte</span>&nbsp;<span class="comment" id="6323769">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323797">eb</span>&nbsp;<span class="op" id="6323800">:=</span>&nbsp;<span class="ident" id="6323803">writeBuf</span><span class="op" id="6323811">(</span><span class="ident" id="6323812">buf</span><span class="op" id="6323815">[</span><span class="op" id="6323816">:</span><span class="op" id="6323817">]</span><span class="op" id="6323818">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323823">eb</span><span class="op" id="6323825">.</span><span class="builtintype" id="6323826">uint16</span><span class="op" id="6323832">(</span><span class="ident" id="6323833">zip64ExtraId</span><span class="op" id="6323845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323850">eb</span><span class="op" id="6323852">.</span><span class="builtintype" id="6323853">uint16</span><span class="op" id="6323859">(</span><span class="num" id="6323860">24</span><span class="op" id="6323862">)</span>&nbsp;<span class="comment" id="6323864">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323887">eb</span><span class="op" id="6323889">.</span><span class="ident" id="6323890">uint64</span><span class="op" id="6323896">(</span><span class="ident" id="6323897">h</span><span class="op" id="6323898">.</span><span class="ident" id="6323899">UncompressedSize64</span><span class="op" id="6323917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323922">eb</span><span class="op" id="6323924">.</span><span class="ident" id="6323925">uint64</span><span class="op" id="6323931">(</span><span class="ident" id="6323932">h</span><span class="op" id="6323933">.</span><span class="ident" id="6323934">CompressedSize64</span><span class="op" id="6323950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323955">eb</span><span class="op" id="6323957">.</span><span class="ident" id="6323958">uint64</span><span class="op" id="6323964">(</span><span class="ident" id="6323965">h</span><span class="op" id="6323966">.</span><span class="ident" id="6323967">offset</span><span class="op" id="6323973">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323978">h</span><span class="op" id="6323979">.</span><span class="ident" id="6323980">Extra</span>&nbsp;<span class="op" id="6323986">=</span>&nbsp;<span class="builtinfunc" id="6323988">append</span><span class="op" id="6323994">(</span><span class="ident" id="6323995">h</span><span class="op" id="6323996">.</span><span class="ident" id="6323997">Extra</span><span class="op" id="6324002">,</span>&nbsp;<span class="ident" id="6324004">buf</span><span class="op" id="6324007">[</span><span class="op" id="6324008">:</span><span class="op" id="6324009">]</span><span class="op" id="6324010">...</span><span class="op" id="6324013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324017">}</span>&nbsp;<span class="keyword" id="6324019">else</span>&nbsp;<span class="op" id="6324024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324029">b</span><span class="op" id="6324030">.</span><span class="builtintype" id="6324031">uint32</span><span class="op" id="6324037">(</span><span class="ident" id="6324038">h</span><span class="op" id="6324039">.</span><span class="ident" id="6324040">CompressedSize</span><span class="op" id="6324054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324059">b</span><span class="op" id="6324060">.</span><span class="builtintype" id="6324061">uint32</span><span class="op" id="6324067">(</span><span class="ident" id="6324068">h</span><span class="op" id="6324069">.</span><span class="ident" id="6324070">UncompressedSize</span><span class="op" id="6324086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324090">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324094">b</span><span class="op" id="6324095">.</span><span class="builtintype" id="6324096">uint16</span><span class="op" id="6324102">(</span><span class="builtintype" id="6324103">uint16</span><span class="op" id="6324109">(</span><span class="builtinfunc" id="6324110">len</span><span class="op" id="6324113">(</span><span class="ident" id="6324114">h</span><span class="op" id="6324115">.</span><span class="ident" id="6324116">Name</span><span class="op" id="6324120">)</span><span class="op" id="6324121">)</span><span class="op" id="6324122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324126">b</span><span class="op" id="6324127">.</span><span class="builtintype" id="6324128">uint16</span><span class="op" id="6324134">(</span><span class="builtintype" id="6324135">uint16</span><span class="op" id="6324141">(</span><span class="builtinfunc" id="6324142">len</span><span class="op" id="6324145">(</span><span class="ident" id="6324146">h</span><span class="op" id="6324147">.</span><span class="ident" id="6324148">Extra</span><span class="op" id="6324153">)</span><span class="op" id="6324154">)</span><span class="op" id="6324155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324159">b</span><span class="op" id="6324160">.</span><span class="builtintype" id="6324161">uint16</span><span class="op" id="6324167">(</span><span class="builtintype" id="6324168">uint16</span><span class="op" id="6324174">(</span><span class="builtinfunc" id="6324175">len</span><span class="op" id="6324178">(</span><span class="ident" id="6324179">h</span><span class="op" id="6324180">.</span><span class="ident" id="6324181">Comment</span><span class="op" id="6324188">)</span><span class="op" id="6324189">)</span><span class="op" id="6324190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324194">b</span>&nbsp;<span class="op" id="6324196">=</span>&nbsp;<span class="ident" id="6324198">b</span><span class="op" id="6324199">[</span><span class="num" id="6324200">4</span><span class="op" id="6324201">:</span><span class="op" id="6324202">]</span>&nbsp;<span class="comment" id="6324204">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324267">b</span><span class="op" id="6324268">.</span><span class="builtintype" id="6324269">uint32</span><span class="op" id="6324275">(</span><span class="ident" id="6324276">h</span><span class="op" id="6324277">.</span><span class="ident" id="6324278">ExternalAttrs</span><span class="op" id="6324291">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324295">if</span>&nbsp;<span class="ident" id="6324298">h</span><span class="op" id="6324299">.</span><span class="ident" id="6324300">offset</span>&nbsp;<span class="op" id="6324307">&gt;</span>&nbsp;<span class="ident" id="6324309">uint32max</span>&nbsp;<span class="op" id="6324319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324324">b</span><span class="op" id="6324325">.</span><span class="builtintype" id="6324326">uint32</span><span class="op" id="6324332">(</span><span class="ident" id="6324333">uint32max</span><span class="op" id="6324342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324346">}</span>&nbsp;<span class="keyword" id="6324348">else</span>&nbsp;<span class="op" id="6324353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324358">b</span><span class="op" id="6324359">.</span><span class="builtintype" id="6324360">uint32</span><span class="op" id="6324366">(</span><span class="builtintype" id="6324367">uint32</span><span class="op" id="6324373">(</span><span class="ident" id="6324374">h</span><span class="op" id="6324375">.</span><span class="ident" id="6324376">offset</span><span class="op" id="6324382">)</span><span class="op" id="6324383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324387">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324391">if</span>&nbsp;<span class="ident" id="6324394">_</span><span class="op" id="6324395">,</span>&nbsp;<span class="ident" id="6324397">err</span>&nbsp;<span class="op" id="6324401">:=</span>&nbsp;<span class="ident" id="6324404">w</span><span class="op" id="6324405">.</span><span class="ident" id="6324406">cw</span><span class="op" id="6324408">.</span><span class="ident" id="6324409">Write</span><span class="op" id="6324414">(</span><span class="ident" id="6324415">buf</span><span class="op" id="6324418">[</span><span class="op" id="6324419">:</span><span class="op" id="6324420">]</span><span class="op" id="6324421">)</span><span class="op" id="6324422">;</span>&nbsp;<span class="ident" id="6324424">err</span>&nbsp;<span class="op" id="6324428">!=</span>&nbsp;<span class="ident" id="6324431">nil</span>&nbsp;<span class="op" id="6324435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324440">return</span>&nbsp;<span class="ident" id="6324447">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324457">if</span>&nbsp;<span class="ident" id="6324460">_</span><span class="op" id="6324461">,</span>&nbsp;<span class="ident" id="6324463">err</span>&nbsp;<span class="op" id="6324467">:=</span>&nbsp;<span class="ident" id="6324470">io</span><span class="op" id="6324472">.</span><span class="ident" id="6324473">WriteString</span><span class="op" id="6324484">(</span><span class="ident" id="6324485">w</span><span class="op" id="6324486">.</span><span class="ident" id="6324487">cw</span><span class="op" id="6324489">,</span>&nbsp;<span class="ident" id="6324491">h</span><span class="op" id="6324492">.</span><span class="ident" id="6324493">Name</span><span class="op" id="6324497">)</span><span class="op" id="6324498">;</span>&nbsp;<span class="ident" id="6324500">err</span>&nbsp;<span class="op" id="6324504">!=</span>&nbsp;<span class="ident" id="6324507">nil</span>&nbsp;<span class="op" id="6324511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324516">return</span>&nbsp;<span class="ident" id="6324523">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324533">if</span>&nbsp;<span class="ident" id="6324536">_</span><span class="op" id="6324537">,</span>&nbsp;<span class="ident" id="6324539">err</span>&nbsp;<span class="op" id="6324543">:=</span>&nbsp;<span class="ident" id="6324546">w</span><span class="op" id="6324547">.</span><span class="ident" id="6324548">cw</span><span class="op" id="6324550">.</span><span class="ident" id="6324551">Write</span><span class="op" id="6324556">(</span><span class="ident" id="6324557">h</span><span class="op" id="6324558">.</span><span class="ident" id="6324559">Extra</span><span class="op" id="6324564">)</span><span class="op" id="6324565">;</span>&nbsp;<span class="ident" id="6324567">err</span>&nbsp;<span class="op" id="6324571">!=</span>&nbsp;<span class="ident" id="6324574">nil</span>&nbsp;<span class="op" id="6324578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324583">return</span>&nbsp;<span class="ident" id="6324590">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324600">if</span>&nbsp;<span class="ident" id="6324603">_</span><span class="op" id="6324604">,</span>&nbsp;<span class="ident" id="6324606">err</span>&nbsp;<span class="op" id="6324610">:=</span>&nbsp;<span class="ident" id="6324613">io</span><span class="op" id="6324615">.</span><span class="ident" id="6324616">WriteString</span><span class="op" id="6324627">(</span><span class="ident" id="6324628">w</span><span class="op" id="6324629">.</span><span class="ident" id="6324630">cw</span><span class="op" id="6324632">,</span>&nbsp;<span class="ident" id="6324634">h</span><span class="op" id="6324635">.</span><span class="ident" id="6324636">Comment</span><span class="op" id="6324643">)</span><span class="op" id="6324644">;</span>&nbsp;<span class="ident" id="6324646">err</span>&nbsp;<span class="op" id="6324650">!=</span>&nbsp;<span class="ident" id="6324653">nil</span>&nbsp;<span class="op" id="6324657">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324662">return</span>&nbsp;<span class="ident" id="6324669">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324681">end</span>&nbsp;<span class="op" id="6324685">:=</span>&nbsp;<span class="ident" id="6324688">w</span><span class="op" id="6324689">.</span><span class="ident" id="6324690">cw</span><span class="op" id="6324692">.</span><span class="ident" id="6324693">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324701">records</span>&nbsp;<span class="op" id="6324709">:=</span>&nbsp;<span class="ident" id="6324712">uint64</span><span class="op" id="6324718">(</span><span class="builtinfunc" id="6324719">len</span><span class="op" id="6324722">(</span><span class="ident" id="6324723">w</span><span class="op" id="6324724">.</span><span class="ident" id="6324725">dir</span><span class="op" id="6324728">)</span><span class="op" id="6324729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324732">size</span>&nbsp;<span class="op" id="6324737">:=</span>&nbsp;<span class="ident" id="6324740">uint64</span><span class="op" id="6324746">(</span><span class="ident" id="6324747">end</span>&nbsp;<span class="op" id="6324751">-</span>&nbsp;<span class="ident" id="6324753">start</span><span class="op" id="6324758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324761">offset</span>&nbsp;<span class="op" id="6324768">:=</span>&nbsp;<span class="ident" id="6324771">uint64</span><span class="op" id="6324777">(</span><span class="ident" id="6324778">start</span><span class="op" id="6324783">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324787">if</span>&nbsp;<span class="ident" id="6324790">records</span>&nbsp;<span class="op" id="6324798">&gt;</span>&nbsp;<span class="ident" id="6324800">uint16max</span>&nbsp;<span class="op" id="6324810">||</span>&nbsp;<span class="ident" id="6324813">size</span>&nbsp;<span class="op" id="6324818">&gt;</span>&nbsp;<span class="ident" id="6324820">uint32max</span>&nbsp;<span class="op" id="6324830">||</span>&nbsp;<span class="ident" id="6324833">offset</span>&nbsp;<span class="op" id="6324840">&gt;</span>&nbsp;<span class="ident" id="6324842">uint32max</span>&nbsp;<span class="op" id="6324852">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324856">var</span>&nbsp;<span class="ident" id="6324860">buf</span>&nbsp;<span class="op" id="6324864">[</span><span class="ident" id="6324865">directory64EndLen</span>&nbsp;<span class="op" id="6324883">+</span>&nbsp;<span class="ident" id="6324885">directory64LocLen</span><span class="op" id="6324902">]</span><span class="builtintype" id="6324903">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324910">b</span>&nbsp;<span class="op" id="6324912">:=</span>&nbsp;<span class="ident" id="6324915">writeBuf</span><span class="op" id="6324923">(</span><span class="ident" id="6324924">buf</span><span class="op" id="6324927">[</span><span class="op" id="6324928">:</span><span class="op" id="6324929">]</span><span class="op" id="6324930">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6324935">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324978">b</span><span class="op" id="6324979">.</span><span class="builtintype" id="6324980">uint32</span><span class="op" id="6324986">(</span><span class="ident" id="6324987">directory64EndSignature</span><span class="op" id="6325010">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325014">b</span><span class="op" id="6325015">.</span><span class="ident" id="6325016">uint64</span><span class="op" id="6325022">(</span><span class="ident" id="6325023">directory64EndLen</span><span class="op" id="6325040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325044">b</span><span class="op" id="6325045">.</span><span class="builtintype" id="6325046">uint16</span><span class="op" id="6325052">(</span><span class="ident" id="6325053">zipVersion45</span><span class="op" id="6325065">)</span>&nbsp;<span class="comment" id="6325067">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325088">b</span><span class="op" id="6325089">.</span><span class="builtintype" id="6325090">uint16</span><span class="op" id="6325096">(</span><span class="ident" id="6325097">zipVersion45</span><span class="op" id="6325109">)</span>&nbsp;<span class="comment" id="6325111">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325142">b</span><span class="op" id="6325143">.</span><span class="builtintype" id="6325144">uint32</span><span class="op" id="6325150">(</span><span class="num" id="6325151">0</span><span class="op" id="6325152">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6325165">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325190">b</span><span class="op" id="6325191">.</span><span class="builtintype" id="6325192">uint32</span><span class="op" id="6325198">(</span><span class="num" id="6325199">0</span><span class="op" id="6325200">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6325213">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325277">b</span><span class="op" id="6325278">.</span><span class="ident" id="6325279">uint64</span><span class="op" id="6325285">(</span><span class="ident" id="6325286">records</span><span class="op" id="6325293">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6325300">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325367">b</span><span class="op" id="6325368">.</span><span class="ident" id="6325369">uint64</span><span class="op" id="6325375">(</span><span class="ident" id="6325376">records</span><span class="op" id="6325383">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6325390">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325444">b</span><span class="op" id="6325445">.</span><span class="ident" id="6325446">uint64</span><span class="op" id="6325452">(</span><span class="ident" id="6325453">size</span><span class="op" id="6325457">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6325467">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325502">b</span><span class="op" id="6325503">.</span><span class="ident" id="6325504">uint64</span><span class="op" id="6325510">(</span><span class="ident" id="6325511">offset</span><span class="op" id="6325517">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6325525">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325609">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325653">b</span><span class="op" id="6325654">.</span><span class="builtintype" id="6325655">uint32</span><span class="op" id="6325661">(</span><span class="ident" id="6325662">directory64LocSignature</span><span class="op" id="6325685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325689">b</span><span class="op" id="6325690">.</span><span class="builtintype" id="6325691">uint32</span><span class="op" id="6325697">(</span><span class="num" id="6325698">0</span><span class="op" id="6325699">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6325711">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325788">b</span><span class="op" id="6325789">.</span><span class="ident" id="6325790">uint64</span><span class="op" id="6325796">(</span><span class="ident" id="6325797">uint64</span><span class="op" id="6325803">(</span><span class="ident" id="6325804">end</span><span class="op" id="6325807">)</span><span class="op" id="6325808">)</span>&nbsp;<span class="comment" id="6325810">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325876">b</span><span class="op" id="6325877">.</span><span class="builtintype" id="6325878">uint32</span><span class="op" id="6325884">(</span><span class="num" id="6325885">1</span><span class="op" id="6325886">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6325898">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325926">if</span>&nbsp;<span class="ident" id="6325929">_</span><span class="op" id="6325930">,</span>&nbsp;<span class="ident" id="6325932">err</span>&nbsp;<span class="op" id="6325936">:=</span>&nbsp;<span class="ident" id="6325939">w</span><span class="op" id="6325940">.</span><span class="ident" id="6325941">cw</span><span class="op" id="6325943">.</span><span class="ident" id="6325944">Write</span><span class="op" id="6325949">(</span><span class="ident" id="6325950">buf</span><span class="op" id="6325953">[</span><span class="op" id="6325954">:</span><span class="op" id="6325955">]</span><span class="op" id="6325956">)</span><span class="op" id="6325957">;</span>&nbsp;<span class="ident" id="6325959">err</span>&nbsp;<span class="op" id="6325963">!=</span>&nbsp;<span class="ident" id="6325966">nil</span>&nbsp;<span class="op" id="6325970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325975">return</span>&nbsp;<span class="ident" id="6325982">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325993">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326056">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326106">records</span>&nbsp;<span class="op" id="6326114">=</span>&nbsp;<span class="ident" id="6326116">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326128">size</span>&nbsp;<span class="op" id="6326133">=</span>&nbsp;<span class="ident" id="6326135">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326147">offset</span>&nbsp;<span class="op" id="6326154">=</span>&nbsp;<span class="ident" id="6326156">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326171">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326192">var</span>&nbsp;<span class="ident" id="6326196">buf</span>&nbsp;<span class="op" id="6326200">[</span><span class="ident" id="6326201">directoryEndLen</span><span class="op" id="6326216">]</span><span class="builtintype" id="6326217">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326223">b</span>&nbsp;<span class="op" id="6326225">:=</span>&nbsp;<span class="ident" id="6326228">writeBuf</span><span class="op" id="6326236">(</span><span class="ident" id="6326237">buf</span><span class="op" id="6326240">[</span><span class="op" id="6326241">:</span><span class="op" id="6326242">]</span><span class="op" id="6326243">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326246">b</span><span class="op" id="6326247">.</span><span class="builtintype" id="6326248">uint32</span><span class="op" id="6326254">(</span><span class="builtintype" id="6326255">uint32</span><span class="op" id="6326261">(</span><span class="ident" id="6326262">directoryEndSignature</span><span class="op" id="6326283">)</span><span class="op" id="6326284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326287">b</span>&nbsp;<span class="op" id="6326289">=</span>&nbsp;<span class="ident" id="6326291">b</span><span class="op" id="6326292">[</span><span class="num" id="6326293">4</span><span class="op" id="6326294">:</span><span class="op" id="6326295">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6326313">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326373">b</span><span class="op" id="6326374">.</span><span class="builtintype" id="6326375">uint16</span><span class="op" id="6326381">(</span><span class="builtintype" id="6326382">uint16</span><span class="op" id="6326388">(</span><span class="ident" id="6326389">records</span><span class="op" id="6326396">)</span><span class="op" id="6326397">)</span>&nbsp;<span class="comment" id="6326399">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326431">b</span><span class="op" id="6326432">.</span><span class="builtintype" id="6326433">uint16</span><span class="op" id="6326439">(</span><span class="builtintype" id="6326440">uint16</span><span class="op" id="6326446">(</span><span class="ident" id="6326447">records</span><span class="op" id="6326454">)</span><span class="op" id="6326455">)</span>&nbsp;<span class="comment" id="6326457">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326485">b</span><span class="op" id="6326486">.</span><span class="builtintype" id="6326487">uint32</span><span class="op" id="6326493">(</span><span class="builtintype" id="6326494">uint32</span><span class="op" id="6326500">(</span><span class="ident" id="6326501">size</span><span class="op" id="6326505">)</span><span class="op" id="6326506">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6326511">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326533">b</span><span class="op" id="6326534">.</span><span class="builtintype" id="6326535">uint32</span><span class="op" id="6326541">(</span><span class="builtintype" id="6326542">uint32</span><span class="op" id="6326548">(</span><span class="ident" id="6326549">offset</span><span class="op" id="6326555">)</span><span class="op" id="6326556">)</span>&nbsp;&nbsp;<span class="comment" id="6326559">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326582">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326624">if</span>&nbsp;<span class="ident" id="6326627">_</span><span class="op" id="6326628">,</span>&nbsp;<span class="ident" id="6326630">err</span>&nbsp;<span class="op" id="6326634">:=</span>&nbsp;<span class="ident" id="6326637">w</span><span class="op" id="6326638">.</span><span class="ident" id="6326639">cw</span><span class="op" id="6326641">.</span><span class="ident" id="6326642">Write</span><span class="op" id="6326647">(</span><span class="ident" id="6326648">buf</span><span class="op" id="6326651">[</span><span class="op" id="6326652">:</span><span class="op" id="6326653">]</span><span class="op" id="6326654">)</span><span class="op" id="6326655">;</span>&nbsp;<span class="ident" id="6326657">err</span>&nbsp;<span class="op" id="6326661">!=</span>&nbsp;<span class="ident" id="6326664">nil</span>&nbsp;<span class="op" id="6326668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326672">return</span>&nbsp;<span class="ident" id="6326679">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326684">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326688">return</span>&nbsp;<span class="ident" id="6326695">w</span><span class="op" id="6326696">.</span><span class="ident" id="6326697">cw</span><span class="op" id="6326699">.</span><span class="ident" id="6326700">w</span><span class="op" id="6326701">.</span><span class="op" id="6326702">(</span><span class="op" id="6326703">*</span><span class="ident" id="6326704">bufio</span><span class="op" id="6326709">.</span><span class="ident" id="6326710">Writer</span><span class="op" id="6326716">)</span><span class="op" id="6326717">.</span><span class="ident" id="6326718">Flush</span><span class="op" id="6326723">(</span><span class="op" id="6326724">)</span><br>
<span class="lineno"></span><span class="op" id="6326726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6326729">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="6326792">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="6326861">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="6326929">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="6326996">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="6327008">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="6327080">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6327123">func</span>&nbsp;<span class="op" id="6327128">(</span><span class="ident" id="6327129">w</span>&nbsp;<span class="op" id="6327131">*</span><span class="ident" id="6327132">Writer</span><span class="op" id="6327138">)</span>&nbsp;<span class="ident" id="6327140">Create</span><span class="op" id="6327146">(</span><span class="ident" id="6327147">name</span>&nbsp;<span class="builtintype" id="6327152">string</span><span class="op" id="6327158">)</span>&nbsp;<span class="op" id="6327160">(</span><span class="ident" id="6327161">io</span><span class="op" id="6327163">.</span><span class="ident" id="6327164">Writer</span><span class="op" id="6327170">,</span>&nbsp;<span class="builtintype" id="6327172">error</span><span class="op" id="6327177">)</span>&nbsp;<span class="op" id="6327179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327182">header</span>&nbsp;<span class="op" id="6327189">:=</span>&nbsp;<span class="op" id="6327192">&amp;</span><span class="ident" id="6327193">FileHeader</span><span class="op" id="6327203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327207">Name</span><span class="op" id="6327211">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6327215">name</span><span class="op" id="6327219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327223">Method</span><span class="op" id="6327229">:</span>&nbsp;<span class="ident" id="6327231">Deflate</span><span class="op" id="6327238">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327244">return</span>&nbsp;<span class="ident" id="6327251">w</span><span class="op" id="6327252">.</span><span class="ident" id="6327253">CreateHeader</span><span class="op" id="6327265">(</span><span class="ident" id="6327266">header</span><span class="op" id="6327272">)</span><br>
<span class="lineno"></span><span class="op" id="6327274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6327277">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="6327351">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="6327377">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="6327446">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="6327518">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6327561">func</span>&nbsp;<span class="op" id="6327566">(</span><span class="ident" id="6327567">w</span>&nbsp;<span class="op" id="6327569">*</span><span class="ident" id="6327570">Writer</span><span class="op" id="6327576">)</span>&nbsp;<span class="ident" id="6327578">CreateHeader</span><span class="op" id="6327590">(</span><span class="ident" id="6327591">fh</span>&nbsp;<span class="op" id="6327594">*</span><span class="ident" id="6327595">FileHeader</span><span class="op" id="6327605">)</span>&nbsp;<span class="op" id="6327607">(</span><span class="ident" id="6327608">io</span><span class="op" id="6327610">.</span><span class="ident" id="6327611">Writer</span><span class="op" id="6327617">,</span>&nbsp;<span class="builtintype" id="6327619">error</span><span class="op" id="6327624">)</span>&nbsp;<span class="op" id="6327626">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327629">if</span>&nbsp;<span class="ident" id="6327632">w</span><span class="op" id="6327633">.</span><span class="ident" id="6327634">last</span>&nbsp;<span class="op" id="6327639">!=</span>&nbsp;<span class="ident" id="6327642">nil</span>&nbsp;<span class="op" id="6327646">&amp;&amp;</span>&nbsp;<span class="op" id="6327649">!</span><span class="ident" id="6327650">w</span><span class="op" id="6327651">.</span><span class="ident" id="6327652">last</span><span class="op" id="6327656">.</span><span class="ident" id="6327657">closed</span>&nbsp;<span class="op" id="6327664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327668">if</span>&nbsp;<span class="ident" id="6327671">err</span>&nbsp;<span class="op" id="6327675">:=</span>&nbsp;<span class="ident" id="6327678">w</span><span class="op" id="6327679">.</span><span class="ident" id="6327680">last</span><span class="op" id="6327684">.</span><span class="builtinfunc" id="6327685">close</span><span class="op" id="6327690">(</span><span class="op" id="6327691">)</span><span class="op" id="6327692">;</span>&nbsp;<span class="ident" id="6327694">err</span>&nbsp;<span class="op" id="6327698">!=</span>&nbsp;<span class="ident" id="6327701">nil</span>&nbsp;<span class="op" id="6327705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327710">return</span>&nbsp;<span class="ident" id="6327717">nil</span><span class="op" id="6327720">,</span>&nbsp;<span class="ident" id="6327722">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327731">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327735">fh</span><span class="op" id="6327737">.</span><span class="ident" id="6327738">Flags</span>&nbsp;<span class="op" id="6327744">|=</span>&nbsp;<span class="num" id="6327747">0x8</span>&nbsp;<span class="comment" id="6327751">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327788">fh</span><span class="op" id="6327790">.</span><span class="ident" id="6327791">CreatorVersion</span>&nbsp;<span class="op" id="6327806">=</span>&nbsp;<span class="ident" id="6327808">fh</span><span class="op" id="6327810">.</span><span class="ident" id="6327811">CreatorVersion</span><span class="op" id="6327825">&amp;</span><span class="num" id="6327826">0xff00</span>&nbsp;<span class="op" id="6327833">|</span>&nbsp;<span class="ident" id="6327835">zipVersion20</span>&nbsp;<span class="comment" id="6327848">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327880">fh</span><span class="op" id="6327882">.</span><span class="ident" id="6327883">ReaderVersion</span>&nbsp;<span class="op" id="6327897">=</span>&nbsp;<span class="ident" id="6327899">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327914">fw</span>&nbsp;<span class="op" id="6327917">:=</span>&nbsp;<span class="op" id="6327920">&amp;</span><span class="ident" id="6327921">fileWriter</span><span class="op" id="6327931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327935">zipw</span><span class="op" id="6327939">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6327946">w</span><span class="op" id="6327947">.</span><span class="ident" id="6327948">cw</span><span class="op" id="6327950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327954">compCount</span><span class="op" id="6327963">:</span>&nbsp;<span class="op" id="6327965">&amp;</span><span class="ident" id="6327966">countWriter</span><span class="op" id="6327977">{</span><span class="ident" id="6327978">w</span><span class="op" id="6327979">:</span>&nbsp;<span class="ident" id="6327981">w</span><span class="op" id="6327982">.</span><span class="ident" id="6327983">cw</span><span class="op" id="6327985">}</span><span class="op" id="6327986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327990">crc32</span><span class="op" id="6327995">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6328001">crc32</span><span class="op" id="6328006">.</span><span class="ident" id="6328007">NewIEEE</span><span class="op" id="6328014">(</span><span class="op" id="6328015">)</span><span class="op" id="6328016">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328022">comp</span>&nbsp;<span class="op" id="6328027">:=</span>&nbsp;<span class="ident" id="6328030">compressor</span><span class="op" id="6328040">(</span><span class="ident" id="6328041">fh</span><span class="op" id="6328043">.</span><span class="ident" id="6328044">Method</span><span class="op" id="6328050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328053">if</span>&nbsp;<span class="ident" id="6328056">comp</span>&nbsp;<span class="op" id="6328061">==</span>&nbsp;<span class="ident" id="6328064">nil</span>&nbsp;<span class="op" id="6328068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328072">return</span>&nbsp;<span class="ident" id="6328079">nil</span><span class="op" id="6328082">,</span>&nbsp;<span class="ident" id="6328084">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328098">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328101">var</span>&nbsp;<span class="ident" id="6328105">err</span>&nbsp;<span class="builtintype" id="6328109">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328116">fw</span><span class="op" id="6328118">.</span><span class="ident" id="6328119">comp</span><span class="op" id="6328123">,</span>&nbsp;<span class="ident" id="6328125">err</span>&nbsp;<span class="op" id="6328129">=</span>&nbsp;<span class="ident" id="6328131">comp</span><span class="op" id="6328135">(</span><span class="ident" id="6328136">fw</span><span class="op" id="6328138">.</span><span class="ident" id="6328139">compCount</span><span class="op" id="6328148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328151">if</span>&nbsp;<span class="ident" id="6328154">err</span>&nbsp;<span class="op" id="6328158">!=</span>&nbsp;<span class="ident" id="6328161">nil</span>&nbsp;<span class="op" id="6328165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328169">return</span>&nbsp;<span class="ident" id="6328176">nil</span><span class="op" id="6328179">,</span>&nbsp;<span class="ident" id="6328181">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328186">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328189">fw</span><span class="op" id="6328191">.</span><span class="ident" id="6328192">rawCount</span>&nbsp;<span class="op" id="6328201">=</span>&nbsp;<span class="op" id="6328203">&amp;</span><span class="ident" id="6328204">countWriter</span><span class="op" id="6328215">{</span><span class="ident" id="6328216">w</span><span class="op" id="6328217">:</span>&nbsp;<span class="ident" id="6328219">fw</span><span class="op" id="6328221">.</span><span class="ident" id="6328222">comp</span><span class="op" id="6328226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328230">h</span>&nbsp;<span class="op" id="6328232">:=</span>&nbsp;<span class="op" id="6328235">&amp;</span><span class="ident" id="6328236">header</span><span class="op" id="6328242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328246">FileHeader</span><span class="op" id="6328256">:</span>&nbsp;<span class="ident" id="6328258">fh</span><span class="op" id="6328260">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328264">offset</span><span class="op" id="6328270">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6328276">uint64</span><span class="op" id="6328282">(</span><span class="ident" id="6328283">w</span><span class="op" id="6328284">.</span><span class="ident" id="6328285">cw</span><span class="op" id="6328287">.</span><span class="ident" id="6328288">count</span><span class="op" id="6328293">)</span><span class="op" id="6328294">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328300">w</span><span class="op" id="6328301">.</span><span class="ident" id="6328302">dir</span>&nbsp;<span class="op" id="6328306">=</span>&nbsp;<span class="builtinfunc" id="6328308">append</span><span class="op" id="6328314">(</span><span class="ident" id="6328315">w</span><span class="op" id="6328316">.</span><span class="ident" id="6328317">dir</span><span class="op" id="6328320">,</span>&nbsp;<span class="ident" id="6328322">h</span><span class="op" id="6328323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328326">fw</span><span class="op" id="6328328">.</span><span class="ident" id="6328329">header</span>&nbsp;<span class="op" id="6328336">=</span>&nbsp;<span class="ident" id="6328338">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328342">if</span>&nbsp;<span class="ident" id="6328345">err</span>&nbsp;<span class="op" id="6328349">:=</span>&nbsp;<span class="ident" id="6328352">writeHeader</span><span class="op" id="6328363">(</span><span class="ident" id="6328364">w</span><span class="op" id="6328365">.</span><span class="ident" id="6328366">cw</span><span class="op" id="6328368">,</span>&nbsp;<span class="ident" id="6328370">fh</span><span class="op" id="6328372">)</span><span class="op" id="6328373">;</span>&nbsp;<span class="ident" id="6328375">err</span>&nbsp;<span class="op" id="6328379">!=</span>&nbsp;<span class="ident" id="6328382">nil</span>&nbsp;<span class="op" id="6328386">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328390">return</span>&nbsp;<span class="ident" id="6328397">nil</span><span class="op" id="6328400">,</span>&nbsp;<span class="ident" id="6328402">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328411">w</span><span class="op" id="6328412">.</span><span class="ident" id="6328413">last</span>&nbsp;<span class="op" id="6328418">=</span>&nbsp;<span class="ident" id="6328420">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328424">return</span>&nbsp;<span class="ident" id="6328431">fw</span><span class="op" id="6328433">,</span>&nbsp;<span class="ident" id="6328435">nil</span><br>
<span class="lineno">230</span><span class="op" id="6328439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6328442">func</span>&nbsp;<span class="ident" id="6328447">writeHeader</span><span class="op" id="6328458">(</span><span class="ident" id="6328459">w</span>&nbsp;<span class="ident" id="6328461">io</span><span class="op" id="6328463">.</span><span class="ident" id="6328464">Writer</span><span class="op" id="6328470">,</span>&nbsp;<span class="ident" id="6328472">h</span>&nbsp;<span class="op" id="6328474">*</span><span class="ident" id="6328475">FileHeader</span><span class="op" id="6328485">)</span>&nbsp;<span class="builtintype" id="6328487">error</span>&nbsp;<span class="op" id="6328493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328496">var</span>&nbsp;<span class="ident" id="6328500">buf</span>&nbsp;<span class="op" id="6328504">[</span><span class="ident" id="6328505">fileHeaderLen</span><span class="op" id="6328518">]</span><span class="builtintype" id="6328519">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328525">b</span>&nbsp;<span class="op" id="6328527">:=</span>&nbsp;<span class="ident" id="6328530">writeBuf</span><span class="op" id="6328538">(</span><span class="ident" id="6328539">buf</span><span class="op" id="6328542">[</span><span class="op" id="6328543">:</span><span class="op" id="6328544">]</span><span class="op" id="6328545">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328548">b</span><span class="op" id="6328549">.</span><span class="builtintype" id="6328550">uint32</span><span class="op" id="6328556">(</span><span class="builtintype" id="6328557">uint32</span><span class="op" id="6328563">(</span><span class="ident" id="6328564">fileHeaderSignature</span><span class="op" id="6328583">)</span><span class="op" id="6328584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328587">b</span><span class="op" id="6328588">.</span><span class="builtintype" id="6328589">uint16</span><span class="op" id="6328595">(</span><span class="ident" id="6328596">h</span><span class="op" id="6328597">.</span><span class="ident" id="6328598">ReaderVersion</span><span class="op" id="6328611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328614">b</span><span class="op" id="6328615">.</span><span class="builtintype" id="6328616">uint16</span><span class="op" id="6328622">(</span><span class="ident" id="6328623">h</span><span class="op" id="6328624">.</span><span class="ident" id="6328625">Flags</span><span class="op" id="6328630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328633">b</span><span class="op" id="6328634">.</span><span class="builtintype" id="6328635">uint16</span><span class="op" id="6328641">(</span><span class="ident" id="6328642">h</span><span class="op" id="6328643">.</span><span class="ident" id="6328644">Method</span><span class="op" id="6328650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328653">b</span><span class="op" id="6328654">.</span><span class="builtintype" id="6328655">uint16</span><span class="op" id="6328661">(</span><span class="ident" id="6328662">h</span><span class="op" id="6328663">.</span><span class="ident" id="6328664">ModifiedTime</span><span class="op" id="6328676">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328679">b</span><span class="op" id="6328680">.</span><span class="builtintype" id="6328681">uint16</span><span class="op" id="6328687">(</span><span class="ident" id="6328688">h</span><span class="op" id="6328689">.</span><span class="ident" id="6328690">ModifiedDate</span><span class="op" id="6328702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328705">b</span><span class="op" id="6328706">.</span><span class="builtintype" id="6328707">uint32</span><span class="op" id="6328713">(</span><span class="num" id="6328714">0</span><span class="op" id="6328715">)</span>&nbsp;<span class="comment" id="6328717">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328767">b</span><span class="op" id="6328768">.</span><span class="builtintype" id="6328769">uint32</span><span class="op" id="6328775">(</span><span class="num" id="6328776">0</span><span class="op" id="6328777">)</span>&nbsp;<span class="comment" id="6328779">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328800">b</span><span class="op" id="6328801">.</span><span class="builtintype" id="6328802">uint32</span><span class="op" id="6328808">(</span><span class="num" id="6328809">0</span><span class="op" id="6328810">)</span>&nbsp;<span class="comment" id="6328812">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328853">b</span><span class="op" id="6328854">.</span><span class="builtintype" id="6328855">uint16</span><span class="op" id="6328861">(</span><span class="builtintype" id="6328862">uint16</span><span class="op" id="6328868">(</span><span class="builtinfunc" id="6328869">len</span><span class="op" id="6328872">(</span><span class="ident" id="6328873">h</span><span class="op" id="6328874">.</span><span class="ident" id="6328875">Name</span><span class="op" id="6328879">)</span><span class="op" id="6328880">)</span><span class="op" id="6328881">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328884">b</span><span class="op" id="6328885">.</span><span class="builtintype" id="6328886">uint16</span><span class="op" id="6328892">(</span><span class="builtintype" id="6328893">uint16</span><span class="op" id="6328899">(</span><span class="builtinfunc" id="6328900">len</span><span class="op" id="6328903">(</span><span class="ident" id="6328904">h</span><span class="op" id="6328905">.</span><span class="ident" id="6328906">Extra</span><span class="op" id="6328911">)</span><span class="op" id="6328912">)</span><span class="op" id="6328913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328916">if</span>&nbsp;<span class="ident" id="6328919">_</span><span class="op" id="6328920">,</span>&nbsp;<span class="ident" id="6328922">err</span>&nbsp;<span class="op" id="6328926">:=</span>&nbsp;<span class="ident" id="6328929">w</span><span class="op" id="6328930">.</span><span class="ident" id="6328931">Write</span><span class="op" id="6328936">(</span><span class="ident" id="6328937">buf</span><span class="op" id="6328940">[</span><span class="op" id="6328941">:</span><span class="op" id="6328942">]</span><span class="op" id="6328943">)</span><span class="op" id="6328944">;</span>&nbsp;<span class="ident" id="6328946">err</span>&nbsp;<span class="op" id="6328950">!=</span>&nbsp;<span class="ident" id="6328953">nil</span>&nbsp;<span class="op" id="6328957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328961">return</span>&nbsp;<span class="ident" id="6328968">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328976">if</span>&nbsp;<span class="ident" id="6328979">_</span><span class="op" id="6328980">,</span>&nbsp;<span class="ident" id="6328982">err</span>&nbsp;<span class="op" id="6328986">:=</span>&nbsp;<span class="ident" id="6328989">io</span><span class="op" id="6328991">.</span><span class="ident" id="6328992">WriteString</span><span class="op" id="6329003">(</span><span class="ident" id="6329004">w</span><span class="op" id="6329005">,</span>&nbsp;<span class="ident" id="6329007">h</span><span class="op" id="6329008">.</span><span class="ident" id="6329009">Name</span><span class="op" id="6329013">)</span><span class="op" id="6329014">;</span>&nbsp;<span class="ident" id="6329016">err</span>&nbsp;<span class="op" id="6329020">!=</span>&nbsp;<span class="ident" id="6329023">nil</span>&nbsp;<span class="op" id="6329027">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329031">return</span>&nbsp;<span class="ident" id="6329038">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329046">_</span><span class="op" id="6329047">,</span>&nbsp;<span class="ident" id="6329049">err</span>&nbsp;<span class="op" id="6329053">:=</span>&nbsp;<span class="ident" id="6329056">w</span><span class="op" id="6329057">.</span><span class="ident" id="6329058">Write</span><span class="op" id="6329063">(</span><span class="ident" id="6329064">h</span><span class="op" id="6329065">.</span><span class="ident" id="6329066">Extra</span><span class="op" id="6329071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329074">return</span>&nbsp;<span class="ident" id="6329081">err</span><br>
<span class="lineno"></span><span class="op" id="6329085">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6329088">type</span>&nbsp;<span class="ident" id="6329093">fileWriter</span>&nbsp;<span class="keyword" id="6329104">struct</span>&nbsp;<span class="op" id="6329111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329114">*</span><span class="ident" id="6329115">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329123">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329133">io</span><span class="op" id="6329135">.</span><span class="ident" id="6329136">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329144">rawCount</span>&nbsp;&nbsp;<span class="op" id="6329154">*</span><span class="ident" id="6329155">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329168">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329178">io</span><span class="op" id="6329180">.</span><span class="ident" id="6329181">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329194">compCount</span>&nbsp;<span class="op" id="6329204">*</span><span class="ident" id="6329205">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329218">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329228">hash</span><span class="op" id="6329232">.</span><span class="ident" id="6329233">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329241">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6329251">bool</span><br>
<span class="lineno"></span><span class="op" id="6329256">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="6329259">func</span>&nbsp;<span class="op" id="6329264">(</span><span class="ident" id="6329265">w</span>&nbsp;<span class="op" id="6329267">*</span><span class="ident" id="6329268">fileWriter</span><span class="op" id="6329278">)</span>&nbsp;<span class="ident" id="6329280">Write</span><span class="op" id="6329285">(</span><span class="ident" id="6329286">p</span>&nbsp;<span class="op" id="6329288">[</span><span class="op" id="6329289">]</span><span class="builtintype" id="6329290">byte</span><span class="op" id="6329294">)</span>&nbsp;<span class="op" id="6329296">(</span><span class="builtintype" id="6329297">int</span><span class="op" id="6329300">,</span>&nbsp;<span class="builtintype" id="6329302">error</span><span class="op" id="6329307">)</span>&nbsp;<span class="op" id="6329309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329312">if</span>&nbsp;<span class="ident" id="6329315">w</span><span class="op" id="6329316">.</span><span class="ident" id="6329317">closed</span>&nbsp;<span class="op" id="6329324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329328">return</span>&nbsp;<span class="num" id="6329335">0</span><span class="op" id="6329336">,</span>&nbsp;<span class="ident" id="6329338">errors</span><span class="op" id="6329344">.</span><span class="ident" id="6329345">New</span><span class="op" id="6329348">(</span><span class="string" id="6329349">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="6329376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329379">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329382">w</span><span class="op" id="6329383">.</span><span class="ident" id="6329384">crc32</span><span class="op" id="6329389">.</span><span class="ident" id="6329390">Write</span><span class="op" id="6329395">(</span><span class="ident" id="6329396">p</span><span class="op" id="6329397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329400">return</span>&nbsp;<span class="ident" id="6329407">w</span><span class="op" id="6329408">.</span><span class="ident" id="6329409">rawCount</span><span class="op" id="6329417">.</span><span class="ident" id="6329418">Write</span><span class="op" id="6329423">(</span><span class="ident" id="6329424">p</span><span class="op" id="6329425">)</span><br>
<span class="lineno"></span><span class="op" id="6329427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6329430">func</span>&nbsp;<span class="op" id="6329435">(</span><span class="ident" id="6329436">w</span>&nbsp;<span class="op" id="6329438">*</span><span class="ident" id="6329439">fileWriter</span><span class="op" id="6329449">)</span>&nbsp;<span class="builtinfunc" id="6329451">close</span><span class="op" id="6329456">(</span><span class="op" id="6329457">)</span>&nbsp;<span class="builtintype" id="6329459">error</span>&nbsp;<span class="op" id="6329465">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329468">if</span>&nbsp;<span class="ident" id="6329471">w</span><span class="op" id="6329472">.</span><span class="ident" id="6329473">closed</span>&nbsp;<span class="op" id="6329480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329484">return</span>&nbsp;<span class="ident" id="6329491">errors</span><span class="op" id="6329497">.</span><span class="ident" id="6329498">New</span><span class="op" id="6329501">(</span><span class="string" id="6329502">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="6329526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329532">w</span><span class="op" id="6329533">.</span><span class="ident" id="6329534">closed</span>&nbsp;<span class="op" id="6329541">=</span>&nbsp;<span class="builtintype" id="6329543">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329549">if</span>&nbsp;<span class="ident" id="6329552">err</span>&nbsp;<span class="op" id="6329556">:=</span>&nbsp;<span class="ident" id="6329559">w</span><span class="op" id="6329560">.</span><span class="ident" id="6329561">comp</span><span class="op" id="6329565">.</span><span class="ident" id="6329566">Close</span><span class="op" id="6329571">(</span><span class="op" id="6329572">)</span><span class="op" id="6329573">;</span>&nbsp;<span class="ident" id="6329575">err</span>&nbsp;<span class="op" id="6329579">!=</span>&nbsp;<span class="ident" id="6329582">nil</span>&nbsp;<span class="op" id="6329586">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329590">return</span>&nbsp;<span class="ident" id="6329597">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329606">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329628">fh</span>&nbsp;<span class="op" id="6329631">:=</span>&nbsp;<span class="ident" id="6329634">w</span><span class="op" id="6329635">.</span><span class="ident" id="6329636">header</span><span class="op" id="6329642">.</span><span class="ident" id="6329643">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329655">fh</span><span class="op" id="6329657">.</span><span class="ident" id="6329658">CRC32</span>&nbsp;<span class="op" id="6329664">=</span>&nbsp;<span class="ident" id="6329666">w</span><span class="op" id="6329667">.</span><span class="ident" id="6329668">crc32</span><span class="op" id="6329673">.</span><span class="ident" id="6329674">Sum32</span><span class="op" id="6329679">(</span><span class="op" id="6329680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329683">fh</span><span class="op" id="6329685">.</span><span class="ident" id="6329686">CompressedSize64</span>&nbsp;<span class="op" id="6329703">=</span>&nbsp;<span class="ident" id="6329705">uint64</span><span class="op" id="6329711">(</span><span class="ident" id="6329712">w</span><span class="op" id="6329713">.</span><span class="ident" id="6329714">compCount</span><span class="op" id="6329723">.</span><span class="ident" id="6329724">count</span><span class="op" id="6329729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329732">fh</span><span class="op" id="6329734">.</span><span class="ident" id="6329735">UncompressedSize64</span>&nbsp;<span class="op" id="6329754">=</span>&nbsp;<span class="ident" id="6329756">uint64</span><span class="op" id="6329762">(</span><span class="ident" id="6329763">w</span><span class="op" id="6329764">.</span><span class="ident" id="6329765">rawCount</span><span class="op" id="6329773">.</span><span class="ident" id="6329774">count</span><span class="op" id="6329779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329783">if</span>&nbsp;<span class="ident" id="6329786">fh</span><span class="op" id="6329788">.</span><span class="ident" id="6329789">isZip64</span><span class="op" id="6329796">(</span><span class="op" id="6329797">)</span>&nbsp;<span class="op" id="6329799">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329803">fh</span><span class="op" id="6329805">.</span><span class="ident" id="6329806">CompressedSize</span>&nbsp;<span class="op" id="6329821">=</span>&nbsp;<span class="ident" id="6329823">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329835">fh</span><span class="op" id="6329837">.</span><span class="ident" id="6329838">UncompressedSize</span>&nbsp;<span class="op" id="6329855">=</span>&nbsp;<span class="ident" id="6329857">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329869">fh</span><span class="op" id="6329871">.</span><span class="ident" id="6329872">ReaderVersion</span>&nbsp;<span class="op" id="6329886">=</span>&nbsp;<span class="ident" id="6329888">zipVersion45</span>&nbsp;<span class="comment" id="6329901">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329954">}</span>&nbsp;<span class="keyword" id="6329956">else</span>&nbsp;<span class="op" id="6329961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329965">fh</span><span class="op" id="6329967">.</span><span class="ident" id="6329968">CompressedSize</span>&nbsp;<span class="op" id="6329983">=</span>&nbsp;<span class="builtintype" id="6329985">uint32</span><span class="op" id="6329991">(</span><span class="ident" id="6329992">fh</span><span class="op" id="6329994">.</span><span class="ident" id="6329995">CompressedSize64</span><span class="op" id="6330011">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330015">fh</span><span class="op" id="6330017">.</span><span class="ident" id="6330018">UncompressedSize</span>&nbsp;<span class="op" id="6330035">=</span>&nbsp;<span class="builtintype" id="6330037">uint32</span><span class="op" id="6330043">(</span><span class="ident" id="6330044">fh</span><span class="op" id="6330046">.</span><span class="ident" id="6330047">UncompressedSize64</span><span class="op" id="6330065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330072">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330139">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330199">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330263">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330328">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330392">var</span>&nbsp;<span class="ident" id="6330396">buf</span>&nbsp;<span class="op" id="6330400">[</span><span class="op" id="6330401">]</span><span class="builtintype" id="6330402">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330408">if</span>&nbsp;<span class="ident" id="6330411">fh</span><span class="op" id="6330413">.</span><span class="ident" id="6330414">isZip64</span><span class="op" id="6330421">(</span><span class="op" id="6330422">)</span>&nbsp;<span class="op" id="6330424">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330428">buf</span>&nbsp;<span class="op" id="6330432">=</span>&nbsp;<span class="builtinfunc" id="6330434">make</span><span class="op" id="6330438">(</span><span class="op" id="6330439">[</span><span class="op" id="6330440">]</span><span class="builtintype" id="6330441">byte</span><span class="op" id="6330445">,</span>&nbsp;<span class="ident" id="6330447">dataDescriptor64Len</span><span class="op" id="6330466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330469">}</span>&nbsp;<span class="keyword" id="6330471">else</span>&nbsp;<span class="op" id="6330476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330480">buf</span>&nbsp;<span class="op" id="6330484">=</span>&nbsp;<span class="builtinfunc" id="6330486">make</span><span class="op" id="6330490">(</span><span class="op" id="6330491">[</span><span class="op" id="6330492">]</span><span class="builtintype" id="6330493">byte</span><span class="op" id="6330497">,</span>&nbsp;<span class="ident" id="6330499">dataDescriptorLen</span><span class="op" id="6330516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330522">b</span>&nbsp;<span class="op" id="6330524">:=</span>&nbsp;<span class="ident" id="6330527">writeBuf</span><span class="op" id="6330535">(</span><span class="ident" id="6330536">buf</span><span class="op" id="6330539">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330542">b</span><span class="op" id="6330543">.</span><span class="builtintype" id="6330544">uint32</span><span class="op" id="6330550">(</span><span class="ident" id="6330551">dataDescriptorSignature</span><span class="op" id="6330574">)</span>&nbsp;<span class="comment" id="6330576">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330616">b</span><span class="op" id="6330617">.</span><span class="builtintype" id="6330618">uint32</span><span class="op" id="6330624">(</span><span class="ident" id="6330625">fh</span><span class="op" id="6330627">.</span><span class="ident" id="6330628">CRC32</span><span class="op" id="6330633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330636">if</span>&nbsp;<span class="ident" id="6330639">fh</span><span class="op" id="6330641">.</span><span class="ident" id="6330642">isZip64</span><span class="op" id="6330649">(</span><span class="op" id="6330650">)</span>&nbsp;<span class="op" id="6330652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330656">b</span><span class="op" id="6330657">.</span><span class="ident" id="6330658">uint64</span><span class="op" id="6330664">(</span><span class="ident" id="6330665">fh</span><span class="op" id="6330667">.</span><span class="ident" id="6330668">CompressedSize64</span><span class="op" id="6330684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330688">b</span><span class="op" id="6330689">.</span><span class="ident" id="6330690">uint64</span><span class="op" id="6330696">(</span><span class="ident" id="6330697">fh</span><span class="op" id="6330699">.</span><span class="ident" id="6330700">UncompressedSize64</span><span class="op" id="6330718">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330721">}</span>&nbsp;<span class="keyword" id="6330723">else</span>&nbsp;<span class="op" id="6330728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330732">b</span><span class="op" id="6330733">.</span><span class="builtintype" id="6330734">uint32</span><span class="op" id="6330740">(</span><span class="ident" id="6330741">fh</span><span class="op" id="6330743">.</span><span class="ident" id="6330744">CompressedSize</span><span class="op" id="6330758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330762">b</span><span class="op" id="6330763">.</span><span class="builtintype" id="6330764">uint32</span><span class="op" id="6330770">(</span><span class="ident" id="6330771">fh</span><span class="op" id="6330773">.</span><span class="ident" id="6330774">UncompressedSize</span><span class="op" id="6330790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330796">_</span><span class="op" id="6330797">,</span>&nbsp;<span class="ident" id="6330799">err</span>&nbsp;<span class="op" id="6330803">:=</span>&nbsp;<span class="ident" id="6330806">w</span><span class="op" id="6330807">.</span><span class="ident" id="6330808">zipw</span><span class="op" id="6330812">.</span><span class="ident" id="6330813">Write</span><span class="op" id="6330818">(</span><span class="ident" id="6330819">buf</span><span class="op" id="6330822">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330825">return</span>&nbsp;<span class="ident" id="6330832">err</span><br>
<span class="lineno"></span><span class="op" id="6330836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6330839">type</span>&nbsp;<span class="ident" id="6330844">countWriter</span>&nbsp;<span class="keyword" id="6330856">struct</span>&nbsp;<span class="op" id="6330863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330866">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330872">io</span><span class="op" id="6330874">.</span><span class="ident" id="6330875">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330883">count</span>&nbsp;<span class="ident" id="6330889">int64</span><br>
<span class="lineno"></span><span class="op" id="6330895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6330898">func</span>&nbsp;<span class="op" id="6330903">(</span><span class="ident" id="6330904">w</span>&nbsp;<span class="op" id="6330906">*</span><span class="ident" id="6330907">countWriter</span><span class="op" id="6330918">)</span>&nbsp;<span class="ident" id="6330920">Write</span><span class="op" id="6330925">(</span><span class="ident" id="6330926">p</span>&nbsp;<span class="op" id="6330928">[</span><span class="op" id="6330929">]</span><span class="builtintype" id="6330930">byte</span><span class="op" id="6330934">)</span>&nbsp;<span class="op" id="6330936">(</span><span class="builtintype" id="6330937">int</span><span class="op" id="6330940">,</span>&nbsp;<span class="builtintype" id="6330942">error</span><span class="op" id="6330947">)</span>&nbsp;<span class="op" id="6330949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330952">n</span><span class="op" id="6330953">,</span>&nbsp;<span class="ident" id="6330955">err</span>&nbsp;<span class="op" id="6330959">:=</span>&nbsp;<span class="ident" id="6330962">w</span><span class="op" id="6330963">.</span><span class="ident" id="6330964">w</span><span class="op" id="6330965">.</span><span class="ident" id="6330966">Write</span><span class="op" id="6330971">(</span><span class="ident" id="6330972">p</span><span class="op" id="6330973">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330976">w</span><span class="op" id="6330977">.</span><span class="ident" id="6330978">count</span>&nbsp;<span class="op" id="6330984">+=</span>&nbsp;<span class="ident" id="6330987">int64</span><span class="op" id="6330992">(</span><span class="ident" id="6330993">n</span><span class="op" id="6330994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330997">return</span>&nbsp;<span class="ident" id="6331004">n</span><span class="op" id="6331005">,</span>&nbsp;<span class="ident" id="6331007">err</span><br>
<span class="lineno"></span><span class="op" id="6331011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6331014">type</span>&nbsp;<span class="ident" id="6331019">nopCloser</span>&nbsp;<span class="keyword" id="6331029">struct</span>&nbsp;<span class="op" id="6331036">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331039">io</span><span class="op" id="6331041">.</span><span class="ident" id="6331042">Writer</span><br>
<span class="lineno"></span><span class="op" id="6331049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6331052">func</span>&nbsp;<span class="op" id="6331057">(</span><span class="ident" id="6331058">w</span>&nbsp;<span class="ident" id="6331060">nopCloser</span><span class="op" id="6331069">)</span>&nbsp;<span class="ident" id="6331071">Close</span><span class="op" id="6331076">(</span><span class="op" id="6331077">)</span>&nbsp;<span class="builtintype" id="6331079">error</span>&nbsp;<span class="op" id="6331085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331088">return</span>&nbsp;<span class="ident" id="6331095">nil</span><br>
<span class="lineno">340</span><span class="op" id="6331099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6331102">type</span>&nbsp;<span class="ident" id="6331107">writeBuf</span>&nbsp;<span class="op" id="6331116">[</span><span class="op" id="6331117">]</span><span class="builtintype" id="6331118">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6331124">func</span>&nbsp;<span class="op" id="6331129">(</span><span class="ident" id="6331130">b</span>&nbsp;<span class="op" id="6331132">*</span><span class="ident" id="6331133">writeBuf</span><span class="op" id="6331141">)</span>&nbsp;<span class="builtintype" id="6331143">uint16</span><span class="op" id="6331149">(</span><span class="ident" id="6331150">v</span>&nbsp;<span class="builtintype" id="6331152">uint16</span><span class="op" id="6331158">)</span>&nbsp;<span class="op" id="6331160">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331163">binary</span><span class="op" id="6331169">.</span><span class="ident" id="6331170">LittleEndian</span><span class="op" id="6331182">.</span><span class="ident" id="6331183">PutUint16</span><span class="op" id="6331192">(</span><span class="op" id="6331193">*</span><span class="ident" id="6331194">b</span><span class="op" id="6331195">,</span>&nbsp;<span class="ident" id="6331197">v</span><span class="op" id="6331198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331201">*</span><span class="ident" id="6331202">b</span>&nbsp;<span class="op" id="6331204">=</span>&nbsp;<span class="op" id="6331206">(</span><span class="op" id="6331207">*</span><span class="ident" id="6331208">b</span><span class="op" id="6331209">)</span><span class="op" id="6331210">[</span><span class="num" id="6331211">2</span><span class="op" id="6331212">:</span><span class="op" id="6331213">]</span><br>
<span class="lineno"></span><span class="op" id="6331215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6331218">func</span>&nbsp;<span class="op" id="6331223">(</span><span class="ident" id="6331224">b</span>&nbsp;<span class="op" id="6331226">*</span><span class="ident" id="6331227">writeBuf</span><span class="op" id="6331235">)</span>&nbsp;<span class="builtintype" id="6331237">uint32</span><span class="op" id="6331243">(</span><span class="ident" id="6331244">v</span>&nbsp;<span class="builtintype" id="6331246">uint32</span><span class="op" id="6331252">)</span>&nbsp;<span class="op" id="6331254">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331257">binary</span><span class="op" id="6331263">.</span><span class="ident" id="6331264">LittleEndian</span><span class="op" id="6331276">.</span><span class="ident" id="6331277">PutUint32</span><span class="op" id="6331286">(</span><span class="op" id="6331287">*</span><span class="ident" id="6331288">b</span><span class="op" id="6331289">,</span>&nbsp;<span class="ident" id="6331291">v</span><span class="op" id="6331292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331295">*</span><span class="ident" id="6331296">b</span>&nbsp;<span class="op" id="6331298">=</span>&nbsp;<span class="op" id="6331300">(</span><span class="op" id="6331301">*</span><span class="ident" id="6331302">b</span><span class="op" id="6331303">)</span><span class="op" id="6331304">[</span><span class="num" id="6331305">4</span><span class="op" id="6331306">:</span><span class="op" id="6331307">]</span><br>
<span class="lineno"></span><span class="op" id="6331309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6331312">func</span>&nbsp;<span class="op" id="6331317">(</span><span class="ident" id="6331318">b</span>&nbsp;<span class="op" id="6331320">*</span><span class="ident" id="6331321">writeBuf</span><span class="op" id="6331329">)</span>&nbsp;<span class="ident" id="6331331">uint64</span><span class="op" id="6331337">(</span><span class="ident" id="6331338">v</span>&nbsp;<span class="ident" id="6331340">uint64</span><span class="op" id="6331346">)</span>&nbsp;<span class="op" id="6331348">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331351">binary</span><span class="op" id="6331357">.</span><span class="ident" id="6331358">LittleEndian</span><span class="op" id="6331370">.</span><span class="ident" id="6331371">PutUint64</span><span class="op" id="6331380">(</span><span class="op" id="6331381">*</span><span class="ident" id="6331382">b</span><span class="op" id="6331383">,</span>&nbsp;<span class="ident" id="6331385">v</span><span class="op" id="6331386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331389">*</span><span class="ident" id="6331390">b</span>&nbsp;<span class="op" id="6331392">=</span>&nbsp;<span class="op" id="6331394">(</span><span class="op" id="6331395">*</span><span class="ident" id="6331396">b</span><span class="op" id="6331397">)</span><span class="op" id="6331398">[</span><span class="num" id="6331399">8</span><span class="op" id="6331400">:</span><span class="op" id="6331401">]</span><br>
<span class="lineno"></span><span class="op" id="6331403">}</span>
</div>
</body>
</html>
