<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html" class="current">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7151508">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7151563">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7151617">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7151668">package</span>&nbsp;<span class="ident" id="7151676">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7151683">import</span>&nbsp;<span class="op" id="7151690">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7151693">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7151702">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7151709">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7151715">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7151728">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7151739">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7151747">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7151757">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7151760">type</span>&nbsp;<span class="ident" id="7151765">deflateTest</span>&nbsp;<span class="keyword" id="7151777">struct</span>&nbsp;<span class="op" id="7151784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151787">in</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7151793">[</span><span class="op" id="7151794">]</span><span class="builtintype" id="7151795">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151801">level</span>&nbsp;<span class="builtintype" id="7151807">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151812">out</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7151818">[</span><span class="op" id="7151819">]</span><span class="builtintype" id="7151820">byte</span><br>
<span class="lineno"></span><span class="op" id="7151825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7151828">type</span>&nbsp;<span class="ident" id="7151833">deflateInflateTest</span>&nbsp;<span class="keyword" id="7151852">struct</span>&nbsp;<span class="op" id="7151859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151862">in</span>&nbsp;<span class="op" id="7151865">[</span><span class="op" id="7151866">]</span><span class="builtintype" id="7151867">byte</span><br>
<span class="lineno">25</span><span class="op" id="7151872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7151875">type</span>&nbsp;<span class="ident" id="7151880">reverseBitsTest</span>&nbsp;<span class="keyword" id="7151896">struct</span>&nbsp;<span class="op" id="7151903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151906">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7151915">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151923">bitCount</span>&nbsp;<span class="builtintype" id="7151932">uint8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151939">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7151948">uint16</span><br>
<span class="lineno"></span><span class="op" id="7151955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7151958">var</span>&nbsp;<span class="ident" id="7151962">deflateTests</span>&nbsp;<span class="op" id="7151975">=</span>&nbsp;<span class="op" id="7151977">[</span><span class="op" id="7151978">]</span><span class="op" id="7151979">*</span><span class="ident" id="7151980">deflateTest</span><span class="op" id="7151991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7151994">{</span><span class="op" id="7151995">[</span><span class="op" id="7151996">]</span><span class="builtintype" id="7151997">byte</span><span class="op" id="7152001">{</span><span class="op" id="7152002">}</span><span class="op" id="7152003">,</span>&nbsp;<span class="num" id="7152005">0</span><span class="op" id="7152006">,</span>&nbsp;<span class="op" id="7152008">[</span><span class="op" id="7152009">]</span><span class="builtintype" id="7152010">byte</span><span class="op" id="7152014">{</span><span class="num" id="7152015">1</span><span class="op" id="7152016">,</span>&nbsp;<span class="num" id="7152018">0</span><span class="op" id="7152019">,</span>&nbsp;<span class="num" id="7152021">0</span><span class="op" id="7152022">,</span>&nbsp;<span class="num" id="7152024">255</span><span class="op" id="7152027">,</span>&nbsp;<span class="num" id="7152029">255</span><span class="op" id="7152032">}</span><span class="op" id="7152033">}</span><span class="op" id="7152034">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152037">{</span><span class="op" id="7152038">[</span><span class="op" id="7152039">]</span><span class="builtintype" id="7152040">byte</span><span class="op" id="7152044">{</span><span class="num" id="7152045">0x11</span><span class="op" id="7152049">}</span><span class="op" id="7152050">,</span>&nbsp;<span class="op" id="7152052">-</span><span class="num" id="7152053">1</span><span class="op" id="7152054">,</span>&nbsp;<span class="op" id="7152056">[</span><span class="op" id="7152057">]</span><span class="builtintype" id="7152058">byte</span><span class="op" id="7152062">{</span><span class="num" id="7152063">18</span><span class="op" id="7152065">,</span>&nbsp;<span class="num" id="7152067">4</span><span class="op" id="7152068">,</span>&nbsp;<span class="num" id="7152070">4</span><span class="op" id="7152071">,</span>&nbsp;<span class="num" id="7152073">0</span><span class="op" id="7152074">,</span>&nbsp;<span class="num" id="7152076">0</span><span class="op" id="7152077">,</span>&nbsp;<span class="num" id="7152079">255</span><span class="op" id="7152082">,</span>&nbsp;<span class="num" id="7152084">255</span><span class="op" id="7152087">}</span><span class="op" id="7152088">}</span><span class="op" id="7152089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152092">{</span><span class="op" id="7152093">[</span><span class="op" id="7152094">]</span><span class="builtintype" id="7152095">byte</span><span class="op" id="7152099">{</span><span class="num" id="7152100">0x11</span><span class="op" id="7152104">}</span><span class="op" id="7152105">,</span>&nbsp;<span class="ident" id="7152107">DefaultCompression</span><span class="op" id="7152125">,</span>&nbsp;<span class="op" id="7152127">[</span><span class="op" id="7152128">]</span><span class="builtintype" id="7152129">byte</span><span class="op" id="7152133">{</span><span class="num" id="7152134">18</span><span class="op" id="7152136">,</span>&nbsp;<span class="num" id="7152138">4</span><span class="op" id="7152139">,</span>&nbsp;<span class="num" id="7152141">4</span><span class="op" id="7152142">,</span>&nbsp;<span class="num" id="7152144">0</span><span class="op" id="7152145">,</span>&nbsp;<span class="num" id="7152147">0</span><span class="op" id="7152148">,</span>&nbsp;<span class="num" id="7152150">255</span><span class="op" id="7152153">,</span>&nbsp;<span class="num" id="7152155">255</span><span class="op" id="7152158">}</span><span class="op" id="7152159">}</span><span class="op" id="7152160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152163">{</span><span class="op" id="7152164">[</span><span class="op" id="7152165">]</span><span class="builtintype" id="7152166">byte</span><span class="op" id="7152170">{</span><span class="num" id="7152171">0x11</span><span class="op" id="7152175">}</span><span class="op" id="7152176">,</span>&nbsp;<span class="num" id="7152178">4</span><span class="op" id="7152179">,</span>&nbsp;<span class="op" id="7152181">[</span><span class="op" id="7152182">]</span><span class="builtintype" id="7152183">byte</span><span class="op" id="7152187">{</span><span class="num" id="7152188">18</span><span class="op" id="7152190">,</span>&nbsp;<span class="num" id="7152192">4</span><span class="op" id="7152193">,</span>&nbsp;<span class="num" id="7152195">4</span><span class="op" id="7152196">,</span>&nbsp;<span class="num" id="7152198">0</span><span class="op" id="7152199">,</span>&nbsp;<span class="num" id="7152201">0</span><span class="op" id="7152202">,</span>&nbsp;<span class="num" id="7152204">255</span><span class="op" id="7152207">,</span>&nbsp;<span class="num" id="7152209">255</span><span class="op" id="7152212">}</span><span class="op" id="7152213">}</span><span class="op" id="7152214">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152218">{</span><span class="op" id="7152219">[</span><span class="op" id="7152220">]</span><span class="builtintype" id="7152221">byte</span><span class="op" id="7152225">{</span><span class="num" id="7152226">0x11</span><span class="op" id="7152230">}</span><span class="op" id="7152231">,</span>&nbsp;<span class="num" id="7152233">0</span><span class="op" id="7152234">,</span>&nbsp;<span class="op" id="7152236">[</span><span class="op" id="7152237">]</span><span class="builtintype" id="7152238">byte</span><span class="op" id="7152242">{</span><span class="num" id="7152243">0</span><span class="op" id="7152244">,</span>&nbsp;<span class="num" id="7152246">1</span><span class="op" id="7152247">,</span>&nbsp;<span class="num" id="7152249">0</span><span class="op" id="7152250">,</span>&nbsp;<span class="num" id="7152252">254</span><span class="op" id="7152255">,</span>&nbsp;<span class="num" id="7152257">255</span><span class="op" id="7152260">,</span>&nbsp;<span class="num" id="7152262">17</span><span class="op" id="7152264">,</span>&nbsp;<span class="num" id="7152266">1</span><span class="op" id="7152267">,</span>&nbsp;<span class="num" id="7152269">0</span><span class="op" id="7152270">,</span>&nbsp;<span class="num" id="7152272">0</span><span class="op" id="7152273">,</span>&nbsp;<span class="num" id="7152275">255</span><span class="op" id="7152278">,</span>&nbsp;<span class="num" id="7152280">255</span><span class="op" id="7152283">}</span><span class="op" id="7152284">}</span><span class="op" id="7152285">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152288">{</span><span class="op" id="7152289">[</span><span class="op" id="7152290">]</span><span class="builtintype" id="7152291">byte</span><span class="op" id="7152295">{</span><span class="num" id="7152296">0x11</span><span class="op" id="7152300">,</span>&nbsp;<span class="num" id="7152302">0x12</span><span class="op" id="7152306">}</span><span class="op" id="7152307">,</span>&nbsp;<span class="num" id="7152309">0</span><span class="op" id="7152310">,</span>&nbsp;<span class="op" id="7152312">[</span><span class="op" id="7152313">]</span><span class="builtintype" id="7152314">byte</span><span class="op" id="7152318">{</span><span class="num" id="7152319">0</span><span class="op" id="7152320">,</span>&nbsp;<span class="num" id="7152322">2</span><span class="op" id="7152323">,</span>&nbsp;<span class="num" id="7152325">0</span><span class="op" id="7152326">,</span>&nbsp;<span class="num" id="7152328">253</span><span class="op" id="7152331">,</span>&nbsp;<span class="num" id="7152333">255</span><span class="op" id="7152336">,</span>&nbsp;<span class="num" id="7152338">17</span><span class="op" id="7152340">,</span>&nbsp;<span class="num" id="7152342">18</span><span class="op" id="7152344">,</span>&nbsp;<span class="num" id="7152346">1</span><span class="op" id="7152347">,</span>&nbsp;<span class="num" id="7152349">0</span><span class="op" id="7152350">,</span>&nbsp;<span class="num" id="7152352">0</span><span class="op" id="7152353">,</span>&nbsp;<span class="num" id="7152355">255</span><span class="op" id="7152358">,</span>&nbsp;<span class="num" id="7152360">255</span><span class="op" id="7152363">}</span><span class="op" id="7152364">}</span><span class="op" id="7152365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152368">{</span><span class="op" id="7152369">[</span><span class="op" id="7152370">]</span><span class="builtintype" id="7152371">byte</span><span class="op" id="7152375">{</span><span class="num" id="7152376">0x11</span><span class="op" id="7152380">,</span>&nbsp;<span class="num" id="7152382">0x11</span><span class="op" id="7152386">,</span>&nbsp;<span class="num" id="7152388">0x11</span><span class="op" id="7152392">,</span>&nbsp;<span class="num" id="7152394">0x11</span><span class="op" id="7152398">,</span>&nbsp;<span class="num" id="7152400">0x11</span><span class="op" id="7152404">,</span>&nbsp;<span class="num" id="7152406">0x11</span><span class="op" id="7152410">,</span>&nbsp;<span class="num" id="7152412">0x11</span><span class="op" id="7152416">,</span>&nbsp;<span class="num" id="7152418">0x11</span><span class="op" id="7152422">}</span><span class="op" id="7152423">,</span>&nbsp;<span class="num" id="7152425">0</span><span class="op" id="7152426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152430">[</span><span class="op" id="7152431">]</span><span class="builtintype" id="7152432">byte</span><span class="op" id="7152436">{</span><span class="num" id="7152437">0</span><span class="op" id="7152438">,</span>&nbsp;<span class="num" id="7152440">8</span><span class="op" id="7152441">,</span>&nbsp;<span class="num" id="7152443">0</span><span class="op" id="7152444">,</span>&nbsp;<span class="num" id="7152446">247</span><span class="op" id="7152449">,</span>&nbsp;<span class="num" id="7152451">255</span><span class="op" id="7152454">,</span>&nbsp;<span class="num" id="7152456">17</span><span class="op" id="7152458">,</span>&nbsp;<span class="num" id="7152460">17</span><span class="op" id="7152462">,</span>&nbsp;<span class="num" id="7152464">17</span><span class="op" id="7152466">,</span>&nbsp;<span class="num" id="7152468">17</span><span class="op" id="7152470">,</span>&nbsp;<span class="num" id="7152472">17</span><span class="op" id="7152474">,</span>&nbsp;<span class="num" id="7152476">17</span><span class="op" id="7152478">,</span>&nbsp;<span class="num" id="7152480">17</span><span class="op" id="7152482">,</span>&nbsp;<span class="num" id="7152484">17</span><span class="op" id="7152486">,</span>&nbsp;<span class="num" id="7152488">1</span><span class="op" id="7152489">,</span>&nbsp;<span class="num" id="7152491">0</span><span class="op" id="7152492">,</span>&nbsp;<span class="num" id="7152494">0</span><span class="op" id="7152495">,</span>&nbsp;<span class="num" id="7152497">255</span><span class="op" id="7152500">,</span>&nbsp;<span class="num" id="7152502">255</span><span class="op" id="7152505">}</span><span class="op" id="7152506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152509">}</span><span class="op" id="7152510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152513">{</span><span class="op" id="7152514">[</span><span class="op" id="7152515">]</span><span class="builtintype" id="7152516">byte</span><span class="op" id="7152520">{</span><span class="op" id="7152521">}</span><span class="op" id="7152522">,</span>&nbsp;<span class="num" id="7152524">1</span><span class="op" id="7152525">,</span>&nbsp;<span class="op" id="7152527">[</span><span class="op" id="7152528">]</span><span class="builtintype" id="7152529">byte</span><span class="op" id="7152533">{</span><span class="num" id="7152534">1</span><span class="op" id="7152535">,</span>&nbsp;<span class="num" id="7152537">0</span><span class="op" id="7152538">,</span>&nbsp;<span class="num" id="7152540">0</span><span class="op" id="7152541">,</span>&nbsp;<span class="num" id="7152543">255</span><span class="op" id="7152546">,</span>&nbsp;<span class="num" id="7152548">255</span><span class="op" id="7152551">}</span><span class="op" id="7152552">}</span><span class="op" id="7152553">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152556">{</span><span class="op" id="7152557">[</span><span class="op" id="7152558">]</span><span class="builtintype" id="7152559">byte</span><span class="op" id="7152563">{</span><span class="num" id="7152564">0x11</span><span class="op" id="7152568">}</span><span class="op" id="7152569">,</span>&nbsp;<span class="num" id="7152571">1</span><span class="op" id="7152572">,</span>&nbsp;<span class="op" id="7152574">[</span><span class="op" id="7152575">]</span><span class="builtintype" id="7152576">byte</span><span class="op" id="7152580">{</span><span class="num" id="7152581">18</span><span class="op" id="7152583">,</span>&nbsp;<span class="num" id="7152585">4</span><span class="op" id="7152586">,</span>&nbsp;<span class="num" id="7152588">4</span><span class="op" id="7152589">,</span>&nbsp;<span class="num" id="7152591">0</span><span class="op" id="7152592">,</span>&nbsp;<span class="num" id="7152594">0</span><span class="op" id="7152595">,</span>&nbsp;<span class="num" id="7152597">255</span><span class="op" id="7152600">,</span>&nbsp;<span class="num" id="7152602">255</span><span class="op" id="7152605">}</span><span class="op" id="7152606">}</span><span class="op" id="7152607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152610">{</span><span class="op" id="7152611">[</span><span class="op" id="7152612">]</span><span class="builtintype" id="7152613">byte</span><span class="op" id="7152617">{</span><span class="num" id="7152618">0x11</span><span class="op" id="7152622">,</span>&nbsp;<span class="num" id="7152624">0x12</span><span class="op" id="7152628">}</span><span class="op" id="7152629">,</span>&nbsp;<span class="num" id="7152631">1</span><span class="op" id="7152632">,</span>&nbsp;<span class="op" id="7152634">[</span><span class="op" id="7152635">]</span><span class="builtintype" id="7152636">byte</span><span class="op" id="7152640">{</span><span class="num" id="7152641">18</span><span class="op" id="7152643">,</span>&nbsp;<span class="num" id="7152645">20</span><span class="op" id="7152647">,</span>&nbsp;<span class="num" id="7152649">2</span><span class="op" id="7152650">,</span>&nbsp;<span class="num" id="7152652">4</span><span class="op" id="7152653">,</span>&nbsp;<span class="num" id="7152655">0</span><span class="op" id="7152656">,</span>&nbsp;<span class="num" id="7152658">0</span><span class="op" id="7152659">,</span>&nbsp;<span class="num" id="7152661">255</span><span class="op" id="7152664">,</span>&nbsp;<span class="num" id="7152666">255</span><span class="op" id="7152669">}</span><span class="op" id="7152670">}</span><span class="op" id="7152671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152674">{</span><span class="op" id="7152675">[</span><span class="op" id="7152676">]</span><span class="builtintype" id="7152677">byte</span><span class="op" id="7152681">{</span><span class="num" id="7152682">0x11</span><span class="op" id="7152686">,</span>&nbsp;<span class="num" id="7152688">0x11</span><span class="op" id="7152692">,</span>&nbsp;<span class="num" id="7152694">0x11</span><span class="op" id="7152698">,</span>&nbsp;<span class="num" id="7152700">0x11</span><span class="op" id="7152704">,</span>&nbsp;<span class="num" id="7152706">0x11</span><span class="op" id="7152710">,</span>&nbsp;<span class="num" id="7152712">0x11</span><span class="op" id="7152716">,</span>&nbsp;<span class="num" id="7152718">0x11</span><span class="op" id="7152722">,</span>&nbsp;<span class="num" id="7152724">0x11</span><span class="op" id="7152728">}</span><span class="op" id="7152729">,</span>&nbsp;<span class="num" id="7152731">1</span><span class="op" id="7152732">,</span>&nbsp;<span class="op" id="7152734">[</span><span class="op" id="7152735">]</span><span class="builtintype" id="7152736">byte</span><span class="op" id="7152740">{</span><span class="num" id="7152741">18</span><span class="op" id="7152743">,</span>&nbsp;<span class="num" id="7152745">132</span><span class="op" id="7152748">,</span>&nbsp;<span class="num" id="7152750">2</span><span class="op" id="7152751">,</span>&nbsp;<span class="num" id="7152753">64</span><span class="op" id="7152755">,</span>&nbsp;<span class="num" id="7152757">0</span><span class="op" id="7152758">,</span>&nbsp;<span class="num" id="7152760">0</span><span class="op" id="7152761">,</span>&nbsp;<span class="num" id="7152763">0</span><span class="op" id="7152764">,</span>&nbsp;<span class="num" id="7152766">255</span><span class="op" id="7152769">,</span>&nbsp;<span class="num" id="7152771">255</span><span class="op" id="7152774">}</span><span class="op" id="7152775">}</span><span class="op" id="7152776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152779">{</span><span class="op" id="7152780">[</span><span class="op" id="7152781">]</span><span class="builtintype" id="7152782">byte</span><span class="op" id="7152786">{</span><span class="op" id="7152787">}</span><span class="op" id="7152788">,</span>&nbsp;<span class="num" id="7152790">9</span><span class="op" id="7152791">,</span>&nbsp;<span class="op" id="7152793">[</span><span class="op" id="7152794">]</span><span class="builtintype" id="7152795">byte</span><span class="op" id="7152799">{</span><span class="num" id="7152800">1</span><span class="op" id="7152801">,</span>&nbsp;<span class="num" id="7152803">0</span><span class="op" id="7152804">,</span>&nbsp;<span class="num" id="7152806">0</span><span class="op" id="7152807">,</span>&nbsp;<span class="num" id="7152809">255</span><span class="op" id="7152812">,</span>&nbsp;<span class="num" id="7152814">255</span><span class="op" id="7152817">}</span><span class="op" id="7152818">}</span><span class="op" id="7152819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152822">{</span><span class="op" id="7152823">[</span><span class="op" id="7152824">]</span><span class="builtintype" id="7152825">byte</span><span class="op" id="7152829">{</span><span class="num" id="7152830">0x11</span><span class="op" id="7152834">}</span><span class="op" id="7152835">,</span>&nbsp;<span class="num" id="7152837">9</span><span class="op" id="7152838">,</span>&nbsp;<span class="op" id="7152840">[</span><span class="op" id="7152841">]</span><span class="builtintype" id="7152842">byte</span><span class="op" id="7152846">{</span><span class="num" id="7152847">18</span><span class="op" id="7152849">,</span>&nbsp;<span class="num" id="7152851">4</span><span class="op" id="7152852">,</span>&nbsp;<span class="num" id="7152854">4</span><span class="op" id="7152855">,</span>&nbsp;<span class="num" id="7152857">0</span><span class="op" id="7152858">,</span>&nbsp;<span class="num" id="7152860">0</span><span class="op" id="7152861">,</span>&nbsp;<span class="num" id="7152863">255</span><span class="op" id="7152866">,</span>&nbsp;<span class="num" id="7152868">255</span><span class="op" id="7152871">}</span><span class="op" id="7152872">}</span><span class="op" id="7152873">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152876">{</span><span class="op" id="7152877">[</span><span class="op" id="7152878">]</span><span class="builtintype" id="7152879">byte</span><span class="op" id="7152883">{</span><span class="num" id="7152884">0x11</span><span class="op" id="7152888">,</span>&nbsp;<span class="num" id="7152890">0x12</span><span class="op" id="7152894">}</span><span class="op" id="7152895">,</span>&nbsp;<span class="num" id="7152897">9</span><span class="op" id="7152898">,</span>&nbsp;<span class="op" id="7152900">[</span><span class="op" id="7152901">]</span><span class="builtintype" id="7152902">byte</span><span class="op" id="7152906">{</span><span class="num" id="7152907">18</span><span class="op" id="7152909">,</span>&nbsp;<span class="num" id="7152911">20</span><span class="op" id="7152913">,</span>&nbsp;<span class="num" id="7152915">2</span><span class="op" id="7152916">,</span>&nbsp;<span class="num" id="7152918">4</span><span class="op" id="7152919">,</span>&nbsp;<span class="num" id="7152921">0</span><span class="op" id="7152922">,</span>&nbsp;<span class="num" id="7152924">0</span><span class="op" id="7152925">,</span>&nbsp;<span class="num" id="7152927">255</span><span class="op" id="7152930">,</span>&nbsp;<span class="num" id="7152932">255</span><span class="op" id="7152935">}</span><span class="op" id="7152936">}</span><span class="op" id="7152937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152940">{</span><span class="op" id="7152941">[</span><span class="op" id="7152942">]</span><span class="builtintype" id="7152943">byte</span><span class="op" id="7152947">{</span><span class="num" id="7152948">0x11</span><span class="op" id="7152952">,</span>&nbsp;<span class="num" id="7152954">0x11</span><span class="op" id="7152958">,</span>&nbsp;<span class="num" id="7152960">0x11</span><span class="op" id="7152964">,</span>&nbsp;<span class="num" id="7152966">0x11</span><span class="op" id="7152970">,</span>&nbsp;<span class="num" id="7152972">0x11</span><span class="op" id="7152976">,</span>&nbsp;<span class="num" id="7152978">0x11</span><span class="op" id="7152982">,</span>&nbsp;<span class="num" id="7152984">0x11</span><span class="op" id="7152988">,</span>&nbsp;<span class="num" id="7152990">0x11</span><span class="op" id="7152994">}</span><span class="op" id="7152995">,</span>&nbsp;<span class="num" id="7152997">9</span><span class="op" id="7152998">,</span>&nbsp;<span class="op" id="7153000">[</span><span class="op" id="7153001">]</span><span class="builtintype" id="7153002">byte</span><span class="op" id="7153006">{</span><span class="num" id="7153007">18</span><span class="op" id="7153009">,</span>&nbsp;<span class="num" id="7153011">132</span><span class="op" id="7153014">,</span>&nbsp;<span class="num" id="7153016">2</span><span class="op" id="7153017">,</span>&nbsp;<span class="num" id="7153019">64</span><span class="op" id="7153021">,</span>&nbsp;<span class="num" id="7153023">0</span><span class="op" id="7153024">,</span>&nbsp;<span class="num" id="7153026">0</span><span class="op" id="7153027">,</span>&nbsp;<span class="num" id="7153029">0</span><span class="op" id="7153030">,</span>&nbsp;<span class="num" id="7153032">255</span><span class="op" id="7153035">,</span>&nbsp;<span class="num" id="7153037">255</span><span class="op" id="7153040">}</span><span class="op" id="7153041">}</span><span class="op" id="7153042">,</span><br>
<span class="lineno"></span><span class="op" id="7153044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7153047">var</span>&nbsp;<span class="ident" id="7153051">deflateInflateTests</span>&nbsp;<span class="op" id="7153071">=</span>&nbsp;<span class="op" id="7153073">[</span><span class="op" id="7153074">]</span><span class="op" id="7153075">*</span><span class="ident" id="7153076">deflateInflateTest</span><span class="op" id="7153094">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153097">{</span><span class="op" id="7153098">[</span><span class="op" id="7153099">]</span><span class="builtintype" id="7153100">byte</span><span class="op" id="7153104">{</span><span class="op" id="7153105">}</span><span class="op" id="7153106">}</span><span class="op" id="7153107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153110">{</span><span class="op" id="7153111">[</span><span class="op" id="7153112">]</span><span class="builtintype" id="7153113">byte</span><span class="op" id="7153117">{</span><span class="num" id="7153118">0x11</span><span class="op" id="7153122">}</span><span class="op" id="7153123">}</span><span class="op" id="7153124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153127">{</span><span class="op" id="7153128">[</span><span class="op" id="7153129">]</span><span class="builtintype" id="7153130">byte</span><span class="op" id="7153134">{</span><span class="num" id="7153135">0x11</span><span class="op" id="7153139">,</span>&nbsp;<span class="num" id="7153141">0x12</span><span class="op" id="7153145">}</span><span class="op" id="7153146">}</span><span class="op" id="7153147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153150">{</span><span class="op" id="7153151">[</span><span class="op" id="7153152">]</span><span class="builtintype" id="7153153">byte</span><span class="op" id="7153157">{</span><span class="num" id="7153158">0x11</span><span class="op" id="7153162">,</span>&nbsp;<span class="num" id="7153164">0x11</span><span class="op" id="7153168">,</span>&nbsp;<span class="num" id="7153170">0x11</span><span class="op" id="7153174">,</span>&nbsp;<span class="num" id="7153176">0x11</span><span class="op" id="7153180">,</span>&nbsp;<span class="num" id="7153182">0x11</span><span class="op" id="7153186">,</span>&nbsp;<span class="num" id="7153188">0x11</span><span class="op" id="7153192">,</span>&nbsp;<span class="num" id="7153194">0x11</span><span class="op" id="7153198">,</span>&nbsp;<span class="num" id="7153200">0x11</span><span class="op" id="7153204">}</span><span class="op" id="7153205">}</span><span class="op" id="7153206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153209">{</span><span class="op" id="7153210">[</span><span class="op" id="7153211">]</span><span class="builtintype" id="7153212">byte</span><span class="op" id="7153216">{</span><span class="num" id="7153217">0x11</span><span class="op" id="7153221">,</span>&nbsp;<span class="num" id="7153223">0x10</span><span class="op" id="7153227">,</span>&nbsp;<span class="num" id="7153229">0x13</span><span class="op" id="7153233">,</span>&nbsp;<span class="num" id="7153235">0x41</span><span class="op" id="7153239">,</span>&nbsp;<span class="num" id="7153241">0x21</span><span class="op" id="7153245">,</span>&nbsp;<span class="num" id="7153247">0x21</span><span class="op" id="7153251">,</span>&nbsp;<span class="num" id="7153253">0x41</span><span class="op" id="7153257">,</span>&nbsp;<span class="num" id="7153259">0x13</span><span class="op" id="7153263">,</span>&nbsp;<span class="num" id="7153265">0x87</span><span class="op" id="7153269">,</span>&nbsp;<span class="num" id="7153271">0x78</span><span class="op" id="7153275">,</span>&nbsp;<span class="num" id="7153277">0x13</span><span class="op" id="7153281">}</span><span class="op" id="7153282">}</span><span class="op" id="7153283">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153286">{</span><span class="ident" id="7153287">largeDataChunk</span><span class="op" id="7153301">(</span><span class="op" id="7153302">)</span><span class="op" id="7153303">}</span><span class="op" id="7153304">,</span><br>
<span class="lineno"></span><span class="op" id="7153306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7153309">var</span>&nbsp;<span class="ident" id="7153313">reverseBitsTests</span>&nbsp;<span class="op" id="7153330">=</span>&nbsp;<span class="op" id="7153332">[</span><span class="op" id="7153333">]</span><span class="op" id="7153334">*</span><span class="ident" id="7153335">reverseBitsTest</span><span class="op" id="7153350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153353">{</span><span class="num" id="7153354">1</span><span class="op" id="7153355">,</span>&nbsp;<span class="num" id="7153357">1</span><span class="op" id="7153358">,</span>&nbsp;<span class="num" id="7153360">1</span><span class="op" id="7153361">}</span><span class="op" id="7153362">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153365">{</span><span class="num" id="7153366">1</span><span class="op" id="7153367">,</span>&nbsp;<span class="num" id="7153369">2</span><span class="op" id="7153370">,</span>&nbsp;<span class="num" id="7153372">2</span><span class="op" id="7153373">}</span><span class="op" id="7153374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153377">{</span><span class="num" id="7153378">1</span><span class="op" id="7153379">,</span>&nbsp;<span class="num" id="7153381">3</span><span class="op" id="7153382">,</span>&nbsp;<span class="num" id="7153384">4</span><span class="op" id="7153385">}</span><span class="op" id="7153386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153389">{</span><span class="num" id="7153390">1</span><span class="op" id="7153391">,</span>&nbsp;<span class="num" id="7153393">4</span><span class="op" id="7153394">,</span>&nbsp;<span class="num" id="7153396">8</span><span class="op" id="7153397">}</span><span class="op" id="7153398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153401">{</span><span class="num" id="7153402">1</span><span class="op" id="7153403">,</span>&nbsp;<span class="num" id="7153405">5</span><span class="op" id="7153406">,</span>&nbsp;<span class="num" id="7153408">16</span><span class="op" id="7153410">}</span><span class="op" id="7153411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153414">{</span><span class="num" id="7153415">17</span><span class="op" id="7153417">,</span>&nbsp;<span class="num" id="7153419">5</span><span class="op" id="7153420">,</span>&nbsp;<span class="num" id="7153422">17</span><span class="op" id="7153424">}</span><span class="op" id="7153425">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153428">{</span><span class="num" id="7153429">257</span><span class="op" id="7153432">,</span>&nbsp;<span class="num" id="7153434">9</span><span class="op" id="7153435">,</span>&nbsp;<span class="num" id="7153437">257</span><span class="op" id="7153440">}</span><span class="op" id="7153441">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153444">{</span><span class="num" id="7153445">29</span><span class="op" id="7153447">,</span>&nbsp;<span class="num" id="7153449">5</span><span class="op" id="7153450">,</span>&nbsp;<span class="num" id="7153452">23</span><span class="op" id="7153454">}</span><span class="op" id="7153455">,</span><br>
<span class="lineno"></span><span class="op" id="7153457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7153460">func</span>&nbsp;<span class="ident" id="7153465">largeDataChunk</span><span class="op" id="7153479">(</span><span class="op" id="7153480">)</span>&nbsp;<span class="op" id="7153482">[</span><span class="op" id="7153483">]</span><span class="builtintype" id="7153484">byte</span>&nbsp;<span class="op" id="7153489">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153492">result</span>&nbsp;<span class="op" id="7153499">:=</span>&nbsp;<span class="builtinfunc" id="7153502">make</span><span class="op" id="7153506">(</span><span class="op" id="7153507">[</span><span class="op" id="7153508">]</span><span class="builtintype" id="7153509">byte</span><span class="op" id="7153513">,</span>&nbsp;<span class="num" id="7153515">100000</span><span class="op" id="7153521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153524">for</span>&nbsp;<span class="ident" id="7153528">i</span>&nbsp;<span class="op" id="7153530">:=</span>&nbsp;<span class="keyword" id="7153533">range</span>&nbsp;<span class="ident" id="7153539">result</span>&nbsp;<span class="op" id="7153546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153550">result</span><span class="op" id="7153556">[</span><span class="ident" id="7153557">i</span><span class="op" id="7153558">]</span>&nbsp;<span class="op" id="7153560">=</span>&nbsp;<span class="builtintype" id="7153562">byte</span><span class="op" id="7153566">(</span><span class="ident" id="7153567">i</span>&nbsp;<span class="op" id="7153569">*</span>&nbsp;<span class="ident" id="7153571">i</span>&nbsp;<span class="op" id="7153573">&amp;</span>&nbsp;<span class="num" id="7153575">0xFF</span><span class="op" id="7153579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153585">return</span>&nbsp;<span class="ident" id="7153592">result</span><br>
<span class="lineno">80</span><span class="op" id="7153599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7153602">func</span>&nbsp;<span class="ident" id="7153607">TestDeflate</span><span class="op" id="7153618">(</span><span class="ident" id="7153619">t</span>&nbsp;<span class="op" id="7153621">*</span><span class="ident" id="7153622">testing</span><span class="op" id="7153629">.</span><span class="ident" id="7153630">T</span><span class="op" id="7153631">)</span>&nbsp;<span class="op" id="7153633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153636">for</span>&nbsp;<span class="ident" id="7153640">_</span><span class="op" id="7153641">,</span>&nbsp;<span class="ident" id="7153643">h</span>&nbsp;<span class="op" id="7153645">:=</span>&nbsp;<span class="keyword" id="7153648">range</span>&nbsp;<span class="ident" id="7153654">deflateTests</span>&nbsp;<span class="op" id="7153667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153671">var</span>&nbsp;<span class="ident" id="7153675">buf</span>&nbsp;<span class="ident" id="7153679">bytes</span><span class="op" id="7153684">.</span><span class="ident" id="7153685">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153694">w</span><span class="op" id="7153695">,</span>&nbsp;<span class="ident" id="7153697">err</span>&nbsp;<span class="op" id="7153701">:=</span>&nbsp;<span class="ident" id="7153704">NewWriter</span><span class="op" id="7153713">(</span><span class="op" id="7153714">&amp;</span><span class="ident" id="7153715">buf</span><span class="op" id="7153718">,</span>&nbsp;<span class="ident" id="7153720">h</span><span class="op" id="7153721">.</span><span class="ident" id="7153722">level</span><span class="op" id="7153727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153731">if</span>&nbsp;<span class="ident" id="7153734">err</span>&nbsp;<span class="op" id="7153738">!=</span>&nbsp;<span class="builtintype" id="7153741">nil</span>&nbsp;<span class="op" id="7153745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153750">t</span><span class="op" id="7153751">.</span><span class="ident" id="7153752">Errorf</span><span class="op" id="7153758">(</span><span class="string" id="7153759">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7153774">,</span>&nbsp;<span class="ident" id="7153776">err</span><span class="op" id="7153779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153784">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153795">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153799">w</span><span class="op" id="7153800">.</span><span class="ident" id="7153801">Write</span><span class="op" id="7153806">(</span><span class="ident" id="7153807">h</span><span class="op" id="7153808">.</span><span class="ident" id="7153809">in</span><span class="op" id="7153811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153815">w</span><span class="op" id="7153816">.</span><span class="ident" id="7153817">Close</span><span class="op" id="7153822">(</span><span class="op" id="7153823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153827">if</span>&nbsp;<span class="op" id="7153830">!</span><span class="ident" id="7153831">bytes</span><span class="op" id="7153836">.</span><span class="ident" id="7153837">Equal</span><span class="op" id="7153842">(</span><span class="ident" id="7153843">buf</span><span class="op" id="7153846">.</span><span class="ident" id="7153847">Bytes</span><span class="op" id="7153852">(</span><span class="op" id="7153853">)</span><span class="op" id="7153854">,</span>&nbsp;<span class="ident" id="7153856">h</span><span class="op" id="7153857">.</span><span class="ident" id="7153858">out</span><span class="op" id="7153861">)</span>&nbsp;<span class="op" id="7153863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153868">t</span><span class="op" id="7153869">.</span><span class="ident" id="7153870">Errorf</span><span class="op" id="7153876">(</span><span class="string" id="7153877">&#34;Deflate(%d,&nbsp;%x)&nbsp;=&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="7153908">,</span>&nbsp;<span class="ident" id="7153910">h</span><span class="op" id="7153911">.</span><span class="ident" id="7153912">level</span><span class="op" id="7153917">,</span>&nbsp;<span class="ident" id="7153919">h</span><span class="op" id="7153920">.</span><span class="ident" id="7153921">in</span><span class="op" id="7153923">,</span>&nbsp;<span class="ident" id="7153925">buf</span><span class="op" id="7153928">.</span><span class="ident" id="7153929">Bytes</span><span class="op" id="7153934">(</span><span class="op" id="7153935">)</span><span class="op" id="7153936">,</span>&nbsp;<span class="ident" id="7153938">h</span><span class="op" id="7153939">.</span><span class="ident" id="7153940">out</span><span class="op" id="7153943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153947">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153950">}</span><br>
<span class="lineno"></span><span class="op" id="7153952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7153955">//&nbsp;A&nbsp;sparseReader&nbsp;returns&nbsp;a&nbsp;stream&nbsp;consisting&nbsp;of&nbsp;0s&nbsp;followed&nbsp;by&nbsp;1&lt;&lt;16&nbsp;1s.</span><br>
<span class="lineno"></span><span class="comment" id="7154029">//&nbsp;This&nbsp;tests&nbsp;missing&nbsp;hash&nbsp;references&nbsp;in&nbsp;a&nbsp;very&nbsp;large&nbsp;input.</span><br>
<span class="lineno">100</span><span class="keyword" id="7154090">type</span>&nbsp;<span class="ident" id="7154095">sparseReader</span>&nbsp;<span class="keyword" id="7154108">struct</span>&nbsp;<span class="op" id="7154115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154118">l</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7154122">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154129">cur</span>&nbsp;<span class="ident" id="7154133">int64</span><br>
<span class="lineno"></span><span class="op" id="7154139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7154142">func</span>&nbsp;<span class="op" id="7154147">(</span><span class="ident" id="7154148">r</span>&nbsp;<span class="op" id="7154150">*</span><span class="ident" id="7154151">sparseReader</span><span class="op" id="7154163">)</span>&nbsp;<span class="ident" id="7154165">Read</span><span class="op" id="7154169">(</span><span class="ident" id="7154170">b</span>&nbsp;<span class="op" id="7154172">[</span><span class="op" id="7154173">]</span><span class="builtintype" id="7154174">byte</span><span class="op" id="7154178">)</span>&nbsp;<span class="op" id="7154180">(</span><span class="ident" id="7154181">n</span>&nbsp;<span class="builtintype" id="7154183">int</span><span class="op" id="7154186">,</span>&nbsp;<span class="ident" id="7154188">err</span>&nbsp;<span class="builtintype" id="7154192">error</span><span class="op" id="7154197">)</span>&nbsp;<span class="op" id="7154199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154202">if</span>&nbsp;<span class="ident" id="7154205">r</span><span class="op" id="7154206">.</span><span class="ident" id="7154207">cur</span>&nbsp;<span class="op" id="7154211">&gt;=</span>&nbsp;<span class="ident" id="7154214">r</span><span class="op" id="7154215">.</span><span class="ident" id="7154216">l</span>&nbsp;<span class="op" id="7154218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154222">return</span>&nbsp;<span class="num" id="7154229">0</span><span class="op" id="7154230">,</span>&nbsp;<span class="ident" id="7154232">io</span><span class="op" id="7154234">.</span><span class="ident" id="7154235">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154243">n</span>&nbsp;<span class="op" id="7154245">=</span>&nbsp;<span class="builtinfunc" id="7154247">len</span><span class="op" id="7154250">(</span><span class="ident" id="7154251">b</span><span class="op" id="7154252">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154255">cur</span>&nbsp;<span class="op" id="7154259">:=</span>&nbsp;<span class="ident" id="7154262">r</span><span class="op" id="7154263">.</span><span class="ident" id="7154264">cur</span>&nbsp;<span class="op" id="7154268">+</span>&nbsp;<span class="ident" id="7154270">int64</span><span class="op" id="7154275">(</span><span class="ident" id="7154276">n</span><span class="op" id="7154277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154280">if</span>&nbsp;<span class="ident" id="7154283">cur</span>&nbsp;<span class="op" id="7154287">&gt;</span>&nbsp;<span class="ident" id="7154289">r</span><span class="op" id="7154290">.</span><span class="ident" id="7154291">l</span>&nbsp;<span class="op" id="7154293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154297">n</span>&nbsp;<span class="op" id="7154299">-=</span>&nbsp;<span class="builtintype" id="7154302">int</span><span class="op" id="7154305">(</span><span class="ident" id="7154306">cur</span>&nbsp;<span class="op" id="7154310">-</span>&nbsp;<span class="ident" id="7154312">r</span><span class="op" id="7154313">.</span><span class="ident" id="7154314">l</span><span class="op" id="7154315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154319">cur</span>&nbsp;<span class="op" id="7154323">=</span>&nbsp;<span class="ident" id="7154325">r</span><span class="op" id="7154326">.</span><span class="ident" id="7154327">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154330">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154333">for</span>&nbsp;<span class="ident" id="7154337">i</span>&nbsp;<span class="op" id="7154339">:=</span>&nbsp;<span class="keyword" id="7154342">range</span>&nbsp;<span class="ident" id="7154348">b</span><span class="op" id="7154349">[</span><span class="num" id="7154350">0</span><span class="op" id="7154351">:</span><span class="ident" id="7154352">n</span><span class="op" id="7154353">]</span>&nbsp;<span class="op" id="7154355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154359">if</span>&nbsp;<span class="ident" id="7154362">r</span><span class="op" id="7154363">.</span><span class="ident" id="7154364">cur</span><span class="op" id="7154367">+</span><span class="ident" id="7154368">int64</span><span class="op" id="7154373">(</span><span class="ident" id="7154374">i</span><span class="op" id="7154375">)</span>&nbsp;<span class="op" id="7154377">&gt;=</span>&nbsp;<span class="ident" id="7154380">r</span><span class="op" id="7154381">.</span><span class="ident" id="7154382">l</span><span class="op" id="7154383">-</span><span class="num" id="7154384">1</span><span class="op" id="7154385">&lt;&lt;</span><span class="num" id="7154387">16</span>&nbsp;<span class="op" id="7154390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154395">b</span><span class="op" id="7154396">[</span><span class="ident" id="7154397">i</span><span class="op" id="7154398">]</span>&nbsp;<span class="op" id="7154400">=</span>&nbsp;<span class="num" id="7154402">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154406">}</span>&nbsp;<span class="keyword" id="7154408">else</span>&nbsp;<span class="op" id="7154413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154418">b</span><span class="op" id="7154419">[</span><span class="ident" id="7154420">i</span><span class="op" id="7154421">]</span>&nbsp;<span class="op" id="7154423">=</span>&nbsp;<span class="num" id="7154425">0</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154435">r</span><span class="op" id="7154436">.</span><span class="ident" id="7154437">cur</span>&nbsp;<span class="op" id="7154441">=</span>&nbsp;<span class="ident" id="7154443">cur</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154448">return</span><br>
<span class="lineno"></span><span class="op" id="7154455">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7154458">func</span>&nbsp;<span class="ident" id="7154463">TestVeryLongSparseChunk</span><span class="op" id="7154486">(</span><span class="ident" id="7154487">t</span>&nbsp;<span class="op" id="7154489">*</span><span class="ident" id="7154490">testing</span><span class="op" id="7154497">.</span><span class="ident" id="7154498">T</span><span class="op" id="7154499">)</span>&nbsp;<span class="op" id="7154501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154504">if</span>&nbsp;<span class="ident" id="7154507">testing</span><span class="op" id="7154514">.</span><span class="ident" id="7154515">Short</span><span class="op" id="7154520">(</span><span class="op" id="7154521">)</span>&nbsp;<span class="op" id="7154523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154527">t</span><span class="op" id="7154528">.</span><span class="ident" id="7154529">Skip</span><span class="op" id="7154533">(</span><span class="string" id="7154534">&#34;skipping&nbsp;sparse&nbsp;chunk&nbsp;during&nbsp;short&nbsp;test&#34;</span><span class="op" id="7154575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154578">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154581">w</span><span class="op" id="7154582">,</span>&nbsp;<span class="ident" id="7154584">err</span>&nbsp;<span class="op" id="7154588">:=</span>&nbsp;<span class="ident" id="7154591">NewWriter</span><span class="op" id="7154600">(</span><span class="ident" id="7154601">ioutil</span><span class="op" id="7154607">.</span><span class="ident" id="7154608">Discard</span><span class="op" id="7154615">,</span>&nbsp;<span class="num" id="7154617">1</span><span class="op" id="7154618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154621">if</span>&nbsp;<span class="ident" id="7154624">err</span>&nbsp;<span class="op" id="7154628">!=</span>&nbsp;<span class="builtintype" id="7154631">nil</span>&nbsp;<span class="op" id="7154635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154639">t</span><span class="op" id="7154640">.</span><span class="ident" id="7154641">Errorf</span><span class="op" id="7154647">(</span><span class="string" id="7154648">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7154663">,</span>&nbsp;<span class="ident" id="7154665">err</span><span class="op" id="7154668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154672">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154680">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154683">if</span>&nbsp;<span class="ident" id="7154686">_</span><span class="op" id="7154687">,</span>&nbsp;<span class="ident" id="7154689">err</span>&nbsp;<span class="op" id="7154693">=</span>&nbsp;<span class="ident" id="7154695">io</span><span class="op" id="7154697">.</span><span class="ident" id="7154698">Copy</span><span class="op" id="7154702">(</span><span class="ident" id="7154703">w</span><span class="op" id="7154704">,</span>&nbsp;<span class="op" id="7154706">&amp;</span><span class="ident" id="7154707">sparseReader</span><span class="op" id="7154719">{</span><span class="ident" id="7154720">l</span><span class="op" id="7154721">:</span>&nbsp;<span class="num" id="7154723">23E8</span><span class="op" id="7154727">}</span><span class="op" id="7154728">)</span><span class="op" id="7154729">;</span>&nbsp;<span class="ident" id="7154731">err</span>&nbsp;<span class="op" id="7154735">!=</span>&nbsp;<span class="builtintype" id="7154738">nil</span>&nbsp;<span class="op" id="7154742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154746">t</span><span class="op" id="7154747">.</span><span class="ident" id="7154748">Errorf</span><span class="op" id="7154754">(</span><span class="string" id="7154755">&#34;Compress&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7154776">,</span>&nbsp;<span class="ident" id="7154778">err</span><span class="op" id="7154781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154785">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154793">}</span><br>
<span class="lineno"></span><span class="op" id="7154795">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="7154798">type</span>&nbsp;<span class="ident" id="7154803">syncBuffer</span>&nbsp;<span class="keyword" id="7154814">struct</span>&nbsp;<span class="op" id="7154821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154824">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154831">bytes</span><span class="op" id="7154836">.</span><span class="ident" id="7154837">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154845">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154852">sync</span><span class="op" id="7154856">.</span><span class="ident" id="7154857">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154866">closed</span>&nbsp;<span class="builtintype" id="7154873">bool</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154879">ready</span>&nbsp;&nbsp;<span class="keyword" id="7154886">chan</span>&nbsp;<span class="builtintype" id="7154891">bool</span><br>
<span class="lineno"></span><span class="op" id="7154896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7154899">func</span>&nbsp;<span class="ident" id="7154904">newSyncBuffer</span><span class="op" id="7154917">(</span><span class="op" id="7154918">)</span>&nbsp;<span class="op" id="7154920">*</span><span class="ident" id="7154921">syncBuffer</span>&nbsp;<span class="op" id="7154932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154935">return</span>&nbsp;<span class="op" id="7154942">&amp;</span><span class="ident" id="7154943">syncBuffer</span><span class="op" id="7154953">{</span><span class="ident" id="7154954">ready</span><span class="op" id="7154959">:</span>&nbsp;<span class="builtinfunc" id="7154961">make</span><span class="op" id="7154965">(</span><span class="keyword" id="7154966">chan</span>&nbsp;<span class="builtintype" id="7154971">bool</span><span class="op" id="7154975">,</span>&nbsp;<span class="num" id="7154977">1</span><span class="op" id="7154978">)</span><span class="op" id="7154979">}</span><br>
<span class="lineno">150</span><span class="op" id="7154981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7154984">func</span>&nbsp;<span class="op" id="7154989">(</span><span class="ident" id="7154990">b</span>&nbsp;<span class="op" id="7154992">*</span><span class="ident" id="7154993">syncBuffer</span><span class="op" id="7155003">)</span>&nbsp;<span class="ident" id="7155005">Read</span><span class="op" id="7155009">(</span><span class="ident" id="7155010">p</span>&nbsp;<span class="op" id="7155012">[</span><span class="op" id="7155013">]</span><span class="builtintype" id="7155014">byte</span><span class="op" id="7155018">)</span>&nbsp;<span class="op" id="7155020">(</span><span class="ident" id="7155021">n</span>&nbsp;<span class="builtintype" id="7155023">int</span><span class="op" id="7155026">,</span>&nbsp;<span class="ident" id="7155028">err</span>&nbsp;<span class="builtintype" id="7155032">error</span><span class="op" id="7155037">)</span>&nbsp;<span class="op" id="7155039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155042">for</span>&nbsp;<span class="op" id="7155046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155050">b</span><span class="op" id="7155051">.</span><span class="ident" id="7155052">mu</span><span class="op" id="7155054">.</span><span class="ident" id="7155055">RLock</span><span class="op" id="7155060">(</span><span class="op" id="7155061">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155065">n</span><span class="op" id="7155066">,</span>&nbsp;<span class="ident" id="7155068">err</span>&nbsp;<span class="op" id="7155072">=</span>&nbsp;<span class="ident" id="7155074">b</span><span class="op" id="7155075">.</span><span class="ident" id="7155076">buf</span><span class="op" id="7155079">.</span><span class="ident" id="7155080">Read</span><span class="op" id="7155084">(</span><span class="ident" id="7155085">p</span><span class="op" id="7155086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155090">b</span><span class="op" id="7155091">.</span><span class="ident" id="7155092">mu</span><span class="op" id="7155094">.</span><span class="ident" id="7155095">RUnlock</span><span class="op" id="7155102">(</span><span class="op" id="7155103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155107">if</span>&nbsp;<span class="ident" id="7155110">n</span>&nbsp;<span class="op" id="7155112">&gt;</span>&nbsp;<span class="num" id="7155114">0</span>&nbsp;<span class="op" id="7155116">||</span>&nbsp;<span class="ident" id="7155119">b</span><span class="op" id="7155120">.</span><span class="ident" id="7155121">closed</span>&nbsp;<span class="op" id="7155128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155133">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7155142">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7155146">&lt;-</span><span class="ident" id="7155148">b</span><span class="op" id="7155149">.</span><span class="ident" id="7155150">ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7155157">}</span><br>
<span class="lineno"></span><span class="op" id="7155159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7155162">func</span>&nbsp;<span class="op" id="7155167">(</span><span class="ident" id="7155168">b</span>&nbsp;<span class="op" id="7155170">*</span><span class="ident" id="7155171">syncBuffer</span><span class="op" id="7155181">)</span>&nbsp;<span class="ident" id="7155183">signal</span><span class="op" id="7155189">(</span><span class="op" id="7155190">)</span>&nbsp;<span class="op" id="7155192">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155195">select</span>&nbsp;<span class="op" id="7155202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155205">case</span>&nbsp;<span class="ident" id="7155210">b</span><span class="op" id="7155211">.</span><span class="ident" id="7155212">ready</span>&nbsp;<span class="op" id="7155218">&lt;-</span>&nbsp;<span class="builtintype" id="7155221">true</span><span class="op" id="7155225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155228">default</span><span class="op" id="7155235">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7155238">}</span><br>
<span class="lineno"></span><span class="op" id="7155240">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7155243">func</span>&nbsp;<span class="op" id="7155248">(</span><span class="ident" id="7155249">b</span>&nbsp;<span class="op" id="7155251">*</span><span class="ident" id="7155252">syncBuffer</span><span class="op" id="7155262">)</span>&nbsp;<span class="ident" id="7155264">Write</span><span class="op" id="7155269">(</span><span class="ident" id="7155270">p</span>&nbsp;<span class="op" id="7155272">[</span><span class="op" id="7155273">]</span><span class="builtintype" id="7155274">byte</span><span class="op" id="7155278">)</span>&nbsp;<span class="op" id="7155280">(</span><span class="ident" id="7155281">n</span>&nbsp;<span class="builtintype" id="7155283">int</span><span class="op" id="7155286">,</span>&nbsp;<span class="ident" id="7155288">err</span>&nbsp;<span class="builtintype" id="7155292">error</span><span class="op" id="7155297">)</span>&nbsp;<span class="op" id="7155299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155302">n</span><span class="op" id="7155303">,</span>&nbsp;<span class="ident" id="7155305">err</span>&nbsp;<span class="op" id="7155309">=</span>&nbsp;<span class="ident" id="7155311">b</span><span class="op" id="7155312">.</span><span class="ident" id="7155313">buf</span><span class="op" id="7155316">.</span><span class="ident" id="7155317">Write</span><span class="op" id="7155322">(</span><span class="ident" id="7155323">p</span><span class="op" id="7155324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155327">b</span><span class="op" id="7155328">.</span><span class="ident" id="7155329">signal</span><span class="op" id="7155335">(</span><span class="op" id="7155336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155339">return</span><br>
<span class="lineno">175</span><span class="op" id="7155346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7155349">func</span>&nbsp;<span class="op" id="7155354">(</span><span class="ident" id="7155355">b</span>&nbsp;<span class="op" id="7155357">*</span><span class="ident" id="7155358">syncBuffer</span><span class="op" id="7155368">)</span>&nbsp;<span class="ident" id="7155370">WriteMode</span><span class="op" id="7155379">(</span><span class="op" id="7155380">)</span>&nbsp;<span class="op" id="7155382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155385">b</span><span class="op" id="7155386">.</span><span class="ident" id="7155387">mu</span><span class="op" id="7155389">.</span><span class="ident" id="7155390">Lock</span><span class="op" id="7155394">(</span><span class="op" id="7155395">)</span><br>
<span class="lineno"></span><span class="op" id="7155397">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="7155400">func</span>&nbsp;<span class="op" id="7155405">(</span><span class="ident" id="7155406">b</span>&nbsp;<span class="op" id="7155408">*</span><span class="ident" id="7155409">syncBuffer</span><span class="op" id="7155419">)</span>&nbsp;<span class="ident" id="7155421">ReadMode</span><span class="op" id="7155429">(</span><span class="op" id="7155430">)</span>&nbsp;<span class="op" id="7155432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155435">b</span><span class="op" id="7155436">.</span><span class="ident" id="7155437">mu</span><span class="op" id="7155439">.</span><span class="ident" id="7155440">Unlock</span><span class="op" id="7155446">(</span><span class="op" id="7155447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155450">b</span><span class="op" id="7155451">.</span><span class="ident" id="7155452">signal</span><span class="op" id="7155458">(</span><span class="op" id="7155459">)</span><br>
<span class="lineno"></span><span class="op" id="7155461">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="7155464">func</span>&nbsp;<span class="op" id="7155469">(</span><span class="ident" id="7155470">b</span>&nbsp;<span class="op" id="7155472">*</span><span class="ident" id="7155473">syncBuffer</span><span class="op" id="7155483">)</span>&nbsp;<span class="ident" id="7155485">Close</span><span class="op" id="7155490">(</span><span class="op" id="7155491">)</span>&nbsp;<span class="builtintype" id="7155493">error</span>&nbsp;<span class="op" id="7155499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155502">b</span><span class="op" id="7155503">.</span><span class="ident" id="7155504">closed</span>&nbsp;<span class="op" id="7155511">=</span>&nbsp;<span class="builtintype" id="7155513">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155519">b</span><span class="op" id="7155520">.</span><span class="ident" id="7155521">signal</span><span class="op" id="7155527">(</span><span class="op" id="7155528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155531">return</span>&nbsp;<span class="builtintype" id="7155538">nil</span><br>
<span class="lineno">190</span><span class="op" id="7155542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7155545">func</span>&nbsp;<span class="ident" id="7155550">testSync</span><span class="op" id="7155558">(</span><span class="ident" id="7155559">t</span>&nbsp;<span class="op" id="7155561">*</span><span class="ident" id="7155562">testing</span><span class="op" id="7155569">.</span><span class="ident" id="7155570">T</span><span class="op" id="7155571">,</span>&nbsp;<span class="ident" id="7155573">level</span>&nbsp;<span class="builtintype" id="7155579">int</span><span class="op" id="7155582">,</span>&nbsp;<span class="ident" id="7155584">input</span>&nbsp;<span class="op" id="7155590">[</span><span class="op" id="7155591">]</span><span class="builtintype" id="7155592">byte</span><span class="op" id="7155596">,</span>&nbsp;<span class="ident" id="7155598">name</span>&nbsp;<span class="builtintype" id="7155603">string</span><span class="op" id="7155609">)</span>&nbsp;<span class="op" id="7155611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155614">if</span>&nbsp;<span class="builtinfunc" id="7155617">len</span><span class="op" id="7155620">(</span><span class="ident" id="7155621">input</span><span class="op" id="7155626">)</span>&nbsp;<span class="op" id="7155628">==</span>&nbsp;<span class="num" id="7155631">0</span>&nbsp;<span class="op" id="7155633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155637">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7155645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155649">t</span><span class="op" id="7155650">.</span><span class="ident" id="7155651">Logf</span><span class="op" id="7155655">(</span><span class="string" id="7155656">&#34;--testSync&nbsp;%d,&nbsp;%d,&nbsp;%s&#34;</span><span class="op" id="7155679">,</span>&nbsp;<span class="ident" id="7155681">level</span><span class="op" id="7155686">,</span>&nbsp;<span class="builtinfunc" id="7155688">len</span><span class="op" id="7155691">(</span><span class="ident" id="7155692">input</span><span class="op" id="7155697">)</span><span class="op" id="7155698">,</span>&nbsp;<span class="ident" id="7155700">name</span><span class="op" id="7155704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155707">buf</span>&nbsp;<span class="op" id="7155711">:=</span>&nbsp;<span class="ident" id="7155714">newSyncBuffer</span><span class="op" id="7155727">(</span><span class="op" id="7155728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155731">buf1</span>&nbsp;<span class="op" id="7155736">:=</span>&nbsp;<span class="builtinfunc" id="7155739">new</span><span class="op" id="7155742">(</span><span class="ident" id="7155743">bytes</span><span class="op" id="7155748">.</span><span class="ident" id="7155749">Buffer</span><span class="op" id="7155755">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155758">buf</span><span class="op" id="7155761">.</span><span class="ident" id="7155762">WriteMode</span><span class="op" id="7155771">(</span><span class="op" id="7155772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155775">w</span><span class="op" id="7155776">,</span>&nbsp;<span class="ident" id="7155778">err</span>&nbsp;<span class="op" id="7155782">:=</span>&nbsp;<span class="ident" id="7155785">NewWriter</span><span class="op" id="7155794">(</span><span class="ident" id="7155795">io</span><span class="op" id="7155797">.</span><span class="ident" id="7155798">MultiWriter</span><span class="op" id="7155809">(</span><span class="ident" id="7155810">buf</span><span class="op" id="7155813">,</span>&nbsp;<span class="ident" id="7155815">buf1</span><span class="op" id="7155819">)</span><span class="op" id="7155820">,</span>&nbsp;<span class="ident" id="7155822">level</span><span class="op" id="7155827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155830">if</span>&nbsp;<span class="ident" id="7155833">err</span>&nbsp;<span class="op" id="7155837">!=</span>&nbsp;<span class="builtintype" id="7155840">nil</span>&nbsp;<span class="op" id="7155844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155848">t</span><span class="op" id="7155849">.</span><span class="ident" id="7155850">Errorf</span><span class="op" id="7155856">(</span><span class="string" id="7155857">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7155872">,</span>&nbsp;<span class="ident" id="7155874">err</span><span class="op" id="7155877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155881">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7155889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155892">r</span>&nbsp;<span class="op" id="7155894">:=</span>&nbsp;<span class="ident" id="7155897">NewReader</span><span class="op" id="7155906">(</span><span class="ident" id="7155907">buf</span><span class="op" id="7155910">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7155914">//&nbsp;Write&nbsp;half&nbsp;the&nbsp;input&nbsp;and&nbsp;read&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155954">for</span>&nbsp;<span class="ident" id="7155958">i</span>&nbsp;<span class="op" id="7155960">:=</span>&nbsp;<span class="num" id="7155963">0</span><span class="op" id="7155964">;</span>&nbsp;<span class="ident" id="7155966">i</span>&nbsp;<span class="op" id="7155968">&lt;</span>&nbsp;<span class="num" id="7155970">2</span><span class="op" id="7155971">;</span>&nbsp;<span class="ident" id="7155973">i</span><span class="op" id="7155974">++</span>&nbsp;<span class="op" id="7155977">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155981">var</span>&nbsp;<span class="ident" id="7155985">lo</span><span class="op" id="7155987">,</span>&nbsp;<span class="ident" id="7155989">hi</span>&nbsp;<span class="builtintype" id="7155992">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155998">if</span>&nbsp;<span class="ident" id="7156001">i</span>&nbsp;<span class="op" id="7156003">==</span>&nbsp;<span class="num" id="7156006">0</span>&nbsp;<span class="op" id="7156008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156013">lo</span><span class="op" id="7156015">,</span>&nbsp;<span class="ident" id="7156017">hi</span>&nbsp;<span class="op" id="7156020">=</span>&nbsp;<span class="num" id="7156022">0</span><span class="op" id="7156023">,</span>&nbsp;<span class="op" id="7156025">(</span><span class="builtinfunc" id="7156026">len</span><span class="op" id="7156029">(</span><span class="ident" id="7156030">input</span><span class="op" id="7156035">)</span><span class="op" id="7156036">+</span><span class="num" id="7156037">1</span><span class="op" id="7156038">)</span><span class="op" id="7156039">/</span><span class="num" id="7156040">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7156044">}</span>&nbsp;<span class="keyword" id="7156046">else</span>&nbsp;<span class="op" id="7156051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156056">lo</span><span class="op" id="7156058">,</span>&nbsp;<span class="ident" id="7156060">hi</span>&nbsp;<span class="op" id="7156063">=</span>&nbsp;<span class="op" id="7156065">(</span><span class="builtinfunc" id="7156066">len</span><span class="op" id="7156069">(</span><span class="ident" id="7156070">input</span><span class="op" id="7156075">)</span><span class="op" id="7156076">+</span><span class="num" id="7156077">1</span><span class="op" id="7156078">)</span><span class="op" id="7156079">/</span><span class="num" id="7156080">2</span><span class="op" id="7156081">,</span>&nbsp;<span class="builtinfunc" id="7156083">len</span><span class="op" id="7156086">(</span><span class="ident" id="7156087">input</span><span class="op" id="7156092">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7156096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156100">t</span><span class="op" id="7156101">.</span><span class="ident" id="7156102">Logf</span><span class="op" id="7156106">(</span><span class="string" id="7156107">&#34;#%d:&nbsp;write&nbsp;%d-%d&#34;</span><span class="op" id="7156125">,</span>&nbsp;<span class="ident" id="7156127">i</span><span class="op" id="7156128">,</span>&nbsp;<span class="ident" id="7156130">lo</span><span class="op" id="7156132">,</span>&nbsp;<span class="ident" id="7156134">hi</span><span class="op" id="7156136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156140">if</span>&nbsp;<span class="ident" id="7156143">_</span><span class="op" id="7156144">,</span>&nbsp;<span class="ident" id="7156146">err</span>&nbsp;<span class="op" id="7156150">:=</span>&nbsp;<span class="ident" id="7156153">w</span><span class="op" id="7156154">.</span><span class="ident" id="7156155">Write</span><span class="op" id="7156160">(</span><span class="ident" id="7156161">input</span><span class="op" id="7156166">[</span><span class="ident" id="7156167">lo</span><span class="op" id="7156169">:</span><span class="ident" id="7156170">hi</span><span class="op" id="7156172">]</span><span class="op" id="7156173">)</span><span class="op" id="7156174">;</span>&nbsp;<span class="ident" id="7156176">err</span>&nbsp;<span class="op" id="7156180">!=</span>&nbsp;<span class="builtintype" id="7156183">nil</span>&nbsp;<span class="op" id="7156187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156192">t</span><span class="op" id="7156193">.</span><span class="ident" id="7156194">Errorf</span><span class="op" id="7156200">(</span><span class="string" id="7156201">&#34;testSync:&nbsp;write:&nbsp;%v&#34;</span><span class="op" id="7156222">,</span>&nbsp;<span class="ident" id="7156224">err</span><span class="op" id="7156227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156232">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7156241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156245">if</span>&nbsp;<span class="ident" id="7156248">i</span>&nbsp;<span class="op" id="7156250">==</span>&nbsp;<span class="num" id="7156253">0</span>&nbsp;<span class="op" id="7156255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156260">if</span>&nbsp;<span class="ident" id="7156263">err</span>&nbsp;<span class="op" id="7156267">:=</span>&nbsp;<span class="ident" id="7156270">w</span><span class="op" id="7156271">.</span><span class="ident" id="7156272">Flush</span><span class="op" id="7156277">(</span><span class="op" id="7156278">)</span><span class="op" id="7156279">;</span>&nbsp;<span class="ident" id="7156281">err</span>&nbsp;<span class="op" id="7156285">!=</span>&nbsp;<span class="builtintype" id="7156288">nil</span>&nbsp;<span class="op" id="7156292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156298">t</span><span class="op" id="7156299">.</span><span class="ident" id="7156300">Errorf</span><span class="op" id="7156306">(</span><span class="string" id="7156307">&#34;testSync:&nbsp;flush:&nbsp;%v&#34;</span><span class="op" id="7156328">,</span>&nbsp;<span class="ident" id="7156330">err</span><span class="op" id="7156333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156339">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7156349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7156353">}</span>&nbsp;<span class="keyword" id="7156355">else</span>&nbsp;<span class="op" id="7156360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156365">if</span>&nbsp;<span class="ident" id="7156368">err</span>&nbsp;<span class="op" id="7156372">:=</span>&nbsp;<span class="ident" id="7156375">w</span><span class="op" id="7156376">.</span><span class="ident" id="7156377">Close</span><span class="op" id="7156382">(</span><span class="op" id="7156383">)</span><span class="op" id="7156384">;</span>&nbsp;<span class="ident" id="7156386">err</span>&nbsp;<span class="op" id="7156390">!=</span>&nbsp;<span class="builtintype" id="7156393">nil</span>&nbsp;<span class="op" id="7156397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156403">t</span><span class="op" id="7156404">.</span><span class="ident" id="7156405">Errorf</span><span class="op" id="7156411">(</span><span class="string" id="7156412">&#34;testSync:&nbsp;close:&nbsp;%v&#34;</span><span class="op" id="7156433">,</span>&nbsp;<span class="ident" id="7156435">err</span><span class="op" id="7156438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7156443">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7156447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156451">buf</span><span class="op" id="7156454">.</span><span class="ident" id="7156455">ReadMode</span><span class="op" id="7156463">(</span><span class="op" id="7156464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156468">out</span>&nbsp;<span class="op" id="7156472">:=</span>&nbsp;<span class="builtinfunc" id="7156475">make</span><span class="op" id="7156479">(</span><span class="op" id="7156480">[</span><span class="op" id="7156481">]</span><span class="builtintype" id="7156482">byte</span><span class="op" id="7156486">,</span>&nbsp;<span class="ident" id="7156488">hi</span><span class="op" id="7156490">-</span><span class="ident" id="7156491">lo</span><span class="op" id="7156493">+</span><span class="num" id="7156494">1</span><span class="op" id="7156495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156499">m</span><span class="op" id="7156500">,</span>&nbsp;<span class="ident" id="7156502">err</span>&nbsp;<span class="op" id="7156506">:=</span>&nbsp;<span class="ident" id="7156509">io</span><span class="op" id="7156511">.</span><span class="ident" id="7156512">ReadAtLeast</span><span class="op" id="7156523">(</span><span class="ident" id="7156524">r</span><span class="op" id="7156525">,</span>&nbsp;<span class="ident" id="7156527">out</span><span class="op" id="7156530">,</span>&nbsp;<span class="ident" id="7156532">hi</span><span class="op" id="7156534">-</span><span class="ident" id="7156535">lo</span><span class="op" id="7156537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156541">t</span><span class="op" id="7156542">.</span><span class="ident" id="7156543">Logf</span><span class="op" id="7156547">(</span><span class="string" id="7156548">&#34;#%d:&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7156562">,</span>&nbsp;<span class="ident" id="7156564">i</span><span class="op" id="7156565">,</span>&nbsp;<span class="ident" id="7156567">m</span><span class="op" id="7156568">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156572">if</span>&nbsp;<span class="ident" id="7156575">m</span>&nbsp;<span class="op" id="7156577">!=</span>&nbsp;<span class="ident" id="7156580">hi</span><span class="op" id="7156582">-</span><span class="ident" id="7156583">lo</span>&nbsp;<span class="op" id="7156586">||</span>&nbsp;<span class="ident" id="7156589">err</span>&nbsp;<span class="op" id="7156593">!=</span>&nbsp;<span class="builtintype" id="7156596">nil</span>&nbsp;<span class="op" id="7156600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156605">t</span><span class="op" id="7156606">.</span><span class="ident" id="7156607">Errorf</span><span class="op" id="7156613">(</span><span class="string" id="7156614">&#34;testSync/%d&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;read&nbsp;%d:&nbsp;%d,&nbsp;%v&nbsp;(%d&nbsp;left)&#34;</span><span class="op" id="7156667">,</span>&nbsp;<span class="ident" id="7156669">i</span><span class="op" id="7156670">,</span>&nbsp;<span class="ident" id="7156672">level</span><span class="op" id="7156677">,</span>&nbsp;<span class="builtinfunc" id="7156679">len</span><span class="op" id="7156682">(</span><span class="ident" id="7156683">input</span><span class="op" id="7156688">)</span><span class="op" id="7156689">,</span>&nbsp;<span class="ident" id="7156691">name</span><span class="op" id="7156695">,</span>&nbsp;<span class="ident" id="7156697">hi</span><span class="op" id="7156699">-</span><span class="ident" id="7156700">lo</span><span class="op" id="7156702">,</span>&nbsp;<span class="ident" id="7156704">m</span><span class="op" id="7156705">,</span>&nbsp;<span class="ident" id="7156707">err</span><span class="op" id="7156710">,</span>&nbsp;<span class="ident" id="7156712">buf</span><span class="op" id="7156715">.</span><span class="ident" id="7156716">buf</span><span class="op" id="7156719">.</span><span class="ident" id="7156720">Len</span><span class="op" id="7156723">(</span><span class="op" id="7156724">)</span><span class="op" id="7156725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156730">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7156739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156743">if</span>&nbsp;<span class="op" id="7156746">!</span><span class="ident" id="7156747">bytes</span><span class="op" id="7156752">.</span><span class="ident" id="7156753">Equal</span><span class="op" id="7156758">(</span><span class="ident" id="7156759">input</span><span class="op" id="7156764">[</span><span class="ident" id="7156765">lo</span><span class="op" id="7156767">:</span><span class="ident" id="7156768">hi</span><span class="op" id="7156770">]</span><span class="op" id="7156771">,</span>&nbsp;<span class="ident" id="7156773">out</span><span class="op" id="7156776">[</span><span class="op" id="7156777">:</span><span class="ident" id="7156778">hi</span><span class="op" id="7156780">-</span><span class="ident" id="7156781">lo</span><span class="op" id="7156783">]</span><span class="op" id="7156784">)</span>&nbsp;<span class="op" id="7156786">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156791">t</span><span class="op" id="7156792">.</span><span class="ident" id="7156793">Errorf</span><span class="op" id="7156799">(</span><span class="string" id="7156800">&#34;testSync/%d:&nbsp;read&nbsp;wrong&nbsp;bytes:&nbsp;%x&nbsp;vs&nbsp;%x&#34;</span><span class="op" id="7156841">,</span>&nbsp;<span class="ident" id="7156843">i</span><span class="op" id="7156844">,</span>&nbsp;<span class="ident" id="7156846">input</span><span class="op" id="7156851">[</span><span class="ident" id="7156852">lo</span><span class="op" id="7156854">:</span><span class="ident" id="7156855">hi</span><span class="op" id="7156857">]</span><span class="op" id="7156858">,</span>&nbsp;<span class="ident" id="7156860">out</span><span class="op" id="7156863">[</span><span class="op" id="7156864">:</span><span class="ident" id="7156865">hi</span><span class="op" id="7156867">-</span><span class="ident" id="7156868">lo</span><span class="op" id="7156870">]</span><span class="op" id="7156871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156876">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7156885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7156889">//&nbsp;This&nbsp;test&nbsp;originally&nbsp;checked&nbsp;that&nbsp;after&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7156942">//&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;input,&nbsp;there&nbsp;was&nbsp;nothing&nbsp;left</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7156999">//&nbsp;in&nbsp;the&nbsp;read&nbsp;buffer&nbsp;(buf.buf.Len()&nbsp;!=&nbsp;0)&nbsp;but&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7157056">//&nbsp;not&nbsp;necessarily&nbsp;the&nbsp;case:&nbsp;the&nbsp;write&nbsp;Flush&nbsp;may&nbsp;emit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7157112">//&nbsp;some&nbsp;extra&nbsp;framing&nbsp;bits&nbsp;that&nbsp;are&nbsp;not&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7157164">//&nbsp;to&nbsp;process&nbsp;to&nbsp;obtain&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;uncompressed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7157225">//&nbsp;data.&nbsp;&nbsp;The&nbsp;test&nbsp;ran&nbsp;correctly&nbsp;most&nbsp;of&nbsp;the&nbsp;time,&nbsp;because</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7157286">//&nbsp;the&nbsp;background&nbsp;goroutine&nbsp;had&nbsp;usually&nbsp;read&nbsp;even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7157338">//&nbsp;those&nbsp;extra&nbsp;bits&nbsp;by&nbsp;now,&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;useful&nbsp;thing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7157399">//&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157411">buf</span><span class="op" id="7157414">.</span><span class="ident" id="7157415">WriteMode</span><span class="op" id="7157424">(</span><span class="op" id="7157425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7157428">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157431">buf</span><span class="op" id="7157434">.</span><span class="ident" id="7157435">ReadMode</span><span class="op" id="7157443">(</span><span class="op" id="7157444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157447">out</span>&nbsp;<span class="op" id="7157451">:=</span>&nbsp;<span class="builtinfunc" id="7157454">make</span><span class="op" id="7157458">(</span><span class="op" id="7157459">[</span><span class="op" id="7157460">]</span><span class="builtintype" id="7157461">byte</span><span class="op" id="7157465">,</span>&nbsp;<span class="num" id="7157467">10</span><span class="op" id="7157469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157472">if</span>&nbsp;<span class="ident" id="7157475">n</span><span class="op" id="7157476">,</span>&nbsp;<span class="ident" id="7157478">err</span>&nbsp;<span class="op" id="7157482">:=</span>&nbsp;<span class="ident" id="7157485">r</span><span class="op" id="7157486">.</span><span class="ident" id="7157487">Read</span><span class="op" id="7157491">(</span><span class="ident" id="7157492">out</span><span class="op" id="7157495">)</span><span class="op" id="7157496">;</span>&nbsp;<span class="ident" id="7157498">n</span>&nbsp;<span class="op" id="7157500">&gt;</span>&nbsp;<span class="num" id="7157502">0</span>&nbsp;<span class="op" id="7157504">||</span>&nbsp;<span class="ident" id="7157507">err</span>&nbsp;<span class="op" id="7157511">!=</span>&nbsp;<span class="ident" id="7157514">io</span><span class="op" id="7157516">.</span><span class="ident" id="7157517">EOF</span>&nbsp;<span class="op" id="7157521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157525">t</span><span class="op" id="7157526">.</span><span class="ident" id="7157527">Errorf</span><span class="op" id="7157533">(</span><span class="string" id="7157534">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;final&nbsp;Read:&nbsp;%d,&nbsp;%v&nbsp;(hex:&nbsp;%x)&#34;</span><span class="op" id="7157587">,</span>&nbsp;<span class="ident" id="7157589">level</span><span class="op" id="7157594">,</span>&nbsp;<span class="builtinfunc" id="7157596">len</span><span class="op" id="7157599">(</span><span class="ident" id="7157600">input</span><span class="op" id="7157605">)</span><span class="op" id="7157606">,</span>&nbsp;<span class="ident" id="7157608">name</span><span class="op" id="7157612">,</span>&nbsp;<span class="ident" id="7157614">n</span><span class="op" id="7157615">,</span>&nbsp;<span class="ident" id="7157617">err</span><span class="op" id="7157620">,</span>&nbsp;<span class="ident" id="7157622">out</span><span class="op" id="7157625">[</span><span class="num" id="7157626">0</span><span class="op" id="7157627">:</span><span class="ident" id="7157628">n</span><span class="op" id="7157629">]</span><span class="op" id="7157630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7157633">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157636">if</span>&nbsp;<span class="ident" id="7157639">buf</span><span class="op" id="7157642">.</span><span class="ident" id="7157643">buf</span><span class="op" id="7157646">.</span><span class="ident" id="7157647">Len</span><span class="op" id="7157650">(</span><span class="op" id="7157651">)</span>&nbsp;<span class="op" id="7157653">!=</span>&nbsp;<span class="num" id="7157656">0</span>&nbsp;<span class="op" id="7157658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157662">t</span><span class="op" id="7157663">.</span><span class="ident" id="7157664">Errorf</span><span class="op" id="7157670">(</span><span class="string" id="7157671">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;extra&nbsp;data&nbsp;at&nbsp;end&#34;</span><span class="op" id="7157713">,</span>&nbsp;<span class="ident" id="7157715">level</span><span class="op" id="7157720">,</span>&nbsp;<span class="builtinfunc" id="7157722">len</span><span class="op" id="7157725">(</span><span class="ident" id="7157726">input</span><span class="op" id="7157731">)</span><span class="op" id="7157732">,</span>&nbsp;<span class="ident" id="7157734">name</span><span class="op" id="7157738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7157741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157744">r</span><span class="op" id="7157745">.</span><span class="ident" id="7157746">Close</span><span class="op" id="7157751">(</span><span class="op" id="7157752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7157756">//&nbsp;stream&nbsp;should&nbsp;work&nbsp;for&nbsp;ordinary&nbsp;reader&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157803">r</span>&nbsp;<span class="op" id="7157805">=</span>&nbsp;<span class="ident" id="7157807">NewReader</span><span class="op" id="7157816">(</span><span class="ident" id="7157817">buf1</span><span class="op" id="7157821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157824">out</span><span class="op" id="7157827">,</span>&nbsp;<span class="ident" id="7157829">err</span>&nbsp;<span class="op" id="7157833">=</span>&nbsp;<span class="ident" id="7157835">ioutil</span><span class="op" id="7157841">.</span><span class="ident" id="7157842">ReadAll</span><span class="op" id="7157849">(</span><span class="ident" id="7157850">r</span><span class="op" id="7157851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157854">if</span>&nbsp;<span class="ident" id="7157857">err</span>&nbsp;<span class="op" id="7157861">!=</span>&nbsp;<span class="builtintype" id="7157864">nil</span>&nbsp;<span class="op" id="7157868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157872">t</span><span class="op" id="7157873">.</span><span class="ident" id="7157874">Errorf</span><span class="op" id="7157880">(</span><span class="string" id="7157881">&#34;testSync:&nbsp;read:&nbsp;%s&#34;</span><span class="op" id="7157901">,</span>&nbsp;<span class="ident" id="7157903">err</span><span class="op" id="7157906">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157910">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7157918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157921">r</span><span class="op" id="7157922">.</span><span class="ident" id="7157923">Close</span><span class="op" id="7157928">(</span><span class="op" id="7157929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157932">if</span>&nbsp;<span class="op" id="7157935">!</span><span class="ident" id="7157936">bytes</span><span class="op" id="7157941">.</span><span class="ident" id="7157942">Equal</span><span class="op" id="7157947">(</span><span class="ident" id="7157948">input</span><span class="op" id="7157953">,</span>&nbsp;<span class="ident" id="7157955">out</span><span class="op" id="7157958">)</span>&nbsp;<span class="op" id="7157960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157964">t</span><span class="op" id="7157965">.</span><span class="ident" id="7157966">Errorf</span><span class="op" id="7157972">(</span><span class="string" id="7157973">&#34;testSync:&nbsp;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="7158038">,</span>&nbsp;<span class="ident" id="7158040">level</span><span class="op" id="7158045">,</span>&nbsp;<span class="ident" id="7158047">name</span><span class="op" id="7158051">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7158054">}</span><br>
<span class="lineno"></span><span class="op" id="7158056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7158059">func</span>&nbsp;<span class="ident" id="7158064">testToFromWithLevelAndLimit</span><span class="op" id="7158091">(</span><span class="ident" id="7158092">t</span>&nbsp;<span class="op" id="7158094">*</span><span class="ident" id="7158095">testing</span><span class="op" id="7158102">.</span><span class="ident" id="7158103">T</span><span class="op" id="7158104">,</span>&nbsp;<span class="ident" id="7158106">level</span>&nbsp;<span class="builtintype" id="7158112">int</span><span class="op" id="7158115">,</span>&nbsp;<span class="ident" id="7158117">input</span>&nbsp;<span class="op" id="7158123">[</span><span class="op" id="7158124">]</span><span class="builtintype" id="7158125">byte</span><span class="op" id="7158129">,</span>&nbsp;<span class="ident" id="7158131">name</span>&nbsp;<span class="builtintype" id="7158136">string</span><span class="op" id="7158142">,</span>&nbsp;<span class="ident" id="7158144">limit</span>&nbsp;<span class="builtintype" id="7158150">int</span><span class="op" id="7158153">)</span>&nbsp;<span class="op" id="7158155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158158">var</span>&nbsp;<span class="ident" id="7158162">buffer</span>&nbsp;<span class="ident" id="7158169">bytes</span><span class="op" id="7158174">.</span><span class="ident" id="7158175">Buffer</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158183">w</span><span class="op" id="7158184">,</span>&nbsp;<span class="ident" id="7158186">err</span>&nbsp;<span class="op" id="7158190">:=</span>&nbsp;<span class="ident" id="7158193">NewWriter</span><span class="op" id="7158202">(</span><span class="op" id="7158203">&amp;</span><span class="ident" id="7158204">buffer</span><span class="op" id="7158210">,</span>&nbsp;<span class="ident" id="7158212">level</span><span class="op" id="7158217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158220">if</span>&nbsp;<span class="ident" id="7158223">err</span>&nbsp;<span class="op" id="7158227">!=</span>&nbsp;<span class="builtintype" id="7158230">nil</span>&nbsp;<span class="op" id="7158234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158238">t</span><span class="op" id="7158239">.</span><span class="ident" id="7158240">Errorf</span><span class="op" id="7158246">(</span><span class="string" id="7158247">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7158262">,</span>&nbsp;<span class="ident" id="7158264">err</span><span class="op" id="7158267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158271">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7158279">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158282">w</span><span class="op" id="7158283">.</span><span class="ident" id="7158284">Write</span><span class="op" id="7158289">(</span><span class="ident" id="7158290">input</span><span class="op" id="7158295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158298">w</span><span class="op" id="7158299">.</span><span class="ident" id="7158300">Close</span><span class="op" id="7158305">(</span><span class="op" id="7158306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158309">if</span>&nbsp;<span class="ident" id="7158312">limit</span>&nbsp;<span class="op" id="7158318">&gt;</span>&nbsp;<span class="num" id="7158320">0</span>&nbsp;<span class="op" id="7158322">&amp;&amp;</span>&nbsp;<span class="ident" id="7158325">buffer</span><span class="op" id="7158331">.</span><span class="ident" id="7158332">Len</span><span class="op" id="7158335">(</span><span class="op" id="7158336">)</span>&nbsp;<span class="op" id="7158338">&gt;</span>&nbsp;<span class="ident" id="7158340">limit</span>&nbsp;<span class="op" id="7158346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158350">t</span><span class="op" id="7158351">.</span><span class="ident" id="7158352">Errorf</span><span class="op" id="7158358">(</span><span class="string" id="7158359">&#34;level:&nbsp;%d,&nbsp;len(compress(data))&nbsp;=&nbsp;%d&nbsp;&gt;&nbsp;limit&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7158409">,</span>&nbsp;<span class="ident" id="7158411">level</span><span class="op" id="7158416">,</span>&nbsp;<span class="ident" id="7158418">buffer</span><span class="op" id="7158424">.</span><span class="ident" id="7158425">Len</span><span class="op" id="7158428">(</span><span class="op" id="7158429">)</span><span class="op" id="7158430">,</span>&nbsp;<span class="ident" id="7158432">limit</span><span class="op" id="7158437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158441">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7158449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158452">r</span>&nbsp;<span class="op" id="7158454">:=</span>&nbsp;<span class="ident" id="7158457">NewReader</span><span class="op" id="7158466">(</span><span class="op" id="7158467">&amp;</span><span class="ident" id="7158468">buffer</span><span class="op" id="7158474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158477">out</span><span class="op" id="7158480">,</span>&nbsp;<span class="ident" id="7158482">err</span>&nbsp;<span class="op" id="7158486">:=</span>&nbsp;<span class="ident" id="7158489">ioutil</span><span class="op" id="7158495">.</span><span class="ident" id="7158496">ReadAll</span><span class="op" id="7158503">(</span><span class="ident" id="7158504">r</span><span class="op" id="7158505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158508">if</span>&nbsp;<span class="ident" id="7158511">err</span>&nbsp;<span class="op" id="7158515">!=</span>&nbsp;<span class="builtintype" id="7158518">nil</span>&nbsp;<span class="op" id="7158522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158526">t</span><span class="op" id="7158527">.</span><span class="ident" id="7158528">Errorf</span><span class="op" id="7158534">(</span><span class="string" id="7158535">&#34;read:&nbsp;%s&#34;</span><span class="op" id="7158545">,</span>&nbsp;<span class="ident" id="7158547">err</span><span class="op" id="7158550">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158554">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7158562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158565">r</span><span class="op" id="7158566">.</span><span class="ident" id="7158567">Close</span><span class="op" id="7158572">(</span><span class="op" id="7158573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158576">if</span>&nbsp;<span class="op" id="7158579">!</span><span class="ident" id="7158580">bytes</span><span class="op" id="7158585">.</span><span class="ident" id="7158586">Equal</span><span class="op" id="7158591">(</span><span class="ident" id="7158592">input</span><span class="op" id="7158597">,</span>&nbsp;<span class="ident" id="7158599">out</span><span class="op" id="7158602">)</span>&nbsp;<span class="op" id="7158604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158608">t</span><span class="op" id="7158609">.</span><span class="ident" id="7158610">Errorf</span><span class="op" id="7158616">(</span><span class="string" id="7158617">&#34;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="7158672">,</span>&nbsp;<span class="ident" id="7158674">level</span><span class="op" id="7158679">,</span>&nbsp;<span class="ident" id="7158681">name</span><span class="op" id="7158685">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158689">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7158697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158700">testSync</span><span class="op" id="7158708">(</span><span class="ident" id="7158709">t</span><span class="op" id="7158710">,</span>&nbsp;<span class="ident" id="7158712">level</span><span class="op" id="7158717">,</span>&nbsp;<span class="ident" id="7158719">input</span><span class="op" id="7158724">,</span>&nbsp;<span class="ident" id="7158726">name</span><span class="op" id="7158730">)</span><br>
<span class="lineno"></span><span class="op" id="7158732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="7158735">func</span>&nbsp;<span class="ident" id="7158740">testToFromWithLimit</span><span class="op" id="7158759">(</span><span class="ident" id="7158760">t</span>&nbsp;<span class="op" id="7158762">*</span><span class="ident" id="7158763">testing</span><span class="op" id="7158770">.</span><span class="ident" id="7158771">T</span><span class="op" id="7158772">,</span>&nbsp;<span class="ident" id="7158774">input</span>&nbsp;<span class="op" id="7158780">[</span><span class="op" id="7158781">]</span><span class="builtintype" id="7158782">byte</span><span class="op" id="7158786">,</span>&nbsp;<span class="ident" id="7158788">name</span>&nbsp;<span class="builtintype" id="7158793">string</span><span class="op" id="7158799">,</span>&nbsp;<span class="ident" id="7158801">limit</span>&nbsp;<span class="op" id="7158807">[</span><span class="num" id="7158808">10</span><span class="op" id="7158810">]</span><span class="builtintype" id="7158811">int</span><span class="op" id="7158814">)</span>&nbsp;<span class="op" id="7158816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158819">for</span>&nbsp;<span class="ident" id="7158823">i</span>&nbsp;<span class="op" id="7158825">:=</span>&nbsp;<span class="num" id="7158828">0</span><span class="op" id="7158829">;</span>&nbsp;<span class="ident" id="7158831">i</span>&nbsp;<span class="op" id="7158833">&lt;</span>&nbsp;<span class="num" id="7158835">10</span><span class="op" id="7158837">;</span>&nbsp;<span class="ident" id="7158839">i</span><span class="op" id="7158840">++</span>&nbsp;<span class="op" id="7158843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158847">testToFromWithLevelAndLimit</span><span class="op" id="7158874">(</span><span class="ident" id="7158875">t</span><span class="op" id="7158876">,</span>&nbsp;<span class="ident" id="7158878">i</span><span class="op" id="7158879">,</span>&nbsp;<span class="ident" id="7158881">input</span><span class="op" id="7158886">,</span>&nbsp;<span class="ident" id="7158888">name</span><span class="op" id="7158892">,</span>&nbsp;<span class="ident" id="7158894">limit</span><span class="op" id="7158899">[</span><span class="ident" id="7158900">i</span><span class="op" id="7158901">]</span><span class="op" id="7158902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7158905">}</span><br>
<span class="lineno"></span><span class="op" id="7158907">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="7158910">func</span>&nbsp;<span class="ident" id="7158915">TestDeflateInflate</span><span class="op" id="7158933">(</span><span class="ident" id="7158934">t</span>&nbsp;<span class="op" id="7158936">*</span><span class="ident" id="7158937">testing</span><span class="op" id="7158944">.</span><span class="ident" id="7158945">T</span><span class="op" id="7158946">)</span>&nbsp;<span class="op" id="7158948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158951">for</span>&nbsp;<span class="ident" id="7158955">i</span><span class="op" id="7158956">,</span>&nbsp;<span class="ident" id="7158958">h</span>&nbsp;<span class="op" id="7158960">:=</span>&nbsp;<span class="keyword" id="7158963">range</span>&nbsp;<span class="ident" id="7158969">deflateInflateTests</span>&nbsp;<span class="op" id="7158989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158993">testToFromWithLimit</span><span class="op" id="7159012">(</span><span class="ident" id="7159013">t</span><span class="op" id="7159014">,</span>&nbsp;<span class="ident" id="7159016">h</span><span class="op" id="7159017">.</span><span class="ident" id="7159018">in</span><span class="op" id="7159020">,</span>&nbsp;<span class="ident" id="7159022">fmt</span><span class="op" id="7159025">.</span><span class="ident" id="7159026">Sprintf</span><span class="op" id="7159033">(</span><span class="string" id="7159034">&#34;#%d&#34;</span><span class="op" id="7159039">,</span>&nbsp;<span class="ident" id="7159041">i</span><span class="op" id="7159042">)</span><span class="op" id="7159043">,</span>&nbsp;<span class="op" id="7159045">[</span><span class="num" id="7159046">10</span><span class="op" id="7159048">]</span><span class="builtintype" id="7159049">int</span><span class="op" id="7159052">{</span><span class="op" id="7159053">}</span><span class="op" id="7159054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159057">}</span><br>
<span class="lineno">315</span><span class="op" id="7159059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7159062">func</span>&nbsp;<span class="ident" id="7159067">TestReverseBits</span><span class="op" id="7159082">(</span><span class="ident" id="7159083">t</span>&nbsp;<span class="op" id="7159085">*</span><span class="ident" id="7159086">testing</span><span class="op" id="7159093">.</span><span class="ident" id="7159094">T</span><span class="op" id="7159095">)</span>&nbsp;<span class="op" id="7159097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159100">for</span>&nbsp;<span class="ident" id="7159104">_</span><span class="op" id="7159105">,</span>&nbsp;<span class="ident" id="7159107">h</span>&nbsp;<span class="op" id="7159109">:=</span>&nbsp;<span class="keyword" id="7159112">range</span>&nbsp;<span class="ident" id="7159118">reverseBitsTests</span>&nbsp;<span class="op" id="7159135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159139">if</span>&nbsp;<span class="ident" id="7159142">v</span>&nbsp;<span class="op" id="7159144">:=</span>&nbsp;<span class="ident" id="7159147">reverseBits</span><span class="op" id="7159158">(</span><span class="ident" id="7159159">h</span><span class="op" id="7159160">.</span><span class="ident" id="7159161">in</span><span class="op" id="7159163">,</span>&nbsp;<span class="ident" id="7159165">h</span><span class="op" id="7159166">.</span><span class="ident" id="7159167">bitCount</span><span class="op" id="7159175">)</span><span class="op" id="7159176">;</span>&nbsp;<span class="ident" id="7159178">v</span>&nbsp;<span class="op" id="7159180">!=</span>&nbsp;<span class="ident" id="7159183">h</span><span class="op" id="7159184">.</span><span class="ident" id="7159185">out</span>&nbsp;<span class="op" id="7159189">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159194">t</span><span class="op" id="7159195">.</span><span class="ident" id="7159196">Errorf</span><span class="op" id="7159202">(</span><span class="string" id="7159203">&#34;reverseBits(%v,%v)&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7159237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159243">h</span><span class="op" id="7159244">.</span><span class="ident" id="7159245">in</span><span class="op" id="7159247">,</span>&nbsp;<span class="ident" id="7159249">h</span><span class="op" id="7159250">.</span><span class="ident" id="7159251">bitCount</span><span class="op" id="7159259">,</span>&nbsp;<span class="ident" id="7159261">v</span><span class="op" id="7159262">,</span>&nbsp;<span class="ident" id="7159264">h</span><span class="op" id="7159265">.</span><span class="ident" id="7159266">out</span><span class="op" id="7159269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159276">}</span><br>
<span class="lineno"></span><span class="op" id="7159278">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="7159281">type</span>&nbsp;<span class="ident" id="7159286">deflateInflateStringTest</span>&nbsp;<span class="keyword" id="7159311">struct</span>&nbsp;<span class="op" id="7159318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159321">filename</span>&nbsp;<span class="builtintype" id="7159330">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159338">label</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7159347">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159355">limit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159364">[</span><span class="num" id="7159365">10</span><span class="op" id="7159367">]</span><span class="builtintype" id="7159368">int</span><br>
<span class="lineno">330</span><span class="op" id="7159372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7159375">var</span>&nbsp;<span class="ident" id="7159379">deflateInflateStringTests</span>&nbsp;<span class="op" id="7159405">=</span>&nbsp;<span class="op" id="7159407">[</span><span class="op" id="7159408">]</span><span class="ident" id="7159409">deflateInflateStringTest</span><span class="op" id="7159433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7159440">&#34;../testdata/e.txt&#34;</span><span class="op" id="7159459">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7159463">&#34;2.718281828...&#34;</span><span class="op" id="7159479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159483">[</span><span class="op" id="7159484">...</span><span class="op" id="7159487">]</span><span class="builtintype" id="7159488">int</span><span class="op" id="7159491">{</span><span class="num" id="7159492">100018</span><span class="op" id="7159498">,</span>&nbsp;<span class="num" id="7159500">50650</span><span class="op" id="7159505">,</span>&nbsp;<span class="num" id="7159507">50960</span><span class="op" id="7159512">,</span>&nbsp;<span class="num" id="7159514">51150</span><span class="op" id="7159519">,</span>&nbsp;<span class="num" id="7159521">50930</span><span class="op" id="7159526">,</span>&nbsp;<span class="num" id="7159528">50790</span><span class="op" id="7159533">,</span>&nbsp;<span class="num" id="7159535">50790</span><span class="op" id="7159540">,</span>&nbsp;<span class="num" id="7159542">50790</span><span class="op" id="7159547">,</span>&nbsp;<span class="num" id="7159549">50790</span><span class="op" id="7159554">,</span>&nbsp;<span class="num" id="7159556">50790</span><span class="op" id="7159561">}</span><span class="op" id="7159562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159565">}</span><span class="op" id="7159566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7159573">&#34;../testdata/Mark.Twain-Tom.Sawyer.txt&#34;</span><span class="op" id="7159612">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7159616">&#34;Mark.Twain-Tom.Sawyer&#34;</span><span class="op" id="7159639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159643">[</span><span class="op" id="7159644">...</span><span class="op" id="7159647">]</span><span class="builtintype" id="7159648">int</span><span class="op" id="7159651">{</span><span class="num" id="7159652">407330</span><span class="op" id="7159658">,</span>&nbsp;<span class="num" id="7159660">187598</span><span class="op" id="7159666">,</span>&nbsp;<span class="num" id="7159668">180361</span><span class="op" id="7159674">,</span>&nbsp;<span class="num" id="7159676">172974</span><span class="op" id="7159682">,</span>&nbsp;<span class="num" id="7159684">169160</span><span class="op" id="7159690">,</span>&nbsp;<span class="num" id="7159692">163476</span><span class="op" id="7159698">,</span>&nbsp;<span class="num" id="7159700">160936</span><span class="op" id="7159706">,</span>&nbsp;<span class="num" id="7159708">160506</span><span class="op" id="7159714">,</span>&nbsp;<span class="num" id="7159716">160295</span><span class="op" id="7159722">,</span>&nbsp;<span class="num" id="7159724">160295</span><span class="op" id="7159730">}</span><span class="op" id="7159731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159734">}</span><span class="op" id="7159735">,</span><br>
<span class="lineno"></span><span class="op" id="7159737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="7159740">func</span>&nbsp;<span class="ident" id="7159745">TestDeflateInflateString</span><span class="op" id="7159769">(</span><span class="ident" id="7159770">t</span>&nbsp;<span class="op" id="7159772">*</span><span class="ident" id="7159773">testing</span><span class="op" id="7159780">.</span><span class="ident" id="7159781">T</span><span class="op" id="7159782">)</span>&nbsp;<span class="op" id="7159784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159787">for</span>&nbsp;<span class="ident" id="7159791">_</span><span class="op" id="7159792">,</span>&nbsp;<span class="ident" id="7159794">test</span>&nbsp;<span class="op" id="7159799">:=</span>&nbsp;<span class="keyword" id="7159802">range</span>&nbsp;<span class="ident" id="7159808">deflateInflateStringTests</span>&nbsp;<span class="op" id="7159834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159838">gold</span><span class="op" id="7159842">,</span>&nbsp;<span class="ident" id="7159844">err</span>&nbsp;<span class="op" id="7159848">:=</span>&nbsp;<span class="ident" id="7159851">ioutil</span><span class="op" id="7159857">.</span><span class="ident" id="7159858">ReadFile</span><span class="op" id="7159866">(</span><span class="ident" id="7159867">test</span><span class="op" id="7159871">.</span><span class="ident" id="7159872">filename</span><span class="op" id="7159880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159884">if</span>&nbsp;<span class="ident" id="7159887">err</span>&nbsp;<span class="op" id="7159891">!=</span>&nbsp;<span class="builtintype" id="7159894">nil</span>&nbsp;<span class="op" id="7159898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159903">t</span><span class="op" id="7159904">.</span><span class="ident" id="7159905">Error</span><span class="op" id="7159910">(</span><span class="ident" id="7159911">err</span><span class="op" id="7159914">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159922">testToFromWithLimit</span><span class="op" id="7159941">(</span><span class="ident" id="7159942">t</span><span class="op" id="7159943">,</span>&nbsp;<span class="ident" id="7159945">gold</span><span class="op" id="7159949">,</span>&nbsp;<span class="ident" id="7159951">test</span><span class="op" id="7159955">.</span><span class="ident" id="7159956">label</span><span class="op" id="7159961">,</span>&nbsp;<span class="ident" id="7159963">test</span><span class="op" id="7159967">.</span><span class="ident" id="7159968">limit</span><span class="op" id="7159973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159977">if</span>&nbsp;<span class="ident" id="7159980">testing</span><span class="op" id="7159987">.</span><span class="ident" id="7159988">Short</span><span class="op" id="7159993">(</span><span class="op" id="7159994">)</span>&nbsp;<span class="op" id="7159996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160001">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160009">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160012">}</span><br>
<span class="lineno"></span><span class="op" id="7160014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7160017">func</span>&nbsp;<span class="ident" id="7160022">TestReaderDict</span><span class="op" id="7160036">(</span><span class="ident" id="7160037">t</span>&nbsp;<span class="op" id="7160039">*</span><span class="ident" id="7160040">testing</span><span class="op" id="7160047">.</span><span class="ident" id="7160048">T</span><span class="op" id="7160049">)</span>&nbsp;<span class="op" id="7160051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160054">const</span>&nbsp;<span class="op" id="7160060">(</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160064">dict</span>&nbsp;<span class="op" id="7160069">=</span>&nbsp;<span class="string" id="7160071">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160087">text</span>&nbsp;<span class="op" id="7160092">=</span>&nbsp;<span class="string" id="7160094">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160118">var</span>&nbsp;<span class="ident" id="7160122">b</span>&nbsp;<span class="ident" id="7160124">bytes</span><span class="op" id="7160129">.</span><span class="ident" id="7160130">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160138">w</span><span class="op" id="7160139">,</span>&nbsp;<span class="ident" id="7160141">err</span>&nbsp;<span class="op" id="7160145">:=</span>&nbsp;<span class="ident" id="7160148">NewWriter</span><span class="op" id="7160157">(</span><span class="op" id="7160158">&amp;</span><span class="ident" id="7160159">b</span><span class="op" id="7160160">,</span>&nbsp;<span class="num" id="7160162">5</span><span class="op" id="7160163">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160166">if</span>&nbsp;<span class="ident" id="7160169">err</span>&nbsp;<span class="op" id="7160173">!=</span>&nbsp;<span class="builtintype" id="7160176">nil</span>&nbsp;<span class="op" id="7160180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160184">t</span><span class="op" id="7160185">.</span><span class="ident" id="7160186">Fatalf</span><span class="op" id="7160192">(</span><span class="string" id="7160193">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7160208">,</span>&nbsp;<span class="ident" id="7160210">err</span><span class="op" id="7160213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160219">w</span><span class="op" id="7160220">.</span><span class="ident" id="7160221">Write</span><span class="op" id="7160226">(</span><span class="op" id="7160227">[</span><span class="op" id="7160228">]</span><span class="builtintype" id="7160229">byte</span><span class="op" id="7160233">(</span><span class="ident" id="7160234">dict</span><span class="op" id="7160238">)</span><span class="op" id="7160239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160242">w</span><span class="op" id="7160243">.</span><span class="ident" id="7160244">Flush</span><span class="op" id="7160249">(</span><span class="op" id="7160250">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160253">b</span><span class="op" id="7160254">.</span><span class="ident" id="7160255">Reset</span><span class="op" id="7160260">(</span><span class="op" id="7160261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160264">w</span><span class="op" id="7160265">.</span><span class="ident" id="7160266">Write</span><span class="op" id="7160271">(</span><span class="op" id="7160272">[</span><span class="op" id="7160273">]</span><span class="builtintype" id="7160274">byte</span><span class="op" id="7160278">(</span><span class="ident" id="7160279">text</span><span class="op" id="7160283">)</span><span class="op" id="7160284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160287">w</span><span class="op" id="7160288">.</span><span class="ident" id="7160289">Close</span><span class="op" id="7160294">(</span><span class="op" id="7160295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160299">r</span>&nbsp;<span class="op" id="7160301">:=</span>&nbsp;<span class="ident" id="7160304">NewReaderDict</span><span class="op" id="7160317">(</span><span class="op" id="7160318">&amp;</span><span class="ident" id="7160319">b</span><span class="op" id="7160320">,</span>&nbsp;<span class="op" id="7160322">[</span><span class="op" id="7160323">]</span><span class="builtintype" id="7160324">byte</span><span class="op" id="7160328">(</span><span class="ident" id="7160329">dict</span><span class="op" id="7160333">)</span><span class="op" id="7160334">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160337">data</span><span class="op" id="7160341">,</span>&nbsp;<span class="ident" id="7160343">err</span>&nbsp;<span class="op" id="7160347">:=</span>&nbsp;<span class="ident" id="7160350">ioutil</span><span class="op" id="7160356">.</span><span class="ident" id="7160357">ReadAll</span><span class="op" id="7160364">(</span><span class="ident" id="7160365">r</span><span class="op" id="7160366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160369">if</span>&nbsp;<span class="ident" id="7160372">err</span>&nbsp;<span class="op" id="7160376">!=</span>&nbsp;<span class="builtintype" id="7160379">nil</span>&nbsp;<span class="op" id="7160383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160387">t</span><span class="op" id="7160388">.</span><span class="ident" id="7160389">Fatal</span><span class="op" id="7160394">(</span><span class="ident" id="7160395">err</span><span class="op" id="7160398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160404">if</span>&nbsp;<span class="builtintype" id="7160407">string</span><span class="op" id="7160413">(</span><span class="ident" id="7160414">data</span><span class="op" id="7160418">)</span>&nbsp;<span class="op" id="7160420">!=</span>&nbsp;<span class="string" id="7160423">&#34;hello&nbsp;again&nbsp;world&#34;</span>&nbsp;<span class="op" id="7160443">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160447">t</span><span class="op" id="7160448">.</span><span class="ident" id="7160449">Fatalf</span><span class="op" id="7160455">(</span><span class="string" id="7160456">&#34;read&nbsp;returned&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7160482">,</span>&nbsp;<span class="builtintype" id="7160484">string</span><span class="op" id="7160490">(</span><span class="ident" id="7160491">data</span><span class="op" id="7160495">)</span><span class="op" id="7160496">,</span>&nbsp;<span class="ident" id="7160498">text</span><span class="op" id="7160502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160505">}</span><br>
<span class="lineno"></span><span class="op" id="7160507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7160510">func</span>&nbsp;<span class="ident" id="7160515">TestWriterDict</span><span class="op" id="7160529">(</span><span class="ident" id="7160530">t</span>&nbsp;<span class="op" id="7160532">*</span><span class="ident" id="7160533">testing</span><span class="op" id="7160540">.</span><span class="ident" id="7160541">T</span><span class="op" id="7160542">)</span>&nbsp;<span class="op" id="7160544">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160547">const</span>&nbsp;<span class="op" id="7160553">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160557">dict</span>&nbsp;<span class="op" id="7160562">=</span>&nbsp;<span class="string" id="7160564">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160580">text</span>&nbsp;<span class="op" id="7160585">=</span>&nbsp;<span class="string" id="7160587">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160611">var</span>&nbsp;<span class="ident" id="7160615">b</span>&nbsp;<span class="ident" id="7160617">bytes</span><span class="op" id="7160622">.</span><span class="ident" id="7160623">Buffer</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160631">w</span><span class="op" id="7160632">,</span>&nbsp;<span class="ident" id="7160634">err</span>&nbsp;<span class="op" id="7160638">:=</span>&nbsp;<span class="ident" id="7160641">NewWriter</span><span class="op" id="7160650">(</span><span class="op" id="7160651">&amp;</span><span class="ident" id="7160652">b</span><span class="op" id="7160653">,</span>&nbsp;<span class="num" id="7160655">5</span><span class="op" id="7160656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160659">if</span>&nbsp;<span class="ident" id="7160662">err</span>&nbsp;<span class="op" id="7160666">!=</span>&nbsp;<span class="builtintype" id="7160669">nil</span>&nbsp;<span class="op" id="7160673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160677">t</span><span class="op" id="7160678">.</span><span class="ident" id="7160679">Fatalf</span><span class="op" id="7160685">(</span><span class="string" id="7160686">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7160701">,</span>&nbsp;<span class="ident" id="7160703">err</span><span class="op" id="7160706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160712">w</span><span class="op" id="7160713">.</span><span class="ident" id="7160714">Write</span><span class="op" id="7160719">(</span><span class="op" id="7160720">[</span><span class="op" id="7160721">]</span><span class="builtintype" id="7160722">byte</span><span class="op" id="7160726">(</span><span class="ident" id="7160727">dict</span><span class="op" id="7160731">)</span><span class="op" id="7160732">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160735">w</span><span class="op" id="7160736">.</span><span class="ident" id="7160737">Flush</span><span class="op" id="7160742">(</span><span class="op" id="7160743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160746">b</span><span class="op" id="7160747">.</span><span class="ident" id="7160748">Reset</span><span class="op" id="7160753">(</span><span class="op" id="7160754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160757">w</span><span class="op" id="7160758">.</span><span class="ident" id="7160759">Write</span><span class="op" id="7160764">(</span><span class="op" id="7160765">[</span><span class="op" id="7160766">]</span><span class="builtintype" id="7160767">byte</span><span class="op" id="7160771">(</span><span class="ident" id="7160772">text</span><span class="op" id="7160776">)</span><span class="op" id="7160777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160780">w</span><span class="op" id="7160781">.</span><span class="ident" id="7160782">Close</span><span class="op" id="7160787">(</span><span class="op" id="7160788">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160792">var</span>&nbsp;<span class="ident" id="7160796">b1</span>&nbsp;<span class="ident" id="7160799">bytes</span><span class="op" id="7160804">.</span><span class="ident" id="7160805">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160813">w</span><span class="op" id="7160814">,</span>&nbsp;<span class="ident" id="7160816">_</span>&nbsp;<span class="op" id="7160818">=</span>&nbsp;<span class="ident" id="7160820">NewWriterDict</span><span class="op" id="7160833">(</span><span class="op" id="7160834">&amp;</span><span class="ident" id="7160835">b1</span><span class="op" id="7160837">,</span>&nbsp;<span class="num" id="7160839">5</span><span class="op" id="7160840">,</span>&nbsp;<span class="op" id="7160842">[</span><span class="op" id="7160843">]</span><span class="builtintype" id="7160844">byte</span><span class="op" id="7160848">(</span><span class="ident" id="7160849">dict</span><span class="op" id="7160853">)</span><span class="op" id="7160854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160857">w</span><span class="op" id="7160858">.</span><span class="ident" id="7160859">Write</span><span class="op" id="7160864">(</span><span class="op" id="7160865">[</span><span class="op" id="7160866">]</span><span class="builtintype" id="7160867">byte</span><span class="op" id="7160871">(</span><span class="ident" id="7160872">text</span><span class="op" id="7160876">)</span><span class="op" id="7160877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160880">w</span><span class="op" id="7160881">.</span><span class="ident" id="7160882">Close</span><span class="op" id="7160887">(</span><span class="op" id="7160888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160892">if</span>&nbsp;<span class="op" id="7160895">!</span><span class="ident" id="7160896">bytes</span><span class="op" id="7160901">.</span><span class="ident" id="7160902">Equal</span><span class="op" id="7160907">(</span><span class="ident" id="7160908">b1</span><span class="op" id="7160910">.</span><span class="ident" id="7160911">Bytes</span><span class="op" id="7160916">(</span><span class="op" id="7160917">)</span><span class="op" id="7160918">,</span>&nbsp;<span class="ident" id="7160920">b</span><span class="op" id="7160921">.</span><span class="ident" id="7160922">Bytes</span><span class="op" id="7160927">(</span><span class="op" id="7160928">)</span><span class="op" id="7160929">)</span>&nbsp;<span class="op" id="7160931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160935">t</span><span class="op" id="7160936">.</span><span class="ident" id="7160937">Fatalf</span><span class="op" id="7160943">(</span><span class="string" id="7160944">&#34;writer&nbsp;wrote&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7160969">,</span>&nbsp;<span class="ident" id="7160971">b1</span><span class="op" id="7160973">.</span><span class="ident" id="7160974">Bytes</span><span class="op" id="7160979">(</span><span class="op" id="7160980">)</span><span class="op" id="7160981">,</span>&nbsp;<span class="ident" id="7160983">b</span><span class="op" id="7160984">.</span><span class="ident" id="7160985">Bytes</span><span class="op" id="7160990">(</span><span class="op" id="7160991">)</span><span class="op" id="7160992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160995">}</span><br>
<span class="lineno"></span><span class="op" id="7160997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="7161000">//&nbsp;See&nbsp;http://code.google.com/p/go/issues/detail?id=2508</span><br>
<span class="lineno"></span><span class="keyword" id="7161057">func</span>&nbsp;<span class="ident" id="7161062">TestRegression2508</span><span class="op" id="7161080">(</span><span class="ident" id="7161081">t</span>&nbsp;<span class="op" id="7161083">*</span><span class="ident" id="7161084">testing</span><span class="op" id="7161091">.</span><span class="ident" id="7161092">T</span><span class="op" id="7161093">)</span>&nbsp;<span class="op" id="7161095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161098">if</span>&nbsp;<span class="ident" id="7161101">testing</span><span class="op" id="7161108">.</span><span class="ident" id="7161109">Short</span><span class="op" id="7161114">(</span><span class="op" id="7161115">)</span>&nbsp;<span class="op" id="7161117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161121">t</span><span class="op" id="7161122">.</span><span class="ident" id="7161123">Logf</span><span class="op" id="7161127">(</span><span class="string" id="7161128">&#34;test&nbsp;disabled&nbsp;with&nbsp;-short&#34;</span><span class="op" id="7161155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161159">return</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161170">w</span><span class="op" id="7161171">,</span>&nbsp;<span class="ident" id="7161173">err</span>&nbsp;<span class="op" id="7161177">:=</span>&nbsp;<span class="ident" id="7161180">NewWriter</span><span class="op" id="7161189">(</span><span class="ident" id="7161190">ioutil</span><span class="op" id="7161196">.</span><span class="ident" id="7161197">Discard</span><span class="op" id="7161204">,</span>&nbsp;<span class="num" id="7161206">1</span><span class="op" id="7161207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161210">if</span>&nbsp;<span class="ident" id="7161213">err</span>&nbsp;<span class="op" id="7161217">!=</span>&nbsp;<span class="builtintype" id="7161220">nil</span>&nbsp;<span class="op" id="7161224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161228">t</span><span class="op" id="7161229">.</span><span class="ident" id="7161230">Fatalf</span><span class="op" id="7161236">(</span><span class="string" id="7161237">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7161252">,</span>&nbsp;<span class="ident" id="7161254">err</span><span class="op" id="7161257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161260">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161263">buf</span>&nbsp;<span class="op" id="7161267">:=</span>&nbsp;<span class="builtinfunc" id="7161270">make</span><span class="op" id="7161274">(</span><span class="op" id="7161275">[</span><span class="op" id="7161276">]</span><span class="builtintype" id="7161277">byte</span><span class="op" id="7161281">,</span>&nbsp;<span class="num" id="7161283">1024</span><span class="op" id="7161287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161290">for</span>&nbsp;<span class="ident" id="7161294">i</span>&nbsp;<span class="op" id="7161296">:=</span>&nbsp;<span class="num" id="7161299">0</span><span class="op" id="7161300">;</span>&nbsp;<span class="ident" id="7161302">i</span>&nbsp;<span class="op" id="7161304">&lt;</span>&nbsp;<span class="num" id="7161306">131072</span><span class="op" id="7161312">;</span>&nbsp;<span class="ident" id="7161314">i</span><span class="op" id="7161315">++</span>&nbsp;<span class="op" id="7161318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161322">if</span>&nbsp;<span class="ident" id="7161325">_</span><span class="op" id="7161326">,</span>&nbsp;<span class="ident" id="7161328">err</span>&nbsp;<span class="op" id="7161332">:=</span>&nbsp;<span class="ident" id="7161335">w</span><span class="op" id="7161336">.</span><span class="ident" id="7161337">Write</span><span class="op" id="7161342">(</span><span class="ident" id="7161343">buf</span><span class="op" id="7161346">)</span><span class="op" id="7161347">;</span>&nbsp;<span class="ident" id="7161349">err</span>&nbsp;<span class="op" id="7161353">!=</span>&nbsp;<span class="builtintype" id="7161356">nil</span>&nbsp;<span class="op" id="7161360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161365">t</span><span class="op" id="7161366">.</span><span class="ident" id="7161367">Fatalf</span><span class="op" id="7161373">(</span><span class="string" id="7161374">&#34;writer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7161393">,</span>&nbsp;<span class="ident" id="7161395">err</span><span class="op" id="7161398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161402">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161408">w</span><span class="op" id="7161409">.</span><span class="ident" id="7161410">Close</span><span class="op" id="7161415">(</span><span class="op" id="7161416">)</span><br>
<span class="lineno"></span><span class="op" id="7161418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7161421">func</span>&nbsp;<span class="ident" id="7161426">TestWriterReset</span><span class="op" id="7161441">(</span><span class="ident" id="7161442">t</span>&nbsp;<span class="op" id="7161444">*</span><span class="ident" id="7161445">testing</span><span class="op" id="7161452">.</span><span class="ident" id="7161453">T</span><span class="op" id="7161454">)</span>&nbsp;<span class="op" id="7161456">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161459">for</span>&nbsp;<span class="ident" id="7161463">level</span>&nbsp;<span class="op" id="7161469">:=</span>&nbsp;<span class="num" id="7161472">0</span><span class="op" id="7161473">;</span>&nbsp;<span class="ident" id="7161475">level</span>&nbsp;<span class="op" id="7161481">&lt;=</span>&nbsp;<span class="num" id="7161484">9</span><span class="op" id="7161485">;</span>&nbsp;<span class="ident" id="7161487">level</span><span class="op" id="7161492">++</span>&nbsp;<span class="op" id="7161495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161499">if</span>&nbsp;<span class="ident" id="7161502">testing</span><span class="op" id="7161509">.</span><span class="ident" id="7161510">Short</span><span class="op" id="7161515">(</span><span class="op" id="7161516">)</span>&nbsp;<span class="op" id="7161518">&amp;&amp;</span>&nbsp;<span class="ident" id="7161521">level</span>&nbsp;<span class="op" id="7161527">&gt;</span>&nbsp;<span class="num" id="7161529">1</span>&nbsp;<span class="op" id="7161531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161536">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161548">w</span><span class="op" id="7161549">,</span>&nbsp;<span class="ident" id="7161551">err</span>&nbsp;<span class="op" id="7161555">:=</span>&nbsp;<span class="ident" id="7161558">NewWriter</span><span class="op" id="7161567">(</span><span class="ident" id="7161568">ioutil</span><span class="op" id="7161574">.</span><span class="ident" id="7161575">Discard</span><span class="op" id="7161582">,</span>&nbsp;<span class="ident" id="7161584">level</span><span class="op" id="7161589">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161593">if</span>&nbsp;<span class="ident" id="7161596">err</span>&nbsp;<span class="op" id="7161600">!=</span>&nbsp;<span class="builtintype" id="7161603">nil</span>&nbsp;<span class="op" id="7161607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161612">t</span><span class="op" id="7161613">.</span><span class="ident" id="7161614">Fatalf</span><span class="op" id="7161620">(</span><span class="string" id="7161621">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7161636">,</span>&nbsp;<span class="ident" id="7161638">err</span><span class="op" id="7161641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161649">buf</span>&nbsp;<span class="op" id="7161653">:=</span>&nbsp;<span class="op" id="7161656">[</span><span class="op" id="7161657">]</span><span class="builtintype" id="7161658">byte</span><span class="op" id="7161662">(</span><span class="string" id="7161663">&#34;hello&nbsp;world&#34;</span><span class="op" id="7161676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161680">for</span>&nbsp;<span class="ident" id="7161684">i</span>&nbsp;<span class="op" id="7161686">:=</span>&nbsp;<span class="num" id="7161689">0</span><span class="op" id="7161690">;</span>&nbsp;<span class="ident" id="7161692">i</span>&nbsp;<span class="op" id="7161694">&lt;</span>&nbsp;<span class="num" id="7161696">1024</span><span class="op" id="7161700">;</span>&nbsp;<span class="ident" id="7161702">i</span><span class="op" id="7161703">++</span>&nbsp;<span class="op" id="7161706">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161711">w</span><span class="op" id="7161712">.</span><span class="ident" id="7161713">Write</span><span class="op" id="7161718">(</span><span class="ident" id="7161719">buf</span><span class="op" id="7161722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161730">w</span><span class="op" id="7161731">.</span><span class="ident" id="7161732">Reset</span><span class="op" id="7161737">(</span><span class="ident" id="7161738">ioutil</span><span class="op" id="7161744">.</span><span class="ident" id="7161745">Discard</span><span class="op" id="7161752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161757">wref</span><span class="op" id="7161761">,</span>&nbsp;<span class="ident" id="7161763">err</span>&nbsp;<span class="op" id="7161767">:=</span>&nbsp;<span class="ident" id="7161770">NewWriter</span><span class="op" id="7161779">(</span><span class="ident" id="7161780">ioutil</span><span class="op" id="7161786">.</span><span class="ident" id="7161787">Discard</span><span class="op" id="7161794">,</span>&nbsp;<span class="ident" id="7161796">level</span><span class="op" id="7161801">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161805">if</span>&nbsp;<span class="ident" id="7161808">err</span>&nbsp;<span class="op" id="7161812">!=</span>&nbsp;<span class="builtintype" id="7161815">nil</span>&nbsp;<span class="op" id="7161819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161824">t</span><span class="op" id="7161825">.</span><span class="ident" id="7161826">Fatalf</span><span class="op" id="7161832">(</span><span class="string" id="7161833">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7161848">,</span>&nbsp;<span class="ident" id="7161850">err</span><span class="op" id="7161853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7161862">//&nbsp;DeepEqual&nbsp;doesn&#39;t&nbsp;compare&nbsp;functions.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161904">w</span><span class="op" id="7161905">.</span><span class="ident" id="7161906">d</span><span class="op" id="7161907">.</span><span class="ident" id="7161908">fill</span><span class="op" id="7161912">,</span>&nbsp;<span class="ident" id="7161914">wref</span><span class="op" id="7161918">.</span><span class="ident" id="7161919">d</span><span class="op" id="7161920">.</span><span class="ident" id="7161921">fill</span>&nbsp;<span class="op" id="7161926">=</span>&nbsp;<span class="builtintype" id="7161928">nil</span><span class="op" id="7161931">,</span>&nbsp;<span class="builtintype" id="7161933">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161939">w</span><span class="op" id="7161940">.</span><span class="ident" id="7161941">d</span><span class="op" id="7161942">.</span><span class="ident" id="7161943">step</span><span class="op" id="7161947">,</span>&nbsp;<span class="ident" id="7161949">wref</span><span class="op" id="7161953">.</span><span class="ident" id="7161954">d</span><span class="op" id="7161955">.</span><span class="ident" id="7161956">step</span>&nbsp;<span class="op" id="7161961">=</span>&nbsp;<span class="builtintype" id="7161963">nil</span><span class="op" id="7161966">,</span>&nbsp;<span class="builtintype" id="7161968">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161974">if</span>&nbsp;<span class="op" id="7161977">!</span><span class="ident" id="7161978">reflect</span><span class="op" id="7161985">.</span><span class="ident" id="7161986">DeepEqual</span><span class="op" id="7161995">(</span><span class="ident" id="7161996">w</span><span class="op" id="7161997">,</span>&nbsp;<span class="ident" id="7161999">wref</span><span class="op" id="7162003">)</span>&nbsp;<span class="op" id="7162005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162010">t</span><span class="op" id="7162011">.</span><span class="ident" id="7162012">Errorf</span><span class="op" id="7162018">(</span><span class="string" id="7162019">&#34;level&nbsp;%d&nbsp;Writer&nbsp;not&nbsp;reset&nbsp;after&nbsp;Reset&#34;</span><span class="op" id="7162058">,</span>&nbsp;<span class="ident" id="7162060">level</span><span class="op" id="7162065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7162069">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7162072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162075">testResetOutput</span><span class="op" id="7162090">(</span><span class="ident" id="7162091">t</span><span class="op" id="7162092">,</span>&nbsp;<span class="keyword" id="7162094">func</span><span class="op" id="7162098">(</span><span class="ident" id="7162099">w</span>&nbsp;<span class="ident" id="7162101">io</span><span class="op" id="7162103">.</span><span class="ident" id="7162104">Writer</span><span class="op" id="7162110">)</span>&nbsp;<span class="op" id="7162112">(</span><span class="op" id="7162113">*</span><span class="ident" id="7162114">Writer</span><span class="op" id="7162120">,</span>&nbsp;<span class="builtintype" id="7162122">error</span><span class="op" id="7162127">)</span>&nbsp;<span class="op" id="7162129">{</span>&nbsp;<span class="keyword" id="7162131">return</span>&nbsp;<span class="ident" id="7162138">NewWriter</span><span class="op" id="7162147">(</span><span class="ident" id="7162148">w</span><span class="op" id="7162149">,</span>&nbsp;<span class="ident" id="7162151">NoCompression</span><span class="op" id="7162164">)</span>&nbsp;<span class="op" id="7162166">}</span><span class="op" id="7162167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162170">testResetOutput</span><span class="op" id="7162185">(</span><span class="ident" id="7162186">t</span><span class="op" id="7162187">,</span>&nbsp;<span class="keyword" id="7162189">func</span><span class="op" id="7162193">(</span><span class="ident" id="7162194">w</span>&nbsp;<span class="ident" id="7162196">io</span><span class="op" id="7162198">.</span><span class="ident" id="7162199">Writer</span><span class="op" id="7162205">)</span>&nbsp;<span class="op" id="7162207">(</span><span class="op" id="7162208">*</span><span class="ident" id="7162209">Writer</span><span class="op" id="7162215">,</span>&nbsp;<span class="builtintype" id="7162217">error</span><span class="op" id="7162222">)</span>&nbsp;<span class="op" id="7162224">{</span>&nbsp;<span class="keyword" id="7162226">return</span>&nbsp;<span class="ident" id="7162233">NewWriter</span><span class="op" id="7162242">(</span><span class="ident" id="7162243">w</span><span class="op" id="7162244">,</span>&nbsp;<span class="ident" id="7162246">DefaultCompression</span><span class="op" id="7162264">)</span>&nbsp;<span class="op" id="7162266">}</span><span class="op" id="7162267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162270">testResetOutput</span><span class="op" id="7162285">(</span><span class="ident" id="7162286">t</span><span class="op" id="7162287">,</span>&nbsp;<span class="keyword" id="7162289">func</span><span class="op" id="7162293">(</span><span class="ident" id="7162294">w</span>&nbsp;<span class="ident" id="7162296">io</span><span class="op" id="7162298">.</span><span class="ident" id="7162299">Writer</span><span class="op" id="7162305">)</span>&nbsp;<span class="op" id="7162307">(</span><span class="op" id="7162308">*</span><span class="ident" id="7162309">Writer</span><span class="op" id="7162315">,</span>&nbsp;<span class="builtintype" id="7162317">error</span><span class="op" id="7162322">)</span>&nbsp;<span class="op" id="7162324">{</span>&nbsp;<span class="keyword" id="7162326">return</span>&nbsp;<span class="ident" id="7162333">NewWriter</span><span class="op" id="7162342">(</span><span class="ident" id="7162343">w</span><span class="op" id="7162344">,</span>&nbsp;<span class="ident" id="7162346">BestCompression</span><span class="op" id="7162361">)</span>&nbsp;<span class="op" id="7162363">}</span><span class="op" id="7162364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162367">dict</span>&nbsp;<span class="op" id="7162372">:=</span>&nbsp;<span class="op" id="7162375">[</span><span class="op" id="7162376">]</span><span class="builtintype" id="7162377">byte</span><span class="op" id="7162381">(</span><span class="string" id="7162382">&#34;we&nbsp;are&nbsp;the&nbsp;world&#34;</span><span class="op" id="7162400">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162403">testResetOutput</span><span class="op" id="7162418">(</span><span class="ident" id="7162419">t</span><span class="op" id="7162420">,</span>&nbsp;<span class="keyword" id="7162422">func</span><span class="op" id="7162426">(</span><span class="ident" id="7162427">w</span>&nbsp;<span class="ident" id="7162429">io</span><span class="op" id="7162431">.</span><span class="ident" id="7162432">Writer</span><span class="op" id="7162438">)</span>&nbsp;<span class="op" id="7162440">(</span><span class="op" id="7162441">*</span><span class="ident" id="7162442">Writer</span><span class="op" id="7162448">,</span>&nbsp;<span class="builtintype" id="7162450">error</span><span class="op" id="7162455">)</span>&nbsp;<span class="op" id="7162457">{</span>&nbsp;<span class="keyword" id="7162459">return</span>&nbsp;<span class="ident" id="7162466">NewWriterDict</span><span class="op" id="7162479">(</span><span class="ident" id="7162480">w</span><span class="op" id="7162481">,</span>&nbsp;<span class="ident" id="7162483">NoCompression</span><span class="op" id="7162496">,</span>&nbsp;<span class="ident" id="7162498">dict</span><span class="op" id="7162502">)</span>&nbsp;<span class="op" id="7162504">}</span><span class="op" id="7162505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162508">testResetOutput</span><span class="op" id="7162523">(</span><span class="ident" id="7162524">t</span><span class="op" id="7162525">,</span>&nbsp;<span class="keyword" id="7162527">func</span><span class="op" id="7162531">(</span><span class="ident" id="7162532">w</span>&nbsp;<span class="ident" id="7162534">io</span><span class="op" id="7162536">.</span><span class="ident" id="7162537">Writer</span><span class="op" id="7162543">)</span>&nbsp;<span class="op" id="7162545">(</span><span class="op" id="7162546">*</span><span class="ident" id="7162547">Writer</span><span class="op" id="7162553">,</span>&nbsp;<span class="builtintype" id="7162555">error</span><span class="op" id="7162560">)</span>&nbsp;<span class="op" id="7162562">{</span>&nbsp;<span class="keyword" id="7162564">return</span>&nbsp;<span class="ident" id="7162571">NewWriterDict</span><span class="op" id="7162584">(</span><span class="ident" id="7162585">w</span><span class="op" id="7162586">,</span>&nbsp;<span class="ident" id="7162588">DefaultCompression</span><span class="op" id="7162606">,</span>&nbsp;<span class="ident" id="7162608">dict</span><span class="op" id="7162612">)</span>&nbsp;<span class="op" id="7162614">}</span><span class="op" id="7162615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162618">testResetOutput</span><span class="op" id="7162633">(</span><span class="ident" id="7162634">t</span><span class="op" id="7162635">,</span>&nbsp;<span class="keyword" id="7162637">func</span><span class="op" id="7162641">(</span><span class="ident" id="7162642">w</span>&nbsp;<span class="ident" id="7162644">io</span><span class="op" id="7162646">.</span><span class="ident" id="7162647">Writer</span><span class="op" id="7162653">)</span>&nbsp;<span class="op" id="7162655">(</span><span class="op" id="7162656">*</span><span class="ident" id="7162657">Writer</span><span class="op" id="7162663">,</span>&nbsp;<span class="builtintype" id="7162665">error</span><span class="op" id="7162670">)</span>&nbsp;<span class="op" id="7162672">{</span>&nbsp;<span class="keyword" id="7162674">return</span>&nbsp;<span class="ident" id="7162681">NewWriterDict</span><span class="op" id="7162694">(</span><span class="ident" id="7162695">w</span><span class="op" id="7162696">,</span>&nbsp;<span class="ident" id="7162698">BestCompression</span><span class="op" id="7162713">,</span>&nbsp;<span class="ident" id="7162715">dict</span><span class="op" id="7162719">)</span>&nbsp;<span class="op" id="7162721">}</span><span class="op" id="7162722">)</span><br>
<span class="lineno"></span><span class="op" id="7162724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="keyword" id="7162727">func</span>&nbsp;<span class="ident" id="7162732">testResetOutput</span><span class="op" id="7162747">(</span><span class="ident" id="7162748">t</span>&nbsp;<span class="op" id="7162750">*</span><span class="ident" id="7162751">testing</span><span class="op" id="7162758">.</span><span class="ident" id="7162759">T</span><span class="op" id="7162760">,</span>&nbsp;<span class="ident" id="7162762">newWriter</span>&nbsp;<span class="keyword" id="7162772">func</span><span class="op" id="7162776">(</span><span class="ident" id="7162777">w</span>&nbsp;<span class="ident" id="7162779">io</span><span class="op" id="7162781">.</span><span class="ident" id="7162782">Writer</span><span class="op" id="7162788">)</span>&nbsp;<span class="op" id="7162790">(</span><span class="op" id="7162791">*</span><span class="ident" id="7162792">Writer</span><span class="op" id="7162798">,</span>&nbsp;<span class="builtintype" id="7162800">error</span><span class="op" id="7162805">)</span><span class="op" id="7162806">)</span>&nbsp;<span class="op" id="7162808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162811">buf</span>&nbsp;<span class="op" id="7162815">:=</span>&nbsp;<span class="builtinfunc" id="7162818">new</span><span class="op" id="7162821">(</span><span class="ident" id="7162822">bytes</span><span class="op" id="7162827">.</span><span class="ident" id="7162828">Buffer</span><span class="op" id="7162834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162837">w</span><span class="op" id="7162838">,</span>&nbsp;<span class="ident" id="7162840">err</span>&nbsp;<span class="op" id="7162844">:=</span>&nbsp;<span class="ident" id="7162847">newWriter</span><span class="op" id="7162856">(</span><span class="ident" id="7162857">buf</span><span class="op" id="7162860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162863">if</span>&nbsp;<span class="ident" id="7162866">err</span>&nbsp;<span class="op" id="7162870">!=</span>&nbsp;<span class="builtintype" id="7162873">nil</span>&nbsp;<span class="op" id="7162877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162881">t</span><span class="op" id="7162882">.</span><span class="ident" id="7162883">Fatalf</span><span class="op" id="7162889">(</span><span class="string" id="7162890">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7162905">,</span>&nbsp;<span class="ident" id="7162907">err</span><span class="op" id="7162910">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7162913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162916">b</span>&nbsp;<span class="op" id="7162918">:=</span>&nbsp;<span class="op" id="7162921">[</span><span class="op" id="7162922">]</span><span class="builtintype" id="7162923">byte</span><span class="op" id="7162927">(</span><span class="string" id="7162928">&#34;hello&nbsp;world&#34;</span><span class="op" id="7162941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162944">for</span>&nbsp;<span class="ident" id="7162948">i</span>&nbsp;<span class="op" id="7162950">:=</span>&nbsp;<span class="num" id="7162953">0</span><span class="op" id="7162954">;</span>&nbsp;<span class="ident" id="7162956">i</span>&nbsp;<span class="op" id="7162958">&lt;</span>&nbsp;<span class="num" id="7162960">1024</span><span class="op" id="7162964">;</span>&nbsp;<span class="ident" id="7162966">i</span><span class="op" id="7162967">++</span>&nbsp;<span class="op" id="7162970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162974">w</span><span class="op" id="7162975">.</span><span class="ident" id="7162976">Write</span><span class="op" id="7162981">(</span><span class="ident" id="7162982">b</span><span class="op" id="7162983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7162986">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162989">w</span><span class="op" id="7162990">.</span><span class="ident" id="7162991">Close</span><span class="op" id="7162996">(</span><span class="op" id="7162997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163000">out1</span>&nbsp;<span class="op" id="7163005">:=</span>&nbsp;<span class="ident" id="7163008">buf</span><span class="op" id="7163011">.</span><span class="ident" id="7163012">String</span><span class="op" id="7163018">(</span><span class="op" id="7163019">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163023">buf2</span>&nbsp;<span class="op" id="7163028">:=</span>&nbsp;<span class="builtinfunc" id="7163031">new</span><span class="op" id="7163034">(</span><span class="ident" id="7163035">bytes</span><span class="op" id="7163040">.</span><span class="ident" id="7163041">Buffer</span><span class="op" id="7163047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163050">w</span><span class="op" id="7163051">.</span><span class="ident" id="7163052">Reset</span><span class="op" id="7163057">(</span><span class="ident" id="7163058">buf2</span><span class="op" id="7163062">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163065">for</span>&nbsp;<span class="ident" id="7163069">i</span>&nbsp;<span class="op" id="7163071">:=</span>&nbsp;<span class="num" id="7163074">0</span><span class="op" id="7163075">;</span>&nbsp;<span class="ident" id="7163077">i</span>&nbsp;<span class="op" id="7163079">&lt;</span>&nbsp;<span class="num" id="7163081">1024</span><span class="op" id="7163085">;</span>&nbsp;<span class="ident" id="7163087">i</span><span class="op" id="7163088">++</span>&nbsp;<span class="op" id="7163091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163095">w</span><span class="op" id="7163096">.</span><span class="ident" id="7163097">Write</span><span class="op" id="7163102">(</span><span class="ident" id="7163103">b</span><span class="op" id="7163104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7163107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163110">w</span><span class="op" id="7163111">.</span><span class="ident" id="7163112">Close</span><span class="op" id="7163117">(</span><span class="op" id="7163118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163121">out2</span>&nbsp;<span class="op" id="7163126">:=</span>&nbsp;<span class="ident" id="7163129">buf2</span><span class="op" id="7163133">.</span><span class="ident" id="7163134">String</span><span class="op" id="7163140">(</span><span class="op" id="7163141">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163145">if</span>&nbsp;<span class="ident" id="7163148">out1</span>&nbsp;<span class="op" id="7163153">!=</span>&nbsp;<span class="ident" id="7163156">out2</span>&nbsp;<span class="op" id="7163161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163165">t</span><span class="op" id="7163166">.</span><span class="ident" id="7163167">Errorf</span><span class="op" id="7163173">(</span><span class="string" id="7163174">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7163195">,</span>&nbsp;<span class="ident" id="7163197">out2</span><span class="op" id="7163201">,</span>&nbsp;<span class="ident" id="7163203">out1</span><span class="op" id="7163207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7163210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163213">t</span><span class="op" id="7163214">.</span><span class="ident" id="7163215">Logf</span><span class="op" id="7163219">(</span><span class="string" id="7163220">&#34;got&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7163234">,</span>&nbsp;<span class="builtinfunc" id="7163236">len</span><span class="op" id="7163239">(</span><span class="ident" id="7163240">out1</span><span class="op" id="7163244">)</span><span class="op" id="7163245">)</span><br>
<span class="lineno">490</span><span class="op" id="7163247">}</span>
</div>
</body>
</html>
