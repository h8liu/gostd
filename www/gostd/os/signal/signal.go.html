<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/signal</h2>
<ul>
<li><a href="/gostd/os/signal/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/signal/signal.go.html" class="current">signal.go</a></li>
<li><a href="/gostd/os/signal/signal_test.go.html">signal_test.go</a></li>
<li><a href="/gostd/os/signal/signal_unix.go.html">signal_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6132910">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6132965">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6133019">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6133070">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="6133127">package</span>&nbsp;<span class="ident" id="6133135">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6133143">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6133204">import</span>&nbsp;<span class="op" id="6133211">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6133214">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6133220">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6133227">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6133230">var</span>&nbsp;<span class="ident" id="6133234">handlers</span>&nbsp;<span class="keyword" id="6133243">struct</span>&nbsp;<span class="op" id="6133250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6133253">sync</span><span class="op" id="6133257">.</span><span class="ident" id="6133258">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6133265">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6133269">map</span><span class="op" id="6133272">[</span><span class="keyword" id="6133273">chan</span><span class="op" id="6133277">&lt;-</span>&nbsp;<span class="ident" id="6133280">os</span><span class="op" id="6133282">.</span><span class="ident" id="6133283">Signal</span><span class="op" id="6133289">]</span><span class="op" id="6133290">*</span><span class="ident" id="6133291">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6133300">ref</span>&nbsp;<span class="op" id="6133304">[</span><span class="ident" id="6133305">numSig</span><span class="op" id="6133311">]</span><span class="ident" id="6133312">int64</span><br>
<span class="lineno"></span><span class="op" id="6133318">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6133321">type</span>&nbsp;<span class="ident" id="6133326">handler</span>&nbsp;<span class="keyword" id="6133334">struct</span>&nbsp;<span class="op" id="6133341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6133344">mask</span>&nbsp;<span class="op" id="6133349">[</span><span class="op" id="6133350">(</span><span class="ident" id="6133351">numSig</span>&nbsp;<span class="op" id="6133358">+</span>&nbsp;<span class="num" id="6133360">31</span><span class="op" id="6133362">)</span>&nbsp;<span class="op" id="6133364">/</span>&nbsp;<span class="num" id="6133366">32</span><span class="op" id="6133368">]</span><span class="builtintype" id="6133369">uint32</span><br>
<span class="lineno"></span><span class="op" id="6133376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6133379">func</span>&nbsp;<span class="op" id="6133384">(</span><span class="ident" id="6133385">h</span>&nbsp;<span class="op" id="6133387">*</span><span class="ident" id="6133388">handler</span><span class="op" id="6133395">)</span>&nbsp;<span class="ident" id="6133397">want</span><span class="op" id="6133401">(</span><span class="ident" id="6133402">sig</span>&nbsp;<span class="builtintype" id="6133406">int</span><span class="op" id="6133409">)</span>&nbsp;<span class="builtintype" id="6133411">bool</span>&nbsp;<span class="op" id="6133416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6133419">return</span>&nbsp;<span class="op" id="6133426">(</span><span class="ident" id="6133427">h</span><span class="op" id="6133428">.</span><span class="ident" id="6133429">mask</span><span class="op" id="6133433">[</span><span class="ident" id="6133434">sig</span><span class="op" id="6133437">/</span><span class="num" id="6133438">32</span><span class="op" id="6133440">]</span><span class="op" id="6133441">&gt;&gt;</span><span class="builtintype" id="6133443">uint</span><span class="op" id="6133447">(</span><span class="ident" id="6133448">sig</span><span class="op" id="6133451">&amp;</span><span class="num" id="6133452">31</span><span class="op" id="6133454">)</span><span class="op" id="6133455">)</span><span class="op" id="6133456">&amp;</span><span class="num" id="6133457">1</span>&nbsp;<span class="op" id="6133459">!=</span>&nbsp;<span class="num" id="6133462">0</span><br>
<span class="lineno"></span><span class="op" id="6133464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6133467">func</span>&nbsp;<span class="op" id="6133472">(</span><span class="ident" id="6133473">h</span>&nbsp;<span class="op" id="6133475">*</span><span class="ident" id="6133476">handler</span><span class="op" id="6133483">)</span>&nbsp;<span class="ident" id="6133485">set</span><span class="op" id="6133488">(</span><span class="ident" id="6133489">sig</span>&nbsp;<span class="builtintype" id="6133493">int</span><span class="op" id="6133496">)</span>&nbsp;<span class="op" id="6133498">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6133501">h</span><span class="op" id="6133502">.</span><span class="ident" id="6133503">mask</span><span class="op" id="6133507">[</span><span class="ident" id="6133508">sig</span><span class="op" id="6133511">/</span><span class="num" id="6133512">32</span><span class="op" id="6133514">]</span>&nbsp;<span class="op" id="6133516">|=</span>&nbsp;<span class="num" id="6133519">1</span>&nbsp;<span class="op" id="6133521">&lt;&lt;</span>&nbsp;<span class="builtintype" id="6133524">uint</span><span class="op" id="6133528">(</span><span class="ident" id="6133529">sig</span><span class="op" id="6133532">&amp;</span><span class="num" id="6133533">31</span><span class="op" id="6133535">)</span><br>
<span class="lineno"></span><span class="op" id="6133537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6133540">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6133604">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="6133676">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="6133720">//</span><br>
<span class="lineno"></span><span class="comment" id="6133723">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="6133793">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="6133860">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="6133939">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="6133976">//</span><br>
<span class="lineno"></span><span class="comment" id="6133979">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="6134049">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="6134111">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="6134175">//</span><br>
<span class="lineno"></span><span class="comment" id="6134178">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="6134249">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="6134315">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="6134341">func</span>&nbsp;<span class="ident" id="6134346">Notify</span><span class="op" id="6134352">(</span><span class="ident" id="6134353">c</span>&nbsp;<span class="keyword" id="6134355">chan</span><span class="op" id="6134359">&lt;-</span>&nbsp;<span class="ident" id="6134362">os</span><span class="op" id="6134364">.</span><span class="ident" id="6134365">Signal</span><span class="op" id="6134371">,</span>&nbsp;<span class="ident" id="6134373">sig</span>&nbsp;<span class="op" id="6134377">...</span><span class="ident" id="6134380">os</span><span class="op" id="6134382">.</span><span class="ident" id="6134383">Signal</span><span class="op" id="6134389">)</span>&nbsp;<span class="op" id="6134391">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134394">if</span>&nbsp;<span class="ident" id="6134397">c</span>&nbsp;<span class="op" id="6134399">==</span>&nbsp;<span class="ident" id="6134402">nil</span>&nbsp;<span class="op" id="6134406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6134410">panic</span><span class="op" id="6134415">(</span><span class="string" id="6134416">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="6134453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134460">handlers</span><span class="op" id="6134468">.</span><span class="ident" id="6134469">Lock</span><span class="op" id="6134473">(</span><span class="op" id="6134474">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134477">defer</span>&nbsp;<span class="ident" id="6134483">handlers</span><span class="op" id="6134491">.</span><span class="ident" id="6134492">Unlock</span><span class="op" id="6134498">(</span><span class="op" id="6134499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134503">h</span>&nbsp;<span class="op" id="6134505">:=</span>&nbsp;<span class="ident" id="6134508">handlers</span><span class="op" id="6134516">.</span><span class="ident" id="6134517">m</span><span class="op" id="6134518">[</span><span class="ident" id="6134519">c</span><span class="op" id="6134520">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134523">if</span>&nbsp;<span class="ident" id="6134526">h</span>&nbsp;<span class="op" id="6134528">==</span>&nbsp;<span class="ident" id="6134531">nil</span>&nbsp;<span class="op" id="6134535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134539">if</span>&nbsp;<span class="ident" id="6134542">handlers</span><span class="op" id="6134550">.</span><span class="ident" id="6134551">m</span>&nbsp;<span class="op" id="6134553">==</span>&nbsp;<span class="ident" id="6134556">nil</span>&nbsp;<span class="op" id="6134560">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134565">handlers</span><span class="op" id="6134573">.</span><span class="ident" id="6134574">m</span>&nbsp;<span class="op" id="6134576">=</span>&nbsp;<span class="builtinfunc" id="6134578">make</span><span class="op" id="6134582">(</span><span class="keyword" id="6134583">map</span><span class="op" id="6134586">[</span><span class="keyword" id="6134587">chan</span><span class="op" id="6134591">&lt;-</span>&nbsp;<span class="ident" id="6134594">os</span><span class="op" id="6134596">.</span><span class="ident" id="6134597">Signal</span><span class="op" id="6134603">]</span><span class="op" id="6134604">*</span><span class="ident" id="6134605">handler</span><span class="op" id="6134612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134620">h</span>&nbsp;<span class="op" id="6134622">=</span>&nbsp;<span class="builtinfunc" id="6134624">new</span><span class="op" id="6134627">(</span><span class="ident" id="6134628">handler</span><span class="op" id="6134635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134639">handlers</span><span class="op" id="6134647">.</span><span class="ident" id="6134648">m</span><span class="op" id="6134649">[</span><span class="ident" id="6134650">c</span><span class="op" id="6134651">]</span>&nbsp;<span class="op" id="6134653">=</span>&nbsp;<span class="ident" id="6134655">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134658">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134662">add</span>&nbsp;<span class="op" id="6134666">:=</span>&nbsp;<span class="keyword" id="6134669">func</span><span class="op" id="6134673">(</span><span class="ident" id="6134674">n</span>&nbsp;<span class="builtintype" id="6134676">int</span><span class="op" id="6134679">)</span>&nbsp;<span class="op" id="6134681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134685">if</span>&nbsp;<span class="ident" id="6134688">n</span>&nbsp;<span class="op" id="6134690">&lt;</span>&nbsp;<span class="num" id="6134692">0</span>&nbsp;<span class="op" id="6134694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134699">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134708">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134712">if</span>&nbsp;<span class="op" id="6134715">!</span><span class="ident" id="6134716">h</span><span class="op" id="6134717">.</span><span class="ident" id="6134718">want</span><span class="op" id="6134722">(</span><span class="ident" id="6134723">n</span><span class="op" id="6134724">)</span>&nbsp;<span class="op" id="6134726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134731">h</span><span class="op" id="6134732">.</span><span class="ident" id="6134733">set</span><span class="op" id="6134736">(</span><span class="ident" id="6134737">n</span><span class="op" id="6134738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134743">if</span>&nbsp;<span class="ident" id="6134746">handlers</span><span class="op" id="6134754">.</span><span class="ident" id="6134755">ref</span><span class="op" id="6134758">[</span><span class="ident" id="6134759">n</span><span class="op" id="6134760">]</span>&nbsp;<span class="op" id="6134762">==</span>&nbsp;<span class="num" id="6134765">0</span>&nbsp;<span class="op" id="6134767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134773">enableSignal</span><span class="op" id="6134785">(</span><span class="ident" id="6134786">n</span><span class="op" id="6134787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134792">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134797">handlers</span><span class="op" id="6134805">.</span><span class="ident" id="6134806">ref</span><span class="op" id="6134809">[</span><span class="ident" id="6134810">n</span><span class="op" id="6134811">]</span><span class="op" id="6134812">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134824">if</span>&nbsp;<span class="builtinfunc" id="6134827">len</span><span class="op" id="6134830">(</span><span class="ident" id="6134831">sig</span><span class="op" id="6134834">)</span>&nbsp;<span class="op" id="6134836">==</span>&nbsp;<span class="num" id="6134839">0</span>&nbsp;<span class="op" id="6134841">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134845">for</span>&nbsp;<span class="ident" id="6134849">n</span>&nbsp;<span class="op" id="6134851">:=</span>&nbsp;<span class="num" id="6134854">0</span><span class="op" id="6134855">;</span>&nbsp;<span class="ident" id="6134857">n</span>&nbsp;<span class="op" id="6134859">&lt;</span>&nbsp;<span class="ident" id="6134861">numSig</span><span class="op" id="6134867">;</span>&nbsp;<span class="ident" id="6134869">n</span><span class="op" id="6134870">++</span>&nbsp;<span class="op" id="6134873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134878">add</span><span class="op" id="6134881">(</span><span class="ident" id="6134882">n</span><span class="op" id="6134883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134890">}</span>&nbsp;<span class="keyword" id="6134892">else</span>&nbsp;<span class="op" id="6134897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6134901">for</span>&nbsp;<span class="ident" id="6134905">_</span><span class="op" id="6134906">,</span>&nbsp;<span class="ident" id="6134908">s</span>&nbsp;<span class="op" id="6134910">:=</span>&nbsp;<span class="keyword" id="6134913">range</span>&nbsp;<span class="ident" id="6134919">sig</span>&nbsp;<span class="op" id="6134923">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6134928">add</span><span class="op" id="6134931">(</span><span class="ident" id="6134932">signum</span><span class="op" id="6134938">(</span><span class="ident" id="6134939">s</span><span class="op" id="6134940">)</span><span class="op" id="6134941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6134948">}</span><br>
<span class="lineno"></span><span class="op" id="6134950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6134953">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6135023">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6135085">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="6135161">func</span>&nbsp;<span class="ident" id="6135166">Stop</span><span class="op" id="6135170">(</span><span class="ident" id="6135171">c</span>&nbsp;<span class="keyword" id="6135173">chan</span><span class="op" id="6135177">&lt;-</span>&nbsp;<span class="ident" id="6135180">os</span><span class="op" id="6135182">.</span><span class="ident" id="6135183">Signal</span><span class="op" id="6135189">)</span>&nbsp;<span class="op" id="6135191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135194">handlers</span><span class="op" id="6135202">.</span><span class="ident" id="6135203">Lock</span><span class="op" id="6135207">(</span><span class="op" id="6135208">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135211">defer</span>&nbsp;<span class="ident" id="6135217">handlers</span><span class="op" id="6135225">.</span><span class="ident" id="6135226">Unlock</span><span class="op" id="6135232">(</span><span class="op" id="6135233">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135237">h</span>&nbsp;<span class="op" id="6135239">:=</span>&nbsp;<span class="ident" id="6135242">handlers</span><span class="op" id="6135250">.</span><span class="ident" id="6135251">m</span><span class="op" id="6135252">[</span><span class="ident" id="6135253">c</span><span class="op" id="6135254">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135257">if</span>&nbsp;<span class="ident" id="6135260">h</span>&nbsp;<span class="op" id="6135262">==</span>&nbsp;<span class="ident" id="6135265">nil</span>&nbsp;<span class="op" id="6135269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135273">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6135281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6135284">delete</span><span class="op" id="6135290">(</span><span class="ident" id="6135291">handlers</span><span class="op" id="6135299">.</span><span class="ident" id="6135300">m</span><span class="op" id="6135301">,</span>&nbsp;<span class="ident" id="6135303">c</span><span class="op" id="6135304">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135308">for</span>&nbsp;<span class="ident" id="6135312">n</span>&nbsp;<span class="op" id="6135314">:=</span>&nbsp;<span class="num" id="6135317">0</span><span class="op" id="6135318">;</span>&nbsp;<span class="ident" id="6135320">n</span>&nbsp;<span class="op" id="6135322">&lt;</span>&nbsp;<span class="ident" id="6135324">numSig</span><span class="op" id="6135330">;</span>&nbsp;<span class="ident" id="6135332">n</span><span class="op" id="6135333">++</span>&nbsp;<span class="op" id="6135336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135340">if</span>&nbsp;<span class="ident" id="6135343">h</span><span class="op" id="6135344">.</span><span class="ident" id="6135345">want</span><span class="op" id="6135349">(</span><span class="ident" id="6135350">n</span><span class="op" id="6135351">)</span>&nbsp;<span class="op" id="6135353">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135358">handlers</span><span class="op" id="6135366">.</span><span class="ident" id="6135367">ref</span><span class="op" id="6135370">[</span><span class="ident" id="6135371">n</span><span class="op" id="6135372">]</span><span class="op" id="6135373">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135379">if</span>&nbsp;<span class="ident" id="6135382">handlers</span><span class="op" id="6135390">.</span><span class="ident" id="6135391">ref</span><span class="op" id="6135394">[</span><span class="ident" id="6135395">n</span><span class="op" id="6135396">]</span>&nbsp;<span class="op" id="6135398">==</span>&nbsp;<span class="num" id="6135401">0</span>&nbsp;<span class="op" id="6135403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135409">disableSignal</span><span class="op" id="6135422">(</span><span class="ident" id="6135423">n</span><span class="op" id="6135424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6135429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6135433">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6135436">}</span><br>
<span class="lineno"></span><span class="op" id="6135438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6135441">func</span>&nbsp;<span class="ident" id="6135446">process</span><span class="op" id="6135453">(</span><span class="ident" id="6135454">sig</span>&nbsp;<span class="ident" id="6135458">os</span><span class="op" id="6135460">.</span><span class="ident" id="6135461">Signal</span><span class="op" id="6135467">)</span>&nbsp;<span class="op" id="6135469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135472">n</span>&nbsp;<span class="op" id="6135474">:=</span>&nbsp;<span class="ident" id="6135477">signum</span><span class="op" id="6135483">(</span><span class="ident" id="6135484">sig</span><span class="op" id="6135487">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135490">if</span>&nbsp;<span class="ident" id="6135493">n</span>&nbsp;<span class="op" id="6135495">&lt;</span>&nbsp;<span class="num" id="6135497">0</span>&nbsp;<span class="op" id="6135499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135503">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6135511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135515">handlers</span><span class="op" id="6135523">.</span><span class="ident" id="6135524">Lock</span><span class="op" id="6135528">(</span><span class="op" id="6135529">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135532">defer</span>&nbsp;<span class="ident" id="6135538">handlers</span><span class="op" id="6135546">.</span><span class="ident" id="6135547">Unlock</span><span class="op" id="6135553">(</span><span class="op" id="6135554">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135558">for</span>&nbsp;<span class="ident" id="6135562">c</span><span class="op" id="6135563">,</span>&nbsp;<span class="ident" id="6135565">h</span>&nbsp;<span class="op" id="6135567">:=</span>&nbsp;<span class="keyword" id="6135570">range</span>&nbsp;<span class="ident" id="6135576">handlers</span><span class="op" id="6135584">.</span><span class="ident" id="6135585">m</span>&nbsp;<span class="op" id="6135587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135591">if</span>&nbsp;<span class="ident" id="6135594">h</span><span class="op" id="6135595">.</span><span class="ident" id="6135596">want</span><span class="op" id="6135600">(</span><span class="ident" id="6135601">n</span><span class="op" id="6135602">)</span>&nbsp;<span class="op" id="6135604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6135609">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135644">select</span>&nbsp;<span class="op" id="6135651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135656">case</span>&nbsp;<span class="ident" id="6135661">c</span>&nbsp;<span class="op" id="6135663">&lt;-</span>&nbsp;<span class="ident" id="6135666">sig</span><span class="op" id="6135669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6135674">default</span><span class="op" id="6135681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6135686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6135690">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6135693">}</span><br>
<span class="lineno"></span><span class="op" id="6135695">}</span>
</div>
</body>
</html>
