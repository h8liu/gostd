<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/format</h2>
<ul>
<li><a href="/gostd/go/format/format.go.html" class="current">format.go</a></li>
<li><a href="/gostd/go/format/format_test.go.html">format_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6082024">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6082079">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6082133">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6082184">//&nbsp;Package&nbsp;format&nbsp;implements&nbsp;standard&nbsp;formatting&nbsp;of&nbsp;Go&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="6082247">package</span>&nbsp;<span class="ident" id="6082255">format</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6082263">import</span>&nbsp;<span class="op" id="6082270">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082273">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082282">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082289">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082299">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082312">&#34;go/printer&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082326">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082338">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082344">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6082354">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6082357">var</span>&nbsp;<span class="ident" id="6082361">config</span>&nbsp;<span class="op" id="6082368">=</span>&nbsp;<span class="ident" id="6082370"><a href="/gostd/go/format/format.go.html#6082312">printer</a></span><span class="op" id="6082377">.</span><span class="ident" id="6082378"><a href="/gostd/go/printer/printer.go.html#5877536">Config</a></span><span class="op" id="6082384">{</span><span class="ident" id="6082385"><a href="/gostd/go/printer/printer.go.html#5877553">Mode</a></span><span class="op" id="6082389">:</span>&nbsp;<span class="ident" id="6082391"><a href="/gostd/go/format/format.go.html#6082312">printer</a></span><span class="op" id="6082398">.</span><span class="ident" id="6082399"><a href="/gostd/go/printer/printer.go.html#5877319">UseSpaces</a></span>&nbsp;<span class="op" id="6082409">|</span>&nbsp;<span class="ident" id="6082411"><a href="/gostd/go/format/format.go.html#6082312">printer</a></span><span class="op" id="6082418">.</span><span class="ident" id="6082419"><a href="/gostd/go/printer/printer.go.html#5877238">TabIndent</a></span><span class="op" id="6082428">,</span>&nbsp;<span class="ident" id="6082430"><a href="/gostd/go/printer/printer.go.html#5877582">Tabwidth</a></span><span class="op" id="6082438">:</span>&nbsp;<span class="num" id="6082440">8</span><span class="op" id="6082441">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6082444">const</span>&nbsp;<span class="ident" id="6082450">parserMode</span>&nbsp;<span class="op" id="6082461">=</span>&nbsp;<span class="ident" id="6082463"><a href="/gostd/go/format/format.go.html#6082299">parser</a></span><span class="op" id="6082469">.</span><span class="ident" id="6082470"><a href="/gostd/go/parser/interface.go.html#5951730">ParseComments</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6082485">//&nbsp;Node&nbsp;formats&nbsp;node&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="6082561">//</span><br>
<span class="lineno">25</span><span class="comment" id="6082564">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*printer.CommentedNode,&nbsp;[]ast.Decl,</span><br>
<span class="lineno"></span><span class="comment" id="6082636">//&nbsp;[]ast.Stmt,&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,</span><br>
<span class="lineno"></span><span class="comment" id="6082709">//&nbsp;or&nbsp;ast.Stmt.&nbsp;Node&nbsp;does&nbsp;not&nbsp;modify&nbsp;node.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6082779">//&nbsp;nodes&nbsp;representing&nbsp;partial&nbsp;source&nbsp;files&nbsp;(i.e.,&nbsp;if&nbsp;the&nbsp;node&nbsp;is&nbsp;not&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6082851">//&nbsp;*ast.File&nbsp;or&nbsp;a&nbsp;*printer.CommentedNode&nbsp;not&nbsp;wrapping&nbsp;an&nbsp;*ast.File).</span><br>
<span class="lineno">30</span><span class="comment" id="6082920">//</span><br>
<span class="lineno"></span><span class="comment" id="6082923">//&nbsp;The&nbsp;function&nbsp;may&nbsp;return&nbsp;early&nbsp;(before&nbsp;the&nbsp;entire&nbsp;result&nbsp;is&nbsp;written)</span><br>
<span class="lineno"></span><span class="comment" id="6082994">//&nbsp;and&nbsp;return&nbsp;a&nbsp;formatting&nbsp;error,&nbsp;for&nbsp;instance&nbsp;due&nbsp;to&nbsp;an&nbsp;incorrect&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="6083066">//</span><br>
<span class="lineno"></span><span class="keyword" id="6083069">func</span>&nbsp;<span class="ident" id="6083074">Node</span><span class="op" id="6083078">(</span><span class="ident" id="6083079">dst</span>&nbsp;<span class="ident" id="6083083"><a href="/gostd/go/format/format.go.html#6082338">io</a></span><span class="op" id="6083085">.</span><span class="ident" id="6083086"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="6083092">,</span>&nbsp;<span class="ident" id="6083094">fset</span>&nbsp;<span class="op" id="6083099">*</span><span class="ident" id="6083100"><a href="/gostd/go/format/format.go.html#6082326">token</a></span><span class="op" id="6083105">.</span><span class="ident" id="6083106"><a href="/gostd/go/token/position.go.html#3883366">FileSet</a></span><span class="op" id="6083113">,</span>&nbsp;<span class="ident" id="6083115">node</span>&nbsp;<span class="keyword" id="6083120">interface</span><span class="op" id="6083129">{</span><span class="op" id="6083130">}</span><span class="op" id="6083131">)</span>&nbsp;<span class="builtintype" id="6083133">error</span>&nbsp;<span class="op" id="6083139">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6083142">//&nbsp;Determine&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;complete&nbsp;source&nbsp;file&nbsp;(file&nbsp;!=&nbsp;nil).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083205">var</span>&nbsp;<span class="ident" id="6083209">file</span>&nbsp;<span class="op" id="6083214">*</span><span class="ident" id="6083215"><a href="/gostd/go/format/format.go.html#6082289">ast</a></span><span class="op" id="6083218">.</span><span class="ident" id="6083219"><a href="/gostd/go/ast/ast.go.html#3823869">File</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083225">var</span>&nbsp;<span class="ident" id="6083229">cnode</span>&nbsp;<span class="op" id="6083235">*</span><span class="ident" id="6083236"><a href="/gostd/go/format/format.go.html#6082312">printer</a></span><span class="op" id="6083243">.</span><span class="ident" id="6083244"><a href="/gostd/go/printer/printer.go.html#5879256">CommentedNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083259">switch</span>&nbsp;<span class="ident" id="6083266">n</span>&nbsp;<span class="op" id="6083268">:=</span>&nbsp;<span class="ident" id="6083271"><a href="/gostd/go/format/format.go.html#6083115">node</a></span><span class="op" id="6083275">.</span><span class="op" id="6083276">(</span><span class="keyword" id="6083277">type</span><span class="op" id="6083281">)</span>&nbsp;<span class="op" id="6083283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083286">case</span>&nbsp;<span class="op" id="6083291">*</span><span class="ident" id="6083292"><a href="/gostd/go/format/format.go.html#6082289">ast</a></span><span class="op" id="6083295">.</span><span class="ident" id="6083296"><a href="/gostd/go/ast/ast.go.html#3823869">File</a></span><span class="op" id="6083300">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083304"><a href="/gostd/go/format/format.go.html#6083209">file</a></span>&nbsp;<span class="op" id="6083309">=</span>&nbsp;<span class="ident" id="6083311"><a href="/gostd/go/format/format.go.html#6083266">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083314">case</span>&nbsp;<span class="op" id="6083319">*</span><span class="ident" id="6083320"><a href="/gostd/go/format/format.go.html#6082312">printer</a></span><span class="op" id="6083327">.</span><span class="ident" id="6083328"><a href="/gostd/go/printer/printer.go.html#5879256">CommentedNode</a></span><span class="op" id="6083341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083345">if</span>&nbsp;<span class="ident" id="6083348">f</span><span class="op" id="6083349">,</span>&nbsp;<span class="ident" id="6083351">ok</span>&nbsp;<span class="op" id="6083354">:=</span>&nbsp;<span class="ident" id="6083357"><a href="/gostd/go/format/format.go.html#6083266">n</a></span><span class="op" id="6083358">.</span><span class="ident" id="6083359"><a href="/gostd/go/printer/printer.go.html#5879280">Node</a></span><span class="op" id="6083363">.</span><span class="op" id="6083364">(</span><span class="op" id="6083365">*</span><span class="ident" id="6083366"><a href="/gostd/go/format/format.go.html#6082289">ast</a></span><span class="op" id="6083369">.</span><span class="ident" id="6083370"><a href="/gostd/go/ast/ast.go.html#3823869">File</a></span><span class="op" id="6083374">)</span><span class="op" id="6083375">;</span>&nbsp;<span class="ident" id="6083377"><a href="/gostd/go/format/format.go.html#6083351">ok</a></span>&nbsp;<span class="op" id="6083380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083385"><a href="/gostd/go/format/format.go.html#6083209">file</a></span>&nbsp;<span class="op" id="6083390">=</span>&nbsp;<span class="ident" id="6083392"><a href="/gostd/go/format/format.go.html#6083348">f</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083397"><a href="/gostd/go/format/format.go.html#6083229">cnode</a></span>&nbsp;<span class="op" id="6083403">=</span>&nbsp;<span class="ident" id="6083405"><a href="/gostd/go/format/format.go.html#6083266">n</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6083416">//&nbsp;Sort&nbsp;imports&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083447">if</span>&nbsp;<span class="ident" id="6083450"><a href="/gostd/go/format/format.go.html#6083209">file</a></span>&nbsp;<span class="op" id="6083455">!=</span>&nbsp;<span class="builtintype" id="6083458">nil</span>&nbsp;<span class="op" id="6083462">&amp;&amp;</span>&nbsp;<span class="ident" id="6083465"><a href="/gostd/go/format/format.go.html#6085036">hasUnsortedImports</a></span><span class="op" id="6083483">(</span><span class="ident" id="6083484"><a href="/gostd/go/format/format.go.html#6083209">file</a></span><span class="op" id="6083488">)</span>&nbsp;<span class="op" id="6083490">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6083494">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;AST&nbsp;because&nbsp;ast.SortImports&nbsp;is&nbsp;destructive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6083562">//&nbsp;TODO(gri)&nbsp;Do&nbsp;this&nbsp;more&nbsp;efficiently.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083603">var</span>&nbsp;<span class="ident" id="6083607">buf</span>&nbsp;<span class="ident" id="6083611"><a href="/gostd/go/format/format.go.html#6082273">bytes</a></span><span class="op" id="6083616">.</span><span class="ident" id="6083617"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083626">err</span>&nbsp;<span class="op" id="6083630">:=</span>&nbsp;<span class="ident" id="6083633"><a href="/gostd/go/format/format.go.html#6082361">config</a></span><span class="op" id="6083639">.</span><span class="ident" id="6083640"><a href="/gostd/go/printer/printer.go.html#5879714">Fprint</a></span><span class="op" id="6083646">(</span><span class="op" id="6083647">&amp;</span><span class="ident" id="6083648"><a href="/gostd/go/format/format.go.html#6083607">buf</a></span><span class="op" id="6083651">,</span>&nbsp;<span class="ident" id="6083653"><a href="/gostd/go/format/format.go.html#6083094">fset</a></span><span class="op" id="6083657">,</span>&nbsp;<span class="ident" id="6083659"><a href="/gostd/go/format/format.go.html#6083209">file</a></span><span class="op" id="6083663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083667">if</span>&nbsp;<span class="ident" id="6083670"><a href="/gostd/go/format/format.go.html#6083626">err</a></span>&nbsp;<span class="op" id="6083674">!=</span>&nbsp;<span class="builtintype" id="6083677">nil</span>&nbsp;<span class="op" id="6083681">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083686">return</span>&nbsp;<span class="ident" id="6083693"><a href="/gostd/go/format/format.go.html#6083626">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083703"><a href="/gostd/go/format/format.go.html#6083209">file</a></span><span class="op" id="6083707">,</span>&nbsp;<span class="ident" id="6083709"><a href="/gostd/go/format/format.go.html#6083626">err</a></span>&nbsp;<span class="op" id="6083713">=</span>&nbsp;<span class="ident" id="6083715"><a href="/gostd/go/format/format.go.html#6082299">parser</a></span><span class="op" id="6083721">.</span><span class="ident" id="6083722"><a href="/gostd/go/parser/interface.go.html#5953223">ParseFile</a></span><span class="op" id="6083731">(</span><span class="ident" id="6083732"><a href="/gostd/go/format/format.go.html#6083094">fset</a></span><span class="op" id="6083736">,</span>&nbsp;<span class="string" id="6083738">&#34;&#34;</span><span class="op" id="6083740">,</span>&nbsp;<span class="ident" id="6083742"><a href="/gostd/go/format/format.go.html#6083607">buf</a></span><span class="op" id="6083745">.</span><span class="ident" id="6083746"><a href="/gostd/bytes/buffer.go.html#1384454">Bytes</a></span><span class="op" id="6083751">(</span><span class="op" id="6083752">)</span><span class="op" id="6083753">,</span>&nbsp;<span class="ident" id="6083755"><a href="/gostd/go/format/format.go.html#6082450">parserMode</a></span><span class="op" id="6083765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083769">if</span>&nbsp;<span class="ident" id="6083772"><a href="/gostd/go/format/format.go.html#6083626">err</a></span>&nbsp;<span class="op" id="6083776">!=</span>&nbsp;<span class="builtintype" id="6083779">nil</span>&nbsp;<span class="op" id="6083783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6083788">//&nbsp;We&nbsp;should&nbsp;never&nbsp;get&nbsp;here.&nbsp;If&nbsp;we&nbsp;do,&nbsp;provide&nbsp;good&nbsp;diagnostic.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083855">return</span>&nbsp;<span class="ident" id="6083862"><a href="/gostd/go/format/format.go.html#6082282">fmt</a></span><span class="op" id="6083865">.</span><span class="ident" id="6083866"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="6083872">(</span><span class="string" id="6083873">&#34;format.Node&nbsp;internal&nbsp;error&nbsp;(%s)&#34;</span><span class="op" id="6083906">,</span>&nbsp;<span class="ident" id="6083908"><a href="/gostd/go/format/format.go.html#6083626">err</a></span><span class="op" id="6083911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083919"><a href="/gostd/go/format/format.go.html#6082289">ast</a></span><span class="op" id="6083922">.</span><span class="ident" id="6083923"><a href="/gostd/go/ast/import.go.html#3847161">SortImports</a></span><span class="op" id="6083934">(</span><span class="ident" id="6083935"><a href="/gostd/go/format/format.go.html#6083094">fset</a></span><span class="op" id="6083939">,</span>&nbsp;<span class="ident" id="6083941"><a href="/gostd/go/format/format.go.html#6083209">file</a></span><span class="op" id="6083945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6083950">//&nbsp;Use&nbsp;new&nbsp;file&nbsp;with&nbsp;sorted&nbsp;imports.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083989"><a href="/gostd/go/format/format.go.html#6083115">node</a></span>&nbsp;<span class="op" id="6083994">=</span>&nbsp;<span class="ident" id="6083996"><a href="/gostd/go/format/format.go.html#6083209">file</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084003">if</span>&nbsp;<span class="ident" id="6084006"><a href="/gostd/go/format/format.go.html#6083229">cnode</a></span>&nbsp;<span class="op" id="6084012">!=</span>&nbsp;<span class="builtintype" id="6084015">nil</span>&nbsp;<span class="op" id="6084019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084024"><a href="/gostd/go/format/format.go.html#6083115">node</a></span>&nbsp;<span class="op" id="6084029">=</span>&nbsp;<span class="op" id="6084031">&amp;</span><span class="ident" id="6084032"><a href="/gostd/go/format/format.go.html#6082312">printer</a></span><span class="op" id="6084039">.</span><span class="ident" id="6084040"><a href="/gostd/go/printer/printer.go.html#5879256">CommentedNode</a></span><span class="op" id="6084053">{</span><span class="ident" id="6084054"><a href="/gostd/go/printer/printer.go.html#5879280">Node</a></span><span class="op" id="6084058">:</span>&nbsp;<span class="ident" id="6084060"><a href="/gostd/go/format/format.go.html#6083209">file</a></span><span class="op" id="6084064">,</span>&nbsp;<span class="ident" id="6084066"><a href="/gostd/go/printer/printer.go.html#5879361">Comments</a></span><span class="op" id="6084074">:</span>&nbsp;<span class="ident" id="6084076"><a href="/gostd/go/format/format.go.html#6083229">cnode</a></span><span class="op" id="6084081">.</span><span class="ident" id="6084082"><a href="/gostd/go/printer/printer.go.html#5879361">Comments</a></span><span class="op" id="6084090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084097">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084101">return</span>&nbsp;<span class="ident" id="6084108"><a href="/gostd/go/format/format.go.html#6082361">config</a></span><span class="op" id="6084114">.</span><span class="ident" id="6084115"><a href="/gostd/go/printer/printer.go.html#5879714">Fprint</a></span><span class="op" id="6084121">(</span><span class="ident" id="6084122"><a href="/gostd/go/format/format.go.html#6083079">dst</a></span><span class="op" id="6084125">,</span>&nbsp;<span class="ident" id="6084127"><a href="/gostd/go/format/format.go.html#6083094">fset</a></span><span class="op" id="6084131">,</span>&nbsp;<span class="ident" id="6084133"><a href="/gostd/go/format/format.go.html#6083115">node</a></span><span class="op" id="6084137">)</span><br>
<span class="lineno"></span><span class="op" id="6084139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6084142">//&nbsp;Source&nbsp;formats&nbsp;src&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;returns&nbsp;the&nbsp;result</span><br>
<span class="lineno">75</span><span class="comment" id="6084212">//&nbsp;or&nbsp;an&nbsp;(I/O&nbsp;or&nbsp;syntax)&nbsp;error.&nbsp;src&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;a&nbsp;syntactically</span><br>
<span class="lineno"></span><span class="comment" id="6084282">//&nbsp;correct&nbsp;Go&nbsp;source&nbsp;file,&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;Go&nbsp;declarations&nbsp;or&nbsp;statements.</span><br>
<span class="lineno"></span><span class="comment" id="6084353">//</span><br>
<span class="lineno"></span><span class="comment" id="6084356">//&nbsp;If&nbsp;src&nbsp;is&nbsp;a&nbsp;partial&nbsp;source&nbsp;file,&nbsp;the&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space&nbsp;of&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="6084430">//&nbsp;is&nbsp;applied&nbsp;to&nbsp;the&nbsp;result&nbsp;(such&nbsp;that&nbsp;it&nbsp;has&nbsp;the&nbsp;same&nbsp;leading&nbsp;and&nbsp;trailing</span><br>
<span class="lineno">80</span><span class="comment" id="6084506">//&nbsp;space&nbsp;as&nbsp;src),&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;indented&nbsp;by&nbsp;the&nbsp;same&nbsp;amount&nbsp;as&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="6084583">//&nbsp;line&nbsp;of&nbsp;src&nbsp;containing&nbsp;code.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for&nbsp;partial&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="6084664">//</span><br>
<span class="lineno"></span><span class="keyword" id="6084667">func</span>&nbsp;<span class="ident" id="6084672">Source</span><span class="op" id="6084678">(</span><span class="ident" id="6084679">src</span>&nbsp;<span class="op" id="6084683">[</span><span class="op" id="6084684">]</span><span class="builtintype" id="6084685">byte</span><span class="op" id="6084689">)</span>&nbsp;<span class="op" id="6084691">(</span><span class="op" id="6084692">[</span><span class="op" id="6084693">]</span><span class="builtintype" id="6084694">byte</span><span class="op" id="6084698">,</span>&nbsp;<span class="builtintype" id="6084700">error</span><span class="op" id="6084705">)</span>&nbsp;<span class="op" id="6084707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084710">fset</span>&nbsp;<span class="op" id="6084715">:=</span>&nbsp;<span class="ident" id="6084718"><a href="/gostd/go/format/format.go.html#6082326">token</a></span><span class="op" id="6084723">.</span><span class="ident" id="6084724"><a href="/gostd/go/token/position.go.html#3883646">NewFileSet</a></span><span class="op" id="6084734">(</span><span class="op" id="6084735">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084738">file</span><span class="op" id="6084742">,</span>&nbsp;<span class="ident" id="6084744">sourceAdj</span><span class="op" id="6084753">,</span>&nbsp;<span class="ident" id="6084755">indentAdj</span><span class="op" id="6084764">,</span>&nbsp;<span class="ident" id="6084766">err</span>&nbsp;<span class="op" id="6084770">:=</span>&nbsp;<span class="ident" id="6084773"><a href="/gostd/go/format/format.go.html#6085917">parse</a></span><span class="op" id="6084778">(</span><span class="ident" id="6084779"><a href="/gostd/go/format/format.go.html#6084710">fset</a></span><span class="op" id="6084783">,</span>&nbsp;<span class="string" id="6084785">&#34;&#34;</span><span class="op" id="6084787">,</span>&nbsp;<span class="ident" id="6084789"><a href="/gostd/go/format/format.go.html#6084679">src</a></span><span class="op" id="6084792">,</span>&nbsp;<span class="builtintype" id="6084794">true</span><span class="op" id="6084798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084801">if</span>&nbsp;<span class="ident" id="6084804"><a href="/gostd/go/format/format.go.html#6084766">err</a></span>&nbsp;<span class="op" id="6084808">!=</span>&nbsp;<span class="builtintype" id="6084811">nil</span>&nbsp;<span class="op" id="6084815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084819">return</span>&nbsp;<span class="builtintype" id="6084826">nil</span><span class="op" id="6084829">,</span>&nbsp;<span class="ident" id="6084831"><a href="/gostd/go/format/format.go.html#6084766">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084840">if</span>&nbsp;<span class="ident" id="6084843"><a href="/gostd/go/format/format.go.html#6084744">sourceAdj</a></span>&nbsp;<span class="op" id="6084853">==</span>&nbsp;<span class="builtintype" id="6084856">nil</span>&nbsp;<span class="op" id="6084860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6084864">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6084891">//&nbsp;TODO(gri)&nbsp;consider&nbsp;doing&nbsp;this&nbsp;always.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084934"><a href="/gostd/go/format/format.go.html#6082289">ast</a></span><span class="op" id="6084937">.</span><span class="ident" id="6084938"><a href="/gostd/go/ast/import.go.html#3847161">SortImports</a></span><span class="op" id="6084949">(</span><span class="ident" id="6084950"><a href="/gostd/go/format/format.go.html#6084710">fset</a></span><span class="op" id="6084954">,</span>&nbsp;<span class="ident" id="6084956"><a href="/gostd/go/format/format.go.html#6084738">file</a></span><span class="op" id="6084960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084963">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084967">return</span>&nbsp;<span class="ident" id="6084974"><a href="/gostd/go/format/format.go.html#6088405">format</a></span><span class="op" id="6084980">(</span><span class="ident" id="6084981"><a href="/gostd/go/format/format.go.html#6084710">fset</a></span><span class="op" id="6084985">,</span>&nbsp;<span class="ident" id="6084987"><a href="/gostd/go/format/format.go.html#6084738">file</a></span><span class="op" id="6084991">,</span>&nbsp;<span class="ident" id="6084993"><a href="/gostd/go/format/format.go.html#6084744">sourceAdj</a></span><span class="op" id="6085002">,</span>&nbsp;<span class="ident" id="6085004"><a href="/gostd/go/format/format.go.html#6084755">indentAdj</a></span><span class="op" id="6085013">,</span>&nbsp;<span class="ident" id="6085015"><a href="/gostd/go/format/format.go.html#6084679">src</a></span><span class="op" id="6085018">,</span>&nbsp;<span class="ident" id="6085020"><a href="/gostd/go/format/format.go.html#6082361">config</a></span><span class="op" id="6085026">)</span><br>
<span class="lineno"></span><span class="op" id="6085028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6085031">func</span>&nbsp;<span class="ident" id="6085036">hasUnsortedImports</span><span class="op" id="6085054">(</span><span class="ident" id="6085055">file</span>&nbsp;<span class="op" id="6085060">*</span><span class="ident" id="6085061"><a href="/gostd/go/format/format.go.html#6082289">ast</a></span><span class="op" id="6085064">.</span><span class="ident" id="6085065"><a href="/gostd/go/ast/ast.go.html#3823869">File</a></span><span class="op" id="6085069">)</span>&nbsp;<span class="builtintype" id="6085071">bool</span>&nbsp;<span class="op" id="6085076">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085079">for</span>&nbsp;<span class="ident" id="6085083">_</span><span class="op" id="6085084">,</span>&nbsp;<span class="ident" id="6085086">d</span>&nbsp;<span class="op" id="6085088">:=</span>&nbsp;<span class="keyword" id="6085091">range</span>&nbsp;<span class="ident" id="6085097"><a href="/gostd/go/format/format.go.html#6085055">file</a></span><span class="op" id="6085101">.</span><span class="ident" id="6085102"><a href="/gostd/go/ast/ast.go.html#3824053">Decls</a></span>&nbsp;<span class="op" id="6085108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085112">d</span><span class="op" id="6085113">,</span>&nbsp;<span class="ident" id="6085115">ok</span>&nbsp;<span class="op" id="6085118">:=</span>&nbsp;<span class="ident" id="6085121"><a href="/gostd/go/format/format.go.html#6085086">d</a></span><span class="op" id="6085122">.</span><span class="op" id="6085123">(</span><span class="op" id="6085124">*</span><span class="ident" id="6085125"><a href="/gostd/go/format/format.go.html#6082289">ast</a></span><span class="op" id="6085128">.</span><span class="ident" id="6085129"><a href="/gostd/go/ast/ast.go.html#3822162">GenDecl</a></span><span class="op" id="6085136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085140">if</span>&nbsp;<span class="op" id="6085143">!</span><span class="ident" id="6085144"><a href="/gostd/go/format/format.go.html#6085115">ok</a></span>&nbsp;<span class="op" id="6085147">||</span>&nbsp;<span class="ident" id="6085150"><a href="/gostd/go/format/format.go.html#6085112">d</a></span><span class="op" id="6085151">.</span><span class="ident" id="6085152"><a href="/gostd/go/ast/ast.go.html#3822282">Tok</a></span>&nbsp;<span class="op" id="6085156">!=</span>&nbsp;<span class="ident" id="6085159"><a href="/gostd/go/format/format.go.html#6082326">token</a></span><span class="op" id="6085164">.</span><span class="ident" id="6085165"><a href="/gostd/go/token/token.go.html#3890848">IMPORT</a></span>&nbsp;<span class="op" id="6085172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085177">//&nbsp;Not&nbsp;an&nbsp;import&nbsp;declaration,&nbsp;so&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085225">//&nbsp;Imports&nbsp;are&nbsp;always&nbsp;first.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085257">return</span>&nbsp;<span class="builtintype" id="6085264">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085276">if</span>&nbsp;<span class="ident" id="6085279"><a href="/gostd/go/format/format.go.html#6085112">d</a></span><span class="op" id="6085280">.</span><span class="ident" id="6085281"><a href="/gostd/go/ast/ast.go.html#3822333">Lparen</a></span><span class="op" id="6085287">.</span><span class="ident" id="6085288"><a href="/gostd/go/token/position.go.html#3876151">IsValid</a></span><span class="op" id="6085295">(</span><span class="op" id="6085296">)</span>&nbsp;<span class="op" id="6085298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085303">//&nbsp;For&nbsp;now&nbsp;assume&nbsp;all&nbsp;grouped&nbsp;imports&nbsp;are&nbsp;unsorted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085358">//&nbsp;TODO(gri)&nbsp;Should&nbsp;check&nbsp;if&nbsp;they&nbsp;are&nbsp;sorted&nbsp;already.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085415">return</span>&nbsp;<span class="builtintype" id="6085422">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085433">//&nbsp;Ungrouped&nbsp;imports&nbsp;are&nbsp;sorted&nbsp;by&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085481">return</span>&nbsp;<span class="builtintype" id="6085488">false</span><br>
<span class="lineno">115</span><span class="op" id="6085494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6085497">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6085577">//&nbsp;Support&nbsp;functions</span><br>
<span class="lineno"></span><span class="comment" id="6085598">//</span><br>
<span class="lineno">120</span><span class="comment" id="6085601">//&nbsp;The&nbsp;functions&nbsp;parse,&nbsp;format,&nbsp;and&nbsp;isSpace&nbsp;below&nbsp;are&nbsp;identical&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6085672">//&nbsp;respective&nbsp;functions&nbsp;in&nbsp;cmd/gofmt/gofmt.go&nbsp;-&nbsp;keep&nbsp;them&nbsp;in&nbsp;sync!</span><br>
<span class="lineno"></span><span class="comment" id="6085739">//</span><br>
<span class="lineno"></span><span class="comment" id="6085742">//&nbsp;TODO(gri)&nbsp;Factor&nbsp;out&nbsp;this&nbsp;functionality,&nbsp;eventually.</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="6085799">//&nbsp;parse&nbsp;parses&nbsp;src,&nbsp;which&nbsp;was&nbsp;read&nbsp;from&nbsp;the&nbsp;named&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="6085856">//&nbsp;as&nbsp;a&nbsp;Go&nbsp;source&nbsp;file,&nbsp;declaration,&nbsp;or&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="6085912">func</span>&nbsp;<span class="ident" id="6085917">parse</span><span class="op" id="6085922">(</span><span class="ident" id="6085923">fset</span>&nbsp;<span class="op" id="6085928">*</span><span class="ident" id="6085929"><a href="/gostd/go/format/format.go.html#6082326">token</a></span><span class="op" id="6085934">.</span><span class="ident" id="6085935"><a href="/gostd/go/token/position.go.html#3883366">FileSet</a></span><span class="op" id="6085942">,</span>&nbsp;<span class="ident" id="6085944">filename</span>&nbsp;<span class="builtintype" id="6085953">string</span><span class="op" id="6085959">,</span>&nbsp;<span class="ident" id="6085961">src</span>&nbsp;<span class="op" id="6085965">[</span><span class="op" id="6085966">]</span><span class="builtintype" id="6085967">byte</span><span class="op" id="6085971">,</span>&nbsp;<span class="ident" id="6085973">fragmentOk</span>&nbsp;<span class="builtintype" id="6085984">bool</span><span class="op" id="6085988">)</span>&nbsp;<span class="op" id="6085990">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085993">file</span>&nbsp;<span class="op" id="6085998">*</span><span class="ident" id="6085999"><a href="/gostd/go/format/format.go.html#6082289">ast</a></span><span class="op" id="6086002">.</span><span class="ident" id="6086003"><a href="/gostd/go/ast/ast.go.html#3823869">File</a></span><span class="op" id="6086007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086010">sourceAdj</span>&nbsp;<span class="keyword" id="6086020">func</span><span class="op" id="6086024">(</span><span class="ident" id="6086025">src</span>&nbsp;<span class="op" id="6086029">[</span><span class="op" id="6086030">]</span><span class="builtintype" id="6086031">byte</span><span class="op" id="6086035">,</span>&nbsp;<span class="ident" id="6086037">indent</span>&nbsp;<span class="builtintype" id="6086044">int</span><span class="op" id="6086047">)</span>&nbsp;<span class="op" id="6086049">[</span><span class="op" id="6086050">]</span><span class="builtintype" id="6086051">byte</span><span class="op" id="6086055">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086058">indentAdj</span>&nbsp;<span class="builtintype" id="6086068">int</span><span class="op" id="6086071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086074">err</span>&nbsp;<span class="builtintype" id="6086078">error</span><span class="op" id="6086083">,</span><br>
<span class="lineno"></span><span class="op" id="6086085">)</span>&nbsp;<span class="op" id="6086087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086090">//&nbsp;Try&nbsp;as&nbsp;whole&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086120"><a href="/gostd/go/format/format.go.html#6085993">file</a></span><span class="op" id="6086124">,</span>&nbsp;<span class="ident" id="6086126"><a href="/gostd/go/format/format.go.html#6086074">err</a></span>&nbsp;<span class="op" id="6086130">=</span>&nbsp;<span class="ident" id="6086132"><a href="/gostd/go/format/format.go.html#6082299">parser</a></span><span class="op" id="6086138">.</span><span class="ident" id="6086139"><a href="/gostd/go/parser/interface.go.html#5953223">ParseFile</a></span><span class="op" id="6086148">(</span><span class="ident" id="6086149"><a href="/gostd/go/format/format.go.html#6085923">fset</a></span><span class="op" id="6086153">,</span>&nbsp;<span class="ident" id="6086155"><a href="/gostd/go/format/format.go.html#6085944">filename</a></span><span class="op" id="6086163">,</span>&nbsp;<span class="ident" id="6086165"><a href="/gostd/go/format/format.go.html#6085961">src</a></span><span class="op" id="6086168">,</span>&nbsp;<span class="ident" id="6086170"><a href="/gostd/go/format/format.go.html#6082450">parserMode</a></span><span class="op" id="6086180">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086183">//&nbsp;If&nbsp;there&#39;s&nbsp;no&nbsp;error,&nbsp;return.&nbsp;&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086274">//&nbsp;package&nbsp;line&nbsp;and&nbsp;source&nbsp;fragments&nbsp;are&nbsp;ok,&nbsp;fall&nbsp;through&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086336">//&nbsp;try&nbsp;as&nbsp;a&nbsp;source&nbsp;fragment.&nbsp;&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086403">if</span>&nbsp;<span class="ident" id="6086406"><a href="/gostd/go/format/format.go.html#6086074">err</a></span>&nbsp;<span class="op" id="6086410">==</span>&nbsp;<span class="builtintype" id="6086413">nil</span>&nbsp;<span class="op" id="6086417">||</span>&nbsp;<span class="op" id="6086420">!</span><span class="ident" id="6086421"><a href="/gostd/go/format/format.go.html#6085973">fragmentOk</a></span>&nbsp;<span class="op" id="6086432">||</span>&nbsp;<span class="op" id="6086435">!</span><span class="ident" id="6086436"><a href="/gostd/go/format/format.go.html#6082344">strings</a></span><span class="op" id="6086443">.</span><span class="ident" id="6086444"><a href="/gostd/strings/strings.go.html#2968416">Contains</a></span><span class="op" id="6086452">(</span><span class="ident" id="6086453"><a href="/gostd/go/format/format.go.html#6086074">err</a></span><span class="op" id="6086456">.</span><span class="ident" id="6086457">Error</span><span class="op" id="6086462">(</span><span class="op" id="6086463">)</span><span class="op" id="6086464">,</span>&nbsp;<span class="string" id="6086466">&#34;expected&nbsp;&#39;package&#39;&#34;</span><span class="op" id="6086486">)</span>&nbsp;<span class="op" id="6086488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086492">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086504">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;declaration&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086561">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086596">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086658">//&nbsp;in&nbsp;psrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086693">psrc</span>&nbsp;<span class="op" id="6086698">:=</span>&nbsp;<span class="builtinfunc" id="6086701">append</span><span class="op" id="6086707">(</span><span class="op" id="6086708">[</span><span class="op" id="6086709">]</span><span class="builtintype" id="6086710">byte</span><span class="op" id="6086714">(</span><span class="string" id="6086715">&#34;package&nbsp;p;&#34;</span><span class="op" id="6086727">)</span><span class="op" id="6086728">,</span>&nbsp;<span class="ident" id="6086730"><a href="/gostd/go/format/format.go.html#6085961">src</a></span><span class="op" id="6086733">...</span><span class="op" id="6086736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086739"><a href="/gostd/go/format/format.go.html#6085993">file</a></span><span class="op" id="6086743">,</span>&nbsp;<span class="ident" id="6086745"><a href="/gostd/go/format/format.go.html#6086074">err</a></span>&nbsp;<span class="op" id="6086749">=</span>&nbsp;<span class="ident" id="6086751"><a href="/gostd/go/format/format.go.html#6082299">parser</a></span><span class="op" id="6086757">.</span><span class="ident" id="6086758"><a href="/gostd/go/parser/interface.go.html#5953223">ParseFile</a></span><span class="op" id="6086767">(</span><span class="ident" id="6086768"><a href="/gostd/go/format/format.go.html#6085923">fset</a></span><span class="op" id="6086772">,</span>&nbsp;<span class="ident" id="6086774"><a href="/gostd/go/format/format.go.html#6085944">filename</a></span><span class="op" id="6086782">,</span>&nbsp;<span class="ident" id="6086784"><a href="/gostd/go/format/format.go.html#6086693">psrc</a></span><span class="op" id="6086788">,</span>&nbsp;<span class="ident" id="6086790"><a href="/gostd/go/format/format.go.html#6082450">parserMode</a></span><span class="op" id="6086800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086803">if</span>&nbsp;<span class="ident" id="6086806"><a href="/gostd/go/format/format.go.html#6086074">err</a></span>&nbsp;<span class="op" id="6086810">==</span>&nbsp;<span class="builtintype" id="6086813">nil</span>&nbsp;<span class="op" id="6086817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086821"><a href="/gostd/go/format/format.go.html#6086010">sourceAdj</a></span>&nbsp;<span class="op" id="6086831">=</span>&nbsp;<span class="keyword" id="6086833">func</span><span class="op" id="6086837">(</span><span class="ident" id="6086838">src</span>&nbsp;<span class="op" id="6086842">[</span><span class="op" id="6086843">]</span><span class="builtintype" id="6086844">byte</span><span class="op" id="6086848">,</span>&nbsp;<span class="ident" id="6086850">indent</span>&nbsp;<span class="builtintype" id="6086857">int</span><span class="op" id="6086860">)</span>&nbsp;<span class="op" id="6086862">[</span><span class="op" id="6086863">]</span><span class="builtintype" id="6086864">byte</span>&nbsp;<span class="op" id="6086869">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086874">//&nbsp;Remove&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086907">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086947"><a href="/gostd/go/format/format.go.html#6086838">src</a></span>&nbsp;<span class="op" id="6086951">=</span>&nbsp;<span class="ident" id="6086953"><a href="/gostd/go/format/format.go.html#6086838">src</a></span><span class="op" id="6086956">[</span><span class="ident" id="6086957"><a href="/gostd/go/format/format.go.html#6086850">indent</a></span><span class="op" id="6086963">+</span><span class="builtinfunc" id="6086964">len</span><span class="op" id="6086967">(</span><span class="string" id="6086968">&#34;package&nbsp;p\n&#34;</span><span class="op" id="6086981">)</span><span class="op" id="6086982">:</span><span class="op" id="6086983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086988">return</span>&nbsp;<span class="ident" id="6086995"><a href="/gostd/go/format/format.go.html#6082273">bytes</a></span><span class="op" id="6087000">.</span><span class="ident" id="6087001"><a href="/gostd/bytes/bytes.go.html#1411807">TrimSpace</a></span><span class="op" id="6087010">(</span><span class="ident" id="6087011"><a href="/gostd/go/format/format.go.html#6086838">src</a></span><span class="op" id="6087014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087018">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087022">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087033">//&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087094">//&nbsp;declaration,&nbsp;fall&nbsp;through&nbsp;to&nbsp;try&nbsp;as&nbsp;a&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087152">//&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087192">if</span>&nbsp;<span class="op" id="6087195">!</span><span class="ident" id="6087196"><a href="/gostd/go/format/format.go.html#6082344">strings</a></span><span class="op" id="6087203">.</span><span class="ident" id="6087204"><a href="/gostd/strings/strings.go.html#2968416">Contains</a></span><span class="op" id="6087212">(</span><span class="ident" id="6087213"><a href="/gostd/go/format/format.go.html#6086074">err</a></span><span class="op" id="6087216">.</span><span class="ident" id="6087217">Error</span><span class="op" id="6087222">(</span><span class="op" id="6087223">)</span><span class="op" id="6087224">,</span>&nbsp;<span class="string" id="6087226">&#34;expected&nbsp;declaration&#34;</span><span class="op" id="6087248">)</span>&nbsp;<span class="op" id="6087250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087254">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087266">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;statement&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087321">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause&nbsp;and&nbsp;turning&nbsp;the&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087376">//&nbsp;into&nbsp;a&nbsp;function&nbsp;body.&nbsp;&nbsp;This&nbsp;handles&nbsp;expressions&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087433">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087495">//&nbsp;in&nbsp;fsrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087530">fsrc</span>&nbsp;<span class="op" id="6087535">:=</span>&nbsp;<span class="builtinfunc" id="6087538">append</span><span class="op" id="6087544">(</span><span class="builtinfunc" id="6087545">append</span><span class="op" id="6087551">(</span><span class="op" id="6087552">[</span><span class="op" id="6087553">]</span><span class="builtintype" id="6087554">byte</span><span class="op" id="6087558">(</span><span class="string" id="6087559">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="6087582">)</span><span class="op" id="6087583">,</span>&nbsp;<span class="ident" id="6087585"><a href="/gostd/go/format/format.go.html#6085961">src</a></span><span class="op" id="6087588">...</span><span class="op" id="6087591">)</span><span class="op" id="6087592">,</span>&nbsp;<span class="string" id="6087594">&#39;\n&#39;</span><span class="op" id="6087598">,</span>&nbsp;<span class="string" id="6087600">&#39;}&#39;</span><span class="op" id="6087603">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087606"><a href="/gostd/go/format/format.go.html#6085993">file</a></span><span class="op" id="6087610">,</span>&nbsp;<span class="ident" id="6087612"><a href="/gostd/go/format/format.go.html#6086074">err</a></span>&nbsp;<span class="op" id="6087616">=</span>&nbsp;<span class="ident" id="6087618"><a href="/gostd/go/format/format.go.html#6082299">parser</a></span><span class="op" id="6087624">.</span><span class="ident" id="6087625"><a href="/gostd/go/parser/interface.go.html#5953223">ParseFile</a></span><span class="op" id="6087634">(</span><span class="ident" id="6087635"><a href="/gostd/go/format/format.go.html#6085923">fset</a></span><span class="op" id="6087639">,</span>&nbsp;<span class="ident" id="6087641"><a href="/gostd/go/format/format.go.html#6085944">filename</a></span><span class="op" id="6087649">,</span>&nbsp;<span class="ident" id="6087651"><a href="/gostd/go/format/format.go.html#6087530">fsrc</a></span><span class="op" id="6087655">,</span>&nbsp;<span class="ident" id="6087657"><a href="/gostd/go/format/format.go.html#6082450">parserMode</a></span><span class="op" id="6087667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087670">if</span>&nbsp;<span class="ident" id="6087673"><a href="/gostd/go/format/format.go.html#6086074">err</a></span>&nbsp;<span class="op" id="6087677">==</span>&nbsp;<span class="builtintype" id="6087680">nil</span>&nbsp;<span class="op" id="6087684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087688"><a href="/gostd/go/format/format.go.html#6086010">sourceAdj</a></span>&nbsp;<span class="op" id="6087698">=</span>&nbsp;<span class="keyword" id="6087700">func</span><span class="op" id="6087704">(</span><span class="ident" id="6087705">src</span>&nbsp;<span class="op" id="6087709">[</span><span class="op" id="6087710">]</span><span class="builtintype" id="6087711">byte</span><span class="op" id="6087715">,</span>&nbsp;<span class="ident" id="6087717">indent</span>&nbsp;<span class="builtintype" id="6087724">int</span><span class="op" id="6087727">)</span>&nbsp;<span class="op" id="6087729">[</span><span class="op" id="6087730">]</span><span class="builtintype" id="6087731">byte</span>&nbsp;<span class="op" id="6087736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087741">//&nbsp;Cap&nbsp;adjusted&nbsp;indent&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087776">if</span>&nbsp;<span class="ident" id="6087779"><a href="/gostd/go/format/format.go.html#6087717">indent</a></span>&nbsp;<span class="op" id="6087786">&lt;</span>&nbsp;<span class="num" id="6087788">0</span>&nbsp;<span class="op" id="6087790">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087796"><a href="/gostd/go/format/format.go.html#6087717">indent</a></span>&nbsp;<span class="op" id="6087803">=</span>&nbsp;<span class="num" id="6087805">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087815">//&nbsp;Remove&nbsp;the&nbsp;wrapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087842">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087884">//&nbsp;There&nbsp;will&nbsp;be&nbsp;two&nbsp;non-blank&nbsp;lines&nbsp;with&nbsp;indent,&nbsp;hence&nbsp;2*indent.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087953"><a href="/gostd/go/format/format.go.html#6087705">src</a></span>&nbsp;<span class="op" id="6087957">=</span>&nbsp;<span class="ident" id="6087959"><a href="/gostd/go/format/format.go.html#6087705">src</a></span><span class="op" id="6087962">[</span><span class="num" id="6087963">2</span><span class="op" id="6087964">*</span><span class="ident" id="6087965"><a href="/gostd/go/format/format.go.html#6087717">indent</a></span><span class="op" id="6087971">+</span><span class="builtinfunc" id="6087972">len</span><span class="op" id="6087975">(</span><span class="string" id="6087976">&#34;package&nbsp;p\n\nfunc&nbsp;_()&nbsp;{&#34;</span><span class="op" id="6088001">)</span><span class="op" id="6088002">:</span><span class="op" id="6088003">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088008"><a href="/gostd/go/format/format.go.html#6087705">src</a></span>&nbsp;<span class="op" id="6088012">=</span>&nbsp;<span class="ident" id="6088014"><a href="/gostd/go/format/format.go.html#6087705">src</a></span><span class="op" id="6088017">[</span><span class="op" id="6088018">:</span><span class="builtinfunc" id="6088019">len</span><span class="op" id="6088022">(</span><span class="ident" id="6088023"><a href="/gostd/go/format/format.go.html#6087705">src</a></span><span class="op" id="6088026">)</span><span class="op" id="6088027">-</span><span class="op" id="6088028">(</span><span class="ident" id="6088029"><a href="/gostd/go/format/format.go.html#6087717">indent</a></span><span class="op" id="6088035">+</span><span class="builtinfunc" id="6088036">len</span><span class="op" id="6088039">(</span><span class="string" id="6088040">&#34;\n}\n&#34;</span><span class="op" id="6088047">)</span><span class="op" id="6088048">)</span><span class="op" id="6088049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088054">return</span>&nbsp;<span class="ident" id="6088061"><a href="/gostd/go/format/format.go.html#6082273">bytes</a></span><span class="op" id="6088066">.</span><span class="ident" id="6088067"><a href="/gostd/bytes/bytes.go.html#1411807">TrimSpace</a></span><span class="op" id="6088076">(</span><span class="ident" id="6088077"><a href="/gostd/go/format/format.go.html#6087705">src</a></span><span class="op" id="6088080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088088">//&nbsp;Gofmt&nbsp;has&nbsp;also&nbsp;indented&nbsp;the&nbsp;function&nbsp;body&nbsp;one&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088146">//&nbsp;Adjust&nbsp;that&nbsp;with&nbsp;indentAdj.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088179"><a href="/gostd/go/format/format.go.html#6086058">indentAdj</a></span>&nbsp;<span class="op" id="6088189">=</span>&nbsp;<span class="op" id="6088191">-</span><span class="num" id="6088192">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088199">//&nbsp;Succeeded,&nbsp;or&nbsp;out&nbsp;of&nbsp;options.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088233">return</span><br>
<span class="lineno"></span><span class="op" id="6088240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6088243">//&nbsp;format&nbsp;formats&nbsp;the&nbsp;given&nbsp;package&nbsp;file&nbsp;originally&nbsp;obtained&nbsp;from&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="6088313">//&nbsp;and&nbsp;adjusts&nbsp;the&nbsp;result&nbsp;based&nbsp;on&nbsp;the&nbsp;original&nbsp;source&nbsp;via&nbsp;sourceAdj</span><br>
<span class="lineno">195</span><span class="comment" id="6088382">//&nbsp;and&nbsp;indentAdj.</span><br>
<span class="lineno"></span><span class="keyword" id="6088400">func</span>&nbsp;<span class="ident" id="6088405">format</span><span class="op" id="6088411">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088414">fset</span>&nbsp;<span class="op" id="6088419">*</span><span class="ident" id="6088420"><a href="/gostd/go/format/format.go.html#6082326">token</a></span><span class="op" id="6088425">.</span><span class="ident" id="6088426"><a href="/gostd/go/token/position.go.html#3883366">FileSet</a></span><span class="op" id="6088433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088436">file</span>&nbsp;<span class="op" id="6088441">*</span><span class="ident" id="6088442"><a href="/gostd/go/format/format.go.html#6082289">ast</a></span><span class="op" id="6088445">.</span><span class="ident" id="6088446"><a href="/gostd/go/ast/ast.go.html#3823869">File</a></span><span class="op" id="6088450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088453">sourceAdj</span>&nbsp;<span class="keyword" id="6088463">func</span><span class="op" id="6088467">(</span><span class="ident" id="6088468">src</span>&nbsp;<span class="op" id="6088472">[</span><span class="op" id="6088473">]</span><span class="builtintype" id="6088474">byte</span><span class="op" id="6088478">,</span>&nbsp;<span class="ident" id="6088480">indent</span>&nbsp;<span class="builtintype" id="6088487">int</span><span class="op" id="6088490">)</span>&nbsp;<span class="op" id="6088492">[</span><span class="op" id="6088493">]</span><span class="builtintype" id="6088494">byte</span><span class="op" id="6088498">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088501">indentAdj</span>&nbsp;<span class="builtintype" id="6088511">int</span><span class="op" id="6088514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088517">src</span>&nbsp;<span class="op" id="6088521">[</span><span class="op" id="6088522">]</span><span class="builtintype" id="6088523">byte</span><span class="op" id="6088527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088530">cfg</span>&nbsp;<span class="ident" id="6088534"><a href="/gostd/go/format/format.go.html#6082312">printer</a></span><span class="op" id="6088541">.</span><span class="ident" id="6088542"><a href="/gostd/go/printer/printer.go.html#5877536">Config</a></span><span class="op" id="6088548">,</span><br>
<span class="lineno"></span><span class="op" id="6088550">)</span>&nbsp;<span class="op" id="6088552">(</span><span class="op" id="6088553">[</span><span class="op" id="6088554">]</span><span class="builtintype" id="6088555">byte</span><span class="op" id="6088559">,</span>&nbsp;<span class="builtintype" id="6088561">error</span><span class="op" id="6088566">)</span>&nbsp;<span class="op" id="6088568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088571">if</span>&nbsp;<span class="ident" id="6088574"><a href="/gostd/go/format/format.go.html#6088453">sourceAdj</a></span>&nbsp;<span class="op" id="6088584">==</span>&nbsp;<span class="builtintype" id="6088587">nil</span>&nbsp;<span class="op" id="6088591">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088595">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088622">var</span>&nbsp;<span class="ident" id="6088626">buf</span>&nbsp;<span class="ident" id="6088630"><a href="/gostd/go/format/format.go.html#6082273">bytes</a></span><span class="op" id="6088635">.</span><span class="ident" id="6088636"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088645">err</span>&nbsp;<span class="op" id="6088649">:=</span>&nbsp;<span class="ident" id="6088652"><a href="/gostd/go/format/format.go.html#6088530">cfg</a></span><span class="op" id="6088655">.</span><span class="ident" id="6088656"><a href="/gostd/go/printer/printer.go.html#5879714">Fprint</a></span><span class="op" id="6088662">(</span><span class="op" id="6088663">&amp;</span><span class="ident" id="6088664"><a href="/gostd/go/format/format.go.html#6088626">buf</a></span><span class="op" id="6088667">,</span>&nbsp;<span class="ident" id="6088669"><a href="/gostd/go/format/format.go.html#6088414">fset</a></span><span class="op" id="6088673">,</span>&nbsp;<span class="ident" id="6088675"><a href="/gostd/go/format/format.go.html#6088436">file</a></span><span class="op" id="6088679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088683">if</span>&nbsp;<span class="ident" id="6088686"><a href="/gostd/go/format/format.go.html#6088645">err</a></span>&nbsp;<span class="op" id="6088690">!=</span>&nbsp;<span class="builtintype" id="6088693">nil</span>&nbsp;<span class="op" id="6088697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088702">return</span>&nbsp;<span class="builtintype" id="6088709">nil</span><span class="op" id="6088712">,</span>&nbsp;<span class="ident" id="6088714"><a href="/gostd/go/format/format.go.html#6088645">err</a></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088724">return</span>&nbsp;<span class="ident" id="6088731"><a href="/gostd/go/format/format.go.html#6088626">buf</a></span><span class="op" id="6088734">.</span><span class="ident" id="6088735"><a href="/gostd/bytes/buffer.go.html#1384454">Bytes</a></span><span class="op" id="6088740">(</span><span class="op" id="6088741">)</span><span class="op" id="6088742">,</span>&nbsp;<span class="builtintype" id="6088744">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088753">//&nbsp;Partial&nbsp;source&nbsp;file.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088778">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;leading&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088819">i</span><span class="op" id="6088820">,</span>&nbsp;<span class="ident" id="6088822">j</span>&nbsp;<span class="op" id="6088824">:=</span>&nbsp;<span class="num" id="6088827">0</span><span class="op" id="6088828">,</span>&nbsp;<span class="num" id="6088830">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088833">for</span>&nbsp;<span class="ident" id="6088837"><a href="/gostd/go/format/format.go.html#6088822">j</a></span>&nbsp;<span class="op" id="6088839">&lt;</span>&nbsp;<span class="builtinfunc" id="6088841">len</span><span class="op" id="6088844">(</span><span class="ident" id="6088845"><a href="/gostd/go/format/format.go.html#6088517">src</a></span><span class="op" id="6088848">)</span>&nbsp;<span class="op" id="6088850">&amp;&amp;</span>&nbsp;<span class="ident" id="6088853"><a href="/gostd/go/format/format.go.html#6089815">isSpace</a></span><span class="op" id="6088860">(</span><span class="ident" id="6088861"><a href="/gostd/go/format/format.go.html#6088517">src</a></span><span class="op" id="6088864">[</span><span class="ident" id="6088865"><a href="/gostd/go/format/format.go.html#6088822">j</a></span><span class="op" id="6088866">]</span><span class="op" id="6088867">)</span>&nbsp;<span class="op" id="6088869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088873">if</span>&nbsp;<span class="ident" id="6088876"><a href="/gostd/go/format/format.go.html#6088517">src</a></span><span class="op" id="6088879">[</span><span class="ident" id="6088880"><a href="/gostd/go/format/format.go.html#6088822">j</a></span><span class="op" id="6088881">]</span>&nbsp;<span class="op" id="6088883">==</span>&nbsp;<span class="string" id="6088886">&#39;\n&#39;</span>&nbsp;<span class="op" id="6088891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088896"><a href="/gostd/go/format/format.go.html#6088819">i</a></span>&nbsp;<span class="op" id="6088898">=</span>&nbsp;<span class="ident" id="6088900"><a href="/gostd/go/format/format.go.html#6088822">j</a></span>&nbsp;<span class="op" id="6088902">+</span>&nbsp;<span class="num" id="6088904">1</span>&nbsp;<span class="comment" id="6088906">//&nbsp;byte&nbsp;offset&nbsp;of&nbsp;last&nbsp;line&nbsp;in&nbsp;leading&nbsp;space</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088957"><a href="/gostd/go/format/format.go.html#6088822">j</a></span><span class="op" id="6088958">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088965">var</span>&nbsp;<span class="ident" id="6088969">res</span>&nbsp;<span class="op" id="6088973">[</span><span class="op" id="6088974">]</span><span class="builtintype" id="6088975">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088981"><a href="/gostd/go/format/format.go.html#6088969">res</a></span>&nbsp;<span class="op" id="6088985">=</span>&nbsp;<span class="builtinfunc" id="6088987">append</span><span class="op" id="6088993">(</span><span class="ident" id="6088994"><a href="/gostd/go/format/format.go.html#6088969">res</a></span><span class="op" id="6088997">,</span>&nbsp;<span class="ident" id="6088999"><a href="/gostd/go/format/format.go.html#6088517">src</a></span><span class="op" id="6089002">[</span><span class="op" id="6089003">:</span><span class="ident" id="6089004"><a href="/gostd/go/format/format.go.html#6088819">i</a></span><span class="op" id="6089005">]</span><span class="op" id="6089006">...</span><span class="op" id="6089009">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089013">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;indentation&nbsp;of&nbsp;first&nbsp;code&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089071">//&nbsp;Spaces&nbsp;are&nbsp;ignored&nbsp;unless&nbsp;there&nbsp;are&nbsp;no&nbsp;tabs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089120">//&nbsp;in&nbsp;which&nbsp;case&nbsp;spaces&nbsp;count&nbsp;as&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089163">indent</span>&nbsp;<span class="op" id="6089170">:=</span>&nbsp;<span class="num" id="6089173">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089176">hasSpace</span>&nbsp;<span class="op" id="6089185">:=</span>&nbsp;<span class="builtintype" id="6089188">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089195">for</span>&nbsp;<span class="ident" id="6089199">_</span><span class="op" id="6089200">,</span>&nbsp;<span class="ident" id="6089202">b</span>&nbsp;<span class="op" id="6089204">:=</span>&nbsp;<span class="keyword" id="6089207">range</span>&nbsp;<span class="ident" id="6089213"><a href="/gostd/go/format/format.go.html#6088517">src</a></span><span class="op" id="6089216">[</span><span class="ident" id="6089217"><a href="/gostd/go/format/format.go.html#6088819">i</a></span><span class="op" id="6089218">:</span><span class="ident" id="6089219"><a href="/gostd/go/format/format.go.html#6088822">j</a></span><span class="op" id="6089220">]</span>&nbsp;<span class="op" id="6089222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089226">switch</span>&nbsp;<span class="ident" id="6089233"><a href="/gostd/go/format/format.go.html#6089202">b</a></span>&nbsp;<span class="op" id="6089235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089239">case</span>&nbsp;<span class="string" id="6089244">&#39;&nbsp;&#39;</span><span class="op" id="6089247">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089252"><a href="/gostd/go/format/format.go.html#6089176">hasSpace</a></span>&nbsp;<span class="op" id="6089261">=</span>&nbsp;<span class="builtintype" id="6089263">true</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089270">case</span>&nbsp;<span class="string" id="6089275">&#39;\t&#39;</span><span class="op" id="6089279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089284"><a href="/gostd/go/format/format.go.html#6089163">indent</a></span><span class="op" id="6089290">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089301">if</span>&nbsp;<span class="ident" id="6089304"><a href="/gostd/go/format/format.go.html#6089163">indent</a></span>&nbsp;<span class="op" id="6089311">==</span>&nbsp;<span class="num" id="6089314">0</span>&nbsp;<span class="op" id="6089316">&amp;&amp;</span>&nbsp;<span class="ident" id="6089319"><a href="/gostd/go/format/format.go.html#6089176">hasSpace</a></span>&nbsp;<span class="op" id="6089328">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089332"><a href="/gostd/go/format/format.go.html#6089163">indent</a></span>&nbsp;<span class="op" id="6089339">=</span>&nbsp;<span class="num" id="6089341">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089347">for</span>&nbsp;<span class="ident" id="6089351">i</span>&nbsp;<span class="op" id="6089353">:=</span>&nbsp;<span class="num" id="6089356">0</span><span class="op" id="6089357">;</span>&nbsp;<span class="ident" id="6089359"><a href="/gostd/go/format/format.go.html#6089351">i</a></span>&nbsp;<span class="op" id="6089361">&lt;</span>&nbsp;<span class="ident" id="6089363"><a href="/gostd/go/format/format.go.html#6089163">indent</a></span><span class="op" id="6089369">;</span>&nbsp;<span class="ident" id="6089371"><a href="/gostd/go/format/format.go.html#6089351">i</a></span><span class="op" id="6089372">++</span>&nbsp;<span class="op" id="6089375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089379"><a href="/gostd/go/format/format.go.html#6088969">res</a></span>&nbsp;<span class="op" id="6089383">=</span>&nbsp;<span class="builtinfunc" id="6089385">append</span><span class="op" id="6089391">(</span><span class="ident" id="6089392"><a href="/gostd/go/format/format.go.html#6088969">res</a></span><span class="op" id="6089395">,</span>&nbsp;<span class="string" id="6089397">&#39;\t&#39;</span><span class="op" id="6089401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089404">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089408">//&nbsp;Format&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089431">//&nbsp;Write&nbsp;it&nbsp;without&nbsp;any&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089484"><a href="/gostd/go/format/format.go.html#6088530">cfg</a></span><span class="op" id="6089487">.</span><span class="ident" id="6089488"><a href="/gostd/go/printer/printer.go.html#5877611">Indent</a></span>&nbsp;<span class="op" id="6089495">=</span>&nbsp;<span class="ident" id="6089497"><a href="/gostd/go/format/format.go.html#6089163">indent</a></span>&nbsp;<span class="op" id="6089504">+</span>&nbsp;<span class="ident" id="6089506"><a href="/gostd/go/format/format.go.html#6088501">indentAdj</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089517">var</span>&nbsp;<span class="ident" id="6089521">buf</span>&nbsp;<span class="ident" id="6089525"><a href="/gostd/go/format/format.go.html#6082273">bytes</a></span><span class="op" id="6089530">.</span><span class="ident" id="6089531"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089539">err</span>&nbsp;<span class="op" id="6089543">:=</span>&nbsp;<span class="ident" id="6089546"><a href="/gostd/go/format/format.go.html#6088530">cfg</a></span><span class="op" id="6089549">.</span><span class="ident" id="6089550"><a href="/gostd/go/printer/printer.go.html#5879714">Fprint</a></span><span class="op" id="6089556">(</span><span class="op" id="6089557">&amp;</span><span class="ident" id="6089558"><a href="/gostd/go/format/format.go.html#6089521">buf</a></span><span class="op" id="6089561">,</span>&nbsp;<span class="ident" id="6089563"><a href="/gostd/go/format/format.go.html#6088414">fset</a></span><span class="op" id="6089567">,</span>&nbsp;<span class="ident" id="6089569"><a href="/gostd/go/format/format.go.html#6088436">file</a></span><span class="op" id="6089573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089576">if</span>&nbsp;<span class="ident" id="6089579"><a href="/gostd/go/format/format.go.html#6089539">err</a></span>&nbsp;<span class="op" id="6089583">!=</span>&nbsp;<span class="builtintype" id="6089586">nil</span>&nbsp;<span class="op" id="6089590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089594">return</span>&nbsp;<span class="builtintype" id="6089601">nil</span><span class="op" id="6089604">,</span>&nbsp;<span class="ident" id="6089606"><a href="/gostd/go/format/format.go.html#6089539">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089614"><a href="/gostd/go/format/format.go.html#6088969">res</a></span>&nbsp;<span class="op" id="6089618">=</span>&nbsp;<span class="builtinfunc" id="6089620">append</span><span class="op" id="6089626">(</span><span class="ident" id="6089627"><a href="/gostd/go/format/format.go.html#6088969">res</a></span><span class="op" id="6089630">,</span>&nbsp;<span class="ident" id="6089632"><a href="/gostd/go/format/format.go.html#6088453">sourceAdj</a></span><span class="op" id="6089641">(</span><span class="ident" id="6089642"><a href="/gostd/go/format/format.go.html#6089521">buf</a></span><span class="op" id="6089645">.</span><span class="ident" id="6089646"><a href="/gostd/bytes/buffer.go.html#1384454">Bytes</a></span><span class="op" id="6089651">(</span><span class="op" id="6089652">)</span><span class="op" id="6089653">,</span>&nbsp;<span class="ident" id="6089655"><a href="/gostd/go/format/format.go.html#6088530">cfg</a></span><span class="op" id="6089658">.</span><span class="ident" id="6089659"><a href="/gostd/go/printer/printer.go.html#5877611">Indent</a></span><span class="op" id="6089665">)</span><span class="op" id="6089666">...</span><span class="op" id="6089669">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089673">//&nbsp;Determine&nbsp;and&nbsp;append&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089714"><a href="/gostd/go/format/format.go.html#6088819">i</a></span>&nbsp;<span class="op" id="6089716">=</span>&nbsp;<span class="builtinfunc" id="6089718">len</span><span class="op" id="6089721">(</span><span class="ident" id="6089722"><a href="/gostd/go/format/format.go.html#6088517">src</a></span><span class="op" id="6089725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089728">for</span>&nbsp;<span class="ident" id="6089732"><a href="/gostd/go/format/format.go.html#6088819">i</a></span>&nbsp;<span class="op" id="6089734">&gt;</span>&nbsp;<span class="num" id="6089736">0</span>&nbsp;<span class="op" id="6089738">&amp;&amp;</span>&nbsp;<span class="ident" id="6089741"><a href="/gostd/go/format/format.go.html#6089815">isSpace</a></span><span class="op" id="6089748">(</span><span class="ident" id="6089749"><a href="/gostd/go/format/format.go.html#6088517">src</a></span><span class="op" id="6089752">[</span><span class="ident" id="6089753"><a href="/gostd/go/format/format.go.html#6088819">i</a></span><span class="op" id="6089754">-</span><span class="num" id="6089755">1</span><span class="op" id="6089756">]</span><span class="op" id="6089757">)</span>&nbsp;<span class="op" id="6089759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089763"><a href="/gostd/go/format/format.go.html#6088819">i</a></span><span class="op" id="6089764">--</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089771">return</span>&nbsp;<span class="builtinfunc" id="6089778">append</span><span class="op" id="6089784">(</span><span class="ident" id="6089785"><a href="/gostd/go/format/format.go.html#6088969">res</a></span><span class="op" id="6089788">,</span>&nbsp;<span class="ident" id="6089790"><a href="/gostd/go/format/format.go.html#6088517">src</a></span><span class="op" id="6089793">[</span><span class="ident" id="6089794"><a href="/gostd/go/format/format.go.html#6088819">i</a></span><span class="op" id="6089795">:</span><span class="op" id="6089796">]</span><span class="op" id="6089797">...</span><span class="op" id="6089800">)</span><span class="op" id="6089801">,</span>&nbsp;<span class="builtintype" id="6089803">nil</span><br>
<span class="lineno"></span><span class="op" id="6089807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6089810">func</span>&nbsp;<span class="ident" id="6089815">isSpace</span><span class="op" id="6089822">(</span><span class="ident" id="6089823">b</span>&nbsp;<span class="builtintype" id="6089825">byte</span><span class="op" id="6089829">)</span>&nbsp;<span class="builtintype" id="6089831">bool</span>&nbsp;<span class="op" id="6089836">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089839">return</span>&nbsp;<span class="ident" id="6089846"><a href="/gostd/go/format/format.go.html#6089823">b</a></span>&nbsp;<span class="op" id="6089848">==</span>&nbsp;<span class="string" id="6089851">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6089855">||</span>&nbsp;<span class="ident" id="6089858"><a href="/gostd/go/format/format.go.html#6089823">b</a></span>&nbsp;<span class="op" id="6089860">==</span>&nbsp;<span class="string" id="6089863">&#39;\t&#39;</span>&nbsp;<span class="op" id="6089868">||</span>&nbsp;<span class="ident" id="6089871"><a href="/gostd/go/format/format.go.html#6089823">b</a></span>&nbsp;<span class="op" id="6089873">==</span>&nbsp;<span class="string" id="6089876">&#39;\n&#39;</span>&nbsp;<span class="op" id="6089881">||</span>&nbsp;<span class="ident" id="6089884"><a href="/gostd/go/format/format.go.html#6089823">b</a></span>&nbsp;<span class="op" id="6089886">==</span>&nbsp;<span class="string" id="6089889">&#39;\r&#39;</span><br>
<span class="lineno"></span><span class="op" id="6089894">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
