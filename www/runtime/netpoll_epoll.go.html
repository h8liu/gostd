<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1878525">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1878580">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1878634">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1878685">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1878702">package</span>&nbsp;<span class="ident" id="1878710">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1878719">import</span>&nbsp;<span class="string" id="1878726">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1878736">func</span>&nbsp;<span class="ident" id="1878741">epollcreate</span><span class="op" id="1878752">(</span><span class="ident" id="1878753">size</span>&nbsp;<span class="builtintype" id="1878758">int32</span><span class="op" id="1878763">)</span>&nbsp;<span class="builtintype" id="1878765">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1878771">func</span>&nbsp;<span class="ident" id="1878776">epollcreate1</span><span class="op" id="1878788">(</span><span class="ident" id="1878789">flags</span>&nbsp;<span class="builtintype" id="1878795">int32</span><span class="op" id="1878800">)</span>&nbsp;<span class="builtintype" id="1878802">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1878809">//go:noescape</span><br>
<span class="lineno">15</span><span class="keyword" id="1878823">func</span>&nbsp;<span class="ident" id="1878828">epollctl</span><span class="op" id="1878836">(</span><span class="ident" id="1878837">epfd</span><span class="op" id="1878841">,</span>&nbsp;<span class="ident" id="1878843">op</span><span class="op" id="1878845">,</span>&nbsp;<span class="ident" id="1878847">fd</span>&nbsp;<span class="builtintype" id="1878850">int32</span><span class="op" id="1878855">,</span>&nbsp;<span class="ident" id="1878857">ev</span>&nbsp;<span class="op" id="1878860">*</span><span class="ident" id="1878861"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028991">epollevent</a></span><span class="op" id="1878871">)</span>&nbsp;<span class="builtintype" id="1878873">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1878880">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="1878894">func</span>&nbsp;<span class="ident" id="1878899">epollwait</span><span class="op" id="1878908">(</span><span class="ident" id="1878909">epfd</span>&nbsp;<span class="builtintype" id="1878914">int32</span><span class="op" id="1878919">,</span>&nbsp;<span class="ident" id="1878921">ev</span>&nbsp;<span class="op" id="1878924">*</span><span class="ident" id="1878925"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028991">epollevent</a></span><span class="op" id="1878935">,</span>&nbsp;<span class="ident" id="1878937">nev</span><span class="op" id="1878940">,</span>&nbsp;<span class="ident" id="1878942">timeout</span>&nbsp;<span class="builtintype" id="1878950">int32</span><span class="op" id="1878955">)</span>&nbsp;<span class="builtintype" id="1878957">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1878963">func</span>&nbsp;<span class="ident" id="1878968">closeonexec</span><span class="op" id="1878979">(</span><span class="ident" id="1878980">fd</span>&nbsp;<span class="builtintype" id="1878983">int32</span><span class="op" id="1878988">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1878991">var</span>&nbsp;<span class="op" id="1878995">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1878998">epfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1879013">int32</span>&nbsp;<span class="op" id="1879019">=</span>&nbsp;<span class="op" id="1879021">-</span><span class="num" id="1879022">1</span>&nbsp;<span class="comment" id="1879024">//&nbsp;epoll&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879045">netpolllasterr</span>&nbsp;<span class="builtintype" id="1879060">int32</span><br>
<span class="lineno"></span><span class="op" id="1879066">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="1879069">func</span>&nbsp;<span class="ident" id="1879074">netpollinit</span><span class="op" id="1879085">(</span><span class="op" id="1879086">)</span>&nbsp;<span class="op" id="1879088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879091"><a href="/runtime/netpoll_epoll.go.html#1878998">epfd</a></span>&nbsp;<span class="op" id="1879096">=</span>&nbsp;<span class="ident" id="1879098"><a href="/runtime/netpoll_epoll.go.html#1878776">epollcreate1</a></span><span class="op" id="1879110">(</span><span class="ident" id="1879111"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028484">_EPOLL_CLOEXEC</a></span><span class="op" id="1879125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879128">if</span>&nbsp;<span class="ident" id="1879131"><a href="/runtime/netpoll_epoll.go.html#1878998">epfd</a></span>&nbsp;<span class="op" id="1879136">&gt;=</span>&nbsp;<span class="num" id="1879139">0</span>&nbsp;<span class="op" id="1879141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879145">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1879153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879156"><a href="/runtime/netpoll_epoll.go.html#1878998">epfd</a></span>&nbsp;<span class="op" id="1879161">=</span>&nbsp;<span class="ident" id="1879163"><a href="/runtime/netpoll_epoll.go.html#1878741">epollcreate</a></span><span class="op" id="1879174">(</span><span class="num" id="1879175">1024</span><span class="op" id="1879179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879182">if</span>&nbsp;<span class="ident" id="1879185"><a href="/runtime/netpoll_epoll.go.html#1878998">epfd</a></span>&nbsp;<span class="op" id="1879190">&gt;=</span>&nbsp;<span class="num" id="1879193">0</span>&nbsp;<span class="op" id="1879195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879199"><a href="/runtime/netpoll_epoll.go.html#1878968">closeonexec</a></span><span class="op" id="1879210">(</span><span class="ident" id="1879211"><a href="/runtime/netpoll_epoll.go.html#1878998">epfd</a></span><span class="op" id="1879215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879219">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1879227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1879230">println</span><span class="op" id="1879237">(</span><span class="string" id="1879238">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;epoll&nbsp;descriptor&#34;</span><span class="op" id="1879286">,</span>&nbsp;<span class="op" id="1879288">-</span><span class="ident" id="1879289"><a href="/runtime/netpoll_epoll.go.html#1878998">epfd</a></span><span class="op" id="1879293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879296"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1879303">(</span><span class="string" id="1879304">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;descriptor&#34;</span><span class="op" id="1879346">)</span><br>
<span class="lineno"></span><span class="op" id="1879348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1879351">func</span>&nbsp;<span class="ident" id="1879356">netpollopen</span><span class="op" id="1879367">(</span><span class="ident" id="1879368">fd</span>&nbsp;<span class="builtintype" id="1879371">uintptr</span><span class="op" id="1879378">,</span>&nbsp;<span class="ident" id="1879380">pd</span>&nbsp;<span class="op" id="1879383">*</span><span class="ident" id="1879384"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1879392">)</span>&nbsp;<span class="builtintype" id="1879394">int32</span>&nbsp;<span class="op" id="1879400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879403">var</span>&nbsp;<span class="ident" id="1879407">ev</span>&nbsp;<span class="ident" id="1879410"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028991">epollevent</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879422"><a href="/runtime/netpoll_epoll.go.html#1879407">ev</a></span><span class="op" id="1879424">.</span><span class="ident" id="1879425">events</span>&nbsp;<span class="op" id="1879432">=</span>&nbsp;<span class="ident" id="1879434"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028351">_EPOLLIN</a></span>&nbsp;<span class="op" id="1879443">|</span>&nbsp;<span class="ident" id="1879445"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028370">_EPOLLOUT</a></span>&nbsp;<span class="op" id="1879455">|</span>&nbsp;<span class="ident" id="1879457"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028431">_EPOLLRDHUP</a></span>&nbsp;<span class="op" id="1879469">|</span>&nbsp;<span class="ident" id="1879471"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028456">_EPOLLET</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1879481">*</span><span class="op" id="1879482">(</span><span class="op" id="1879483">*</span><span class="op" id="1879484">*</span><span class="ident" id="1879485"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1879493">)</span><span class="op" id="1879494">(</span><span class="ident" id="1879495"><a href="/runtime/netpoll_epoll.go.html#1878726">unsafe</a></span><span class="op" id="1879501">.</span><span class="ident" id="1879502">Pointer</span><span class="op" id="1879509">(</span><span class="op" id="1879510">&amp;</span><span class="ident" id="1879511"><a href="/runtime/netpoll_epoll.go.html#1879407">ev</a></span><span class="op" id="1879513">.</span><span class="ident" id="1879514">data</span><span class="op" id="1879518">)</span><span class="op" id="1879519">)</span>&nbsp;<span class="op" id="1879521">=</span>&nbsp;<span class="ident" id="1879523"><a href="/runtime/netpoll_epoll.go.html#1879380">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879527">return</span>&nbsp;<span class="op" id="1879534">-</span><span class="ident" id="1879535"><a href="/runtime/netpoll_epoll.go.html#1878828">epollctl</a></span><span class="op" id="1879543">(</span><span class="ident" id="1879544"><a href="/runtime/netpoll_epoll.go.html#1878998">epfd</a></span><span class="op" id="1879548">,</span>&nbsp;<span class="ident" id="1879550"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028514">_EPOLL_CTL_ADD</a></span><span class="op" id="1879564">,</span>&nbsp;<span class="builtintype" id="1879566">int32</span><span class="op" id="1879571">(</span><span class="ident" id="1879572"><a href="/runtime/netpoll_epoll.go.html#1879368">fd</a></span><span class="op" id="1879574">)</span><span class="op" id="1879575">,</span>&nbsp;<span class="op" id="1879577">&amp;</span><span class="ident" id="1879578"><a href="/runtime/netpoll_epoll.go.html#1879407">ev</a></span><span class="op" id="1879580">)</span><br>
<span class="lineno">45</span><span class="op" id="1879582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1879585">func</span>&nbsp;<span class="ident" id="1879590">netpollclose</span><span class="op" id="1879602">(</span><span class="ident" id="1879603">fd</span>&nbsp;<span class="builtintype" id="1879606">uintptr</span><span class="op" id="1879613">)</span>&nbsp;<span class="builtintype" id="1879615">int32</span>&nbsp;<span class="op" id="1879621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879624">var</span>&nbsp;<span class="ident" id="1879628">ev</span>&nbsp;<span class="ident" id="1879631"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028991">epollevent</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879643">return</span>&nbsp;<span class="op" id="1879650">-</span><span class="ident" id="1879651"><a href="/runtime/netpoll_epoll.go.html#1878828">epollctl</a></span><span class="op" id="1879659">(</span><span class="ident" id="1879660"><a href="/runtime/netpoll_epoll.go.html#1878998">epfd</a></span><span class="op" id="1879664">,</span>&nbsp;<span class="ident" id="1879666"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028539">_EPOLL_CTL_DEL</a></span><span class="op" id="1879680">,</span>&nbsp;<span class="builtintype" id="1879682">int32</span><span class="op" id="1879687">(</span><span class="ident" id="1879688"><a href="/runtime/netpoll_epoll.go.html#1879603">fd</a></span><span class="op" id="1879690">)</span><span class="op" id="1879691">,</span>&nbsp;<span class="op" id="1879693">&amp;</span><span class="ident" id="1879694"><a href="/runtime/netpoll_epoll.go.html#1879628">ev</a></span><span class="op" id="1879696">)</span><br>
<span class="lineno">50</span><span class="op" id="1879698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1879701">func</span>&nbsp;<span class="ident" id="1879706">netpollarm</span><span class="op" id="1879716">(</span><span class="ident" id="1879717">pd</span>&nbsp;<span class="op" id="1879720">*</span><span class="ident" id="1879721"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1879729">,</span>&nbsp;<span class="ident" id="1879731">mode</span>&nbsp;<span class="builtintype" id="1879736">int</span><span class="op" id="1879739">)</span>&nbsp;<span class="op" id="1879741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879744"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1879751">(</span><span class="string" id="1879752">&#34;unused&#34;</span><span class="op" id="1879760">)</span><br>
<span class="lineno"></span><span class="op" id="1879762">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1879765">//&nbsp;polls&nbsp;for&nbsp;ready&nbsp;network&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="1879804">//&nbsp;returns&nbsp;list&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;become&nbsp;runnable</span><br>
<span class="lineno"></span><span class="keyword" id="1879855">func</span>&nbsp;<span class="ident" id="1879860">netpoll</span><span class="op" id="1879867">(</span><span class="ident" id="1879868">block</span>&nbsp;<span class="builtintype" id="1879874">bool</span><span class="op" id="1879878">)</span>&nbsp;<span class="op" id="1879880">(</span><span class="ident" id="1879881">gp</span>&nbsp;<span class="op" id="1879884">*</span><span class="ident" id="1879885"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><span class="op" id="1879886">)</span>&nbsp;<span class="op" id="1879888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879891">if</span>&nbsp;<span class="ident" id="1879894"><a href="/runtime/netpoll_epoll.go.html#1878998">epfd</a></span>&nbsp;<span class="op" id="1879899">==</span>&nbsp;<span class="op" id="1879902">-</span><span class="num" id="1879903">1</span>&nbsp;<span class="op" id="1879905">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879909">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1879917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879920">waitms</span>&nbsp;<span class="op" id="1879927">:=</span>&nbsp;<span class="builtintype" id="1879930">int32</span><span class="op" id="1879935">(</span><span class="op" id="1879936">-</span><span class="num" id="1879937">1</span><span class="op" id="1879938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879941">if</span>&nbsp;<span class="op" id="1879944">!</span><span class="ident" id="1879945"><a href="/runtime/netpoll_epoll.go.html#1879868">block</a></span>&nbsp;<span class="op" id="1879951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879955"><a href="/runtime/netpoll_epoll.go.html#1879920">waitms</a></span>&nbsp;<span class="op" id="1879962">=</span>&nbsp;<span class="num" id="1879964">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1879967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879970">var</span>&nbsp;<span class="ident" id="1879974">events</span>&nbsp;<span class="op" id="1879981">[</span><span class="num" id="1879982">128</span><span class="op" id="1879985">]</span><span class="ident" id="1879986"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028991">epollevent</a></span><br>
<span class="lineno"></span><span class="ident" id="1879997">retry</span><span class="op" id="1880002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880005">n</span>&nbsp;<span class="op" id="1880007">:=</span>&nbsp;<span class="ident" id="1880010"><a href="/runtime/netpoll_epoll.go.html#1878899">epollwait</a></span><span class="op" id="1880019">(</span><span class="ident" id="1880020"><a href="/runtime/netpoll_epoll.go.html#1878998">epfd</a></span><span class="op" id="1880024">,</span>&nbsp;<span class="op" id="1880026">&amp;</span><span class="ident" id="1880027"><a href="/runtime/netpoll_epoll.go.html#1879974">events</a></span><span class="op" id="1880033">[</span><span class="num" id="1880034">0</span><span class="op" id="1880035">]</span><span class="op" id="1880036">,</span>&nbsp;<span class="builtintype" id="1880038">int32</span><span class="op" id="1880043">(</span><span class="builtinfunc" id="1880044">len</span><span class="op" id="1880047">(</span><span class="ident" id="1880048"><a href="/runtime/netpoll_epoll.go.html#1879974">events</a></span><span class="op" id="1880054">)</span><span class="op" id="1880055">)</span><span class="op" id="1880056">,</span>&nbsp;<span class="ident" id="1880058"><a href="/runtime/netpoll_epoll.go.html#1879920">waitms</a></span><span class="op" id="1880064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880067">if</span>&nbsp;<span class="ident" id="1880070"><a href="/runtime/netpoll_epoll.go.html#1880005">n</a></span>&nbsp;<span class="op" id="1880072">&lt;</span>&nbsp;<span class="num" id="1880074">0</span>&nbsp;<span class="op" id="1880076">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880080">if</span>&nbsp;<span class="ident" id="1880083"><a href="/runtime/netpoll_epoll.go.html#1880005">n</a></span>&nbsp;<span class="op" id="1880085">!=</span>&nbsp;<span class="op" id="1880088">-</span><span class="ident" id="1880089"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2027062">_EINTR</a></span>&nbsp;<span class="op" id="1880096">&amp;&amp;</span>&nbsp;<span class="ident" id="1880099"><a href="/runtime/netpoll_epoll.go.html#1880005">n</a></span>&nbsp;<span class="op" id="1880101">!=</span>&nbsp;<span class="ident" id="1880104"><a href="/runtime/netpoll_epoll.go.html#1879045">netpolllasterr</a></span>&nbsp;<span class="op" id="1880119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880124"><a href="/runtime/netpoll_epoll.go.html#1879045">netpolllasterr</a></span>&nbsp;<span class="op" id="1880139">=</span>&nbsp;<span class="ident" id="1880141"><a href="/runtime/netpoll_epoll.go.html#1880005">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1880146">println</span><span class="op" id="1880153">(</span><span class="string" id="1880154">&#34;runtime:&nbsp;epollwait&nbsp;on&nbsp;fd&#34;</span><span class="op" id="1880180">,</span>&nbsp;<span class="ident" id="1880182"><a href="/runtime/netpoll_epoll.go.html#1878998">epfd</a></span><span class="op" id="1880186">,</span>&nbsp;<span class="string" id="1880188">&#34;failed&nbsp;with&#34;</span><span class="op" id="1880201">,</span>&nbsp;<span class="op" id="1880203">-</span><span class="ident" id="1880204"><a href="/runtime/netpoll_epoll.go.html#1880005">n</a></span><span class="op" id="1880205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1880209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880213">goto</span>&nbsp;<span class="ident" id="1880218">retry</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1880225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880228">for</span>&nbsp;<span class="ident" id="1880232">i</span>&nbsp;<span class="op" id="1880234">:=</span>&nbsp;<span class="builtintype" id="1880237">int32</span><span class="op" id="1880242">(</span><span class="num" id="1880243">0</span><span class="op" id="1880244">)</span><span class="op" id="1880245">;</span>&nbsp;<span class="ident" id="1880247"><a href="/runtime/netpoll_epoll.go.html#1880232">i</a></span>&nbsp;<span class="op" id="1880249">&lt;</span>&nbsp;<span class="ident" id="1880251"><a href="/runtime/netpoll_epoll.go.html#1880005">n</a></span><span class="op" id="1880252">;</span>&nbsp;<span class="ident" id="1880254"><a href="/runtime/netpoll_epoll.go.html#1880232">i</a></span><span class="op" id="1880255">++</span>&nbsp;<span class="op" id="1880258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880262">ev</span>&nbsp;<span class="op" id="1880265">:=</span>&nbsp;<span class="op" id="1880268">&amp;</span><span class="ident" id="1880269"><a href="/runtime/netpoll_epoll.go.html#1879974">events</a></span><span class="op" id="1880275">[</span><span class="ident" id="1880276"><a href="/runtime/netpoll_epoll.go.html#1880232">i</a></span><span class="op" id="1880277">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880281">if</span>&nbsp;<span class="ident" id="1880284"><a href="/runtime/netpoll_epoll.go.html#1880262">ev</a></span><span class="op" id="1880286">.</span><span class="ident" id="1880287">events</span>&nbsp;<span class="op" id="1880294">==</span>&nbsp;<span class="num" id="1880297">0</span>&nbsp;<span class="op" id="1880299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880304">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1880315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880319">var</span>&nbsp;<span class="ident" id="1880323">mode</span>&nbsp;<span class="builtintype" id="1880328">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880336">if</span>&nbsp;<span class="ident" id="1880339"><a href="/runtime/netpoll_epoll.go.html#1880262">ev</a></span><span class="op" id="1880341">.</span><span class="ident" id="1880342">events</span><span class="op" id="1880348">&amp;</span><span class="op" id="1880349">(</span><span class="ident" id="1880350"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028351">_EPOLLIN</a></span><span class="op" id="1880358">|</span><span class="ident" id="1880359"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028431">_EPOLLRDHUP</a></span><span class="op" id="1880370">|</span><span class="ident" id="1880371"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028410">_EPOLLHUP</a></span><span class="op" id="1880380">|</span><span class="ident" id="1880381"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028390">_EPOLLERR</a></span><span class="op" id="1880390">)</span>&nbsp;<span class="op" id="1880392">!=</span>&nbsp;<span class="num" id="1880395">0</span>&nbsp;<span class="op" id="1880397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880402"><a href="/runtime/netpoll_epoll.go.html#1880323">mode</a></span>&nbsp;<span class="op" id="1880407">+=</span>&nbsp;<span class="string" id="1880410">&#39;r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1880416">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880420">if</span>&nbsp;<span class="ident" id="1880423"><a href="/runtime/netpoll_epoll.go.html#1880262">ev</a></span><span class="op" id="1880425">.</span><span class="ident" id="1880426">events</span><span class="op" id="1880432">&amp;</span><span class="op" id="1880433">(</span><span class="ident" id="1880434"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028370">_EPOLLOUT</a></span><span class="op" id="1880443">|</span><span class="ident" id="1880444"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028410">_EPOLLHUP</a></span><span class="op" id="1880453">|</span><span class="ident" id="1880454"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2028390">_EPOLLERR</a></span><span class="op" id="1880463">)</span>&nbsp;<span class="op" id="1880465">!=</span>&nbsp;<span class="num" id="1880468">0</span>&nbsp;<span class="op" id="1880470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880475"><a href="/runtime/netpoll_epoll.go.html#1880323">mode</a></span>&nbsp;<span class="op" id="1880480">+=</span>&nbsp;<span class="string" id="1880483">&#39;w&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1880489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880493">if</span>&nbsp;<span class="ident" id="1880496"><a href="/runtime/netpoll_epoll.go.html#1880323">mode</a></span>&nbsp;<span class="op" id="1880501">!=</span>&nbsp;<span class="num" id="1880504">0</span>&nbsp;<span class="op" id="1880506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880511">pd</span>&nbsp;<span class="op" id="1880514">:=</span>&nbsp;<span class="op" id="1880517">*</span><span class="op" id="1880518">(</span><span class="op" id="1880519">*</span><span class="op" id="1880520">*</span><span class="ident" id="1880521"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1880529">)</span><span class="op" id="1880530">(</span><span class="ident" id="1880531"><a href="/runtime/netpoll_epoll.go.html#1878726">unsafe</a></span><span class="op" id="1880537">.</span><span class="ident" id="1880538">Pointer</span><span class="op" id="1880545">(</span><span class="op" id="1880546">&amp;</span><span class="ident" id="1880547"><a href="/runtime/netpoll_epoll.go.html#1880262">ev</a></span><span class="op" id="1880549">.</span><span class="ident" id="1880550">data</span><span class="op" id="1880554">)</span><span class="op" id="1880555">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880560"><a href="/runtime/netpoll.go.html#1874504">netpollready</a></span><span class="op" id="1880572">(</span><span class="op" id="1880573">(</span><span class="op" id="1880574">*</span><span class="op" id="1880575">*</span><span class="ident" id="1880576"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><span class="op" id="1880577">)</span><span class="op" id="1880578">(</span><span class="ident" id="1880579"><a href="/runtime/stubs.go.html#1973287">noescape</a></span><span class="op" id="1880587">(</span><span class="ident" id="1880588"><a href="/runtime/netpoll_epoll.go.html#1878726">unsafe</a></span><span class="op" id="1880594">.</span><span class="ident" id="1880595">Pointer</span><span class="op" id="1880602">(</span><span class="op" id="1880603">&amp;</span><span class="ident" id="1880604"><a href="/runtime/netpoll_epoll.go.html#1879881">gp</a></span><span class="op" id="1880606">)</span><span class="op" id="1880607">)</span><span class="op" id="1880608">)</span><span class="op" id="1880609">,</span>&nbsp;<span class="ident" id="1880611"><a href="/runtime/netpoll_epoll.go.html#1880511">pd</a></span><span class="op" id="1880613">,</span>&nbsp;<span class="ident" id="1880615"><a href="/runtime/netpoll_epoll.go.html#1880323">mode</a></span><span class="op" id="1880619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1880623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1880626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880629">if</span>&nbsp;<span class="ident" id="1880632"><a href="/runtime/netpoll_epoll.go.html#1879868">block</a></span>&nbsp;<span class="op" id="1880638">&amp;&amp;</span>&nbsp;<span class="ident" id="1880641"><a href="/runtime/netpoll_epoll.go.html#1879881">gp</a></span>&nbsp;<span class="op" id="1880644">==</span>&nbsp;<span class="ident" id="1880647">nil</span>&nbsp;<span class="op" id="1880651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880655">goto</span>&nbsp;<span class="ident" id="1880660">retry</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1880667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880670">return</span>&nbsp;<span class="ident" id="1880677"><a href="/runtime/netpoll_epoll.go.html#1879881">gp</a></span><br>
<span class="lineno"></span><span class="op" id="1880680">}</span>
</div>
</body>
</html>
