<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strconv</h2>
<ul>
<li><a href="/gostd/strconv/atob.go.html">atob.go</a></li>
<li><a href="/gostd/strconv/atob_test.go.html">atob_test.go</a></li>
<li><a href="/gostd/strconv/atof.go.html">atof.go</a></li>
<li><a href="/gostd/strconv/atof_test.go.html">atof_test.go</a></li>
<li><a href="/gostd/strconv/atoi.go.html">atoi.go</a></li>
<li><a href="/gostd/strconv/atoi_test.go.html">atoi_test.go</a></li>
<li><a href="/gostd/strconv/decimal.go.html">decimal.go</a></li>
<li><a href="/gostd/strconv/decimal_test.go.html">decimal_test.go</a></li>
<li><a href="/gostd/strconv/extfloat.go.html">extfloat.go</a></li>
<li><a href="/gostd/strconv/fp_test.go.html">fp_test.go</a></li>
<li><a href="/gostd/strconv/ftoa.go.html">ftoa.go</a></li>
<li><a href="/gostd/strconv/ftoa_test.go.html">ftoa_test.go</a></li>
<li><a href="/gostd/strconv/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/strconv/isprint.go.html">isprint.go</a></li>
<li><a href="/gostd/strconv/itoa.go.html">itoa.go</a></li>
<li><a href="/gostd/strconv/itoa_test.go.html">itoa_test.go</a></li>
<li><a href="/gostd/strconv/quote.go.html">quote.go</a></li>
<li><a href="/gostd/strconv/quote_example_test.go.html">quote_example_test.go</a></li>
<li><a href="/gostd/strconv/quote_test.go.html">quote_test.go</a></li>
<li><a href="/gostd/strconv/strconv_test.go.html">strconv_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2268413">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2268468">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2268522">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2268573">//&nbsp;Binary&nbsp;to&nbsp;decimal&nbsp;floating&nbsp;point&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="2268621">//&nbsp;Algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2268635">//&nbsp;&nbsp;&nbsp;1)&nbsp;store&nbsp;mantissa&nbsp;in&nbsp;multiprecision&nbsp;decimal</span><br>
<span class="lineno"></span><span class="comment" id="2268684">//&nbsp;&nbsp;&nbsp;2)&nbsp;shift&nbsp;decimal&nbsp;by&nbsp;exponent</span><br>
<span class="lineno"></span><span class="comment" id="2268718">//&nbsp;&nbsp;&nbsp;3)&nbsp;read&nbsp;digits&nbsp;out&nbsp;&amp;&nbsp;format</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2268752">package</span>&nbsp;<span class="ident" id="2268760">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2268769">import</span>&nbsp;<span class="string" id="2268776">&#34;math&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2268784">//&nbsp;TODO:&nbsp;move&nbsp;elsewhere?</span><br>
<span class="lineno"></span><span class="keyword" id="2268809">type</span>&nbsp;<span class="ident" id="2268814">floatInfo</span>&nbsp;<span class="keyword" id="2268824">struct</span>&nbsp;<span class="op" id="2268831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2268834">mantbits</span>&nbsp;<span class="builtintype" id="2268843">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2268849">expbits</span>&nbsp;&nbsp;<span class="builtintype" id="2268858">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2268864">bias</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2268873">int</span><br>
<span class="lineno">20</span><span class="op" id="2268877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2268880">var</span>&nbsp;<span class="ident" id="2268884">float32info</span>&nbsp;<span class="op" id="2268896">=</span>&nbsp;<span class="ident" id="2268898">floatInfo</span><span class="op" id="2268907">{</span><span class="num" id="2268908">23</span><span class="op" id="2268910">,</span>&nbsp;<span class="num" id="2268912">8</span><span class="op" id="2268913">,</span>&nbsp;<span class="op" id="2268915">-</span><span class="num" id="2268916">127</span><span class="op" id="2268919">}</span><br>
<span class="lineno"></span><span class="keyword" id="2268921">var</span>&nbsp;<span class="ident" id="2268925">float64info</span>&nbsp;<span class="op" id="2268937">=</span>&nbsp;<span class="ident" id="2268939">floatInfo</span><span class="op" id="2268948">{</span><span class="num" id="2268949">52</span><span class="op" id="2268951">,</span>&nbsp;<span class="num" id="2268953">11</span><span class="op" id="2268955">,</span>&nbsp;<span class="op" id="2268957">-</span><span class="num" id="2268958">1023</span><span class="op" id="2268962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2268965">//&nbsp;FormatFloat&nbsp;converts&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f&nbsp;to&nbsp;a&nbsp;string,</span><br>
<span class="lineno"></span><span class="comment" id="2269030">//&nbsp;according&nbsp;to&nbsp;the&nbsp;format&nbsp;fmt&nbsp;and&nbsp;precision&nbsp;prec.&nbsp;&nbsp;It&nbsp;rounds&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2269096">//&nbsp;result&nbsp;assuming&nbsp;that&nbsp;the&nbsp;original&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="2269168">//&nbsp;value&nbsp;of&nbsp;bitSize&nbsp;bits&nbsp;(32&nbsp;for&nbsp;float32,&nbsp;64&nbsp;for&nbsp;float64).</span><br>
<span class="lineno"></span><span class="comment" id="2269227">//</span><br>
<span class="lineno">30</span><span class="comment" id="2269230">//&nbsp;The&nbsp;format&nbsp;fmt&nbsp;is&nbsp;one&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2269258">//&nbsp;&#39;b&#39;&nbsp;(-ddddp±ddd,&nbsp;a&nbsp;binary&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2269299">//&nbsp;&#39;e&#39;&nbsp;(-d.dddde±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2269342">//&nbsp;&#39;E&#39;&nbsp;(-d.ddddE±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2269385">//&nbsp;&#39;f&#39;&nbsp;(-ddd.dddd,&nbsp;no&nbsp;exponent),</span><br>
<span class="lineno">35</span><span class="comment" id="2269418">//&nbsp;&#39;g&#39;&nbsp;(&#39;e&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2269470">//&nbsp;&#39;G&#39;&nbsp;(&#39;E&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise).</span><br>
<span class="lineno"></span><span class="comment" id="2269519">//</span><br>
<span class="lineno"></span><span class="comment" id="2269522">//&nbsp;The&nbsp;precision&nbsp;prec&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2269574">//&nbsp;(excluding&nbsp;the&nbsp;exponent)&nbsp;printed&nbsp;by&nbsp;the&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;g&#39;,&nbsp;and&nbsp;&#39;G&#39;&nbsp;formats.</span><br>
<span class="lineno">40</span><span class="comment" id="2269654">//&nbsp;For&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;and&nbsp;&#39;f&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span><span class="comment" id="2269731">//&nbsp;For&nbsp;&#39;g&#39;&nbsp;and&nbsp;&#39;G&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="2269784">//&nbsp;The&nbsp;special&nbsp;precision&nbsp;-1&nbsp;uses&nbsp;the&nbsp;smallest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2269847">//&nbsp;necessary&nbsp;such&nbsp;that&nbsp;ParseFloat&nbsp;will&nbsp;return&nbsp;f&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="keyword" id="2269904">func</span>&nbsp;<span class="ident" id="2269909">FormatFloat</span><span class="op" id="2269920">(</span><span class="ident" id="2269921">f</span>&nbsp;<span class="builtintype" id="2269923">float64</span><span class="op" id="2269930">,</span>&nbsp;<span class="ident" id="2269932">fmt</span>&nbsp;<span class="builtintype" id="2269936">byte</span><span class="op" id="2269940">,</span>&nbsp;<span class="ident" id="2269942">prec</span><span class="op" id="2269946">,</span>&nbsp;<span class="ident" id="2269948">bitSize</span>&nbsp;<span class="builtintype" id="2269956">int</span><span class="op" id="2269959">)</span>&nbsp;<span class="builtintype" id="2269961">string</span>&nbsp;<span class="op" id="2269968">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269971">return</span>&nbsp;<span class="builtintype" id="2269978">string</span><span class="op" id="2269984">(</span><span class="ident" id="2269985">genericFtoa</span><span class="op" id="2269996">(</span><span class="builtinfunc" id="2269997">make</span><span class="op" id="2270001">(</span><span class="op" id="2270002">[</span><span class="op" id="2270003">]</span><span class="builtintype" id="2270004">byte</span><span class="op" id="2270008">,</span>&nbsp;<span class="num" id="2270010">0</span><span class="op" id="2270011">,</span>&nbsp;<span class="ident" id="2270013">max</span><span class="op" id="2270016">(</span><span class="ident" id="2270017">prec</span><span class="op" id="2270021">+</span><span class="num" id="2270022">4</span><span class="op" id="2270023">,</span>&nbsp;<span class="num" id="2270025">24</span><span class="op" id="2270027">)</span><span class="op" id="2270028">)</span><span class="op" id="2270029">,</span>&nbsp;<span class="ident" id="2270031">f</span><span class="op" id="2270032">,</span>&nbsp;<span class="ident" id="2270034">fmt</span><span class="op" id="2270037">,</span>&nbsp;<span class="ident" id="2270039">prec</span><span class="op" id="2270043">,</span>&nbsp;<span class="ident" id="2270045">bitSize</span><span class="op" id="2270052">)</span><span class="op" id="2270053">)</span><br>
<span class="lineno"></span><span class="op" id="2270055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2270058">//&nbsp;AppendFloat&nbsp;appends&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f,</span><br>
<span class="lineno"></span><span class="comment" id="2270129">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;FormatFloat,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">50</span><span class="keyword" id="2270201">func</span>&nbsp;<span class="ident" id="2270206">AppendFloat</span><span class="op" id="2270217">(</span><span class="ident" id="2270218">dst</span>&nbsp;<span class="op" id="2270222">[</span><span class="op" id="2270223">]</span><span class="builtintype" id="2270224">byte</span><span class="op" id="2270228">,</span>&nbsp;<span class="ident" id="2270230">f</span>&nbsp;<span class="builtintype" id="2270232">float64</span><span class="op" id="2270239">,</span>&nbsp;<span class="ident" id="2270241">fmt</span>&nbsp;<span class="builtintype" id="2270245">byte</span><span class="op" id="2270249">,</span>&nbsp;<span class="ident" id="2270251">prec</span>&nbsp;<span class="builtintype" id="2270256">int</span><span class="op" id="2270259">,</span>&nbsp;<span class="ident" id="2270261">bitSize</span>&nbsp;<span class="builtintype" id="2270269">int</span><span class="op" id="2270272">)</span>&nbsp;<span class="op" id="2270274">[</span><span class="op" id="2270275">]</span><span class="builtintype" id="2270276">byte</span>&nbsp;<span class="op" id="2270281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270284">return</span>&nbsp;<span class="ident" id="2270291">genericFtoa</span><span class="op" id="2270302">(</span><span class="ident" id="2270303">dst</span><span class="op" id="2270306">,</span>&nbsp;<span class="ident" id="2270308">f</span><span class="op" id="2270309">,</span>&nbsp;<span class="ident" id="2270311">fmt</span><span class="op" id="2270314">,</span>&nbsp;<span class="ident" id="2270316">prec</span><span class="op" id="2270320">,</span>&nbsp;<span class="ident" id="2270322">bitSize</span><span class="op" id="2270329">)</span><br>
<span class="lineno"></span><span class="op" id="2270331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2270334">func</span>&nbsp;<span class="ident" id="2270339">genericFtoa</span><span class="op" id="2270350">(</span><span class="ident" id="2270351">dst</span>&nbsp;<span class="op" id="2270355">[</span><span class="op" id="2270356">]</span><span class="builtintype" id="2270357">byte</span><span class="op" id="2270361">,</span>&nbsp;<span class="ident" id="2270363">val</span>&nbsp;<span class="builtintype" id="2270367">float64</span><span class="op" id="2270374">,</span>&nbsp;<span class="ident" id="2270376">fmt</span>&nbsp;<span class="builtintype" id="2270380">byte</span><span class="op" id="2270384">,</span>&nbsp;<span class="ident" id="2270386">prec</span><span class="op" id="2270390">,</span>&nbsp;<span class="ident" id="2270392">bitSize</span>&nbsp;<span class="builtintype" id="2270400">int</span><span class="op" id="2270403">)</span>&nbsp;<span class="op" id="2270405">[</span><span class="op" id="2270406">]</span><span class="builtintype" id="2270407">byte</span>&nbsp;<span class="op" id="2270412">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270415">var</span>&nbsp;<span class="ident" id="2270419">bits</span>&nbsp;<span class="ident" id="2270424">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270432">var</span>&nbsp;<span class="ident" id="2270436">flt</span>&nbsp;<span class="op" id="2270440">*</span><span class="ident" id="2270441">floatInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270452">switch</span>&nbsp;<span class="ident" id="2270459">bitSize</span>&nbsp;<span class="op" id="2270467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270470">case</span>&nbsp;<span class="num" id="2270475">32</span><span class="op" id="2270477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2270481">bits</span>&nbsp;<span class="op" id="2270486">=</span>&nbsp;<span class="ident" id="2270488">uint64</span><span class="op" id="2270494">(</span><span class="ident" id="2270495">math</span><span class="op" id="2270499">.</span><span class="ident" id="2270500">Float32bits</span><span class="op" id="2270511">(</span><span class="builtintype" id="2270512">float32</span><span class="op" id="2270519">(</span><span class="ident" id="2270520">val</span><span class="op" id="2270523">)</span><span class="op" id="2270524">)</span><span class="op" id="2270525">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2270529">flt</span>&nbsp;<span class="op" id="2270533">=</span>&nbsp;<span class="op" id="2270535">&amp;</span><span class="ident" id="2270536">float32info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270549">case</span>&nbsp;<span class="num" id="2270554">64</span><span class="op" id="2270556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2270560">bits</span>&nbsp;<span class="op" id="2270565">=</span>&nbsp;<span class="ident" id="2270567">math</span><span class="op" id="2270571">.</span><span class="ident" id="2270572">Float64bits</span><span class="op" id="2270583">(</span><span class="ident" id="2270584">val</span><span class="op" id="2270587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2270591">flt</span>&nbsp;<span class="op" id="2270595">=</span>&nbsp;<span class="op" id="2270597">&amp;</span><span class="ident" id="2270598">float64info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270611">default</span><span class="op" id="2270618">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2270622">panic</span><span class="op" id="2270627">(</span><span class="string" id="2270628">&#34;strconv:&nbsp;illegal&nbsp;AppendFloat/FormatFloat&nbsp;bitSize&#34;</span><span class="op" id="2270678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2270681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2270685">neg</span>&nbsp;<span class="op" id="2270689">:=</span>&nbsp;<span class="ident" id="2270692">bits</span><span class="op" id="2270696">&gt;&gt;</span><span class="op" id="2270698">(</span><span class="ident" id="2270699">flt</span><span class="op" id="2270702">.</span><span class="ident" id="2270703">expbits</span><span class="op" id="2270710">+</span><span class="ident" id="2270711">flt</span><span class="op" id="2270714">.</span><span class="ident" id="2270715">mantbits</span><span class="op" id="2270723">)</span>&nbsp;<span class="op" id="2270725">!=</span>&nbsp;<span class="num" id="2270728">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2270731">exp</span>&nbsp;<span class="op" id="2270735">:=</span>&nbsp;<span class="builtintype" id="2270738">int</span><span class="op" id="2270741">(</span><span class="ident" id="2270742">bits</span><span class="op" id="2270746">&gt;&gt;</span><span class="ident" id="2270748">flt</span><span class="op" id="2270751">.</span><span class="ident" id="2270752">mantbits</span><span class="op" id="2270760">)</span>&nbsp;<span class="op" id="2270762">&amp;</span>&nbsp;<span class="op" id="2270764">(</span><span class="num" id="2270765">1</span><span class="op" id="2270766">&lt;&lt;</span><span class="ident" id="2270768">flt</span><span class="op" id="2270771">.</span><span class="ident" id="2270772">expbits</span>&nbsp;<span class="op" id="2270780">-</span>&nbsp;<span class="num" id="2270782">1</span><span class="op" id="2270783">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2270786">mant</span>&nbsp;<span class="op" id="2270791">:=</span>&nbsp;<span class="ident" id="2270794">bits</span>&nbsp;<span class="op" id="2270799">&amp;</span>&nbsp;<span class="op" id="2270801">(</span><span class="ident" id="2270802">uint64</span><span class="op" id="2270808">(</span><span class="num" id="2270809">1</span><span class="op" id="2270810">)</span><span class="op" id="2270811">&lt;&lt;</span><span class="ident" id="2270813">flt</span><span class="op" id="2270816">.</span><span class="ident" id="2270817">mantbits</span>&nbsp;<span class="op" id="2270826">-</span>&nbsp;<span class="num" id="2270828">1</span><span class="op" id="2270829">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270833">switch</span>&nbsp;<span class="ident" id="2270840">exp</span>&nbsp;<span class="op" id="2270844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270847">case</span>&nbsp;<span class="num" id="2270852">1</span><span class="op" id="2270853">&lt;&lt;</span><span class="ident" id="2270855">flt</span><span class="op" id="2270858">.</span><span class="ident" id="2270859">expbits</span>&nbsp;<span class="op" id="2270867">-</span>&nbsp;<span class="num" id="2270869">1</span><span class="op" id="2270870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2270874">//&nbsp;Inf,&nbsp;NaN</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270888">var</span>&nbsp;<span class="ident" id="2270892">s</span>&nbsp;<span class="builtintype" id="2270894">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270903">switch</span>&nbsp;<span class="op" id="2270910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270914">case</span>&nbsp;<span class="ident" id="2270919">mant</span>&nbsp;<span class="op" id="2270924">!=</span>&nbsp;<span class="num" id="2270927">0</span><span class="op" id="2270928">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2270933">s</span>&nbsp;<span class="op" id="2270935">=</span>&nbsp;<span class="string" id="2270937">&#34;NaN&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270945">case</span>&nbsp;<span class="ident" id="2270950">neg</span><span class="op" id="2270953">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2270958">s</span>&nbsp;<span class="op" id="2270960">=</span>&nbsp;<span class="string" id="2270962">&#34;-Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270971">default</span><span class="op" id="2270978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2270983">s</span>&nbsp;<span class="op" id="2270985">=</span>&nbsp;<span class="string" id="2270987">&#34;+Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2270996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271000">return</span>&nbsp;<span class="builtinfunc" id="2271007">append</span><span class="op" id="2271013">(</span><span class="ident" id="2271014">dst</span><span class="op" id="2271017">,</span>&nbsp;<span class="ident" id="2271019">s</span><span class="op" id="2271020">...</span><span class="op" id="2271023">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271027">case</span>&nbsp;<span class="num" id="2271032">0</span><span class="op" id="2271033">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2271037">//&nbsp;denormalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271055">exp</span><span class="op" id="2271058">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271063">default</span><span class="op" id="2271070">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2271074">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271100">mant</span>&nbsp;<span class="op" id="2271105">|=</span>&nbsp;<span class="ident" id="2271108">uint64</span><span class="op" id="2271114">(</span><span class="num" id="2271115">1</span><span class="op" id="2271116">)</span>&nbsp;<span class="op" id="2271118">&lt;&lt;</span>&nbsp;<span class="ident" id="2271121">flt</span><span class="op" id="2271124">.</span><span class="ident" id="2271125">mantbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271138">exp</span>&nbsp;<span class="op" id="2271142">+=</span>&nbsp;<span class="ident" id="2271145">flt</span><span class="op" id="2271148">.</span><span class="ident" id="2271149">bias</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2271156">//&nbsp;Pick&nbsp;off&nbsp;easy&nbsp;binary&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271189">if</span>&nbsp;<span class="ident" id="2271192">fmt</span>&nbsp;<span class="op" id="2271196">==</span>&nbsp;<span class="string" id="2271199">&#39;b&#39;</span>&nbsp;<span class="op" id="2271203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271207">return</span>&nbsp;<span class="ident" id="2271214">fmtB</span><span class="op" id="2271218">(</span><span class="ident" id="2271219">dst</span><span class="op" id="2271222">,</span>&nbsp;<span class="ident" id="2271224">neg</span><span class="op" id="2271227">,</span>&nbsp;<span class="ident" id="2271229">mant</span><span class="op" id="2271233">,</span>&nbsp;<span class="ident" id="2271235">exp</span><span class="op" id="2271238">,</span>&nbsp;<span class="ident" id="2271240">flt</span><span class="op" id="2271243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271246">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271250">if</span>&nbsp;<span class="op" id="2271253">!</span><span class="ident" id="2271254">optimize</span>&nbsp;<span class="op" id="2271263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271267">return</span>&nbsp;<span class="ident" id="2271274">bigFtoa</span><span class="op" id="2271281">(</span><span class="ident" id="2271282">dst</span><span class="op" id="2271285">,</span>&nbsp;<span class="ident" id="2271287">prec</span><span class="op" id="2271291">,</span>&nbsp;<span class="ident" id="2271293">fmt</span><span class="op" id="2271296">,</span>&nbsp;<span class="ident" id="2271298">neg</span><span class="op" id="2271301">,</span>&nbsp;<span class="ident" id="2271303">mant</span><span class="op" id="2271307">,</span>&nbsp;<span class="ident" id="2271309">exp</span><span class="op" id="2271312">,</span>&nbsp;<span class="ident" id="2271314">flt</span><span class="op" id="2271317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271324">var</span>&nbsp;<span class="ident" id="2271328">digs</span>&nbsp;<span class="ident" id="2271333">decimalSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271347">ok</span>&nbsp;<span class="op" id="2271350">:=</span>&nbsp;<span class="builtintype" id="2271353">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2271360">//&nbsp;Negative&nbsp;precision&nbsp;means&nbsp;&#34;only&nbsp;as&nbsp;much&nbsp;as&nbsp;needed&nbsp;to&nbsp;be&nbsp;exact.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271427">shortest</span>&nbsp;<span class="op" id="2271436">:=</span>&nbsp;<span class="ident" id="2271439">prec</span>&nbsp;<span class="op" id="2271444">&lt;</span>&nbsp;<span class="num" id="2271446">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271449">if</span>&nbsp;<span class="ident" id="2271452">shortest</span>&nbsp;<span class="op" id="2271461">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2271465">//&nbsp;Try&nbsp;Grisu3&nbsp;algorithm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271492">f</span>&nbsp;<span class="op" id="2271494">:=</span>&nbsp;<span class="builtinfunc" id="2271497">new</span><span class="op" id="2271500">(</span><span class="ident" id="2271501">extFloat</span><span class="op" id="2271509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271513">lower</span><span class="op" id="2271518">,</span>&nbsp;<span class="ident" id="2271520">upper</span>&nbsp;<span class="op" id="2271526">:=</span>&nbsp;<span class="ident" id="2271529">f</span><span class="op" id="2271530">.</span><span class="ident" id="2271531">AssignComputeBounds</span><span class="op" id="2271550">(</span><span class="ident" id="2271551">mant</span><span class="op" id="2271555">,</span>&nbsp;<span class="ident" id="2271557">exp</span><span class="op" id="2271560">,</span>&nbsp;<span class="ident" id="2271562">neg</span><span class="op" id="2271565">,</span>&nbsp;<span class="ident" id="2271567">flt</span><span class="op" id="2271570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271574">var</span>&nbsp;<span class="ident" id="2271578">buf</span>&nbsp;<span class="op" id="2271582">[</span><span class="num" id="2271583">32</span><span class="op" id="2271585">]</span><span class="builtintype" id="2271586">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271593">digs</span><span class="op" id="2271597">.</span><span class="ident" id="2271598">d</span>&nbsp;<span class="op" id="2271600">=</span>&nbsp;<span class="ident" id="2271602">buf</span><span class="op" id="2271605">[</span><span class="op" id="2271606">:</span><span class="op" id="2271607">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271611">ok</span>&nbsp;<span class="op" id="2271614">=</span>&nbsp;<span class="ident" id="2271616">f</span><span class="op" id="2271617">.</span><span class="ident" id="2271618">ShortestDecimal</span><span class="op" id="2271633">(</span><span class="op" id="2271634">&amp;</span><span class="ident" id="2271635">digs</span><span class="op" id="2271639">,</span>&nbsp;<span class="op" id="2271641">&amp;</span><span class="ident" id="2271642">lower</span><span class="op" id="2271647">,</span>&nbsp;<span class="op" id="2271649">&amp;</span><span class="ident" id="2271650">upper</span><span class="op" id="2271655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271659">if</span>&nbsp;<span class="op" id="2271662">!</span><span class="ident" id="2271663">ok</span>&nbsp;<span class="op" id="2271666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271671">return</span>&nbsp;<span class="ident" id="2271678">bigFtoa</span><span class="op" id="2271685">(</span><span class="ident" id="2271686">dst</span><span class="op" id="2271689">,</span>&nbsp;<span class="ident" id="2271691">prec</span><span class="op" id="2271695">,</span>&nbsp;<span class="ident" id="2271697">fmt</span><span class="op" id="2271700">,</span>&nbsp;<span class="ident" id="2271702">neg</span><span class="op" id="2271705">,</span>&nbsp;<span class="ident" id="2271707">mant</span><span class="op" id="2271711">,</span>&nbsp;<span class="ident" id="2271713">exp</span><span class="op" id="2271716">,</span>&nbsp;<span class="ident" id="2271718">flt</span><span class="op" id="2271721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2271729">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271778">switch</span>&nbsp;<span class="ident" id="2271785">fmt</span>&nbsp;<span class="op" id="2271789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271793">case</span>&nbsp;<span class="string" id="2271798">&#39;e&#39;</span><span class="op" id="2271801">,</span>&nbsp;<span class="string" id="2271803">&#39;E&#39;</span><span class="op" id="2271806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271811">prec</span>&nbsp;<span class="op" id="2271816">=</span>&nbsp;<span class="ident" id="2271818">digs</span><span class="op" id="2271822">.</span><span class="ident" id="2271823">nd</span>&nbsp;<span class="op" id="2271826">-</span>&nbsp;<span class="num" id="2271828">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271832">case</span>&nbsp;<span class="string" id="2271837">&#39;f&#39;</span><span class="op" id="2271840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271845">prec</span>&nbsp;<span class="op" id="2271850">=</span>&nbsp;<span class="ident" id="2271852">max</span><span class="op" id="2271855">(</span><span class="ident" id="2271856">digs</span><span class="op" id="2271860">.</span><span class="ident" id="2271861">nd</span><span class="op" id="2271863">-</span><span class="ident" id="2271864">digs</span><span class="op" id="2271868">.</span><span class="ident" id="2271869">dp</span><span class="op" id="2271871">,</span>&nbsp;<span class="num" id="2271873">0</span><span class="op" id="2271874">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271878">case</span>&nbsp;<span class="string" id="2271883">&#39;g&#39;</span><span class="op" id="2271886">,</span>&nbsp;<span class="string" id="2271888">&#39;G&#39;</span><span class="op" id="2271891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271896">prec</span>&nbsp;<span class="op" id="2271901">=</span>&nbsp;<span class="ident" id="2271903">digs</span><span class="op" id="2271907">.</span><span class="ident" id="2271908">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271916">}</span>&nbsp;<span class="keyword" id="2271918">else</span>&nbsp;<span class="keyword" id="2271923">if</span>&nbsp;<span class="ident" id="2271926">fmt</span>&nbsp;<span class="op" id="2271930">!=</span>&nbsp;<span class="string" id="2271933">&#39;f&#39;</span>&nbsp;<span class="op" id="2271937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2271941">//&nbsp;Fixed&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271970">digits</span>&nbsp;<span class="op" id="2271977">:=</span>&nbsp;<span class="ident" id="2271980">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271987">switch</span>&nbsp;<span class="ident" id="2271994">fmt</span>&nbsp;<span class="op" id="2271998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272002">case</span>&nbsp;<span class="string" id="2272007">&#39;e&#39;</span><span class="op" id="2272010">,</span>&nbsp;<span class="string" id="2272012">&#39;E&#39;</span><span class="op" id="2272015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272020">digits</span><span class="op" id="2272026">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272031">case</span>&nbsp;<span class="string" id="2272036">&#39;g&#39;</span><span class="op" id="2272039">,</span>&nbsp;<span class="string" id="2272041">&#39;G&#39;</span><span class="op" id="2272044">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272049">if</span>&nbsp;<span class="ident" id="2272052">prec</span>&nbsp;<span class="op" id="2272057">==</span>&nbsp;<span class="num" id="2272060">0</span>&nbsp;<span class="op" id="2272062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272068">prec</span>&nbsp;<span class="op" id="2272073">=</span>&nbsp;<span class="num" id="2272075">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272085">digits</span>&nbsp;<span class="op" id="2272092">=</span>&nbsp;<span class="ident" id="2272094">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272101">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272105">if</span>&nbsp;<span class="ident" id="2272108">digits</span>&nbsp;<span class="op" id="2272115">&lt;=</span>&nbsp;<span class="num" id="2272118">15</span>&nbsp;<span class="op" id="2272121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2272126">//&nbsp;try&nbsp;fast&nbsp;algorithm&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;is&nbsp;reasonable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272192">var</span>&nbsp;<span class="ident" id="2272196">buf</span>&nbsp;<span class="op" id="2272200">[</span><span class="num" id="2272201">24</span><span class="op" id="2272203">]</span><span class="builtintype" id="2272204">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272212">digs</span><span class="op" id="2272216">.</span><span class="ident" id="2272217">d</span>&nbsp;<span class="op" id="2272219">=</span>&nbsp;<span class="ident" id="2272221">buf</span><span class="op" id="2272224">[</span><span class="op" id="2272225">:</span><span class="op" id="2272226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272231">f</span>&nbsp;<span class="op" id="2272233">:=</span>&nbsp;<span class="ident" id="2272236">extFloat</span><span class="op" id="2272244">{</span><span class="ident" id="2272245">mant</span><span class="op" id="2272249">,</span>&nbsp;<span class="ident" id="2272251">exp</span>&nbsp;<span class="op" id="2272255">-</span>&nbsp;<span class="builtintype" id="2272257">int</span><span class="op" id="2272260">(</span><span class="ident" id="2272261">flt</span><span class="op" id="2272264">.</span><span class="ident" id="2272265">mantbits</span><span class="op" id="2272273">)</span><span class="op" id="2272274">,</span>&nbsp;<span class="ident" id="2272276">neg</span><span class="op" id="2272279">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272284">ok</span>&nbsp;<span class="op" id="2272287">=</span>&nbsp;<span class="ident" id="2272289">f</span><span class="op" id="2272290">.</span><span class="ident" id="2272291">FixedDecimal</span><span class="op" id="2272303">(</span><span class="op" id="2272304">&amp;</span><span class="ident" id="2272305">digs</span><span class="op" id="2272309">,</span>&nbsp;<span class="ident" id="2272311">digits</span><span class="op" id="2272317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272327">if</span>&nbsp;<span class="op" id="2272330">!</span><span class="ident" id="2272331">ok</span>&nbsp;<span class="op" id="2272334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272338">return</span>&nbsp;<span class="ident" id="2272345">bigFtoa</span><span class="op" id="2272352">(</span><span class="ident" id="2272353">dst</span><span class="op" id="2272356">,</span>&nbsp;<span class="ident" id="2272358">prec</span><span class="op" id="2272362">,</span>&nbsp;<span class="ident" id="2272364">fmt</span><span class="op" id="2272367">,</span>&nbsp;<span class="ident" id="2272369">neg</span><span class="op" id="2272372">,</span>&nbsp;<span class="ident" id="2272374">mant</span><span class="op" id="2272378">,</span>&nbsp;<span class="ident" id="2272380">exp</span><span class="op" id="2272383">,</span>&nbsp;<span class="ident" id="2272385">flt</span><span class="op" id="2272388">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272394">return</span>&nbsp;<span class="ident" id="2272401">formatDigits</span><span class="op" id="2272413">(</span><span class="ident" id="2272414">dst</span><span class="op" id="2272417">,</span>&nbsp;<span class="ident" id="2272419">shortest</span><span class="op" id="2272427">,</span>&nbsp;<span class="ident" id="2272429">neg</span><span class="op" id="2272432">,</span>&nbsp;<span class="ident" id="2272434">digs</span><span class="op" id="2272438">,</span>&nbsp;<span class="ident" id="2272440">prec</span><span class="op" id="2272444">,</span>&nbsp;<span class="ident" id="2272446">fmt</span><span class="op" id="2272449">)</span><br>
<span class="lineno"></span><span class="op" id="2272451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2272454">//&nbsp;bigFtoa&nbsp;uses&nbsp;multiprecision&nbsp;computations&nbsp;to&nbsp;format&nbsp;a&nbsp;float.</span><br>
<span class="lineno">155</span><span class="keyword" id="2272517">func</span>&nbsp;<span class="ident" id="2272522">bigFtoa</span><span class="op" id="2272529">(</span><span class="ident" id="2272530">dst</span>&nbsp;<span class="op" id="2272534">[</span><span class="op" id="2272535">]</span><span class="builtintype" id="2272536">byte</span><span class="op" id="2272540">,</span>&nbsp;<span class="ident" id="2272542">prec</span>&nbsp;<span class="builtintype" id="2272547">int</span><span class="op" id="2272550">,</span>&nbsp;<span class="ident" id="2272552">fmt</span>&nbsp;<span class="builtintype" id="2272556">byte</span><span class="op" id="2272560">,</span>&nbsp;<span class="ident" id="2272562">neg</span>&nbsp;<span class="builtintype" id="2272566">bool</span><span class="op" id="2272570">,</span>&nbsp;<span class="ident" id="2272572">mant</span>&nbsp;<span class="ident" id="2272577">uint64</span><span class="op" id="2272583">,</span>&nbsp;<span class="ident" id="2272585">exp</span>&nbsp;<span class="builtintype" id="2272589">int</span><span class="op" id="2272592">,</span>&nbsp;<span class="ident" id="2272594">flt</span>&nbsp;<span class="op" id="2272598">*</span><span class="ident" id="2272599">floatInfo</span><span class="op" id="2272608">)</span>&nbsp;<span class="op" id="2272610">[</span><span class="op" id="2272611">]</span><span class="builtintype" id="2272612">byte</span>&nbsp;<span class="op" id="2272617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272620">d</span>&nbsp;<span class="op" id="2272622">:=</span>&nbsp;<span class="builtinfunc" id="2272625">new</span><span class="op" id="2272628">(</span><span class="ident" id="2272629">decimal</span><span class="op" id="2272636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272639">d</span><span class="op" id="2272640">.</span><span class="ident" id="2272641">Assign</span><span class="op" id="2272647">(</span><span class="ident" id="2272648">mant</span><span class="op" id="2272652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272655">d</span><span class="op" id="2272656">.</span><span class="ident" id="2272657">Shift</span><span class="op" id="2272662">(</span><span class="ident" id="2272663">exp</span>&nbsp;<span class="op" id="2272667">-</span>&nbsp;<span class="builtintype" id="2272669">int</span><span class="op" id="2272672">(</span><span class="ident" id="2272673">flt</span><span class="op" id="2272676">.</span><span class="ident" id="2272677">mantbits</span><span class="op" id="2272685">)</span><span class="op" id="2272686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272689">var</span>&nbsp;<span class="ident" id="2272693">digs</span>&nbsp;<span class="ident" id="2272698">decimalSlice</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272712">shortest</span>&nbsp;<span class="op" id="2272721">:=</span>&nbsp;<span class="ident" id="2272724">prec</span>&nbsp;<span class="op" id="2272729">&lt;</span>&nbsp;<span class="num" id="2272731">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272734">if</span>&nbsp;<span class="ident" id="2272737">shortest</span>&nbsp;<span class="op" id="2272746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272750">roundShortest</span><span class="op" id="2272763">(</span><span class="ident" id="2272764">d</span><span class="op" id="2272765">,</span>&nbsp;<span class="ident" id="2272767">mant</span><span class="op" id="2272771">,</span>&nbsp;<span class="ident" id="2272773">exp</span><span class="op" id="2272776">,</span>&nbsp;<span class="ident" id="2272778">flt</span><span class="op" id="2272781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272785">digs</span>&nbsp;<span class="op" id="2272790">=</span>&nbsp;<span class="ident" id="2272792">decimalSlice</span><span class="op" id="2272804">{</span><span class="ident" id="2272805">d</span><span class="op" id="2272806">:</span>&nbsp;<span class="ident" id="2272808">d</span><span class="op" id="2272809">.</span><span class="ident" id="2272810">d</span><span class="op" id="2272811">[</span><span class="op" id="2272812">:</span><span class="op" id="2272813">]</span><span class="op" id="2272814">,</span>&nbsp;<span class="ident" id="2272816">nd</span><span class="op" id="2272818">:</span>&nbsp;<span class="ident" id="2272820">d</span><span class="op" id="2272821">.</span><span class="ident" id="2272822">nd</span><span class="op" id="2272824">,</span>&nbsp;<span class="ident" id="2272826">dp</span><span class="op" id="2272828">:</span>&nbsp;<span class="ident" id="2272830">d</span><span class="op" id="2272831">.</span><span class="ident" id="2272832">dp</span><span class="op" id="2272834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2272838">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272887">switch</span>&nbsp;<span class="ident" id="2272894">fmt</span>&nbsp;<span class="op" id="2272898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272902">case</span>&nbsp;<span class="string" id="2272907">&#39;e&#39;</span><span class="op" id="2272910">,</span>&nbsp;<span class="string" id="2272912">&#39;E&#39;</span><span class="op" id="2272915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272920">prec</span>&nbsp;<span class="op" id="2272925">=</span>&nbsp;<span class="ident" id="2272927">digs</span><span class="op" id="2272931">.</span><span class="ident" id="2272932">nd</span>&nbsp;<span class="op" id="2272935">-</span>&nbsp;<span class="num" id="2272937">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272941">case</span>&nbsp;<span class="string" id="2272946">&#39;f&#39;</span><span class="op" id="2272949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272954">prec</span>&nbsp;<span class="op" id="2272959">=</span>&nbsp;<span class="ident" id="2272961">max</span><span class="op" id="2272964">(</span><span class="ident" id="2272965">digs</span><span class="op" id="2272969">.</span><span class="ident" id="2272970">nd</span><span class="op" id="2272972">-</span><span class="ident" id="2272973">digs</span><span class="op" id="2272977">.</span><span class="ident" id="2272978">dp</span><span class="op" id="2272980">,</span>&nbsp;<span class="num" id="2272982">0</span><span class="op" id="2272983">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272987">case</span>&nbsp;<span class="string" id="2272992">&#39;g&#39;</span><span class="op" id="2272995">,</span>&nbsp;<span class="string" id="2272997">&#39;G&#39;</span><span class="op" id="2273000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273005">prec</span>&nbsp;<span class="op" id="2273010">=</span>&nbsp;<span class="ident" id="2273012">digs</span><span class="op" id="2273016">.</span><span class="ident" id="2273017">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273025">}</span>&nbsp;<span class="keyword" id="2273027">else</span>&nbsp;<span class="op" id="2273032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2273036">//&nbsp;Round&nbsp;appropriately.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273062">switch</span>&nbsp;<span class="ident" id="2273069">fmt</span>&nbsp;<span class="op" id="2273073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273077">case</span>&nbsp;<span class="string" id="2273082">&#39;e&#39;</span><span class="op" id="2273085">,</span>&nbsp;<span class="string" id="2273087">&#39;E&#39;</span><span class="op" id="2273090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273095">d</span><span class="op" id="2273096">.</span><span class="ident" id="2273097">Round</span><span class="op" id="2273102">(</span><span class="ident" id="2273103">prec</span>&nbsp;<span class="op" id="2273108">+</span>&nbsp;<span class="num" id="2273110">1</span><span class="op" id="2273111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273115">case</span>&nbsp;<span class="string" id="2273120">&#39;f&#39;</span><span class="op" id="2273123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273128">d</span><span class="op" id="2273129">.</span><span class="ident" id="2273130">Round</span><span class="op" id="2273135">(</span><span class="ident" id="2273136">d</span><span class="op" id="2273137">.</span><span class="ident" id="2273138">dp</span>&nbsp;<span class="op" id="2273141">+</span>&nbsp;<span class="ident" id="2273143">prec</span><span class="op" id="2273147">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273151">case</span>&nbsp;<span class="string" id="2273156">&#39;g&#39;</span><span class="op" id="2273159">,</span>&nbsp;<span class="string" id="2273161">&#39;G&#39;</span><span class="op" id="2273164">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273169">if</span>&nbsp;<span class="ident" id="2273172">prec</span>&nbsp;<span class="op" id="2273177">==</span>&nbsp;<span class="num" id="2273180">0</span>&nbsp;<span class="op" id="2273182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273188">prec</span>&nbsp;<span class="op" id="2273193">=</span>&nbsp;<span class="num" id="2273195">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273205">d</span><span class="op" id="2273206">.</span><span class="ident" id="2273207">Round</span><span class="op" id="2273212">(</span><span class="ident" id="2273213">prec</span><span class="op" id="2273217">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273225">digs</span>&nbsp;<span class="op" id="2273230">=</span>&nbsp;<span class="ident" id="2273232">decimalSlice</span><span class="op" id="2273244">{</span><span class="ident" id="2273245">d</span><span class="op" id="2273246">:</span>&nbsp;<span class="ident" id="2273248">d</span><span class="op" id="2273249">.</span><span class="ident" id="2273250">d</span><span class="op" id="2273251">[</span><span class="op" id="2273252">:</span><span class="op" id="2273253">]</span><span class="op" id="2273254">,</span>&nbsp;<span class="ident" id="2273256">nd</span><span class="op" id="2273258">:</span>&nbsp;<span class="ident" id="2273260">d</span><span class="op" id="2273261">.</span><span class="ident" id="2273262">nd</span><span class="op" id="2273264">,</span>&nbsp;<span class="ident" id="2273266">dp</span><span class="op" id="2273268">:</span>&nbsp;<span class="ident" id="2273270">d</span><span class="op" id="2273271">.</span><span class="ident" id="2273272">dp</span><span class="op" id="2273274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273280">return</span>&nbsp;<span class="ident" id="2273287">formatDigits</span><span class="op" id="2273299">(</span><span class="ident" id="2273300">dst</span><span class="op" id="2273303">,</span>&nbsp;<span class="ident" id="2273305">shortest</span><span class="op" id="2273313">,</span>&nbsp;<span class="ident" id="2273315">neg</span><span class="op" id="2273318">,</span>&nbsp;<span class="ident" id="2273320">digs</span><span class="op" id="2273324">,</span>&nbsp;<span class="ident" id="2273326">prec</span><span class="op" id="2273330">,</span>&nbsp;<span class="ident" id="2273332">fmt</span><span class="op" id="2273335">)</span><br>
<span class="lineno"></span><span class="op" id="2273337">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="2273340">func</span>&nbsp;<span class="ident" id="2273345">formatDigits</span><span class="op" id="2273357">(</span><span class="ident" id="2273358">dst</span>&nbsp;<span class="op" id="2273362">[</span><span class="op" id="2273363">]</span><span class="builtintype" id="2273364">byte</span><span class="op" id="2273368">,</span>&nbsp;<span class="ident" id="2273370">shortest</span>&nbsp;<span class="builtintype" id="2273379">bool</span><span class="op" id="2273383">,</span>&nbsp;<span class="ident" id="2273385">neg</span>&nbsp;<span class="builtintype" id="2273389">bool</span><span class="op" id="2273393">,</span>&nbsp;<span class="ident" id="2273395">digs</span>&nbsp;<span class="ident" id="2273400">decimalSlice</span><span class="op" id="2273412">,</span>&nbsp;<span class="ident" id="2273414">prec</span>&nbsp;<span class="builtintype" id="2273419">int</span><span class="op" id="2273422">,</span>&nbsp;<span class="ident" id="2273424">fmt</span>&nbsp;<span class="builtintype" id="2273428">byte</span><span class="op" id="2273432">)</span>&nbsp;<span class="op" id="2273434">[</span><span class="op" id="2273435">]</span><span class="builtintype" id="2273436">byte</span>&nbsp;<span class="op" id="2273441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273444">switch</span>&nbsp;<span class="ident" id="2273451">fmt</span>&nbsp;<span class="op" id="2273455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273458">case</span>&nbsp;<span class="string" id="2273463">&#39;e&#39;</span><span class="op" id="2273466">,</span>&nbsp;<span class="string" id="2273468">&#39;E&#39;</span><span class="op" id="2273471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273475">return</span>&nbsp;<span class="ident" id="2273482">fmtE</span><span class="op" id="2273486">(</span><span class="ident" id="2273487">dst</span><span class="op" id="2273490">,</span>&nbsp;<span class="ident" id="2273492">neg</span><span class="op" id="2273495">,</span>&nbsp;<span class="ident" id="2273497">digs</span><span class="op" id="2273501">,</span>&nbsp;<span class="ident" id="2273503">prec</span><span class="op" id="2273507">,</span>&nbsp;<span class="ident" id="2273509">fmt</span><span class="op" id="2273512">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273515">case</span>&nbsp;<span class="string" id="2273520">&#39;f&#39;</span><span class="op" id="2273523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273527">return</span>&nbsp;<span class="ident" id="2273534">fmtF</span><span class="op" id="2273538">(</span><span class="ident" id="2273539">dst</span><span class="op" id="2273542">,</span>&nbsp;<span class="ident" id="2273544">neg</span><span class="op" id="2273547">,</span>&nbsp;<span class="ident" id="2273549">digs</span><span class="op" id="2273553">,</span>&nbsp;<span class="ident" id="2273555">prec</span><span class="op" id="2273559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273562">case</span>&nbsp;<span class="string" id="2273567">&#39;g&#39;</span><span class="op" id="2273570">,</span>&nbsp;<span class="string" id="2273572">&#39;G&#39;</span><span class="op" id="2273575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2273579">//&nbsp;trailing&nbsp;fractional&nbsp;zeros&nbsp;in&nbsp;&#39;e&#39;&nbsp;form&nbsp;will&nbsp;be&nbsp;trimmed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273639">eprec</span>&nbsp;<span class="op" id="2273645">:=</span>&nbsp;<span class="ident" id="2273648">prec</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273655">if</span>&nbsp;<span class="ident" id="2273658">eprec</span>&nbsp;<span class="op" id="2273664">&gt;</span>&nbsp;<span class="ident" id="2273666">digs</span><span class="op" id="2273670">.</span><span class="ident" id="2273671">nd</span>&nbsp;<span class="op" id="2273674">&amp;&amp;</span>&nbsp;<span class="ident" id="2273677">digs</span><span class="op" id="2273681">.</span><span class="ident" id="2273682">nd</span>&nbsp;<span class="op" id="2273685">&gt;=</span>&nbsp;<span class="ident" id="2273688">digs</span><span class="op" id="2273692">.</span><span class="ident" id="2273693">dp</span>&nbsp;<span class="op" id="2273696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273701">eprec</span>&nbsp;<span class="op" id="2273707">=</span>&nbsp;<span class="ident" id="2273709">digs</span><span class="op" id="2273713">.</span><span class="ident" id="2273714">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2273723">//&nbsp;%e&nbsp;is&nbsp;used&nbsp;if&nbsp;the&nbsp;exponent&nbsp;from&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2273775">//&nbsp;is&nbsp;less&nbsp;than&nbsp;-4&nbsp;or&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;the&nbsp;precision.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2273839">//&nbsp;if&nbsp;precision&nbsp;was&nbsp;the&nbsp;shortest&nbsp;possible,&nbsp;use&nbsp;precision&nbsp;6&nbsp;for&nbsp;this&nbsp;decision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273919">if</span>&nbsp;<span class="ident" id="2273922">shortest</span>&nbsp;<span class="op" id="2273931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273936">eprec</span>&nbsp;<span class="op" id="2273942">=</span>&nbsp;<span class="num" id="2273944">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273952">exp</span>&nbsp;<span class="op" id="2273956">:=</span>&nbsp;<span class="ident" id="2273959">digs</span><span class="op" id="2273963">.</span><span class="ident" id="2273964">dp</span>&nbsp;<span class="op" id="2273967">-</span>&nbsp;<span class="num" id="2273969">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273973">if</span>&nbsp;<span class="ident" id="2273976">exp</span>&nbsp;<span class="op" id="2273980">&lt;</span>&nbsp;<span class="op" id="2273982">-</span><span class="num" id="2273983">4</span>&nbsp;<span class="op" id="2273985">||</span>&nbsp;<span class="ident" id="2273988">exp</span>&nbsp;<span class="op" id="2273992">&gt;=</span>&nbsp;<span class="ident" id="2273995">eprec</span>&nbsp;<span class="op" id="2274001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274006">if</span>&nbsp;<span class="ident" id="2274009">prec</span>&nbsp;<span class="op" id="2274014">&gt;</span>&nbsp;<span class="ident" id="2274016">digs</span><span class="op" id="2274020">.</span><span class="ident" id="2274021">nd</span>&nbsp;<span class="op" id="2274024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274030">prec</span>&nbsp;<span class="op" id="2274035">=</span>&nbsp;<span class="ident" id="2274037">digs</span><span class="op" id="2274041">.</span><span class="ident" id="2274042">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274053">return</span>&nbsp;<span class="ident" id="2274060">fmtE</span><span class="op" id="2274064">(</span><span class="ident" id="2274065">dst</span><span class="op" id="2274068">,</span>&nbsp;<span class="ident" id="2274070">neg</span><span class="op" id="2274073">,</span>&nbsp;<span class="ident" id="2274075">digs</span><span class="op" id="2274079">,</span>&nbsp;<span class="ident" id="2274081">prec</span><span class="op" id="2274085">-</span><span class="num" id="2274086">1</span><span class="op" id="2274087">,</span>&nbsp;<span class="ident" id="2274089">fmt</span><span class="op" id="2274092">+</span><span class="string" id="2274093">&#39;e&#39;</span><span class="op" id="2274096">-</span><span class="string" id="2274097">&#39;g&#39;</span><span class="op" id="2274100">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274108">if</span>&nbsp;<span class="ident" id="2274111">prec</span>&nbsp;<span class="op" id="2274116">&gt;</span>&nbsp;<span class="ident" id="2274118">digs</span><span class="op" id="2274122">.</span><span class="ident" id="2274123">dp</span>&nbsp;<span class="op" id="2274126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274131">prec</span>&nbsp;<span class="op" id="2274136">=</span>&nbsp;<span class="ident" id="2274138">digs</span><span class="op" id="2274142">.</span><span class="ident" id="2274143">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274152">return</span>&nbsp;<span class="ident" id="2274159">fmtF</span><span class="op" id="2274163">(</span><span class="ident" id="2274164">dst</span><span class="op" id="2274167">,</span>&nbsp;<span class="ident" id="2274169">neg</span><span class="op" id="2274172">,</span>&nbsp;<span class="ident" id="2274174">digs</span><span class="op" id="2274178">,</span>&nbsp;<span class="ident" id="2274180">max</span><span class="op" id="2274183">(</span><span class="ident" id="2274184">prec</span><span class="op" id="2274188">-</span><span class="ident" id="2274189">digs</span><span class="op" id="2274193">.</span><span class="ident" id="2274194">dp</span><span class="op" id="2274196">,</span>&nbsp;<span class="num" id="2274198">0</span><span class="op" id="2274199">)</span><span class="op" id="2274200">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274207">//&nbsp;unknown&nbsp;format</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274226">return</span>&nbsp;<span class="builtinfunc" id="2274233">append</span><span class="op" id="2274239">(</span><span class="ident" id="2274240">dst</span><span class="op" id="2274243">,</span>&nbsp;<span class="string" id="2274245">&#39;%&#39;</span><span class="op" id="2274248">,</span>&nbsp;<span class="ident" id="2274250">fmt</span><span class="op" id="2274253">)</span><br>
<span class="lineno"></span><span class="op" id="2274255">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2274258">//&nbsp;Round&nbsp;d&nbsp;(=&nbsp;mant&nbsp;*&nbsp;2^exp)&nbsp;to&nbsp;the&nbsp;shortest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2274319">//&nbsp;that&nbsp;will&nbsp;let&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;value&nbsp;be&nbsp;precisely</span><br>
<span class="lineno"></span><span class="comment" id="2274383">//&nbsp;reconstructed.&nbsp;&nbsp;Size&nbsp;is&nbsp;original&nbsp;floating&nbsp;point&nbsp;size&nbsp;(64&nbsp;or&nbsp;32).</span><br>
<span class="lineno"></span><span class="keyword" id="2274451">func</span>&nbsp;<span class="ident" id="2274456">roundShortest</span><span class="op" id="2274469">(</span><span class="ident" id="2274470">d</span>&nbsp;<span class="op" id="2274472">*</span><span class="ident" id="2274473">decimal</span><span class="op" id="2274480">,</span>&nbsp;<span class="ident" id="2274482">mant</span>&nbsp;<span class="ident" id="2274487">uint64</span><span class="op" id="2274493">,</span>&nbsp;<span class="ident" id="2274495">exp</span>&nbsp;<span class="builtintype" id="2274499">int</span><span class="op" id="2274502">,</span>&nbsp;<span class="ident" id="2274504">flt</span>&nbsp;<span class="op" id="2274508">*</span><span class="ident" id="2274509">floatInfo</span><span class="op" id="2274518">)</span>&nbsp;<span class="op" id="2274520">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274523">//&nbsp;If&nbsp;mantissa&nbsp;is&nbsp;zero,&nbsp;the&nbsp;number&nbsp;is&nbsp;zero;&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274578">if</span>&nbsp;<span class="ident" id="2274581">mant</span>&nbsp;<span class="op" id="2274586">==</span>&nbsp;<span class="num" id="2274589">0</span>&nbsp;<span class="op" id="2274591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274595">d</span><span class="op" id="2274596">.</span><span class="ident" id="2274597">nd</span>&nbsp;<span class="op" id="2274600">=</span>&nbsp;<span class="num" id="2274602">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274606">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274614">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274618">//&nbsp;Compute&nbsp;upper&nbsp;and&nbsp;lower&nbsp;such&nbsp;that&nbsp;any&nbsp;decimal&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274675">//&nbsp;between&nbsp;upper&nbsp;and&nbsp;lower&nbsp;(possibly&nbsp;inclusive)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274724">//&nbsp;will&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;number.</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274779">//&nbsp;We&nbsp;may&nbsp;see&nbsp;at&nbsp;once&nbsp;that&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274839">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274843">//&nbsp;Suppose&nbsp;d&nbsp;is&nbsp;not&nbsp;denormal,&nbsp;so&nbsp;that&nbsp;2^exp&nbsp;&lt;=&nbsp;d&nbsp;&lt;&nbsp;10^dp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274902">//&nbsp;The&nbsp;closest&nbsp;shorter&nbsp;number&nbsp;is&nbsp;at&nbsp;least&nbsp;10^(dp-nd)&nbsp;away.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274962">//&nbsp;The&nbsp;lower/upper&nbsp;bounds&nbsp;computed&nbsp;below&nbsp;are&nbsp;at&nbsp;distance</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275020">//&nbsp;at&nbsp;most&nbsp;2^(exp-mantbits).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275050">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275054">//&nbsp;So&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest&nbsp;if&nbsp;10^(dp-nd)&nbsp;&gt;&nbsp;2^(exp-mantbits),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275126">//&nbsp;or&nbsp;equivalently&nbsp;log2(10)*(dp-nd)&nbsp;&gt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275179">//&nbsp;It&nbsp;is&nbsp;true&nbsp;if&nbsp;332/100*(dp-nd)&nbsp;&gt;=&nbsp;exp-mantbits&nbsp;(log2(10)&nbsp;&gt;&nbsp;3.32).</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275248">minexp</span>&nbsp;<span class="op" id="2275255">:=</span>&nbsp;<span class="ident" id="2275258">flt</span><span class="op" id="2275261">.</span><span class="ident" id="2275262">bias</span>&nbsp;<span class="op" id="2275267">+</span>&nbsp;<span class="num" id="2275269">1</span>&nbsp;<span class="comment" id="2275271">//&nbsp;minimum&nbsp;possible&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275301">if</span>&nbsp;<span class="ident" id="2275304">exp</span>&nbsp;<span class="op" id="2275308">&gt;</span>&nbsp;<span class="ident" id="2275310">minexp</span>&nbsp;<span class="op" id="2275317">&amp;&amp;</span>&nbsp;<span class="num" id="2275320">332</span><span class="op" id="2275323">*</span><span class="op" id="2275324">(</span><span class="ident" id="2275325">d</span><span class="op" id="2275326">.</span><span class="ident" id="2275327">dp</span><span class="op" id="2275329">-</span><span class="ident" id="2275330">d</span><span class="op" id="2275331">.</span><span class="ident" id="2275332">nd</span><span class="op" id="2275334">)</span>&nbsp;<span class="op" id="2275336">&gt;=</span>&nbsp;<span class="num" id="2275339">100</span><span class="op" id="2275342">*</span><span class="op" id="2275343">(</span><span class="ident" id="2275344">exp</span><span class="op" id="2275347">-</span><span class="builtintype" id="2275348">int</span><span class="op" id="2275351">(</span><span class="ident" id="2275352">flt</span><span class="op" id="2275355">.</span><span class="ident" id="2275356">mantbits</span><span class="op" id="2275364">)</span><span class="op" id="2275365">)</span>&nbsp;<span class="op" id="2275367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275371">//&nbsp;The&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275408">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2275416">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275420">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275453">//&nbsp;Next&nbsp;highest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant+1&nbsp;&lt;&lt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275519">//&nbsp;Our&nbsp;upper&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mant*2+1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275587">upper</span>&nbsp;<span class="op" id="2275593">:=</span>&nbsp;<span class="builtinfunc" id="2275596">new</span><span class="op" id="2275599">(</span><span class="ident" id="2275600">decimal</span><span class="op" id="2275607">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275610">upper</span><span class="op" id="2275615">.</span><span class="ident" id="2275616">Assign</span><span class="op" id="2275622">(</span><span class="ident" id="2275623">mant</span><span class="op" id="2275627">*</span><span class="num" id="2275628">2</span>&nbsp;<span class="op" id="2275630">+</span>&nbsp;<span class="num" id="2275632">1</span><span class="op" id="2275633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275636">upper</span><span class="op" id="2275641">.</span><span class="ident" id="2275642">Shift</span><span class="op" id="2275647">(</span><span class="ident" id="2275648">exp</span>&nbsp;<span class="op" id="2275652">-</span>&nbsp;<span class="builtintype" id="2275654">int</span><span class="op" id="2275657">(</span><span class="ident" id="2275658">flt</span><span class="op" id="2275661">.</span><span class="ident" id="2275662">mantbits</span><span class="op" id="2275670">)</span>&nbsp;<span class="op" id="2275672">-</span>&nbsp;<span class="num" id="2275674">1</span><span class="op" id="2275675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275679">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275712">//&nbsp;Next&nbsp;lowest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant-1&nbsp;&lt;&lt;&nbsp;exp-mantbits,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275777">//&nbsp;unless&nbsp;mant-1&nbsp;drops&nbsp;the&nbsp;significant&nbsp;bit&nbsp;and&nbsp;exp&nbsp;is&nbsp;not&nbsp;the&nbsp;minimum&nbsp;exp,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275853">//&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;next&nbsp;lowest&nbsp;is&nbsp;mant*2-1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275918">//&nbsp;Either&nbsp;way,&nbsp;call&nbsp;it&nbsp;mantlo&nbsp;&lt;&lt;&nbsp;explo-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275968">//&nbsp;Our&nbsp;lower&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mantlo*2+1&nbsp;&lt;&lt;&nbsp;explo-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276040">var</span>&nbsp;<span class="ident" id="2276044">mantlo</span>&nbsp;<span class="ident" id="2276051">uint64</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276059">var</span>&nbsp;<span class="ident" id="2276063">explo</span>&nbsp;<span class="builtintype" id="2276069">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276074">if</span>&nbsp;<span class="ident" id="2276077">mant</span>&nbsp;<span class="op" id="2276082">&gt;</span>&nbsp;<span class="num" id="2276084">1</span><span class="op" id="2276085">&lt;&lt;</span><span class="ident" id="2276087">flt</span><span class="op" id="2276090">.</span><span class="ident" id="2276091">mantbits</span>&nbsp;<span class="op" id="2276100">||</span>&nbsp;<span class="ident" id="2276103">exp</span>&nbsp;<span class="op" id="2276107">==</span>&nbsp;<span class="ident" id="2276110">minexp</span>&nbsp;<span class="op" id="2276117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276121">mantlo</span>&nbsp;<span class="op" id="2276128">=</span>&nbsp;<span class="ident" id="2276130">mant</span>&nbsp;<span class="op" id="2276135">-</span>&nbsp;<span class="num" id="2276137">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276141">explo</span>&nbsp;<span class="op" id="2276147">=</span>&nbsp;<span class="ident" id="2276149">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276154">}</span>&nbsp;<span class="keyword" id="2276156">else</span>&nbsp;<span class="op" id="2276161">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276165">mantlo</span>&nbsp;<span class="op" id="2276172">=</span>&nbsp;<span class="ident" id="2276174">mant</span><span class="op" id="2276178">*</span><span class="num" id="2276179">2</span>&nbsp;<span class="op" id="2276181">-</span>&nbsp;<span class="num" id="2276183">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276187">explo</span>&nbsp;<span class="op" id="2276193">=</span>&nbsp;<span class="ident" id="2276195">exp</span>&nbsp;<span class="op" id="2276199">-</span>&nbsp;<span class="num" id="2276201">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276207">lower</span>&nbsp;<span class="op" id="2276213">:=</span>&nbsp;<span class="builtinfunc" id="2276216">new</span><span class="op" id="2276219">(</span><span class="ident" id="2276220">decimal</span><span class="op" id="2276227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276230">lower</span><span class="op" id="2276235">.</span><span class="ident" id="2276236">Assign</span><span class="op" id="2276242">(</span><span class="ident" id="2276243">mantlo</span><span class="op" id="2276249">*</span><span class="num" id="2276250">2</span>&nbsp;<span class="op" id="2276252">+</span>&nbsp;<span class="num" id="2276254">1</span><span class="op" id="2276255">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276258">lower</span><span class="op" id="2276263">.</span><span class="ident" id="2276264">Shift</span><span class="op" id="2276269">(</span><span class="ident" id="2276270">explo</span>&nbsp;<span class="op" id="2276276">-</span>&nbsp;<span class="builtintype" id="2276278">int</span><span class="op" id="2276281">(</span><span class="ident" id="2276282">flt</span><span class="op" id="2276285">.</span><span class="ident" id="2276286">mantbits</span><span class="op" id="2276294">)</span>&nbsp;<span class="op" id="2276296">-</span>&nbsp;<span class="num" id="2276298">1</span><span class="op" id="2276299">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2276303">//&nbsp;The&nbsp;upper&nbsp;and&nbsp;lower&nbsp;bounds&nbsp;are&nbsp;possible&nbsp;outputs&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2276363">//&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;is&nbsp;even,&nbsp;so&nbsp;that&nbsp;IEEE&nbsp;round-to-even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2276425">//&nbsp;would&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;and&nbsp;not&nbsp;the&nbsp;neighbors.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276489">inclusive</span>&nbsp;<span class="op" id="2276499">:=</span>&nbsp;<span class="ident" id="2276502">mant</span><span class="op" id="2276506">%</span><span class="num" id="2276507">2</span>&nbsp;<span class="op" id="2276509">==</span>&nbsp;<span class="num" id="2276512">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2276516">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;the&nbsp;minimum&nbsp;number&nbsp;of&nbsp;digits&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2276581">//&nbsp;Walk&nbsp;along&nbsp;until&nbsp;d&nbsp;has&nbsp;distinguished&nbsp;itself&nbsp;from&nbsp;upper&nbsp;and&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276651">for</span>&nbsp;<span class="ident" id="2276655">i</span>&nbsp;<span class="op" id="2276657">:=</span>&nbsp;<span class="num" id="2276660">0</span><span class="op" id="2276661">;</span>&nbsp;<span class="ident" id="2276663">i</span>&nbsp;<span class="op" id="2276665">&lt;</span>&nbsp;<span class="ident" id="2276667">d</span><span class="op" id="2276668">.</span><span class="ident" id="2276669">nd</span><span class="op" id="2276671">;</span>&nbsp;<span class="ident" id="2276673">i</span><span class="op" id="2276674">++</span>&nbsp;<span class="op" id="2276677">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276681">var</span>&nbsp;<span class="ident" id="2276685">l</span><span class="op" id="2276686">,</span>&nbsp;<span class="ident" id="2276688">m</span><span class="op" id="2276689">,</span>&nbsp;<span class="ident" id="2276691">u</span>&nbsp;<span class="builtintype" id="2276693">byte</span>&nbsp;<span class="comment" id="2276698">//&nbsp;lower,&nbsp;middle,&nbsp;upper&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276731">if</span>&nbsp;<span class="ident" id="2276734">i</span>&nbsp;<span class="op" id="2276736">&lt;</span>&nbsp;<span class="ident" id="2276738">lower</span><span class="op" id="2276743">.</span><span class="ident" id="2276744">nd</span>&nbsp;<span class="op" id="2276747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276752">l</span>&nbsp;<span class="op" id="2276754">=</span>&nbsp;<span class="ident" id="2276756">lower</span><span class="op" id="2276761">.</span><span class="ident" id="2276762">d</span><span class="op" id="2276763">[</span><span class="ident" id="2276764">i</span><span class="op" id="2276765">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276769">}</span>&nbsp;<span class="keyword" id="2276771">else</span>&nbsp;<span class="op" id="2276776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276781">l</span>&nbsp;<span class="op" id="2276783">=</span>&nbsp;<span class="string" id="2276785">&#39;0&#39;</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276795">m</span>&nbsp;<span class="op" id="2276797">=</span>&nbsp;<span class="ident" id="2276799">d</span><span class="op" id="2276800">.</span><span class="ident" id="2276801">d</span><span class="op" id="2276802">[</span><span class="ident" id="2276803">i</span><span class="op" id="2276804">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276808">if</span>&nbsp;<span class="ident" id="2276811">i</span>&nbsp;<span class="op" id="2276813">&lt;</span>&nbsp;<span class="ident" id="2276815">upper</span><span class="op" id="2276820">.</span><span class="ident" id="2276821">nd</span>&nbsp;<span class="op" id="2276824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276829">u</span>&nbsp;<span class="op" id="2276831">=</span>&nbsp;<span class="ident" id="2276833">upper</span><span class="op" id="2276838">.</span><span class="ident" id="2276839">d</span><span class="op" id="2276840">[</span><span class="ident" id="2276841">i</span><span class="op" id="2276842">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276846">}</span>&nbsp;<span class="keyword" id="2276848">else</span>&nbsp;<span class="op" id="2276853">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276858">u</span>&nbsp;<span class="op" id="2276860">=</span>&nbsp;<span class="string" id="2276862">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2276873">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;down&nbsp;(truncate)&nbsp;if&nbsp;lower&nbsp;has&nbsp;a&nbsp;different&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2276939">//&nbsp;or&nbsp;if&nbsp;lower&nbsp;is&nbsp;inclusive&nbsp;and&nbsp;is&nbsp;exactly&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;down.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277013">okdown</span>&nbsp;<span class="op" id="2277020">:=</span>&nbsp;<span class="ident" id="2277023">l</span>&nbsp;<span class="op" id="2277025">!=</span>&nbsp;<span class="ident" id="2277028">m</span>&nbsp;<span class="op" id="2277030">||</span>&nbsp;<span class="op" id="2277033">(</span><span class="ident" id="2277034">inclusive</span>&nbsp;<span class="op" id="2277044">&amp;&amp;</span>&nbsp;<span class="ident" id="2277047">l</span>&nbsp;<span class="op" id="2277049">==</span>&nbsp;<span class="ident" id="2277052">m</span>&nbsp;<span class="op" id="2277054">&amp;&amp;</span>&nbsp;<span class="ident" id="2277057">i</span><span class="op" id="2277058">+</span><span class="num" id="2277059">1</span>&nbsp;<span class="op" id="2277061">==</span>&nbsp;<span class="ident" id="2277064">lower</span><span class="op" id="2277069">.</span><span class="ident" id="2277070">nd</span><span class="op" id="2277072">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277077">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;up&nbsp;if&nbsp;upper&nbsp;has&nbsp;a&nbsp;different&nbsp;digit&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277134">//&nbsp;either&nbsp;upper&nbsp;is&nbsp;inclusive&nbsp;or&nbsp;upper&nbsp;is&nbsp;bigger&nbsp;than&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277216">okup</span>&nbsp;<span class="op" id="2277221">:=</span>&nbsp;<span class="ident" id="2277224">m</span>&nbsp;<span class="op" id="2277226">!=</span>&nbsp;<span class="ident" id="2277229">u</span>&nbsp;<span class="op" id="2277231">&amp;&amp;</span>&nbsp;<span class="op" id="2277234">(</span><span class="ident" id="2277235">inclusive</span>&nbsp;<span class="op" id="2277245">||</span>&nbsp;<span class="ident" id="2277248">m</span><span class="op" id="2277249">+</span><span class="num" id="2277250">1</span>&nbsp;<span class="op" id="2277252">&lt;</span>&nbsp;<span class="ident" id="2277254">u</span>&nbsp;<span class="op" id="2277256">||</span>&nbsp;<span class="ident" id="2277259">i</span><span class="op" id="2277260">+</span><span class="num" id="2277261">1</span>&nbsp;<span class="op" id="2277263">&lt;</span>&nbsp;<span class="ident" id="2277265">upper</span><span class="op" id="2277270">.</span><span class="ident" id="2277271">nd</span><span class="op" id="2277273">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277278">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;either,&nbsp;then&nbsp;round&nbsp;to&nbsp;the&nbsp;nearest&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277341">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;only&nbsp;one,&nbsp;do&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277382">switch</span>&nbsp;<span class="op" id="2277389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277393">case</span>&nbsp;<span class="ident" id="2277398">okdown</span>&nbsp;<span class="op" id="2277405">&amp;&amp;</span>&nbsp;<span class="ident" id="2277408">okup</span><span class="op" id="2277412">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277417">d</span><span class="op" id="2277418">.</span><span class="ident" id="2277419">Round</span><span class="op" id="2277424">(</span><span class="ident" id="2277425">i</span>&nbsp;<span class="op" id="2277427">+</span>&nbsp;<span class="num" id="2277429">1</span><span class="op" id="2277430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277435">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277444">case</span>&nbsp;<span class="ident" id="2277449">okdown</span><span class="op" id="2277455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277460">d</span><span class="op" id="2277461">.</span><span class="ident" id="2277462">RoundDown</span><span class="op" id="2277471">(</span><span class="ident" id="2277472">i</span>&nbsp;<span class="op" id="2277474">+</span>&nbsp;<span class="num" id="2277476">1</span><span class="op" id="2277477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277482">return</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277491">case</span>&nbsp;<span class="ident" id="2277496">okup</span><span class="op" id="2277500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277505">d</span><span class="op" id="2277506">.</span><span class="ident" id="2277507">RoundUp</span><span class="op" id="2277514">(</span><span class="ident" id="2277515">i</span>&nbsp;<span class="op" id="2277517">+</span>&nbsp;<span class="num" id="2277519">1</span><span class="op" id="2277520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277525">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277537">}</span><br>
<span class="lineno">325</span><span class="op" id="2277539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2277542">type</span>&nbsp;<span class="ident" id="2277547">decimalSlice</span>&nbsp;<span class="keyword" id="2277560">struct</span>&nbsp;<span class="op" id="2277567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277570">d</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2277577">[</span><span class="op" id="2277578">]</span><span class="builtintype" id="2277579">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277585">nd</span><span class="op" id="2277587">,</span>&nbsp;<span class="ident" id="2277589">dp</span>&nbsp;<span class="builtintype" id="2277592">int</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277597">neg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2277604">bool</span><br>
<span class="lineno"></span><span class="op" id="2277609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2277612">//&nbsp;%e:&nbsp;-d.ddddde±dd</span><br>
<span class="lineno"></span><span class="keyword" id="2277633">func</span>&nbsp;<span class="ident" id="2277638">fmtE</span><span class="op" id="2277642">(</span><span class="ident" id="2277643">dst</span>&nbsp;<span class="op" id="2277647">[</span><span class="op" id="2277648">]</span><span class="builtintype" id="2277649">byte</span><span class="op" id="2277653">,</span>&nbsp;<span class="ident" id="2277655">neg</span>&nbsp;<span class="builtintype" id="2277659">bool</span><span class="op" id="2277663">,</span>&nbsp;<span class="ident" id="2277665">d</span>&nbsp;<span class="ident" id="2277667">decimalSlice</span><span class="op" id="2277679">,</span>&nbsp;<span class="ident" id="2277681">prec</span>&nbsp;<span class="builtintype" id="2277686">int</span><span class="op" id="2277689">,</span>&nbsp;<span class="ident" id="2277691">fmt</span>&nbsp;<span class="builtintype" id="2277695">byte</span><span class="op" id="2277699">)</span>&nbsp;<span class="op" id="2277701">[</span><span class="op" id="2277702">]</span><span class="builtintype" id="2277703">byte</span>&nbsp;<span class="op" id="2277708">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277711">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277720">if</span>&nbsp;<span class="ident" id="2277723">neg</span>&nbsp;<span class="op" id="2277727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277731">dst</span>&nbsp;<span class="op" id="2277735">=</span>&nbsp;<span class="builtinfunc" id="2277737">append</span><span class="op" id="2277743">(</span><span class="ident" id="2277744">dst</span><span class="op" id="2277747">,</span>&nbsp;<span class="string" id="2277749">&#39;-&#39;</span><span class="op" id="2277752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277759">//&nbsp;first&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277775">ch</span>&nbsp;<span class="op" id="2277778">:=</span>&nbsp;<span class="builtintype" id="2277781">byte</span><span class="op" id="2277785">(</span><span class="string" id="2277786">&#39;0&#39;</span><span class="op" id="2277789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277792">if</span>&nbsp;<span class="ident" id="2277795">d</span><span class="op" id="2277796">.</span><span class="ident" id="2277797">nd</span>&nbsp;<span class="op" id="2277800">!=</span>&nbsp;<span class="num" id="2277803">0</span>&nbsp;<span class="op" id="2277805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277809">ch</span>&nbsp;<span class="op" id="2277812">=</span>&nbsp;<span class="ident" id="2277814">d</span><span class="op" id="2277815">.</span><span class="ident" id="2277816">d</span><span class="op" id="2277817">[</span><span class="num" id="2277818">0</span><span class="op" id="2277819">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277822">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277825">dst</span>&nbsp;<span class="op" id="2277829">=</span>&nbsp;<span class="builtinfunc" id="2277831">append</span><span class="op" id="2277837">(</span><span class="ident" id="2277838">dst</span><span class="op" id="2277841">,</span>&nbsp;<span class="ident" id="2277843">ch</span><span class="op" id="2277845">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277849">//&nbsp;.moredigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277865">if</span>&nbsp;<span class="ident" id="2277868">prec</span>&nbsp;<span class="op" id="2277873">&gt;</span>&nbsp;<span class="num" id="2277875">0</span>&nbsp;<span class="op" id="2277877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277881">dst</span>&nbsp;<span class="op" id="2277885">=</span>&nbsp;<span class="builtinfunc" id="2277887">append</span><span class="op" id="2277893">(</span><span class="ident" id="2277894">dst</span><span class="op" id="2277897">,</span>&nbsp;<span class="string" id="2277899">&#39;.&#39;</span><span class="op" id="2277902">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277906">i</span>&nbsp;<span class="op" id="2277908">:=</span>&nbsp;<span class="num" id="2277911">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277915">m</span>&nbsp;<span class="op" id="2277917">:=</span>&nbsp;<span class="ident" id="2277920">d</span><span class="op" id="2277921">.</span><span class="ident" id="2277922">nd</span>&nbsp;<span class="op" id="2277925">+</span>&nbsp;<span class="ident" id="2277927">prec</span>&nbsp;<span class="op" id="2277932">+</span>&nbsp;<span class="num" id="2277934">1</span>&nbsp;<span class="op" id="2277936">-</span>&nbsp;<span class="ident" id="2277938">max</span><span class="op" id="2277941">(</span><span class="ident" id="2277942">d</span><span class="op" id="2277943">.</span><span class="ident" id="2277944">nd</span><span class="op" id="2277946">,</span>&nbsp;<span class="ident" id="2277948">prec</span><span class="op" id="2277952">+</span><span class="num" id="2277953">1</span><span class="op" id="2277954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277958">for</span>&nbsp;<span class="ident" id="2277962">i</span>&nbsp;<span class="op" id="2277964">&lt;</span>&nbsp;<span class="ident" id="2277966">m</span>&nbsp;<span class="op" id="2277968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277973">dst</span>&nbsp;<span class="op" id="2277977">=</span>&nbsp;<span class="builtinfunc" id="2277979">append</span><span class="op" id="2277985">(</span><span class="ident" id="2277986">dst</span><span class="op" id="2277989">,</span>&nbsp;<span class="ident" id="2277991">d</span><span class="op" id="2277992">.</span><span class="ident" id="2277993">d</span><span class="op" id="2277994">[</span><span class="ident" id="2277995">i</span><span class="op" id="2277996">]</span><span class="op" id="2277997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278002">i</span><span class="op" id="2278003">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278012">for</span>&nbsp;<span class="ident" id="2278016">i</span>&nbsp;<span class="op" id="2278018">&lt;=</span>&nbsp;<span class="ident" id="2278021">prec</span>&nbsp;<span class="op" id="2278026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278031">dst</span>&nbsp;<span class="op" id="2278035">=</span>&nbsp;<span class="builtinfunc" id="2278037">append</span><span class="op" id="2278043">(</span><span class="ident" id="2278044">dst</span><span class="op" id="2278047">,</span>&nbsp;<span class="string" id="2278049">&#39;0&#39;</span><span class="op" id="2278052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278057">i</span><span class="op" id="2278058">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278063">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278070">//&nbsp;e±</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278078">dst</span>&nbsp;<span class="op" id="2278082">=</span>&nbsp;<span class="builtinfunc" id="2278084">append</span><span class="op" id="2278090">(</span><span class="ident" id="2278091">dst</span><span class="op" id="2278094">,</span>&nbsp;<span class="ident" id="2278096">fmt</span><span class="op" id="2278099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278102">exp</span>&nbsp;<span class="op" id="2278106">:=</span>&nbsp;<span class="ident" id="2278109">d</span><span class="op" id="2278110">.</span><span class="ident" id="2278111">dp</span>&nbsp;<span class="op" id="2278114">-</span>&nbsp;<span class="num" id="2278116">1</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278119">if</span>&nbsp;<span class="ident" id="2278122">d</span><span class="op" id="2278123">.</span><span class="ident" id="2278124">nd</span>&nbsp;<span class="op" id="2278127">==</span>&nbsp;<span class="num" id="2278130">0</span>&nbsp;<span class="op" id="2278132">{</span>&nbsp;<span class="comment" id="2278134">//&nbsp;special&nbsp;case:&nbsp;0&nbsp;has&nbsp;exponent&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278170">exp</span>&nbsp;<span class="op" id="2278174">=</span>&nbsp;<span class="num" id="2278176">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278182">if</span>&nbsp;<span class="ident" id="2278185">exp</span>&nbsp;<span class="op" id="2278189">&lt;</span>&nbsp;<span class="num" id="2278191">0</span>&nbsp;<span class="op" id="2278193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278197">ch</span>&nbsp;<span class="op" id="2278200">=</span>&nbsp;<span class="string" id="2278202">&#39;-&#39;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278208">exp</span>&nbsp;<span class="op" id="2278212">=</span>&nbsp;<span class="op" id="2278214">-</span><span class="ident" id="2278215">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278220">}</span>&nbsp;<span class="keyword" id="2278222">else</span>&nbsp;<span class="op" id="2278227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278231">ch</span>&nbsp;<span class="op" id="2278234">=</span>&nbsp;<span class="string" id="2278236">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278244">dst</span>&nbsp;<span class="op" id="2278248">=</span>&nbsp;<span class="builtinfunc" id="2278250">append</span><span class="op" id="2278256">(</span><span class="ident" id="2278257">dst</span><span class="op" id="2278260">,</span>&nbsp;<span class="ident" id="2278262">ch</span><span class="op" id="2278264">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278268">//&nbsp;dddd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278277">var</span>&nbsp;<span class="ident" id="2278281">buf</span>&nbsp;<span class="op" id="2278285">[</span><span class="num" id="2278286">3</span><span class="op" id="2278287">]</span><span class="builtintype" id="2278288">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278294">i</span>&nbsp;<span class="op" id="2278296">:=</span>&nbsp;<span class="builtinfunc" id="2278299">len</span><span class="op" id="2278302">(</span><span class="ident" id="2278303">buf</span><span class="op" id="2278306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278309">for</span>&nbsp;<span class="ident" id="2278313">exp</span>&nbsp;<span class="op" id="2278317">&gt;=</span>&nbsp;<span class="num" id="2278320">10</span>&nbsp;<span class="op" id="2278323">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278327">i</span><span class="op" id="2278328">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278333">buf</span><span class="op" id="2278336">[</span><span class="ident" id="2278337">i</span><span class="op" id="2278338">]</span>&nbsp;<span class="op" id="2278340">=</span>&nbsp;<span class="builtintype" id="2278342">byte</span><span class="op" id="2278346">(</span><span class="ident" id="2278347">exp</span><span class="op" id="2278350">%</span><span class="num" id="2278351">10</span>&nbsp;<span class="op" id="2278354">+</span>&nbsp;<span class="string" id="2278356">&#39;0&#39;</span><span class="op" id="2278359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278363">exp</span>&nbsp;<span class="op" id="2278367">/=</span>&nbsp;<span class="num" id="2278370">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278377">//&nbsp;exp&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278390">i</span><span class="op" id="2278391">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278395">buf</span><span class="op" id="2278398">[</span><span class="ident" id="2278399">i</span><span class="op" id="2278400">]</span>&nbsp;<span class="op" id="2278402">=</span>&nbsp;<span class="builtintype" id="2278404">byte</span><span class="op" id="2278408">(</span><span class="ident" id="2278409">exp</span>&nbsp;<span class="op" id="2278413">+</span>&nbsp;<span class="string" id="2278415">&#39;0&#39;</span><span class="op" id="2278418">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278422">switch</span>&nbsp;<span class="ident" id="2278429">i</span>&nbsp;<span class="op" id="2278431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278434">case</span>&nbsp;<span class="num" id="2278439">0</span><span class="op" id="2278440">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278444">dst</span>&nbsp;<span class="op" id="2278448">=</span>&nbsp;<span class="builtinfunc" id="2278450">append</span><span class="op" id="2278456">(</span><span class="ident" id="2278457">dst</span><span class="op" id="2278460">,</span>&nbsp;<span class="ident" id="2278462">buf</span><span class="op" id="2278465">[</span><span class="num" id="2278466">0</span><span class="op" id="2278467">]</span><span class="op" id="2278468">,</span>&nbsp;<span class="ident" id="2278470">buf</span><span class="op" id="2278473">[</span><span class="num" id="2278474">1</span><span class="op" id="2278475">]</span><span class="op" id="2278476">,</span>&nbsp;<span class="ident" id="2278478">buf</span><span class="op" id="2278481">[</span><span class="num" id="2278482">2</span><span class="op" id="2278483">]</span><span class="op" id="2278484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278487">case</span>&nbsp;<span class="num" id="2278492">1</span><span class="op" id="2278493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278497">dst</span>&nbsp;<span class="op" id="2278501">=</span>&nbsp;<span class="builtinfunc" id="2278503">append</span><span class="op" id="2278509">(</span><span class="ident" id="2278510">dst</span><span class="op" id="2278513">,</span>&nbsp;<span class="ident" id="2278515">buf</span><span class="op" id="2278518">[</span><span class="num" id="2278519">1</span><span class="op" id="2278520">]</span><span class="op" id="2278521">,</span>&nbsp;<span class="ident" id="2278523">buf</span><span class="op" id="2278526">[</span><span class="num" id="2278527">2</span><span class="op" id="2278528">]</span><span class="op" id="2278529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278532">case</span>&nbsp;<span class="num" id="2278537">2</span><span class="op" id="2278538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278542">//&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278562">dst</span>&nbsp;<span class="op" id="2278566">=</span>&nbsp;<span class="builtinfunc" id="2278568">append</span><span class="op" id="2278574">(</span><span class="ident" id="2278575">dst</span><span class="op" id="2278578">,</span>&nbsp;<span class="string" id="2278580">&#39;0&#39;</span><span class="op" id="2278583">,</span>&nbsp;<span class="ident" id="2278585">buf</span><span class="op" id="2278588">[</span><span class="num" id="2278589">2</span><span class="op" id="2278590">]</span><span class="op" id="2278591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278597">return</span>&nbsp;<span class="ident" id="2278604">dst</span><br>
<span class="lineno"></span><span class="op" id="2278608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="2278611">//&nbsp;%f:&nbsp;-ddddddd.ddddd</span><br>
<span class="lineno"></span><span class="keyword" id="2278633">func</span>&nbsp;<span class="ident" id="2278638">fmtF</span><span class="op" id="2278642">(</span><span class="ident" id="2278643">dst</span>&nbsp;<span class="op" id="2278647">[</span><span class="op" id="2278648">]</span><span class="builtintype" id="2278649">byte</span><span class="op" id="2278653">,</span>&nbsp;<span class="ident" id="2278655">neg</span>&nbsp;<span class="builtintype" id="2278659">bool</span><span class="op" id="2278663">,</span>&nbsp;<span class="ident" id="2278665">d</span>&nbsp;<span class="ident" id="2278667">decimalSlice</span><span class="op" id="2278679">,</span>&nbsp;<span class="ident" id="2278681">prec</span>&nbsp;<span class="builtintype" id="2278686">int</span><span class="op" id="2278689">)</span>&nbsp;<span class="op" id="2278691">[</span><span class="op" id="2278692">]</span><span class="builtintype" id="2278693">byte</span>&nbsp;<span class="op" id="2278698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278701">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278710">if</span>&nbsp;<span class="ident" id="2278713">neg</span>&nbsp;<span class="op" id="2278717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278721">dst</span>&nbsp;<span class="op" id="2278725">=</span>&nbsp;<span class="builtinfunc" id="2278727">append</span><span class="op" id="2278733">(</span><span class="ident" id="2278734">dst</span><span class="op" id="2278737">,</span>&nbsp;<span class="string" id="2278739">&#39;-&#39;</span><span class="op" id="2278742">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278749">//&nbsp;integer,&nbsp;padded&nbsp;with&nbsp;zeros&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278791">if</span>&nbsp;<span class="ident" id="2278794">d</span><span class="op" id="2278795">.</span><span class="ident" id="2278796">dp</span>&nbsp;<span class="op" id="2278799">&gt;</span>&nbsp;<span class="num" id="2278801">0</span>&nbsp;<span class="op" id="2278803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278807">var</span>&nbsp;<span class="ident" id="2278811">i</span>&nbsp;<span class="builtintype" id="2278813">int</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278819">for</span>&nbsp;<span class="ident" id="2278823">i</span>&nbsp;<span class="op" id="2278825">=</span>&nbsp;<span class="num" id="2278827">0</span><span class="op" id="2278828">;</span>&nbsp;<span class="ident" id="2278830">i</span>&nbsp;<span class="op" id="2278832">&lt;</span>&nbsp;<span class="ident" id="2278834">d</span><span class="op" id="2278835">.</span><span class="ident" id="2278836">dp</span>&nbsp;<span class="op" id="2278839">&amp;&amp;</span>&nbsp;<span class="ident" id="2278842">i</span>&nbsp;<span class="op" id="2278844">&lt;</span>&nbsp;<span class="ident" id="2278846">d</span><span class="op" id="2278847">.</span><span class="ident" id="2278848">nd</span><span class="op" id="2278850">;</span>&nbsp;<span class="ident" id="2278852">i</span><span class="op" id="2278853">++</span>&nbsp;<span class="op" id="2278856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278861">dst</span>&nbsp;<span class="op" id="2278865">=</span>&nbsp;<span class="builtinfunc" id="2278867">append</span><span class="op" id="2278873">(</span><span class="ident" id="2278874">dst</span><span class="op" id="2278877">,</span>&nbsp;<span class="ident" id="2278879">d</span><span class="op" id="2278880">.</span><span class="ident" id="2278881">d</span><span class="op" id="2278882">[</span><span class="ident" id="2278883">i</span><span class="op" id="2278884">]</span><span class="op" id="2278885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278893">for</span>&nbsp;<span class="op" id="2278897">;</span>&nbsp;<span class="ident" id="2278899">i</span>&nbsp;<span class="op" id="2278901">&lt;</span>&nbsp;<span class="ident" id="2278903">d</span><span class="op" id="2278904">.</span><span class="ident" id="2278905">dp</span><span class="op" id="2278907">;</span>&nbsp;<span class="ident" id="2278909">i</span><span class="op" id="2278910">++</span>&nbsp;<span class="op" id="2278913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278918">dst</span>&nbsp;<span class="op" id="2278922">=</span>&nbsp;<span class="builtinfunc" id="2278924">append</span><span class="op" id="2278930">(</span><span class="ident" id="2278931">dst</span><span class="op" id="2278934">,</span>&nbsp;<span class="string" id="2278936">&#39;0&#39;</span><span class="op" id="2278939">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278946">}</span>&nbsp;<span class="keyword" id="2278948">else</span>&nbsp;<span class="op" id="2278953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278957">dst</span>&nbsp;<span class="op" id="2278961">=</span>&nbsp;<span class="builtinfunc" id="2278963">append</span><span class="op" id="2278969">(</span><span class="ident" id="2278970">dst</span><span class="op" id="2278973">,</span>&nbsp;<span class="string" id="2278975">&#39;0&#39;</span><span class="op" id="2278978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278985">//&nbsp;fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278998">if</span>&nbsp;<span class="ident" id="2279001">prec</span>&nbsp;<span class="op" id="2279006">&gt;</span>&nbsp;<span class="num" id="2279008">0</span>&nbsp;<span class="op" id="2279010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279014">dst</span>&nbsp;<span class="op" id="2279018">=</span>&nbsp;<span class="builtinfunc" id="2279020">append</span><span class="op" id="2279026">(</span><span class="ident" id="2279027">dst</span><span class="op" id="2279030">,</span>&nbsp;<span class="string" id="2279032">&#39;.&#39;</span><span class="op" id="2279035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279039">for</span>&nbsp;<span class="ident" id="2279043">i</span>&nbsp;<span class="op" id="2279045">:=</span>&nbsp;<span class="num" id="2279048">0</span><span class="op" id="2279049">;</span>&nbsp;<span class="ident" id="2279051">i</span>&nbsp;<span class="op" id="2279053">&lt;</span>&nbsp;<span class="ident" id="2279055">prec</span><span class="op" id="2279059">;</span>&nbsp;<span class="ident" id="2279061">i</span><span class="op" id="2279062">++</span>&nbsp;<span class="op" id="2279065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279070">ch</span>&nbsp;<span class="op" id="2279073">:=</span>&nbsp;<span class="builtintype" id="2279076">byte</span><span class="op" id="2279080">(</span><span class="string" id="2279081">&#39;0&#39;</span><span class="op" id="2279084">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279089">if</span>&nbsp;<span class="ident" id="2279092">j</span>&nbsp;<span class="op" id="2279094">:=</span>&nbsp;<span class="ident" id="2279097">d</span><span class="op" id="2279098">.</span><span class="ident" id="2279099">dp</span>&nbsp;<span class="op" id="2279102">+</span>&nbsp;<span class="ident" id="2279104">i</span><span class="op" id="2279105">;</span>&nbsp;<span class="num" id="2279107">0</span>&nbsp;<span class="op" id="2279109">&lt;=</span>&nbsp;<span class="ident" id="2279112">j</span>&nbsp;<span class="op" id="2279114">&amp;&amp;</span>&nbsp;<span class="ident" id="2279117">j</span>&nbsp;<span class="op" id="2279119">&lt;</span>&nbsp;<span class="ident" id="2279121">d</span><span class="op" id="2279122">.</span><span class="ident" id="2279123">nd</span>&nbsp;<span class="op" id="2279126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279132">ch</span>&nbsp;<span class="op" id="2279135">=</span>&nbsp;<span class="ident" id="2279137">d</span><span class="op" id="2279138">.</span><span class="ident" id="2279139">d</span><span class="op" id="2279140">[</span><span class="ident" id="2279141">j</span><span class="op" id="2279142">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279152">dst</span>&nbsp;<span class="op" id="2279156">=</span>&nbsp;<span class="builtinfunc" id="2279158">append</span><span class="op" id="2279164">(</span><span class="ident" id="2279165">dst</span><span class="op" id="2279168">,</span>&nbsp;<span class="ident" id="2279170">ch</span><span class="op" id="2279172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279176">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279183">return</span>&nbsp;<span class="ident" id="2279190">dst</span><br>
<span class="lineno"></span><span class="op" id="2279194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="2279197">//&nbsp;%b:&nbsp;-ddddddddp+ddd</span><br>
<span class="lineno"></span><span class="keyword" id="2279219">func</span>&nbsp;<span class="ident" id="2279224">fmtB</span><span class="op" id="2279228">(</span><span class="ident" id="2279229">dst</span>&nbsp;<span class="op" id="2279233">[</span><span class="op" id="2279234">]</span><span class="builtintype" id="2279235">byte</span><span class="op" id="2279239">,</span>&nbsp;<span class="ident" id="2279241">neg</span>&nbsp;<span class="builtintype" id="2279245">bool</span><span class="op" id="2279249">,</span>&nbsp;<span class="ident" id="2279251">mant</span>&nbsp;<span class="ident" id="2279256">uint64</span><span class="op" id="2279262">,</span>&nbsp;<span class="ident" id="2279264">exp</span>&nbsp;<span class="builtintype" id="2279268">int</span><span class="op" id="2279271">,</span>&nbsp;<span class="ident" id="2279273">flt</span>&nbsp;<span class="op" id="2279277">*</span><span class="ident" id="2279278">floatInfo</span><span class="op" id="2279287">)</span>&nbsp;<span class="op" id="2279289">[</span><span class="op" id="2279290">]</span><span class="builtintype" id="2279291">byte</span>&nbsp;<span class="op" id="2279296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279299">var</span>&nbsp;<span class="ident" id="2279303">buf</span>&nbsp;<span class="op" id="2279307">[</span><span class="num" id="2279308">50</span><span class="op" id="2279310">]</span><span class="builtintype" id="2279311">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279317">w</span>&nbsp;<span class="op" id="2279319">:=</span>&nbsp;<span class="builtinfunc" id="2279322">len</span><span class="op" id="2279325">(</span><span class="ident" id="2279326">buf</span><span class="op" id="2279329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279332">exp</span>&nbsp;<span class="op" id="2279336">-=</span>&nbsp;<span class="builtintype" id="2279339">int</span><span class="op" id="2279342">(</span><span class="ident" id="2279343">flt</span><span class="op" id="2279346">.</span><span class="ident" id="2279347">mantbits</span><span class="op" id="2279355">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279358">esign</span>&nbsp;<span class="op" id="2279364">:=</span>&nbsp;<span class="builtintype" id="2279367">byte</span><span class="op" id="2279371">(</span><span class="string" id="2279372">&#39;+&#39;</span><span class="op" id="2279375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279378">if</span>&nbsp;<span class="ident" id="2279381">exp</span>&nbsp;<span class="op" id="2279385">&lt;</span>&nbsp;<span class="num" id="2279387">0</span>&nbsp;<span class="op" id="2279389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279393">esign</span>&nbsp;<span class="op" id="2279399">=</span>&nbsp;<span class="string" id="2279401">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279407">exp</span>&nbsp;<span class="op" id="2279411">=</span>&nbsp;<span class="op" id="2279413">-</span><span class="ident" id="2279414">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279419">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279422">n</span>&nbsp;<span class="op" id="2279424">:=</span>&nbsp;<span class="num" id="2279427">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279430">for</span>&nbsp;<span class="ident" id="2279434">exp</span>&nbsp;<span class="op" id="2279438">&gt;</span>&nbsp;<span class="num" id="2279440">0</span>&nbsp;<span class="op" id="2279442">||</span>&nbsp;<span class="ident" id="2279445">n</span>&nbsp;<span class="op" id="2279447">&lt;</span>&nbsp;<span class="num" id="2279449">1</span>&nbsp;<span class="op" id="2279451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279455">n</span><span class="op" id="2279456">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279461">w</span><span class="op" id="2279462">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279467">buf</span><span class="op" id="2279470">[</span><span class="ident" id="2279471">w</span><span class="op" id="2279472">]</span>&nbsp;<span class="op" id="2279474">=</span>&nbsp;<span class="builtintype" id="2279476">byte</span><span class="op" id="2279480">(</span><span class="ident" id="2279481">exp</span><span class="op" id="2279484">%</span><span class="num" id="2279485">10</span>&nbsp;<span class="op" id="2279488">+</span>&nbsp;<span class="string" id="2279490">&#39;0&#39;</span><span class="op" id="2279493">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279497">exp</span>&nbsp;<span class="op" id="2279501">/=</span>&nbsp;<span class="num" id="2279504">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279511">w</span><span class="op" id="2279512">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279516">buf</span><span class="op" id="2279519">[</span><span class="ident" id="2279520">w</span><span class="op" id="2279521">]</span>&nbsp;<span class="op" id="2279523">=</span>&nbsp;<span class="ident" id="2279525">esign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279532">w</span><span class="op" id="2279533">--</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279537">buf</span><span class="op" id="2279540">[</span><span class="ident" id="2279541">w</span><span class="op" id="2279542">]</span>&nbsp;<span class="op" id="2279544">=</span>&nbsp;<span class="string" id="2279546">&#39;p&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279551">n</span>&nbsp;<span class="op" id="2279553">=</span>&nbsp;<span class="num" id="2279555">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279558">for</span>&nbsp;<span class="ident" id="2279562">mant</span>&nbsp;<span class="op" id="2279567">&gt;</span>&nbsp;<span class="num" id="2279569">0</span>&nbsp;<span class="op" id="2279571">||</span>&nbsp;<span class="ident" id="2279574">n</span>&nbsp;<span class="op" id="2279576">&lt;</span>&nbsp;<span class="num" id="2279578">1</span>&nbsp;<span class="op" id="2279580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279584">n</span><span class="op" id="2279585">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279590">w</span><span class="op" id="2279591">--</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279596">buf</span><span class="op" id="2279599">[</span><span class="ident" id="2279600">w</span><span class="op" id="2279601">]</span>&nbsp;<span class="op" id="2279603">=</span>&nbsp;<span class="builtintype" id="2279605">byte</span><span class="op" id="2279609">(</span><span class="ident" id="2279610">mant</span><span class="op" id="2279614">%</span><span class="num" id="2279615">10</span>&nbsp;<span class="op" id="2279618">+</span>&nbsp;<span class="string" id="2279620">&#39;0&#39;</span><span class="op" id="2279623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279627">mant</span>&nbsp;<span class="op" id="2279632">/=</span>&nbsp;<span class="num" id="2279635">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279642">if</span>&nbsp;<span class="ident" id="2279645">neg</span>&nbsp;<span class="op" id="2279649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279653">w</span><span class="op" id="2279654">--</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279659">buf</span><span class="op" id="2279662">[</span><span class="ident" id="2279663">w</span><span class="op" id="2279664">]</span>&nbsp;<span class="op" id="2279666">=</span>&nbsp;<span class="string" id="2279668">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279676">return</span>&nbsp;<span class="builtinfunc" id="2279683">append</span><span class="op" id="2279689">(</span><span class="ident" id="2279690">dst</span><span class="op" id="2279693">,</span>&nbsp;<span class="ident" id="2279695">buf</span><span class="op" id="2279698">[</span><span class="ident" id="2279699">w</span><span class="op" id="2279700">:</span><span class="op" id="2279701">]</span><span class="op" id="2279702">...</span><span class="op" id="2279705">)</span><br>
<span class="lineno"></span><span class="op" id="2279707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="2279710">func</span>&nbsp;<span class="ident" id="2279715">max</span><span class="op" id="2279718">(</span><span class="ident" id="2279719">a</span><span class="op" id="2279720">,</span>&nbsp;<span class="ident" id="2279722">b</span>&nbsp;<span class="builtintype" id="2279724">int</span><span class="op" id="2279727">)</span>&nbsp;<span class="builtintype" id="2279729">int</span>&nbsp;<span class="op" id="2279733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279736">if</span>&nbsp;<span class="ident" id="2279739">a</span>&nbsp;<span class="op" id="2279741">&gt;</span>&nbsp;<span class="ident" id="2279743">b</span>&nbsp;<span class="op" id="2279745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279749">return</span>&nbsp;<span class="ident" id="2279756">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279762">return</span>&nbsp;<span class="ident" id="2279769">b</span><br>
<span class="lineno">475</span><span class="op" id="2279771">}</span>
</div>
</body>
</html>
