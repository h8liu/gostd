<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html" class="current">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8453288">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8453343">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8453397">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8453448">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;simple&nbsp;printer&nbsp;performance&nbsp;benchmark:</span><br>
<span class="lineno"></span><span class="comment" id="8453512">//&nbsp;go&nbsp;test&nbsp;-bench=BenchmarkPrint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8453546">package</span>&nbsp;<span class="ident" id="8453554">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="8453563">import</span>&nbsp;<span class="op" id="8453570">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8453573">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8453582">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8453592">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8453605">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8453611">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8453624">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8453631">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8453641">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8453644">var</span>&nbsp;<span class="ident" id="8453648">testfile</span>&nbsp;<span class="op" id="8453657">*</span><span class="ident" id="8453658">ast</span><span class="op" id="8453661">.</span><span class="ident" id="8453662">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8453668">func</span>&nbsp;<span class="ident" id="8453673">testprint</span><span class="op" id="8453682">(</span><span class="ident" id="8453683">out</span>&nbsp;<span class="ident" id="8453687">io</span><span class="op" id="8453689">.</span><span class="ident" id="8453690">Writer</span><span class="op" id="8453696">,</span>&nbsp;<span class="ident" id="8453698">file</span>&nbsp;<span class="op" id="8453703">*</span><span class="ident" id="8453704">ast</span><span class="op" id="8453707">.</span><span class="ident" id="8453708">File</span><span class="op" id="8453712">)</span>&nbsp;<span class="op" id="8453714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8453717">if</span>&nbsp;<span class="ident" id="8453720">err</span>&nbsp;<span class="op" id="8453724">:=</span>&nbsp;<span class="op" id="8453727">(</span><span class="op" id="8453728">&amp;</span><span class="ident" id="8453729">Config</span><span class="op" id="8453735">{</span><span class="ident" id="8453736">TabIndent</span>&nbsp;<span class="op" id="8453746">|</span>&nbsp;<span class="ident" id="8453748">UseSpaces</span><span class="op" id="8453757">,</span>&nbsp;<span class="num" id="8453759">8</span><span class="op" id="8453760">,</span>&nbsp;<span class="num" id="8453762">0</span><span class="op" id="8453763">}</span><span class="op" id="8453764">)</span><span class="op" id="8453765">.</span><span class="ident" id="8453766">Fprint</span><span class="op" id="8453772">(</span><span class="ident" id="8453773">out</span><span class="op" id="8453776">,</span>&nbsp;<span class="ident" id="8453778">fset</span><span class="op" id="8453782">,</span>&nbsp;<span class="ident" id="8453784">file</span><span class="op" id="8453788">)</span><span class="op" id="8453789">;</span>&nbsp;<span class="ident" id="8453791">err</span>&nbsp;<span class="op" id="8453795">!=</span>&nbsp;<span class="builtintype" id="8453798">nil</span>&nbsp;<span class="op" id="8453802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453806">log</span><span class="op" id="8453809">.</span><span class="ident" id="8453810">Fatalf</span><span class="op" id="8453816">(</span><span class="string" id="8453817">&#34;print&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8453834">,</span>&nbsp;<span class="ident" id="8453836">err</span><span class="op" id="8453839">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8453842">}</span><br>
<span class="lineno"></span><span class="op" id="8453844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8453847">//&nbsp;cannot&nbsp;initialize&nbsp;in&nbsp;init&nbsp;because&nbsp;(printer)&nbsp;Fprint&nbsp;launches&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="8453922">func</span>&nbsp;<span class="ident" id="8453927">initialize</span><span class="op" id="8453937">(</span><span class="op" id="8453938">)</span>&nbsp;<span class="op" id="8453940">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8453943">const</span>&nbsp;<span class="ident" id="8453949">filename</span>&nbsp;<span class="op" id="8453958">=</span>&nbsp;<span class="string" id="8453960">&#34;testdata/parser.go&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453983">src</span><span class="op" id="8453986">,</span>&nbsp;<span class="ident" id="8453988">err</span>&nbsp;<span class="op" id="8453992">:=</span>&nbsp;<span class="ident" id="8453995">ioutil</span><span class="op" id="8454001">.</span><span class="ident" id="8454002">ReadFile</span><span class="op" id="8454010">(</span><span class="ident" id="8454011">filename</span><span class="op" id="8454019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8454022">if</span>&nbsp;<span class="ident" id="8454025">err</span>&nbsp;<span class="op" id="8454029">!=</span>&nbsp;<span class="builtintype" id="8454032">nil</span>&nbsp;<span class="op" id="8454036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454040">log</span><span class="op" id="8454043">.</span><span class="ident" id="8454044">Fatalf</span><span class="op" id="8454050">(</span><span class="string" id="8454051">&#34;%s&#34;</span><span class="op" id="8454055">,</span>&nbsp;<span class="ident" id="8454057">err</span><span class="op" id="8454060">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8454063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454067">file</span><span class="op" id="8454071">,</span>&nbsp;<span class="ident" id="8454073">err</span>&nbsp;<span class="op" id="8454077">:=</span>&nbsp;<span class="ident" id="8454080">parser</span><span class="op" id="8454086">.</span><span class="ident" id="8454087">ParseFile</span><span class="op" id="8454096">(</span><span class="ident" id="8454097">fset</span><span class="op" id="8454101">,</span>&nbsp;<span class="ident" id="8454103">filename</span><span class="op" id="8454111">,</span>&nbsp;<span class="ident" id="8454113">src</span><span class="op" id="8454116">,</span>&nbsp;<span class="ident" id="8454118">parser</span><span class="op" id="8454124">.</span><span class="ident" id="8454125">ParseComments</span><span class="op" id="8454138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8454141">if</span>&nbsp;<span class="ident" id="8454144">err</span>&nbsp;<span class="op" id="8454148">!=</span>&nbsp;<span class="builtintype" id="8454151">nil</span>&nbsp;<span class="op" id="8454155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454159">log</span><span class="op" id="8454162">.</span><span class="ident" id="8454163">Fatalf</span><span class="op" id="8454169">(</span><span class="string" id="8454170">&#34;%s&#34;</span><span class="op" id="8454174">,</span>&nbsp;<span class="ident" id="8454176">err</span><span class="op" id="8454179">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8454182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8454186">var</span>&nbsp;<span class="ident" id="8454190">buf</span>&nbsp;<span class="ident" id="8454194">bytes</span><span class="op" id="8454199">.</span><span class="ident" id="8454200">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454208">testprint</span><span class="op" id="8454217">(</span><span class="op" id="8454218">&amp;</span><span class="ident" id="8454219">buf</span><span class="op" id="8454222">,</span>&nbsp;<span class="ident" id="8454224">file</span><span class="op" id="8454228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8454231">if</span>&nbsp;<span class="op" id="8454234">!</span><span class="ident" id="8454235">bytes</span><span class="op" id="8454240">.</span><span class="ident" id="8454241">Equal</span><span class="op" id="8454246">(</span><span class="ident" id="8454247">buf</span><span class="op" id="8454250">.</span><span class="ident" id="8454251">Bytes</span><span class="op" id="8454256">(</span><span class="op" id="8454257">)</span><span class="op" id="8454258">,</span>&nbsp;<span class="ident" id="8454260">src</span><span class="op" id="8454263">)</span>&nbsp;<span class="op" id="8454265">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454269">log</span><span class="op" id="8454272">.</span><span class="ident" id="8454273">Fatalf</span><span class="op" id="8454279">(</span><span class="string" id="8454280">&#34;print&nbsp;error:&nbsp;%s&nbsp;not&nbsp;idempotent&#34;</span><span class="op" id="8454312">,</span>&nbsp;<span class="ident" id="8454314">filename</span><span class="op" id="8454322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8454325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454329">testfile</span>&nbsp;<span class="op" id="8454338">=</span>&nbsp;<span class="ident" id="8454340">file</span><br>
<span class="lineno"></span><span class="op" id="8454345">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="8454348">func</span>&nbsp;<span class="ident" id="8454353">BenchmarkPrint</span><span class="op" id="8454367">(</span><span class="ident" id="8454368">b</span>&nbsp;<span class="op" id="8454370">*</span><span class="ident" id="8454371">testing</span><span class="op" id="8454378">.</span><span class="ident" id="8454379">B</span><span class="op" id="8454380">)</span>&nbsp;<span class="op" id="8454382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8454385">if</span>&nbsp;<span class="ident" id="8454388">testfile</span>&nbsp;<span class="op" id="8454397">==</span>&nbsp;<span class="builtintype" id="8454400">nil</span>&nbsp;<span class="op" id="8454404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454408">initialize</span><span class="op" id="8454418">(</span><span class="op" id="8454419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8454422">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8454425">for</span>&nbsp;<span class="ident" id="8454429">i</span>&nbsp;<span class="op" id="8454431">:=</span>&nbsp;<span class="num" id="8454434">0</span><span class="op" id="8454435">;</span>&nbsp;<span class="ident" id="8454437">i</span>&nbsp;<span class="op" id="8454439">&lt;</span>&nbsp;<span class="ident" id="8454441">b</span><span class="op" id="8454442">.</span><span class="ident" id="8454443">N</span><span class="op" id="8454444">;</span>&nbsp;<span class="ident" id="8454446">i</span><span class="op" id="8454447">++</span>&nbsp;<span class="op" id="8454450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454454">testprint</span><span class="op" id="8454463">(</span><span class="ident" id="8454464">ioutil</span><span class="op" id="8454470">.</span><span class="ident" id="8454471">Discard</span><span class="op" id="8454478">,</span>&nbsp;<span class="ident" id="8454480">testfile</span><span class="op" id="8454488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8454491">}</span><br>
<span class="lineno"></span><span class="op" id="8454493">}</span>
</div>
</body>
</html>
