<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2508043">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2508099">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2508153">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2508204">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2508274">//&nbsp;Unix&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2508306">package</span>&nbsp;<span class="ident" id="2508314">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2508323">import</span>&nbsp;<span class="string" id="2508330">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2508338">var</span>&nbsp;<span class="op" id="2508342">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2508345">//&nbsp;envOnce&nbsp;guards&nbsp;initialization&nbsp;by&nbsp;copyenv,&nbsp;which&nbsp;populates&nbsp;env.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2508412">envOnce</span>&nbsp;<span class="ident" id="2508420">sync</span><span class="op" id="2508424">.</span><span class="ident" id="2508425">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2508432">//&nbsp;envLock&nbsp;guards&nbsp;env&nbsp;and&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2508465">envLock</span>&nbsp;<span class="ident" id="2508473">sync</span><span class="op" id="2508477">.</span><span class="ident" id="2508478">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2508488">//&nbsp;env&nbsp;maps&nbsp;from&nbsp;an&nbsp;environment&nbsp;variable&nbsp;to&nbsp;its&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2508563">env</span>&nbsp;<span class="keyword" id="2508567">map</span><span class="op" id="2508570">[</span><span class="builtintype" id="2508571">string</span><span class="op" id="2508577">]</span><span class="builtintype" id="2508578">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2508584">//&nbsp;envs&nbsp;is&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;elements&nbsp;are&nbsp;expected&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2508646">//&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;key=value&#34;.&nbsp;An&nbsp;empty&nbsp;string&nbsp;means&nbsp;deleted</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2508708">//&nbsp;(or&nbsp;a&nbsp;duplicate&nbsp;to&nbsp;be&nbsp;ignored).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2508744">envs</span>&nbsp;<span class="op" id="2508749">[</span><span class="op" id="2508750">]</span><span class="builtintype" id="2508751">string</span>&nbsp;<span class="op" id="2508758">=</span>&nbsp;<span class="ident" id="2508760">runtime_envs</span><span class="op" id="2508772">(</span><span class="op" id="2508773">)</span><br>
<span class="lineno"></span><span class="op" id="2508775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2508778">func</span>&nbsp;<span class="ident" id="2508783">runtime_envs</span><span class="op" id="2508795">(</span><span class="op" id="2508796">)</span>&nbsp;<span class="op" id="2508798">[</span><span class="op" id="2508799">]</span><span class="builtintype" id="2508800">string</span>&nbsp;<span class="comment" id="2508807">//&nbsp;in&nbsp;package&nbsp;runtime</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2508830">//&nbsp;setenv_c&nbsp;and&nbsp;unsetenv_c&nbsp;are&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime&nbsp;but&nbsp;are&nbsp;no-ops</span><br>
<span class="lineno"></span><span class="comment" id="2508900">//&nbsp;if&nbsp;cgo&nbsp;isn&#39;t&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="keyword" id="2508924">func</span>&nbsp;<span class="ident" id="2508929">setenv_c</span><span class="op" id="2508937">(</span><span class="ident" id="2508938">k</span><span class="op" id="2508939">,</span>&nbsp;<span class="ident" id="2508941">v</span>&nbsp;<span class="builtintype" id="2508943">string</span><span class="op" id="2508949">)</span><br>
<span class="lineno"></span><span class="keyword" id="2508951">func</span>&nbsp;<span class="ident" id="2508956">unsetenv_c</span><span class="op" id="2508966">(</span><span class="ident" id="2508967">k</span>&nbsp;<span class="builtintype" id="2508969">string</span><span class="op" id="2508975">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2508978">func</span>&nbsp;<span class="ident" id="2508983">copyenv</span><span class="op" id="2508990">(</span><span class="op" id="2508991">)</span>&nbsp;<span class="op" id="2508993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2508996">env</span>&nbsp;<span class="op" id="2509000">=</span>&nbsp;<span class="builtinfunc" id="2509002">make</span><span class="op" id="2509006">(</span><span class="keyword" id="2509007">map</span><span class="op" id="2509010">[</span><span class="builtintype" id="2509011">string</span><span class="op" id="2509017">]</span><span class="builtintype" id="2509018">int</span><span class="op" id="2509021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509024">for</span>&nbsp;<span class="ident" id="2509028">i</span><span class="op" id="2509029">,</span>&nbsp;<span class="ident" id="2509031">s</span>&nbsp;<span class="op" id="2509033">:=</span>&nbsp;<span class="keyword" id="2509036">range</span>&nbsp;<span class="ident" id="2509042">envs</span>&nbsp;<span class="op" id="2509047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509051">for</span>&nbsp;<span class="ident" id="2509055">j</span>&nbsp;<span class="op" id="2509057">:=</span>&nbsp;<span class="num" id="2509060">0</span><span class="op" id="2509061">;</span>&nbsp;<span class="ident" id="2509063">j</span>&nbsp;<span class="op" id="2509065">&lt;</span>&nbsp;<span class="builtinfunc" id="2509067">len</span><span class="op" id="2509070">(</span><span class="ident" id="2509071">s</span><span class="op" id="2509072">)</span><span class="op" id="2509073">;</span>&nbsp;<span class="ident" id="2509075">j</span><span class="op" id="2509076">++</span>&nbsp;<span class="op" id="2509079">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509084">if</span>&nbsp;<span class="ident" id="2509087">s</span><span class="op" id="2509088">[</span><span class="ident" id="2509089">j</span><span class="op" id="2509090">]</span>&nbsp;<span class="op" id="2509092">==</span>&nbsp;<span class="string" id="2509095">&#39;=&#39;</span>&nbsp;<span class="op" id="2509099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2509105">key</span>&nbsp;<span class="op" id="2509109">:=</span>&nbsp;<span class="ident" id="2509112">s</span><span class="op" id="2509113">[</span><span class="op" id="2509114">:</span><span class="ident" id="2509115">j</span><span class="op" id="2509116">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509122">if</span>&nbsp;<span class="ident" id="2509125">_</span><span class="op" id="2509126">,</span>&nbsp;<span class="ident" id="2509128">ok</span>&nbsp;<span class="op" id="2509131">:=</span>&nbsp;<span class="ident" id="2509134">env</span><span class="op" id="2509137">[</span><span class="ident" id="2509138">key</span><span class="op" id="2509141">]</span><span class="op" id="2509142">;</span>&nbsp;<span class="op" id="2509144">!</span><span class="ident" id="2509145">ok</span>&nbsp;<span class="op" id="2509148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2509155">env</span><span class="op" id="2509158">[</span><span class="ident" id="2509159">key</span><span class="op" id="2509162">]</span>&nbsp;<span class="op" id="2509164">=</span>&nbsp;<span class="ident" id="2509166">i</span>&nbsp;<span class="comment" id="2509168">//&nbsp;first&nbsp;mention&nbsp;of&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2509196">}</span>&nbsp;<span class="keyword" id="2509198">else</span>&nbsp;<span class="op" id="2509203">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2509210">//&nbsp;Clear&nbsp;duplicate&nbsp;keys.&nbsp;This&nbsp;permits&nbsp;Unsetenv&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2509265">//&nbsp;safely&nbsp;delete&nbsp;only&nbsp;the&nbsp;first&nbsp;item&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2509315">//&nbsp;worrying&nbsp;about&nbsp;unshadowing&nbsp;a&nbsp;later&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2509363">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;security&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2509406">envs</span><span class="op" id="2509410">[</span><span class="ident" id="2509411">i</span><span class="op" id="2509412">]</span>&nbsp;<span class="op" id="2509414">=</span>&nbsp;<span class="string" id="2509416">&#34;&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2509423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509429">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2509438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2509442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2509445">}</span><br>
<span class="lineno">55</span><span class="op" id="2509447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2509450">func</span>&nbsp;<span class="ident" id="2509455">Unsetenv</span><span class="op" id="2509463">(</span><span class="ident" id="2509464">key</span>&nbsp;<span class="builtintype" id="2509468">string</span><span class="op" id="2509474">)</span>&nbsp;<span class="builtintype" id="2509476">error</span>&nbsp;<span class="op" id="2509482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2509485">envOnce</span><span class="op" id="2509492">.</span><span class="ident" id="2509493">Do</span><span class="op" id="2509495">(</span><span class="ident" id="2509496">copyenv</span><span class="op" id="2509503">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2509507">envLock</span><span class="op" id="2509514">.</span><span class="ident" id="2509515">Lock</span><span class="op" id="2509519">(</span><span class="op" id="2509520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509523">defer</span>&nbsp;<span class="ident" id="2509529">envLock</span><span class="op" id="2509536">.</span><span class="ident" id="2509537">Unlock</span><span class="op" id="2509543">(</span><span class="op" id="2509544">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509548">if</span>&nbsp;<span class="ident" id="2509551">i</span><span class="op" id="2509552">,</span>&nbsp;<span class="ident" id="2509554">ok</span>&nbsp;<span class="op" id="2509557">:=</span>&nbsp;<span class="ident" id="2509560">env</span><span class="op" id="2509563">[</span><span class="ident" id="2509564">key</span><span class="op" id="2509567">]</span><span class="op" id="2509568">;</span>&nbsp;<span class="ident" id="2509570">ok</span>&nbsp;<span class="op" id="2509573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2509577">envs</span><span class="op" id="2509581">[</span><span class="ident" id="2509582">i</span><span class="op" id="2509583">]</span>&nbsp;<span class="op" id="2509585">=</span>&nbsp;<span class="string" id="2509587">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2509592">delete</span><span class="op" id="2509598">(</span><span class="ident" id="2509599">env</span><span class="op" id="2509602">,</span>&nbsp;<span class="ident" id="2509604">key</span><span class="op" id="2509607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2509610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2509613">unsetenv_c</span><span class="op" id="2509623">(</span><span class="ident" id="2509624">key</span><span class="op" id="2509627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509630">return</span>&nbsp;<span class="ident" id="2509637">nil</span><br>
<span class="lineno"></span><span class="op" id="2509641">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2509644">func</span>&nbsp;<span class="ident" id="2509649">Getenv</span><span class="op" id="2509655">(</span><span class="ident" id="2509656">key</span>&nbsp;<span class="builtintype" id="2509660">string</span><span class="op" id="2509666">)</span>&nbsp;<span class="op" id="2509668">(</span><span class="ident" id="2509669">value</span>&nbsp;<span class="builtintype" id="2509675">string</span><span class="op" id="2509681">,</span>&nbsp;<span class="ident" id="2509683">found</span>&nbsp;<span class="builtintype" id="2509689">bool</span><span class="op" id="2509693">)</span>&nbsp;<span class="op" id="2509695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2509698">envOnce</span><span class="op" id="2509705">.</span><span class="ident" id="2509706">Do</span><span class="op" id="2509708">(</span><span class="ident" id="2509709">copyenv</span><span class="op" id="2509716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509719">if</span>&nbsp;<span class="builtinfunc" id="2509722">len</span><span class="op" id="2509725">(</span><span class="ident" id="2509726">key</span><span class="op" id="2509729">)</span>&nbsp;<span class="op" id="2509731">==</span>&nbsp;<span class="num" id="2509734">0</span>&nbsp;<span class="op" id="2509736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509740">return</span>&nbsp;<span class="string" id="2509747">&#34;&#34;</span><span class="op" id="2509749">,</span>&nbsp;<span class="builtintype" id="2509751">false</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2509758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2509762">envLock</span><span class="op" id="2509769">.</span><span class="ident" id="2509770">RLock</span><span class="op" id="2509775">(</span><span class="op" id="2509776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509779">defer</span>&nbsp;<span class="ident" id="2509785">envLock</span><span class="op" id="2509792">.</span><span class="ident" id="2509793">RUnlock</span><span class="op" id="2509800">(</span><span class="op" id="2509801">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2509805">i</span><span class="op" id="2509806">,</span>&nbsp;<span class="ident" id="2509808">ok</span>&nbsp;<span class="op" id="2509811">:=</span>&nbsp;<span class="ident" id="2509814">env</span><span class="op" id="2509817">[</span><span class="ident" id="2509818">key</span><span class="op" id="2509821">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509824">if</span>&nbsp;<span class="op" id="2509827">!</span><span class="ident" id="2509828">ok</span>&nbsp;<span class="op" id="2509831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509835">return</span>&nbsp;<span class="string" id="2509842">&#34;&#34;</span><span class="op" id="2509844">,</span>&nbsp;<span class="builtintype" id="2509846">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2509853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2509856">s</span>&nbsp;<span class="op" id="2509858">:=</span>&nbsp;<span class="ident" id="2509861">envs</span><span class="op" id="2509865">[</span><span class="ident" id="2509866">i</span><span class="op" id="2509867">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509870">for</span>&nbsp;<span class="ident" id="2509874">i</span>&nbsp;<span class="op" id="2509876">:=</span>&nbsp;<span class="num" id="2509879">0</span><span class="op" id="2509880">;</span>&nbsp;<span class="ident" id="2509882">i</span>&nbsp;<span class="op" id="2509884">&lt;</span>&nbsp;<span class="builtinfunc" id="2509886">len</span><span class="op" id="2509889">(</span><span class="ident" id="2509890">s</span><span class="op" id="2509891">)</span><span class="op" id="2509892">;</span>&nbsp;<span class="ident" id="2509894">i</span><span class="op" id="2509895">++</span>&nbsp;<span class="op" id="2509898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509902">if</span>&nbsp;<span class="ident" id="2509905">s</span><span class="op" id="2509906">[</span><span class="ident" id="2509907">i</span><span class="op" id="2509908">]</span>&nbsp;<span class="op" id="2509910">==</span>&nbsp;<span class="string" id="2509913">&#39;=&#39;</span>&nbsp;<span class="op" id="2509917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509922">return</span>&nbsp;<span class="ident" id="2509929">s</span><span class="op" id="2509930">[</span><span class="ident" id="2509931">i</span><span class="op" id="2509932">+</span><span class="num" id="2509933">1</span><span class="op" id="2509934">:</span><span class="op" id="2509935">]</span><span class="op" id="2509936">,</span>&nbsp;<span class="builtintype" id="2509938">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2509945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2509948">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2509951">return</span>&nbsp;<span class="string" id="2509958">&#34;&#34;</span><span class="op" id="2509960">,</span>&nbsp;<span class="builtintype" id="2509962">false</span><br>
<span class="lineno"></span><span class="op" id="2509968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2509971">func</span>&nbsp;<span class="ident" id="2509976">Setenv</span><span class="op" id="2509982">(</span><span class="ident" id="2509983">key</span><span class="op" id="2509986">,</span>&nbsp;<span class="ident" id="2509988">value</span>&nbsp;<span class="builtintype" id="2509994">string</span><span class="op" id="2510000">)</span>&nbsp;<span class="builtintype" id="2510002">error</span>&nbsp;<span class="op" id="2510008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510011">envOnce</span><span class="op" id="2510018">.</span><span class="ident" id="2510019">Do</span><span class="op" id="2510021">(</span><span class="ident" id="2510022">copyenv</span><span class="op" id="2510029">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510032">if</span>&nbsp;<span class="builtinfunc" id="2510035">len</span><span class="op" id="2510038">(</span><span class="ident" id="2510039">key</span><span class="op" id="2510042">)</span>&nbsp;<span class="op" id="2510044">==</span>&nbsp;<span class="num" id="2510047">0</span>&nbsp;<span class="op" id="2510049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510053">return</span>&nbsp;<span class="ident" id="2510060">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2510068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510071">for</span>&nbsp;<span class="ident" id="2510075">i</span>&nbsp;<span class="op" id="2510077">:=</span>&nbsp;<span class="num" id="2510080">0</span><span class="op" id="2510081">;</span>&nbsp;<span class="ident" id="2510083">i</span>&nbsp;<span class="op" id="2510085">&lt;</span>&nbsp;<span class="builtinfunc" id="2510087">len</span><span class="op" id="2510090">(</span><span class="ident" id="2510091">key</span><span class="op" id="2510094">)</span><span class="op" id="2510095">;</span>&nbsp;<span class="ident" id="2510097">i</span><span class="op" id="2510098">++</span>&nbsp;<span class="op" id="2510101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510105">if</span>&nbsp;<span class="ident" id="2510108">key</span><span class="op" id="2510111">[</span><span class="ident" id="2510112">i</span><span class="op" id="2510113">]</span>&nbsp;<span class="op" id="2510115">==</span>&nbsp;<span class="string" id="2510118">&#39;=&#39;</span>&nbsp;<span class="op" id="2510122">||</span>&nbsp;<span class="ident" id="2510125">key</span><span class="op" id="2510128">[</span><span class="ident" id="2510129">i</span><span class="op" id="2510130">]</span>&nbsp;<span class="op" id="2510132">==</span>&nbsp;<span class="num" id="2510135">0</span>&nbsp;<span class="op" id="2510137">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510142">return</span>&nbsp;<span class="ident" id="2510149">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2510158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2510161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510164">for</span>&nbsp;<span class="ident" id="2510168">i</span>&nbsp;<span class="op" id="2510170">:=</span>&nbsp;<span class="num" id="2510173">0</span><span class="op" id="2510174">;</span>&nbsp;<span class="ident" id="2510176">i</span>&nbsp;<span class="op" id="2510178">&lt;</span>&nbsp;<span class="builtinfunc" id="2510180">len</span><span class="op" id="2510183">(</span><span class="ident" id="2510184">value</span><span class="op" id="2510189">)</span><span class="op" id="2510190">;</span>&nbsp;<span class="ident" id="2510192">i</span><span class="op" id="2510193">++</span>&nbsp;<span class="op" id="2510196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510200">if</span>&nbsp;<span class="ident" id="2510203">value</span><span class="op" id="2510208">[</span><span class="ident" id="2510209">i</span><span class="op" id="2510210">]</span>&nbsp;<span class="op" id="2510212">==</span>&nbsp;<span class="num" id="2510215">0</span>&nbsp;<span class="op" id="2510217">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510222">return</span>&nbsp;<span class="ident" id="2510229">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2510238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2510241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510245">envLock</span><span class="op" id="2510252">.</span><span class="ident" id="2510253">Lock</span><span class="op" id="2510257">(</span><span class="op" id="2510258">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510261">defer</span>&nbsp;<span class="ident" id="2510267">envLock</span><span class="op" id="2510274">.</span><span class="ident" id="2510275">Unlock</span><span class="op" id="2510281">(</span><span class="op" id="2510282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510286">i</span><span class="op" id="2510287">,</span>&nbsp;<span class="ident" id="2510289">ok</span>&nbsp;<span class="op" id="2510292">:=</span>&nbsp;<span class="ident" id="2510295">env</span><span class="op" id="2510298">[</span><span class="ident" id="2510299">key</span><span class="op" id="2510302">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510305">kv</span>&nbsp;<span class="op" id="2510308">:=</span>&nbsp;<span class="ident" id="2510311">key</span>&nbsp;<span class="op" id="2510315">+</span>&nbsp;<span class="string" id="2510317">&#34;=&#34;</span>&nbsp;<span class="op" id="2510321">+</span>&nbsp;<span class="ident" id="2510323">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510330">if</span>&nbsp;<span class="ident" id="2510333">ok</span>&nbsp;<span class="op" id="2510336">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510340">envs</span><span class="op" id="2510344">[</span><span class="ident" id="2510345">i</span><span class="op" id="2510346">]</span>&nbsp;<span class="op" id="2510348">=</span>&nbsp;<span class="ident" id="2510350">kv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2510354">}</span>&nbsp;<span class="keyword" id="2510356">else</span>&nbsp;<span class="op" id="2510361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510365">i</span>&nbsp;<span class="op" id="2510367">=</span>&nbsp;<span class="builtinfunc" id="2510369">len</span><span class="op" id="2510372">(</span><span class="ident" id="2510373">envs</span><span class="op" id="2510377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510381">envs</span>&nbsp;<span class="op" id="2510386">=</span>&nbsp;<span class="builtinfunc" id="2510388">append</span><span class="op" id="2510394">(</span><span class="ident" id="2510395">envs</span><span class="op" id="2510399">,</span>&nbsp;<span class="ident" id="2510401">kv</span><span class="op" id="2510403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2510406">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510409">env</span><span class="op" id="2510412">[</span><span class="ident" id="2510413">key</span><span class="op" id="2510416">]</span>&nbsp;<span class="op" id="2510418">=</span>&nbsp;<span class="ident" id="2510420">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510423">setenv_c</span><span class="op" id="2510431">(</span><span class="ident" id="2510432">key</span><span class="op" id="2510435">,</span>&nbsp;<span class="ident" id="2510437">value</span><span class="op" id="2510442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510445">return</span>&nbsp;<span class="ident" id="2510452">nil</span><br>
<span class="lineno"></span><span class="op" id="2510456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2510459">func</span>&nbsp;<span class="ident" id="2510464">Clearenv</span><span class="op" id="2510472">(</span><span class="op" id="2510473">)</span>&nbsp;<span class="op" id="2510475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510478">envOnce</span><span class="op" id="2510485">.</span><span class="ident" id="2510486">Do</span><span class="op" id="2510488">(</span><span class="ident" id="2510489">copyenv</span><span class="op" id="2510496">)</span>&nbsp;<span class="comment" id="2510498">//&nbsp;prevent&nbsp;copyenv&nbsp;in&nbsp;Getenv/Setenv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510536">envLock</span><span class="op" id="2510543">.</span><span class="ident" id="2510544">Lock</span><span class="op" id="2510548">(</span><span class="op" id="2510549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510552">defer</span>&nbsp;<span class="ident" id="2510558">envLock</span><span class="op" id="2510565">.</span><span class="ident" id="2510566">Unlock</span><span class="op" id="2510572">(</span><span class="op" id="2510573">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510577">for</span>&nbsp;<span class="ident" id="2510581">k</span>&nbsp;<span class="op" id="2510583">:=</span>&nbsp;<span class="keyword" id="2510586">range</span>&nbsp;<span class="ident" id="2510592">env</span>&nbsp;<span class="op" id="2510596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510600">unsetenv_c</span><span class="op" id="2510610">(</span><span class="ident" id="2510611">k</span><span class="op" id="2510612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2510615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510618">env</span>&nbsp;<span class="op" id="2510622">=</span>&nbsp;<span class="builtinfunc" id="2510624">make</span><span class="op" id="2510628">(</span><span class="keyword" id="2510629">map</span><span class="op" id="2510632">[</span><span class="builtintype" id="2510633">string</span><span class="op" id="2510639">]</span><span class="builtintype" id="2510640">int</span><span class="op" id="2510643">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510646">envs</span>&nbsp;<span class="op" id="2510651">=</span>&nbsp;<span class="op" id="2510653">[</span><span class="op" id="2510654">]</span><span class="builtintype" id="2510655">string</span><span class="op" id="2510661">{</span><span class="op" id="2510662">}</span><br>
<span class="lineno"></span><span class="op" id="2510664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2510667">func</span>&nbsp;<span class="ident" id="2510672">Environ</span><span class="op" id="2510679">(</span><span class="op" id="2510680">)</span>&nbsp;<span class="op" id="2510682">[</span><span class="op" id="2510683">]</span><span class="builtintype" id="2510684">string</span>&nbsp;<span class="op" id="2510691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510694">envOnce</span><span class="op" id="2510701">.</span><span class="ident" id="2510702">Do</span><span class="op" id="2510704">(</span><span class="ident" id="2510705">copyenv</span><span class="op" id="2510712">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510715">envLock</span><span class="op" id="2510722">.</span><span class="ident" id="2510723">RLock</span><span class="op" id="2510728">(</span><span class="op" id="2510729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510732">defer</span>&nbsp;<span class="ident" id="2510738">envLock</span><span class="op" id="2510745">.</span><span class="ident" id="2510746">RUnlock</span><span class="op" id="2510753">(</span><span class="op" id="2510754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510757">a</span>&nbsp;<span class="op" id="2510759">:=</span>&nbsp;<span class="builtinfunc" id="2510762">make</span><span class="op" id="2510766">(</span><span class="op" id="2510767">[</span><span class="op" id="2510768">]</span><span class="builtintype" id="2510769">string</span><span class="op" id="2510775">,</span>&nbsp;<span class="num" id="2510777">0</span><span class="op" id="2510778">,</span>&nbsp;<span class="builtinfunc" id="2510780">len</span><span class="op" id="2510783">(</span><span class="ident" id="2510784">envs</span><span class="op" id="2510788">)</span><span class="op" id="2510789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510792">for</span>&nbsp;<span class="ident" id="2510796">_</span><span class="op" id="2510797">,</span>&nbsp;<span class="ident" id="2510799">env</span>&nbsp;<span class="op" id="2510803">:=</span>&nbsp;<span class="keyword" id="2510806">range</span>&nbsp;<span class="ident" id="2510812">envs</span>&nbsp;<span class="op" id="2510817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510821">if</span>&nbsp;<span class="ident" id="2510824">env</span>&nbsp;<span class="op" id="2510828">!=</span>&nbsp;<span class="string" id="2510831">&#34;&#34;</span>&nbsp;<span class="op" id="2510834">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2510839">a</span>&nbsp;<span class="op" id="2510841">=</span>&nbsp;<span class="builtinfunc" id="2510843">append</span><span class="op" id="2510849">(</span><span class="ident" id="2510850">a</span><span class="op" id="2510851">,</span>&nbsp;<span class="ident" id="2510853">env</span><span class="op" id="2510856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2510860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2510863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2510866">return</span>&nbsp;<span class="ident" id="2510873">a</span><br>
<span class="lineno"></span><span class="op" id="2510875">}</span>
</div>
</body>
</html>
