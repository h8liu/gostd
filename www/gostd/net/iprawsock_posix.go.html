<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3185395">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3185451">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3185505">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3185556">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3185634">package</span>&nbsp;<span class="ident" id="3185642">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3185647">import</span>&nbsp;<span class="op" id="3185654">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3185657">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3185668">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3185675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3185678">//&nbsp;BUG(mikio):&nbsp;On&nbsp;every&nbsp;POSIX&nbsp;platform,&nbsp;reads&nbsp;from&nbsp;the&nbsp;&#34;ip4&#34;&nbsp;network</span><br>
<span class="lineno">15</span><span class="comment" id="3185747">//&nbsp;using&nbsp;the&nbsp;ReadFrom&nbsp;or&nbsp;ReadFromIP&nbsp;method&nbsp;might&nbsp;not&nbsp;return&nbsp;a&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="3185818">//&nbsp;IPv4&nbsp;packet,&nbsp;including&nbsp;its&nbsp;header,&nbsp;even&nbsp;if&nbsp;there&nbsp;is&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3185879">//&nbsp;available.&nbsp;This&nbsp;can&nbsp;occur&nbsp;even&nbsp;in&nbsp;cases&nbsp;where&nbsp;Read&nbsp;or&nbsp;ReadMsgIP</span><br>
<span class="lineno"></span><span class="comment" id="3185946">//&nbsp;could&nbsp;return&nbsp;a&nbsp;complete&nbsp;packet.&nbsp;For&nbsp;this&nbsp;reason,&nbsp;it&nbsp;is&nbsp;recommended</span><br>
<span class="lineno"></span><span class="comment" id="3186016">//&nbsp;that&nbsp;you&nbsp;do&nbsp;not&nbsp;uses&nbsp;these&nbsp;methods&nbsp;if&nbsp;it&nbsp;is&nbsp;important&nbsp;to&nbsp;receive&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="3186086">//&nbsp;full&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3186102">//</span><br>
<span class="lineno"></span><span class="comment" id="3186105">//&nbsp;The&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;guidelines&nbsp;make&nbsp;it&nbsp;impossible&nbsp;for&nbsp;us&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3186171">//&nbsp;change&nbsp;the&nbsp;behavior&nbsp;of&nbsp;these&nbsp;methods;&nbsp;use&nbsp;Read&nbsp;or&nbsp;ReadMsgIP</span><br>
<span class="lineno"></span><span class="comment" id="3186234">//&nbsp;instead.</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3186247">func</span>&nbsp;<span class="ident" id="3186252">sockaddrToIP</span><span class="op" id="3186264">(</span><span class="ident" id="3186265">sa</span>&nbsp;<span class="ident" id="3186268">syscall</span><span class="op" id="3186275">.</span><span class="ident" id="3186276">Sockaddr</span><span class="op" id="3186284">)</span>&nbsp;<span class="ident" id="3186286">Addr</span>&nbsp;<span class="op" id="3186291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186294">switch</span>&nbsp;<span class="ident" id="3186301">sa</span>&nbsp;<span class="op" id="3186304">:=</span>&nbsp;<span class="ident" id="3186307">sa</span><span class="op" id="3186309">.</span><span class="op" id="3186310">(</span><span class="keyword" id="3186311">type</span><span class="op" id="3186315">)</span>&nbsp;<span class="op" id="3186317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186320">case</span>&nbsp;<span class="op" id="3186325">*</span><span class="ident" id="3186326">syscall</span><span class="op" id="3186333">.</span><span class="ident" id="3186334">SockaddrInet4</span><span class="op" id="3186347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186351">return</span>&nbsp;<span class="op" id="3186358">&amp;</span><span class="ident" id="3186359">IPAddr</span><span class="op" id="3186365">{</span><span class="ident" id="3186366">IP</span><span class="op" id="3186368">:</span>&nbsp;<span class="ident" id="3186370">sa</span><span class="op" id="3186372">.</span><span class="ident" id="3186373">Addr</span><span class="op" id="3186377">[</span><span class="num" id="3186378">0</span><span class="op" id="3186379">:</span><span class="op" id="3186380">]</span><span class="op" id="3186381">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186384">case</span>&nbsp;<span class="op" id="3186389">*</span><span class="ident" id="3186390">syscall</span><span class="op" id="3186397">.</span><span class="ident" id="3186398">SockaddrInet6</span><span class="op" id="3186411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186415">return</span>&nbsp;<span class="op" id="3186422">&amp;</span><span class="ident" id="3186423">IPAddr</span><span class="op" id="3186429">{</span><span class="ident" id="3186430">IP</span><span class="op" id="3186432">:</span>&nbsp;<span class="ident" id="3186434">sa</span><span class="op" id="3186436">.</span><span class="ident" id="3186437">Addr</span><span class="op" id="3186441">[</span><span class="num" id="3186442">0</span><span class="op" id="3186443">:</span><span class="op" id="3186444">]</span><span class="op" id="3186445">,</span>&nbsp;<span class="ident" id="3186447">Zone</span><span class="op" id="3186451">:</span>&nbsp;<span class="ident" id="3186453">zoneToString</span><span class="op" id="3186465">(</span><span class="builtintype" id="3186466">int</span><span class="op" id="3186469">(</span><span class="ident" id="3186470">sa</span><span class="op" id="3186472">.</span><span class="ident" id="3186473">ZoneId</span><span class="op" id="3186479">)</span><span class="op" id="3186480">)</span><span class="op" id="3186481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3186484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186487">return</span>&nbsp;<span class="ident" id="3186494">nil</span><br>
<span class="lineno"></span><span class="op" id="3186498">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3186501">func</span>&nbsp;<span class="op" id="3186506">(</span><span class="ident" id="3186507">a</span>&nbsp;<span class="op" id="3186509">*</span><span class="ident" id="3186510">IPAddr</span><span class="op" id="3186516">)</span>&nbsp;<span class="ident" id="3186518">family</span><span class="op" id="3186524">(</span><span class="op" id="3186525">)</span>&nbsp;<span class="builtintype" id="3186527">int</span>&nbsp;<span class="op" id="3186531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186534">if</span>&nbsp;<span class="ident" id="3186537">a</span>&nbsp;<span class="op" id="3186539">==</span>&nbsp;<span class="ident" id="3186542">nil</span>&nbsp;<span class="op" id="3186546">||</span>&nbsp;<span class="builtinfunc" id="3186549">len</span><span class="op" id="3186552">(</span><span class="ident" id="3186553">a</span><span class="op" id="3186554">.</span><span class="ident" id="3186555">IP</span><span class="op" id="3186557">)</span>&nbsp;<span class="op" id="3186559">&lt;=</span>&nbsp;<span class="ident" id="3186562">IPv4len</span>&nbsp;<span class="op" id="3186570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186574">return</span>&nbsp;<span class="ident" id="3186581">syscall</span><span class="op" id="3186588">.</span><span class="ident" id="3186589">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3186598">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186601">if</span>&nbsp;<span class="ident" id="3186604">a</span><span class="op" id="3186605">.</span><span class="ident" id="3186606">IP</span><span class="op" id="3186608">.</span><span class="ident" id="3186609">To4</span><span class="op" id="3186612">(</span><span class="op" id="3186613">)</span>&nbsp;<span class="op" id="3186615">!=</span>&nbsp;<span class="ident" id="3186618">nil</span>&nbsp;<span class="op" id="3186622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186626">return</span>&nbsp;<span class="ident" id="3186633">syscall</span><span class="op" id="3186640">.</span><span class="ident" id="3186641">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3186650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186653">return</span>&nbsp;<span class="ident" id="3186660">syscall</span><span class="op" id="3186667">.</span><span class="ident" id="3186668">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3186677">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3186680">func</span>&nbsp;<span class="op" id="3186685">(</span><span class="ident" id="3186686">a</span>&nbsp;<span class="op" id="3186688">*</span><span class="ident" id="3186689">IPAddr</span><span class="op" id="3186695">)</span>&nbsp;<span class="ident" id="3186697">isWildcard</span><span class="op" id="3186707">(</span><span class="op" id="3186708">)</span>&nbsp;<span class="builtintype" id="3186710">bool</span>&nbsp;<span class="op" id="3186715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186718">if</span>&nbsp;<span class="ident" id="3186721">a</span>&nbsp;<span class="op" id="3186723">==</span>&nbsp;<span class="ident" id="3186726">nil</span>&nbsp;<span class="op" id="3186730">||</span>&nbsp;<span class="ident" id="3186733">a</span><span class="op" id="3186734">.</span><span class="ident" id="3186735">IP</span>&nbsp;<span class="op" id="3186738">==</span>&nbsp;<span class="ident" id="3186741">nil</span>&nbsp;<span class="op" id="3186745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186749">return</span>&nbsp;<span class="builtintype" id="3186756">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3186762">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186765">return</span>&nbsp;<span class="ident" id="3186772">a</span><span class="op" id="3186773">.</span><span class="ident" id="3186774">IP</span><span class="op" id="3186776">.</span><span class="ident" id="3186777">IsUnspecified</span><span class="op" id="3186790">(</span><span class="op" id="3186791">)</span><br>
<span class="lineno"></span><span class="op" id="3186793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3186796">func</span>&nbsp;<span class="op" id="3186801">(</span><span class="ident" id="3186802">a</span>&nbsp;<span class="op" id="3186804">*</span><span class="ident" id="3186805">IPAddr</span><span class="op" id="3186811">)</span>&nbsp;<span class="ident" id="3186813">sockaddr</span><span class="op" id="3186821">(</span><span class="ident" id="3186822">family</span>&nbsp;<span class="builtintype" id="3186829">int</span><span class="op" id="3186832">)</span>&nbsp;<span class="op" id="3186834">(</span><span class="ident" id="3186835">syscall</span><span class="op" id="3186842">.</span><span class="ident" id="3186843">Sockaddr</span><span class="op" id="3186851">,</span>&nbsp;<span class="builtintype" id="3186853">error</span><span class="op" id="3186858">)</span>&nbsp;<span class="op" id="3186860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186863">if</span>&nbsp;<span class="ident" id="3186866">a</span>&nbsp;<span class="op" id="3186868">==</span>&nbsp;<span class="ident" id="3186871">nil</span>&nbsp;<span class="op" id="3186875">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186879">return</span>&nbsp;<span class="ident" id="3186886">nil</span><span class="op" id="3186889">,</span>&nbsp;<span class="ident" id="3186891">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3186896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186899">return</span>&nbsp;<span class="ident" id="3186906">ipToSockaddr</span><span class="op" id="3186918">(</span><span class="ident" id="3186919">family</span><span class="op" id="3186925">,</span>&nbsp;<span class="ident" id="3186927">a</span><span class="op" id="3186928">.</span><span class="ident" id="3186929">IP</span><span class="op" id="3186931">,</span>&nbsp;<span class="num" id="3186933">0</span><span class="op" id="3186934">,</span>&nbsp;<span class="ident" id="3186936">a</span><span class="op" id="3186937">.</span><span class="ident" id="3186938">Zone</span><span class="op" id="3186942">)</span><br>
<span class="lineno"></span><span class="op" id="3186944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3186947">//&nbsp;IPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3187017">//&nbsp;for&nbsp;IP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="3187048">type</span>&nbsp;<span class="ident" id="3187053">IPConn</span>&nbsp;<span class="keyword" id="3187060">struct</span>&nbsp;<span class="op" id="3187067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187070">conn</span><br>
<span class="lineno"></span><span class="op" id="3187075">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3187078">func</span>&nbsp;<span class="ident" id="3187083">newIPConn</span><span class="op" id="3187092">(</span><span class="ident" id="3187093">fd</span>&nbsp;<span class="op" id="3187096">*</span><span class="ident" id="3187097">netFD</span><span class="op" id="3187102">)</span>&nbsp;<span class="op" id="3187104">*</span><span class="ident" id="3187105">IPConn</span>&nbsp;<span class="op" id="3187112">{</span>&nbsp;<span class="keyword" id="3187114">return</span>&nbsp;<span class="op" id="3187121">&amp;</span><span class="ident" id="3187122">IPConn</span><span class="op" id="3187128">{</span><span class="ident" id="3187129">conn</span><span class="op" id="3187133">{</span><span class="ident" id="3187134">fd</span><span class="op" id="3187136">}</span><span class="op" id="3187137">}</span>&nbsp;<span class="op" id="3187139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3187142">//&nbsp;ReadFromIP&nbsp;reads&nbsp;an&nbsp;IP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3187211">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno">70</span><span class="comment" id="3187282">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3187309">//</span><br>
<span class="lineno"></span><span class="comment" id="3187312">//&nbsp;ReadFromIP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3187375">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3187442">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno">75</span><span class="keyword" id="3187462">func</span>&nbsp;<span class="op" id="3187467">(</span><span class="ident" id="3187468">c</span>&nbsp;<span class="op" id="3187470">*</span><span class="ident" id="3187471">IPConn</span><span class="op" id="3187477">)</span>&nbsp;<span class="ident" id="3187479">ReadFromIP</span><span class="op" id="3187489">(</span><span class="ident" id="3187490">b</span>&nbsp;<span class="op" id="3187492">[</span><span class="op" id="3187493">]</span><span class="builtintype" id="3187494">byte</span><span class="op" id="3187498">)</span>&nbsp;<span class="op" id="3187500">(</span><span class="builtintype" id="3187501">int</span><span class="op" id="3187504">,</span>&nbsp;<span class="op" id="3187506">*</span><span class="ident" id="3187507">IPAddr</span><span class="op" id="3187513">,</span>&nbsp;<span class="builtintype" id="3187515">error</span><span class="op" id="3187520">)</span>&nbsp;<span class="op" id="3187522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187525">if</span>&nbsp;<span class="op" id="3187528">!</span><span class="ident" id="3187529">c</span><span class="op" id="3187530">.</span><span class="ident" id="3187531">ok</span><span class="op" id="3187533">(</span><span class="op" id="3187534">)</span>&nbsp;<span class="op" id="3187536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187540">return</span>&nbsp;<span class="num" id="3187547">0</span><span class="op" id="3187548">,</span>&nbsp;<span class="ident" id="3187550">nil</span><span class="op" id="3187553">,</span>&nbsp;<span class="ident" id="3187555">syscall</span><span class="op" id="3187562">.</span><span class="ident" id="3187563">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3187574">//&nbsp;TODO(cw,rsc):&nbsp;consider&nbsp;using&nbsp;readv&nbsp;if&nbsp;we&nbsp;know&nbsp;the&nbsp;family</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3187635">//&nbsp;type&nbsp;to&nbsp;avoid&nbsp;the&nbsp;header&nbsp;trim/copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187674">var</span>&nbsp;<span class="ident" id="3187678">addr</span>&nbsp;<span class="op" id="3187683">*</span><span class="ident" id="3187684">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187692">n</span><span class="op" id="3187693">,</span>&nbsp;<span class="ident" id="3187695">sa</span><span class="op" id="3187697">,</span>&nbsp;<span class="ident" id="3187699">err</span>&nbsp;<span class="op" id="3187703">:=</span>&nbsp;<span class="ident" id="3187706">c</span><span class="op" id="3187707">.</span><span class="ident" id="3187708">fd</span><span class="op" id="3187710">.</span><span class="ident" id="3187711">readFrom</span><span class="op" id="3187719">(</span><span class="ident" id="3187720">b</span><span class="op" id="3187721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187724">switch</span>&nbsp;<span class="ident" id="3187731">sa</span>&nbsp;<span class="op" id="3187734">:=</span>&nbsp;<span class="ident" id="3187737">sa</span><span class="op" id="3187739">.</span><span class="op" id="3187740">(</span><span class="keyword" id="3187741">type</span><span class="op" id="3187745">)</span>&nbsp;<span class="op" id="3187747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187750">case</span>&nbsp;<span class="op" id="3187755">*</span><span class="ident" id="3187756">syscall</span><span class="op" id="3187763">.</span><span class="ident" id="3187764">SockaddrInet4</span><span class="op" id="3187777">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187781">addr</span>&nbsp;<span class="op" id="3187786">=</span>&nbsp;<span class="op" id="3187788">&amp;</span><span class="ident" id="3187789">IPAddr</span><span class="op" id="3187795">{</span><span class="ident" id="3187796">IP</span><span class="op" id="3187798">:</span>&nbsp;<span class="ident" id="3187800">sa</span><span class="op" id="3187802">.</span><span class="ident" id="3187803">Addr</span><span class="op" id="3187807">[</span><span class="num" id="3187808">0</span><span class="op" id="3187809">:</span><span class="op" id="3187810">]</span><span class="op" id="3187811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187815">if</span>&nbsp;<span class="builtinfunc" id="3187818">len</span><span class="op" id="3187821">(</span><span class="ident" id="3187822">b</span><span class="op" id="3187823">)</span>&nbsp;<span class="op" id="3187825">&gt;=</span>&nbsp;<span class="ident" id="3187828">IPv4len</span>&nbsp;<span class="op" id="3187836">{</span>&nbsp;<span class="comment" id="3187838">//&nbsp;discard&nbsp;ipv4&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187864">hsize</span>&nbsp;<span class="op" id="3187870">:=</span>&nbsp;<span class="op" id="3187873">(</span><span class="builtintype" id="3187874">int</span><span class="op" id="3187877">(</span><span class="ident" id="3187878">b</span><span class="op" id="3187879">[</span><span class="num" id="3187880">0</span><span class="op" id="3187881">]</span><span class="op" id="3187882">)</span>&nbsp;<span class="op" id="3187884">&amp;</span>&nbsp;<span class="num" id="3187886">0xf</span><span class="op" id="3187889">)</span>&nbsp;<span class="op" id="3187891">*</span>&nbsp;<span class="num" id="3187893">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3187898">copy</span><span class="op" id="3187902">(</span><span class="ident" id="3187903">b</span><span class="op" id="3187904">,</span>&nbsp;<span class="ident" id="3187906">b</span><span class="op" id="3187907">[</span><span class="ident" id="3187908">hsize</span><span class="op" id="3187913">:</span><span class="op" id="3187914">]</span><span class="op" id="3187915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187920">n</span>&nbsp;<span class="op" id="3187922">-=</span>&nbsp;<span class="ident" id="3187925">hsize</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187936">case</span>&nbsp;<span class="op" id="3187941">*</span><span class="ident" id="3187942">syscall</span><span class="op" id="3187949">.</span><span class="ident" id="3187950">SockaddrInet6</span><span class="op" id="3187963">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187967">addr</span>&nbsp;<span class="op" id="3187972">=</span>&nbsp;<span class="op" id="3187974">&amp;</span><span class="ident" id="3187975">IPAddr</span><span class="op" id="3187981">{</span><span class="ident" id="3187982">IP</span><span class="op" id="3187984">:</span>&nbsp;<span class="ident" id="3187986">sa</span><span class="op" id="3187988">.</span><span class="ident" id="3187989">Addr</span><span class="op" id="3187993">[</span><span class="num" id="3187994">0</span><span class="op" id="3187995">:</span><span class="op" id="3187996">]</span><span class="op" id="3187997">,</span>&nbsp;<span class="ident" id="3187999">Zone</span><span class="op" id="3188003">:</span>&nbsp;<span class="ident" id="3188005">zoneToString</span><span class="op" id="3188017">(</span><span class="builtintype" id="3188018">int</span><span class="op" id="3188021">(</span><span class="ident" id="3188022">sa</span><span class="op" id="3188024">.</span><span class="ident" id="3188025">ZoneId</span><span class="op" id="3188031">)</span><span class="op" id="3188032">)</span><span class="op" id="3188033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3188036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188039">return</span>&nbsp;<span class="ident" id="3188046">n</span><span class="op" id="3188047">,</span>&nbsp;<span class="ident" id="3188049">addr</span><span class="op" id="3188053">,</span>&nbsp;<span class="ident" id="3188055">err</span><br>
<span class="lineno">95</span><span class="op" id="3188059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3188062">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3188117">func</span>&nbsp;<span class="op" id="3188122">(</span><span class="ident" id="3188123">c</span>&nbsp;<span class="op" id="3188125">*</span><span class="ident" id="3188126">IPConn</span><span class="op" id="3188132">)</span>&nbsp;<span class="ident" id="3188134">ReadFrom</span><span class="op" id="3188142">(</span><span class="ident" id="3188143">b</span>&nbsp;<span class="op" id="3188145">[</span><span class="op" id="3188146">]</span><span class="builtintype" id="3188147">byte</span><span class="op" id="3188151">)</span>&nbsp;<span class="op" id="3188153">(</span><span class="builtintype" id="3188154">int</span><span class="op" id="3188157">,</span>&nbsp;<span class="ident" id="3188159">Addr</span><span class="op" id="3188163">,</span>&nbsp;<span class="builtintype" id="3188165">error</span><span class="op" id="3188170">)</span>&nbsp;<span class="op" id="3188172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188175">if</span>&nbsp;<span class="op" id="3188178">!</span><span class="ident" id="3188179">c</span><span class="op" id="3188180">.</span><span class="ident" id="3188181">ok</span><span class="op" id="3188183">(</span><span class="op" id="3188184">)</span>&nbsp;<span class="op" id="3188186">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188190">return</span>&nbsp;<span class="num" id="3188197">0</span><span class="op" id="3188198">,</span>&nbsp;<span class="ident" id="3188200">nil</span><span class="op" id="3188203">,</span>&nbsp;<span class="ident" id="3188205">syscall</span><span class="op" id="3188212">.</span><span class="ident" id="3188213">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3188221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3188224">n</span><span class="op" id="3188225">,</span>&nbsp;<span class="ident" id="3188227">addr</span><span class="op" id="3188231">,</span>&nbsp;<span class="ident" id="3188233">err</span>&nbsp;<span class="op" id="3188237">:=</span>&nbsp;<span class="ident" id="3188240">c</span><span class="op" id="3188241">.</span><span class="ident" id="3188242">ReadFromIP</span><span class="op" id="3188252">(</span><span class="ident" id="3188253">b</span><span class="op" id="3188254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188257">return</span>&nbsp;<span class="ident" id="3188264">n</span><span class="op" id="3188265">,</span>&nbsp;<span class="ident" id="3188267">addr</span><span class="op" id="3188271">.</span><span class="ident" id="3188272">toAddr</span><span class="op" id="3188278">(</span><span class="op" id="3188279">)</span><span class="op" id="3188280">,</span>&nbsp;<span class="ident" id="3188282">err</span><br>
<span class="lineno"></span><span class="op" id="3188286">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3188289">//&nbsp;ReadMsgIP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3188360">//&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3188427">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3188498">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno">110</span><span class="keyword" id="3188567">func</span>&nbsp;<span class="op" id="3188572">(</span><span class="ident" id="3188573">c</span>&nbsp;<span class="op" id="3188575">*</span><span class="ident" id="3188576">IPConn</span><span class="op" id="3188582">)</span>&nbsp;<span class="ident" id="3188584">ReadMsgIP</span><span class="op" id="3188593">(</span><span class="ident" id="3188594">b</span><span class="op" id="3188595">,</span>&nbsp;<span class="ident" id="3188597">oob</span>&nbsp;<span class="op" id="3188601">[</span><span class="op" id="3188602">]</span><span class="builtintype" id="3188603">byte</span><span class="op" id="3188607">)</span>&nbsp;<span class="op" id="3188609">(</span><span class="ident" id="3188610">n</span><span class="op" id="3188611">,</span>&nbsp;<span class="ident" id="3188613">oobn</span><span class="op" id="3188617">,</span>&nbsp;<span class="ident" id="3188619">flags</span>&nbsp;<span class="builtintype" id="3188625">int</span><span class="op" id="3188628">,</span>&nbsp;<span class="ident" id="3188630">addr</span>&nbsp;<span class="op" id="3188635">*</span><span class="ident" id="3188636">IPAddr</span><span class="op" id="3188642">,</span>&nbsp;<span class="ident" id="3188644">err</span>&nbsp;<span class="builtintype" id="3188648">error</span><span class="op" id="3188653">)</span>&nbsp;<span class="op" id="3188655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188658">if</span>&nbsp;<span class="op" id="3188661">!</span><span class="ident" id="3188662">c</span><span class="op" id="3188663">.</span><span class="ident" id="3188664">ok</span><span class="op" id="3188666">(</span><span class="op" id="3188667">)</span>&nbsp;<span class="op" id="3188669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188673">return</span>&nbsp;<span class="num" id="3188680">0</span><span class="op" id="3188681">,</span>&nbsp;<span class="num" id="3188683">0</span><span class="op" id="3188684">,</span>&nbsp;<span class="num" id="3188686">0</span><span class="op" id="3188687">,</span>&nbsp;<span class="ident" id="3188689">nil</span><span class="op" id="3188692">,</span>&nbsp;<span class="ident" id="3188694">syscall</span><span class="op" id="3188701">.</span><span class="ident" id="3188702">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3188710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188713">var</span>&nbsp;<span class="ident" id="3188717">sa</span>&nbsp;<span class="ident" id="3188720">syscall</span><span class="op" id="3188727">.</span><span class="ident" id="3188728">Sockaddr</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3188738">n</span><span class="op" id="3188739">,</span>&nbsp;<span class="ident" id="3188741">oobn</span><span class="op" id="3188745">,</span>&nbsp;<span class="ident" id="3188747">flags</span><span class="op" id="3188752">,</span>&nbsp;<span class="ident" id="3188754">sa</span><span class="op" id="3188756">,</span>&nbsp;<span class="ident" id="3188758">err</span>&nbsp;<span class="op" id="3188762">=</span>&nbsp;<span class="ident" id="3188764">c</span><span class="op" id="3188765">.</span><span class="ident" id="3188766">fd</span><span class="op" id="3188768">.</span><span class="ident" id="3188769">readMsg</span><span class="op" id="3188776">(</span><span class="ident" id="3188777">b</span><span class="op" id="3188778">,</span>&nbsp;<span class="ident" id="3188780">oob</span><span class="op" id="3188783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188786">switch</span>&nbsp;<span class="ident" id="3188793">sa</span>&nbsp;<span class="op" id="3188796">:=</span>&nbsp;<span class="ident" id="3188799">sa</span><span class="op" id="3188801">.</span><span class="op" id="3188802">(</span><span class="keyword" id="3188803">type</span><span class="op" id="3188807">)</span>&nbsp;<span class="op" id="3188809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188812">case</span>&nbsp;<span class="op" id="3188817">*</span><span class="ident" id="3188818">syscall</span><span class="op" id="3188825">.</span><span class="ident" id="3188826">SockaddrInet4</span><span class="op" id="3188839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3188843">addr</span>&nbsp;<span class="op" id="3188848">=</span>&nbsp;<span class="op" id="3188850">&amp;</span><span class="ident" id="3188851">IPAddr</span><span class="op" id="3188857">{</span><span class="ident" id="3188858">IP</span><span class="op" id="3188860">:</span>&nbsp;<span class="ident" id="3188862">sa</span><span class="op" id="3188864">.</span><span class="ident" id="3188865">Addr</span><span class="op" id="3188869">[</span><span class="num" id="3188870">0</span><span class="op" id="3188871">:</span><span class="op" id="3188872">]</span><span class="op" id="3188873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188876">case</span>&nbsp;<span class="op" id="3188881">*</span><span class="ident" id="3188882">syscall</span><span class="op" id="3188889">.</span><span class="ident" id="3188890">SockaddrInet6</span><span class="op" id="3188903">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3188907">addr</span>&nbsp;<span class="op" id="3188912">=</span>&nbsp;<span class="op" id="3188914">&amp;</span><span class="ident" id="3188915">IPAddr</span><span class="op" id="3188921">{</span><span class="ident" id="3188922">IP</span><span class="op" id="3188924">:</span>&nbsp;<span class="ident" id="3188926">sa</span><span class="op" id="3188928">.</span><span class="ident" id="3188929">Addr</span><span class="op" id="3188933">[</span><span class="num" id="3188934">0</span><span class="op" id="3188935">:</span><span class="op" id="3188936">]</span><span class="op" id="3188937">,</span>&nbsp;<span class="ident" id="3188939">Zone</span><span class="op" id="3188943">:</span>&nbsp;<span class="ident" id="3188945">zoneToString</span><span class="op" id="3188957">(</span><span class="builtintype" id="3188958">int</span><span class="op" id="3188961">(</span><span class="ident" id="3188962">sa</span><span class="op" id="3188964">.</span><span class="ident" id="3188965">ZoneId</span><span class="op" id="3188971">)</span><span class="op" id="3188972">)</span><span class="op" id="3188973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3188976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188979">return</span><br>
<span class="lineno"></span><span class="op" id="3188986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3188989">//&nbsp;WriteToIP&nbsp;writes&nbsp;an&nbsp;IP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3189057">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3189068">//</span><br>
<span class="lineno"></span><span class="comment" id="3189071">//&nbsp;WriteToIP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3189133">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">130</span><span class="comment" id="3189200">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3189269">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3189282">func</span>&nbsp;<span class="op" id="3189287">(</span><span class="ident" id="3189288">c</span>&nbsp;<span class="op" id="3189290">*</span><span class="ident" id="3189291">IPConn</span><span class="op" id="3189297">)</span>&nbsp;<span class="ident" id="3189299">WriteToIP</span><span class="op" id="3189308">(</span><span class="ident" id="3189309">b</span>&nbsp;<span class="op" id="3189311">[</span><span class="op" id="3189312">]</span><span class="builtintype" id="3189313">byte</span><span class="op" id="3189317">,</span>&nbsp;<span class="ident" id="3189319">addr</span>&nbsp;<span class="op" id="3189324">*</span><span class="ident" id="3189325">IPAddr</span><span class="op" id="3189331">)</span>&nbsp;<span class="op" id="3189333">(</span><span class="builtintype" id="3189334">int</span><span class="op" id="3189337">,</span>&nbsp;<span class="builtintype" id="3189339">error</span><span class="op" id="3189344">)</span>&nbsp;<span class="op" id="3189346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189349">if</span>&nbsp;<span class="op" id="3189352">!</span><span class="ident" id="3189353">c</span><span class="op" id="3189354">.</span><span class="ident" id="3189355">ok</span><span class="op" id="3189357">(</span><span class="op" id="3189358">)</span>&nbsp;<span class="op" id="3189360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189364">return</span>&nbsp;<span class="num" id="3189371">0</span><span class="op" id="3189372">,</span>&nbsp;<span class="ident" id="3189374">syscall</span><span class="op" id="3189381">.</span><span class="ident" id="3189382">EINVAL</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3189390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189393">if</span>&nbsp;<span class="ident" id="3189396">c</span><span class="op" id="3189397">.</span><span class="ident" id="3189398">fd</span><span class="op" id="3189400">.</span><span class="ident" id="3189401">isConnected</span>&nbsp;<span class="op" id="3189413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189417">return</span>&nbsp;<span class="num" id="3189424">0</span><span class="op" id="3189425">,</span>&nbsp;<span class="op" id="3189427">&amp;</span><span class="ident" id="3189428">OpError</span><span class="op" id="3189435">{</span><span class="ident" id="3189436">Op</span><span class="op" id="3189438">:</span>&nbsp;<span class="string" id="3189440">&#34;write&#34;</span><span class="op" id="3189447">,</span>&nbsp;<span class="ident" id="3189449">Net</span><span class="op" id="3189452">:</span>&nbsp;<span class="ident" id="3189454">c</span><span class="op" id="3189455">.</span><span class="ident" id="3189456">fd</span><span class="op" id="3189458">.</span><span class="ident" id="3189459">net</span><span class="op" id="3189462">,</span>&nbsp;<span class="ident" id="3189464">Addr</span><span class="op" id="3189468">:</span>&nbsp;<span class="ident" id="3189470">addr</span><span class="op" id="3189474">,</span>&nbsp;<span class="ident" id="3189476">Err</span><span class="op" id="3189479">:</span>&nbsp;<span class="ident" id="3189481">ErrWriteToConnected</span><span class="op" id="3189500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3189503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189506">if</span>&nbsp;<span class="ident" id="3189509">addr</span>&nbsp;<span class="op" id="3189514">==</span>&nbsp;<span class="ident" id="3189517">nil</span>&nbsp;<span class="op" id="3189521">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189525">return</span>&nbsp;<span class="num" id="3189532">0</span><span class="op" id="3189533">,</span>&nbsp;<span class="op" id="3189535">&amp;</span><span class="ident" id="3189536">OpError</span><span class="op" id="3189543">{</span><span class="ident" id="3189544">Op</span><span class="op" id="3189546">:</span>&nbsp;<span class="string" id="3189548">&#34;write&#34;</span><span class="op" id="3189555">,</span>&nbsp;<span class="ident" id="3189557">Net</span><span class="op" id="3189560">:</span>&nbsp;<span class="ident" id="3189562">c</span><span class="op" id="3189563">.</span><span class="ident" id="3189564">fd</span><span class="op" id="3189566">.</span><span class="ident" id="3189567">net</span><span class="op" id="3189570">,</span>&nbsp;<span class="ident" id="3189572">Addr</span><span class="op" id="3189576">:</span>&nbsp;<span class="ident" id="3189578">nil</span><span class="op" id="3189581">,</span>&nbsp;<span class="ident" id="3189583">Err</span><span class="op" id="3189586">:</span>&nbsp;<span class="ident" id="3189588">errMissingAddress</span><span class="op" id="3189605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3189608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189611">sa</span><span class="op" id="3189613">,</span>&nbsp;<span class="ident" id="3189615">err</span>&nbsp;<span class="op" id="3189619">:=</span>&nbsp;<span class="ident" id="3189622">addr</span><span class="op" id="3189626">.</span><span class="ident" id="3189627">sockaddr</span><span class="op" id="3189635">(</span><span class="ident" id="3189636">c</span><span class="op" id="3189637">.</span><span class="ident" id="3189638">fd</span><span class="op" id="3189640">.</span><span class="ident" id="3189641">family</span><span class="op" id="3189647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189650">if</span>&nbsp;<span class="ident" id="3189653">err</span>&nbsp;<span class="op" id="3189657">!=</span>&nbsp;<span class="ident" id="3189660">nil</span>&nbsp;<span class="op" id="3189664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189668">return</span>&nbsp;<span class="num" id="3189675">0</span><span class="op" id="3189676">,</span>&nbsp;<span class="op" id="3189678">&amp;</span><span class="ident" id="3189679">OpError</span><span class="op" id="3189686">{</span><span class="string" id="3189687">&#34;write&#34;</span><span class="op" id="3189694">,</span>&nbsp;<span class="ident" id="3189696">c</span><span class="op" id="3189697">.</span><span class="ident" id="3189698">fd</span><span class="op" id="3189700">.</span><span class="ident" id="3189701">net</span><span class="op" id="3189704">,</span>&nbsp;<span class="ident" id="3189706">addr</span><span class="op" id="3189710">,</span>&nbsp;<span class="ident" id="3189712">err</span><span class="op" id="3189715">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3189718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189721">return</span>&nbsp;<span class="ident" id="3189728">c</span><span class="op" id="3189729">.</span><span class="ident" id="3189730">fd</span><span class="op" id="3189732">.</span><span class="ident" id="3189733">writeTo</span><span class="op" id="3189740">(</span><span class="ident" id="3189741">b</span><span class="op" id="3189742">,</span>&nbsp;<span class="ident" id="3189744">sa</span><span class="op" id="3189746">)</span><br>
<span class="lineno"></span><span class="op" id="3189748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3189751">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno">150</span><span class="keyword" id="3189804">func</span>&nbsp;<span class="op" id="3189809">(</span><span class="ident" id="3189810">c</span>&nbsp;<span class="op" id="3189812">*</span><span class="ident" id="3189813">IPConn</span><span class="op" id="3189819">)</span>&nbsp;<span class="ident" id="3189821">WriteTo</span><span class="op" id="3189828">(</span><span class="ident" id="3189829">b</span>&nbsp;<span class="op" id="3189831">[</span><span class="op" id="3189832">]</span><span class="builtintype" id="3189833">byte</span><span class="op" id="3189837">,</span>&nbsp;<span class="ident" id="3189839">addr</span>&nbsp;<span class="ident" id="3189844">Addr</span><span class="op" id="3189848">)</span>&nbsp;<span class="op" id="3189850">(</span><span class="builtintype" id="3189851">int</span><span class="op" id="3189854">,</span>&nbsp;<span class="builtintype" id="3189856">error</span><span class="op" id="3189861">)</span>&nbsp;<span class="op" id="3189863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189866">if</span>&nbsp;<span class="op" id="3189869">!</span><span class="ident" id="3189870">c</span><span class="op" id="3189871">.</span><span class="ident" id="3189872">ok</span><span class="op" id="3189874">(</span><span class="op" id="3189875">)</span>&nbsp;<span class="op" id="3189877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189881">return</span>&nbsp;<span class="num" id="3189888">0</span><span class="op" id="3189889">,</span>&nbsp;<span class="ident" id="3189891">syscall</span><span class="op" id="3189898">.</span><span class="ident" id="3189899">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3189907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189910">a</span><span class="op" id="3189911">,</span>&nbsp;<span class="ident" id="3189913">ok</span>&nbsp;<span class="op" id="3189916">:=</span>&nbsp;<span class="ident" id="3189919">addr</span><span class="op" id="3189923">.</span><span class="op" id="3189924">(</span><span class="op" id="3189925">*</span><span class="ident" id="3189926">IPAddr</span><span class="op" id="3189932">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189935">if</span>&nbsp;<span class="op" id="3189938">!</span><span class="ident" id="3189939">ok</span>&nbsp;<span class="op" id="3189942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189946">return</span>&nbsp;<span class="num" id="3189953">0</span><span class="op" id="3189954">,</span>&nbsp;<span class="op" id="3189956">&amp;</span><span class="ident" id="3189957">OpError</span><span class="op" id="3189964">{</span><span class="string" id="3189965">&#34;write&#34;</span><span class="op" id="3189972">,</span>&nbsp;<span class="ident" id="3189974">c</span><span class="op" id="3189975">.</span><span class="ident" id="3189976">fd</span><span class="op" id="3189978">.</span><span class="ident" id="3189979">net</span><span class="op" id="3189982">,</span>&nbsp;<span class="ident" id="3189984">addr</span><span class="op" id="3189988">,</span>&nbsp;<span class="ident" id="3189990">syscall</span><span class="op" id="3189997">.</span><span class="ident" id="3189998">EINVAL</span><span class="op" id="3190004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190010">return</span>&nbsp;<span class="ident" id="3190017">c</span><span class="op" id="3190018">.</span><span class="ident" id="3190019">WriteToIP</span><span class="op" id="3190028">(</span><span class="ident" id="3190029">b</span><span class="op" id="3190030">,</span>&nbsp;<span class="ident" id="3190032">a</span><span class="op" id="3190033">)</span><br>
<span class="lineno"></span><span class="op" id="3190035">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="3190038">//&nbsp;WriteMsgIP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3190108">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3190175">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="3190227">func</span>&nbsp;<span class="op" id="3190232">(</span><span class="ident" id="3190233">c</span>&nbsp;<span class="op" id="3190235">*</span><span class="ident" id="3190236">IPConn</span><span class="op" id="3190242">)</span>&nbsp;<span class="ident" id="3190244">WriteMsgIP</span><span class="op" id="3190254">(</span><span class="ident" id="3190255">b</span><span class="op" id="3190256">,</span>&nbsp;<span class="ident" id="3190258">oob</span>&nbsp;<span class="op" id="3190262">[</span><span class="op" id="3190263">]</span><span class="builtintype" id="3190264">byte</span><span class="op" id="3190268">,</span>&nbsp;<span class="ident" id="3190270">addr</span>&nbsp;<span class="op" id="3190275">*</span><span class="ident" id="3190276">IPAddr</span><span class="op" id="3190282">)</span>&nbsp;<span class="op" id="3190284">(</span><span class="ident" id="3190285">n</span><span class="op" id="3190286">,</span>&nbsp;<span class="ident" id="3190288">oobn</span>&nbsp;<span class="builtintype" id="3190293">int</span><span class="op" id="3190296">,</span>&nbsp;<span class="ident" id="3190298">err</span>&nbsp;<span class="builtintype" id="3190302">error</span><span class="op" id="3190307">)</span>&nbsp;<span class="op" id="3190309">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190312">if</span>&nbsp;<span class="op" id="3190315">!</span><span class="ident" id="3190316">c</span><span class="op" id="3190317">.</span><span class="ident" id="3190318">ok</span><span class="op" id="3190320">(</span><span class="op" id="3190321">)</span>&nbsp;<span class="op" id="3190323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190327">return</span>&nbsp;<span class="num" id="3190334">0</span><span class="op" id="3190335">,</span>&nbsp;<span class="num" id="3190337">0</span><span class="op" id="3190338">,</span>&nbsp;<span class="ident" id="3190340">syscall</span><span class="op" id="3190347">.</span><span class="ident" id="3190348">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190359">if</span>&nbsp;<span class="ident" id="3190362">c</span><span class="op" id="3190363">.</span><span class="ident" id="3190364">fd</span><span class="op" id="3190366">.</span><span class="ident" id="3190367">isConnected</span>&nbsp;<span class="op" id="3190379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190383">return</span>&nbsp;<span class="num" id="3190390">0</span><span class="op" id="3190391">,</span>&nbsp;<span class="num" id="3190393">0</span><span class="op" id="3190394">,</span>&nbsp;<span class="op" id="3190396">&amp;</span><span class="ident" id="3190397">OpError</span><span class="op" id="3190404">{</span><span class="ident" id="3190405">Op</span><span class="op" id="3190407">:</span>&nbsp;<span class="string" id="3190409">&#34;write&#34;</span><span class="op" id="3190416">,</span>&nbsp;<span class="ident" id="3190418">Net</span><span class="op" id="3190421">:</span>&nbsp;<span class="ident" id="3190423">c</span><span class="op" id="3190424">.</span><span class="ident" id="3190425">fd</span><span class="op" id="3190427">.</span><span class="ident" id="3190428">net</span><span class="op" id="3190431">,</span>&nbsp;<span class="ident" id="3190433">Addr</span><span class="op" id="3190437">:</span>&nbsp;<span class="ident" id="3190439">addr</span><span class="op" id="3190443">,</span>&nbsp;<span class="ident" id="3190445">Err</span><span class="op" id="3190448">:</span>&nbsp;<span class="ident" id="3190450">ErrWriteToConnected</span><span class="op" id="3190469">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190475">if</span>&nbsp;<span class="ident" id="3190478">addr</span>&nbsp;<span class="op" id="3190483">==</span>&nbsp;<span class="ident" id="3190486">nil</span>&nbsp;<span class="op" id="3190490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190494">return</span>&nbsp;<span class="num" id="3190501">0</span><span class="op" id="3190502">,</span>&nbsp;<span class="num" id="3190504">0</span><span class="op" id="3190505">,</span>&nbsp;<span class="op" id="3190507">&amp;</span><span class="ident" id="3190508">OpError</span><span class="op" id="3190515">{</span><span class="ident" id="3190516">Op</span><span class="op" id="3190518">:</span>&nbsp;<span class="string" id="3190520">&#34;write&#34;</span><span class="op" id="3190527">,</span>&nbsp;<span class="ident" id="3190529">Net</span><span class="op" id="3190532">:</span>&nbsp;<span class="ident" id="3190534">c</span><span class="op" id="3190535">.</span><span class="ident" id="3190536">fd</span><span class="op" id="3190538">.</span><span class="ident" id="3190539">net</span><span class="op" id="3190542">,</span>&nbsp;<span class="ident" id="3190544">Addr</span><span class="op" id="3190548">:</span>&nbsp;<span class="ident" id="3190550">nil</span><span class="op" id="3190553">,</span>&nbsp;<span class="ident" id="3190555">Err</span><span class="op" id="3190558">:</span>&nbsp;<span class="ident" id="3190560">errMissingAddress</span><span class="op" id="3190577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190583">sa</span><span class="op" id="3190585">,</span>&nbsp;<span class="ident" id="3190587">err</span>&nbsp;<span class="op" id="3190591">:=</span>&nbsp;<span class="ident" id="3190594">addr</span><span class="op" id="3190598">.</span><span class="ident" id="3190599">sockaddr</span><span class="op" id="3190607">(</span><span class="ident" id="3190608">c</span><span class="op" id="3190609">.</span><span class="ident" id="3190610">fd</span><span class="op" id="3190612">.</span><span class="ident" id="3190613">family</span><span class="op" id="3190619">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190622">if</span>&nbsp;<span class="ident" id="3190625">err</span>&nbsp;<span class="op" id="3190629">!=</span>&nbsp;<span class="ident" id="3190632">nil</span>&nbsp;<span class="op" id="3190636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190640">return</span>&nbsp;<span class="num" id="3190647">0</span><span class="op" id="3190648">,</span>&nbsp;<span class="num" id="3190650">0</span><span class="op" id="3190651">,</span>&nbsp;<span class="op" id="3190653">&amp;</span><span class="ident" id="3190654">OpError</span><span class="op" id="3190661">{</span><span class="string" id="3190662">&#34;write&#34;</span><span class="op" id="3190669">,</span>&nbsp;<span class="ident" id="3190671">c</span><span class="op" id="3190672">.</span><span class="ident" id="3190673">fd</span><span class="op" id="3190675">.</span><span class="ident" id="3190676">net</span><span class="op" id="3190679">,</span>&nbsp;<span class="ident" id="3190681">addr</span><span class="op" id="3190685">,</span>&nbsp;<span class="ident" id="3190687">err</span><span class="op" id="3190690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190696">return</span>&nbsp;<span class="ident" id="3190703">c</span><span class="op" id="3190704">.</span><span class="ident" id="3190705">fd</span><span class="op" id="3190707">.</span><span class="ident" id="3190708">writeMsg</span><span class="op" id="3190716">(</span><span class="ident" id="3190717">b</span><span class="op" id="3190718">,</span>&nbsp;<span class="ident" id="3190720">oob</span><span class="op" id="3190723">,</span>&nbsp;<span class="ident" id="3190725">sa</span><span class="op" id="3190727">)</span><br>
<span class="lineno"></span><span class="op" id="3190729">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="comment" id="3190732">//&nbsp;DialIP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;protocol</span><br>
<span class="lineno"></span><span class="comment" id="3190803">//&nbsp;netProto,&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon</span><br>
<span class="lineno"></span><span class="comment" id="3190872">//&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3190906">func</span>&nbsp;<span class="ident" id="3190911">DialIP</span><span class="op" id="3190917">(</span><span class="ident" id="3190918">netProto</span>&nbsp;<span class="builtintype" id="3190927">string</span><span class="op" id="3190933">,</span>&nbsp;<span class="ident" id="3190935">laddr</span><span class="op" id="3190940">,</span>&nbsp;<span class="ident" id="3190942">raddr</span>&nbsp;<span class="op" id="3190948">*</span><span class="ident" id="3190949">IPAddr</span><span class="op" id="3190955">)</span>&nbsp;<span class="op" id="3190957">(</span><span class="op" id="3190958">*</span><span class="ident" id="3190959">IPConn</span><span class="op" id="3190965">,</span>&nbsp;<span class="builtintype" id="3190967">error</span><span class="op" id="3190972">)</span>&nbsp;<span class="op" id="3190974">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190977">return</span>&nbsp;<span class="ident" id="3190984">dialIP</span><span class="op" id="3190990">(</span><span class="ident" id="3190991">netProto</span><span class="op" id="3190999">,</span>&nbsp;<span class="ident" id="3191001">laddr</span><span class="op" id="3191006">,</span>&nbsp;<span class="ident" id="3191008">raddr</span><span class="op" id="3191013">,</span>&nbsp;<span class="ident" id="3191015">noDeadline</span><span class="op" id="3191025">)</span><br>
<span class="lineno"></span><span class="op" id="3191027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3191030">func</span>&nbsp;<span class="ident" id="3191035">dialIP</span><span class="op" id="3191041">(</span><span class="ident" id="3191042">netProto</span>&nbsp;<span class="builtintype" id="3191051">string</span><span class="op" id="3191057">,</span>&nbsp;<span class="ident" id="3191059">laddr</span><span class="op" id="3191064">,</span>&nbsp;<span class="ident" id="3191066">raddr</span>&nbsp;<span class="op" id="3191072">*</span><span class="ident" id="3191073">IPAddr</span><span class="op" id="3191079">,</span>&nbsp;<span class="ident" id="3191081">deadline</span>&nbsp;<span class="ident" id="3191090">time</span><span class="op" id="3191094">.</span><span class="ident" id="3191095">Time</span><span class="op" id="3191099">)</span>&nbsp;<span class="op" id="3191101">(</span><span class="op" id="3191102">*</span><span class="ident" id="3191103">IPConn</span><span class="op" id="3191109">,</span>&nbsp;<span class="builtintype" id="3191111">error</span><span class="op" id="3191116">)</span>&nbsp;<span class="op" id="3191118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191121">net</span><span class="op" id="3191124">,</span>&nbsp;<span class="ident" id="3191126">proto</span><span class="op" id="3191131">,</span>&nbsp;<span class="ident" id="3191133">err</span>&nbsp;<span class="op" id="3191137">:=</span>&nbsp;<span class="ident" id="3191140">parseNetwork</span><span class="op" id="3191152">(</span><span class="ident" id="3191153">netProto</span><span class="op" id="3191161">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191164">if</span>&nbsp;<span class="ident" id="3191167">err</span>&nbsp;<span class="op" id="3191171">!=</span>&nbsp;<span class="ident" id="3191174">nil</span>&nbsp;<span class="op" id="3191178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191182">return</span>&nbsp;<span class="ident" id="3191189">nil</span><span class="op" id="3191192">,</span>&nbsp;<span class="op" id="3191194">&amp;</span><span class="ident" id="3191195">OpError</span><span class="op" id="3191202">{</span><span class="ident" id="3191203">Op</span><span class="op" id="3191205">:</span>&nbsp;<span class="string" id="3191207">&#34;dial&#34;</span><span class="op" id="3191213">,</span>&nbsp;<span class="ident" id="3191215">Net</span><span class="op" id="3191218">:</span>&nbsp;<span class="ident" id="3191220">netProto</span><span class="op" id="3191228">,</span>&nbsp;<span class="ident" id="3191230">Addr</span><span class="op" id="3191234">:</span>&nbsp;<span class="ident" id="3191236">raddr</span><span class="op" id="3191241">,</span>&nbsp;<span class="ident" id="3191243">Err</span><span class="op" id="3191246">:</span>&nbsp;<span class="ident" id="3191248">err</span><span class="op" id="3191251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191257">switch</span>&nbsp;<span class="ident" id="3191264">net</span>&nbsp;<span class="op" id="3191268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191271">case</span>&nbsp;<span class="string" id="3191276">&#34;ip&#34;</span><span class="op" id="3191280">,</span>&nbsp;<span class="string" id="3191282">&#34;ip4&#34;</span><span class="op" id="3191287">,</span>&nbsp;<span class="string" id="3191289">&#34;ip6&#34;</span><span class="op" id="3191294">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191297">default</span><span class="op" id="3191304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191308">return</span>&nbsp;<span class="ident" id="3191315">nil</span><span class="op" id="3191318">,</span>&nbsp;<span class="op" id="3191320">&amp;</span><span class="ident" id="3191321">OpError</span><span class="op" id="3191328">{</span><span class="ident" id="3191329">Op</span><span class="op" id="3191331">:</span>&nbsp;<span class="string" id="3191333">&#34;dial&#34;</span><span class="op" id="3191339">,</span>&nbsp;<span class="ident" id="3191341">Net</span><span class="op" id="3191344">:</span>&nbsp;<span class="ident" id="3191346">netProto</span><span class="op" id="3191354">,</span>&nbsp;<span class="ident" id="3191356">Addr</span><span class="op" id="3191360">:</span>&nbsp;<span class="ident" id="3191362">raddr</span><span class="op" id="3191367">,</span>&nbsp;<span class="ident" id="3191369">Err</span><span class="op" id="3191372">:</span>&nbsp;<span class="ident" id="3191374">UnknownNetworkError</span><span class="op" id="3191393">(</span><span class="ident" id="3191394">netProto</span><span class="op" id="3191402">)</span><span class="op" id="3191403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191409">if</span>&nbsp;<span class="ident" id="3191412">raddr</span>&nbsp;<span class="op" id="3191418">==</span>&nbsp;<span class="ident" id="3191421">nil</span>&nbsp;<span class="op" id="3191425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191429">return</span>&nbsp;<span class="ident" id="3191436">nil</span><span class="op" id="3191439">,</span>&nbsp;<span class="op" id="3191441">&amp;</span><span class="ident" id="3191442">OpError</span><span class="op" id="3191449">{</span><span class="ident" id="3191450">Op</span><span class="op" id="3191452">:</span>&nbsp;<span class="string" id="3191454">&#34;dial&#34;</span><span class="op" id="3191460">,</span>&nbsp;<span class="ident" id="3191462">Net</span><span class="op" id="3191465">:</span>&nbsp;<span class="ident" id="3191467">netProto</span><span class="op" id="3191475">,</span>&nbsp;<span class="ident" id="3191477">Addr</span><span class="op" id="3191481">:</span>&nbsp;<span class="ident" id="3191483">nil</span><span class="op" id="3191486">,</span>&nbsp;<span class="ident" id="3191488">Err</span><span class="op" id="3191491">:</span>&nbsp;<span class="ident" id="3191493">errMissingAddress</span><span class="op" id="3191510">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191516">fd</span><span class="op" id="3191518">,</span>&nbsp;<span class="ident" id="3191520">err</span>&nbsp;<span class="op" id="3191524">:=</span>&nbsp;<span class="ident" id="3191527">internetSocket</span><span class="op" id="3191541">(</span><span class="ident" id="3191542">net</span><span class="op" id="3191545">,</span>&nbsp;<span class="ident" id="3191547">laddr</span><span class="op" id="3191552">,</span>&nbsp;<span class="ident" id="3191554">raddr</span><span class="op" id="3191559">,</span>&nbsp;<span class="ident" id="3191561">deadline</span><span class="op" id="3191569">,</span>&nbsp;<span class="ident" id="3191571">syscall</span><span class="op" id="3191578">.</span><span class="ident" id="3191579">SOCK_RAW</span><span class="op" id="3191587">,</span>&nbsp;<span class="ident" id="3191589">proto</span><span class="op" id="3191594">,</span>&nbsp;<span class="string" id="3191596">&#34;dial&#34;</span><span class="op" id="3191602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191605">if</span>&nbsp;<span class="ident" id="3191608">err</span>&nbsp;<span class="op" id="3191612">!=</span>&nbsp;<span class="ident" id="3191615">nil</span>&nbsp;<span class="op" id="3191619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191623">return</span>&nbsp;<span class="ident" id="3191630">nil</span><span class="op" id="3191633">,</span>&nbsp;<span class="op" id="3191635">&amp;</span><span class="ident" id="3191636">OpError</span><span class="op" id="3191643">{</span><span class="ident" id="3191644">Op</span><span class="op" id="3191646">:</span>&nbsp;<span class="string" id="3191648">&#34;dial&#34;</span><span class="op" id="3191654">,</span>&nbsp;<span class="ident" id="3191656">Net</span><span class="op" id="3191659">:</span>&nbsp;<span class="ident" id="3191661">netProto</span><span class="op" id="3191669">,</span>&nbsp;<span class="ident" id="3191671">Addr</span><span class="op" id="3191675">:</span>&nbsp;<span class="ident" id="3191677">raddr</span><span class="op" id="3191682">,</span>&nbsp;<span class="ident" id="3191684">Err</span><span class="op" id="3191687">:</span>&nbsp;<span class="ident" id="3191689">err</span><span class="op" id="3191692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191695">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191698">return</span>&nbsp;<span class="ident" id="3191705">newIPConn</span><span class="op" id="3191714">(</span><span class="ident" id="3191715">fd</span><span class="op" id="3191717">)</span><span class="op" id="3191718">,</span>&nbsp;<span class="ident" id="3191720">nil</span><br>
<span class="lineno"></span><span class="op" id="3191724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3191727">//&nbsp;ListenIP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;IP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3191794">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">210</span><span class="comment" id="3191860">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;IP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3191930">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3191945">func</span>&nbsp;<span class="ident" id="3191950">ListenIP</span><span class="op" id="3191958">(</span><span class="ident" id="3191959">netProto</span>&nbsp;<span class="builtintype" id="3191968">string</span><span class="op" id="3191974">,</span>&nbsp;<span class="ident" id="3191976">laddr</span>&nbsp;<span class="op" id="3191982">*</span><span class="ident" id="3191983">IPAddr</span><span class="op" id="3191989">)</span>&nbsp;<span class="op" id="3191991">(</span><span class="op" id="3191992">*</span><span class="ident" id="3191993">IPConn</span><span class="op" id="3191999">,</span>&nbsp;<span class="builtintype" id="3192001">error</span><span class="op" id="3192006">)</span>&nbsp;<span class="op" id="3192008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192011">net</span><span class="op" id="3192014">,</span>&nbsp;<span class="ident" id="3192016">proto</span><span class="op" id="3192021">,</span>&nbsp;<span class="ident" id="3192023">err</span>&nbsp;<span class="op" id="3192027">:=</span>&nbsp;<span class="ident" id="3192030">parseNetwork</span><span class="op" id="3192042">(</span><span class="ident" id="3192043">netProto</span><span class="op" id="3192051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192054">if</span>&nbsp;<span class="ident" id="3192057">err</span>&nbsp;<span class="op" id="3192061">!=</span>&nbsp;<span class="ident" id="3192064">nil</span>&nbsp;<span class="op" id="3192068">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192072">return</span>&nbsp;<span class="ident" id="3192079">nil</span><span class="op" id="3192082">,</span>&nbsp;<span class="op" id="3192084">&amp;</span><span class="ident" id="3192085">OpError</span><span class="op" id="3192092">{</span><span class="ident" id="3192093">Op</span><span class="op" id="3192095">:</span>&nbsp;<span class="string" id="3192097">&#34;dial&#34;</span><span class="op" id="3192103">,</span>&nbsp;<span class="ident" id="3192105">Net</span><span class="op" id="3192108">:</span>&nbsp;<span class="ident" id="3192110">netProto</span><span class="op" id="3192118">,</span>&nbsp;<span class="ident" id="3192120">Addr</span><span class="op" id="3192124">:</span>&nbsp;<span class="ident" id="3192126">laddr</span><span class="op" id="3192131">,</span>&nbsp;<span class="ident" id="3192133">Err</span><span class="op" id="3192136">:</span>&nbsp;<span class="ident" id="3192138">err</span><span class="op" id="3192141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3192144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192147">switch</span>&nbsp;<span class="ident" id="3192154">net</span>&nbsp;<span class="op" id="3192158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192161">case</span>&nbsp;<span class="string" id="3192166">&#34;ip&#34;</span><span class="op" id="3192170">,</span>&nbsp;<span class="string" id="3192172">&#34;ip4&#34;</span><span class="op" id="3192177">,</span>&nbsp;<span class="string" id="3192179">&#34;ip6&#34;</span><span class="op" id="3192184">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192187">default</span><span class="op" id="3192194">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192198">return</span>&nbsp;<span class="ident" id="3192205">nil</span><span class="op" id="3192208">,</span>&nbsp;<span class="op" id="3192210">&amp;</span><span class="ident" id="3192211">OpError</span><span class="op" id="3192218">{</span><span class="ident" id="3192219">Op</span><span class="op" id="3192221">:</span>&nbsp;<span class="string" id="3192223">&#34;listen&#34;</span><span class="op" id="3192231">,</span>&nbsp;<span class="ident" id="3192233">Net</span><span class="op" id="3192236">:</span>&nbsp;<span class="ident" id="3192238">netProto</span><span class="op" id="3192246">,</span>&nbsp;<span class="ident" id="3192248">Addr</span><span class="op" id="3192252">:</span>&nbsp;<span class="ident" id="3192254">laddr</span><span class="op" id="3192259">,</span>&nbsp;<span class="ident" id="3192261">Err</span><span class="op" id="3192264">:</span>&nbsp;<span class="ident" id="3192266">UnknownNetworkError</span><span class="op" id="3192285">(</span><span class="ident" id="3192286">netProto</span><span class="op" id="3192294">)</span><span class="op" id="3192295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3192298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192301">fd</span><span class="op" id="3192303">,</span>&nbsp;<span class="ident" id="3192305">err</span>&nbsp;<span class="op" id="3192309">:=</span>&nbsp;<span class="ident" id="3192312">internetSocket</span><span class="op" id="3192326">(</span><span class="ident" id="3192327">net</span><span class="op" id="3192330">,</span>&nbsp;<span class="ident" id="3192332">laddr</span><span class="op" id="3192337">,</span>&nbsp;<span class="ident" id="3192339">nil</span><span class="op" id="3192342">,</span>&nbsp;<span class="ident" id="3192344">noDeadline</span><span class="op" id="3192354">,</span>&nbsp;<span class="ident" id="3192356">syscall</span><span class="op" id="3192363">.</span><span class="ident" id="3192364">SOCK_RAW</span><span class="op" id="3192372">,</span>&nbsp;<span class="ident" id="3192374">proto</span><span class="op" id="3192379">,</span>&nbsp;<span class="string" id="3192381">&#34;listen&#34;</span><span class="op" id="3192389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192392">if</span>&nbsp;<span class="ident" id="3192395">err</span>&nbsp;<span class="op" id="3192399">!=</span>&nbsp;<span class="ident" id="3192402">nil</span>&nbsp;<span class="op" id="3192406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192410">return</span>&nbsp;<span class="ident" id="3192417">nil</span><span class="op" id="3192420">,</span>&nbsp;<span class="op" id="3192422">&amp;</span><span class="ident" id="3192423">OpError</span><span class="op" id="3192430">{</span><span class="ident" id="3192431">Op</span><span class="op" id="3192433">:</span>&nbsp;<span class="string" id="3192435">&#34;listen&#34;</span><span class="op" id="3192443">,</span>&nbsp;<span class="ident" id="3192445">Net</span><span class="op" id="3192448">:</span>&nbsp;<span class="ident" id="3192450">netProto</span><span class="op" id="3192458">,</span>&nbsp;<span class="ident" id="3192460">Addr</span><span class="op" id="3192464">:</span>&nbsp;<span class="ident" id="3192466">laddr</span><span class="op" id="3192471">,</span>&nbsp;<span class="ident" id="3192473">Err</span><span class="op" id="3192476">:</span>&nbsp;<span class="ident" id="3192478">err</span><span class="op" id="3192481">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3192484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192487">return</span>&nbsp;<span class="ident" id="3192494">newIPConn</span><span class="op" id="3192503">(</span><span class="ident" id="3192504">fd</span><span class="op" id="3192506">)</span><span class="op" id="3192507">,</span>&nbsp;<span class="ident" id="3192509">nil</span><br>
<span class="lineno"></span><span class="op" id="3192513">}</span>
</div>
</body>
</html>
