<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html" class="current">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6678870">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6678926">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6678980">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6679031">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="6679110">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6679119">package</span>&nbsp;<span class="ident" id="6679127">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6679132">import</span>&nbsp;<span class="op" id="6679139">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6679142">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6679148">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6679159">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6679170">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6679181">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6679188">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6679191">func</span>&nbsp;<span class="ident" id="6679196">packetConnTestData</span><span class="op" id="6679214">(</span><span class="ident" id="6679215">t</span>&nbsp;<span class="op" id="6679217">*</span><span class="ident" id="6679218">testing</span><span class="op" id="6679225">.</span><span class="ident" id="6679226">T</span><span class="op" id="6679227">,</span>&nbsp;<span class="ident" id="6679229">net</span>&nbsp;<span class="builtintype" id="6679233">string</span><span class="op" id="6679239">,</span>&nbsp;<span class="ident" id="6679241">i</span>&nbsp;<span class="builtintype" id="6679243">int</span><span class="op" id="6679246">)</span>&nbsp;<span class="op" id="6679248">(</span><span class="op" id="6679249">[</span><span class="op" id="6679250">]</span><span class="builtintype" id="6679251">byte</span><span class="op" id="6679255">,</span>&nbsp;<span class="keyword" id="6679257">func</span><span class="op" id="6679261">(</span><span class="op" id="6679262">)</span><span class="op" id="6679263">)</span>&nbsp;<span class="op" id="6679265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679268">switch</span>&nbsp;<span class="ident" id="6679275">net</span>&nbsp;<span class="op" id="6679279">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679282">case</span>&nbsp;<span class="string" id="6679287">&#34;udp&#34;</span><span class="op" id="6679292">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679296">return</span>&nbsp;<span class="op" id="6679303">[</span><span class="op" id="6679304">]</span><span class="builtintype" id="6679305">byte</span><span class="op" id="6679309">(</span><span class="string" id="6679310">&#34;UDP&nbsp;PACKETCONN&nbsp;TEST&#34;</span><span class="op" id="6679331">)</span><span class="op" id="6679332">,</span>&nbsp;<span class="ident" id="6679334">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679339">case</span>&nbsp;<span class="string" id="6679344">&#34;ip&#34;</span><span class="op" id="6679348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679352">if</span>&nbsp;<span class="ident" id="6679355">skip</span><span class="op" id="6679359">,</span>&nbsp;<span class="ident" id="6679361">skipmsg</span>&nbsp;<span class="op" id="6679369">:=</span>&nbsp;<span class="ident" id="6679372">skipRawSocketTest</span><span class="op" id="6679389">(</span><span class="ident" id="6679390">t</span><span class="op" id="6679391">)</span><span class="op" id="6679392">;</span>&nbsp;<span class="ident" id="6679394">skip</span>&nbsp;<span class="op" id="6679399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679404">return</span>&nbsp;<span class="ident" id="6679411">nil</span><span class="op" id="6679414">,</span>&nbsp;<span class="keyword" id="6679416">func</span><span class="op" id="6679420">(</span><span class="op" id="6679421">)</span>&nbsp;<span class="op" id="6679423">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679429">t</span><span class="op" id="6679430">.</span><span class="ident" id="6679431">Logf</span><span class="op" id="6679435">(</span><span class="ident" id="6679436">skipmsg</span><span class="op" id="6679443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679456">b</span><span class="op" id="6679457">,</span>&nbsp;<span class="ident" id="6679459">err</span>&nbsp;<span class="op" id="6679463">:=</span>&nbsp;<span class="op" id="6679466">(</span><span class="op" id="6679467">&amp;</span><span class="ident" id="6679468">icmpMessage</span><span class="op" id="6679479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679484">Type</span><span class="op" id="6679488">:</span>&nbsp;<span class="ident" id="6679490">icmpv4EchoRequest</span><span class="op" id="6679507">,</span>&nbsp;<span class="ident" id="6679509">Code</span><span class="op" id="6679513">:</span>&nbsp;<span class="num" id="6679515">0</span><span class="op" id="6679516">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679521">Body</span><span class="op" id="6679525">:</span>&nbsp;<span class="op" id="6679527">&amp;</span><span class="ident" id="6679528">icmpEcho</span><span class="op" id="6679536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679542">ID</span><span class="op" id="6679544">:</span>&nbsp;<span class="ident" id="6679546">os</span><span class="op" id="6679548">.</span><span class="ident" id="6679549">Getpid</span><span class="op" id="6679555">(</span><span class="op" id="6679556">)</span>&nbsp;<span class="op" id="6679558">&amp;</span>&nbsp;<span class="num" id="6679560">0xffff</span><span class="op" id="6679566">,</span>&nbsp;<span class="ident" id="6679568">Seq</span><span class="op" id="6679571">:</span>&nbsp;<span class="ident" id="6679573">i</span>&nbsp;<span class="op" id="6679575">+</span>&nbsp;<span class="num" id="6679577">1</span><span class="op" id="6679578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679584">Data</span><span class="op" id="6679588">:</span>&nbsp;<span class="op" id="6679590">[</span><span class="op" id="6679591">]</span><span class="builtintype" id="6679592">byte</span><span class="op" id="6679596">(</span><span class="string" id="6679597">&#34;IP&nbsp;PACKETCONN&nbsp;TEST&#34;</span><span class="op" id="6679617">)</span><span class="op" id="6679618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679623">}</span><span class="op" id="6679624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679628">}</span><span class="op" id="6679629">)</span><span class="op" id="6679630">.</span><span class="ident" id="6679631">Marshal</span><span class="op" id="6679638">(</span><span class="op" id="6679639">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679643">if</span>&nbsp;<span class="ident" id="6679646">err</span>&nbsp;<span class="op" id="6679650">!=</span>&nbsp;<span class="ident" id="6679653">nil</span>&nbsp;<span class="op" id="6679657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679662">return</span>&nbsp;<span class="ident" id="6679669">nil</span><span class="op" id="6679672">,</span>&nbsp;<span class="keyword" id="6679674">func</span><span class="op" id="6679678">(</span><span class="op" id="6679679">)</span>&nbsp;<span class="op" id="6679681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679687">t</span><span class="op" id="6679688">.</span><span class="ident" id="6679689">Fatalf</span><span class="op" id="6679695">(</span><span class="string" id="6679696">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6679728">,</span>&nbsp;<span class="ident" id="6679730">err</span><span class="op" id="6679733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679742">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679746">return</span>&nbsp;<span class="ident" id="6679753">b</span><span class="op" id="6679754">,</span>&nbsp;<span class="ident" id="6679756">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679761">case</span>&nbsp;<span class="string" id="6679766">&#34;unixgram&#34;</span><span class="op" id="6679776">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679780">switch</span>&nbsp;<span class="ident" id="6679787">runtime</span><span class="op" id="6679794">.</span><span class="ident" id="6679795">GOOS</span>&nbsp;<span class="op" id="6679800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679804">case</span>&nbsp;<span class="string" id="6679809">&#34;nacl&#34;</span><span class="op" id="6679815">,</span>&nbsp;<span class="string" id="6679817">&#34;plan9&#34;</span><span class="op" id="6679824">,</span>&nbsp;<span class="string" id="6679826">&#34;windows&#34;</span><span class="op" id="6679835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679840">return</span>&nbsp;<span class="ident" id="6679847">nil</span><span class="op" id="6679850">,</span>&nbsp;<span class="keyword" id="6679852">func</span><span class="op" id="6679856">(</span><span class="op" id="6679857">)</span>&nbsp;<span class="op" id="6679859">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679865">t</span><span class="op" id="6679866">.</span><span class="ident" id="6679867">Logf</span><span class="op" id="6679871">(</span><span class="string" id="6679872">&#34;skipping&nbsp;%q&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6679896">,</span>&nbsp;<span class="ident" id="6679898">net</span><span class="op" id="6679901">,</span>&nbsp;<span class="ident" id="6679903">runtime</span><span class="op" id="6679910">.</span><span class="ident" id="6679911">GOOS</span><span class="op" id="6679915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679924">default</span><span class="op" id="6679931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679936">return</span>&nbsp;<span class="op" id="6679943">[</span><span class="op" id="6679944">]</span><span class="builtintype" id="6679945">byte</span><span class="op" id="6679949">(</span><span class="string" id="6679950">&#34;UNIXGRAM&nbsp;PACKETCONN&nbsp;TEST&#34;</span><span class="op" id="6679976">)</span><span class="op" id="6679977">,</span>&nbsp;<span class="ident" id="6679979">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679985">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679988">default</span><span class="op" id="6679995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679999">return</span>&nbsp;<span class="ident" id="6680006">nil</span><span class="op" id="6680009">,</span>&nbsp;<span class="keyword" id="6680011">func</span><span class="op" id="6680015">(</span><span class="op" id="6680016">)</span>&nbsp;<span class="op" id="6680018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680023">t</span><span class="op" id="6680024">.</span><span class="ident" id="6680025">Logf</span><span class="op" id="6680029">(</span><span class="string" id="6680030">&#34;skipping&nbsp;%q&nbsp;test&#34;</span><span class="op" id="6680048">,</span>&nbsp;<span class="ident" id="6680050">net</span><span class="op" id="6680053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680060">}</span><br>
<span class="lineno">55</span><span class="op" id="6680062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6680065">var</span>&nbsp;<span class="ident" id="6680069">packetConnTests</span>&nbsp;<span class="op" id="6680085">=</span>&nbsp;<span class="op" id="6680087">[</span><span class="op" id="6680088">]</span><span class="keyword" id="6680089">struct</span>&nbsp;<span class="op" id="6680096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680099">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6680105">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680113">addr1</span>&nbsp;<span class="builtintype" id="6680119">string</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680127">addr2</span>&nbsp;<span class="builtintype" id="6680133">string</span><br>
<span class="lineno"></span><span class="op" id="6680140">}</span><span class="op" id="6680141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680144">{</span><span class="string" id="6680145">&#34;udp&#34;</span><span class="op" id="6680150">,</span>&nbsp;<span class="string" id="6680152">&#34;127.0.0.1:0&#34;</span><span class="op" id="6680165">,</span>&nbsp;<span class="string" id="6680167">&#34;127.0.0.1:0&#34;</span><span class="op" id="6680180">}</span><span class="op" id="6680181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680184">{</span><span class="string" id="6680185">&#34;ip:icmp&#34;</span><span class="op" id="6680194">,</span>&nbsp;<span class="string" id="6680196">&#34;127.0.0.1&#34;</span><span class="op" id="6680207">,</span>&nbsp;<span class="string" id="6680209">&#34;127.0.0.1&#34;</span><span class="op" id="6680220">}</span><span class="op" id="6680221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680224">{</span><span class="string" id="6680225">&#34;unixgram&#34;</span><span class="op" id="6680235">,</span>&nbsp;<span class="ident" id="6680237">testUnixAddr</span><span class="op" id="6680249">(</span><span class="op" id="6680250">)</span><span class="op" id="6680251">,</span>&nbsp;<span class="ident" id="6680253">testUnixAddr</span><span class="op" id="6680265">(</span><span class="op" id="6680266">)</span><span class="op" id="6680267">}</span><span class="op" id="6680268">,</span><br>
<span class="lineno">65</span><span class="op" id="6680270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6680273">func</span>&nbsp;<span class="ident" id="6680278">TestPacketConn</span><span class="op" id="6680292">(</span><span class="ident" id="6680293">t</span>&nbsp;<span class="op" id="6680295">*</span><span class="ident" id="6680296">testing</span><span class="op" id="6680303">.</span><span class="ident" id="6680304">T</span><span class="op" id="6680305">)</span>&nbsp;<span class="op" id="6680307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680310">closer</span>&nbsp;<span class="op" id="6680317">:=</span>&nbsp;<span class="keyword" id="6680320">func</span><span class="op" id="6680324">(</span><span class="ident" id="6680325">c</span>&nbsp;<span class="ident" id="6680327">PacketConn</span><span class="op" id="6680337">,</span>&nbsp;<span class="ident" id="6680339">net</span><span class="op" id="6680342">,</span>&nbsp;<span class="ident" id="6680344">addr1</span><span class="op" id="6680349">,</span>&nbsp;<span class="ident" id="6680351">addr2</span>&nbsp;<span class="builtintype" id="6680357">string</span><span class="op" id="6680363">)</span>&nbsp;<span class="op" id="6680365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680369">c</span><span class="op" id="6680370">.</span><span class="ident" id="6680371">Close</span><span class="op" id="6680376">(</span><span class="op" id="6680377">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680381">switch</span>&nbsp;<span class="ident" id="6680388">net</span>&nbsp;<span class="op" id="6680392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680396">case</span>&nbsp;<span class="string" id="6680401">&#34;unixgram&#34;</span><span class="op" id="6680411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680416">os</span><span class="op" id="6680418">.</span><span class="ident" id="6680419">Remove</span><span class="op" id="6680425">(</span><span class="ident" id="6680426">addr1</span><span class="op" id="6680431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680436">os</span><span class="op" id="6680438">.</span><span class="ident" id="6680439">Remove</span><span class="op" id="6680445">(</span><span class="ident" id="6680446">addr2</span><span class="op" id="6680451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680455">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680462">for</span>&nbsp;<span class="ident" id="6680466">i</span><span class="op" id="6680467">,</span>&nbsp;<span class="ident" id="6680469">tt</span>&nbsp;<span class="op" id="6680472">:=</span>&nbsp;<span class="keyword" id="6680475">range</span>&nbsp;<span class="ident" id="6680481">packetConnTests</span>&nbsp;<span class="op" id="6680497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680501">netstr</span>&nbsp;<span class="op" id="6680508">:=</span>&nbsp;<span class="ident" id="6680511">strings</span><span class="op" id="6680518">.</span><span class="ident" id="6680519">Split</span><span class="op" id="6680524">(</span><span class="ident" id="6680525">tt</span><span class="op" id="6680527">.</span><span class="ident" id="6680528">net</span><span class="op" id="6680531">,</span>&nbsp;<span class="string" id="6680533">&#34;:&#34;</span><span class="op" id="6680536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680540">wb</span><span class="op" id="6680542">,</span>&nbsp;<span class="ident" id="6680544">skipOrFatalFn</span>&nbsp;<span class="op" id="6680558">:=</span>&nbsp;<span class="ident" id="6680561">packetConnTestData</span><span class="op" id="6680579">(</span><span class="ident" id="6680580">t</span><span class="op" id="6680581">,</span>&nbsp;<span class="ident" id="6680583">netstr</span><span class="op" id="6680589">[</span><span class="num" id="6680590">0</span><span class="op" id="6680591">]</span><span class="op" id="6680592">,</span>&nbsp;<span class="ident" id="6680594">i</span><span class="op" id="6680595">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680599">if</span>&nbsp;<span class="ident" id="6680602">skipOrFatalFn</span>&nbsp;<span class="op" id="6680616">!=</span>&nbsp;<span class="ident" id="6680619">nil</span>&nbsp;<span class="op" id="6680623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680628">skipOrFatalFn</span><span class="op" id="6680641">(</span><span class="op" id="6680642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680647">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680663">c1</span><span class="op" id="6680665">,</span>&nbsp;<span class="ident" id="6680667">err</span>&nbsp;<span class="op" id="6680671">:=</span>&nbsp;<span class="ident" id="6680674">ListenPacket</span><span class="op" id="6680686">(</span><span class="ident" id="6680687">tt</span><span class="op" id="6680689">.</span><span class="ident" id="6680690">net</span><span class="op" id="6680693">,</span>&nbsp;<span class="ident" id="6680695">tt</span><span class="op" id="6680697">.</span><span class="ident" id="6680698">addr1</span><span class="op" id="6680703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680707">if</span>&nbsp;<span class="ident" id="6680710">err</span>&nbsp;<span class="op" id="6680714">!=</span>&nbsp;<span class="ident" id="6680717">nil</span>&nbsp;<span class="op" id="6680721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680726">t</span><span class="op" id="6680727">.</span><span class="ident" id="6680728">Fatalf</span><span class="op" id="6680734">(</span><span class="string" id="6680735">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6680760">,</span>&nbsp;<span class="ident" id="6680762">err</span><span class="op" id="6680765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680773">defer</span>&nbsp;<span class="ident" id="6680779">closer</span><span class="op" id="6680785">(</span><span class="ident" id="6680786">c1</span><span class="op" id="6680788">,</span>&nbsp;<span class="ident" id="6680790">netstr</span><span class="op" id="6680796">[</span><span class="num" id="6680797">0</span><span class="op" id="6680798">]</span><span class="op" id="6680799">,</span>&nbsp;<span class="ident" id="6680801">tt</span><span class="op" id="6680803">.</span><span class="ident" id="6680804">addr1</span><span class="op" id="6680809">,</span>&nbsp;<span class="ident" id="6680811">tt</span><span class="op" id="6680813">.</span><span class="ident" id="6680814">addr2</span><span class="op" id="6680819">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680823">c1</span><span class="op" id="6680825">.</span><span class="ident" id="6680826">LocalAddr</span><span class="op" id="6680835">(</span><span class="op" id="6680836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680840">c1</span><span class="op" id="6680842">.</span><span class="ident" id="6680843">SetDeadline</span><span class="op" id="6680854">(</span><span class="ident" id="6680855">time</span><span class="op" id="6680859">.</span><span class="ident" id="6680860">Now</span><span class="op" id="6680863">(</span><span class="op" id="6680864">)</span><span class="op" id="6680865">.</span><span class="ident" id="6680866">Add</span><span class="op" id="6680869">(</span><span class="num" id="6680870">100</span>&nbsp;<span class="op" id="6680874">*</span>&nbsp;<span class="ident" id="6680876">time</span><span class="op" id="6680880">.</span><span class="ident" id="6680881">Millisecond</span><span class="op" id="6680892">)</span><span class="op" id="6680893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680897">c1</span><span class="op" id="6680899">.</span><span class="ident" id="6680900">SetReadDeadline</span><span class="op" id="6680915">(</span><span class="ident" id="6680916">time</span><span class="op" id="6680920">.</span><span class="ident" id="6680921">Now</span><span class="op" id="6680924">(</span><span class="op" id="6680925">)</span><span class="op" id="6680926">.</span><span class="ident" id="6680927">Add</span><span class="op" id="6680930">(</span><span class="num" id="6680931">100</span>&nbsp;<span class="op" id="6680935">*</span>&nbsp;<span class="ident" id="6680937">time</span><span class="op" id="6680941">.</span><span class="ident" id="6680942">Millisecond</span><span class="op" id="6680953">)</span><span class="op" id="6680954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680958">c1</span><span class="op" id="6680960">.</span><span class="ident" id="6680961">SetWriteDeadline</span><span class="op" id="6680977">(</span><span class="ident" id="6680978">time</span><span class="op" id="6680982">.</span><span class="ident" id="6680983">Now</span><span class="op" id="6680986">(</span><span class="op" id="6680987">)</span><span class="op" id="6680988">.</span><span class="ident" id="6680989">Add</span><span class="op" id="6680992">(</span><span class="num" id="6680993">100</span>&nbsp;<span class="op" id="6680997">*</span>&nbsp;<span class="ident" id="6680999">time</span><span class="op" id="6681003">.</span><span class="ident" id="6681004">Millisecond</span><span class="op" id="6681015">)</span><span class="op" id="6681016">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681021">c2</span><span class="op" id="6681023">,</span>&nbsp;<span class="ident" id="6681025">err</span>&nbsp;<span class="op" id="6681029">:=</span>&nbsp;<span class="ident" id="6681032">ListenPacket</span><span class="op" id="6681044">(</span><span class="ident" id="6681045">tt</span><span class="op" id="6681047">.</span><span class="ident" id="6681048">net</span><span class="op" id="6681051">,</span>&nbsp;<span class="ident" id="6681053">tt</span><span class="op" id="6681055">.</span><span class="ident" id="6681056">addr2</span><span class="op" id="6681061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681065">if</span>&nbsp;<span class="ident" id="6681068">err</span>&nbsp;<span class="op" id="6681072">!=</span>&nbsp;<span class="ident" id="6681075">nil</span>&nbsp;<span class="op" id="6681079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681084">t</span><span class="op" id="6681085">.</span><span class="ident" id="6681086">Fatalf</span><span class="op" id="6681092">(</span><span class="string" id="6681093">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6681118">,</span>&nbsp;<span class="ident" id="6681120">err</span><span class="op" id="6681123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681131">defer</span>&nbsp;<span class="ident" id="6681137">closer</span><span class="op" id="6681143">(</span><span class="ident" id="6681144">c2</span><span class="op" id="6681146">,</span>&nbsp;<span class="ident" id="6681148">netstr</span><span class="op" id="6681154">[</span><span class="num" id="6681155">0</span><span class="op" id="6681156">]</span><span class="op" id="6681157">,</span>&nbsp;<span class="ident" id="6681159">tt</span><span class="op" id="6681161">.</span><span class="ident" id="6681162">addr1</span><span class="op" id="6681167">,</span>&nbsp;<span class="ident" id="6681169">tt</span><span class="op" id="6681171">.</span><span class="ident" id="6681172">addr2</span><span class="op" id="6681177">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681181">c2</span><span class="op" id="6681183">.</span><span class="ident" id="6681184">LocalAddr</span><span class="op" id="6681193">(</span><span class="op" id="6681194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681198">c2</span><span class="op" id="6681200">.</span><span class="ident" id="6681201">SetDeadline</span><span class="op" id="6681212">(</span><span class="ident" id="6681213">time</span><span class="op" id="6681217">.</span><span class="ident" id="6681218">Now</span><span class="op" id="6681221">(</span><span class="op" id="6681222">)</span><span class="op" id="6681223">.</span><span class="ident" id="6681224">Add</span><span class="op" id="6681227">(</span><span class="num" id="6681228">100</span>&nbsp;<span class="op" id="6681232">*</span>&nbsp;<span class="ident" id="6681234">time</span><span class="op" id="6681238">.</span><span class="ident" id="6681239">Millisecond</span><span class="op" id="6681250">)</span><span class="op" id="6681251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681255">c2</span><span class="op" id="6681257">.</span><span class="ident" id="6681258">SetReadDeadline</span><span class="op" id="6681273">(</span><span class="ident" id="6681274">time</span><span class="op" id="6681278">.</span><span class="ident" id="6681279">Now</span><span class="op" id="6681282">(</span><span class="op" id="6681283">)</span><span class="op" id="6681284">.</span><span class="ident" id="6681285">Add</span><span class="op" id="6681288">(</span><span class="num" id="6681289">100</span>&nbsp;<span class="op" id="6681293">*</span>&nbsp;<span class="ident" id="6681295">time</span><span class="op" id="6681299">.</span><span class="ident" id="6681300">Millisecond</span><span class="op" id="6681311">)</span><span class="op" id="6681312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681316">c2</span><span class="op" id="6681318">.</span><span class="ident" id="6681319">SetWriteDeadline</span><span class="op" id="6681335">(</span><span class="ident" id="6681336">time</span><span class="op" id="6681340">.</span><span class="ident" id="6681341">Now</span><span class="op" id="6681344">(</span><span class="op" id="6681345">)</span><span class="op" id="6681346">.</span><span class="ident" id="6681347">Add</span><span class="op" id="6681350">(</span><span class="num" id="6681351">100</span>&nbsp;<span class="op" id="6681355">*</span>&nbsp;<span class="ident" id="6681357">time</span><span class="op" id="6681361">.</span><span class="ident" id="6681362">Millisecond</span><span class="op" id="6681373">)</span><span class="op" id="6681374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681379">if</span>&nbsp;<span class="ident" id="6681382">_</span><span class="op" id="6681383">,</span>&nbsp;<span class="ident" id="6681385">err</span>&nbsp;<span class="op" id="6681389">:=</span>&nbsp;<span class="ident" id="6681392">c1</span><span class="op" id="6681394">.</span><span class="ident" id="6681395">WriteTo</span><span class="op" id="6681402">(</span><span class="ident" id="6681403">wb</span><span class="op" id="6681405">,</span>&nbsp;<span class="ident" id="6681407">c2</span><span class="op" id="6681409">.</span><span class="ident" id="6681410">LocalAddr</span><span class="op" id="6681419">(</span><span class="op" id="6681420">)</span><span class="op" id="6681421">)</span><span class="op" id="6681422">;</span>&nbsp;<span class="ident" id="6681424">err</span>&nbsp;<span class="op" id="6681428">!=</span>&nbsp;<span class="ident" id="6681431">nil</span>&nbsp;<span class="op" id="6681435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681440">t</span><span class="op" id="6681441">.</span><span class="ident" id="6681442">Fatalf</span><span class="op" id="6681448">(</span><span class="string" id="6681449">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6681480">,</span>&nbsp;<span class="ident" id="6681482">err</span><span class="op" id="6681485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681493">rb2</span>&nbsp;<span class="op" id="6681497">:=</span>&nbsp;<span class="builtinfunc" id="6681500">make</span><span class="op" id="6681504">(</span><span class="op" id="6681505">[</span><span class="op" id="6681506">]</span><span class="builtintype" id="6681507">byte</span><span class="op" id="6681511">,</span>&nbsp;<span class="num" id="6681513">128</span><span class="op" id="6681516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681520">if</span>&nbsp;<span class="ident" id="6681523">_</span><span class="op" id="6681524">,</span>&nbsp;<span class="ident" id="6681526">_</span><span class="op" id="6681527">,</span>&nbsp;<span class="ident" id="6681529">err</span>&nbsp;<span class="op" id="6681533">:=</span>&nbsp;<span class="ident" id="6681536">c2</span><span class="op" id="6681538">.</span><span class="ident" id="6681539">ReadFrom</span><span class="op" id="6681547">(</span><span class="ident" id="6681548">rb2</span><span class="op" id="6681551">)</span><span class="op" id="6681552">;</span>&nbsp;<span class="ident" id="6681554">err</span>&nbsp;<span class="op" id="6681558">!=</span>&nbsp;<span class="ident" id="6681561">nil</span>&nbsp;<span class="op" id="6681565">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681570">t</span><span class="op" id="6681571">.</span><span class="ident" id="6681572">Fatalf</span><span class="op" id="6681578">(</span><span class="string" id="6681579">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6681611">,</span>&nbsp;<span class="ident" id="6681613">err</span><span class="op" id="6681616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681624">if</span>&nbsp;<span class="ident" id="6681627">_</span><span class="op" id="6681628">,</span>&nbsp;<span class="ident" id="6681630">err</span>&nbsp;<span class="op" id="6681634">:=</span>&nbsp;<span class="ident" id="6681637">c2</span><span class="op" id="6681639">.</span><span class="ident" id="6681640">WriteTo</span><span class="op" id="6681647">(</span><span class="ident" id="6681648">wb</span><span class="op" id="6681650">,</span>&nbsp;<span class="ident" id="6681652">c1</span><span class="op" id="6681654">.</span><span class="ident" id="6681655">LocalAddr</span><span class="op" id="6681664">(</span><span class="op" id="6681665">)</span><span class="op" id="6681666">)</span><span class="op" id="6681667">;</span>&nbsp;<span class="ident" id="6681669">err</span>&nbsp;<span class="op" id="6681673">!=</span>&nbsp;<span class="ident" id="6681676">nil</span>&nbsp;<span class="op" id="6681680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681685">t</span><span class="op" id="6681686">.</span><span class="ident" id="6681687">Fatalf</span><span class="op" id="6681693">(</span><span class="string" id="6681694">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6681725">,</span>&nbsp;<span class="ident" id="6681727">err</span><span class="op" id="6681730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681734">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681738">rb1</span>&nbsp;<span class="op" id="6681742">:=</span>&nbsp;<span class="builtinfunc" id="6681745">make</span><span class="op" id="6681749">(</span><span class="op" id="6681750">[</span><span class="op" id="6681751">]</span><span class="builtintype" id="6681752">byte</span><span class="op" id="6681756">,</span>&nbsp;<span class="num" id="6681758">128</span><span class="op" id="6681761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681765">if</span>&nbsp;<span class="ident" id="6681768">_</span><span class="op" id="6681769">,</span>&nbsp;<span class="ident" id="6681771">_</span><span class="op" id="6681772">,</span>&nbsp;<span class="ident" id="6681774">err</span>&nbsp;<span class="op" id="6681778">:=</span>&nbsp;<span class="ident" id="6681781">c1</span><span class="op" id="6681783">.</span><span class="ident" id="6681784">ReadFrom</span><span class="op" id="6681792">(</span><span class="ident" id="6681793">rb1</span><span class="op" id="6681796">)</span><span class="op" id="6681797">;</span>&nbsp;<span class="ident" id="6681799">err</span>&nbsp;<span class="op" id="6681803">!=</span>&nbsp;<span class="ident" id="6681806">nil</span>&nbsp;<span class="op" id="6681810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681815">t</span><span class="op" id="6681816">.</span><span class="ident" id="6681817">Fatalf</span><span class="op" id="6681823">(</span><span class="string" id="6681824">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6681856">,</span>&nbsp;<span class="ident" id="6681858">err</span><span class="op" id="6681861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681868">}</span><br>
<span class="lineno">120</span><span class="op" id="6681870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6681873">func</span>&nbsp;<span class="ident" id="6681878">TestConnAndPacketConn</span><span class="op" id="6681899">(</span><span class="ident" id="6681900">t</span>&nbsp;<span class="op" id="6681902">*</span><span class="ident" id="6681903">testing</span><span class="op" id="6681910">.</span><span class="ident" id="6681911">T</span><span class="op" id="6681912">)</span>&nbsp;<span class="op" id="6681914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681917">closer</span>&nbsp;<span class="op" id="6681924">:=</span>&nbsp;<span class="keyword" id="6681927">func</span><span class="op" id="6681931">(</span><span class="ident" id="6681932">c</span>&nbsp;<span class="ident" id="6681934">PacketConn</span><span class="op" id="6681944">,</span>&nbsp;<span class="ident" id="6681946">net</span><span class="op" id="6681949">,</span>&nbsp;<span class="ident" id="6681951">addr1</span><span class="op" id="6681956">,</span>&nbsp;<span class="ident" id="6681958">addr2</span>&nbsp;<span class="builtintype" id="6681964">string</span><span class="op" id="6681970">)</span>&nbsp;<span class="op" id="6681972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681976">c</span><span class="op" id="6681977">.</span><span class="ident" id="6681978">Close</span><span class="op" id="6681983">(</span><span class="op" id="6681984">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681988">switch</span>&nbsp;<span class="ident" id="6681995">net</span>&nbsp;<span class="op" id="6681999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682003">case</span>&nbsp;<span class="string" id="6682008">&#34;unixgram&#34;</span><span class="op" id="6682018">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682023">os</span><span class="op" id="6682025">.</span><span class="ident" id="6682026">Remove</span><span class="op" id="6682032">(</span><span class="ident" id="6682033">addr1</span><span class="op" id="6682038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682043">os</span><span class="op" id="6682045">.</span><span class="ident" id="6682046">Remove</span><span class="op" id="6682052">(</span><span class="ident" id="6682053">addr2</span><span class="op" id="6682058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682062">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682069">for</span>&nbsp;<span class="ident" id="6682073">i</span><span class="op" id="6682074">,</span>&nbsp;<span class="ident" id="6682076">tt</span>&nbsp;<span class="op" id="6682079">:=</span>&nbsp;<span class="keyword" id="6682082">range</span>&nbsp;<span class="ident" id="6682088">packetConnTests</span>&nbsp;<span class="op" id="6682104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682108">var</span>&nbsp;<span class="ident" id="6682112">wb</span>&nbsp;<span class="op" id="6682115">[</span><span class="op" id="6682116">]</span><span class="builtintype" id="6682117">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682124">netstr</span>&nbsp;<span class="op" id="6682131">:=</span>&nbsp;<span class="ident" id="6682134">strings</span><span class="op" id="6682141">.</span><span class="ident" id="6682142">Split</span><span class="op" id="6682147">(</span><span class="ident" id="6682148">tt</span><span class="op" id="6682150">.</span><span class="ident" id="6682151">net</span><span class="op" id="6682154">,</span>&nbsp;<span class="string" id="6682156">&#34;:&#34;</span><span class="op" id="6682159">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682163">wb</span><span class="op" id="6682165">,</span>&nbsp;<span class="ident" id="6682167">skipOrFatalFn</span>&nbsp;<span class="op" id="6682181">:=</span>&nbsp;<span class="ident" id="6682184">packetConnTestData</span><span class="op" id="6682202">(</span><span class="ident" id="6682203">t</span><span class="op" id="6682204">,</span>&nbsp;<span class="ident" id="6682206">netstr</span><span class="op" id="6682212">[</span><span class="num" id="6682213">0</span><span class="op" id="6682214">]</span><span class="op" id="6682215">,</span>&nbsp;<span class="ident" id="6682217">i</span><span class="op" id="6682218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682222">if</span>&nbsp;<span class="ident" id="6682225">skipOrFatalFn</span>&nbsp;<span class="op" id="6682239">!=</span>&nbsp;<span class="ident" id="6682242">nil</span>&nbsp;<span class="op" id="6682246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682251">skipOrFatalFn</span><span class="op" id="6682264">(</span><span class="op" id="6682265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682270">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682281">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682286">c1</span><span class="op" id="6682288">,</span>&nbsp;<span class="ident" id="6682290">err</span>&nbsp;<span class="op" id="6682294">:=</span>&nbsp;<span class="ident" id="6682297">ListenPacket</span><span class="op" id="6682309">(</span><span class="ident" id="6682310">tt</span><span class="op" id="6682312">.</span><span class="ident" id="6682313">net</span><span class="op" id="6682316">,</span>&nbsp;<span class="ident" id="6682318">tt</span><span class="op" id="6682320">.</span><span class="ident" id="6682321">addr1</span><span class="op" id="6682326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682330">if</span>&nbsp;<span class="ident" id="6682333">err</span>&nbsp;<span class="op" id="6682337">!=</span>&nbsp;<span class="ident" id="6682340">nil</span>&nbsp;<span class="op" id="6682344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682349">t</span><span class="op" id="6682350">.</span><span class="ident" id="6682351">Fatalf</span><span class="op" id="6682357">(</span><span class="string" id="6682358">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6682383">,</span>&nbsp;<span class="ident" id="6682385">err</span><span class="op" id="6682388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682392">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682396">defer</span>&nbsp;<span class="ident" id="6682402">closer</span><span class="op" id="6682408">(</span><span class="ident" id="6682409">c1</span><span class="op" id="6682411">,</span>&nbsp;<span class="ident" id="6682413">netstr</span><span class="op" id="6682419">[</span><span class="num" id="6682420">0</span><span class="op" id="6682421">]</span><span class="op" id="6682422">,</span>&nbsp;<span class="ident" id="6682424">tt</span><span class="op" id="6682426">.</span><span class="ident" id="6682427">addr1</span><span class="op" id="6682432">,</span>&nbsp;<span class="ident" id="6682434">tt</span><span class="op" id="6682436">.</span><span class="ident" id="6682437">addr2</span><span class="op" id="6682442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682446">c1</span><span class="op" id="6682448">.</span><span class="ident" id="6682449">LocalAddr</span><span class="op" id="6682458">(</span><span class="op" id="6682459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682463">c1</span><span class="op" id="6682465">.</span><span class="ident" id="6682466">SetDeadline</span><span class="op" id="6682477">(</span><span class="ident" id="6682478">time</span><span class="op" id="6682482">.</span><span class="ident" id="6682483">Now</span><span class="op" id="6682486">(</span><span class="op" id="6682487">)</span><span class="op" id="6682488">.</span><span class="ident" id="6682489">Add</span><span class="op" id="6682492">(</span><span class="num" id="6682493">100</span>&nbsp;<span class="op" id="6682497">*</span>&nbsp;<span class="ident" id="6682499">time</span><span class="op" id="6682503">.</span><span class="ident" id="6682504">Millisecond</span><span class="op" id="6682515">)</span><span class="op" id="6682516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682520">c1</span><span class="op" id="6682522">.</span><span class="ident" id="6682523">SetReadDeadline</span><span class="op" id="6682538">(</span><span class="ident" id="6682539">time</span><span class="op" id="6682543">.</span><span class="ident" id="6682544">Now</span><span class="op" id="6682547">(</span><span class="op" id="6682548">)</span><span class="op" id="6682549">.</span><span class="ident" id="6682550">Add</span><span class="op" id="6682553">(</span><span class="num" id="6682554">100</span>&nbsp;<span class="op" id="6682558">*</span>&nbsp;<span class="ident" id="6682560">time</span><span class="op" id="6682564">.</span><span class="ident" id="6682565">Millisecond</span><span class="op" id="6682576">)</span><span class="op" id="6682577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682581">c1</span><span class="op" id="6682583">.</span><span class="ident" id="6682584">SetWriteDeadline</span><span class="op" id="6682600">(</span><span class="ident" id="6682601">time</span><span class="op" id="6682605">.</span><span class="ident" id="6682606">Now</span><span class="op" id="6682609">(</span><span class="op" id="6682610">)</span><span class="op" id="6682611">.</span><span class="ident" id="6682612">Add</span><span class="op" id="6682615">(</span><span class="num" id="6682616">100</span>&nbsp;<span class="op" id="6682620">*</span>&nbsp;<span class="ident" id="6682622">time</span><span class="op" id="6682626">.</span><span class="ident" id="6682627">Millisecond</span><span class="op" id="6682638">)</span><span class="op" id="6682639">)</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682644">c2</span><span class="op" id="6682646">,</span>&nbsp;<span class="ident" id="6682648">err</span>&nbsp;<span class="op" id="6682652">:=</span>&nbsp;<span class="ident" id="6682655">Dial</span><span class="op" id="6682659">(</span><span class="ident" id="6682660">tt</span><span class="op" id="6682662">.</span><span class="ident" id="6682663">net</span><span class="op" id="6682666">,</span>&nbsp;<span class="ident" id="6682668">c1</span><span class="op" id="6682670">.</span><span class="ident" id="6682671">LocalAddr</span><span class="op" id="6682680">(</span><span class="op" id="6682681">)</span><span class="op" id="6682682">.</span><span class="ident" id="6682683">String</span><span class="op" id="6682689">(</span><span class="op" id="6682690">)</span><span class="op" id="6682691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682695">if</span>&nbsp;<span class="ident" id="6682698">err</span>&nbsp;<span class="op" id="6682702">!=</span>&nbsp;<span class="ident" id="6682705">nil</span>&nbsp;<span class="op" id="6682709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682714">t</span><span class="op" id="6682715">.</span><span class="ident" id="6682716">Fatalf</span><span class="op" id="6682722">(</span><span class="string" id="6682723">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6682740">,</span>&nbsp;<span class="ident" id="6682742">err</span><span class="op" id="6682745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682749">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682753">defer</span>&nbsp;<span class="ident" id="6682759">c2</span><span class="op" id="6682761">.</span><span class="ident" id="6682762">Close</span><span class="op" id="6682767">(</span><span class="op" id="6682768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682772">c2</span><span class="op" id="6682774">.</span><span class="ident" id="6682775">LocalAddr</span><span class="op" id="6682784">(</span><span class="op" id="6682785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682789">c2</span><span class="op" id="6682791">.</span><span class="ident" id="6682792">RemoteAddr</span><span class="op" id="6682802">(</span><span class="op" id="6682803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682807">c2</span><span class="op" id="6682809">.</span><span class="ident" id="6682810">SetDeadline</span><span class="op" id="6682821">(</span><span class="ident" id="6682822">time</span><span class="op" id="6682826">.</span><span class="ident" id="6682827">Now</span><span class="op" id="6682830">(</span><span class="op" id="6682831">)</span><span class="op" id="6682832">.</span><span class="ident" id="6682833">Add</span><span class="op" id="6682836">(</span><span class="num" id="6682837">100</span>&nbsp;<span class="op" id="6682841">*</span>&nbsp;<span class="ident" id="6682843">time</span><span class="op" id="6682847">.</span><span class="ident" id="6682848">Millisecond</span><span class="op" id="6682859">)</span><span class="op" id="6682860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682864">c2</span><span class="op" id="6682866">.</span><span class="ident" id="6682867">SetReadDeadline</span><span class="op" id="6682882">(</span><span class="ident" id="6682883">time</span><span class="op" id="6682887">.</span><span class="ident" id="6682888">Now</span><span class="op" id="6682891">(</span><span class="op" id="6682892">)</span><span class="op" id="6682893">.</span><span class="ident" id="6682894">Add</span><span class="op" id="6682897">(</span><span class="num" id="6682898">100</span>&nbsp;<span class="op" id="6682902">*</span>&nbsp;<span class="ident" id="6682904">time</span><span class="op" id="6682908">.</span><span class="ident" id="6682909">Millisecond</span><span class="op" id="6682920">)</span><span class="op" id="6682921">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682925">c2</span><span class="op" id="6682927">.</span><span class="ident" id="6682928">SetWriteDeadline</span><span class="op" id="6682944">(</span><span class="ident" id="6682945">time</span><span class="op" id="6682949">.</span><span class="ident" id="6682950">Now</span><span class="op" id="6682953">(</span><span class="op" id="6682954">)</span><span class="op" id="6682955">.</span><span class="ident" id="6682956">Add</span><span class="op" id="6682959">(</span><span class="num" id="6682960">100</span>&nbsp;<span class="op" id="6682964">*</span>&nbsp;<span class="ident" id="6682966">time</span><span class="op" id="6682970">.</span><span class="ident" id="6682971">Millisecond</span><span class="op" id="6682982">)</span><span class="op" id="6682983">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682988">if</span>&nbsp;<span class="ident" id="6682991">_</span><span class="op" id="6682992">,</span>&nbsp;<span class="ident" id="6682994">err</span>&nbsp;<span class="op" id="6682998">:=</span>&nbsp;<span class="ident" id="6683001">c2</span><span class="op" id="6683003">.</span><span class="ident" id="6683004">Write</span><span class="op" id="6683009">(</span><span class="ident" id="6683010">wb</span><span class="op" id="6683012">)</span><span class="op" id="6683013">;</span>&nbsp;<span class="ident" id="6683015">err</span>&nbsp;<span class="op" id="6683019">!=</span>&nbsp;<span class="ident" id="6683022">nil</span>&nbsp;<span class="op" id="6683026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683031">t</span><span class="op" id="6683032">.</span><span class="ident" id="6683033">Fatalf</span><span class="op" id="6683039">(</span><span class="string" id="6683040">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6683063">,</span>&nbsp;<span class="ident" id="6683065">err</span><span class="op" id="6683068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683072">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683076">rb1</span>&nbsp;<span class="op" id="6683080">:=</span>&nbsp;<span class="builtinfunc" id="6683083">make</span><span class="op" id="6683087">(</span><span class="op" id="6683088">[</span><span class="op" id="6683089">]</span><span class="builtintype" id="6683090">byte</span><span class="op" id="6683094">,</span>&nbsp;<span class="num" id="6683096">128</span><span class="op" id="6683099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683103">if</span>&nbsp;<span class="ident" id="6683106">_</span><span class="op" id="6683107">,</span>&nbsp;<span class="ident" id="6683109">_</span><span class="op" id="6683110">,</span>&nbsp;<span class="ident" id="6683112">err</span>&nbsp;<span class="op" id="6683116">:=</span>&nbsp;<span class="ident" id="6683119">c1</span><span class="op" id="6683121">.</span><span class="ident" id="6683122">ReadFrom</span><span class="op" id="6683130">(</span><span class="ident" id="6683131">rb1</span><span class="op" id="6683134">)</span><span class="op" id="6683135">;</span>&nbsp;<span class="ident" id="6683137">err</span>&nbsp;<span class="op" id="6683141">!=</span>&nbsp;<span class="ident" id="6683144">nil</span>&nbsp;<span class="op" id="6683148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683153">t</span><span class="op" id="6683154">.</span><span class="ident" id="6683155">Fatalf</span><span class="op" id="6683161">(</span><span class="string" id="6683162">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6683194">,</span>&nbsp;<span class="ident" id="6683196">err</span><span class="op" id="6683199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683207">var</span>&nbsp;<span class="ident" id="6683211">dst</span>&nbsp;<span class="ident" id="6683215">Addr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683222">switch</span>&nbsp;<span class="ident" id="6683229">netstr</span><span class="op" id="6683235">[</span><span class="num" id="6683236">0</span><span class="op" id="6683237">]</span>&nbsp;<span class="op" id="6683239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683243">case</span>&nbsp;<span class="string" id="6683248">&#34;ip&#34;</span><span class="op" id="6683252">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683257">dst</span>&nbsp;<span class="op" id="6683261">=</span>&nbsp;<span class="op" id="6683263">&amp;</span><span class="ident" id="6683264">IPAddr</span><span class="op" id="6683270">{</span><span class="ident" id="6683271">IP</span><span class="op" id="6683273">:</span>&nbsp;<span class="ident" id="6683275">IPv4</span><span class="op" id="6683279">(</span><span class="num" id="6683280">127</span><span class="op" id="6683283">,</span>&nbsp;<span class="num" id="6683285">0</span><span class="op" id="6683286">,</span>&nbsp;<span class="num" id="6683288">0</span><span class="op" id="6683289">,</span>&nbsp;<span class="num" id="6683291">1</span><span class="op" id="6683292">)</span><span class="op" id="6683293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683297">case</span>&nbsp;<span class="string" id="6683302">&#34;unixgram&#34;</span><span class="op" id="6683312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683317">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683328">default</span><span class="op" id="6683335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683340">dst</span>&nbsp;<span class="op" id="6683344">=</span>&nbsp;<span class="ident" id="6683346">c2</span><span class="op" id="6683348">.</span><span class="ident" id="6683349">LocalAddr</span><span class="op" id="6683358">(</span><span class="op" id="6683359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683367">if</span>&nbsp;<span class="ident" id="6683370">_</span><span class="op" id="6683371">,</span>&nbsp;<span class="ident" id="6683373">err</span>&nbsp;<span class="op" id="6683377">:=</span>&nbsp;<span class="ident" id="6683380">c1</span><span class="op" id="6683382">.</span><span class="ident" id="6683383">WriteTo</span><span class="op" id="6683390">(</span><span class="ident" id="6683391">wb</span><span class="op" id="6683393">,</span>&nbsp;<span class="ident" id="6683395">dst</span><span class="op" id="6683398">)</span><span class="op" id="6683399">;</span>&nbsp;<span class="ident" id="6683401">err</span>&nbsp;<span class="op" id="6683405">!=</span>&nbsp;<span class="ident" id="6683408">nil</span>&nbsp;<span class="op" id="6683412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683417">t</span><span class="op" id="6683418">.</span><span class="ident" id="6683419">Fatalf</span><span class="op" id="6683425">(</span><span class="string" id="6683426">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6683457">,</span>&nbsp;<span class="ident" id="6683459">err</span><span class="op" id="6683462">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683470">rb2</span>&nbsp;<span class="op" id="6683474">:=</span>&nbsp;<span class="builtinfunc" id="6683477">make</span><span class="op" id="6683481">(</span><span class="op" id="6683482">[</span><span class="op" id="6683483">]</span><span class="builtintype" id="6683484">byte</span><span class="op" id="6683488">,</span>&nbsp;<span class="num" id="6683490">128</span><span class="op" id="6683493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683497">if</span>&nbsp;<span class="ident" id="6683500">_</span><span class="op" id="6683501">,</span>&nbsp;<span class="ident" id="6683503">err</span>&nbsp;<span class="op" id="6683507">:=</span>&nbsp;<span class="ident" id="6683510">c2</span><span class="op" id="6683512">.</span><span class="ident" id="6683513">Read</span><span class="op" id="6683517">(</span><span class="ident" id="6683518">rb2</span><span class="op" id="6683521">)</span><span class="op" id="6683522">;</span>&nbsp;<span class="ident" id="6683524">err</span>&nbsp;<span class="op" id="6683528">!=</span>&nbsp;<span class="ident" id="6683531">nil</span>&nbsp;<span class="op" id="6683535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683540">t</span><span class="op" id="6683541">.</span><span class="ident" id="6683542">Fatalf</span><span class="op" id="6683548">(</span><span class="string" id="6683549">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6683571">,</span>&nbsp;<span class="ident" id="6683573">err</span><span class="op" id="6683576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683580">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683583">}</span><br>
<span class="lineno"></span><span class="op" id="6683585">}</span>
</div>
</body>
</html>
