<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2065276">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2065331">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2065385">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2065436">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2065506">package</span>&nbsp;<span class="ident" id="2065514">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2065518">import</span>&nbsp;<span class="op" id="2065525">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2065528">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2065539">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2065554">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2065564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2065567">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2065611">type</span>&nbsp;<span class="ident" id="2065616">File</span>&nbsp;<span class="keyword" id="2065621">struct</span>&nbsp;<span class="op" id="2065628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2065631">*</span><span class="ident" id="2065632"><a href="/os/file_unix.go.html#2065853">file</a></span><br>
<span class="lineno"></span><span class="op" id="2065637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2065640">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2065685">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2065749">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2065809">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2065848">type</span>&nbsp;<span class="ident" id="2065853">file</span>&nbsp;<span class="keyword" id="2065858">struct</span>&nbsp;<span class="op" id="2065865">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065868">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2065876">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065881">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2065889">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065897">dirinfo</span>&nbsp;<span class="op" id="2065905">*</span><span class="ident" id="2065906"><a href="/os/file_unix.go.html#2066593">dirInfo</a></span>&nbsp;<span class="comment" id="2065914">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065950">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2065958">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2065967">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2066007">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2066010">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2066084">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2066172">func</span>&nbsp;<span class="op" id="2066177">(</span><span class="ident" id="2066178">f</span>&nbsp;<span class="op" id="2066180">*</span><span class="ident" id="2066181"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2066185">)</span>&nbsp;<span class="ident" id="2066187">Fd</span><span class="op" id="2066189">(</span><span class="op" id="2066190">)</span>&nbsp;<span class="builtintype" id="2066192">uintptr</span>&nbsp;<span class="op" id="2066200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066203">if</span>&nbsp;<span class="ident" id="2066206"><a href="/os/file_unix.go.html#2066178">f</a></span>&nbsp;<span class="op" id="2066208">==</span>&nbsp;<span class="ident" id="2066211">nil</span>&nbsp;<span class="op" id="2066215">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066219">return</span>&nbsp;<span class="op" id="2066226">^</span><span class="op" id="2066227">(</span><span class="builtintype" id="2066228">uintptr</span><span class="op" id="2066235">(</span><span class="num" id="2066236">0</span><span class="op" id="2066237">)</span><span class="op" id="2066238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2066241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066244">return</span>&nbsp;<span class="builtintype" id="2066251">uintptr</span><span class="op" id="2066258">(</span><span class="ident" id="2066259"><a href="/os/file_unix.go.html#2066178">f</a></span><span class="op" id="2066260">.</span><span class="ident" id="2066261">fd</span><span class="op" id="2066263">)</span><br>
<span class="lineno"></span><span class="op" id="2066265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2066268">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2066339">func</span>&nbsp;<span class="ident" id="2066344">NewFile</span><span class="op" id="2066351">(</span><span class="ident" id="2066352">fd</span>&nbsp;<span class="builtintype" id="2066355">uintptr</span><span class="op" id="2066362">,</span>&nbsp;<span class="ident" id="2066364">name</span>&nbsp;<span class="builtintype" id="2066369">string</span><span class="op" id="2066375">)</span>&nbsp;<span class="op" id="2066377">*</span><span class="ident" id="2066378"><a href="/os/file_unix.go.html#2065616">File</a></span>&nbsp;<span class="op" id="2066383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066386">fdi</span>&nbsp;<span class="op" id="2066390">:=</span>&nbsp;<span class="builtintype" id="2066393">int</span><span class="op" id="2066396">(</span><span class="ident" id="2066397"><a href="/os/file_unix.go.html#2066352">fd</a></span><span class="op" id="2066399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066402">if</span>&nbsp;<span class="ident" id="2066405"><a href="/os/file_unix.go.html#2066386">fdi</a></span>&nbsp;<span class="op" id="2066409">&lt;</span>&nbsp;<span class="num" id="2066411">0</span>&nbsp;<span class="op" id="2066413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066417">return</span>&nbsp;<span class="ident" id="2066424">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2066429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066432">f</span>&nbsp;<span class="op" id="2066434">:=</span>&nbsp;<span class="op" id="2066437">&amp;</span><span class="ident" id="2066438"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2066442">{</span><span class="op" id="2066443">&amp;</span><span class="ident" id="2066444"><a href="/os/file_unix.go.html#2065853">file</a></span><span class="op" id="2066448">{</span><span class="ident" id="2066449">fd</span><span class="op" id="2066451">:</span>&nbsp;<span class="ident" id="2066453"><a href="/os/file_unix.go.html#2066386">fdi</a></span><span class="op" id="2066456">,</span>&nbsp;<span class="ident" id="2066458">name</span><span class="op" id="2066462">:</span>&nbsp;<span class="ident" id="2066464"><a href="/os/file_unix.go.html#2066364">name</a></span><span class="op" id="2066468">}</span><span class="op" id="2066469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066472"><a href="/os/file_unix.go.html#2065528">runtime</a></span><span class="op" id="2066479">.</span><span class="ident" id="2066480">SetFinalizer</span><span class="op" id="2066492">(</span><span class="ident" id="2066493"><a href="/os/file_unix.go.html#2066432">f</a></span><span class="op" id="2066494">.</span><span class="ident" id="2066495">file</span><span class="op" id="2066499">,</span>&nbsp;<span class="op" id="2066501">(</span><span class="op" id="2066502">*</span><span class="ident" id="2066503"><a href="/os/file_unix.go.html#2065853">file</a></span><span class="op" id="2066507">)</span><span class="op" id="2066508">.</span><span class="builtinfunc" id="2066509">close</span><span class="op" id="2066514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066517">return</span>&nbsp;<span class="ident" id="2066524"><a href="/os/file_unix.go.html#2066432">f</a></span><br>
<span class="lineno"></span><span class="op" id="2066526">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2066529">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2066588">type</span>&nbsp;<span class="ident" id="2066593">dirInfo</span>&nbsp;<span class="keyword" id="2066601">struct</span>&nbsp;<span class="op" id="2066608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066611">buf</span>&nbsp;&nbsp;<span class="op" id="2066616">[</span><span class="op" id="2066617">]</span><span class="builtintype" id="2066618">byte</span>&nbsp;<span class="comment" id="2066623">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066652">nbuf</span>&nbsp;<span class="builtintype" id="2066657">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2066664">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066715">bufp</span>&nbsp;<span class="builtintype" id="2066720">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2066727">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2066762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2066765">func</span>&nbsp;<span class="ident" id="2066770">epipecheck</span><span class="op" id="2066780">(</span><span class="ident" id="2066781">file</span>&nbsp;<span class="op" id="2066786">*</span><span class="ident" id="2066787"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2066791">,</span>&nbsp;<span class="ident" id="2066793">e</span>&nbsp;<span class="builtintype" id="2066795">error</span><span class="op" id="2066800">)</span>&nbsp;<span class="op" id="2066802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066805">if</span>&nbsp;<span class="ident" id="2066808"><a href="/os/file_unix.go.html#2066793">e</a></span>&nbsp;<span class="op" id="2066810">==</span>&nbsp;<span class="ident" id="2066813"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2066820">.</span><span class="ident" id="2066821">EPIPE</span>&nbsp;<span class="op" id="2066827">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066831">if</span>&nbsp;<span class="ident" id="2066834"><a href="/os/file_unix.go.html#2065539">atomic</a></span><span class="op" id="2066840">.</span><span class="ident" id="2066841">AddInt32</span><span class="op" id="2066849">(</span><span class="op" id="2066850">&amp;</span><span class="ident" id="2066851"><a href="/os/file_unix.go.html#2066781">file</a></span><span class="op" id="2066855">.</span><span class="ident" id="2066856">nepipe</span><span class="op" id="2066862">,</span>&nbsp;<span class="num" id="2066864">1</span><span class="op" id="2066865">)</span>&nbsp;<span class="op" id="2066867">&gt;=</span>&nbsp;<span class="num" id="2066870">10</span>&nbsp;<span class="op" id="2066873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066878"><a href="/os/file_posix.go.html#2061371">sigpipe</a></span><span class="op" id="2066885">(</span><span class="op" id="2066886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2066890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2066893">}</span>&nbsp;<span class="keyword" id="2066895">else</span>&nbsp;<span class="op" id="2066900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066904"><a href="/os/file_unix.go.html#2065539">atomic</a></span><span class="op" id="2066910">.</span><span class="ident" id="2066911">StoreInt32</span><span class="op" id="2066921">(</span><span class="op" id="2066922">&amp;</span><span class="ident" id="2066923"><a href="/os/file_unix.go.html#2066781">file</a></span><span class="op" id="2066927">.</span><span class="ident" id="2066928">nepipe</span><span class="op" id="2066934">,</span>&nbsp;<span class="num" id="2066936">0</span><span class="op" id="2066937">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2066940">}</span><br>
<span class="lineno"></span><span class="op" id="2066942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2066945">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2067011">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2067074">const</span>&nbsp;<span class="ident" id="2067080">DevNull</span>&nbsp;<span class="op" id="2067088">=</span>&nbsp;<span class="string" id="2067090">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2067103">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2067170">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2067237">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2067309">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2067362">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2067418">func</span>&nbsp;<span class="ident" id="2067423">OpenFile</span><span class="op" id="2067431">(</span><span class="ident" id="2067432">name</span>&nbsp;<span class="builtintype" id="2067437">string</span><span class="op" id="2067443">,</span>&nbsp;<span class="ident" id="2067445">flag</span>&nbsp;<span class="builtintype" id="2067450">int</span><span class="op" id="2067453">,</span>&nbsp;<span class="ident" id="2067455">perm</span>&nbsp;<span class="ident" id="2067460"><a href="/os/types.go.html#2086441">FileMode</a></span><span class="op" id="2067468">)</span>&nbsp;<span class="op" id="2067470">(</span><span class="ident" id="2067471">file</span>&nbsp;<span class="op" id="2067476">*</span><span class="ident" id="2067477"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2067481">,</span>&nbsp;<span class="ident" id="2067483">err</span>&nbsp;<span class="builtintype" id="2067487">error</span><span class="op" id="2067492">)</span>&nbsp;<span class="op" id="2067494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067497">r</span><span class="op" id="2067498">,</span>&nbsp;<span class="ident" id="2067500">e</span>&nbsp;<span class="op" id="2067502">:=</span>&nbsp;<span class="ident" id="2067505"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2067512">.</span><span class="ident" id="2067513">Open</span><span class="op" id="2067517">(</span><span class="ident" id="2067518"><a href="/os/file_unix.go.html#2067432">name</a></span><span class="op" id="2067522">,</span>&nbsp;<span class="ident" id="2067524"><a href="/os/file_unix.go.html#2067445">flag</a></span><span class="op" id="2067528">|</span><span class="ident" id="2067529"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2067536">.</span><span class="ident" id="2067537">O_CLOEXEC</span><span class="op" id="2067546">,</span>&nbsp;<span class="ident" id="2067548"><a href="/os/file_posix.go.html#2062060">syscallMode</a></span><span class="op" id="2067559">(</span><span class="ident" id="2067560"><a href="/os/file_unix.go.html#2067455">perm</a></span><span class="op" id="2067564">)</span><span class="op" id="2067565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067568">if</span>&nbsp;<span class="ident" id="2067571"><a href="/os/file_unix.go.html#2067500">e</a></span>&nbsp;<span class="op" id="2067573">!=</span>&nbsp;<span class="ident" id="2067576">nil</span>&nbsp;<span class="op" id="2067580">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067584">return</span>&nbsp;<span class="ident" id="2067591">nil</span><span class="op" id="2067594">,</span>&nbsp;<span class="op" id="2067596">&amp;</span><span class="ident" id="2067597"><a href="/os/error.go.html#2044260">PathError</a></span><span class="op" id="2067606">{</span><span class="string" id="2067607">&#34;open&#34;</span><span class="op" id="2067613">,</span>&nbsp;<span class="ident" id="2067615"><a href="/os/file_unix.go.html#2067432">name</a></span><span class="op" id="2067619">,</span>&nbsp;<span class="ident" id="2067621"><a href="/os/file_unix.go.html#2067500">e</a></span><span class="op" id="2067622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2067629">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2067682">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067738">if</span>&nbsp;<span class="op" id="2067741">!</span><span class="ident" id="2067742"><a href="/os/sys_unix.go.html#2085364">supportsCloseOnExec</a></span>&nbsp;<span class="op" id="2067762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067766"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2067773">.</span><span class="ident" id="2067774">CloseOnExec</span><span class="op" id="2067785">(</span><span class="ident" id="2067786"><a href="/os/file_unix.go.html#2067497">r</a></span><span class="op" id="2067787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067794">return</span>&nbsp;<span class="ident" id="2067801"><a href="/os/file_unix.go.html#2066344">NewFile</a></span><span class="op" id="2067808">(</span><span class="builtintype" id="2067809">uintptr</span><span class="op" id="2067816">(</span><span class="ident" id="2067817"><a href="/os/file_unix.go.html#2067497">r</a></span><span class="op" id="2067818">)</span><span class="op" id="2067819">,</span>&nbsp;<span class="ident" id="2067821"><a href="/os/file_unix.go.html#2067432">name</a></span><span class="op" id="2067825">)</span><span class="op" id="2067826">,</span>&nbsp;<span class="ident" id="2067828">nil</span><br>
<span class="lineno">90</span><span class="op" id="2067832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2067835">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2067892">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2067924">func</span>&nbsp;<span class="op" id="2067929">(</span><span class="ident" id="2067930">f</span>&nbsp;<span class="op" id="2067932">*</span><span class="ident" id="2067933"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2067937">)</span>&nbsp;<span class="ident" id="2067939">Close</span><span class="op" id="2067944">(</span><span class="op" id="2067945">)</span>&nbsp;<span class="builtintype" id="2067947">error</span>&nbsp;<span class="op" id="2067953">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067956">if</span>&nbsp;<span class="ident" id="2067959"><a href="/os/file_unix.go.html#2067930">f</a></span>&nbsp;<span class="op" id="2067961">==</span>&nbsp;<span class="ident" id="2067964">nil</span>&nbsp;<span class="op" id="2067968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067972">return</span>&nbsp;<span class="ident" id="2067979"><a href="/os/error.go.html#2043976">ErrInvalid</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067994">return</span>&nbsp;<span class="ident" id="2068001"><a href="/os/file_unix.go.html#2067930">f</a></span><span class="op" id="2068002">.</span><span class="ident" id="2068003">file</span><span class="op" id="2068007">.</span><span class="builtinfunc" id="2068008">close</span><span class="op" id="2068013">(</span><span class="op" id="2068014">)</span><br>
<span class="lineno"></span><span class="op" id="2068016">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2068019">func</span>&nbsp;<span class="op" id="2068024">(</span><span class="ident" id="2068025">file</span>&nbsp;<span class="op" id="2068030">*</span><span class="ident" id="2068031"><a href="/os/file_unix.go.html#2065853">file</a></span><span class="op" id="2068035">)</span>&nbsp;<span class="builtinfunc" id="2068037">close</span><span class="op" id="2068042">(</span><span class="op" id="2068043">)</span>&nbsp;<span class="builtintype" id="2068045">error</span>&nbsp;<span class="op" id="2068051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068054">if</span>&nbsp;<span class="ident" id="2068057"><a href="/os/file_unix.go.html#2068025">file</a></span>&nbsp;<span class="op" id="2068062">==</span>&nbsp;<span class="ident" id="2068065">nil</span>&nbsp;<span class="op" id="2068069">||</span>&nbsp;<span class="ident" id="2068072"><a href="/os/file_unix.go.html#2068025">file</a></span><span class="op" id="2068076">.</span><span class="ident" id="2068077">fd</span>&nbsp;<span class="op" id="2068080">&lt;</span>&nbsp;<span class="num" id="2068082">0</span>&nbsp;<span class="op" id="2068084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068088">return</span>&nbsp;<span class="ident" id="2068095"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2068102">.</span><span class="ident" id="2068103">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068111">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068114">var</span>&nbsp;<span class="ident" id="2068118">err</span>&nbsp;<span class="builtintype" id="2068122">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068129">if</span>&nbsp;<span class="ident" id="2068132">e</span>&nbsp;<span class="op" id="2068134">:=</span>&nbsp;<span class="ident" id="2068137"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2068144">.</span><span class="ident" id="2068145">Close</span><span class="op" id="2068150">(</span><span class="ident" id="2068151"><a href="/os/file_unix.go.html#2068025">file</a></span><span class="op" id="2068155">.</span><span class="ident" id="2068156">fd</span><span class="op" id="2068158">)</span><span class="op" id="2068159">;</span>&nbsp;<span class="ident" id="2068161"><a href="/os/file_unix.go.html#2068132">e</a></span>&nbsp;<span class="op" id="2068163">!=</span>&nbsp;<span class="ident" id="2068166">nil</span>&nbsp;<span class="op" id="2068170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068174"><a href="/os/file_unix.go.html#2068118">err</a></span>&nbsp;<span class="op" id="2068178">=</span>&nbsp;<span class="op" id="2068180">&amp;</span><span class="ident" id="2068181"><a href="/os/error.go.html#2044260">PathError</a></span><span class="op" id="2068190">{</span><span class="string" id="2068191">&#34;close&#34;</span><span class="op" id="2068198">,</span>&nbsp;<span class="ident" id="2068200"><a href="/os/file_unix.go.html#2068025">file</a></span><span class="op" id="2068204">.</span><span class="ident" id="2068205">name</span><span class="op" id="2068209">,</span>&nbsp;<span class="ident" id="2068211"><a href="/os/file_unix.go.html#2068132">e</a></span><span class="op" id="2068212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068218"><a href="/os/file_unix.go.html#2068025">file</a></span><span class="op" id="2068222">.</span><span class="ident" id="2068223">fd</span>&nbsp;<span class="op" id="2068226">=</span>&nbsp;<span class="op" id="2068228">-</span><span class="num" id="2068229">1</span>&nbsp;<span class="comment" id="2068231">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2068264">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068300"><a href="/os/file_unix.go.html#2065528">runtime</a></span><span class="op" id="2068307">.</span><span class="ident" id="2068308">SetFinalizer</span><span class="op" id="2068320">(</span><span class="ident" id="2068321"><a href="/os/file_unix.go.html#2068025">file</a></span><span class="op" id="2068325">,</span>&nbsp;<span class="ident" id="2068327">nil</span><span class="op" id="2068330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068333">return</span>&nbsp;<span class="ident" id="2068340"><a href="/os/file_unix.go.html#2068118">err</a></span><br>
<span class="lineno"></span><span class="op" id="2068344">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2068347">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2068403">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2068459">func</span>&nbsp;<span class="op" id="2068464">(</span><span class="ident" id="2068465">f</span>&nbsp;<span class="op" id="2068467">*</span><span class="ident" id="2068468"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2068472">)</span>&nbsp;<span class="ident" id="2068474">Stat</span><span class="op" id="2068478">(</span><span class="op" id="2068479">)</span>&nbsp;<span class="op" id="2068481">(</span><span class="ident" id="2068482">fi</span>&nbsp;<span class="ident" id="2068485"><a href="/os/types.go.html#2085788">FileInfo</a></span><span class="op" id="2068493">,</span>&nbsp;<span class="ident" id="2068495">err</span>&nbsp;<span class="builtintype" id="2068499">error</span><span class="op" id="2068504">)</span>&nbsp;<span class="op" id="2068506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068509">if</span>&nbsp;<span class="ident" id="2068512"><a href="/os/file_unix.go.html#2068465">f</a></span>&nbsp;<span class="op" id="2068514">==</span>&nbsp;<span class="ident" id="2068517">nil</span>&nbsp;<span class="op" id="2068521">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068525">return</span>&nbsp;<span class="ident" id="2068532">nil</span><span class="op" id="2068535">,</span>&nbsp;<span class="ident" id="2068537"><a href="/os/error.go.html#2043976">ErrInvalid</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068552">var</span>&nbsp;<span class="ident" id="2068556">stat</span>&nbsp;<span class="ident" id="2068561"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2068568">.</span><span class="ident" id="2068569">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068577"><a href="/os/file_unix.go.html#2068495">err</a></span>&nbsp;<span class="op" id="2068581">=</span>&nbsp;<span class="ident" id="2068583"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2068590">.</span><span class="ident" id="2068591">Fstat</span><span class="op" id="2068596">(</span><span class="ident" id="2068597"><a href="/os/file_unix.go.html#2068465">f</a></span><span class="op" id="2068598">.</span><span class="ident" id="2068599">fd</span><span class="op" id="2068601">,</span>&nbsp;<span class="op" id="2068603">&amp;</span><span class="ident" id="2068604"><a href="/os/file_unix.go.html#2068556">stat</a></span><span class="op" id="2068608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068611">if</span>&nbsp;<span class="ident" id="2068614"><a href="/os/file_unix.go.html#2068495">err</a></span>&nbsp;<span class="op" id="2068618">!=</span>&nbsp;<span class="ident" id="2068621">nil</span>&nbsp;<span class="op" id="2068625">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068629">return</span>&nbsp;<span class="ident" id="2068636">nil</span><span class="op" id="2068639">,</span>&nbsp;<span class="op" id="2068641">&amp;</span><span class="ident" id="2068642"><a href="/os/error.go.html#2044260">PathError</a></span><span class="op" id="2068651">{</span><span class="string" id="2068652">&#34;stat&#34;</span><span class="op" id="2068658">,</span>&nbsp;<span class="ident" id="2068660"><a href="/os/file_unix.go.html#2068465">f</a></span><span class="op" id="2068661">.</span><span class="ident" id="2068662">name</span><span class="op" id="2068666">,</span>&nbsp;<span class="ident" id="2068668"><a href="/os/file_unix.go.html#2068495">err</a></span><span class="op" id="2068671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068677">return</span>&nbsp;<span class="ident" id="2068684"><a href="/os/stat_linux.go.html#2083514">fileInfoFromStat</a></span><span class="op" id="2068700">(</span><span class="op" id="2068701">&amp;</span><span class="ident" id="2068702"><a href="/os/file_unix.go.html#2068556">stat</a></span><span class="op" id="2068706">,</span>&nbsp;<span class="ident" id="2068708"><a href="/os/file_unix.go.html#2068465">f</a></span><span class="op" id="2068709">.</span><span class="ident" id="2068710">name</span><span class="op" id="2068714">)</span><span class="op" id="2068715">,</span>&nbsp;<span class="ident" id="2068717">nil</span><br>
<span class="lineno"></span><span class="op" id="2068721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2068724">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2068778">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2068834">func</span>&nbsp;<span class="ident" id="2068839">Stat</span><span class="op" id="2068843">(</span><span class="ident" id="2068844">name</span>&nbsp;<span class="builtintype" id="2068849">string</span><span class="op" id="2068855">)</span>&nbsp;<span class="op" id="2068857">(</span><span class="ident" id="2068858">fi</span>&nbsp;<span class="ident" id="2068861"><a href="/os/types.go.html#2085788">FileInfo</a></span><span class="op" id="2068869">,</span>&nbsp;<span class="ident" id="2068871">err</span>&nbsp;<span class="builtintype" id="2068875">error</span><span class="op" id="2068880">)</span>&nbsp;<span class="op" id="2068882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068885">var</span>&nbsp;<span class="ident" id="2068889">stat</span>&nbsp;<span class="ident" id="2068894"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2068901">.</span><span class="ident" id="2068902">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068910"><a href="/os/file_unix.go.html#2068871">err</a></span>&nbsp;<span class="op" id="2068914">=</span>&nbsp;<span class="ident" id="2068916"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2068923">.</span><span class="ident" id="2068924">Stat</span><span class="op" id="2068928">(</span><span class="ident" id="2068929"><a href="/os/file_unix.go.html#2068844">name</a></span><span class="op" id="2068933">,</span>&nbsp;<span class="op" id="2068935">&amp;</span><span class="ident" id="2068936"><a href="/os/file_unix.go.html#2068889">stat</a></span><span class="op" id="2068940">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068943">if</span>&nbsp;<span class="ident" id="2068946"><a href="/os/file_unix.go.html#2068871">err</a></span>&nbsp;<span class="op" id="2068950">!=</span>&nbsp;<span class="ident" id="2068953">nil</span>&nbsp;<span class="op" id="2068957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068961">return</span>&nbsp;<span class="ident" id="2068968">nil</span><span class="op" id="2068971">,</span>&nbsp;<span class="op" id="2068973">&amp;</span><span class="ident" id="2068974"><a href="/os/error.go.html#2044260">PathError</a></span><span class="op" id="2068983">{</span><span class="string" id="2068984">&#34;stat&#34;</span><span class="op" id="2068990">,</span>&nbsp;<span class="ident" id="2068992"><a href="/os/file_unix.go.html#2068844">name</a></span><span class="op" id="2068996">,</span>&nbsp;<span class="ident" id="2068998"><a href="/os/file_unix.go.html#2068871">err</a></span><span class="op" id="2069001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069007">return</span>&nbsp;<span class="ident" id="2069014"><a href="/os/stat_linux.go.html#2083514">fileInfoFromStat</a></span><span class="op" id="2069030">(</span><span class="op" id="2069031">&amp;</span><span class="ident" id="2069032"><a href="/os/file_unix.go.html#2068889">stat</a></span><span class="op" id="2069036">,</span>&nbsp;<span class="ident" id="2069038"><a href="/os/file_unix.go.html#2068844">name</a></span><span class="op" id="2069042">)</span><span class="op" id="2069043">,</span>&nbsp;<span class="ident" id="2069045">nil</span><br>
<span class="lineno"></span><span class="op" id="2069049">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2069052">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2069107">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2069164">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2069240">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2069296">func</span>&nbsp;<span class="ident" id="2069301">Lstat</span><span class="op" id="2069306">(</span><span class="ident" id="2069307">name</span>&nbsp;<span class="builtintype" id="2069312">string</span><span class="op" id="2069318">)</span>&nbsp;<span class="op" id="2069320">(</span><span class="ident" id="2069321">fi</span>&nbsp;<span class="ident" id="2069324"><a href="/os/types.go.html#2085788">FileInfo</a></span><span class="op" id="2069332">,</span>&nbsp;<span class="ident" id="2069334">err</span>&nbsp;<span class="builtintype" id="2069338">error</span><span class="op" id="2069343">)</span>&nbsp;<span class="op" id="2069345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069348">var</span>&nbsp;<span class="ident" id="2069352">stat</span>&nbsp;<span class="ident" id="2069357"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2069364">.</span><span class="ident" id="2069365">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069373"><a href="/os/file_unix.go.html#2069334">err</a></span>&nbsp;<span class="op" id="2069377">=</span>&nbsp;<span class="ident" id="2069379"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2069386">.</span><span class="ident" id="2069387">Lstat</span><span class="op" id="2069392">(</span><span class="ident" id="2069393"><a href="/os/file_unix.go.html#2069307">name</a></span><span class="op" id="2069397">,</span>&nbsp;<span class="op" id="2069399">&amp;</span><span class="ident" id="2069400"><a href="/os/file_unix.go.html#2069352">stat</a></span><span class="op" id="2069404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069407">if</span>&nbsp;<span class="ident" id="2069410"><a href="/os/file_unix.go.html#2069334">err</a></span>&nbsp;<span class="op" id="2069414">!=</span>&nbsp;<span class="ident" id="2069417">nil</span>&nbsp;<span class="op" id="2069421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069425">return</span>&nbsp;<span class="ident" id="2069432">nil</span><span class="op" id="2069435">,</span>&nbsp;<span class="op" id="2069437">&amp;</span><span class="ident" id="2069438"><a href="/os/error.go.html#2044260">PathError</a></span><span class="op" id="2069447">{</span><span class="string" id="2069448">&#34;lstat&#34;</span><span class="op" id="2069455">,</span>&nbsp;<span class="ident" id="2069457"><a href="/os/file_unix.go.html#2069307">name</a></span><span class="op" id="2069461">,</span>&nbsp;<span class="ident" id="2069463"><a href="/os/file_unix.go.html#2069334">err</a></span><span class="op" id="2069466">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069472">return</span>&nbsp;<span class="ident" id="2069479"><a href="/os/stat_linux.go.html#2083514">fileInfoFromStat</a></span><span class="op" id="2069495">(</span><span class="op" id="2069496">&amp;</span><span class="ident" id="2069497"><a href="/os/file_unix.go.html#2069352">stat</a></span><span class="op" id="2069501">,</span>&nbsp;<span class="ident" id="2069503"><a href="/os/file_unix.go.html#2069307">name</a></span><span class="op" id="2069507">)</span><span class="op" id="2069508">,</span>&nbsp;<span class="ident" id="2069510">nil</span><br>
<span class="lineno"></span><span class="op" id="2069514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2069517">func</span>&nbsp;<span class="op" id="2069522">(</span><span class="ident" id="2069523">f</span>&nbsp;<span class="op" id="2069525">*</span><span class="ident" id="2069526"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2069530">)</span>&nbsp;<span class="ident" id="2069532">readdir</span><span class="op" id="2069539">(</span><span class="ident" id="2069540">n</span>&nbsp;<span class="builtintype" id="2069542">int</span><span class="op" id="2069545">)</span>&nbsp;<span class="op" id="2069547">(</span><span class="ident" id="2069548">fi</span>&nbsp;<span class="op" id="2069551">[</span><span class="op" id="2069552">]</span><span class="ident" id="2069553"><a href="/os/types.go.html#2085788">FileInfo</a></span><span class="op" id="2069561">,</span>&nbsp;<span class="ident" id="2069563">err</span>&nbsp;<span class="builtintype" id="2069567">error</span><span class="op" id="2069572">)</span>&nbsp;<span class="op" id="2069574">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069577">dirname</span>&nbsp;<span class="op" id="2069585">:=</span>&nbsp;<span class="ident" id="2069588"><a href="/os/file_unix.go.html#2069523">f</a></span><span class="op" id="2069589">.</span><span class="ident" id="2069590">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069596">if</span>&nbsp;<span class="ident" id="2069599"><a href="/os/file_unix.go.html#2069577">dirname</a></span>&nbsp;<span class="op" id="2069607">==</span>&nbsp;<span class="string" id="2069610">&#34;&#34;</span>&nbsp;<span class="op" id="2069613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069617"><a href="/os/file_unix.go.html#2069577">dirname</a></span>&nbsp;<span class="op" id="2069625">=</span>&nbsp;<span class="string" id="2069627">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069635">names</span><span class="op" id="2069640">,</span>&nbsp;<span class="ident" id="2069642"><a href="/os/file_unix.go.html#2069563">err</a></span>&nbsp;<span class="op" id="2069646">:=</span>&nbsp;<span class="ident" id="2069649"><a href="/os/file_unix.go.html#2069523">f</a></span><span class="op" id="2069650">.</span><span class="ident" id="2069651">Readdirnames</span><span class="op" id="2069663">(</span><span class="ident" id="2069664"><a href="/os/file_unix.go.html#2069540">n</a></span><span class="op" id="2069665">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069668"><a href="/os/file_unix.go.html#2069548">fi</a></span>&nbsp;<span class="op" id="2069671">=</span>&nbsp;<span class="builtinfunc" id="2069673">make</span><span class="op" id="2069677">(</span><span class="op" id="2069678">[</span><span class="op" id="2069679">]</span><span class="ident" id="2069680"><a href="/os/types.go.html#2085788">FileInfo</a></span><span class="op" id="2069688">,</span>&nbsp;<span class="num" id="2069690">0</span><span class="op" id="2069691">,</span>&nbsp;<span class="builtinfunc" id="2069693">len</span><span class="op" id="2069696">(</span><span class="ident" id="2069697"><a href="/os/file_unix.go.html#2069635">names</a></span><span class="op" id="2069702">)</span><span class="op" id="2069703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069706">for</span>&nbsp;<span class="ident" id="2069710">_</span><span class="op" id="2069711">,</span>&nbsp;<span class="ident" id="2069713">filename</span>&nbsp;<span class="op" id="2069722">:=</span>&nbsp;<span class="keyword" id="2069725">range</span>&nbsp;<span class="ident" id="2069731"><a href="/os/file_unix.go.html#2069635">names</a></span>&nbsp;<span class="op" id="2069737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069741">fip</span><span class="op" id="2069744">,</span>&nbsp;<span class="ident" id="2069746">lerr</span>&nbsp;<span class="op" id="2069751">:=</span>&nbsp;<span class="ident" id="2069754"><a href="/os/file.go.html#2060693">lstat</a></span><span class="op" id="2069759">(</span><span class="ident" id="2069760"><a href="/os/file_unix.go.html#2069577">dirname</a></span>&nbsp;<span class="op" id="2069768">+</span>&nbsp;<span class="string" id="2069770">&#34;/&#34;</span>&nbsp;<span class="op" id="2069774">+</span>&nbsp;<span class="ident" id="2069776"><a href="/os/file_unix.go.html#2069713">filename</a></span><span class="op" id="2069784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069788">if</span>&nbsp;<span class="ident" id="2069791"><a href="/os/error.go.html#2045357">IsNotExist</a></span><span class="op" id="2069801">(</span><span class="ident" id="2069802"><a href="/os/file_unix.go.html#2069746">lerr</a></span><span class="op" id="2069806">)</span>&nbsp;<span class="op" id="2069808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2069813">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2069860">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069903">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069918">if</span>&nbsp;<span class="ident" id="2069921"><a href="/os/file_unix.go.html#2069746">lerr</a></span>&nbsp;<span class="op" id="2069926">!=</span>&nbsp;<span class="ident" id="2069929">nil</span>&nbsp;<span class="op" id="2069933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069938">return</span>&nbsp;<span class="ident" id="2069945"><a href="/os/file_unix.go.html#2069548">fi</a></span><span class="op" id="2069947">,</span>&nbsp;<span class="ident" id="2069949"><a href="/os/file_unix.go.html#2069746">lerr</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069960"><a href="/os/file_unix.go.html#2069548">fi</a></span>&nbsp;<span class="op" id="2069963">=</span>&nbsp;<span class="builtinfunc" id="2069965">append</span><span class="op" id="2069971">(</span><span class="ident" id="2069972"><a href="/os/file_unix.go.html#2069548">fi</a></span><span class="op" id="2069974">,</span>&nbsp;<span class="ident" id="2069976"><a href="/os/file_unix.go.html#2069741">fip</a></span><span class="op" id="2069979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069985">return</span>&nbsp;<span class="ident" id="2069992"><a href="/os/file_unix.go.html#2069548">fi</a></span><span class="op" id="2069994">,</span>&nbsp;<span class="ident" id="2069996"><a href="/os/file_unix.go.html#2069563">err</a></span><br>
<span class="lineno"></span><span class="op" id="2070000">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2070003">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2070061">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2070115">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2070169">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2070187">const</span>&nbsp;<span class="op" id="2070193">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070196">needsMaxRW</span>&nbsp;<span class="op" id="2070207">=</span>&nbsp;<span class="ident" id="2070209"><a href="/os/file_unix.go.html#2065528">runtime</a></span><span class="op" id="2070216">.</span><span class="ident" id="2070217">GOOS</span>&nbsp;<span class="op" id="2070222">==</span>&nbsp;<span class="string" id="2070225">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2070234">||</span>&nbsp;<span class="ident" id="2070237"><a href="/os/file_unix.go.html#2065528">runtime</a></span><span class="op" id="2070244">.</span><span class="ident" id="2070245">GOOS</span>&nbsp;<span class="op" id="2070250">==</span>&nbsp;<span class="string" id="2070253">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070264">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2070275">=</span>&nbsp;<span class="num" id="2070277">1</span>&nbsp;<span class="op" id="2070279">&lt;&lt;</span>&nbsp;<span class="num" id="2070282">30</span><br>
<span class="lineno"></span><span class="op" id="2070285">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2070288">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2070336">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2070397">func</span>&nbsp;<span class="op" id="2070402">(</span><span class="ident" id="2070403">f</span>&nbsp;<span class="op" id="2070405">*</span><span class="ident" id="2070406"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2070410">)</span>&nbsp;<span class="ident" id="2070412">read</span><span class="op" id="2070416">(</span><span class="ident" id="2070417">b</span>&nbsp;<span class="op" id="2070419">[</span><span class="op" id="2070420">]</span><span class="builtintype" id="2070421">byte</span><span class="op" id="2070425">)</span>&nbsp;<span class="op" id="2070427">(</span><span class="ident" id="2070428">n</span>&nbsp;<span class="builtintype" id="2070430">int</span><span class="op" id="2070433">,</span>&nbsp;<span class="ident" id="2070435">err</span>&nbsp;<span class="builtintype" id="2070439">error</span><span class="op" id="2070444">)</span>&nbsp;<span class="op" id="2070446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070449">if</span>&nbsp;<span class="ident" id="2070452"><a href="/os/file_unix.go.html#2070196">needsMaxRW</a></span>&nbsp;<span class="op" id="2070463">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2070466">len</span><span class="op" id="2070469">(</span><span class="ident" id="2070470"><a href="/os/file_unix.go.html#2070417">b</a></span><span class="op" id="2070471">)</span>&nbsp;<span class="op" id="2070473">&gt;</span>&nbsp;<span class="ident" id="2070475"><a href="/os/file_unix.go.html#2070264">maxRW</a></span>&nbsp;<span class="op" id="2070481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070485"><a href="/os/file_unix.go.html#2070417">b</a></span>&nbsp;<span class="op" id="2070487">=</span>&nbsp;<span class="ident" id="2070489"><a href="/os/file_unix.go.html#2070417">b</a></span><span class="op" id="2070490">[</span><span class="op" id="2070491">:</span><span class="ident" id="2070492"><a href="/os/file_unix.go.html#2070264">maxRW</a></span><span class="op" id="2070497">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070503">return</span>&nbsp;<span class="ident" id="2070510"><a href="/os/file.go.html#2061002">fixCount</a></span><span class="op" id="2070518">(</span><span class="ident" id="2070519"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2070526">.</span><span class="ident" id="2070527">Read</span><span class="op" id="2070531">(</span><span class="ident" id="2070532"><a href="/os/file_unix.go.html#2070403">f</a></span><span class="op" id="2070533">.</span><span class="ident" id="2070534">fd</span><span class="op" id="2070536">,</span>&nbsp;<span class="ident" id="2070538"><a href="/os/file_unix.go.html#2070417">b</a></span><span class="op" id="2070539">)</span><span class="op" id="2070540">)</span><br>
<span class="lineno"></span><span class="op" id="2070542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2070545">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2070616">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2070678">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2070734">func</span>&nbsp;<span class="op" id="2070739">(</span><span class="ident" id="2070740">f</span>&nbsp;<span class="op" id="2070742">*</span><span class="ident" id="2070743"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2070747">)</span>&nbsp;<span class="ident" id="2070749">pread</span><span class="op" id="2070754">(</span><span class="ident" id="2070755">b</span>&nbsp;<span class="op" id="2070757">[</span><span class="op" id="2070758">]</span><span class="builtintype" id="2070759">byte</span><span class="op" id="2070763">,</span>&nbsp;<span class="ident" id="2070765">off</span>&nbsp;<span class="ident" id="2070769">int64</span><span class="op" id="2070774">)</span>&nbsp;<span class="op" id="2070776">(</span><span class="ident" id="2070777">n</span>&nbsp;<span class="builtintype" id="2070779">int</span><span class="op" id="2070782">,</span>&nbsp;<span class="ident" id="2070784">err</span>&nbsp;<span class="builtintype" id="2070788">error</span><span class="op" id="2070793">)</span>&nbsp;<span class="op" id="2070795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070798">if</span>&nbsp;<span class="ident" id="2070801"><a href="/os/file_unix.go.html#2070196">needsMaxRW</a></span>&nbsp;<span class="op" id="2070812">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2070815">len</span><span class="op" id="2070818">(</span><span class="ident" id="2070819"><a href="/os/file_unix.go.html#2070755">b</a></span><span class="op" id="2070820">)</span>&nbsp;<span class="op" id="2070822">&gt;</span>&nbsp;<span class="ident" id="2070824"><a href="/os/file_unix.go.html#2070264">maxRW</a></span>&nbsp;<span class="op" id="2070830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070834"><a href="/os/file_unix.go.html#2070755">b</a></span>&nbsp;<span class="op" id="2070836">=</span>&nbsp;<span class="ident" id="2070838"><a href="/os/file_unix.go.html#2070755">b</a></span><span class="op" id="2070839">[</span><span class="op" id="2070840">:</span><span class="ident" id="2070841"><a href="/os/file_unix.go.html#2070264">maxRW</a></span><span class="op" id="2070846">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070852">return</span>&nbsp;<span class="ident" id="2070859"><a href="/os/file.go.html#2061002">fixCount</a></span><span class="op" id="2070867">(</span><span class="ident" id="2070868"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2070875">.</span><span class="ident" id="2070876">Pread</span><span class="op" id="2070881">(</span><span class="ident" id="2070882"><a href="/os/file_unix.go.html#2070740">f</a></span><span class="op" id="2070883">.</span><span class="ident" id="2070884">fd</span><span class="op" id="2070886">,</span>&nbsp;<span class="ident" id="2070888"><a href="/os/file_unix.go.html#2070755">b</a></span><span class="op" id="2070889">,</span>&nbsp;<span class="ident" id="2070891"><a href="/os/file_unix.go.html#2070765">off</a></span><span class="op" id="2070894">)</span><span class="op" id="2070895">)</span><br>
<span class="lineno"></span><span class="op" id="2070897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2070900">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2070942">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2071006">func</span>&nbsp;<span class="op" id="2071011">(</span><span class="ident" id="2071012">f</span>&nbsp;<span class="op" id="2071014">*</span><span class="ident" id="2071015"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2071019">)</span>&nbsp;<span class="ident" id="2071021">write</span><span class="op" id="2071026">(</span><span class="ident" id="2071027">b</span>&nbsp;<span class="op" id="2071029">[</span><span class="op" id="2071030">]</span><span class="builtintype" id="2071031">byte</span><span class="op" id="2071035">)</span>&nbsp;<span class="op" id="2071037">(</span><span class="ident" id="2071038">n</span>&nbsp;<span class="builtintype" id="2071040">int</span><span class="op" id="2071043">,</span>&nbsp;<span class="ident" id="2071045">err</span>&nbsp;<span class="builtintype" id="2071049">error</span><span class="op" id="2071054">)</span>&nbsp;<span class="op" id="2071056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2071059">for</span>&nbsp;<span class="op" id="2071063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2071067">bcap</span>&nbsp;<span class="op" id="2071072">:=</span>&nbsp;<span class="ident" id="2071075"><a href="/os/file_unix.go.html#2071027">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2071079">if</span>&nbsp;<span class="ident" id="2071082"><a href="/os/file_unix.go.html#2070196">needsMaxRW</a></span>&nbsp;<span class="op" id="2071093">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2071096">len</span><span class="op" id="2071099">(</span><span class="ident" id="2071100"><a href="/os/file_unix.go.html#2071067">bcap</a></span><span class="op" id="2071104">)</span>&nbsp;<span class="op" id="2071106">&gt;</span>&nbsp;<span class="ident" id="2071108"><a href="/os/file_unix.go.html#2070264">maxRW</a></span>&nbsp;<span class="op" id="2071114">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2071119"><a href="/os/file_unix.go.html#2071067">bcap</a></span>&nbsp;<span class="op" id="2071124">=</span>&nbsp;<span class="ident" id="2071126"><a href="/os/file_unix.go.html#2071067">bcap</a></span><span class="op" id="2071130">[</span><span class="op" id="2071131">:</span><span class="ident" id="2071132"><a href="/os/file_unix.go.html#2070264">maxRW</a></span><span class="op" id="2071137">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2071141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2071145">m</span><span class="op" id="2071146">,</span>&nbsp;<span class="ident" id="2071148">err</span>&nbsp;<span class="op" id="2071152">:=</span>&nbsp;<span class="ident" id="2071155"><a href="/os/file.go.html#2061002">fixCount</a></span><span class="op" id="2071163">(</span><span class="ident" id="2071164"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2071171">.</span><span class="ident" id="2071172">Write</span><span class="op" id="2071177">(</span><span class="ident" id="2071178"><a href="/os/file_unix.go.html#2071012">f</a></span><span class="op" id="2071179">.</span><span class="ident" id="2071180">fd</span><span class="op" id="2071182">,</span>&nbsp;<span class="ident" id="2071184"><a href="/os/file_unix.go.html#2071067">bcap</a></span><span class="op" id="2071188">)</span><span class="op" id="2071189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2071193"><a href="/os/file_unix.go.html#2071038">n</a></span>&nbsp;<span class="op" id="2071195">+=</span>&nbsp;<span class="ident" id="2071198"><a href="/os/file_unix.go.html#2071145">m</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2071203">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2071265">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2071325">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2071391">if</span>&nbsp;<span class="num" id="2071394">0</span>&nbsp;<span class="op" id="2071396">&lt;</span>&nbsp;<span class="ident" id="2071398"><a href="/os/file_unix.go.html#2071145">m</a></span>&nbsp;<span class="op" id="2071400">&amp;&amp;</span>&nbsp;<span class="ident" id="2071403"><a href="/os/file_unix.go.html#2071145">m</a></span>&nbsp;<span class="op" id="2071405">&lt;</span>&nbsp;<span class="builtinfunc" id="2071407">len</span><span class="op" id="2071410">(</span><span class="ident" id="2071411"><a href="/os/file_unix.go.html#2071067">bcap</a></span><span class="op" id="2071415">)</span>&nbsp;<span class="op" id="2071417">||</span>&nbsp;<span class="ident" id="2071420"><a href="/os/file_unix.go.html#2071148">err</a></span>&nbsp;<span class="op" id="2071424">==</span>&nbsp;<span class="ident" id="2071427"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2071434">.</span><span class="ident" id="2071435">EINTR</span>&nbsp;<span class="op" id="2071441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2071446"><a href="/os/file_unix.go.html#2071027">b</a></span>&nbsp;<span class="op" id="2071448">=</span>&nbsp;<span class="ident" id="2071450"><a href="/os/file_unix.go.html#2071027">b</a></span><span class="op" id="2071451">[</span><span class="ident" id="2071452"><a href="/os/file_unix.go.html#2071145">m</a></span><span class="op" id="2071453">:</span><span class="op" id="2071454">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2071459">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2071470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2071475">if</span>&nbsp;<span class="ident" id="2071478"><a href="/os/file_unix.go.html#2070196">needsMaxRW</a></span>&nbsp;<span class="op" id="2071489">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2071492">len</span><span class="op" id="2071495">(</span><span class="ident" id="2071496"><a href="/os/file_unix.go.html#2071067">bcap</a></span><span class="op" id="2071500">)</span>&nbsp;<span class="op" id="2071502">!=</span>&nbsp;<span class="builtinfunc" id="2071505">len</span><span class="op" id="2071508">(</span><span class="ident" id="2071509"><a href="/os/file_unix.go.html#2071027">b</a></span><span class="op" id="2071510">)</span>&nbsp;<span class="op" id="2071512">&amp;&amp;</span>&nbsp;<span class="ident" id="2071515"><a href="/os/file_unix.go.html#2071148">err</a></span>&nbsp;<span class="op" id="2071519">==</span>&nbsp;<span class="ident" id="2071522">nil</span>&nbsp;<span class="op" id="2071526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2071531"><a href="/os/file_unix.go.html#2071027">b</a></span>&nbsp;<span class="op" id="2071533">=</span>&nbsp;<span class="ident" id="2071535"><a href="/os/file_unix.go.html#2071027">b</a></span><span class="op" id="2071536">[</span><span class="ident" id="2071537"><a href="/os/file_unix.go.html#2071145">m</a></span><span class="op" id="2071538">:</span><span class="op" id="2071539">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2071544">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2071555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2071560">return</span>&nbsp;<span class="ident" id="2071567"><a href="/os/file_unix.go.html#2071038">n</a></span><span class="op" id="2071568">,</span>&nbsp;<span class="ident" id="2071570"><a href="/os/file_unix.go.html#2071148">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2071575">}</span><br>
<span class="lineno">230</span><span class="op" id="2071577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2071580">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2071651">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2071715">func</span>&nbsp;<span class="op" id="2071720">(</span><span class="ident" id="2071721">f</span>&nbsp;<span class="op" id="2071723">*</span><span class="ident" id="2071724"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2071728">)</span>&nbsp;<span class="ident" id="2071730">pwrite</span><span class="op" id="2071736">(</span><span class="ident" id="2071737">b</span>&nbsp;<span class="op" id="2071739">[</span><span class="op" id="2071740">]</span><span class="builtintype" id="2071741">byte</span><span class="op" id="2071745">,</span>&nbsp;<span class="ident" id="2071747">off</span>&nbsp;<span class="ident" id="2071751">int64</span><span class="op" id="2071756">)</span>&nbsp;<span class="op" id="2071758">(</span><span class="ident" id="2071759">n</span>&nbsp;<span class="builtintype" id="2071761">int</span><span class="op" id="2071764">,</span>&nbsp;<span class="ident" id="2071766">err</span>&nbsp;<span class="builtintype" id="2071770">error</span><span class="op" id="2071775">)</span>&nbsp;<span class="op" id="2071777">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2071780">if</span>&nbsp;<span class="ident" id="2071783"><a href="/os/file_unix.go.html#2070196">needsMaxRW</a></span>&nbsp;<span class="op" id="2071794">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2071797">len</span><span class="op" id="2071800">(</span><span class="ident" id="2071801"><a href="/os/file_unix.go.html#2071737">b</a></span><span class="op" id="2071802">)</span>&nbsp;<span class="op" id="2071804">&gt;</span>&nbsp;<span class="ident" id="2071806"><a href="/os/file_unix.go.html#2070264">maxRW</a></span>&nbsp;<span class="op" id="2071812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2071816"><a href="/os/file_unix.go.html#2071737">b</a></span>&nbsp;<span class="op" id="2071818">=</span>&nbsp;<span class="ident" id="2071820"><a href="/os/file_unix.go.html#2071737">b</a></span><span class="op" id="2071821">[</span><span class="op" id="2071822">:</span><span class="ident" id="2071823"><a href="/os/file_unix.go.html#2070264">maxRW</a></span><span class="op" id="2071828">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2071831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2071834">return</span>&nbsp;<span class="ident" id="2071841"><a href="/os/file.go.html#2061002">fixCount</a></span><span class="op" id="2071849">(</span><span class="ident" id="2071850"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2071857">.</span><span class="ident" id="2071858">Pwrite</span><span class="op" id="2071864">(</span><span class="ident" id="2071865"><a href="/os/file_unix.go.html#2071721">f</a></span><span class="op" id="2071866">.</span><span class="ident" id="2071867">fd</span><span class="op" id="2071869">,</span>&nbsp;<span class="ident" id="2071871"><a href="/os/file_unix.go.html#2071737">b</a></span><span class="op" id="2071872">,</span>&nbsp;<span class="ident" id="2071874"><a href="/os/file_unix.go.html#2071747">off</a></span><span class="op" id="2071877">)</span><span class="op" id="2071878">)</span><br>
<span class="lineno"></span><span class="op" id="2071880">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2071883">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2071965">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2072041">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2072109">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2072160">func</span>&nbsp;<span class="op" id="2072165">(</span><span class="ident" id="2072166">f</span>&nbsp;<span class="op" id="2072168">*</span><span class="ident" id="2072169"><a href="/os/file_unix.go.html#2065616">File</a></span><span class="op" id="2072173">)</span>&nbsp;<span class="ident" id="2072175">seek</span><span class="op" id="2072179">(</span><span class="ident" id="2072180">offset</span>&nbsp;<span class="ident" id="2072187">int64</span><span class="op" id="2072192">,</span>&nbsp;<span class="ident" id="2072194">whence</span>&nbsp;<span class="builtintype" id="2072201">int</span><span class="op" id="2072204">)</span>&nbsp;<span class="op" id="2072206">(</span><span class="ident" id="2072207">ret</span>&nbsp;<span class="ident" id="2072211">int64</span><span class="op" id="2072216">,</span>&nbsp;<span class="ident" id="2072218">err</span>&nbsp;<span class="builtintype" id="2072222">error</span><span class="op" id="2072227">)</span>&nbsp;<span class="op" id="2072229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2072232">return</span>&nbsp;<span class="ident" id="2072239"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2072246">.</span><span class="ident" id="2072247">Seek</span><span class="op" id="2072251">(</span><span class="ident" id="2072252"><a href="/os/file_unix.go.html#2072166">f</a></span><span class="op" id="2072253">.</span><span class="ident" id="2072254">fd</span><span class="op" id="2072256">,</span>&nbsp;<span class="ident" id="2072258"><a href="/os/file_unix.go.html#2072180">offset</a></span><span class="op" id="2072264">,</span>&nbsp;<span class="ident" id="2072266"><a href="/os/file_unix.go.html#2072194">whence</a></span><span class="op" id="2072272">)</span><br>
<span class="lineno"></span><span class="op" id="2072274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2072277">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2072325">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2072402">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2072458">func</span>&nbsp;<span class="ident" id="2072463">Truncate</span><span class="op" id="2072471">(</span><span class="ident" id="2072472">name</span>&nbsp;<span class="builtintype" id="2072477">string</span><span class="op" id="2072483">,</span>&nbsp;<span class="ident" id="2072485">size</span>&nbsp;<span class="ident" id="2072490">int64</span><span class="op" id="2072495">)</span>&nbsp;<span class="builtintype" id="2072497">error</span>&nbsp;<span class="op" id="2072503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2072506">if</span>&nbsp;<span class="ident" id="2072509">e</span>&nbsp;<span class="op" id="2072511">:=</span>&nbsp;<span class="ident" id="2072514"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2072521">.</span><span class="ident" id="2072522">Truncate</span><span class="op" id="2072530">(</span><span class="ident" id="2072531"><a href="/os/file_unix.go.html#2072472">name</a></span><span class="op" id="2072535">,</span>&nbsp;<span class="ident" id="2072537"><a href="/os/file_unix.go.html#2072485">size</a></span><span class="op" id="2072541">)</span><span class="op" id="2072542">;</span>&nbsp;<span class="ident" id="2072544"><a href="/os/file_unix.go.html#2072509">e</a></span>&nbsp;<span class="op" id="2072546">!=</span>&nbsp;<span class="ident" id="2072549">nil</span>&nbsp;<span class="op" id="2072553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2072557">return</span>&nbsp;<span class="op" id="2072564">&amp;</span><span class="ident" id="2072565"><a href="/os/error.go.html#2044260">PathError</a></span><span class="op" id="2072574">{</span><span class="string" id="2072575">&#34;truncate&#34;</span><span class="op" id="2072585">,</span>&nbsp;<span class="ident" id="2072587"><a href="/os/file_unix.go.html#2072472">name</a></span><span class="op" id="2072591">,</span>&nbsp;<span class="ident" id="2072593"><a href="/os/file_unix.go.html#2072509">e</a></span><span class="op" id="2072594">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2072597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2072600">return</span>&nbsp;<span class="ident" id="2072607">nil</span><br>
<span class="lineno"></span><span class="op" id="2072611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2072614">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2072661">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2072717">func</span>&nbsp;<span class="ident" id="2072722">Remove</span><span class="op" id="2072728">(</span><span class="ident" id="2072729">name</span>&nbsp;<span class="builtintype" id="2072734">string</span><span class="op" id="2072740">)</span>&nbsp;<span class="builtintype" id="2072742">error</span>&nbsp;<span class="op" id="2072748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2072751">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2072795">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2072836">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2072880">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2072917">e</span>&nbsp;<span class="op" id="2072919">:=</span>&nbsp;<span class="ident" id="2072922"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2072929">.</span><span class="ident" id="2072930">Unlink</span><span class="op" id="2072936">(</span><span class="ident" id="2072937"><a href="/os/file_unix.go.html#2072729">name</a></span><span class="op" id="2072941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2072944">if</span>&nbsp;<span class="ident" id="2072947"><a href="/os/file_unix.go.html#2072917">e</a></span>&nbsp;<span class="op" id="2072949">==</span>&nbsp;<span class="ident" id="2072952">nil</span>&nbsp;<span class="op" id="2072956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2072960">return</span>&nbsp;<span class="ident" id="2072967">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2072972">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2072975">e1</span>&nbsp;<span class="op" id="2072978">:=</span>&nbsp;<span class="ident" id="2072981"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2072988">.</span><span class="ident" id="2072989">Rmdir</span><span class="op" id="2072994">(</span><span class="ident" id="2072995"><a href="/os/file_unix.go.html#2072729">name</a></span><span class="op" id="2072999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2073002">if</span>&nbsp;<span class="ident" id="2073005"><a href="/os/file_unix.go.html#2072975">e1</a></span>&nbsp;<span class="op" id="2073008">==</span>&nbsp;<span class="ident" id="2073011">nil</span>&nbsp;<span class="op" id="2073015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2073019">return</span>&nbsp;<span class="ident" id="2073026">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2073031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2073035">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2073086">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2073135">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2073184">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2073233">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2073287">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2073338">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2073393">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2073442">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2073473">if</span>&nbsp;<span class="ident" id="2073476"><a href="/os/file_unix.go.html#2072975">e1</a></span>&nbsp;<span class="op" id="2073479">!=</span>&nbsp;<span class="ident" id="2073482"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2073489">.</span><span class="ident" id="2073490">ENOTDIR</span>&nbsp;<span class="op" id="2073498">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2073502"><a href="/os/file_unix.go.html#2072917">e</a></span>&nbsp;<span class="op" id="2073504">=</span>&nbsp;<span class="ident" id="2073506"><a href="/os/file_unix.go.html#2072975">e1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2073510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2073513">return</span>&nbsp;<span class="op" id="2073520">&amp;</span><span class="ident" id="2073521"><a href="/os/error.go.html#2044260">PathError</a></span><span class="op" id="2073530">{</span><span class="string" id="2073531">&#34;remove&#34;</span><span class="op" id="2073539">,</span>&nbsp;<span class="ident" id="2073541"><a href="/os/file_unix.go.html#2072729">name</a></span><span class="op" id="2073545">,</span>&nbsp;<span class="ident" id="2073547"><a href="/os/file_unix.go.html#2072917">e</a></span><span class="op" id="2073548">}</span><br>
<span class="lineno"></span><span class="op" id="2073550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2073553">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2073636">func</span>&nbsp;<span class="ident" id="2073641">basename</span><span class="op" id="2073649">(</span><span class="ident" id="2073650">name</span>&nbsp;<span class="builtintype" id="2073655">string</span><span class="op" id="2073661">)</span>&nbsp;<span class="builtintype" id="2073663">string</span>&nbsp;<span class="op" id="2073670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2073673">i</span>&nbsp;<span class="op" id="2073675">:=</span>&nbsp;<span class="builtinfunc" id="2073678">len</span><span class="op" id="2073681">(</span><span class="ident" id="2073682"><a href="/os/file_unix.go.html#2073650">name</a></span><span class="op" id="2073686">)</span>&nbsp;<span class="op" id="2073688">-</span>&nbsp;<span class="num" id="2073690">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2073693">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2073721">for</span>&nbsp;<span class="op" id="2073725">;</span>&nbsp;<span class="ident" id="2073727"><a href="/os/file_unix.go.html#2073673">i</a></span>&nbsp;<span class="op" id="2073729">&gt;</span>&nbsp;<span class="num" id="2073731">0</span>&nbsp;<span class="op" id="2073733">&amp;&amp;</span>&nbsp;<span class="ident" id="2073736"><a href="/os/file_unix.go.html#2073650">name</a></span><span class="op" id="2073740">[</span><span class="ident" id="2073741"><a href="/os/file_unix.go.html#2073673">i</a></span><span class="op" id="2073742">]</span>&nbsp;<span class="op" id="2073744">==</span>&nbsp;<span class="string" id="2073747">&#39;/&#39;</span><span class="op" id="2073750">;</span>&nbsp;<span class="ident" id="2073752"><a href="/os/file_unix.go.html#2073673">i</a></span><span class="op" id="2073753">--</span>&nbsp;<span class="op" id="2073756">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2073760"><a href="/os/file_unix.go.html#2073650">name</a></span>&nbsp;<span class="op" id="2073765">=</span>&nbsp;<span class="ident" id="2073767"><a href="/os/file_unix.go.html#2073650">name</a></span><span class="op" id="2073771">[</span><span class="op" id="2073772">:</span><span class="ident" id="2073773"><a href="/os/file_unix.go.html#2073673">i</a></span><span class="op" id="2073774">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2073777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2073780">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2073814">for</span>&nbsp;<span class="ident" id="2073818"><a href="/os/file_unix.go.html#2073673">i</a></span><span class="op" id="2073819">--</span><span class="op" id="2073821">;</span>&nbsp;<span class="ident" id="2073823"><a href="/os/file_unix.go.html#2073673">i</a></span>&nbsp;<span class="op" id="2073825">&gt;=</span>&nbsp;<span class="num" id="2073828">0</span><span class="op" id="2073829">;</span>&nbsp;<span class="ident" id="2073831"><a href="/os/file_unix.go.html#2073673">i</a></span><span class="op" id="2073832">--</span>&nbsp;<span class="op" id="2073835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2073839">if</span>&nbsp;<span class="ident" id="2073842"><a href="/os/file_unix.go.html#2073650">name</a></span><span class="op" id="2073846">[</span><span class="ident" id="2073847"><a href="/os/file_unix.go.html#2073673">i</a></span><span class="op" id="2073848">]</span>&nbsp;<span class="op" id="2073850">==</span>&nbsp;<span class="string" id="2073853">&#39;/&#39;</span>&nbsp;<span class="op" id="2073857">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2073862"><a href="/os/file_unix.go.html#2073650">name</a></span>&nbsp;<span class="op" id="2073867">=</span>&nbsp;<span class="ident" id="2073869"><a href="/os/file_unix.go.html#2073650">name</a></span><span class="op" id="2073873">[</span><span class="ident" id="2073874"><a href="/os/file_unix.go.html#2073673">i</a></span><span class="op" id="2073875">+</span><span class="num" id="2073876">1</span><span class="op" id="2073877">:</span><span class="op" id="2073878">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2073883">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2073891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2073894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2073898">return</span>&nbsp;<span class="ident" id="2073905"><a href="/os/file_unix.go.html#2073650">name</a></span><br>
<span class="lineno"></span><span class="op" id="2073910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2073913">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2073982">func</span>&nbsp;<span class="ident" id="2073987">TempDir</span><span class="op" id="2073994">(</span><span class="op" id="2073995">)</span>&nbsp;<span class="builtintype" id="2073997">string</span>&nbsp;<span class="op" id="2074004">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2074007">dir</span>&nbsp;<span class="op" id="2074011">:=</span>&nbsp;<span class="ident" id="2074014"><a href="/os/env.go.html#2043043">Getenv</a></span><span class="op" id="2074020">(</span><span class="string" id="2074021">&#34;TMPDIR&#34;</span><span class="op" id="2074029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2074032">if</span>&nbsp;<span class="ident" id="2074035"><a href="/os/file_unix.go.html#2074007">dir</a></span>&nbsp;<span class="op" id="2074039">==</span>&nbsp;<span class="string" id="2074042">&#34;&#34;</span>&nbsp;<span class="op" id="2074045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2074049">if</span>&nbsp;<span class="ident" id="2074052"><a href="/os/file_unix.go.html#2065528">runtime</a></span><span class="op" id="2074059">.</span><span class="ident" id="2074060">GOOS</span>&nbsp;<span class="op" id="2074065">==</span>&nbsp;<span class="string" id="2074068">&#34;android&#34;</span>&nbsp;<span class="op" id="2074078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2074083"><a href="/os/file_unix.go.html#2074007">dir</a></span>&nbsp;<span class="op" id="2074087">=</span>&nbsp;<span class="string" id="2074089">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2074109">}</span>&nbsp;<span class="keyword" id="2074111">else</span>&nbsp;<span class="op" id="2074116">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2074121"><a href="/os/file_unix.go.html#2074007">dir</a></span>&nbsp;<span class="op" id="2074125">=</span>&nbsp;<span class="string" id="2074127">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2074136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2074139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2074142">return</span>&nbsp;<span class="ident" id="2074149"><a href="/os/file_unix.go.html#2074007">dir</a></span><br>
<span class="lineno"></span><span class="op" id="2074153">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2074156">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2074216">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2074272">func</span>&nbsp;<span class="ident" id="2074277">Link</span><span class="op" id="2074281">(</span><span class="ident" id="2074282">oldname</span><span class="op" id="2074289">,</span>&nbsp;<span class="ident" id="2074291">newname</span>&nbsp;<span class="builtintype" id="2074299">string</span><span class="op" id="2074305">)</span>&nbsp;<span class="builtintype" id="2074307">error</span>&nbsp;<span class="op" id="2074313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2074316">e</span>&nbsp;<span class="op" id="2074318">:=</span>&nbsp;<span class="ident" id="2074321"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2074328">.</span><span class="ident" id="2074329">Link</span><span class="op" id="2074333">(</span><span class="ident" id="2074334"><a href="/os/file_unix.go.html#2074282">oldname</a></span><span class="op" id="2074341">,</span>&nbsp;<span class="ident" id="2074343"><a href="/os/file_unix.go.html#2074291">newname</a></span><span class="op" id="2074350">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2074353">if</span>&nbsp;<span class="ident" id="2074356"><a href="/os/file_unix.go.html#2074316">e</a></span>&nbsp;<span class="op" id="2074358">!=</span>&nbsp;<span class="ident" id="2074361">nil</span>&nbsp;<span class="op" id="2074365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2074369">return</span>&nbsp;<span class="op" id="2074376">&amp;</span><span class="ident" id="2074377"><a href="/os/file.go.html#2056240">LinkError</a></span><span class="op" id="2074386">{</span><span class="string" id="2074387">&#34;link&#34;</span><span class="op" id="2074393">,</span>&nbsp;<span class="ident" id="2074395"><a href="/os/file_unix.go.html#2074282">oldname</a></span><span class="op" id="2074402">,</span>&nbsp;<span class="ident" id="2074404"><a href="/os/file_unix.go.html#2074291">newname</a></span><span class="op" id="2074411">,</span>&nbsp;<span class="ident" id="2074413"><a href="/os/file_unix.go.html#2074316">e</a></span><span class="op" id="2074414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2074417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2074420">return</span>&nbsp;<span class="ident" id="2074427">nil</span><br>
<span class="lineno"></span><span class="op" id="2074431">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2074434">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2074492">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2074548">func</span>&nbsp;<span class="ident" id="2074553">Symlink</span><span class="op" id="2074560">(</span><span class="ident" id="2074561">oldname</span><span class="op" id="2074568">,</span>&nbsp;<span class="ident" id="2074570">newname</span>&nbsp;<span class="builtintype" id="2074578">string</span><span class="op" id="2074584">)</span>&nbsp;<span class="builtintype" id="2074586">error</span>&nbsp;<span class="op" id="2074592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2074595">e</span>&nbsp;<span class="op" id="2074597">:=</span>&nbsp;<span class="ident" id="2074600"><a href="/os/file_unix.go.html#2065554">syscall</a></span><span class="op" id="2074607">.</span><span class="ident" id="2074608">Symlink</span><span class="op" id="2074615">(</span><span class="ident" id="2074616"><a href="/os/file_unix.go.html#2074561">oldname</a></span><span class="op" id="2074623">,</span>&nbsp;<span class="ident" id="2074625"><a href="/os/file_unix.go.html#2074570">newname</a></span><span class="op" id="2074632">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2074635">if</span>&nbsp;<span class="ident" id="2074638"><a href="/os/file_unix.go.html#2074595">e</a></span>&nbsp;<span class="op" id="2074640">!=</span>&nbsp;<span class="ident" id="2074643">nil</span>&nbsp;<span class="op" id="2074647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2074651">return</span>&nbsp;<span class="op" id="2074658">&amp;</span><span class="ident" id="2074659"><a href="/os/file.go.html#2056240">LinkError</a></span><span class="op" id="2074668">{</span><span class="string" id="2074669">&#34;symlink&#34;</span><span class="op" id="2074678">,</span>&nbsp;<span class="ident" id="2074680"><a href="/os/file_unix.go.html#2074561">oldname</a></span><span class="op" id="2074687">,</span>&nbsp;<span class="ident" id="2074689"><a href="/os/file_unix.go.html#2074570">newname</a></span><span class="op" id="2074696">,</span>&nbsp;<span class="ident" id="2074698"><a href="/os/file_unix.go.html#2074595">e</a></span><span class="op" id="2074699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2074702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2074705">return</span>&nbsp;<span class="ident" id="2074712">nil</span><br>
<span class="lineno"></span><span class="op" id="2074716">}</span>
</div>
</body>
</html>
