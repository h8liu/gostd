<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5608384">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5608439">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5608493">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5608544">package</span>&nbsp;<span class="ident" id="5608552">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5608558">import</span>&nbsp;<span class="op" id="5608565">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5608568">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5608577">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5608587">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5608596">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5608611">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5608616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5608619">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="5608663">func</span>&nbsp;<span class="ident" id="5608668">min</span><span class="op" id="5608671">(</span><span class="ident" id="5608672">x</span><span class="op" id="5608673">,</span>&nbsp;<span class="ident" id="5608675">y</span>&nbsp;<span class="builtintype" id="5608677">int</span><span class="op" id="5608680">)</span>&nbsp;<span class="builtintype" id="5608682">int</span>&nbsp;<span class="op" id="5608686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608689">if</span>&nbsp;<span class="ident" id="5608692">x</span>&nbsp;<span class="op" id="5608694">&lt;</span>&nbsp;<span class="ident" id="5608696">y</span>&nbsp;<span class="op" id="5608698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608702">return</span>&nbsp;<span class="ident" id="5608709">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608712">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608715">return</span>&nbsp;<span class="ident" id="5608722">y</span><br>
<span class="lineno"></span><span class="op" id="5608724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5608727">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="5608806">func</span>&nbsp;<span class="ident" id="5608811">div</span><span class="op" id="5608814">(</span><span class="ident" id="5608815">a</span><span class="op" id="5608816">,</span>&nbsp;<span class="ident" id="5608818">b</span>&nbsp;<span class="builtintype" id="5608820">int32</span><span class="op" id="5608825">)</span>&nbsp;<span class="builtintype" id="5608827">int32</span>&nbsp;<span class="op" id="5608833">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608836">if</span>&nbsp;<span class="ident" id="5608839">a</span>&nbsp;<span class="op" id="5608841">&gt;=</span>&nbsp;<span class="num" id="5608844">0</span>&nbsp;<span class="op" id="5608846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608850">return</span>&nbsp;<span class="op" id="5608857">(</span><span class="ident" id="5608858">a</span>&nbsp;<span class="op" id="5608860">+</span>&nbsp;<span class="op" id="5608862">(</span><span class="ident" id="5608863">b</span>&nbsp;<span class="op" id="5608865">&gt;&gt;</span>&nbsp;<span class="num" id="5608868">1</span><span class="op" id="5608869">)</span><span class="op" id="5608870">)</span>&nbsp;<span class="op" id="5608872">/</span>&nbsp;<span class="ident" id="5608874">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608880">return</span>&nbsp;<span class="op" id="5608887">-</span><span class="op" id="5608888">(</span><span class="op" id="5608889">(</span><span class="op" id="5608890">-</span><span class="ident" id="5608891">a</span>&nbsp;<span class="op" id="5608893">+</span>&nbsp;<span class="op" id="5608895">(</span><span class="ident" id="5608896">b</span>&nbsp;<span class="op" id="5608898">&gt;&gt;</span>&nbsp;<span class="num" id="5608901">1</span><span class="op" id="5608902">)</span><span class="op" id="5608903">)</span>&nbsp;<span class="op" id="5608905">/</span>&nbsp;<span class="ident" id="5608907">b</span><span class="op" id="5608908">)</span><br>
<span class="lineno"></span><span class="op" id="5608910">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5608913">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5608978">var</span>&nbsp;<span class="ident" id="5608982">bitCount</span>&nbsp;<span class="op" id="5608991">=</span>&nbsp;<span class="op" id="5608993">[</span><span class="num" id="5608994">256</span><span class="op" id="5608997">]</span><span class="builtintype" id="5608998">byte</span><span class="op" id="5609002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609005">0</span><span class="op" id="5609006">,</span>&nbsp;<span class="num" id="5609008">1</span><span class="op" id="5609009">,</span>&nbsp;<span class="num" id="5609011">2</span><span class="op" id="5609012">,</span>&nbsp;<span class="num" id="5609014">2</span><span class="op" id="5609015">,</span>&nbsp;<span class="num" id="5609017">3</span><span class="op" id="5609018">,</span>&nbsp;<span class="num" id="5609020">3</span><span class="op" id="5609021">,</span>&nbsp;<span class="num" id="5609023">3</span><span class="op" id="5609024">,</span>&nbsp;<span class="num" id="5609026">3</span><span class="op" id="5609027">,</span>&nbsp;<span class="num" id="5609029">4</span><span class="op" id="5609030">,</span>&nbsp;<span class="num" id="5609032">4</span><span class="op" id="5609033">,</span>&nbsp;<span class="num" id="5609035">4</span><span class="op" id="5609036">,</span>&nbsp;<span class="num" id="5609038">4</span><span class="op" id="5609039">,</span>&nbsp;<span class="num" id="5609041">4</span><span class="op" id="5609042">,</span>&nbsp;<span class="num" id="5609044">4</span><span class="op" id="5609045">,</span>&nbsp;<span class="num" id="5609047">4</span><span class="op" id="5609048">,</span>&nbsp;<span class="num" id="5609050">4</span><span class="op" id="5609051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609054">5</span><span class="op" id="5609055">,</span>&nbsp;<span class="num" id="5609057">5</span><span class="op" id="5609058">,</span>&nbsp;<span class="num" id="5609060">5</span><span class="op" id="5609061">,</span>&nbsp;<span class="num" id="5609063">5</span><span class="op" id="5609064">,</span>&nbsp;<span class="num" id="5609066">5</span><span class="op" id="5609067">,</span>&nbsp;<span class="num" id="5609069">5</span><span class="op" id="5609070">,</span>&nbsp;<span class="num" id="5609072">5</span><span class="op" id="5609073">,</span>&nbsp;<span class="num" id="5609075">5</span><span class="op" id="5609076">,</span>&nbsp;<span class="num" id="5609078">5</span><span class="op" id="5609079">,</span>&nbsp;<span class="num" id="5609081">5</span><span class="op" id="5609082">,</span>&nbsp;<span class="num" id="5609084">5</span><span class="op" id="5609085">,</span>&nbsp;<span class="num" id="5609087">5</span><span class="op" id="5609088">,</span>&nbsp;<span class="num" id="5609090">5</span><span class="op" id="5609091">,</span>&nbsp;<span class="num" id="5609093">5</span><span class="op" id="5609094">,</span>&nbsp;<span class="num" id="5609096">5</span><span class="op" id="5609097">,</span>&nbsp;<span class="num" id="5609099">5</span><span class="op" id="5609100">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609103">6</span><span class="op" id="5609104">,</span>&nbsp;<span class="num" id="5609106">6</span><span class="op" id="5609107">,</span>&nbsp;<span class="num" id="5609109">6</span><span class="op" id="5609110">,</span>&nbsp;<span class="num" id="5609112">6</span><span class="op" id="5609113">,</span>&nbsp;<span class="num" id="5609115">6</span><span class="op" id="5609116">,</span>&nbsp;<span class="num" id="5609118">6</span><span class="op" id="5609119">,</span>&nbsp;<span class="num" id="5609121">6</span><span class="op" id="5609122">,</span>&nbsp;<span class="num" id="5609124">6</span><span class="op" id="5609125">,</span>&nbsp;<span class="num" id="5609127">6</span><span class="op" id="5609128">,</span>&nbsp;<span class="num" id="5609130">6</span><span class="op" id="5609131">,</span>&nbsp;<span class="num" id="5609133">6</span><span class="op" id="5609134">,</span>&nbsp;<span class="num" id="5609136">6</span><span class="op" id="5609137">,</span>&nbsp;<span class="num" id="5609139">6</span><span class="op" id="5609140">,</span>&nbsp;<span class="num" id="5609142">6</span><span class="op" id="5609143">,</span>&nbsp;<span class="num" id="5609145">6</span><span class="op" id="5609146">,</span>&nbsp;<span class="num" id="5609148">6</span><span class="op" id="5609149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609152">6</span><span class="op" id="5609153">,</span>&nbsp;<span class="num" id="5609155">6</span><span class="op" id="5609156">,</span>&nbsp;<span class="num" id="5609158">6</span><span class="op" id="5609159">,</span>&nbsp;<span class="num" id="5609161">6</span><span class="op" id="5609162">,</span>&nbsp;<span class="num" id="5609164">6</span><span class="op" id="5609165">,</span>&nbsp;<span class="num" id="5609167">6</span><span class="op" id="5609168">,</span>&nbsp;<span class="num" id="5609170">6</span><span class="op" id="5609171">,</span>&nbsp;<span class="num" id="5609173">6</span><span class="op" id="5609174">,</span>&nbsp;<span class="num" id="5609176">6</span><span class="op" id="5609177">,</span>&nbsp;<span class="num" id="5609179">6</span><span class="op" id="5609180">,</span>&nbsp;<span class="num" id="5609182">6</span><span class="op" id="5609183">,</span>&nbsp;<span class="num" id="5609185">6</span><span class="op" id="5609186">,</span>&nbsp;<span class="num" id="5609188">6</span><span class="op" id="5609189">,</span>&nbsp;<span class="num" id="5609191">6</span><span class="op" id="5609192">,</span>&nbsp;<span class="num" id="5609194">6</span><span class="op" id="5609195">,</span>&nbsp;<span class="num" id="5609197">6</span><span class="op" id="5609198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609201">7</span><span class="op" id="5609202">,</span>&nbsp;<span class="num" id="5609204">7</span><span class="op" id="5609205">,</span>&nbsp;<span class="num" id="5609207">7</span><span class="op" id="5609208">,</span>&nbsp;<span class="num" id="5609210">7</span><span class="op" id="5609211">,</span>&nbsp;<span class="num" id="5609213">7</span><span class="op" id="5609214">,</span>&nbsp;<span class="num" id="5609216">7</span><span class="op" id="5609217">,</span>&nbsp;<span class="num" id="5609219">7</span><span class="op" id="5609220">,</span>&nbsp;<span class="num" id="5609222">7</span><span class="op" id="5609223">,</span>&nbsp;<span class="num" id="5609225">7</span><span class="op" id="5609226">,</span>&nbsp;<span class="num" id="5609228">7</span><span class="op" id="5609229">,</span>&nbsp;<span class="num" id="5609231">7</span><span class="op" id="5609232">,</span>&nbsp;<span class="num" id="5609234">7</span><span class="op" id="5609235">,</span>&nbsp;<span class="num" id="5609237">7</span><span class="op" id="5609238">,</span>&nbsp;<span class="num" id="5609240">7</span><span class="op" id="5609241">,</span>&nbsp;<span class="num" id="5609243">7</span><span class="op" id="5609244">,</span>&nbsp;<span class="num" id="5609246">7</span><span class="op" id="5609247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609250">7</span><span class="op" id="5609251">,</span>&nbsp;<span class="num" id="5609253">7</span><span class="op" id="5609254">,</span>&nbsp;<span class="num" id="5609256">7</span><span class="op" id="5609257">,</span>&nbsp;<span class="num" id="5609259">7</span><span class="op" id="5609260">,</span>&nbsp;<span class="num" id="5609262">7</span><span class="op" id="5609263">,</span>&nbsp;<span class="num" id="5609265">7</span><span class="op" id="5609266">,</span>&nbsp;<span class="num" id="5609268">7</span><span class="op" id="5609269">,</span>&nbsp;<span class="num" id="5609271">7</span><span class="op" id="5609272">,</span>&nbsp;<span class="num" id="5609274">7</span><span class="op" id="5609275">,</span>&nbsp;<span class="num" id="5609277">7</span><span class="op" id="5609278">,</span>&nbsp;<span class="num" id="5609280">7</span><span class="op" id="5609281">,</span>&nbsp;<span class="num" id="5609283">7</span><span class="op" id="5609284">,</span>&nbsp;<span class="num" id="5609286">7</span><span class="op" id="5609287">,</span>&nbsp;<span class="num" id="5609289">7</span><span class="op" id="5609290">,</span>&nbsp;<span class="num" id="5609292">7</span><span class="op" id="5609293">,</span>&nbsp;<span class="num" id="5609295">7</span><span class="op" id="5609296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609299">7</span><span class="op" id="5609300">,</span>&nbsp;<span class="num" id="5609302">7</span><span class="op" id="5609303">,</span>&nbsp;<span class="num" id="5609305">7</span><span class="op" id="5609306">,</span>&nbsp;<span class="num" id="5609308">7</span><span class="op" id="5609309">,</span>&nbsp;<span class="num" id="5609311">7</span><span class="op" id="5609312">,</span>&nbsp;<span class="num" id="5609314">7</span><span class="op" id="5609315">,</span>&nbsp;<span class="num" id="5609317">7</span><span class="op" id="5609318">,</span>&nbsp;<span class="num" id="5609320">7</span><span class="op" id="5609321">,</span>&nbsp;<span class="num" id="5609323">7</span><span class="op" id="5609324">,</span>&nbsp;<span class="num" id="5609326">7</span><span class="op" id="5609327">,</span>&nbsp;<span class="num" id="5609329">7</span><span class="op" id="5609330">,</span>&nbsp;<span class="num" id="5609332">7</span><span class="op" id="5609333">,</span>&nbsp;<span class="num" id="5609335">7</span><span class="op" id="5609336">,</span>&nbsp;<span class="num" id="5609338">7</span><span class="op" id="5609339">,</span>&nbsp;<span class="num" id="5609341">7</span><span class="op" id="5609342">,</span>&nbsp;<span class="num" id="5609344">7</span><span class="op" id="5609345">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609348">7</span><span class="op" id="5609349">,</span>&nbsp;<span class="num" id="5609351">7</span><span class="op" id="5609352">,</span>&nbsp;<span class="num" id="5609354">7</span><span class="op" id="5609355">,</span>&nbsp;<span class="num" id="5609357">7</span><span class="op" id="5609358">,</span>&nbsp;<span class="num" id="5609360">7</span><span class="op" id="5609361">,</span>&nbsp;<span class="num" id="5609363">7</span><span class="op" id="5609364">,</span>&nbsp;<span class="num" id="5609366">7</span><span class="op" id="5609367">,</span>&nbsp;<span class="num" id="5609369">7</span><span class="op" id="5609370">,</span>&nbsp;<span class="num" id="5609372">7</span><span class="op" id="5609373">,</span>&nbsp;<span class="num" id="5609375">7</span><span class="op" id="5609376">,</span>&nbsp;<span class="num" id="5609378">7</span><span class="op" id="5609379">,</span>&nbsp;<span class="num" id="5609381">7</span><span class="op" id="5609382">,</span>&nbsp;<span class="num" id="5609384">7</span><span class="op" id="5609385">,</span>&nbsp;<span class="num" id="5609387">7</span><span class="op" id="5609388">,</span>&nbsp;<span class="num" id="5609390">7</span><span class="op" id="5609391">,</span>&nbsp;<span class="num" id="5609393">7</span><span class="op" id="5609394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609397">8</span><span class="op" id="5609398">,</span>&nbsp;<span class="num" id="5609400">8</span><span class="op" id="5609401">,</span>&nbsp;<span class="num" id="5609403">8</span><span class="op" id="5609404">,</span>&nbsp;<span class="num" id="5609406">8</span><span class="op" id="5609407">,</span>&nbsp;<span class="num" id="5609409">8</span><span class="op" id="5609410">,</span>&nbsp;<span class="num" id="5609412">8</span><span class="op" id="5609413">,</span>&nbsp;<span class="num" id="5609415">8</span><span class="op" id="5609416">,</span>&nbsp;<span class="num" id="5609418">8</span><span class="op" id="5609419">,</span>&nbsp;<span class="num" id="5609421">8</span><span class="op" id="5609422">,</span>&nbsp;<span class="num" id="5609424">8</span><span class="op" id="5609425">,</span>&nbsp;<span class="num" id="5609427">8</span><span class="op" id="5609428">,</span>&nbsp;<span class="num" id="5609430">8</span><span class="op" id="5609431">,</span>&nbsp;<span class="num" id="5609433">8</span><span class="op" id="5609434">,</span>&nbsp;<span class="num" id="5609436">8</span><span class="op" id="5609437">,</span>&nbsp;<span class="num" id="5609439">8</span><span class="op" id="5609440">,</span>&nbsp;<span class="num" id="5609442">8</span><span class="op" id="5609443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609446">8</span><span class="op" id="5609447">,</span>&nbsp;<span class="num" id="5609449">8</span><span class="op" id="5609450">,</span>&nbsp;<span class="num" id="5609452">8</span><span class="op" id="5609453">,</span>&nbsp;<span class="num" id="5609455">8</span><span class="op" id="5609456">,</span>&nbsp;<span class="num" id="5609458">8</span><span class="op" id="5609459">,</span>&nbsp;<span class="num" id="5609461">8</span><span class="op" id="5609462">,</span>&nbsp;<span class="num" id="5609464">8</span><span class="op" id="5609465">,</span>&nbsp;<span class="num" id="5609467">8</span><span class="op" id="5609468">,</span>&nbsp;<span class="num" id="5609470">8</span><span class="op" id="5609471">,</span>&nbsp;<span class="num" id="5609473">8</span><span class="op" id="5609474">,</span>&nbsp;<span class="num" id="5609476">8</span><span class="op" id="5609477">,</span>&nbsp;<span class="num" id="5609479">8</span><span class="op" id="5609480">,</span>&nbsp;<span class="num" id="5609482">8</span><span class="op" id="5609483">,</span>&nbsp;<span class="num" id="5609485">8</span><span class="op" id="5609486">,</span>&nbsp;<span class="num" id="5609488">8</span><span class="op" id="5609489">,</span>&nbsp;<span class="num" id="5609491">8</span><span class="op" id="5609492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609495">8</span><span class="op" id="5609496">,</span>&nbsp;<span class="num" id="5609498">8</span><span class="op" id="5609499">,</span>&nbsp;<span class="num" id="5609501">8</span><span class="op" id="5609502">,</span>&nbsp;<span class="num" id="5609504">8</span><span class="op" id="5609505">,</span>&nbsp;<span class="num" id="5609507">8</span><span class="op" id="5609508">,</span>&nbsp;<span class="num" id="5609510">8</span><span class="op" id="5609511">,</span>&nbsp;<span class="num" id="5609513">8</span><span class="op" id="5609514">,</span>&nbsp;<span class="num" id="5609516">8</span><span class="op" id="5609517">,</span>&nbsp;<span class="num" id="5609519">8</span><span class="op" id="5609520">,</span>&nbsp;<span class="num" id="5609522">8</span><span class="op" id="5609523">,</span>&nbsp;<span class="num" id="5609525">8</span><span class="op" id="5609526">,</span>&nbsp;<span class="num" id="5609528">8</span><span class="op" id="5609529">,</span>&nbsp;<span class="num" id="5609531">8</span><span class="op" id="5609532">,</span>&nbsp;<span class="num" id="5609534">8</span><span class="op" id="5609535">,</span>&nbsp;<span class="num" id="5609537">8</span><span class="op" id="5609538">,</span>&nbsp;<span class="num" id="5609540">8</span><span class="op" id="5609541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609544">8</span><span class="op" id="5609545">,</span>&nbsp;<span class="num" id="5609547">8</span><span class="op" id="5609548">,</span>&nbsp;<span class="num" id="5609550">8</span><span class="op" id="5609551">,</span>&nbsp;<span class="num" id="5609553">8</span><span class="op" id="5609554">,</span>&nbsp;<span class="num" id="5609556">8</span><span class="op" id="5609557">,</span>&nbsp;<span class="num" id="5609559">8</span><span class="op" id="5609560">,</span>&nbsp;<span class="num" id="5609562">8</span><span class="op" id="5609563">,</span>&nbsp;<span class="num" id="5609565">8</span><span class="op" id="5609566">,</span>&nbsp;<span class="num" id="5609568">8</span><span class="op" id="5609569">,</span>&nbsp;<span class="num" id="5609571">8</span><span class="op" id="5609572">,</span>&nbsp;<span class="num" id="5609574">8</span><span class="op" id="5609575">,</span>&nbsp;<span class="num" id="5609577">8</span><span class="op" id="5609578">,</span>&nbsp;<span class="num" id="5609580">8</span><span class="op" id="5609581">,</span>&nbsp;<span class="num" id="5609583">8</span><span class="op" id="5609584">,</span>&nbsp;<span class="num" id="5609586">8</span><span class="op" id="5609587">,</span>&nbsp;<span class="num" id="5609589">8</span><span class="op" id="5609590">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609593">8</span><span class="op" id="5609594">,</span>&nbsp;<span class="num" id="5609596">8</span><span class="op" id="5609597">,</span>&nbsp;<span class="num" id="5609599">8</span><span class="op" id="5609600">,</span>&nbsp;<span class="num" id="5609602">8</span><span class="op" id="5609603">,</span>&nbsp;<span class="num" id="5609605">8</span><span class="op" id="5609606">,</span>&nbsp;<span class="num" id="5609608">8</span><span class="op" id="5609609">,</span>&nbsp;<span class="num" id="5609611">8</span><span class="op" id="5609612">,</span>&nbsp;<span class="num" id="5609614">8</span><span class="op" id="5609615">,</span>&nbsp;<span class="num" id="5609617">8</span><span class="op" id="5609618">,</span>&nbsp;<span class="num" id="5609620">8</span><span class="op" id="5609621">,</span>&nbsp;<span class="num" id="5609623">8</span><span class="op" id="5609624">,</span>&nbsp;<span class="num" id="5609626">8</span><span class="op" id="5609627">,</span>&nbsp;<span class="num" id="5609629">8</span><span class="op" id="5609630">,</span>&nbsp;<span class="num" id="5609632">8</span><span class="op" id="5609633">,</span>&nbsp;<span class="num" id="5609635">8</span><span class="op" id="5609636">,</span>&nbsp;<span class="num" id="5609638">8</span><span class="op" id="5609639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609642">8</span><span class="op" id="5609643">,</span>&nbsp;<span class="num" id="5609645">8</span><span class="op" id="5609646">,</span>&nbsp;<span class="num" id="5609648">8</span><span class="op" id="5609649">,</span>&nbsp;<span class="num" id="5609651">8</span><span class="op" id="5609652">,</span>&nbsp;<span class="num" id="5609654">8</span><span class="op" id="5609655">,</span>&nbsp;<span class="num" id="5609657">8</span><span class="op" id="5609658">,</span>&nbsp;<span class="num" id="5609660">8</span><span class="op" id="5609661">,</span>&nbsp;<span class="num" id="5609663">8</span><span class="op" id="5609664">,</span>&nbsp;<span class="num" id="5609666">8</span><span class="op" id="5609667">,</span>&nbsp;<span class="num" id="5609669">8</span><span class="op" id="5609670">,</span>&nbsp;<span class="num" id="5609672">8</span><span class="op" id="5609673">,</span>&nbsp;<span class="num" id="5609675">8</span><span class="op" id="5609676">,</span>&nbsp;<span class="num" id="5609678">8</span><span class="op" id="5609679">,</span>&nbsp;<span class="num" id="5609681">8</span><span class="op" id="5609682">,</span>&nbsp;<span class="num" id="5609684">8</span><span class="op" id="5609685">,</span>&nbsp;<span class="num" id="5609687">8</span><span class="op" id="5609688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609691">8</span><span class="op" id="5609692">,</span>&nbsp;<span class="num" id="5609694">8</span><span class="op" id="5609695">,</span>&nbsp;<span class="num" id="5609697">8</span><span class="op" id="5609698">,</span>&nbsp;<span class="num" id="5609700">8</span><span class="op" id="5609701">,</span>&nbsp;<span class="num" id="5609703">8</span><span class="op" id="5609704">,</span>&nbsp;<span class="num" id="5609706">8</span><span class="op" id="5609707">,</span>&nbsp;<span class="num" id="5609709">8</span><span class="op" id="5609710">,</span>&nbsp;<span class="num" id="5609712">8</span><span class="op" id="5609713">,</span>&nbsp;<span class="num" id="5609715">8</span><span class="op" id="5609716">,</span>&nbsp;<span class="num" id="5609718">8</span><span class="op" id="5609719">,</span>&nbsp;<span class="num" id="5609721">8</span><span class="op" id="5609722">,</span>&nbsp;<span class="num" id="5609724">8</span><span class="op" id="5609725">,</span>&nbsp;<span class="num" id="5609727">8</span><span class="op" id="5609728">,</span>&nbsp;<span class="num" id="5609730">8</span><span class="op" id="5609731">,</span>&nbsp;<span class="num" id="5609733">8</span><span class="op" id="5609734">,</span>&nbsp;<span class="num" id="5609736">8</span><span class="op" id="5609737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5609740">8</span><span class="op" id="5609741">,</span>&nbsp;<span class="num" id="5609743">8</span><span class="op" id="5609744">,</span>&nbsp;<span class="num" id="5609746">8</span><span class="op" id="5609747">,</span>&nbsp;<span class="num" id="5609749">8</span><span class="op" id="5609750">,</span>&nbsp;<span class="num" id="5609752">8</span><span class="op" id="5609753">,</span>&nbsp;<span class="num" id="5609755">8</span><span class="op" id="5609756">,</span>&nbsp;<span class="num" id="5609758">8</span><span class="op" id="5609759">,</span>&nbsp;<span class="num" id="5609761">8</span><span class="op" id="5609762">,</span>&nbsp;<span class="num" id="5609764">8</span><span class="op" id="5609765">,</span>&nbsp;<span class="num" id="5609767">8</span><span class="op" id="5609768">,</span>&nbsp;<span class="num" id="5609770">8</span><span class="op" id="5609771">,</span>&nbsp;<span class="num" id="5609773">8</span><span class="op" id="5609774">,</span>&nbsp;<span class="num" id="5609776">8</span><span class="op" id="5609777">,</span>&nbsp;<span class="num" id="5609779">8</span><span class="op" id="5609780">,</span>&nbsp;<span class="num" id="5609782">8</span><span class="op" id="5609783">,</span>&nbsp;<span class="num" id="5609785">8</span><span class="op" id="5609786">,</span><br>
<span class="lineno"></span><span class="op" id="5609788">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5609791">type</span>&nbsp;<span class="ident" id="5609796">quantIndex</span>&nbsp;<span class="builtintype" id="5609807">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5609812">const</span>&nbsp;<span class="op" id="5609818">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5609821">quantIndexLuminance</span>&nbsp;<span class="ident" id="5609841">quantIndex</span>&nbsp;<span class="op" id="5609852">=</span>&nbsp;<span class="ident" id="5609854">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5609860">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5609883">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="5609895">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5609898">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="5609975">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5610051">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5610127">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5610145">var</span>&nbsp;<span class="ident" id="5610149">unscaledQuant</span>&nbsp;<span class="op" id="5610163">=</span>&nbsp;<span class="op" id="5610165">[</span><span class="ident" id="5610166">nQuantIndex</span><span class="op" id="5610177">]</span><span class="op" id="5610178">[</span><span class="ident" id="5610179">blockSize</span><span class="op" id="5610188">]</span><span class="builtintype" id="5610189">byte</span><span class="op" id="5610193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5610196">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5610211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610215">16</span><span class="op" id="5610217">,</span>&nbsp;<span class="num" id="5610219">11</span><span class="op" id="5610221">,</span>&nbsp;<span class="num" id="5610223">12</span><span class="op" id="5610225">,</span>&nbsp;<span class="num" id="5610227">14</span><span class="op" id="5610229">,</span>&nbsp;<span class="num" id="5610231">12</span><span class="op" id="5610233">,</span>&nbsp;<span class="num" id="5610235">10</span><span class="op" id="5610237">,</span>&nbsp;<span class="num" id="5610239">16</span><span class="op" id="5610241">,</span>&nbsp;<span class="num" id="5610243">14</span><span class="op" id="5610245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610249">13</span><span class="op" id="5610251">,</span>&nbsp;<span class="num" id="5610253">14</span><span class="op" id="5610255">,</span>&nbsp;<span class="num" id="5610257">18</span><span class="op" id="5610259">,</span>&nbsp;<span class="num" id="5610261">17</span><span class="op" id="5610263">,</span>&nbsp;<span class="num" id="5610265">16</span><span class="op" id="5610267">,</span>&nbsp;<span class="num" id="5610269">19</span><span class="op" id="5610271">,</span>&nbsp;<span class="num" id="5610273">24</span><span class="op" id="5610275">,</span>&nbsp;<span class="num" id="5610277">40</span><span class="op" id="5610279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610283">26</span><span class="op" id="5610285">,</span>&nbsp;<span class="num" id="5610287">24</span><span class="op" id="5610289">,</span>&nbsp;<span class="num" id="5610291">22</span><span class="op" id="5610293">,</span>&nbsp;<span class="num" id="5610295">22</span><span class="op" id="5610297">,</span>&nbsp;<span class="num" id="5610299">24</span><span class="op" id="5610301">,</span>&nbsp;<span class="num" id="5610303">49</span><span class="op" id="5610305">,</span>&nbsp;<span class="num" id="5610307">35</span><span class="op" id="5610309">,</span>&nbsp;<span class="num" id="5610311">37</span><span class="op" id="5610313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610317">29</span><span class="op" id="5610319">,</span>&nbsp;<span class="num" id="5610321">40</span><span class="op" id="5610323">,</span>&nbsp;<span class="num" id="5610325">58</span><span class="op" id="5610327">,</span>&nbsp;<span class="num" id="5610329">51</span><span class="op" id="5610331">,</span>&nbsp;<span class="num" id="5610333">61</span><span class="op" id="5610335">,</span>&nbsp;<span class="num" id="5610337">60</span><span class="op" id="5610339">,</span>&nbsp;<span class="num" id="5610341">57</span><span class="op" id="5610343">,</span>&nbsp;<span class="num" id="5610345">51</span><span class="op" id="5610347">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610351">56</span><span class="op" id="5610353">,</span>&nbsp;<span class="num" id="5610355">55</span><span class="op" id="5610357">,</span>&nbsp;<span class="num" id="5610359">64</span><span class="op" id="5610361">,</span>&nbsp;<span class="num" id="5610363">72</span><span class="op" id="5610365">,</span>&nbsp;<span class="num" id="5610367">92</span><span class="op" id="5610369">,</span>&nbsp;<span class="num" id="5610371">78</span><span class="op" id="5610373">,</span>&nbsp;<span class="num" id="5610375">64</span><span class="op" id="5610377">,</span>&nbsp;<span class="num" id="5610379">68</span><span class="op" id="5610381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610385">87</span><span class="op" id="5610387">,</span>&nbsp;<span class="num" id="5610389">69</span><span class="op" id="5610391">,</span>&nbsp;<span class="num" id="5610393">55</span><span class="op" id="5610395">,</span>&nbsp;<span class="num" id="5610397">56</span><span class="op" id="5610399">,</span>&nbsp;<span class="num" id="5610401">80</span><span class="op" id="5610403">,</span>&nbsp;<span class="num" id="5610405">109</span><span class="op" id="5610408">,</span>&nbsp;<span class="num" id="5610410">81</span><span class="op" id="5610412">,</span>&nbsp;<span class="num" id="5610414">87</span><span class="op" id="5610416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610420">95</span><span class="op" id="5610422">,</span>&nbsp;<span class="num" id="5610424">98</span><span class="op" id="5610426">,</span>&nbsp;<span class="num" id="5610428">103</span><span class="op" id="5610431">,</span>&nbsp;<span class="num" id="5610433">104</span><span class="op" id="5610436">,</span>&nbsp;<span class="num" id="5610438">103</span><span class="op" id="5610441">,</span>&nbsp;<span class="num" id="5610443">62</span><span class="op" id="5610445">,</span>&nbsp;<span class="num" id="5610447">77</span><span class="op" id="5610449">,</span>&nbsp;<span class="num" id="5610451">113</span><span class="op" id="5610454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610458">121</span><span class="op" id="5610461">,</span>&nbsp;<span class="num" id="5610463">112</span><span class="op" id="5610466">,</span>&nbsp;<span class="num" id="5610468">100</span><span class="op" id="5610471">,</span>&nbsp;<span class="num" id="5610473">120</span><span class="op" id="5610476">,</span>&nbsp;<span class="num" id="5610478">92</span><span class="op" id="5610480">,</span>&nbsp;<span class="num" id="5610482">101</span><span class="op" id="5610485">,</span>&nbsp;<span class="num" id="5610487">103</span><span class="op" id="5610490">,</span>&nbsp;<span class="num" id="5610492">99</span><span class="op" id="5610494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5610497">}</span><span class="op" id="5610498">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5610501">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5610518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610522">17</span><span class="op" id="5610524">,</span>&nbsp;<span class="num" id="5610526">18</span><span class="op" id="5610528">,</span>&nbsp;<span class="num" id="5610530">18</span><span class="op" id="5610532">,</span>&nbsp;<span class="num" id="5610534">24</span><span class="op" id="5610536">,</span>&nbsp;<span class="num" id="5610538">21</span><span class="op" id="5610540">,</span>&nbsp;<span class="num" id="5610542">24</span><span class="op" id="5610544">,</span>&nbsp;<span class="num" id="5610546">47</span><span class="op" id="5610548">,</span>&nbsp;<span class="num" id="5610550">26</span><span class="op" id="5610552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610556">26</span><span class="op" id="5610558">,</span>&nbsp;<span class="num" id="5610560">47</span><span class="op" id="5610562">,</span>&nbsp;<span class="num" id="5610564">99</span><span class="op" id="5610566">,</span>&nbsp;<span class="num" id="5610568">66</span><span class="op" id="5610570">,</span>&nbsp;<span class="num" id="5610572">56</span><span class="op" id="5610574">,</span>&nbsp;<span class="num" id="5610576">66</span><span class="op" id="5610578">,</span>&nbsp;<span class="num" id="5610580">99</span><span class="op" id="5610582">,</span>&nbsp;<span class="num" id="5610584">99</span><span class="op" id="5610586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610590">99</span><span class="op" id="5610592">,</span>&nbsp;<span class="num" id="5610594">99</span><span class="op" id="5610596">,</span>&nbsp;<span class="num" id="5610598">99</span><span class="op" id="5610600">,</span>&nbsp;<span class="num" id="5610602">99</span><span class="op" id="5610604">,</span>&nbsp;<span class="num" id="5610606">99</span><span class="op" id="5610608">,</span>&nbsp;<span class="num" id="5610610">99</span><span class="op" id="5610612">,</span>&nbsp;<span class="num" id="5610614">99</span><span class="op" id="5610616">,</span>&nbsp;<span class="num" id="5610618">99</span><span class="op" id="5610620">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610624">99</span><span class="op" id="5610626">,</span>&nbsp;<span class="num" id="5610628">99</span><span class="op" id="5610630">,</span>&nbsp;<span class="num" id="5610632">99</span><span class="op" id="5610634">,</span>&nbsp;<span class="num" id="5610636">99</span><span class="op" id="5610638">,</span>&nbsp;<span class="num" id="5610640">99</span><span class="op" id="5610642">,</span>&nbsp;<span class="num" id="5610644">99</span><span class="op" id="5610646">,</span>&nbsp;<span class="num" id="5610648">99</span><span class="op" id="5610650">,</span>&nbsp;<span class="num" id="5610652">99</span><span class="op" id="5610654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610658">99</span><span class="op" id="5610660">,</span>&nbsp;<span class="num" id="5610662">99</span><span class="op" id="5610664">,</span>&nbsp;<span class="num" id="5610666">99</span><span class="op" id="5610668">,</span>&nbsp;<span class="num" id="5610670">99</span><span class="op" id="5610672">,</span>&nbsp;<span class="num" id="5610674">99</span><span class="op" id="5610676">,</span>&nbsp;<span class="num" id="5610678">99</span><span class="op" id="5610680">,</span>&nbsp;<span class="num" id="5610682">99</span><span class="op" id="5610684">,</span>&nbsp;<span class="num" id="5610686">99</span><span class="op" id="5610688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610692">99</span><span class="op" id="5610694">,</span>&nbsp;<span class="num" id="5610696">99</span><span class="op" id="5610698">,</span>&nbsp;<span class="num" id="5610700">99</span><span class="op" id="5610702">,</span>&nbsp;<span class="num" id="5610704">99</span><span class="op" id="5610706">,</span>&nbsp;<span class="num" id="5610708">99</span><span class="op" id="5610710">,</span>&nbsp;<span class="num" id="5610712">99</span><span class="op" id="5610714">,</span>&nbsp;<span class="num" id="5610716">99</span><span class="op" id="5610718">,</span>&nbsp;<span class="num" id="5610720">99</span><span class="op" id="5610722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610726">99</span><span class="op" id="5610728">,</span>&nbsp;<span class="num" id="5610730">99</span><span class="op" id="5610732">,</span>&nbsp;<span class="num" id="5610734">99</span><span class="op" id="5610736">,</span>&nbsp;<span class="num" id="5610738">99</span><span class="op" id="5610740">,</span>&nbsp;<span class="num" id="5610742">99</span><span class="op" id="5610744">,</span>&nbsp;<span class="num" id="5610746">99</span><span class="op" id="5610748">,</span>&nbsp;<span class="num" id="5610750">99</span><span class="op" id="5610752">,</span>&nbsp;<span class="num" id="5610754">99</span><span class="op" id="5610756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5610760">99</span><span class="op" id="5610762">,</span>&nbsp;<span class="num" id="5610764">99</span><span class="op" id="5610766">,</span>&nbsp;<span class="num" id="5610768">99</span><span class="op" id="5610770">,</span>&nbsp;<span class="num" id="5610772">99</span><span class="op" id="5610774">,</span>&nbsp;<span class="num" id="5610776">99</span><span class="op" id="5610778">,</span>&nbsp;<span class="num" id="5610780">99</span><span class="op" id="5610782">,</span>&nbsp;<span class="num" id="5610784">99</span><span class="op" id="5610786">,</span>&nbsp;<span class="num" id="5610788">99</span><span class="op" id="5610790">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5610793">}</span><span class="op" id="5610794">,</span><br>
<span class="lineno"></span><span class="op" id="5610796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5610799">type</span>&nbsp;<span class="ident" id="5610804">huffIndex</span>&nbsp;<span class="builtintype" id="5610814">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="5610819">const</span>&nbsp;<span class="op" id="5610825">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610828">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="5610849">huffIndex</span>&nbsp;<span class="op" id="5610859">=</span>&nbsp;<span class="ident" id="5610861">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610867">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610889">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610913">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5610937">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="5610948">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5610951">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5610996">type</span>&nbsp;<span class="ident" id="5611001">huffmanSpec</span>&nbsp;<span class="keyword" id="5611013">struct</span>&nbsp;<span class="op" id="5611020">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5611023">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611077">count</span>&nbsp;<span class="op" id="5611083">[</span><span class="num" id="5611084">16</span><span class="op" id="5611086">]</span><span class="builtintype" id="5611087">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5611093">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611149">value</span>&nbsp;<span class="op" id="5611155">[</span><span class="op" id="5611156">]</span><span class="builtintype" id="5611157">byte</span><br>
<span class="lineno"></span><span class="op" id="5611162">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="5611165">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="5611223">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="5611286">var</span>&nbsp;<span class="ident" id="5611290">theHuffmanSpec</span>&nbsp;<span class="op" id="5611305">=</span>&nbsp;<span class="op" id="5611307">[</span><span class="ident" id="5611308">nHuffIndex</span><span class="op" id="5611318">]</span><span class="ident" id="5611319">huffmanSpec</span><span class="op" id="5611330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5611333">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5611351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5611355">[</span><span class="num" id="5611356">16</span><span class="op" id="5611358">]</span><span class="builtintype" id="5611359">byte</span><span class="op" id="5611363">{</span><span class="num" id="5611364">0</span><span class="op" id="5611365">,</span>&nbsp;<span class="num" id="5611367">1</span><span class="op" id="5611368">,</span>&nbsp;<span class="num" id="5611370">5</span><span class="op" id="5611371">,</span>&nbsp;<span class="num" id="5611373">1</span><span class="op" id="5611374">,</span>&nbsp;<span class="num" id="5611376">1</span><span class="op" id="5611377">,</span>&nbsp;<span class="num" id="5611379">1</span><span class="op" id="5611380">,</span>&nbsp;<span class="num" id="5611382">1</span><span class="op" id="5611383">,</span>&nbsp;<span class="num" id="5611385">1</span><span class="op" id="5611386">,</span>&nbsp;<span class="num" id="5611388">1</span><span class="op" id="5611389">,</span>&nbsp;<span class="num" id="5611391">0</span><span class="op" id="5611392">,</span>&nbsp;<span class="num" id="5611394">0</span><span class="op" id="5611395">,</span>&nbsp;<span class="num" id="5611397">0</span><span class="op" id="5611398">,</span>&nbsp;<span class="num" id="5611400">0</span><span class="op" id="5611401">,</span>&nbsp;<span class="num" id="5611403">0</span><span class="op" id="5611404">,</span>&nbsp;<span class="num" id="5611406">0</span><span class="op" id="5611407">,</span>&nbsp;<span class="num" id="5611409">0</span><span class="op" id="5611410">}</span><span class="op" id="5611411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5611415">[</span><span class="op" id="5611416">]</span><span class="builtintype" id="5611417">byte</span><span class="op" id="5611421">{</span><span class="num" id="5611422">0</span><span class="op" id="5611423">,</span>&nbsp;<span class="num" id="5611425">1</span><span class="op" id="5611426">,</span>&nbsp;<span class="num" id="5611428">2</span><span class="op" id="5611429">,</span>&nbsp;<span class="num" id="5611431">3</span><span class="op" id="5611432">,</span>&nbsp;<span class="num" id="5611434">4</span><span class="op" id="5611435">,</span>&nbsp;<span class="num" id="5611437">5</span><span class="op" id="5611438">,</span>&nbsp;<span class="num" id="5611440">6</span><span class="op" id="5611441">,</span>&nbsp;<span class="num" id="5611443">7</span><span class="op" id="5611444">,</span>&nbsp;<span class="num" id="5611446">8</span><span class="op" id="5611447">,</span>&nbsp;<span class="num" id="5611449">9</span><span class="op" id="5611450">,</span>&nbsp;<span class="num" id="5611452">10</span><span class="op" id="5611454">,</span>&nbsp;<span class="num" id="5611456">11</span><span class="op" id="5611458">}</span><span class="op" id="5611459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5611462">}</span><span class="op" id="5611463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5611466">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5611484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5611488">[</span><span class="num" id="5611489">16</span><span class="op" id="5611491">]</span><span class="builtintype" id="5611492">byte</span><span class="op" id="5611496">{</span><span class="num" id="5611497">0</span><span class="op" id="5611498">,</span>&nbsp;<span class="num" id="5611500">2</span><span class="op" id="5611501">,</span>&nbsp;<span class="num" id="5611503">1</span><span class="op" id="5611504">,</span>&nbsp;<span class="num" id="5611506">3</span><span class="op" id="5611507">,</span>&nbsp;<span class="num" id="5611509">3</span><span class="op" id="5611510">,</span>&nbsp;<span class="num" id="5611512">2</span><span class="op" id="5611513">,</span>&nbsp;<span class="num" id="5611515">4</span><span class="op" id="5611516">,</span>&nbsp;<span class="num" id="5611518">3</span><span class="op" id="5611519">,</span>&nbsp;<span class="num" id="5611521">5</span><span class="op" id="5611522">,</span>&nbsp;<span class="num" id="5611524">5</span><span class="op" id="5611525">,</span>&nbsp;<span class="num" id="5611527">4</span><span class="op" id="5611528">,</span>&nbsp;<span class="num" id="5611530">4</span><span class="op" id="5611531">,</span>&nbsp;<span class="num" id="5611533">0</span><span class="op" id="5611534">,</span>&nbsp;<span class="num" id="5611536">0</span><span class="op" id="5611537">,</span>&nbsp;<span class="num" id="5611539">1</span><span class="op" id="5611540">,</span>&nbsp;<span class="num" id="5611542">125</span><span class="op" id="5611545">}</span><span class="op" id="5611546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5611550">[</span><span class="op" id="5611551">]</span><span class="builtintype" id="5611552">byte</span><span class="op" id="5611556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5611561">0x01</span><span class="op" id="5611565">,</span>&nbsp;<span class="num" id="5611567">0x02</span><span class="op" id="5611571">,</span>&nbsp;<span class="num" id="5611573">0x03</span><span class="op" id="5611577">,</span>&nbsp;<span class="num" id="5611579">0x00</span><span class="op" id="5611583">,</span>&nbsp;<span class="num" id="5611585">0x04</span><span class="op" id="5611589">,</span>&nbsp;<span class="num" id="5611591">0x11</span><span class="op" id="5611595">,</span>&nbsp;<span class="num" id="5611597">0x05</span><span class="op" id="5611601">,</span>&nbsp;<span class="num" id="5611603">0x12</span><span class="op" id="5611607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5611612">0x21</span><span class="op" id="5611616">,</span>&nbsp;<span class="num" id="5611618">0x31</span><span class="op" id="5611622">,</span>&nbsp;<span class="num" id="5611624">0x41</span><span class="op" id="5611628">,</span>&nbsp;<span class="num" id="5611630">0x06</span><span class="op" id="5611634">,</span>&nbsp;<span class="num" id="5611636">0x13</span><span class="op" id="5611640">,</span>&nbsp;<span class="num" id="5611642">0x51</span><span class="op" id="5611646">,</span>&nbsp;<span class="num" id="5611648">0x61</span><span class="op" id="5611652">,</span>&nbsp;<span class="num" id="5611654">0x07</span><span class="op" id="5611658">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5611663">0x22</span><span class="op" id="5611667">,</span>&nbsp;<span class="num" id="5611669">0x71</span><span class="op" id="5611673">,</span>&nbsp;<span class="num" id="5611675">0x14</span><span class="op" id="5611679">,</span>&nbsp;<span class="num" id="5611681">0x32</span><span class="op" id="5611685">,</span>&nbsp;<span class="num" id="5611687">0x81</span><span class="op" id="5611691">,</span>&nbsp;<span class="num" id="5611693">0x91</span><span class="op" id="5611697">,</span>&nbsp;<span class="num" id="5611699">0xa1</span><span class="op" id="5611703">,</span>&nbsp;<span class="num" id="5611705">0x08</span><span class="op" id="5611709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5611714">0x23</span><span class="op" id="5611718">,</span>&nbsp;<span class="num" id="5611720">0x42</span><span class="op" id="5611724">,</span>&nbsp;<span class="num" id="5611726">0xb1</span><span class="op" id="5611730">,</span>&nbsp;<span class="num" id="5611732">0xc1</span><span class="op" id="5611736">,</span>&nbsp;<span class="num" id="5611738">0x15</span><span class="op" id="5611742">,</span>&nbsp;<span class="num" id="5611744">0x52</span><span class="op" id="5611748">,</span>&nbsp;<span class="num" id="5611750">0xd1</span><span class="op" id="5611754">,</span>&nbsp;<span class="num" id="5611756">0xf0</span><span class="op" id="5611760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5611765">0x24</span><span class="op" id="5611769">,</span>&nbsp;<span class="num" id="5611771">0x33</span><span class="op" id="5611775">,</span>&nbsp;<span class="num" id="5611777">0x62</span><span class="op" id="5611781">,</span>&nbsp;<span class="num" id="5611783">0x72</span><span class="op" id="5611787">,</span>&nbsp;<span class="num" id="5611789">0x82</span><span class="op" id="5611793">,</span>&nbsp;<span class="num" id="5611795">0x09</span><span class="op" id="5611799">,</span>&nbsp;<span class="num" id="5611801">0x0a</span><span class="op" id="5611805">,</span>&nbsp;<span class="num" id="5611807">0x16</span><span class="op" id="5611811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5611816">0x17</span><span class="op" id="5611820">,</span>&nbsp;<span class="num" id="5611822">0x18</span><span class="op" id="5611826">,</span>&nbsp;<span class="num" id="5611828">0x19</span><span class="op" id="5611832">,</span>&nbsp;<span class="num" id="5611834">0x1a</span><span class="op" id="5611838">,</span>&nbsp;<span class="num" id="5611840">0x25</span><span class="op" id="5611844">,</span>&nbsp;<span class="num" id="5611846">0x26</span><span class="op" id="5611850">,</span>&nbsp;<span class="num" id="5611852">0x27</span><span class="op" id="5611856">,</span>&nbsp;<span class="num" id="5611858">0x28</span><span class="op" id="5611862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5611867">0x29</span><span class="op" id="5611871">,</span>&nbsp;<span class="num" id="5611873">0x2a</span><span class="op" id="5611877">,</span>&nbsp;<span class="num" id="5611879">0x34</span><span class="op" id="5611883">,</span>&nbsp;<span class="num" id="5611885">0x35</span><span class="op" id="5611889">,</span>&nbsp;<span class="num" id="5611891">0x36</span><span class="op" id="5611895">,</span>&nbsp;<span class="num" id="5611897">0x37</span><span class="op" id="5611901">,</span>&nbsp;<span class="num" id="5611903">0x38</span><span class="op" id="5611907">,</span>&nbsp;<span class="num" id="5611909">0x39</span><span class="op" id="5611913">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5611918">0x3a</span><span class="op" id="5611922">,</span>&nbsp;<span class="num" id="5611924">0x43</span><span class="op" id="5611928">,</span>&nbsp;<span class="num" id="5611930">0x44</span><span class="op" id="5611934">,</span>&nbsp;<span class="num" id="5611936">0x45</span><span class="op" id="5611940">,</span>&nbsp;<span class="num" id="5611942">0x46</span><span class="op" id="5611946">,</span>&nbsp;<span class="num" id="5611948">0x47</span><span class="op" id="5611952">,</span>&nbsp;<span class="num" id="5611954">0x48</span><span class="op" id="5611958">,</span>&nbsp;<span class="num" id="5611960">0x49</span><span class="op" id="5611964">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5611969">0x4a</span><span class="op" id="5611973">,</span>&nbsp;<span class="num" id="5611975">0x53</span><span class="op" id="5611979">,</span>&nbsp;<span class="num" id="5611981">0x54</span><span class="op" id="5611985">,</span>&nbsp;<span class="num" id="5611987">0x55</span><span class="op" id="5611991">,</span>&nbsp;<span class="num" id="5611993">0x56</span><span class="op" id="5611997">,</span>&nbsp;<span class="num" id="5611999">0x57</span><span class="op" id="5612003">,</span>&nbsp;<span class="num" id="5612005">0x58</span><span class="op" id="5612009">,</span>&nbsp;<span class="num" id="5612011">0x59</span><span class="op" id="5612015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612020">0x5a</span><span class="op" id="5612024">,</span>&nbsp;<span class="num" id="5612026">0x63</span><span class="op" id="5612030">,</span>&nbsp;<span class="num" id="5612032">0x64</span><span class="op" id="5612036">,</span>&nbsp;<span class="num" id="5612038">0x65</span><span class="op" id="5612042">,</span>&nbsp;<span class="num" id="5612044">0x66</span><span class="op" id="5612048">,</span>&nbsp;<span class="num" id="5612050">0x67</span><span class="op" id="5612054">,</span>&nbsp;<span class="num" id="5612056">0x68</span><span class="op" id="5612060">,</span>&nbsp;<span class="num" id="5612062">0x69</span><span class="op" id="5612066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612071">0x6a</span><span class="op" id="5612075">,</span>&nbsp;<span class="num" id="5612077">0x73</span><span class="op" id="5612081">,</span>&nbsp;<span class="num" id="5612083">0x74</span><span class="op" id="5612087">,</span>&nbsp;<span class="num" id="5612089">0x75</span><span class="op" id="5612093">,</span>&nbsp;<span class="num" id="5612095">0x76</span><span class="op" id="5612099">,</span>&nbsp;<span class="num" id="5612101">0x77</span><span class="op" id="5612105">,</span>&nbsp;<span class="num" id="5612107">0x78</span><span class="op" id="5612111">,</span>&nbsp;<span class="num" id="5612113">0x79</span><span class="op" id="5612117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612122">0x7a</span><span class="op" id="5612126">,</span>&nbsp;<span class="num" id="5612128">0x83</span><span class="op" id="5612132">,</span>&nbsp;<span class="num" id="5612134">0x84</span><span class="op" id="5612138">,</span>&nbsp;<span class="num" id="5612140">0x85</span><span class="op" id="5612144">,</span>&nbsp;<span class="num" id="5612146">0x86</span><span class="op" id="5612150">,</span>&nbsp;<span class="num" id="5612152">0x87</span><span class="op" id="5612156">,</span>&nbsp;<span class="num" id="5612158">0x88</span><span class="op" id="5612162">,</span>&nbsp;<span class="num" id="5612164">0x89</span><span class="op" id="5612168">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612173">0x8a</span><span class="op" id="5612177">,</span>&nbsp;<span class="num" id="5612179">0x92</span><span class="op" id="5612183">,</span>&nbsp;<span class="num" id="5612185">0x93</span><span class="op" id="5612189">,</span>&nbsp;<span class="num" id="5612191">0x94</span><span class="op" id="5612195">,</span>&nbsp;<span class="num" id="5612197">0x95</span><span class="op" id="5612201">,</span>&nbsp;<span class="num" id="5612203">0x96</span><span class="op" id="5612207">,</span>&nbsp;<span class="num" id="5612209">0x97</span><span class="op" id="5612213">,</span>&nbsp;<span class="num" id="5612215">0x98</span><span class="op" id="5612219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612224">0x99</span><span class="op" id="5612228">,</span>&nbsp;<span class="num" id="5612230">0x9a</span><span class="op" id="5612234">,</span>&nbsp;<span class="num" id="5612236">0xa2</span><span class="op" id="5612240">,</span>&nbsp;<span class="num" id="5612242">0xa3</span><span class="op" id="5612246">,</span>&nbsp;<span class="num" id="5612248">0xa4</span><span class="op" id="5612252">,</span>&nbsp;<span class="num" id="5612254">0xa5</span><span class="op" id="5612258">,</span>&nbsp;<span class="num" id="5612260">0xa6</span><span class="op" id="5612264">,</span>&nbsp;<span class="num" id="5612266">0xa7</span><span class="op" id="5612270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612275">0xa8</span><span class="op" id="5612279">,</span>&nbsp;<span class="num" id="5612281">0xa9</span><span class="op" id="5612285">,</span>&nbsp;<span class="num" id="5612287">0xaa</span><span class="op" id="5612291">,</span>&nbsp;<span class="num" id="5612293">0xb2</span><span class="op" id="5612297">,</span>&nbsp;<span class="num" id="5612299">0xb3</span><span class="op" id="5612303">,</span>&nbsp;<span class="num" id="5612305">0xb4</span><span class="op" id="5612309">,</span>&nbsp;<span class="num" id="5612311">0xb5</span><span class="op" id="5612315">,</span>&nbsp;<span class="num" id="5612317">0xb6</span><span class="op" id="5612321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612326">0xb7</span><span class="op" id="5612330">,</span>&nbsp;<span class="num" id="5612332">0xb8</span><span class="op" id="5612336">,</span>&nbsp;<span class="num" id="5612338">0xb9</span><span class="op" id="5612342">,</span>&nbsp;<span class="num" id="5612344">0xba</span><span class="op" id="5612348">,</span>&nbsp;<span class="num" id="5612350">0xc2</span><span class="op" id="5612354">,</span>&nbsp;<span class="num" id="5612356">0xc3</span><span class="op" id="5612360">,</span>&nbsp;<span class="num" id="5612362">0xc4</span><span class="op" id="5612366">,</span>&nbsp;<span class="num" id="5612368">0xc5</span><span class="op" id="5612372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612377">0xc6</span><span class="op" id="5612381">,</span>&nbsp;<span class="num" id="5612383">0xc7</span><span class="op" id="5612387">,</span>&nbsp;<span class="num" id="5612389">0xc8</span><span class="op" id="5612393">,</span>&nbsp;<span class="num" id="5612395">0xc9</span><span class="op" id="5612399">,</span>&nbsp;<span class="num" id="5612401">0xca</span><span class="op" id="5612405">,</span>&nbsp;<span class="num" id="5612407">0xd2</span><span class="op" id="5612411">,</span>&nbsp;<span class="num" id="5612413">0xd3</span><span class="op" id="5612417">,</span>&nbsp;<span class="num" id="5612419">0xd4</span><span class="op" id="5612423">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612428">0xd5</span><span class="op" id="5612432">,</span>&nbsp;<span class="num" id="5612434">0xd6</span><span class="op" id="5612438">,</span>&nbsp;<span class="num" id="5612440">0xd7</span><span class="op" id="5612444">,</span>&nbsp;<span class="num" id="5612446">0xd8</span><span class="op" id="5612450">,</span>&nbsp;<span class="num" id="5612452">0xd9</span><span class="op" id="5612456">,</span>&nbsp;<span class="num" id="5612458">0xda</span><span class="op" id="5612462">,</span>&nbsp;<span class="num" id="5612464">0xe1</span><span class="op" id="5612468">,</span>&nbsp;<span class="num" id="5612470">0xe2</span><span class="op" id="5612474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612479">0xe3</span><span class="op" id="5612483">,</span>&nbsp;<span class="num" id="5612485">0xe4</span><span class="op" id="5612489">,</span>&nbsp;<span class="num" id="5612491">0xe5</span><span class="op" id="5612495">,</span>&nbsp;<span class="num" id="5612497">0xe6</span><span class="op" id="5612501">,</span>&nbsp;<span class="num" id="5612503">0xe7</span><span class="op" id="5612507">,</span>&nbsp;<span class="num" id="5612509">0xe8</span><span class="op" id="5612513">,</span>&nbsp;<span class="num" id="5612515">0xe9</span><span class="op" id="5612519">,</span>&nbsp;<span class="num" id="5612521">0xea</span><span class="op" id="5612525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612530">0xf1</span><span class="op" id="5612534">,</span>&nbsp;<span class="num" id="5612536">0xf2</span><span class="op" id="5612540">,</span>&nbsp;<span class="num" id="5612542">0xf3</span><span class="op" id="5612546">,</span>&nbsp;<span class="num" id="5612548">0xf4</span><span class="op" id="5612552">,</span>&nbsp;<span class="num" id="5612554">0xf5</span><span class="op" id="5612558">,</span>&nbsp;<span class="num" id="5612560">0xf6</span><span class="op" id="5612564">,</span>&nbsp;<span class="num" id="5612566">0xf7</span><span class="op" id="5612570">,</span>&nbsp;<span class="num" id="5612572">0xf8</span><span class="op" id="5612576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612581">0xf9</span><span class="op" id="5612585">,</span>&nbsp;<span class="num" id="5612587">0xfa</span><span class="op" id="5612591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612595">}</span><span class="op" id="5612596">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612599">}</span><span class="op" id="5612600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5612603">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612627">[</span><span class="num" id="5612628">16</span><span class="op" id="5612630">]</span><span class="builtintype" id="5612631">byte</span><span class="op" id="5612635">{</span><span class="num" id="5612636">0</span><span class="op" id="5612637">,</span>&nbsp;<span class="num" id="5612639">3</span><span class="op" id="5612640">,</span>&nbsp;<span class="num" id="5612642">1</span><span class="op" id="5612643">,</span>&nbsp;<span class="num" id="5612645">1</span><span class="op" id="5612646">,</span>&nbsp;<span class="num" id="5612648">1</span><span class="op" id="5612649">,</span>&nbsp;<span class="num" id="5612651">1</span><span class="op" id="5612652">,</span>&nbsp;<span class="num" id="5612654">1</span><span class="op" id="5612655">,</span>&nbsp;<span class="num" id="5612657">1</span><span class="op" id="5612658">,</span>&nbsp;<span class="num" id="5612660">1</span><span class="op" id="5612661">,</span>&nbsp;<span class="num" id="5612663">1</span><span class="op" id="5612664">,</span>&nbsp;<span class="num" id="5612666">1</span><span class="op" id="5612667">,</span>&nbsp;<span class="num" id="5612669">0</span><span class="op" id="5612670">,</span>&nbsp;<span class="num" id="5612672">0</span><span class="op" id="5612673">,</span>&nbsp;<span class="num" id="5612675">0</span><span class="op" id="5612676">,</span>&nbsp;<span class="num" id="5612678">0</span><span class="op" id="5612679">,</span>&nbsp;<span class="num" id="5612681">0</span><span class="op" id="5612682">}</span><span class="op" id="5612683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612687">[</span><span class="op" id="5612688">]</span><span class="builtintype" id="5612689">byte</span><span class="op" id="5612693">{</span><span class="num" id="5612694">0</span><span class="op" id="5612695">,</span>&nbsp;<span class="num" id="5612697">1</span><span class="op" id="5612698">,</span>&nbsp;<span class="num" id="5612700">2</span><span class="op" id="5612701">,</span>&nbsp;<span class="num" id="5612703">3</span><span class="op" id="5612704">,</span>&nbsp;<span class="num" id="5612706">4</span><span class="op" id="5612707">,</span>&nbsp;<span class="num" id="5612709">5</span><span class="op" id="5612710">,</span>&nbsp;<span class="num" id="5612712">6</span><span class="op" id="5612713">,</span>&nbsp;<span class="num" id="5612715">7</span><span class="op" id="5612716">,</span>&nbsp;<span class="num" id="5612718">8</span><span class="op" id="5612719">,</span>&nbsp;<span class="num" id="5612721">9</span><span class="op" id="5612722">,</span>&nbsp;<span class="num" id="5612724">10</span><span class="op" id="5612726">,</span>&nbsp;<span class="num" id="5612728">11</span><span class="op" id="5612730">}</span><span class="op" id="5612731">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612734">}</span><span class="op" id="5612735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5612738">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612762">[</span><span class="num" id="5612763">16</span><span class="op" id="5612765">]</span><span class="builtintype" id="5612766">byte</span><span class="op" id="5612770">{</span><span class="num" id="5612771">0</span><span class="op" id="5612772">,</span>&nbsp;<span class="num" id="5612774">2</span><span class="op" id="5612775">,</span>&nbsp;<span class="num" id="5612777">1</span><span class="op" id="5612778">,</span>&nbsp;<span class="num" id="5612780">2</span><span class="op" id="5612781">,</span>&nbsp;<span class="num" id="5612783">4</span><span class="op" id="5612784">,</span>&nbsp;<span class="num" id="5612786">4</span><span class="op" id="5612787">,</span>&nbsp;<span class="num" id="5612789">3</span><span class="op" id="5612790">,</span>&nbsp;<span class="num" id="5612792">4</span><span class="op" id="5612793">,</span>&nbsp;<span class="num" id="5612795">7</span><span class="op" id="5612796">,</span>&nbsp;<span class="num" id="5612798">5</span><span class="op" id="5612799">,</span>&nbsp;<span class="num" id="5612801">4</span><span class="op" id="5612802">,</span>&nbsp;<span class="num" id="5612804">4</span><span class="op" id="5612805">,</span>&nbsp;<span class="num" id="5612807">0</span><span class="op" id="5612808">,</span>&nbsp;<span class="num" id="5612810">1</span><span class="op" id="5612811">,</span>&nbsp;<span class="num" id="5612813">2</span><span class="op" id="5612814">,</span>&nbsp;<span class="num" id="5612816">119</span><span class="op" id="5612819">}</span><span class="op" id="5612820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5612824">[</span><span class="op" id="5612825">]</span><span class="builtintype" id="5612826">byte</span><span class="op" id="5612830">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612835">0x00</span><span class="op" id="5612839">,</span>&nbsp;<span class="num" id="5612841">0x01</span><span class="op" id="5612845">,</span>&nbsp;<span class="num" id="5612847">0x02</span><span class="op" id="5612851">,</span>&nbsp;<span class="num" id="5612853">0x03</span><span class="op" id="5612857">,</span>&nbsp;<span class="num" id="5612859">0x11</span><span class="op" id="5612863">,</span>&nbsp;<span class="num" id="5612865">0x04</span><span class="op" id="5612869">,</span>&nbsp;<span class="num" id="5612871">0x05</span><span class="op" id="5612875">,</span>&nbsp;<span class="num" id="5612877">0x21</span><span class="op" id="5612881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612886">0x31</span><span class="op" id="5612890">,</span>&nbsp;<span class="num" id="5612892">0x06</span><span class="op" id="5612896">,</span>&nbsp;<span class="num" id="5612898">0x12</span><span class="op" id="5612902">,</span>&nbsp;<span class="num" id="5612904">0x41</span><span class="op" id="5612908">,</span>&nbsp;<span class="num" id="5612910">0x51</span><span class="op" id="5612914">,</span>&nbsp;<span class="num" id="5612916">0x07</span><span class="op" id="5612920">,</span>&nbsp;<span class="num" id="5612922">0x61</span><span class="op" id="5612926">,</span>&nbsp;<span class="num" id="5612928">0x71</span><span class="op" id="5612932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612937">0x13</span><span class="op" id="5612941">,</span>&nbsp;<span class="num" id="5612943">0x22</span><span class="op" id="5612947">,</span>&nbsp;<span class="num" id="5612949">0x32</span><span class="op" id="5612953">,</span>&nbsp;<span class="num" id="5612955">0x81</span><span class="op" id="5612959">,</span>&nbsp;<span class="num" id="5612961">0x08</span><span class="op" id="5612965">,</span>&nbsp;<span class="num" id="5612967">0x14</span><span class="op" id="5612971">,</span>&nbsp;<span class="num" id="5612973">0x42</span><span class="op" id="5612977">,</span>&nbsp;<span class="num" id="5612979">0x91</span><span class="op" id="5612983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5612988">0xa1</span><span class="op" id="5612992">,</span>&nbsp;<span class="num" id="5612994">0xb1</span><span class="op" id="5612998">,</span>&nbsp;<span class="num" id="5613000">0xc1</span><span class="op" id="5613004">,</span>&nbsp;<span class="num" id="5613006">0x09</span><span class="op" id="5613010">,</span>&nbsp;<span class="num" id="5613012">0x23</span><span class="op" id="5613016">,</span>&nbsp;<span class="num" id="5613018">0x33</span><span class="op" id="5613022">,</span>&nbsp;<span class="num" id="5613024">0x52</span><span class="op" id="5613028">,</span>&nbsp;<span class="num" id="5613030">0xf0</span><span class="op" id="5613034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613039">0x15</span><span class="op" id="5613043">,</span>&nbsp;<span class="num" id="5613045">0x62</span><span class="op" id="5613049">,</span>&nbsp;<span class="num" id="5613051">0x72</span><span class="op" id="5613055">,</span>&nbsp;<span class="num" id="5613057">0xd1</span><span class="op" id="5613061">,</span>&nbsp;<span class="num" id="5613063">0x0a</span><span class="op" id="5613067">,</span>&nbsp;<span class="num" id="5613069">0x16</span><span class="op" id="5613073">,</span>&nbsp;<span class="num" id="5613075">0x24</span><span class="op" id="5613079">,</span>&nbsp;<span class="num" id="5613081">0x34</span><span class="op" id="5613085">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613090">0xe1</span><span class="op" id="5613094">,</span>&nbsp;<span class="num" id="5613096">0x25</span><span class="op" id="5613100">,</span>&nbsp;<span class="num" id="5613102">0xf1</span><span class="op" id="5613106">,</span>&nbsp;<span class="num" id="5613108">0x17</span><span class="op" id="5613112">,</span>&nbsp;<span class="num" id="5613114">0x18</span><span class="op" id="5613118">,</span>&nbsp;<span class="num" id="5613120">0x19</span><span class="op" id="5613124">,</span>&nbsp;<span class="num" id="5613126">0x1a</span><span class="op" id="5613130">,</span>&nbsp;<span class="num" id="5613132">0x26</span><span class="op" id="5613136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613141">0x27</span><span class="op" id="5613145">,</span>&nbsp;<span class="num" id="5613147">0x28</span><span class="op" id="5613151">,</span>&nbsp;<span class="num" id="5613153">0x29</span><span class="op" id="5613157">,</span>&nbsp;<span class="num" id="5613159">0x2a</span><span class="op" id="5613163">,</span>&nbsp;<span class="num" id="5613165">0x35</span><span class="op" id="5613169">,</span>&nbsp;<span class="num" id="5613171">0x36</span><span class="op" id="5613175">,</span>&nbsp;<span class="num" id="5613177">0x37</span><span class="op" id="5613181">,</span>&nbsp;<span class="num" id="5613183">0x38</span><span class="op" id="5613187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613192">0x39</span><span class="op" id="5613196">,</span>&nbsp;<span class="num" id="5613198">0x3a</span><span class="op" id="5613202">,</span>&nbsp;<span class="num" id="5613204">0x43</span><span class="op" id="5613208">,</span>&nbsp;<span class="num" id="5613210">0x44</span><span class="op" id="5613214">,</span>&nbsp;<span class="num" id="5613216">0x45</span><span class="op" id="5613220">,</span>&nbsp;<span class="num" id="5613222">0x46</span><span class="op" id="5613226">,</span>&nbsp;<span class="num" id="5613228">0x47</span><span class="op" id="5613232">,</span>&nbsp;<span class="num" id="5613234">0x48</span><span class="op" id="5613238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613243">0x49</span><span class="op" id="5613247">,</span>&nbsp;<span class="num" id="5613249">0x4a</span><span class="op" id="5613253">,</span>&nbsp;<span class="num" id="5613255">0x53</span><span class="op" id="5613259">,</span>&nbsp;<span class="num" id="5613261">0x54</span><span class="op" id="5613265">,</span>&nbsp;<span class="num" id="5613267">0x55</span><span class="op" id="5613271">,</span>&nbsp;<span class="num" id="5613273">0x56</span><span class="op" id="5613277">,</span>&nbsp;<span class="num" id="5613279">0x57</span><span class="op" id="5613283">,</span>&nbsp;<span class="num" id="5613285">0x58</span><span class="op" id="5613289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613294">0x59</span><span class="op" id="5613298">,</span>&nbsp;<span class="num" id="5613300">0x5a</span><span class="op" id="5613304">,</span>&nbsp;<span class="num" id="5613306">0x63</span><span class="op" id="5613310">,</span>&nbsp;<span class="num" id="5613312">0x64</span><span class="op" id="5613316">,</span>&nbsp;<span class="num" id="5613318">0x65</span><span class="op" id="5613322">,</span>&nbsp;<span class="num" id="5613324">0x66</span><span class="op" id="5613328">,</span>&nbsp;<span class="num" id="5613330">0x67</span><span class="op" id="5613334">,</span>&nbsp;<span class="num" id="5613336">0x68</span><span class="op" id="5613340">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613345">0x69</span><span class="op" id="5613349">,</span>&nbsp;<span class="num" id="5613351">0x6a</span><span class="op" id="5613355">,</span>&nbsp;<span class="num" id="5613357">0x73</span><span class="op" id="5613361">,</span>&nbsp;<span class="num" id="5613363">0x74</span><span class="op" id="5613367">,</span>&nbsp;<span class="num" id="5613369">0x75</span><span class="op" id="5613373">,</span>&nbsp;<span class="num" id="5613375">0x76</span><span class="op" id="5613379">,</span>&nbsp;<span class="num" id="5613381">0x77</span><span class="op" id="5613385">,</span>&nbsp;<span class="num" id="5613387">0x78</span><span class="op" id="5613391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613396">0x79</span><span class="op" id="5613400">,</span>&nbsp;<span class="num" id="5613402">0x7a</span><span class="op" id="5613406">,</span>&nbsp;<span class="num" id="5613408">0x82</span><span class="op" id="5613412">,</span>&nbsp;<span class="num" id="5613414">0x83</span><span class="op" id="5613418">,</span>&nbsp;<span class="num" id="5613420">0x84</span><span class="op" id="5613424">,</span>&nbsp;<span class="num" id="5613426">0x85</span><span class="op" id="5613430">,</span>&nbsp;<span class="num" id="5613432">0x86</span><span class="op" id="5613436">,</span>&nbsp;<span class="num" id="5613438">0x87</span><span class="op" id="5613442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613447">0x88</span><span class="op" id="5613451">,</span>&nbsp;<span class="num" id="5613453">0x89</span><span class="op" id="5613457">,</span>&nbsp;<span class="num" id="5613459">0x8a</span><span class="op" id="5613463">,</span>&nbsp;<span class="num" id="5613465">0x92</span><span class="op" id="5613469">,</span>&nbsp;<span class="num" id="5613471">0x93</span><span class="op" id="5613475">,</span>&nbsp;<span class="num" id="5613477">0x94</span><span class="op" id="5613481">,</span>&nbsp;<span class="num" id="5613483">0x95</span><span class="op" id="5613487">,</span>&nbsp;<span class="num" id="5613489">0x96</span><span class="op" id="5613493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613498">0x97</span><span class="op" id="5613502">,</span>&nbsp;<span class="num" id="5613504">0x98</span><span class="op" id="5613508">,</span>&nbsp;<span class="num" id="5613510">0x99</span><span class="op" id="5613514">,</span>&nbsp;<span class="num" id="5613516">0x9a</span><span class="op" id="5613520">,</span>&nbsp;<span class="num" id="5613522">0xa2</span><span class="op" id="5613526">,</span>&nbsp;<span class="num" id="5613528">0xa3</span><span class="op" id="5613532">,</span>&nbsp;<span class="num" id="5613534">0xa4</span><span class="op" id="5613538">,</span>&nbsp;<span class="num" id="5613540">0xa5</span><span class="op" id="5613544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613549">0xa6</span><span class="op" id="5613553">,</span>&nbsp;<span class="num" id="5613555">0xa7</span><span class="op" id="5613559">,</span>&nbsp;<span class="num" id="5613561">0xa8</span><span class="op" id="5613565">,</span>&nbsp;<span class="num" id="5613567">0xa9</span><span class="op" id="5613571">,</span>&nbsp;<span class="num" id="5613573">0xaa</span><span class="op" id="5613577">,</span>&nbsp;<span class="num" id="5613579">0xb2</span><span class="op" id="5613583">,</span>&nbsp;<span class="num" id="5613585">0xb3</span><span class="op" id="5613589">,</span>&nbsp;<span class="num" id="5613591">0xb4</span><span class="op" id="5613595">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613600">0xb5</span><span class="op" id="5613604">,</span>&nbsp;<span class="num" id="5613606">0xb6</span><span class="op" id="5613610">,</span>&nbsp;<span class="num" id="5613612">0xb7</span><span class="op" id="5613616">,</span>&nbsp;<span class="num" id="5613618">0xb8</span><span class="op" id="5613622">,</span>&nbsp;<span class="num" id="5613624">0xb9</span><span class="op" id="5613628">,</span>&nbsp;<span class="num" id="5613630">0xba</span><span class="op" id="5613634">,</span>&nbsp;<span class="num" id="5613636">0xc2</span><span class="op" id="5613640">,</span>&nbsp;<span class="num" id="5613642">0xc3</span><span class="op" id="5613646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613651">0xc4</span><span class="op" id="5613655">,</span>&nbsp;<span class="num" id="5613657">0xc5</span><span class="op" id="5613661">,</span>&nbsp;<span class="num" id="5613663">0xc6</span><span class="op" id="5613667">,</span>&nbsp;<span class="num" id="5613669">0xc7</span><span class="op" id="5613673">,</span>&nbsp;<span class="num" id="5613675">0xc8</span><span class="op" id="5613679">,</span>&nbsp;<span class="num" id="5613681">0xc9</span><span class="op" id="5613685">,</span>&nbsp;<span class="num" id="5613687">0xca</span><span class="op" id="5613691">,</span>&nbsp;<span class="num" id="5613693">0xd2</span><span class="op" id="5613697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613702">0xd3</span><span class="op" id="5613706">,</span>&nbsp;<span class="num" id="5613708">0xd4</span><span class="op" id="5613712">,</span>&nbsp;<span class="num" id="5613714">0xd5</span><span class="op" id="5613718">,</span>&nbsp;<span class="num" id="5613720">0xd6</span><span class="op" id="5613724">,</span>&nbsp;<span class="num" id="5613726">0xd7</span><span class="op" id="5613730">,</span>&nbsp;<span class="num" id="5613732">0xd8</span><span class="op" id="5613736">,</span>&nbsp;<span class="num" id="5613738">0xd9</span><span class="op" id="5613742">,</span>&nbsp;<span class="num" id="5613744">0xda</span><span class="op" id="5613748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613753">0xe2</span><span class="op" id="5613757">,</span>&nbsp;<span class="num" id="5613759">0xe3</span><span class="op" id="5613763">,</span>&nbsp;<span class="num" id="5613765">0xe4</span><span class="op" id="5613769">,</span>&nbsp;<span class="num" id="5613771">0xe5</span><span class="op" id="5613775">,</span>&nbsp;<span class="num" id="5613777">0xe6</span><span class="op" id="5613781">,</span>&nbsp;<span class="num" id="5613783">0xe7</span><span class="op" id="5613787">,</span>&nbsp;<span class="num" id="5613789">0xe8</span><span class="op" id="5613793">,</span>&nbsp;<span class="num" id="5613795">0xe9</span><span class="op" id="5613799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613804">0xea</span><span class="op" id="5613808">,</span>&nbsp;<span class="num" id="5613810">0xf2</span><span class="op" id="5613814">,</span>&nbsp;<span class="num" id="5613816">0xf3</span><span class="op" id="5613820">,</span>&nbsp;<span class="num" id="5613822">0xf4</span><span class="op" id="5613826">,</span>&nbsp;<span class="num" id="5613828">0xf5</span><span class="op" id="5613832">,</span>&nbsp;<span class="num" id="5613834">0xf6</span><span class="op" id="5613838">,</span>&nbsp;<span class="num" id="5613840">0xf7</span><span class="op" id="5613844">,</span>&nbsp;<span class="num" id="5613846">0xf8</span><span class="op" id="5613850">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5613855">0xf9</span><span class="op" id="5613859">,</span>&nbsp;<span class="num" id="5613861">0xfa</span><span class="op" id="5613865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5613869">}</span><span class="op" id="5613870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5613873">}</span><span class="op" id="5613874">,</span><br>
<span class="lineno"></span><span class="op" id="5613876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5613879">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="5613954">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5614031">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="5614109">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5614150">type</span>&nbsp;<span class="ident" id="5614155">huffmanLUT</span>&nbsp;<span class="op" id="5614166">[</span><span class="op" id="5614167">]</span><span class="builtintype" id="5614168">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="5614176">func</span>&nbsp;<span class="op" id="5614181">(</span><span class="ident" id="5614182">h</span>&nbsp;<span class="op" id="5614184">*</span><span class="ident" id="5614185">huffmanLUT</span><span class="op" id="5614195">)</span>&nbsp;<span class="ident" id="5614197">init</span><span class="op" id="5614201">(</span><span class="ident" id="5614202">s</span>&nbsp;<span class="ident" id="5614204">huffmanSpec</span><span class="op" id="5614215">)</span>&nbsp;<span class="op" id="5614217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614220">maxValue</span>&nbsp;<span class="op" id="5614229">:=</span>&nbsp;<span class="num" id="5614232">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614235">for</span>&nbsp;<span class="ident" id="5614239">_</span><span class="op" id="5614240">,</span>&nbsp;<span class="ident" id="5614242">v</span>&nbsp;<span class="op" id="5614244">:=</span>&nbsp;<span class="keyword" id="5614247">range</span>&nbsp;<span class="ident" id="5614253">s</span><span class="op" id="5614254">.</span><span class="ident" id="5614255">value</span>&nbsp;<span class="op" id="5614261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614265">if</span>&nbsp;<span class="builtintype" id="5614268">int</span><span class="op" id="5614271">(</span><span class="ident" id="5614272">v</span><span class="op" id="5614273">)</span>&nbsp;<span class="op" id="5614275">&gt;</span>&nbsp;<span class="ident" id="5614277">maxValue</span>&nbsp;<span class="op" id="5614286">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614291">maxValue</span>&nbsp;<span class="op" id="5614300">=</span>&nbsp;<span class="builtintype" id="5614302">int</span><span class="op" id="5614305">(</span><span class="ident" id="5614306">v</span><span class="op" id="5614307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5614311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5614314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5614317">*</span><span class="ident" id="5614318">h</span>&nbsp;<span class="op" id="5614320">=</span>&nbsp;<span class="builtinfunc" id="5614322">make</span><span class="op" id="5614326">(</span><span class="op" id="5614327">[</span><span class="op" id="5614328">]</span><span class="builtintype" id="5614329">uint32</span><span class="op" id="5614335">,</span>&nbsp;<span class="ident" id="5614337">maxValue</span><span class="op" id="5614345">+</span><span class="num" id="5614346">1</span><span class="op" id="5614347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614350">code</span><span class="op" id="5614354">,</span>&nbsp;<span class="ident" id="5614356">k</span>&nbsp;<span class="op" id="5614358">:=</span>&nbsp;<span class="builtintype" id="5614361">uint32</span><span class="op" id="5614367">(</span><span class="num" id="5614368">0</span><span class="op" id="5614369">)</span><span class="op" id="5614370">,</span>&nbsp;<span class="num" id="5614372">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614375">for</span>&nbsp;<span class="ident" id="5614379">i</span>&nbsp;<span class="op" id="5614381">:=</span>&nbsp;<span class="num" id="5614384">0</span><span class="op" id="5614385">;</span>&nbsp;<span class="ident" id="5614387">i</span>&nbsp;<span class="op" id="5614389">&lt;</span>&nbsp;<span class="builtinfunc" id="5614391">len</span><span class="op" id="5614394">(</span><span class="ident" id="5614395">s</span><span class="op" id="5614396">.</span><span class="ident" id="5614397">count</span><span class="op" id="5614402">)</span><span class="op" id="5614403">;</span>&nbsp;<span class="ident" id="5614405">i</span><span class="op" id="5614406">++</span>&nbsp;<span class="op" id="5614409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614413">nBits</span>&nbsp;<span class="op" id="5614419">:=</span>&nbsp;<span class="builtintype" id="5614422">uint32</span><span class="op" id="5614428">(</span><span class="ident" id="5614429">i</span><span class="op" id="5614430">+</span><span class="num" id="5614431">1</span><span class="op" id="5614432">)</span>&nbsp;<span class="op" id="5614434">&lt;&lt;</span>&nbsp;<span class="num" id="5614437">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614442">for</span>&nbsp;<span class="ident" id="5614446">j</span>&nbsp;<span class="op" id="5614448">:=</span>&nbsp;<span class="builtintype" id="5614451">uint8</span><span class="op" id="5614456">(</span><span class="num" id="5614457">0</span><span class="op" id="5614458">)</span><span class="op" id="5614459">;</span>&nbsp;<span class="ident" id="5614461">j</span>&nbsp;<span class="op" id="5614463">&lt;</span>&nbsp;<span class="ident" id="5614465">s</span><span class="op" id="5614466">.</span><span class="ident" id="5614467">count</span><span class="op" id="5614472">[</span><span class="ident" id="5614473">i</span><span class="op" id="5614474">]</span><span class="op" id="5614475">;</span>&nbsp;<span class="ident" id="5614477">j</span><span class="op" id="5614478">++</span>&nbsp;<span class="op" id="5614481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5614486">(</span><span class="op" id="5614487">*</span><span class="ident" id="5614488">h</span><span class="op" id="5614489">)</span><span class="op" id="5614490">[</span><span class="ident" id="5614491">s</span><span class="op" id="5614492">.</span><span class="ident" id="5614493">value</span><span class="op" id="5614498">[</span><span class="ident" id="5614499">k</span><span class="op" id="5614500">]</span><span class="op" id="5614501">]</span>&nbsp;<span class="op" id="5614503">=</span>&nbsp;<span class="ident" id="5614505">nBits</span>&nbsp;<span class="op" id="5614511">|</span>&nbsp;<span class="ident" id="5614513">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614521">code</span><span class="op" id="5614525">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614531">k</span><span class="op" id="5614532">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5614537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614541">code</span>&nbsp;<span class="op" id="5614546">&lt;&lt;=</span>&nbsp;<span class="num" id="5614550">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5614553">}</span><br>
<span class="lineno"></span><span class="op" id="5614555">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5614558">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="5614623">var</span>&nbsp;<span class="ident" id="5614627">theHuffmanLUT</span>&nbsp;<span class="op" id="5614641">[</span><span class="num" id="5614642">4</span><span class="op" id="5614643">]</span><span class="ident" id="5614644">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5614656">func</span>&nbsp;<span class="ident" id="5614661">init</span><span class="op" id="5614665">(</span><span class="op" id="5614666">)</span>&nbsp;<span class="op" id="5614668">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5614671">for</span>&nbsp;<span class="ident" id="5614675">i</span><span class="op" id="5614676">,</span>&nbsp;<span class="ident" id="5614678">s</span>&nbsp;<span class="op" id="5614680">:=</span>&nbsp;<span class="keyword" id="5614683">range</span>&nbsp;<span class="ident" id="5614689">theHuffmanSpec</span>&nbsp;<span class="op" id="5614704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614708">theHuffmanLUT</span><span class="op" id="5614721">[</span><span class="ident" id="5614722">i</span><span class="op" id="5614723">]</span><span class="op" id="5614724">.</span><span class="ident" id="5614725">init</span><span class="op" id="5614729">(</span><span class="ident" id="5614730">s</span><span class="op" id="5614731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5614734">}</span><br>
<span class="lineno"></span><span class="op" id="5614736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="5614739">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5614771">type</span>&nbsp;<span class="ident" id="5614776">writer</span>&nbsp;<span class="keyword" id="5614783">interface</span>&nbsp;<span class="op" id="5614793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614796">Flush</span><span class="op" id="5614801">(</span><span class="op" id="5614802">)</span>&nbsp;<span class="builtintype" id="5614804">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614811">io</span><span class="op" id="5614813">.</span><span class="ident" id="5614814">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614822">io</span><span class="op" id="5614824">.</span><span class="ident" id="5614825">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="5614836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5614839">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5614887">type</span>&nbsp;<span class="ident" id="5614892">encoder</span>&nbsp;<span class="keyword" id="5614900">struct</span>&nbsp;<span class="op" id="5614907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5614910">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5614985">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615056">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5615060">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615068">err</span>&nbsp;<span class="builtintype" id="5615072">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5615079">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615108">buf</span>&nbsp;<span class="op" id="5615112">[</span><span class="num" id="5615113">16</span><span class="op" id="5615115">]</span><span class="builtintype" id="5615116">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5615122">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615177">bits</span><span class="op" id="5615181">,</span>&nbsp;<span class="ident" id="5615183">nBits</span>&nbsp;<span class="builtintype" id="5615189">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5615197">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615260">quant</span>&nbsp;<span class="op" id="5615266">[</span><span class="ident" id="5615267">nQuantIndex</span><span class="op" id="5615278">]</span><span class="op" id="5615279">[</span><span class="ident" id="5615280">blockSize</span><span class="op" id="5615289">]</span><span class="builtintype" id="5615290">byte</span><br>
<span class="lineno"></span><span class="op" id="5615295">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="5615298">func</span>&nbsp;<span class="op" id="5615303">(</span><span class="ident" id="5615304">e</span>&nbsp;<span class="op" id="5615306">*</span><span class="ident" id="5615307">encoder</span><span class="op" id="5615314">)</span>&nbsp;<span class="ident" id="5615316">flush</span><span class="op" id="5615321">(</span><span class="op" id="5615322">)</span>&nbsp;<span class="op" id="5615324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5615327">if</span>&nbsp;<span class="ident" id="5615330">e</span><span class="op" id="5615331">.</span><span class="ident" id="5615332">err</span>&nbsp;<span class="op" id="5615336">!=</span>&nbsp;<span class="builtintype" id="5615339">nil</span>&nbsp;<span class="op" id="5615343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5615347">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5615355">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615358">e</span><span class="op" id="5615359">.</span><span class="ident" id="5615360">err</span>&nbsp;<span class="op" id="5615364">=</span>&nbsp;<span class="ident" id="5615366">e</span><span class="op" id="5615367">.</span><span class="ident" id="5615368">w</span><span class="op" id="5615369">.</span><span class="ident" id="5615370">Flush</span><span class="op" id="5615375">(</span><span class="op" id="5615376">)</span><br>
<span class="lineno"></span><span class="op" id="5615378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5615381">func</span>&nbsp;<span class="op" id="5615386">(</span><span class="ident" id="5615387">e</span>&nbsp;<span class="op" id="5615389">*</span><span class="ident" id="5615390">encoder</span><span class="op" id="5615397">)</span>&nbsp;<span class="ident" id="5615399">write</span><span class="op" id="5615404">(</span><span class="ident" id="5615405">p</span>&nbsp;<span class="op" id="5615407">[</span><span class="op" id="5615408">]</span><span class="builtintype" id="5615409">byte</span><span class="op" id="5615413">)</span>&nbsp;<span class="op" id="5615415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5615418">if</span>&nbsp;<span class="ident" id="5615421">e</span><span class="op" id="5615422">.</span><span class="ident" id="5615423">err</span>&nbsp;<span class="op" id="5615427">!=</span>&nbsp;<span class="builtintype" id="5615430">nil</span>&nbsp;<span class="op" id="5615434">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5615438">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5615446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615449">_</span><span class="op" id="5615450">,</span>&nbsp;<span class="ident" id="5615452">e</span><span class="op" id="5615453">.</span><span class="ident" id="5615454">err</span>&nbsp;<span class="op" id="5615458">=</span>&nbsp;<span class="ident" id="5615460">e</span><span class="op" id="5615461">.</span><span class="ident" id="5615462">w</span><span class="op" id="5615463">.</span><span class="ident" id="5615464">Write</span><span class="op" id="5615469">(</span><span class="ident" id="5615470">p</span><span class="op" id="5615471">)</span><br>
<span class="lineno"></span><span class="op" id="5615473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="5615476">func</span>&nbsp;<span class="op" id="5615481">(</span><span class="ident" id="5615482">e</span>&nbsp;<span class="op" id="5615484">*</span><span class="ident" id="5615485">encoder</span><span class="op" id="5615492">)</span>&nbsp;<span class="ident" id="5615494">writeByte</span><span class="op" id="5615503">(</span><span class="ident" id="5615504">b</span>&nbsp;<span class="builtintype" id="5615506">byte</span><span class="op" id="5615510">)</span>&nbsp;<span class="op" id="5615512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5615515">if</span>&nbsp;<span class="ident" id="5615518">e</span><span class="op" id="5615519">.</span><span class="ident" id="5615520">err</span>&nbsp;<span class="op" id="5615524">!=</span>&nbsp;<span class="builtintype" id="5615527">nil</span>&nbsp;<span class="op" id="5615531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5615535">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5615543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615546">e</span><span class="op" id="5615547">.</span><span class="ident" id="5615548">err</span>&nbsp;<span class="op" id="5615552">=</span>&nbsp;<span class="ident" id="5615554">e</span><span class="op" id="5615555">.</span><span class="ident" id="5615556">w</span><span class="op" id="5615557">.</span><span class="ident" id="5615558">WriteByte</span><span class="op" id="5615567">(</span><span class="ident" id="5615568">b</span><span class="op" id="5615569">)</span><br>
<span class="lineno">250</span><span class="op" id="5615571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5615574">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="5615648">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="5615703">func</span>&nbsp;<span class="op" id="5615708">(</span><span class="ident" id="5615709">e</span>&nbsp;<span class="op" id="5615711">*</span><span class="ident" id="5615712">encoder</span><span class="op" id="5615719">)</span>&nbsp;<span class="ident" id="5615721">emit</span><span class="op" id="5615725">(</span><span class="ident" id="5615726">bits</span><span class="op" id="5615730">,</span>&nbsp;<span class="ident" id="5615732">nBits</span>&nbsp;<span class="builtintype" id="5615738">uint32</span><span class="op" id="5615744">)</span>&nbsp;<span class="op" id="5615746">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615749">nBits</span>&nbsp;<span class="op" id="5615755">+=</span>&nbsp;<span class="ident" id="5615758">e</span><span class="op" id="5615759">.</span><span class="ident" id="5615760">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615767">bits</span>&nbsp;<span class="op" id="5615772">&lt;&lt;=</span>&nbsp;<span class="num" id="5615776">32</span>&nbsp;<span class="op" id="5615779">-</span>&nbsp;<span class="ident" id="5615781">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615788">bits</span>&nbsp;<span class="op" id="5615793">|=</span>&nbsp;<span class="ident" id="5615796">e</span><span class="op" id="5615797">.</span><span class="ident" id="5615798">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5615804">for</span>&nbsp;<span class="ident" id="5615808">nBits</span>&nbsp;<span class="op" id="5615814">&gt;=</span>&nbsp;<span class="num" id="5615817">8</span>&nbsp;<span class="op" id="5615819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615823">b</span>&nbsp;<span class="op" id="5615825">:=</span>&nbsp;<span class="builtintype" id="5615828">uint8</span><span class="op" id="5615833">(</span><span class="ident" id="5615834">bits</span>&nbsp;<span class="op" id="5615839">&gt;&gt;</span>&nbsp;<span class="num" id="5615842">24</span><span class="op" id="5615844">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615848">e</span><span class="op" id="5615849">.</span><span class="ident" id="5615850">writeByte</span><span class="op" id="5615859">(</span><span class="ident" id="5615860">b</span><span class="op" id="5615861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5615865">if</span>&nbsp;<span class="ident" id="5615868">b</span>&nbsp;<span class="op" id="5615870">==</span>&nbsp;<span class="num" id="5615873">0xff</span>&nbsp;<span class="op" id="5615878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615883">e</span><span class="op" id="5615884">.</span><span class="ident" id="5615885">writeByte</span><span class="op" id="5615894">(</span><span class="num" id="5615895">0x00</span><span class="op" id="5615899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5615903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615907">bits</span>&nbsp;<span class="op" id="5615912">&lt;&lt;=</span>&nbsp;<span class="num" id="5615916">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615920">nBits</span>&nbsp;<span class="op" id="5615926">-=</span>&nbsp;<span class="num" id="5615929">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5615932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5615935">e</span><span class="op" id="5615936">.</span><span class="ident" id="5615937">bits</span><span class="op" id="5615941">,</span>&nbsp;<span class="ident" id="5615943">e</span><span class="op" id="5615944">.</span><span class="ident" id="5615945">nBits</span>&nbsp;<span class="op" id="5615951">=</span>&nbsp;<span class="ident" id="5615953">bits</span><span class="op" id="5615957">,</span>&nbsp;<span class="ident" id="5615959">nBits</span><br>
<span class="lineno"></span><span class="op" id="5615965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5615968">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5616034">func</span>&nbsp;<span class="op" id="5616039">(</span><span class="ident" id="5616040">e</span>&nbsp;<span class="op" id="5616042">*</span><span class="ident" id="5616043">encoder</span><span class="op" id="5616050">)</span>&nbsp;<span class="ident" id="5616052">emitHuff</span><span class="op" id="5616060">(</span><span class="ident" id="5616061">h</span>&nbsp;<span class="ident" id="5616063">huffIndex</span><span class="op" id="5616072">,</span>&nbsp;<span class="ident" id="5616074">value</span>&nbsp;<span class="builtintype" id="5616080">int32</span><span class="op" id="5616085">)</span>&nbsp;<span class="op" id="5616087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616090">x</span>&nbsp;<span class="op" id="5616092">:=</span>&nbsp;<span class="ident" id="5616095">theHuffmanLUT</span><span class="op" id="5616108">[</span><span class="ident" id="5616109">h</span><span class="op" id="5616110">]</span><span class="op" id="5616111">[</span><span class="ident" id="5616112">value</span><span class="op" id="5616117">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616120">e</span><span class="op" id="5616121">.</span><span class="ident" id="5616122">emit</span><span class="op" id="5616126">(</span><span class="ident" id="5616127">x</span><span class="op" id="5616128">&amp;</span><span class="op" id="5616129">(</span><span class="num" id="5616130">1</span><span class="op" id="5616131">&lt;&lt;</span><span class="num" id="5616133">24</span><span class="op" id="5616135">-</span><span class="num" id="5616136">1</span><span class="op" id="5616137">)</span><span class="op" id="5616138">,</span>&nbsp;<span class="ident" id="5616140">x</span><span class="op" id="5616141">&gt;&gt;</span><span class="num" id="5616143">24</span><span class="op" id="5616145">)</span><br>
<span class="lineno"></span><span class="op" id="5616147">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="5616150">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5616229">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5616249">func</span>&nbsp;<span class="op" id="5616254">(</span><span class="ident" id="5616255">e</span>&nbsp;<span class="op" id="5616257">*</span><span class="ident" id="5616258">encoder</span><span class="op" id="5616265">)</span>&nbsp;<span class="ident" id="5616267">emitHuffRLE</span><span class="op" id="5616278">(</span><span class="ident" id="5616279">h</span>&nbsp;<span class="ident" id="5616281">huffIndex</span><span class="op" id="5616290">,</span>&nbsp;<span class="ident" id="5616292">runLength</span><span class="op" id="5616301">,</span>&nbsp;<span class="ident" id="5616303">value</span>&nbsp;<span class="builtintype" id="5616309">int32</span><span class="op" id="5616314">)</span>&nbsp;<span class="op" id="5616316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616319">a</span><span class="op" id="5616320">,</span>&nbsp;<span class="ident" id="5616322">b</span>&nbsp;<span class="op" id="5616324">:=</span>&nbsp;<span class="ident" id="5616327">value</span><span class="op" id="5616332">,</span>&nbsp;<span class="ident" id="5616334">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5616341">if</span>&nbsp;<span class="ident" id="5616344">a</span>&nbsp;<span class="op" id="5616346">&lt;</span>&nbsp;<span class="num" id="5616348">0</span>&nbsp;<span class="op" id="5616350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616354">a</span><span class="op" id="5616355">,</span>&nbsp;<span class="ident" id="5616357">b</span>&nbsp;<span class="op" id="5616359">=</span>&nbsp;<span class="op" id="5616361">-</span><span class="ident" id="5616362">value</span><span class="op" id="5616367">,</span>&nbsp;<span class="ident" id="5616369">value</span><span class="op" id="5616374">-</span><span class="num" id="5616375">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5616378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5616381">var</span>&nbsp;<span class="ident" id="5616385">nBits</span>&nbsp;<span class="builtintype" id="5616391">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5616399">if</span>&nbsp;<span class="ident" id="5616402">a</span>&nbsp;<span class="op" id="5616404">&lt;</span>&nbsp;<span class="num" id="5616406">0x100</span>&nbsp;<span class="op" id="5616412">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616416">nBits</span>&nbsp;<span class="op" id="5616422">=</span>&nbsp;<span class="builtintype" id="5616424">uint32</span><span class="op" id="5616430">(</span><span class="ident" id="5616431">bitCount</span><span class="op" id="5616439">[</span><span class="ident" id="5616440">a</span><span class="op" id="5616441">]</span><span class="op" id="5616442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5616445">}</span>&nbsp;<span class="keyword" id="5616447">else</span>&nbsp;<span class="op" id="5616452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616456">nBits</span>&nbsp;<span class="op" id="5616462">=</span>&nbsp;<span class="num" id="5616464">8</span>&nbsp;<span class="op" id="5616466">+</span>&nbsp;<span class="builtintype" id="5616468">uint32</span><span class="op" id="5616474">(</span><span class="ident" id="5616475">bitCount</span><span class="op" id="5616483">[</span><span class="ident" id="5616484">a</span><span class="op" id="5616485">&gt;&gt;</span><span class="num" id="5616487">8</span><span class="op" id="5616488">]</span><span class="op" id="5616489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5616492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616495">e</span><span class="op" id="5616496">.</span><span class="ident" id="5616497">emitHuff</span><span class="op" id="5616505">(</span><span class="ident" id="5616506">h</span><span class="op" id="5616507">,</span>&nbsp;<span class="ident" id="5616509">runLength</span><span class="op" id="5616518">&lt;&lt;</span><span class="num" id="5616520">4</span><span class="op" id="5616521">|</span><span class="builtintype" id="5616522">int32</span><span class="op" id="5616527">(</span><span class="ident" id="5616528">nBits</span><span class="op" id="5616533">)</span><span class="op" id="5616534">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5616537">if</span>&nbsp;<span class="ident" id="5616540">nBits</span>&nbsp;<span class="op" id="5616546">&gt;</span>&nbsp;<span class="num" id="5616548">0</span>&nbsp;<span class="op" id="5616550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616554">e</span><span class="op" id="5616555">.</span><span class="ident" id="5616556">emit</span><span class="op" id="5616560">(</span><span class="builtintype" id="5616561">uint32</span><span class="op" id="5616567">(</span><span class="ident" id="5616568">b</span><span class="op" id="5616569">)</span><span class="op" id="5616570">&amp;</span><span class="op" id="5616571">(</span><span class="num" id="5616572">1</span><span class="op" id="5616573">&lt;&lt;</span><span class="ident" id="5616575">nBits</span><span class="op" id="5616580">-</span><span class="num" id="5616581">1</span><span class="op" id="5616582">)</span><span class="op" id="5616583">,</span>&nbsp;<span class="ident" id="5616585">nBits</span><span class="op" id="5616590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5616593">}</span><br>
<span class="lineno"></span><span class="op" id="5616595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="5616598">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5616673">func</span>&nbsp;<span class="op" id="5616678">(</span><span class="ident" id="5616679">e</span>&nbsp;<span class="op" id="5616681">*</span><span class="ident" id="5616682">encoder</span><span class="op" id="5616689">)</span>&nbsp;<span class="ident" id="5616691">writeMarkerHeader</span><span class="op" id="5616708">(</span><span class="ident" id="5616709">marker</span>&nbsp;<span class="builtintype" id="5616716">uint8</span><span class="op" id="5616721">,</span>&nbsp;<span class="ident" id="5616723">markerlen</span>&nbsp;<span class="builtintype" id="5616733">int</span><span class="op" id="5616736">)</span>&nbsp;<span class="op" id="5616738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616741">e</span><span class="op" id="5616742">.</span><span class="ident" id="5616743">buf</span><span class="op" id="5616746">[</span><span class="num" id="5616747">0</span><span class="op" id="5616748">]</span>&nbsp;<span class="op" id="5616750">=</span>&nbsp;<span class="num" id="5616752">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616758">e</span><span class="op" id="5616759">.</span><span class="ident" id="5616760">buf</span><span class="op" id="5616763">[</span><span class="num" id="5616764">1</span><span class="op" id="5616765">]</span>&nbsp;<span class="op" id="5616767">=</span>&nbsp;<span class="ident" id="5616769">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616777">e</span><span class="op" id="5616778">.</span><span class="ident" id="5616779">buf</span><span class="op" id="5616782">[</span><span class="num" id="5616783">2</span><span class="op" id="5616784">]</span>&nbsp;<span class="op" id="5616786">=</span>&nbsp;<span class="builtintype" id="5616788">uint8</span><span class="op" id="5616793">(</span><span class="ident" id="5616794">markerlen</span>&nbsp;<span class="op" id="5616804">&gt;&gt;</span>&nbsp;<span class="num" id="5616807">8</span><span class="op" id="5616808">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616811">e</span><span class="op" id="5616812">.</span><span class="ident" id="5616813">buf</span><span class="op" id="5616816">[</span><span class="num" id="5616817">3</span><span class="op" id="5616818">]</span>&nbsp;<span class="op" id="5616820">=</span>&nbsp;<span class="builtintype" id="5616822">uint8</span><span class="op" id="5616827">(</span><span class="ident" id="5616828">markerlen</span>&nbsp;<span class="op" id="5616838">&amp;</span>&nbsp;<span class="num" id="5616840">0xff</span><span class="op" id="5616844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616847">e</span><span class="op" id="5616848">.</span><span class="ident" id="5616849">write</span><span class="op" id="5616854">(</span><span class="ident" id="5616855">e</span><span class="op" id="5616856">.</span><span class="ident" id="5616857">buf</span><span class="op" id="5616860">[</span><span class="op" id="5616861">:</span><span class="num" id="5616862">4</span><span class="op" id="5616863">]</span><span class="op" id="5616864">)</span><br>
<span class="lineno"></span><span class="op" id="5616866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5616869">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="5616926">func</span>&nbsp;<span class="op" id="5616931">(</span><span class="ident" id="5616932">e</span>&nbsp;<span class="op" id="5616934">*</span><span class="ident" id="5616935">encoder</span><span class="op" id="5616942">)</span>&nbsp;<span class="ident" id="5616944">writeDQT</span><span class="op" id="5616952">(</span><span class="op" id="5616953">)</span>&nbsp;<span class="op" id="5616955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5616958">const</span>&nbsp;<span class="ident" id="5616964">markerlen</span>&nbsp;<span class="op" id="5616974">=</span>&nbsp;<span class="num" id="5616976">2</span>&nbsp;<span class="op" id="5616978">+</span>&nbsp;<span class="builtintype" id="5616980">int</span><span class="op" id="5616983">(</span><span class="ident" id="5616984">nQuantIndex</span><span class="op" id="5616995">)</span><span class="op" id="5616996">*</span><span class="op" id="5616997">(</span><span class="num" id="5616998">1</span><span class="op" id="5616999">+</span><span class="ident" id="5617000">blockSize</span><span class="op" id="5617009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617012">e</span><span class="op" id="5617013">.</span><span class="ident" id="5617014">writeMarkerHeader</span><span class="op" id="5617031">(</span><span class="ident" id="5617032">dqtMarker</span><span class="op" id="5617041">,</span>&nbsp;<span class="ident" id="5617043">markerlen</span><span class="op" id="5617052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5617055">for</span>&nbsp;<span class="ident" id="5617059">i</span>&nbsp;<span class="op" id="5617061">:=</span>&nbsp;<span class="keyword" id="5617064">range</span>&nbsp;<span class="ident" id="5617070">e</span><span class="op" id="5617071">.</span><span class="ident" id="5617072">quant</span>&nbsp;<span class="op" id="5617078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617082">e</span><span class="op" id="5617083">.</span><span class="ident" id="5617084">writeByte</span><span class="op" id="5617093">(</span><span class="builtintype" id="5617094">uint8</span><span class="op" id="5617099">(</span><span class="ident" id="5617100">i</span><span class="op" id="5617101">)</span><span class="op" id="5617102">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617106">e</span><span class="op" id="5617107">.</span><span class="ident" id="5617108">write</span><span class="op" id="5617113">(</span><span class="ident" id="5617114">e</span><span class="op" id="5617115">.</span><span class="ident" id="5617116">quant</span><span class="op" id="5617121">[</span><span class="ident" id="5617122">i</span><span class="op" id="5617123">]</span><span class="op" id="5617124">[</span><span class="op" id="5617125">:</span><span class="op" id="5617126">]</span><span class="op" id="5617127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5617130">}</span><br>
<span class="lineno"></span><span class="op" id="5617132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5617135">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="5617193">func</span>&nbsp;<span class="op" id="5617198">(</span><span class="ident" id="5617199">e</span>&nbsp;<span class="op" id="5617201">*</span><span class="ident" id="5617202">encoder</span><span class="op" id="5617209">)</span>&nbsp;<span class="ident" id="5617211">writeSOF0</span><span class="op" id="5617220">(</span><span class="ident" id="5617221">size</span>&nbsp;<span class="ident" id="5617226">image</span><span class="op" id="5617231">.</span><span class="ident" id="5617232">Point</span><span class="op" id="5617237">,</span>&nbsp;<span class="ident" id="5617239">nComponent</span>&nbsp;<span class="builtintype" id="5617250">int</span><span class="op" id="5617253">)</span>&nbsp;<span class="op" id="5617255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617258">markerlen</span>&nbsp;<span class="op" id="5617268">:=</span>&nbsp;<span class="num" id="5617271">8</span>&nbsp;<span class="op" id="5617273">+</span>&nbsp;<span class="num" id="5617275">3</span><span class="op" id="5617276">*</span><span class="ident" id="5617277">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617289">e</span><span class="op" id="5617290">.</span><span class="ident" id="5617291">writeMarkerHeader</span><span class="op" id="5617308">(</span><span class="ident" id="5617309">sof0Marker</span><span class="op" id="5617319">,</span>&nbsp;<span class="ident" id="5617321">markerlen</span><span class="op" id="5617330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617333">e</span><span class="op" id="5617334">.</span><span class="ident" id="5617335">buf</span><span class="op" id="5617338">[</span><span class="num" id="5617339">0</span><span class="op" id="5617340">]</span>&nbsp;<span class="op" id="5617342">=</span>&nbsp;<span class="num" id="5617344">8</span>&nbsp;<span class="comment" id="5617346">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617363">e</span><span class="op" id="5617364">.</span><span class="ident" id="5617365">buf</span><span class="op" id="5617368">[</span><span class="num" id="5617369">1</span><span class="op" id="5617370">]</span>&nbsp;<span class="op" id="5617372">=</span>&nbsp;<span class="builtintype" id="5617374">uint8</span><span class="op" id="5617379">(</span><span class="ident" id="5617380">size</span><span class="op" id="5617384">.</span><span class="ident" id="5617385">Y</span>&nbsp;<span class="op" id="5617387">&gt;&gt;</span>&nbsp;<span class="num" id="5617390">8</span><span class="op" id="5617391">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617394">e</span><span class="op" id="5617395">.</span><span class="ident" id="5617396">buf</span><span class="op" id="5617399">[</span><span class="num" id="5617400">2</span><span class="op" id="5617401">]</span>&nbsp;<span class="op" id="5617403">=</span>&nbsp;<span class="builtintype" id="5617405">uint8</span><span class="op" id="5617410">(</span><span class="ident" id="5617411">size</span><span class="op" id="5617415">.</span><span class="ident" id="5617416">Y</span>&nbsp;<span class="op" id="5617418">&amp;</span>&nbsp;<span class="num" id="5617420">0xff</span><span class="op" id="5617424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617427">e</span><span class="op" id="5617428">.</span><span class="ident" id="5617429">buf</span><span class="op" id="5617432">[</span><span class="num" id="5617433">3</span><span class="op" id="5617434">]</span>&nbsp;<span class="op" id="5617436">=</span>&nbsp;<span class="builtintype" id="5617438">uint8</span><span class="op" id="5617443">(</span><span class="ident" id="5617444">size</span><span class="op" id="5617448">.</span><span class="ident" id="5617449">X</span>&nbsp;<span class="op" id="5617451">&gt;&gt;</span>&nbsp;<span class="num" id="5617454">8</span><span class="op" id="5617455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617458">e</span><span class="op" id="5617459">.</span><span class="ident" id="5617460">buf</span><span class="op" id="5617463">[</span><span class="num" id="5617464">4</span><span class="op" id="5617465">]</span>&nbsp;<span class="op" id="5617467">=</span>&nbsp;<span class="builtintype" id="5617469">uint8</span><span class="op" id="5617474">(</span><span class="ident" id="5617475">size</span><span class="op" id="5617479">.</span><span class="ident" id="5617480">X</span>&nbsp;<span class="op" id="5617482">&amp;</span>&nbsp;<span class="num" id="5617484">0xff</span><span class="op" id="5617488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617491">e</span><span class="op" id="5617492">.</span><span class="ident" id="5617493">buf</span><span class="op" id="5617496">[</span><span class="num" id="5617497">5</span><span class="op" id="5617498">]</span>&nbsp;<span class="op" id="5617500">=</span>&nbsp;<span class="builtintype" id="5617502">uint8</span><span class="op" id="5617507">(</span><span class="ident" id="5617508">nComponent</span><span class="op" id="5617518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5617521">if</span>&nbsp;<span class="ident" id="5617524">nComponent</span>&nbsp;<span class="op" id="5617535">==</span>&nbsp;<span class="num" id="5617538">1</span>&nbsp;<span class="op" id="5617540">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617544">e</span><span class="op" id="5617545">.</span><span class="ident" id="5617546">buf</span><span class="op" id="5617549">[</span><span class="num" id="5617550">6</span><span class="op" id="5617551">]</span>&nbsp;<span class="op" id="5617553">=</span>&nbsp;<span class="num" id="5617555">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5617559">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617600">e</span><span class="op" id="5617601">.</span><span class="ident" id="5617602">buf</span><span class="op" id="5617605">[</span><span class="num" id="5617606">7</span><span class="op" id="5617607">]</span>&nbsp;<span class="op" id="5617609">=</span>&nbsp;<span class="num" id="5617611">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617618">e</span><span class="op" id="5617619">.</span><span class="ident" id="5617620">buf</span><span class="op" id="5617623">[</span><span class="num" id="5617624">8</span><span class="op" id="5617625">]</span>&nbsp;<span class="op" id="5617627">=</span>&nbsp;<span class="num" id="5617629">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5617635">}</span>&nbsp;<span class="keyword" id="5617637">else</span>&nbsp;<span class="op" id="5617642">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5617646">for</span>&nbsp;<span class="ident" id="5617650">i</span>&nbsp;<span class="op" id="5617652">:=</span>&nbsp;<span class="num" id="5617655">0</span><span class="op" id="5617656">;</span>&nbsp;<span class="ident" id="5617658">i</span>&nbsp;<span class="op" id="5617660">&lt;</span>&nbsp;<span class="ident" id="5617662">nComponent</span><span class="op" id="5617672">;</span>&nbsp;<span class="ident" id="5617674">i</span><span class="op" id="5617675">++</span>&nbsp;<span class="op" id="5617678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617683">e</span><span class="op" id="5617684">.</span><span class="ident" id="5617685">buf</span><span class="op" id="5617688">[</span><span class="num" id="5617689">3</span><span class="op" id="5617690">*</span><span class="ident" id="5617691">i</span><span class="op" id="5617692">+</span><span class="num" id="5617693">6</span><span class="op" id="5617694">]</span>&nbsp;<span class="op" id="5617696">=</span>&nbsp;<span class="builtintype" id="5617698">uint8</span><span class="op" id="5617703">(</span><span class="ident" id="5617704">i</span>&nbsp;<span class="op" id="5617706">+</span>&nbsp;<span class="num" id="5617708">1</span><span class="op" id="5617709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5617714">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617753">e</span><span class="op" id="5617754">.</span><span class="ident" id="5617755">buf</span><span class="op" id="5617758">[</span><span class="num" id="5617759">3</span><span class="op" id="5617760">*</span><span class="ident" id="5617761">i</span><span class="op" id="5617762">+</span><span class="num" id="5617763">7</span><span class="op" id="5617764">]</span>&nbsp;<span class="op" id="5617766">=</span>&nbsp;<span class="string" id="5617768">&#34;\x22\x11\x11&#34;</span><span class="op" id="5617782">[</span><span class="ident" id="5617783">i</span><span class="op" id="5617784">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617789">e</span><span class="op" id="5617790">.</span><span class="ident" id="5617791">buf</span><span class="op" id="5617794">[</span><span class="num" id="5617795">3</span><span class="op" id="5617796">*</span><span class="ident" id="5617797">i</span><span class="op" id="5617798">+</span><span class="num" id="5617799">8</span><span class="op" id="5617800">]</span>&nbsp;<span class="op" id="5617802">=</span>&nbsp;<span class="string" id="5617804">&#34;\x00\x01\x01&#34;</span><span class="op" id="5617818">[</span><span class="ident" id="5617819">i</span><span class="op" id="5617820">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5617824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5617827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617830">e</span><span class="op" id="5617831">.</span><span class="ident" id="5617832">write</span><span class="op" id="5617837">(</span><span class="ident" id="5617838">e</span><span class="op" id="5617839">.</span><span class="ident" id="5617840">buf</span><span class="op" id="5617843">[</span><span class="op" id="5617844">:</span><span class="num" id="5617845">3</span><span class="op" id="5617846">*</span><span class="op" id="5617847">(</span><span class="ident" id="5617848">nComponent</span><span class="op" id="5617858">-</span><span class="num" id="5617859">1</span><span class="op" id="5617860">)</span><span class="op" id="5617861">+</span><span class="num" id="5617862">9</span><span class="op" id="5617863">]</span><span class="op" id="5617864">)</span><br>
<span class="lineno"></span><span class="op" id="5617866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="5617869">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="5617921">func</span>&nbsp;<span class="op" id="5617926">(</span><span class="ident" id="5617927">e</span>&nbsp;<span class="op" id="5617929">*</span><span class="ident" id="5617930">encoder</span><span class="op" id="5617937">)</span>&nbsp;<span class="ident" id="5617939">writeDHT</span><span class="op" id="5617947">(</span><span class="ident" id="5617948">nComponent</span>&nbsp;<span class="builtintype" id="5617959">int</span><span class="op" id="5617962">)</span>&nbsp;<span class="op" id="5617964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617967">markerlen</span>&nbsp;<span class="op" id="5617977">:=</span>&nbsp;<span class="num" id="5617980">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5617983">specs</span>&nbsp;<span class="op" id="5617989">:=</span>&nbsp;<span class="ident" id="5617992">theHuffmanSpec</span><span class="op" id="5618006">[</span><span class="op" id="5618007">:</span><span class="op" id="5618008">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618011">if</span>&nbsp;<span class="ident" id="5618014">nComponent</span>&nbsp;<span class="op" id="5618025">==</span>&nbsp;<span class="num" id="5618028">1</span>&nbsp;<span class="op" id="5618030">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5618034">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618068">specs</span>&nbsp;<span class="op" id="5618074">=</span>&nbsp;<span class="ident" id="5618076">specs</span><span class="op" id="5618081">[</span><span class="op" id="5618082">:</span><span class="num" id="5618083">2</span><span class="op" id="5618084">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5618087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618090">for</span>&nbsp;<span class="ident" id="5618094">_</span><span class="op" id="5618095">,</span>&nbsp;<span class="ident" id="5618097">s</span>&nbsp;<span class="op" id="5618099">:=</span>&nbsp;<span class="keyword" id="5618102">range</span>&nbsp;<span class="ident" id="5618108">specs</span>&nbsp;<span class="op" id="5618114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618118">markerlen</span>&nbsp;<span class="op" id="5618128">+=</span>&nbsp;<span class="num" id="5618131">1</span>&nbsp;<span class="op" id="5618133">+</span>&nbsp;<span class="num" id="5618135">16</span>&nbsp;<span class="op" id="5618138">+</span>&nbsp;<span class="builtinfunc" id="5618140">len</span><span class="op" id="5618143">(</span><span class="ident" id="5618144">s</span><span class="op" id="5618145">.</span><span class="ident" id="5618146">value</span><span class="op" id="5618151">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5618154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618157">e</span><span class="op" id="5618158">.</span><span class="ident" id="5618159">writeMarkerHeader</span><span class="op" id="5618176">(</span><span class="ident" id="5618177">dhtMarker</span><span class="op" id="5618186">,</span>&nbsp;<span class="ident" id="5618188">markerlen</span><span class="op" id="5618197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618200">for</span>&nbsp;<span class="ident" id="5618204">i</span><span class="op" id="5618205">,</span>&nbsp;<span class="ident" id="5618207">s</span>&nbsp;<span class="op" id="5618209">:=</span>&nbsp;<span class="keyword" id="5618212">range</span>&nbsp;<span class="ident" id="5618218">specs</span>&nbsp;<span class="op" id="5618224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618228">e</span><span class="op" id="5618229">.</span><span class="ident" id="5618230">writeByte</span><span class="op" id="5618239">(</span><span class="string" id="5618240">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="5618258">[</span><span class="ident" id="5618259">i</span><span class="op" id="5618260">]</span><span class="op" id="5618261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618265">e</span><span class="op" id="5618266">.</span><span class="ident" id="5618267">write</span><span class="op" id="5618272">(</span><span class="ident" id="5618273">s</span><span class="op" id="5618274">.</span><span class="ident" id="5618275">count</span><span class="op" id="5618280">[</span><span class="op" id="5618281">:</span><span class="op" id="5618282">]</span><span class="op" id="5618283">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618287">e</span><span class="op" id="5618288">.</span><span class="ident" id="5618289">write</span><span class="op" id="5618294">(</span><span class="ident" id="5618295">s</span><span class="op" id="5618296">.</span><span class="ident" id="5618297">value</span><span class="op" id="5618302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5618305">}</span><br>
<span class="lineno"></span><span class="op" id="5618307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5618310">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="5618389">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5618468">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5618500">func</span>&nbsp;<span class="op" id="5618505">(</span><span class="ident" id="5618506">e</span>&nbsp;<span class="op" id="5618508">*</span><span class="ident" id="5618509">encoder</span><span class="op" id="5618516">)</span>&nbsp;<span class="ident" id="5618518">writeBlock</span><span class="op" id="5618528">(</span><span class="ident" id="5618529">b</span>&nbsp;<span class="op" id="5618531">*</span><span class="ident" id="5618532">block</span><span class="op" id="5618537">,</span>&nbsp;<span class="ident" id="5618539">q</span>&nbsp;<span class="ident" id="5618541">quantIndex</span><span class="op" id="5618551">,</span>&nbsp;<span class="ident" id="5618553">prevDC</span>&nbsp;<span class="builtintype" id="5618560">int32</span><span class="op" id="5618565">)</span>&nbsp;<span class="builtintype" id="5618567">int32</span>&nbsp;<span class="op" id="5618573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618576">fdct</span><span class="op" id="5618580">(</span><span class="ident" id="5618581">b</span><span class="op" id="5618582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5618585">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618608">dc</span>&nbsp;<span class="op" id="5618611">:=</span>&nbsp;<span class="ident" id="5618614">div</span><span class="op" id="5618617">(</span><span class="ident" id="5618618">b</span><span class="op" id="5618619">[</span><span class="num" id="5618620">0</span><span class="op" id="5618621">]</span><span class="op" id="5618622">,</span>&nbsp;<span class="num" id="5618624">8</span><span class="op" id="5618625">*</span><span class="builtintype" id="5618626">int32</span><span class="op" id="5618631">(</span><span class="ident" id="5618632">e</span><span class="op" id="5618633">.</span><span class="ident" id="5618634">quant</span><span class="op" id="5618639">[</span><span class="ident" id="5618640">q</span><span class="op" id="5618641">]</span><span class="op" id="5618642">[</span><span class="num" id="5618643">0</span><span class="op" id="5618644">]</span><span class="op" id="5618645">)</span><span class="op" id="5618646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618649">e</span><span class="op" id="5618650">.</span><span class="ident" id="5618651">emitHuffRLE</span><span class="op" id="5618662">(</span><span class="ident" id="5618663">huffIndex</span><span class="op" id="5618672">(</span><span class="num" id="5618673">2</span><span class="op" id="5618674">*</span><span class="ident" id="5618675">q</span><span class="op" id="5618676">+</span><span class="num" id="5618677">0</span><span class="op" id="5618678">)</span><span class="op" id="5618679">,</span>&nbsp;<span class="num" id="5618681">0</span><span class="op" id="5618682">,</span>&nbsp;<span class="ident" id="5618684">dc</span><span class="op" id="5618686">-</span><span class="ident" id="5618687">prevDC</span><span class="op" id="5618693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5618696">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618724">h</span><span class="op" id="5618725">,</span>&nbsp;<span class="ident" id="5618727">runLength</span>&nbsp;<span class="op" id="5618737">:=</span>&nbsp;<span class="ident" id="5618740">huffIndex</span><span class="op" id="5618749">(</span><span class="num" id="5618750">2</span><span class="op" id="5618751">*</span><span class="ident" id="5618752">q</span><span class="op" id="5618753">+</span><span class="num" id="5618754">1</span><span class="op" id="5618755">)</span><span class="op" id="5618756">,</span>&nbsp;<span class="builtintype" id="5618758">int32</span><span class="op" id="5618763">(</span><span class="num" id="5618764">0</span><span class="op" id="5618765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618768">for</span>&nbsp;<span class="ident" id="5618772">zig</span>&nbsp;<span class="op" id="5618776">:=</span>&nbsp;<span class="num" id="5618779">1</span><span class="op" id="5618780">;</span>&nbsp;<span class="ident" id="5618782">zig</span>&nbsp;<span class="op" id="5618786">&lt;</span>&nbsp;<span class="ident" id="5618788">blockSize</span><span class="op" id="5618797">;</span>&nbsp;<span class="ident" id="5618799">zig</span><span class="op" id="5618802">++</span>&nbsp;<span class="op" id="5618805">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618809">ac</span>&nbsp;<span class="op" id="5618812">:=</span>&nbsp;<span class="ident" id="5618815">div</span><span class="op" id="5618818">(</span><span class="ident" id="5618819">b</span><span class="op" id="5618820">[</span><span class="ident" id="5618821">unzig</span><span class="op" id="5618826">[</span><span class="ident" id="5618827">zig</span><span class="op" id="5618830">]</span><span class="op" id="5618831">]</span><span class="op" id="5618832">,</span>&nbsp;<span class="num" id="5618834">8</span><span class="op" id="5618835">*</span><span class="builtintype" id="5618836">int32</span><span class="op" id="5618841">(</span><span class="ident" id="5618842">e</span><span class="op" id="5618843">.</span><span class="ident" id="5618844">quant</span><span class="op" id="5618849">[</span><span class="ident" id="5618850">q</span><span class="op" id="5618851">]</span><span class="op" id="5618852">[</span><span class="ident" id="5618853">zig</span><span class="op" id="5618856">]</span><span class="op" id="5618857">)</span><span class="op" id="5618858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618862">if</span>&nbsp;<span class="ident" id="5618865">ac</span>&nbsp;<span class="op" id="5618868">==</span>&nbsp;<span class="num" id="5618871">0</span>&nbsp;<span class="op" id="5618873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618878">runLength</span><span class="op" id="5618887">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5618892">}</span>&nbsp;<span class="keyword" id="5618894">else</span>&nbsp;<span class="op" id="5618899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5618904">for</span>&nbsp;<span class="ident" id="5618908">runLength</span>&nbsp;<span class="op" id="5618918">&gt;</span>&nbsp;<span class="num" id="5618920">15</span>&nbsp;<span class="op" id="5618923">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618929">e</span><span class="op" id="5618930">.</span><span class="ident" id="5618931">emitHuff</span><span class="op" id="5618939">(</span><span class="ident" id="5618940">h</span><span class="op" id="5618941">,</span>&nbsp;<span class="num" id="5618943">0xf0</span><span class="op" id="5618947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618953">runLength</span>&nbsp;<span class="op" id="5618963">-=</span>&nbsp;<span class="num" id="5618966">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5618972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618977">e</span><span class="op" id="5618978">.</span><span class="ident" id="5618979">emitHuffRLE</span><span class="op" id="5618990">(</span><span class="ident" id="5618991">h</span><span class="op" id="5618992">,</span>&nbsp;<span class="ident" id="5618994">runLength</span><span class="op" id="5619003">,</span>&nbsp;<span class="ident" id="5619005">ac</span><span class="op" id="5619007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619012">runLength</span>&nbsp;<span class="op" id="5619022">=</span>&nbsp;<span class="num" id="5619024">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5619028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5619031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5619034">if</span>&nbsp;<span class="ident" id="5619037">runLength</span>&nbsp;<span class="op" id="5619047">&gt;</span>&nbsp;<span class="num" id="5619049">0</span>&nbsp;<span class="op" id="5619051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619055">e</span><span class="op" id="5619056">.</span><span class="ident" id="5619057">emitHuff</span><span class="op" id="5619065">(</span><span class="ident" id="5619066">h</span><span class="op" id="5619067">,</span>&nbsp;<span class="num" id="5619069">0x00</span><span class="op" id="5619073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5619076">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5619079">return</span>&nbsp;<span class="ident" id="5619086">dc</span><br>
<span class="lineno"></span><span class="op" id="5619089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5619092">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5619166">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="5619183">func</span>&nbsp;<span class="ident" id="5619188">toYCbCr</span><span class="op" id="5619195">(</span><span class="ident" id="5619196">m</span>&nbsp;<span class="ident" id="5619198">image</span><span class="op" id="5619203">.</span><span class="ident" id="5619204">Image</span><span class="op" id="5619209">,</span>&nbsp;<span class="ident" id="5619211">p</span>&nbsp;<span class="ident" id="5619213">image</span><span class="op" id="5619218">.</span><span class="ident" id="5619219">Point</span><span class="op" id="5619224">,</span>&nbsp;<span class="ident" id="5619226">yBlock</span><span class="op" id="5619232">,</span>&nbsp;<span class="ident" id="5619234">cbBlock</span><span class="op" id="5619241">,</span>&nbsp;<span class="ident" id="5619243">crBlock</span>&nbsp;<span class="op" id="5619251">*</span><span class="ident" id="5619252">block</span><span class="op" id="5619257">)</span>&nbsp;<span class="op" id="5619259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619262">b</span>&nbsp;<span class="op" id="5619264">:=</span>&nbsp;<span class="ident" id="5619267">m</span><span class="op" id="5619268">.</span><span class="ident" id="5619269">Bounds</span><span class="op" id="5619275">(</span><span class="op" id="5619276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619279">xmax</span>&nbsp;<span class="op" id="5619284">:=</span>&nbsp;<span class="ident" id="5619287">b</span><span class="op" id="5619288">.</span><span class="ident" id="5619289">Max</span><span class="op" id="5619292">.</span><span class="ident" id="5619293">X</span>&nbsp;<span class="op" id="5619295">-</span>&nbsp;<span class="num" id="5619297">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619300">ymax</span>&nbsp;<span class="op" id="5619305">:=</span>&nbsp;<span class="ident" id="5619308">b</span><span class="op" id="5619309">.</span><span class="ident" id="5619310">Max</span><span class="op" id="5619313">.</span><span class="ident" id="5619314">Y</span>&nbsp;<span class="op" id="5619316">-</span>&nbsp;<span class="num" id="5619318">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5619321">for</span>&nbsp;<span class="ident" id="5619325">j</span>&nbsp;<span class="op" id="5619327">:=</span>&nbsp;<span class="num" id="5619330">0</span><span class="op" id="5619331">;</span>&nbsp;<span class="ident" id="5619333">j</span>&nbsp;<span class="op" id="5619335">&lt;</span>&nbsp;<span class="num" id="5619337">8</span><span class="op" id="5619338">;</span>&nbsp;<span class="ident" id="5619340">j</span><span class="op" id="5619341">++</span>&nbsp;<span class="op" id="5619344">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5619348">for</span>&nbsp;<span class="ident" id="5619352">i</span>&nbsp;<span class="op" id="5619354">:=</span>&nbsp;<span class="num" id="5619357">0</span><span class="op" id="5619358">;</span>&nbsp;<span class="ident" id="5619360">i</span>&nbsp;<span class="op" id="5619362">&lt;</span>&nbsp;<span class="num" id="5619364">8</span><span class="op" id="5619365">;</span>&nbsp;<span class="ident" id="5619367">i</span><span class="op" id="5619368">++</span>&nbsp;<span class="op" id="5619371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619376">r</span><span class="op" id="5619377">,</span>&nbsp;<span class="ident" id="5619379">g</span><span class="op" id="5619380">,</span>&nbsp;<span class="ident" id="5619382">b</span><span class="op" id="5619383">,</span>&nbsp;<span class="ident" id="5619385">_</span>&nbsp;<span class="op" id="5619387">:=</span>&nbsp;<span class="ident" id="5619390">m</span><span class="op" id="5619391">.</span><span class="ident" id="5619392">At</span><span class="op" id="5619394">(</span><span class="ident" id="5619395">min</span><span class="op" id="5619398">(</span><span class="ident" id="5619399">p</span><span class="op" id="5619400">.</span><span class="ident" id="5619401">X</span><span class="op" id="5619402">+</span><span class="ident" id="5619403">i</span><span class="op" id="5619404">,</span>&nbsp;<span class="ident" id="5619406">xmax</span><span class="op" id="5619410">)</span><span class="op" id="5619411">,</span>&nbsp;<span class="ident" id="5619413">min</span><span class="op" id="5619416">(</span><span class="ident" id="5619417">p</span><span class="op" id="5619418">.</span><span class="ident" id="5619419">Y</span><span class="op" id="5619420">+</span><span class="ident" id="5619421">j</span><span class="op" id="5619422">,</span>&nbsp;<span class="ident" id="5619424">ymax</span><span class="op" id="5619428">)</span><span class="op" id="5619429">)</span><span class="op" id="5619430">.</span><span class="ident" id="5619431">RGBA</span><span class="op" id="5619435">(</span><span class="op" id="5619436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619441">yy</span><span class="op" id="5619443">,</span>&nbsp;<span class="ident" id="5619445">cb</span><span class="op" id="5619447">,</span>&nbsp;<span class="ident" id="5619449">cr</span>&nbsp;<span class="op" id="5619452">:=</span>&nbsp;<span class="ident" id="5619455">color</span><span class="op" id="5619460">.</span><span class="ident" id="5619461">RGBToYCbCr</span><span class="op" id="5619471">(</span><span class="builtintype" id="5619472">uint8</span><span class="op" id="5619477">(</span><span class="ident" id="5619478">r</span><span class="op" id="5619479">&gt;&gt;</span><span class="num" id="5619481">8</span><span class="op" id="5619482">)</span><span class="op" id="5619483">,</span>&nbsp;<span class="builtintype" id="5619485">uint8</span><span class="op" id="5619490">(</span><span class="ident" id="5619491">g</span><span class="op" id="5619492">&gt;&gt;</span><span class="num" id="5619494">8</span><span class="op" id="5619495">)</span><span class="op" id="5619496">,</span>&nbsp;<span class="builtintype" id="5619498">uint8</span><span class="op" id="5619503">(</span><span class="ident" id="5619504">b</span><span class="op" id="5619505">&gt;&gt;</span><span class="num" id="5619507">8</span><span class="op" id="5619508">)</span><span class="op" id="5619509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619514">yBlock</span><span class="op" id="5619520">[</span><span class="num" id="5619521">8</span><span class="op" id="5619522">*</span><span class="ident" id="5619523">j</span><span class="op" id="5619524">+</span><span class="ident" id="5619525">i</span><span class="op" id="5619526">]</span>&nbsp;<span class="op" id="5619528">=</span>&nbsp;<span class="builtintype" id="5619530">int32</span><span class="op" id="5619535">(</span><span class="ident" id="5619536">yy</span><span class="op" id="5619538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619543">cbBlock</span><span class="op" id="5619550">[</span><span class="num" id="5619551">8</span><span class="op" id="5619552">*</span><span class="ident" id="5619553">j</span><span class="op" id="5619554">+</span><span class="ident" id="5619555">i</span><span class="op" id="5619556">]</span>&nbsp;<span class="op" id="5619558">=</span>&nbsp;<span class="builtintype" id="5619560">int32</span><span class="op" id="5619565">(</span><span class="ident" id="5619566">cb</span><span class="op" id="5619568">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619573">crBlock</span><span class="op" id="5619580">[</span><span class="num" id="5619581">8</span><span class="op" id="5619582">*</span><span class="ident" id="5619583">j</span><span class="op" id="5619584">+</span><span class="ident" id="5619585">i</span><span class="op" id="5619586">]</span>&nbsp;<span class="op" id="5619588">=</span>&nbsp;<span class="builtintype" id="5619590">int32</span><span class="op" id="5619595">(</span><span class="ident" id="5619596">cr</span><span class="op" id="5619598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5619602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5619605">}</span><br>
<span class="lineno"></span><span class="op" id="5619607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="5619610">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="5619686">func</span>&nbsp;<span class="ident" id="5619691">grayToY</span><span class="op" id="5619698">(</span><span class="ident" id="5619699">m</span>&nbsp;<span class="op" id="5619701">*</span><span class="ident" id="5619702">image</span><span class="op" id="5619707">.</span><span class="ident" id="5619708">Gray</span><span class="op" id="5619712">,</span>&nbsp;<span class="ident" id="5619714">p</span>&nbsp;<span class="ident" id="5619716">image</span><span class="op" id="5619721">.</span><span class="ident" id="5619722">Point</span><span class="op" id="5619727">,</span>&nbsp;<span class="ident" id="5619729">yBlock</span>&nbsp;<span class="op" id="5619736">*</span><span class="ident" id="5619737">block</span><span class="op" id="5619742">)</span>&nbsp;<span class="op" id="5619744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619747">b</span>&nbsp;<span class="op" id="5619749">:=</span>&nbsp;<span class="ident" id="5619752">m</span><span class="op" id="5619753">.</span><span class="ident" id="5619754">Bounds</span><span class="op" id="5619760">(</span><span class="op" id="5619761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619764">xmax</span>&nbsp;<span class="op" id="5619769">:=</span>&nbsp;<span class="ident" id="5619772">b</span><span class="op" id="5619773">.</span><span class="ident" id="5619774">Max</span><span class="op" id="5619777">.</span><span class="ident" id="5619778">X</span>&nbsp;<span class="op" id="5619780">-</span>&nbsp;<span class="num" id="5619782">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619785">ymax</span>&nbsp;<span class="op" id="5619790">:=</span>&nbsp;<span class="ident" id="5619793">b</span><span class="op" id="5619794">.</span><span class="ident" id="5619795">Max</span><span class="op" id="5619798">.</span><span class="ident" id="5619799">Y</span>&nbsp;<span class="op" id="5619801">-</span>&nbsp;<span class="num" id="5619803">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619806">pix</span>&nbsp;<span class="op" id="5619810">:=</span>&nbsp;<span class="ident" id="5619813">m</span><span class="op" id="5619814">.</span><span class="ident" id="5619815">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5619820">for</span>&nbsp;<span class="ident" id="5619824">j</span>&nbsp;<span class="op" id="5619826">:=</span>&nbsp;<span class="num" id="5619829">0</span><span class="op" id="5619830">;</span>&nbsp;<span class="ident" id="5619832">j</span>&nbsp;<span class="op" id="5619834">&lt;</span>&nbsp;<span class="num" id="5619836">8</span><span class="op" id="5619837">;</span>&nbsp;<span class="ident" id="5619839">j</span><span class="op" id="5619840">++</span>&nbsp;<span class="op" id="5619843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5619847">for</span>&nbsp;<span class="ident" id="5619851">i</span>&nbsp;<span class="op" id="5619853">:=</span>&nbsp;<span class="num" id="5619856">0</span><span class="op" id="5619857">;</span>&nbsp;<span class="ident" id="5619859">i</span>&nbsp;<span class="op" id="5619861">&lt;</span>&nbsp;<span class="num" id="5619863">8</span><span class="op" id="5619864">;</span>&nbsp;<span class="ident" id="5619866">i</span><span class="op" id="5619867">++</span>&nbsp;<span class="op" id="5619870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619875">idx</span>&nbsp;<span class="op" id="5619879">:=</span>&nbsp;<span class="ident" id="5619882">m</span><span class="op" id="5619883">.</span><span class="ident" id="5619884">PixOffset</span><span class="op" id="5619893">(</span><span class="ident" id="5619894">min</span><span class="op" id="5619897">(</span><span class="ident" id="5619898">p</span><span class="op" id="5619899">.</span><span class="ident" id="5619900">X</span><span class="op" id="5619901">+</span><span class="ident" id="5619902">i</span><span class="op" id="5619903">,</span>&nbsp;<span class="ident" id="5619905">xmax</span><span class="op" id="5619909">)</span><span class="op" id="5619910">,</span>&nbsp;<span class="ident" id="5619912">min</span><span class="op" id="5619915">(</span><span class="ident" id="5619916">p</span><span class="op" id="5619917">.</span><span class="ident" id="5619918">Y</span><span class="op" id="5619919">+</span><span class="ident" id="5619920">j</span><span class="op" id="5619921">,</span>&nbsp;<span class="ident" id="5619923">ymax</span><span class="op" id="5619927">)</span><span class="op" id="5619928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5619933">yBlock</span><span class="op" id="5619939">[</span><span class="num" id="5619940">8</span><span class="op" id="5619941">*</span><span class="ident" id="5619942">j</span><span class="op" id="5619943">+</span><span class="ident" id="5619944">i</span><span class="op" id="5619945">]</span>&nbsp;<span class="op" id="5619947">=</span>&nbsp;<span class="builtintype" id="5619949">int32</span><span class="op" id="5619954">(</span><span class="ident" id="5619955">pix</span><span class="op" id="5619958">[</span><span class="ident" id="5619959">idx</span><span class="op" id="5619962">]</span><span class="op" id="5619963">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5619967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5619970">}</span><br>
<span class="lineno"></span><span class="op" id="5619972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5619975">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="5620049">func</span>&nbsp;<span class="ident" id="5620054">rgbaToYCbCr</span><span class="op" id="5620065">(</span><span class="ident" id="5620066">m</span>&nbsp;<span class="op" id="5620068">*</span><span class="ident" id="5620069">image</span><span class="op" id="5620074">.</span><span class="ident" id="5620075">RGBA</span><span class="op" id="5620079">,</span>&nbsp;<span class="ident" id="5620081">p</span>&nbsp;<span class="ident" id="5620083">image</span><span class="op" id="5620088">.</span><span class="ident" id="5620089">Point</span><span class="op" id="5620094">,</span>&nbsp;<span class="ident" id="5620096">yBlock</span><span class="op" id="5620102">,</span>&nbsp;<span class="ident" id="5620104">cbBlock</span><span class="op" id="5620111">,</span>&nbsp;<span class="ident" id="5620113">crBlock</span>&nbsp;<span class="op" id="5620121">*</span><span class="ident" id="5620122">block</span><span class="op" id="5620127">)</span>&nbsp;<span class="op" id="5620129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620132">b</span>&nbsp;<span class="op" id="5620134">:=</span>&nbsp;<span class="ident" id="5620137">m</span><span class="op" id="5620138">.</span><span class="ident" id="5620139">Bounds</span><span class="op" id="5620145">(</span><span class="op" id="5620146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620149">xmax</span>&nbsp;<span class="op" id="5620154">:=</span>&nbsp;<span class="ident" id="5620157">b</span><span class="op" id="5620158">.</span><span class="ident" id="5620159">Max</span><span class="op" id="5620162">.</span><span class="ident" id="5620163">X</span>&nbsp;<span class="op" id="5620165">-</span>&nbsp;<span class="num" id="5620167">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620170">ymax</span>&nbsp;<span class="op" id="5620175">:=</span>&nbsp;<span class="ident" id="5620178">b</span><span class="op" id="5620179">.</span><span class="ident" id="5620180">Max</span><span class="op" id="5620183">.</span><span class="ident" id="5620184">Y</span>&nbsp;<span class="op" id="5620186">-</span>&nbsp;<span class="num" id="5620188">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620191">for</span>&nbsp;<span class="ident" id="5620195">j</span>&nbsp;<span class="op" id="5620197">:=</span>&nbsp;<span class="num" id="5620200">0</span><span class="op" id="5620201">;</span>&nbsp;<span class="ident" id="5620203">j</span>&nbsp;<span class="op" id="5620205">&lt;</span>&nbsp;<span class="num" id="5620207">8</span><span class="op" id="5620208">;</span>&nbsp;<span class="ident" id="5620210">j</span><span class="op" id="5620211">++</span>&nbsp;<span class="op" id="5620214">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620218">sj</span>&nbsp;<span class="op" id="5620221">:=</span>&nbsp;<span class="ident" id="5620224">p</span><span class="op" id="5620225">.</span><span class="ident" id="5620226">Y</span>&nbsp;<span class="op" id="5620228">+</span>&nbsp;<span class="ident" id="5620230">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620234">if</span>&nbsp;<span class="ident" id="5620237">sj</span>&nbsp;<span class="op" id="5620240">&gt;</span>&nbsp;<span class="ident" id="5620242">ymax</span>&nbsp;<span class="op" id="5620247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620252">sj</span>&nbsp;<span class="op" id="5620255">=</span>&nbsp;<span class="ident" id="5620257">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5620264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620268">offset</span>&nbsp;<span class="op" id="5620275">:=</span>&nbsp;<span class="op" id="5620278">(</span><span class="ident" id="5620279">sj</span><span class="op" id="5620281">-</span><span class="ident" id="5620282">b</span><span class="op" id="5620283">.</span><span class="ident" id="5620284">Min</span><span class="op" id="5620287">.</span><span class="ident" id="5620288">Y</span><span class="op" id="5620289">)</span><span class="op" id="5620290">*</span><span class="ident" id="5620291">m</span><span class="op" id="5620292">.</span><span class="ident" id="5620293">Stride</span>&nbsp;<span class="op" id="5620300">-</span>&nbsp;<span class="ident" id="5620302">b</span><span class="op" id="5620303">.</span><span class="ident" id="5620304">Min</span><span class="op" id="5620307">.</span><span class="ident" id="5620308">X</span><span class="op" id="5620309">*</span><span class="num" id="5620310">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620314">for</span>&nbsp;<span class="ident" id="5620318">i</span>&nbsp;<span class="op" id="5620320">:=</span>&nbsp;<span class="num" id="5620323">0</span><span class="op" id="5620324">;</span>&nbsp;<span class="ident" id="5620326">i</span>&nbsp;<span class="op" id="5620328">&lt;</span>&nbsp;<span class="num" id="5620330">8</span><span class="op" id="5620331">;</span>&nbsp;<span class="ident" id="5620333">i</span><span class="op" id="5620334">++</span>&nbsp;<span class="op" id="5620337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620342">sx</span>&nbsp;<span class="op" id="5620345">:=</span>&nbsp;<span class="ident" id="5620348">p</span><span class="op" id="5620349">.</span><span class="ident" id="5620350">X</span>&nbsp;<span class="op" id="5620352">+</span>&nbsp;<span class="ident" id="5620354">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620359">if</span>&nbsp;<span class="ident" id="5620362">sx</span>&nbsp;<span class="op" id="5620365">&gt;</span>&nbsp;<span class="ident" id="5620367">xmax</span>&nbsp;<span class="op" id="5620372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620378">sx</span>&nbsp;<span class="op" id="5620381">=</span>&nbsp;<span class="ident" id="5620383">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5620391">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620396">pix</span>&nbsp;<span class="op" id="5620400">:=</span>&nbsp;<span class="ident" id="5620403">m</span><span class="op" id="5620404">.</span><span class="ident" id="5620405">Pix</span><span class="op" id="5620408">[</span><span class="ident" id="5620409">offset</span><span class="op" id="5620415">+</span><span class="ident" id="5620416">sx</span><span class="op" id="5620418">*</span><span class="num" id="5620419">4</span><span class="op" id="5620420">:</span><span class="op" id="5620421">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620426">yy</span><span class="op" id="5620428">,</span>&nbsp;<span class="ident" id="5620430">cb</span><span class="op" id="5620432">,</span>&nbsp;<span class="ident" id="5620434">cr</span>&nbsp;<span class="op" id="5620437">:=</span>&nbsp;<span class="ident" id="5620440">color</span><span class="op" id="5620445">.</span><span class="ident" id="5620446">RGBToYCbCr</span><span class="op" id="5620456">(</span><span class="ident" id="5620457">pix</span><span class="op" id="5620460">[</span><span class="num" id="5620461">0</span><span class="op" id="5620462">]</span><span class="op" id="5620463">,</span>&nbsp;<span class="ident" id="5620465">pix</span><span class="op" id="5620468">[</span><span class="num" id="5620469">1</span><span class="op" id="5620470">]</span><span class="op" id="5620471">,</span>&nbsp;<span class="ident" id="5620473">pix</span><span class="op" id="5620476">[</span><span class="num" id="5620477">2</span><span class="op" id="5620478">]</span><span class="op" id="5620479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620484">yBlock</span><span class="op" id="5620490">[</span><span class="num" id="5620491">8</span><span class="op" id="5620492">*</span><span class="ident" id="5620493">j</span><span class="op" id="5620494">+</span><span class="ident" id="5620495">i</span><span class="op" id="5620496">]</span>&nbsp;<span class="op" id="5620498">=</span>&nbsp;<span class="builtintype" id="5620500">int32</span><span class="op" id="5620505">(</span><span class="ident" id="5620506">yy</span><span class="op" id="5620508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620513">cbBlock</span><span class="op" id="5620520">[</span><span class="num" id="5620521">8</span><span class="op" id="5620522">*</span><span class="ident" id="5620523">j</span><span class="op" id="5620524">+</span><span class="ident" id="5620525">i</span><span class="op" id="5620526">]</span>&nbsp;<span class="op" id="5620528">=</span>&nbsp;<span class="builtintype" id="5620530">int32</span><span class="op" id="5620535">(</span><span class="ident" id="5620536">cb</span><span class="op" id="5620538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620543">crBlock</span><span class="op" id="5620550">[</span><span class="num" id="5620551">8</span><span class="op" id="5620552">*</span><span class="ident" id="5620553">j</span><span class="op" id="5620554">+</span><span class="ident" id="5620555">i</span><span class="op" id="5620556">]</span>&nbsp;<span class="op" id="5620558">=</span>&nbsp;<span class="builtintype" id="5620560">int32</span><span class="op" id="5620565">(</span><span class="ident" id="5620566">cr</span><span class="op" id="5620568">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5620572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5620575">}</span><br>
<span class="lineno"></span><span class="op" id="5620577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5620580">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="5620656">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="5620670">func</span>&nbsp;<span class="ident" id="5620675">scale</span><span class="op" id="5620680">(</span><span class="ident" id="5620681">dst</span>&nbsp;<span class="op" id="5620685">*</span><span class="ident" id="5620686">block</span><span class="op" id="5620691">,</span>&nbsp;<span class="ident" id="5620693">src</span>&nbsp;<span class="op" id="5620697">*</span><span class="op" id="5620698">[</span><span class="num" id="5620699">4</span><span class="op" id="5620700">]</span><span class="ident" id="5620701">block</span><span class="op" id="5620706">)</span>&nbsp;<span class="op" id="5620708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620711">for</span>&nbsp;<span class="ident" id="5620715">i</span>&nbsp;<span class="op" id="5620717">:=</span>&nbsp;<span class="num" id="5620720">0</span><span class="op" id="5620721">;</span>&nbsp;<span class="ident" id="5620723">i</span>&nbsp;<span class="op" id="5620725">&lt;</span>&nbsp;<span class="num" id="5620727">4</span><span class="op" id="5620728">;</span>&nbsp;<span class="ident" id="5620730">i</span><span class="op" id="5620731">++</span>&nbsp;<span class="op" id="5620734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620738">dstOff</span>&nbsp;<span class="op" id="5620745">:=</span>&nbsp;<span class="op" id="5620748">(</span><span class="ident" id="5620749">i</span><span class="op" id="5620750">&amp;</span><span class="num" id="5620751">2</span><span class="op" id="5620752">)</span><span class="op" id="5620753">&lt;&lt;</span><span class="num" id="5620755">4</span>&nbsp;<span class="op" id="5620757">|</span>&nbsp;<span class="op" id="5620759">(</span><span class="ident" id="5620760">i</span><span class="op" id="5620761">&amp;</span><span class="num" id="5620762">1</span><span class="op" id="5620763">)</span><span class="op" id="5620764">&lt;&lt;</span><span class="num" id="5620766">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620770">for</span>&nbsp;<span class="ident" id="5620774">y</span>&nbsp;<span class="op" id="5620776">:=</span>&nbsp;<span class="num" id="5620779">0</span><span class="op" id="5620780">;</span>&nbsp;<span class="ident" id="5620782">y</span>&nbsp;<span class="op" id="5620784">&lt;</span>&nbsp;<span class="num" id="5620786">4</span><span class="op" id="5620787">;</span>&nbsp;<span class="ident" id="5620789">y</span><span class="op" id="5620790">++</span>&nbsp;<span class="op" id="5620793">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5620798">for</span>&nbsp;<span class="ident" id="5620802">x</span>&nbsp;<span class="op" id="5620804">:=</span>&nbsp;<span class="num" id="5620807">0</span><span class="op" id="5620808">;</span>&nbsp;<span class="ident" id="5620810">x</span>&nbsp;<span class="op" id="5620812">&lt;</span>&nbsp;<span class="num" id="5620814">4</span><span class="op" id="5620815">;</span>&nbsp;<span class="ident" id="5620817">x</span><span class="op" id="5620818">++</span>&nbsp;<span class="op" id="5620821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620827">j</span>&nbsp;<span class="op" id="5620829">:=</span>&nbsp;<span class="num" id="5620832">16</span><span class="op" id="5620834">*</span><span class="ident" id="5620835">y</span>&nbsp;<span class="op" id="5620837">+</span>&nbsp;<span class="num" id="5620839">2</span><span class="op" id="5620840">*</span><span class="ident" id="5620841">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620847">sum</span>&nbsp;<span class="op" id="5620851">:=</span>&nbsp;<span class="ident" id="5620854">src</span><span class="op" id="5620857">[</span><span class="ident" id="5620858">i</span><span class="op" id="5620859">]</span><span class="op" id="5620860">[</span><span class="ident" id="5620861">j</span><span class="op" id="5620862">]</span>&nbsp;<span class="op" id="5620864">+</span>&nbsp;<span class="ident" id="5620866">src</span><span class="op" id="5620869">[</span><span class="ident" id="5620870">i</span><span class="op" id="5620871">]</span><span class="op" id="5620872">[</span><span class="ident" id="5620873">j</span><span class="op" id="5620874">+</span><span class="num" id="5620875">1</span><span class="op" id="5620876">]</span>&nbsp;<span class="op" id="5620878">+</span>&nbsp;<span class="ident" id="5620880">src</span><span class="op" id="5620883">[</span><span class="ident" id="5620884">i</span><span class="op" id="5620885">]</span><span class="op" id="5620886">[</span><span class="ident" id="5620887">j</span><span class="op" id="5620888">+</span><span class="num" id="5620889">8</span><span class="op" id="5620890">]</span>&nbsp;<span class="op" id="5620892">+</span>&nbsp;<span class="ident" id="5620894">src</span><span class="op" id="5620897">[</span><span class="ident" id="5620898">i</span><span class="op" id="5620899">]</span><span class="op" id="5620900">[</span><span class="ident" id="5620901">j</span><span class="op" id="5620902">+</span><span class="num" id="5620903">9</span><span class="op" id="5620904">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5620910">dst</span><span class="op" id="5620913">[</span><span class="num" id="5620914">8</span><span class="op" id="5620915">*</span><span class="ident" id="5620916">y</span><span class="op" id="5620917">+</span><span class="ident" id="5620918">x</span><span class="op" id="5620919">+</span><span class="ident" id="5620920">dstOff</span><span class="op" id="5620926">]</span>&nbsp;<span class="op" id="5620928">=</span>&nbsp;<span class="op" id="5620930">(</span><span class="ident" id="5620931">sum</span>&nbsp;<span class="op" id="5620935">+</span>&nbsp;<span class="num" id="5620937">2</span><span class="op" id="5620938">)</span>&nbsp;<span class="op" id="5620940">&gt;&gt;</span>&nbsp;<span class="num" id="5620943">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5620948">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5620952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5620955">}</span><br>
<span class="lineno"></span><span class="op" id="5620957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5620960">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="5621024">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5621059">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5621097">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5621157">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5621228">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="5621303">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5621346">var</span>&nbsp;<span class="ident" id="5621350">sosHeaderY</span>&nbsp;<span class="op" id="5621361">=</span>&nbsp;<span class="op" id="5621363">[</span><span class="op" id="5621364">]</span><span class="builtintype" id="5621365">byte</span><span class="op" id="5621369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5621372">0xff</span><span class="op" id="5621376">,</span>&nbsp;<span class="num" id="5621378">0xda</span><span class="op" id="5621382">,</span>&nbsp;<span class="num" id="5621384">0x00</span><span class="op" id="5621388">,</span>&nbsp;<span class="num" id="5621390">0x08</span><span class="op" id="5621394">,</span>&nbsp;<span class="num" id="5621396">0x01</span><span class="op" id="5621400">,</span>&nbsp;<span class="num" id="5621402">0x01</span><span class="op" id="5621406">,</span>&nbsp;<span class="num" id="5621408">0x00</span><span class="op" id="5621412">,</span>&nbsp;<span class="num" id="5621414">0x00</span><span class="op" id="5621418">,</span>&nbsp;<span class="num" id="5621420">0x3f</span><span class="op" id="5621424">,</span>&nbsp;<span class="num" id="5621426">0x00</span><span class="op" id="5621430">,</span><br>
<span class="lineno"></span><span class="op" id="5621432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="5621435">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="5621504">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5621539">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5621577">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5621637">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="5621697">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5621757">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5621828">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="5621903">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5621946">var</span>&nbsp;<span class="ident" id="5621950">sosHeaderYCbCr</span>&nbsp;<span class="op" id="5621965">=</span>&nbsp;<span class="op" id="5621967">[</span><span class="op" id="5621968">]</span><span class="builtintype" id="5621969">byte</span><span class="op" id="5621973">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5621976">0xff</span><span class="op" id="5621980">,</span>&nbsp;<span class="num" id="5621982">0xda</span><span class="op" id="5621986">,</span>&nbsp;<span class="num" id="5621988">0x00</span><span class="op" id="5621992">,</span>&nbsp;<span class="num" id="5621994">0x0c</span><span class="op" id="5621998">,</span>&nbsp;<span class="num" id="5622000">0x03</span><span class="op" id="5622004">,</span>&nbsp;<span class="num" id="5622006">0x01</span><span class="op" id="5622010">,</span>&nbsp;<span class="num" id="5622012">0x00</span><span class="op" id="5622016">,</span>&nbsp;<span class="num" id="5622018">0x02</span><span class="op" id="5622022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5622025">0x11</span><span class="op" id="5622029">,</span>&nbsp;<span class="num" id="5622031">0x03</span><span class="op" id="5622035">,</span>&nbsp;<span class="num" id="5622037">0x11</span><span class="op" id="5622041">,</span>&nbsp;<span class="num" id="5622043">0x00</span><span class="op" id="5622047">,</span>&nbsp;<span class="num" id="5622049">0x3f</span><span class="op" id="5622053">,</span>&nbsp;<span class="num" id="5622055">0x00</span><span class="op" id="5622059">,</span><br>
<span class="lineno"></span><span class="op" id="5622061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5622064">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="5622107">func</span>&nbsp;<span class="op" id="5622112">(</span><span class="ident" id="5622113">e</span>&nbsp;<span class="op" id="5622115">*</span><span class="ident" id="5622116">encoder</span><span class="op" id="5622123">)</span>&nbsp;<span class="ident" id="5622125">writeSOS</span><span class="op" id="5622133">(</span><span class="ident" id="5622134">m</span>&nbsp;<span class="ident" id="5622136">image</span><span class="op" id="5622141">.</span><span class="ident" id="5622142">Image</span><span class="op" id="5622147">)</span>&nbsp;<span class="op" id="5622149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622152">switch</span>&nbsp;<span class="ident" id="5622159">m</span><span class="op" id="5622160">.</span><span class="op" id="5622161">(</span><span class="keyword" id="5622162">type</span><span class="op" id="5622166">)</span>&nbsp;<span class="op" id="5622168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622171">case</span>&nbsp;<span class="op" id="5622176">*</span><span class="ident" id="5622177">image</span><span class="op" id="5622182">.</span><span class="ident" id="5622183">Gray</span><span class="op" id="5622187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622191">e</span><span class="op" id="5622192">.</span><span class="ident" id="5622193">write</span><span class="op" id="5622198">(</span><span class="ident" id="5622199">sosHeaderY</span><span class="op" id="5622209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622212">default</span><span class="op" id="5622219">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622223">e</span><span class="op" id="5622224">.</span><span class="ident" id="5622225">write</span><span class="op" id="5622230">(</span><span class="ident" id="5622231">sosHeaderYCbCr</span><span class="op" id="5622245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5622248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622251">var</span>&nbsp;<span class="op" id="5622255">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5622259">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5622306">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622358">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622365">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622373">cb</span><span class="op" id="5622375">,</span>&nbsp;<span class="ident" id="5622377">cr</span>&nbsp;<span class="op" id="5622380">[</span><span class="num" id="5622381">4</span><span class="op" id="5622382">]</span><span class="ident" id="5622383">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5622391">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622429">prevDCY</span><span class="op" id="5622436">,</span>&nbsp;<span class="ident" id="5622438">prevDCCb</span><span class="op" id="5622446">,</span>&nbsp;<span class="ident" id="5622448">prevDCCr</span>&nbsp;<span class="builtintype" id="5622457">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5622464">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622467">bounds</span>&nbsp;<span class="op" id="5622474">:=</span>&nbsp;<span class="ident" id="5622477">m</span><span class="op" id="5622478">.</span><span class="ident" id="5622479">Bounds</span><span class="op" id="5622485">(</span><span class="op" id="5622486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622489">switch</span>&nbsp;<span class="ident" id="5622496">m</span>&nbsp;<span class="op" id="5622498">:=</span>&nbsp;<span class="ident" id="5622501">m</span><span class="op" id="5622502">.</span><span class="op" id="5622503">(</span><span class="keyword" id="5622504">type</span><span class="op" id="5622508">)</span>&nbsp;<span class="op" id="5622510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5622513">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622575">case</span>&nbsp;<span class="op" id="5622580">*</span><span class="ident" id="5622581">image</span><span class="op" id="5622586">.</span><span class="ident" id="5622587">Gray</span><span class="op" id="5622591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622595">for</span>&nbsp;<span class="ident" id="5622599">y</span>&nbsp;<span class="op" id="5622601">:=</span>&nbsp;<span class="ident" id="5622604">bounds</span><span class="op" id="5622610">.</span><span class="ident" id="5622611">Min</span><span class="op" id="5622614">.</span><span class="ident" id="5622615">Y</span><span class="op" id="5622616">;</span>&nbsp;<span class="ident" id="5622618">y</span>&nbsp;<span class="op" id="5622620">&lt;</span>&nbsp;<span class="ident" id="5622622">bounds</span><span class="op" id="5622628">.</span><span class="ident" id="5622629">Max</span><span class="op" id="5622632">.</span><span class="ident" id="5622633">Y</span><span class="op" id="5622634">;</span>&nbsp;<span class="ident" id="5622636">y</span>&nbsp;<span class="op" id="5622638">+=</span>&nbsp;<span class="num" id="5622641">8</span>&nbsp;<span class="op" id="5622643">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622648">for</span>&nbsp;<span class="ident" id="5622652">x</span>&nbsp;<span class="op" id="5622654">:=</span>&nbsp;<span class="ident" id="5622657">bounds</span><span class="op" id="5622663">.</span><span class="ident" id="5622664">Min</span><span class="op" id="5622667">.</span><span class="ident" id="5622668">X</span><span class="op" id="5622669">;</span>&nbsp;<span class="ident" id="5622671">x</span>&nbsp;<span class="op" id="5622673">&lt;</span>&nbsp;<span class="ident" id="5622675">bounds</span><span class="op" id="5622681">.</span><span class="ident" id="5622682">Max</span><span class="op" id="5622685">.</span><span class="ident" id="5622686">X</span><span class="op" id="5622687">;</span>&nbsp;<span class="ident" id="5622689">x</span>&nbsp;<span class="op" id="5622691">+=</span>&nbsp;<span class="num" id="5622694">8</span>&nbsp;<span class="op" id="5622696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622702">p</span>&nbsp;<span class="op" id="5622704">:=</span>&nbsp;<span class="ident" id="5622707">image</span><span class="op" id="5622712">.</span><span class="ident" id="5622713">Pt</span><span class="op" id="5622715">(</span><span class="ident" id="5622716">x</span><span class="op" id="5622717">,</span>&nbsp;<span class="ident" id="5622719">y</span><span class="op" id="5622720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622726">grayToY</span><span class="op" id="5622733">(</span><span class="ident" id="5622734">m</span><span class="op" id="5622735">,</span>&nbsp;<span class="ident" id="5622737">p</span><span class="op" id="5622738">,</span>&nbsp;<span class="op" id="5622740">&amp;</span><span class="ident" id="5622741">b</span><span class="op" id="5622742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622748">prevDCY</span>&nbsp;<span class="op" id="5622756">=</span>&nbsp;<span class="ident" id="5622758">e</span><span class="op" id="5622759">.</span><span class="ident" id="5622760">writeBlock</span><span class="op" id="5622770">(</span><span class="op" id="5622771">&amp;</span><span class="ident" id="5622772">b</span><span class="op" id="5622773">,</span>&nbsp;<span class="num" id="5622775">0</span><span class="op" id="5622776">,</span>&nbsp;<span class="ident" id="5622778">prevDCY</span><span class="op" id="5622785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5622790">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5622794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622797">default</span><span class="op" id="5622804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622808">rgba</span><span class="op" id="5622812">,</span>&nbsp;<span class="ident" id="5622814">_</span>&nbsp;<span class="op" id="5622816">:=</span>&nbsp;<span class="ident" id="5622819">m</span><span class="op" id="5622820">.</span><span class="op" id="5622821">(</span><span class="op" id="5622822">*</span><span class="ident" id="5622823">image</span><span class="op" id="5622828">.</span><span class="ident" id="5622829">RGBA</span><span class="op" id="5622833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622837">for</span>&nbsp;<span class="ident" id="5622841">y</span>&nbsp;<span class="op" id="5622843">:=</span>&nbsp;<span class="ident" id="5622846">bounds</span><span class="op" id="5622852">.</span><span class="ident" id="5622853">Min</span><span class="op" id="5622856">.</span><span class="ident" id="5622857">Y</span><span class="op" id="5622858">;</span>&nbsp;<span class="ident" id="5622860">y</span>&nbsp;<span class="op" id="5622862">&lt;</span>&nbsp;<span class="ident" id="5622864">bounds</span><span class="op" id="5622870">.</span><span class="ident" id="5622871">Max</span><span class="op" id="5622874">.</span><span class="ident" id="5622875">Y</span><span class="op" id="5622876">;</span>&nbsp;<span class="ident" id="5622878">y</span>&nbsp;<span class="op" id="5622880">+=</span>&nbsp;<span class="num" id="5622883">16</span>&nbsp;<span class="op" id="5622886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622891">for</span>&nbsp;<span class="ident" id="5622895">x</span>&nbsp;<span class="op" id="5622897">:=</span>&nbsp;<span class="ident" id="5622900">bounds</span><span class="op" id="5622906">.</span><span class="ident" id="5622907">Min</span><span class="op" id="5622910">.</span><span class="ident" id="5622911">X</span><span class="op" id="5622912">;</span>&nbsp;<span class="ident" id="5622914">x</span>&nbsp;<span class="op" id="5622916">&lt;</span>&nbsp;<span class="ident" id="5622918">bounds</span><span class="op" id="5622924">.</span><span class="ident" id="5622925">Max</span><span class="op" id="5622928">.</span><span class="ident" id="5622929">X</span><span class="op" id="5622930">;</span>&nbsp;<span class="ident" id="5622932">x</span>&nbsp;<span class="op" id="5622934">+=</span>&nbsp;<span class="num" id="5622937">16</span>&nbsp;<span class="op" id="5622940">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622946">for</span>&nbsp;<span class="ident" id="5622950">i</span>&nbsp;<span class="op" id="5622952">:=</span>&nbsp;<span class="num" id="5622955">0</span><span class="op" id="5622956">;</span>&nbsp;<span class="ident" id="5622958">i</span>&nbsp;<span class="op" id="5622960">&lt;</span>&nbsp;<span class="num" id="5622962">4</span><span class="op" id="5622963">;</span>&nbsp;<span class="ident" id="5622965">i</span><span class="op" id="5622966">++</span>&nbsp;<span class="op" id="5622969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622976">xOff</span>&nbsp;<span class="op" id="5622981">:=</span>&nbsp;<span class="op" id="5622984">(</span><span class="ident" id="5622985">i</span>&nbsp;<span class="op" id="5622987">&amp;</span>&nbsp;<span class="num" id="5622989">1</span><span class="op" id="5622990">)</span>&nbsp;<span class="op" id="5622992">*</span>&nbsp;<span class="num" id="5622994">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623001">yOff</span>&nbsp;<span class="op" id="5623006">:=</span>&nbsp;<span class="op" id="5623009">(</span><span class="ident" id="5623010">i</span>&nbsp;<span class="op" id="5623012">&amp;</span>&nbsp;<span class="num" id="5623014">2</span><span class="op" id="5623015">)</span>&nbsp;<span class="op" id="5623017">*</span>&nbsp;<span class="num" id="5623019">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623026">p</span>&nbsp;<span class="op" id="5623028">:=</span>&nbsp;<span class="ident" id="5623031">image</span><span class="op" id="5623036">.</span><span class="ident" id="5623037">Pt</span><span class="op" id="5623039">(</span><span class="ident" id="5623040">x</span><span class="op" id="5623041">+</span><span class="ident" id="5623042">xOff</span><span class="op" id="5623046">,</span>&nbsp;<span class="ident" id="5623048">y</span><span class="op" id="5623049">+</span><span class="ident" id="5623050">yOff</span><span class="op" id="5623054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5623061">if</span>&nbsp;<span class="ident" id="5623064">rgba</span>&nbsp;<span class="op" id="5623069">!=</span>&nbsp;<span class="builtintype" id="5623072">nil</span>&nbsp;<span class="op" id="5623076">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623084">rgbaToYCbCr</span><span class="op" id="5623095">(</span><span class="ident" id="5623096">rgba</span><span class="op" id="5623100">,</span>&nbsp;<span class="ident" id="5623102">p</span><span class="op" id="5623103">,</span>&nbsp;<span class="op" id="5623105">&amp;</span><span class="ident" id="5623106">b</span><span class="op" id="5623107">,</span>&nbsp;<span class="op" id="5623109">&amp;</span><span class="ident" id="5623110">cb</span><span class="op" id="5623112">[</span><span class="ident" id="5623113">i</span><span class="op" id="5623114">]</span><span class="op" id="5623115">,</span>&nbsp;<span class="op" id="5623117">&amp;</span><span class="ident" id="5623118">cr</span><span class="op" id="5623120">[</span><span class="ident" id="5623121">i</span><span class="op" id="5623122">]</span><span class="op" id="5623123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5623130">}</span>&nbsp;<span class="keyword" id="5623132">else</span>&nbsp;<span class="op" id="5623137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623145">toYCbCr</span><span class="op" id="5623152">(</span><span class="ident" id="5623153">m</span><span class="op" id="5623154">,</span>&nbsp;<span class="ident" id="5623156">p</span><span class="op" id="5623157">,</span>&nbsp;<span class="op" id="5623159">&amp;</span><span class="ident" id="5623160">b</span><span class="op" id="5623161">,</span>&nbsp;<span class="op" id="5623163">&amp;</span><span class="ident" id="5623164">cb</span><span class="op" id="5623166">[</span><span class="ident" id="5623167">i</span><span class="op" id="5623168">]</span><span class="op" id="5623169">,</span>&nbsp;<span class="op" id="5623171">&amp;</span><span class="ident" id="5623172">cr</span><span class="op" id="5623174">[</span><span class="ident" id="5623175">i</span><span class="op" id="5623176">]</span><span class="op" id="5623177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5623184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623191">prevDCY</span>&nbsp;<span class="op" id="5623199">=</span>&nbsp;<span class="ident" id="5623201">e</span><span class="op" id="5623202">.</span><span class="ident" id="5623203">writeBlock</span><span class="op" id="5623213">(</span><span class="op" id="5623214">&amp;</span><span class="ident" id="5623215">b</span><span class="op" id="5623216">,</span>&nbsp;<span class="num" id="5623218">0</span><span class="op" id="5623219">,</span>&nbsp;<span class="ident" id="5623221">prevDCY</span><span class="op" id="5623228">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5623234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623240">scale</span><span class="op" id="5623245">(</span><span class="op" id="5623246">&amp;</span><span class="ident" id="5623247">b</span><span class="op" id="5623248">,</span>&nbsp;<span class="op" id="5623250">&amp;</span><span class="ident" id="5623251">cb</span><span class="op" id="5623253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623259">prevDCCb</span>&nbsp;<span class="op" id="5623268">=</span>&nbsp;<span class="ident" id="5623270">e</span><span class="op" id="5623271">.</span><span class="ident" id="5623272">writeBlock</span><span class="op" id="5623282">(</span><span class="op" id="5623283">&amp;</span><span class="ident" id="5623284">b</span><span class="op" id="5623285">,</span>&nbsp;<span class="num" id="5623287">1</span><span class="op" id="5623288">,</span>&nbsp;<span class="ident" id="5623290">prevDCCb</span><span class="op" id="5623298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623304">scale</span><span class="op" id="5623309">(</span><span class="op" id="5623310">&amp;</span><span class="ident" id="5623311">b</span><span class="op" id="5623312">,</span>&nbsp;<span class="op" id="5623314">&amp;</span><span class="ident" id="5623315">cr</span><span class="op" id="5623317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623323">prevDCCr</span>&nbsp;<span class="op" id="5623332">=</span>&nbsp;<span class="ident" id="5623334">e</span><span class="op" id="5623335">.</span><span class="ident" id="5623336">writeBlock</span><span class="op" id="5623346">(</span><span class="op" id="5623347">&amp;</span><span class="ident" id="5623348">b</span><span class="op" id="5623349">,</span>&nbsp;<span class="num" id="5623351">1</span><span class="op" id="5623352">,</span>&nbsp;<span class="ident" id="5623354">prevDCCr</span><span class="op" id="5623362">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5623367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5623371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5623374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5623377">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623409">e</span><span class="op" id="5623410">.</span><span class="ident" id="5623411">emit</span><span class="op" id="5623415">(</span><span class="num" id="5623416">0x7f</span><span class="op" id="5623420">,</span>&nbsp;<span class="num" id="5623422">7</span><span class="op" id="5623423">)</span><br>
<span class="lineno">535</span><span class="op" id="5623425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5623428">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5623489">const</span>&nbsp;<span class="ident" id="5623495">DefaultQuality</span>&nbsp;<span class="op" id="5623510">=</span>&nbsp;<span class="num" id="5623512">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="5623516">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="5623556">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="5623617">type</span>&nbsp;<span class="ident" id="5623622">Options</span>&nbsp;<span class="keyword" id="5623630">struct</span>&nbsp;<span class="op" id="5623637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623640">Quality</span>&nbsp;<span class="builtintype" id="5623648">int</span><br>
<span class="lineno"></span><span class="op" id="5623652">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="5623655">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5623734">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="5623803">func</span>&nbsp;<span class="ident" id="5623808">Encode</span><span class="op" id="5623814">(</span><span class="ident" id="5623815">w</span>&nbsp;<span class="ident" id="5623817">io</span><span class="op" id="5623819">.</span><span class="ident" id="5623820">Writer</span><span class="op" id="5623826">,</span>&nbsp;<span class="ident" id="5623828">m</span>&nbsp;<span class="ident" id="5623830">image</span><span class="op" id="5623835">.</span><span class="ident" id="5623836">Image</span><span class="op" id="5623841">,</span>&nbsp;<span class="ident" id="5623843">o</span>&nbsp;<span class="op" id="5623845">*</span><span class="ident" id="5623846">Options</span><span class="op" id="5623853">)</span>&nbsp;<span class="builtintype" id="5623855">error</span>&nbsp;<span class="op" id="5623861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623864">b</span>&nbsp;<span class="op" id="5623866">:=</span>&nbsp;<span class="ident" id="5623869">m</span><span class="op" id="5623870">.</span><span class="ident" id="5623871">Bounds</span><span class="op" id="5623877">(</span><span class="op" id="5623878">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5623881">if</span>&nbsp;<span class="ident" id="5623884">b</span><span class="op" id="5623885">.</span><span class="ident" id="5623886">Dx</span><span class="op" id="5623888">(</span><span class="op" id="5623889">)</span>&nbsp;<span class="op" id="5623891">&gt;=</span>&nbsp;<span class="num" id="5623894">1</span><span class="op" id="5623895">&lt;&lt;</span><span class="num" id="5623897">16</span>&nbsp;<span class="op" id="5623900">||</span>&nbsp;<span class="ident" id="5623903">b</span><span class="op" id="5623904">.</span><span class="ident" id="5623905">Dy</span><span class="op" id="5623907">(</span><span class="op" id="5623908">)</span>&nbsp;<span class="op" id="5623910">&gt;=</span>&nbsp;<span class="num" id="5623913">1</span><span class="op" id="5623914">&lt;&lt;</span><span class="num" id="5623916">16</span>&nbsp;<span class="op" id="5623919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5623923">return</span>&nbsp;<span class="ident" id="5623930">errors</span><span class="op" id="5623936">.</span><span class="ident" id="5623937">New</span><span class="op" id="5623940">(</span><span class="string" id="5623941">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5623977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5623980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5623983">var</span>&nbsp;<span class="ident" id="5623987">e</span>&nbsp;<span class="ident" id="5623989">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5623998">if</span>&nbsp;<span class="ident" id="5624001">ww</span><span class="op" id="5624003">,</span>&nbsp;<span class="ident" id="5624005">ok</span>&nbsp;<span class="op" id="5624008">:=</span>&nbsp;<span class="ident" id="5624011">w</span><span class="op" id="5624012">.</span><span class="op" id="5624013">(</span><span class="ident" id="5624014">writer</span><span class="op" id="5624020">)</span><span class="op" id="5624021">;</span>&nbsp;<span class="ident" id="5624023">ok</span>&nbsp;<span class="op" id="5624026">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624030">e</span><span class="op" id="5624031">.</span><span class="ident" id="5624032">w</span>&nbsp;<span class="op" id="5624034">=</span>&nbsp;<span class="ident" id="5624036">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624040">}</span>&nbsp;<span class="keyword" id="5624042">else</span>&nbsp;<span class="op" id="5624047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624051">e</span><span class="op" id="5624052">.</span><span class="ident" id="5624053">w</span>&nbsp;<span class="op" id="5624055">=</span>&nbsp;<span class="ident" id="5624057">bufio</span><span class="op" id="5624062">.</span><span class="ident" id="5624063">NewWriter</span><span class="op" id="5624072">(</span><span class="ident" id="5624073">w</span><span class="op" id="5624074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624080">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624110">quality</span>&nbsp;<span class="op" id="5624118">:=</span>&nbsp;<span class="ident" id="5624121">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624137">if</span>&nbsp;<span class="ident" id="5624140">o</span>&nbsp;<span class="op" id="5624142">!=</span>&nbsp;<span class="builtintype" id="5624145">nil</span>&nbsp;<span class="op" id="5624149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624153">quality</span>&nbsp;<span class="op" id="5624161">=</span>&nbsp;<span class="ident" id="5624163">o</span><span class="op" id="5624164">.</span><span class="ident" id="5624165">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624175">if</span>&nbsp;<span class="ident" id="5624178">quality</span>&nbsp;<span class="op" id="5624186">&lt;</span>&nbsp;<span class="num" id="5624188">1</span>&nbsp;<span class="op" id="5624190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624195">quality</span>&nbsp;<span class="op" id="5624203">=</span>&nbsp;<span class="num" id="5624205">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624209">}</span>&nbsp;<span class="keyword" id="5624211">else</span>&nbsp;<span class="keyword" id="5624216">if</span>&nbsp;<span class="ident" id="5624219">quality</span>&nbsp;<span class="op" id="5624227">&gt;</span>&nbsp;<span class="num" id="5624229">100</span>&nbsp;<span class="op" id="5624233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624238">quality</span>&nbsp;<span class="op" id="5624246">=</span>&nbsp;<span class="num" id="5624248">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624260">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624315">var</span>&nbsp;<span class="ident" id="5624319">scale</span>&nbsp;<span class="builtintype" id="5624325">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624330">if</span>&nbsp;<span class="ident" id="5624333">quality</span>&nbsp;<span class="op" id="5624341">&lt;</span>&nbsp;<span class="num" id="5624343">50</span>&nbsp;<span class="op" id="5624346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624350">scale</span>&nbsp;<span class="op" id="5624356">=</span>&nbsp;<span class="num" id="5624358">5000</span>&nbsp;<span class="op" id="5624363">/</span>&nbsp;<span class="ident" id="5624365">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624374">}</span>&nbsp;<span class="keyword" id="5624376">else</span>&nbsp;<span class="op" id="5624381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624385">scale</span>&nbsp;<span class="op" id="5624391">=</span>&nbsp;<span class="num" id="5624393">200</span>&nbsp;<span class="op" id="5624397">-</span>&nbsp;<span class="ident" id="5624399">quality</span><span class="op" id="5624406">*</span><span class="num" id="5624407">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624413">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624453">for</span>&nbsp;<span class="ident" id="5624457">i</span>&nbsp;<span class="op" id="5624459">:=</span>&nbsp;<span class="keyword" id="5624462">range</span>&nbsp;<span class="ident" id="5624468">e</span><span class="op" id="5624469">.</span><span class="ident" id="5624470">quant</span>&nbsp;<span class="op" id="5624476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624480">for</span>&nbsp;<span class="ident" id="5624484">j</span>&nbsp;<span class="op" id="5624486">:=</span>&nbsp;<span class="keyword" id="5624489">range</span>&nbsp;<span class="ident" id="5624495">e</span><span class="op" id="5624496">.</span><span class="ident" id="5624497">quant</span><span class="op" id="5624502">[</span><span class="ident" id="5624503">i</span><span class="op" id="5624504">]</span>&nbsp;<span class="op" id="5624506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624511">x</span>&nbsp;<span class="op" id="5624513">:=</span>&nbsp;<span class="builtintype" id="5624516">int</span><span class="op" id="5624519">(</span><span class="ident" id="5624520">unscaledQuant</span><span class="op" id="5624533">[</span><span class="ident" id="5624534">i</span><span class="op" id="5624535">]</span><span class="op" id="5624536">[</span><span class="ident" id="5624537">j</span><span class="op" id="5624538">]</span><span class="op" id="5624539">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624544">x</span>&nbsp;<span class="op" id="5624546">=</span>&nbsp;<span class="op" id="5624548">(</span><span class="ident" id="5624549">x</span><span class="op" id="5624550">*</span><span class="ident" id="5624551">scale</span>&nbsp;<span class="op" id="5624557">+</span>&nbsp;<span class="num" id="5624559">50</span><span class="op" id="5624561">)</span>&nbsp;<span class="op" id="5624563">/</span>&nbsp;<span class="num" id="5624565">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624572">if</span>&nbsp;<span class="ident" id="5624575">x</span>&nbsp;<span class="op" id="5624577">&lt;</span>&nbsp;<span class="num" id="5624579">1</span>&nbsp;<span class="op" id="5624581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624587">x</span>&nbsp;<span class="op" id="5624589">=</span>&nbsp;<span class="num" id="5624591">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624596">}</span>&nbsp;<span class="keyword" id="5624598">else</span>&nbsp;<span class="keyword" id="5624603">if</span>&nbsp;<span class="ident" id="5624606">x</span>&nbsp;<span class="op" id="5624608">&gt;</span>&nbsp;<span class="num" id="5624610">255</span>&nbsp;<span class="op" id="5624614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624620">x</span>&nbsp;<span class="op" id="5624622">=</span>&nbsp;<span class="num" id="5624624">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624636">e</span><span class="op" id="5624637">.</span><span class="ident" id="5624638">quant</span><span class="op" id="5624643">[</span><span class="ident" id="5624644">i</span><span class="op" id="5624645">]</span><span class="op" id="5624646">[</span><span class="ident" id="5624647">j</span><span class="op" id="5624648">]</span>&nbsp;<span class="op" id="5624650">=</span>&nbsp;<span class="builtintype" id="5624652">uint8</span><span class="op" id="5624657">(</span><span class="ident" id="5624658">x</span><span class="op" id="5624659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624669">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624729">nComponent</span>&nbsp;<span class="op" id="5624740">:=</span>&nbsp;<span class="num" id="5624743">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624746">switch</span>&nbsp;<span class="ident" id="5624753">m</span><span class="op" id="5624754">.</span><span class="op" id="5624755">(</span><span class="keyword" id="5624756">type</span><span class="op" id="5624760">)</span>&nbsp;<span class="op" id="5624762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624765">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624827">case</span>&nbsp;<span class="op" id="5624832">*</span><span class="ident" id="5624833">image</span><span class="op" id="5624838">.</span><span class="ident" id="5624839">Gray</span><span class="op" id="5624843">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624847">nComponent</span>&nbsp;<span class="op" id="5624858">=</span>&nbsp;<span class="num" id="5624860">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624866">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624903">e</span><span class="op" id="5624904">.</span><span class="ident" id="5624905">buf</span><span class="op" id="5624908">[</span><span class="num" id="5624909">0</span><span class="op" id="5624910">]</span>&nbsp;<span class="op" id="5624912">=</span>&nbsp;<span class="num" id="5624914">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624920">e</span><span class="op" id="5624921">.</span><span class="ident" id="5624922">buf</span><span class="op" id="5624925">[</span><span class="num" id="5624926">1</span><span class="op" id="5624927">]</span>&nbsp;<span class="op" id="5624929">=</span>&nbsp;<span class="num" id="5624931">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624937">e</span><span class="op" id="5624938">.</span><span class="ident" id="5624939">write</span><span class="op" id="5624944">(</span><span class="ident" id="5624945">e</span><span class="op" id="5624946">.</span><span class="ident" id="5624947">buf</span><span class="op" id="5624950">[</span><span class="op" id="5624951">:</span><span class="num" id="5624952">2</span><span class="op" id="5624953">]</span><span class="op" id="5624954">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624957">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624992">e</span><span class="op" id="5624993">.</span><span class="ident" id="5624994">writeDQT</span><span class="op" id="5625002">(</span><span class="op" id="5625003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5625006">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625038">e</span><span class="op" id="5625039">.</span><span class="ident" id="5625040">writeSOF0</span><span class="op" id="5625049">(</span><span class="ident" id="5625050">b</span><span class="op" id="5625051">.</span><span class="ident" id="5625052">Size</span><span class="op" id="5625056">(</span><span class="op" id="5625057">)</span><span class="op" id="5625058">,</span>&nbsp;<span class="ident" id="5625060">nComponent</span><span class="op" id="5625070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5625073">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625103">e</span><span class="op" id="5625104">.</span><span class="ident" id="5625105">writeDHT</span><span class="op" id="5625113">(</span><span class="ident" id="5625114">nComponent</span><span class="op" id="5625124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5625127">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625153">e</span><span class="op" id="5625154">.</span><span class="ident" id="5625155">writeSOS</span><span class="op" id="5625163">(</span><span class="ident" id="5625164">m</span><span class="op" id="5625165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5625168">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625203">e</span><span class="op" id="5625204">.</span><span class="ident" id="5625205">buf</span><span class="op" id="5625208">[</span><span class="num" id="5625209">0</span><span class="op" id="5625210">]</span>&nbsp;<span class="op" id="5625212">=</span>&nbsp;<span class="num" id="5625214">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625220">e</span><span class="op" id="5625221">.</span><span class="ident" id="5625222">buf</span><span class="op" id="5625225">[</span><span class="num" id="5625226">1</span><span class="op" id="5625227">]</span>&nbsp;<span class="op" id="5625229">=</span>&nbsp;<span class="num" id="5625231">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625237">e</span><span class="op" id="5625238">.</span><span class="ident" id="5625239">write</span><span class="op" id="5625244">(</span><span class="ident" id="5625245">e</span><span class="op" id="5625246">.</span><span class="ident" id="5625247">buf</span><span class="op" id="5625250">[</span><span class="op" id="5625251">:</span><span class="num" id="5625252">2</span><span class="op" id="5625253">]</span><span class="op" id="5625254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625257">e</span><span class="op" id="5625258">.</span><span class="ident" id="5625259">flush</span><span class="op" id="5625264">(</span><span class="op" id="5625265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5625268">return</span>&nbsp;<span class="ident" id="5625275">e</span><span class="op" id="5625276">.</span><span class="ident" id="5625277">err</span><br>
<span class="lineno"></span><span class="op" id="5625281">}</span>
</div>
</body>
</html>
