<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/pprof</h2>
<ul>
<li><a href="/gostd/net/http/pprof/pprof.go.html" class="current">pprof.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4277682">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4277738">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4277792">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4277843">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4277910">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="4277969">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="4278010">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="4278057">//</span><br>
<span class="lineno">10</span><span class="comment" id="4278060">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4278125">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="4278159">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="4278210">//</span><br>
<span class="lineno"></span><span class="comment" id="4278213">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="4278267">//&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4278296">//</span><br>
<span class="lineno"></span><span class="comment" id="4278299">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="4278365">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4278433">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="4278478">//</span><br>
<span class="lineno"></span><span class="comment" id="4278481">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="4278497">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="4278558">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}()</span><br>
<span class="lineno"></span><span class="comment" id="4278566">//</span><br>
<span class="lineno">25</span><span class="comment" id="4278569">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="4278625">//</span><br>
<span class="lineno"></span><span class="comment" id="4278628">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="4278684">//</span><br>
<span class="lineno"></span><span class="comment" id="4278687">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="4278729">//</span><br>
<span class="lineno"></span><span class="comment" id="4278732">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="4278791">//</span><br>
<span class="lineno"></span><span class="comment" id="4278794">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="4278843">//</span><br>
<span class="lineno">35</span><span class="comment" id="4278846">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="4278903">//</span><br>
<span class="lineno"></span><span class="comment" id="4278906">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="4278981">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="4279001">//</span><br>
<span class="lineno">40</span><span class="comment" id="4279004">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="4279052">//</span><br>
<span class="lineno"></span><span class="comment" id="4279055">//&nbsp;&nbsp;&nbsp;&nbsp;http://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="4279116">//</span><br>
<span class="lineno"></span><span class="keyword" id="4279119">package</span>&nbsp;<span class="ident" id="4279127">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="4279134">import</span>&nbsp;<span class="op" id="4279141">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279144">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279153">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279162">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279169">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279186">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279192">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279199">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279211">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279217">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279228">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279245">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279256">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279267">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="4279274">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4279277">func</span>&nbsp;<span class="ident" id="4279282">init</span><span class="op" id="4279286">(</span><span class="op" id="4279287">)</span>&nbsp;<span class="op" id="4279289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279292">http</span><span class="op" id="4279296">.</span><span class="ident" id="4279297">Handle</span><span class="op" id="4279303">(</span><span class="string" id="4279304">&#34;/debug/pprof/&#34;</span><span class="op" id="4279319">,</span>&nbsp;<span class="ident" id="4279321">http</span><span class="op" id="4279325">.</span><span class="ident" id="4279326">HandlerFunc</span><span class="op" id="4279337">(</span><span class="ident" id="4279338">Index</span><span class="op" id="4279343">)</span><span class="op" id="4279344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279347">http</span><span class="op" id="4279351">.</span><span class="ident" id="4279352">Handle</span><span class="op" id="4279358">(</span><span class="string" id="4279359">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="4279381">,</span>&nbsp;<span class="ident" id="4279383">http</span><span class="op" id="4279387">.</span><span class="ident" id="4279388">HandlerFunc</span><span class="op" id="4279399">(</span><span class="ident" id="4279400">Cmdline</span><span class="op" id="4279407">)</span><span class="op" id="4279408">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279411">http</span><span class="op" id="4279415">.</span><span class="ident" id="4279416">Handle</span><span class="op" id="4279422">(</span><span class="string" id="4279423">&#34;/debug/pprof/profile&#34;</span><span class="op" id="4279445">,</span>&nbsp;<span class="ident" id="4279447">http</span><span class="op" id="4279451">.</span><span class="ident" id="4279452">HandlerFunc</span><span class="op" id="4279463">(</span><span class="ident" id="4279464">Profile</span><span class="op" id="4279471">)</span><span class="op" id="4279472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279475">http</span><span class="op" id="4279479">.</span><span class="ident" id="4279480">Handle</span><span class="op" id="4279486">(</span><span class="string" id="4279487">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="4279508">,</span>&nbsp;<span class="ident" id="4279510">http</span><span class="op" id="4279514">.</span><span class="ident" id="4279515">HandlerFunc</span><span class="op" id="4279526">(</span><span class="ident" id="4279527">Symbol</span><span class="op" id="4279533">)</span><span class="op" id="4279534">)</span><br>
<span class="lineno"></span><span class="op" id="4279536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4279539">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="4279586">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="4279642">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="4279710">func</span>&nbsp;<span class="ident" id="4279715">Cmdline</span><span class="op" id="4279722">(</span><span class="ident" id="4279723">w</span>&nbsp;<span class="ident" id="4279725">http</span><span class="op" id="4279729">.</span><span class="ident" id="4279730">ResponseWriter</span><span class="op" id="4279744">,</span>&nbsp;<span class="ident" id="4279746">r</span>&nbsp;<span class="op" id="4279748">*</span><span class="ident" id="4279749">http</span><span class="op" id="4279753">.</span><span class="ident" id="4279754">Request</span><span class="op" id="4279761">)</span>&nbsp;<span class="op" id="4279763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279766">w</span><span class="op" id="4279767">.</span><span class="ident" id="4279768">Header</span><span class="op" id="4279774">(</span><span class="op" id="4279775">)</span><span class="op" id="4279776">.</span><span class="ident" id="4279777">Set</span><span class="op" id="4279780">(</span><span class="string" id="4279781">&#34;Content-Type&#34;</span><span class="op" id="4279795">,</span>&nbsp;<span class="string" id="4279797">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="4279824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279827">fmt</span><span class="op" id="4279830">.</span><span class="ident" id="4279831">Fprintf</span><span class="op" id="4279838">(</span><span class="ident" id="4279839">w</span><span class="op" id="4279840">,</span>&nbsp;<span class="ident" id="4279842">strings</span><span class="op" id="4279849">.</span><span class="ident" id="4279850">Join</span><span class="op" id="4279854">(</span><span class="ident" id="4279855">os</span><span class="op" id="4279857">.</span><span class="ident" id="4279858">Args</span><span class="op" id="4279862">,</span>&nbsp;<span class="string" id="4279864">&#34;\x00&#34;</span><span class="op" id="4279870">)</span><span class="op" id="4279871">)</span><br>
<span class="lineno">75</span><span class="op" id="4279873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4279876">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="4279934">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4280002">func</span>&nbsp;<span class="ident" id="4280007">Profile</span><span class="op" id="4280014">(</span><span class="ident" id="4280015">w</span>&nbsp;<span class="ident" id="4280017">http</span><span class="op" id="4280021">.</span><span class="ident" id="4280022">ResponseWriter</span><span class="op" id="4280036">,</span>&nbsp;<span class="ident" id="4280038">r</span>&nbsp;<span class="op" id="4280040">*</span><span class="ident" id="4280041">http</span><span class="op" id="4280045">.</span><span class="ident" id="4280046">Request</span><span class="op" id="4280053">)</span>&nbsp;<span class="op" id="4280055">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280058">sec</span><span class="op" id="4280061">,</span>&nbsp;<span class="ident" id="4280063">_</span>&nbsp;<span class="op" id="4280065">:=</span>&nbsp;<span class="ident" id="4280068">strconv</span><span class="op" id="4280075">.</span><span class="ident" id="4280076">ParseInt</span><span class="op" id="4280084">(</span><span class="ident" id="4280085">r</span><span class="op" id="4280086">.</span><span class="ident" id="4280087">FormValue</span><span class="op" id="4280096">(</span><span class="string" id="4280097">&#34;seconds&#34;</span><span class="op" id="4280106">)</span><span class="op" id="4280107">,</span>&nbsp;<span class="num" id="4280109">10</span><span class="op" id="4280111">,</span>&nbsp;<span class="num" id="4280113">64</span><span class="op" id="4280115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280118">if</span>&nbsp;<span class="ident" id="4280121">sec</span>&nbsp;<span class="op" id="4280125">==</span>&nbsp;<span class="num" id="4280128">0</span>&nbsp;<span class="op" id="4280130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280134">sec</span>&nbsp;<span class="op" id="4280138">=</span>&nbsp;<span class="num" id="4280140">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4280148">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4280205">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280247">w</span><span class="op" id="4280248">.</span><span class="ident" id="4280249">Header</span><span class="op" id="4280255">(</span><span class="op" id="4280256">)</span><span class="op" id="4280257">.</span><span class="ident" id="4280258">Set</span><span class="op" id="4280261">(</span><span class="string" id="4280262">&#34;Content-Type&#34;</span><span class="op" id="4280276">,</span>&nbsp;<span class="string" id="4280278">&#34;application/octet-stream&#34;</span><span class="op" id="4280304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280307">if</span>&nbsp;<span class="ident" id="4280310">err</span>&nbsp;<span class="op" id="4280314">:=</span>&nbsp;<span class="ident" id="4280317">pprof</span><span class="op" id="4280322">.</span><span class="ident" id="4280323">StartCPUProfile</span><span class="op" id="4280338">(</span><span class="ident" id="4280339">w</span><span class="op" id="4280340">)</span><span class="op" id="4280341">;</span>&nbsp;<span class="ident" id="4280343">err</span>&nbsp;<span class="op" id="4280347">!=</span>&nbsp;<span class="builtintype" id="4280350">nil</span>&nbsp;<span class="op" id="4280354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4280358">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4280405">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4280449">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280475">w</span><span class="op" id="4280476">.</span><span class="ident" id="4280477">Header</span><span class="op" id="4280483">(</span><span class="op" id="4280484">)</span><span class="op" id="4280485">.</span><span class="ident" id="4280486">Set</span><span class="op" id="4280489">(</span><span class="string" id="4280490">&#34;Content-Type&#34;</span><span class="op" id="4280504">,</span>&nbsp;<span class="string" id="4280506">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="4280533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280537">w</span><span class="op" id="4280538">.</span><span class="ident" id="4280539">WriteHeader</span><span class="op" id="4280550">(</span><span class="ident" id="4280551">http</span><span class="op" id="4280555">.</span><span class="ident" id="4280556">StatusInternalServerError</span><span class="op" id="4280581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280585">fmt</span><span class="op" id="4280588">.</span><span class="ident" id="4280589">Fprintf</span><span class="op" id="4280596">(</span><span class="ident" id="4280597">w</span><span class="op" id="4280598">,</span>&nbsp;<span class="string" id="4280600">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="4280638">,</span>&nbsp;<span class="ident" id="4280640">err</span><span class="op" id="4280643">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280647">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280658">time</span><span class="op" id="4280662">.</span><span class="ident" id="4280663">Sleep</span><span class="op" id="4280668">(</span><span class="ident" id="4280669">time</span><span class="op" id="4280673">.</span><span class="ident" id="4280674">Duration</span><span class="op" id="4280682">(</span><span class="ident" id="4280683">sec</span><span class="op" id="4280686">)</span>&nbsp;<span class="op" id="4280688">*</span>&nbsp;<span class="ident" id="4280690">time</span><span class="op" id="4280694">.</span><span class="ident" id="4280695">Second</span><span class="op" id="4280701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280704">pprof</span><span class="op" id="4280709">.</span><span class="ident" id="4280710">StopCPUProfile</span><span class="op" id="4280724">(</span><span class="op" id="4280725">)</span><br>
<span class="lineno"></span><span class="op" id="4280727">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4280730">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="4280793">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="4280864">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="4280931">func</span>&nbsp;<span class="ident" id="4280936">Symbol</span><span class="op" id="4280942">(</span><span class="ident" id="4280943">w</span>&nbsp;<span class="ident" id="4280945">http</span><span class="op" id="4280949">.</span><span class="ident" id="4280950">ResponseWriter</span><span class="op" id="4280964">,</span>&nbsp;<span class="ident" id="4280966">r</span>&nbsp;<span class="op" id="4280968">*</span><span class="ident" id="4280969">http</span><span class="op" id="4280973">.</span><span class="ident" id="4280974">Request</span><span class="op" id="4280981">)</span>&nbsp;<span class="op" id="4280983">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280986">w</span><span class="op" id="4280987">.</span><span class="ident" id="4280988">Header</span><span class="op" id="4280994">(</span><span class="op" id="4280995">)</span><span class="op" id="4280996">.</span><span class="ident" id="4280997">Set</span><span class="op" id="4281000">(</span><span class="string" id="4281001">&#34;Content-Type&#34;</span><span class="op" id="4281015">,</span>&nbsp;<span class="string" id="4281017">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="4281044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281048">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281095">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281144">var</span>&nbsp;<span class="ident" id="4281148">buf</span>&nbsp;<span class="ident" id="4281152">bytes</span><span class="op" id="4281157">.</span><span class="ident" id="4281158">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281167">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281218">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281276">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281328">fmt</span><span class="op" id="4281331">.</span><span class="ident" id="4281332">Fprintf</span><span class="op" id="4281339">(</span><span class="op" id="4281340">&amp;</span><span class="ident" id="4281341">buf</span><span class="op" id="4281344">,</span>&nbsp;<span class="string" id="4281346">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="4281364">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281368">var</span>&nbsp;<span class="ident" id="4281372">b</span>&nbsp;<span class="op" id="4281374">*</span><span class="ident" id="4281375">bufio</span><span class="op" id="4281380">.</span><span class="ident" id="4281381">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281389">if</span>&nbsp;<span class="ident" id="4281392">r</span><span class="op" id="4281393">.</span><span class="ident" id="4281394">Method</span>&nbsp;<span class="op" id="4281401">==</span>&nbsp;<span class="string" id="4281404">&#34;POST&#34;</span>&nbsp;<span class="op" id="4281411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281415">b</span>&nbsp;<span class="op" id="4281417">=</span>&nbsp;<span class="ident" id="4281419">bufio</span><span class="op" id="4281424">.</span><span class="ident" id="4281425">NewReader</span><span class="op" id="4281434">(</span><span class="ident" id="4281435">r</span><span class="op" id="4281436">.</span><span class="ident" id="4281437">Body</span><span class="op" id="4281441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4281444">}</span>&nbsp;<span class="keyword" id="4281446">else</span>&nbsp;<span class="op" id="4281451">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281455">b</span>&nbsp;<span class="op" id="4281457">=</span>&nbsp;<span class="ident" id="4281459">bufio</span><span class="op" id="4281464">.</span><span class="ident" id="4281465">NewReader</span><span class="op" id="4281474">(</span><span class="ident" id="4281475">strings</span><span class="op" id="4281482">.</span><span class="ident" id="4281483">NewReader</span><span class="op" id="4281492">(</span><span class="ident" id="4281493">r</span><span class="op" id="4281494">.</span><span class="ident" id="4281495">URL</span><span class="op" id="4281498">.</span><span class="ident" id="4281499">RawQuery</span><span class="op" id="4281507">)</span><span class="op" id="4281508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4281511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281515">for</span>&nbsp;<span class="op" id="4281519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281523">word</span><span class="op" id="4281527">,</span>&nbsp;<span class="ident" id="4281529">err</span>&nbsp;<span class="op" id="4281533">:=</span>&nbsp;<span class="ident" id="4281536">b</span><span class="op" id="4281537">.</span><span class="ident" id="4281538">ReadSlice</span><span class="op" id="4281547">(</span><span class="string" id="4281548">&#39;+&#39;</span><span class="op" id="4281551">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281555">if</span>&nbsp;<span class="ident" id="4281558">err</span>&nbsp;<span class="op" id="4281562">==</span>&nbsp;<span class="builtintype" id="4281565">nil</span>&nbsp;<span class="op" id="4281569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281574">word</span>&nbsp;<span class="op" id="4281579">=</span>&nbsp;<span class="ident" id="4281581">word</span><span class="op" id="4281585">[</span><span class="num" id="4281586">0</span>&nbsp;<span class="op" id="4281588">:</span>&nbsp;<span class="builtinfunc" id="4281590">len</span><span class="op" id="4281593">(</span><span class="ident" id="4281594">word</span><span class="op" id="4281598">)</span><span class="op" id="4281599">-</span><span class="num" id="4281600">1</span><span class="op" id="4281601">]</span>&nbsp;<span class="comment" id="4281603">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4281615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281619">pc</span><span class="op" id="4281621">,</span>&nbsp;<span class="ident" id="4281623">_</span>&nbsp;<span class="op" id="4281625">:=</span>&nbsp;<span class="ident" id="4281628">strconv</span><span class="op" id="4281635">.</span><span class="ident" id="4281636">ParseUint</span><span class="op" id="4281645">(</span><span class="builtintype" id="4281646">string</span><span class="op" id="4281652">(</span><span class="ident" id="4281653">word</span><span class="op" id="4281657">)</span><span class="op" id="4281658">,</span>&nbsp;<span class="num" id="4281660">0</span><span class="op" id="4281661">,</span>&nbsp;<span class="num" id="4281663">64</span><span class="op" id="4281665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281669">if</span>&nbsp;<span class="ident" id="4281672">pc</span>&nbsp;<span class="op" id="4281675">!=</span>&nbsp;<span class="num" id="4281678">0</span>&nbsp;<span class="op" id="4281680">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281685">f</span>&nbsp;<span class="op" id="4281687">:=</span>&nbsp;<span class="ident" id="4281690">runtime</span><span class="op" id="4281697">.</span><span class="ident" id="4281698">FuncForPC</span><span class="op" id="4281707">(</span><span class="builtintype" id="4281708">uintptr</span><span class="op" id="4281715">(</span><span class="ident" id="4281716">pc</span><span class="op" id="4281718">)</span><span class="op" id="4281719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281724">if</span>&nbsp;<span class="ident" id="4281727">f</span>&nbsp;<span class="op" id="4281729">!=</span>&nbsp;<span class="builtintype" id="4281732">nil</span>&nbsp;<span class="op" id="4281736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281742">fmt</span><span class="op" id="4281745">.</span><span class="ident" id="4281746">Fprintf</span><span class="op" id="4281753">(</span><span class="op" id="4281754">&amp;</span><span class="ident" id="4281755">buf</span><span class="op" id="4281758">,</span>&nbsp;<span class="string" id="4281760">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="4281770">,</span>&nbsp;<span class="ident" id="4281772">pc</span><span class="op" id="4281774">,</span>&nbsp;<span class="ident" id="4281776">f</span><span class="op" id="4281777">.</span><span class="ident" id="4281778">Name</span><span class="op" id="4281782">(</span><span class="op" id="4281783">)</span><span class="op" id="4281784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4281789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4281793">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281798">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281846">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281904">if</span>&nbsp;<span class="ident" id="4281907">err</span>&nbsp;<span class="op" id="4281911">!=</span>&nbsp;<span class="builtintype" id="4281914">nil</span>&nbsp;<span class="op" id="4281918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281923">if</span>&nbsp;<span class="ident" id="4281926">err</span>&nbsp;<span class="op" id="4281930">!=</span>&nbsp;<span class="ident" id="4281933">io</span><span class="op" id="4281935">.</span><span class="ident" id="4281936">EOF</span>&nbsp;<span class="op" id="4281940">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281946">fmt</span><span class="op" id="4281949">.</span><span class="ident" id="4281950">Fprintf</span><span class="op" id="4281957">(</span><span class="op" id="4281958">&amp;</span><span class="ident" id="4281959">buf</span><span class="op" id="4281962">,</span>&nbsp;<span class="string" id="4281964">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="4281987">,</span>&nbsp;<span class="ident" id="4281989">err</span><span class="op" id="4281992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4281997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282002">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282013">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282017">w</span><span class="op" id="4282018">.</span><span class="ident" id="4282019">Write</span><span class="op" id="4282024">(</span><span class="ident" id="4282025">buf</span><span class="op" id="4282028">.</span><span class="ident" id="4282029">Bytes</span><span class="op" id="4282034">(</span><span class="op" id="4282035">)</span><span class="op" id="4282036">)</span><br>
<span class="lineno"></span><span class="op" id="4282038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4282041">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="4282107">func</span>&nbsp;<span class="ident" id="4282112">Handler</span><span class="op" id="4282119">(</span><span class="ident" id="4282120">name</span>&nbsp;<span class="builtintype" id="4282125">string</span><span class="op" id="4282131">)</span>&nbsp;<span class="ident" id="4282133">http</span><span class="op" id="4282137">.</span><span class="ident" id="4282138">Handler</span>&nbsp;<span class="op" id="4282146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282149">return</span>&nbsp;<span class="ident" id="4282156">handler</span><span class="op" id="4282163">(</span><span class="ident" id="4282164">name</span><span class="op" id="4282168">)</span><br>
<span class="lineno"></span><span class="op" id="4282170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4282173">type</span>&nbsp;<span class="ident" id="4282178">handler</span>&nbsp;<span class="builtintype" id="4282186">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="4282194">func</span>&nbsp;<span class="op" id="4282199">(</span><span class="ident" id="4282200">name</span>&nbsp;<span class="ident" id="4282205">handler</span><span class="op" id="4282212">)</span>&nbsp;<span class="ident" id="4282214">ServeHTTP</span><span class="op" id="4282223">(</span><span class="ident" id="4282224">w</span>&nbsp;<span class="ident" id="4282226">http</span><span class="op" id="4282230">.</span><span class="ident" id="4282231">ResponseWriter</span><span class="op" id="4282245">,</span>&nbsp;<span class="ident" id="4282247">r</span>&nbsp;<span class="op" id="4282249">*</span><span class="ident" id="4282250">http</span><span class="op" id="4282254">.</span><span class="ident" id="4282255">Request</span><span class="op" id="4282262">)</span>&nbsp;<span class="op" id="4282264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282267">w</span><span class="op" id="4282268">.</span><span class="ident" id="4282269">Header</span><span class="op" id="4282275">(</span><span class="op" id="4282276">)</span><span class="op" id="4282277">.</span><span class="ident" id="4282278">Set</span><span class="op" id="4282281">(</span><span class="string" id="4282282">&#34;Content-Type&#34;</span><span class="op" id="4282296">,</span>&nbsp;<span class="string" id="4282298">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="4282325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282328">debug</span><span class="op" id="4282333">,</span>&nbsp;<span class="ident" id="4282335">_</span>&nbsp;<span class="op" id="4282337">:=</span>&nbsp;<span class="ident" id="4282340">strconv</span><span class="op" id="4282347">.</span><span class="ident" id="4282348">Atoi</span><span class="op" id="4282352">(</span><span class="ident" id="4282353">r</span><span class="op" id="4282354">.</span><span class="ident" id="4282355">FormValue</span><span class="op" id="4282364">(</span><span class="string" id="4282365">&#34;debug&#34;</span><span class="op" id="4282372">)</span><span class="op" id="4282373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282376">p</span>&nbsp;<span class="op" id="4282378">:=</span>&nbsp;<span class="ident" id="4282381">pprof</span><span class="op" id="4282386">.</span><span class="ident" id="4282387">Lookup</span><span class="op" id="4282393">(</span><span class="builtintype" id="4282394">string</span><span class="op" id="4282400">(</span><span class="ident" id="4282401">name</span><span class="op" id="4282405">)</span><span class="op" id="4282406">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282409">if</span>&nbsp;<span class="ident" id="4282412">p</span>&nbsp;<span class="op" id="4282414">==</span>&nbsp;<span class="builtintype" id="4282417">nil</span>&nbsp;<span class="op" id="4282421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282425">w</span><span class="op" id="4282426">.</span><span class="ident" id="4282427">WriteHeader</span><span class="op" id="4282438">(</span><span class="num" id="4282439">404</span><span class="op" id="4282442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282446">fmt</span><span class="op" id="4282449">.</span><span class="ident" id="4282450">Fprintf</span><span class="op" id="4282457">(</span><span class="ident" id="4282458">w</span><span class="op" id="4282459">,</span>&nbsp;<span class="string" id="4282461">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="4282484">,</span>&nbsp;<span class="ident" id="4282486">name</span><span class="op" id="4282490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282494">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282502">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282505">gc</span><span class="op" id="4282507">,</span>&nbsp;<span class="ident" id="4282509">_</span>&nbsp;<span class="op" id="4282511">:=</span>&nbsp;<span class="ident" id="4282514">strconv</span><span class="op" id="4282521">.</span><span class="ident" id="4282522">Atoi</span><span class="op" id="4282526">(</span><span class="ident" id="4282527">r</span><span class="op" id="4282528">.</span><span class="ident" id="4282529">FormValue</span><span class="op" id="4282538">(</span><span class="string" id="4282539">&#34;gc&#34;</span><span class="op" id="4282543">)</span><span class="op" id="4282544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282547">if</span>&nbsp;<span class="ident" id="4282550">name</span>&nbsp;<span class="op" id="4282555">==</span>&nbsp;<span class="string" id="4282558">&#34;heap&#34;</span>&nbsp;<span class="op" id="4282565">&amp;&amp;</span>&nbsp;<span class="ident" id="4282568">gc</span>&nbsp;<span class="op" id="4282571">&gt;</span>&nbsp;<span class="num" id="4282573">0</span>&nbsp;<span class="op" id="4282575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282579">runtime</span><span class="op" id="4282586">.</span><span class="ident" id="4282587">GC</span><span class="op" id="4282589">(</span><span class="op" id="4282590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282596">p</span><span class="op" id="4282597">.</span><span class="ident" id="4282598">WriteTo</span><span class="op" id="4282605">(</span><span class="ident" id="4282606">w</span><span class="op" id="4282607">,</span>&nbsp;<span class="ident" id="4282609">debug</span><span class="op" id="4282614">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282617">return</span><br>
<span class="lineno"></span><span class="op" id="4282624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4282627">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="4282700">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="4282763">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="4282832">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="4282867">func</span>&nbsp;<span class="ident" id="4282872">Index</span><span class="op" id="4282877">(</span><span class="ident" id="4282878">w</span>&nbsp;<span class="ident" id="4282880">http</span><span class="op" id="4282884">.</span><span class="ident" id="4282885">ResponseWriter</span><span class="op" id="4282899">,</span>&nbsp;<span class="ident" id="4282901">r</span>&nbsp;<span class="op" id="4282903">*</span><span class="ident" id="4282904">http</span><span class="op" id="4282908">.</span><span class="ident" id="4282909">Request</span><span class="op" id="4282916">)</span>&nbsp;<span class="op" id="4282918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282921">if</span>&nbsp;<span class="ident" id="4282924">strings</span><span class="op" id="4282931">.</span><span class="ident" id="4282932">HasPrefix</span><span class="op" id="4282941">(</span><span class="ident" id="4282942">r</span><span class="op" id="4282943">.</span><span class="ident" id="4282944">URL</span><span class="op" id="4282947">.</span><span class="ident" id="4282948">Path</span><span class="op" id="4282952">,</span>&nbsp;<span class="string" id="4282954">&#34;/debug/pprof/&#34;</span><span class="op" id="4282969">)</span>&nbsp;<span class="op" id="4282971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282975">name</span>&nbsp;<span class="op" id="4282980">:=</span>&nbsp;<span class="ident" id="4282983">strings</span><span class="op" id="4282990">.</span><span class="ident" id="4282991">TrimPrefix</span><span class="op" id="4283001">(</span><span class="ident" id="4283002">r</span><span class="op" id="4283003">.</span><span class="ident" id="4283004">URL</span><span class="op" id="4283007">.</span><span class="ident" id="4283008">Path</span><span class="op" id="4283012">,</span>&nbsp;<span class="string" id="4283014">&#34;/debug/pprof/&#34;</span><span class="op" id="4283029">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283033">if</span>&nbsp;<span class="ident" id="4283036">name</span>&nbsp;<span class="op" id="4283041">!=</span>&nbsp;<span class="string" id="4283044">&#34;&#34;</span>&nbsp;<span class="op" id="4283047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283052">handler</span><span class="op" id="4283059">(</span><span class="ident" id="4283060">name</span><span class="op" id="4283064">)</span><span class="op" id="4283065">.</span><span class="ident" id="4283066">ServeHTTP</span><span class="op" id="4283075">(</span><span class="ident" id="4283076">w</span><span class="op" id="4283077">,</span>&nbsp;<span class="ident" id="4283079">r</span><span class="op" id="4283080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283085">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283097">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283101">profiles</span>&nbsp;<span class="op" id="4283110">:=</span>&nbsp;<span class="ident" id="4283113">pprof</span><span class="op" id="4283118">.</span><span class="ident" id="4283119">Profiles</span><span class="op" id="4283127">(</span><span class="op" id="4283128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283131">if</span>&nbsp;<span class="ident" id="4283134">err</span>&nbsp;<span class="op" id="4283138">:=</span>&nbsp;<span class="ident" id="4283141">indexTmpl</span><span class="op" id="4283150">.</span><span class="ident" id="4283151">Execute</span><span class="op" id="4283158">(</span><span class="ident" id="4283159">w</span><span class="op" id="4283160">,</span>&nbsp;<span class="ident" id="4283162">profiles</span><span class="op" id="4283170">)</span><span class="op" id="4283171">;</span>&nbsp;<span class="ident" id="4283173">err</span>&nbsp;<span class="op" id="4283177">!=</span>&nbsp;<span class="builtintype" id="4283180">nil</span>&nbsp;<span class="op" id="4283184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283188">log</span><span class="op" id="4283191">.</span><span class="ident" id="4283192">Print</span><span class="op" id="4283197">(</span><span class="ident" id="4283198">err</span><span class="op" id="4283201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283204">}</span><br>
<span class="lineno">190</span><span class="op" id="4283206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4283209">var</span>&nbsp;<span class="ident" id="4283213">indexTmpl</span>&nbsp;<span class="op" id="4283223">=</span>&nbsp;<span class="ident" id="4283225">template</span><span class="op" id="4283233">.</span><span class="ident" id="4283234">Must</span><span class="op" id="4283238">(</span><span class="ident" id="4283239">template</span><span class="op" id="4283247">.</span><span class="ident" id="4283248">New</span><span class="op" id="4283251">(</span><span class="string" id="4283252">&#34;index&#34;</span><span class="op" id="4283259">)</span><span class="op" id="4283260">.</span><span class="ident" id="4283261">Parse</span><span class="op" id="4283266">(</span><span class="string" id="4283267">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="4283586">)</span><span class="op" id="4283587">)</span>
</div>
</body>
</html>
