<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html" class="current">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6689026">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6689081">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6689135">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6689186">package</span>&nbsp;<span class="ident" id="6689194">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6689205">import</span>&nbsp;<span class="op" id="6689212">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6689215">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6689224">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6689241">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6689248">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6689254">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6689267">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6689284">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6689290">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6689301">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6689312">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6689322">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6689325">func</span>&nbsp;<span class="ident" id="6689330">TestBoundaryLine</span><span class="op" id="6689346">(</span><span class="ident" id="6689347">t</span>&nbsp;<span class="op" id="6689349">*</span><span class="ident" id="6689350">testing</span><span class="op" id="6689357">.</span><span class="ident" id="6689358">T</span><span class="op" id="6689359">)</span>&nbsp;<span class="op" id="6689361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6689364">mr</span>&nbsp;<span class="op" id="6689367">:=</span>&nbsp;<span class="ident" id="6689370">NewReader</span><span class="op" id="6689379">(</span><span class="ident" id="6689380">strings</span><span class="op" id="6689387">.</span><span class="ident" id="6689388">NewReader</span><span class="op" id="6689397">(</span><span class="string" id="6689398">&#34;&#34;</span><span class="op" id="6689400">)</span><span class="op" id="6689401">,</span>&nbsp;<span class="string" id="6689403">&#34;myBoundary&#34;</span><span class="op" id="6689415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6689418">if</span>&nbsp;<span class="op" id="6689421">!</span><span class="ident" id="6689422">mr</span><span class="op" id="6689424">.</span><span class="ident" id="6689425">isBoundaryDelimiterLine</span><span class="op" id="6689448">(</span><span class="op" id="6689449">[</span><span class="op" id="6689450">]</span><span class="builtintype" id="6689451">byte</span><span class="op" id="6689455">(</span><span class="string" id="6689456">&#34;--myBoundary\r\n&#34;</span><span class="op" id="6689474">)</span><span class="op" id="6689475">)</span>&nbsp;<span class="op" id="6689477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6689481">t</span><span class="op" id="6689482">.</span><span class="ident" id="6689483">Error</span><span class="op" id="6689488">(</span><span class="string" id="6689489">&#34;expected&#34;</span><span class="op" id="6689499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6689502">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6689505">if</span>&nbsp;<span class="op" id="6689508">!</span><span class="ident" id="6689509">mr</span><span class="op" id="6689511">.</span><span class="ident" id="6689512">isBoundaryDelimiterLine</span><span class="op" id="6689535">(</span><span class="op" id="6689536">[</span><span class="op" id="6689537">]</span><span class="builtintype" id="6689538">byte</span><span class="op" id="6689542">(</span><span class="string" id="6689543">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="6689562">)</span><span class="op" id="6689563">)</span>&nbsp;<span class="op" id="6689565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6689569">t</span><span class="op" id="6689570">.</span><span class="ident" id="6689571">Error</span><span class="op" id="6689576">(</span><span class="string" id="6689577">&#34;expected&#34;</span><span class="op" id="6689587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6689590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6689593">if</span>&nbsp;<span class="op" id="6689596">!</span><span class="ident" id="6689597">mr</span><span class="op" id="6689599">.</span><span class="ident" id="6689600">isBoundaryDelimiterLine</span><span class="op" id="6689623">(</span><span class="op" id="6689624">[</span><span class="op" id="6689625">]</span><span class="builtintype" id="6689626">byte</span><span class="op" id="6689630">(</span><span class="string" id="6689631">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="6689648">)</span><span class="op" id="6689649">)</span>&nbsp;<span class="op" id="6689651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6689655">t</span><span class="op" id="6689656">.</span><span class="ident" id="6689657">Error</span><span class="op" id="6689662">(</span><span class="string" id="6689663">&#34;expected&#34;</span><span class="op" id="6689673">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6689676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6689679">if</span>&nbsp;<span class="ident" id="6689682">mr</span><span class="op" id="6689684">.</span><span class="ident" id="6689685">isBoundaryDelimiterLine</span><span class="op" id="6689708">(</span><span class="op" id="6689709">[</span><span class="op" id="6689710">]</span><span class="builtintype" id="6689711">byte</span><span class="op" id="6689715">(</span><span class="string" id="6689716">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="6689739">)</span><span class="op" id="6689740">)</span>&nbsp;<span class="op" id="6689742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6689746">t</span><span class="op" id="6689747">.</span><span class="ident" id="6689748">Error</span><span class="op" id="6689753">(</span><span class="string" id="6689754">&#34;expected&nbsp;fail&#34;</span><span class="op" id="6689769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6689772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6689775">if</span>&nbsp;<span class="ident" id="6689778">mr</span><span class="op" id="6689780">.</span><span class="ident" id="6689781">isBoundaryDelimiterLine</span><span class="op" id="6689804">(</span><span class="op" id="6689805">[</span><span class="op" id="6689806">]</span><span class="builtintype" id="6689807">byte</span><span class="op" id="6689811">(</span><span class="string" id="6689812">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="6689834">)</span><span class="op" id="6689835">)</span>&nbsp;<span class="op" id="6689837">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6689841">t</span><span class="op" id="6689842">.</span><span class="ident" id="6689843">Error</span><span class="op" id="6689848">(</span><span class="string" id="6689849">&#34;expected&nbsp;fail&#34;</span><span class="op" id="6689864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6689867">}</span><br>
<span class="lineno"></span><span class="op" id="6689869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6689872">func</span>&nbsp;<span class="ident" id="6689877">escapeString</span><span class="op" id="6689889">(</span><span class="ident" id="6689890">v</span>&nbsp;<span class="builtintype" id="6689892">string</span><span class="op" id="6689898">)</span>&nbsp;<span class="builtintype" id="6689900">string</span>&nbsp;<span class="op" id="6689907">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6689910">bytes</span><span class="op" id="6689915">,</span>&nbsp;<span class="ident" id="6689917">_</span>&nbsp;<span class="op" id="6689919">:=</span>&nbsp;<span class="ident" id="6689922">json</span><span class="op" id="6689926">.</span><span class="ident" id="6689927">Marshal</span><span class="op" id="6689934">(</span><span class="ident" id="6689935">v</span><span class="op" id="6689936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6689939">return</span>&nbsp;<span class="builtintype" id="6689946">string</span><span class="op" id="6689952">(</span><span class="ident" id="6689953">bytes</span><span class="op" id="6689958">)</span><br>
<span class="lineno"></span><span class="op" id="6689960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6689963">func</span>&nbsp;<span class="ident" id="6689968">expectEq</span><span class="op" id="6689976">(</span><span class="ident" id="6689977">t</span>&nbsp;<span class="op" id="6689979">*</span><span class="ident" id="6689980">testing</span><span class="op" id="6689987">.</span><span class="ident" id="6689988">T</span><span class="op" id="6689989">,</span>&nbsp;<span class="ident" id="6689991">expected</span><span class="op" id="6689999">,</span>&nbsp;<span class="ident" id="6690001">actual</span><span class="op" id="6690007">,</span>&nbsp;<span class="ident" id="6690009">what</span>&nbsp;<span class="builtintype" id="6690014">string</span><span class="op" id="6690020">)</span>&nbsp;<span class="op" id="6690022">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6690025">if</span>&nbsp;<span class="ident" id="6690028">expected</span>&nbsp;<span class="op" id="6690037">==</span>&nbsp;<span class="ident" id="6690040">actual</span>&nbsp;<span class="op" id="6690047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6690051">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6690059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6690062">t</span><span class="op" id="6690063">.</span><span class="ident" id="6690064">Errorf</span><span class="op" id="6690070">(</span><span class="string" id="6690071">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="6690139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6690143">what</span><span class="op" id="6690147">,</span>&nbsp;<span class="ident" id="6690149">escapeString</span><span class="op" id="6690161">(</span><span class="ident" id="6690162">actual</span><span class="op" id="6690168">)</span><span class="op" id="6690169">,</span>&nbsp;<span class="builtinfunc" id="6690171">len</span><span class="op" id="6690174">(</span><span class="ident" id="6690175">actual</span><span class="op" id="6690181">)</span><span class="op" id="6690182">,</span>&nbsp;<span class="ident" id="6690184">escapeString</span><span class="op" id="6690196">(</span><span class="ident" id="6690197">expected</span><span class="op" id="6690205">)</span><span class="op" id="6690206">,</span>&nbsp;<span class="builtinfunc" id="6690208">len</span><span class="op" id="6690211">(</span><span class="ident" id="6690212">expected</span><span class="op" id="6690220">)</span><span class="op" id="6690221">)</span><br>
<span class="lineno">50</span><span class="op" id="6690223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6690226">func</span>&nbsp;<span class="ident" id="6690231">TestNameAccessors</span><span class="op" id="6690248">(</span><span class="ident" id="6690249">t</span>&nbsp;<span class="op" id="6690251">*</span><span class="ident" id="6690252">testing</span><span class="op" id="6690259">.</span><span class="ident" id="6690260">T</span><span class="op" id="6690261">)</span>&nbsp;<span class="op" id="6690263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6690266">tests</span>&nbsp;<span class="op" id="6690272">:=</span>&nbsp;<span class="op" id="6690275">[</span><span class="op" id="6690276">...</span><span class="op" id="6690279">]</span><span class="op" id="6690280">[</span><span class="num" id="6690281">3</span><span class="op" id="6690282">]</span><span class="builtintype" id="6690283">string</span><span class="op" id="6690289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6690293">{</span><span class="string" id="6690294">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="6690317">,</span>&nbsp;<span class="string" id="6690319">&#34;foo&#34;</span><span class="op" id="6690324">,</span>&nbsp;<span class="string" id="6690326">&#34;&#34;</span><span class="op" id="6690328">}</span><span class="op" id="6690329">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6690333">{</span><span class="string" id="6690334">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="6690357">,</span>&nbsp;<span class="string" id="6690359">&#34;foo&#34;</span><span class="op" id="6690364">,</span>&nbsp;<span class="string" id="6690366">&#34;&#34;</span><span class="op" id="6690368">}</span><span class="op" id="6690369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6690373">{</span><span class="string" id="6690374">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="6690396">,</span>&nbsp;<span class="string" id="6690398">&#34;foo&#34;</span><span class="op" id="6690403">,</span>&nbsp;<span class="string" id="6690405">&#34;&#34;</span><span class="op" id="6690407">}</span><span class="op" id="6690408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6690412">{</span><span class="string" id="6690413">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="6690438">,</span>&nbsp;<span class="string" id="6690440">&#34;foo&#34;</span><span class="op" id="6690445">,</span>&nbsp;<span class="string" id="6690447">&#34;&#34;</span><span class="op" id="6690449">}</span><span class="op" id="6690450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6690454">{</span><span class="string" id="6690455">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="6690480">,</span>&nbsp;<span class="string" id="6690482">&#34;foo&#34;</span><span class="op" id="6690487">,</span>&nbsp;<span class="string" id="6690489">&#34;&#34;</span><span class="op" id="6690491">}</span><span class="op" id="6690492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6690496">{</span><span class="string" id="6690497">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="6690520">,</span>&nbsp;<span class="string" id="6690522">&#34;foo&#34;</span><span class="op" id="6690527">,</span>&nbsp;<span class="string" id="6690529">&#34;&#34;</span><span class="op" id="6690531">}</span><span class="op" id="6690532">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6690536">{</span><span class="string" id="6690537">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="6690590">,</span>&nbsp;<span class="string" id="6690592">&#34;foo&#34;</span><span class="op" id="6690597">,</span>&nbsp;<span class="string" id="6690599">&#34;foo.txt&#34;</span><span class="op" id="6690608">}</span><span class="op" id="6690609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6690613">{</span><span class="string" id="6690614">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="6690671">,</span>&nbsp;<span class="string" id="6690673">&#34;&#34;</span><span class="op" id="6690675">,</span>&nbsp;<span class="string" id="6690677">&#34;bar.txt&#34;</span><span class="op" id="6690686">}</span><span class="op" id="6690687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6690690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6690693">for</span>&nbsp;<span class="ident" id="6690697">i</span><span class="op" id="6690698">,</span>&nbsp;<span class="ident" id="6690700">test</span>&nbsp;<span class="op" id="6690705">:=</span>&nbsp;<span class="keyword" id="6690708">range</span>&nbsp;<span class="ident" id="6690714">tests</span>&nbsp;<span class="op" id="6690720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6690724">p</span>&nbsp;<span class="op" id="6690726">:=</span>&nbsp;<span class="op" id="6690729">&amp;</span><span class="ident" id="6690730">Part</span><span class="op" id="6690734">{</span><span class="ident" id="6690735">Header</span><span class="op" id="6690741">:</span>&nbsp;<span class="builtinfunc" id="6690743">make</span><span class="op" id="6690747">(</span><span class="keyword" id="6690748">map</span><span class="op" id="6690751">[</span><span class="builtintype" id="6690752">string</span><span class="op" id="6690758">]</span><span class="op" id="6690759">[</span><span class="op" id="6690760">]</span><span class="builtintype" id="6690761">string</span><span class="op" id="6690767">)</span><span class="op" id="6690768">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6690772">p</span><span class="op" id="6690773">.</span><span class="ident" id="6690774">Header</span><span class="op" id="6690780">.</span><span class="ident" id="6690781">Set</span><span class="op" id="6690784">(</span><span class="string" id="6690785">&#34;Content-Disposition&#34;</span><span class="op" id="6690806">,</span>&nbsp;<span class="ident" id="6690808">test</span><span class="op" id="6690812">[</span><span class="num" id="6690813">0</span><span class="op" id="6690814">]</span><span class="op" id="6690815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6690819">if</span>&nbsp;<span class="ident" id="6690822">g</span><span class="op" id="6690823">,</span>&nbsp;<span class="ident" id="6690825">e</span>&nbsp;<span class="op" id="6690827">:=</span>&nbsp;<span class="ident" id="6690830">p</span><span class="op" id="6690831">.</span><span class="ident" id="6690832">FormName</span><span class="op" id="6690840">(</span><span class="op" id="6690841">)</span><span class="op" id="6690842">,</span>&nbsp;<span class="ident" id="6690844">test</span><span class="op" id="6690848">[</span><span class="num" id="6690849">1</span><span class="op" id="6690850">]</span><span class="op" id="6690851">;</span>&nbsp;<span class="ident" id="6690853">g</span>&nbsp;<span class="op" id="6690855">!=</span>&nbsp;<span class="ident" id="6690858">e</span>&nbsp;<span class="op" id="6690860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6690865">t</span><span class="op" id="6690866">.</span><span class="ident" id="6690867">Errorf</span><span class="op" id="6690873">(</span><span class="string" id="6690874">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6690909">,</span>&nbsp;<span class="ident" id="6690911">i</span><span class="op" id="6690912">,</span>&nbsp;<span class="ident" id="6690914">g</span><span class="op" id="6690915">,</span>&nbsp;<span class="ident" id="6690917">e</span><span class="op" id="6690918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6690922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6690926">if</span>&nbsp;<span class="ident" id="6690929">g</span><span class="op" id="6690930">,</span>&nbsp;<span class="ident" id="6690932">e</span>&nbsp;<span class="op" id="6690934">:=</span>&nbsp;<span class="ident" id="6690937">p</span><span class="op" id="6690938">.</span><span class="ident" id="6690939">FileName</span><span class="op" id="6690947">(</span><span class="op" id="6690948">)</span><span class="op" id="6690949">,</span>&nbsp;<span class="ident" id="6690951">test</span><span class="op" id="6690955">[</span><span class="num" id="6690956">2</span><span class="op" id="6690957">]</span><span class="op" id="6690958">;</span>&nbsp;<span class="ident" id="6690960">g</span>&nbsp;<span class="op" id="6690962">!=</span>&nbsp;<span class="ident" id="6690965">e</span>&nbsp;<span class="op" id="6690967">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6690972">t</span><span class="op" id="6690973">.</span><span class="ident" id="6690974">Errorf</span><span class="op" id="6690980">(</span><span class="string" id="6690981">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6691016">,</span>&nbsp;<span class="ident" id="6691018">i</span><span class="op" id="6691019">,</span>&nbsp;<span class="ident" id="6691021">g</span><span class="op" id="6691022">,</span>&nbsp;<span class="ident" id="6691024">e</span><span class="op" id="6691025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6691029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6691032">}</span><br>
<span class="lineno"></span><span class="op" id="6691034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6691037">var</span>&nbsp;<span class="ident" id="6691041">longLine</span>&nbsp;<span class="op" id="6691050">=</span>&nbsp;<span class="ident" id="6691052">strings</span><span class="op" id="6691059">.</span><span class="ident" id="6691060">Repeat</span><span class="op" id="6691066">(</span><span class="string" id="6691067">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="6691087">,</span>&nbsp;<span class="op" id="6691089">(</span><span class="num" id="6691090">1</span><span class="op" id="6691091">&lt;&lt;</span><span class="num" id="6691093">20</span><span class="op" id="6691095">)</span><span class="op" id="6691096">/</span><span class="num" id="6691097">8</span><span class="op" id="6691098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6691101">func</span>&nbsp;<span class="ident" id="6691106">testMultipartBody</span><span class="op" id="6691123">(</span><span class="ident" id="6691124">sep</span>&nbsp;<span class="builtintype" id="6691128">string</span><span class="op" id="6691134">)</span>&nbsp;<span class="builtintype" id="6691136">string</span>&nbsp;<span class="op" id="6691143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6691146">testBody</span>&nbsp;<span class="op" id="6691155">:=</span>&nbsp;<span class="string" id="6691158">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6691515">testBody</span>&nbsp;<span class="op" id="6691524">=</span>&nbsp;<span class="ident" id="6691526">strings</span><span class="op" id="6691533">.</span><span class="ident" id="6691534">Replace</span><span class="op" id="6691541">(</span><span class="ident" id="6691542">testBody</span><span class="op" id="6691550">,</span>&nbsp;<span class="string" id="6691552">&#34;\n&#34;</span><span class="op" id="6691556">,</span>&nbsp;<span class="ident" id="6691558">sep</span><span class="op" id="6691561">,</span>&nbsp;<span class="op" id="6691563">-</span><span class="num" id="6691564">1</span><span class="op" id="6691565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6691568">return</span>&nbsp;<span class="ident" id="6691575">strings</span><span class="op" id="6691582">.</span><span class="ident" id="6691583">Replace</span><span class="op" id="6691590">(</span><span class="ident" id="6691591">testBody</span><span class="op" id="6691599">,</span>&nbsp;<span class="string" id="6691601">&#34;[longline]&#34;</span><span class="op" id="6691613">,</span>&nbsp;<span class="ident" id="6691615">longLine</span><span class="op" id="6691623">,</span>&nbsp;<span class="num" id="6691625">1</span><span class="op" id="6691626">)</span><br>
<span class="lineno">110</span><span class="op" id="6691628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6691631">func</span>&nbsp;<span class="ident" id="6691636">TestMultipart</span><span class="op" id="6691649">(</span><span class="ident" id="6691650">t</span>&nbsp;<span class="op" id="6691652">*</span><span class="ident" id="6691653">testing</span><span class="op" id="6691660">.</span><span class="ident" id="6691661">T</span><span class="op" id="6691662">)</span>&nbsp;<span class="op" id="6691664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6691667">bodyReader</span>&nbsp;<span class="op" id="6691678">:=</span>&nbsp;<span class="ident" id="6691681">strings</span><span class="op" id="6691688">.</span><span class="ident" id="6691689">NewReader</span><span class="op" id="6691698">(</span><span class="ident" id="6691699">testMultipartBody</span><span class="op" id="6691716">(</span><span class="string" id="6691717">&#34;\r\n&#34;</span><span class="op" id="6691723">)</span><span class="op" id="6691724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6691727">testMultipart</span><span class="op" id="6691740">(</span><span class="ident" id="6691741">t</span><span class="op" id="6691742">,</span>&nbsp;<span class="ident" id="6691744">bodyReader</span><span class="op" id="6691754">,</span>&nbsp;<span class="builtintype" id="6691756">false</span><span class="op" id="6691761">)</span><br>
<span class="lineno">115</span><span class="op" id="6691763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6691766">func</span>&nbsp;<span class="ident" id="6691771">TestMultipartOnlyNewlines</span><span class="op" id="6691796">(</span><span class="ident" id="6691797">t</span>&nbsp;<span class="op" id="6691799">*</span><span class="ident" id="6691800">testing</span><span class="op" id="6691807">.</span><span class="ident" id="6691808">T</span><span class="op" id="6691809">)</span>&nbsp;<span class="op" id="6691811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6691814">bodyReader</span>&nbsp;<span class="op" id="6691825">:=</span>&nbsp;<span class="ident" id="6691828">strings</span><span class="op" id="6691835">.</span><span class="ident" id="6691836">NewReader</span><span class="op" id="6691845">(</span><span class="ident" id="6691846">testMultipartBody</span><span class="op" id="6691863">(</span><span class="string" id="6691864">&#34;\n&#34;</span><span class="op" id="6691868">)</span><span class="op" id="6691869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6691872">testMultipart</span><span class="op" id="6691885">(</span><span class="ident" id="6691886">t</span><span class="op" id="6691887">,</span>&nbsp;<span class="ident" id="6691889">bodyReader</span><span class="op" id="6691899">,</span>&nbsp;<span class="builtintype" id="6691901">true</span><span class="op" id="6691905">)</span><br>
<span class="lineno">120</span><span class="op" id="6691907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6691910">func</span>&nbsp;<span class="ident" id="6691915">TestMultipartSlowInput</span><span class="op" id="6691937">(</span><span class="ident" id="6691938">t</span>&nbsp;<span class="op" id="6691940">*</span><span class="ident" id="6691941">testing</span><span class="op" id="6691948">.</span><span class="ident" id="6691949">T</span><span class="op" id="6691950">)</span>&nbsp;<span class="op" id="6691952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6691955">bodyReader</span>&nbsp;<span class="op" id="6691966">:=</span>&nbsp;<span class="ident" id="6691969">strings</span><span class="op" id="6691976">.</span><span class="ident" id="6691977">NewReader</span><span class="op" id="6691986">(</span><span class="ident" id="6691987">testMultipartBody</span><span class="op" id="6692004">(</span><span class="string" id="6692005">&#34;\r\n&#34;</span><span class="op" id="6692011">)</span><span class="op" id="6692012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6692015">testMultipart</span><span class="op" id="6692028">(</span><span class="ident" id="6692029">t</span><span class="op" id="6692030">,</span>&nbsp;<span class="op" id="6692032">&amp;</span><span class="ident" id="6692033">slowReader</span><span class="op" id="6692043">{</span><span class="ident" id="6692044">bodyReader</span><span class="op" id="6692054">}</span><span class="op" id="6692055">,</span>&nbsp;<span class="builtintype" id="6692057">false</span><span class="op" id="6692062">)</span><br>
<span class="lineno">125</span><span class="op" id="6692064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6692067">func</span>&nbsp;<span class="ident" id="6692072">testMultipart</span><span class="op" id="6692085">(</span><span class="ident" id="6692086">t</span>&nbsp;<span class="op" id="6692088">*</span><span class="ident" id="6692089">testing</span><span class="op" id="6692096">.</span><span class="ident" id="6692097">T</span><span class="op" id="6692098">,</span>&nbsp;<span class="ident" id="6692100">r</span>&nbsp;<span class="ident" id="6692102">io</span><span class="op" id="6692104">.</span><span class="ident" id="6692105">Reader</span><span class="op" id="6692111">,</span>&nbsp;<span class="ident" id="6692113">onlyNewlines</span>&nbsp;<span class="builtintype" id="6692126">bool</span><span class="op" id="6692130">)</span>&nbsp;<span class="op" id="6692132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6692135">reader</span>&nbsp;<span class="op" id="6692142">:=</span>&nbsp;<span class="ident" id="6692145">NewReader</span><span class="op" id="6692154">(</span><span class="ident" id="6692155">r</span><span class="op" id="6692156">,</span>&nbsp;<span class="string" id="6692158">&#34;MyBoundary&#34;</span><span class="op" id="6692170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6692173">buf</span>&nbsp;<span class="op" id="6692177">:=</span>&nbsp;<span class="builtinfunc" id="6692180">new</span><span class="op" id="6692183">(</span><span class="ident" id="6692184">bytes</span><span class="op" id="6692189">.</span><span class="ident" id="6692190">Buffer</span><span class="op" id="6692196">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6692200">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6692210">part</span><span class="op" id="6692214">,</span>&nbsp;<span class="ident" id="6692216">err</span>&nbsp;<span class="op" id="6692220">:=</span>&nbsp;<span class="ident" id="6692223">reader</span><span class="op" id="6692229">.</span><span class="ident" id="6692230">NextPart</span><span class="op" id="6692238">(</span><span class="op" id="6692239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6692242">if</span>&nbsp;<span class="ident" id="6692245">part</span>&nbsp;<span class="op" id="6692250">==</span>&nbsp;<span class="ident" id="6692253">nil</span>&nbsp;<span class="op" id="6692257">||</span>&nbsp;<span class="ident" id="6692260">err</span>&nbsp;<span class="op" id="6692264">!=</span>&nbsp;<span class="ident" id="6692267">nil</span>&nbsp;<span class="op" id="6692271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6692275">t</span><span class="op" id="6692276">.</span><span class="ident" id="6692277">Error</span><span class="op" id="6692282">(</span><span class="string" id="6692283">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="6692299">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6692303">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6692311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6692314">if</span>&nbsp;<span class="ident" id="6692317">x</span>&nbsp;<span class="op" id="6692319">:=</span>&nbsp;<span class="ident" id="6692322">part</span><span class="op" id="6692326">.</span><span class="ident" id="6692327">Header</span><span class="op" id="6692333">.</span><span class="ident" id="6692334">Get</span><span class="op" id="6692337">(</span><span class="string" id="6692338">&#34;Header1&#34;</span><span class="op" id="6692347">)</span><span class="op" id="6692348">;</span>&nbsp;<span class="ident" id="6692350">x</span>&nbsp;<span class="op" id="6692352">!=</span>&nbsp;<span class="string" id="6692355">&#34;value1&#34;</span>&nbsp;<span class="op" id="6692364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6692368">t</span><span class="op" id="6692369">.</span><span class="ident" id="6692370">Errorf</span><span class="op" id="6692376">(</span><span class="string" id="6692377">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6692412">,</span>&nbsp;<span class="string" id="6692414">&#34;Header1&#34;</span><span class="op" id="6692423">,</span>&nbsp;<span class="ident" id="6692425">x</span><span class="op" id="6692426">,</span>&nbsp;<span class="string" id="6692428">&#34;value1&#34;</span><span class="op" id="6692436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6692439">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6692442">if</span>&nbsp;<span class="ident" id="6692445">x</span>&nbsp;<span class="op" id="6692447">:=</span>&nbsp;<span class="ident" id="6692450">part</span><span class="op" id="6692454">.</span><span class="ident" id="6692455">Header</span><span class="op" id="6692461">.</span><span class="ident" id="6692462">Get</span><span class="op" id="6692465">(</span><span class="string" id="6692466">&#34;foo-bar&#34;</span><span class="op" id="6692475">)</span><span class="op" id="6692476">;</span>&nbsp;<span class="ident" id="6692478">x</span>&nbsp;<span class="op" id="6692480">!=</span>&nbsp;<span class="string" id="6692483">&#34;baz&#34;</span>&nbsp;<span class="op" id="6692489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6692493">t</span><span class="op" id="6692494">.</span><span class="ident" id="6692495">Errorf</span><span class="op" id="6692501">(</span><span class="string" id="6692502">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6692537">,</span>&nbsp;<span class="string" id="6692539">&#34;foo-bar&#34;</span><span class="op" id="6692548">,</span>&nbsp;<span class="ident" id="6692550">x</span><span class="op" id="6692551">,</span>&nbsp;<span class="string" id="6692553">&#34;baz&#34;</span><span class="op" id="6692558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6692561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6692564">if</span>&nbsp;<span class="ident" id="6692567">x</span>&nbsp;<span class="op" id="6692569">:=</span>&nbsp;<span class="ident" id="6692572">part</span><span class="op" id="6692576">.</span><span class="ident" id="6692577">Header</span><span class="op" id="6692583">.</span><span class="ident" id="6692584">Get</span><span class="op" id="6692587">(</span><span class="string" id="6692588">&#34;Foo-Bar&#34;</span><span class="op" id="6692597">)</span><span class="op" id="6692598">;</span>&nbsp;<span class="ident" id="6692600">x</span>&nbsp;<span class="op" id="6692602">!=</span>&nbsp;<span class="string" id="6692605">&#34;baz&#34;</span>&nbsp;<span class="op" id="6692611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6692615">t</span><span class="op" id="6692616">.</span><span class="ident" id="6692617">Errorf</span><span class="op" id="6692623">(</span><span class="string" id="6692624">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6692659">,</span>&nbsp;<span class="string" id="6692661">&#34;Foo-Bar&#34;</span><span class="op" id="6692670">,</span>&nbsp;<span class="ident" id="6692672">x</span><span class="op" id="6692673">,</span>&nbsp;<span class="string" id="6692675">&#34;baz&#34;</span><span class="op" id="6692680">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6692683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6692686">buf</span><span class="op" id="6692689">.</span><span class="ident" id="6692690">Reset</span><span class="op" id="6692695">(</span><span class="op" id="6692696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6692699">if</span>&nbsp;<span class="ident" id="6692702">_</span><span class="op" id="6692703">,</span>&nbsp;<span class="ident" id="6692705">err</span>&nbsp;<span class="op" id="6692709">:=</span>&nbsp;<span class="ident" id="6692712">io</span><span class="op" id="6692714">.</span><span class="ident" id="6692715">Copy</span><span class="op" id="6692719">(</span><span class="ident" id="6692720">buf</span><span class="op" id="6692723">,</span>&nbsp;<span class="ident" id="6692725">part</span><span class="op" id="6692729">)</span><span class="op" id="6692730">;</span>&nbsp;<span class="ident" id="6692732">err</span>&nbsp;<span class="op" id="6692736">!=</span>&nbsp;<span class="ident" id="6692739">nil</span>&nbsp;<span class="op" id="6692743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6692747">t</span><span class="op" id="6692748">.</span><span class="ident" id="6692749">Errorf</span><span class="op" id="6692755">(</span><span class="string" id="6692756">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="6692773">,</span>&nbsp;<span class="ident" id="6692775">err</span><span class="op" id="6692778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6692781">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6692785">adjustNewlines</span>&nbsp;<span class="op" id="6692800">:=</span>&nbsp;<span class="keyword" id="6692803">func</span><span class="op" id="6692807">(</span><span class="ident" id="6692808">s</span>&nbsp;<span class="builtintype" id="6692810">string</span><span class="op" id="6692816">)</span>&nbsp;<span class="builtintype" id="6692818">string</span>&nbsp;<span class="op" id="6692825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6692829">if</span>&nbsp;<span class="ident" id="6692832">onlyNewlines</span>&nbsp;<span class="op" id="6692845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6692850">return</span>&nbsp;<span class="ident" id="6692857">strings</span><span class="op" id="6692864">.</span><span class="ident" id="6692865">Replace</span><span class="op" id="6692872">(</span><span class="ident" id="6692873">s</span><span class="op" id="6692874">,</span>&nbsp;<span class="string" id="6692876">&#34;\r\n&#34;</span><span class="op" id="6692882">,</span>&nbsp;<span class="string" id="6692884">&#34;\n&#34;</span><span class="op" id="6692888">,</span>&nbsp;<span class="op" id="6692890">-</span><span class="num" id="6692891">1</span><span class="op" id="6692892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6692896">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6692900">return</span>&nbsp;<span class="ident" id="6692907">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6692910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6692914">expectEq</span><span class="op" id="6692922">(</span><span class="ident" id="6692923">t</span><span class="op" id="6692924">,</span>&nbsp;<span class="ident" id="6692926">adjustNewlines</span><span class="op" id="6692940">(</span><span class="string" id="6692941">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="6692963">)</span><span class="op" id="6692964">,</span>&nbsp;<span class="ident" id="6692966">buf</span><span class="op" id="6692969">.</span><span class="ident" id="6692970">String</span><span class="op" id="6692976">(</span><span class="op" id="6692977">)</span><span class="op" id="6692978">,</span>&nbsp;<span class="string" id="6692980">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="6693001">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6693005">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693015">part</span><span class="op" id="6693019">,</span>&nbsp;<span class="ident" id="6693021">err</span>&nbsp;<span class="op" id="6693025">=</span>&nbsp;<span class="ident" id="6693027">reader</span><span class="op" id="6693033">.</span><span class="ident" id="6693034">NextPart</span><span class="op" id="6693042">(</span><span class="op" id="6693043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6693046">if</span>&nbsp;<span class="ident" id="6693049">err</span>&nbsp;<span class="op" id="6693053">!=</span>&nbsp;<span class="ident" id="6693056">nil</span>&nbsp;<span class="op" id="6693060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693064">t</span><span class="op" id="6693065">.</span><span class="ident" id="6693066">Fatalf</span><span class="op" id="6693072">(</span><span class="string" id="6693073">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="6693098">,</span>&nbsp;<span class="ident" id="6693100">err</span><span class="op" id="6693103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6693107">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6693115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6693118">if</span>&nbsp;<span class="ident" id="6693121">e</span><span class="op" id="6693122">,</span>&nbsp;<span class="ident" id="6693124">g</span>&nbsp;<span class="op" id="6693126">:=</span>&nbsp;<span class="string" id="6693129">&#34;bigsection&#34;</span><span class="op" id="6693141">,</span>&nbsp;<span class="ident" id="6693143">part</span><span class="op" id="6693147">.</span><span class="ident" id="6693148">Header</span><span class="op" id="6693154">.</span><span class="ident" id="6693155">Get</span><span class="op" id="6693158">(</span><span class="string" id="6693159">&#34;name&#34;</span><span class="op" id="6693165">)</span><span class="op" id="6693166">;</span>&nbsp;<span class="ident" id="6693168">e</span>&nbsp;<span class="op" id="6693170">!=</span>&nbsp;<span class="ident" id="6693173">g</span>&nbsp;<span class="op" id="6693175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693179">t</span><span class="op" id="6693180">.</span><span class="ident" id="6693181">Errorf</span><span class="op" id="6693187">(</span><span class="string" id="6693188">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6693230">,</span>&nbsp;<span class="ident" id="6693232">e</span><span class="op" id="6693233">,</span>&nbsp;<span class="ident" id="6693235">g</span><span class="op" id="6693236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6693239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693242">buf</span><span class="op" id="6693245">.</span><span class="ident" id="6693246">Reset</span><span class="op" id="6693251">(</span><span class="op" id="6693252">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6693255">if</span>&nbsp;<span class="ident" id="6693258">_</span><span class="op" id="6693259">,</span>&nbsp;<span class="ident" id="6693261">err</span>&nbsp;<span class="op" id="6693265">:=</span>&nbsp;<span class="ident" id="6693268">io</span><span class="op" id="6693270">.</span><span class="ident" id="6693271">Copy</span><span class="op" id="6693275">(</span><span class="ident" id="6693276">buf</span><span class="op" id="6693279">,</span>&nbsp;<span class="ident" id="6693281">part</span><span class="op" id="6693285">)</span><span class="op" id="6693286">;</span>&nbsp;<span class="ident" id="6693288">err</span>&nbsp;<span class="op" id="6693292">!=</span>&nbsp;<span class="ident" id="6693295">nil</span>&nbsp;<span class="op" id="6693299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693303">t</span><span class="op" id="6693304">.</span><span class="ident" id="6693305">Errorf</span><span class="op" id="6693311">(</span><span class="string" id="6693312">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="6693329">,</span>&nbsp;<span class="ident" id="6693331">err</span><span class="op" id="6693334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6693337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693340">s</span>&nbsp;<span class="op" id="6693342">:=</span>&nbsp;<span class="ident" id="6693345">buf</span><span class="op" id="6693348">.</span><span class="ident" id="6693349">String</span><span class="op" id="6693355">(</span><span class="op" id="6693356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6693359">if</span>&nbsp;<span class="builtinfunc" id="6693362">len</span><span class="op" id="6693365">(</span><span class="ident" id="6693366">s</span><span class="op" id="6693367">)</span>&nbsp;<span class="op" id="6693369">!=</span>&nbsp;<span class="builtinfunc" id="6693372">len</span><span class="op" id="6693375">(</span><span class="ident" id="6693376">longLine</span><span class="op" id="6693384">)</span>&nbsp;<span class="op" id="6693386">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693390">t</span><span class="op" id="6693391">.</span><span class="ident" id="6693392">Errorf</span><span class="op" id="6693398">(</span><span class="string" id="6693399">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="6693458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6693463">len</span><span class="op" id="6693466">(</span><span class="ident" id="6693467">longLine</span><span class="op" id="6693475">)</span><span class="op" id="6693476">,</span>&nbsp;<span class="builtinfunc" id="6693478">len</span><span class="op" id="6693481">(</span><span class="ident" id="6693482">s</span><span class="op" id="6693483">)</span><span class="op" id="6693484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6693487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6693490">if</span>&nbsp;<span class="ident" id="6693493">s</span>&nbsp;<span class="op" id="6693495">!=</span>&nbsp;<span class="ident" id="6693498">longLine</span>&nbsp;<span class="op" id="6693507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693511">t</span><span class="op" id="6693512">.</span><span class="ident" id="6693513">Errorf</span><span class="op" id="6693519">(</span><span class="string" id="6693520">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="6693550">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6693553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6693557">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693567">part</span><span class="op" id="6693571">,</span>&nbsp;<span class="ident" id="6693573">err</span>&nbsp;<span class="op" id="6693577">=</span>&nbsp;<span class="ident" id="6693579">reader</span><span class="op" id="6693585">.</span><span class="ident" id="6693586">NextPart</span><span class="op" id="6693594">(</span><span class="op" id="6693595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6693598">if</span>&nbsp;<span class="ident" id="6693601">part</span>&nbsp;<span class="op" id="6693606">==</span>&nbsp;<span class="ident" id="6693609">nil</span>&nbsp;<span class="op" id="6693613">||</span>&nbsp;<span class="ident" id="6693616">err</span>&nbsp;<span class="op" id="6693620">!=</span>&nbsp;<span class="ident" id="6693623">nil</span>&nbsp;<span class="op" id="6693627">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693631">t</span><span class="op" id="6693632">.</span><span class="ident" id="6693633">Error</span><span class="op" id="6693638">(</span><span class="string" id="6693639">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="6693655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6693659">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6693667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6693670">if</span>&nbsp;<span class="ident" id="6693673">part</span><span class="op" id="6693677">.</span><span class="ident" id="6693678">Header</span><span class="op" id="6693684">.</span><span class="ident" id="6693685">Get</span><span class="op" id="6693688">(</span><span class="string" id="6693689">&#34;foo-bar&#34;</span><span class="op" id="6693698">)</span>&nbsp;<span class="op" id="6693700">!=</span>&nbsp;<span class="string" id="6693703">&#34;bazb&#34;</span>&nbsp;<span class="op" id="6693710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693714">t</span><span class="op" id="6693715">.</span><span class="ident" id="6693716">Error</span><span class="op" id="6693721">(</span><span class="string" id="6693722">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="6693746">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6693749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693752">buf</span><span class="op" id="6693755">.</span><span class="ident" id="6693756">Reset</span><span class="op" id="6693761">(</span><span class="op" id="6693762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6693765">if</span>&nbsp;<span class="ident" id="6693768">_</span><span class="op" id="6693769">,</span>&nbsp;<span class="ident" id="6693771">err</span>&nbsp;<span class="op" id="6693775">:=</span>&nbsp;<span class="ident" id="6693778">io</span><span class="op" id="6693780">.</span><span class="ident" id="6693781">Copy</span><span class="op" id="6693785">(</span><span class="ident" id="6693786">buf</span><span class="op" id="6693789">,</span>&nbsp;<span class="ident" id="6693791">part</span><span class="op" id="6693795">)</span><span class="op" id="6693796">;</span>&nbsp;<span class="ident" id="6693798">err</span>&nbsp;<span class="op" id="6693802">!=</span>&nbsp;<span class="ident" id="6693805">nil</span>&nbsp;<span class="op" id="6693809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693813">t</span><span class="op" id="6693814">.</span><span class="ident" id="6693815">Errorf</span><span class="op" id="6693821">(</span><span class="string" id="6693822">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="6693839">,</span>&nbsp;<span class="ident" id="6693841">err</span><span class="op" id="6693844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6693847">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693850">expectEq</span><span class="op" id="6693858">(</span><span class="ident" id="6693859">t</span><span class="op" id="6693860">,</span>&nbsp;<span class="ident" id="6693862">adjustNewlines</span><span class="op" id="6693876">(</span><span class="string" id="6693877">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="6693942">)</span><span class="op" id="6693943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693947">buf</span><span class="op" id="6693950">.</span><span class="ident" id="6693951">String</span><span class="op" id="6693957">(</span><span class="op" id="6693958">)</span><span class="op" id="6693959">,</span>&nbsp;<span class="string" id="6693961">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="6693977">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6693981">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693991">part</span><span class="op" id="6693995">,</span>&nbsp;<span class="ident" id="6693997">err</span>&nbsp;<span class="op" id="6694001">=</span>&nbsp;<span class="ident" id="6694003">reader</span><span class="op" id="6694009">.</span><span class="ident" id="6694010">NextPart</span><span class="op" id="6694018">(</span><span class="op" id="6694019">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6694022">if</span>&nbsp;<span class="ident" id="6694025">part</span>&nbsp;<span class="op" id="6694030">==</span>&nbsp;<span class="ident" id="6694033">nil</span>&nbsp;<span class="op" id="6694037">||</span>&nbsp;<span class="ident" id="6694040">err</span>&nbsp;<span class="op" id="6694044">!=</span>&nbsp;<span class="ident" id="6694047">nil</span>&nbsp;<span class="op" id="6694051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694055">t</span><span class="op" id="6694056">.</span><span class="ident" id="6694057">Error</span><span class="op" id="6694062">(</span><span class="string" id="6694063">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="6694095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6694099">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6694111">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694134">part</span><span class="op" id="6694138">,</span>&nbsp;<span class="ident" id="6694140">err</span>&nbsp;<span class="op" id="6694144">=</span>&nbsp;<span class="ident" id="6694146">reader</span><span class="op" id="6694152">.</span><span class="ident" id="6694153">NextPart</span><span class="op" id="6694161">(</span><span class="op" id="6694162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6694165">if</span>&nbsp;<span class="ident" id="6694168">part</span>&nbsp;<span class="op" id="6694173">!=</span>&nbsp;<span class="ident" id="6694176">nil</span>&nbsp;<span class="op" id="6694180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694184">t</span><span class="op" id="6694185">.</span><span class="ident" id="6694186">Error</span><span class="op" id="6694191">(</span><span class="string" id="6694192">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="6694221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694224">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6694227">if</span>&nbsp;<span class="ident" id="6694230">err</span>&nbsp;<span class="op" id="6694234">!=</span>&nbsp;<span class="ident" id="6694237">io</span><span class="op" id="6694239">.</span><span class="ident" id="6694240">EOF</span>&nbsp;<span class="op" id="6694244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694248">t</span><span class="op" id="6694249">.</span><span class="ident" id="6694250">Errorf</span><span class="op" id="6694256">(</span><span class="string" id="6694257">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6694296">,</span>&nbsp;<span class="ident" id="6694298">err</span><span class="op" id="6694301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694304">}</span><br>
<span class="lineno"></span><span class="op" id="6694306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="6694309">func</span>&nbsp;<span class="ident" id="6694314">TestVariousTextLineEndings</span><span class="op" id="6694340">(</span><span class="ident" id="6694341">t</span>&nbsp;<span class="op" id="6694343">*</span><span class="ident" id="6694344">testing</span><span class="op" id="6694351">.</span><span class="ident" id="6694352">T</span><span class="op" id="6694353">)</span>&nbsp;<span class="op" id="6694355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694358">tests</span>&nbsp;<span class="op" id="6694364">:=</span>&nbsp;<span class="op" id="6694367">[</span><span class="op" id="6694368">...</span><span class="op" id="6694371">]</span><span class="builtintype" id="6694372">string</span><span class="op" id="6694378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694382">&#34;Foo\nBar&#34;</span><span class="op" id="6694392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694396">&#34;Foo\nBar\n&#34;</span><span class="op" id="6694408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694412">&#34;Foo\r\nBar&#34;</span><span class="op" id="6694424">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694428">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="6694444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694448">&#34;Foo\rBar&#34;</span><span class="op" id="6694458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694462">&#34;Foo\rBar\r&#34;</span><span class="op" id="6694474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694478">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="6694524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694527">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6694531">for</span>&nbsp;<span class="ident" id="6694535">testNum</span><span class="op" id="6694542">,</span>&nbsp;<span class="ident" id="6694544">expectedBody</span>&nbsp;<span class="op" id="6694557">:=</span>&nbsp;<span class="keyword" id="6694560">range</span>&nbsp;<span class="ident" id="6694566">tests</span>&nbsp;<span class="op" id="6694572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694576">body</span>&nbsp;<span class="op" id="6694581">:=</span>&nbsp;<span class="string" id="6694584">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="6694601">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694606">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="6694659">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694664">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="6694671">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694676">expectedBody</span>&nbsp;<span class="op" id="6694689">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694694">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694719">bodyReader</span>&nbsp;<span class="op" id="6694730">:=</span>&nbsp;<span class="ident" id="6694733">strings</span><span class="op" id="6694740">.</span><span class="ident" id="6694741">NewReader</span><span class="op" id="6694750">(</span><span class="ident" id="6694751">body</span><span class="op" id="6694755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694760">reader</span>&nbsp;<span class="op" id="6694767">:=</span>&nbsp;<span class="ident" id="6694770">NewReader</span><span class="op" id="6694779">(</span><span class="ident" id="6694780">bodyReader</span><span class="op" id="6694790">,</span>&nbsp;<span class="string" id="6694792">&#34;BOUNDARY&#34;</span><span class="op" id="6694802">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694806">buf</span>&nbsp;<span class="op" id="6694810">:=</span>&nbsp;<span class="builtinfunc" id="6694813">new</span><span class="op" id="6694816">(</span><span class="ident" id="6694817">bytes</span><span class="op" id="6694822">.</span><span class="ident" id="6694823">Buffer</span><span class="op" id="6694829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694833">part</span><span class="op" id="6694837">,</span>&nbsp;<span class="ident" id="6694839">err</span>&nbsp;<span class="op" id="6694843">:=</span>&nbsp;<span class="ident" id="6694846">reader</span><span class="op" id="6694852">.</span><span class="ident" id="6694853">NextPart</span><span class="op" id="6694861">(</span><span class="op" id="6694862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6694866">if</span>&nbsp;<span class="ident" id="6694869">part</span>&nbsp;<span class="op" id="6694874">==</span>&nbsp;<span class="ident" id="6694877">nil</span>&nbsp;<span class="op" id="6694881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694886">t</span><span class="op" id="6694887">.</span><span class="ident" id="6694888">Errorf</span><span class="op" id="6694894">(</span><span class="string" id="6694895">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="6694928">,</span>&nbsp;<span class="ident" id="6694930">testNum</span><span class="op" id="6694937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6694942">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6694957">if</span>&nbsp;<span class="ident" id="6694960">err</span>&nbsp;<span class="op" id="6694964">!=</span>&nbsp;<span class="ident" id="6694967">nil</span>&nbsp;<span class="op" id="6694971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694976">t</span><span class="op" id="6694977">.</span><span class="ident" id="6694978">Errorf</span><span class="op" id="6694984">(</span><span class="string" id="6694985">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="6695018">,</span>&nbsp;<span class="ident" id="6695020">testNum</span><span class="op" id="6695027">,</span>&nbsp;<span class="ident" id="6695029">err</span><span class="op" id="6695032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6695037">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695048">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695052">written</span><span class="op" id="6695059">,</span>&nbsp;<span class="ident" id="6695061">err</span>&nbsp;<span class="op" id="6695065">:=</span>&nbsp;<span class="ident" id="6695068">io</span><span class="op" id="6695070">.</span><span class="ident" id="6695071">Copy</span><span class="op" id="6695075">(</span><span class="ident" id="6695076">buf</span><span class="op" id="6695079">,</span>&nbsp;<span class="ident" id="6695081">part</span><span class="op" id="6695085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695089">expectEq</span><span class="op" id="6695097">(</span><span class="ident" id="6695098">t</span><span class="op" id="6695099">,</span>&nbsp;<span class="ident" id="6695101">expectedBody</span><span class="op" id="6695113">,</span>&nbsp;<span class="ident" id="6695115">buf</span><span class="op" id="6695118">.</span><span class="ident" id="6695119">String</span><span class="op" id="6695125">(</span><span class="op" id="6695126">)</span><span class="op" id="6695127">,</span>&nbsp;<span class="ident" id="6695129">fmt</span><span class="op" id="6695132">.</span><span class="ident" id="6695133">Sprintf</span><span class="op" id="6695140">(</span><span class="string" id="6695141">&#34;test&nbsp;%d&#34;</span><span class="op" id="6695150">,</span>&nbsp;<span class="ident" id="6695152">testNum</span><span class="op" id="6695159">)</span><span class="op" id="6695160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6695164">if</span>&nbsp;<span class="ident" id="6695167">err</span>&nbsp;<span class="op" id="6695171">!=</span>&nbsp;<span class="ident" id="6695174">nil</span>&nbsp;<span class="op" id="6695178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695183">t</span><span class="op" id="6695184">.</span><span class="ident" id="6695185">Errorf</span><span class="op" id="6695191">(</span><span class="string" id="6695192">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="6695237">,</span>&nbsp;<span class="ident" id="6695239">written</span><span class="op" id="6695246">,</span>&nbsp;<span class="ident" id="6695248">err</span><span class="op" id="6695251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695255">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695260">part</span><span class="op" id="6695264">,</span>&nbsp;<span class="ident" id="6695266">err</span>&nbsp;<span class="op" id="6695270">=</span>&nbsp;<span class="ident" id="6695272">reader</span><span class="op" id="6695278">.</span><span class="ident" id="6695279">NextPart</span><span class="op" id="6695287">(</span><span class="op" id="6695288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6695292">if</span>&nbsp;<span class="ident" id="6695295">part</span>&nbsp;<span class="op" id="6695300">!=</span>&nbsp;<span class="ident" id="6695303">nil</span>&nbsp;<span class="op" id="6695307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695312">t</span><span class="op" id="6695313">.</span><span class="ident" id="6695314">Errorf</span><span class="op" id="6695320">(</span><span class="string" id="6695321">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="6695349">,</span>&nbsp;<span class="ident" id="6695351">testNum</span><span class="op" id="6695358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695362">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6695366">if</span>&nbsp;<span class="ident" id="6695369">err</span>&nbsp;<span class="op" id="6695373">!=</span>&nbsp;<span class="ident" id="6695376">io</span><span class="op" id="6695378">.</span><span class="ident" id="6695379">EOF</span>&nbsp;<span class="op" id="6695383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695388">t</span><span class="op" id="6695389">.</span><span class="ident" id="6695390">Errorf</span><span class="op" id="6695396">(</span><span class="string" id="6695397">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6695433">,</span>&nbsp;<span class="ident" id="6695435">testNum</span><span class="op" id="6695442">,</span>&nbsp;<span class="ident" id="6695444">err</span><span class="op" id="6695447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695455">}</span><br>
<span class="lineno">260</span><span class="op" id="6695457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6695460">type</span>&nbsp;<span class="ident" id="6695465">maliciousReader</span>&nbsp;<span class="keyword" id="6695481">struct</span>&nbsp;<span class="op" id="6695488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695491">t</span>&nbsp;<span class="op" id="6695493">*</span><span class="ident" id="6695494">testing</span><span class="op" id="6695501">.</span><span class="ident" id="6695502">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695505">n</span>&nbsp;<span class="builtintype" id="6695507">int</span><br>
<span class="lineno">265</span><span class="op" id="6695511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6695514">const</span>&nbsp;<span class="ident" id="6695520">maxReadThreshold</span>&nbsp;<span class="op" id="6695537">=</span>&nbsp;<span class="num" id="6695539">1</span>&nbsp;<span class="op" id="6695541">&lt;&lt;</span>&nbsp;<span class="num" id="6695544">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6695548">func</span>&nbsp;<span class="op" id="6695553">(</span><span class="ident" id="6695554">mr</span>&nbsp;<span class="op" id="6695557">*</span><span class="ident" id="6695558">maliciousReader</span><span class="op" id="6695573">)</span>&nbsp;<span class="ident" id="6695575">Read</span><span class="op" id="6695579">(</span><span class="ident" id="6695580">b</span>&nbsp;<span class="op" id="6695582">[</span><span class="op" id="6695583">]</span><span class="builtintype" id="6695584">byte</span><span class="op" id="6695588">)</span>&nbsp;<span class="op" id="6695590">(</span><span class="ident" id="6695591">n</span>&nbsp;<span class="builtintype" id="6695593">int</span><span class="op" id="6695596">,</span>&nbsp;<span class="ident" id="6695598">err</span>&nbsp;<span class="builtintype" id="6695602">error</span><span class="op" id="6695607">)</span>&nbsp;<span class="op" id="6695609">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695612">mr</span><span class="op" id="6695614">.</span><span class="ident" id="6695615">n</span>&nbsp;<span class="op" id="6695617">+=</span>&nbsp;<span class="builtinfunc" id="6695620">len</span><span class="op" id="6695623">(</span><span class="ident" id="6695624">b</span><span class="op" id="6695625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6695628">if</span>&nbsp;<span class="ident" id="6695631">mr</span><span class="op" id="6695633">.</span><span class="ident" id="6695634">n</span>&nbsp;<span class="op" id="6695636">&gt;=</span>&nbsp;<span class="ident" id="6695639">maxReadThreshold</span>&nbsp;<span class="op" id="6695656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695660">mr</span><span class="op" id="6695662">.</span><span class="ident" id="6695663">t</span><span class="op" id="6695664">.</span><span class="ident" id="6695665">Fatal</span><span class="op" id="6695670">(</span><span class="string" id="6695671">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="6695690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6695694">return</span>&nbsp;<span class="num" id="6695701">0</span><span class="op" id="6695702">,</span>&nbsp;<span class="ident" id="6695704">io</span><span class="op" id="6695706">.</span><span class="ident" id="6695707">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695712">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6695715">return</span>&nbsp;<span class="builtinfunc" id="6695722">len</span><span class="op" id="6695725">(</span><span class="ident" id="6695726">b</span><span class="op" id="6695727">)</span><span class="op" id="6695728">,</span>&nbsp;<span class="ident" id="6695730">nil</span><br>
<span class="lineno"></span><span class="op" id="6695734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6695737">func</span>&nbsp;<span class="ident" id="6695742">TestLineLimit</span><span class="op" id="6695755">(</span><span class="ident" id="6695756">t</span>&nbsp;<span class="op" id="6695758">*</span><span class="ident" id="6695759">testing</span><span class="op" id="6695766">.</span><span class="ident" id="6695767">T</span><span class="op" id="6695768">)</span>&nbsp;<span class="op" id="6695770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695773">mr</span>&nbsp;<span class="op" id="6695776">:=</span>&nbsp;<span class="op" id="6695779">&amp;</span><span class="ident" id="6695780">maliciousReader</span><span class="op" id="6695795">{</span><span class="ident" id="6695796">t</span><span class="op" id="6695797">:</span>&nbsp;<span class="ident" id="6695799">t</span><span class="op" id="6695800">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695803">r</span>&nbsp;<span class="op" id="6695805">:=</span>&nbsp;<span class="ident" id="6695808">NewReader</span><span class="op" id="6695817">(</span><span class="ident" id="6695818">mr</span><span class="op" id="6695820">,</span>&nbsp;<span class="string" id="6695822">&#34;fooBoundary&#34;</span><span class="op" id="6695835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695838">part</span><span class="op" id="6695842">,</span>&nbsp;<span class="ident" id="6695844">err</span>&nbsp;<span class="op" id="6695848">:=</span>&nbsp;<span class="ident" id="6695851">r</span><span class="op" id="6695852">.</span><span class="ident" id="6695853">NextPart</span><span class="op" id="6695861">(</span><span class="op" id="6695862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6695865">if</span>&nbsp;<span class="ident" id="6695868">part</span>&nbsp;<span class="op" id="6695873">!=</span>&nbsp;<span class="ident" id="6695876">nil</span>&nbsp;<span class="op" id="6695880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695884">t</span><span class="op" id="6695885">.</span><span class="ident" id="6695886">Errorf</span><span class="op" id="6695892">(</span><span class="string" id="6695893">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="6695915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695918">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6695921">if</span>&nbsp;<span class="ident" id="6695924">err</span>&nbsp;<span class="op" id="6695928">==</span>&nbsp;<span class="ident" id="6695931">nil</span>&nbsp;<span class="op" id="6695935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695939">t</span><span class="op" id="6695940">.</span><span class="ident" id="6695941">Errorf</span><span class="op" id="6695947">(</span><span class="string" id="6695948">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="6695967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6695973">if</span>&nbsp;<span class="ident" id="6695976">mr</span><span class="op" id="6695978">.</span><span class="ident" id="6695979">n</span>&nbsp;<span class="op" id="6695981">&gt;=</span>&nbsp;<span class="ident" id="6695984">maxReadThreshold</span>&nbsp;<span class="op" id="6696001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696005">t</span><span class="op" id="6696006">.</span><span class="ident" id="6696007">Errorf</span><span class="op" id="6696013">(</span><span class="string" id="6696014">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6696052">,</span>&nbsp;<span class="ident" id="6696054">maxReadThreshold</span><span class="op" id="6696070">,</span>&nbsp;<span class="ident" id="6696072">mr</span><span class="op" id="6696074">.</span><span class="ident" id="6696075">n</span><span class="op" id="6696076">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696079">}</span><br>
<span class="lineno"></span><span class="op" id="6696081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6696084">func</span>&nbsp;<span class="ident" id="6696089">TestMultipartTruncated</span><span class="op" id="6696111">(</span><span class="ident" id="6696112">t</span>&nbsp;<span class="op" id="6696114">*</span><span class="ident" id="6696115">testing</span><span class="op" id="6696122">.</span><span class="ident" id="6696123">T</span><span class="op" id="6696124">)</span>&nbsp;<span class="op" id="6696126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696129">testBody</span>&nbsp;<span class="op" id="6696138">:=</span>&nbsp;<span class="string" id="6696141">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696248">body</span>&nbsp;<span class="op" id="6696253">:=</span>&nbsp;<span class="ident" id="6696256">strings</span><span class="op" id="6696263">.</span><span class="ident" id="6696264">Replace</span><span class="op" id="6696271">(</span><span class="ident" id="6696272">testBody</span><span class="op" id="6696280">,</span>&nbsp;<span class="string" id="6696282">&#34;\n&#34;</span><span class="op" id="6696286">,</span>&nbsp;<span class="string" id="6696288">&#34;\r\n&#34;</span><span class="op" id="6696294">,</span>&nbsp;<span class="op" id="6696296">-</span><span class="num" id="6696297">1</span><span class="op" id="6696298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696301">bodyReader</span>&nbsp;<span class="op" id="6696312">:=</span>&nbsp;<span class="ident" id="6696315">strings</span><span class="op" id="6696322">.</span><span class="ident" id="6696323">NewReader</span><span class="op" id="6696332">(</span><span class="ident" id="6696333">body</span><span class="op" id="6696337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696340">r</span>&nbsp;<span class="op" id="6696342">:=</span>&nbsp;<span class="ident" id="6696345">NewReader</span><span class="op" id="6696354">(</span><span class="ident" id="6696355">bodyReader</span><span class="op" id="6696365">,</span>&nbsp;<span class="string" id="6696367">&#34;MyBoundary&#34;</span><span class="op" id="6696379">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696383">part</span><span class="op" id="6696387">,</span>&nbsp;<span class="ident" id="6696389">err</span>&nbsp;<span class="op" id="6696393">:=</span>&nbsp;<span class="ident" id="6696396">r</span><span class="op" id="6696397">.</span><span class="ident" id="6696398">NextPart</span><span class="op" id="6696406">(</span><span class="op" id="6696407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696410">if</span>&nbsp;<span class="ident" id="6696413">err</span>&nbsp;<span class="op" id="6696417">!=</span>&nbsp;<span class="ident" id="6696420">nil</span>&nbsp;<span class="op" id="6696424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696428">t</span><span class="op" id="6696429">.</span><span class="ident" id="6696430">Fatalf</span><span class="op" id="6696436">(</span><span class="string" id="6696437">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="6696456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696462">_</span><span class="op" id="6696463">,</span>&nbsp;<span class="ident" id="6696465">err</span>&nbsp;<span class="op" id="6696469">=</span>&nbsp;<span class="ident" id="6696471">io</span><span class="op" id="6696473">.</span><span class="ident" id="6696474">Copy</span><span class="op" id="6696478">(</span><span class="ident" id="6696479">ioutil</span><span class="op" id="6696485">.</span><span class="ident" id="6696486">Discard</span><span class="op" id="6696493">,</span>&nbsp;<span class="ident" id="6696495">part</span><span class="op" id="6696499">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696502">if</span>&nbsp;<span class="ident" id="6696505">err</span>&nbsp;<span class="op" id="6696509">!=</span>&nbsp;<span class="ident" id="6696512">io</span><span class="op" id="6696514">.</span><span class="ident" id="6696515">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6696532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696536">t</span><span class="op" id="6696537">.</span><span class="ident" id="6696538">Fatalf</span><span class="op" id="6696544">(</span><span class="string" id="6696545">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6696589">,</span>&nbsp;<span class="ident" id="6696591">err</span><span class="op" id="6696594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696597">}</span><br>
<span class="lineno"></span><span class="op" id="6696599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="6696602">type</span>&nbsp;<span class="ident" id="6696607">slowReader</span>&nbsp;<span class="keyword" id="6696618">struct</span>&nbsp;<span class="op" id="6696625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696628">r</span>&nbsp;<span class="ident" id="6696630">io</span><span class="op" id="6696632">.</span><span class="ident" id="6696633">Reader</span><br>
<span class="lineno"></span><span class="op" id="6696640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6696643">func</span>&nbsp;<span class="op" id="6696648">(</span><span class="ident" id="6696649">s</span>&nbsp;<span class="op" id="6696651">*</span><span class="ident" id="6696652">slowReader</span><span class="op" id="6696662">)</span>&nbsp;<span class="ident" id="6696664">Read</span><span class="op" id="6696668">(</span><span class="ident" id="6696669">p</span>&nbsp;<span class="op" id="6696671">[</span><span class="op" id="6696672">]</span><span class="builtintype" id="6696673">byte</span><span class="op" id="6696677">)</span>&nbsp;<span class="op" id="6696679">(</span><span class="builtintype" id="6696680">int</span><span class="op" id="6696683">,</span>&nbsp;<span class="builtintype" id="6696685">error</span><span class="op" id="6696690">)</span>&nbsp;<span class="op" id="6696692">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696695">if</span>&nbsp;<span class="builtinfunc" id="6696698">len</span><span class="op" id="6696701">(</span><span class="ident" id="6696702">p</span><span class="op" id="6696703">)</span>&nbsp;<span class="op" id="6696705">==</span>&nbsp;<span class="num" id="6696708">0</span>&nbsp;<span class="op" id="6696710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696714">return</span>&nbsp;<span class="ident" id="6696721">s</span><span class="op" id="6696722">.</span><span class="ident" id="6696723">r</span><span class="op" id="6696724">.</span><span class="ident" id="6696725">Read</span><span class="op" id="6696729">(</span><span class="ident" id="6696730">p</span><span class="op" id="6696731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696737">return</span>&nbsp;<span class="ident" id="6696744">s</span><span class="op" id="6696745">.</span><span class="ident" id="6696746">r</span><span class="op" id="6696747">.</span><span class="ident" id="6696748">Read</span><span class="op" id="6696752">(</span><span class="ident" id="6696753">p</span><span class="op" id="6696754">[</span><span class="op" id="6696755">:</span><span class="num" id="6696756">1</span><span class="op" id="6696757">]</span><span class="op" id="6696758">)</span><br>
<span class="lineno"></span><span class="op" id="6696760">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="6696763">func</span>&nbsp;<span class="ident" id="6696768">TestLineContinuation</span><span class="op" id="6696788">(</span><span class="ident" id="6696789">t</span>&nbsp;<span class="op" id="6696791">*</span><span class="ident" id="6696792">testing</span><span class="op" id="6696799">.</span><span class="ident" id="6696800">T</span><span class="op" id="6696801">)</span>&nbsp;<span class="op" id="6696803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6696806">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6696882">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6696894">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6696961">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697022">testBody</span>&nbsp;<span class="op" id="6697031">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6697036">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697532">r</span>&nbsp;<span class="op" id="6697534">:=</span>&nbsp;<span class="ident" id="6697537">NewReader</span><span class="op" id="6697546">(</span><span class="ident" id="6697547">strings</span><span class="op" id="6697554">.</span><span class="ident" id="6697555">NewReader</span><span class="op" id="6697564">(</span><span class="ident" id="6697565">testBody</span><span class="op" id="6697573">)</span><span class="op" id="6697574">,</span>&nbsp;<span class="string" id="6697576">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="6697600">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697604">for</span>&nbsp;<span class="ident" id="6697608">i</span>&nbsp;<span class="op" id="6697610">:=</span>&nbsp;<span class="num" id="6697613">0</span><span class="op" id="6697614">;</span>&nbsp;<span class="ident" id="6697616">i</span>&nbsp;<span class="op" id="6697618">&lt;</span>&nbsp;<span class="num" id="6697620">2</span><span class="op" id="6697621">;</span>&nbsp;<span class="ident" id="6697623">i</span><span class="op" id="6697624">++</span>&nbsp;<span class="op" id="6697627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697631">part</span><span class="op" id="6697635">,</span>&nbsp;<span class="ident" id="6697637">err</span>&nbsp;<span class="op" id="6697641">:=</span>&nbsp;<span class="ident" id="6697644">r</span><span class="op" id="6697645">.</span><span class="ident" id="6697646">NextPart</span><span class="op" id="6697654">(</span><span class="op" id="6697655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697659">if</span>&nbsp;<span class="ident" id="6697662">err</span>&nbsp;<span class="op" id="6697666">!=</span>&nbsp;<span class="ident" id="6697669">nil</span>&nbsp;<span class="op" id="6697673">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697678">t</span><span class="op" id="6697679">.</span><span class="ident" id="6697680">Fatalf</span><span class="op" id="6697686">(</span><span class="string" id="6697687">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="6697706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697714">var</span>&nbsp;<span class="ident" id="6697718">buf</span>&nbsp;<span class="ident" id="6697722">bytes</span><span class="op" id="6697727">.</span><span class="ident" id="6697728">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697737">n</span><span class="op" id="6697738">,</span>&nbsp;<span class="ident" id="6697740">err</span>&nbsp;<span class="op" id="6697744">:=</span>&nbsp;<span class="ident" id="6697747">io</span><span class="op" id="6697749">.</span><span class="ident" id="6697750">Copy</span><span class="op" id="6697754">(</span><span class="op" id="6697755">&amp;</span><span class="ident" id="6697756">buf</span><span class="op" id="6697759">,</span>&nbsp;<span class="ident" id="6697761">part</span><span class="op" id="6697765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697769">if</span>&nbsp;<span class="ident" id="6697772">err</span>&nbsp;<span class="op" id="6697776">!=</span>&nbsp;<span class="ident" id="6697779">nil</span>&nbsp;<span class="op" id="6697783">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697788">t</span><span class="op" id="6697789">.</span><span class="ident" id="6697790">Errorf</span><span class="op" id="6697796">(</span><span class="string" id="6697797">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="6697838">,</span>&nbsp;<span class="ident" id="6697840">err</span><span class="op" id="6697843">,</span>&nbsp;<span class="ident" id="6697845">buf</span><span class="op" id="6697848">.</span><span class="ident" id="6697849">String</span><span class="op" id="6697855">(</span><span class="op" id="6697856">)</span><span class="op" id="6697857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697865">if</span>&nbsp;<span class="ident" id="6697868">n</span>&nbsp;<span class="op" id="6697870">&lt;=</span>&nbsp;<span class="num" id="6697873">0</span>&nbsp;<span class="op" id="6697875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697880">t</span><span class="op" id="6697881">.</span><span class="ident" id="6697882">Errorf</span><span class="op" id="6697888">(</span><span class="string" id="6697889">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="6697917">,</span>&nbsp;<span class="ident" id="6697919">n</span><span class="op" id="6697920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697924">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697927">}</span><br>
<span class="lineno"></span><span class="op" id="6697929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6697932">func</span>&nbsp;<span class="ident" id="6697937">TestQuotedPrintableEncoding</span><span class="op" id="6697964">(</span><span class="ident" id="6697965">t</span>&nbsp;<span class="op" id="6697967">*</span><span class="ident" id="6697968">testing</span><span class="op" id="6697975">.</span><span class="ident" id="6697976">T</span><span class="op" id="6697977">)</span>&nbsp;<span class="op" id="6697979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6697982">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698020">body</span>&nbsp;<span class="op" id="6698025">:=</span>&nbsp;<span class="string" id="6698028">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698762">r</span>&nbsp;<span class="op" id="6698764">:=</span>&nbsp;<span class="ident" id="6698767">NewReader</span><span class="op" id="6698776">(</span><span class="ident" id="6698777">strings</span><span class="op" id="6698784">.</span><span class="ident" id="6698785">NewReader</span><span class="op" id="6698794">(</span><span class="ident" id="6698795">body</span><span class="op" id="6698799">)</span><span class="op" id="6698800">,</span>&nbsp;<span class="string" id="6698802">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="6698832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698835">part</span><span class="op" id="6698839">,</span>&nbsp;<span class="ident" id="6698841">err</span>&nbsp;<span class="op" id="6698845">:=</span>&nbsp;<span class="ident" id="6698848">r</span><span class="op" id="6698849">.</span><span class="ident" id="6698850">NextPart</span><span class="op" id="6698858">(</span><span class="op" id="6698859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698862">if</span>&nbsp;<span class="ident" id="6698865">err</span>&nbsp;<span class="op" id="6698869">!=</span>&nbsp;<span class="ident" id="6698872">nil</span>&nbsp;<span class="op" id="6698876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698880">t</span><span class="op" id="6698881">.</span><span class="ident" id="6698882">Fatal</span><span class="op" id="6698887">(</span><span class="ident" id="6698888">err</span><span class="op" id="6698891">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6698894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698897">if</span>&nbsp;<span class="ident" id="6698900">te</span><span class="op" id="6698902">,</span>&nbsp;<span class="ident" id="6698904">ok</span>&nbsp;<span class="op" id="6698907">:=</span>&nbsp;<span class="ident" id="6698910">part</span><span class="op" id="6698914">.</span><span class="ident" id="6698915">Header</span><span class="op" id="6698921">[</span><span class="string" id="6698922">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="6698949">]</span><span class="op" id="6698950">;</span>&nbsp;<span class="ident" id="6698952">ok</span>&nbsp;<span class="op" id="6698955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698959">t</span><span class="op" id="6698960">.</span><span class="ident" id="6698961">Errorf</span><span class="op" id="6698967">(</span><span class="string" id="6698968">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="6699012">,</span>&nbsp;<span class="ident" id="6699014">te</span><span class="op" id="6699016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699022">var</span>&nbsp;<span class="ident" id="6699026">buf</span>&nbsp;<span class="ident" id="6699030">bytes</span><span class="op" id="6699035">.</span><span class="ident" id="6699036">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699044">_</span><span class="op" id="6699045">,</span>&nbsp;<span class="ident" id="6699047">err</span>&nbsp;<span class="op" id="6699051">=</span>&nbsp;<span class="ident" id="6699053">io</span><span class="op" id="6699055">.</span><span class="ident" id="6699056">Copy</span><span class="op" id="6699060">(</span><span class="op" id="6699061">&amp;</span><span class="ident" id="6699062">buf</span><span class="op" id="6699065">,</span>&nbsp;<span class="ident" id="6699067">part</span><span class="op" id="6699071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699074">if</span>&nbsp;<span class="ident" id="6699077">err</span>&nbsp;<span class="op" id="6699081">!=</span>&nbsp;<span class="ident" id="6699084">nil</span>&nbsp;<span class="op" id="6699088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699092">t</span><span class="op" id="6699093">.</span><span class="ident" id="6699094">Error</span><span class="op" id="6699099">(</span><span class="ident" id="6699100">err</span><span class="op" id="6699103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699109">got</span>&nbsp;<span class="op" id="6699113">:=</span>&nbsp;<span class="ident" id="6699116">buf</span><span class="op" id="6699119">.</span><span class="ident" id="6699120">String</span><span class="op" id="6699126">(</span><span class="op" id="6699127">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699130">want</span>&nbsp;<span class="op" id="6699135">:=</span>&nbsp;<span class="string" id="6699138">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699495">if</span>&nbsp;<span class="ident" id="6699498">got</span>&nbsp;<span class="op" id="6699502">!=</span>&nbsp;<span class="ident" id="6699505">want</span>&nbsp;<span class="op" id="6699510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699514">t</span><span class="op" id="6699515">.</span><span class="ident" id="6699516">Errorf</span><span class="op" id="6699522">(</span><span class="string" id="6699523">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="6699562">,</span>&nbsp;<span class="ident" id="6699564">got</span><span class="op" id="6699567">,</span>&nbsp;<span class="ident" id="6699569">want</span><span class="op" id="6699573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699576">}</span><br>
<span class="lineno"></span><span class="op" id="6699578">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6699581">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="6699654">func</span>&nbsp;<span class="ident" id="6699659">TestNested</span><span class="op" id="6699669">(</span><span class="ident" id="6699670">t</span>&nbsp;<span class="op" id="6699672">*</span><span class="ident" id="6699673">testing</span><span class="op" id="6699680">.</span><span class="ident" id="6699681">T</span><span class="op" id="6699682">)</span>&nbsp;<span class="op" id="6699684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6699687">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6699747">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699794">f</span><span class="op" id="6699795">,</span>&nbsp;<span class="ident" id="6699797">err</span>&nbsp;<span class="op" id="6699801">:=</span>&nbsp;<span class="ident" id="6699804">os</span><span class="op" id="6699806">.</span><span class="ident" id="6699807">Open</span><span class="op" id="6699811">(</span><span class="string" id="6699812">&#34;testdata/nested-mime&#34;</span><span class="op" id="6699834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699837">if</span>&nbsp;<span class="ident" id="6699840">err</span>&nbsp;<span class="op" id="6699844">!=</span>&nbsp;<span class="ident" id="6699847">nil</span>&nbsp;<span class="op" id="6699851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699855">t</span><span class="op" id="6699856">.</span><span class="ident" id="6699857">Fatal</span><span class="op" id="6699862">(</span><span class="ident" id="6699863">err</span><span class="op" id="6699866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699872">defer</span>&nbsp;<span class="ident" id="6699878">f</span><span class="op" id="6699879">.</span><span class="ident" id="6699880">Close</span><span class="op" id="6699885">(</span><span class="op" id="6699886">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699889">mr</span>&nbsp;<span class="op" id="6699892">:=</span>&nbsp;<span class="ident" id="6699895">NewReader</span><span class="op" id="6699904">(</span><span class="ident" id="6699905">f</span><span class="op" id="6699906">,</span>&nbsp;<span class="string" id="6699908">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="6699938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699941">p</span><span class="op" id="6699942">,</span>&nbsp;<span class="ident" id="6699944">err</span>&nbsp;<span class="op" id="6699948">:=</span>&nbsp;<span class="ident" id="6699951">mr</span><span class="op" id="6699953">.</span><span class="ident" id="6699954">NextPart</span><span class="op" id="6699962">(</span><span class="op" id="6699963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699966">if</span>&nbsp;<span class="ident" id="6699969">err</span>&nbsp;<span class="op" id="6699973">!=</span>&nbsp;<span class="ident" id="6699976">nil</span>&nbsp;<span class="op" id="6699980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699984">t</span><span class="op" id="6699985">.</span><span class="ident" id="6699986">Fatalf</span><span class="op" id="6699992">(</span><span class="string" id="6699993">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="6700040">,</span>&nbsp;<span class="ident" id="6700042">err</span><span class="op" id="6700045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700048">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6700052">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700135">mr2</span>&nbsp;<span class="op" id="6700139">:=</span>&nbsp;<span class="ident" id="6700142">NewReader</span><span class="op" id="6700151">(</span><span class="ident" id="6700152">p</span><span class="op" id="6700153">,</span>&nbsp;<span class="string" id="6700155">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="6700185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700188">p</span><span class="op" id="6700189">,</span>&nbsp;<span class="ident" id="6700191">err</span>&nbsp;<span class="op" id="6700195">=</span>&nbsp;<span class="ident" id="6700197">mr2</span><span class="op" id="6700200">.</span><span class="ident" id="6700201">NextPart</span><span class="op" id="6700209">(</span><span class="op" id="6700210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700213">if</span>&nbsp;<span class="ident" id="6700216">err</span>&nbsp;<span class="op" id="6700220">!=</span>&nbsp;<span class="ident" id="6700223">nil</span>&nbsp;<span class="op" id="6700227">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700231">t</span><span class="op" id="6700232">.</span><span class="ident" id="6700233">Fatalf</span><span class="op" id="6700239">(</span><span class="string" id="6700240">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="6700269">,</span>&nbsp;<span class="ident" id="6700271">err</span><span class="op" id="6700274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700280">if</span>&nbsp;<span class="ident" id="6700283">b</span><span class="op" id="6700284">,</span>&nbsp;<span class="ident" id="6700286">err</span>&nbsp;<span class="op" id="6700290">:=</span>&nbsp;<span class="ident" id="6700293">ioutil</span><span class="op" id="6700299">.</span><span class="ident" id="6700300">ReadAll</span><span class="op" id="6700307">(</span><span class="ident" id="6700308">p</span><span class="op" id="6700309">)</span><span class="op" id="6700310">;</span>&nbsp;<span class="builtintype" id="6700312">string</span><span class="op" id="6700318">(</span><span class="ident" id="6700319">b</span><span class="op" id="6700320">)</span>&nbsp;<span class="op" id="6700322">!=</span>&nbsp;<span class="string" id="6700325">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="6700338">||</span>&nbsp;<span class="ident" id="6700341">err</span>&nbsp;<span class="op" id="6700345">!=</span>&nbsp;<span class="ident" id="6700348">nil</span>&nbsp;<span class="op" id="6700352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700356">t</span><span class="op" id="6700357">.</span><span class="ident" id="6700358">Fatalf</span><span class="op" id="6700364">(</span><span class="string" id="6700365">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="6700402">,</span>&nbsp;<span class="ident" id="6700404">b</span><span class="op" id="6700405">,</span>&nbsp;<span class="ident" id="6700407">err</span><span class="op" id="6700410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700413">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700416">p</span><span class="op" id="6700417">,</span>&nbsp;<span class="ident" id="6700419">err</span>&nbsp;<span class="op" id="6700423">=</span>&nbsp;<span class="ident" id="6700425">mr2</span><span class="op" id="6700428">.</span><span class="ident" id="6700429">NextPart</span><span class="op" id="6700437">(</span><span class="op" id="6700438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700441">if</span>&nbsp;<span class="ident" id="6700444">err</span>&nbsp;<span class="op" id="6700448">!=</span>&nbsp;<span class="ident" id="6700451">nil</span>&nbsp;<span class="op" id="6700455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700459">t</span><span class="op" id="6700460">.</span><span class="ident" id="6700461">Fatalf</span><span class="op" id="6700467">(</span><span class="string" id="6700468">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="6700496">,</span>&nbsp;<span class="ident" id="6700498">err</span><span class="op" id="6700501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700507">if</span>&nbsp;<span class="ident" id="6700510">b</span><span class="op" id="6700511">,</span>&nbsp;<span class="ident" id="6700513">err</span>&nbsp;<span class="op" id="6700517">:=</span>&nbsp;<span class="ident" id="6700520">ioutil</span><span class="op" id="6700526">.</span><span class="ident" id="6700527">ReadAll</span><span class="op" id="6700534">(</span><span class="ident" id="6700535">p</span><span class="op" id="6700536">)</span><span class="op" id="6700537">;</span>&nbsp;<span class="builtintype" id="6700539">string</span><span class="op" id="6700545">(</span><span class="ident" id="6700546">b</span><span class="op" id="6700547">)</span>&nbsp;<span class="op" id="6700549">!=</span>&nbsp;<span class="string" id="6700552">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="6700570">||</span>&nbsp;<span class="ident" id="6700573">err</span>&nbsp;<span class="op" id="6700577">!=</span>&nbsp;<span class="ident" id="6700580">nil</span>&nbsp;<span class="op" id="6700584">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700588">t</span><span class="op" id="6700589">.</span><span class="ident" id="6700590">Fatalf</span><span class="op" id="6700596">(</span><span class="string" id="6700597">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="6700633">,</span>&nbsp;<span class="ident" id="6700635">b</span><span class="op" id="6700636">,</span>&nbsp;<span class="ident" id="6700638">err</span><span class="op" id="6700641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700648">p</span><span class="op" id="6700649">,</span>&nbsp;<span class="ident" id="6700651">err</span>&nbsp;<span class="op" id="6700655">=</span>&nbsp;<span class="ident" id="6700657">mr2</span><span class="op" id="6700660">.</span><span class="ident" id="6700661">NextPart</span><span class="op" id="6700669">(</span><span class="op" id="6700670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700673">if</span>&nbsp;<span class="ident" id="6700676">err</span>&nbsp;<span class="op" id="6700680">!=</span>&nbsp;<span class="ident" id="6700683">io</span><span class="op" id="6700685">.</span><span class="ident" id="6700686">EOF</span>&nbsp;<span class="op" id="6700690">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700694">t</span><span class="op" id="6700695">.</span><span class="ident" id="6700696">Fatalf</span><span class="op" id="6700702">(</span><span class="string" id="6700703">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="6700743">,</span>&nbsp;<span class="ident" id="6700745">err</span><span class="op" id="6700748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6700755">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700824">_</span><span class="op" id="6700825">,</span>&nbsp;<span class="ident" id="6700827">err</span>&nbsp;<span class="op" id="6700831">=</span>&nbsp;<span class="ident" id="6700833">mr</span><span class="op" id="6700835">.</span><span class="ident" id="6700836">NextPart</span><span class="op" id="6700844">(</span><span class="op" id="6700845">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700848">if</span>&nbsp;<span class="ident" id="6700851">err</span>&nbsp;<span class="op" id="6700855">!=</span>&nbsp;<span class="ident" id="6700858">nil</span>&nbsp;<span class="op" id="6700862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700866">t</span><span class="op" id="6700867">.</span><span class="ident" id="6700868">Fatalf</span><span class="op" id="6700874">(</span><span class="string" id="6700875">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="6700926">,</span>&nbsp;<span class="ident" id="6700928">err</span><span class="op" id="6700931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700938">_</span><span class="op" id="6700939">,</span>&nbsp;<span class="ident" id="6700941">err</span>&nbsp;<span class="op" id="6700945">=</span>&nbsp;<span class="ident" id="6700947">mr</span><span class="op" id="6700949">.</span><span class="ident" id="6700950">NextPart</span><span class="op" id="6700958">(</span><span class="op" id="6700959">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700962">if</span>&nbsp;<span class="ident" id="6700965">err</span>&nbsp;<span class="op" id="6700969">!=</span>&nbsp;<span class="ident" id="6700972">io</span><span class="op" id="6700974">.</span><span class="ident" id="6700975">EOF</span>&nbsp;<span class="op" id="6700979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700983">t</span><span class="op" id="6700984">.</span><span class="ident" id="6700985">Fatalf</span><span class="op" id="6700991">(</span><span class="string" id="6700992">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="6701032">,</span>&nbsp;<span class="ident" id="6701034">err</span><span class="op" id="6701037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6701040">}</span><br>
<span class="lineno"></span><span class="op" id="6701042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="6701045">type</span>&nbsp;<span class="ident" id="6701050">headerBody</span>&nbsp;<span class="keyword" id="6701061">struct</span>&nbsp;<span class="op" id="6701068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701071">header</span>&nbsp;<span class="ident" id="6701078">textproto</span><span class="op" id="6701087">.</span><span class="ident" id="6701088">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701100">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6701107">string</span><br>
<span class="lineno"></span><span class="op" id="6701114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="6701117">func</span>&nbsp;<span class="ident" id="6701122">formData</span><span class="op" id="6701130">(</span><span class="ident" id="6701131">key</span><span class="op" id="6701134">,</span>&nbsp;<span class="ident" id="6701136">value</span>&nbsp;<span class="builtintype" id="6701142">string</span><span class="op" id="6701148">)</span>&nbsp;<span class="ident" id="6701150">headerBody</span>&nbsp;<span class="op" id="6701161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6701164">return</span>&nbsp;<span class="ident" id="6701171">headerBody</span><span class="op" id="6701181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701185">textproto</span><span class="op" id="6701194">.</span><span class="ident" id="6701195">MIMEHeader</span><span class="op" id="6701205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6701210">&#34;Content-Type&#34;</span><span class="op" id="6701224">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6701233">{</span><span class="string" id="6701234">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="6701266">}</span><span class="op" id="6701267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6701272">&#34;Content-Disposition&#34;</span><span class="op" id="6701293">:</span>&nbsp;<span class="op" id="6701295">{</span><span class="string" id="6701296">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="6701315">+</span>&nbsp;<span class="ident" id="6701317">key</span><span class="op" id="6701320">}</span><span class="op" id="6701321">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6701325">}</span><span class="op" id="6701326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701330">value</span><span class="op" id="6701335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6701338">}</span><br>
<span class="lineno"></span><span class="op" id="6701340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="6701343">type</span>&nbsp;<span class="ident" id="6701348">parseTest</span>&nbsp;<span class="keyword" id="6701358">struct</span>&nbsp;<span class="op" id="6701365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701368">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6701376">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701384">in</span><span class="op" id="6701386">,</span>&nbsp;<span class="ident" id="6701388">sep</span>&nbsp;<span class="builtintype" id="6701392">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701400">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6701408">[</span><span class="op" id="6701409">]</span><span class="ident" id="6701410">headerBody</span><br>
<span class="lineno"></span><span class="op" id="6701421">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="6701424">var</span>&nbsp;<span class="ident" id="6701428">parseTests</span>&nbsp;<span class="op" id="6701439">=</span>&nbsp;<span class="op" id="6701441">[</span><span class="op" id="6701442">]</span><span class="ident" id="6701443">parseTest</span><span class="op" id="6701452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6701455">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6701525">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6701594">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6701660">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6701723">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6701789">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6701852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701856">name</span><span class="op" id="6701860">:</span>&nbsp;<span class="string" id="6701862">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="6701879">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701883">sep</span><span class="op" id="6701886">:</span>&nbsp;&nbsp;<span class="string" id="6701889">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="6701919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701923">in</span><span class="op" id="6701925">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6701929">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="6703837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6703841">want</span><span class="op" id="6703845">:</span>&nbsp;<span class="op" id="6703847">[</span><span class="op" id="6703848">]</span><span class="ident" id="6703849">headerBody</span><span class="op" id="6703859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6703864">formData</span><span class="op" id="6703872">(</span><span class="string" id="6703873">&#34;otherEmpty1&#34;</span><span class="op" id="6703886">,</span>&nbsp;<span class="string" id="6703888">&#34;&#34;</span><span class="op" id="6703890">)</span><span class="op" id="6703891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6703896">formData</span><span class="op" id="6703904">(</span><span class="string" id="6703905">&#34;otherFoo1&#34;</span><span class="op" id="6703916">,</span>&nbsp;<span class="string" id="6703918">&#34;foo&#34;</span><span class="op" id="6703923">)</span><span class="op" id="6703924">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6703929">formData</span><span class="op" id="6703937">(</span><span class="string" id="6703938">&#34;otherFoo2&#34;</span><span class="op" id="6703949">,</span>&nbsp;<span class="string" id="6703951">&#34;foo&#34;</span><span class="op" id="6703956">)</span><span class="op" id="6703957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6703962">formData</span><span class="op" id="6703970">(</span><span class="string" id="6703971">&#34;otherEmpty2&#34;</span><span class="op" id="6703984">,</span>&nbsp;<span class="string" id="6703986">&#34;&#34;</span><span class="op" id="6703988">)</span><span class="op" id="6703989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6703994">formData</span><span class="op" id="6704002">(</span><span class="string" id="6704003">&#34;otherRepeatFoo&#34;</span><span class="op" id="6704019">,</span>&nbsp;<span class="string" id="6704021">&#34;foo&#34;</span><span class="op" id="6704026">)</span><span class="op" id="6704027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6704032">formData</span><span class="op" id="6704040">(</span><span class="string" id="6704041">&#34;otherRepeatFoo&#34;</span><span class="op" id="6704057">,</span>&nbsp;<span class="string" id="6704059">&#34;foo&#34;</span><span class="op" id="6704064">)</span><span class="op" id="6704065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6704070">formData</span><span class="op" id="6704078">(</span><span class="string" id="6704079">&#34;otherRepeatEmpty&#34;</span><span class="op" id="6704097">,</span>&nbsp;<span class="string" id="6704099">&#34;&#34;</span><span class="op" id="6704101">)</span><span class="op" id="6704102">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6704107">formData</span><span class="op" id="6704115">(</span><span class="string" id="6704116">&#34;otherRepeatEmpty&#34;</span><span class="op" id="6704134">,</span>&nbsp;<span class="string" id="6704136">&#34;&#34;</span><span class="op" id="6704138">)</span><span class="op" id="6704139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6704144">formData</span><span class="op" id="6704152">(</span><span class="string" id="6704153">&#34;submit&#34;</span><span class="op" id="6704161">,</span>&nbsp;<span class="string" id="6704163">&#34;Submit&#34;</span><span class="op" id="6704171">)</span><span class="op" id="6704172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6704177">{</span><span class="ident" id="6704178">textproto</span><span class="op" id="6704187">.</span><span class="ident" id="6704188">MIMEHeader</span><span class="op" id="6704198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6704204">&#34;Content-Type&#34;</span><span class="op" id="6704218">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6704227">{</span><span class="string" id="6704228">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="6704444">}</span><span class="op" id="6704445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6704451">&#34;Content-Disposition&#34;</span><span class="op" id="6704472">:</span>&nbsp;<span class="op" id="6704474">{</span><span class="string" id="6704475">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="6704520">}</span><span class="op" id="6704521">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6704526">}</span><span class="op" id="6704527">,</span>&nbsp;<span class="string" id="6704529">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="6704776">}</span><span class="op" id="6704777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6704781">}</span><span class="op" id="6704782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6704785">}</span><span class="op" id="6704786">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6704790">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6704862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6704866">name</span><span class="op" id="6704870">:</span>&nbsp;<span class="string" id="6704872">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="6704903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6704907">sep</span><span class="op" id="6704910">:</span>&nbsp;&nbsp;<span class="string" id="6704913">&#34;abc&#34;</span><span class="op" id="6704918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6704922">in</span><span class="op" id="6704924">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6704928">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="6704962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6704966">want</span><span class="op" id="6704970">:</span>&nbsp;<span class="op" id="6704972">[</span><span class="op" id="6704973">]</span><span class="ident" id="6704974">headerBody</span><span class="op" id="6704984">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6704989">{</span><span class="ident" id="6704990">textproto</span><span class="op" id="6704999">.</span><span class="ident" id="6705000">MIMEHeader</span><span class="op" id="6705010">{</span><span class="string" id="6705011">&#34;Foo&#34;</span><span class="op" id="6705016">:</span>&nbsp;<span class="op" id="6705018">{</span><span class="string" id="6705019">&#34;bar&#34;</span><span class="op" id="6705024">}</span><span class="op" id="6705025">}</span><span class="op" id="6705026">,</span>&nbsp;<span class="string" id="6705028">&#34;&#34;</span><span class="op" id="6705030">}</span><span class="op" id="6705031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705035">}</span><span class="op" id="6705036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705039">}</span><span class="op" id="6705040">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6705044">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705124">name</span><span class="op" id="6705128">:</span>&nbsp;<span class="string" id="6705130">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="6705165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705169">sep</span><span class="op" id="6705172">:</span>&nbsp;&nbsp;<span class="string" id="6705175">&#34;abc&#34;</span><span class="op" id="6705180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705184">in</span><span class="op" id="6705186">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6705190">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="6705228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705232">want</span><span class="op" id="6705236">:</span>&nbsp;<span class="op" id="6705238">[</span><span class="op" id="6705239">]</span><span class="ident" id="6705240">headerBody</span><span class="op" id="6705250">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705255">{</span><span class="ident" id="6705256">textproto</span><span class="op" id="6705265">.</span><span class="ident" id="6705266">MIMEHeader</span><span class="op" id="6705276">{</span><span class="string" id="6705277">&#34;Foo&#34;</span><span class="op" id="6705282">:</span>&nbsp;<span class="op" id="6705284">{</span><span class="string" id="6705285">&#34;bar&#34;</span><span class="op" id="6705290">}</span><span class="op" id="6705291">}</span><span class="op" id="6705292">,</span>&nbsp;<span class="string" id="6705294">&#34;&#34;</span><span class="op" id="6705296">}</span><span class="op" id="6705297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705301">}</span><span class="op" id="6705302">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705305">}</span><span class="op" id="6705306">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6705310">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705336">name</span><span class="op" id="6705340">:</span>&nbsp;<span class="string" id="6705342">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="6705360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705364">sep</span><span class="op" id="6705367">:</span>&nbsp;&nbsp;<span class="string" id="6705370">&#34;abc&#34;</span><span class="op" id="6705375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705379">in</span><span class="op" id="6705381">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6705385">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="6705446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705450">want</span><span class="op" id="6705454">:</span>&nbsp;<span class="op" id="6705456">[</span><span class="op" id="6705457">]</span><span class="ident" id="6705458">headerBody</span><span class="op" id="6705468">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705473">{</span><span class="ident" id="6705474">textproto</span><span class="op" id="6705483">.</span><span class="ident" id="6705484">MIMEHeader</span><span class="op" id="6705494">{</span><span class="string" id="6705495">&#34;Foo&#34;</span><span class="op" id="6705500">:</span>&nbsp;<span class="op" id="6705502">{</span><span class="string" id="6705503">&#34;bar&#34;</span><span class="op" id="6705508">}</span><span class="op" id="6705509">}</span><span class="op" id="6705510">,</span>&nbsp;<span class="string" id="6705512">&#34;&#34;</span><span class="op" id="6705514">}</span><span class="op" id="6705515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705520">{</span><span class="ident" id="6705521">textproto</span><span class="op" id="6705530">.</span><span class="ident" id="6705531">MIMEHeader</span><span class="op" id="6705541">{</span><span class="string" id="6705542">&#34;Foo2&#34;</span><span class="op" id="6705548">:</span>&nbsp;<span class="op" id="6705550">{</span><span class="string" id="6705551">&#34;bar2&#34;</span><span class="op" id="6705557">}</span><span class="op" id="6705558">}</span><span class="op" id="6705559">,</span>&nbsp;<span class="string" id="6705561">&#34;&#34;</span><span class="op" id="6705563">}</span><span class="op" id="6705564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705568">}</span><span class="op" id="6705569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705572">}</span><span class="op" id="6705573">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6705577">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705639">name</span><span class="op" id="6705643">:</span>&nbsp;<span class="string" id="6705645">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="6705673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705677">sep</span><span class="op" id="6705680">:</span>&nbsp;&nbsp;<span class="string" id="6705683">&#34;abc&#34;</span><span class="op" id="6705688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705692">in</span><span class="op" id="6705694">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6705698">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="6705736">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705740">want</span><span class="op" id="6705744">:</span>&nbsp;<span class="op" id="6705746">[</span><span class="op" id="6705747">]</span><span class="ident" id="6705748">headerBody</span><span class="op" id="6705758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705763">{</span><span class="ident" id="6705764">textproto</span><span class="op" id="6705773">.</span><span class="ident" id="6705774">MIMEHeader</span><span class="op" id="6705784">{</span><span class="string" id="6705785">&#34;Foo&#34;</span><span class="op" id="6705790">:</span>&nbsp;<span class="op" id="6705792">{</span><span class="string" id="6705793">&#34;bar&#34;</span><span class="op" id="6705798">}</span><span class="op" id="6705799">}</span><span class="op" id="6705800">,</span>&nbsp;<span class="string" id="6705802">&#34;&#34;</span><span class="op" id="6705804">}</span><span class="op" id="6705805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705809">}</span><span class="op" id="6705810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705813">}</span><span class="op" id="6705814">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6705818">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6705878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705882">name</span><span class="op" id="6705886">:</span>&nbsp;<span class="string" id="6705888">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="6705916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705920">sep</span><span class="op" id="6705923">:</span>&nbsp;&nbsp;<span class="string" id="6705926">&#34;abc&#34;</span><span class="op" id="6705931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705935">in</span><span class="op" id="6705937">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6705941">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="6705978">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6705982">want</span><span class="op" id="6705986">:</span>&nbsp;<span class="op" id="6705988">[</span><span class="op" id="6705989">]</span><span class="ident" id="6705990">headerBody</span><span class="op" id="6706000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706005">{</span><span class="ident" id="6706006">textproto</span><span class="op" id="6706015">.</span><span class="ident" id="6706016">MIMEHeader</span><span class="op" id="6706026">{</span><span class="string" id="6706027">&#34;Foo&#34;</span><span class="op" id="6706032">:</span>&nbsp;<span class="op" id="6706034">{</span><span class="string" id="6706035">&#34;bar&#34;</span><span class="op" id="6706040">}</span><span class="op" id="6706041">}</span><span class="op" id="6706042">,</span>&nbsp;<span class="string" id="6706044">&#34;&#34;</span><span class="op" id="6706046">}</span><span class="op" id="6706047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706051">}</span><span class="op" id="6706052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706055">}</span><span class="op" id="6706056">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6706060">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706113">name</span><span class="op" id="6706117">:</span>&nbsp;<span class="string" id="6706119">&#34;no&nbsp;parts&#34;</span><span class="op" id="6706129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706133">sep</span><span class="op" id="6706136">:</span>&nbsp;&nbsp;<span class="string" id="6706139">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="6706179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706183">in</span><span class="op" id="6706185">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6706189">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="6706237">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706241">want</span><span class="op" id="6706245">:</span>&nbsp;<span class="op" id="6706247">[</span><span class="op" id="6706248">]</span><span class="ident" id="6706249">headerBody</span><span class="op" id="6706259">{</span><span class="op" id="6706260">}</span><span class="op" id="6706261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706264">}</span><span class="op" id="6706265">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6706269">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706350">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706354">name</span><span class="op" id="6706358">:</span>&nbsp;<span class="string" id="6706360">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="6706384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706388">sep</span><span class="op" id="6706391">:</span>&nbsp;&nbsp;<span class="string" id="6706394">&#34;sep&#34;</span><span class="op" id="6706399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706403">in</span><span class="op" id="6706405">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6706409">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="6706456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706460">want</span><span class="op" id="6706464">:</span>&nbsp;<span class="op" id="6706466">[</span><span class="op" id="6706467">]</span><span class="ident" id="6706468">headerBody</span><span class="op" id="6706478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706483">{</span><span class="ident" id="6706484">textproto</span><span class="op" id="6706493">.</span><span class="ident" id="6706494">MIMEHeader</span><span class="op" id="6706504">{</span><span class="string" id="6706505">&#34;Foo&#34;</span><span class="op" id="6706510">:</span>&nbsp;<span class="op" id="6706512">{</span><span class="string" id="6706513">&#34;bar&#34;</span><span class="op" id="6706518">}</span><span class="op" id="6706519">}</span><span class="op" id="6706520">,</span>&nbsp;<span class="string" id="6706522">&#34;--sepFAKE&#34;</span><span class="op" id="6706533">}</span><span class="op" id="6706534">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706538">}</span><span class="op" id="6706539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706542">}</span><span class="op" id="6706543">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6706547">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706608">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706612">name</span><span class="op" id="6706616">:</span>&nbsp;<span class="string" id="6706618">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="6706644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706648">sep</span><span class="op" id="6706651">:</span>&nbsp;&nbsp;<span class="string" id="6706654">&#34;sep&#34;</span><span class="op" id="6706659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706663">in</span><span class="op" id="6706665">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6706669">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="6706712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706716">want</span><span class="op" id="6706720">:</span>&nbsp;<span class="op" id="6706722">[</span><span class="op" id="6706723">]</span><span class="ident" id="6706724">headerBody</span><span class="op" id="6706734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706739">{</span><span class="ident" id="6706740">textproto</span><span class="op" id="6706749">.</span><span class="ident" id="6706750">MIMEHeader</span><span class="op" id="6706760">{</span><span class="string" id="6706761">&#34;Foo&#34;</span><span class="op" id="6706766">:</span>&nbsp;<span class="op" id="6706768">{</span><span class="string" id="6706769">&#34;bar&#34;</span><span class="op" id="6706774">}</span><span class="op" id="6706775">}</span><span class="op" id="6706776">,</span>&nbsp;<span class="string" id="6706778">&#34;text&#34;</span><span class="op" id="6706784">}</span><span class="op" id="6706785">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706789">}</span><span class="op" id="6706790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706793">}</span><span class="op" id="6706794">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6706798">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6706829">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706833">name</span><span class="op" id="6706837">:</span>&nbsp;<span class="string" id="6706839">&#34;leading&nbsp;line&#34;</span><span class="op" id="6706853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706857">sep</span><span class="op" id="6706860">:</span>&nbsp;&nbsp;<span class="string" id="6706863">&#34;MyBoundary&#34;</span><span class="op" id="6706875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6706879">in</span><span class="op" id="6706881">:</span>&nbsp;<span class="ident" id="6706883">strings</span><span class="op" id="6706890">.</span><span class="ident" id="6706891">Replace</span><span class="op" id="6706898">(</span><span class="string" id="6706899">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="6706992">,</span>&nbsp;<span class="string" id="6706994">&#34;\n&#34;</span><span class="op" id="6706998">,</span>&nbsp;<span class="string" id="6707000">&#34;\r\n&#34;</span><span class="op" id="6707006">,</span>&nbsp;<span class="op" id="6707008">-</span><span class="num" id="6707009">1</span><span class="op" id="6707010">)</span><span class="op" id="6707011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6707015">want</span><span class="op" id="6707019">:</span>&nbsp;<span class="op" id="6707021">[</span><span class="op" id="6707022">]</span><span class="ident" id="6707023">headerBody</span><span class="op" id="6707033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6707038">{</span><span class="ident" id="6707039">textproto</span><span class="op" id="6707048">.</span><span class="ident" id="6707049">MIMEHeader</span><span class="op" id="6707059">{</span><span class="string" id="6707060">&#34;Foo&#34;</span><span class="op" id="6707065">:</span>&nbsp;<span class="op" id="6707067">{</span><span class="string" id="6707068">&#34;bar&#34;</span><span class="op" id="6707073">}</span><span class="op" id="6707074">}</span><span class="op" id="6707075">,</span>&nbsp;<span class="string" id="6707077">&#34;&#34;</span><span class="op" id="6707079">}</span><span class="op" id="6707080">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6707084">}</span><span class="op" id="6707085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6707088">}</span><span class="op" id="6707089">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6707093">roundTripParseTest</span><span class="op" id="6707111">(</span><span class="op" id="6707112">)</span><span class="op" id="6707113">,</span><br>
<span class="lineno"></span><span class="op" id="6707115">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="6707118">func</span>&nbsp;<span class="ident" id="6707123">TestParse</span><span class="op" id="6707132">(</span><span class="ident" id="6707133">t</span>&nbsp;<span class="op" id="6707135">*</span><span class="ident" id="6707136">testing</span><span class="op" id="6707143">.</span><span class="ident" id="6707144">T</span><span class="op" id="6707145">)</span>&nbsp;<span class="op" id="6707147">{</span><br>
<span class="lineno"></span><span class="ident" id="6707149">Cases</span><span class="op" id="6707154">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6707157">for</span>&nbsp;<span class="ident" id="6707161">_</span><span class="op" id="6707162">,</span>&nbsp;<span class="ident" id="6707164">tt</span>&nbsp;<span class="op" id="6707167">:=</span>&nbsp;<span class="keyword" id="6707170">range</span>&nbsp;<span class="ident" id="6707176">parseTests</span>&nbsp;<span class="op" id="6707187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6707191">r</span>&nbsp;<span class="op" id="6707193">:=</span>&nbsp;<span class="ident" id="6707196">NewReader</span><span class="op" id="6707205">(</span><span class="ident" id="6707206">strings</span><span class="op" id="6707213">.</span><span class="ident" id="6707214">NewReader</span><span class="op" id="6707223">(</span><span class="ident" id="6707224">tt</span><span class="op" id="6707226">.</span><span class="ident" id="6707227">in</span><span class="op" id="6707229">)</span><span class="op" id="6707230">,</span>&nbsp;<span class="ident" id="6707232">tt</span><span class="op" id="6707234">.</span><span class="ident" id="6707235">sep</span><span class="op" id="6707238">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6707242">got</span>&nbsp;<span class="op" id="6707246">:=</span>&nbsp;<span class="op" id="6707249">[</span><span class="op" id="6707250">]</span><span class="ident" id="6707251">headerBody</span><span class="op" id="6707261">{</span><span class="op" id="6707262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6707266">for</span>&nbsp;<span class="op" id="6707270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6707275">p</span><span class="op" id="6707276">,</span>&nbsp;<span class="ident" id="6707278">err</span>&nbsp;<span class="op" id="6707282">:=</span>&nbsp;<span class="ident" id="6707285">r</span><span class="op" id="6707286">.</span><span class="ident" id="6707287">NextPart</span><span class="op" id="6707295">(</span><span class="op" id="6707296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6707301">if</span>&nbsp;<span class="ident" id="6707304">err</span>&nbsp;<span class="op" id="6707308">==</span>&nbsp;<span class="ident" id="6707311">io</span><span class="op" id="6707313">.</span><span class="ident" id="6707314">EOF</span>&nbsp;<span class="op" id="6707318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6707324">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6707333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6707338">if</span>&nbsp;<span class="ident" id="6707341">err</span>&nbsp;<span class="op" id="6707345">!=</span>&nbsp;<span class="ident" id="6707348">nil</span>&nbsp;<span class="op" id="6707352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6707358">t</span><span class="op" id="6707359">.</span><span class="ident" id="6707360">Errorf</span><span class="op" id="6707366">(</span><span class="string" id="6707367">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="6707393">,</span>&nbsp;<span class="ident" id="6707395">tt</span><span class="op" id="6707397">.</span><span class="ident" id="6707398">name</span><span class="op" id="6707402">,</span>&nbsp;<span class="ident" id="6707404">err</span><span class="op" id="6707407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6707413">continue</span>&nbsp;<span class="ident" id="6707422">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6707431">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6707436">pbody</span><span class="op" id="6707441">,</span>&nbsp;<span class="ident" id="6707443">err</span>&nbsp;<span class="op" id="6707447">:=</span>&nbsp;<span class="ident" id="6707450">ioutil</span><span class="op" id="6707456">.</span><span class="ident" id="6707457">ReadAll</span><span class="op" id="6707464">(</span><span class="ident" id="6707465">p</span><span class="op" id="6707466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6707471">if</span>&nbsp;<span class="ident" id="6707474">err</span>&nbsp;<span class="op" id="6707478">!=</span>&nbsp;<span class="ident" id="6707481">nil</span>&nbsp;<span class="op" id="6707485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6707491">t</span><span class="op" id="6707492">.</span><span class="ident" id="6707493">Errorf</span><span class="op" id="6707499">(</span><span class="string" id="6707500">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="6707536">,</span>&nbsp;<span class="ident" id="6707538">tt</span><span class="op" id="6707540">.</span><span class="ident" id="6707541">name</span><span class="op" id="6707545">,</span>&nbsp;<span class="ident" id="6707547">err</span><span class="op" id="6707550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6707556">continue</span>&nbsp;<span class="ident" id="6707565">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6707574">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6707579">got</span>&nbsp;<span class="op" id="6707583">=</span>&nbsp;<span class="builtinfunc" id="6707585">append</span><span class="op" id="6707591">(</span><span class="ident" id="6707592">got</span><span class="op" id="6707595">,</span>&nbsp;<span class="ident" id="6707597">headerBody</span><span class="op" id="6707607">{</span><span class="ident" id="6707608">p</span><span class="op" id="6707609">.</span><span class="ident" id="6707610">Header</span><span class="op" id="6707616">,</span>&nbsp;<span class="builtintype" id="6707618">string</span><span class="op" id="6707624">(</span><span class="ident" id="6707625">pbody</span><span class="op" id="6707630">)</span><span class="op" id="6707631">}</span><span class="op" id="6707632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6707636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6707640">if</span>&nbsp;<span class="op" id="6707643">!</span><span class="ident" id="6707644">reflect</span><span class="op" id="6707651">.</span><span class="ident" id="6707652">DeepEqual</span><span class="op" id="6707661">(</span><span class="ident" id="6707662">tt</span><span class="op" id="6707664">.</span><span class="ident" id="6707665">want</span><span class="op" id="6707669">,</span>&nbsp;<span class="ident" id="6707671">got</span><span class="op" id="6707674">)</span>&nbsp;<span class="op" id="6707676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6707681">t</span><span class="op" id="6707682">.</span><span class="ident" id="6707683">Errorf</span><span class="op" id="6707689">(</span><span class="string" id="6707690">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="6707720">,</span>&nbsp;<span class="ident" id="6707722">tt</span><span class="op" id="6707724">.</span><span class="ident" id="6707725">name</span><span class="op" id="6707729">,</span>&nbsp;<span class="ident" id="6707731">got</span><span class="op" id="6707734">,</span>&nbsp;<span class="ident" id="6707736">tt</span><span class="op" id="6707738">.</span><span class="ident" id="6707739">want</span><span class="op" id="6707743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6707748">if</span>&nbsp;<span class="builtinfunc" id="6707751">len</span><span class="op" id="6707754">(</span><span class="ident" id="6707755">tt</span><span class="op" id="6707757">.</span><span class="ident" id="6707758">want</span><span class="op" id="6707762">)</span>&nbsp;<span class="op" id="6707764">!=</span>&nbsp;<span class="builtinfunc" id="6707767">len</span><span class="op" id="6707770">(</span><span class="ident" id="6707771">got</span><span class="op" id="6707774">)</span>&nbsp;<span class="op" id="6707776">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6707782">t</span><span class="op" id="6707783">.</span><span class="ident" id="6707784">Errorf</span><span class="op" id="6707790">(</span><span class="string" id="6707791">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6707823">,</span>&nbsp;<span class="ident" id="6707825">tt</span><span class="op" id="6707827">.</span><span class="ident" id="6707828">name</span><span class="op" id="6707832">,</span>&nbsp;<span class="builtinfunc" id="6707834">len</span><span class="op" id="6707837">(</span><span class="ident" id="6707838">got</span><span class="op" id="6707841">)</span><span class="op" id="6707842">,</span>&nbsp;<span class="builtinfunc" id="6707844">len</span><span class="op" id="6707847">(</span><span class="ident" id="6707848">tt</span><span class="op" id="6707850">.</span><span class="ident" id="6707851">want</span><span class="op" id="6707855">)</span><span class="op" id="6707856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6707861">}</span>&nbsp;<span class="keyword" id="6707863">else</span>&nbsp;<span class="keyword" id="6707868">if</span>&nbsp;<span class="builtinfunc" id="6707871">len</span><span class="op" id="6707874">(</span><span class="ident" id="6707875">got</span><span class="op" id="6707878">)</span>&nbsp;<span class="op" id="6707880">&gt;</span>&nbsp;<span class="num" id="6707882">1</span>&nbsp;<span class="op" id="6707884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6707890">for</span>&nbsp;<span class="ident" id="6707894">pi</span><span class="op" id="6707896">,</span>&nbsp;<span class="ident" id="6707898">wantPart</span>&nbsp;<span class="op" id="6707907">:=</span>&nbsp;<span class="keyword" id="6707910">range</span>&nbsp;<span class="ident" id="6707916">tt</span><span class="op" id="6707918">.</span><span class="ident" id="6707919">want</span>&nbsp;<span class="op" id="6707924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6707931">if</span>&nbsp;<span class="op" id="6707934">!</span><span class="ident" id="6707935">reflect</span><span class="op" id="6707942">.</span><span class="ident" id="6707943">DeepEqual</span><span class="op" id="6707952">(</span><span class="ident" id="6707953">wantPart</span><span class="op" id="6707961">,</span>&nbsp;<span class="ident" id="6707963">got</span><span class="op" id="6707966">[</span><span class="ident" id="6707967">pi</span><span class="op" id="6707969">]</span><span class="op" id="6707970">)</span>&nbsp;<span class="op" id="6707972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6707980">t</span><span class="op" id="6707981">.</span><span class="ident" id="6707982">Errorf</span><span class="op" id="6707988">(</span><span class="string" id="6707989">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="6708028">,</span>&nbsp;<span class="ident" id="6708030">tt</span><span class="op" id="6708032">.</span><span class="ident" id="6708033">name</span><span class="op" id="6708037">,</span>&nbsp;<span class="ident" id="6708039">pi</span><span class="op" id="6708041">,</span>&nbsp;<span class="ident" id="6708043">got</span><span class="op" id="6708046">[</span><span class="ident" id="6708047">pi</span><span class="op" id="6708049">]</span><span class="op" id="6708050">,</span>&nbsp;<span class="ident" id="6708052">wantPart</span><span class="op" id="6708060">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708085">}</span><br>
<span class="lineno">605</span><span class="op" id="6708087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6708090">func</span>&nbsp;<span class="ident" id="6708095">roundTripParseTest</span><span class="op" id="6708113">(</span><span class="op" id="6708114">)</span>&nbsp;<span class="ident" id="6708116">parseTest</span>&nbsp;<span class="op" id="6708126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708129">t</span>&nbsp;<span class="op" id="6708131">:=</span>&nbsp;<span class="ident" id="6708134">parseTest</span><span class="op" id="6708143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708147">name</span><span class="op" id="6708151">:</span>&nbsp;<span class="string" id="6708153">&#34;round&nbsp;trip&#34;</span><span class="op" id="6708165">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708169">want</span><span class="op" id="6708173">:</span>&nbsp;<span class="op" id="6708175">[</span><span class="op" id="6708176">]</span><span class="ident" id="6708177">headerBody</span><span class="op" id="6708187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708192">formData</span><span class="op" id="6708200">(</span><span class="string" id="6708201">&#34;empty&#34;</span><span class="op" id="6708208">,</span>&nbsp;<span class="string" id="6708210">&#34;&#34;</span><span class="op" id="6708212">)</span><span class="op" id="6708213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708218">formData</span><span class="op" id="6708226">(</span><span class="string" id="6708227">&#34;lf&#34;</span><span class="op" id="6708231">,</span>&nbsp;<span class="string" id="6708233">&#34;\n&#34;</span><span class="op" id="6708237">)</span><span class="op" id="6708238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708243">formData</span><span class="op" id="6708251">(</span><span class="string" id="6708252">&#34;cr&#34;</span><span class="op" id="6708256">,</span>&nbsp;<span class="string" id="6708258">&#34;\r&#34;</span><span class="op" id="6708262">)</span><span class="op" id="6708263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708268">formData</span><span class="op" id="6708276">(</span><span class="string" id="6708277">&#34;crlf&#34;</span><span class="op" id="6708283">,</span>&nbsp;<span class="string" id="6708285">&#34;\r\n&#34;</span><span class="op" id="6708291">)</span><span class="op" id="6708292">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708297">formData</span><span class="op" id="6708305">(</span><span class="string" id="6708306">&#34;foo&#34;</span><span class="op" id="6708311">,</span>&nbsp;<span class="string" id="6708313">&#34;bar&#34;</span><span class="op" id="6708318">)</span><span class="op" id="6708319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708323">}</span><span class="op" id="6708324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6708330">var</span>&nbsp;<span class="ident" id="6708334">buf</span>&nbsp;<span class="ident" id="6708338">bytes</span><span class="op" id="6708343">.</span><span class="ident" id="6708344">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708352">w</span>&nbsp;<span class="op" id="6708354">:=</span>&nbsp;<span class="ident" id="6708357">NewWriter</span><span class="op" id="6708366">(</span><span class="op" id="6708367">&amp;</span><span class="ident" id="6708368">buf</span><span class="op" id="6708371">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6708374">for</span>&nbsp;<span class="ident" id="6708378">_</span><span class="op" id="6708379">,</span>&nbsp;<span class="ident" id="6708381">p</span>&nbsp;<span class="op" id="6708383">:=</span>&nbsp;<span class="keyword" id="6708386">range</span>&nbsp;<span class="ident" id="6708392">t</span><span class="op" id="6708393">.</span><span class="ident" id="6708394">want</span>&nbsp;<span class="op" id="6708399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708403">pw</span><span class="op" id="6708405">,</span>&nbsp;<span class="ident" id="6708407">err</span>&nbsp;<span class="op" id="6708411">:=</span>&nbsp;<span class="ident" id="6708414">w</span><span class="op" id="6708415">.</span><span class="ident" id="6708416">CreatePart</span><span class="op" id="6708426">(</span><span class="ident" id="6708427">p</span><span class="op" id="6708428">.</span><span class="ident" id="6708429">header</span><span class="op" id="6708435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6708439">if</span>&nbsp;<span class="ident" id="6708442">err</span>&nbsp;<span class="op" id="6708446">!=</span>&nbsp;<span class="ident" id="6708449">nil</span>&nbsp;<span class="op" id="6708453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6708458">panic</span><span class="op" id="6708463">(</span><span class="ident" id="6708464">err</span><span class="op" id="6708467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708471">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708475">_</span><span class="op" id="6708476">,</span>&nbsp;<span class="ident" id="6708478">err</span>&nbsp;<span class="op" id="6708482">=</span>&nbsp;<span class="ident" id="6708484">pw</span><span class="op" id="6708486">.</span><span class="ident" id="6708487">Write</span><span class="op" id="6708492">(</span><span class="op" id="6708493">[</span><span class="op" id="6708494">]</span><span class="builtintype" id="6708495">byte</span><span class="op" id="6708499">(</span><span class="ident" id="6708500">p</span><span class="op" id="6708501">.</span><span class="ident" id="6708502">body</span><span class="op" id="6708506">)</span><span class="op" id="6708507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6708511">if</span>&nbsp;<span class="ident" id="6708514">err</span>&nbsp;<span class="op" id="6708518">!=</span>&nbsp;<span class="ident" id="6708521">nil</span>&nbsp;<span class="op" id="6708525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6708530">panic</span><span class="op" id="6708535">(</span><span class="ident" id="6708536">err</span><span class="op" id="6708539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708546">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708549">w</span><span class="op" id="6708550">.</span><span class="ident" id="6708551">Close</span><span class="op" id="6708556">(</span><span class="op" id="6708557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708560">t</span><span class="op" id="6708561">.</span><span class="ident" id="6708562">in</span>&nbsp;<span class="op" id="6708565">=</span>&nbsp;<span class="ident" id="6708567">buf</span><span class="op" id="6708570">.</span><span class="ident" id="6708571">String</span><span class="op" id="6708577">(</span><span class="op" id="6708578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708581">t</span><span class="op" id="6708582">.</span><span class="ident" id="6708583">sep</span>&nbsp;<span class="op" id="6708587">=</span>&nbsp;<span class="ident" id="6708589">w</span><span class="op" id="6708590">.</span><span class="ident" id="6708591">Boundary</span><span class="op" id="6708599">(</span><span class="op" id="6708600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6708603">return</span>&nbsp;<span class="ident" id="6708610">t</span><br>
<span class="lineno"></span><span class="op" id="6708612">}</span>
</div>
</body>
</html>
