<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html" class="current">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8307343">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8307398">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8307452">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8307503">package</span>&nbsp;<span class="ident" id="8307511">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8307516">import</span>&nbsp;<span class="op" id="8307523">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8307526">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8307535">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8307551">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8307561">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8307569">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8307576">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8307582">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8307595">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8307602">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8307613">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8307624">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="8307631">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="8307634">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="8307709">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="8307786">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8307865">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="8307924">//</span><br>
<span class="lineno"></span><span class="comment" id="8307927">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8308001">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8308079">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="8308155">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="8308222">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="8308241">//</span><br>
<span class="lineno"></span><span class="comment" id="8308244">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="8308323">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="8308403">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="8308481">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="8308560">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8308579">var</span>&nbsp;<span class="ident" id="8308583">update</span>&nbsp;<span class="op" id="8308590">=</span>&nbsp;<span class="ident" id="8308592">flag</span><span class="op" id="8308596">.</span><span class="ident" id="8308597">Bool</span><span class="op" id="8308601">(</span><span class="string" id="8308602">&#34;update&#34;</span><span class="op" id="8308610">,</span>&nbsp;<span class="builtintype" id="8308612">false</span><span class="op" id="8308617">,</span>&nbsp;<span class="string" id="8308619">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="8308648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="8308651">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="8308731">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="8308805">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="8308823">type</span>&nbsp;<span class="ident" id="8308828">recordingConn</span>&nbsp;<span class="keyword" id="8308842">struct</span>&nbsp;<span class="op" id="8308849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308852">net</span><span class="op" id="8308855">.</span><span class="ident" id="8308856">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308862">sync</span><span class="op" id="8308866">.</span><span class="ident" id="8308867">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308874">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8308882">[</span><span class="op" id="8308883">]</span><span class="op" id="8308884">[</span><span class="op" id="8308885">]</span><span class="builtintype" id="8308886">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308892">reading</span>&nbsp;<span class="builtintype" id="8308900">bool</span><br>
<span class="lineno"></span><span class="op" id="8308905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8308908">func</span>&nbsp;<span class="op" id="8308913">(</span><span class="ident" id="8308914">r</span>&nbsp;<span class="op" id="8308916">*</span><span class="ident" id="8308917">recordingConn</span><span class="op" id="8308930">)</span>&nbsp;<span class="ident" id="8308932">Read</span><span class="op" id="8308936">(</span><span class="ident" id="8308937">b</span>&nbsp;<span class="op" id="8308939">[</span><span class="op" id="8308940">]</span><span class="builtintype" id="8308941">byte</span><span class="op" id="8308945">)</span>&nbsp;<span class="op" id="8308947">(</span><span class="ident" id="8308948">n</span>&nbsp;<span class="builtintype" id="8308950">int</span><span class="op" id="8308953">,</span>&nbsp;<span class="ident" id="8308955">err</span>&nbsp;<span class="builtintype" id="8308959">error</span><span class="op" id="8308964">)</span>&nbsp;<span class="op" id="8308966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308969">if</span>&nbsp;<span class="ident" id="8308972">n</span><span class="op" id="8308973">,</span>&nbsp;<span class="ident" id="8308975">err</span>&nbsp;<span class="op" id="8308979">=</span>&nbsp;<span class="ident" id="8308981">r</span><span class="op" id="8308982">.</span><span class="ident" id="8308983">Conn</span><span class="op" id="8308987">.</span><span class="ident" id="8308988">Read</span><span class="op" id="8308992">(</span><span class="ident" id="8308993">b</span><span class="op" id="8308994">)</span><span class="op" id="8308995">;</span>&nbsp;<span class="ident" id="8308997">n</span>&nbsp;<span class="op" id="8308999">==</span>&nbsp;<span class="num" id="8309002">0</span>&nbsp;<span class="op" id="8309004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309008">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309019">b</span>&nbsp;<span class="op" id="8309021">=</span>&nbsp;<span class="ident" id="8309023">b</span><span class="op" id="8309024">[</span><span class="op" id="8309025">:</span><span class="ident" id="8309026">n</span><span class="op" id="8309027">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309031">r</span><span class="op" id="8309032">.</span><span class="ident" id="8309033">Lock</span><span class="op" id="8309037">(</span><span class="op" id="8309038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309041">defer</span>&nbsp;<span class="ident" id="8309047">r</span><span class="op" id="8309048">.</span><span class="ident" id="8309049">Unlock</span><span class="op" id="8309055">(</span><span class="op" id="8309056">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309060">if</span>&nbsp;<span class="ident" id="8309063">l</span>&nbsp;<span class="op" id="8309065">:=</span>&nbsp;<span class="builtinfunc" id="8309068">len</span><span class="op" id="8309071">(</span><span class="ident" id="8309072">r</span><span class="op" id="8309073">.</span><span class="ident" id="8309074">flows</span><span class="op" id="8309079">)</span><span class="op" id="8309080">;</span>&nbsp;<span class="ident" id="8309082">l</span>&nbsp;<span class="op" id="8309084">==</span>&nbsp;<span class="num" id="8309087">0</span>&nbsp;<span class="op" id="8309089">||</span>&nbsp;<span class="op" id="8309092">!</span><span class="ident" id="8309093">r</span><span class="op" id="8309094">.</span><span class="ident" id="8309095">reading</span>&nbsp;<span class="op" id="8309103">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309107">buf</span>&nbsp;<span class="op" id="8309111">:=</span>&nbsp;<span class="builtinfunc" id="8309114">make</span><span class="op" id="8309118">(</span><span class="op" id="8309119">[</span><span class="op" id="8309120">]</span><span class="builtintype" id="8309121">byte</span><span class="op" id="8309125">,</span>&nbsp;<span class="builtinfunc" id="8309127">len</span><span class="op" id="8309130">(</span><span class="ident" id="8309131">b</span><span class="op" id="8309132">)</span><span class="op" id="8309133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8309137">copy</span><span class="op" id="8309141">(</span><span class="ident" id="8309142">buf</span><span class="op" id="8309145">,</span>&nbsp;<span class="ident" id="8309147">b</span><span class="op" id="8309148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309152">r</span><span class="op" id="8309153">.</span><span class="ident" id="8309154">flows</span>&nbsp;<span class="op" id="8309160">=</span>&nbsp;<span class="builtinfunc" id="8309162">append</span><span class="op" id="8309168">(</span><span class="ident" id="8309169">r</span><span class="op" id="8309170">.</span><span class="ident" id="8309171">flows</span><span class="op" id="8309176">,</span>&nbsp;<span class="ident" id="8309178">buf</span><span class="op" id="8309181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309184">}</span>&nbsp;<span class="keyword" id="8309186">else</span>&nbsp;<span class="op" id="8309191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309195">r</span><span class="op" id="8309196">.</span><span class="ident" id="8309197">flows</span><span class="op" id="8309202">[</span><span class="ident" id="8309203">l</span><span class="op" id="8309204">-</span><span class="num" id="8309205">1</span><span class="op" id="8309206">]</span>&nbsp;<span class="op" id="8309208">=</span>&nbsp;<span class="builtinfunc" id="8309210">append</span><span class="op" id="8309216">(</span><span class="ident" id="8309217">r</span><span class="op" id="8309218">.</span><span class="ident" id="8309219">flows</span><span class="op" id="8309224">[</span><span class="ident" id="8309225">l</span><span class="op" id="8309226">-</span><span class="num" id="8309227">1</span><span class="op" id="8309228">]</span><span class="op" id="8309229">,</span>&nbsp;<span class="ident" id="8309231">b</span><span class="op" id="8309232">[</span><span class="op" id="8309233">:</span><span class="ident" id="8309234">n</span><span class="op" id="8309235">]</span><span class="op" id="8309236">...</span><span class="op" id="8309239">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309245">r</span><span class="op" id="8309246">.</span><span class="ident" id="8309247">reading</span>&nbsp;<span class="op" id="8309255">=</span>&nbsp;<span class="builtintype" id="8309257">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309263">return</span><br>
<span class="lineno"></span><span class="op" id="8309270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="8309273">func</span>&nbsp;<span class="op" id="8309278">(</span><span class="ident" id="8309279">r</span>&nbsp;<span class="op" id="8309281">*</span><span class="ident" id="8309282">recordingConn</span><span class="op" id="8309295">)</span>&nbsp;<span class="ident" id="8309297">Write</span><span class="op" id="8309302">(</span><span class="ident" id="8309303">b</span>&nbsp;<span class="op" id="8309305">[</span><span class="op" id="8309306">]</span><span class="builtintype" id="8309307">byte</span><span class="op" id="8309311">)</span>&nbsp;<span class="op" id="8309313">(</span><span class="ident" id="8309314">n</span>&nbsp;<span class="builtintype" id="8309316">int</span><span class="op" id="8309319">,</span>&nbsp;<span class="ident" id="8309321">err</span>&nbsp;<span class="builtintype" id="8309325">error</span><span class="op" id="8309330">)</span>&nbsp;<span class="op" id="8309332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309335">if</span>&nbsp;<span class="ident" id="8309338">n</span><span class="op" id="8309339">,</span>&nbsp;<span class="ident" id="8309341">err</span>&nbsp;<span class="op" id="8309345">=</span>&nbsp;<span class="ident" id="8309347">r</span><span class="op" id="8309348">.</span><span class="ident" id="8309349">Conn</span><span class="op" id="8309353">.</span><span class="ident" id="8309354">Write</span><span class="op" id="8309359">(</span><span class="ident" id="8309360">b</span><span class="op" id="8309361">)</span><span class="op" id="8309362">;</span>&nbsp;<span class="ident" id="8309364">n</span>&nbsp;<span class="op" id="8309366">==</span>&nbsp;<span class="num" id="8309369">0</span>&nbsp;<span class="op" id="8309371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309375">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309386">b</span>&nbsp;<span class="op" id="8309388">=</span>&nbsp;<span class="ident" id="8309390">b</span><span class="op" id="8309391">[</span><span class="op" id="8309392">:</span><span class="ident" id="8309393">n</span><span class="op" id="8309394">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309398">r</span><span class="op" id="8309399">.</span><span class="ident" id="8309400">Lock</span><span class="op" id="8309404">(</span><span class="op" id="8309405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309408">defer</span>&nbsp;<span class="ident" id="8309414">r</span><span class="op" id="8309415">.</span><span class="ident" id="8309416">Unlock</span><span class="op" id="8309422">(</span><span class="op" id="8309423">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309427">if</span>&nbsp;<span class="ident" id="8309430">l</span>&nbsp;<span class="op" id="8309432">:=</span>&nbsp;<span class="builtinfunc" id="8309435">len</span><span class="op" id="8309438">(</span><span class="ident" id="8309439">r</span><span class="op" id="8309440">.</span><span class="ident" id="8309441">flows</span><span class="op" id="8309446">)</span><span class="op" id="8309447">;</span>&nbsp;<span class="ident" id="8309449">l</span>&nbsp;<span class="op" id="8309451">==</span>&nbsp;<span class="num" id="8309454">0</span>&nbsp;<span class="op" id="8309456">||</span>&nbsp;<span class="ident" id="8309459">r</span><span class="op" id="8309460">.</span><span class="ident" id="8309461">reading</span>&nbsp;<span class="op" id="8309469">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309473">buf</span>&nbsp;<span class="op" id="8309477">:=</span>&nbsp;<span class="builtinfunc" id="8309480">make</span><span class="op" id="8309484">(</span><span class="op" id="8309485">[</span><span class="op" id="8309486">]</span><span class="builtintype" id="8309487">byte</span><span class="op" id="8309491">,</span>&nbsp;<span class="builtinfunc" id="8309493">len</span><span class="op" id="8309496">(</span><span class="ident" id="8309497">b</span><span class="op" id="8309498">)</span><span class="op" id="8309499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8309503">copy</span><span class="op" id="8309507">(</span><span class="ident" id="8309508">buf</span><span class="op" id="8309511">,</span>&nbsp;<span class="ident" id="8309513">b</span><span class="op" id="8309514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309518">r</span><span class="op" id="8309519">.</span><span class="ident" id="8309520">flows</span>&nbsp;<span class="op" id="8309526">=</span>&nbsp;<span class="builtinfunc" id="8309528">append</span><span class="op" id="8309534">(</span><span class="ident" id="8309535">r</span><span class="op" id="8309536">.</span><span class="ident" id="8309537">flows</span><span class="op" id="8309542">,</span>&nbsp;<span class="ident" id="8309544">buf</span><span class="op" id="8309547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309550">}</span>&nbsp;<span class="keyword" id="8309552">else</span>&nbsp;<span class="op" id="8309557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309561">r</span><span class="op" id="8309562">.</span><span class="ident" id="8309563">flows</span><span class="op" id="8309568">[</span><span class="ident" id="8309569">l</span><span class="op" id="8309570">-</span><span class="num" id="8309571">1</span><span class="op" id="8309572">]</span>&nbsp;<span class="op" id="8309574">=</span>&nbsp;<span class="builtinfunc" id="8309576">append</span><span class="op" id="8309582">(</span><span class="ident" id="8309583">r</span><span class="op" id="8309584">.</span><span class="ident" id="8309585">flows</span><span class="op" id="8309590">[</span><span class="ident" id="8309591">l</span><span class="op" id="8309592">-</span><span class="num" id="8309593">1</span><span class="op" id="8309594">]</span><span class="op" id="8309595">,</span>&nbsp;<span class="ident" id="8309597">b</span><span class="op" id="8309598">[</span><span class="op" id="8309599">:</span><span class="ident" id="8309600">n</span><span class="op" id="8309601">]</span><span class="op" id="8309602">...</span><span class="op" id="8309605">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309611">r</span><span class="op" id="8309612">.</span><span class="ident" id="8309613">reading</span>&nbsp;<span class="op" id="8309621">=</span>&nbsp;<span class="builtintype" id="8309623">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309630">return</span><br>
<span class="lineno"></span><span class="op" id="8309637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="8309640">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="8309714">func</span>&nbsp;<span class="op" id="8309719">(</span><span class="ident" id="8309720">r</span>&nbsp;<span class="op" id="8309722">*</span><span class="ident" id="8309723">recordingConn</span><span class="op" id="8309736">)</span>&nbsp;<span class="ident" id="8309738">WriteTo</span><span class="op" id="8309745">(</span><span class="ident" id="8309746">w</span>&nbsp;<span class="ident" id="8309748">io</span><span class="op" id="8309750">.</span><span class="ident" id="8309751">Writer</span><span class="op" id="8309757">)</span>&nbsp;<span class="op" id="8309759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8309762">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309814">clientToServer</span>&nbsp;<span class="op" id="8309829">:=</span>&nbsp;<span class="builtintype" id="8309832">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309839">for</span>&nbsp;<span class="ident" id="8309843">i</span><span class="op" id="8309844">,</span>&nbsp;<span class="ident" id="8309846">flow</span>&nbsp;<span class="op" id="8309851">:=</span>&nbsp;<span class="keyword" id="8309854">range</span>&nbsp;<span class="ident" id="8309860">r</span><span class="op" id="8309861">.</span><span class="ident" id="8309862">flows</span>&nbsp;<span class="op" id="8309868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309872">source</span><span class="op" id="8309878">,</span>&nbsp;<span class="ident" id="8309880">dest</span>&nbsp;<span class="op" id="8309885">:=</span>&nbsp;<span class="string" id="8309888">&#34;client&#34;</span><span class="op" id="8309896">,</span>&nbsp;<span class="string" id="8309898">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309909">if</span>&nbsp;<span class="op" id="8309912">!</span><span class="ident" id="8309913">clientToServer</span>&nbsp;<span class="op" id="8309928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309933">source</span><span class="op" id="8309939">,</span>&nbsp;<span class="ident" id="8309941">dest</span>&nbsp;<span class="op" id="8309946">=</span>&nbsp;<span class="ident" id="8309948">dest</span><span class="op" id="8309952">,</span>&nbsp;<span class="ident" id="8309954">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309963">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309967">fmt</span><span class="op" id="8309970">.</span><span class="ident" id="8309971">Fprintf</span><span class="op" id="8309978">(</span><span class="ident" id="8309979">w</span><span class="op" id="8309980">,</span>&nbsp;<span class="string" id="8309982">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="8310008">,</span>&nbsp;<span class="ident" id="8310010">i</span><span class="op" id="8310011">+</span><span class="num" id="8310012">1</span><span class="op" id="8310013">,</span>&nbsp;<span class="ident" id="8310015">source</span><span class="op" id="8310021">,</span>&nbsp;<span class="ident" id="8310023">dest</span><span class="op" id="8310027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310031">dumper</span>&nbsp;<span class="op" id="8310038">:=</span>&nbsp;<span class="ident" id="8310041">hex</span><span class="op" id="8310044">.</span><span class="ident" id="8310045">Dumper</span><span class="op" id="8310051">(</span><span class="ident" id="8310052">w</span><span class="op" id="8310053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310057">dumper</span><span class="op" id="8310063">.</span><span class="ident" id="8310064">Write</span><span class="op" id="8310069">(</span><span class="ident" id="8310070">flow</span><span class="op" id="8310074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310078">dumper</span><span class="op" id="8310084">.</span><span class="ident" id="8310085">Close</span><span class="op" id="8310090">(</span><span class="op" id="8310091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310095">clientToServer</span>&nbsp;<span class="op" id="8310110">=</span>&nbsp;<span class="op" id="8310112">!</span><span class="ident" id="8310113">clientToServer</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310129">}</span><br>
<span class="lineno"></span><span class="op" id="8310131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8310134">func</span>&nbsp;<span class="ident" id="8310139">parseTestData</span><span class="op" id="8310152">(</span><span class="ident" id="8310153">r</span>&nbsp;<span class="ident" id="8310155">io</span><span class="op" id="8310157">.</span><span class="ident" id="8310158">Reader</span><span class="op" id="8310164">)</span>&nbsp;<span class="op" id="8310166">(</span><span class="ident" id="8310167">flows</span>&nbsp;<span class="op" id="8310173">[</span><span class="op" id="8310174">]</span><span class="op" id="8310175">[</span><span class="op" id="8310176">]</span><span class="builtintype" id="8310177">byte</span><span class="op" id="8310181">,</span>&nbsp;<span class="ident" id="8310183">err</span>&nbsp;<span class="builtintype" id="8310187">error</span><span class="op" id="8310192">)</span>&nbsp;<span class="op" id="8310194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310197">var</span>&nbsp;<span class="ident" id="8310201">currentFlow</span>&nbsp;<span class="op" id="8310213">[</span><span class="op" id="8310214">]</span><span class="builtintype" id="8310215">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310222">scanner</span>&nbsp;<span class="op" id="8310230">:=</span>&nbsp;<span class="ident" id="8310233">bufio</span><span class="op" id="8310238">.</span><span class="ident" id="8310239">NewScanner</span><span class="op" id="8310249">(</span><span class="ident" id="8310250">r</span><span class="op" id="8310251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310254">for</span>&nbsp;<span class="ident" id="8310258">scanner</span><span class="op" id="8310265">.</span><span class="ident" id="8310266">Scan</span><span class="op" id="8310270">(</span><span class="op" id="8310271">)</span>&nbsp;<span class="op" id="8310273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310277">line</span>&nbsp;<span class="op" id="8310282">:=</span>&nbsp;<span class="ident" id="8310285">scanner</span><span class="op" id="8310292">.</span><span class="ident" id="8310293">Text</span><span class="op" id="8310297">(</span><span class="op" id="8310298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8310302">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8310366">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310386">if</span>&nbsp;<span class="ident" id="8310389">strings</span><span class="op" id="8310396">.</span><span class="ident" id="8310397">HasPrefix</span><span class="op" id="8310406">(</span><span class="ident" id="8310407">line</span><span class="op" id="8310411">,</span>&nbsp;<span class="string" id="8310413">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="8310419">)</span>&nbsp;<span class="op" id="8310421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310426">if</span>&nbsp;<span class="builtinfunc" id="8310429">len</span><span class="op" id="8310432">(</span><span class="ident" id="8310433">currentFlow</span><span class="op" id="8310444">)</span>&nbsp;<span class="op" id="8310446">&gt;</span>&nbsp;<span class="num" id="8310448">0</span>&nbsp;<span class="op" id="8310450">||</span>&nbsp;<span class="builtinfunc" id="8310453">len</span><span class="op" id="8310456">(</span><span class="ident" id="8310457">flows</span><span class="op" id="8310462">)</span>&nbsp;<span class="op" id="8310464">&gt;</span>&nbsp;<span class="num" id="8310466">0</span>&nbsp;<span class="op" id="8310468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310474">flows</span>&nbsp;<span class="op" id="8310480">=</span>&nbsp;<span class="builtinfunc" id="8310482">append</span><span class="op" id="8310488">(</span><span class="ident" id="8310489">flows</span><span class="op" id="8310494">,</span>&nbsp;<span class="ident" id="8310496">currentFlow</span><span class="op" id="8310507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310513">currentFlow</span>&nbsp;<span class="op" id="8310525">=</span>&nbsp;<span class="ident" id="8310527">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310539">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8310555">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8310618">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8310671">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310733">if</span>&nbsp;<span class="ident" id="8310736">i</span>&nbsp;<span class="op" id="8310738">:=</span>&nbsp;<span class="ident" id="8310741">strings</span><span class="op" id="8310748">.</span><span class="ident" id="8310749">IndexByte</span><span class="op" id="8310758">(</span><span class="ident" id="8310759">line</span><span class="op" id="8310763">,</span>&nbsp;<span class="string" id="8310765">&#39;&nbsp;&#39;</span><span class="op" id="8310768">)</span><span class="op" id="8310769">;</span>&nbsp;<span class="ident" id="8310771">i</span>&nbsp;<span class="op" id="8310773">&gt;=</span>&nbsp;<span class="num" id="8310776">0</span>&nbsp;<span class="op" id="8310778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310783">line</span>&nbsp;<span class="op" id="8310788">=</span>&nbsp;<span class="ident" id="8310790">line</span><span class="op" id="8310794">[</span><span class="ident" id="8310795">i</span><span class="op" id="8310796">:</span><span class="op" id="8310797">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310801">}</span>&nbsp;<span class="keyword" id="8310803">else</span>&nbsp;<span class="op" id="8310808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310813">return</span>&nbsp;<span class="ident" id="8310820">nil</span><span class="op" id="8310823">,</span>&nbsp;<span class="ident" id="8310825">errors</span><span class="op" id="8310831">.</span><span class="ident" id="8310832">New</span><span class="op" id="8310835">(</span><span class="string" id="8310836">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="8310855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310864">if</span>&nbsp;<span class="ident" id="8310867">i</span>&nbsp;<span class="op" id="8310869">:=</span>&nbsp;<span class="ident" id="8310872">strings</span><span class="op" id="8310879">.</span><span class="ident" id="8310880">IndexByte</span><span class="op" id="8310889">(</span><span class="ident" id="8310890">line</span><span class="op" id="8310894">,</span>&nbsp;<span class="string" id="8310896">&#39;|&#39;</span><span class="op" id="8310899">)</span><span class="op" id="8310900">;</span>&nbsp;<span class="ident" id="8310902">i</span>&nbsp;<span class="op" id="8310904">&gt;=</span>&nbsp;<span class="num" id="8310907">0</span>&nbsp;<span class="op" id="8310909">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310914">line</span>&nbsp;<span class="op" id="8310919">=</span>&nbsp;<span class="ident" id="8310921">line</span><span class="op" id="8310925">[</span><span class="op" id="8310926">:</span><span class="ident" id="8310927">i</span><span class="op" id="8310928">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310932">}</span>&nbsp;<span class="keyword" id="8310934">else</span>&nbsp;<span class="op" id="8310939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310944">return</span>&nbsp;<span class="ident" id="8310951">nil</span><span class="op" id="8310954">,</span>&nbsp;<span class="ident" id="8310956">errors</span><span class="op" id="8310962">.</span><span class="ident" id="8310963">New</span><span class="op" id="8310966">(</span><span class="string" id="8310967">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="8310986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310995">hexBytes</span>&nbsp;<span class="op" id="8311004">:=</span>&nbsp;<span class="ident" id="8311007">strings</span><span class="op" id="8311014">.</span><span class="ident" id="8311015">Fields</span><span class="op" id="8311021">(</span><span class="ident" id="8311022">line</span><span class="op" id="8311026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311030">for</span>&nbsp;<span class="ident" id="8311034">_</span><span class="op" id="8311035">,</span>&nbsp;<span class="ident" id="8311037">hexByte</span>&nbsp;<span class="op" id="8311045">:=</span>&nbsp;<span class="keyword" id="8311048">range</span>&nbsp;<span class="ident" id="8311054">hexBytes</span>&nbsp;<span class="op" id="8311063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311068">val</span><span class="op" id="8311071">,</span>&nbsp;<span class="ident" id="8311073">err</span>&nbsp;<span class="op" id="8311077">:=</span>&nbsp;<span class="ident" id="8311080">strconv</span><span class="op" id="8311087">.</span><span class="ident" id="8311088">ParseUint</span><span class="op" id="8311097">(</span><span class="ident" id="8311098">hexByte</span><span class="op" id="8311105">,</span>&nbsp;<span class="num" id="8311107">16</span><span class="op" id="8311109">,</span>&nbsp;<span class="num" id="8311111">8</span><span class="op" id="8311112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311117">if</span>&nbsp;<span class="ident" id="8311120">err</span>&nbsp;<span class="op" id="8311124">!=</span>&nbsp;<span class="ident" id="8311127">nil</span>&nbsp;<span class="op" id="8311131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311137">return</span>&nbsp;<span class="ident" id="8311144">nil</span><span class="op" id="8311147">,</span>&nbsp;<span class="ident" id="8311149">errors</span><span class="op" id="8311155">.</span><span class="ident" id="8311156">New</span><span class="op" id="8311159">(</span><span class="string" id="8311160">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="8311194">+</span>&nbsp;<span class="ident" id="8311196">err</span><span class="op" id="8311199">.</span><span class="ident" id="8311200">Error</span><span class="op" id="8311205">(</span><span class="op" id="8311206">)</span><span class="op" id="8311207">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311217">currentFlow</span>&nbsp;<span class="op" id="8311229">=</span>&nbsp;<span class="builtinfunc" id="8311231">append</span><span class="op" id="8311237">(</span><span class="ident" id="8311238">currentFlow</span><span class="op" id="8311249">,</span>&nbsp;<span class="builtintype" id="8311251">byte</span><span class="op" id="8311255">(</span><span class="ident" id="8311256">val</span><span class="op" id="8311259">)</span><span class="op" id="8311260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311271">if</span>&nbsp;<span class="builtinfunc" id="8311274">len</span><span class="op" id="8311277">(</span><span class="ident" id="8311278">currentFlow</span><span class="op" id="8311289">)</span>&nbsp;<span class="op" id="8311291">&gt;</span>&nbsp;<span class="num" id="8311293">0</span>&nbsp;<span class="op" id="8311295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311299">flows</span>&nbsp;<span class="op" id="8311305">=</span>&nbsp;<span class="builtinfunc" id="8311307">append</span><span class="op" id="8311313">(</span><span class="ident" id="8311314">flows</span><span class="op" id="8311319">,</span>&nbsp;<span class="ident" id="8311321">currentFlow</span><span class="op" id="8311332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311339">return</span>&nbsp;<span class="ident" id="8311346">flows</span><span class="op" id="8311351">,</span>&nbsp;<span class="ident" id="8311353">nil</span><br>
<span class="lineno">155</span><span class="op" id="8311357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8311360">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="8311434">func</span>&nbsp;<span class="ident" id="8311439">tempFile</span><span class="op" id="8311447">(</span><span class="ident" id="8311448">contents</span>&nbsp;<span class="builtintype" id="8311457">string</span><span class="op" id="8311463">)</span>&nbsp;<span class="builtintype" id="8311465">string</span>&nbsp;<span class="op" id="8311472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311475">file</span><span class="op" id="8311479">,</span>&nbsp;<span class="ident" id="8311481">err</span>&nbsp;<span class="op" id="8311485">:=</span>&nbsp;<span class="ident" id="8311488">ioutil</span><span class="op" id="8311494">.</span><span class="ident" id="8311495">TempFile</span><span class="op" id="8311503">(</span><span class="string" id="8311504">&#34;&#34;</span><span class="op" id="8311506">,</span>&nbsp;<span class="string" id="8311508">&#34;go-tls-test&#34;</span><span class="op" id="8311521">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311524">if</span>&nbsp;<span class="ident" id="8311527">err</span>&nbsp;<span class="op" id="8311531">!=</span>&nbsp;<span class="ident" id="8311534">nil</span>&nbsp;<span class="op" id="8311538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8311542">panic</span><span class="op" id="8311547">(</span><span class="string" id="8311548">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="8311579">+</span>&nbsp;<span class="ident" id="8311581">err</span><span class="op" id="8311584">.</span><span class="ident" id="8311585">Error</span><span class="op" id="8311590">(</span><span class="op" id="8311591">)</span><span class="op" id="8311592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311598">path</span>&nbsp;<span class="op" id="8311603">:=</span>&nbsp;<span class="ident" id="8311606">file</span><span class="op" id="8311610">.</span><span class="ident" id="8311611">Name</span><span class="op" id="8311615">(</span><span class="op" id="8311616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311619">file</span><span class="op" id="8311623">.</span><span class="ident" id="8311624">WriteString</span><span class="op" id="8311635">(</span><span class="ident" id="8311636">contents</span><span class="op" id="8311644">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311647">file</span><span class="op" id="8311651">.</span><span class="ident" id="8311652">Close</span><span class="op" id="8311657">(</span><span class="op" id="8311658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311661">return</span>&nbsp;<span class="ident" id="8311668">path</span><br>
<span class="lineno"></span><span class="op" id="8311673">}</span>
</div>
</body>
</html>
