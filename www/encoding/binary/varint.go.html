<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3172121">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3172177">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3172231">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3172282">package</span>&nbsp;<span class="ident" id="3172290">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3172298">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3172360">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3172380">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="3172454">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3172482">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="3172557">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="3172595">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3172664">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="3172737">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="3172812">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3172864">//</span><br>
<span class="lineno"></span><span class="comment" id="3172867">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="3172883">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="3172952">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="3173031">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="3173110">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3173186">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3173265">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="3173343">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3173424">import</span>&nbsp;<span class="op" id="3173431">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3173434">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3173444">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="3173449">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3173452">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="3173526">const</span>&nbsp;<span class="op" id="3173532">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173535">MaxVarintLen16</span>&nbsp;<span class="op" id="3173550">=</span>&nbsp;<span class="num" id="3173552">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173555">MaxVarintLen32</span>&nbsp;<span class="op" id="3173570">=</span>&nbsp;<span class="num" id="3173572">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173575">MaxVarintLen64</span>&nbsp;<span class="op" id="3173590">=</span>&nbsp;<span class="num" id="3173592">10</span><br>
<span class="lineno"></span><span class="op" id="3173595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3173598">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="3173679">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3173733">func</span>&nbsp;<span class="ident" id="3173738">PutUvarint</span><span class="op" id="3173748">(</span><span class="ident" id="3173749">buf</span>&nbsp;<span class="op" id="3173753">[</span><span class="op" id="3173754">]</span><span class="builtintype" id="3173755">byte</span><span class="op" id="3173759">,</span>&nbsp;<span class="ident" id="3173761">x</span>&nbsp;<span class="ident" id="3173763">uint64</span><span class="op" id="3173769">)</span>&nbsp;<span class="builtintype" id="3173771">int</span>&nbsp;<span class="op" id="3173775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173778">i</span>&nbsp;<span class="op" id="3173780">:=</span>&nbsp;<span class="num" id="3173783">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173786">for</span>&nbsp;<span class="ident" id="3173790"><a href="/encoding/binary/varint.go.html#3173761">x</a></span>&nbsp;<span class="op" id="3173792">&gt;=</span>&nbsp;<span class="num" id="3173795">0x80</span>&nbsp;<span class="op" id="3173800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173804"><a href="/encoding/binary/varint.go.html#3173749">buf</a></span><span class="op" id="3173807">[</span><span class="ident" id="3173808"><a href="/encoding/binary/varint.go.html#3173778">i</a></span><span class="op" id="3173809">]</span>&nbsp;<span class="op" id="3173811">=</span>&nbsp;<span class="builtintype" id="3173813">byte</span><span class="op" id="3173817">(</span><span class="ident" id="3173818"><a href="/encoding/binary/varint.go.html#3173761">x</a></span><span class="op" id="3173819">)</span>&nbsp;<span class="op" id="3173821">|</span>&nbsp;<span class="num" id="3173823">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173830"><a href="/encoding/binary/varint.go.html#3173761">x</a></span>&nbsp;<span class="op" id="3173832">&gt;&gt;=</span>&nbsp;<span class="num" id="3173836">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173840"><a href="/encoding/binary/varint.go.html#3173778">i</a></span><span class="op" id="3173841">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3173845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173848"><a href="/encoding/binary/varint.go.html#3173749">buf</a></span><span class="op" id="3173851">[</span><span class="ident" id="3173852"><a href="/encoding/binary/varint.go.html#3173778">i</a></span><span class="op" id="3173853">]</span>&nbsp;<span class="op" id="3173855">=</span>&nbsp;<span class="builtintype" id="3173857">byte</span><span class="op" id="3173861">(</span><span class="ident" id="3173862"><a href="/encoding/binary/varint.go.html#3173761">x</a></span><span class="op" id="3173863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173866">return</span>&nbsp;<span class="ident" id="3173873"><a href="/encoding/binary/varint.go.html#3173778">i</a></span>&nbsp;<span class="op" id="3173875">+</span>&nbsp;<span class="num" id="3173877">1</span><br>
<span class="lineno">50</span><span class="op" id="3173879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3173882">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3173950">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3174018">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="3174064">//</span><br>
<span class="lineno"></span><span class="comment" id="3174067">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3174092">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3174140">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3174191">//</span><br>
<span class="lineno">60</span><span class="keyword" id="3174194">func</span>&nbsp;<span class="ident" id="3174199">Uvarint</span><span class="op" id="3174206">(</span><span class="ident" id="3174207">buf</span>&nbsp;<span class="op" id="3174211">[</span><span class="op" id="3174212">]</span><span class="builtintype" id="3174213">byte</span><span class="op" id="3174217">)</span>&nbsp;<span class="op" id="3174219">(</span><span class="ident" id="3174220">uint64</span><span class="op" id="3174226">,</span>&nbsp;<span class="builtintype" id="3174228">int</span><span class="op" id="3174231">)</span>&nbsp;<span class="op" id="3174233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174236">var</span>&nbsp;<span class="ident" id="3174240">x</span>&nbsp;<span class="ident" id="3174242">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174250">var</span>&nbsp;<span class="ident" id="3174254">s</span>&nbsp;<span class="builtintype" id="3174256">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174262">for</span>&nbsp;<span class="ident" id="3174266">i</span><span class="op" id="3174267">,</span>&nbsp;<span class="ident" id="3174269">b</span>&nbsp;<span class="op" id="3174271">:=</span>&nbsp;<span class="keyword" id="3174274">range</span>&nbsp;<span class="ident" id="3174280"><a href="/encoding/binary/varint.go.html#3174207">buf</a></span>&nbsp;<span class="op" id="3174284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174288">if</span>&nbsp;<span class="ident" id="3174291"><a href="/encoding/binary/varint.go.html#3174269">b</a></span>&nbsp;<span class="op" id="3174293">&lt;</span>&nbsp;<span class="num" id="3174295">0x80</span>&nbsp;<span class="op" id="3174300">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174305">if</span>&nbsp;<span class="ident" id="3174308"><a href="/encoding/binary/varint.go.html#3174266">i</a></span>&nbsp;<span class="op" id="3174310">&gt;</span>&nbsp;<span class="num" id="3174312">9</span>&nbsp;<span class="op" id="3174314">||</span>&nbsp;<span class="ident" id="3174317"><a href="/encoding/binary/varint.go.html#3174266">i</a></span>&nbsp;<span class="op" id="3174319">==</span>&nbsp;<span class="num" id="3174322">9</span>&nbsp;<span class="op" id="3174324">&amp;&amp;</span>&nbsp;<span class="ident" id="3174327"><a href="/encoding/binary/varint.go.html#3174269">b</a></span>&nbsp;<span class="op" id="3174329">&gt;</span>&nbsp;<span class="num" id="3174331">1</span>&nbsp;<span class="op" id="3174333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174339">return</span>&nbsp;<span class="num" id="3174346">0</span><span class="op" id="3174347">,</span>&nbsp;<span class="op" id="3174349">-</span><span class="op" id="3174350">(</span><span class="ident" id="3174351"><a href="/encoding/binary/varint.go.html#3174266">i</a></span>&nbsp;<span class="op" id="3174353">+</span>&nbsp;<span class="num" id="3174355">1</span><span class="op" id="3174356">)</span>&nbsp;<span class="comment" id="3174358">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3174373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174378">return</span>&nbsp;<span class="ident" id="3174385"><a href="/encoding/binary/varint.go.html#3174240">x</a></span>&nbsp;<span class="op" id="3174387">|</span>&nbsp;<span class="ident" id="3174389">uint64</span><span class="op" id="3174395">(</span><span class="ident" id="3174396"><a href="/encoding/binary/varint.go.html#3174269">b</a></span><span class="op" id="3174397">)</span><span class="op" id="3174398">&lt;&lt;</span><span class="ident" id="3174400"><a href="/encoding/binary/varint.go.html#3174254">s</a></span><span class="op" id="3174401">,</span>&nbsp;<span class="ident" id="3174403"><a href="/encoding/binary/varint.go.html#3174266">i</a></span>&nbsp;<span class="op" id="3174405">+</span>&nbsp;<span class="num" id="3174407">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3174411">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174415"><a href="/encoding/binary/varint.go.html#3174240">x</a></span>&nbsp;<span class="op" id="3174417">|=</span>&nbsp;<span class="ident" id="3174420">uint64</span><span class="op" id="3174426">(</span><span class="ident" id="3174427"><a href="/encoding/binary/varint.go.html#3174269">b</a></span><span class="op" id="3174428">&amp;</span><span class="num" id="3174429">0x7f</span><span class="op" id="3174433">)</span>&nbsp;<span class="op" id="3174435">&lt;&lt;</span>&nbsp;<span class="ident" id="3174438"><a href="/encoding/binary/varint.go.html#3174254">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174442"><a href="/encoding/binary/varint.go.html#3174254">s</a></span>&nbsp;<span class="op" id="3174444">+=</span>&nbsp;<span class="num" id="3174447">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3174450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174453">return</span>&nbsp;<span class="num" id="3174460">0</span><span class="op" id="3174461">,</span>&nbsp;<span class="num" id="3174463">0</span><br>
<span class="lineno"></span><span class="op" id="3174465">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3174468">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3174548">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3174601">func</span>&nbsp;<span class="ident" id="3174606">PutVarint</span><span class="op" id="3174615">(</span><span class="ident" id="3174616">buf</span>&nbsp;<span class="op" id="3174620">[</span><span class="op" id="3174621">]</span><span class="builtintype" id="3174622">byte</span><span class="op" id="3174626">,</span>&nbsp;<span class="ident" id="3174628">x</span>&nbsp;<span class="ident" id="3174630">int64</span><span class="op" id="3174635">)</span>&nbsp;<span class="builtintype" id="3174637">int</span>&nbsp;<span class="op" id="3174641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174644">ux</span>&nbsp;<span class="op" id="3174647">:=</span>&nbsp;<span class="ident" id="3174650">uint64</span><span class="op" id="3174656">(</span><span class="ident" id="3174657"><a href="/encoding/binary/varint.go.html#3174628">x</a></span><span class="op" id="3174658">)</span>&nbsp;<span class="op" id="3174660">&lt;&lt;</span>&nbsp;<span class="num" id="3174663">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174666">if</span>&nbsp;<span class="ident" id="3174669"><a href="/encoding/binary/varint.go.html#3174628">x</a></span>&nbsp;<span class="op" id="3174671">&lt;</span>&nbsp;<span class="num" id="3174673">0</span>&nbsp;<span class="op" id="3174675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174679"><a href="/encoding/binary/varint.go.html#3174644">ux</a></span>&nbsp;<span class="op" id="3174682">=</span>&nbsp;<span class="op" id="3174684">^</span><span class="ident" id="3174685"><a href="/encoding/binary/varint.go.html#3174644">ux</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3174689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174692">return</span>&nbsp;<span class="ident" id="3174699"><a href="/encoding/binary/varint.go.html#3173738">PutUvarint</a></span><span class="op" id="3174709">(</span><span class="ident" id="3174710"><a href="/encoding/binary/varint.go.html#3174616">buf</a></span><span class="op" id="3174713">,</span>&nbsp;<span class="ident" id="3174715"><a href="/encoding/binary/varint.go.html#3174644">ux</a></span><span class="op" id="3174717">)</span><br>
<span class="lineno"></span><span class="op" id="3174719">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3174722">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3174789">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3174857">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="3174922">//</span><br>
<span class="lineno">90</span><span class="comment" id="3174925">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3174950">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3174998">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3175049">//</span><br>
<span class="lineno"></span><span class="keyword" id="3175052">func</span>&nbsp;<span class="ident" id="3175057">Varint</span><span class="op" id="3175063">(</span><span class="ident" id="3175064">buf</span>&nbsp;<span class="op" id="3175068">[</span><span class="op" id="3175069">]</span><span class="builtintype" id="3175070">byte</span><span class="op" id="3175074">)</span>&nbsp;<span class="op" id="3175076">(</span><span class="ident" id="3175077">int64</span><span class="op" id="3175082">,</span>&nbsp;<span class="builtintype" id="3175084">int</span><span class="op" id="3175087">)</span>&nbsp;<span class="op" id="3175089">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175092">ux</span><span class="op" id="3175094">,</span>&nbsp;<span class="ident" id="3175096">n</span>&nbsp;<span class="op" id="3175098">:=</span>&nbsp;<span class="ident" id="3175101"><a href="/encoding/binary/varint.go.html#3174199">Uvarint</a></span><span class="op" id="3175108">(</span><span class="ident" id="3175109"><a href="/encoding/binary/varint.go.html#3175064">buf</a></span><span class="op" id="3175112">)</span>&nbsp;<span class="comment" id="3175114">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175154">x</span>&nbsp;<span class="op" id="3175156">:=</span>&nbsp;<span class="ident" id="3175159">int64</span><span class="op" id="3175164">(</span><span class="ident" id="3175165"><a href="/encoding/binary/varint.go.html#3175092">ux</a></span>&nbsp;<span class="op" id="3175168">&gt;&gt;</span>&nbsp;<span class="num" id="3175171">1</span><span class="op" id="3175172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175175">if</span>&nbsp;<span class="ident" id="3175178"><a href="/encoding/binary/varint.go.html#3175092">ux</a></span><span class="op" id="3175180">&amp;</span><span class="num" id="3175181">1</span>&nbsp;<span class="op" id="3175183">!=</span>&nbsp;<span class="num" id="3175186">0</span>&nbsp;<span class="op" id="3175188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175192"><a href="/encoding/binary/varint.go.html#3175154">x</a></span>&nbsp;<span class="op" id="3175194">=</span>&nbsp;<span class="op" id="3175196">^</span><span class="ident" id="3175197"><a href="/encoding/binary/varint.go.html#3175154">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175200">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175203">return</span>&nbsp;<span class="ident" id="3175210"><a href="/encoding/binary/varint.go.html#3175154">x</a></span><span class="op" id="3175211">,</span>&nbsp;<span class="ident" id="3175213"><a href="/encoding/binary/varint.go.html#3175096">n</a></span><br>
<span class="lineno"></span><span class="op" id="3175215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3175218">var</span>&nbsp;<span class="ident" id="3175222">overflow</span>&nbsp;<span class="op" id="3175231">=</span>&nbsp;<span class="ident" id="3175233"><a href="/encoding/binary/varint.go.html#3173434">errors</a></span><span class="op" id="3175239">.</span><span class="ident" id="3175240">New</span><span class="op" id="3175243">(</span><span class="string" id="3175244">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="3175287">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3175290">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="3175374">func</span>&nbsp;<span class="ident" id="3175379">ReadUvarint</span><span class="op" id="3175390">(</span><span class="ident" id="3175391">r</span>&nbsp;<span class="ident" id="3175393"><a href="/encoding/binary/varint.go.html#3173444">io</a></span><span class="op" id="3175395">.</span><span class="ident" id="3175396">ByteReader</span><span class="op" id="3175406">)</span>&nbsp;<span class="op" id="3175408">(</span><span class="ident" id="3175409">uint64</span><span class="op" id="3175415">,</span>&nbsp;<span class="builtintype" id="3175417">error</span><span class="op" id="3175422">)</span>&nbsp;<span class="op" id="3175424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175427">var</span>&nbsp;<span class="ident" id="3175431">x</span>&nbsp;<span class="ident" id="3175433">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175441">var</span>&nbsp;<span class="ident" id="3175445">s</span>&nbsp;<span class="builtintype" id="3175447">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175453">for</span>&nbsp;<span class="ident" id="3175457">i</span>&nbsp;<span class="op" id="3175459">:=</span>&nbsp;<span class="num" id="3175462">0</span><span class="op" id="3175463">;</span>&nbsp;<span class="op" id="3175465">;</span>&nbsp;<span class="ident" id="3175467"><a href="/encoding/binary/varint.go.html#3175457">i</a></span><span class="op" id="3175468">++</span>&nbsp;<span class="op" id="3175471">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175475">b</span><span class="op" id="3175476">,</span>&nbsp;<span class="ident" id="3175478">err</span>&nbsp;<span class="op" id="3175482">:=</span>&nbsp;<span class="ident" id="3175485"><a href="/encoding/binary/varint.go.html#3175391">r</a></span><span class="op" id="3175486">.</span><span class="ident" id="3175487">ReadByte</span><span class="op" id="3175495">(</span><span class="op" id="3175496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175500">if</span>&nbsp;<span class="ident" id="3175503"><a href="/encoding/binary/varint.go.html#3175478">err</a></span>&nbsp;<span class="op" id="3175507">!=</span>&nbsp;<span class="ident" id="3175510">nil</span>&nbsp;<span class="op" id="3175514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175519">return</span>&nbsp;<span class="ident" id="3175526"><a href="/encoding/binary/varint.go.html#3175431">x</a></span><span class="op" id="3175527">,</span>&nbsp;<span class="ident" id="3175529"><a href="/encoding/binary/varint.go.html#3175478">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175539">if</span>&nbsp;<span class="ident" id="3175542"><a href="/encoding/binary/varint.go.html#3175475">b</a></span>&nbsp;<span class="op" id="3175544">&lt;</span>&nbsp;<span class="num" id="3175546">0x80</span>&nbsp;<span class="op" id="3175551">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175556">if</span>&nbsp;<span class="ident" id="3175559"><a href="/encoding/binary/varint.go.html#3175457">i</a></span>&nbsp;<span class="op" id="3175561">&gt;</span>&nbsp;<span class="num" id="3175563">9</span>&nbsp;<span class="op" id="3175565">||</span>&nbsp;<span class="ident" id="3175568"><a href="/encoding/binary/varint.go.html#3175457">i</a></span>&nbsp;<span class="op" id="3175570">==</span>&nbsp;<span class="num" id="3175573">9</span>&nbsp;<span class="op" id="3175575">&amp;&amp;</span>&nbsp;<span class="ident" id="3175578"><a href="/encoding/binary/varint.go.html#3175475">b</a></span>&nbsp;<span class="op" id="3175580">&gt;</span>&nbsp;<span class="num" id="3175582">1</span>&nbsp;<span class="op" id="3175584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175590">return</span>&nbsp;<span class="ident" id="3175597"><a href="/encoding/binary/varint.go.html#3175431">x</a></span><span class="op" id="3175598">,</span>&nbsp;<span class="ident" id="3175600"><a href="/encoding/binary/varint.go.html#3175222">overflow</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175617">return</span>&nbsp;<span class="ident" id="3175624"><a href="/encoding/binary/varint.go.html#3175431">x</a></span>&nbsp;<span class="op" id="3175626">|</span>&nbsp;<span class="ident" id="3175628">uint64</span><span class="op" id="3175634">(</span><span class="ident" id="3175635"><a href="/encoding/binary/varint.go.html#3175475">b</a></span><span class="op" id="3175636">)</span><span class="op" id="3175637">&lt;&lt;</span><span class="ident" id="3175639"><a href="/encoding/binary/varint.go.html#3175445">s</a></span><span class="op" id="3175640">,</span>&nbsp;<span class="ident" id="3175642">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175648">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175652"><a href="/encoding/binary/varint.go.html#3175431">x</a></span>&nbsp;<span class="op" id="3175654">|=</span>&nbsp;<span class="ident" id="3175657">uint64</span><span class="op" id="3175663">(</span><span class="ident" id="3175664"><a href="/encoding/binary/varint.go.html#3175475">b</a></span><span class="op" id="3175665">&amp;</span><span class="num" id="3175666">0x7f</span><span class="op" id="3175670">)</span>&nbsp;<span class="op" id="3175672">&lt;&lt;</span>&nbsp;<span class="ident" id="3175675"><a href="/encoding/binary/varint.go.html#3175445">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175679"><a href="/encoding/binary/varint.go.html#3175445">s</a></span>&nbsp;<span class="op" id="3175681">+=</span>&nbsp;<span class="num" id="3175684">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175687">}</span><br>
<span class="lineno"></span><span class="op" id="3175689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3175692">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="3175773">func</span>&nbsp;<span class="ident" id="3175778">ReadVarint</span><span class="op" id="3175788">(</span><span class="ident" id="3175789">r</span>&nbsp;<span class="ident" id="3175791"><a href="/encoding/binary/varint.go.html#3173444">io</a></span><span class="op" id="3175793">.</span><span class="ident" id="3175794">ByteReader</span><span class="op" id="3175804">)</span>&nbsp;<span class="op" id="3175806">(</span><span class="ident" id="3175807">int64</span><span class="op" id="3175812">,</span>&nbsp;<span class="builtintype" id="3175814">error</span><span class="op" id="3175819">)</span>&nbsp;<span class="op" id="3175821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175824">ux</span><span class="op" id="3175826">,</span>&nbsp;<span class="ident" id="3175828">err</span>&nbsp;<span class="op" id="3175832">:=</span>&nbsp;<span class="ident" id="3175835"><a href="/encoding/binary/varint.go.html#3175379">ReadUvarint</a></span><span class="op" id="3175846">(</span><span class="ident" id="3175847"><a href="/encoding/binary/varint.go.html#3175789">r</a></span><span class="op" id="3175848">)</span>&nbsp;<span class="comment" id="3175850">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175890">x</span>&nbsp;<span class="op" id="3175892">:=</span>&nbsp;<span class="ident" id="3175895">int64</span><span class="op" id="3175900">(</span><span class="ident" id="3175901"><a href="/encoding/binary/varint.go.html#3175824">ux</a></span>&nbsp;<span class="op" id="3175904">&gt;&gt;</span>&nbsp;<span class="num" id="3175907">1</span><span class="op" id="3175908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175911">if</span>&nbsp;<span class="ident" id="3175914"><a href="/encoding/binary/varint.go.html#3175824">ux</a></span><span class="op" id="3175916">&amp;</span><span class="num" id="3175917">1</span>&nbsp;<span class="op" id="3175919">!=</span>&nbsp;<span class="num" id="3175922">0</span>&nbsp;<span class="op" id="3175924">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175928"><a href="/encoding/binary/varint.go.html#3175890">x</a></span>&nbsp;<span class="op" id="3175930">=</span>&nbsp;<span class="op" id="3175932">^</span><span class="ident" id="3175933"><a href="/encoding/binary/varint.go.html#3175890">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175939">return</span>&nbsp;<span class="ident" id="3175946"><a href="/encoding/binary/varint.go.html#3175890">x</a></span><span class="op" id="3175947">,</span>&nbsp;<span class="ident" id="3175949"><a href="/encoding/binary/varint.go.html#3175828">err</a></span><br>
<span class="lineno"></span><span class="op" id="3175953">}</span>
</div>
</body>
</html>
