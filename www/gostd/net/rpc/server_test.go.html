<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8176198">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8176253">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8176307">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8176358">package</span>&nbsp;<span class="ident" id="8176366">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8176371">import</span>&nbsp;<span class="op" id="8176378">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8176381">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8176391">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8176398">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8176404">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8176411">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8176418">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8176439">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8176450">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8176461">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8176469">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8176484">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8176495">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="8176502">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8176505">var</span>&nbsp;<span class="op" id="8176509">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8176512">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8176538">*</span><span class="ident" id="8176539">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8176547">serverAddr</span><span class="op" id="8176557">,</span>&nbsp;<span class="ident" id="8176559">newServerAddr</span>&nbsp;<span class="builtintype" id="8176573">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8176581">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8176607">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8176615">once</span><span class="op" id="8176619">,</span>&nbsp;<span class="ident" id="8176621">newOnce</span><span class="op" id="8176628">,</span>&nbsp;<span class="ident" id="8176630">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8176641">sync</span><span class="op" id="8176645">.</span><span class="ident" id="8176646">Once</span><br>
<span class="lineno"></span><span class="op" id="8176651">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8176654">const</span>&nbsp;<span class="op" id="8176660">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8176663">newHttpPath</span>&nbsp;<span class="op" id="8176675">=</span>&nbsp;<span class="string" id="8176677">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="8176684">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8176687">type</span>&nbsp;<span class="ident" id="8176692">Args</span>&nbsp;<span class="keyword" id="8176697">struct</span>&nbsp;<span class="op" id="8176704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8176707">A</span><span class="op" id="8176708">,</span>&nbsp;<span class="ident" id="8176710">B</span>&nbsp;<span class="builtintype" id="8176712">int</span><br>
<span class="lineno">35</span><span class="op" id="8176716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8176719">type</span>&nbsp;<span class="ident" id="8176724">Reply</span>&nbsp;<span class="keyword" id="8176730">struct</span>&nbsp;<span class="op" id="8176737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8176740">C</span>&nbsp;<span class="builtintype" id="8176742">int</span><br>
<span class="lineno"></span><span class="op" id="8176746">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8176749">type</span>&nbsp;<span class="ident" id="8176754">Arith</span>&nbsp;<span class="builtintype" id="8176760">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8176765">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="8176853">func</span>&nbsp;<span class="op" id="8176858">(</span><span class="ident" id="8176859">t</span>&nbsp;<span class="op" id="8176861">*</span><span class="ident" id="8176862">Arith</span><span class="op" id="8176867">)</span>&nbsp;<span class="ident" id="8176869">Add</span><span class="op" id="8176872">(</span><span class="ident" id="8176873">args</span>&nbsp;<span class="ident" id="8176878">Args</span><span class="op" id="8176882">,</span>&nbsp;<span class="ident" id="8176884">reply</span>&nbsp;<span class="op" id="8176890">*</span><span class="ident" id="8176891">Reply</span><span class="op" id="8176896">)</span>&nbsp;<span class="builtintype" id="8176898">error</span>&nbsp;<span class="op" id="8176904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8176907">reply</span><span class="op" id="8176912">.</span><span class="ident" id="8176913">C</span>&nbsp;<span class="op" id="8176915">=</span>&nbsp;<span class="ident" id="8176917">args</span><span class="op" id="8176921">.</span><span class="ident" id="8176922">A</span>&nbsp;<span class="op" id="8176924">+</span>&nbsp;<span class="ident" id="8176926">args</span><span class="op" id="8176930">.</span><span class="ident" id="8176931">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8176934">return</span>&nbsp;<span class="ident" id="8176941">nil</span><br>
<span class="lineno"></span><span class="op" id="8176945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8176948">func</span>&nbsp;<span class="op" id="8176953">(</span><span class="ident" id="8176954">t</span>&nbsp;<span class="op" id="8176956">*</span><span class="ident" id="8176957">Arith</span><span class="op" id="8176962">)</span>&nbsp;<span class="ident" id="8176964">Mul</span><span class="op" id="8176967">(</span><span class="ident" id="8176968">args</span>&nbsp;<span class="op" id="8176973">*</span><span class="ident" id="8176974">Args</span><span class="op" id="8176978">,</span>&nbsp;<span class="ident" id="8176980">reply</span>&nbsp;<span class="op" id="8176986">*</span><span class="ident" id="8176987">Reply</span><span class="op" id="8176992">)</span>&nbsp;<span class="builtintype" id="8176994">error</span>&nbsp;<span class="op" id="8177000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8177003">reply</span><span class="op" id="8177008">.</span><span class="ident" id="8177009">C</span>&nbsp;<span class="op" id="8177011">=</span>&nbsp;<span class="ident" id="8177013">args</span><span class="op" id="8177017">.</span><span class="ident" id="8177018">A</span>&nbsp;<span class="op" id="8177020">*</span>&nbsp;<span class="ident" id="8177022">args</span><span class="op" id="8177026">.</span><span class="ident" id="8177027">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8177030">return</span>&nbsp;<span class="ident" id="8177037">nil</span><br>
<span class="lineno"></span><span class="op" id="8177041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8177044">func</span>&nbsp;<span class="op" id="8177049">(</span><span class="ident" id="8177050">t</span>&nbsp;<span class="op" id="8177052">*</span><span class="ident" id="8177053">Arith</span><span class="op" id="8177058">)</span>&nbsp;<span class="ident" id="8177060">Div</span><span class="op" id="8177063">(</span><span class="ident" id="8177064">args</span>&nbsp;<span class="ident" id="8177069">Args</span><span class="op" id="8177073">,</span>&nbsp;<span class="ident" id="8177075">reply</span>&nbsp;<span class="op" id="8177081">*</span><span class="ident" id="8177082">Reply</span><span class="op" id="8177087">)</span>&nbsp;<span class="builtintype" id="8177089">error</span>&nbsp;<span class="op" id="8177095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8177098">if</span>&nbsp;<span class="ident" id="8177101">args</span><span class="op" id="8177105">.</span><span class="ident" id="8177106">B</span>&nbsp;<span class="op" id="8177108">==</span>&nbsp;<span class="num" id="8177111">0</span>&nbsp;<span class="op" id="8177113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8177117">return</span>&nbsp;<span class="ident" id="8177124">errors</span><span class="op" id="8177130">.</span><span class="ident" id="8177131">New</span><span class="op" id="8177134">(</span><span class="string" id="8177135">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="8177151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8177154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8177157">reply</span><span class="op" id="8177162">.</span><span class="ident" id="8177163">C</span>&nbsp;<span class="op" id="8177165">=</span>&nbsp;<span class="ident" id="8177167">args</span><span class="op" id="8177171">.</span><span class="ident" id="8177172">A</span>&nbsp;<span class="op" id="8177174">/</span>&nbsp;<span class="ident" id="8177176">args</span><span class="op" id="8177180">.</span><span class="ident" id="8177181">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8177184">return</span>&nbsp;<span class="ident" id="8177191">nil</span><br>
<span class="lineno"></span><span class="op" id="8177195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8177198">func</span>&nbsp;<span class="op" id="8177203">(</span><span class="ident" id="8177204">t</span>&nbsp;<span class="op" id="8177206">*</span><span class="ident" id="8177207">Arith</span><span class="op" id="8177212">)</span>&nbsp;<span class="ident" id="8177214">String</span><span class="op" id="8177220">(</span><span class="ident" id="8177221">args</span>&nbsp;<span class="op" id="8177226">*</span><span class="ident" id="8177227">Args</span><span class="op" id="8177231">,</span>&nbsp;<span class="ident" id="8177233">reply</span>&nbsp;<span class="op" id="8177239">*</span><span class="builtintype" id="8177240">string</span><span class="op" id="8177246">)</span>&nbsp;<span class="builtintype" id="8177248">error</span>&nbsp;<span class="op" id="8177254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8177257">*</span><span class="ident" id="8177258">reply</span>&nbsp;<span class="op" id="8177264">=</span>&nbsp;<span class="ident" id="8177266">fmt</span><span class="op" id="8177269">.</span><span class="ident" id="8177270">Sprintf</span><span class="op" id="8177277">(</span><span class="string" id="8177278">&#34;%d+%d=%d&#34;</span><span class="op" id="8177288">,</span>&nbsp;<span class="ident" id="8177290">args</span><span class="op" id="8177294">.</span><span class="ident" id="8177295">A</span><span class="op" id="8177296">,</span>&nbsp;<span class="ident" id="8177298">args</span><span class="op" id="8177302">.</span><span class="ident" id="8177303">B</span><span class="op" id="8177304">,</span>&nbsp;<span class="ident" id="8177306">args</span><span class="op" id="8177310">.</span><span class="ident" id="8177311">A</span><span class="op" id="8177312">+</span><span class="ident" id="8177313">args</span><span class="op" id="8177317">.</span><span class="ident" id="8177318">B</span><span class="op" id="8177319">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8177322">return</span>&nbsp;<span class="ident" id="8177329">nil</span><br>
<span class="lineno"></span><span class="op" id="8177333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8177336">func</span>&nbsp;<span class="op" id="8177341">(</span><span class="ident" id="8177342">t</span>&nbsp;<span class="op" id="8177344">*</span><span class="ident" id="8177345">Arith</span><span class="op" id="8177350">)</span>&nbsp;<span class="ident" id="8177352">Scan</span><span class="op" id="8177356">(</span><span class="ident" id="8177357">args</span>&nbsp;<span class="builtintype" id="8177362">string</span><span class="op" id="8177368">,</span>&nbsp;<span class="ident" id="8177370">reply</span>&nbsp;<span class="op" id="8177376">*</span><span class="ident" id="8177377">Reply</span><span class="op" id="8177382">)</span>&nbsp;<span class="op" id="8177384">(</span><span class="ident" id="8177385">err</span>&nbsp;<span class="builtintype" id="8177389">error</span><span class="op" id="8177394">)</span>&nbsp;<span class="op" id="8177396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8177399">_</span><span class="op" id="8177400">,</span>&nbsp;<span class="ident" id="8177402">err</span>&nbsp;<span class="op" id="8177406">=</span>&nbsp;<span class="ident" id="8177408">fmt</span><span class="op" id="8177411">.</span><span class="ident" id="8177412">Sscan</span><span class="op" id="8177417">(</span><span class="ident" id="8177418">args</span><span class="op" id="8177422">,</span>&nbsp;<span class="op" id="8177424">&amp;</span><span class="ident" id="8177425">reply</span><span class="op" id="8177430">.</span><span class="ident" id="8177431">C</span><span class="op" id="8177432">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8177435">return</span><br>
<span class="lineno"></span><span class="op" id="8177442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8177445">func</span>&nbsp;<span class="op" id="8177450">(</span><span class="ident" id="8177451">t</span>&nbsp;<span class="op" id="8177453">*</span><span class="ident" id="8177454">Arith</span><span class="op" id="8177459">)</span>&nbsp;<span class="ident" id="8177461">Error</span><span class="op" id="8177466">(</span><span class="ident" id="8177467">args</span>&nbsp;<span class="op" id="8177472">*</span><span class="ident" id="8177473">Args</span><span class="op" id="8177477">,</span>&nbsp;<span class="ident" id="8177479">reply</span>&nbsp;<span class="op" id="8177485">*</span><span class="ident" id="8177486">Reply</span><span class="op" id="8177491">)</span>&nbsp;<span class="builtintype" id="8177493">error</span>&nbsp;<span class="op" id="8177499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8177502">panic</span><span class="op" id="8177507">(</span><span class="string" id="8177508">&#34;ERROR&#34;</span><span class="op" id="8177515">)</span><br>
<span class="lineno">75</span><span class="op" id="8177517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8177520">func</span>&nbsp;<span class="ident" id="8177525">listenTCP</span><span class="op" id="8177534">(</span><span class="op" id="8177535">)</span>&nbsp;<span class="op" id="8177537">(</span><span class="ident" id="8177538">net</span><span class="op" id="8177541">.</span><span class="ident" id="8177542">Listener</span><span class="op" id="8177550">,</span>&nbsp;<span class="builtintype" id="8177552">string</span><span class="op" id="8177558">)</span>&nbsp;<span class="op" id="8177560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8177563">l</span><span class="op" id="8177564">,</span>&nbsp;<span class="ident" id="8177566">e</span>&nbsp;<span class="op" id="8177568">:=</span>&nbsp;<span class="ident" id="8177571">net</span><span class="op" id="8177574">.</span><span class="ident" id="8177575">Listen</span><span class="op" id="8177581">(</span><span class="string" id="8177582">&#34;tcp&#34;</span><span class="op" id="8177587">,</span>&nbsp;<span class="string" id="8177589">&#34;127.0.0.1:0&#34;</span><span class="op" id="8177602">)</span>&nbsp;<span class="comment" id="8177604">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8177630">if</span>&nbsp;<span class="ident" id="8177633">e</span>&nbsp;<span class="op" id="8177635">!=</span>&nbsp;<span class="ident" id="8177638">nil</span>&nbsp;<span class="op" id="8177642">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8177646">log</span><span class="op" id="8177649">.</span><span class="ident" id="8177650">Fatalf</span><span class="op" id="8177656">(</span><span class="string" id="8177657">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="8177680">,</span>&nbsp;<span class="ident" id="8177682">e</span><span class="op" id="8177683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8177686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8177689">return</span>&nbsp;<span class="ident" id="8177696">l</span><span class="op" id="8177697">,</span>&nbsp;<span class="ident" id="8177699">l</span><span class="op" id="8177700">.</span><span class="ident" id="8177701">Addr</span><span class="op" id="8177705">(</span><span class="op" id="8177706">)</span><span class="op" id="8177707">.</span><span class="ident" id="8177708">String</span><span class="op" id="8177714">(</span><span class="op" id="8177715">)</span><br>
<span class="lineno"></span><span class="op" id="8177717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="8177720">func</span>&nbsp;<span class="ident" id="8177725">startServer</span><span class="op" id="8177736">(</span><span class="op" id="8177737">)</span>&nbsp;<span class="op" id="8177739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8177742">Register</span><span class="op" id="8177750">(</span><span class="builtinfunc" id="8177751">new</span><span class="op" id="8177754">(</span><span class="ident" id="8177755">Arith</span><span class="op" id="8177760">)</span><span class="op" id="8177761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8177764">RegisterName</span><span class="op" id="8177776">(</span><span class="string" id="8177777">&#34;net.rpc.Arith&#34;</span><span class="op" id="8177792">,</span>&nbsp;<span class="builtinfunc" id="8177794">new</span><span class="op" id="8177797">(</span><span class="ident" id="8177798">Arith</span><span class="op" id="8177803">)</span><span class="op" id="8177804">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8177808">var</span>&nbsp;<span class="ident" id="8177812">l</span>&nbsp;<span class="ident" id="8177814">net</span><span class="op" id="8177817">.</span><span class="ident" id="8177818">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8177828">l</span><span class="op" id="8177829">,</span>&nbsp;<span class="ident" id="8177831">serverAddr</span>&nbsp;<span class="op" id="8177842">=</span>&nbsp;<span class="ident" id="8177844">listenTCP</span><span class="op" id="8177853">(</span><span class="op" id="8177854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8177857">log</span><span class="op" id="8177860">.</span><span class="ident" id="8177861">Println</span><span class="op" id="8177868">(</span><span class="string" id="8177869">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="8177899">,</span>&nbsp;<span class="ident" id="8177901">serverAddr</span><span class="op" id="8177911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8177914">go</span>&nbsp;<span class="ident" id="8177917">Accept</span><span class="op" id="8177923">(</span><span class="ident" id="8177924">l</span><span class="op" id="8177925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8177929">HandleHTTP</span><span class="op" id="8177939">(</span><span class="op" id="8177940">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8177943">httpOnce</span><span class="op" id="8177951">.</span><span class="ident" id="8177952">Do</span><span class="op" id="8177954">(</span><span class="ident" id="8177955">startHttpServer</span><span class="op" id="8177970">)</span><br>
<span class="lineno"></span><span class="op" id="8177972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8177975">func</span>&nbsp;<span class="ident" id="8177980">startNewServer</span><span class="op" id="8177994">(</span><span class="op" id="8177995">)</span>&nbsp;<span class="op" id="8177997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178000">newServer</span>&nbsp;<span class="op" id="8178010">=</span>&nbsp;<span class="ident" id="8178012">NewServer</span><span class="op" id="8178021">(</span><span class="op" id="8178022">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178025">newServer</span><span class="op" id="8178034">.</span><span class="ident" id="8178035">Register</span><span class="op" id="8178043">(</span><span class="builtinfunc" id="8178044">new</span><span class="op" id="8178047">(</span><span class="ident" id="8178048">Arith</span><span class="op" id="8178053">)</span><span class="op" id="8178054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178057">newServer</span><span class="op" id="8178066">.</span><span class="ident" id="8178067">RegisterName</span><span class="op" id="8178079">(</span><span class="string" id="8178080">&#34;net.rpc.Arith&#34;</span><span class="op" id="8178095">,</span>&nbsp;<span class="builtinfunc" id="8178097">new</span><span class="op" id="8178100">(</span><span class="ident" id="8178101">Arith</span><span class="op" id="8178106">)</span><span class="op" id="8178107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178110">newServer</span><span class="op" id="8178119">.</span><span class="ident" id="8178120">RegisterName</span><span class="op" id="8178132">(</span><span class="string" id="8178133">&#34;newServer.Arith&#34;</span><span class="op" id="8178150">,</span>&nbsp;<span class="builtinfunc" id="8178152">new</span><span class="op" id="8178155">(</span><span class="ident" id="8178156">Arith</span><span class="op" id="8178161">)</span><span class="op" id="8178162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8178166">var</span>&nbsp;<span class="ident" id="8178170">l</span>&nbsp;<span class="ident" id="8178172">net</span><span class="op" id="8178175">.</span><span class="ident" id="8178176">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178186">l</span><span class="op" id="8178187">,</span>&nbsp;<span class="ident" id="8178189">newServerAddr</span>&nbsp;<span class="op" id="8178203">=</span>&nbsp;<span class="ident" id="8178205">listenTCP</span><span class="op" id="8178214">(</span><span class="op" id="8178215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178218">log</span><span class="op" id="8178221">.</span><span class="ident" id="8178222">Println</span><span class="op" id="8178229">(</span><span class="string" id="8178230">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="8178270">,</span>&nbsp;<span class="ident" id="8178272">newServerAddr</span><span class="op" id="8178285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8178288">go</span>&nbsp;<span class="ident" id="8178291">newServer</span><span class="op" id="8178300">.</span><span class="ident" id="8178301">Accept</span><span class="op" id="8178307">(</span><span class="ident" id="8178308">l</span><span class="op" id="8178309">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178313">newServer</span><span class="op" id="8178322">.</span><span class="ident" id="8178323">HandleHTTP</span><span class="op" id="8178333">(</span><span class="ident" id="8178334">newHttpPath</span><span class="op" id="8178345">,</span>&nbsp;<span class="string" id="8178347">&#34;/bar&#34;</span><span class="op" id="8178353">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178356">httpOnce</span><span class="op" id="8178364">.</span><span class="ident" id="8178365">Do</span><span class="op" id="8178367">(</span><span class="ident" id="8178368">startHttpServer</span><span class="op" id="8178383">)</span><br>
<span class="lineno"></span><span class="op" id="8178385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8178388">func</span>&nbsp;<span class="ident" id="8178393">startHttpServer</span><span class="op" id="8178408">(</span><span class="op" id="8178409">)</span>&nbsp;<span class="op" id="8178411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178414">server</span>&nbsp;<span class="op" id="8178421">:=</span>&nbsp;<span class="ident" id="8178424">httptest</span><span class="op" id="8178432">.</span><span class="ident" id="8178433">NewServer</span><span class="op" id="8178442">(</span><span class="ident" id="8178443">nil</span><span class="op" id="8178446">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178449">httpServerAddr</span>&nbsp;<span class="op" id="8178464">=</span>&nbsp;<span class="ident" id="8178466">server</span><span class="op" id="8178472">.</span><span class="ident" id="8178473">Listener</span><span class="op" id="8178481">.</span><span class="ident" id="8178482">Addr</span><span class="op" id="8178486">(</span><span class="op" id="8178487">)</span><span class="op" id="8178488">.</span><span class="ident" id="8178489">String</span><span class="op" id="8178495">(</span><span class="op" id="8178496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178499">log</span><span class="op" id="8178502">.</span><span class="ident" id="8178503">Println</span><span class="op" id="8178510">(</span><span class="string" id="8178511">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="8178546">,</span>&nbsp;<span class="ident" id="8178548">httpServerAddr</span><span class="op" id="8178562">)</span><br>
<span class="lineno"></span><span class="op" id="8178564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8178567">func</span>&nbsp;<span class="ident" id="8178572">TestRPC</span><span class="op" id="8178579">(</span><span class="ident" id="8178580">t</span>&nbsp;<span class="op" id="8178582">*</span><span class="ident" id="8178583">testing</span><span class="op" id="8178590">.</span><span class="ident" id="8178591">T</span><span class="op" id="8178592">)</span>&nbsp;<span class="op" id="8178594">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178597">once</span><span class="op" id="8178601">.</span><span class="ident" id="8178602">Do</span><span class="op" id="8178604">(</span><span class="ident" id="8178605">startServer</span><span class="op" id="8178616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178619">testRPC</span><span class="op" id="8178626">(</span><span class="ident" id="8178627">t</span><span class="op" id="8178628">,</span>&nbsp;<span class="ident" id="8178630">serverAddr</span><span class="op" id="8178640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178643">newOnce</span><span class="op" id="8178650">.</span><span class="ident" id="8178651">Do</span><span class="op" id="8178653">(</span><span class="ident" id="8178654">startNewServer</span><span class="op" id="8178668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178671">testRPC</span><span class="op" id="8178678">(</span><span class="ident" id="8178679">t</span><span class="op" id="8178680">,</span>&nbsp;<span class="ident" id="8178682">newServerAddr</span><span class="op" id="8178695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178698">testNewServerRPC</span><span class="op" id="8178714">(</span><span class="ident" id="8178715">t</span><span class="op" id="8178716">,</span>&nbsp;<span class="ident" id="8178718">newServerAddr</span><span class="op" id="8178731">)</span><br>
<span class="lineno">125</span><span class="op" id="8178733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8178736">func</span>&nbsp;<span class="ident" id="8178741">testRPC</span><span class="op" id="8178748">(</span><span class="ident" id="8178749">t</span>&nbsp;<span class="op" id="8178751">*</span><span class="ident" id="8178752">testing</span><span class="op" id="8178759">.</span><span class="ident" id="8178760">T</span><span class="op" id="8178761">,</span>&nbsp;<span class="ident" id="8178763">addr</span>&nbsp;<span class="builtintype" id="8178768">string</span><span class="op" id="8178774">)</span>&nbsp;<span class="op" id="8178776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178779">client</span><span class="op" id="8178785">,</span>&nbsp;<span class="ident" id="8178787">err</span>&nbsp;<span class="op" id="8178791">:=</span>&nbsp;<span class="ident" id="8178794">Dial</span><span class="op" id="8178798">(</span><span class="string" id="8178799">&#34;tcp&#34;</span><span class="op" id="8178804">,</span>&nbsp;<span class="ident" id="8178806">addr</span><span class="op" id="8178810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8178813">if</span>&nbsp;<span class="ident" id="8178816">err</span>&nbsp;<span class="op" id="8178820">!=</span>&nbsp;<span class="ident" id="8178823">nil</span>&nbsp;<span class="op" id="8178827">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178831">t</span><span class="op" id="8178832">.</span><span class="ident" id="8178833">Fatal</span><span class="op" id="8178838">(</span><span class="string" id="8178839">&#34;dialing&#34;</span><span class="op" id="8178848">,</span>&nbsp;<span class="ident" id="8178850">err</span><span class="op" id="8178853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8178856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8178859">defer</span>&nbsp;<span class="ident" id="8178865">client</span><span class="op" id="8178871">.</span><span class="ident" id="8178872">Close</span><span class="op" id="8178877">(</span><span class="op" id="8178878">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8178882">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178904">args</span>&nbsp;<span class="op" id="8178909">:=</span>&nbsp;<span class="op" id="8178912">&amp;</span><span class="ident" id="8178913">Args</span><span class="op" id="8178917">{</span><span class="num" id="8178918">7</span><span class="op" id="8178919">,</span>&nbsp;<span class="num" id="8178921">8</span><span class="op" id="8178922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178925">reply</span>&nbsp;<span class="op" id="8178931">:=</span>&nbsp;<span class="builtinfunc" id="8178934">new</span><span class="op" id="8178937">(</span><span class="ident" id="8178938">Reply</span><span class="op" id="8178943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8178946">err</span>&nbsp;<span class="op" id="8178950">=</span>&nbsp;<span class="ident" id="8178952">client</span><span class="op" id="8178958">.</span><span class="ident" id="8178959">Call</span><span class="op" id="8178963">(</span><span class="string" id="8178964">&#34;Arith.Add&#34;</span><span class="op" id="8178975">,</span>&nbsp;<span class="ident" id="8178977">args</span><span class="op" id="8178981">,</span>&nbsp;<span class="ident" id="8178983">reply</span><span class="op" id="8178988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8178991">if</span>&nbsp;<span class="ident" id="8178994">err</span>&nbsp;<span class="op" id="8178998">!=</span>&nbsp;<span class="ident" id="8179001">nil</span>&nbsp;<span class="op" id="8179005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179009">t</span><span class="op" id="8179010">.</span><span class="ident" id="8179011">Errorf</span><span class="op" id="8179017">(</span><span class="string" id="8179018">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8179060">,</span>&nbsp;<span class="ident" id="8179062">err</span><span class="op" id="8179065">.</span><span class="ident" id="8179066">Error</span><span class="op" id="8179071">(</span><span class="op" id="8179072">)</span><span class="op" id="8179073">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8179079">if</span>&nbsp;<span class="ident" id="8179082">reply</span><span class="op" id="8179087">.</span><span class="ident" id="8179088">C</span>&nbsp;<span class="op" id="8179090">!=</span>&nbsp;<span class="ident" id="8179093">args</span><span class="op" id="8179097">.</span><span class="ident" id="8179098">A</span><span class="op" id="8179099">+</span><span class="ident" id="8179100">args</span><span class="op" id="8179104">.</span><span class="ident" id="8179105">B</span>&nbsp;<span class="op" id="8179107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179111">t</span><span class="op" id="8179112">.</span><span class="ident" id="8179113">Errorf</span><span class="op" id="8179119">(</span><span class="string" id="8179120">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8179145">,</span>&nbsp;<span class="ident" id="8179147">reply</span><span class="op" id="8179152">.</span><span class="ident" id="8179153">C</span><span class="op" id="8179154">,</span>&nbsp;<span class="ident" id="8179156">args</span><span class="op" id="8179160">.</span><span class="ident" id="8179161">A</span><span class="op" id="8179162">+</span><span class="ident" id="8179163">args</span><span class="op" id="8179167">.</span><span class="ident" id="8179168">B</span><span class="op" id="8179169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8179176">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179199">args</span>&nbsp;<span class="op" id="8179204">=</span>&nbsp;<span class="op" id="8179206">&amp;</span><span class="ident" id="8179207">Args</span><span class="op" id="8179211">{</span><span class="num" id="8179212">7</span><span class="op" id="8179213">,</span>&nbsp;<span class="num" id="8179215">0</span><span class="op" id="8179216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179219">reply</span>&nbsp;<span class="op" id="8179225">=</span>&nbsp;<span class="builtinfunc" id="8179227">new</span><span class="op" id="8179230">(</span><span class="ident" id="8179231">Reply</span><span class="op" id="8179236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179239">err</span>&nbsp;<span class="op" id="8179243">=</span>&nbsp;<span class="ident" id="8179245">client</span><span class="op" id="8179251">.</span><span class="ident" id="8179252">Call</span><span class="op" id="8179256">(</span><span class="string" id="8179257">&#34;Arith.BadOperation&#34;</span><span class="op" id="8179277">,</span>&nbsp;<span class="ident" id="8179279">args</span><span class="op" id="8179283">,</span>&nbsp;<span class="ident" id="8179285">reply</span><span class="op" id="8179290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8179293">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8179313">if</span>&nbsp;<span class="ident" id="8179316">err</span>&nbsp;<span class="op" id="8179320">==</span>&nbsp;<span class="ident" id="8179323">nil</span>&nbsp;<span class="op" id="8179327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179331">t</span><span class="op" id="8179332">.</span><span class="ident" id="8179333">Error</span><span class="op" id="8179338">(</span><span class="string" id="8179339">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8179369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179372">}</span>&nbsp;<span class="keyword" id="8179374">else</span>&nbsp;<span class="keyword" id="8179379">if</span>&nbsp;<span class="op" id="8179382">!</span><span class="ident" id="8179383">strings</span><span class="op" id="8179390">.</span><span class="ident" id="8179391">HasPrefix</span><span class="op" id="8179400">(</span><span class="ident" id="8179401">err</span><span class="op" id="8179404">.</span><span class="ident" id="8179405">Error</span><span class="op" id="8179410">(</span><span class="op" id="8179411">)</span><span class="op" id="8179412">,</span>&nbsp;<span class="string" id="8179414">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="8179439">)</span>&nbsp;<span class="op" id="8179441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179445">t</span><span class="op" id="8179446">.</span><span class="ident" id="8179447">Errorf</span><span class="op" id="8179453">(</span><span class="string" id="8179454">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8179510">,</span>&nbsp;<span class="ident" id="8179512">err</span><span class="op" id="8179515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179518">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8179522">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179542">args</span>&nbsp;<span class="op" id="8179547">=</span>&nbsp;<span class="op" id="8179549">&amp;</span><span class="ident" id="8179550">Args</span><span class="op" id="8179554">{</span><span class="num" id="8179555">7</span><span class="op" id="8179556">,</span>&nbsp;<span class="num" id="8179558">8</span><span class="op" id="8179559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179562">reply</span>&nbsp;<span class="op" id="8179568">=</span>&nbsp;<span class="builtinfunc" id="8179570">new</span><span class="op" id="8179573">(</span><span class="ident" id="8179574">Reply</span><span class="op" id="8179579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179582">err</span>&nbsp;<span class="op" id="8179586">=</span>&nbsp;<span class="ident" id="8179588">client</span><span class="op" id="8179594">.</span><span class="ident" id="8179595">Call</span><span class="op" id="8179599">(</span><span class="string" id="8179600">&#34;Arith.Unknown&#34;</span><span class="op" id="8179615">,</span>&nbsp;<span class="ident" id="8179617">args</span><span class="op" id="8179621">,</span>&nbsp;<span class="ident" id="8179623">reply</span><span class="op" id="8179628">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8179631">if</span>&nbsp;<span class="ident" id="8179634">err</span>&nbsp;<span class="op" id="8179638">==</span>&nbsp;<span class="ident" id="8179641">nil</span>&nbsp;<span class="op" id="8179645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179649">t</span><span class="op" id="8179650">.</span><span class="ident" id="8179651">Error</span><span class="op" id="8179656">(</span><span class="string" id="8179657">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="8179697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179700">}</span>&nbsp;<span class="keyword" id="8179702">else</span>&nbsp;<span class="keyword" id="8179707">if</span>&nbsp;<span class="ident" id="8179710">strings</span><span class="op" id="8179717">.</span><span class="ident" id="8179718">Index</span><span class="op" id="8179723">(</span><span class="ident" id="8179724">err</span><span class="op" id="8179727">.</span><span class="ident" id="8179728">Error</span><span class="op" id="8179733">(</span><span class="op" id="8179734">)</span><span class="op" id="8179735">,</span>&nbsp;<span class="string" id="8179737">&#34;method&#34;</span><span class="op" id="8179745">)</span>&nbsp;<span class="op" id="8179747">&lt;</span>&nbsp;<span class="num" id="8179749">0</span>&nbsp;<span class="op" id="8179751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179755">t</span><span class="op" id="8179756">.</span><span class="ident" id="8179757">Error</span><span class="op" id="8179762">(</span><span class="string" id="8179763">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="8179797">,</span>&nbsp;<span class="ident" id="8179799">err</span><span class="op" id="8179802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179805">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8179809">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179827">args</span>&nbsp;<span class="op" id="8179832">=</span>&nbsp;<span class="op" id="8179834">&amp;</span><span class="ident" id="8179835">Args</span><span class="op" id="8179839">{</span><span class="num" id="8179840">7</span><span class="op" id="8179841">,</span>&nbsp;<span class="num" id="8179843">8</span><span class="op" id="8179844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179847">mulReply</span>&nbsp;<span class="op" id="8179856">:=</span>&nbsp;<span class="builtinfunc" id="8179859">new</span><span class="op" id="8179862">(</span><span class="ident" id="8179863">Reply</span><span class="op" id="8179868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179871">mulCall</span>&nbsp;<span class="op" id="8179879">:=</span>&nbsp;<span class="ident" id="8179882">client</span><span class="op" id="8179888">.</span><span class="ident" id="8179889">Go</span><span class="op" id="8179891">(</span><span class="string" id="8179892">&#34;Arith.Mul&#34;</span><span class="op" id="8179903">,</span>&nbsp;<span class="ident" id="8179905">args</span><span class="op" id="8179909">,</span>&nbsp;<span class="ident" id="8179911">mulReply</span><span class="op" id="8179919">,</span>&nbsp;<span class="ident" id="8179921">nil</span><span class="op" id="8179924">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179927">addReply</span>&nbsp;<span class="op" id="8179936">:=</span>&nbsp;<span class="builtinfunc" id="8179939">new</span><span class="op" id="8179942">(</span><span class="ident" id="8179943">Reply</span><span class="op" id="8179948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179951">addCall</span>&nbsp;<span class="op" id="8179959">:=</span>&nbsp;<span class="ident" id="8179962">client</span><span class="op" id="8179968">.</span><span class="ident" id="8179969">Go</span><span class="op" id="8179971">(</span><span class="string" id="8179972">&#34;Arith.Add&#34;</span><span class="op" id="8179983">,</span>&nbsp;<span class="ident" id="8179985">args</span><span class="op" id="8179989">,</span>&nbsp;<span class="ident" id="8179991">addReply</span><span class="op" id="8179999">,</span>&nbsp;<span class="ident" id="8180001">nil</span><span class="op" id="8180004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180008">addCall</span>&nbsp;<span class="op" id="8180016">=</span>&nbsp;<span class="op" id="8180018">&lt;-</span><span class="ident" id="8180020">addCall</span><span class="op" id="8180027">.</span><span class="ident" id="8180028">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180034">if</span>&nbsp;<span class="ident" id="8180037">addCall</span><span class="op" id="8180044">.</span><span class="ident" id="8180045">Error</span>&nbsp;<span class="op" id="8180051">!=</span>&nbsp;<span class="ident" id="8180054">nil</span>&nbsp;<span class="op" id="8180058">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180062">t</span><span class="op" id="8180063">.</span><span class="ident" id="8180064">Errorf</span><span class="op" id="8180070">(</span><span class="string" id="8180071">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8180113">,</span>&nbsp;<span class="ident" id="8180115">addCall</span><span class="op" id="8180122">.</span><span class="ident" id="8180123">Error</span><span class="op" id="8180128">.</span><span class="ident" id="8180129">Error</span><span class="op" id="8180134">(</span><span class="op" id="8180135">)</span><span class="op" id="8180136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180142">if</span>&nbsp;<span class="ident" id="8180145">addReply</span><span class="op" id="8180153">.</span><span class="ident" id="8180154">C</span>&nbsp;<span class="op" id="8180156">!=</span>&nbsp;<span class="ident" id="8180159">args</span><span class="op" id="8180163">.</span><span class="ident" id="8180164">A</span><span class="op" id="8180165">+</span><span class="ident" id="8180166">args</span><span class="op" id="8180170">.</span><span class="ident" id="8180171">B</span>&nbsp;<span class="op" id="8180173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180177">t</span><span class="op" id="8180178">.</span><span class="ident" id="8180179">Errorf</span><span class="op" id="8180185">(</span><span class="string" id="8180186">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8180211">,</span>&nbsp;<span class="ident" id="8180213">addReply</span><span class="op" id="8180221">.</span><span class="ident" id="8180222">C</span><span class="op" id="8180223">,</span>&nbsp;<span class="ident" id="8180225">args</span><span class="op" id="8180229">.</span><span class="ident" id="8180230">A</span><span class="op" id="8180231">+</span><span class="ident" id="8180232">args</span><span class="op" id="8180236">.</span><span class="ident" id="8180237">B</span><span class="op" id="8180238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180241">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180245">mulCall</span>&nbsp;<span class="op" id="8180253">=</span>&nbsp;<span class="op" id="8180255">&lt;-</span><span class="ident" id="8180257">mulCall</span><span class="op" id="8180264">.</span><span class="ident" id="8180265">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180271">if</span>&nbsp;<span class="ident" id="8180274">mulCall</span><span class="op" id="8180281">.</span><span class="ident" id="8180282">Error</span>&nbsp;<span class="op" id="8180288">!=</span>&nbsp;<span class="ident" id="8180291">nil</span>&nbsp;<span class="op" id="8180295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180299">t</span><span class="op" id="8180300">.</span><span class="ident" id="8180301">Errorf</span><span class="op" id="8180307">(</span><span class="string" id="8180308">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8180350">,</span>&nbsp;<span class="ident" id="8180352">mulCall</span><span class="op" id="8180359">.</span><span class="ident" id="8180360">Error</span><span class="op" id="8180365">.</span><span class="ident" id="8180366">Error</span><span class="op" id="8180371">(</span><span class="op" id="8180372">)</span><span class="op" id="8180373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180376">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180379">if</span>&nbsp;<span class="ident" id="8180382">mulReply</span><span class="op" id="8180390">.</span><span class="ident" id="8180391">C</span>&nbsp;<span class="op" id="8180393">!=</span>&nbsp;<span class="ident" id="8180396">args</span><span class="op" id="8180400">.</span><span class="ident" id="8180401">A</span><span class="op" id="8180402">*</span><span class="ident" id="8180403">args</span><span class="op" id="8180407">.</span><span class="ident" id="8180408">B</span>&nbsp;<span class="op" id="8180410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180414">t</span><span class="op" id="8180415">.</span><span class="ident" id="8180416">Errorf</span><span class="op" id="8180422">(</span><span class="string" id="8180423">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8180448">,</span>&nbsp;<span class="ident" id="8180450">mulReply</span><span class="op" id="8180458">.</span><span class="ident" id="8180459">C</span><span class="op" id="8180460">,</span>&nbsp;<span class="ident" id="8180462">args</span><span class="op" id="8180466">.</span><span class="ident" id="8180467">A</span><span class="op" id="8180468">*</span><span class="ident" id="8180469">args</span><span class="op" id="8180473">.</span><span class="ident" id="8180474">B</span><span class="op" id="8180475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8180482">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180497">args</span>&nbsp;<span class="op" id="8180502">=</span>&nbsp;<span class="op" id="8180504">&amp;</span><span class="ident" id="8180505">Args</span><span class="op" id="8180509">{</span><span class="num" id="8180510">7</span><span class="op" id="8180511">,</span>&nbsp;<span class="num" id="8180513">0</span><span class="op" id="8180514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180517">reply</span>&nbsp;<span class="op" id="8180523">=</span>&nbsp;<span class="builtinfunc" id="8180525">new</span><span class="op" id="8180528">(</span><span class="ident" id="8180529">Reply</span><span class="op" id="8180534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180537">err</span>&nbsp;<span class="op" id="8180541">=</span>&nbsp;<span class="ident" id="8180543">client</span><span class="op" id="8180549">.</span><span class="ident" id="8180550">Call</span><span class="op" id="8180554">(</span><span class="string" id="8180555">&#34;Arith.Div&#34;</span><span class="op" id="8180566">,</span>&nbsp;<span class="ident" id="8180568">args</span><span class="op" id="8180572">,</span>&nbsp;<span class="ident" id="8180574">reply</span><span class="op" id="8180579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8180582">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180615">if</span>&nbsp;<span class="ident" id="8180618">err</span>&nbsp;<span class="op" id="8180622">==</span>&nbsp;<span class="ident" id="8180625">nil</span>&nbsp;<span class="op" id="8180629">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180633">t</span><span class="op" id="8180634">.</span><span class="ident" id="8180635">Error</span><span class="op" id="8180640">(</span><span class="string" id="8180641">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8180662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180665">}</span>&nbsp;<span class="keyword" id="8180667">else</span>&nbsp;<span class="keyword" id="8180672">if</span>&nbsp;<span class="ident" id="8180675">err</span><span class="op" id="8180678">.</span><span class="ident" id="8180679">Error</span><span class="op" id="8180684">(</span><span class="op" id="8180685">)</span>&nbsp;<span class="op" id="8180687">!=</span>&nbsp;<span class="string" id="8180690">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="8180707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180711">t</span><span class="op" id="8180712">.</span><span class="ident" id="8180713">Error</span><span class="op" id="8180718">(</span><span class="string" id="8180719">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8180760">,</span>&nbsp;<span class="ident" id="8180762">err</span><span class="op" id="8180765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8180772">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180786">reply</span>&nbsp;<span class="op" id="8180792">=</span>&nbsp;<span class="builtinfunc" id="8180794">new</span><span class="op" id="8180797">(</span><span class="ident" id="8180798">Reply</span><span class="op" id="8180803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180806">err</span>&nbsp;<span class="op" id="8180810">=</span>&nbsp;<span class="ident" id="8180812">client</span><span class="op" id="8180818">.</span><span class="ident" id="8180819">Call</span><span class="op" id="8180823">(</span><span class="string" id="8180824">&#34;Arith.Add&#34;</span><span class="op" id="8180835">,</span>&nbsp;<span class="ident" id="8180837">reply</span><span class="op" id="8180842">,</span>&nbsp;<span class="ident" id="8180844">reply</span><span class="op" id="8180849">)</span>&nbsp;<span class="comment" id="8180851">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180901">if</span>&nbsp;<span class="ident" id="8180904">err</span>&nbsp;<span class="op" id="8180908">==</span>&nbsp;<span class="ident" id="8180911">nil</span>&nbsp;<span class="op" id="8180915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180919">t</span><span class="op" id="8180920">.</span><span class="ident" id="8180921">Error</span><span class="op" id="8180926">(</span><span class="string" id="8180927">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="8180981">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180984">}</span>&nbsp;<span class="keyword" id="8180986">else</span>&nbsp;<span class="keyword" id="8180991">if</span>&nbsp;<span class="ident" id="8180994">strings</span><span class="op" id="8181001">.</span><span class="ident" id="8181002">Index</span><span class="op" id="8181007">(</span><span class="ident" id="8181008">err</span><span class="op" id="8181011">.</span><span class="ident" id="8181012">Error</span><span class="op" id="8181017">(</span><span class="op" id="8181018">)</span><span class="op" id="8181019">,</span>&nbsp;<span class="string" id="8181021">&#34;type&#34;</span><span class="op" id="8181027">)</span>&nbsp;<span class="op" id="8181029">&lt;</span>&nbsp;<span class="num" id="8181031">0</span>&nbsp;<span class="op" id="8181033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181037">t</span><span class="op" id="8181038">.</span><span class="ident" id="8181039">Error</span><span class="op" id="8181044">(</span><span class="string" id="8181045">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="8181077">,</span>&nbsp;<span class="ident" id="8181079">err</span><span class="op" id="8181082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8181089">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181113">const</span>&nbsp;<span class="ident" id="8181119">Val</span>&nbsp;<span class="op" id="8181123">=</span>&nbsp;<span class="num" id="8181125">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181132">str</span>&nbsp;<span class="op" id="8181136">:=</span>&nbsp;<span class="ident" id="8181139">fmt</span><span class="op" id="8181142">.</span><span class="ident" id="8181143">Sprint</span><span class="op" id="8181149">(</span><span class="ident" id="8181150">Val</span><span class="op" id="8181153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181156">reply</span>&nbsp;<span class="op" id="8181162">=</span>&nbsp;<span class="builtinfunc" id="8181164">new</span><span class="op" id="8181167">(</span><span class="ident" id="8181168">Reply</span><span class="op" id="8181173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181176">err</span>&nbsp;<span class="op" id="8181180">=</span>&nbsp;<span class="ident" id="8181182">client</span><span class="op" id="8181188">.</span><span class="ident" id="8181189">Call</span><span class="op" id="8181193">(</span><span class="string" id="8181194">&#34;Arith.Scan&#34;</span><span class="op" id="8181206">,</span>&nbsp;<span class="op" id="8181208">&amp;</span><span class="ident" id="8181209">str</span><span class="op" id="8181212">,</span>&nbsp;<span class="ident" id="8181214">reply</span><span class="op" id="8181219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181222">if</span>&nbsp;<span class="ident" id="8181225">err</span>&nbsp;<span class="op" id="8181229">!=</span>&nbsp;<span class="ident" id="8181232">nil</span>&nbsp;<span class="op" id="8181236">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181240">t</span><span class="op" id="8181241">.</span><span class="ident" id="8181242">Errorf</span><span class="op" id="8181248">(</span><span class="string" id="8181249">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8181292">,</span>&nbsp;<span class="ident" id="8181294">err</span><span class="op" id="8181297">.</span><span class="ident" id="8181298">Error</span><span class="op" id="8181303">(</span><span class="op" id="8181304">)</span><span class="op" id="8181305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181308">}</span>&nbsp;<span class="keyword" id="8181310">else</span>&nbsp;<span class="keyword" id="8181315">if</span>&nbsp;<span class="ident" id="8181318">reply</span><span class="op" id="8181323">.</span><span class="ident" id="8181324">C</span>&nbsp;<span class="op" id="8181326">!=</span>&nbsp;<span class="ident" id="8181329">Val</span>&nbsp;<span class="op" id="8181333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181337">t</span><span class="op" id="8181338">.</span><span class="ident" id="8181339">Errorf</span><span class="op" id="8181345">(</span><span class="string" id="8181346">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8181372">,</span>&nbsp;<span class="ident" id="8181374">Val</span><span class="op" id="8181377">,</span>&nbsp;<span class="ident" id="8181379">reply</span><span class="op" id="8181384">.</span><span class="ident" id="8181385">C</span><span class="op" id="8181386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8181393">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181414">args</span>&nbsp;<span class="op" id="8181419">=</span>&nbsp;<span class="op" id="8181421">&amp;</span><span class="ident" id="8181422">Args</span><span class="op" id="8181426">{</span><span class="num" id="8181427">27</span><span class="op" id="8181429">,</span>&nbsp;<span class="num" id="8181431">35</span><span class="op" id="8181433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181436">str</span>&nbsp;<span class="op" id="8181440">=</span>&nbsp;<span class="string" id="8181442">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181446">err</span>&nbsp;<span class="op" id="8181450">=</span>&nbsp;<span class="ident" id="8181452">client</span><span class="op" id="8181458">.</span><span class="ident" id="8181459">Call</span><span class="op" id="8181463">(</span><span class="string" id="8181464">&#34;Arith.String&#34;</span><span class="op" id="8181478">,</span>&nbsp;<span class="ident" id="8181480">args</span><span class="op" id="8181484">,</span>&nbsp;<span class="op" id="8181486">&amp;</span><span class="ident" id="8181487">str</span><span class="op" id="8181490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181493">if</span>&nbsp;<span class="ident" id="8181496">err</span>&nbsp;<span class="op" id="8181500">!=</span>&nbsp;<span class="ident" id="8181503">nil</span>&nbsp;<span class="op" id="8181507">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181511">t</span><span class="op" id="8181512">.</span><span class="ident" id="8181513">Errorf</span><span class="op" id="8181519">(</span><span class="string" id="8181520">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8181565">,</span>&nbsp;<span class="ident" id="8181567">err</span><span class="op" id="8181570">.</span><span class="ident" id="8181571">Error</span><span class="op" id="8181576">(</span><span class="op" id="8181577">)</span><span class="op" id="8181578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181584">expect</span>&nbsp;<span class="op" id="8181591">:=</span>&nbsp;<span class="ident" id="8181594">fmt</span><span class="op" id="8181597">.</span><span class="ident" id="8181598">Sprintf</span><span class="op" id="8181605">(</span><span class="string" id="8181606">&#34;%d+%d=%d&#34;</span><span class="op" id="8181616">,</span>&nbsp;<span class="ident" id="8181618">args</span><span class="op" id="8181622">.</span><span class="ident" id="8181623">A</span><span class="op" id="8181624">,</span>&nbsp;<span class="ident" id="8181626">args</span><span class="op" id="8181630">.</span><span class="ident" id="8181631">B</span><span class="op" id="8181632">,</span>&nbsp;<span class="ident" id="8181634">args</span><span class="op" id="8181638">.</span><span class="ident" id="8181639">A</span><span class="op" id="8181640">+</span><span class="ident" id="8181641">args</span><span class="op" id="8181645">.</span><span class="ident" id="8181646">B</span><span class="op" id="8181647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181650">if</span>&nbsp;<span class="ident" id="8181653">str</span>&nbsp;<span class="op" id="8181657">!=</span>&nbsp;<span class="ident" id="8181660">expect</span>&nbsp;<span class="op" id="8181667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181671">t</span><span class="op" id="8181672">.</span><span class="ident" id="8181673">Errorf</span><span class="op" id="8181679">(</span><span class="string" id="8181680">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8181708">,</span>&nbsp;<span class="ident" id="8181710">expect</span><span class="op" id="8181716">,</span>&nbsp;<span class="ident" id="8181718">str</span><span class="op" id="8181721">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181728">args</span>&nbsp;<span class="op" id="8181733">=</span>&nbsp;<span class="op" id="8181735">&amp;</span><span class="ident" id="8181736">Args</span><span class="op" id="8181740">{</span><span class="num" id="8181741">7</span><span class="op" id="8181742">,</span>&nbsp;<span class="num" id="8181744">8</span><span class="op" id="8181745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181748">reply</span>&nbsp;<span class="op" id="8181754">=</span>&nbsp;<span class="builtinfunc" id="8181756">new</span><span class="op" id="8181759">(</span><span class="ident" id="8181760">Reply</span><span class="op" id="8181765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181768">err</span>&nbsp;<span class="op" id="8181772">=</span>&nbsp;<span class="ident" id="8181774">client</span><span class="op" id="8181780">.</span><span class="ident" id="8181781">Call</span><span class="op" id="8181785">(</span><span class="string" id="8181786">&#34;Arith.Mul&#34;</span><span class="op" id="8181797">,</span>&nbsp;<span class="ident" id="8181799">args</span><span class="op" id="8181803">,</span>&nbsp;<span class="ident" id="8181805">reply</span><span class="op" id="8181810">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181813">if</span>&nbsp;<span class="ident" id="8181816">err</span>&nbsp;<span class="op" id="8181820">!=</span>&nbsp;<span class="ident" id="8181823">nil</span>&nbsp;<span class="op" id="8181827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181831">t</span><span class="op" id="8181832">.</span><span class="ident" id="8181833">Errorf</span><span class="op" id="8181839">(</span><span class="string" id="8181840">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8181882">,</span>&nbsp;<span class="ident" id="8181884">err</span><span class="op" id="8181887">.</span><span class="ident" id="8181888">Error</span><span class="op" id="8181893">(</span><span class="op" id="8181894">)</span><span class="op" id="8181895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181901">if</span>&nbsp;<span class="ident" id="8181904">reply</span><span class="op" id="8181909">.</span><span class="ident" id="8181910">C</span>&nbsp;<span class="op" id="8181912">!=</span>&nbsp;<span class="ident" id="8181915">args</span><span class="op" id="8181919">.</span><span class="ident" id="8181920">A</span><span class="op" id="8181921">*</span><span class="ident" id="8181922">args</span><span class="op" id="8181926">.</span><span class="ident" id="8181927">B</span>&nbsp;<span class="op" id="8181929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181933">t</span><span class="op" id="8181934">.</span><span class="ident" id="8181935">Errorf</span><span class="op" id="8181941">(</span><span class="string" id="8181942">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8181967">,</span>&nbsp;<span class="ident" id="8181969">reply</span><span class="op" id="8181974">.</span><span class="ident" id="8181975">C</span><span class="op" id="8181976">,</span>&nbsp;<span class="ident" id="8181978">args</span><span class="op" id="8181982">.</span><span class="ident" id="8181983">A</span><span class="op" id="8181984">*</span><span class="ident" id="8181985">args</span><span class="op" id="8181989">.</span><span class="ident" id="8181990">B</span><span class="op" id="8181991">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8181998">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182036">args</span>&nbsp;<span class="op" id="8182041">=</span>&nbsp;<span class="op" id="8182043">&amp;</span><span class="ident" id="8182044">Args</span><span class="op" id="8182048">{</span><span class="num" id="8182049">7</span><span class="op" id="8182050">,</span>&nbsp;<span class="num" id="8182052">8</span><span class="op" id="8182053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182056">reply</span>&nbsp;<span class="op" id="8182062">=</span>&nbsp;<span class="builtinfunc" id="8182064">new</span><span class="op" id="8182067">(</span><span class="ident" id="8182068">Reply</span><span class="op" id="8182073">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182076">err</span>&nbsp;<span class="op" id="8182080">=</span>&nbsp;<span class="ident" id="8182082">client</span><span class="op" id="8182088">.</span><span class="ident" id="8182089">Call</span><span class="op" id="8182093">(</span><span class="string" id="8182094">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="8182113">,</span>&nbsp;<span class="ident" id="8182115">args</span><span class="op" id="8182119">,</span>&nbsp;<span class="ident" id="8182121">reply</span><span class="op" id="8182126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182129">if</span>&nbsp;<span class="ident" id="8182132">err</span>&nbsp;<span class="op" id="8182136">!=</span>&nbsp;<span class="ident" id="8182139">nil</span>&nbsp;<span class="op" id="8182143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182147">t</span><span class="op" id="8182148">.</span><span class="ident" id="8182149">Errorf</span><span class="op" id="8182155">(</span><span class="string" id="8182156">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8182198">,</span>&nbsp;<span class="ident" id="8182200">err</span><span class="op" id="8182203">.</span><span class="ident" id="8182204">Error</span><span class="op" id="8182209">(</span><span class="op" id="8182210">)</span><span class="op" id="8182211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182217">if</span>&nbsp;<span class="ident" id="8182220">reply</span><span class="op" id="8182225">.</span><span class="ident" id="8182226">C</span>&nbsp;<span class="op" id="8182228">!=</span>&nbsp;<span class="ident" id="8182231">args</span><span class="op" id="8182235">.</span><span class="ident" id="8182236">A</span><span class="op" id="8182237">+</span><span class="ident" id="8182238">args</span><span class="op" id="8182242">.</span><span class="ident" id="8182243">B</span>&nbsp;<span class="op" id="8182245">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182249">t</span><span class="op" id="8182250">.</span><span class="ident" id="8182251">Errorf</span><span class="op" id="8182257">(</span><span class="string" id="8182258">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8182283">,</span>&nbsp;<span class="ident" id="8182285">reply</span><span class="op" id="8182290">.</span><span class="ident" id="8182291">C</span><span class="op" id="8182292">,</span>&nbsp;<span class="ident" id="8182294">args</span><span class="op" id="8182298">.</span><span class="ident" id="8182299">A</span><span class="op" id="8182300">+</span><span class="ident" id="8182301">args</span><span class="op" id="8182305">.</span><span class="ident" id="8182306">B</span><span class="op" id="8182307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182310">}</span><br>
<span class="lineno"></span><span class="op" id="8182312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8182315">func</span>&nbsp;<span class="ident" id="8182320">testNewServerRPC</span><span class="op" id="8182336">(</span><span class="ident" id="8182337">t</span>&nbsp;<span class="op" id="8182339">*</span><span class="ident" id="8182340">testing</span><span class="op" id="8182347">.</span><span class="ident" id="8182348">T</span><span class="op" id="8182349">,</span>&nbsp;<span class="ident" id="8182351">addr</span>&nbsp;<span class="builtintype" id="8182356">string</span><span class="op" id="8182362">)</span>&nbsp;<span class="op" id="8182364">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182367">client</span><span class="op" id="8182373">,</span>&nbsp;<span class="ident" id="8182375">err</span>&nbsp;<span class="op" id="8182379">:=</span>&nbsp;<span class="ident" id="8182382">Dial</span><span class="op" id="8182386">(</span><span class="string" id="8182387">&#34;tcp&#34;</span><span class="op" id="8182392">,</span>&nbsp;<span class="ident" id="8182394">addr</span><span class="op" id="8182398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182401">if</span>&nbsp;<span class="ident" id="8182404">err</span>&nbsp;<span class="op" id="8182408">!=</span>&nbsp;<span class="ident" id="8182411">nil</span>&nbsp;<span class="op" id="8182415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182419">t</span><span class="op" id="8182420">.</span><span class="ident" id="8182421">Fatal</span><span class="op" id="8182426">(</span><span class="string" id="8182427">&#34;dialing&#34;</span><span class="op" id="8182436">,</span>&nbsp;<span class="ident" id="8182438">err</span><span class="op" id="8182441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182447">defer</span>&nbsp;<span class="ident" id="8182453">client</span><span class="op" id="8182459">.</span><span class="ident" id="8182460">Close</span><span class="op" id="8182465">(</span><span class="op" id="8182466">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8182470">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182492">args</span>&nbsp;<span class="op" id="8182497">:=</span>&nbsp;<span class="op" id="8182500">&amp;</span><span class="ident" id="8182501">Args</span><span class="op" id="8182505">{</span><span class="num" id="8182506">7</span><span class="op" id="8182507">,</span>&nbsp;<span class="num" id="8182509">8</span><span class="op" id="8182510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182513">reply</span>&nbsp;<span class="op" id="8182519">:=</span>&nbsp;<span class="builtinfunc" id="8182522">new</span><span class="op" id="8182525">(</span><span class="ident" id="8182526">Reply</span><span class="op" id="8182531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182534">err</span>&nbsp;<span class="op" id="8182538">=</span>&nbsp;<span class="ident" id="8182540">client</span><span class="op" id="8182546">.</span><span class="ident" id="8182547">Call</span><span class="op" id="8182551">(</span><span class="string" id="8182552">&#34;newServer.Arith.Add&#34;</span><span class="op" id="8182573">,</span>&nbsp;<span class="ident" id="8182575">args</span><span class="op" id="8182579">,</span>&nbsp;<span class="ident" id="8182581">reply</span><span class="op" id="8182586">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182589">if</span>&nbsp;<span class="ident" id="8182592">err</span>&nbsp;<span class="op" id="8182596">!=</span>&nbsp;<span class="ident" id="8182599">nil</span>&nbsp;<span class="op" id="8182603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182607">t</span><span class="op" id="8182608">.</span><span class="ident" id="8182609">Errorf</span><span class="op" id="8182615">(</span><span class="string" id="8182616">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8182658">,</span>&nbsp;<span class="ident" id="8182660">err</span><span class="op" id="8182663">.</span><span class="ident" id="8182664">Error</span><span class="op" id="8182669">(</span><span class="op" id="8182670">)</span><span class="op" id="8182671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182677">if</span>&nbsp;<span class="ident" id="8182680">reply</span><span class="op" id="8182685">.</span><span class="ident" id="8182686">C</span>&nbsp;<span class="op" id="8182688">!=</span>&nbsp;<span class="ident" id="8182691">args</span><span class="op" id="8182695">.</span><span class="ident" id="8182696">A</span><span class="op" id="8182697">+</span><span class="ident" id="8182698">args</span><span class="op" id="8182702">.</span><span class="ident" id="8182703">B</span>&nbsp;<span class="op" id="8182705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182709">t</span><span class="op" id="8182710">.</span><span class="ident" id="8182711">Errorf</span><span class="op" id="8182717">(</span><span class="string" id="8182718">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8182743">,</span>&nbsp;<span class="ident" id="8182745">reply</span><span class="op" id="8182750">.</span><span class="ident" id="8182751">C</span><span class="op" id="8182752">,</span>&nbsp;<span class="ident" id="8182754">args</span><span class="op" id="8182758">.</span><span class="ident" id="8182759">A</span><span class="op" id="8182760">+</span><span class="ident" id="8182761">args</span><span class="op" id="8182765">.</span><span class="ident" id="8182766">B</span><span class="op" id="8182767">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182770">}</span><br>
<span class="lineno"></span><span class="op" id="8182772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8182775">func</span>&nbsp;<span class="ident" id="8182780">TestHTTP</span><span class="op" id="8182788">(</span><span class="ident" id="8182789">t</span>&nbsp;<span class="op" id="8182791">*</span><span class="ident" id="8182792">testing</span><span class="op" id="8182799">.</span><span class="ident" id="8182800">T</span><span class="op" id="8182801">)</span>&nbsp;<span class="op" id="8182803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182806">once</span><span class="op" id="8182810">.</span><span class="ident" id="8182811">Do</span><span class="op" id="8182813">(</span><span class="ident" id="8182814">startServer</span><span class="op" id="8182825">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182828">testHTTPRPC</span><span class="op" id="8182839">(</span><span class="ident" id="8182840">t</span><span class="op" id="8182841">,</span>&nbsp;<span class="string" id="8182843">&#34;&#34;</span><span class="op" id="8182845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182848">newOnce</span><span class="op" id="8182855">.</span><span class="ident" id="8182856">Do</span><span class="op" id="8182858">(</span><span class="ident" id="8182859">startNewServer</span><span class="op" id="8182873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182876">testHTTPRPC</span><span class="op" id="8182887">(</span><span class="ident" id="8182888">t</span><span class="op" id="8182889">,</span>&nbsp;<span class="ident" id="8182891">newHttpPath</span><span class="op" id="8182902">)</span><br>
<span class="lineno"></span><span class="op" id="8182904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8182907">func</span>&nbsp;<span class="ident" id="8182912">testHTTPRPC</span><span class="op" id="8182923">(</span><span class="ident" id="8182924">t</span>&nbsp;<span class="op" id="8182926">*</span><span class="ident" id="8182927">testing</span><span class="op" id="8182934">.</span><span class="ident" id="8182935">T</span><span class="op" id="8182936">,</span>&nbsp;<span class="ident" id="8182938">path</span>&nbsp;<span class="builtintype" id="8182943">string</span><span class="op" id="8182949">)</span>&nbsp;<span class="op" id="8182951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182954">var</span>&nbsp;<span class="ident" id="8182958">client</span>&nbsp;<span class="op" id="8182965">*</span><span class="ident" id="8182966">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182974">var</span>&nbsp;<span class="ident" id="8182978">err</span>&nbsp;<span class="builtintype" id="8182982">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182989">if</span>&nbsp;<span class="ident" id="8182992">path</span>&nbsp;<span class="op" id="8182997">==</span>&nbsp;<span class="string" id="8183000">&#34;&#34;</span>&nbsp;<span class="op" id="8183003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183007">client</span><span class="op" id="8183013">,</span>&nbsp;<span class="ident" id="8183015">err</span>&nbsp;<span class="op" id="8183019">=</span>&nbsp;<span class="ident" id="8183021">DialHTTP</span><span class="op" id="8183029">(</span><span class="string" id="8183030">&#34;tcp&#34;</span><span class="op" id="8183035">,</span>&nbsp;<span class="ident" id="8183037">httpServerAddr</span><span class="op" id="8183051">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183054">}</span>&nbsp;<span class="keyword" id="8183056">else</span>&nbsp;<span class="op" id="8183061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183065">client</span><span class="op" id="8183071">,</span>&nbsp;<span class="ident" id="8183073">err</span>&nbsp;<span class="op" id="8183077">=</span>&nbsp;<span class="ident" id="8183079">DialHTTPPath</span><span class="op" id="8183091">(</span><span class="string" id="8183092">&#34;tcp&#34;</span><span class="op" id="8183097">,</span>&nbsp;<span class="ident" id="8183099">httpServerAddr</span><span class="op" id="8183113">,</span>&nbsp;<span class="ident" id="8183115">path</span><span class="op" id="8183119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183125">if</span>&nbsp;<span class="ident" id="8183128">err</span>&nbsp;<span class="op" id="8183132">!=</span>&nbsp;<span class="ident" id="8183135">nil</span>&nbsp;<span class="op" id="8183139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183143">t</span><span class="op" id="8183144">.</span><span class="ident" id="8183145">Fatal</span><span class="op" id="8183150">(</span><span class="string" id="8183151">&#34;dialing&#34;</span><span class="op" id="8183160">,</span>&nbsp;<span class="ident" id="8183162">err</span><span class="op" id="8183165">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183171">defer</span>&nbsp;<span class="ident" id="8183177">client</span><span class="op" id="8183183">.</span><span class="ident" id="8183184">Close</span><span class="op" id="8183189">(</span><span class="op" id="8183190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8183194">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183216">args</span>&nbsp;<span class="op" id="8183221">:=</span>&nbsp;<span class="op" id="8183224">&amp;</span><span class="ident" id="8183225">Args</span><span class="op" id="8183229">{</span><span class="num" id="8183230">7</span><span class="op" id="8183231">,</span>&nbsp;<span class="num" id="8183233">8</span><span class="op" id="8183234">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183237">reply</span>&nbsp;<span class="op" id="8183243">:=</span>&nbsp;<span class="builtinfunc" id="8183246">new</span><span class="op" id="8183249">(</span><span class="ident" id="8183250">Reply</span><span class="op" id="8183255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183258">err</span>&nbsp;<span class="op" id="8183262">=</span>&nbsp;<span class="ident" id="8183264">client</span><span class="op" id="8183270">.</span><span class="ident" id="8183271">Call</span><span class="op" id="8183275">(</span><span class="string" id="8183276">&#34;Arith.Add&#34;</span><span class="op" id="8183287">,</span>&nbsp;<span class="ident" id="8183289">args</span><span class="op" id="8183293">,</span>&nbsp;<span class="ident" id="8183295">reply</span><span class="op" id="8183300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183303">if</span>&nbsp;<span class="ident" id="8183306">err</span>&nbsp;<span class="op" id="8183310">!=</span>&nbsp;<span class="ident" id="8183313">nil</span>&nbsp;<span class="op" id="8183317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183321">t</span><span class="op" id="8183322">.</span><span class="ident" id="8183323">Errorf</span><span class="op" id="8183329">(</span><span class="string" id="8183330">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8183372">,</span>&nbsp;<span class="ident" id="8183374">err</span><span class="op" id="8183377">.</span><span class="ident" id="8183378">Error</span><span class="op" id="8183383">(</span><span class="op" id="8183384">)</span><span class="op" id="8183385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183388">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183391">if</span>&nbsp;<span class="ident" id="8183394">reply</span><span class="op" id="8183399">.</span><span class="ident" id="8183400">C</span>&nbsp;<span class="op" id="8183402">!=</span>&nbsp;<span class="ident" id="8183405">args</span><span class="op" id="8183409">.</span><span class="ident" id="8183410">A</span><span class="op" id="8183411">+</span><span class="ident" id="8183412">args</span><span class="op" id="8183416">.</span><span class="ident" id="8183417">B</span>&nbsp;<span class="op" id="8183419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183423">t</span><span class="op" id="8183424">.</span><span class="ident" id="8183425">Errorf</span><span class="op" id="8183431">(</span><span class="string" id="8183432">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8183457">,</span>&nbsp;<span class="ident" id="8183459">reply</span><span class="op" id="8183464">.</span><span class="ident" id="8183465">C</span><span class="op" id="8183466">,</span>&nbsp;<span class="ident" id="8183468">args</span><span class="op" id="8183472">.</span><span class="ident" id="8183473">A</span><span class="op" id="8183474">+</span><span class="ident" id="8183475">args</span><span class="op" id="8183479">.</span><span class="ident" id="8183480">B</span><span class="op" id="8183481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183484">}</span><br>
<span class="lineno"></span><span class="op" id="8183486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="8183489">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="8183562">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="8183599">type</span>&nbsp;<span class="ident" id="8183604">CodecEmulator</span>&nbsp;<span class="keyword" id="8183618">struct</span>&nbsp;<span class="op" id="8183625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183628">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8183642">*</span><span class="ident" id="8183643">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183651">serviceMethod</span>&nbsp;<span class="builtintype" id="8183665">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183673">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8183687">*</span><span class="ident" id="8183688">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183694">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8183708">*</span><span class="ident" id="8183709">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183716">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8183730">error</span><br>
<span class="lineno"></span><span class="op" id="8183736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="8183739">func</span>&nbsp;<span class="op" id="8183744">(</span><span class="ident" id="8183745">codec</span>&nbsp;<span class="op" id="8183751">*</span><span class="ident" id="8183752">CodecEmulator</span><span class="op" id="8183765">)</span>&nbsp;<span class="ident" id="8183767">Call</span><span class="op" id="8183771">(</span><span class="ident" id="8183772">serviceMethod</span>&nbsp;<span class="builtintype" id="8183786">string</span><span class="op" id="8183792">,</span>&nbsp;<span class="ident" id="8183794">args</span>&nbsp;<span class="op" id="8183799">*</span><span class="ident" id="8183800">Args</span><span class="op" id="8183804">,</span>&nbsp;<span class="ident" id="8183806">reply</span>&nbsp;<span class="op" id="8183812">*</span><span class="ident" id="8183813">Reply</span><span class="op" id="8183818">)</span>&nbsp;<span class="builtintype" id="8183820">error</span>&nbsp;<span class="op" id="8183826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183829">codec</span><span class="op" id="8183834">.</span><span class="ident" id="8183835">serviceMethod</span>&nbsp;<span class="op" id="8183849">=</span>&nbsp;<span class="ident" id="8183851">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183866">codec</span><span class="op" id="8183871">.</span><span class="ident" id="8183872">args</span>&nbsp;<span class="op" id="8183877">=</span>&nbsp;<span class="ident" id="8183879">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183885">codec</span><span class="op" id="8183890">.</span><span class="ident" id="8183891">reply</span>&nbsp;<span class="op" id="8183897">=</span>&nbsp;<span class="ident" id="8183899">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183906">codec</span><span class="op" id="8183911">.</span><span class="ident" id="8183912">err</span>&nbsp;<span class="op" id="8183916">=</span>&nbsp;<span class="ident" id="8183918">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183923">var</span>&nbsp;<span class="ident" id="8183927">serverError</span>&nbsp;<span class="builtintype" id="8183939">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183946">if</span>&nbsp;<span class="ident" id="8183949">codec</span><span class="op" id="8183954">.</span><span class="ident" id="8183955">server</span>&nbsp;<span class="op" id="8183962">==</span>&nbsp;<span class="ident" id="8183965">nil</span>&nbsp;<span class="op" id="8183969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183973">serverError</span>&nbsp;<span class="op" id="8183985">=</span>&nbsp;<span class="ident" id="8183987">ServeRequest</span><span class="op" id="8183999">(</span><span class="ident" id="8184000">codec</span><span class="op" id="8184005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184008">}</span>&nbsp;<span class="keyword" id="8184010">else</span>&nbsp;<span class="op" id="8184015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184019">serverError</span>&nbsp;<span class="op" id="8184031">=</span>&nbsp;<span class="ident" id="8184033">codec</span><span class="op" id="8184038">.</span><span class="ident" id="8184039">server</span><span class="op" id="8184045">.</span><span class="ident" id="8184046">ServeRequest</span><span class="op" id="8184058">(</span><span class="ident" id="8184059">codec</span><span class="op" id="8184064">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184070">if</span>&nbsp;<span class="ident" id="8184073">codec</span><span class="op" id="8184078">.</span><span class="ident" id="8184079">err</span>&nbsp;<span class="op" id="8184083">==</span>&nbsp;<span class="ident" id="8184086">nil</span>&nbsp;<span class="op" id="8184090">&amp;&amp;</span>&nbsp;<span class="ident" id="8184093">serverError</span>&nbsp;<span class="op" id="8184105">!=</span>&nbsp;<span class="ident" id="8184108">nil</span>&nbsp;<span class="op" id="8184112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184116">codec</span><span class="op" id="8184121">.</span><span class="ident" id="8184122">err</span>&nbsp;<span class="op" id="8184126">=</span>&nbsp;<span class="ident" id="8184128">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184144">return</span>&nbsp;<span class="ident" id="8184151">codec</span><span class="op" id="8184156">.</span><span class="ident" id="8184157">err</span><br>
<span class="lineno">330</span><span class="op" id="8184161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8184164">func</span>&nbsp;<span class="op" id="8184169">(</span><span class="ident" id="8184170">codec</span>&nbsp;<span class="op" id="8184176">*</span><span class="ident" id="8184177">CodecEmulator</span><span class="op" id="8184190">)</span>&nbsp;<span class="ident" id="8184192">ReadRequestHeader</span><span class="op" id="8184209">(</span><span class="ident" id="8184210">req</span>&nbsp;<span class="op" id="8184214">*</span><span class="ident" id="8184215">Request</span><span class="op" id="8184222">)</span>&nbsp;<span class="builtintype" id="8184224">error</span>&nbsp;<span class="op" id="8184230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184233">req</span><span class="op" id="8184236">.</span><span class="ident" id="8184237">ServiceMethod</span>&nbsp;<span class="op" id="8184251">=</span>&nbsp;<span class="ident" id="8184253">codec</span><span class="op" id="8184258">.</span><span class="ident" id="8184259">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184274">req</span><span class="op" id="8184277">.</span><span class="ident" id="8184278">Seq</span>&nbsp;<span class="op" id="8184282">=</span>&nbsp;<span class="num" id="8184284">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184287">return</span>&nbsp;<span class="ident" id="8184294">nil</span><br>
<span class="lineno"></span><span class="op" id="8184298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8184301">func</span>&nbsp;<span class="op" id="8184306">(</span><span class="ident" id="8184307">codec</span>&nbsp;<span class="op" id="8184313">*</span><span class="ident" id="8184314">CodecEmulator</span><span class="op" id="8184327">)</span>&nbsp;<span class="ident" id="8184329">ReadRequestBody</span><span class="op" id="8184344">(</span><span class="ident" id="8184345">argv</span>&nbsp;<span class="keyword" id="8184350">interface</span><span class="op" id="8184359">{</span><span class="op" id="8184360">}</span><span class="op" id="8184361">)</span>&nbsp;<span class="builtintype" id="8184363">error</span>&nbsp;<span class="op" id="8184369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184372">if</span>&nbsp;<span class="ident" id="8184375">codec</span><span class="op" id="8184380">.</span><span class="ident" id="8184381">args</span>&nbsp;<span class="op" id="8184386">==</span>&nbsp;<span class="ident" id="8184389">nil</span>&nbsp;<span class="op" id="8184393">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184397">return</span>&nbsp;<span class="ident" id="8184404">io</span><span class="op" id="8184406">.</span><span class="ident" id="8184407">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184428">*</span><span class="op" id="8184429">(</span><span class="ident" id="8184430">argv</span><span class="op" id="8184434">.</span><span class="op" id="8184435">(</span><span class="op" id="8184436">*</span><span class="ident" id="8184437">Args</span><span class="op" id="8184441">)</span><span class="op" id="8184442">)</span>&nbsp;<span class="op" id="8184444">=</span>&nbsp;<span class="op" id="8184446">*</span><span class="ident" id="8184447">codec</span><span class="op" id="8184452">.</span><span class="ident" id="8184453">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184459">return</span>&nbsp;<span class="ident" id="8184466">nil</span><br>
<span class="lineno"></span><span class="op" id="8184470">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="8184473">func</span>&nbsp;<span class="op" id="8184478">(</span><span class="ident" id="8184479">codec</span>&nbsp;<span class="op" id="8184485">*</span><span class="ident" id="8184486">CodecEmulator</span><span class="op" id="8184499">)</span>&nbsp;<span class="ident" id="8184501">WriteResponse</span><span class="op" id="8184514">(</span><span class="ident" id="8184515">resp</span>&nbsp;<span class="op" id="8184520">*</span><span class="ident" id="8184521">Response</span><span class="op" id="8184529">,</span>&nbsp;<span class="ident" id="8184531">reply</span>&nbsp;<span class="keyword" id="8184537">interface</span><span class="op" id="8184546">{</span><span class="op" id="8184547">}</span><span class="op" id="8184548">)</span>&nbsp;<span class="builtintype" id="8184550">error</span>&nbsp;<span class="op" id="8184556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184559">if</span>&nbsp;<span class="ident" id="8184562">resp</span><span class="op" id="8184566">.</span><span class="ident" id="8184567">Error</span>&nbsp;<span class="op" id="8184573">!=</span>&nbsp;<span class="string" id="8184576">&#34;&#34;</span>&nbsp;<span class="op" id="8184579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184583">codec</span><span class="op" id="8184588">.</span><span class="ident" id="8184589">err</span>&nbsp;<span class="op" id="8184593">=</span>&nbsp;<span class="ident" id="8184595">errors</span><span class="op" id="8184601">.</span><span class="ident" id="8184602">New</span><span class="op" id="8184605">(</span><span class="ident" id="8184606">resp</span><span class="op" id="8184610">.</span><span class="ident" id="8184611">Error</span><span class="op" id="8184616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184619">}</span>&nbsp;<span class="keyword" id="8184621">else</span>&nbsp;<span class="op" id="8184626">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184630">*</span><span class="ident" id="8184631">codec</span><span class="op" id="8184636">.</span><span class="ident" id="8184637">reply</span>&nbsp;<span class="op" id="8184643">=</span>&nbsp;<span class="op" id="8184645">*</span><span class="op" id="8184646">(</span><span class="ident" id="8184647">reply</span><span class="op" id="8184652">.</span><span class="op" id="8184653">(</span><span class="op" id="8184654">*</span><span class="ident" id="8184655">Reply</span><span class="op" id="8184660">)</span><span class="op" id="8184661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184667">return</span>&nbsp;<span class="ident" id="8184674">nil</span><br>
<span class="lineno"></span><span class="op" id="8184678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="8184681">func</span>&nbsp;<span class="op" id="8184686">(</span><span class="ident" id="8184687">codec</span>&nbsp;<span class="op" id="8184693">*</span><span class="ident" id="8184694">CodecEmulator</span><span class="op" id="8184707">)</span>&nbsp;<span class="ident" id="8184709">Close</span><span class="op" id="8184714">(</span><span class="op" id="8184715">)</span>&nbsp;<span class="builtintype" id="8184717">error</span>&nbsp;<span class="op" id="8184723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184726">return</span>&nbsp;<span class="ident" id="8184733">nil</span><br>
<span class="lineno"></span><span class="op" id="8184737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8184740">func</span>&nbsp;<span class="ident" id="8184745">TestServeRequest</span><span class="op" id="8184761">(</span><span class="ident" id="8184762">t</span>&nbsp;<span class="op" id="8184764">*</span><span class="ident" id="8184765">testing</span><span class="op" id="8184772">.</span><span class="ident" id="8184773">T</span><span class="op" id="8184774">)</span>&nbsp;<span class="op" id="8184776">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184779">once</span><span class="op" id="8184783">.</span><span class="ident" id="8184784">Do</span><span class="op" id="8184786">(</span><span class="ident" id="8184787">startServer</span><span class="op" id="8184798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184801">testServeRequest</span><span class="op" id="8184817">(</span><span class="ident" id="8184818">t</span><span class="op" id="8184819">,</span>&nbsp;<span class="ident" id="8184821">nil</span><span class="op" id="8184824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184827">newOnce</span><span class="op" id="8184834">.</span><span class="ident" id="8184835">Do</span><span class="op" id="8184837">(</span><span class="ident" id="8184838">startNewServer</span><span class="op" id="8184852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184855">testServeRequest</span><span class="op" id="8184871">(</span><span class="ident" id="8184872">t</span><span class="op" id="8184873">,</span>&nbsp;<span class="ident" id="8184875">newServer</span><span class="op" id="8184884">)</span><br>
<span class="lineno"></span><span class="op" id="8184886">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="8184889">func</span>&nbsp;<span class="ident" id="8184894">testServeRequest</span><span class="op" id="8184910">(</span><span class="ident" id="8184911">t</span>&nbsp;<span class="op" id="8184913">*</span><span class="ident" id="8184914">testing</span><span class="op" id="8184921">.</span><span class="ident" id="8184922">T</span><span class="op" id="8184923">,</span>&nbsp;<span class="ident" id="8184925">server</span>&nbsp;<span class="op" id="8184932">*</span><span class="ident" id="8184933">Server</span><span class="op" id="8184939">)</span>&nbsp;<span class="op" id="8184941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184944">client</span>&nbsp;<span class="op" id="8184951">:=</span>&nbsp;<span class="ident" id="8184954">CodecEmulator</span><span class="op" id="8184967">{</span><span class="ident" id="8184968">server</span><span class="op" id="8184974">:</span>&nbsp;<span class="ident" id="8184976">server</span><span class="op" id="8184982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184985">defer</span>&nbsp;<span class="ident" id="8184991">client</span><span class="op" id="8184997">.</span><span class="ident" id="8184998">Close</span><span class="op" id="8185003">(</span><span class="op" id="8185004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185008">args</span>&nbsp;<span class="op" id="8185013">:=</span>&nbsp;<span class="op" id="8185016">&amp;</span><span class="ident" id="8185017">Args</span><span class="op" id="8185021">{</span><span class="num" id="8185022">7</span><span class="op" id="8185023">,</span>&nbsp;<span class="num" id="8185025">8</span><span class="op" id="8185026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185029">reply</span>&nbsp;<span class="op" id="8185035">:=</span>&nbsp;<span class="builtinfunc" id="8185038">new</span><span class="op" id="8185041">(</span><span class="ident" id="8185042">Reply</span><span class="op" id="8185047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185050">err</span>&nbsp;<span class="op" id="8185054">:=</span>&nbsp;<span class="ident" id="8185057">client</span><span class="op" id="8185063">.</span><span class="ident" id="8185064">Call</span><span class="op" id="8185068">(</span><span class="string" id="8185069">&#34;Arith.Add&#34;</span><span class="op" id="8185080">,</span>&nbsp;<span class="ident" id="8185082">args</span><span class="op" id="8185086">,</span>&nbsp;<span class="ident" id="8185088">reply</span><span class="op" id="8185093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185096">if</span>&nbsp;<span class="ident" id="8185099">err</span>&nbsp;<span class="op" id="8185103">!=</span>&nbsp;<span class="ident" id="8185106">nil</span>&nbsp;<span class="op" id="8185110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185114">t</span><span class="op" id="8185115">.</span><span class="ident" id="8185116">Errorf</span><span class="op" id="8185122">(</span><span class="string" id="8185123">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8185165">,</span>&nbsp;<span class="ident" id="8185167">err</span><span class="op" id="8185170">.</span><span class="ident" id="8185171">Error</span><span class="op" id="8185176">(</span><span class="op" id="8185177">)</span><span class="op" id="8185178">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185184">if</span>&nbsp;<span class="ident" id="8185187">reply</span><span class="op" id="8185192">.</span><span class="ident" id="8185193">C</span>&nbsp;<span class="op" id="8185195">!=</span>&nbsp;<span class="ident" id="8185198">args</span><span class="op" id="8185202">.</span><span class="ident" id="8185203">A</span><span class="op" id="8185204">+</span><span class="ident" id="8185205">args</span><span class="op" id="8185209">.</span><span class="ident" id="8185210">B</span>&nbsp;<span class="op" id="8185212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185216">t</span><span class="op" id="8185217">.</span><span class="ident" id="8185218">Errorf</span><span class="op" id="8185224">(</span><span class="string" id="8185225">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8185250">,</span>&nbsp;<span class="ident" id="8185252">reply</span><span class="op" id="8185257">.</span><span class="ident" id="8185258">C</span><span class="op" id="8185259">,</span>&nbsp;<span class="ident" id="8185261">args</span><span class="op" id="8185265">.</span><span class="ident" id="8185266">A</span><span class="op" id="8185267">+</span><span class="ident" id="8185268">args</span><span class="op" id="8185272">.</span><span class="ident" id="8185273">B</span><span class="op" id="8185274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185281">err</span>&nbsp;<span class="op" id="8185285">=</span>&nbsp;<span class="ident" id="8185287">client</span><span class="op" id="8185293">.</span><span class="ident" id="8185294">Call</span><span class="op" id="8185298">(</span><span class="string" id="8185299">&#34;Arith.Add&#34;</span><span class="op" id="8185310">,</span>&nbsp;<span class="ident" id="8185312">nil</span><span class="op" id="8185315">,</span>&nbsp;<span class="ident" id="8185317">reply</span><span class="op" id="8185322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185325">if</span>&nbsp;<span class="ident" id="8185328">err</span>&nbsp;<span class="op" id="8185332">==</span>&nbsp;<span class="ident" id="8185335">nil</span>&nbsp;<span class="op" id="8185339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185343">t</span><span class="op" id="8185344">.</span><span class="ident" id="8185345">Errorf</span><span class="op" id="8185351">(</span><span class="string" id="8185352">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="8185399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185402">}</span><br>
<span class="lineno"></span><span class="op" id="8185404">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="8185407">type</span>&nbsp;<span class="ident" id="8185412">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="8185428">int</span><br>
<span class="lineno"></span><span class="keyword" id="8185432">type</span>&nbsp;<span class="ident" id="8185437">ArgNotPublic</span>&nbsp;<span class="builtintype" id="8185450">int</span><br>
<span class="lineno"></span><span class="keyword" id="8185454">type</span>&nbsp;<span class="ident" id="8185459">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="8185474">int</span><br>
<span class="lineno"></span><span class="keyword" id="8185478">type</span>&nbsp;<span class="ident" id="8185483">NeedsPtrType</span>&nbsp;<span class="builtintype" id="8185496">int</span><br>
<span class="lineno">390</span><span class="keyword" id="8185500">type</span>&nbsp;<span class="ident" id="8185505">local</span>&nbsp;<span class="keyword" id="8185511">struct</span><span class="op" id="8185517">{</span><span class="op" id="8185518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8185521">func</span>&nbsp;<span class="op" id="8185526">(</span><span class="ident" id="8185527">t</span>&nbsp;<span class="op" id="8185529">*</span><span class="ident" id="8185530">ReplyNotPointer</span><span class="op" id="8185545">)</span>&nbsp;<span class="ident" id="8185547">ReplyNotPointer</span><span class="op" id="8185562">(</span><span class="ident" id="8185563">args</span>&nbsp;<span class="op" id="8185568">*</span><span class="ident" id="8185569">Args</span><span class="op" id="8185573">,</span>&nbsp;<span class="ident" id="8185575">reply</span>&nbsp;<span class="ident" id="8185581">Reply</span><span class="op" id="8185586">)</span>&nbsp;<span class="builtintype" id="8185588">error</span>&nbsp;<span class="op" id="8185594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185597">return</span>&nbsp;<span class="ident" id="8185604">nil</span><br>
<span class="lineno"></span><span class="op" id="8185608">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="8185611">func</span>&nbsp;<span class="op" id="8185616">(</span><span class="ident" id="8185617">t</span>&nbsp;<span class="op" id="8185619">*</span><span class="ident" id="8185620">ArgNotPublic</span><span class="op" id="8185632">)</span>&nbsp;<span class="ident" id="8185634">ArgNotPublic</span><span class="op" id="8185646">(</span><span class="ident" id="8185647">args</span>&nbsp;<span class="op" id="8185652">*</span><span class="ident" id="8185653">local</span><span class="op" id="8185658">,</span>&nbsp;<span class="ident" id="8185660">reply</span>&nbsp;<span class="op" id="8185666">*</span><span class="ident" id="8185667">Reply</span><span class="op" id="8185672">)</span>&nbsp;<span class="builtintype" id="8185674">error</span>&nbsp;<span class="op" id="8185680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185683">return</span>&nbsp;<span class="ident" id="8185690">nil</span><br>
<span class="lineno"></span><span class="op" id="8185694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="8185697">func</span>&nbsp;<span class="op" id="8185702">(</span><span class="ident" id="8185703">t</span>&nbsp;<span class="op" id="8185705">*</span><span class="ident" id="8185706">ReplyNotPublic</span><span class="op" id="8185720">)</span>&nbsp;<span class="ident" id="8185722">ReplyNotPublic</span><span class="op" id="8185736">(</span><span class="ident" id="8185737">args</span>&nbsp;<span class="op" id="8185742">*</span><span class="ident" id="8185743">Args</span><span class="op" id="8185747">,</span>&nbsp;<span class="ident" id="8185749">reply</span>&nbsp;<span class="op" id="8185755">*</span><span class="ident" id="8185756">local</span><span class="op" id="8185761">)</span>&nbsp;<span class="builtintype" id="8185763">error</span>&nbsp;<span class="op" id="8185769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185772">return</span>&nbsp;<span class="ident" id="8185779">nil</span><br>
<span class="lineno"></span><span class="op" id="8185783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8185786">func</span>&nbsp;<span class="op" id="8185791">(</span><span class="ident" id="8185792">t</span>&nbsp;<span class="op" id="8185794">*</span><span class="ident" id="8185795">NeedsPtrType</span><span class="op" id="8185807">)</span>&nbsp;<span class="ident" id="8185809">NeedsPtrType</span><span class="op" id="8185821">(</span><span class="ident" id="8185822">args</span>&nbsp;<span class="op" id="8185827">*</span><span class="ident" id="8185828">Args</span><span class="op" id="8185832">,</span>&nbsp;<span class="ident" id="8185834">reply</span>&nbsp;<span class="op" id="8185840">*</span><span class="ident" id="8185841">Reply</span><span class="op" id="8185846">)</span>&nbsp;<span class="builtintype" id="8185848">error</span>&nbsp;<span class="op" id="8185854">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185857">return</span>&nbsp;<span class="ident" id="8185864">nil</span><br>
<span class="lineno"></span><span class="op" id="8185868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8185871">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="8185963">func</span>&nbsp;<span class="ident" id="8185968">TestRegistrationError</span><span class="op" id="8185989">(</span><span class="ident" id="8185990">t</span>&nbsp;<span class="op" id="8185992">*</span><span class="ident" id="8185993">testing</span><span class="op" id="8186000">.</span><span class="ident" id="8186001">T</span><span class="op" id="8186002">)</span>&nbsp;<span class="op" id="8186004">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186007">err</span>&nbsp;<span class="op" id="8186011">:=</span>&nbsp;<span class="ident" id="8186014">Register</span><span class="op" id="8186022">(</span><span class="builtinfunc" id="8186023">new</span><span class="op" id="8186026">(</span><span class="ident" id="8186027">ReplyNotPointer</span><span class="op" id="8186042">)</span><span class="op" id="8186043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186046">if</span>&nbsp;<span class="ident" id="8186049">err</span>&nbsp;<span class="op" id="8186053">==</span>&nbsp;<span class="ident" id="8186056">nil</span>&nbsp;<span class="op" id="8186060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186064">t</span><span class="op" id="8186065">.</span><span class="ident" id="8186066">Error</span><span class="op" id="8186071">(</span><span class="string" id="8186072">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="8186116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186122">err</span>&nbsp;<span class="op" id="8186126">=</span>&nbsp;<span class="ident" id="8186128">Register</span><span class="op" id="8186136">(</span><span class="builtinfunc" id="8186137">new</span><span class="op" id="8186140">(</span><span class="ident" id="8186141">ArgNotPublic</span><span class="op" id="8186153">)</span><span class="op" id="8186154">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186157">if</span>&nbsp;<span class="ident" id="8186160">err</span>&nbsp;<span class="op" id="8186164">==</span>&nbsp;<span class="ident" id="8186167">nil</span>&nbsp;<span class="op" id="8186171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186175">t</span><span class="op" id="8186176">.</span><span class="ident" id="8186177">Error</span><span class="op" id="8186182">(</span><span class="string" id="8186183">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="8186224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186230">err</span>&nbsp;<span class="op" id="8186234">=</span>&nbsp;<span class="ident" id="8186236">Register</span><span class="op" id="8186244">(</span><span class="builtinfunc" id="8186245">new</span><span class="op" id="8186248">(</span><span class="ident" id="8186249">ReplyNotPublic</span><span class="op" id="8186263">)</span><span class="op" id="8186264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186267">if</span>&nbsp;<span class="ident" id="8186270">err</span>&nbsp;<span class="op" id="8186274">==</span>&nbsp;<span class="ident" id="8186277">nil</span>&nbsp;<span class="op" id="8186281">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186285">t</span><span class="op" id="8186286">.</span><span class="ident" id="8186287">Error</span><span class="op" id="8186292">(</span><span class="string" id="8186293">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="8186336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186342">err</span>&nbsp;<span class="op" id="8186346">=</span>&nbsp;<span class="ident" id="8186348">Register</span><span class="op" id="8186356">(</span><span class="ident" id="8186357">NeedsPtrType</span><span class="op" id="8186369">(</span><span class="num" id="8186370">0</span><span class="op" id="8186371">)</span><span class="op" id="8186372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186375">if</span>&nbsp;<span class="ident" id="8186378">err</span>&nbsp;<span class="op" id="8186382">==</span>&nbsp;<span class="ident" id="8186385">nil</span>&nbsp;<span class="op" id="8186389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186393">t</span><span class="op" id="8186394">.</span><span class="ident" id="8186395">Error</span><span class="op" id="8186400">(</span><span class="string" id="8186401">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="8186442">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186445">}</span>&nbsp;<span class="keyword" id="8186447">else</span>&nbsp;<span class="keyword" id="8186452">if</span>&nbsp;<span class="op" id="8186455">!</span><span class="ident" id="8186456">strings</span><span class="op" id="8186463">.</span><span class="ident" id="8186464">Contains</span><span class="op" id="8186472">(</span><span class="ident" id="8186473">err</span><span class="op" id="8186476">.</span><span class="ident" id="8186477">Error</span><span class="op" id="8186482">(</span><span class="op" id="8186483">)</span><span class="op" id="8186484">,</span>&nbsp;<span class="string" id="8186486">&#34;pointer&#34;</span><span class="op" id="8186495">)</span>&nbsp;<span class="op" id="8186497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186501">t</span><span class="op" id="8186502">.</span><span class="ident" id="8186503">Error</span><span class="op" id="8186508">(</span><span class="string" id="8186509">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="8186554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186557">}</span><br>
<span class="lineno"></span><span class="op" id="8186559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8186562">type</span>&nbsp;<span class="ident" id="8186567">WriteFailCodec</span>&nbsp;<span class="builtintype" id="8186582">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8186587">func</span>&nbsp;<span class="op" id="8186592">(</span><span class="ident" id="8186593">WriteFailCodec</span><span class="op" id="8186607">)</span>&nbsp;<span class="ident" id="8186609">WriteRequest</span><span class="op" id="8186621">(</span><span class="op" id="8186622">*</span><span class="ident" id="8186623">Request</span><span class="op" id="8186630">,</span>&nbsp;<span class="keyword" id="8186632">interface</span><span class="op" id="8186641">{</span><span class="op" id="8186642">}</span><span class="op" id="8186643">)</span>&nbsp;<span class="builtintype" id="8186645">error</span>&nbsp;<span class="op" id="8186651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8186654">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186716">return</span>&nbsp;<span class="ident" id="8186723">errors</span><span class="op" id="8186729">.</span><span class="ident" id="8186730">New</span><span class="op" id="8186733">(</span><span class="string" id="8186734">&#34;fail&#34;</span><span class="op" id="8186740">)</span><br>
<span class="lineno">435</span><span class="op" id="8186742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8186745">func</span>&nbsp;<span class="op" id="8186750">(</span><span class="ident" id="8186751">WriteFailCodec</span><span class="op" id="8186765">)</span>&nbsp;<span class="ident" id="8186767">ReadResponseHeader</span><span class="op" id="8186785">(</span><span class="op" id="8186786">*</span><span class="ident" id="8186787">Response</span><span class="op" id="8186795">)</span>&nbsp;<span class="builtintype" id="8186797">error</span>&nbsp;<span class="op" id="8186803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186806">select</span>&nbsp;<span class="op" id="8186813">{</span><span class="op" id="8186814">}</span><br>
<span class="lineno"></span><span class="op" id="8186816">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="8186819">func</span>&nbsp;<span class="op" id="8186824">(</span><span class="ident" id="8186825">WriteFailCodec</span><span class="op" id="8186839">)</span>&nbsp;<span class="ident" id="8186841">ReadResponseBody</span><span class="op" id="8186857">(</span><span class="keyword" id="8186858">interface</span><span class="op" id="8186867">{</span><span class="op" id="8186868">}</span><span class="op" id="8186869">)</span>&nbsp;<span class="builtintype" id="8186871">error</span>&nbsp;<span class="op" id="8186877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186880">select</span>&nbsp;<span class="op" id="8186887">{</span><span class="op" id="8186888">}</span><br>
<span class="lineno"></span><span class="op" id="8186890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="8186893">func</span>&nbsp;<span class="op" id="8186898">(</span><span class="ident" id="8186899">WriteFailCodec</span><span class="op" id="8186913">)</span>&nbsp;<span class="ident" id="8186915">Close</span><span class="op" id="8186920">(</span><span class="op" id="8186921">)</span>&nbsp;<span class="builtintype" id="8186923">error</span>&nbsp;<span class="op" id="8186929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186932">return</span>&nbsp;<span class="ident" id="8186939">nil</span><br>
<span class="lineno"></span><span class="op" id="8186943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8186946">func</span>&nbsp;<span class="ident" id="8186951">TestSendDeadlock</span><span class="op" id="8186967">(</span><span class="ident" id="8186968">t</span>&nbsp;<span class="op" id="8186970">*</span><span class="ident" id="8186971">testing</span><span class="op" id="8186978">.</span><span class="ident" id="8186979">T</span><span class="op" id="8186980">)</span>&nbsp;<span class="op" id="8186982">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186985">client</span>&nbsp;<span class="op" id="8186992">:=</span>&nbsp;<span class="ident" id="8186995">NewClientWithCodec</span><span class="op" id="8187013">(</span><span class="ident" id="8187014">WriteFailCodec</span><span class="op" id="8187028">(</span><span class="num" id="8187029">0</span><span class="op" id="8187030">)</span><span class="op" id="8187031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187034">defer</span>&nbsp;<span class="ident" id="8187040">client</span><span class="op" id="8187046">.</span><span class="ident" id="8187047">Close</span><span class="op" id="8187052">(</span><span class="op" id="8187053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187057">done</span>&nbsp;<span class="op" id="8187062">:=</span>&nbsp;<span class="builtinfunc" id="8187065">make</span><span class="op" id="8187069">(</span><span class="keyword" id="8187070">chan</span>&nbsp;<span class="builtintype" id="8187075">bool</span><span class="op" id="8187079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187082">go</span>&nbsp;<span class="keyword" id="8187085">func</span><span class="op" id="8187089">(</span><span class="op" id="8187090">)</span>&nbsp;<span class="op" id="8187092">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187096">testSendDeadlock</span><span class="op" id="8187112">(</span><span class="ident" id="8187113">client</span><span class="op" id="8187119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187123">testSendDeadlock</span><span class="op" id="8187139">(</span><span class="ident" id="8187140">client</span><span class="op" id="8187146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187150">done</span>&nbsp;<span class="op" id="8187155">&lt;-</span>&nbsp;<span class="builtintype" id="8187158">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187164">}</span><span class="op" id="8187165">(</span><span class="op" id="8187166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187169">select</span>&nbsp;<span class="op" id="8187176">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187179">case</span>&nbsp;<span class="op" id="8187184">&lt;-</span><span class="ident" id="8187186">done</span><span class="op" id="8187190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187194">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187202">case</span>&nbsp;<span class="op" id="8187207">&lt;-</span><span class="ident" id="8187209">time</span><span class="op" id="8187213">.</span><span class="ident" id="8187214">After</span><span class="op" id="8187219">(</span><span class="num" id="8187220">5</span>&nbsp;<span class="op" id="8187222">*</span>&nbsp;<span class="ident" id="8187224">time</span><span class="op" id="8187228">.</span><span class="ident" id="8187229">Second</span><span class="op" id="8187235">)</span><span class="op" id="8187236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187240">t</span><span class="op" id="8187241">.</span><span class="ident" id="8187242">Fatal</span><span class="op" id="8187247">(</span><span class="string" id="8187248">&#34;deadlock&#34;</span><span class="op" id="8187258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187261">}</span><br>
<span class="lineno">465</span><span class="op" id="8187263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8187266">func</span>&nbsp;<span class="ident" id="8187271">testSendDeadlock</span><span class="op" id="8187287">(</span><span class="ident" id="8187288">client</span>&nbsp;<span class="op" id="8187295">*</span><span class="ident" id="8187296">Client</span><span class="op" id="8187302">)</span>&nbsp;<span class="op" id="8187304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187307">defer</span>&nbsp;<span class="keyword" id="8187313">func</span><span class="op" id="8187317">(</span><span class="op" id="8187318">)</span>&nbsp;<span class="op" id="8187320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8187324">recover</span><span class="op" id="8187331">(</span><span class="op" id="8187332">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187335">}</span><span class="op" id="8187336">(</span><span class="op" id="8187337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187340">args</span>&nbsp;<span class="op" id="8187345">:=</span>&nbsp;<span class="op" id="8187348">&amp;</span><span class="ident" id="8187349">Args</span><span class="op" id="8187353">{</span><span class="num" id="8187354">7</span><span class="op" id="8187355">,</span>&nbsp;<span class="num" id="8187357">8</span><span class="op" id="8187358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187361">reply</span>&nbsp;<span class="op" id="8187367">:=</span>&nbsp;<span class="builtinfunc" id="8187370">new</span><span class="op" id="8187373">(</span><span class="ident" id="8187374">Reply</span><span class="op" id="8187379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187382">client</span><span class="op" id="8187388">.</span><span class="ident" id="8187389">Call</span><span class="op" id="8187393">(</span><span class="string" id="8187394">&#34;Arith.Add&#34;</span><span class="op" id="8187405">,</span>&nbsp;<span class="ident" id="8187407">args</span><span class="op" id="8187411">,</span>&nbsp;<span class="ident" id="8187413">reply</span><span class="op" id="8187418">)</span><br>
<span class="lineno"></span><span class="op" id="8187420">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="8187423">func</span>&nbsp;<span class="ident" id="8187428">dialDirect</span><span class="op" id="8187438">(</span><span class="op" id="8187439">)</span>&nbsp;<span class="op" id="8187441">(</span><span class="op" id="8187442">*</span><span class="ident" id="8187443">Client</span><span class="op" id="8187449">,</span>&nbsp;<span class="builtintype" id="8187451">error</span><span class="op" id="8187456">)</span>&nbsp;<span class="op" id="8187458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187461">return</span>&nbsp;<span class="ident" id="8187468">Dial</span><span class="op" id="8187472">(</span><span class="string" id="8187473">&#34;tcp&#34;</span><span class="op" id="8187478">,</span>&nbsp;<span class="ident" id="8187480">serverAddr</span><span class="op" id="8187490">)</span><br>
<span class="lineno"></span><span class="op" id="8187492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="8187495">func</span>&nbsp;<span class="ident" id="8187500">dialHTTP</span><span class="op" id="8187508">(</span><span class="op" id="8187509">)</span>&nbsp;<span class="op" id="8187511">(</span><span class="op" id="8187512">*</span><span class="ident" id="8187513">Client</span><span class="op" id="8187519">,</span>&nbsp;<span class="builtintype" id="8187521">error</span><span class="op" id="8187526">)</span>&nbsp;<span class="op" id="8187528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187531">return</span>&nbsp;<span class="ident" id="8187538">DialHTTP</span><span class="op" id="8187546">(</span><span class="string" id="8187547">&#34;tcp&#34;</span><span class="op" id="8187552">,</span>&nbsp;<span class="ident" id="8187554">httpServerAddr</span><span class="op" id="8187568">)</span><br>
<span class="lineno"></span><span class="op" id="8187570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8187573">func</span>&nbsp;<span class="ident" id="8187578">countMallocs</span><span class="op" id="8187590">(</span><span class="ident" id="8187591">dial</span>&nbsp;<span class="keyword" id="8187596">func</span><span class="op" id="8187600">(</span><span class="op" id="8187601">)</span>&nbsp;<span class="op" id="8187603">(</span><span class="op" id="8187604">*</span><span class="ident" id="8187605">Client</span><span class="op" id="8187611">,</span>&nbsp;<span class="builtintype" id="8187613">error</span><span class="op" id="8187618">)</span><span class="op" id="8187619">,</span>&nbsp;<span class="ident" id="8187621">t</span>&nbsp;<span class="op" id="8187623">*</span><span class="ident" id="8187624">testing</span><span class="op" id="8187631">.</span><span class="ident" id="8187632">T</span><span class="op" id="8187633">)</span>&nbsp;<span class="builtintype" id="8187635">float64</span>&nbsp;<span class="op" id="8187643">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187646">once</span><span class="op" id="8187650">.</span><span class="ident" id="8187651">Do</span><span class="op" id="8187653">(</span><span class="ident" id="8187654">startServer</span><span class="op" id="8187665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187668">client</span><span class="op" id="8187674">,</span>&nbsp;<span class="ident" id="8187676">err</span>&nbsp;<span class="op" id="8187680">:=</span>&nbsp;<span class="ident" id="8187683">dial</span><span class="op" id="8187687">(</span><span class="op" id="8187688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187691">if</span>&nbsp;<span class="ident" id="8187694">err</span>&nbsp;<span class="op" id="8187698">!=</span>&nbsp;<span class="ident" id="8187701">nil</span>&nbsp;<span class="op" id="8187705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187709">t</span><span class="op" id="8187710">.</span><span class="ident" id="8187711">Fatal</span><span class="op" id="8187716">(</span><span class="string" id="8187717">&#34;error&nbsp;dialing&#34;</span><span class="op" id="8187732">,</span>&nbsp;<span class="ident" id="8187734">err</span><span class="op" id="8187737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187740">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187743">defer</span>&nbsp;<span class="ident" id="8187749">client</span><span class="op" id="8187755">.</span><span class="ident" id="8187756">Close</span><span class="op" id="8187761">(</span><span class="op" id="8187762">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187766">args</span>&nbsp;<span class="op" id="8187771">:=</span>&nbsp;<span class="op" id="8187774">&amp;</span><span class="ident" id="8187775">Args</span><span class="op" id="8187779">{</span><span class="num" id="8187780">7</span><span class="op" id="8187781">,</span>&nbsp;<span class="num" id="8187783">8</span><span class="op" id="8187784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187787">reply</span>&nbsp;<span class="op" id="8187793">:=</span>&nbsp;<span class="builtinfunc" id="8187796">new</span><span class="op" id="8187799">(</span><span class="ident" id="8187800">Reply</span><span class="op" id="8187805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187808">return</span>&nbsp;<span class="ident" id="8187815">testing</span><span class="op" id="8187822">.</span><span class="ident" id="8187823">AllocsPerRun</span><span class="op" id="8187835">(</span><span class="num" id="8187836">100</span><span class="op" id="8187839">,</span>&nbsp;<span class="keyword" id="8187841">func</span><span class="op" id="8187845">(</span><span class="op" id="8187846">)</span>&nbsp;<span class="op" id="8187848">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187852">err</span>&nbsp;<span class="op" id="8187856">:=</span>&nbsp;<span class="ident" id="8187859">client</span><span class="op" id="8187865">.</span><span class="ident" id="8187866">Call</span><span class="op" id="8187870">(</span><span class="string" id="8187871">&#34;Arith.Add&#34;</span><span class="op" id="8187882">,</span>&nbsp;<span class="ident" id="8187884">args</span><span class="op" id="8187888">,</span>&nbsp;<span class="ident" id="8187890">reply</span><span class="op" id="8187895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187899">if</span>&nbsp;<span class="ident" id="8187902">err</span>&nbsp;<span class="op" id="8187906">!=</span>&nbsp;<span class="ident" id="8187909">nil</span>&nbsp;<span class="op" id="8187913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187918">t</span><span class="op" id="8187919">.</span><span class="ident" id="8187920">Errorf</span><span class="op" id="8187926">(</span><span class="string" id="8187927">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8187969">,</span>&nbsp;<span class="ident" id="8187971">err</span><span class="op" id="8187974">.</span><span class="ident" id="8187975">Error</span><span class="op" id="8187980">(</span><span class="op" id="8187981">)</span><span class="op" id="8187982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187990">if</span>&nbsp;<span class="ident" id="8187993">reply</span><span class="op" id="8187998">.</span><span class="ident" id="8187999">C</span>&nbsp;<span class="op" id="8188001">!=</span>&nbsp;<span class="ident" id="8188004">args</span><span class="op" id="8188008">.</span><span class="ident" id="8188009">A</span><span class="op" id="8188010">+</span><span class="ident" id="8188011">args</span><span class="op" id="8188015">.</span><span class="ident" id="8188016">B</span>&nbsp;<span class="op" id="8188018">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188023">t</span><span class="op" id="8188024">.</span><span class="ident" id="8188025">Errorf</span><span class="op" id="8188031">(</span><span class="string" id="8188032">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8188057">,</span>&nbsp;<span class="ident" id="8188059">reply</span><span class="op" id="8188064">.</span><span class="ident" id="8188065">C</span><span class="op" id="8188066">,</span>&nbsp;<span class="ident" id="8188068">args</span><span class="op" id="8188072">.</span><span class="ident" id="8188073">A</span><span class="op" id="8188074">+</span><span class="ident" id="8188075">args</span><span class="op" id="8188079">.</span><span class="ident" id="8188080">B</span><span class="op" id="8188081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188088">}</span><span class="op" id="8188089">)</span><br>
<span class="lineno"></span><span class="op" id="8188091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="8188094">func</span>&nbsp;<span class="ident" id="8188099">TestCountMallocs</span><span class="op" id="8188115">(</span><span class="ident" id="8188116">t</span>&nbsp;<span class="op" id="8188118">*</span><span class="ident" id="8188119">testing</span><span class="op" id="8188126">.</span><span class="ident" id="8188127">T</span><span class="op" id="8188128">)</span>&nbsp;<span class="op" id="8188130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188133">if</span>&nbsp;<span class="ident" id="8188136">testing</span><span class="op" id="8188143">.</span><span class="ident" id="8188144">Short</span><span class="op" id="8188149">(</span><span class="op" id="8188150">)</span>&nbsp;<span class="op" id="8188152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188156">t</span><span class="op" id="8188157">.</span><span class="ident" id="8188158">Skip</span><span class="op" id="8188162">(</span><span class="string" id="8188163">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8188200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188206">if</span>&nbsp;<span class="ident" id="8188209">runtime</span><span class="op" id="8188216">.</span><span class="ident" id="8188217">GOMAXPROCS</span><span class="op" id="8188227">(</span><span class="num" id="8188228">0</span><span class="op" id="8188229">)</span>&nbsp;<span class="op" id="8188231">&gt;</span>&nbsp;<span class="num" id="8188233">1</span>&nbsp;<span class="op" id="8188235">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188239">t</span><span class="op" id="8188240">.</span><span class="ident" id="8188241">Skip</span><span class="op" id="8188245">(</span><span class="string" id="8188246">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="8188270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188276">fmt</span><span class="op" id="8188279">.</span><span class="ident" id="8188280">Printf</span><span class="op" id="8188286">(</span><span class="string" id="8188287">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="8188321">,</span>&nbsp;<span class="ident" id="8188323">countMallocs</span><span class="op" id="8188335">(</span><span class="ident" id="8188336">dialDirect</span><span class="op" id="8188346">,</span>&nbsp;<span class="ident" id="8188348">t</span><span class="op" id="8188349">)</span><span class="op" id="8188350">)</span><br>
<span class="lineno"></span><span class="op" id="8188352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="8188355">func</span>&nbsp;<span class="ident" id="8188360">TestCountMallocsOverHTTP</span><span class="op" id="8188384">(</span><span class="ident" id="8188385">t</span>&nbsp;<span class="op" id="8188387">*</span><span class="ident" id="8188388">testing</span><span class="op" id="8188395">.</span><span class="ident" id="8188396">T</span><span class="op" id="8188397">)</span>&nbsp;<span class="op" id="8188399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188402">if</span>&nbsp;<span class="ident" id="8188405">testing</span><span class="op" id="8188412">.</span><span class="ident" id="8188413">Short</span><span class="op" id="8188418">(</span><span class="op" id="8188419">)</span>&nbsp;<span class="op" id="8188421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188425">t</span><span class="op" id="8188426">.</span><span class="ident" id="8188427">Skip</span><span class="op" id="8188431">(</span><span class="string" id="8188432">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8188469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188475">if</span>&nbsp;<span class="ident" id="8188478">runtime</span><span class="op" id="8188485">.</span><span class="ident" id="8188486">GOMAXPROCS</span><span class="op" id="8188496">(</span><span class="num" id="8188497">0</span><span class="op" id="8188498">)</span>&nbsp;<span class="op" id="8188500">&gt;</span>&nbsp;<span class="num" id="8188502">1</span>&nbsp;<span class="op" id="8188504">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188508">t</span><span class="op" id="8188509">.</span><span class="ident" id="8188510">Skip</span><span class="op" id="8188514">(</span><span class="string" id="8188515">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="8188539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188545">fmt</span><span class="op" id="8188548">.</span><span class="ident" id="8188549">Printf</span><span class="op" id="8188555">(</span><span class="string" id="8188556">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="8188595">,</span>&nbsp;<span class="ident" id="8188597">countMallocs</span><span class="op" id="8188609">(</span><span class="ident" id="8188610">dialHTTP</span><span class="op" id="8188618">,</span>&nbsp;<span class="ident" id="8188620">t</span><span class="op" id="8188621">)</span><span class="op" id="8188622">)</span><br>
<span class="lineno"></span><span class="op" id="8188624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="8188627">type</span>&nbsp;<span class="ident" id="8188632">writeCrasher</span>&nbsp;<span class="keyword" id="8188645">struct</span>&nbsp;<span class="op" id="8188652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188655">done</span>&nbsp;<span class="keyword" id="8188660">chan</span>&nbsp;<span class="builtintype" id="8188665">bool</span><br>
<span class="lineno"></span><span class="op" id="8188670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188673">func</span>&nbsp;<span class="op" id="8188678">(</span><span class="ident" id="8188679">writeCrasher</span><span class="op" id="8188691">)</span>&nbsp;<span class="ident" id="8188693">Close</span><span class="op" id="8188698">(</span><span class="op" id="8188699">)</span>&nbsp;<span class="builtintype" id="8188701">error</span>&nbsp;<span class="op" id="8188707">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188710">return</span>&nbsp;<span class="ident" id="8188717">nil</span><br>
<span class="lineno"></span><span class="op" id="8188721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188724">func</span>&nbsp;<span class="op" id="8188729">(</span><span class="ident" id="8188730">w</span>&nbsp;<span class="op" id="8188732">*</span><span class="ident" id="8188733">writeCrasher</span><span class="op" id="8188745">)</span>&nbsp;<span class="ident" id="8188747">Read</span><span class="op" id="8188751">(</span><span class="ident" id="8188752">p</span>&nbsp;<span class="op" id="8188754">[</span><span class="op" id="8188755">]</span><span class="builtintype" id="8188756">byte</span><span class="op" id="8188760">)</span>&nbsp;<span class="op" id="8188762">(</span><span class="builtintype" id="8188763">int</span><span class="op" id="8188766">,</span>&nbsp;<span class="builtintype" id="8188768">error</span><span class="op" id="8188773">)</span>&nbsp;<span class="op" id="8188775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188778">&lt;-</span><span class="ident" id="8188780">w</span><span class="op" id="8188781">.</span><span class="ident" id="8188782">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188788">return</span>&nbsp;<span class="num" id="8188795">0</span><span class="op" id="8188796">,</span>&nbsp;<span class="ident" id="8188798">io</span><span class="op" id="8188800">.</span><span class="ident" id="8188801">EOF</span><br>
<span class="lineno"></span><span class="op" id="8188805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188808">func</span>&nbsp;<span class="op" id="8188813">(</span><span class="ident" id="8188814">writeCrasher</span><span class="op" id="8188826">)</span>&nbsp;<span class="ident" id="8188828">Write</span><span class="op" id="8188833">(</span><span class="ident" id="8188834">p</span>&nbsp;<span class="op" id="8188836">[</span><span class="op" id="8188837">]</span><span class="builtintype" id="8188838">byte</span><span class="op" id="8188842">)</span>&nbsp;<span class="op" id="8188844">(</span><span class="builtintype" id="8188845">int</span><span class="op" id="8188848">,</span>&nbsp;<span class="builtintype" id="8188850">error</span><span class="op" id="8188855">)</span>&nbsp;<span class="op" id="8188857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188860">return</span>&nbsp;<span class="num" id="8188867">0</span><span class="op" id="8188868">,</span>&nbsp;<span class="ident" id="8188870">errors</span><span class="op" id="8188876">.</span><span class="ident" id="8188877">New</span><span class="op" id="8188880">(</span><span class="string" id="8188881">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="8188901">)</span><br>
<span class="lineno">540</span><span class="op" id="8188903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188906">func</span>&nbsp;<span class="ident" id="8188911">TestClientWriteError</span><span class="op" id="8188931">(</span><span class="ident" id="8188932">t</span>&nbsp;<span class="op" id="8188934">*</span><span class="ident" id="8188935">testing</span><span class="op" id="8188942">.</span><span class="ident" id="8188943">T</span><span class="op" id="8188944">)</span>&nbsp;<span class="op" id="8188946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188949">w</span>&nbsp;<span class="op" id="8188951">:=</span>&nbsp;<span class="op" id="8188954">&amp;</span><span class="ident" id="8188955">writeCrasher</span><span class="op" id="8188967">{</span><span class="ident" id="8188968">done</span><span class="op" id="8188972">:</span>&nbsp;<span class="builtinfunc" id="8188974">make</span><span class="op" id="8188978">(</span><span class="keyword" id="8188979">chan</span>&nbsp;<span class="builtintype" id="8188984">bool</span><span class="op" id="8188988">)</span><span class="op" id="8188989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188992">c</span>&nbsp;<span class="op" id="8188994">:=</span>&nbsp;<span class="ident" id="8188997">NewClient</span><span class="op" id="8189006">(</span><span class="ident" id="8189007">w</span><span class="op" id="8189008">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189011">defer</span>&nbsp;<span class="ident" id="8189017">c</span><span class="op" id="8189018">.</span><span class="ident" id="8189019">Close</span><span class="op" id="8189024">(</span><span class="op" id="8189025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189029">res</span>&nbsp;<span class="op" id="8189033">:=</span>&nbsp;<span class="builtintype" id="8189036">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189043">err</span>&nbsp;<span class="op" id="8189047">:=</span>&nbsp;<span class="ident" id="8189050">c</span><span class="op" id="8189051">.</span><span class="ident" id="8189052">Call</span><span class="op" id="8189056">(</span><span class="string" id="8189057">&#34;foo&#34;</span><span class="op" id="8189062">,</span>&nbsp;<span class="num" id="8189064">1</span><span class="op" id="8189065">,</span>&nbsp;<span class="op" id="8189067">&amp;</span><span class="ident" id="8189068">res</span><span class="op" id="8189071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189074">if</span>&nbsp;<span class="ident" id="8189077">err</span>&nbsp;<span class="op" id="8189081">==</span>&nbsp;<span class="ident" id="8189084">nil</span>&nbsp;<span class="op" id="8189088">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189092">t</span><span class="op" id="8189093">.</span><span class="ident" id="8189094">Fatal</span><span class="op" id="8189099">(</span><span class="string" id="8189100">&#34;expected&nbsp;error&#34;</span><span class="op" id="8189116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189122">if</span>&nbsp;<span class="ident" id="8189125">err</span><span class="op" id="8189128">.</span><span class="ident" id="8189129">Error</span><span class="op" id="8189134">(</span><span class="op" id="8189135">)</span>&nbsp;<span class="op" id="8189137">!=</span>&nbsp;<span class="string" id="8189140">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="8189161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189165">t</span><span class="op" id="8189166">.</span><span class="ident" id="8189167">Error</span><span class="op" id="8189172">(</span><span class="string" id="8189173">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="8189201">,</span>&nbsp;<span class="ident" id="8189203">err</span><span class="op" id="8189206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189209">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189212">w</span><span class="op" id="8189213">.</span><span class="ident" id="8189214">done</span>&nbsp;<span class="op" id="8189219">&lt;-</span>&nbsp;<span class="builtintype" id="8189222">true</span><br>
<span class="lineno"></span><span class="op" id="8189227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8189230">func</span>&nbsp;<span class="ident" id="8189235">TestTCPClose</span><span class="op" id="8189247">(</span><span class="ident" id="8189248">t</span>&nbsp;<span class="op" id="8189250">*</span><span class="ident" id="8189251">testing</span><span class="op" id="8189258">.</span><span class="ident" id="8189259">T</span><span class="op" id="8189260">)</span>&nbsp;<span class="op" id="8189262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189265">once</span><span class="op" id="8189269">.</span><span class="ident" id="8189270">Do</span><span class="op" id="8189272">(</span><span class="ident" id="8189273">startServer</span><span class="op" id="8189284">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189288">client</span><span class="op" id="8189294">,</span>&nbsp;<span class="ident" id="8189296">err</span>&nbsp;<span class="op" id="8189300">:=</span>&nbsp;<span class="ident" id="8189303">dialHTTP</span><span class="op" id="8189311">(</span><span class="op" id="8189312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189315">if</span>&nbsp;<span class="ident" id="8189318">err</span>&nbsp;<span class="op" id="8189322">!=</span>&nbsp;<span class="ident" id="8189325">nil</span>&nbsp;<span class="op" id="8189329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189333">t</span><span class="op" id="8189334">.</span><span class="ident" id="8189335">Fatalf</span><span class="op" id="8189341">(</span><span class="string" id="8189342">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="8189355">,</span>&nbsp;<span class="ident" id="8189357">err</span><span class="op" id="8189360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189363">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189366">defer</span>&nbsp;<span class="ident" id="8189372">client</span><span class="op" id="8189378">.</span><span class="ident" id="8189379">Close</span><span class="op" id="8189384">(</span><span class="op" id="8189385">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189389">args</span>&nbsp;<span class="op" id="8189394">:=</span>&nbsp;<span class="ident" id="8189397">Args</span><span class="op" id="8189401">{</span><span class="num" id="8189402">17</span><span class="op" id="8189404">,</span>&nbsp;<span class="num" id="8189406">8</span><span class="op" id="8189407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189410">var</span>&nbsp;<span class="ident" id="8189414">reply</span>&nbsp;<span class="ident" id="8189420">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189427">err</span>&nbsp;<span class="op" id="8189431">=</span>&nbsp;<span class="ident" id="8189433">client</span><span class="op" id="8189439">.</span><span class="ident" id="8189440">Call</span><span class="op" id="8189444">(</span><span class="string" id="8189445">&#34;Arith.Mul&#34;</span><span class="op" id="8189456">,</span>&nbsp;<span class="ident" id="8189458">args</span><span class="op" id="8189462">,</span>&nbsp;<span class="op" id="8189464">&amp;</span><span class="ident" id="8189465">reply</span><span class="op" id="8189470">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189473">if</span>&nbsp;<span class="ident" id="8189476">err</span>&nbsp;<span class="op" id="8189480">!=</span>&nbsp;<span class="ident" id="8189483">nil</span>&nbsp;<span class="op" id="8189487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189491">t</span><span class="op" id="8189492">.</span><span class="ident" id="8189493">Fatal</span><span class="op" id="8189498">(</span><span class="string" id="8189499">&#34;arith&nbsp;error:&#34;</span><span class="op" id="8189513">,</span>&nbsp;<span class="ident" id="8189515">err</span><span class="op" id="8189518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189524">t</span><span class="op" id="8189525">.</span><span class="ident" id="8189526">Logf</span><span class="op" id="8189530">(</span><span class="string" id="8189531">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="8189550">,</span>&nbsp;<span class="ident" id="8189552">args</span><span class="op" id="8189556">.</span><span class="ident" id="8189557">A</span><span class="op" id="8189558">,</span>&nbsp;<span class="ident" id="8189560">args</span><span class="op" id="8189564">.</span><span class="ident" id="8189565">B</span><span class="op" id="8189566">,</span>&nbsp;<span class="ident" id="8189568">reply</span><span class="op" id="8189573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189576">if</span>&nbsp;<span class="ident" id="8189579">reply</span><span class="op" id="8189584">.</span><span class="ident" id="8189585">C</span>&nbsp;<span class="op" id="8189587">!=</span>&nbsp;<span class="ident" id="8189590">args</span><span class="op" id="8189594">.</span><span class="ident" id="8189595">A</span><span class="op" id="8189596">*</span><span class="ident" id="8189597">args</span><span class="op" id="8189601">.</span><span class="ident" id="8189602">B</span>&nbsp;<span class="op" id="8189604">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189608">t</span><span class="op" id="8189609">.</span><span class="ident" id="8189610">Errorf</span><span class="op" id="8189616">(</span><span class="string" id="8189617">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8189642">,</span>&nbsp;<span class="ident" id="8189644">reply</span><span class="op" id="8189649">.</span><span class="ident" id="8189650">C</span><span class="op" id="8189651">,</span>&nbsp;<span class="ident" id="8189653">args</span><span class="op" id="8189657">.</span><span class="ident" id="8189658">A</span><span class="op" id="8189659">*</span><span class="ident" id="8189660">args</span><span class="op" id="8189664">.</span><span class="ident" id="8189665">B</span><span class="op" id="8189666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189669">}</span><br>
<span class="lineno"></span><span class="op" id="8189671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8189674">func</span>&nbsp;<span class="ident" id="8189679">TestErrorAfterClientClose</span><span class="op" id="8189704">(</span><span class="ident" id="8189705">t</span>&nbsp;<span class="op" id="8189707">*</span><span class="ident" id="8189708">testing</span><span class="op" id="8189715">.</span><span class="ident" id="8189716">T</span><span class="op" id="8189717">)</span>&nbsp;<span class="op" id="8189719">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189722">once</span><span class="op" id="8189726">.</span><span class="ident" id="8189727">Do</span><span class="op" id="8189729">(</span><span class="ident" id="8189730">startServer</span><span class="op" id="8189741">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189745">client</span><span class="op" id="8189751">,</span>&nbsp;<span class="ident" id="8189753">err</span>&nbsp;<span class="op" id="8189757">:=</span>&nbsp;<span class="ident" id="8189760">dialHTTP</span><span class="op" id="8189768">(</span><span class="op" id="8189769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189772">if</span>&nbsp;<span class="ident" id="8189775">err</span>&nbsp;<span class="op" id="8189779">!=</span>&nbsp;<span class="ident" id="8189782">nil</span>&nbsp;<span class="op" id="8189786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189790">t</span><span class="op" id="8189791">.</span><span class="ident" id="8189792">Fatalf</span><span class="op" id="8189798">(</span><span class="string" id="8189799">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="8189812">,</span>&nbsp;<span class="ident" id="8189814">err</span><span class="op" id="8189817">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189823">err</span>&nbsp;<span class="op" id="8189827">=</span>&nbsp;<span class="ident" id="8189829">client</span><span class="op" id="8189835">.</span><span class="ident" id="8189836">Close</span><span class="op" id="8189841">(</span><span class="op" id="8189842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189845">if</span>&nbsp;<span class="ident" id="8189848">err</span>&nbsp;<span class="op" id="8189852">!=</span>&nbsp;<span class="ident" id="8189855">nil</span>&nbsp;<span class="op" id="8189859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189863">t</span><span class="op" id="8189864">.</span><span class="ident" id="8189865">Fatal</span><span class="op" id="8189870">(</span><span class="string" id="8189871">&#34;close&nbsp;error:&#34;</span><span class="op" id="8189885">,</span>&nbsp;<span class="ident" id="8189887">err</span><span class="op" id="8189890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189893">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189896">err</span>&nbsp;<span class="op" id="8189900">=</span>&nbsp;<span class="ident" id="8189902">client</span><span class="op" id="8189908">.</span><span class="ident" id="8189909">Call</span><span class="op" id="8189913">(</span><span class="string" id="8189914">&#34;Arith.Add&#34;</span><span class="op" id="8189925">,</span>&nbsp;<span class="op" id="8189927">&amp;</span><span class="ident" id="8189928">Args</span><span class="op" id="8189932">{</span><span class="num" id="8189933">7</span><span class="op" id="8189934">,</span>&nbsp;<span class="num" id="8189936">9</span><span class="op" id="8189937">}</span><span class="op" id="8189938">,</span>&nbsp;<span class="builtinfunc" id="8189940">new</span><span class="op" id="8189943">(</span><span class="ident" id="8189944">Reply</span><span class="op" id="8189949">)</span><span class="op" id="8189950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189953">if</span>&nbsp;<span class="ident" id="8189956">err</span>&nbsp;<span class="op" id="8189960">!=</span>&nbsp;<span class="ident" id="8189963">ErrShutdown</span>&nbsp;<span class="op" id="8189975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189979">t</span><span class="op" id="8189980">.</span><span class="ident" id="8189981">Errorf</span><span class="op" id="8189987">(</span><span class="string" id="8189988">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8190026">,</span>&nbsp;<span class="ident" id="8190028">err</span><span class="op" id="8190031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190034">}</span><br>
<span class="lineno"></span><span class="op" id="8190036">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="8190039">func</span>&nbsp;<span class="ident" id="8190044">benchmarkEndToEnd</span><span class="op" id="8190061">(</span><span class="ident" id="8190062">dial</span>&nbsp;<span class="keyword" id="8190067">func</span><span class="op" id="8190071">(</span><span class="op" id="8190072">)</span>&nbsp;<span class="op" id="8190074">(</span><span class="op" id="8190075">*</span><span class="ident" id="8190076">Client</span><span class="op" id="8190082">,</span>&nbsp;<span class="builtintype" id="8190084">error</span><span class="op" id="8190089">)</span><span class="op" id="8190090">,</span>&nbsp;<span class="ident" id="8190092">b</span>&nbsp;<span class="op" id="8190094">*</span><span class="ident" id="8190095">testing</span><span class="op" id="8190102">.</span><span class="ident" id="8190103">B</span><span class="op" id="8190104">)</span>&nbsp;<span class="op" id="8190106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190109">once</span><span class="op" id="8190113">.</span><span class="ident" id="8190114">Do</span><span class="op" id="8190116">(</span><span class="ident" id="8190117">startServer</span><span class="op" id="8190128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190131">client</span><span class="op" id="8190137">,</span>&nbsp;<span class="ident" id="8190139">err</span>&nbsp;<span class="op" id="8190143">:=</span>&nbsp;<span class="ident" id="8190146">dial</span><span class="op" id="8190150">(</span><span class="op" id="8190151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190154">if</span>&nbsp;<span class="ident" id="8190157">err</span>&nbsp;<span class="op" id="8190161">!=</span>&nbsp;<span class="ident" id="8190164">nil</span>&nbsp;<span class="op" id="8190168">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190172">b</span><span class="op" id="8190173">.</span><span class="ident" id="8190174">Fatal</span><span class="op" id="8190179">(</span><span class="string" id="8190180">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="8190196">,</span>&nbsp;<span class="ident" id="8190198">err</span><span class="op" id="8190201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190207">defer</span>&nbsp;<span class="ident" id="8190213">client</span><span class="op" id="8190219">.</span><span class="ident" id="8190220">Close</span><span class="op" id="8190225">(</span><span class="op" id="8190226">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8190230">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190252">args</span>&nbsp;<span class="op" id="8190257">:=</span>&nbsp;<span class="op" id="8190260">&amp;</span><span class="ident" id="8190261">Args</span><span class="op" id="8190265">{</span><span class="num" id="8190266">7</span><span class="op" id="8190267">,</span>&nbsp;<span class="num" id="8190269">8</span><span class="op" id="8190270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190273">b</span><span class="op" id="8190274">.</span><span class="ident" id="8190275">ResetTimer</span><span class="op" id="8190285">(</span><span class="op" id="8190286">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190290">b</span><span class="op" id="8190291">.</span><span class="ident" id="8190292">RunParallel</span><span class="op" id="8190303">(</span><span class="keyword" id="8190304">func</span><span class="op" id="8190308">(</span><span class="ident" id="8190309">pb</span>&nbsp;<span class="op" id="8190312">*</span><span class="ident" id="8190313">testing</span><span class="op" id="8190320">.</span><span class="ident" id="8190321">PB</span><span class="op" id="8190323">)</span>&nbsp;<span class="op" id="8190325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190329">reply</span>&nbsp;<span class="op" id="8190335">:=</span>&nbsp;<span class="builtinfunc" id="8190338">new</span><span class="op" id="8190341">(</span><span class="ident" id="8190342">Reply</span><span class="op" id="8190347">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190351">for</span>&nbsp;<span class="ident" id="8190355">pb</span><span class="op" id="8190357">.</span><span class="ident" id="8190358">Next</span><span class="op" id="8190362">(</span><span class="op" id="8190363">)</span>&nbsp;<span class="op" id="8190365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190370">err</span>&nbsp;<span class="op" id="8190374">:=</span>&nbsp;<span class="ident" id="8190377">client</span><span class="op" id="8190383">.</span><span class="ident" id="8190384">Call</span><span class="op" id="8190388">(</span><span class="string" id="8190389">&#34;Arith.Add&#34;</span><span class="op" id="8190400">,</span>&nbsp;<span class="ident" id="8190402">args</span><span class="op" id="8190406">,</span>&nbsp;<span class="ident" id="8190408">reply</span><span class="op" id="8190413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190418">if</span>&nbsp;<span class="ident" id="8190421">err</span>&nbsp;<span class="op" id="8190425">!=</span>&nbsp;<span class="ident" id="8190428">nil</span>&nbsp;<span class="op" id="8190432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190438">b</span><span class="op" id="8190439">.</span><span class="ident" id="8190440">Fatalf</span><span class="op" id="8190446">(</span><span class="string" id="8190447">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8190500">,</span>&nbsp;<span class="ident" id="8190502">err</span><span class="op" id="8190505">.</span><span class="ident" id="8190506">Error</span><span class="op" id="8190511">(</span><span class="op" id="8190512">)</span><span class="op" id="8190513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190518">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190523">if</span>&nbsp;<span class="ident" id="8190526">reply</span><span class="op" id="8190531">.</span><span class="ident" id="8190532">C</span>&nbsp;<span class="op" id="8190534">!=</span>&nbsp;<span class="ident" id="8190537">args</span><span class="op" id="8190541">.</span><span class="ident" id="8190542">A</span><span class="op" id="8190543">+</span><span class="ident" id="8190544">args</span><span class="op" id="8190548">.</span><span class="ident" id="8190549">B</span>&nbsp;<span class="op" id="8190551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190557">b</span><span class="op" id="8190558">.</span><span class="ident" id="8190559">Fatalf</span><span class="op" id="8190565">(</span><span class="string" id="8190566">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8190602">,</span>&nbsp;<span class="ident" id="8190604">reply</span><span class="op" id="8190609">.</span><span class="ident" id="8190610">C</span><span class="op" id="8190611">,</span>&nbsp;<span class="ident" id="8190613">args</span><span class="op" id="8190617">.</span><span class="ident" id="8190618">A</span><span class="op" id="8190619">+</span><span class="ident" id="8190620">args</span><span class="op" id="8190624">.</span><span class="ident" id="8190625">B</span><span class="op" id="8190626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190638">}</span><span class="op" id="8190639">)</span><br>
<span class="lineno">620</span><span class="op" id="8190641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8190644">func</span>&nbsp;<span class="ident" id="8190649">benchmarkEndToEndAsync</span><span class="op" id="8190671">(</span><span class="ident" id="8190672">dial</span>&nbsp;<span class="keyword" id="8190677">func</span><span class="op" id="8190681">(</span><span class="op" id="8190682">)</span>&nbsp;<span class="op" id="8190684">(</span><span class="op" id="8190685">*</span><span class="ident" id="8190686">Client</span><span class="op" id="8190692">,</span>&nbsp;<span class="builtintype" id="8190694">error</span><span class="op" id="8190699">)</span><span class="op" id="8190700">,</span>&nbsp;<span class="ident" id="8190702">b</span>&nbsp;<span class="op" id="8190704">*</span><span class="ident" id="8190705">testing</span><span class="op" id="8190712">.</span><span class="ident" id="8190713">B</span><span class="op" id="8190714">)</span>&nbsp;<span class="op" id="8190716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190719">const</span>&nbsp;<span class="ident" id="8190725">MaxConcurrentCalls</span>&nbsp;<span class="op" id="8190744">=</span>&nbsp;<span class="num" id="8190746">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190751">once</span><span class="op" id="8190755">.</span><span class="ident" id="8190756">Do</span><span class="op" id="8190758">(</span><span class="ident" id="8190759">startServer</span><span class="op" id="8190770">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190773">client</span><span class="op" id="8190779">,</span>&nbsp;<span class="ident" id="8190781">err</span>&nbsp;<span class="op" id="8190785">:=</span>&nbsp;<span class="ident" id="8190788">dial</span><span class="op" id="8190792">(</span><span class="op" id="8190793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190796">if</span>&nbsp;<span class="ident" id="8190799">err</span>&nbsp;<span class="op" id="8190803">!=</span>&nbsp;<span class="ident" id="8190806">nil</span>&nbsp;<span class="op" id="8190810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190814">b</span><span class="op" id="8190815">.</span><span class="ident" id="8190816">Fatal</span><span class="op" id="8190821">(</span><span class="string" id="8190822">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="8190838">,</span>&nbsp;<span class="ident" id="8190840">err</span><span class="op" id="8190843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8190846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190849">defer</span>&nbsp;<span class="ident" id="8190855">client</span><span class="op" id="8190861">.</span><span class="ident" id="8190862">Close</span><span class="op" id="8190867">(</span><span class="op" id="8190868">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8190872">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190895">args</span>&nbsp;<span class="op" id="8190900">:=</span>&nbsp;<span class="op" id="8190903">&amp;</span><span class="ident" id="8190904">Args</span><span class="op" id="8190908">{</span><span class="num" id="8190909">7</span><span class="op" id="8190910">,</span>&nbsp;<span class="num" id="8190912">8</span><span class="op" id="8190913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190916">procs</span>&nbsp;<span class="op" id="8190922">:=</span>&nbsp;<span class="num" id="8190925">4</span>&nbsp;<span class="op" id="8190927">*</span>&nbsp;<span class="ident" id="8190929">runtime</span><span class="op" id="8190936">.</span><span class="ident" id="8190937">GOMAXPROCS</span><span class="op" id="8190947">(</span><span class="op" id="8190948">-</span><span class="num" id="8190949">1</span><span class="op" id="8190950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190953">send</span>&nbsp;<span class="op" id="8190958">:=</span>&nbsp;<span class="builtintype" id="8190961">int32</span><span class="op" id="8190966">(</span><span class="ident" id="8190967">b</span><span class="op" id="8190968">.</span><span class="ident" id="8190969">N</span><span class="op" id="8190970">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8190973">recv</span>&nbsp;<span class="op" id="8190978">:=</span>&nbsp;<span class="builtintype" id="8190981">int32</span><span class="op" id="8190986">(</span><span class="ident" id="8190987">b</span><span class="op" id="8190988">.</span><span class="ident" id="8190989">N</span><span class="op" id="8190990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8190993">var</span>&nbsp;<span class="ident" id="8190997">wg</span>&nbsp;<span class="ident" id="8191000">sync</span><span class="op" id="8191004">.</span><span class="ident" id="8191005">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191016">wg</span><span class="op" id="8191018">.</span><span class="ident" id="8191019">Add</span><span class="op" id="8191022">(</span><span class="ident" id="8191023">procs</span><span class="op" id="8191028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191031">gate</span>&nbsp;<span class="op" id="8191036">:=</span>&nbsp;<span class="builtinfunc" id="8191039">make</span><span class="op" id="8191043">(</span><span class="keyword" id="8191044">chan</span>&nbsp;<span class="builtintype" id="8191049">bool</span><span class="op" id="8191053">,</span>&nbsp;<span class="ident" id="8191055">MaxConcurrentCalls</span><span class="op" id="8191073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191076">res</span>&nbsp;<span class="op" id="8191080">:=</span>&nbsp;<span class="builtinfunc" id="8191083">make</span><span class="op" id="8191087">(</span><span class="keyword" id="8191088">chan</span>&nbsp;<span class="op" id="8191093">*</span><span class="ident" id="8191094">Call</span><span class="op" id="8191098">,</span>&nbsp;<span class="ident" id="8191100">MaxConcurrentCalls</span><span class="op" id="8191118">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191121">b</span><span class="op" id="8191122">.</span><span class="ident" id="8191123">ResetTimer</span><span class="op" id="8191133">(</span><span class="op" id="8191134">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191138">for</span>&nbsp;<span class="ident" id="8191142">p</span>&nbsp;<span class="op" id="8191144">:=</span>&nbsp;<span class="num" id="8191147">0</span><span class="op" id="8191148">;</span>&nbsp;<span class="ident" id="8191150">p</span>&nbsp;<span class="op" id="8191152">&lt;</span>&nbsp;<span class="ident" id="8191154">procs</span><span class="op" id="8191159">;</span>&nbsp;<span class="ident" id="8191161">p</span><span class="op" id="8191162">++</span>&nbsp;<span class="op" id="8191165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191169">go</span>&nbsp;<span class="keyword" id="8191172">func</span><span class="op" id="8191176">(</span><span class="op" id="8191177">)</span>&nbsp;<span class="op" id="8191179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191184">for</span>&nbsp;<span class="ident" id="8191188">atomic</span><span class="op" id="8191194">.</span><span class="ident" id="8191195">AddInt32</span><span class="op" id="8191203">(</span><span class="op" id="8191204">&amp;</span><span class="ident" id="8191205">send</span><span class="op" id="8191209">,</span>&nbsp;<span class="op" id="8191211">-</span><span class="num" id="8191212">1</span><span class="op" id="8191213">)</span>&nbsp;<span class="op" id="8191215">&gt;=</span>&nbsp;<span class="num" id="8191218">0</span>&nbsp;<span class="op" id="8191220">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191226">gate</span>&nbsp;<span class="op" id="8191231">&lt;-</span>&nbsp;<span class="builtintype" id="8191234">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191243">reply</span>&nbsp;<span class="op" id="8191249">:=</span>&nbsp;<span class="builtinfunc" id="8191252">new</span><span class="op" id="8191255">(</span><span class="ident" id="8191256">Reply</span><span class="op" id="8191261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191267">client</span><span class="op" id="8191273">.</span><span class="ident" id="8191274">Go</span><span class="op" id="8191276">(</span><span class="string" id="8191277">&#34;Arith.Add&#34;</span><span class="op" id="8191288">,</span>&nbsp;<span class="ident" id="8191290">args</span><span class="op" id="8191294">,</span>&nbsp;<span class="ident" id="8191296">reply</span><span class="op" id="8191301">,</span>&nbsp;<span class="ident" id="8191303">res</span><span class="op" id="8191306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191315">}</span><span class="op" id="8191316">(</span><span class="op" id="8191317">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191321">go</span>&nbsp;<span class="keyword" id="8191324">func</span><span class="op" id="8191328">(</span><span class="op" id="8191329">)</span>&nbsp;<span class="op" id="8191331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191336">for</span>&nbsp;<span class="ident" id="8191340">call</span>&nbsp;<span class="op" id="8191345">:=</span>&nbsp;<span class="keyword" id="8191348">range</span>&nbsp;<span class="ident" id="8191354">res</span>&nbsp;<span class="op" id="8191358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191364">A</span>&nbsp;<span class="op" id="8191366">:=</span>&nbsp;<span class="ident" id="8191369">call</span><span class="op" id="8191373">.</span><span class="ident" id="8191374">Args</span><span class="op" id="8191378">.</span><span class="op" id="8191379">(</span><span class="op" id="8191380">*</span><span class="ident" id="8191381">Args</span><span class="op" id="8191385">)</span><span class="op" id="8191386">.</span><span class="ident" id="8191387">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191393">B</span>&nbsp;<span class="op" id="8191395">:=</span>&nbsp;<span class="ident" id="8191398">call</span><span class="op" id="8191402">.</span><span class="ident" id="8191403">Args</span><span class="op" id="8191407">.</span><span class="op" id="8191408">(</span><span class="op" id="8191409">*</span><span class="ident" id="8191410">Args</span><span class="op" id="8191414">)</span><span class="op" id="8191415">.</span><span class="ident" id="8191416">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191422">C</span>&nbsp;<span class="op" id="8191424">:=</span>&nbsp;<span class="ident" id="8191427">call</span><span class="op" id="8191431">.</span><span class="ident" id="8191432">Reply</span><span class="op" id="8191437">.</span><span class="op" id="8191438">(</span><span class="op" id="8191439">*</span><span class="ident" id="8191440">Reply</span><span class="op" id="8191445">)</span><span class="op" id="8191446">.</span><span class="ident" id="8191447">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191453">if</span>&nbsp;<span class="ident" id="8191456">A</span><span class="op" id="8191457">+</span><span class="ident" id="8191458">B</span>&nbsp;<span class="op" id="8191460">!=</span>&nbsp;<span class="ident" id="8191463">C</span>&nbsp;<span class="op" id="8191465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191472">b</span><span class="op" id="8191473">.</span><span class="ident" id="8191474">Fatalf</span><span class="op" id="8191480">(</span><span class="string" id="8191481">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8191523">,</span>&nbsp;<span class="ident" id="8191525">A</span><span class="op" id="8191526">+</span><span class="ident" id="8191527">B</span><span class="op" id="8191528">,</span>&nbsp;<span class="ident" id="8191530">C</span><span class="op" id="8191531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191543">&lt;-</span><span class="ident" id="8191545">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8191554">if</span>&nbsp;<span class="ident" id="8191557">atomic</span><span class="op" id="8191563">.</span><span class="ident" id="8191564">AddInt32</span><span class="op" id="8191572">(</span><span class="op" id="8191573">&amp;</span><span class="ident" id="8191574">recv</span><span class="op" id="8191578">,</span>&nbsp;<span class="op" id="8191580">-</span><span class="num" id="8191581">1</span><span class="op" id="8191582">)</span>&nbsp;<span class="op" id="8191584">==</span>&nbsp;<span class="num" id="8191587">0</span>&nbsp;<span class="op" id="8191589">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8191596">close</span><span class="op" id="8191601">(</span><span class="ident" id="8191602">res</span><span class="op" id="8191605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191621">wg</span><span class="op" id="8191623">.</span><span class="ident" id="8191624">Done</span><span class="op" id="8191628">(</span><span class="op" id="8191629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191633">}</span><span class="op" id="8191634">(</span><span class="op" id="8191635">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8191638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191641">wg</span><span class="op" id="8191643">.</span><span class="ident" id="8191644">Wait</span><span class="op" id="8191648">(</span><span class="op" id="8191649">)</span><br>
<span class="lineno"></span><span class="op" id="8191651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8191654">func</span>&nbsp;<span class="ident" id="8191659">BenchmarkEndToEnd</span><span class="op" id="8191676">(</span><span class="ident" id="8191677">b</span>&nbsp;<span class="op" id="8191679">*</span><span class="ident" id="8191680">testing</span><span class="op" id="8191687">.</span><span class="ident" id="8191688">B</span><span class="op" id="8191689">)</span>&nbsp;<span class="op" id="8191691">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191694">benchmarkEndToEnd</span><span class="op" id="8191711">(</span><span class="ident" id="8191712">dialDirect</span><span class="op" id="8191722">,</span>&nbsp;<span class="ident" id="8191724">b</span><span class="op" id="8191725">)</span><br>
<span class="lineno"></span><span class="op" id="8191727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8191730">func</span>&nbsp;<span class="ident" id="8191735">BenchmarkEndToEndHTTP</span><span class="op" id="8191756">(</span><span class="ident" id="8191757">b</span>&nbsp;<span class="op" id="8191759">*</span><span class="ident" id="8191760">testing</span><span class="op" id="8191767">.</span><span class="ident" id="8191768">B</span><span class="op" id="8191769">)</span>&nbsp;<span class="op" id="8191771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191774">benchmarkEndToEnd</span><span class="op" id="8191791">(</span><span class="ident" id="8191792">dialHTTP</span><span class="op" id="8191800">,</span>&nbsp;<span class="ident" id="8191802">b</span><span class="op" id="8191803">)</span><br>
<span class="lineno">675</span><span class="op" id="8191805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8191808">func</span>&nbsp;<span class="ident" id="8191813">BenchmarkEndToEndAsync</span><span class="op" id="8191835">(</span><span class="ident" id="8191836">b</span>&nbsp;<span class="op" id="8191838">*</span><span class="ident" id="8191839">testing</span><span class="op" id="8191846">.</span><span class="ident" id="8191847">B</span><span class="op" id="8191848">)</span>&nbsp;<span class="op" id="8191850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191853">benchmarkEndToEndAsync</span><span class="op" id="8191875">(</span><span class="ident" id="8191876">dialDirect</span><span class="op" id="8191886">,</span>&nbsp;<span class="ident" id="8191888">b</span><span class="op" id="8191889">)</span><br>
<span class="lineno"></span><span class="op" id="8191891">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="8191894">func</span>&nbsp;<span class="ident" id="8191899">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="8191925">(</span><span class="ident" id="8191926">b</span>&nbsp;<span class="op" id="8191928">*</span><span class="ident" id="8191929">testing</span><span class="op" id="8191936">.</span><span class="ident" id="8191937">B</span><span class="op" id="8191938">)</span>&nbsp;<span class="op" id="8191940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8191943">benchmarkEndToEndAsync</span><span class="op" id="8191965">(</span><span class="ident" id="8191966">dialHTTP</span><span class="op" id="8191974">,</span>&nbsp;<span class="ident" id="8191976">b</span><span class="op" id="8191977">)</span><br>
<span class="lineno"></span><span class="op" id="8191979">}</span>
</div>
</body>
</html>
