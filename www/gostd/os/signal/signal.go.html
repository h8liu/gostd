<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/signal</h2>
<ul>
<li><a href="/gostd/os/signal/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/signal/signal.go.html" class="current">signal.go</a></li>
<li><a href="/gostd/os/signal/signal_test.go.html">signal_test.go</a></li>
<li><a href="/gostd/os/signal/signal_unix.go.html">signal_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5780131">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5780186">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5780240">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5780291">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="5780348">package</span>&nbsp;<span class="ident" id="5780356">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5780364">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5780425">import</span>&nbsp;<span class="op" id="5780432">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5780435">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5780441">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5780448">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5780451">var</span>&nbsp;<span class="ident" id="5780455">handlers</span>&nbsp;<span class="keyword" id="5780464">struct</span>&nbsp;<span class="op" id="5780471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5780474">sync</span><span class="op" id="5780478">.</span><span class="ident" id="5780479">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5780486">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5780490">map</span><span class="op" id="5780493">[</span><span class="keyword" id="5780494">chan</span><span class="op" id="5780498">&lt;-</span>&nbsp;<span class="ident" id="5780501">os</span><span class="op" id="5780503">.</span><span class="ident" id="5780504">Signal</span><span class="op" id="5780510">]</span><span class="op" id="5780511">*</span><span class="ident" id="5780512">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5780521">ref</span>&nbsp;<span class="op" id="5780525">[</span><span class="ident" id="5780526">numSig</span><span class="op" id="5780532">]</span><span class="builtintype" id="5780533">int64</span><br>
<span class="lineno"></span><span class="op" id="5780539">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5780542">type</span>&nbsp;<span class="ident" id="5780547">handler</span>&nbsp;<span class="keyword" id="5780555">struct</span>&nbsp;<span class="op" id="5780562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5780565">mask</span>&nbsp;<span class="op" id="5780570">[</span><span class="op" id="5780571">(</span><span class="ident" id="5780572">numSig</span>&nbsp;<span class="op" id="5780579">+</span>&nbsp;<span class="num" id="5780581">31</span><span class="op" id="5780583">)</span>&nbsp;<span class="op" id="5780585">/</span>&nbsp;<span class="num" id="5780587">32</span><span class="op" id="5780589">]</span><span class="builtintype" id="5780590">uint32</span><br>
<span class="lineno"></span><span class="op" id="5780597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5780600">func</span>&nbsp;<span class="op" id="5780605">(</span><span class="ident" id="5780606">h</span>&nbsp;<span class="op" id="5780608">*</span><span class="ident" id="5780609">handler</span><span class="op" id="5780616">)</span>&nbsp;<span class="ident" id="5780618">want</span><span class="op" id="5780622">(</span><span class="ident" id="5780623">sig</span>&nbsp;<span class="builtintype" id="5780627">int</span><span class="op" id="5780630">)</span>&nbsp;<span class="builtintype" id="5780632">bool</span>&nbsp;<span class="op" id="5780637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5780640">return</span>&nbsp;<span class="op" id="5780647">(</span><span class="ident" id="5780648">h</span><span class="op" id="5780649">.</span><span class="ident" id="5780650">mask</span><span class="op" id="5780654">[</span><span class="ident" id="5780655">sig</span><span class="op" id="5780658">/</span><span class="num" id="5780659">32</span><span class="op" id="5780661">]</span><span class="op" id="5780662">&gt;&gt;</span><span class="builtintype" id="5780664">uint</span><span class="op" id="5780668">(</span><span class="ident" id="5780669">sig</span><span class="op" id="5780672">&amp;</span><span class="num" id="5780673">31</span><span class="op" id="5780675">)</span><span class="op" id="5780676">)</span><span class="op" id="5780677">&amp;</span><span class="num" id="5780678">1</span>&nbsp;<span class="op" id="5780680">!=</span>&nbsp;<span class="num" id="5780683">0</span><br>
<span class="lineno"></span><span class="op" id="5780685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5780688">func</span>&nbsp;<span class="op" id="5780693">(</span><span class="ident" id="5780694">h</span>&nbsp;<span class="op" id="5780696">*</span><span class="ident" id="5780697">handler</span><span class="op" id="5780704">)</span>&nbsp;<span class="ident" id="5780706">set</span><span class="op" id="5780709">(</span><span class="ident" id="5780710">sig</span>&nbsp;<span class="builtintype" id="5780714">int</span><span class="op" id="5780717">)</span>&nbsp;<span class="op" id="5780719">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5780722">h</span><span class="op" id="5780723">.</span><span class="ident" id="5780724">mask</span><span class="op" id="5780728">[</span><span class="ident" id="5780729">sig</span><span class="op" id="5780732">/</span><span class="num" id="5780733">32</span><span class="op" id="5780735">]</span>&nbsp;<span class="op" id="5780737">|=</span>&nbsp;<span class="num" id="5780740">1</span>&nbsp;<span class="op" id="5780742">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5780745">uint</span><span class="op" id="5780749">(</span><span class="ident" id="5780750">sig</span><span class="op" id="5780753">&amp;</span><span class="num" id="5780754">31</span><span class="op" id="5780756">)</span><br>
<span class="lineno"></span><span class="op" id="5780758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5780761">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5780825">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="5780897">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="5780941">//</span><br>
<span class="lineno"></span><span class="comment" id="5780944">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5781014">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="5781081">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="5781160">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="5781197">//</span><br>
<span class="lineno"></span><span class="comment" id="5781200">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="5781270">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5781332">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="5781396">//</span><br>
<span class="lineno"></span><span class="comment" id="5781399">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="5781470">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5781536">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="5781562">func</span>&nbsp;<span class="ident" id="5781567">Notify</span><span class="op" id="5781573">(</span><span class="ident" id="5781574">c</span>&nbsp;<span class="keyword" id="5781576">chan</span><span class="op" id="5781580">&lt;-</span>&nbsp;<span class="ident" id="5781583">os</span><span class="op" id="5781585">.</span><span class="ident" id="5781586">Signal</span><span class="op" id="5781592">,</span>&nbsp;<span class="ident" id="5781594">sig</span>&nbsp;<span class="op" id="5781598">...</span><span class="ident" id="5781601">os</span><span class="op" id="5781603">.</span><span class="ident" id="5781604">Signal</span><span class="op" id="5781610">)</span>&nbsp;<span class="op" id="5781612">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5781615">if</span>&nbsp;<span class="ident" id="5781618">c</span>&nbsp;<span class="op" id="5781620">==</span>&nbsp;<span class="builtintype" id="5781623">nil</span>&nbsp;<span class="op" id="5781627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5781631">panic</span><span class="op" id="5781636">(</span><span class="string" id="5781637">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="5781674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5781677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5781681">handlers</span><span class="op" id="5781689">.</span><span class="ident" id="5781690">Lock</span><span class="op" id="5781694">(</span><span class="op" id="5781695">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5781698">defer</span>&nbsp;<span class="ident" id="5781704">handlers</span><span class="op" id="5781712">.</span><span class="ident" id="5781713">Unlock</span><span class="op" id="5781719">(</span><span class="op" id="5781720">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5781724">h</span>&nbsp;<span class="op" id="5781726">:=</span>&nbsp;<span class="ident" id="5781729">handlers</span><span class="op" id="5781737">.</span><span class="ident" id="5781738">m</span><span class="op" id="5781739">[</span><span class="ident" id="5781740">c</span><span class="op" id="5781741">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5781744">if</span>&nbsp;<span class="ident" id="5781747">h</span>&nbsp;<span class="op" id="5781749">==</span>&nbsp;<span class="builtintype" id="5781752">nil</span>&nbsp;<span class="op" id="5781756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5781760">if</span>&nbsp;<span class="ident" id="5781763">handlers</span><span class="op" id="5781771">.</span><span class="ident" id="5781772">m</span>&nbsp;<span class="op" id="5781774">==</span>&nbsp;<span class="builtintype" id="5781777">nil</span>&nbsp;<span class="op" id="5781781">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5781786">handlers</span><span class="op" id="5781794">.</span><span class="ident" id="5781795">m</span>&nbsp;<span class="op" id="5781797">=</span>&nbsp;<span class="builtinfunc" id="5781799">make</span><span class="op" id="5781803">(</span><span class="keyword" id="5781804">map</span><span class="op" id="5781807">[</span><span class="keyword" id="5781808">chan</span><span class="op" id="5781812">&lt;-</span>&nbsp;<span class="ident" id="5781815">os</span><span class="op" id="5781817">.</span><span class="ident" id="5781818">Signal</span><span class="op" id="5781824">]</span><span class="op" id="5781825">*</span><span class="ident" id="5781826">handler</span><span class="op" id="5781833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5781837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5781841">h</span>&nbsp;<span class="op" id="5781843">=</span>&nbsp;<span class="builtinfunc" id="5781845">new</span><span class="op" id="5781848">(</span><span class="ident" id="5781849">handler</span><span class="op" id="5781856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5781860">handlers</span><span class="op" id="5781868">.</span><span class="ident" id="5781869">m</span><span class="op" id="5781870">[</span><span class="ident" id="5781871">c</span><span class="op" id="5781872">]</span>&nbsp;<span class="op" id="5781874">=</span>&nbsp;<span class="ident" id="5781876">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5781879">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5781883">add</span>&nbsp;<span class="op" id="5781887">:=</span>&nbsp;<span class="keyword" id="5781890">func</span><span class="op" id="5781894">(</span><span class="ident" id="5781895">n</span>&nbsp;<span class="builtintype" id="5781897">int</span><span class="op" id="5781900">)</span>&nbsp;<span class="op" id="5781902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5781906">if</span>&nbsp;<span class="ident" id="5781909">n</span>&nbsp;<span class="op" id="5781911">&lt;</span>&nbsp;<span class="num" id="5781913">0</span>&nbsp;<span class="op" id="5781915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5781920">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5781929">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5781933">if</span>&nbsp;<span class="op" id="5781936">!</span><span class="ident" id="5781937">h</span><span class="op" id="5781938">.</span><span class="ident" id="5781939">want</span><span class="op" id="5781943">(</span><span class="ident" id="5781944">n</span><span class="op" id="5781945">)</span>&nbsp;<span class="op" id="5781947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5781952">h</span><span class="op" id="5781953">.</span><span class="ident" id="5781954">set</span><span class="op" id="5781957">(</span><span class="ident" id="5781958">n</span><span class="op" id="5781959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5781964">if</span>&nbsp;<span class="ident" id="5781967">handlers</span><span class="op" id="5781975">.</span><span class="ident" id="5781976">ref</span><span class="op" id="5781979">[</span><span class="ident" id="5781980">n</span><span class="op" id="5781981">]</span>&nbsp;<span class="op" id="5781983">==</span>&nbsp;<span class="num" id="5781986">0</span>&nbsp;<span class="op" id="5781988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5781994">enableSignal</span><span class="op" id="5782006">(</span><span class="ident" id="5782007">n</span><span class="op" id="5782008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782013">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5782018">handlers</span><span class="op" id="5782026">.</span><span class="ident" id="5782027">ref</span><span class="op" id="5782030">[</span><span class="ident" id="5782031">n</span><span class="op" id="5782032">]</span><span class="op" id="5782033">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782045">if</span>&nbsp;<span class="builtinfunc" id="5782048">len</span><span class="op" id="5782051">(</span><span class="ident" id="5782052">sig</span><span class="op" id="5782055">)</span>&nbsp;<span class="op" id="5782057">==</span>&nbsp;<span class="num" id="5782060">0</span>&nbsp;<span class="op" id="5782062">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782066">for</span>&nbsp;<span class="ident" id="5782070">n</span>&nbsp;<span class="op" id="5782072">:=</span>&nbsp;<span class="num" id="5782075">0</span><span class="op" id="5782076">;</span>&nbsp;<span class="ident" id="5782078">n</span>&nbsp;<span class="op" id="5782080">&lt;</span>&nbsp;<span class="ident" id="5782082">numSig</span><span class="op" id="5782088">;</span>&nbsp;<span class="ident" id="5782090">n</span><span class="op" id="5782091">++</span>&nbsp;<span class="op" id="5782094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5782099">add</span><span class="op" id="5782102">(</span><span class="ident" id="5782103">n</span><span class="op" id="5782104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782111">}</span>&nbsp;<span class="keyword" id="5782113">else</span>&nbsp;<span class="op" id="5782118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782122">for</span>&nbsp;<span class="ident" id="5782126">_</span><span class="op" id="5782127">,</span>&nbsp;<span class="ident" id="5782129">s</span>&nbsp;<span class="op" id="5782131">:=</span>&nbsp;<span class="keyword" id="5782134">range</span>&nbsp;<span class="ident" id="5782140">sig</span>&nbsp;<span class="op" id="5782144">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5782149">add</span><span class="op" id="5782152">(</span><span class="ident" id="5782153">signum</span><span class="op" id="5782159">(</span><span class="ident" id="5782160">s</span><span class="op" id="5782161">)</span><span class="op" id="5782162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782169">}</span><br>
<span class="lineno"></span><span class="op" id="5782171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5782174">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5782244">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5782306">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="5782382">func</span>&nbsp;<span class="ident" id="5782387">Stop</span><span class="op" id="5782391">(</span><span class="ident" id="5782392">c</span>&nbsp;<span class="keyword" id="5782394">chan</span><span class="op" id="5782398">&lt;-</span>&nbsp;<span class="ident" id="5782401">os</span><span class="op" id="5782403">.</span><span class="ident" id="5782404">Signal</span><span class="op" id="5782410">)</span>&nbsp;<span class="op" id="5782412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5782415">handlers</span><span class="op" id="5782423">.</span><span class="ident" id="5782424">Lock</span><span class="op" id="5782428">(</span><span class="op" id="5782429">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782432">defer</span>&nbsp;<span class="ident" id="5782438">handlers</span><span class="op" id="5782446">.</span><span class="ident" id="5782447">Unlock</span><span class="op" id="5782453">(</span><span class="op" id="5782454">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5782458">h</span>&nbsp;<span class="op" id="5782460">:=</span>&nbsp;<span class="ident" id="5782463">handlers</span><span class="op" id="5782471">.</span><span class="ident" id="5782472">m</span><span class="op" id="5782473">[</span><span class="ident" id="5782474">c</span><span class="op" id="5782475">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782478">if</span>&nbsp;<span class="ident" id="5782481">h</span>&nbsp;<span class="op" id="5782483">==</span>&nbsp;<span class="builtintype" id="5782486">nil</span>&nbsp;<span class="op" id="5782490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782494">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5782505">delete</span><span class="op" id="5782511">(</span><span class="ident" id="5782512">handlers</span><span class="op" id="5782520">.</span><span class="ident" id="5782521">m</span><span class="op" id="5782522">,</span>&nbsp;<span class="ident" id="5782524">c</span><span class="op" id="5782525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782529">for</span>&nbsp;<span class="ident" id="5782533">n</span>&nbsp;<span class="op" id="5782535">:=</span>&nbsp;<span class="num" id="5782538">0</span><span class="op" id="5782539">;</span>&nbsp;<span class="ident" id="5782541">n</span>&nbsp;<span class="op" id="5782543">&lt;</span>&nbsp;<span class="ident" id="5782545">numSig</span><span class="op" id="5782551">;</span>&nbsp;<span class="ident" id="5782553">n</span><span class="op" id="5782554">++</span>&nbsp;<span class="op" id="5782557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782561">if</span>&nbsp;<span class="ident" id="5782564">h</span><span class="op" id="5782565">.</span><span class="ident" id="5782566">want</span><span class="op" id="5782570">(</span><span class="ident" id="5782571">n</span><span class="op" id="5782572">)</span>&nbsp;<span class="op" id="5782574">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5782579">handlers</span><span class="op" id="5782587">.</span><span class="ident" id="5782588">ref</span><span class="op" id="5782591">[</span><span class="ident" id="5782592">n</span><span class="op" id="5782593">]</span><span class="op" id="5782594">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782600">if</span>&nbsp;<span class="ident" id="5782603">handlers</span><span class="op" id="5782611">.</span><span class="ident" id="5782612">ref</span><span class="op" id="5782615">[</span><span class="ident" id="5782616">n</span><span class="op" id="5782617">]</span>&nbsp;<span class="op" id="5782619">==</span>&nbsp;<span class="num" id="5782622">0</span>&nbsp;<span class="op" id="5782624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5782630">disableSignal</span><span class="op" id="5782643">(</span><span class="ident" id="5782644">n</span><span class="op" id="5782645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782654">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782657">}</span><br>
<span class="lineno"></span><span class="op" id="5782659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5782662">func</span>&nbsp;<span class="ident" id="5782667">process</span><span class="op" id="5782674">(</span><span class="ident" id="5782675">sig</span>&nbsp;<span class="ident" id="5782679">os</span><span class="op" id="5782681">.</span><span class="ident" id="5782682">Signal</span><span class="op" id="5782688">)</span>&nbsp;<span class="op" id="5782690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5782693">n</span>&nbsp;<span class="op" id="5782695">:=</span>&nbsp;<span class="ident" id="5782698">signum</span><span class="op" id="5782704">(</span><span class="ident" id="5782705">sig</span><span class="op" id="5782708">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782711">if</span>&nbsp;<span class="ident" id="5782714">n</span>&nbsp;<span class="op" id="5782716">&lt;</span>&nbsp;<span class="num" id="5782718">0</span>&nbsp;<span class="op" id="5782720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782724">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5782736">handlers</span><span class="op" id="5782744">.</span><span class="ident" id="5782745">Lock</span><span class="op" id="5782749">(</span><span class="op" id="5782750">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782753">defer</span>&nbsp;<span class="ident" id="5782759">handlers</span><span class="op" id="5782767">.</span><span class="ident" id="5782768">Unlock</span><span class="op" id="5782774">(</span><span class="op" id="5782775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782779">for</span>&nbsp;<span class="ident" id="5782783">c</span><span class="op" id="5782784">,</span>&nbsp;<span class="ident" id="5782786">h</span>&nbsp;<span class="op" id="5782788">:=</span>&nbsp;<span class="keyword" id="5782791">range</span>&nbsp;<span class="ident" id="5782797">handlers</span><span class="op" id="5782805">.</span><span class="ident" id="5782806">m</span>&nbsp;<span class="op" id="5782808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782812">if</span>&nbsp;<span class="ident" id="5782815">h</span><span class="op" id="5782816">.</span><span class="ident" id="5782817">want</span><span class="op" id="5782821">(</span><span class="ident" id="5782822">n</span><span class="op" id="5782823">)</span>&nbsp;<span class="op" id="5782825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5782830">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782865">select</span>&nbsp;<span class="op" id="5782872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782877">case</span>&nbsp;<span class="ident" id="5782882">c</span>&nbsp;<span class="op" id="5782884">&lt;-</span>&nbsp;<span class="ident" id="5782887">sig</span><span class="op" id="5782890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5782895">default</span><span class="op" id="5782902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782911">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782914">}</span><br>
<span class="lineno"></span><span class="op" id="5782916">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
