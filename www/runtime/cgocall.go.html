<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1711752">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1711808">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1711862">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1711913">//&nbsp;Cgo&nbsp;call&nbsp;and&nbsp;callback&nbsp;support.</span><br>
<span class="lineno"></span><span class="comment" id="1711947">//</span><br>
<span class="lineno"></span><span class="comment" id="1711950">//&nbsp;To&nbsp;call&nbsp;into&nbsp;the&nbsp;C&nbsp;function&nbsp;f&nbsp;from&nbsp;Go,&nbsp;the&nbsp;cgo-generated&nbsp;code&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1712021">//&nbsp;runtime.cgocall(_cgo_Cfunc_f,&nbsp;frame),&nbsp;where&nbsp;_cgo_Cfunc_f&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1712086">//&nbsp;gcc-compiled&nbsp;function&nbsp;written&nbsp;by&nbsp;cgo.</span><br>
<span class="lineno">10</span><span class="comment" id="1712127">//</span><br>
<span class="lineno"></span><span class="comment" id="1712130">//&nbsp;runtime.cgocall&nbsp;(below)&nbsp;locks&nbsp;g&nbsp;to&nbsp;m,&nbsp;calls&nbsp;entersyscall</span><br>
<span class="lineno"></span><span class="comment" id="1712190">//&nbsp;so&nbsp;as&nbsp;not&nbsp;to&nbsp;block&nbsp;other&nbsp;goroutines&nbsp;or&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span><span class="comment" id="1712255">//&nbsp;and&nbsp;then&nbsp;calls&nbsp;runtime.asmcgocall(_cgo_Cfunc_f,&nbsp;frame).</span><br>
<span class="lineno"></span><span class="comment" id="1712314">//</span><br>
<span class="lineno">15</span><span class="comment" id="1712317">//&nbsp;runtime.asmcgocall&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;to&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1712386">//&nbsp;(assumed&nbsp;to&nbsp;be&nbsp;an&nbsp;operating&nbsp;system-allocated&nbsp;stack,&nbsp;so&nbsp;safe&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="1712456">//&nbsp;gcc-compiled&nbsp;code&nbsp;on)&nbsp;and&nbsp;calls&nbsp;_cgo_Cfunc_f(frame).</span><br>
<span class="lineno"></span><span class="comment" id="1712512">//</span><br>
<span class="lineno"></span><span class="comment" id="1712515">//&nbsp;_cgo_Cfunc_f&nbsp;invokes&nbsp;the&nbsp;actual&nbsp;C&nbsp;function&nbsp;f&nbsp;with&nbsp;arguments</span><br>
<span class="lineno">20</span><span class="comment" id="1712578">//&nbsp;taken&nbsp;from&nbsp;the&nbsp;frame&nbsp;structure,&nbsp;records&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;frame,</span><br>
<span class="lineno"></span><span class="comment" id="1712647">//&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.asmcgocall.</span><br>
<span class="lineno"></span><span class="comment" id="1712685">//</span><br>
<span class="lineno"></span><span class="comment" id="1712688">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.asmcgocall&nbsp;switches&nbsp;back&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1712757">//&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocall.</span><br>
<span class="lineno">25</span><span class="comment" id="1712821">//</span><br>
<span class="lineno"></span><span class="comment" id="1712824">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocall&nbsp;calls&nbsp;exitsyscall,&nbsp;which&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="1712901">//&nbsp;until&nbsp;this&nbsp;m&nbsp;can&nbsp;run&nbsp;Go&nbsp;code&nbsp;without&nbsp;violating&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit,</span><br>
<span class="lineno"></span><span class="comment" id="1712974">//&nbsp;and&nbsp;then&nbsp;unlocks&nbsp;g&nbsp;from&nbsp;m.</span><br>
<span class="lineno"></span><span class="comment" id="1713004">//</span><br>
<span class="lineno">30</span><span class="comment" id="1713007">//&nbsp;The&nbsp;above&nbsp;description&nbsp;skipped&nbsp;over&nbsp;the&nbsp;possibility&nbsp;of&nbsp;the&nbsp;gcc-compiled</span><br>
<span class="lineno"></span><span class="comment" id="1713081">//&nbsp;function&nbsp;f&nbsp;calling&nbsp;back&nbsp;into&nbsp;Go.&nbsp;&nbsp;If&nbsp;that&nbsp;happens,&nbsp;we&nbsp;continue&nbsp;down</span><br>
<span class="lineno"></span><span class="comment" id="1713152">//&nbsp;the&nbsp;rabbit&nbsp;hole&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1713198">//</span><br>
<span class="lineno"></span><span class="comment" id="1713201">//&nbsp;To&nbsp;make&nbsp;it&nbsp;possible&nbsp;for&nbsp;gcc-compiled&nbsp;C&nbsp;code&nbsp;to&nbsp;call&nbsp;a&nbsp;Go&nbsp;function&nbsp;p.GoF,</span><br>
<span class="lineno">35</span><span class="comment" id="1713277">//&nbsp;cgo&nbsp;writes&nbsp;a&nbsp;gcc-compiled&nbsp;function&nbsp;named&nbsp;GoF&nbsp;(not&nbsp;p.GoF,&nbsp;since&nbsp;gcc&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1713355">//&nbsp;know&nbsp;about&nbsp;packages).&nbsp;&nbsp;The&nbsp;gcc-compiled&nbsp;C&nbsp;function&nbsp;f&nbsp;calls&nbsp;GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1713422">//</span><br>
<span class="lineno"></span><span class="comment" id="1713425">//&nbsp;GoF&nbsp;calls&nbsp;crosscall2(_cgoexp_GoF,&nbsp;frame,&nbsp;framesize).&nbsp;&nbsp;Crosscall2</span><br>
<span class="lineno"></span><span class="comment" id="1713493">//&nbsp;(in&nbsp;cgo/gcc_$GOARCH.S,&nbsp;a&nbsp;gcc-compiled&nbsp;assembly&nbsp;file)&nbsp;is&nbsp;a&nbsp;two-argument</span><br>
<span class="lineno">40</span><span class="comment" id="1713567">//&nbsp;adapter&nbsp;from&nbsp;the&nbsp;gcc&nbsp;function&nbsp;call&nbsp;ABI&nbsp;to&nbsp;the&nbsp;6c&nbsp;function&nbsp;call&nbsp;ABI.</span><br>
<span class="lineno"></span><span class="comment" id="1713638">//&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;gcc&nbsp;to&nbsp;call&nbsp;6c&nbsp;functions.&nbsp;&nbsp;In&nbsp;this&nbsp;case&nbsp;it&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1713708">//&nbsp;_cgoexp_GoF(frame,&nbsp;framesize),&nbsp;still&nbsp;running&nbsp;on&nbsp;m-&gt;g0&#39;s&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1713773">//&nbsp;and&nbsp;outside&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit.&nbsp;&nbsp;Thus,&nbsp;this&nbsp;code&nbsp;cannot&nbsp;yet</span><br>
<span class="lineno"></span><span class="comment" id="1713839">//&nbsp;call&nbsp;arbitrary&nbsp;Go&nbsp;code&nbsp;directly&nbsp;and&nbsp;must&nbsp;be&nbsp;careful&nbsp;not&nbsp;to&nbsp;allocate</span><br>
<span class="lineno">45</span><span class="comment" id="1713910">//&nbsp;memory&nbsp;or&nbsp;use&nbsp;up&nbsp;m-&gt;g0&#39;s&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1713945">//</span><br>
<span class="lineno"></span><span class="comment" id="1713948">//&nbsp;_cgoexp_GoF&nbsp;calls&nbsp;runtime.cgocallback(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1714015">//&nbsp;(The&nbsp;reason&nbsp;for&nbsp;having&nbsp;_cgoexp_GoF&nbsp;instead&nbsp;of&nbsp;writing&nbsp;a&nbsp;crosscall3</span><br>
<span class="lineno"></span><span class="comment" id="1714085">//&nbsp;to&nbsp;make&nbsp;this&nbsp;call&nbsp;directly&nbsp;is&nbsp;that&nbsp;_cgoexp_GoF,&nbsp;because&nbsp;it&nbsp;is&nbsp;compiled</span><br>
<span class="lineno">50</span><span class="comment" id="1714159">//&nbsp;with&nbsp;6c&nbsp;instead&nbsp;of&nbsp;gcc,&nbsp;can&nbsp;refer&nbsp;to&nbsp;dotted&nbsp;names&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="1714217">//&nbsp;runtime.cgocallback&nbsp;and&nbsp;p.GoF.)</span><br>
<span class="lineno"></span><span class="comment" id="1714252">//</span><br>
<span class="lineno"></span><span class="comment" id="1714255">//&nbsp;runtime.cgocallback&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;from&nbsp;m-&gt;g0&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1714319">//&nbsp;stack&nbsp;to&nbsp;the&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack,&nbsp;on&nbsp;which&nbsp;it&nbsp;calls</span><br>
<span class="lineno">55</span><span class="comment" id="1714383">//&nbsp;runtime.cgocallbackg(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1714433">//&nbsp;As&nbsp;part&nbsp;of&nbsp;the&nbsp;stack&nbsp;switch,&nbsp;runtime.cgocallback&nbsp;saves&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="1714503">//&nbsp;SP&nbsp;as&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;so&nbsp;that&nbsp;any&nbsp;use&nbsp;of&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1714573">//&nbsp;execution&nbsp;of&nbsp;the&nbsp;callback&nbsp;will&nbsp;be&nbsp;done&nbsp;below&nbsp;the&nbsp;existing&nbsp;stack&nbsp;frames.</span><br>
<span class="lineno"></span><span class="comment" id="1714648">//&nbsp;Before&nbsp;overwriting&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;it&nbsp;pushes&nbsp;the&nbsp;old&nbsp;value&nbsp;on&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="1714718">//&nbsp;m-&gt;g0&nbsp;stack,&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;restored&nbsp;later.</span><br>
<span class="lineno"></span><span class="comment" id="1714768">//</span><br>
<span class="lineno"></span><span class="comment" id="1714771">//&nbsp;runtime.cgocallbackg&nbsp;(below)&nbsp;is&nbsp;now&nbsp;running&nbsp;on&nbsp;a&nbsp;real&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1714838">//&nbsp;stack&nbsp;(not&nbsp;an&nbsp;m-&gt;g0&nbsp;stack).&nbsp;&nbsp;First&nbsp;it&nbsp;calls&nbsp;runtime.exitsyscall,&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="1714917">//&nbsp;block&nbsp;until&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit&nbsp;allows&nbsp;running&nbsp;this&nbsp;goroutine.</span><br>
<span class="lineno">65</span><span class="comment" id="1714985">//&nbsp;Once&nbsp;exitsyscall&nbsp;has&nbsp;returned,&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;call&nbsp;the&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="1715064">//&nbsp;allocator&nbsp;or&nbsp;invoke&nbsp;the&nbsp;Go&nbsp;callback&nbsp;function&nbsp;p.GoF.&nbsp;&nbsp;runtime.cgocallbackg</span><br>
<span class="lineno"></span><span class="comment" id="1715141">//&nbsp;first&nbsp;defers&nbsp;a&nbsp;function&nbsp;to&nbsp;unwind&nbsp;m-&gt;g0.sched.sp,&nbsp;so&nbsp;that&nbsp;if&nbsp;p.GoF</span><br>
<span class="lineno"></span><span class="comment" id="1715211">//&nbsp;panics,&nbsp;m-&gt;g0.sched.sp&nbsp;will&nbsp;be&nbsp;restored&nbsp;to&nbsp;its&nbsp;old&nbsp;value:&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1715288">//&nbsp;and&nbsp;the&nbsp;m-&gt;curg&nbsp;stack&nbsp;will&nbsp;be&nbsp;unwound&nbsp;in&nbsp;lock&nbsp;step.</span><br>
<span class="lineno">70</span><span class="comment" id="1715343">//&nbsp;Then&nbsp;it&nbsp;calls&nbsp;p.GoF.&nbsp;&nbsp;Finally&nbsp;it&nbsp;pops&nbsp;but&nbsp;does&nbsp;not&nbsp;execute&nbsp;the&nbsp;deferred</span><br>
<span class="lineno"></span><span class="comment" id="1715418">//&nbsp;function,&nbsp;calls&nbsp;runtime.entersyscall,&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocallback.</span><br>
<span class="lineno"></span><span class="comment" id="1715495">//</span><br>
<span class="lineno"></span><span class="comment" id="1715498">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocallback&nbsp;switches&nbsp;back&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1715564">//&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;(the&nbsp;pointer&nbsp;is&nbsp;still&nbsp;in&nbsp;m-&gt;g0.sched.sp),&nbsp;restores&nbsp;the&nbsp;old</span><br>
<span class="lineno">75</span><span class="comment" id="1715640">//&nbsp;m-&gt;g0.sched.sp&nbsp;value&nbsp;from&nbsp;the&nbsp;stack,&nbsp;and&nbsp;returns&nbsp;to&nbsp;_cgoexp_GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1715708">//</span><br>
<span class="lineno"></span><span class="comment" id="1715711">//&nbsp;_cgoexp_GoF&nbsp;immediately&nbsp;returns&nbsp;to&nbsp;crosscall2,&nbsp;which&nbsp;restores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1715780">//&nbsp;callee-save&nbsp;registers&nbsp;for&nbsp;gcc&nbsp;and&nbsp;returns&nbsp;to&nbsp;GoF,&nbsp;which&nbsp;returns&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1715854">package</span>&nbsp;<span class="ident" id="1715862">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1715871">import</span>&nbsp;<span class="string" id="1715878">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1715888">//&nbsp;Call&nbsp;from&nbsp;Go&nbsp;to&nbsp;C.</span><br>
<span class="lineno">85</span><span class="comment" id="1715910">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1715923">func</span>&nbsp;<span class="ident" id="1715928">cgocall</span><span class="op" id="1715935">(</span><span class="ident" id="1715936">fn</span><span class="op" id="1715938">,</span>&nbsp;<span class="ident" id="1715940">arg</span>&nbsp;<span class="ident" id="1715944"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1715950">.</span><span class="ident" id="1715951">Pointer</span><span class="op" id="1715958">)</span>&nbsp;<span class="op" id="1715960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715963"><a href="/runtime/cgocall.go.html#1716007">cgocall_errno</a></span><span class="op" id="1715976">(</span><span class="ident" id="1715977"><a href="/runtime/cgocall.go.html#1715936">fn</a></span><span class="op" id="1715979">,</span>&nbsp;<span class="ident" id="1715981"><a href="/runtime/cgocall.go.html#1715940">arg</a></span><span class="op" id="1715984">)</span><br>
<span class="lineno"></span><span class="op" id="1715986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="1715989">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1716002">func</span>&nbsp;<span class="ident" id="1716007">cgocall_errno</span><span class="op" id="1716020">(</span><span class="ident" id="1716021">fn</span><span class="op" id="1716023">,</span>&nbsp;<span class="ident" id="1716025">arg</span>&nbsp;<span class="ident" id="1716029"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1716035">.</span><span class="ident" id="1716036">Pointer</span><span class="op" id="1716043">)</span>&nbsp;<span class="builtintype" id="1716045">int32</span>&nbsp;<span class="op" id="1716051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1716054">if</span>&nbsp;<span class="op" id="1716057">!</span><span class="ident" id="1716058"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021332">iscgo</a></span>&nbsp;<span class="op" id="1716064">&amp;&amp;</span>&nbsp;<span class="ident" id="1716067"><a href="/runtime/extern.go.html#1763640">GOOS</a></span>&nbsp;<span class="op" id="1716072">!=</span>&nbsp;<span class="string" id="1716075">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1716085">&amp;&amp;</span>&nbsp;<span class="ident" id="1716088"><a href="/runtime/extern.go.html#1763640">GOOS</a></span>&nbsp;<span class="op" id="1716093">!=</span>&nbsp;<span class="string" id="1716096">&#34;windows&#34;</span>&nbsp;<span class="op" id="1716106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1716110"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1716117">(</span><span class="string" id="1716118">&#34;cgocall&nbsp;unavailable&#34;</span><span class="op" id="1716139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1716142">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1716146">if</span>&nbsp;<span class="ident" id="1716149"><a href="/runtime/cgocall.go.html#1716021">fn</a></span>&nbsp;<span class="op" id="1716152">==</span>&nbsp;<span class="ident" id="1716155">nil</span>&nbsp;<span class="op" id="1716159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1716163"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1716170">(</span><span class="string" id="1716171">&#34;cgocall&nbsp;nil&#34;</span><span class="op" id="1716184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1716187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1716191">if</span>&nbsp;<span class="ident" id="1716194"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1716206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1716210"><a href="/runtime/race0.go.html#1907831">racereleasemerge</a></span><span class="op" id="1716226">(</span><span class="ident" id="1716227"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1716233">.</span><span class="ident" id="1716234">Pointer</span><span class="op" id="1716241">(</span><span class="op" id="1716242">&amp;</span><span class="ident" id="1716243"><a href="/runtime/cgocall.go.html#1720429">racecgosync</a></span><span class="op" id="1716254">)</span><span class="op" id="1716255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1716258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1716262">//&nbsp;Create&nbsp;an&nbsp;extra&nbsp;M&nbsp;for&nbsp;callbacks&nbsp;on&nbsp;threads&nbsp;not&nbsp;created&nbsp;by&nbsp;Go&nbsp;on&nbsp;first&nbsp;cgo&nbsp;call.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1716346">if</span>&nbsp;<span class="ident" id="1716349"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021259">needextram</a></span>&nbsp;<span class="op" id="1716360">==</span>&nbsp;<span class="num" id="1716363">1</span>&nbsp;<span class="op" id="1716365">&amp;&amp;</span>&nbsp;<span class="ident" id="1716368"><a href="/runtime/stubs.go.html#1974711">cas</a></span><span class="op" id="1716371">(</span><span class="op" id="1716372">&amp;</span><span class="ident" id="1716373"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021259">needextram</a></span><span class="op" id="1716383">,</span>&nbsp;<span class="num" id="1716385">1</span><span class="op" id="1716386">,</span>&nbsp;<span class="num" id="1716388">0</span><span class="op" id="1716389">)</span>&nbsp;<span class="op" id="1716391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1716395"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1716398">(</span><span class="ident" id="1716399"><a href="/runtime/stubs.go.html#1972781">newextram</a></span><span class="op" id="1716408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1716411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1716415">/*<br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Lock&nbsp;g&nbsp;to&nbsp;m&nbsp;to&nbsp;ensure&nbsp;we&nbsp;stay&nbsp;on&nbsp;the&nbsp;same&nbsp;stack&nbsp;if&nbsp;we&nbsp;do&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;cgo&nbsp;callback.&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1716548"><a href="/runtime/stubs.go.html#1972798">lockOSThread</a></span><span class="op" id="1716560">(</span><span class="op" id="1716561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1716564">mp</span>&nbsp;<span class="op" id="1716567">:=</span>&nbsp;<span class="ident" id="1716570"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1716574">(</span><span class="op" id="1716575">)</span><span class="op" id="1716576">.</span><span class="ident" id="1716577">m</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1716580"><a href="/runtime/cgocall.go.html#1716564">mp</a></span><span class="op" id="1716582">.</span><span class="ident" id="1716583">ncgocall</span><span class="op" id="1716591">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1716595"><a href="/runtime/cgocall.go.html#1716564">mp</a></span><span class="op" id="1716597">.</span><span class="ident" id="1716598">ncgo</span><span class="op" id="1716602">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1716606">defer</span>&nbsp;<span class="ident" id="1716612"><a href="/runtime/cgocall.go.html#1717085">endcgo</a></span><span class="op" id="1716618">(</span><span class="ident" id="1716619"><a href="/runtime/cgocall.go.html#1716564">mp</a></span><span class="op" id="1716621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1716625">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Announce&nbsp;we&nbsp;are&nbsp;entering&nbsp;a&nbsp;system&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;so&nbsp;that&nbsp;the&nbsp;scheduler&nbsp;knows&nbsp;to&nbsp;create&nbsp;another<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;M&nbsp;to&nbsp;run&nbsp;goroutines&nbsp;while&nbsp;we&nbsp;are&nbsp;in&nbsp;the<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;foreign&nbsp;code.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;The&nbsp;call&nbsp;to&nbsp;asmcgocall&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;split&nbsp;the&nbsp;stack&nbsp;and&nbsp;does&nbsp;not&nbsp;allocate&nbsp;memory,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;so&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;while&nbsp;&#34;in&nbsp;a&nbsp;system&nbsp;call&#34;,&nbsp;outside<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;the&nbsp;$GOMAXPROCS&nbsp;accounting.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1716983"><a href="/runtime/stubs.go.html#1973386">entersyscall</a></span><span class="op" id="1716995">(</span><span class="op" id="1716996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1716999">errno</span>&nbsp;<span class="op" id="1717005">:=</span>&nbsp;<span class="ident" id="1717008"><a href="/runtime/stubs.go.html#1976541">asmcgocall_errno</a></span><span class="op" id="1717024">(</span><span class="ident" id="1717025"><a href="/runtime/cgocall.go.html#1716021">fn</a></span><span class="op" id="1717027">,</span>&nbsp;<span class="ident" id="1717029"><a href="/runtime/cgocall.go.html#1716025">arg</a></span><span class="op" id="1717032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1717035"><a href="/runtime/stubs.go.html#1973482">exitsyscall</a></span><span class="op" id="1717046">(</span><span class="op" id="1717047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1717051">return</span>&nbsp;<span class="ident" id="1717058"><a href="/runtime/cgocall.go.html#1716999">errno</a></span><br>
<span class="lineno">135</span><span class="op" id="1717064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1717067">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1717080">func</span>&nbsp;<span class="ident" id="1717085">endcgo</span><span class="op" id="1717091">(</span><span class="ident" id="1717092">mp</span>&nbsp;<span class="op" id="1717095">*</span><span class="ident" id="1717096"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017777">m</a></span><span class="op" id="1717097">)</span>&nbsp;<span class="op" id="1717099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1717102"><a href="/runtime/cgocall.go.html#1717092">mp</a></span><span class="op" id="1717104">.</span><span class="ident" id="1717105">ncgo</span><span class="op" id="1717109">--</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1717113">if</span>&nbsp;<span class="ident" id="1717116"><a href="/runtime/cgocall.go.html#1717092">mp</a></span><span class="op" id="1717118">.</span><span class="ident" id="1717119">ncgo</span>&nbsp;<span class="op" id="1717124">==</span>&nbsp;<span class="num" id="1717127">0</span>&nbsp;<span class="op" id="1717129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1717133">//&nbsp;We&nbsp;are&nbsp;going&nbsp;back&nbsp;to&nbsp;Go&nbsp;and&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;recursive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1717189">//&nbsp;call.&nbsp;&nbsp;Let&nbsp;the&nbsp;GC&nbsp;collect&nbsp;any&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1717245">//&nbsp;_cgo_allocate&nbsp;that&nbsp;is&nbsp;no&nbsp;longer&nbsp;referenced.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1717294"><a href="/runtime/cgocall.go.html#1717092">mp</a></span><span class="op" id="1717296">.</span><span class="ident" id="1717297">cgomal</span>&nbsp;<span class="op" id="1717304">=</span>&nbsp;<span class="ident" id="1717306">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1717311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1717315">if</span>&nbsp;<span class="ident" id="1717318"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1717330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1717334"><a href="/runtime/race0.go.html#1907447">raceacquire</a></span><span class="op" id="1717345">(</span><span class="ident" id="1717346"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1717352">.</span><span class="ident" id="1717353">Pointer</span><span class="op" id="1717360">(</span><span class="op" id="1717361">&amp;</span><span class="ident" id="1717362"><a href="/runtime/cgocall.go.html#1720429">racecgosync</a></span><span class="op" id="1717373">)</span><span class="op" id="1717374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1717377">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1717381"><a href="/runtime/stubs.go.html#1972818">unlockOSThread</a></span><span class="op" id="1717395">(</span><span class="op" id="1717396">)</span>&nbsp;<span class="comment" id="1717398">//&nbsp;invalidates&nbsp;mp</span><br>
<span class="lineno"></span><span class="op" id="1717416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1717419">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;cgo&nbsp;code.</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="1717454">//&nbsp;Filled&nbsp;by&nbsp;schedinit&nbsp;from&nbsp;corresponding&nbsp;C&nbsp;variables,</span><br>
<span class="lineno"></span><span class="comment" id="1717509">//&nbsp;which&nbsp;are&nbsp;in&nbsp;turn&nbsp;filled&nbsp;in&nbsp;by&nbsp;dynamic&nbsp;linker&nbsp;when&nbsp;Cgo&nbsp;is&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="1717581">var</span>&nbsp;<span class="ident" id="1717585">cgoMalloc</span><span class="op" id="1717594">,</span>&nbsp;<span class="ident" id="1717596">cgoFree</span>&nbsp;<span class="ident" id="1717604"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1717610">.</span><span class="ident" id="1717611">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1717620">func</span>&nbsp;<span class="ident" id="1717625">cmalloc</span><span class="op" id="1717632">(</span><span class="ident" id="1717633">n</span>&nbsp;<span class="builtintype" id="1717635">uintptr</span><span class="op" id="1717642">)</span>&nbsp;<span class="ident" id="1717644"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1717650">.</span><span class="ident" id="1717651">Pointer</span>&nbsp;<span class="op" id="1717659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1717662">var</span>&nbsp;<span class="ident" id="1717666">args</span>&nbsp;<span class="keyword" id="1717671">struct</span>&nbsp;<span class="op" id="1717678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1717682">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1717686">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1717695">ret</span>&nbsp;<span class="ident" id="1717699"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1717705">.</span><span class="ident" id="1717706">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1717715">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1717718"><a href="/runtime/cgocall.go.html#1717666">args</a></span><span class="op" id="1717722">.</span><span class="ident" id="1717723">n</span>&nbsp;<span class="op" id="1717725">=</span>&nbsp;<span class="ident" id="1717727">uint64</span><span class="op" id="1717733">(</span><span class="ident" id="1717734"><a href="/runtime/cgocall.go.html#1717633">n</a></span><span class="op" id="1717735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1717738"><a href="/runtime/cgocall.go.html#1715928">cgocall</a></span><span class="op" id="1717745">(</span><span class="ident" id="1717746"><a href="/runtime/cgocall.go.html#1717585">cgoMalloc</a></span><span class="op" id="1717755">,</span>&nbsp;<span class="ident" id="1717757"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1717763">.</span><span class="ident" id="1717764">Pointer</span><span class="op" id="1717771">(</span><span class="op" id="1717772">&amp;</span><span class="ident" id="1717773"><a href="/runtime/cgocall.go.html#1717666">args</a></span><span class="op" id="1717777">)</span><span class="op" id="1717778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1717781">if</span>&nbsp;<span class="ident" id="1717784"><a href="/runtime/cgocall.go.html#1717666">args</a></span><span class="op" id="1717788">.</span><span class="ident" id="1717789">ret</span>&nbsp;<span class="op" id="1717793">==</span>&nbsp;<span class="ident" id="1717796">nil</span>&nbsp;<span class="op" id="1717800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1717804"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1717811">(</span><span class="string" id="1717812">&#34;C&nbsp;malloc&nbsp;failed&#34;</span><span class="op" id="1717829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1717832">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1717835">return</span>&nbsp;<span class="ident" id="1717842"><a href="/runtime/cgocall.go.html#1717666">args</a></span><span class="op" id="1717846">.</span><span class="ident" id="1717847">ret</span><br>
<span class="lineno"></span><span class="op" id="1717851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1717854">func</span>&nbsp;<span class="ident" id="1717859">cfree</span><span class="op" id="1717864">(</span><span class="ident" id="1717865">p</span>&nbsp;<span class="ident" id="1717867"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1717873">.</span><span class="ident" id="1717874">Pointer</span><span class="op" id="1717881">)</span>&nbsp;<span class="op" id="1717883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1717886"><a href="/runtime/cgocall.go.html#1715928">cgocall</a></span><span class="op" id="1717893">(</span><span class="ident" id="1717894"><a href="/runtime/cgocall.go.html#1717596">cgoFree</a></span><span class="op" id="1717901">,</span>&nbsp;<span class="ident" id="1717903"><a href="/runtime/cgocall.go.html#1717865">p</a></span><span class="op" id="1717904">)</span><br>
<span class="lineno">175</span><span class="op" id="1717906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1717909">//&nbsp;Call&nbsp;from&nbsp;C&nbsp;back&nbsp;to&nbsp;Go.</span><br>
<span class="lineno"></span><span class="comment" id="1717936">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1717949">func</span>&nbsp;<span class="ident" id="1717954">cgocallbackg</span><span class="op" id="1717966">(</span><span class="op" id="1717967">)</span>&nbsp;<span class="op" id="1717969">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1717972">gp</span>&nbsp;<span class="op" id="1717975">:=</span>&nbsp;<span class="ident" id="1717978"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1717982">(</span><span class="op" id="1717983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1717986">if</span>&nbsp;<span class="ident" id="1717989"><a href="/runtime/cgocall.go.html#1717972">gp</a></span>&nbsp;<span class="op" id="1717992">!=</span>&nbsp;<span class="ident" id="1717995"><a href="/runtime/cgocall.go.html#1717972">gp</a></span><span class="op" id="1717997">.</span><span class="ident" id="1717998">m</span><span class="op" id="1717999">.</span><span class="ident" id="1718000">curg</span>&nbsp;<span class="op" id="1718005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1718009">println</span><span class="op" id="1718016">(</span><span class="string" id="1718017">&#34;runtime:&nbsp;bad&nbsp;g&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1718048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718052"><a href="/runtime/stubs.go.html#1973863">exit</a></span><span class="op" id="1718056">(</span><span class="num" id="1718057">2</span><span class="op" id="1718058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1718061">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1718065">//&nbsp;entersyscall&nbsp;saves&nbsp;the&nbsp;caller&#39;s&nbsp;SP&nbsp;to&nbsp;allow&nbsp;the&nbsp;GC&nbsp;to&nbsp;trace&nbsp;the&nbsp;Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1718136">//&nbsp;stack.&nbsp;However,&nbsp;since&nbsp;we&#39;re&nbsp;returning&nbsp;to&nbsp;an&nbsp;earlier&nbsp;stack&nbsp;frame&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1718208">//&nbsp;need&nbsp;to&nbsp;pair&nbsp;with&nbsp;the&nbsp;entersyscall()&nbsp;call&nbsp;made&nbsp;by&nbsp;cgocall,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1718279">//&nbsp;save&nbsp;syscall*&nbsp;and&nbsp;let&nbsp;reentersyscall&nbsp;restore&nbsp;them.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718334">savedsp</span>&nbsp;<span class="op" id="1718342">:=</span>&nbsp;<span class="ident" id="1718345"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1718351">.</span><span class="ident" id="1718352">Pointer</span><span class="op" id="1718359">(</span><span class="ident" id="1718360"><a href="/runtime/cgocall.go.html#1717972">gp</a></span><span class="op" id="1718362">.</span><span class="ident" id="1718363">syscallsp</span><span class="op" id="1718372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718375">savedpc</span>&nbsp;<span class="op" id="1718383">:=</span>&nbsp;<span class="ident" id="1718386"><a href="/runtime/cgocall.go.html#1717972">gp</a></span><span class="op" id="1718388">.</span><span class="ident" id="1718389">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718400"><a href="/runtime/stubs.go.html#1973482">exitsyscall</a></span><span class="op" id="1718411">(</span><span class="op" id="1718412">)</span>&nbsp;<span class="comment" id="1718414">//&nbsp;coming&nbsp;out&nbsp;of&nbsp;cgo&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718441"><a href="/runtime/cgocall.go.html#1718526">cgocallbackg1</a></span><span class="op" id="1718454">(</span><span class="op" id="1718455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1718458">//&nbsp;going&nbsp;back&nbsp;to&nbsp;cgo&nbsp;call</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718485"><a href="/runtime/stubs.go.html#1973406">reentersyscall</a></span><span class="op" id="1718499">(</span><span class="ident" id="1718500"><a href="/runtime/cgocall.go.html#1718375">savedpc</a></span><span class="op" id="1718507">,</span>&nbsp;<span class="ident" id="1718509"><a href="/runtime/cgocall.go.html#1718334">savedsp</a></span><span class="op" id="1718516">)</span><br>
<span class="lineno"></span><span class="op" id="1718518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1718521">func</span>&nbsp;<span class="ident" id="1718526">cgocallbackg1</span><span class="op" id="1718539">(</span><span class="op" id="1718540">)</span>&nbsp;<span class="op" id="1718542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718545">gp</span>&nbsp;<span class="op" id="1718548">:=</span>&nbsp;<span class="ident" id="1718551"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1718555">(</span><span class="op" id="1718556">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1718559">if</span>&nbsp;<span class="ident" id="1718562"><a href="/runtime/cgocall.go.html#1718545">gp</a></span><span class="op" id="1718564">.</span><span class="ident" id="1718565">m</span><span class="op" id="1718566">.</span><span class="ident" id="1718567">needextram</span>&nbsp;<span class="op" id="1718578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718582"><a href="/runtime/cgocall.go.html#1718545">gp</a></span><span class="op" id="1718584">.</span><span class="ident" id="1718585">m</span><span class="op" id="1718586">.</span><span class="ident" id="1718587">needextram</span>&nbsp;<span class="op" id="1718598">=</span>&nbsp;<span class="ident" id="1718600">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718608"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1718611">(</span><span class="ident" id="1718612"><a href="/runtime/stubs.go.html#1972781">newextram</a></span><span class="op" id="1718621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1718624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1718628">//&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718675">restore</span>&nbsp;<span class="op" id="1718683">:=</span>&nbsp;<span class="ident" id="1718686">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1718692">defer</span>&nbsp;<span class="ident" id="1718698"><a href="/runtime/cgocall.go.html#1719823">unwindm</a></span><span class="op" id="1718705">(</span><span class="op" id="1718706">&amp;</span><span class="ident" id="1718707"><a href="/runtime/cgocall.go.html#1718675">restore</a></span><span class="op" id="1718714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1718718">if</span>&nbsp;<span class="ident" id="1718721"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1718733">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718737"><a href="/runtime/race0.go.html#1907447">raceacquire</a></span><span class="op" id="1718748">(</span><span class="ident" id="1718749"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1718755">.</span><span class="ident" id="1718756">Pointer</span><span class="op" id="1718763">(</span><span class="op" id="1718764">&amp;</span><span class="ident" id="1718765"><a href="/runtime/cgocall.go.html#1720429">racecgosync</a></span><span class="op" id="1718776">)</span><span class="op" id="1718777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1718780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1718784">type</span>&nbsp;<span class="ident" id="1718789">args</span>&nbsp;<span class="keyword" id="1718794">struct</span>&nbsp;<span class="op" id="1718801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718805">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1718813">*</span><span class="ident" id="1718814"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016291">funcval</a></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718824">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1718832"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1718838">.</span><span class="ident" id="1718839">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1718849">argsize</span>&nbsp;<span class="builtintype" id="1718857">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1718866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1718869">var</span>&nbsp;<span class="ident" id="1718873">cb</span>&nbsp;<span class="op" id="1718876">*</span><span class="ident" id="1718877"><a href="/runtime/cgocall.go.html#1718789">args</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1718884">//&nbsp;Location&nbsp;of&nbsp;callback&nbsp;arguments&nbsp;depends&nbsp;on&nbsp;stack&nbsp;frame&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1718949">//&nbsp;and&nbsp;size&nbsp;of&nbsp;stack&nbsp;frame&nbsp;of&nbsp;cgocallback_gofunc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1719000">sp</span>&nbsp;<span class="op" id="1719003">:=</span>&nbsp;<span class="ident" id="1719006"><a href="/runtime/cgocall.go.html#1718545">gp</a></span><span class="op" id="1719008">.</span><span class="ident" id="1719009">m</span><span class="op" id="1719010">.</span><span class="ident" id="1719011">g0</span><span class="op" id="1719013">.</span><span class="ident" id="1719014">sched</span><span class="op" id="1719019">.</span><span class="ident" id="1719020">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1719024">switch</span>&nbsp;<span class="ident" id="1719031"><a href="/runtime/extern.go.html#1763748">GOARCH</a></span>&nbsp;<span class="op" id="1719038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1719041">default</span><span class="op" id="1719048">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1719052"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1719059">(</span><span class="string" id="1719060">&#34;cgocallbackg&nbsp;is&nbsp;unimplemented&nbsp;on&nbsp;arch&#34;</span><span class="op" id="1719099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1719102">case</span>&nbsp;<span class="string" id="1719107">&#34;arm&#34;</span><span class="op" id="1719112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1719116">//&nbsp;On&nbsp;arm,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;two&nbsp;words&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;saved&nbsp;LR&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1719185">//&nbsp;SP&nbsp;and&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;between&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;the&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1719260"><a href="/runtime/cgocall.go.html#1718873">cb</a></span>&nbsp;<span class="op" id="1719263">=</span>&nbsp;<span class="op" id="1719265">(</span><span class="op" id="1719266">*</span><span class="ident" id="1719267"><a href="/runtime/cgocall.go.html#1718789">args</a></span><span class="op" id="1719271">)</span><span class="op" id="1719272">(</span><span class="ident" id="1719273"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1719279">.</span><span class="ident" id="1719280">Pointer</span><span class="op" id="1719287">(</span><span class="ident" id="1719288"><a href="/runtime/cgocall.go.html#1719000">sp</a></span>&nbsp;<span class="op" id="1719291">+</span>&nbsp;<span class="num" id="1719293">4</span><span class="op" id="1719294">*</span><span class="ident" id="1719295"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span><span class="op" id="1719302">)</span><span class="op" id="1719303">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1719306">case</span>&nbsp;<span class="string" id="1719311">&#34;amd64&#34;</span><span class="op" id="1719318">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1719322">//&nbsp;On&nbsp;amd64,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;one&nbsp;word,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1719378"><a href="/runtime/cgocall.go.html#1718873">cb</a></span>&nbsp;<span class="op" id="1719381">=</span>&nbsp;<span class="op" id="1719383">(</span><span class="op" id="1719384">*</span><span class="ident" id="1719385"><a href="/runtime/cgocall.go.html#1718789">args</a></span><span class="op" id="1719389">)</span><span class="op" id="1719390">(</span><span class="ident" id="1719391"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1719397">.</span><span class="ident" id="1719398">Pointer</span><span class="op" id="1719405">(</span><span class="ident" id="1719406"><a href="/runtime/cgocall.go.html#1719000">sp</a></span>&nbsp;<span class="op" id="1719409">+</span>&nbsp;<span class="num" id="1719411">2</span><span class="op" id="1719412">*</span><span class="ident" id="1719413"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span><span class="op" id="1719420">)</span><span class="op" id="1719421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1719424">case</span>&nbsp;<span class="string" id="1719429">&#34;386&#34;</span><span class="op" id="1719434">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1719438">//&nbsp;On&nbsp;386,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;three&nbsp;words,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1719495"><a href="/runtime/cgocall.go.html#1718873">cb</a></span>&nbsp;<span class="op" id="1719498">=</span>&nbsp;<span class="op" id="1719500">(</span><span class="op" id="1719501">*</span><span class="ident" id="1719502"><a href="/runtime/cgocall.go.html#1718789">args</a></span><span class="op" id="1719506">)</span><span class="op" id="1719507">(</span><span class="ident" id="1719508"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1719514">.</span><span class="ident" id="1719515">Pointer</span><span class="op" id="1719522">(</span><span class="ident" id="1719523"><a href="/runtime/cgocall.go.html#1719000">sp</a></span>&nbsp;<span class="op" id="1719526">+</span>&nbsp;<span class="num" id="1719528">4</span><span class="op" id="1719529">*</span><span class="ident" id="1719530"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span><span class="op" id="1719537">)</span><span class="op" id="1719538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1719541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1719545">//&nbsp;Invoke&nbsp;callback.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1719566"><a href="/runtime/stubs.go.html#1974328">reflectcall</a></span><span class="op" id="1719577">(</span><span class="ident" id="1719578"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1719584">.</span><span class="ident" id="1719585">Pointer</span><span class="op" id="1719592">(</span><span class="ident" id="1719593"><a href="/runtime/cgocall.go.html#1718873">cb</a></span><span class="op" id="1719595">.</span><span class="ident" id="1719596">fn</span><span class="op" id="1719598">)</span><span class="op" id="1719599">,</span>&nbsp;<span class="ident" id="1719601"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1719607">.</span><span class="ident" id="1719608">Pointer</span><span class="op" id="1719615">(</span><span class="ident" id="1719616"><a href="/runtime/cgocall.go.html#1718873">cb</a></span><span class="op" id="1719618">.</span><span class="ident" id="1719619">arg</span><span class="op" id="1719622">)</span><span class="op" id="1719623">,</span>&nbsp;<span class="builtintype" id="1719625">uint32</span><span class="op" id="1719631">(</span><span class="ident" id="1719632"><a href="/runtime/cgocall.go.html#1718873">cb</a></span><span class="op" id="1719634">.</span><span class="ident" id="1719635">argsize</span><span class="op" id="1719642">)</span><span class="op" id="1719643">,</span>&nbsp;<span class="num" id="1719645">0</span><span class="op" id="1719646">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1719650">if</span>&nbsp;<span class="ident" id="1719653"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1719665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1719669"><a href="/runtime/race0.go.html#1907831">racereleasemerge</a></span><span class="op" id="1719685">(</span><span class="ident" id="1719686"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1719692">.</span><span class="ident" id="1719693">Pointer</span><span class="op" id="1719700">(</span><span class="op" id="1719701">&amp;</span><span class="ident" id="1719702"><a href="/runtime/cgocall.go.html#1720429">racecgosync</a></span><span class="op" id="1719713">)</span><span class="op" id="1719714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1719717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1719721">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;m-&gt;g0-&gt;sched.sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1719756">//&nbsp;Our&nbsp;caller,&nbsp;cgocallback,&nbsp;will&nbsp;do&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1719799"><a href="/runtime/cgocall.go.html#1718675">restore</a></span>&nbsp;<span class="op" id="1719807">=</span>&nbsp;<span class="ident" id="1719809">false</span><br>
<span class="lineno"></span><span class="op" id="1719815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="1719818">func</span>&nbsp;<span class="ident" id="1719823">unwindm</span><span class="op" id="1719830">(</span><span class="ident" id="1719831">restore</span>&nbsp;<span class="op" id="1719839">*</span><span class="builtintype" id="1719840">bool</span><span class="op" id="1719844">)</span>&nbsp;<span class="op" id="1719846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1719849">if</span>&nbsp;<span class="op" id="1719852">!</span><span class="op" id="1719853">*</span><span class="ident" id="1719854"><a href="/runtime/cgocall.go.html#1719831">restore</a></span>&nbsp;<span class="op" id="1719862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1719866">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1719874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1719877">//&nbsp;Restore&nbsp;sp&nbsp;saved&nbsp;by&nbsp;cgocallback&nbsp;during</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1719920">//&nbsp;unwind&nbsp;of&nbsp;g&#39;s&nbsp;stack&nbsp;(see&nbsp;comment&nbsp;at&nbsp;top&nbsp;of&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1719974">mp</span>&nbsp;<span class="op" id="1719977">:=</span>&nbsp;<span class="ident" id="1719980"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1719988">(</span><span class="op" id="1719989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1719992">sched</span>&nbsp;<span class="op" id="1719998">:=</span>&nbsp;<span class="op" id="1720001">&amp;</span><span class="ident" id="1720002"><a href="/runtime/cgocall.go.html#1719974">mp</a></span><span class="op" id="1720004">.</span><span class="ident" id="1720005">g0</span><span class="op" id="1720007">.</span><span class="ident" id="1720008">sched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1720015">switch</span>&nbsp;<span class="ident" id="1720022"><a href="/runtime/extern.go.html#1763748">GOARCH</a></span>&nbsp;<span class="op" id="1720029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1720032">default</span><span class="op" id="1720039">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1720043"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1720050">(</span><span class="string" id="1720051">&#34;unwindm&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1720076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1720079">case</span>&nbsp;<span class="string" id="1720084">&#34;386&#34;</span><span class="op" id="1720089">,</span>&nbsp;<span class="string" id="1720091">&#34;amd64&#34;</span><span class="op" id="1720098">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1720102"><a href="/runtime/cgocall.go.html#1719992">sched</a></span><span class="op" id="1720107">.</span><span class="ident" id="1720108">sp</span>&nbsp;<span class="op" id="1720111">=</span>&nbsp;<span class="op" id="1720113">*</span><span class="op" id="1720114">(</span><span class="op" id="1720115">*</span><span class="builtintype" id="1720116">uintptr</span><span class="op" id="1720123">)</span><span class="op" id="1720124">(</span><span class="ident" id="1720125"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1720131">.</span><span class="ident" id="1720132">Pointer</span><span class="op" id="1720139">(</span><span class="ident" id="1720140"><a href="/runtime/cgocall.go.html#1719992">sched</a></span><span class="op" id="1720145">.</span><span class="ident" id="1720146">sp</span><span class="op" id="1720148">)</span><span class="op" id="1720149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1720152">case</span>&nbsp;<span class="string" id="1720157">&#34;arm&#34;</span><span class="op" id="1720162">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1720166"><a href="/runtime/cgocall.go.html#1719992">sched</a></span><span class="op" id="1720171">.</span><span class="ident" id="1720172">sp</span>&nbsp;<span class="op" id="1720175">=</span>&nbsp;<span class="op" id="1720177">*</span><span class="op" id="1720178">(</span><span class="op" id="1720179">*</span><span class="builtintype" id="1720180">uintptr</span><span class="op" id="1720187">)</span><span class="op" id="1720188">(</span><span class="ident" id="1720189"><a href="/runtime/cgocall.go.html#1715878">unsafe</a></span><span class="op" id="1720195">.</span><span class="ident" id="1720196">Pointer</span><span class="op" id="1720203">(</span><span class="ident" id="1720204"><a href="/runtime/cgocall.go.html#1719992">sched</a></span><span class="op" id="1720209">.</span><span class="ident" id="1720210">sp</span>&nbsp;<span class="op" id="1720213">+</span>&nbsp;<span class="num" id="1720215">4</span><span class="op" id="1720216">)</span><span class="op" id="1720217">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1720220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1720223"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1720231">(</span><span class="ident" id="1720232"><a href="/runtime/cgocall.go.html#1719974">mp</a></span><span class="op" id="1720234">)</span><br>
<span class="lineno"></span><span class="op" id="1720236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1720239">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno">270</span><span class="keyword" id="1720263">func</span>&nbsp;<span class="ident" id="1720268">badcgocallback</span><span class="op" id="1720282">(</span><span class="op" id="1720283">)</span>&nbsp;<span class="op" id="1720285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1720288"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1720295">(</span><span class="string" id="1720296">&#34;misaligned&nbsp;stack&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1720329">)</span><br>
<span class="lineno"></span><span class="op" id="1720331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1720334">//&nbsp;called&nbsp;from&nbsp;(incomplete)&nbsp;assembly</span><br>
<span class="lineno">275</span><span class="keyword" id="1720371">func</span>&nbsp;<span class="ident" id="1720376">cgounimpl</span><span class="op" id="1720385">(</span><span class="op" id="1720386">)</span>&nbsp;<span class="op" id="1720388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1720391"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1720398">(</span><span class="string" id="1720399">&#34;cgo&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1720420">)</span><br>
<span class="lineno"></span><span class="op" id="1720422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1720425">var</span>&nbsp;<span class="ident" id="1720429">racecgosync</span>&nbsp;<span class="ident" id="1720441">uint64</span>&nbsp;<span class="comment" id="1720448">//&nbsp;represents&nbsp;possible&nbsp;synchronization&nbsp;in&nbsp;C&nbsp;code</span>
</div>
</body>
</html>
