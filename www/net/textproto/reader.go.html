<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3629961">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3630017">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3630071">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3630122">package</span>&nbsp;<span class="ident" id="3630130">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3630141">import</span>&nbsp;<span class="op" id="3630148">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3630151">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3630160">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3630169">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3630175">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3630188">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3630199">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3630209">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3630212">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="3630277">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3630342">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3630392">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="3630456">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3630513">type</span>&nbsp;<span class="ident" id="3630518">Reader</span>&nbsp;<span class="keyword" id="3630525">struct</span>&nbsp;<span class="op" id="3630532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630535">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3630539">*</span><span class="ident" id="3630540"><a href="/net/textproto/reader.go.html#3630151">bufio</a></span><span class="op" id="3630545">.</span><span class="ident" id="3630546">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630554">dot</span>&nbsp;<span class="op" id="3630558">*</span><span class="ident" id="3630559"><a href="/net/textproto/reader.go.html#3638139">dotReader</a></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630570">buf</span>&nbsp;<span class="op" id="3630574">[</span><span class="op" id="3630575">]</span><span class="builtintype" id="3630576">byte</span>&nbsp;<span class="comment" id="3630581">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="3630630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3630633">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3630683">func</span>&nbsp;<span class="ident" id="3630688">NewReader</span><span class="op" id="3630697">(</span><span class="ident" id="3630698">r</span>&nbsp;<span class="op" id="3630700">*</span><span class="ident" id="3630701"><a href="/net/textproto/reader.go.html#3630151">bufio</a></span><span class="op" id="3630706">.</span><span class="ident" id="3630707">Reader</span><span class="op" id="3630713">)</span>&nbsp;<span class="op" id="3630715">*</span><span class="ident" id="3630716"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span>&nbsp;<span class="op" id="3630723">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630726">return</span>&nbsp;<span class="op" id="3630733">&amp;</span><span class="ident" id="3630734"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3630740">{</span><span class="ident" id="3630741">R</span><span class="op" id="3630742">:</span>&nbsp;<span class="ident" id="3630744"><a href="/net/textproto/reader.go.html#3630698">r</a></span><span class="op" id="3630745">}</span><br>
<span class="lineno"></span><span class="op" id="3630747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3630750">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3630790">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="3630848">func</span>&nbsp;<span class="op" id="3630853">(</span><span class="ident" id="3630854">r</span>&nbsp;<span class="op" id="3630856">*</span><span class="ident" id="3630857"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3630863">)</span>&nbsp;<span class="ident" id="3630865">ReadLine</span><span class="op" id="3630873">(</span><span class="op" id="3630874">)</span>&nbsp;<span class="op" id="3630876">(</span><span class="builtintype" id="3630877">string</span><span class="op" id="3630883">,</span>&nbsp;<span class="builtintype" id="3630885">error</span><span class="op" id="3630890">)</span>&nbsp;<span class="op" id="3630892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630895">line</span><span class="op" id="3630899">,</span>&nbsp;<span class="ident" id="3630901">err</span>&nbsp;<span class="op" id="3630905">:=</span>&nbsp;<span class="ident" id="3630908"><a href="/net/textproto/reader.go.html#3630854">r</a></span><span class="op" id="3630909">.</span><span class="ident" id="3630910">readLineSlice</span><span class="op" id="3630923">(</span><span class="op" id="3630924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630927">return</span>&nbsp;<span class="builtintype" id="3630934">string</span><span class="op" id="3630940">(</span><span class="ident" id="3630941"><a href="/net/textproto/reader.go.html#3630895">line</a></span><span class="op" id="3630945">)</span><span class="op" id="3630946">,</span>&nbsp;<span class="ident" id="3630948"><a href="/net/textproto/reader.go.html#3630901">err</a></span><br>
<span class="lineno"></span><span class="op" id="3630952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3630955">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3631031">func</span>&nbsp;<span class="op" id="3631036">(</span><span class="ident" id="3631037">r</span>&nbsp;<span class="op" id="3631039">*</span><span class="ident" id="3631040"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3631046">)</span>&nbsp;<span class="ident" id="3631048">ReadLineBytes</span><span class="op" id="3631061">(</span><span class="op" id="3631062">)</span>&nbsp;<span class="op" id="3631064">(</span><span class="op" id="3631065">[</span><span class="op" id="3631066">]</span><span class="builtintype" id="3631067">byte</span><span class="op" id="3631071">,</span>&nbsp;<span class="builtintype" id="3631073">error</span><span class="op" id="3631078">)</span>&nbsp;<span class="op" id="3631080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631083">line</span><span class="op" id="3631087">,</span>&nbsp;<span class="ident" id="3631089">err</span>&nbsp;<span class="op" id="3631093">:=</span>&nbsp;<span class="ident" id="3631096"><a href="/net/textproto/reader.go.html#3631037">r</a></span><span class="op" id="3631097">.</span><span class="ident" id="3631098">readLineSlice</span><span class="op" id="3631111">(</span><span class="op" id="3631112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3631115">if</span>&nbsp;<span class="ident" id="3631118"><a href="/net/textproto/reader.go.html#3631083">line</a></span>&nbsp;<span class="op" id="3631123">!=</span>&nbsp;<span class="ident" id="3631126">nil</span>&nbsp;<span class="op" id="3631130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631134">buf</span>&nbsp;<span class="op" id="3631138">:=</span>&nbsp;<span class="builtinfunc" id="3631141">make</span><span class="op" id="3631145">(</span><span class="op" id="3631146">[</span><span class="op" id="3631147">]</span><span class="builtintype" id="3631148">byte</span><span class="op" id="3631152">,</span>&nbsp;<span class="builtinfunc" id="3631154">len</span><span class="op" id="3631157">(</span><span class="ident" id="3631158"><a href="/net/textproto/reader.go.html#3631083">line</a></span><span class="op" id="3631162">)</span><span class="op" id="3631163">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3631167">copy</span><span class="op" id="3631171">(</span><span class="ident" id="3631172"><a href="/net/textproto/reader.go.html#3631134">buf</a></span><span class="op" id="3631175">,</span>&nbsp;<span class="ident" id="3631177"><a href="/net/textproto/reader.go.html#3631083">line</a></span><span class="op" id="3631181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631185"><a href="/net/textproto/reader.go.html#3631083">line</a></span>&nbsp;<span class="op" id="3631190">=</span>&nbsp;<span class="ident" id="3631192"><a href="/net/textproto/reader.go.html#3631134">buf</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3631197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3631200">return</span>&nbsp;<span class="ident" id="3631207"><a href="/net/textproto/reader.go.html#3631083">line</a></span><span class="op" id="3631211">,</span>&nbsp;<span class="ident" id="3631213"><a href="/net/textproto/reader.go.html#3631089">err</a></span><br>
<span class="lineno"></span><span class="op" id="3631217">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3631220">func</span>&nbsp;<span class="op" id="3631225">(</span><span class="ident" id="3631226">r</span>&nbsp;<span class="op" id="3631228">*</span><span class="ident" id="3631229"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3631235">)</span>&nbsp;<span class="ident" id="3631237">readLineSlice</span><span class="op" id="3631250">(</span><span class="op" id="3631251">)</span>&nbsp;<span class="op" id="3631253">(</span><span class="op" id="3631254">[</span><span class="op" id="3631255">]</span><span class="builtintype" id="3631256">byte</span><span class="op" id="3631260">,</span>&nbsp;<span class="builtintype" id="3631262">error</span><span class="op" id="3631267">)</span>&nbsp;<span class="op" id="3631269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631272"><a href="/net/textproto/reader.go.html#3631226">r</a></span><span class="op" id="3631273">.</span><span class="ident" id="3631274">closeDot</span><span class="op" id="3631282">(</span><span class="op" id="3631283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3631286">var</span>&nbsp;<span class="ident" id="3631290">line</span>&nbsp;<span class="op" id="3631295">[</span><span class="op" id="3631296">]</span><span class="builtintype" id="3631297">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3631303">for</span>&nbsp;<span class="op" id="3631307">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631311">l</span><span class="op" id="3631312">,</span>&nbsp;<span class="ident" id="3631314">more</span><span class="op" id="3631318">,</span>&nbsp;<span class="ident" id="3631320">err</span>&nbsp;<span class="op" id="3631324">:=</span>&nbsp;<span class="ident" id="3631327"><a href="/net/textproto/reader.go.html#3631226">r</a></span><span class="op" id="3631328">.</span><span class="ident" id="3631329">R</span><span class="op" id="3631330">.</span><span class="ident" id="3631331">ReadLine</span><span class="op" id="3631339">(</span><span class="op" id="3631340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3631344">if</span>&nbsp;<span class="ident" id="3631347"><a href="/net/textproto/reader.go.html#3631320">err</a></span>&nbsp;<span class="op" id="3631351">!=</span>&nbsp;<span class="ident" id="3631354">nil</span>&nbsp;<span class="op" id="3631358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3631363">return</span>&nbsp;<span class="ident" id="3631370">nil</span><span class="op" id="3631373">,</span>&nbsp;<span class="ident" id="3631375"><a href="/net/textproto/reader.go.html#3631320">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3631381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631385">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3631445">if</span>&nbsp;<span class="ident" id="3631448"><a href="/net/textproto/reader.go.html#3631290">line</a></span>&nbsp;<span class="op" id="3631453">==</span>&nbsp;<span class="ident" id="3631456">nil</span>&nbsp;<span class="op" id="3631460">&amp;&amp;</span>&nbsp;<span class="op" id="3631463">!</span><span class="ident" id="3631464"><a href="/net/textproto/reader.go.html#3631314">more</a></span>&nbsp;<span class="op" id="3631469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3631474">return</span>&nbsp;<span class="ident" id="3631481"><a href="/net/textproto/reader.go.html#3631311">l</a></span><span class="op" id="3631482">,</span>&nbsp;<span class="ident" id="3631484">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3631490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631494"><a href="/net/textproto/reader.go.html#3631290">line</a></span>&nbsp;<span class="op" id="3631499">=</span>&nbsp;<span class="builtinfunc" id="3631501">append</span><span class="op" id="3631507">(</span><span class="ident" id="3631508"><a href="/net/textproto/reader.go.html#3631290">line</a></span><span class="op" id="3631512">,</span>&nbsp;<span class="ident" id="3631514"><a href="/net/textproto/reader.go.html#3631311">l</a></span><span class="op" id="3631515">...</span><span class="op" id="3631518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3631522">if</span>&nbsp;<span class="op" id="3631525">!</span><span class="ident" id="3631526"><a href="/net/textproto/reader.go.html#3631314">more</a></span>&nbsp;<span class="op" id="3631531">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3631536">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3631544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3631547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3631550">return</span>&nbsp;<span class="ident" id="3631557"><a href="/net/textproto/reader.go.html#3631290">line</a></span><span class="op" id="3631561">,</span>&nbsp;<span class="ident" id="3631563">nil</span><br>
<span class="lineno"></span><span class="op" id="3631567">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3631570">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3631631">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="3631680">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3631742">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="3631805">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3631864">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3631927">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3631943">//</span><br>
<span class="lineno"></span><span class="comment" id="3631946">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="3631983">//</span><br>
<span class="lineno"></span><span class="comment" id="3631986">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3631996">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="3632014">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3632024">//</span><br>
<span class="lineno">85</span><span class="comment" id="3632027">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3632100">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3632140">//</span><br>
<span class="lineno"></span><span class="comment" id="3632143">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="3632204">//</span><br>
<span class="lineno">90</span><span class="keyword" id="3632207">func</span>&nbsp;<span class="op" id="3632212">(</span><span class="ident" id="3632213">r</span>&nbsp;<span class="op" id="3632215">*</span><span class="ident" id="3632216"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3632222">)</span>&nbsp;<span class="ident" id="3632224">ReadContinuedLine</span><span class="op" id="3632241">(</span><span class="op" id="3632242">)</span>&nbsp;<span class="op" id="3632244">(</span><span class="builtintype" id="3632245">string</span><span class="op" id="3632251">,</span>&nbsp;<span class="builtintype" id="3632253">error</span><span class="op" id="3632258">)</span>&nbsp;<span class="op" id="3632260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632263">line</span><span class="op" id="3632267">,</span>&nbsp;<span class="ident" id="3632269">err</span>&nbsp;<span class="op" id="3632273">:=</span>&nbsp;<span class="ident" id="3632276"><a href="/net/textproto/reader.go.html#3632213">r</a></span><span class="op" id="3632277">.</span><span class="ident" id="3632278">readContinuedLineSlice</span><span class="op" id="3632300">(</span><span class="op" id="3632301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3632304">return</span>&nbsp;<span class="builtintype" id="3632311">string</span><span class="op" id="3632317">(</span><span class="ident" id="3632318"><a href="/net/textproto/reader.go.html#3632263">line</a></span><span class="op" id="3632322">)</span><span class="op" id="3632323">,</span>&nbsp;<span class="ident" id="3632325"><a href="/net/textproto/reader.go.html#3632269">err</a></span><br>
<span class="lineno"></span><span class="op" id="3632329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3632332">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3632401">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="3632441">func</span>&nbsp;<span class="ident" id="3632446">trim</span><span class="op" id="3632450">(</span><span class="ident" id="3632451">s</span>&nbsp;<span class="op" id="3632453">[</span><span class="op" id="3632454">]</span><span class="builtintype" id="3632455">byte</span><span class="op" id="3632459">)</span>&nbsp;<span class="op" id="3632461">[</span><span class="op" id="3632462">]</span><span class="builtintype" id="3632463">byte</span>&nbsp;<span class="op" id="3632468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632471">i</span>&nbsp;<span class="op" id="3632473">:=</span>&nbsp;<span class="num" id="3632476">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3632479">for</span>&nbsp;<span class="ident" id="3632483"><a href="/net/textproto/reader.go.html#3632471">i</a></span>&nbsp;<span class="op" id="3632485">&lt;</span>&nbsp;<span class="builtinfunc" id="3632487">len</span><span class="op" id="3632490">(</span><span class="ident" id="3632491"><a href="/net/textproto/reader.go.html#3632451">s</a></span><span class="op" id="3632492">)</span>&nbsp;<span class="op" id="3632494">&amp;&amp;</span>&nbsp;<span class="op" id="3632497">(</span><span class="ident" id="3632498"><a href="/net/textproto/reader.go.html#3632451">s</a></span><span class="op" id="3632499">[</span><span class="ident" id="3632500"><a href="/net/textproto/reader.go.html#3632471">i</a></span><span class="op" id="3632501">]</span>&nbsp;<span class="op" id="3632503">==</span>&nbsp;<span class="string" id="3632506">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3632510">||</span>&nbsp;<span class="ident" id="3632513"><a href="/net/textproto/reader.go.html#3632451">s</a></span><span class="op" id="3632514">[</span><span class="ident" id="3632515"><a href="/net/textproto/reader.go.html#3632471">i</a></span><span class="op" id="3632516">]</span>&nbsp;<span class="op" id="3632518">==</span>&nbsp;<span class="string" id="3632521">&#39;\t&#39;</span><span class="op" id="3632525">)</span>&nbsp;<span class="op" id="3632527">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632531"><a href="/net/textproto/reader.go.html#3632471">i</a></span><span class="op" id="3632532">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3632536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632539">n</span>&nbsp;<span class="op" id="3632541">:=</span>&nbsp;<span class="builtinfunc" id="3632544">len</span><span class="op" id="3632547">(</span><span class="ident" id="3632548"><a href="/net/textproto/reader.go.html#3632451">s</a></span><span class="op" id="3632549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3632552">for</span>&nbsp;<span class="ident" id="3632556"><a href="/net/textproto/reader.go.html#3632539">n</a></span>&nbsp;<span class="op" id="3632558">&gt;</span>&nbsp;<span class="ident" id="3632560"><a href="/net/textproto/reader.go.html#3632471">i</a></span>&nbsp;<span class="op" id="3632562">&amp;&amp;</span>&nbsp;<span class="op" id="3632565">(</span><span class="ident" id="3632566"><a href="/net/textproto/reader.go.html#3632451">s</a></span><span class="op" id="3632567">[</span><span class="ident" id="3632568"><a href="/net/textproto/reader.go.html#3632539">n</a></span><span class="op" id="3632569">-</span><span class="num" id="3632570">1</span><span class="op" id="3632571">]</span>&nbsp;<span class="op" id="3632573">==</span>&nbsp;<span class="string" id="3632576">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3632580">||</span>&nbsp;<span class="ident" id="3632583"><a href="/net/textproto/reader.go.html#3632451">s</a></span><span class="op" id="3632584">[</span><span class="ident" id="3632585"><a href="/net/textproto/reader.go.html#3632539">n</a></span><span class="op" id="3632586">-</span><span class="num" id="3632587">1</span><span class="op" id="3632588">]</span>&nbsp;<span class="op" id="3632590">==</span>&nbsp;<span class="string" id="3632593">&#39;\t&#39;</span><span class="op" id="3632597">)</span>&nbsp;<span class="op" id="3632599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632603"><a href="/net/textproto/reader.go.html#3632539">n</a></span><span class="op" id="3632604">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3632608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3632611">return</span>&nbsp;<span class="ident" id="3632618"><a href="/net/textproto/reader.go.html#3632451">s</a></span><span class="op" id="3632619">[</span><span class="ident" id="3632620"><a href="/net/textproto/reader.go.html#3632471">i</a></span><span class="op" id="3632621">:</span><span class="ident" id="3632622"><a href="/net/textproto/reader.go.html#3632539">n</a></span><span class="op" id="3632623">]</span><br>
<span class="lineno"></span><span class="op" id="3632625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3632628">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="3632684">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3632725">func</span>&nbsp;<span class="op" id="3632730">(</span><span class="ident" id="3632731">r</span>&nbsp;<span class="op" id="3632733">*</span><span class="ident" id="3632734"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3632740">)</span>&nbsp;<span class="ident" id="3632742">ReadContinuedLineBytes</span><span class="op" id="3632764">(</span><span class="op" id="3632765">)</span>&nbsp;<span class="op" id="3632767">(</span><span class="op" id="3632768">[</span><span class="op" id="3632769">]</span><span class="builtintype" id="3632770">byte</span><span class="op" id="3632774">,</span>&nbsp;<span class="builtintype" id="3632776">error</span><span class="op" id="3632781">)</span>&nbsp;<span class="op" id="3632783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632786">line</span><span class="op" id="3632790">,</span>&nbsp;<span class="ident" id="3632792">err</span>&nbsp;<span class="op" id="3632796">:=</span>&nbsp;<span class="ident" id="3632799"><a href="/net/textproto/reader.go.html#3632731">r</a></span><span class="op" id="3632800">.</span><span class="ident" id="3632801">readContinuedLineSlice</span><span class="op" id="3632823">(</span><span class="op" id="3632824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3632827">if</span>&nbsp;<span class="ident" id="3632830"><a href="/net/textproto/reader.go.html#3632786">line</a></span>&nbsp;<span class="op" id="3632835">!=</span>&nbsp;<span class="ident" id="3632838">nil</span>&nbsp;<span class="op" id="3632842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632846">buf</span>&nbsp;<span class="op" id="3632850">:=</span>&nbsp;<span class="builtinfunc" id="3632853">make</span><span class="op" id="3632857">(</span><span class="op" id="3632858">[</span><span class="op" id="3632859">]</span><span class="builtintype" id="3632860">byte</span><span class="op" id="3632864">,</span>&nbsp;<span class="builtinfunc" id="3632866">len</span><span class="op" id="3632869">(</span><span class="ident" id="3632870"><a href="/net/textproto/reader.go.html#3632786">line</a></span><span class="op" id="3632874">)</span><span class="op" id="3632875">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3632879">copy</span><span class="op" id="3632883">(</span><span class="ident" id="3632884"><a href="/net/textproto/reader.go.html#3632846">buf</a></span><span class="op" id="3632887">,</span>&nbsp;<span class="ident" id="3632889"><a href="/net/textproto/reader.go.html#3632786">line</a></span><span class="op" id="3632893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632897"><a href="/net/textproto/reader.go.html#3632786">line</a></span>&nbsp;<span class="op" id="3632902">=</span>&nbsp;<span class="ident" id="3632904"><a href="/net/textproto/reader.go.html#3632846">buf</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3632909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3632912">return</span>&nbsp;<span class="ident" id="3632919"><a href="/net/textproto/reader.go.html#3632786">line</a></span><span class="op" id="3632923">,</span>&nbsp;<span class="ident" id="3632925"><a href="/net/textproto/reader.go.html#3632792">err</a></span><br>
<span class="lineno"></span><span class="op" id="3632929">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3632932">func</span>&nbsp;<span class="op" id="3632937">(</span><span class="ident" id="3632938">r</span>&nbsp;<span class="op" id="3632940">*</span><span class="ident" id="3632941"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3632947">)</span>&nbsp;<span class="ident" id="3632949">readContinuedLineSlice</span><span class="op" id="3632971">(</span><span class="op" id="3632972">)</span>&nbsp;<span class="op" id="3632974">(</span><span class="op" id="3632975">[</span><span class="op" id="3632976">]</span><span class="builtintype" id="3632977">byte</span><span class="op" id="3632981">,</span>&nbsp;<span class="builtintype" id="3632983">error</span><span class="op" id="3632988">)</span>&nbsp;<span class="op" id="3632990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632993">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633018">line</span><span class="op" id="3633022">,</span>&nbsp;<span class="ident" id="3633024">err</span>&nbsp;<span class="op" id="3633028">:=</span>&nbsp;<span class="ident" id="3633031"><a href="/net/textproto/reader.go.html#3632938">r</a></span><span class="op" id="3633032">.</span><span class="ident" id="3633033">readLineSlice</span><span class="op" id="3633046">(</span><span class="op" id="3633047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633050">if</span>&nbsp;<span class="ident" id="3633053"><a href="/net/textproto/reader.go.html#3633024">err</a></span>&nbsp;<span class="op" id="3633057">!=</span>&nbsp;<span class="ident" id="3633060">nil</span>&nbsp;<span class="op" id="3633064">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633068">return</span>&nbsp;<span class="ident" id="3633075">nil</span><span class="op" id="3633078">,</span>&nbsp;<span class="ident" id="3633080"><a href="/net/textproto/reader.go.html#3633024">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633088">if</span>&nbsp;<span class="builtinfunc" id="3633091">len</span><span class="op" id="3633094">(</span><span class="ident" id="3633095"><a href="/net/textproto/reader.go.html#3633018">line</a></span><span class="op" id="3633099">)</span>&nbsp;<span class="op" id="3633101">==</span>&nbsp;<span class="num" id="3633104">0</span>&nbsp;<span class="op" id="3633106">{</span>&nbsp;<span class="comment" id="3633108">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633142">return</span>&nbsp;<span class="ident" id="3633149"><a href="/net/textproto/reader.go.html#3633018">line</a></span><span class="op" id="3633153">,</span>&nbsp;<span class="ident" id="3633155">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633160">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633164">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633235">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633307">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633379">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633408">if</span>&nbsp;<span class="ident" id="3633411"><a href="/net/textproto/reader.go.html#3632938">r</a></span><span class="op" id="3633412">.</span><span class="ident" id="3633413">R</span><span class="op" id="3633414">.</span><span class="ident" id="3633415">Buffered</span><span class="op" id="3633423">(</span><span class="op" id="3633424">)</span>&nbsp;<span class="op" id="3633426">&gt;</span>&nbsp;<span class="num" id="3633428">1</span>&nbsp;<span class="op" id="3633430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633434">peek</span><span class="op" id="3633438">,</span>&nbsp;<span class="ident" id="3633440">err</span>&nbsp;<span class="op" id="3633444">:=</span>&nbsp;<span class="ident" id="3633447"><a href="/net/textproto/reader.go.html#3632938">r</a></span><span class="op" id="3633448">.</span><span class="ident" id="3633449">R</span><span class="op" id="3633450">.</span><span class="ident" id="3633451">Peek</span><span class="op" id="3633455">(</span><span class="num" id="3633456">1</span><span class="op" id="3633457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633461">if</span>&nbsp;<span class="ident" id="3633464"><a href="/net/textproto/reader.go.html#3633440">err</a></span>&nbsp;<span class="op" id="3633468">==</span>&nbsp;<span class="ident" id="3633471">nil</span>&nbsp;<span class="op" id="3633475">&amp;&amp;</span>&nbsp;<span class="ident" id="3633478"><a href="/net/textproto/textproto.go.html#3649943">isASCIILetter</a></span><span class="op" id="3633491">(</span><span class="ident" id="3633492"><a href="/net/textproto/reader.go.html#3633434">peek</a></span><span class="op" id="3633496">[</span><span class="num" id="3633497">0</span><span class="op" id="3633498">]</span><span class="op" id="3633499">)</span>&nbsp;<span class="op" id="3633501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633506">return</span>&nbsp;<span class="ident" id="3633513"><a href="/net/textproto/reader.go.html#3632446">trim</a></span><span class="op" id="3633517">(</span><span class="ident" id="3633518"><a href="/net/textproto/reader.go.html#3633018">line</a></span><span class="op" id="3633522">)</span><span class="op" id="3633523">,</span>&nbsp;<span class="ident" id="3633525">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633531">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633538">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633605">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633634"><a href="/net/textproto/reader.go.html#3632938">r</a></span><span class="op" id="3633635">.</span><span class="ident" id="3633636">buf</span>&nbsp;<span class="op" id="3633640">=</span>&nbsp;<span class="builtinfunc" id="3633642">append</span><span class="op" id="3633648">(</span><span class="ident" id="3633649"><a href="/net/textproto/reader.go.html#3632938">r</a></span><span class="op" id="3633650">.</span><span class="ident" id="3633651">buf</span><span class="op" id="3633654">[</span><span class="op" id="3633655">:</span><span class="num" id="3633656">0</span><span class="op" id="3633657">]</span><span class="op" id="3633658">,</span>&nbsp;<span class="ident" id="3633660"><a href="/net/textproto/reader.go.html#3632446">trim</a></span><span class="op" id="3633664">(</span><span class="ident" id="3633665"><a href="/net/textproto/reader.go.html#3633018">line</a></span><span class="op" id="3633669">)</span><span class="op" id="3633670">...</span><span class="op" id="3633673">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633677">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633706">for</span>&nbsp;<span class="ident" id="3633710"><a href="/net/textproto/reader.go.html#3632938">r</a></span><span class="op" id="3633711">.</span><span class="ident" id="3633712">skipSpace</span><span class="op" id="3633721">(</span><span class="op" id="3633722">)</span>&nbsp;<span class="op" id="3633724">&gt;</span>&nbsp;<span class="num" id="3633726">0</span>&nbsp;<span class="op" id="3633728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633732">line</span><span class="op" id="3633736">,</span>&nbsp;<span class="ident" id="3633738">err</span>&nbsp;<span class="op" id="3633742">:=</span>&nbsp;<span class="ident" id="3633745"><a href="/net/textproto/reader.go.html#3632938">r</a></span><span class="op" id="3633746">.</span><span class="ident" id="3633747">readLineSlice</span><span class="op" id="3633760">(</span><span class="op" id="3633761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633765">if</span>&nbsp;<span class="ident" id="3633768"><a href="/net/textproto/reader.go.html#3633738">err</a></span>&nbsp;<span class="op" id="3633772">!=</span>&nbsp;<span class="ident" id="3633775">nil</span>&nbsp;<span class="op" id="3633779">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633784">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633796"><a href="/net/textproto/reader.go.html#3632938">r</a></span><span class="op" id="3633797">.</span><span class="ident" id="3633798">buf</span>&nbsp;<span class="op" id="3633802">=</span>&nbsp;<span class="builtinfunc" id="3633804">append</span><span class="op" id="3633810">(</span><span class="ident" id="3633811"><a href="/net/textproto/reader.go.html#3632938">r</a></span><span class="op" id="3633812">.</span><span class="ident" id="3633813">buf</span><span class="op" id="3633816">,</span>&nbsp;<span class="string" id="3633818">&#39;&nbsp;&#39;</span><span class="op" id="3633821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633825"><a href="/net/textproto/reader.go.html#3632938">r</a></span><span class="op" id="3633826">.</span><span class="ident" id="3633827">buf</span>&nbsp;<span class="op" id="3633831">=</span>&nbsp;<span class="builtinfunc" id="3633833">append</span><span class="op" id="3633839">(</span><span class="ident" id="3633840"><a href="/net/textproto/reader.go.html#3632938">r</a></span><span class="op" id="3633841">.</span><span class="ident" id="3633842">buf</span><span class="op" id="3633845">,</span>&nbsp;<span class="ident" id="3633847"><a href="/net/textproto/reader.go.html#3633732">line</a></span><span class="op" id="3633851">...</span><span class="op" id="3633854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633857">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633860">return</span>&nbsp;<span class="ident" id="3633867"><a href="/net/textproto/reader.go.html#3632938">r</a></span><span class="op" id="3633868">.</span><span class="ident" id="3633869">buf</span><span class="op" id="3633872">,</span>&nbsp;<span class="ident" id="3633874">nil</span><br>
<span class="lineno"></span><span class="op" id="3633878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3633881">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3633959">func</span>&nbsp;<span class="op" id="3633964">(</span><span class="ident" id="3633965">r</span>&nbsp;<span class="op" id="3633967">*</span><span class="ident" id="3633968"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3633974">)</span>&nbsp;<span class="ident" id="3633976">skipSpace</span><span class="op" id="3633985">(</span><span class="op" id="3633986">)</span>&nbsp;<span class="builtintype" id="3633988">int</span>&nbsp;<span class="op" id="3633992">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633995">n</span>&nbsp;<span class="op" id="3633997">:=</span>&nbsp;<span class="num" id="3634000">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634003">for</span>&nbsp;<span class="op" id="3634007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634011">c</span><span class="op" id="3634012">,</span>&nbsp;<span class="ident" id="3634014">err</span>&nbsp;<span class="op" id="3634018">:=</span>&nbsp;<span class="ident" id="3634021"><a href="/net/textproto/reader.go.html#3633965">r</a></span><span class="op" id="3634022">.</span><span class="ident" id="3634023">R</span><span class="op" id="3634024">.</span><span class="ident" id="3634025">ReadByte</span><span class="op" id="3634033">(</span><span class="op" id="3634034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634038">if</span>&nbsp;<span class="ident" id="3634041"><a href="/net/textproto/reader.go.html#3634014">err</a></span>&nbsp;<span class="op" id="3634045">!=</span>&nbsp;<span class="ident" id="3634048">nil</span>&nbsp;<span class="op" id="3634052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3634057">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634100">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634112">if</span>&nbsp;<span class="ident" id="3634115"><a href="/net/textproto/reader.go.html#3634011">c</a></span>&nbsp;<span class="op" id="3634117">!=</span>&nbsp;<span class="string" id="3634120">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3634124">&amp;&amp;</span>&nbsp;<span class="ident" id="3634127"><a href="/net/textproto/reader.go.html#3634011">c</a></span>&nbsp;<span class="op" id="3634129">!=</span>&nbsp;<span class="string" id="3634132">&#39;\t&#39;</span>&nbsp;<span class="op" id="3634137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634142"><a href="/net/textproto/reader.go.html#3633965">r</a></span><span class="op" id="3634143">.</span><span class="ident" id="3634144">R</span><span class="op" id="3634145">.</span><span class="ident" id="3634146">UnreadByte</span><span class="op" id="3634156">(</span><span class="op" id="3634157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634162">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634174"><a href="/net/textproto/reader.go.html#3633995">n</a></span><span class="op" id="3634175">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634182">return</span>&nbsp;<span class="ident" id="3634189"><a href="/net/textproto/reader.go.html#3633995">n</a></span><br>
<span class="lineno"></span><span class="op" id="3634191">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="3634194">func</span>&nbsp;<span class="op" id="3634199">(</span><span class="ident" id="3634200">r</span>&nbsp;<span class="op" id="3634202">*</span><span class="ident" id="3634203"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3634209">)</span>&nbsp;<span class="ident" id="3634211">readCodeLine</span><span class="op" id="3634223">(</span><span class="ident" id="3634224">expectCode</span>&nbsp;<span class="builtintype" id="3634235">int</span><span class="op" id="3634238">)</span>&nbsp;<span class="op" id="3634240">(</span><span class="ident" id="3634241">code</span>&nbsp;<span class="builtintype" id="3634246">int</span><span class="op" id="3634249">,</span>&nbsp;<span class="ident" id="3634251">continued</span>&nbsp;<span class="builtintype" id="3634261">bool</span><span class="op" id="3634265">,</span>&nbsp;<span class="ident" id="3634267">message</span>&nbsp;<span class="builtintype" id="3634275">string</span><span class="op" id="3634281">,</span>&nbsp;<span class="ident" id="3634283">err</span>&nbsp;<span class="builtintype" id="3634287">error</span><span class="op" id="3634292">)</span>&nbsp;<span class="op" id="3634294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634297">line</span><span class="op" id="3634301">,</span>&nbsp;<span class="ident" id="3634303"><a href="/net/textproto/reader.go.html#3634283">err</a></span>&nbsp;<span class="op" id="3634307">:=</span>&nbsp;<span class="ident" id="3634310"><a href="/net/textproto/reader.go.html#3634200">r</a></span><span class="op" id="3634311">.</span><span class="ident" id="3634312">ReadLine</span><span class="op" id="3634320">(</span><span class="op" id="3634321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634324">if</span>&nbsp;<span class="ident" id="3634327"><a href="/net/textproto/reader.go.html#3634283">err</a></span>&nbsp;<span class="op" id="3634331">!=</span>&nbsp;<span class="ident" id="3634334">nil</span>&nbsp;<span class="op" id="3634338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634342">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634353">return</span>&nbsp;<span class="ident" id="3634360"><a href="/net/textproto/reader.go.html#3634400">parseCodeLine</a></span><span class="op" id="3634373">(</span><span class="ident" id="3634374"><a href="/net/textproto/reader.go.html#3634297">line</a></span><span class="op" id="3634378">,</span>&nbsp;<span class="ident" id="3634380"><a href="/net/textproto/reader.go.html#3634224">expectCode</a></span><span class="op" id="3634390">)</span><br>
<span class="lineno"></span><span class="op" id="3634392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3634395">func</span>&nbsp;<span class="ident" id="3634400">parseCodeLine</span><span class="op" id="3634413">(</span><span class="ident" id="3634414">line</span>&nbsp;<span class="builtintype" id="3634419">string</span><span class="op" id="3634425">,</span>&nbsp;<span class="ident" id="3634427">expectCode</span>&nbsp;<span class="builtintype" id="3634438">int</span><span class="op" id="3634441">)</span>&nbsp;<span class="op" id="3634443">(</span><span class="ident" id="3634444">code</span>&nbsp;<span class="builtintype" id="3634449">int</span><span class="op" id="3634452">,</span>&nbsp;<span class="ident" id="3634454">continued</span>&nbsp;<span class="builtintype" id="3634464">bool</span><span class="op" id="3634468">,</span>&nbsp;<span class="ident" id="3634470">message</span>&nbsp;<span class="builtintype" id="3634478">string</span><span class="op" id="3634484">,</span>&nbsp;<span class="ident" id="3634486">err</span>&nbsp;<span class="builtintype" id="3634490">error</span><span class="op" id="3634495">)</span>&nbsp;<span class="op" id="3634497">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634500">if</span>&nbsp;<span class="builtinfunc" id="3634503">len</span><span class="op" id="3634506">(</span><span class="ident" id="3634507"><a href="/net/textproto/reader.go.html#3634414">line</a></span><span class="op" id="3634511">)</span>&nbsp;<span class="op" id="3634513">&lt;</span>&nbsp;<span class="num" id="3634515">4</span>&nbsp;<span class="op" id="3634517">||</span>&nbsp;<span class="ident" id="3634520"><a href="/net/textproto/reader.go.html#3634414">line</a></span><span class="op" id="3634524">[</span><span class="num" id="3634525">3</span><span class="op" id="3634526">]</span>&nbsp;<span class="op" id="3634528">!=</span>&nbsp;<span class="string" id="3634531">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3634535">&amp;&amp;</span>&nbsp;<span class="ident" id="3634538"><a href="/net/textproto/reader.go.html#3634414">line</a></span><span class="op" id="3634542">[</span><span class="num" id="3634543">3</span><span class="op" id="3634544">]</span>&nbsp;<span class="op" id="3634546">!=</span>&nbsp;<span class="string" id="3634549">&#39;-&#39;</span>&nbsp;<span class="op" id="3634553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634557"><a href="/net/textproto/reader.go.html#3634486">err</a></span>&nbsp;<span class="op" id="3634561">=</span>&nbsp;<span class="ident" id="3634563"><a href="/net/textproto/textproto.go.html#3647455">ProtocolError</a></span><span class="op" id="3634576">(</span><span class="string" id="3634577">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3634596">+</span>&nbsp;<span class="ident" id="3634598"><a href="/net/textproto/reader.go.html#3634414">line</a></span><span class="op" id="3634602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634606">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634617"><a href="/net/textproto/reader.go.html#3634454">continued</a></span>&nbsp;<span class="op" id="3634627">=</span>&nbsp;<span class="ident" id="3634629"><a href="/net/textproto/reader.go.html#3634414">line</a></span><span class="op" id="3634633">[</span><span class="num" id="3634634">3</span><span class="op" id="3634635">]</span>&nbsp;<span class="op" id="3634637">==</span>&nbsp;<span class="string" id="3634640">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634645"><a href="/net/textproto/reader.go.html#3634444">code</a></span><span class="op" id="3634649">,</span>&nbsp;<span class="ident" id="3634651"><a href="/net/textproto/reader.go.html#3634486">err</a></span>&nbsp;<span class="op" id="3634655">=</span>&nbsp;<span class="ident" id="3634657"><a href="/net/textproto/reader.go.html#3630188">strconv</a></span><span class="op" id="3634664">.</span><span class="ident" id="3634665">Atoi</span><span class="op" id="3634669">(</span><span class="ident" id="3634670"><a href="/net/textproto/reader.go.html#3634414">line</a></span><span class="op" id="3634674">[</span><span class="num" id="3634675">0</span><span class="op" id="3634676">:</span><span class="num" id="3634677">3</span><span class="op" id="3634678">]</span><span class="op" id="3634679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634682">if</span>&nbsp;<span class="ident" id="3634685"><a href="/net/textproto/reader.go.html#3634486">err</a></span>&nbsp;<span class="op" id="3634689">!=</span>&nbsp;<span class="ident" id="3634692">nil</span>&nbsp;<span class="op" id="3634696">||</span>&nbsp;<span class="ident" id="3634699"><a href="/net/textproto/reader.go.html#3634444">code</a></span>&nbsp;<span class="op" id="3634704">&lt;</span>&nbsp;<span class="num" id="3634706">100</span>&nbsp;<span class="op" id="3634710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634714"><a href="/net/textproto/reader.go.html#3634486">err</a></span>&nbsp;<span class="op" id="3634718">=</span>&nbsp;<span class="ident" id="3634720"><a href="/net/textproto/textproto.go.html#3647455">ProtocolError</a></span><span class="op" id="3634733">(</span><span class="string" id="3634734">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="3634760">+</span>&nbsp;<span class="ident" id="3634762"><a href="/net/textproto/reader.go.html#3634414">line</a></span><span class="op" id="3634766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634770">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634778">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634781"><a href="/net/textproto/reader.go.html#3634470">message</a></span>&nbsp;<span class="op" id="3634789">=</span>&nbsp;<span class="ident" id="3634791"><a href="/net/textproto/reader.go.html#3634414">line</a></span><span class="op" id="3634795">[</span><span class="num" id="3634796">4</span><span class="op" id="3634797">:</span><span class="op" id="3634798">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634801">if</span>&nbsp;<span class="num" id="3634804">1</span>&nbsp;<span class="op" id="3634806">&lt;=</span>&nbsp;<span class="ident" id="3634809"><a href="/net/textproto/reader.go.html#3634427">expectCode</a></span>&nbsp;<span class="op" id="3634820">&amp;&amp;</span>&nbsp;<span class="ident" id="3634823"><a href="/net/textproto/reader.go.html#3634427">expectCode</a></span>&nbsp;<span class="op" id="3634834">&lt;</span>&nbsp;<span class="num" id="3634836">10</span>&nbsp;<span class="op" id="3634839">&amp;&amp;</span>&nbsp;<span class="ident" id="3634842"><a href="/net/textproto/reader.go.html#3634444">code</a></span><span class="op" id="3634846">/</span><span class="num" id="3634847">100</span>&nbsp;<span class="op" id="3634851">!=</span>&nbsp;<span class="ident" id="3634854"><a href="/net/textproto/reader.go.html#3634427">expectCode</a></span>&nbsp;<span class="op" id="3634865">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3634870">10</span>&nbsp;<span class="op" id="3634873">&lt;=</span>&nbsp;<span class="ident" id="3634876"><a href="/net/textproto/reader.go.html#3634427">expectCode</a></span>&nbsp;<span class="op" id="3634887">&amp;&amp;</span>&nbsp;<span class="ident" id="3634890"><a href="/net/textproto/reader.go.html#3634427">expectCode</a></span>&nbsp;<span class="op" id="3634901">&lt;</span>&nbsp;<span class="num" id="3634903">100</span>&nbsp;<span class="op" id="3634907">&amp;&amp;</span>&nbsp;<span class="ident" id="3634910"><a href="/net/textproto/reader.go.html#3634444">code</a></span><span class="op" id="3634914">/</span><span class="num" id="3634915">10</span>&nbsp;<span class="op" id="3634918">!=</span>&nbsp;<span class="ident" id="3634921"><a href="/net/textproto/reader.go.html#3634427">expectCode</a></span>&nbsp;<span class="op" id="3634932">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3634937">100</span>&nbsp;<span class="op" id="3634941">&lt;=</span>&nbsp;<span class="ident" id="3634944"><a href="/net/textproto/reader.go.html#3634427">expectCode</a></span>&nbsp;<span class="op" id="3634955">&amp;&amp;</span>&nbsp;<span class="ident" id="3634958"><a href="/net/textproto/reader.go.html#3634427">expectCode</a></span>&nbsp;<span class="op" id="3634969">&lt;</span>&nbsp;<span class="num" id="3634971">1000</span>&nbsp;<span class="op" id="3634976">&amp;&amp;</span>&nbsp;<span class="ident" id="3634979"><a href="/net/textproto/reader.go.html#3634444">code</a></span>&nbsp;<span class="op" id="3634984">!=</span>&nbsp;<span class="ident" id="3634987"><a href="/net/textproto/reader.go.html#3634427">expectCode</a></span>&nbsp;<span class="op" id="3634998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635002"><a href="/net/textproto/reader.go.html#3634486">err</a></span>&nbsp;<span class="op" id="3635006">=</span>&nbsp;<span class="op" id="3635008">&amp;</span><span class="ident" id="3635009"><a href="/net/textproto/textproto.go.html#3647221">Error</a></span><span class="op" id="3635014">{</span><span class="ident" id="3635015"><a href="/net/textproto/reader.go.html#3634444">code</a></span><span class="op" id="3635019">,</span>&nbsp;<span class="ident" id="3635021"><a href="/net/textproto/reader.go.html#3634470">message</a></span><span class="op" id="3635028">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635034">return</span><br>
<span class="lineno"></span><span class="op" id="3635041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3635044">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="3635099">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3635115">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3635174">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3635241">//&nbsp;&nbsp;&nbsp;&nbsp220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="3635274">//</span><br>
<span class="lineno">210</span><span class="comment" id="3635277">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3635349">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3635412">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3635478">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3635523">//</span><br>
<span class="lineno">215</span><span class="comment" id="3635526">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3635591">//</span><br>
<span class="lineno"></span><span class="comment" id="3635594">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3635655">//</span><br>
<span class="lineno"></span><span class="keyword" id="3635658">func</span>&nbsp;<span class="op" id="3635663">(</span><span class="ident" id="3635664">r</span>&nbsp;<span class="op" id="3635666">*</span><span class="ident" id="3635667"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3635673">)</span>&nbsp;<span class="ident" id="3635675">ReadCodeLine</span><span class="op" id="3635687">(</span><span class="ident" id="3635688">expectCode</span>&nbsp;<span class="builtintype" id="3635699">int</span><span class="op" id="3635702">)</span>&nbsp;<span class="op" id="3635704">(</span><span class="ident" id="3635705">code</span>&nbsp;<span class="builtintype" id="3635710">int</span><span class="op" id="3635713">,</span>&nbsp;<span class="ident" id="3635715">message</span>&nbsp;<span class="builtintype" id="3635723">string</span><span class="op" id="3635729">,</span>&nbsp;<span class="ident" id="3635731">err</span>&nbsp;<span class="builtintype" id="3635735">error</span><span class="op" id="3635740">)</span>&nbsp;<span class="op" id="3635742">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635745"><a href="/net/textproto/reader.go.html#3635705">code</a></span><span class="op" id="3635749">,</span>&nbsp;<span class="ident" id="3635751">continued</span><span class="op" id="3635760">,</span>&nbsp;<span class="ident" id="3635762"><a href="/net/textproto/reader.go.html#3635715">message</a></span><span class="op" id="3635769">,</span>&nbsp;<span class="ident" id="3635771"><a href="/net/textproto/reader.go.html#3635731">err</a></span>&nbsp;<span class="op" id="3635775">:=</span>&nbsp;<span class="ident" id="3635778"><a href="/net/textproto/reader.go.html#3635664">r</a></span><span class="op" id="3635779">.</span><span class="ident" id="3635780">readCodeLine</span><span class="op" id="3635792">(</span><span class="ident" id="3635793"><a href="/net/textproto/reader.go.html#3635688">expectCode</a></span><span class="op" id="3635803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635806">if</span>&nbsp;<span class="ident" id="3635809"><a href="/net/textproto/reader.go.html#3635731">err</a></span>&nbsp;<span class="op" id="3635813">==</span>&nbsp;<span class="ident" id="3635816">nil</span>&nbsp;<span class="op" id="3635820">&amp;&amp;</span>&nbsp;<span class="ident" id="3635823"><a href="/net/textproto/reader.go.html#3635751">continued</a></span>&nbsp;<span class="op" id="3635833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635837"><a href="/net/textproto/reader.go.html#3635731">err</a></span>&nbsp;<span class="op" id="3635841">=</span>&nbsp;<span class="ident" id="3635843"><a href="/net/textproto/textproto.go.html#3647455">ProtocolError</a></span><span class="op" id="3635856">(</span><span class="string" id="3635857">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3635892">+</span>&nbsp;<span class="ident" id="3635894"><a href="/net/textproto/reader.go.html#3635715">message</a></span><span class="op" id="3635901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635907">return</span><br>
<span class="lineno">225</span><span class="op" id="3635914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3635917">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3635974">//</span><br>
<span class="lineno"></span><span class="comment" id="3635977">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="3636000">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3636023">//&nbsp;&nbsp;&nbsp;&nbsp...</span><br>
<span class="lineno"></span><span class="comment" id="3636030">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3636053">//</span><br>
<span class="lineno"></span><span class="comment" id="3636056">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="3636131">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="3636202">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3636269">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="3636301">//</span><br>
<span class="lineno"></span><span class="comment" id="3636304">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="3636371">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3636383">//</span><br>
<span class="lineno"></span><span class="comment" id="3636386">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3636458">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3636521">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="3636587">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3636632">//</span><br>
<span class="lineno"></span><span class="comment" id="3636635">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3636696">//</span><br>
<span class="lineno"></span><span class="keyword" id="3636699">func</span>&nbsp;<span class="op" id="3636704">(</span><span class="ident" id="3636705">r</span>&nbsp;<span class="op" id="3636707">*</span><span class="ident" id="3636708"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3636714">)</span>&nbsp;<span class="ident" id="3636716">ReadResponse</span><span class="op" id="3636728">(</span><span class="ident" id="3636729">expectCode</span>&nbsp;<span class="builtintype" id="3636740">int</span><span class="op" id="3636743">)</span>&nbsp;<span class="op" id="3636745">(</span><span class="ident" id="3636746">code</span>&nbsp;<span class="builtintype" id="3636751">int</span><span class="op" id="3636754">,</span>&nbsp;<span class="ident" id="3636756">message</span>&nbsp;<span class="builtintype" id="3636764">string</span><span class="op" id="3636770">,</span>&nbsp;<span class="ident" id="3636772">err</span>&nbsp;<span class="builtintype" id="3636776">error</span><span class="op" id="3636781">)</span>&nbsp;<span class="op" id="3636783">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636786"><a href="/net/textproto/reader.go.html#3636746">code</a></span><span class="op" id="3636790">,</span>&nbsp;<span class="ident" id="3636792">continued</span><span class="op" id="3636801">,</span>&nbsp;<span class="ident" id="3636803"><a href="/net/textproto/reader.go.html#3636756">message</a></span><span class="op" id="3636810">,</span>&nbsp;<span class="ident" id="3636812"><a href="/net/textproto/reader.go.html#3636772">err</a></span>&nbsp;<span class="op" id="3636816">:=</span>&nbsp;<span class="ident" id="3636819"><a href="/net/textproto/reader.go.html#3636705">r</a></span><span class="op" id="3636820">.</span><span class="ident" id="3636821">readCodeLine</span><span class="op" id="3636833">(</span><span class="ident" id="3636834"><a href="/net/textproto/reader.go.html#3636729">expectCode</a></span><span class="op" id="3636844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636847">for</span>&nbsp;<span class="ident" id="3636851"><a href="/net/textproto/reader.go.html#3636772">err</a></span>&nbsp;<span class="op" id="3636855">==</span>&nbsp;<span class="ident" id="3636858">nil</span>&nbsp;<span class="op" id="3636862">&amp;&amp;</span>&nbsp;<span class="ident" id="3636865"><a href="/net/textproto/reader.go.html#3636792">continued</a></span>&nbsp;<span class="op" id="3636875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636879">line</span><span class="op" id="3636883">,</span>&nbsp;<span class="ident" id="3636885">err</span>&nbsp;<span class="op" id="3636889">:=</span>&nbsp;<span class="ident" id="3636892"><a href="/net/textproto/reader.go.html#3636705">r</a></span><span class="op" id="3636893">.</span><span class="ident" id="3636894">ReadLine</span><span class="op" id="3636902">(</span><span class="op" id="3636903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636907">if</span>&nbsp;<span class="ident" id="3636910"><a href="/net/textproto/reader.go.html#3636885">err</a></span>&nbsp;<span class="op" id="3636914">!=</span>&nbsp;<span class="ident" id="3636917">nil</span>&nbsp;<span class="op" id="3636921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636926">return</span>&nbsp;<span class="num" id="3636933">0</span><span class="op" id="3636934">,</span>&nbsp;<span class="string" id="3636936">&#34;&#34;</span><span class="op" id="3636938">,</span>&nbsp;<span class="ident" id="3636940"><a href="/net/textproto/reader.go.html#3636885">err</a></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636951">var</span>&nbsp;<span class="ident" id="3636955">code2</span>&nbsp;<span class="builtintype" id="3636961">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636967">var</span>&nbsp;<span class="ident" id="3636971">moreMessage</span>&nbsp;<span class="builtintype" id="3636983">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636992"><a href="/net/textproto/reader.go.html#3636955">code2</a></span><span class="op" id="3636997">,</span>&nbsp;<span class="ident" id="3636999"><a href="/net/textproto/reader.go.html#3636792">continued</a></span><span class="op" id="3637008">,</span>&nbsp;<span class="ident" id="3637010"><a href="/net/textproto/reader.go.html#3636971">moreMessage</a></span><span class="op" id="3637021">,</span>&nbsp;<span class="ident" id="3637023"><a href="/net/textproto/reader.go.html#3636885">err</a></span>&nbsp;<span class="op" id="3637027">=</span>&nbsp;<span class="ident" id="3637029"><a href="/net/textproto/reader.go.html#3634400">parseCodeLine</a></span><span class="op" id="3637042">(</span><span class="ident" id="3637043"><a href="/net/textproto/reader.go.html#3636879">line</a></span><span class="op" id="3637047">,</span>&nbsp;<span class="ident" id="3637049"><a href="/net/textproto/reader.go.html#3636729">expectCode</a></span><span class="op" id="3637059">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637063">if</span>&nbsp;<span class="ident" id="3637066"><a href="/net/textproto/reader.go.html#3636885">err</a></span>&nbsp;<span class="op" id="3637070">!=</span>&nbsp;<span class="ident" id="3637073">nil</span>&nbsp;<span class="op" id="3637077">||</span>&nbsp;<span class="ident" id="3637080"><a href="/net/textproto/reader.go.html#3636955">code2</a></span>&nbsp;<span class="op" id="3637086">!=</span>&nbsp;<span class="ident" id="3637089"><a href="/net/textproto/reader.go.html#3636746">code</a></span>&nbsp;<span class="op" id="3637094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637099"><a href="/net/textproto/reader.go.html#3636756">message</a></span>&nbsp;<span class="op" id="3637107">+=</span>&nbsp;<span class="string" id="3637110">&#34;\n&#34;</span>&nbsp;<span class="op" id="3637115">+</span>&nbsp;<span class="ident" id="3637117"><a href="/net/textproto/reader.go.html#3630199">strings</a></span><span class="op" id="3637124">.</span><span class="ident" id="3637125">TrimRight</span><span class="op" id="3637134">(</span><span class="ident" id="3637135"><a href="/net/textproto/reader.go.html#3636879">line</a></span><span class="op" id="3637139">,</span>&nbsp;<span class="string" id="3637141">&#34;\r\n&#34;</span><span class="op" id="3637147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637152"><a href="/net/textproto/reader.go.html#3636792">continued</a></span>&nbsp;<span class="op" id="3637162">=</span>&nbsp;<span class="builtintype" id="3637164">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637172">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637183">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637187"><a href="/net/textproto/reader.go.html#3636756">message</a></span>&nbsp;<span class="op" id="3637195">+=</span>&nbsp;<span class="string" id="3637198">&#34;\n&#34;</span>&nbsp;<span class="op" id="3637203">+</span>&nbsp;<span class="ident" id="3637205"><a href="/net/textproto/reader.go.html#3636971">moreMessage</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637221">return</span><br>
<span class="lineno"></span><span class="op" id="3637228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3637231">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3637296">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3637348">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3637405">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3637426">//</span><br>
<span class="lineno">275</span><span class="comment" id="3637429">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="3637486">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="3637554">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="3637618">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="3637685">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="3637743">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="3637784">//</span><br>
<span class="lineno"></span><span class="comment" id="3637787">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="3637844">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3637903">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="3637974">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3638036">func</span>&nbsp;<span class="op" id="3638041">(</span><span class="ident" id="3638042">r</span>&nbsp;<span class="op" id="3638044">*</span><span class="ident" id="3638045"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3638051">)</span>&nbsp;<span class="ident" id="3638053">DotReader</span><span class="op" id="3638062">(</span><span class="op" id="3638063">)</span>&nbsp;<span class="ident" id="3638065"><a href="/net/textproto/reader.go.html#3630169">io</a></span><span class="op" id="3638067">.</span><span class="ident" id="3638068">Reader</span>&nbsp;<span class="op" id="3638075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638078"><a href="/net/textproto/reader.go.html#3638042">r</a></span><span class="op" id="3638079">.</span><span class="ident" id="3638080">closeDot</span><span class="op" id="3638088">(</span><span class="op" id="3638089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638092"><a href="/net/textproto/reader.go.html#3638042">r</a></span><span class="op" id="3638093">.</span><span class="ident" id="3638094">dot</span>&nbsp;<span class="op" id="3638098">=</span>&nbsp;<span class="op" id="3638100">&amp;</span><span class="ident" id="3638101"><a href="/net/textproto/reader.go.html#3638139">dotReader</a></span><span class="op" id="3638110">{</span><span class="ident" id="3638111">r</span><span class="op" id="3638112">:</span>&nbsp;<span class="ident" id="3638114"><a href="/net/textproto/reader.go.html#3638042">r</a></span><span class="op" id="3638115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638118">return</span>&nbsp;<span class="ident" id="3638125"><a href="/net/textproto/reader.go.html#3638042">r</a></span><span class="op" id="3638126">.</span><span class="ident" id="3638127">dot</span><br>
<span class="lineno">290</span><span class="op" id="3638131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3638134">type</span>&nbsp;<span class="ident" id="3638139">dotReader</span>&nbsp;<span class="keyword" id="3638149">struct</span>&nbsp;<span class="op" id="3638156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638159">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3638165">*</span><span class="ident" id="3638166"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638174">state</span>&nbsp;<span class="builtintype" id="3638180">int</span><br>
<span class="lineno">295</span><span class="op" id="3638184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3638187">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="3638255">func</span>&nbsp;<span class="op" id="3638260">(</span><span class="ident" id="3638261">d</span>&nbsp;<span class="op" id="3638263">*</span><span class="ident" id="3638264"><a href="/net/textproto/reader.go.html#3638139">dotReader</a></span><span class="op" id="3638273">)</span>&nbsp;<span class="ident" id="3638275">Read</span><span class="op" id="3638279">(</span><span class="ident" id="3638280">b</span>&nbsp;<span class="op" id="3638282">[</span><span class="op" id="3638283">]</span><span class="builtintype" id="3638284">byte</span><span class="op" id="3638288">)</span>&nbsp;<span class="op" id="3638290">(</span><span class="ident" id="3638291">n</span>&nbsp;<span class="builtintype" id="3638293">int</span><span class="op" id="3638296">,</span>&nbsp;<span class="ident" id="3638298">err</span>&nbsp;<span class="builtintype" id="3638302">error</span><span class="op" id="3638307">)</span>&nbsp;<span class="op" id="3638309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3638312">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3638359">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3638414">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638448">const</span>&nbsp;<span class="op" id="3638454">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638458">stateBeginLine</span>&nbsp;<span class="op" id="3638473">=</span>&nbsp;<span class="ident" id="3638475">iota</span>&nbsp;<span class="comment" id="3638480">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638532">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638554">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638587">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638609">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638644">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638666">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638705">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638727">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638763">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638785">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3638819">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638822">br</span>&nbsp;<span class="op" id="3638825">:=</span>&nbsp;<span class="ident" id="3638828"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3638829">.</span><span class="ident" id="3638830">r</span><span class="op" id="3638831">.</span><span class="ident" id="3638832">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638835">for</span>&nbsp;<span class="ident" id="3638839"><a href="/net/textproto/reader.go.html#3638291">n</a></span>&nbsp;<span class="op" id="3638841">&lt;</span>&nbsp;<span class="builtinfunc" id="3638843">len</span><span class="op" id="3638846">(</span><span class="ident" id="3638847"><a href="/net/textproto/reader.go.html#3638280">b</a></span><span class="op" id="3638848">)</span>&nbsp;<span class="op" id="3638850">&amp;&amp;</span>&nbsp;<span class="ident" id="3638853"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3638854">.</span><span class="ident" id="3638855">state</span>&nbsp;<span class="op" id="3638861">!=</span>&nbsp;<span class="ident" id="3638864"><a href="/net/textproto/reader.go.html#3638763">stateEOF</a></span>&nbsp;<span class="op" id="3638873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638877">var</span>&nbsp;<span class="ident" id="3638881">c</span>&nbsp;<span class="builtintype" id="3638883">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638890"><a href="/net/textproto/reader.go.html#3638881">c</a></span><span class="op" id="3638891">,</span>&nbsp;<span class="ident" id="3638893"><a href="/net/textproto/reader.go.html#3638298">err</a></span>&nbsp;<span class="op" id="3638897">=</span>&nbsp;<span class="ident" id="3638899"><a href="/net/textproto/reader.go.html#3638822">br</a></span><span class="op" id="3638901">.</span><span class="ident" id="3638902">ReadByte</span><span class="op" id="3638910">(</span><span class="op" id="3638911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638915">if</span>&nbsp;<span class="ident" id="3638918"><a href="/net/textproto/reader.go.html#3638298">err</a></span>&nbsp;<span class="op" id="3638922">!=</span>&nbsp;<span class="ident" id="3638925">nil</span>&nbsp;<span class="op" id="3638929">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638934">if</span>&nbsp;<span class="ident" id="3638937"><a href="/net/textproto/reader.go.html#3638298">err</a></span>&nbsp;<span class="op" id="3638941">==</span>&nbsp;<span class="ident" id="3638944"><a href="/net/textproto/reader.go.html#3630169">io</a></span><span class="op" id="3638946">.</span><span class="ident" id="3638947">EOF</span>&nbsp;<span class="op" id="3638951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638957"><a href="/net/textproto/reader.go.html#3638298">err</a></span>&nbsp;<span class="op" id="3638961">=</span>&nbsp;<span class="ident" id="3638963"><a href="/net/textproto/reader.go.html#3630169">io</a></span><span class="op" id="3638965">.</span><span class="ident" id="3638966">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3638986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638991">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3638999">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639003">switch</span>&nbsp;<span class="ident" id="3639010"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639011">.</span><span class="ident" id="3639012">state</span>&nbsp;<span class="op" id="3639018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639022">case</span>&nbsp;<span class="ident" id="3639027"><a href="/net/textproto/reader.go.html#3638458">stateBeginLine</a></span><span class="op" id="3639041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639046">if</span>&nbsp;<span class="ident" id="3639049"><a href="/net/textproto/reader.go.html#3638881">c</a></span>&nbsp;<span class="op" id="3639051">==</span>&nbsp;<span class="string" id="3639054">&#39;.&#39;</span>&nbsp;<span class="op" id="3639058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639064"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639065">.</span><span class="ident" id="3639066">state</span>&nbsp;<span class="op" id="3639072">=</span>&nbsp;<span class="ident" id="3639074"><a href="/net/textproto/reader.go.html#3638532">stateDot</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639087">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639104">if</span>&nbsp;<span class="ident" id="3639107"><a href="/net/textproto/reader.go.html#3638881">c</a></span>&nbsp;<span class="op" id="3639109">==</span>&nbsp;<span class="string" id="3639112">&#39;\r&#39;</span>&nbsp;<span class="op" id="3639117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639123"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639124">.</span><span class="ident" id="3639125">state</span>&nbsp;<span class="op" id="3639131">=</span>&nbsp;<span class="ident" id="3639133"><a href="/net/textproto/reader.go.html#3638644">stateCR</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639145">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639157">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639162"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639163">.</span><span class="ident" id="3639164">state</span>&nbsp;<span class="op" id="3639170">=</span>&nbsp;<span class="ident" id="3639172"><a href="/net/textproto/reader.go.html#3638705">stateData</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639185">case</span>&nbsp;<span class="ident" id="3639190"><a href="/net/textproto/reader.go.html#3638532">stateDot</a></span><span class="op" id="3639198">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639203">if</span>&nbsp;<span class="ident" id="3639206"><a href="/net/textproto/reader.go.html#3638881">c</a></span>&nbsp;<span class="op" id="3639208">==</span>&nbsp;<span class="string" id="3639211">&#39;\r&#39;</span>&nbsp;<span class="op" id="3639216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639222"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639223">.</span><span class="ident" id="3639224">state</span>&nbsp;<span class="op" id="3639230">=</span>&nbsp;<span class="ident" id="3639232"><a href="/net/textproto/reader.go.html#3638587">stateDotCR</a></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639247">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639264">if</span>&nbsp;<span class="ident" id="3639267"><a href="/net/textproto/reader.go.html#3638881">c</a></span>&nbsp;<span class="op" id="3639269">==</span>&nbsp;<span class="string" id="3639272">&#39;\n&#39;</span>&nbsp;<span class="op" id="3639277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639283"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639284">.</span><span class="ident" id="3639285">state</span>&nbsp;<span class="op" id="3639291">=</span>&nbsp;<span class="ident" id="3639293"><a href="/net/textproto/reader.go.html#3638763">stateEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639306">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639323"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639324">.</span><span class="ident" id="3639325">state</span>&nbsp;<span class="op" id="3639331">=</span>&nbsp;<span class="ident" id="3639333"><a href="/net/textproto/reader.go.html#3638705">stateData</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639346">case</span>&nbsp;<span class="ident" id="3639351"><a href="/net/textproto/reader.go.html#3638587">stateDotCR</a></span><span class="op" id="3639361">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639366">if</span>&nbsp;<span class="ident" id="3639369"><a href="/net/textproto/reader.go.html#3638881">c</a></span>&nbsp;<span class="op" id="3639371">==</span>&nbsp;<span class="string" id="3639374">&#39;\n&#39;</span>&nbsp;<span class="op" id="3639379">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639385"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639386">.</span><span class="ident" id="3639387">state</span>&nbsp;<span class="op" id="3639393">=</span>&nbsp;<span class="ident" id="3639395"><a href="/net/textproto/reader.go.html#3638763">stateEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639408">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3639425">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3639450">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639495"><a href="/net/textproto/reader.go.html#3638822">br</a></span><span class="op" id="3639497">.</span><span class="ident" id="3639498">UnreadByte</span><span class="op" id="3639508">(</span><span class="op" id="3639509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639514"><a href="/net/textproto/reader.go.html#3638881">c</a></span>&nbsp;<span class="op" id="3639516">=</span>&nbsp;<span class="string" id="3639518">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639526"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639527">.</span><span class="ident" id="3639528">state</span>&nbsp;<span class="op" id="3639534">=</span>&nbsp;<span class="ident" id="3639536"><a href="/net/textproto/reader.go.html#3638705">stateData</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639549">case</span>&nbsp;<span class="ident" id="3639554"><a href="/net/textproto/reader.go.html#3638644">stateCR</a></span><span class="op" id="3639561">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639566">if</span>&nbsp;<span class="ident" id="3639569"><a href="/net/textproto/reader.go.html#3638881">c</a></span>&nbsp;<span class="op" id="3639571">==</span>&nbsp;<span class="string" id="3639574">&#39;\n&#39;</span>&nbsp;<span class="op" id="3639579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639585"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639586">.</span><span class="ident" id="3639587">state</span>&nbsp;<span class="op" id="3639593">=</span>&nbsp;<span class="ident" id="3639595"><a href="/net/textproto/reader.go.html#3638458">stateBeginLine</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639614">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3639628">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639667"><a href="/net/textproto/reader.go.html#3638822">br</a></span><span class="op" id="3639669">.</span><span class="ident" id="3639670">UnreadByte</span><span class="op" id="3639680">(</span><span class="op" id="3639681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639686"><a href="/net/textproto/reader.go.html#3638881">c</a></span>&nbsp;<span class="op" id="3639688">=</span>&nbsp;<span class="string" id="3639690">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639698"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639699">.</span><span class="ident" id="3639700">state</span>&nbsp;<span class="op" id="3639706">=</span>&nbsp;<span class="ident" id="3639708"><a href="/net/textproto/reader.go.html#3638705">stateData</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639721">case</span>&nbsp;<span class="ident" id="3639726"><a href="/net/textproto/reader.go.html#3638705">stateData</a></span><span class="op" id="3639735">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639740">if</span>&nbsp;<span class="ident" id="3639743"><a href="/net/textproto/reader.go.html#3638881">c</a></span>&nbsp;<span class="op" id="3639745">==</span>&nbsp;<span class="string" id="3639748">&#39;\r&#39;</span>&nbsp;<span class="op" id="3639753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639759"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639760">.</span><span class="ident" id="3639761">state</span>&nbsp;<span class="op" id="3639767">=</span>&nbsp;<span class="ident" id="3639769"><a href="/net/textproto/reader.go.html#3638644">stateCR</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639781">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639798">if</span>&nbsp;<span class="ident" id="3639801"><a href="/net/textproto/reader.go.html#3638881">c</a></span>&nbsp;<span class="op" id="3639803">==</span>&nbsp;<span class="string" id="3639806">&#39;\n&#39;</span>&nbsp;<span class="op" id="3639811">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639817"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639818">.</span><span class="ident" id="3639819">state</span>&nbsp;<span class="op" id="3639825">=</span>&nbsp;<span class="ident" id="3639827"><a href="/net/textproto/reader.go.html#3638458">stateBeginLine</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639853"><a href="/net/textproto/reader.go.html#3638280">b</a></span><span class="op" id="3639854">[</span><span class="ident" id="3639855"><a href="/net/textproto/reader.go.html#3638291">n</a></span><span class="op" id="3639856">]</span>&nbsp;<span class="op" id="3639858">=</span>&nbsp;<span class="ident" id="3639860"><a href="/net/textproto/reader.go.html#3638881">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639864"><a href="/net/textproto/reader.go.html#3638291">n</a></span><span class="op" id="3639865">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639872">if</span>&nbsp;<span class="ident" id="3639875"><a href="/net/textproto/reader.go.html#3638298">err</a></span>&nbsp;<span class="op" id="3639879">==</span>&nbsp;<span class="ident" id="3639882">nil</span>&nbsp;<span class="op" id="3639886">&amp;&amp;</span>&nbsp;<span class="ident" id="3639889"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639890">.</span><span class="ident" id="3639891">state</span>&nbsp;<span class="op" id="3639897">==</span>&nbsp;<span class="ident" id="3639900"><a href="/net/textproto/reader.go.html#3638763">stateEOF</a></span>&nbsp;<span class="op" id="3639909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639913"><a href="/net/textproto/reader.go.html#3638298">err</a></span>&nbsp;<span class="op" id="3639917">=</span>&nbsp;<span class="ident" id="3639919"><a href="/net/textproto/reader.go.html#3630169">io</a></span><span class="op" id="3639921">.</span><span class="ident" id="3639922">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639930">if</span>&nbsp;<span class="ident" id="3639933"><a href="/net/textproto/reader.go.html#3638298">err</a></span>&nbsp;<span class="op" id="3639937">!=</span>&nbsp;<span class="ident" id="3639940">nil</span>&nbsp;<span class="op" id="3639944">&amp;&amp;</span>&nbsp;<span class="ident" id="3639947"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639948">.</span><span class="ident" id="3639949">r</span><span class="op" id="3639950">.</span><span class="ident" id="3639951">dot</span>&nbsp;<span class="op" id="3639955">==</span>&nbsp;<span class="ident" id="3639958"><a href="/net/textproto/reader.go.html#3638261">d</a></span>&nbsp;<span class="op" id="3639960">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639964"><a href="/net/textproto/reader.go.html#3638261">d</a></span><span class="op" id="3639965">.</span><span class="ident" id="3639966">r</span><span class="op" id="3639967">.</span><span class="ident" id="3639968">dot</span>&nbsp;<span class="op" id="3639972">=</span>&nbsp;<span class="ident" id="3639974">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639982">return</span><br>
<span class="lineno"></span><span class="op" id="3639989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3639992">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="3640041">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3640097">func</span>&nbsp;<span class="op" id="3640102">(</span><span class="ident" id="3640103">r</span>&nbsp;<span class="op" id="3640105">*</span><span class="ident" id="3640106"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3640112">)</span>&nbsp;<span class="ident" id="3640114">closeDot</span><span class="op" id="3640122">(</span><span class="op" id="3640123">)</span>&nbsp;<span class="op" id="3640125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640128">if</span>&nbsp;<span class="ident" id="3640131"><a href="/net/textproto/reader.go.html#3640103">r</a></span><span class="op" id="3640132">.</span><span class="ident" id="3640133">dot</span>&nbsp;<span class="op" id="3640137">==</span>&nbsp;<span class="ident" id="3640140">nil</span>&nbsp;<span class="op" id="3640144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640148">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3640156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640159">buf</span>&nbsp;<span class="op" id="3640163">:=</span>&nbsp;<span class="builtinfunc" id="3640166">make</span><span class="op" id="3640170">(</span><span class="op" id="3640171">[</span><span class="op" id="3640172">]</span><span class="builtintype" id="3640173">byte</span><span class="op" id="3640177">,</span>&nbsp;<span class="num" id="3640179">128</span><span class="op" id="3640182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640185">for</span>&nbsp;<span class="ident" id="3640189"><a href="/net/textproto/reader.go.html#3640103">r</a></span><span class="op" id="3640190">.</span><span class="ident" id="3640191">dot</span>&nbsp;<span class="op" id="3640195">!=</span>&nbsp;<span class="ident" id="3640198">nil</span>&nbsp;<span class="op" id="3640202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3640206">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3640246">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640277"><a href="/net/textproto/reader.go.html#3640103">r</a></span><span class="op" id="3640278">.</span><span class="ident" id="3640279">dot</span><span class="op" id="3640282">.</span><span class="ident" id="3640283">Read</span><span class="op" id="3640287">(</span><span class="ident" id="3640288"><a href="/net/textproto/reader.go.html#3640159">buf</a></span><span class="op" id="3640291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3640294">}</span><br>
<span class="lineno"></span><span class="op" id="3640296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3640299">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="3640366">//</span><br>
<span class="lineno"></span><span class="comment" id="3640369">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3640451">func</span>&nbsp;<span class="op" id="3640456">(</span><span class="ident" id="3640457">r</span>&nbsp;<span class="op" id="3640459">*</span><span class="ident" id="3640460"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3640466">)</span>&nbsp;<span class="ident" id="3640468">ReadDotBytes</span><span class="op" id="3640480">(</span><span class="op" id="3640481">)</span>&nbsp;<span class="op" id="3640483">(</span><span class="op" id="3640484">[</span><span class="op" id="3640485">]</span><span class="builtintype" id="3640486">byte</span><span class="op" id="3640490">,</span>&nbsp;<span class="builtintype" id="3640492">error</span><span class="op" id="3640497">)</span>&nbsp;<span class="op" id="3640499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640502">return</span>&nbsp;<span class="ident" id="3640509"><a href="/net/textproto/reader.go.html#3630175">ioutil</a></span><span class="op" id="3640515">.</span><span class="ident" id="3640516">ReadAll</span><span class="op" id="3640523">(</span><span class="ident" id="3640524"><a href="/net/textproto/reader.go.html#3640457">r</a></span><span class="op" id="3640525">.</span><span class="ident" id="3640526">DotReader</span><span class="op" id="3640535">(</span><span class="op" id="3640536">)</span><span class="op" id="3640537">)</span><br>
<span class="lineno"></span><span class="op" id="3640539">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3640542">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3640599">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="3640676">//</span><br>
<span class="lineno"></span><span class="comment" id="3640679">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="3640761">func</span>&nbsp;<span class="op" id="3640766">(</span><span class="ident" id="3640767">r</span>&nbsp;<span class="op" id="3640769">*</span><span class="ident" id="3640770"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3640776">)</span>&nbsp;<span class="ident" id="3640778">ReadDotLines</span><span class="op" id="3640790">(</span><span class="op" id="3640791">)</span>&nbsp;<span class="op" id="3640793">(</span><span class="op" id="3640794">[</span><span class="op" id="3640795">]</span><span class="builtintype" id="3640796">string</span><span class="op" id="3640802">,</span>&nbsp;<span class="builtintype" id="3640804">error</span><span class="op" id="3640809">)</span>&nbsp;<span class="op" id="3640811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3640814">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3640863">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3640913">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640966">var</span>&nbsp;<span class="ident" id="3640970">v</span>&nbsp;<span class="op" id="3640972">[</span><span class="op" id="3640973">]</span><span class="builtintype" id="3640974">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640982">var</span>&nbsp;<span class="ident" id="3640986">err</span>&nbsp;<span class="builtintype" id="3640990">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640997">for</span>&nbsp;<span class="op" id="3641001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3641005">var</span>&nbsp;<span class="ident" id="3641009">line</span>&nbsp;<span class="builtintype" id="3641014">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3641023"><a href="/net/textproto/reader.go.html#3641009">line</a></span><span class="op" id="3641027">,</span>&nbsp;<span class="ident" id="3641029"><a href="/net/textproto/reader.go.html#3640986">err</a></span>&nbsp;<span class="op" id="3641033">=</span>&nbsp;<span class="ident" id="3641035"><a href="/net/textproto/reader.go.html#3640767">r</a></span><span class="op" id="3641036">.</span><span class="ident" id="3641037">ReadLine</span><span class="op" id="3641045">(</span><span class="op" id="3641046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3641050">if</span>&nbsp;<span class="ident" id="3641053"><a href="/net/textproto/reader.go.html#3640986">err</a></span>&nbsp;<span class="op" id="3641057">!=</span>&nbsp;<span class="ident" id="3641060">nil</span>&nbsp;<span class="op" id="3641064">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3641069">if</span>&nbsp;<span class="ident" id="3641072"><a href="/net/textproto/reader.go.html#3640986">err</a></span>&nbsp;<span class="op" id="3641076">==</span>&nbsp;<span class="ident" id="3641079"><a href="/net/textproto/reader.go.html#3630169">io</a></span><span class="op" id="3641081">.</span><span class="ident" id="3641082">EOF</span>&nbsp;<span class="op" id="3641086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3641092"><a href="/net/textproto/reader.go.html#3640986">err</a></span>&nbsp;<span class="op" id="3641096">=</span>&nbsp;<span class="ident" id="3641098"><a href="/net/textproto/reader.go.html#3630169">io</a></span><span class="op" id="3641100">.</span><span class="ident" id="3641101">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3641121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3641126">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3641134">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3641139">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3641192">if</span>&nbsp;<span class="builtinfunc" id="3641195">len</span><span class="op" id="3641198">(</span><span class="ident" id="3641199"><a href="/net/textproto/reader.go.html#3641009">line</a></span><span class="op" id="3641203">)</span>&nbsp;<span class="op" id="3641205">&gt;</span>&nbsp;<span class="num" id="3641207">0</span>&nbsp;<span class="op" id="3641209">&amp;&amp;</span>&nbsp;<span class="ident" id="3641212"><a href="/net/textproto/reader.go.html#3641009">line</a></span><span class="op" id="3641216">[</span><span class="num" id="3641217">0</span><span class="op" id="3641218">]</span>&nbsp;<span class="op" id="3641220">==</span>&nbsp;<span class="string" id="3641223">&#39;.&#39;</span>&nbsp;<span class="op" id="3641227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3641232">if</span>&nbsp;<span class="builtinfunc" id="3641235">len</span><span class="op" id="3641238">(</span><span class="ident" id="3641239"><a href="/net/textproto/reader.go.html#3641009">line</a></span><span class="op" id="3641243">)</span>&nbsp;<span class="op" id="3641245">==</span>&nbsp;<span class="num" id="3641248">1</span>&nbsp;<span class="op" id="3641250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3641256">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3641265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3641270"><a href="/net/textproto/reader.go.html#3641009">line</a></span>&nbsp;<span class="op" id="3641275">=</span>&nbsp;<span class="ident" id="3641277"><a href="/net/textproto/reader.go.html#3641009">line</a></span><span class="op" id="3641281">[</span><span class="num" id="3641282">1</span><span class="op" id="3641283">:</span><span class="op" id="3641284">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3641288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3641292"><a href="/net/textproto/reader.go.html#3640970">v</a></span>&nbsp;<span class="op" id="3641294">=</span>&nbsp;<span class="builtinfunc" id="3641296">append</span><span class="op" id="3641302">(</span><span class="ident" id="3641303"><a href="/net/textproto/reader.go.html#3640970">v</a></span><span class="op" id="3641304">,</span>&nbsp;<span class="ident" id="3641306"><a href="/net/textproto/reader.go.html#3641009">line</a></span><span class="op" id="3641310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3641313">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3641316">return</span>&nbsp;<span class="ident" id="3641323"><a href="/net/textproto/reader.go.html#3640970">v</a></span><span class="op" id="3641324">,</span>&nbsp;<span class="ident" id="3641326"><a href="/net/textproto/reader.go.html#3640986">err</a></span><br>
<span class="lineno"></span><span class="op" id="3641330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3641333">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3641385">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="3641452">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3641479">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3641539">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3641605">//</span><br>
<span class="lineno"></span><span class="comment" id="3641608">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="3641645">//</span><br>
<span class="lineno"></span><span class="comment" id="3641648">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3641667">//&nbsp;&nbsp;&nbsp;&nbspLong-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="3641685">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="3641708">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="3641727">//</span><br>
<span class="lineno"></span><span class="comment" id="3641730">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="3641783">//</span><br>
<span class="lineno"></span><span class="comment" id="3641786">//&nbsp;&nbsp;&nbsp;&nbspmap[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="3641810">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="3641848">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="3641887">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="3641892">//</span><br>
<span class="lineno"></span><span class="keyword" id="3641895">func</span>&nbsp;<span class="op" id="3641900">(</span><span class="ident" id="3641901">r</span>&nbsp;<span class="op" id="3641903">*</span><span class="ident" id="3641904"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3641910">)</span>&nbsp;<span class="ident" id="3641912">ReadMIMEHeader</span><span class="op" id="3641926">(</span><span class="op" id="3641927">)</span>&nbsp;<span class="op" id="3641929">(</span><span class="ident" id="3641930"><a href="/net/textproto/header.go.html#3625965">MIMEHeader</a></span><span class="op" id="3641940">,</span>&nbsp;<span class="builtintype" id="3641942">error</span><span class="op" id="3641947">)</span>&nbsp;<span class="op" id="3641949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3641952">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3642018">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3642078">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642146">var</span>&nbsp;<span class="ident" id="3642150">strs</span>&nbsp;<span class="op" id="3642155">[</span><span class="op" id="3642156">]</span><span class="builtintype" id="3642157">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642165">hint</span>&nbsp;<span class="op" id="3642170">:=</span>&nbsp;<span class="ident" id="3642173"><a href="/net/textproto/reader.go.html#3641901">r</a></span><span class="op" id="3642174">.</span><span class="ident" id="3642175">upcomingHeaderNewlines</span><span class="op" id="3642197">(</span><span class="op" id="3642198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642201">if</span>&nbsp;<span class="ident" id="3642204"><a href="/net/textproto/reader.go.html#3642165">hint</a></span>&nbsp;<span class="op" id="3642209">&gt;</span>&nbsp;<span class="num" id="3642211">0</span>&nbsp;<span class="op" id="3642213">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642217"><a href="/net/textproto/reader.go.html#3642150">strs</a></span>&nbsp;<span class="op" id="3642222">=</span>&nbsp;<span class="builtinfunc" id="3642224">make</span><span class="op" id="3642228">(</span><span class="op" id="3642229">[</span><span class="op" id="3642230">]</span><span class="builtintype" id="3642231">string</span><span class="op" id="3642237">,</span>&nbsp;<span class="ident" id="3642239"><a href="/net/textproto/reader.go.html#3642165">hint</a></span><span class="op" id="3642243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3642246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642250">m</span>&nbsp;<span class="op" id="3642252">:=</span>&nbsp;<span class="builtinfunc" id="3642255">make</span><span class="op" id="3642259">(</span><span class="ident" id="3642260"><a href="/net/textproto/header.go.html#3625965">MIMEHeader</a></span><span class="op" id="3642270">,</span>&nbsp;<span class="ident" id="3642272"><a href="/net/textproto/reader.go.html#3642165">hint</a></span><span class="op" id="3642276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642279">for</span>&nbsp;<span class="op" id="3642283">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642287">kv</span><span class="op" id="3642289">,</span>&nbsp;<span class="ident" id="3642291">err</span>&nbsp;<span class="op" id="3642295">:=</span>&nbsp;<span class="ident" id="3642298"><a href="/net/textproto/reader.go.html#3641901">r</a></span><span class="op" id="3642299">.</span><span class="ident" id="3642300">readContinuedLineSlice</span><span class="op" id="3642322">(</span><span class="op" id="3642323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642327">if</span>&nbsp;<span class="builtinfunc" id="3642330">len</span><span class="op" id="3642333">(</span><span class="ident" id="3642334"><a href="/net/textproto/reader.go.html#3642287">kv</a></span><span class="op" id="3642336">)</span>&nbsp;<span class="op" id="3642338">==</span>&nbsp;<span class="num" id="3642341">0</span>&nbsp;<span class="op" id="3642343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642348">return</span>&nbsp;<span class="ident" id="3642355"><a href="/net/textproto/reader.go.html#3642250">m</a></span><span class="op" id="3642356">,</span>&nbsp;<span class="ident" id="3642358"><a href="/net/textproto/reader.go.html#3642291">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3642364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3642369">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3642426">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3642479">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642508">i</span>&nbsp;<span class="op" id="3642510">:=</span>&nbsp;<span class="ident" id="3642513"><a href="/net/textproto/reader.go.html#3630160">bytes</a></span><span class="op" id="3642518">.</span><span class="ident" id="3642519">IndexByte</span><span class="op" id="3642528">(</span><span class="ident" id="3642529"><a href="/net/textproto/reader.go.html#3642287">kv</a></span><span class="op" id="3642531">,</span>&nbsp;<span class="string" id="3642533">&#39;:&#39;</span><span class="op" id="3642536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642540">if</span>&nbsp;<span class="ident" id="3642543"><a href="/net/textproto/reader.go.html#3642508">i</a></span>&nbsp;<span class="op" id="3642545">&lt;</span>&nbsp;<span class="num" id="3642547">0</span>&nbsp;<span class="op" id="3642549">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642554">return</span>&nbsp;<span class="ident" id="3642561"><a href="/net/textproto/reader.go.html#3642250">m</a></span><span class="op" id="3642562">,</span>&nbsp;<span class="ident" id="3642564"><a href="/net/textproto/textproto.go.html#3647455">ProtocolError</a></span><span class="op" id="3642577">(</span><span class="string" id="3642578">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="3642609">+</span>&nbsp;<span class="builtintype" id="3642611">string</span><span class="op" id="3642617">(</span><span class="ident" id="3642618"><a href="/net/textproto/reader.go.html#3642287">kv</a></span><span class="op" id="3642620">)</span><span class="op" id="3642621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3642625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642629">endKey</span>&nbsp;<span class="op" id="3642636">:=</span>&nbsp;<span class="ident" id="3642639"><a href="/net/textproto/reader.go.html#3642508">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642643">for</span>&nbsp;<span class="ident" id="3642647"><a href="/net/textproto/reader.go.html#3642629">endKey</a></span>&nbsp;<span class="op" id="3642654">&gt;</span>&nbsp;<span class="num" id="3642656">0</span>&nbsp;<span class="op" id="3642658">&amp;&amp;</span>&nbsp;<span class="ident" id="3642661"><a href="/net/textproto/reader.go.html#3642287">kv</a></span><span class="op" id="3642663">[</span><span class="ident" id="3642664"><a href="/net/textproto/reader.go.html#3642629">endKey</a></span><span class="op" id="3642670">-</span><span class="num" id="3642671">1</span><span class="op" id="3642672">]</span>&nbsp;<span class="op" id="3642674">==</span>&nbsp;<span class="string" id="3642677">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3642681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642686"><a href="/net/textproto/reader.go.html#3642629">endKey</a></span><span class="op" id="3642692">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3642697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642701">key</span>&nbsp;<span class="op" id="3642705">:=</span>&nbsp;<span class="ident" id="3642708"><a href="/net/textproto/reader.go.html#3644775">canonicalMIMEHeaderKey</a></span><span class="op" id="3642730">(</span><span class="ident" id="3642731"><a href="/net/textproto/reader.go.html#3642287">kv</a></span><span class="op" id="3642733">[</span><span class="op" id="3642734">:</span><span class="ident" id="3642735"><a href="/net/textproto/reader.go.html#3642629">endKey</a></span><span class="op" id="3642741">]</span><span class="op" id="3642742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3642747">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642782"><a href="/net/textproto/reader.go.html#3642508">i</a></span><span class="op" id="3642783">++</span>&nbsp;<span class="comment" id="3642786">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642802">for</span>&nbsp;<span class="ident" id="3642806"><a href="/net/textproto/reader.go.html#3642508">i</a></span>&nbsp;<span class="op" id="3642808">&lt;</span>&nbsp;<span class="builtinfunc" id="3642810">len</span><span class="op" id="3642813">(</span><span class="ident" id="3642814"><a href="/net/textproto/reader.go.html#3642287">kv</a></span><span class="op" id="3642816">)</span>&nbsp;<span class="op" id="3642818">&amp;&amp;</span>&nbsp;<span class="op" id="3642821">(</span><span class="ident" id="3642822"><a href="/net/textproto/reader.go.html#3642287">kv</a></span><span class="op" id="3642824">[</span><span class="ident" id="3642825"><a href="/net/textproto/reader.go.html#3642508">i</a></span><span class="op" id="3642826">]</span>&nbsp;<span class="op" id="3642828">==</span>&nbsp;<span class="string" id="3642831">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3642835">||</span>&nbsp;<span class="ident" id="3642838"><a href="/net/textproto/reader.go.html#3642287">kv</a></span><span class="op" id="3642840">[</span><span class="ident" id="3642841"><a href="/net/textproto/reader.go.html#3642508">i</a></span><span class="op" id="3642842">]</span>&nbsp;<span class="op" id="3642844">==</span>&nbsp;<span class="string" id="3642847">&#39;\t&#39;</span><span class="op" id="3642851">)</span>&nbsp;<span class="op" id="3642853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642858"><a href="/net/textproto/reader.go.html#3642508">i</a></span><span class="op" id="3642859">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3642864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642868">value</span>&nbsp;<span class="op" id="3642874">:=</span>&nbsp;<span class="builtintype" id="3642877">string</span><span class="op" id="3642883">(</span><span class="ident" id="3642884"><a href="/net/textproto/reader.go.html#3642287">kv</a></span><span class="op" id="3642886">[</span><span class="ident" id="3642887"><a href="/net/textproto/reader.go.html#3642508">i</a></span><span class="op" id="3642888">:</span><span class="op" id="3642889">]</span><span class="op" id="3642890">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642895">vv</span>&nbsp;<span class="op" id="3642898">:=</span>&nbsp;<span class="ident" id="3642901"><a href="/net/textproto/reader.go.html#3642250">m</a></span><span class="op" id="3642902">[</span><span class="ident" id="3642903"><a href="/net/textproto/reader.go.html#3642701">key</a></span><span class="op" id="3642906">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642910">if</span>&nbsp;<span class="ident" id="3642913"><a href="/net/textproto/reader.go.html#3642895">vv</a></span>&nbsp;<span class="op" id="3642916">==</span>&nbsp;<span class="ident" id="3642919">nil</span>&nbsp;<span class="op" id="3642923">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3642926">len</span><span class="op" id="3642929">(</span><span class="ident" id="3642930"><a href="/net/textproto/reader.go.html#3642150">strs</a></span><span class="op" id="3642934">)</span>&nbsp;<span class="op" id="3642936">&gt;</span>&nbsp;<span class="num" id="3642938">0</span>&nbsp;<span class="op" id="3642940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3642945">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3643003">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3643043">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3643104">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643157"><a href="/net/textproto/reader.go.html#3642895">vv</a></span><span class="op" id="3643159">,</span>&nbsp;<span class="ident" id="3643161"><a href="/net/textproto/reader.go.html#3642150">strs</a></span>&nbsp;<span class="op" id="3643166">=</span>&nbsp;<span class="ident" id="3643168"><a href="/net/textproto/reader.go.html#3642150">strs</a></span><span class="op" id="3643172">[</span><span class="op" id="3643173">:</span><span class="num" id="3643174">1</span><span class="op" id="3643175">:</span><span class="num" id="3643176">1</span><span class="op" id="3643177">]</span><span class="op" id="3643178">,</span>&nbsp;<span class="ident" id="3643180"><a href="/net/textproto/reader.go.html#3642150">strs</a></span><span class="op" id="3643184">[</span><span class="num" id="3643185">1</span><span class="op" id="3643186">:</span><span class="op" id="3643187">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643192"><a href="/net/textproto/reader.go.html#3642895">vv</a></span><span class="op" id="3643194">[</span><span class="num" id="3643195">0</span><span class="op" id="3643196">]</span>&nbsp;<span class="op" id="3643198">=</span>&nbsp;<span class="ident" id="3643200"><a href="/net/textproto/reader.go.html#3642868">value</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643209"><a href="/net/textproto/reader.go.html#3642250">m</a></span><span class="op" id="3643210">[</span><span class="ident" id="3643211"><a href="/net/textproto/reader.go.html#3642701">key</a></span><span class="op" id="3643214">]</span>&nbsp;<span class="op" id="3643216">=</span>&nbsp;<span class="ident" id="3643218"><a href="/net/textproto/reader.go.html#3642895">vv</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3643223">}</span>&nbsp;<span class="keyword" id="3643225">else</span>&nbsp;<span class="op" id="3643230">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643235"><a href="/net/textproto/reader.go.html#3642250">m</a></span><span class="op" id="3643236">[</span><span class="ident" id="3643237"><a href="/net/textproto/reader.go.html#3642701">key</a></span><span class="op" id="3643240">]</span>&nbsp;<span class="op" id="3643242">=</span>&nbsp;<span class="builtinfunc" id="3643244">append</span><span class="op" id="3643250">(</span><span class="ident" id="3643251"><a href="/net/textproto/reader.go.html#3642895">vv</a></span><span class="op" id="3643253">,</span>&nbsp;<span class="ident" id="3643255"><a href="/net/textproto/reader.go.html#3642868">value</a></span><span class="op" id="3643260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3643264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3643269">if</span>&nbsp;<span class="ident" id="3643272"><a href="/net/textproto/reader.go.html#3642291">err</a></span>&nbsp;<span class="op" id="3643276">!=</span>&nbsp;<span class="ident" id="3643279">nil</span>&nbsp;<span class="op" id="3643283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3643288">return</span>&nbsp;<span class="ident" id="3643295"><a href="/net/textproto/reader.go.html#3642250">m</a></span><span class="op" id="3643296">,</span>&nbsp;<span class="ident" id="3643298"><a href="/net/textproto/reader.go.html#3642291">err</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3643304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3643307">}</span><br>
<span class="lineno"></span><span class="op" id="3643309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3643312">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="3643389">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3643456">func</span>&nbsp;<span class="op" id="3643461">(</span><span class="ident" id="3643462">r</span>&nbsp;<span class="op" id="3643464">*</span><span class="ident" id="3643465"><a href="/net/textproto/reader.go.html#3630518">Reader</a></span><span class="op" id="3643471">)</span>&nbsp;<span class="ident" id="3643473">upcomingHeaderNewlines</span><span class="op" id="3643495">(</span><span class="op" id="3643496">)</span>&nbsp;<span class="op" id="3643498">(</span><span class="ident" id="3643499">n</span>&nbsp;<span class="builtintype" id="3643501">int</span><span class="op" id="3643504">)</span>&nbsp;<span class="op" id="3643506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3643509">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643547"><a href="/net/textproto/reader.go.html#3643462">r</a></span><span class="op" id="3643548">.</span><span class="ident" id="3643549">R</span><span class="op" id="3643550">.</span><span class="ident" id="3643551">Peek</span><span class="op" id="3643555">(</span><span class="num" id="3643556">1</span><span class="op" id="3643557">)</span>&nbsp;<span class="comment" id="3643559">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643592">s</span>&nbsp;<span class="op" id="3643594">:=</span>&nbsp;<span class="ident" id="3643597"><a href="/net/textproto/reader.go.html#3643462">r</a></span><span class="op" id="3643598">.</span><span class="ident" id="3643599">R</span><span class="op" id="3643600">.</span><span class="ident" id="3643601">Buffered</span><span class="op" id="3643609">(</span><span class="op" id="3643610">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3643613">if</span>&nbsp;<span class="ident" id="3643616"><a href="/net/textproto/reader.go.html#3643592">s</a></span>&nbsp;<span class="op" id="3643618">==</span>&nbsp;<span class="num" id="3643621">0</span>&nbsp;<span class="op" id="3643623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3643627">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3643635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643638">peek</span><span class="op" id="3643642">,</span>&nbsp;<span class="ident" id="3643644">_</span>&nbsp;<span class="op" id="3643646">:=</span>&nbsp;<span class="ident" id="3643649"><a href="/net/textproto/reader.go.html#3643462">r</a></span><span class="op" id="3643650">.</span><span class="ident" id="3643651">R</span><span class="op" id="3643652">.</span><span class="ident" id="3643653">Peek</span><span class="op" id="3643657">(</span><span class="ident" id="3643658"><a href="/net/textproto/reader.go.html#3643592">s</a></span><span class="op" id="3643659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3643662">for</span>&nbsp;<span class="builtinfunc" id="3643666">len</span><span class="op" id="3643669">(</span><span class="ident" id="3643670"><a href="/net/textproto/reader.go.html#3643638">peek</a></span><span class="op" id="3643674">)</span>&nbsp;<span class="op" id="3643676">&gt;</span>&nbsp;<span class="num" id="3643678">0</span>&nbsp;<span class="op" id="3643680">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643684">i</span>&nbsp;<span class="op" id="3643686">:=</span>&nbsp;<span class="ident" id="3643689"><a href="/net/textproto/reader.go.html#3630160">bytes</a></span><span class="op" id="3643694">.</span><span class="ident" id="3643695">IndexByte</span><span class="op" id="3643704">(</span><span class="ident" id="3643705"><a href="/net/textproto/reader.go.html#3643638">peek</a></span><span class="op" id="3643709">,</span>&nbsp;<span class="string" id="3643711">&#39;\n&#39;</span><span class="op" id="3643715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3643719">if</span>&nbsp;<span class="ident" id="3643722"><a href="/net/textproto/reader.go.html#3643684">i</a></span>&nbsp;<span class="op" id="3643724">&lt;</span>&nbsp;<span class="num" id="3643726">3</span>&nbsp;<span class="op" id="3643728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3643733">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3643792">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3643847">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3643856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643860"><a href="/net/textproto/reader.go.html#3643499">n</a></span><span class="op" id="3643861">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643866"><a href="/net/textproto/reader.go.html#3643638">peek</a></span>&nbsp;<span class="op" id="3643871">=</span>&nbsp;<span class="ident" id="3643873"><a href="/net/textproto/reader.go.html#3643638">peek</a></span><span class="op" id="3643877">[</span><span class="ident" id="3643878"><a href="/net/textproto/reader.go.html#3643684">i</a></span><span class="op" id="3643879">+</span><span class="num" id="3643880">1</span><span class="op" id="3643881">:</span><span class="op" id="3643882">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3643885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3643888">return</span><br>
<span class="lineno">535</span><span class="op" id="3643895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3643898">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3643960">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3644023">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="3644082">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3644140">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3644201">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="3644251">func</span>&nbsp;<span class="ident" id="3644256">CanonicalMIMEHeaderKey</span><span class="op" id="3644278">(</span><span class="ident" id="3644279">s</span>&nbsp;<span class="builtintype" id="3644281">string</span><span class="op" id="3644287">)</span>&nbsp;<span class="builtintype" id="3644289">string</span>&nbsp;<span class="op" id="3644296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3644299">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3644339">upper</span>&nbsp;<span class="op" id="3644345">:=</span>&nbsp;<span class="builtintype" id="3644348">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3644354">for</span>&nbsp;<span class="ident" id="3644358">i</span>&nbsp;<span class="op" id="3644360">:=</span>&nbsp;<span class="num" id="3644363">0</span><span class="op" id="3644364">;</span>&nbsp;<span class="ident" id="3644366"><a href="/net/textproto/reader.go.html#3644358">i</a></span>&nbsp;<span class="op" id="3644368">&lt;</span>&nbsp;<span class="builtinfunc" id="3644370">len</span><span class="op" id="3644373">(</span><span class="ident" id="3644374"><a href="/net/textproto/reader.go.html#3644279">s</a></span><span class="op" id="3644375">)</span><span class="op" id="3644376">;</span>&nbsp;<span class="ident" id="3644378"><a href="/net/textproto/reader.go.html#3644358">i</a></span><span class="op" id="3644379">++</span>&nbsp;<span class="op" id="3644382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3644386">c</span>&nbsp;<span class="op" id="3644388">:=</span>&nbsp;<span class="ident" id="3644391"><a href="/net/textproto/reader.go.html#3644279">s</a></span><span class="op" id="3644392">[</span><span class="ident" id="3644393"><a href="/net/textproto/reader.go.html#3644358">i</a></span><span class="op" id="3644394">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3644398">if</span>&nbsp;<span class="ident" id="3644401"><a href="/net/textproto/reader.go.html#3644339">upper</a></span>&nbsp;<span class="op" id="3644407">&amp;&amp;</span>&nbsp;<span class="string" id="3644410">&#39;a&#39;</span>&nbsp;<span class="op" id="3644414">&lt;=</span>&nbsp;<span class="ident" id="3644417"><a href="/net/textproto/reader.go.html#3644386">c</a></span>&nbsp;<span class="op" id="3644419">&amp;&amp;</span>&nbsp;<span class="ident" id="3644422"><a href="/net/textproto/reader.go.html#3644386">c</a></span>&nbsp;<span class="op" id="3644424">&lt;=</span>&nbsp;<span class="string" id="3644427">&#39;z&#39;</span>&nbsp;<span class="op" id="3644431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3644436">return</span>&nbsp;<span class="ident" id="3644443"><a href="/net/textproto/reader.go.html#3644775">canonicalMIMEHeaderKey</a></span><span class="op" id="3644465">(</span><span class="op" id="3644466">[</span><span class="op" id="3644467">]</span><span class="builtintype" id="3644468">byte</span><span class="op" id="3644472">(</span><span class="ident" id="3644473"><a href="/net/textproto/reader.go.html#3644279">s</a></span><span class="op" id="3644474">)</span><span class="op" id="3644475">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3644479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3644483">if</span>&nbsp;<span class="op" id="3644486">!</span><span class="ident" id="3644487"><a href="/net/textproto/reader.go.html#3644339">upper</a></span>&nbsp;<span class="op" id="3644493">&amp;&amp;</span>&nbsp;<span class="string" id="3644496">&#39;A&#39;</span>&nbsp;<span class="op" id="3644500">&lt;=</span>&nbsp;<span class="ident" id="3644503"><a href="/net/textproto/reader.go.html#3644386">c</a></span>&nbsp;<span class="op" id="3644505">&amp;&amp;</span>&nbsp;<span class="ident" id="3644508"><a href="/net/textproto/reader.go.html#3644386">c</a></span>&nbsp;<span class="op" id="3644510">&lt;=</span>&nbsp;<span class="string" id="3644513">&#39;Z&#39;</span>&nbsp;<span class="op" id="3644517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3644522">return</span>&nbsp;<span class="ident" id="3644529"><a href="/net/textproto/reader.go.html#3644775">canonicalMIMEHeaderKey</a></span><span class="op" id="3644551">(</span><span class="op" id="3644552">[</span><span class="op" id="3644553">]</span><span class="builtintype" id="3644554">byte</span><span class="op" id="3644558">(</span><span class="ident" id="3644559"><a href="/net/textproto/reader.go.html#3644279">s</a></span><span class="op" id="3644560">)</span><span class="op" id="3644561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3644565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3644569"><a href="/net/textproto/reader.go.html#3644339">upper</a></span>&nbsp;<span class="op" id="3644575">=</span>&nbsp;<span class="ident" id="3644577"><a href="/net/textproto/reader.go.html#3644386">c</a></span>&nbsp;<span class="op" id="3644579">==</span>&nbsp;<span class="string" id="3644582">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3644587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3644590">return</span>&nbsp;<span class="ident" id="3644597"><a href="/net/textproto/reader.go.html#3644279">s</a></span><br>
<span class="lineno"></span><span class="op" id="3644599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3644602">const</span>&nbsp;<span class="ident" id="3644608">toLower</span>&nbsp;<span class="op" id="3644616">=</span>&nbsp;<span class="string" id="3644618">&#39;a&#39;</span>&nbsp;<span class="op" id="3644622">-</span>&nbsp;<span class="string" id="3644624">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="3644629">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3644693">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3644759">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3644770">func</span>&nbsp;<span class="ident" id="3644775">canonicalMIMEHeaderKey</span><span class="op" id="3644797">(</span><span class="ident" id="3644798">a</span>&nbsp;<span class="op" id="3644800">[</span><span class="op" id="3644801">]</span><span class="builtintype" id="3644802">byte</span><span class="op" id="3644806">)</span>&nbsp;<span class="builtintype" id="3644808">string</span>&nbsp;<span class="op" id="3644815">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3644818">upper</span>&nbsp;<span class="op" id="3644824">:=</span>&nbsp;<span class="builtintype" id="3644827">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3644833">for</span>&nbsp;<span class="ident" id="3644837">i</span><span class="op" id="3644838">,</span>&nbsp;<span class="ident" id="3644840">c</span>&nbsp;<span class="op" id="3644842">:=</span>&nbsp;<span class="keyword" id="3644845">range</span>&nbsp;<span class="ident" id="3644851"><a href="/net/textproto/reader.go.html#3644798">a</a></span>&nbsp;<span class="op" id="3644853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3644857">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3644900">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3644937">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3644981">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645037">if</span>&nbsp;<span class="ident" id="3645040"><a href="/net/textproto/reader.go.html#3644840">c</a></span>&nbsp;<span class="op" id="3645042">==</span>&nbsp;<span class="string" id="3645045">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3645049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645054"><a href="/net/textproto/reader.go.html#3644840">c</a></span>&nbsp;<span class="op" id="3645056">=</span>&nbsp;<span class="string" id="3645058">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3645064">}</span>&nbsp;<span class="keyword" id="3645066">else</span>&nbsp;<span class="keyword" id="3645071">if</span>&nbsp;<span class="ident" id="3645074"><a href="/net/textproto/reader.go.html#3644818">upper</a></span>&nbsp;<span class="op" id="3645080">&amp;&amp;</span>&nbsp;<span class="string" id="3645083">&#39;a&#39;</span>&nbsp;<span class="op" id="3645087">&lt;=</span>&nbsp;<span class="ident" id="3645090"><a href="/net/textproto/reader.go.html#3644840">c</a></span>&nbsp;<span class="op" id="3645092">&amp;&amp;</span>&nbsp;<span class="ident" id="3645095"><a href="/net/textproto/reader.go.html#3644840">c</a></span>&nbsp;<span class="op" id="3645097">&lt;=</span>&nbsp;<span class="string" id="3645100">&#39;z&#39;</span>&nbsp;<span class="op" id="3645104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645109"><a href="/net/textproto/reader.go.html#3644840">c</a></span>&nbsp;<span class="op" id="3645111">-=</span>&nbsp;<span class="ident" id="3645114"><a href="/net/textproto/reader.go.html#3644608">toLower</a></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3645124">}</span>&nbsp;<span class="keyword" id="3645126">else</span>&nbsp;<span class="keyword" id="3645131">if</span>&nbsp;<span class="op" id="3645134">!</span><span class="ident" id="3645135"><a href="/net/textproto/reader.go.html#3644818">upper</a></span>&nbsp;<span class="op" id="3645141">&amp;&amp;</span>&nbsp;<span class="string" id="3645144">&#39;A&#39;</span>&nbsp;<span class="op" id="3645148">&lt;=</span>&nbsp;<span class="ident" id="3645151"><a href="/net/textproto/reader.go.html#3644840">c</a></span>&nbsp;<span class="op" id="3645153">&amp;&amp;</span>&nbsp;<span class="ident" id="3645156"><a href="/net/textproto/reader.go.html#3644840">c</a></span>&nbsp;<span class="op" id="3645158">&lt;=</span>&nbsp;<span class="string" id="3645161">&#39;Z&#39;</span>&nbsp;<span class="op" id="3645165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645170"><a href="/net/textproto/reader.go.html#3644840">c</a></span>&nbsp;<span class="op" id="3645172">+=</span>&nbsp;<span class="ident" id="3645175"><a href="/net/textproto/reader.go.html#3644608">toLower</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3645185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645189"><a href="/net/textproto/reader.go.html#3644798">a</a></span><span class="op" id="3645190">[</span><span class="ident" id="3645191"><a href="/net/textproto/reader.go.html#3644837">i</a></span><span class="op" id="3645192">]</span>&nbsp;<span class="op" id="3645194">=</span>&nbsp;<span class="ident" id="3645196"><a href="/net/textproto/reader.go.html#3644840">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645200"><a href="/net/textproto/reader.go.html#3644818">upper</a></span>&nbsp;<span class="op" id="3645206">=</span>&nbsp;<span class="ident" id="3645208"><a href="/net/textproto/reader.go.html#3644840">c</a></span>&nbsp;<span class="op" id="3645210">==</span>&nbsp;<span class="string" id="3645213">&#39;-&#39;</span>&nbsp;<span class="comment" id="3645217">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3645235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3645238">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3645300">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3645360">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645391">if</span>&nbsp;<span class="ident" id="3645394">v</span>&nbsp;<span class="op" id="3645396">:=</span>&nbsp;<span class="ident" id="3645399"><a href="/net/textproto/reader.go.html#3645520">commonHeader</a></span><span class="op" id="3645411">[</span><span class="builtintype" id="3645412">string</span><span class="op" id="3645418">(</span><span class="ident" id="3645419"><a href="/net/textproto/reader.go.html#3644798">a</a></span><span class="op" id="3645420">)</span><span class="op" id="3645421">]</span><span class="op" id="3645422">;</span>&nbsp;<span class="ident" id="3645424"><a href="/net/textproto/reader.go.html#3645394">v</a></span>&nbsp;<span class="op" id="3645426">!=</span>&nbsp;<span class="string" id="3645429">&#34;&#34;</span>&nbsp;<span class="op" id="3645432">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645436">return</span>&nbsp;<span class="ident" id="3645443"><a href="/net/textproto/reader.go.html#3645394">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3645446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645449">return</span>&nbsp;<span class="builtintype" id="3645456">string</span><span class="op" id="3645462">(</span><span class="ident" id="3645463"><a href="/net/textproto/reader.go.html#3644798">a</a></span><span class="op" id="3645464">)</span><br>
<span class="lineno"></span><span class="op" id="3645466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3645469">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="3645516">var</span>&nbsp;<span class="ident" id="3645520">commonHeader</span>&nbsp;<span class="op" id="3645533">=</span>&nbsp;<span class="builtinfunc" id="3645535">make</span><span class="op" id="3645539">(</span><span class="keyword" id="3645540">map</span><span class="op" id="3645543">[</span><span class="builtintype" id="3645544">string</span><span class="op" id="3645550">]</span><span class="builtintype" id="3645551">string</span><span class="op" id="3645557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3645560">func</span>&nbsp;<span class="ident" id="3645565">init</span><span class="op" id="3645569">(</span><span class="op" id="3645570">)</span>&nbsp;<span class="op" id="3645572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645575">for</span>&nbsp;<span class="ident" id="3645579">_</span><span class="op" id="3645580">,</span>&nbsp;<span class="ident" id="3645582">v</span>&nbsp;<span class="op" id="3645584">:=</span>&nbsp;<span class="keyword" id="3645587">range</span>&nbsp;<span class="op" id="3645593">[</span><span class="op" id="3645594">]</span><span class="builtintype" id="3645595">string</span><span class="op" id="3645601">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645605">&#34;Accept&#34;</span><span class="op" id="3645613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645617">&#34;Accept-Charset&#34;</span><span class="op" id="3645633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645637">&#34;Accept-Encoding&#34;</span><span class="op" id="3645654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645658">&#34;Accept-Language&#34;</span><span class="op" id="3645675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645679">&#34;Accept-Ranges&#34;</span><span class="op" id="3645694">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645698">&#34;Cache-Control&#34;</span><span class="op" id="3645713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645717">&#34;Cc&#34;</span><span class="op" id="3645721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645725">&#34;Connection&#34;</span><span class="op" id="3645737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645741">&#34;Content-Id&#34;</span><span class="op" id="3645753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645757">&#34;Content-Language&#34;</span><span class="op" id="3645775">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645779">&#34;Content-Length&#34;</span><span class="op" id="3645795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645799">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="3645826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645830">&#34;Content-Type&#34;</span><span class="op" id="3645844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645848">&#34;Cookie&#34;</span><span class="op" id="3645856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645860">&#34;Date&#34;</span><span class="op" id="3645866">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645870">&#34;Dkim-Signature&#34;</span><span class="op" id="3645886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645890">&#34;Etag&#34;</span><span class="op" id="3645896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645900">&#34;Expires&#34;</span><span class="op" id="3645909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645913">&#34;From&#34;</span><span class="op" id="3645919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645923">&#34;Host&#34;</span><span class="op" id="3645929">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645933">&#34;If-Modified-Since&#34;</span><span class="op" id="3645952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645956">&#34;If-None-Match&#34;</span><span class="op" id="3645971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645975">&#34;In-Reply-To&#34;</span><span class="op" id="3645988">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3645992">&#34;Last-Modified&#34;</span><span class="op" id="3646007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646011">&#34;Location&#34;</span><span class="op" id="3646021">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646025">&#34;Message-Id&#34;</span><span class="op" id="3646037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646041">&#34;Mime-Version&#34;</span><span class="op" id="3646055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646059">&#34;Pragma&#34;</span><span class="op" id="3646067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646071">&#34;Received&#34;</span><span class="op" id="3646081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646085">&#34;Return-Path&#34;</span><span class="op" id="3646098">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646102">&#34;Server&#34;</span><span class="op" id="3646110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646114">&#34;Set-Cookie&#34;</span><span class="op" id="3646126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646130">&#34;Subject&#34;</span><span class="op" id="3646139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646143">&#34;To&#34;</span><span class="op" id="3646147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646151">&#34;User-Agent&#34;</span><span class="op" id="3646163">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646167">&#34;Via&#34;</span><span class="op" id="3646172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646176">&#34;X-Forwarded-For&#34;</span><span class="op" id="3646193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646197">&#34;X-Imforwards&#34;</span><span class="op" id="3646211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3646215">&#34;X-Powered-By&#34;</span><span class="op" id="3646229">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3646232">}</span>&nbsp;<span class="op" id="3646234">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3646238"><a href="/net/textproto/reader.go.html#3645520">commonHeader</a></span><span class="op" id="3646250">[</span><span class="ident" id="3646251"><a href="/net/textproto/reader.go.html#3645582">v</a></span><span class="op" id="3646252">]</span>&nbsp;<span class="op" id="3646254">=</span>&nbsp;<span class="ident" id="3646256"><a href="/net/textproto/reader.go.html#3645582">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3646259">}</span><br>
<span class="lineno"></span><span class="op" id="3646261">}</span>
</div>
</body>
</html>
