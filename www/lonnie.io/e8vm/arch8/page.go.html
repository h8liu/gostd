<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="4876269">package</span>&nbsp;<span class="ident" id="4876277">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4876284">import</span>&nbsp;<span class="op" id="4876291">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4876294">&#34;encoding/binary&#34;</span><br>
<span class="lineno">5</span><span class="op" id="4876312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4876315">//&nbsp;PageSize&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;a&nbsp;page&nbsp;contains.</span><br>
<span class="lineno"></span><span class="keyword" id="4876367">const</span>&nbsp;<span class="ident" id="4876373">PageSize</span>&nbsp;<span class="op" id="4876382">=</span>&nbsp;<span class="num" id="4876384">4096</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="4876390">//&nbsp;Page&nbsp;is&nbsp;a&nbsp;memory&nbsp;addressable&nbsp;area&nbsp;of&nbsp;PageSize&nbsp;bytes</span><br>
<span class="lineno"></span><span class="keyword" id="4876445">type</span>&nbsp;<span class="ident" id="4876450">page</span>&nbsp;<span class="keyword" id="4876455">struct</span>&nbsp;<span class="op" id="4876462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876465">Bytes</span>&nbsp;<span class="op" id="4876471">[</span><span class="op" id="4876472">]</span><span class="builtintype" id="4876473">byte</span><br>
<span class="lineno"></span><span class="op" id="4876478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4876481">//&nbsp;NewPage&nbsp;creates&nbsp;a&nbsp;new&nbsp;empty&nbsp;page.</span><br>
<span class="lineno"></span><span class="keyword" id="4876518">func</span>&nbsp;<span class="ident" id="4876523">newPage</span><span class="op" id="4876530">(</span><span class="op" id="4876531">)</span>&nbsp;<span class="op" id="4876533">*</span><span class="ident" id="4876534">page</span>&nbsp;<span class="op" id="4876539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876542">return</span>&nbsp;<span class="op" id="4876549">&amp;</span><span class="ident" id="4876550">page</span><span class="op" id="4876554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876558">Bytes</span><span class="op" id="4876563">:</span>&nbsp;<span class="builtinfunc" id="4876565">make</span><span class="op" id="4876569">(</span><span class="op" id="4876570">[</span><span class="op" id="4876571">]</span><span class="builtintype" id="4876572">byte</span><span class="op" id="4876576">,</span>&nbsp;<span class="ident" id="4876578">PageSize</span><span class="op" id="4876586">)</span><span class="op" id="4876587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4876590">}</span><br>
<span class="lineno">20</span><span class="op" id="4876592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4876595">//&nbsp;ReadByte&nbsp;reads&nbsp;a&nbsp;byte&nbsp;at&nbsp;the&nbsp;particular&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="4876646">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;larger&nbsp;than&nbsp;offset,&nbsp;it&nbsp;uses&nbsp;the&nbsp;modular.</span><br>
<span class="lineno"></span><span class="keyword" id="4876705">func</span>&nbsp;<span class="op" id="4876710">(</span><span class="ident" id="4876711">p</span>&nbsp;<span class="op" id="4876713">*</span><span class="ident" id="4876714">page</span><span class="op" id="4876718">)</span>&nbsp;<span class="ident" id="4876720">ReadByte</span><span class="op" id="4876728">(</span><span class="ident" id="4876729">offset</span>&nbsp;<span class="builtintype" id="4876736">uint32</span><span class="op" id="4876742">)</span>&nbsp;<span class="builtintype" id="4876744">byte</span>&nbsp;<span class="op" id="4876749">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876752">return</span>&nbsp;<span class="ident" id="4876759">p</span><span class="op" id="4876760">.</span><span class="ident" id="4876761">Bytes</span><span class="op" id="4876766">[</span><span class="ident" id="4876767">offset</span><span class="op" id="4876773">%</span><span class="ident" id="4876774">PageSize</span><span class="op" id="4876782">]</span><br>
<span class="lineno"></span><span class="op" id="4876784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4876787">//&nbsp;WriteByte&nbsp;writes&nbsp;a&nbsp;byte&nbsp;into&nbsp;the&nbsp;page&nbsp;at&nbsp;a&nbsp;particular&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="4876852">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;larger&nbsp;than&nbsp;offset,&nbsp;it&nbsp;uses&nbsp;the&nbsp;modular.</span><br>
<span class="lineno">30</span><span class="keyword" id="4876911">func</span>&nbsp;<span class="op" id="4876916">(</span><span class="ident" id="4876917">p</span>&nbsp;<span class="op" id="4876919">*</span><span class="ident" id="4876920">page</span><span class="op" id="4876924">)</span>&nbsp;<span class="ident" id="4876926">WriteByte</span><span class="op" id="4876935">(</span><span class="ident" id="4876936">offset</span>&nbsp;<span class="builtintype" id="4876943">uint32</span><span class="op" id="4876949">,</span>&nbsp;<span class="ident" id="4876951">b</span>&nbsp;<span class="builtintype" id="4876953">byte</span><span class="op" id="4876957">)</span>&nbsp;<span class="op" id="4876959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876962">p</span><span class="op" id="4876963">.</span><span class="ident" id="4876964">Bytes</span><span class="op" id="4876969">[</span><span class="ident" id="4876970">offset</span><span class="op" id="4876976">%</span><span class="ident" id="4876977">PageSize</span><span class="op" id="4876985">]</span>&nbsp;<span class="op" id="4876987">=</span>&nbsp;<span class="ident" id="4876989">b</span><br>
<span class="lineno"></span><span class="op" id="4876991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4876994">//&nbsp;The&nbsp;machines&nbsp;endian.</span><br>
<span class="lineno">35</span><span class="keyword" id="4877018">var</span>&nbsp;<span class="ident" id="4877022">Endian</span>&nbsp;<span class="op" id="4877029">=</span>&nbsp;<span class="ident" id="4877031">binary</span><span class="op" id="4877037">.</span><span class="ident" id="4877038">LittleEndian</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4877052">func</span>&nbsp;<span class="ident" id="4877057">wordOff</span><span class="op" id="4877064">(</span><span class="ident" id="4877065">offset</span>&nbsp;<span class="builtintype" id="4877072">uint32</span><span class="op" id="4877078">)</span>&nbsp;<span class="builtintype" id="4877080">uint32</span>&nbsp;<span class="op" id="4877087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877090">return</span>&nbsp;<span class="op" id="4877097">(</span><span class="ident" id="4877098">offset</span>&nbsp;<span class="op" id="4877105">%</span>&nbsp;<span class="ident" id="4877107">PageSize</span><span class="op" id="4877115">)</span>&nbsp;<span class="op" id="4877117">&amp;</span>&nbsp;<span class="op" id="4877119">^</span><span class="builtintype" id="4877120">uint32</span><span class="op" id="4877126">(</span><span class="num" id="4877127">0x3</span><span class="op" id="4877130">)</span><br>
<span class="lineno"></span><span class="op" id="4877132">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4877135">//&nbsp;ReadWord&nbsp;reads&nbsp;the&nbsp;word&nbsp;at&nbsp;the&nbsp;particular&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="4877188">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;larger&nbsp;than&nbsp;offset,&nbsp;it&nbsp;uses&nbsp;the&nbsp;modular.</span><br>
<span class="lineno"></span><span class="comment" id="4877247">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;not&nbsp;4-byte&nbsp;aligned,&nbsp;it&nbsp;aligns&nbsp;down.</span><br>
<span class="lineno"></span><span class="keyword" id="4877301">func</span>&nbsp;<span class="op" id="4877306">(</span><span class="ident" id="4877307">p</span>&nbsp;<span class="op" id="4877309">*</span><span class="ident" id="4877310">page</span><span class="op" id="4877314">)</span>&nbsp;<span class="ident" id="4877316">ReadWord</span><span class="op" id="4877324">(</span><span class="ident" id="4877325">offset</span>&nbsp;<span class="builtintype" id="4877332">uint32</span><span class="op" id="4877338">)</span>&nbsp;<span class="builtintype" id="4877340">uint32</span>&nbsp;<span class="op" id="4877347">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877350">offset</span>&nbsp;<span class="op" id="4877357">=</span>&nbsp;<span class="ident" id="4877359">wordOff</span><span class="op" id="4877366">(</span><span class="ident" id="4877367">offset</span><span class="op" id="4877373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877376">return</span>&nbsp;<span class="ident" id="4877383">Endian</span><span class="op" id="4877389">.</span><span class="ident" id="4877390">Uint32</span><span class="op" id="4877396">(</span><span class="ident" id="4877397">p</span><span class="op" id="4877398">.</span><span class="ident" id="4877399">Bytes</span><span class="op" id="4877404">[</span><span class="ident" id="4877405">offset</span>&nbsp;<span class="op" id="4877412">:</span>&nbsp;<span class="ident" id="4877414">offset</span><span class="op" id="4877420">+</span><span class="num" id="4877421">4</span><span class="op" id="4877422">]</span><span class="op" id="4877423">)</span><br>
<span class="lineno"></span><span class="op" id="4877425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4877428">//&nbsp;WriteWord&nbsp;writes&nbsp;the&nbsp;word&nbsp;at&nbsp;the&nbsp;particular&nbsp;offset.</span><br>
<span class="lineno">50</span><span class="comment" id="4877483">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;larger&nbsp;than&nbsp;offset,&nbsp;it&nbsp;uses&nbsp;the&nbsp;modular.</span><br>
<span class="lineno"></span><span class="comment" id="4877542">//&nbsp;When&nbsp;offset&nbsp;is&nbsp;not&nbsp;4-byte&nbsp;aligned,&nbsp;it&nbsp;aligns&nbsp;down.</span><br>
<span class="lineno"></span><span class="keyword" id="4877596">func</span>&nbsp;<span class="op" id="4877601">(</span><span class="ident" id="4877602">p</span>&nbsp;<span class="op" id="4877604">*</span><span class="ident" id="4877605">page</span><span class="op" id="4877609">)</span>&nbsp;<span class="ident" id="4877611">WriteWord</span><span class="op" id="4877620">(</span><span class="ident" id="4877621">offset</span>&nbsp;<span class="builtintype" id="4877628">uint32</span><span class="op" id="4877634">,</span>&nbsp;<span class="ident" id="4877636">w</span>&nbsp;<span class="builtintype" id="4877638">uint32</span><span class="op" id="4877644">)</span>&nbsp;<span class="op" id="4877646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877649">offset</span>&nbsp;<span class="op" id="4877656">=</span>&nbsp;<span class="ident" id="4877658">wordOff</span><span class="op" id="4877665">(</span><span class="ident" id="4877666">offset</span><span class="op" id="4877672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877675">Endian</span><span class="op" id="4877681">.</span><span class="ident" id="4877682">PutUint32</span><span class="op" id="4877691">(</span><span class="ident" id="4877692">p</span><span class="op" id="4877693">.</span><span class="ident" id="4877694">Bytes</span><span class="op" id="4877699">[</span><span class="ident" id="4877700">offset</span><span class="op" id="4877706">:</span><span class="ident" id="4877707">offset</span><span class="op" id="4877713">+</span><span class="num" id="4877714">4</span><span class="op" id="4877715">]</span><span class="op" id="4877716">,</span>&nbsp;<span class="ident" id="4877718">w</span><span class="op" id="4877719">)</span><br>
<span class="lineno">55</span><span class="op" id="4877721">}</span>
</div>
</body>
</html>
