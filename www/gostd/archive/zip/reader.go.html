<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5407985">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5408040">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5408094">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5408145">package</span>&nbsp;<span class="ident" id="5408153">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5408158">import</span>&nbsp;<span class="op" id="5408165">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5408168">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5408177">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5408196">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5408206">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5408214">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5408228">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5408234">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5408239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5408242">var</span>&nbsp;<span class="op" id="5408246">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408249">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5408262">=</span>&nbsp;<span class="ident" id="5408264">errors</span><span class="op" id="5408270">.</span><span class="ident" id="5408271">New</span><span class="op" id="5408274">(</span><span class="string" id="5408275">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="5408302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408305">ErrAlgorithm</span>&nbsp;<span class="op" id="5408318">=</span>&nbsp;<span class="ident" id="5408320">errors</span><span class="op" id="5408326">.</span><span class="ident" id="5408327">New</span><span class="op" id="5408330">(</span><span class="string" id="5408331">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="5408371">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408374">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="5408387">=</span>&nbsp;<span class="ident" id="5408389">errors</span><span class="op" id="5408395">.</span><span class="ident" id="5408396">New</span><span class="op" id="5408399">(</span><span class="string" id="5408400">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="5408421">)</span><br>
<span class="lineno"></span><span class="op" id="5408423">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5408426">type</span>&nbsp;<span class="ident" id="5408431">Reader</span>&nbsp;<span class="keyword" id="5408438">struct</span>&nbsp;<span class="op" id="5408445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408448">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408456">io</span><span class="op" id="5408458">.</span><span class="ident" id="5408459">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408469">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5408477">[</span><span class="op" id="5408478">]</span><span class="op" id="5408479">*</span><span class="ident" id="5408480">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408486">Comment</span>&nbsp;<span class="builtintype" id="5408494">string</span><br>
<span class="lineno"></span><span class="op" id="5408501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5408504">type</span>&nbsp;<span class="ident" id="5408509">ReadCloser</span>&nbsp;<span class="keyword" id="5408520">struct</span>&nbsp;<span class="op" id="5408527">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408530">f</span>&nbsp;<span class="op" id="5408532">*</span><span class="ident" id="5408533">os</span><span class="op" id="5408535">.</span><span class="ident" id="5408536">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408542">Reader</span><br>
<span class="lineno"></span><span class="op" id="5408549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5408552">type</span>&nbsp;<span class="ident" id="5408557">File</span>&nbsp;<span class="keyword" id="5408562">struct</span>&nbsp;<span class="op" id="5408569">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408572">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408584">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408597">io</span><span class="op" id="5408599">.</span><span class="ident" id="5408600">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408610">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5408623">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408630">headerOffset</span>&nbsp;<span class="builtintype" id="5408643">int64</span><br>
<span class="lineno"></span><span class="op" id="5408649">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5408652">func</span>&nbsp;<span class="op" id="5408657">(</span><span class="ident" id="5408658">f</span>&nbsp;<span class="op" id="5408660">*</span><span class="ident" id="5408661">File</span><span class="op" id="5408665">)</span>&nbsp;<span class="ident" id="5408667">hasDataDescriptor</span><span class="op" id="5408684">(</span><span class="op" id="5408685">)</span>&nbsp;<span class="builtintype" id="5408687">bool</span>&nbsp;<span class="op" id="5408692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408695">return</span>&nbsp;<span class="ident" id="5408702">f</span><span class="op" id="5408703">.</span><span class="ident" id="5408704">Flags</span><span class="op" id="5408709">&amp;</span><span class="num" id="5408710">0x8</span>&nbsp;<span class="op" id="5408714">!=</span>&nbsp;<span class="num" id="5408717">0</span><br>
<span class="lineno"></span><span class="op" id="5408719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5408722">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="5408802">func</span>&nbsp;<span class="ident" id="5408807">OpenReader</span><span class="op" id="5408817">(</span><span class="ident" id="5408818">name</span>&nbsp;<span class="builtintype" id="5408823">string</span><span class="op" id="5408829">)</span>&nbsp;<span class="op" id="5408831">(</span><span class="op" id="5408832">*</span><span class="ident" id="5408833">ReadCloser</span><span class="op" id="5408843">,</span>&nbsp;<span class="builtintype" id="5408845">error</span><span class="op" id="5408850">)</span>&nbsp;<span class="op" id="5408852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408855">f</span><span class="op" id="5408856">,</span>&nbsp;<span class="ident" id="5408858">err</span>&nbsp;<span class="op" id="5408862">:=</span>&nbsp;<span class="ident" id="5408865">os</span><span class="op" id="5408867">.</span><span class="ident" id="5408868">Open</span><span class="op" id="5408872">(</span><span class="ident" id="5408873">name</span><span class="op" id="5408877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408880">if</span>&nbsp;<span class="ident" id="5408883">err</span>&nbsp;<span class="op" id="5408887">!=</span>&nbsp;<span class="builtintype" id="5408890">nil</span>&nbsp;<span class="op" id="5408894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408898">return</span>&nbsp;<span class="builtintype" id="5408905">nil</span><span class="op" id="5408908">,</span>&nbsp;<span class="ident" id="5408910">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5408915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408918">fi</span><span class="op" id="5408920">,</span>&nbsp;<span class="ident" id="5408922">err</span>&nbsp;<span class="op" id="5408926">:=</span>&nbsp;<span class="ident" id="5408929">f</span><span class="op" id="5408930">.</span><span class="ident" id="5408931">Stat</span><span class="op" id="5408935">(</span><span class="op" id="5408936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408939">if</span>&nbsp;<span class="ident" id="5408942">err</span>&nbsp;<span class="op" id="5408946">!=</span>&nbsp;<span class="builtintype" id="5408949">nil</span>&nbsp;<span class="op" id="5408953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408957">f</span><span class="op" id="5408958">.</span><span class="ident" id="5408959">Close</span><span class="op" id="5408964">(</span><span class="op" id="5408965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408969">return</span>&nbsp;<span class="builtintype" id="5408976">nil</span><span class="op" id="5408979">,</span>&nbsp;<span class="ident" id="5408981">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5408986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408989">r</span>&nbsp;<span class="op" id="5408991">:=</span>&nbsp;<span class="builtinfunc" id="5408994">new</span><span class="op" id="5408997">(</span><span class="ident" id="5408998">ReadCloser</span><span class="op" id="5409008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409011">if</span>&nbsp;<span class="ident" id="5409014">err</span>&nbsp;<span class="op" id="5409018">:=</span>&nbsp;<span class="ident" id="5409021">r</span><span class="op" id="5409022">.</span><span class="ident" id="5409023">init</span><span class="op" id="5409027">(</span><span class="ident" id="5409028">f</span><span class="op" id="5409029">,</span>&nbsp;<span class="ident" id="5409031">fi</span><span class="op" id="5409033">.</span><span class="ident" id="5409034">Size</span><span class="op" id="5409038">(</span><span class="op" id="5409039">)</span><span class="op" id="5409040">)</span><span class="op" id="5409041">;</span>&nbsp;<span class="ident" id="5409043">err</span>&nbsp;<span class="op" id="5409047">!=</span>&nbsp;<span class="builtintype" id="5409050">nil</span>&nbsp;<span class="op" id="5409054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409058">f</span><span class="op" id="5409059">.</span><span class="ident" id="5409060">Close</span><span class="op" id="5409065">(</span><span class="op" id="5409066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409070">return</span>&nbsp;<span class="builtintype" id="5409077">nil</span><span class="op" id="5409080">,</span>&nbsp;<span class="ident" id="5409082">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5409087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409090">r</span><span class="op" id="5409091">.</span><span class="ident" id="5409092">f</span>&nbsp;<span class="op" id="5409094">=</span>&nbsp;<span class="ident" id="5409096">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409099">return</span>&nbsp;<span class="ident" id="5409106">r</span><span class="op" id="5409107">,</span>&nbsp;<span class="builtintype" id="5409109">nil</span><br>
<span class="lineno"></span><span class="op" id="5409113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5409116">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5409186">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5409219">func</span>&nbsp;<span class="ident" id="5409224">NewReader</span><span class="op" id="5409233">(</span><span class="ident" id="5409234">r</span>&nbsp;<span class="ident" id="5409236">io</span><span class="op" id="5409238">.</span><span class="ident" id="5409239">ReaderAt</span><span class="op" id="5409247">,</span>&nbsp;<span class="ident" id="5409249">size</span>&nbsp;<span class="builtintype" id="5409254">int64</span><span class="op" id="5409259">)</span>&nbsp;<span class="op" id="5409261">(</span><span class="op" id="5409262">*</span><span class="ident" id="5409263">Reader</span><span class="op" id="5409269">,</span>&nbsp;<span class="builtintype" id="5409271">error</span><span class="op" id="5409276">)</span>&nbsp;<span class="op" id="5409278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409281">zr</span>&nbsp;<span class="op" id="5409284">:=</span>&nbsp;<span class="builtinfunc" id="5409287">new</span><span class="op" id="5409290">(</span><span class="ident" id="5409291">Reader</span><span class="op" id="5409297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409300">if</span>&nbsp;<span class="ident" id="5409303">err</span>&nbsp;<span class="op" id="5409307">:=</span>&nbsp;<span class="ident" id="5409310">zr</span><span class="op" id="5409312">.</span><span class="ident" id="5409313">init</span><span class="op" id="5409317">(</span><span class="ident" id="5409318">r</span><span class="op" id="5409319">,</span>&nbsp;<span class="ident" id="5409321">size</span><span class="op" id="5409325">)</span><span class="op" id="5409326">;</span>&nbsp;<span class="ident" id="5409328">err</span>&nbsp;<span class="op" id="5409332">!=</span>&nbsp;<span class="builtintype" id="5409335">nil</span>&nbsp;<span class="op" id="5409339">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409343">return</span>&nbsp;<span class="builtintype" id="5409350">nil</span><span class="op" id="5409353">,</span>&nbsp;<span class="ident" id="5409355">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5409360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409363">return</span>&nbsp;<span class="ident" id="5409370">zr</span><span class="op" id="5409372">,</span>&nbsp;<span class="builtintype" id="5409374">nil</span><br>
<span class="lineno"></span><span class="op" id="5409378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5409381">func</span>&nbsp;<span class="op" id="5409386">(</span><span class="ident" id="5409387">z</span>&nbsp;<span class="op" id="5409389">*</span><span class="ident" id="5409390">Reader</span><span class="op" id="5409396">)</span>&nbsp;<span class="ident" id="5409398">init</span><span class="op" id="5409402">(</span><span class="ident" id="5409403">r</span>&nbsp;<span class="ident" id="5409405">io</span><span class="op" id="5409407">.</span><span class="ident" id="5409408">ReaderAt</span><span class="op" id="5409416">,</span>&nbsp;<span class="ident" id="5409418">size</span>&nbsp;<span class="builtintype" id="5409423">int64</span><span class="op" id="5409428">)</span>&nbsp;<span class="builtintype" id="5409430">error</span>&nbsp;<span class="op" id="5409436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409439">end</span><span class="op" id="5409442">,</span>&nbsp;<span class="ident" id="5409444">err</span>&nbsp;<span class="op" id="5409448">:=</span>&nbsp;<span class="ident" id="5409451">readDirectoryEnd</span><span class="op" id="5409467">(</span><span class="ident" id="5409468">r</span><span class="op" id="5409469">,</span>&nbsp;<span class="ident" id="5409471">size</span><span class="op" id="5409475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409478">if</span>&nbsp;<span class="ident" id="5409481">err</span>&nbsp;<span class="op" id="5409485">!=</span>&nbsp;<span class="builtintype" id="5409488">nil</span>&nbsp;<span class="op" id="5409492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409496">return</span>&nbsp;<span class="ident" id="5409503">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5409508">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409511">z</span><span class="op" id="5409512">.</span><span class="ident" id="5409513">r</span>&nbsp;<span class="op" id="5409515">=</span>&nbsp;<span class="ident" id="5409517">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409520">z</span><span class="op" id="5409521">.</span><span class="ident" id="5409522">File</span>&nbsp;<span class="op" id="5409527">=</span>&nbsp;<span class="builtinfunc" id="5409529">make</span><span class="op" id="5409533">(</span><span class="op" id="5409534">[</span><span class="op" id="5409535">]</span><span class="op" id="5409536">*</span><span class="ident" id="5409537">File</span><span class="op" id="5409541">,</span>&nbsp;<span class="num" id="5409543">0</span><span class="op" id="5409544">,</span>&nbsp;<span class="ident" id="5409546">end</span><span class="op" id="5409549">.</span><span class="ident" id="5409550">directoryRecords</span><span class="op" id="5409566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409569">z</span><span class="op" id="5409570">.</span><span class="ident" id="5409571">Comment</span>&nbsp;<span class="op" id="5409579">=</span>&nbsp;<span class="ident" id="5409581">end</span><span class="op" id="5409584">.</span><span class="ident" id="5409585">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409594">rs</span>&nbsp;<span class="op" id="5409597">:=</span>&nbsp;<span class="ident" id="5409600">io</span><span class="op" id="5409602">.</span><span class="ident" id="5409603">NewSectionReader</span><span class="op" id="5409619">(</span><span class="ident" id="5409620">r</span><span class="op" id="5409621">,</span>&nbsp;<span class="num" id="5409623">0</span><span class="op" id="5409624">,</span>&nbsp;<span class="ident" id="5409626">size</span><span class="op" id="5409630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409633">if</span>&nbsp;<span class="ident" id="5409636">_</span><span class="op" id="5409637">,</span>&nbsp;<span class="ident" id="5409639">err</span>&nbsp;<span class="op" id="5409643">=</span>&nbsp;<span class="ident" id="5409645">rs</span><span class="op" id="5409647">.</span><span class="ident" id="5409648">Seek</span><span class="op" id="5409652">(</span><span class="builtintype" id="5409653">int64</span><span class="op" id="5409658">(</span><span class="ident" id="5409659">end</span><span class="op" id="5409662">.</span><span class="ident" id="5409663">directoryOffset</span><span class="op" id="5409678">)</span><span class="op" id="5409679">,</span>&nbsp;<span class="ident" id="5409681">os</span><span class="op" id="5409683">.</span><span class="ident" id="5409684">SEEK_SET</span><span class="op" id="5409692">)</span><span class="op" id="5409693">;</span>&nbsp;<span class="ident" id="5409695">err</span>&nbsp;<span class="op" id="5409699">!=</span>&nbsp;<span class="builtintype" id="5409702">nil</span>&nbsp;<span class="op" id="5409706">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409710">return</span>&nbsp;<span class="ident" id="5409717">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5409722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409725">buf</span>&nbsp;<span class="op" id="5409729">:=</span>&nbsp;<span class="ident" id="5409732">bufio</span><span class="op" id="5409737">.</span><span class="ident" id="5409738">NewReader</span><span class="op" id="5409747">(</span><span class="ident" id="5409748">rs</span><span class="op" id="5409750">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5409754">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5409823">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5409881">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5409949">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409995">for</span>&nbsp;<span class="op" id="5409999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5410003">f</span>&nbsp;<span class="op" id="5410005">:=</span>&nbsp;<span class="op" id="5410008">&amp;</span><span class="ident" id="5410009">File</span><span class="op" id="5410013">{</span><span class="ident" id="5410014">zipr</span><span class="op" id="5410018">:</span>&nbsp;<span class="ident" id="5410020">r</span><span class="op" id="5410021">,</span>&nbsp;<span class="ident" id="5410023">zipsize</span><span class="op" id="5410030">:</span>&nbsp;<span class="ident" id="5410032">size</span><span class="op" id="5410036">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5410040">err</span>&nbsp;<span class="op" id="5410044">=</span>&nbsp;<span class="ident" id="5410046">readDirectoryHeader</span><span class="op" id="5410065">(</span><span class="ident" id="5410066">f</span><span class="op" id="5410067">,</span>&nbsp;<span class="ident" id="5410069">buf</span><span class="op" id="5410072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410076">if</span>&nbsp;<span class="ident" id="5410079">err</span>&nbsp;<span class="op" id="5410083">==</span>&nbsp;<span class="ident" id="5410086">ErrFormat</span>&nbsp;<span class="op" id="5410096">||</span>&nbsp;<span class="ident" id="5410099">err</span>&nbsp;<span class="op" id="5410103">==</span>&nbsp;<span class="ident" id="5410106">io</span><span class="op" id="5410108">.</span><span class="ident" id="5410109">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="5410126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410131">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5410139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410143">if</span>&nbsp;<span class="ident" id="5410146">err</span>&nbsp;<span class="op" id="5410150">!=</span>&nbsp;<span class="builtintype" id="5410153">nil</span>&nbsp;<span class="op" id="5410157">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410162">return</span>&nbsp;<span class="ident" id="5410169">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5410175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5410179">z</span><span class="op" id="5410180">.</span><span class="ident" id="5410181">File</span>&nbsp;<span class="op" id="5410186">=</span>&nbsp;<span class="builtinfunc" id="5410188">append</span><span class="op" id="5410194">(</span><span class="ident" id="5410195">z</span><span class="op" id="5410196">.</span><span class="ident" id="5410197">File</span><span class="op" id="5410201">,</span>&nbsp;<span class="ident" id="5410203">f</span><span class="op" id="5410204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5410207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410210">if</span>&nbsp;<span class="builtintype" id="5410213">uint16</span><span class="op" id="5410219">(</span><span class="builtinfunc" id="5410220">len</span><span class="op" id="5410223">(</span><span class="ident" id="5410224">z</span><span class="op" id="5410225">.</span><span class="ident" id="5410226">File</span><span class="op" id="5410230">)</span><span class="op" id="5410231">)</span>&nbsp;<span class="op" id="5410233">!=</span>&nbsp;<span class="builtintype" id="5410236">uint16</span><span class="op" id="5410242">(</span><span class="ident" id="5410243">end</span><span class="op" id="5410246">.</span><span class="ident" id="5410247">directoryRecords</span><span class="op" id="5410263">)</span>&nbsp;<span class="op" id="5410265">{</span>&nbsp;<span class="comment" id="5410267">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5410298">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5410351">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410395">return</span>&nbsp;<span class="ident" id="5410402">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5410407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410410">return</span>&nbsp;<span class="builtintype" id="5410417">nil</span><br>
<span class="lineno">110</span><span class="op" id="5410421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5410424">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="5410485">func</span>&nbsp;<span class="op" id="5410490">(</span><span class="ident" id="5410491">rc</span>&nbsp;<span class="op" id="5410494">*</span><span class="ident" id="5410495">ReadCloser</span><span class="op" id="5410505">)</span>&nbsp;<span class="ident" id="5410507">Close</span><span class="op" id="5410512">(</span><span class="op" id="5410513">)</span>&nbsp;<span class="builtintype" id="5410515">error</span>&nbsp;<span class="op" id="5410521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410524">return</span>&nbsp;<span class="ident" id="5410531">rc</span><span class="op" id="5410533">.</span><span class="ident" id="5410534">f</span><span class="op" id="5410535">.</span><span class="ident" id="5410536">Close</span><span class="op" id="5410541">(</span><span class="op" id="5410542">)</span><br>
<span class="lineno">115</span><span class="op" id="5410544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5410547">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="5410614">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5410666">//</span><br>
<span class="lineno">120</span><span class="comment" id="5410669">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="5410730">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="5410775">func</span>&nbsp;<span class="op" id="5410780">(</span><span class="ident" id="5410781">f</span>&nbsp;<span class="op" id="5410783">*</span><span class="ident" id="5410784">File</span><span class="op" id="5410788">)</span>&nbsp;<span class="ident" id="5410790">DataOffset</span><span class="op" id="5410800">(</span><span class="op" id="5410801">)</span>&nbsp;<span class="op" id="5410803">(</span><span class="ident" id="5410804">offset</span>&nbsp;<span class="builtintype" id="5410811">int64</span><span class="op" id="5410816">,</span>&nbsp;<span class="ident" id="5410818">err</span>&nbsp;<span class="builtintype" id="5410822">error</span><span class="op" id="5410827">)</span>&nbsp;<span class="op" id="5410829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5410832">bodyOffset</span><span class="op" id="5410842">,</span>&nbsp;<span class="ident" id="5410844">err</span>&nbsp;<span class="op" id="5410848">:=</span>&nbsp;<span class="ident" id="5410851">f</span><span class="op" id="5410852">.</span><span class="ident" id="5410853">findBodyOffset</span><span class="op" id="5410867">(</span><span class="op" id="5410868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410871">if</span>&nbsp;<span class="ident" id="5410874">err</span>&nbsp;<span class="op" id="5410878">!=</span>&nbsp;<span class="builtintype" id="5410881">nil</span>&nbsp;<span class="op" id="5410885">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410889">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5410897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410900">return</span>&nbsp;<span class="ident" id="5410907">f</span><span class="op" id="5410908">.</span><span class="ident" id="5410909">headerOffset</span>&nbsp;<span class="op" id="5410922">+</span>&nbsp;<span class="ident" id="5410924">bodyOffset</span><span class="op" id="5410934">,</span>&nbsp;<span class="builtintype" id="5410936">nil</span><br>
<span class="lineno"></span><span class="op" id="5410940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5410943">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="5411017">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="5411061">func</span>&nbsp;<span class="op" id="5411066">(</span><span class="ident" id="5411067">f</span>&nbsp;<span class="op" id="5411069">*</span><span class="ident" id="5411070">File</span><span class="op" id="5411074">)</span>&nbsp;<span class="ident" id="5411076">Open</span><span class="op" id="5411080">(</span><span class="op" id="5411081">)</span>&nbsp;<span class="op" id="5411083">(</span><span class="ident" id="5411084">rc</span>&nbsp;<span class="ident" id="5411087">io</span><span class="op" id="5411089">.</span><span class="ident" id="5411090">ReadCloser</span><span class="op" id="5411100">,</span>&nbsp;<span class="ident" id="5411102">err</span>&nbsp;<span class="builtintype" id="5411106">error</span><span class="op" id="5411111">)</span>&nbsp;<span class="op" id="5411113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411116">bodyOffset</span><span class="op" id="5411126">,</span>&nbsp;<span class="ident" id="5411128">err</span>&nbsp;<span class="op" id="5411132">:=</span>&nbsp;<span class="ident" id="5411135">f</span><span class="op" id="5411136">.</span><span class="ident" id="5411137">findBodyOffset</span><span class="op" id="5411151">(</span><span class="op" id="5411152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411155">if</span>&nbsp;<span class="ident" id="5411158">err</span>&nbsp;<span class="op" id="5411162">!=</span>&nbsp;<span class="builtintype" id="5411165">nil</span>&nbsp;<span class="op" id="5411169">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411173">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5411181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411184">size</span>&nbsp;<span class="op" id="5411189">:=</span>&nbsp;<span class="builtintype" id="5411192">int64</span><span class="op" id="5411197">(</span><span class="ident" id="5411198">f</span><span class="op" id="5411199">.</span><span class="ident" id="5411200">CompressedSize64</span><span class="op" id="5411216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411219">r</span>&nbsp;<span class="op" id="5411221">:=</span>&nbsp;<span class="ident" id="5411224">io</span><span class="op" id="5411226">.</span><span class="ident" id="5411227">NewSectionReader</span><span class="op" id="5411243">(</span><span class="ident" id="5411244">f</span><span class="op" id="5411245">.</span><span class="ident" id="5411246">zipr</span><span class="op" id="5411250">,</span>&nbsp;<span class="ident" id="5411252">f</span><span class="op" id="5411253">.</span><span class="ident" id="5411254">headerOffset</span><span class="op" id="5411266">+</span><span class="ident" id="5411267">bodyOffset</span><span class="op" id="5411277">,</span>&nbsp;<span class="ident" id="5411279">size</span><span class="op" id="5411283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411286">dcomp</span>&nbsp;<span class="op" id="5411292">:=</span>&nbsp;<span class="ident" id="5411295">decompressor</span><span class="op" id="5411307">(</span><span class="ident" id="5411308">f</span><span class="op" id="5411309">.</span><span class="ident" id="5411310">Method</span><span class="op" id="5411316">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411319">if</span>&nbsp;<span class="ident" id="5411322">dcomp</span>&nbsp;<span class="op" id="5411328">==</span>&nbsp;<span class="builtintype" id="5411331">nil</span>&nbsp;<span class="op" id="5411335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411339">err</span>&nbsp;<span class="op" id="5411343">=</span>&nbsp;<span class="ident" id="5411345">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411360">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5411368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411371">rc</span>&nbsp;<span class="op" id="5411374">=</span>&nbsp;<span class="ident" id="5411376">dcomp</span><span class="op" id="5411381">(</span><span class="ident" id="5411382">r</span><span class="op" id="5411383">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411386">var</span>&nbsp;<span class="ident" id="5411390">desr</span>&nbsp;<span class="ident" id="5411395">io</span><span class="op" id="5411397">.</span><span class="ident" id="5411398">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411406">if</span>&nbsp;<span class="ident" id="5411409">f</span><span class="op" id="5411410">.</span><span class="ident" id="5411411">hasDataDescriptor</span><span class="op" id="5411428">(</span><span class="op" id="5411429">)</span>&nbsp;<span class="op" id="5411431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411435">desr</span>&nbsp;<span class="op" id="5411440">=</span>&nbsp;<span class="ident" id="5411442">io</span><span class="op" id="5411444">.</span><span class="ident" id="5411445">NewSectionReader</span><span class="op" id="5411461">(</span><span class="ident" id="5411462">f</span><span class="op" id="5411463">.</span><span class="ident" id="5411464">zipr</span><span class="op" id="5411468">,</span>&nbsp;<span class="ident" id="5411470">f</span><span class="op" id="5411471">.</span><span class="ident" id="5411472">headerOffset</span><span class="op" id="5411484">+</span><span class="ident" id="5411485">bodyOffset</span><span class="op" id="5411495">+</span><span class="ident" id="5411496">size</span><span class="op" id="5411500">,</span>&nbsp;<span class="ident" id="5411502">dataDescriptorLen</span><span class="op" id="5411519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5411522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411525">rc</span>&nbsp;<span class="op" id="5411528">=</span>&nbsp;<span class="op" id="5411530">&amp;</span><span class="ident" id="5411531">checksumReader</span><span class="op" id="5411545">{</span><span class="ident" id="5411546">rc</span><span class="op" id="5411548">,</span>&nbsp;<span class="ident" id="5411550">crc32</span><span class="op" id="5411555">.</span><span class="ident" id="5411556">NewIEEE</span><span class="op" id="5411563">(</span><span class="op" id="5411564">)</span><span class="op" id="5411565">,</span>&nbsp;<span class="ident" id="5411567">f</span><span class="op" id="5411568">,</span>&nbsp;<span class="ident" id="5411570">desr</span><span class="op" id="5411574">,</span>&nbsp;<span class="builtintype" id="5411576">nil</span><span class="op" id="5411579">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411582">return</span><br>
<span class="lineno"></span><span class="op" id="5411589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5411592">type</span>&nbsp;<span class="ident" id="5411597">checksumReader</span>&nbsp;<span class="keyword" id="5411612">struct</span>&nbsp;<span class="op" id="5411619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411622">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5411627">io</span><span class="op" id="5411629">.</span><span class="ident" id="5411630">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411642">hash</span>&nbsp;<span class="ident" id="5411647">hash</span><span class="op" id="5411651">.</span><span class="ident" id="5411652">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411660">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5411665">*</span><span class="ident" id="5411666">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411672">desr</span>&nbsp;<span class="ident" id="5411677">io</span><span class="op" id="5411679">.</span><span class="ident" id="5411680">Reader</span>&nbsp;<span class="comment" id="5411687">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411737">err</span>&nbsp;&nbsp;<span class="builtintype" id="5411742">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5411752">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="5411768">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="5411771">func</span>&nbsp;<span class="op" id="5411776">(</span><span class="ident" id="5411777">r</span>&nbsp;<span class="op" id="5411779">*</span><span class="ident" id="5411780">checksumReader</span><span class="op" id="5411794">)</span>&nbsp;<span class="ident" id="5411796">Read</span><span class="op" id="5411800">(</span><span class="ident" id="5411801">b</span>&nbsp;<span class="op" id="5411803">[</span><span class="op" id="5411804">]</span><span class="builtintype" id="5411805">byte</span><span class="op" id="5411809">)</span>&nbsp;<span class="op" id="5411811">(</span><span class="ident" id="5411812">n</span>&nbsp;<span class="builtintype" id="5411814">int</span><span class="op" id="5411817">,</span>&nbsp;<span class="ident" id="5411819">err</span>&nbsp;<span class="builtintype" id="5411823">error</span><span class="op" id="5411828">)</span>&nbsp;<span class="op" id="5411830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411833">if</span>&nbsp;<span class="ident" id="5411836">r</span><span class="op" id="5411837">.</span><span class="ident" id="5411838">err</span>&nbsp;<span class="op" id="5411842">!=</span>&nbsp;<span class="builtintype" id="5411845">nil</span>&nbsp;<span class="op" id="5411849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411853">return</span>&nbsp;<span class="num" id="5411860">0</span><span class="op" id="5411861">,</span>&nbsp;<span class="ident" id="5411863">r</span><span class="op" id="5411864">.</span><span class="ident" id="5411865">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5411870">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411873">n</span><span class="op" id="5411874">,</span>&nbsp;<span class="ident" id="5411876">err</span>&nbsp;<span class="op" id="5411880">=</span>&nbsp;<span class="ident" id="5411882">r</span><span class="op" id="5411883">.</span><span class="ident" id="5411884">rc</span><span class="op" id="5411886">.</span><span class="ident" id="5411887">Read</span><span class="op" id="5411891">(</span><span class="ident" id="5411892">b</span><span class="op" id="5411893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411896">r</span><span class="op" id="5411897">.</span><span class="ident" id="5411898">hash</span><span class="op" id="5411902">.</span><span class="ident" id="5411903">Write</span><span class="op" id="5411908">(</span><span class="ident" id="5411909">b</span><span class="op" id="5411910">[</span><span class="op" id="5411911">:</span><span class="ident" id="5411912">n</span><span class="op" id="5411913">]</span><span class="op" id="5411914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411917">if</span>&nbsp;<span class="ident" id="5411920">err</span>&nbsp;<span class="op" id="5411924">==</span>&nbsp;<span class="builtintype" id="5411927">nil</span>&nbsp;<span class="op" id="5411931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411935">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5411943">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411946">if</span>&nbsp;<span class="ident" id="5411949">err</span>&nbsp;<span class="op" id="5411953">==</span>&nbsp;<span class="ident" id="5411956">io</span><span class="op" id="5411958">.</span><span class="ident" id="5411959">EOF</span>&nbsp;<span class="op" id="5411963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411967">if</span>&nbsp;<span class="ident" id="5411970">r</span><span class="op" id="5411971">.</span><span class="ident" id="5411972">desr</span>&nbsp;<span class="op" id="5411977">!=</span>&nbsp;<span class="builtintype" id="5411980">nil</span>&nbsp;<span class="op" id="5411984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411989">if</span>&nbsp;<span class="ident" id="5411992">err1</span>&nbsp;<span class="op" id="5411997">:=</span>&nbsp;<span class="ident" id="5412000">readDataDescriptor</span><span class="op" id="5412018">(</span><span class="ident" id="5412019">r</span><span class="op" id="5412020">.</span><span class="ident" id="5412021">desr</span><span class="op" id="5412025">,</span>&nbsp;<span class="ident" id="5412027">r</span><span class="op" id="5412028">.</span><span class="ident" id="5412029">f</span><span class="op" id="5412030">)</span><span class="op" id="5412031">;</span>&nbsp;<span class="ident" id="5412033">err1</span>&nbsp;<span class="op" id="5412038">!=</span>&nbsp;<span class="builtintype" id="5412041">nil</span>&nbsp;<span class="op" id="5412045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5412051">err</span>&nbsp;<span class="op" id="5412055">=</span>&nbsp;<span class="ident" id="5412057">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5412065">}</span>&nbsp;<span class="keyword" id="5412067">else</span>&nbsp;<span class="keyword" id="5412072">if</span>&nbsp;<span class="ident" id="5412075">r</span><span class="op" id="5412076">.</span><span class="ident" id="5412077">hash</span><span class="op" id="5412081">.</span><span class="ident" id="5412082">Sum32</span><span class="op" id="5412087">(</span><span class="op" id="5412088">)</span>&nbsp;<span class="op" id="5412090">!=</span>&nbsp;<span class="ident" id="5412093">r</span><span class="op" id="5412094">.</span><span class="ident" id="5412095">f</span><span class="op" id="5412096">.</span><span class="ident" id="5412097">CRC32</span>&nbsp;<span class="op" id="5412103">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5412109">err</span>&nbsp;<span class="op" id="5412113">=</span>&nbsp;<span class="ident" id="5412115">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5412130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5412134">}</span>&nbsp;<span class="keyword" id="5412136">else</span>&nbsp;<span class="op" id="5412141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5412146">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5412203">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5412262">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5412313">if</span>&nbsp;<span class="ident" id="5412316">r</span><span class="op" id="5412317">.</span><span class="ident" id="5412318">f</span><span class="op" id="5412319">.</span><span class="ident" id="5412320">CRC32</span>&nbsp;<span class="op" id="5412326">!=</span>&nbsp;<span class="num" id="5412329">0</span>&nbsp;<span class="op" id="5412331">&amp;&amp;</span>&nbsp;<span class="ident" id="5412334">r</span><span class="op" id="5412335">.</span><span class="ident" id="5412336">hash</span><span class="op" id="5412340">.</span><span class="ident" id="5412341">Sum32</span><span class="op" id="5412346">(</span><span class="op" id="5412347">)</span>&nbsp;<span class="op" id="5412349">!=</span>&nbsp;<span class="ident" id="5412352">r</span><span class="op" id="5412353">.</span><span class="ident" id="5412354">f</span><span class="op" id="5412355">.</span><span class="ident" id="5412356">CRC32</span>&nbsp;<span class="op" id="5412362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5412368">err</span>&nbsp;<span class="op" id="5412372">=</span>&nbsp;<span class="ident" id="5412374">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5412389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5412393">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5412396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5412399">r</span><span class="op" id="5412400">.</span><span class="ident" id="5412401">err</span>&nbsp;<span class="op" id="5412405">=</span>&nbsp;<span class="ident" id="5412407">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5412412">return</span><br>
<span class="lineno"></span><span class="op" id="5412419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5412422">func</span>&nbsp;<span class="op" id="5412427">(</span><span class="ident" id="5412428">r</span>&nbsp;<span class="op" id="5412430">*</span><span class="ident" id="5412431">checksumReader</span><span class="op" id="5412445">)</span>&nbsp;<span class="ident" id="5412447">Close</span><span class="op" id="5412452">(</span><span class="op" id="5412453">)</span>&nbsp;<span class="builtintype" id="5412455">error</span>&nbsp;<span class="op" id="5412461">{</span>&nbsp;<span class="keyword" id="5412463">return</span>&nbsp;<span class="ident" id="5412470">r</span><span class="op" id="5412471">.</span><span class="ident" id="5412472">rc</span><span class="op" id="5412474">.</span><span class="ident" id="5412475">Close</span><span class="op" id="5412480">(</span><span class="op" id="5412481">)</span>&nbsp;<span class="op" id="5412483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5412486">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5412558">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="5412595">func</span>&nbsp;<span class="op" id="5412600">(</span><span class="ident" id="5412601">f</span>&nbsp;<span class="op" id="5412603">*</span><span class="ident" id="5412604">File</span><span class="op" id="5412608">)</span>&nbsp;<span class="ident" id="5412610">findBodyOffset</span><span class="op" id="5412624">(</span><span class="op" id="5412625">)</span>&nbsp;<span class="op" id="5412627">(</span><span class="builtintype" id="5412628">int64</span><span class="op" id="5412633">,</span>&nbsp;<span class="builtintype" id="5412635">error</span><span class="op" id="5412640">)</span>&nbsp;<span class="op" id="5412642">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5412645">var</span>&nbsp;<span class="ident" id="5412649">buf</span>&nbsp;<span class="op" id="5412653">[</span><span class="ident" id="5412654">fileHeaderLen</span><span class="op" id="5412667">]</span><span class="builtintype" id="5412668">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5412674">if</span>&nbsp;<span class="ident" id="5412677">_</span><span class="op" id="5412678">,</span>&nbsp;<span class="ident" id="5412680">err</span>&nbsp;<span class="op" id="5412684">:=</span>&nbsp;<span class="ident" id="5412687">f</span><span class="op" id="5412688">.</span><span class="ident" id="5412689">zipr</span><span class="op" id="5412693">.</span><span class="ident" id="5412694">ReadAt</span><span class="op" id="5412700">(</span><span class="ident" id="5412701">buf</span><span class="op" id="5412704">[</span><span class="op" id="5412705">:</span><span class="op" id="5412706">]</span><span class="op" id="5412707">,</span>&nbsp;<span class="ident" id="5412709">f</span><span class="op" id="5412710">.</span><span class="ident" id="5412711">headerOffset</span><span class="op" id="5412723">)</span><span class="op" id="5412724">;</span>&nbsp;<span class="ident" id="5412726">err</span>&nbsp;<span class="op" id="5412730">!=</span>&nbsp;<span class="builtintype" id="5412733">nil</span>&nbsp;<span class="op" id="5412737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5412741">return</span>&nbsp;<span class="num" id="5412748">0</span><span class="op" id="5412749">,</span>&nbsp;<span class="ident" id="5412751">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5412756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5412759">b</span>&nbsp;<span class="op" id="5412761">:=</span>&nbsp;<span class="ident" id="5412764">readBuf</span><span class="op" id="5412771">(</span><span class="ident" id="5412772">buf</span><span class="op" id="5412775">[</span><span class="op" id="5412776">:</span><span class="op" id="5412777">]</span><span class="op" id="5412778">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5412781">if</span>&nbsp;<span class="ident" id="5412784">sig</span>&nbsp;<span class="op" id="5412788">:=</span>&nbsp;<span class="ident" id="5412791">b</span><span class="op" id="5412792">.</span><span class="builtintype" id="5412793">uint32</span><span class="op" id="5412799">(</span><span class="op" id="5412800">)</span><span class="op" id="5412801">;</span>&nbsp;<span class="ident" id="5412803">sig</span>&nbsp;<span class="op" id="5412807">!=</span>&nbsp;<span class="ident" id="5412810">fileHeaderSignature</span>&nbsp;<span class="op" id="5412830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5412834">return</span>&nbsp;<span class="num" id="5412841">0</span><span class="op" id="5412842">,</span>&nbsp;<span class="ident" id="5412844">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5412855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5412858">b</span>&nbsp;<span class="op" id="5412860">=</span>&nbsp;<span class="ident" id="5412862">b</span><span class="op" id="5412863">[</span><span class="num" id="5412864">22</span><span class="op" id="5412866">:</span><span class="op" id="5412867">]</span>&nbsp;<span class="comment" id="5412869">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5412902">filenameLen</span>&nbsp;<span class="op" id="5412914">:=</span>&nbsp;<span class="builtintype" id="5412917">int</span><span class="op" id="5412920">(</span><span class="ident" id="5412921">b</span><span class="op" id="5412922">.</span><span class="builtintype" id="5412923">uint16</span><span class="op" id="5412929">(</span><span class="op" id="5412930">)</span><span class="op" id="5412931">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5412934">extraLen</span>&nbsp;<span class="op" id="5412943">:=</span>&nbsp;<span class="builtintype" id="5412946">int</span><span class="op" id="5412949">(</span><span class="ident" id="5412950">b</span><span class="op" id="5412951">.</span><span class="builtintype" id="5412952">uint16</span><span class="op" id="5412958">(</span><span class="op" id="5412959">)</span><span class="op" id="5412960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5412963">return</span>&nbsp;<span class="builtintype" id="5412970">int64</span><span class="op" id="5412975">(</span><span class="ident" id="5412976">fileHeaderLen</span>&nbsp;<span class="op" id="5412990">+</span>&nbsp;<span class="ident" id="5412992">filenameLen</span>&nbsp;<span class="op" id="5413004">+</span>&nbsp;<span class="ident" id="5413006">extraLen</span><span class="op" id="5413014">)</span><span class="op" id="5413015">,</span>&nbsp;<span class="builtintype" id="5413017">nil</span><br>
<span class="lineno"></span><span class="op" id="5413021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5413024">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="5413091">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="5413162">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="5413224">func</span>&nbsp;<span class="ident" id="5413229">readDirectoryHeader</span><span class="op" id="5413248">(</span><span class="ident" id="5413249">f</span>&nbsp;<span class="op" id="5413251">*</span><span class="ident" id="5413252">File</span><span class="op" id="5413256">,</span>&nbsp;<span class="ident" id="5413258">r</span>&nbsp;<span class="ident" id="5413260">io</span><span class="op" id="5413262">.</span><span class="ident" id="5413263">Reader</span><span class="op" id="5413269">)</span>&nbsp;<span class="builtintype" id="5413271">error</span>&nbsp;<span class="op" id="5413277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5413280">var</span>&nbsp;<span class="ident" id="5413284">buf</span>&nbsp;<span class="op" id="5413288">[</span><span class="ident" id="5413289">directoryHeaderLen</span><span class="op" id="5413307">]</span><span class="builtintype" id="5413308">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5413314">if</span>&nbsp;<span class="ident" id="5413317">_</span><span class="op" id="5413318">,</span>&nbsp;<span class="ident" id="5413320">err</span>&nbsp;<span class="op" id="5413324">:=</span>&nbsp;<span class="ident" id="5413327">io</span><span class="op" id="5413329">.</span><span class="ident" id="5413330">ReadFull</span><span class="op" id="5413338">(</span><span class="ident" id="5413339">r</span><span class="op" id="5413340">,</span>&nbsp;<span class="ident" id="5413342">buf</span><span class="op" id="5413345">[</span><span class="op" id="5413346">:</span><span class="op" id="5413347">]</span><span class="op" id="5413348">)</span><span class="op" id="5413349">;</span>&nbsp;<span class="ident" id="5413351">err</span>&nbsp;<span class="op" id="5413355">!=</span>&nbsp;<span class="builtintype" id="5413358">nil</span>&nbsp;<span class="op" id="5413362">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5413366">return</span>&nbsp;<span class="ident" id="5413373">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5413378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413381">b</span>&nbsp;<span class="op" id="5413383">:=</span>&nbsp;<span class="ident" id="5413386">readBuf</span><span class="op" id="5413393">(</span><span class="ident" id="5413394">buf</span><span class="op" id="5413397">[</span><span class="op" id="5413398">:</span><span class="op" id="5413399">]</span><span class="op" id="5413400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5413403">if</span>&nbsp;<span class="ident" id="5413406">sig</span>&nbsp;<span class="op" id="5413410">:=</span>&nbsp;<span class="ident" id="5413413">b</span><span class="op" id="5413414">.</span><span class="builtintype" id="5413415">uint32</span><span class="op" id="5413421">(</span><span class="op" id="5413422">)</span><span class="op" id="5413423">;</span>&nbsp;<span class="ident" id="5413425">sig</span>&nbsp;<span class="op" id="5413429">!=</span>&nbsp;<span class="ident" id="5413432">directoryHeaderSignature</span>&nbsp;<span class="op" id="5413457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5413461">return</span>&nbsp;<span class="ident" id="5413468">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5413479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413482">f</span><span class="op" id="5413483">.</span><span class="ident" id="5413484">CreatorVersion</span>&nbsp;<span class="op" id="5413499">=</span>&nbsp;<span class="ident" id="5413501">b</span><span class="op" id="5413502">.</span><span class="builtintype" id="5413503">uint16</span><span class="op" id="5413509">(</span><span class="op" id="5413510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413513">f</span><span class="op" id="5413514">.</span><span class="ident" id="5413515">ReaderVersion</span>&nbsp;<span class="op" id="5413529">=</span>&nbsp;<span class="ident" id="5413531">b</span><span class="op" id="5413532">.</span><span class="builtintype" id="5413533">uint16</span><span class="op" id="5413539">(</span><span class="op" id="5413540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413543">f</span><span class="op" id="5413544">.</span><span class="ident" id="5413545">Flags</span>&nbsp;<span class="op" id="5413551">=</span>&nbsp;<span class="ident" id="5413553">b</span><span class="op" id="5413554">.</span><span class="builtintype" id="5413555">uint16</span><span class="op" id="5413561">(</span><span class="op" id="5413562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413565">f</span><span class="op" id="5413566">.</span><span class="ident" id="5413567">Method</span>&nbsp;<span class="op" id="5413574">=</span>&nbsp;<span class="ident" id="5413576">b</span><span class="op" id="5413577">.</span><span class="builtintype" id="5413578">uint16</span><span class="op" id="5413584">(</span><span class="op" id="5413585">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413588">f</span><span class="op" id="5413589">.</span><span class="ident" id="5413590">ModifiedTime</span>&nbsp;<span class="op" id="5413603">=</span>&nbsp;<span class="ident" id="5413605">b</span><span class="op" id="5413606">.</span><span class="builtintype" id="5413607">uint16</span><span class="op" id="5413613">(</span><span class="op" id="5413614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413617">f</span><span class="op" id="5413618">.</span><span class="ident" id="5413619">ModifiedDate</span>&nbsp;<span class="op" id="5413632">=</span>&nbsp;<span class="ident" id="5413634">b</span><span class="op" id="5413635">.</span><span class="builtintype" id="5413636">uint16</span><span class="op" id="5413642">(</span><span class="op" id="5413643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413646">f</span><span class="op" id="5413647">.</span><span class="ident" id="5413648">CRC32</span>&nbsp;<span class="op" id="5413654">=</span>&nbsp;<span class="ident" id="5413656">b</span><span class="op" id="5413657">.</span><span class="builtintype" id="5413658">uint32</span><span class="op" id="5413664">(</span><span class="op" id="5413665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413668">f</span><span class="op" id="5413669">.</span><span class="ident" id="5413670">CompressedSize</span>&nbsp;<span class="op" id="5413685">=</span>&nbsp;<span class="ident" id="5413687">b</span><span class="op" id="5413688">.</span><span class="builtintype" id="5413689">uint32</span><span class="op" id="5413695">(</span><span class="op" id="5413696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413699">f</span><span class="op" id="5413700">.</span><span class="ident" id="5413701">UncompressedSize</span>&nbsp;<span class="op" id="5413718">=</span>&nbsp;<span class="ident" id="5413720">b</span><span class="op" id="5413721">.</span><span class="builtintype" id="5413722">uint32</span><span class="op" id="5413728">(</span><span class="op" id="5413729">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413732">f</span><span class="op" id="5413733">.</span><span class="ident" id="5413734">CompressedSize64</span>&nbsp;<span class="op" id="5413751">=</span>&nbsp;<span class="builtintype" id="5413753">uint64</span><span class="op" id="5413759">(</span><span class="ident" id="5413760">f</span><span class="op" id="5413761">.</span><span class="ident" id="5413762">CompressedSize</span><span class="op" id="5413776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413779">f</span><span class="op" id="5413780">.</span><span class="ident" id="5413781">UncompressedSize64</span>&nbsp;<span class="op" id="5413800">=</span>&nbsp;<span class="builtintype" id="5413802">uint64</span><span class="op" id="5413808">(</span><span class="ident" id="5413809">f</span><span class="op" id="5413810">.</span><span class="ident" id="5413811">UncompressedSize</span><span class="op" id="5413827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413830">filenameLen</span>&nbsp;<span class="op" id="5413842">:=</span>&nbsp;<span class="builtintype" id="5413845">int</span><span class="op" id="5413848">(</span><span class="ident" id="5413849">b</span><span class="op" id="5413850">.</span><span class="builtintype" id="5413851">uint16</span><span class="op" id="5413857">(</span><span class="op" id="5413858">)</span><span class="op" id="5413859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413862">extraLen</span>&nbsp;<span class="op" id="5413871">:=</span>&nbsp;<span class="builtintype" id="5413874">int</span><span class="op" id="5413877">(</span><span class="ident" id="5413878">b</span><span class="op" id="5413879">.</span><span class="builtintype" id="5413880">uint16</span><span class="op" id="5413886">(</span><span class="op" id="5413887">)</span><span class="op" id="5413888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413891">commentLen</span>&nbsp;<span class="op" id="5413902">:=</span>&nbsp;<span class="builtintype" id="5413905">int</span><span class="op" id="5413908">(</span><span class="ident" id="5413909">b</span><span class="op" id="5413910">.</span><span class="builtintype" id="5413911">uint16</span><span class="op" id="5413917">(</span><span class="op" id="5413918">)</span><span class="op" id="5413919">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413922">b</span>&nbsp;<span class="op" id="5413924">=</span>&nbsp;<span class="ident" id="5413926">b</span><span class="op" id="5413927">[</span><span class="num" id="5413928">4</span><span class="op" id="5413929">:</span><span class="op" id="5413930">]</span>&nbsp;<span class="comment" id="5413932">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413998">f</span><span class="op" id="5413999">.</span><span class="ident" id="5414000">ExternalAttrs</span>&nbsp;<span class="op" id="5414014">=</span>&nbsp;<span class="ident" id="5414016">b</span><span class="op" id="5414017">.</span><span class="builtintype" id="5414018">uint32</span><span class="op" id="5414024">(</span><span class="op" id="5414025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414028">f</span><span class="op" id="5414029">.</span><span class="ident" id="5414030">headerOffset</span>&nbsp;<span class="op" id="5414043">=</span>&nbsp;<span class="builtintype" id="5414045">int64</span><span class="op" id="5414050">(</span><span class="ident" id="5414051">b</span><span class="op" id="5414052">.</span><span class="builtintype" id="5414053">uint32</span><span class="op" id="5414059">(</span><span class="op" id="5414060">)</span><span class="op" id="5414061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414064">d</span>&nbsp;<span class="op" id="5414066">:=</span>&nbsp;<span class="builtinfunc" id="5414069">make</span><span class="op" id="5414073">(</span><span class="op" id="5414074">[</span><span class="op" id="5414075">]</span><span class="builtintype" id="5414076">byte</span><span class="op" id="5414080">,</span>&nbsp;<span class="ident" id="5414082">filenameLen</span><span class="op" id="5414093">+</span><span class="ident" id="5414094">extraLen</span><span class="op" id="5414102">+</span><span class="ident" id="5414103">commentLen</span><span class="op" id="5414113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5414116">if</span>&nbsp;<span class="ident" id="5414119">_</span><span class="op" id="5414120">,</span>&nbsp;<span class="ident" id="5414122">err</span>&nbsp;<span class="op" id="5414126">:=</span>&nbsp;<span class="ident" id="5414129">io</span><span class="op" id="5414131">.</span><span class="ident" id="5414132">ReadFull</span><span class="op" id="5414140">(</span><span class="ident" id="5414141">r</span><span class="op" id="5414142">,</span>&nbsp;<span class="ident" id="5414144">d</span><span class="op" id="5414145">)</span><span class="op" id="5414146">;</span>&nbsp;<span class="ident" id="5414148">err</span>&nbsp;<span class="op" id="5414152">!=</span>&nbsp;<span class="builtintype" id="5414155">nil</span>&nbsp;<span class="op" id="5414159">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5414163">return</span>&nbsp;<span class="ident" id="5414170">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5414175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414178">f</span><span class="op" id="5414179">.</span><span class="ident" id="5414180">Name</span>&nbsp;<span class="op" id="5414185">=</span>&nbsp;<span class="builtintype" id="5414187">string</span><span class="op" id="5414193">(</span><span class="ident" id="5414194">d</span><span class="op" id="5414195">[</span><span class="op" id="5414196">:</span><span class="ident" id="5414197">filenameLen</span><span class="op" id="5414208">]</span><span class="op" id="5414209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414212">f</span><span class="op" id="5414213">.</span><span class="ident" id="5414214">Extra</span>&nbsp;<span class="op" id="5414220">=</span>&nbsp;<span class="ident" id="5414222">d</span><span class="op" id="5414223">[</span><span class="ident" id="5414224">filenameLen</span>&nbsp;<span class="op" id="5414236">:</span>&nbsp;<span class="ident" id="5414238">filenameLen</span><span class="op" id="5414249">+</span><span class="ident" id="5414250">extraLen</span><span class="op" id="5414258">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414261">f</span><span class="op" id="5414262">.</span><span class="ident" id="5414263">Comment</span>&nbsp;<span class="op" id="5414271">=</span>&nbsp;<span class="builtintype" id="5414273">string</span><span class="op" id="5414279">(</span><span class="ident" id="5414280">d</span><span class="op" id="5414281">[</span><span class="ident" id="5414282">filenameLen</span><span class="op" id="5414293">+</span><span class="ident" id="5414294">extraLen</span><span class="op" id="5414302">:</span><span class="op" id="5414303">]</span><span class="op" id="5414304">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5414308">if</span>&nbsp;<span class="builtinfunc" id="5414311">len</span><span class="op" id="5414314">(</span><span class="ident" id="5414315">f</span><span class="op" id="5414316">.</span><span class="ident" id="5414317">Extra</span><span class="op" id="5414322">)</span>&nbsp;<span class="op" id="5414324">&gt;</span>&nbsp;<span class="num" id="5414326">0</span>&nbsp;<span class="op" id="5414328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414332">b</span>&nbsp;<span class="op" id="5414334">:=</span>&nbsp;<span class="ident" id="5414337">readBuf</span><span class="op" id="5414344">(</span><span class="ident" id="5414345">f</span><span class="op" id="5414346">.</span><span class="ident" id="5414347">Extra</span><span class="op" id="5414352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5414356">for</span>&nbsp;<span class="builtinfunc" id="5414360">len</span><span class="op" id="5414363">(</span><span class="ident" id="5414364">b</span><span class="op" id="5414365">)</span>&nbsp;<span class="op" id="5414367">&gt;=</span>&nbsp;<span class="num" id="5414370">4</span>&nbsp;<span class="op" id="5414372">{</span>&nbsp;<span class="comment" id="5414374">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414407">tag</span>&nbsp;<span class="op" id="5414411">:=</span>&nbsp;<span class="ident" id="5414414">b</span><span class="op" id="5414415">.</span><span class="builtintype" id="5414416">uint16</span><span class="op" id="5414422">(</span><span class="op" id="5414423">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414428">size</span>&nbsp;<span class="op" id="5414433">:=</span>&nbsp;<span class="ident" id="5414436">b</span><span class="op" id="5414437">.</span><span class="builtintype" id="5414438">uint16</span><span class="op" id="5414444">(</span><span class="op" id="5414445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5414450">if</span>&nbsp;<span class="builtintype" id="5414453">int</span><span class="op" id="5414456">(</span><span class="ident" id="5414457">size</span><span class="op" id="5414461">)</span>&nbsp;<span class="op" id="5414463">&gt;</span>&nbsp;<span class="builtinfunc" id="5414465">len</span><span class="op" id="5414468">(</span><span class="ident" id="5414469">b</span><span class="op" id="5414470">)</span>&nbsp;<span class="op" id="5414472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5414478">return</span>&nbsp;<span class="ident" id="5414485">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5414498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5414503">if</span>&nbsp;<span class="ident" id="5414506">tag</span>&nbsp;<span class="op" id="5414510">==</span>&nbsp;<span class="ident" id="5414513">zip64ExtraId</span>&nbsp;<span class="op" id="5414526">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5414532">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414590">eb</span>&nbsp;<span class="op" id="5414593">:=</span>&nbsp;<span class="ident" id="5414596">readBuf</span><span class="op" id="5414603">(</span><span class="ident" id="5414604">b</span><span class="op" id="5414605">[</span><span class="op" id="5414606">:</span><span class="ident" id="5414607">size</span><span class="op" id="5414611">]</span><span class="op" id="5414612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5414618">if</span>&nbsp;<span class="builtinfunc" id="5414621">len</span><span class="op" id="5414624">(</span><span class="ident" id="5414625">eb</span><span class="op" id="5414627">)</span>&nbsp;<span class="op" id="5414629">&gt;=</span>&nbsp;<span class="num" id="5414632">8</span>&nbsp;<span class="op" id="5414634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414641">f</span><span class="op" id="5414642">.</span><span class="ident" id="5414643">UncompressedSize64</span>&nbsp;<span class="op" id="5414662">=</span>&nbsp;<span class="ident" id="5414664">eb</span><span class="op" id="5414666">.</span><span class="builtintype" id="5414667">uint64</span><span class="op" id="5414673">(</span><span class="op" id="5414674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5414680">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5414686">if</span>&nbsp;<span class="builtinfunc" id="5414689">len</span><span class="op" id="5414692">(</span><span class="ident" id="5414693">eb</span><span class="op" id="5414695">)</span>&nbsp;<span class="op" id="5414697">&gt;=</span>&nbsp;<span class="num" id="5414700">8</span>&nbsp;<span class="op" id="5414702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414709">f</span><span class="op" id="5414710">.</span><span class="ident" id="5414711">CompressedSize64</span>&nbsp;<span class="op" id="5414728">=</span>&nbsp;<span class="ident" id="5414730">eb</span><span class="op" id="5414732">.</span><span class="builtintype" id="5414733">uint64</span><span class="op" id="5414739">(</span><span class="op" id="5414740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5414746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5414752">if</span>&nbsp;<span class="builtinfunc" id="5414755">len</span><span class="op" id="5414758">(</span><span class="ident" id="5414759">eb</span><span class="op" id="5414761">)</span>&nbsp;<span class="op" id="5414763">&gt;=</span>&nbsp;<span class="num" id="5414766">8</span>&nbsp;<span class="op" id="5414768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414775">f</span><span class="op" id="5414776">.</span><span class="ident" id="5414777">headerOffset</span>&nbsp;<span class="op" id="5414790">=</span>&nbsp;<span class="builtintype" id="5414792">int64</span><span class="op" id="5414797">(</span><span class="ident" id="5414798">eb</span><span class="op" id="5414800">.</span><span class="builtintype" id="5414801">uint64</span><span class="op" id="5414807">(</span><span class="op" id="5414808">)</span><span class="op" id="5414809">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5414815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5414820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5414825">b</span>&nbsp;<span class="op" id="5414827">=</span>&nbsp;<span class="ident" id="5414829">b</span><span class="op" id="5414830">[</span><span class="ident" id="5414831">size</span><span class="op" id="5414835">:</span><span class="op" id="5414836">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5414840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5414844">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5414888">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5414945">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5414998">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5415035">for</span>&nbsp;<span class="ident" id="5415039">_</span><span class="op" id="5415040">,</span>&nbsp;<span class="ident" id="5415042">v</span>&nbsp;<span class="op" id="5415044">:=</span>&nbsp;<span class="keyword" id="5415047">range</span>&nbsp;<span class="ident" id="5415053">b</span>&nbsp;<span class="op" id="5415055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5415060">if</span>&nbsp;<span class="ident" id="5415063">v</span>&nbsp;<span class="op" id="5415065">!=</span>&nbsp;<span class="num" id="5415068">0</span>&nbsp;<span class="op" id="5415070">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5415076">return</span>&nbsp;<span class="ident" id="5415083">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5415096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5415100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5415103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5415106">return</span>&nbsp;<span class="builtintype" id="5415113">nil</span><br>
<span class="lineno">280</span><span class="op" id="5415117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5415120">func</span>&nbsp;<span class="ident" id="5415125">readDataDescriptor</span><span class="op" id="5415143">(</span><span class="ident" id="5415144">r</span>&nbsp;<span class="ident" id="5415146">io</span><span class="op" id="5415148">.</span><span class="ident" id="5415149">Reader</span><span class="op" id="5415155">,</span>&nbsp;<span class="ident" id="5415157">f</span>&nbsp;<span class="op" id="5415159">*</span><span class="ident" id="5415160">File</span><span class="op" id="5415164">)</span>&nbsp;<span class="builtintype" id="5415166">error</span>&nbsp;<span class="op" id="5415172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5415175">var</span>&nbsp;<span class="ident" id="5415179">buf</span>&nbsp;<span class="op" id="5415183">[</span><span class="ident" id="5415184">dataDescriptorLen</span><span class="op" id="5415201">]</span><span class="builtintype" id="5415202">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5415209">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5415264">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5415326">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5415383">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5415438">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5415498">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5415562">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5415602">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5415606">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5415667">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5415722">if</span>&nbsp;<span class="ident" id="5415725">_</span><span class="op" id="5415726">,</span>&nbsp;<span class="ident" id="5415728">err</span>&nbsp;<span class="op" id="5415732">:=</span>&nbsp;<span class="ident" id="5415735">io</span><span class="op" id="5415737">.</span><span class="ident" id="5415738">ReadFull</span><span class="op" id="5415746">(</span><span class="ident" id="5415747">r</span><span class="op" id="5415748">,</span>&nbsp;<span class="ident" id="5415750">buf</span><span class="op" id="5415753">[</span><span class="op" id="5415754">:</span><span class="num" id="5415755">4</span><span class="op" id="5415756">]</span><span class="op" id="5415757">)</span><span class="op" id="5415758">;</span>&nbsp;<span class="ident" id="5415760">err</span>&nbsp;<span class="op" id="5415764">!=</span>&nbsp;<span class="builtintype" id="5415767">nil</span>&nbsp;<span class="op" id="5415771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5415775">return</span>&nbsp;<span class="ident" id="5415782">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5415787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5415790">off</span>&nbsp;<span class="op" id="5415794">:=</span>&nbsp;<span class="num" id="5415797">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5415800">maybeSig</span>&nbsp;<span class="op" id="5415809">:=</span>&nbsp;<span class="ident" id="5415812">readBuf</span><span class="op" id="5415819">(</span><span class="ident" id="5415820">buf</span><span class="op" id="5415823">[</span><span class="op" id="5415824">:</span><span class="num" id="5415825">4</span><span class="op" id="5415826">]</span><span class="op" id="5415827">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5415830">if</span>&nbsp;<span class="ident" id="5415833">maybeSig</span><span class="op" id="5415841">.</span><span class="builtintype" id="5415842">uint32</span><span class="op" id="5415848">(</span><span class="op" id="5415849">)</span>&nbsp;<span class="op" id="5415851">!=</span>&nbsp;<span class="ident" id="5415854">dataDescriptorSignature</span>&nbsp;<span class="op" id="5415878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5415882">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5415933">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5415945">off</span>&nbsp;<span class="op" id="5415949">+=</span>&nbsp;<span class="num" id="5415952">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5415955">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5415958">if</span>&nbsp;<span class="ident" id="5415961">_</span><span class="op" id="5415962">,</span>&nbsp;<span class="ident" id="5415964">err</span>&nbsp;<span class="op" id="5415968">:=</span>&nbsp;<span class="ident" id="5415971">io</span><span class="op" id="5415973">.</span><span class="ident" id="5415974">ReadFull</span><span class="op" id="5415982">(</span><span class="ident" id="5415983">r</span><span class="op" id="5415984">,</span>&nbsp;<span class="ident" id="5415986">buf</span><span class="op" id="5415989">[</span><span class="ident" id="5415990">off</span><span class="op" id="5415993">:</span><span class="num" id="5415994">12</span><span class="op" id="5415996">]</span><span class="op" id="5415997">)</span><span class="op" id="5415998">;</span>&nbsp;<span class="ident" id="5416000">err</span>&nbsp;<span class="op" id="5416004">!=</span>&nbsp;<span class="builtintype" id="5416007">nil</span>&nbsp;<span class="op" id="5416011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416015">return</span>&nbsp;<span class="ident" id="5416022">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5416027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5416030">b</span>&nbsp;<span class="op" id="5416032">:=</span>&nbsp;<span class="ident" id="5416035">readBuf</span><span class="op" id="5416042">(</span><span class="ident" id="5416043">buf</span><span class="op" id="5416046">[</span><span class="op" id="5416047">:</span><span class="num" id="5416048">12</span><span class="op" id="5416050">]</span><span class="op" id="5416051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416054">if</span>&nbsp;<span class="ident" id="5416057">b</span><span class="op" id="5416058">.</span><span class="builtintype" id="5416059">uint32</span><span class="op" id="5416065">(</span><span class="op" id="5416066">)</span>&nbsp;<span class="op" id="5416068">!=</span>&nbsp;<span class="ident" id="5416071">f</span><span class="op" id="5416072">.</span><span class="ident" id="5416073">CRC32</span>&nbsp;<span class="op" id="5416079">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416083">return</span>&nbsp;<span class="ident" id="5416090">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5416103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5416107">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5416175">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5416232">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5416296">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5416360">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416384">return</span>&nbsp;<span class="builtintype" id="5416391">nil</span><br>
<span class="lineno">320</span><span class="op" id="5416395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5416398">func</span>&nbsp;<span class="ident" id="5416403">readDirectoryEnd</span><span class="op" id="5416419">(</span><span class="ident" id="5416420">r</span>&nbsp;<span class="ident" id="5416422">io</span><span class="op" id="5416424">.</span><span class="ident" id="5416425">ReaderAt</span><span class="op" id="5416433">,</span>&nbsp;<span class="ident" id="5416435">size</span>&nbsp;<span class="builtintype" id="5416440">int64</span><span class="op" id="5416445">)</span>&nbsp;<span class="op" id="5416447">(</span><span class="ident" id="5416448">dir</span>&nbsp;<span class="op" id="5416452">*</span><span class="ident" id="5416453">directoryEnd</span><span class="op" id="5416465">,</span>&nbsp;<span class="ident" id="5416467">err</span>&nbsp;<span class="builtintype" id="5416471">error</span><span class="op" id="5416476">)</span>&nbsp;<span class="op" id="5416478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5416481">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416553">var</span>&nbsp;<span class="ident" id="5416557">buf</span>&nbsp;<span class="op" id="5416561">[</span><span class="op" id="5416562">]</span><span class="builtintype" id="5416563">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416569">var</span>&nbsp;<span class="ident" id="5416573">directoryEndOffset</span>&nbsp;<span class="builtintype" id="5416592">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416599">for</span>&nbsp;<span class="ident" id="5416603">i</span><span class="op" id="5416604">,</span>&nbsp;<span class="ident" id="5416606">bLen</span>&nbsp;<span class="op" id="5416611">:=</span>&nbsp;<span class="keyword" id="5416614">range</span>&nbsp;<span class="op" id="5416620">[</span><span class="op" id="5416621">]</span><span class="builtintype" id="5416622">int64</span><span class="op" id="5416627">{</span><span class="num" id="5416628">1024</span><span class="op" id="5416632">,</span>&nbsp;<span class="num" id="5416634">65</span>&nbsp;<span class="op" id="5416637">*</span>&nbsp;<span class="num" id="5416639">1024</span><span class="op" id="5416643">}</span>&nbsp;<span class="op" id="5416645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416649">if</span>&nbsp;<span class="ident" id="5416652">bLen</span>&nbsp;<span class="op" id="5416657">&gt;</span>&nbsp;<span class="ident" id="5416659">size</span>&nbsp;<span class="op" id="5416664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5416669">bLen</span>&nbsp;<span class="op" id="5416674">=</span>&nbsp;<span class="ident" id="5416676">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5416683">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5416687">buf</span>&nbsp;<span class="op" id="5416691">=</span>&nbsp;<span class="builtinfunc" id="5416693">make</span><span class="op" id="5416697">(</span><span class="op" id="5416698">[</span><span class="op" id="5416699">]</span><span class="builtintype" id="5416700">byte</span><span class="op" id="5416704">,</span>&nbsp;<span class="builtintype" id="5416706">int</span><span class="op" id="5416709">(</span><span class="ident" id="5416710">bLen</span><span class="op" id="5416714">)</span><span class="op" id="5416715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416719">if</span>&nbsp;<span class="ident" id="5416722">_</span><span class="op" id="5416723">,</span>&nbsp;<span class="ident" id="5416725">err</span>&nbsp;<span class="op" id="5416729">:=</span>&nbsp;<span class="ident" id="5416732">r</span><span class="op" id="5416733">.</span><span class="ident" id="5416734">ReadAt</span><span class="op" id="5416740">(</span><span class="ident" id="5416741">buf</span><span class="op" id="5416744">,</span>&nbsp;<span class="ident" id="5416746">size</span><span class="op" id="5416750">-</span><span class="ident" id="5416751">bLen</span><span class="op" id="5416755">)</span><span class="op" id="5416756">;</span>&nbsp;<span class="ident" id="5416758">err</span>&nbsp;<span class="op" id="5416762">!=</span>&nbsp;<span class="builtintype" id="5416765">nil</span>&nbsp;<span class="op" id="5416769">&amp;&amp;</span>&nbsp;<span class="ident" id="5416772">err</span>&nbsp;<span class="op" id="5416776">!=</span>&nbsp;<span class="ident" id="5416779">io</span><span class="op" id="5416781">.</span><span class="ident" id="5416782">EOF</span>&nbsp;<span class="op" id="5416786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416791">return</span>&nbsp;<span class="builtintype" id="5416798">nil</span><span class="op" id="5416801">,</span>&nbsp;<span class="ident" id="5416803">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5416809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416813">if</span>&nbsp;<span class="ident" id="5416816">p</span>&nbsp;<span class="op" id="5416818">:=</span>&nbsp;<span class="ident" id="5416821">findSignatureInBlock</span><span class="op" id="5416841">(</span><span class="ident" id="5416842">buf</span><span class="op" id="5416845">)</span><span class="op" id="5416846">;</span>&nbsp;<span class="ident" id="5416848">p</span>&nbsp;<span class="op" id="5416850">&gt;=</span>&nbsp;<span class="num" id="5416853">0</span>&nbsp;<span class="op" id="5416855">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5416860">buf</span>&nbsp;<span class="op" id="5416864">=</span>&nbsp;<span class="ident" id="5416866">buf</span><span class="op" id="5416869">[</span><span class="ident" id="5416870">p</span><span class="op" id="5416871">:</span><span class="op" id="5416872">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5416877">directoryEndOffset</span>&nbsp;<span class="op" id="5416896">=</span>&nbsp;<span class="ident" id="5416898">size</span>&nbsp;<span class="op" id="5416903">-</span>&nbsp;<span class="ident" id="5416905">bLen</span>&nbsp;<span class="op" id="5416910">+</span>&nbsp;<span class="builtintype" id="5416912">int64</span><span class="op" id="5416917">(</span><span class="ident" id="5416918">p</span><span class="op" id="5416919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416924">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5416932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416936">if</span>&nbsp;<span class="ident" id="5416939">i</span>&nbsp;<span class="op" id="5416941">==</span>&nbsp;<span class="num" id="5416944">1</span>&nbsp;<span class="op" id="5416946">||</span>&nbsp;<span class="ident" id="5416949">bLen</span>&nbsp;<span class="op" id="5416954">==</span>&nbsp;<span class="ident" id="5416957">size</span>&nbsp;<span class="op" id="5416962">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416967">return</span>&nbsp;<span class="builtintype" id="5416974">nil</span><span class="op" id="5416977">,</span>&nbsp;<span class="ident" id="5416979">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5416991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5416994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5416998">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417026">b</span>&nbsp;<span class="op" id="5417028">:=</span>&nbsp;<span class="ident" id="5417031">readBuf</span><span class="op" id="5417038">(</span><span class="ident" id="5417039">buf</span><span class="op" id="5417042">[</span><span class="num" id="5417043">4</span><span class="op" id="5417044">:</span><span class="op" id="5417045">]</span><span class="op" id="5417046">)</span>&nbsp;<span class="comment" id="5417048">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417067">d</span>&nbsp;<span class="op" id="5417069">:=</span>&nbsp;<span class="op" id="5417072">&amp;</span><span class="ident" id="5417073">directoryEnd</span><span class="op" id="5417085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417089">diskNbr</span><span class="op" id="5417096">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5417109">uint32</span><span class="op" id="5417115">(</span><span class="ident" id="5417116">b</span><span class="op" id="5417117">.</span><span class="builtintype" id="5417118">uint16</span><span class="op" id="5417124">(</span><span class="op" id="5417125">)</span><span class="op" id="5417126">)</span><span class="op" id="5417127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417131">dirDiskNbr</span><span class="op" id="5417141">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5417151">uint32</span><span class="op" id="5417157">(</span><span class="ident" id="5417158">b</span><span class="op" id="5417159">.</span><span class="builtintype" id="5417160">uint16</span><span class="op" id="5417166">(</span><span class="op" id="5417167">)</span><span class="op" id="5417168">)</span><span class="op" id="5417169">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417173">dirRecordsThisDisk</span><span class="op" id="5417191">:</span>&nbsp;<span class="builtintype" id="5417193">uint64</span><span class="op" id="5417199">(</span><span class="ident" id="5417200">b</span><span class="op" id="5417201">.</span><span class="builtintype" id="5417202">uint16</span><span class="op" id="5417208">(</span><span class="op" id="5417209">)</span><span class="op" id="5417210">)</span><span class="op" id="5417211">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417215">directoryRecords</span><span class="op" id="5417231">:</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5417235">uint64</span><span class="op" id="5417241">(</span><span class="ident" id="5417242">b</span><span class="op" id="5417243">.</span><span class="builtintype" id="5417244">uint16</span><span class="op" id="5417250">(</span><span class="op" id="5417251">)</span><span class="op" id="5417252">)</span><span class="op" id="5417253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417257">directorySize</span><span class="op" id="5417270">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5417277">uint64</span><span class="op" id="5417283">(</span><span class="ident" id="5417284">b</span><span class="op" id="5417285">.</span><span class="builtintype" id="5417286">uint32</span><span class="op" id="5417292">(</span><span class="op" id="5417293">)</span><span class="op" id="5417294">)</span><span class="op" id="5417295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417299">directoryOffset</span><span class="op" id="5417314">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5417319">uint64</span><span class="op" id="5417325">(</span><span class="ident" id="5417326">b</span><span class="op" id="5417327">.</span><span class="builtintype" id="5417328">uint32</span><span class="op" id="5417334">(</span><span class="op" id="5417335">)</span><span class="op" id="5417336">)</span><span class="op" id="5417337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417341">commentLen</span><span class="op" id="5417351">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417361">b</span><span class="op" id="5417362">.</span><span class="builtintype" id="5417363">uint16</span><span class="op" id="5417369">(</span><span class="op" id="5417370">)</span><span class="op" id="5417371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417374">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417377">l</span>&nbsp;<span class="op" id="5417379">:=</span>&nbsp;<span class="builtintype" id="5417382">int</span><span class="op" id="5417385">(</span><span class="ident" id="5417386">d</span><span class="op" id="5417387">.</span><span class="ident" id="5417388">commentLen</span><span class="op" id="5417398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417401">if</span>&nbsp;<span class="ident" id="5417404">l</span>&nbsp;<span class="op" id="5417406">&gt;</span>&nbsp;<span class="builtinfunc" id="5417408">len</span><span class="op" id="5417411">(</span><span class="ident" id="5417412">b</span><span class="op" id="5417413">)</span>&nbsp;<span class="op" id="5417415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417419">return</span>&nbsp;<span class="builtintype" id="5417426">nil</span><span class="op" id="5417429">,</span>&nbsp;<span class="ident" id="5417431">errors</span><span class="op" id="5417437">.</span><span class="ident" id="5417438">New</span><span class="op" id="5417441">(</span><span class="string" id="5417442">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="5417471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417477">d</span><span class="op" id="5417478">.</span><span class="ident" id="5417479">comment</span>&nbsp;<span class="op" id="5417487">=</span>&nbsp;<span class="builtintype" id="5417489">string</span><span class="op" id="5417495">(</span><span class="ident" id="5417496">b</span><span class="op" id="5417497">[</span><span class="op" id="5417498">:</span><span class="ident" id="5417499">l</span><span class="op" id="5417500">]</span><span class="op" id="5417501">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417505">p</span><span class="op" id="5417506">,</span>&nbsp;<span class="ident" id="5417508">err</span>&nbsp;<span class="op" id="5417512">:=</span>&nbsp;<span class="ident" id="5417515">findDirectory64End</span><span class="op" id="5417533">(</span><span class="ident" id="5417534">r</span><span class="op" id="5417535">,</span>&nbsp;<span class="ident" id="5417537">directoryEndOffset</span><span class="op" id="5417555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417558">if</span>&nbsp;<span class="ident" id="5417561">err</span>&nbsp;<span class="op" id="5417565">==</span>&nbsp;<span class="builtintype" id="5417568">nil</span>&nbsp;<span class="op" id="5417572">&amp;&amp;</span>&nbsp;<span class="ident" id="5417575">p</span>&nbsp;<span class="op" id="5417577">&gt;=</span>&nbsp;<span class="num" id="5417580">0</span>&nbsp;<span class="op" id="5417582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417586">err</span>&nbsp;<span class="op" id="5417590">=</span>&nbsp;<span class="ident" id="5417592">readDirectory64End</span><span class="op" id="5417610">(</span><span class="ident" id="5417611">r</span><span class="op" id="5417612">,</span>&nbsp;<span class="ident" id="5417614">p</span><span class="op" id="5417615">,</span>&nbsp;<span class="ident" id="5417617">d</span><span class="op" id="5417618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417621">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417624">if</span>&nbsp;<span class="ident" id="5417627">err</span>&nbsp;<span class="op" id="5417631">!=</span>&nbsp;<span class="builtintype" id="5417634">nil</span>&nbsp;<span class="op" id="5417638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417642">return</span>&nbsp;<span class="builtintype" id="5417649">nil</span><span class="op" id="5417652">,</span>&nbsp;<span class="ident" id="5417654">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5417663">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417726">if</span>&nbsp;<span class="ident" id="5417729">o</span>&nbsp;<span class="op" id="5417731">:=</span>&nbsp;<span class="builtintype" id="5417734">int64</span><span class="op" id="5417739">(</span><span class="ident" id="5417740">d</span><span class="op" id="5417741">.</span><span class="ident" id="5417742">directoryOffset</span><span class="op" id="5417757">)</span><span class="op" id="5417758">;</span>&nbsp;<span class="ident" id="5417760">o</span>&nbsp;<span class="op" id="5417762">&lt;</span>&nbsp;<span class="num" id="5417764">0</span>&nbsp;<span class="op" id="5417766">||</span>&nbsp;<span class="ident" id="5417769">o</span>&nbsp;<span class="op" id="5417771">&gt;=</span>&nbsp;<span class="ident" id="5417774">size</span>&nbsp;<span class="op" id="5417779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417783">return</span>&nbsp;<span class="builtintype" id="5417790">nil</span><span class="op" id="5417793">,</span>&nbsp;<span class="ident" id="5417795">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417809">return</span>&nbsp;<span class="ident" id="5417816">d</span><span class="op" id="5417817">,</span>&nbsp;<span class="builtintype" id="5417819">nil</span><br>
<span class="lineno"></span><span class="op" id="5417823">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="5417826">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5417896">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5417966">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5417976">func</span>&nbsp;<span class="ident" id="5417981">findDirectory64End</span><span class="op" id="5417999">(</span><span class="ident" id="5418000">r</span>&nbsp;<span class="ident" id="5418002">io</span><span class="op" id="5418004">.</span><span class="ident" id="5418005">ReaderAt</span><span class="op" id="5418013">,</span>&nbsp;<span class="ident" id="5418015">directoryEndOffset</span>&nbsp;<span class="builtintype" id="5418034">int64</span><span class="op" id="5418039">)</span>&nbsp;<span class="op" id="5418041">(</span><span class="builtintype" id="5418042">int64</span><span class="op" id="5418047">,</span>&nbsp;<span class="builtintype" id="5418049">error</span><span class="op" id="5418054">)</span>&nbsp;<span class="op" id="5418056">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418059">locOffset</span>&nbsp;<span class="op" id="5418069">:=</span>&nbsp;<span class="ident" id="5418072">directoryEndOffset</span>&nbsp;<span class="op" id="5418091">-</span>&nbsp;<span class="ident" id="5418093">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418112">if</span>&nbsp;<span class="ident" id="5418115">locOffset</span>&nbsp;<span class="op" id="5418125">&lt;</span>&nbsp;<span class="num" id="5418127">0</span>&nbsp;<span class="op" id="5418129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418133">return</span>&nbsp;<span class="op" id="5418140">-</span><span class="num" id="5418141">1</span><span class="op" id="5418142">,</span>&nbsp;<span class="builtintype" id="5418144">nil</span>&nbsp;<span class="comment" id="5418148">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418201">buf</span>&nbsp;<span class="op" id="5418205">:=</span>&nbsp;<span class="builtinfunc" id="5418208">make</span><span class="op" id="5418212">(</span><span class="op" id="5418213">[</span><span class="op" id="5418214">]</span><span class="builtintype" id="5418215">byte</span><span class="op" id="5418219">,</span>&nbsp;<span class="ident" id="5418221">directory64LocLen</span><span class="op" id="5418238">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418241">if</span>&nbsp;<span class="ident" id="5418244">_</span><span class="op" id="5418245">,</span>&nbsp;<span class="ident" id="5418247">err</span>&nbsp;<span class="op" id="5418251">:=</span>&nbsp;<span class="ident" id="5418254">r</span><span class="op" id="5418255">.</span><span class="ident" id="5418256">ReadAt</span><span class="op" id="5418262">(</span><span class="ident" id="5418263">buf</span><span class="op" id="5418266">,</span>&nbsp;<span class="ident" id="5418268">locOffset</span><span class="op" id="5418277">)</span><span class="op" id="5418278">;</span>&nbsp;<span class="ident" id="5418280">err</span>&nbsp;<span class="op" id="5418284">!=</span>&nbsp;<span class="builtintype" id="5418287">nil</span>&nbsp;<span class="op" id="5418291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418295">return</span>&nbsp;<span class="op" id="5418302">-</span><span class="num" id="5418303">1</span><span class="op" id="5418304">,</span>&nbsp;<span class="ident" id="5418306">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418314">b</span>&nbsp;<span class="op" id="5418316">:=</span>&nbsp;<span class="ident" id="5418319">readBuf</span><span class="op" id="5418326">(</span><span class="ident" id="5418327">buf</span><span class="op" id="5418330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418333">if</span>&nbsp;<span class="ident" id="5418336">sig</span>&nbsp;<span class="op" id="5418340">:=</span>&nbsp;<span class="ident" id="5418343">b</span><span class="op" id="5418344">.</span><span class="builtintype" id="5418345">uint32</span><span class="op" id="5418351">(</span><span class="op" id="5418352">)</span><span class="op" id="5418353">;</span>&nbsp;<span class="ident" id="5418355">sig</span>&nbsp;<span class="op" id="5418359">!=</span>&nbsp;<span class="ident" id="5418362">directory64LocSignature</span>&nbsp;<span class="op" id="5418386">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418390">return</span>&nbsp;<span class="op" id="5418397">-</span><span class="num" id="5418398">1</span><span class="op" id="5418399">,</span>&nbsp;<span class="builtintype" id="5418401">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418409">b</span>&nbsp;<span class="op" id="5418411">=</span>&nbsp;<span class="ident" id="5418413">b</span><span class="op" id="5418414">[</span><span class="num" id="5418415">4</span><span class="op" id="5418416">:</span><span class="op" id="5418417">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5418425">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418506">p</span>&nbsp;<span class="op" id="5418508">:=</span>&nbsp;<span class="ident" id="5418511">b</span><span class="op" id="5418512">.</span><span class="builtintype" id="5418513">uint64</span><span class="op" id="5418519">(</span><span class="op" id="5418520">)</span>&nbsp;<span class="comment" id="5418522">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418587">return</span>&nbsp;<span class="builtintype" id="5418594">int64</span><span class="op" id="5418599">(</span><span class="ident" id="5418600">p</span><span class="op" id="5418601">)</span><span class="op" id="5418602">,</span>&nbsp;<span class="builtintype" id="5418604">nil</span><br>
<span class="lineno">395</span><span class="op" id="5418608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5418611">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5418679">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5418733">func</span>&nbsp;<span class="ident" id="5418738">readDirectory64End</span><span class="op" id="5418756">(</span><span class="ident" id="5418757">r</span>&nbsp;<span class="ident" id="5418759">io</span><span class="op" id="5418761">.</span><span class="ident" id="5418762">ReaderAt</span><span class="op" id="5418770">,</span>&nbsp;<span class="ident" id="5418772">offset</span>&nbsp;<span class="builtintype" id="5418779">int64</span><span class="op" id="5418784">,</span>&nbsp;<span class="ident" id="5418786">d</span>&nbsp;<span class="op" id="5418788">*</span><span class="ident" id="5418789">directoryEnd</span><span class="op" id="5418801">)</span>&nbsp;<span class="op" id="5418803">(</span><span class="ident" id="5418804">err</span>&nbsp;<span class="builtintype" id="5418808">error</span><span class="op" id="5418813">)</span>&nbsp;<span class="op" id="5418815">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418818">buf</span>&nbsp;<span class="op" id="5418822">:=</span>&nbsp;<span class="builtinfunc" id="5418825">make</span><span class="op" id="5418829">(</span><span class="op" id="5418830">[</span><span class="op" id="5418831">]</span><span class="builtintype" id="5418832">byte</span><span class="op" id="5418836">,</span>&nbsp;<span class="ident" id="5418838">directory64EndLen</span><span class="op" id="5418855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418858">if</span>&nbsp;<span class="ident" id="5418861">_</span><span class="op" id="5418862">,</span>&nbsp;<span class="ident" id="5418864">err</span>&nbsp;<span class="op" id="5418868">:=</span>&nbsp;<span class="ident" id="5418871">r</span><span class="op" id="5418872">.</span><span class="ident" id="5418873">ReadAt</span><span class="op" id="5418879">(</span><span class="ident" id="5418880">buf</span><span class="op" id="5418883">,</span>&nbsp;<span class="ident" id="5418885">offset</span><span class="op" id="5418891">)</span><span class="op" id="5418892">;</span>&nbsp;<span class="ident" id="5418894">err</span>&nbsp;<span class="op" id="5418898">!=</span>&nbsp;<span class="builtintype" id="5418901">nil</span>&nbsp;<span class="op" id="5418905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418909">return</span>&nbsp;<span class="ident" id="5418916">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418925">b</span>&nbsp;<span class="op" id="5418927">:=</span>&nbsp;<span class="ident" id="5418930">readBuf</span><span class="op" id="5418937">(</span><span class="ident" id="5418938">buf</span><span class="op" id="5418941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418944">if</span>&nbsp;<span class="ident" id="5418947">sig</span>&nbsp;<span class="op" id="5418951">:=</span>&nbsp;<span class="ident" id="5418954">b</span><span class="op" id="5418955">.</span><span class="builtintype" id="5418956">uint32</span><span class="op" id="5418962">(</span><span class="op" id="5418963">)</span><span class="op" id="5418964">;</span>&nbsp;<span class="ident" id="5418966">sig</span>&nbsp;<span class="op" id="5418970">!=</span>&nbsp;<span class="ident" id="5418973">directory64EndSignature</span>&nbsp;<span class="op" id="5418997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419001">return</span>&nbsp;<span class="ident" id="5419008">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5419019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419023">b</span>&nbsp;<span class="op" id="5419025">=</span>&nbsp;<span class="ident" id="5419027">b</span><span class="op" id="5419028">[</span><span class="num" id="5419029">12</span><span class="op" id="5419031">:</span><span class="op" id="5419032">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5419057">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419124">d</span><span class="op" id="5419125">.</span><span class="ident" id="5419126">diskNbr</span>&nbsp;<span class="op" id="5419134">=</span>&nbsp;<span class="ident" id="5419136">b</span><span class="op" id="5419137">.</span><span class="builtintype" id="5419138">uint32</span><span class="op" id="5419144">(</span><span class="op" id="5419145">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5419158">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419182">d</span><span class="op" id="5419183">.</span><span class="ident" id="5419184">dirDiskNbr</span>&nbsp;<span class="op" id="5419195">=</span>&nbsp;<span class="ident" id="5419197">b</span><span class="op" id="5419198">.</span><span class="builtintype" id="5419199">uint32</span><span class="op" id="5419205">(</span><span class="op" id="5419206">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5419216">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419279">d</span><span class="op" id="5419280">.</span><span class="ident" id="5419281">dirRecordsThisDisk</span>&nbsp;<span class="op" id="5419300">=</span>&nbsp;<span class="ident" id="5419302">b</span><span class="op" id="5419303">.</span><span class="builtintype" id="5419304">uint64</span><span class="op" id="5419310">(</span><span class="op" id="5419311">)</span>&nbsp;<span class="comment" id="5419313">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419379">d</span><span class="op" id="5419380">.</span><span class="ident" id="5419381">directoryRecords</span>&nbsp;<span class="op" id="5419398">=</span>&nbsp;<span class="ident" id="5419400">b</span><span class="op" id="5419401">.</span><span class="builtintype" id="5419402">uint64</span><span class="op" id="5419408">(</span><span class="op" id="5419409">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5419413">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419466">d</span><span class="op" id="5419467">.</span><span class="ident" id="5419468">directorySize</span>&nbsp;<span class="op" id="5419482">=</span>&nbsp;<span class="ident" id="5419484">b</span><span class="op" id="5419485">.</span><span class="builtintype" id="5419486">uint64</span><span class="op" id="5419492">(</span><span class="op" id="5419493">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5419500">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419534">d</span><span class="op" id="5419535">.</span><span class="ident" id="5419536">directoryOffset</span>&nbsp;<span class="op" id="5419552">=</span>&nbsp;<span class="ident" id="5419554">b</span><span class="op" id="5419555">.</span><span class="builtintype" id="5419556">uint64</span><span class="op" id="5419562">(</span><span class="op" id="5419563">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5419568">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419651">return</span>&nbsp;<span class="builtintype" id="5419658">nil</span><br>
<span class="lineno"></span><span class="op" id="5419662">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="5419665">func</span>&nbsp;<span class="ident" id="5419670">findSignatureInBlock</span><span class="op" id="5419690">(</span><span class="ident" id="5419691">b</span>&nbsp;<span class="op" id="5419693">[</span><span class="op" id="5419694">]</span><span class="builtintype" id="5419695">byte</span><span class="op" id="5419699">)</span>&nbsp;<span class="builtintype" id="5419701">int</span>&nbsp;<span class="op" id="5419705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419708">for</span>&nbsp;<span class="ident" id="5419712">i</span>&nbsp;<span class="op" id="5419714">:=</span>&nbsp;<span class="builtinfunc" id="5419717">len</span><span class="op" id="5419720">(</span><span class="ident" id="5419721">b</span><span class="op" id="5419722">)</span>&nbsp;<span class="op" id="5419724">-</span>&nbsp;<span class="ident" id="5419726">directoryEndLen</span><span class="op" id="5419741">;</span>&nbsp;<span class="ident" id="5419743">i</span>&nbsp;<span class="op" id="5419745">&gt;=</span>&nbsp;<span class="num" id="5419748">0</span><span class="op" id="5419749">;</span>&nbsp;<span class="ident" id="5419751">i</span><span class="op" id="5419752">--</span>&nbsp;<span class="op" id="5419755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5419759">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419812">if</span>&nbsp;<span class="ident" id="5419815">b</span><span class="op" id="5419816">[</span><span class="ident" id="5419817">i</span><span class="op" id="5419818">]</span>&nbsp;<span class="op" id="5419820">==</span>&nbsp;<span class="string" id="5419823">&#39;P&#39;</span>&nbsp;<span class="op" id="5419827">&amp;&amp;</span>&nbsp;<span class="ident" id="5419830">b</span><span class="op" id="5419831">[</span><span class="ident" id="5419832">i</span><span class="op" id="5419833">+</span><span class="num" id="5419834">1</span><span class="op" id="5419835">]</span>&nbsp;<span class="op" id="5419837">==</span>&nbsp;<span class="string" id="5419840">&#39;K&#39;</span>&nbsp;<span class="op" id="5419844">&amp;&amp;</span>&nbsp;<span class="ident" id="5419847">b</span><span class="op" id="5419848">[</span><span class="ident" id="5419849">i</span><span class="op" id="5419850">+</span><span class="num" id="5419851">2</span><span class="op" id="5419852">]</span>&nbsp;<span class="op" id="5419854">==</span>&nbsp;<span class="num" id="5419857">0x05</span>&nbsp;<span class="op" id="5419862">&amp;&amp;</span>&nbsp;<span class="ident" id="5419865">b</span><span class="op" id="5419866">[</span><span class="ident" id="5419867">i</span><span class="op" id="5419868">+</span><span class="num" id="5419869">3</span><span class="op" id="5419870">]</span>&nbsp;<span class="op" id="5419872">==</span>&nbsp;<span class="num" id="5419875">0x06</span>&nbsp;<span class="op" id="5419880">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5419885">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419914">n</span>&nbsp;<span class="op" id="5419916">:=</span>&nbsp;<span class="builtintype" id="5419919">int</span><span class="op" id="5419922">(</span><span class="ident" id="5419923">b</span><span class="op" id="5419924">[</span><span class="ident" id="5419925">i</span><span class="op" id="5419926">+</span><span class="ident" id="5419927">directoryEndLen</span><span class="op" id="5419942">-</span><span class="num" id="5419943">2</span><span class="op" id="5419944">]</span><span class="op" id="5419945">)</span>&nbsp;<span class="op" id="5419947">|</span>&nbsp;<span class="builtintype" id="5419949">int</span><span class="op" id="5419952">(</span><span class="ident" id="5419953">b</span><span class="op" id="5419954">[</span><span class="ident" id="5419955">i</span><span class="op" id="5419956">+</span><span class="ident" id="5419957">directoryEndLen</span><span class="op" id="5419972">-</span><span class="num" id="5419973">1</span><span class="op" id="5419974">]</span><span class="op" id="5419975">)</span><span class="op" id="5419976">&lt;&lt;</span><span class="num" id="5419978">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419983">if</span>&nbsp;<span class="ident" id="5419986">n</span><span class="op" id="5419987">+</span><span class="ident" id="5419988">directoryEndLen</span><span class="op" id="5420003">+</span><span class="ident" id="5420004">i</span>&nbsp;<span class="op" id="5420006">&lt;=</span>&nbsp;<span class="builtinfunc" id="5420009">len</span><span class="op" id="5420012">(</span><span class="ident" id="5420013">b</span><span class="op" id="5420014">)</span>&nbsp;<span class="op" id="5420016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420022">return</span>&nbsp;<span class="ident" id="5420029">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420034">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420044">return</span>&nbsp;<span class="op" id="5420051">-</span><span class="num" id="5420052">1</span><br>
<span class="lineno"></span><span class="op" id="5420054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5420057">type</span>&nbsp;<span class="ident" id="5420062">readBuf</span>&nbsp;<span class="op" id="5420070">[</span><span class="op" id="5420071">]</span><span class="builtintype" id="5420072">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5420078">func</span>&nbsp;<span class="op" id="5420083">(</span><span class="ident" id="5420084">b</span>&nbsp;<span class="op" id="5420086">*</span><span class="ident" id="5420087">readBuf</span><span class="op" id="5420094">)</span>&nbsp;<span class="builtintype" id="5420096">uint16</span><span class="op" id="5420102">(</span><span class="op" id="5420103">)</span>&nbsp;<span class="builtintype" id="5420105">uint16</span>&nbsp;<span class="op" id="5420112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420115">v</span>&nbsp;<span class="op" id="5420117">:=</span>&nbsp;<span class="ident" id="5420120">binary</span><span class="op" id="5420126">.</span><span class="ident" id="5420127">LittleEndian</span><span class="op" id="5420139">.</span><span class="ident" id="5420140">Uint16</span><span class="op" id="5420146">(</span><span class="op" id="5420147">*</span><span class="ident" id="5420148">b</span><span class="op" id="5420149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420152">*</span><span class="ident" id="5420153">b</span>&nbsp;<span class="op" id="5420155">=</span>&nbsp;<span class="op" id="5420157">(</span><span class="op" id="5420158">*</span><span class="ident" id="5420159">b</span><span class="op" id="5420160">)</span><span class="op" id="5420161">[</span><span class="num" id="5420162">2</span><span class="op" id="5420163">:</span><span class="op" id="5420164">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420167">return</span>&nbsp;<span class="ident" id="5420174">v</span><br>
<span class="lineno"></span><span class="op" id="5420176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5420179">func</span>&nbsp;<span class="op" id="5420184">(</span><span class="ident" id="5420185">b</span>&nbsp;<span class="op" id="5420187">*</span><span class="ident" id="5420188">readBuf</span><span class="op" id="5420195">)</span>&nbsp;<span class="builtintype" id="5420197">uint32</span><span class="op" id="5420203">(</span><span class="op" id="5420204">)</span>&nbsp;<span class="builtintype" id="5420206">uint32</span>&nbsp;<span class="op" id="5420213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420216">v</span>&nbsp;<span class="op" id="5420218">:=</span>&nbsp;<span class="ident" id="5420221">binary</span><span class="op" id="5420227">.</span><span class="ident" id="5420228">LittleEndian</span><span class="op" id="5420240">.</span><span class="ident" id="5420241">Uint32</span><span class="op" id="5420247">(</span><span class="op" id="5420248">*</span><span class="ident" id="5420249">b</span><span class="op" id="5420250">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420253">*</span><span class="ident" id="5420254">b</span>&nbsp;<span class="op" id="5420256">=</span>&nbsp;<span class="op" id="5420258">(</span><span class="op" id="5420259">*</span><span class="ident" id="5420260">b</span><span class="op" id="5420261">)</span><span class="op" id="5420262">[</span><span class="num" id="5420263">4</span><span class="op" id="5420264">:</span><span class="op" id="5420265">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420268">return</span>&nbsp;<span class="ident" id="5420275">v</span><br>
<span class="lineno"></span><span class="op" id="5420277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5420280">func</span>&nbsp;<span class="op" id="5420285">(</span><span class="ident" id="5420286">b</span>&nbsp;<span class="op" id="5420288">*</span><span class="ident" id="5420289">readBuf</span><span class="op" id="5420296">)</span>&nbsp;<span class="builtintype" id="5420298">uint64</span><span class="op" id="5420304">(</span><span class="op" id="5420305">)</span>&nbsp;<span class="builtintype" id="5420307">uint64</span>&nbsp;<span class="op" id="5420314">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420317">v</span>&nbsp;<span class="op" id="5420319">:=</span>&nbsp;<span class="ident" id="5420322">binary</span><span class="op" id="5420328">.</span><span class="ident" id="5420329">LittleEndian</span><span class="op" id="5420341">.</span><span class="ident" id="5420342">Uint64</span><span class="op" id="5420348">(</span><span class="op" id="5420349">*</span><span class="ident" id="5420350">b</span><span class="op" id="5420351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420354">*</span><span class="ident" id="5420355">b</span>&nbsp;<span class="op" id="5420357">=</span>&nbsp;<span class="op" id="5420359">(</span><span class="op" id="5420360">*</span><span class="ident" id="5420361">b</span><span class="op" id="5420362">)</span><span class="op" id="5420363">[</span><span class="num" id="5420364">8</span><span class="op" id="5420365">:</span><span class="op" id="5420366">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420369">return</span>&nbsp;<span class="ident" id="5420376">v</span><br>
<span class="lineno"></span><span class="op" id="5420378">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
