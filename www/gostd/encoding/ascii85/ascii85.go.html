<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html" class="current">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6115719">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6115774">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6115828">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6115879">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6115935">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="6116012">package</span>&nbsp;<span class="ident" id="6116020">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6116029">import</span>&nbsp;<span class="op" id="6116036">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6116039">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6116045">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="6116055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6116058">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6116077">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="6116136">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="6116199">//</span><br>
<span class="lineno"></span><span class="comment" id="6116202">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6116266">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="6116332">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="6116404">//</span><br>
<span class="lineno">25</span><span class="comment" id="6116407">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6116471">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="6116501">func</span>&nbsp;<span class="ident" id="6116506">Encode</span><span class="op" id="6116512">(</span><span class="ident" id="6116513">dst</span><span class="op" id="6116516">,</span>&nbsp;<span class="ident" id="6116518">src</span>&nbsp;<span class="op" id="6116522">[</span><span class="op" id="6116523">]</span><span class="builtintype" id="6116524">byte</span><span class="op" id="6116528">)</span>&nbsp;<span class="builtintype" id="6116530">int</span>&nbsp;<span class="op" id="6116534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6116537">if</span>&nbsp;<span class="builtinfunc" id="6116540">len</span><span class="op" id="6116543">(</span><span class="ident" id="6116544">src</span><span class="op" id="6116547">)</span>&nbsp;<span class="op" id="6116549">==</span>&nbsp;<span class="num" id="6116552">0</span>&nbsp;<span class="op" id="6116554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6116558">return</span>&nbsp;<span class="num" id="6116565">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6116568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6116572">n</span>&nbsp;<span class="op" id="6116574">:=</span>&nbsp;<span class="num" id="6116577">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6116580">for</span>&nbsp;<span class="builtinfunc" id="6116584">len</span><span class="op" id="6116587">(</span><span class="ident" id="6116588">src</span><span class="op" id="6116591">)</span>&nbsp;<span class="op" id="6116593">&gt;</span>&nbsp;<span class="num" id="6116595">0</span>&nbsp;<span class="op" id="6116597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6116601">dst</span><span class="op" id="6116604">[</span><span class="num" id="6116605">0</span><span class="op" id="6116606">]</span>&nbsp;<span class="op" id="6116608">=</span>&nbsp;<span class="num" id="6116610">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6116614">dst</span><span class="op" id="6116617">[</span><span class="num" id="6116618">1</span><span class="op" id="6116619">]</span>&nbsp;<span class="op" id="6116621">=</span>&nbsp;<span class="num" id="6116623">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6116627">dst</span><span class="op" id="6116630">[</span><span class="num" id="6116631">2</span><span class="op" id="6116632">]</span>&nbsp;<span class="op" id="6116634">=</span>&nbsp;<span class="num" id="6116636">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6116640">dst</span><span class="op" id="6116643">[</span><span class="num" id="6116644">3</span><span class="op" id="6116645">]</span>&nbsp;<span class="op" id="6116647">=</span>&nbsp;<span class="num" id="6116649">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6116653">dst</span><span class="op" id="6116656">[</span><span class="num" id="6116657">4</span><span class="op" id="6116658">]</span>&nbsp;<span class="op" id="6116660">=</span>&nbsp;<span class="num" id="6116662">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6116667">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6116730">var</span>&nbsp;<span class="ident" id="6116734">v</span>&nbsp;<span class="builtintype" id="6116736">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6116745">switch</span>&nbsp;<span class="builtinfunc" id="6116752">len</span><span class="op" id="6116755">(</span><span class="ident" id="6116756">src</span><span class="op" id="6116759">)</span>&nbsp;<span class="op" id="6116761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6116765">default</span><span class="op" id="6116772">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6116777">v</span>&nbsp;<span class="op" id="6116779">|=</span>&nbsp;<span class="builtintype" id="6116782">uint32</span><span class="op" id="6116788">(</span><span class="ident" id="6116789">src</span><span class="op" id="6116792">[</span><span class="num" id="6116793">3</span><span class="op" id="6116794">]</span><span class="op" id="6116795">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6116800">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6116814">case</span>&nbsp;<span class="num" id="6116819">3</span><span class="op" id="6116820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6116825">v</span>&nbsp;<span class="op" id="6116827">|=</span>&nbsp;<span class="builtintype" id="6116830">uint32</span><span class="op" id="6116836">(</span><span class="ident" id="6116837">src</span><span class="op" id="6116840">[</span><span class="num" id="6116841">2</span><span class="op" id="6116842">]</span><span class="op" id="6116843">)</span>&nbsp;<span class="op" id="6116845">&lt;&lt;</span>&nbsp;<span class="num" id="6116848">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6116853">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6116867">case</span>&nbsp;<span class="num" id="6116872">2</span><span class="op" id="6116873">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6116878">v</span>&nbsp;<span class="op" id="6116880">|=</span>&nbsp;<span class="builtintype" id="6116883">uint32</span><span class="op" id="6116889">(</span><span class="ident" id="6116890">src</span><span class="op" id="6116893">[</span><span class="num" id="6116894">1</span><span class="op" id="6116895">]</span><span class="op" id="6116896">)</span>&nbsp;<span class="op" id="6116898">&lt;&lt;</span>&nbsp;<span class="num" id="6116901">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6116907">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6116921">case</span>&nbsp;<span class="num" id="6116926">1</span><span class="op" id="6116927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6116932">v</span>&nbsp;<span class="op" id="6116934">|=</span>&nbsp;<span class="builtintype" id="6116937">uint32</span><span class="op" id="6116943">(</span><span class="ident" id="6116944">src</span><span class="op" id="6116947">[</span><span class="num" id="6116948">0</span><span class="op" id="6116949">]</span><span class="op" id="6116950">)</span>&nbsp;<span class="op" id="6116952">&lt;&lt;</span>&nbsp;<span class="num" id="6116955">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6116960">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6116965">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6117012">if</span>&nbsp;<span class="ident" id="6117015">v</span>&nbsp;<span class="op" id="6117017">==</span>&nbsp;<span class="num" id="6117020">0</span>&nbsp;<span class="op" id="6117022">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6117025">len</span><span class="op" id="6117028">(</span><span class="ident" id="6117029">src</span><span class="op" id="6117032">)</span>&nbsp;<span class="op" id="6117034">&gt;=</span>&nbsp;<span class="num" id="6117037">4</span>&nbsp;<span class="op" id="6117039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117044">dst</span><span class="op" id="6117047">[</span><span class="num" id="6117048">0</span><span class="op" id="6117049">]</span>&nbsp;<span class="op" id="6117051">=</span>&nbsp;<span class="string" id="6117053">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117060">dst</span>&nbsp;<span class="op" id="6117064">=</span>&nbsp;<span class="ident" id="6117066">dst</span><span class="op" id="6117069">[</span><span class="num" id="6117070">1</span><span class="op" id="6117071">:</span><span class="op" id="6117072">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117077">src</span>&nbsp;<span class="op" id="6117081">=</span>&nbsp;<span class="ident" id="6117083">src</span><span class="op" id="6117086">[</span><span class="num" id="6117087">4</span><span class="op" id="6117088">:</span><span class="op" id="6117089">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117094">n</span><span class="op" id="6117095">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6117101">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6117112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6117117">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6117165">for</span>&nbsp;<span class="ident" id="6117169">i</span>&nbsp;<span class="op" id="6117171">:=</span>&nbsp;<span class="num" id="6117174">4</span><span class="op" id="6117175">;</span>&nbsp;<span class="ident" id="6117177">i</span>&nbsp;<span class="op" id="6117179">&gt;=</span>&nbsp;<span class="num" id="6117182">0</span><span class="op" id="6117183">;</span>&nbsp;<span class="ident" id="6117185">i</span><span class="op" id="6117186">--</span>&nbsp;<span class="op" id="6117189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117194">dst</span><span class="op" id="6117197">[</span><span class="ident" id="6117198">i</span><span class="op" id="6117199">]</span>&nbsp;<span class="op" id="6117201">=</span>&nbsp;<span class="string" id="6117203">&#39;!&#39;</span>&nbsp;<span class="op" id="6117207">+</span>&nbsp;<span class="builtintype" id="6117209">byte</span><span class="op" id="6117213">(</span><span class="ident" id="6117214">v</span><span class="op" id="6117215">%</span><span class="num" id="6117216">85</span><span class="op" id="6117218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117223">v</span>&nbsp;<span class="op" id="6117225">/=</span>&nbsp;<span class="num" id="6117228">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6117233">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6117238">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117296">m</span>&nbsp;<span class="op" id="6117298">:=</span>&nbsp;<span class="num" id="6117301">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6117305">if</span>&nbsp;<span class="builtinfunc" id="6117308">len</span><span class="op" id="6117311">(</span><span class="ident" id="6117312">src</span><span class="op" id="6117315">)</span>&nbsp;<span class="op" id="6117317">&lt;</span>&nbsp;<span class="num" id="6117319">4</span>&nbsp;<span class="op" id="6117321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117326">m</span>&nbsp;<span class="op" id="6117328">-=</span>&nbsp;<span class="num" id="6117331">4</span>&nbsp;<span class="op" id="6117333">-</span>&nbsp;<span class="builtinfunc" id="6117335">len</span><span class="op" id="6117338">(</span><span class="ident" id="6117339">src</span><span class="op" id="6117342">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117347">src</span>&nbsp;<span class="op" id="6117351">=</span>&nbsp;<span class="ident" id="6117353">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6117359">}</span>&nbsp;<span class="keyword" id="6117361">else</span>&nbsp;<span class="op" id="6117366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117371">src</span>&nbsp;<span class="op" id="6117375">=</span>&nbsp;<span class="ident" id="6117377">src</span><span class="op" id="6117380">[</span><span class="num" id="6117381">4</span><span class="op" id="6117382">:</span><span class="op" id="6117383">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6117387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117391">dst</span>&nbsp;<span class="op" id="6117395">=</span>&nbsp;<span class="ident" id="6117397">dst</span><span class="op" id="6117400">[</span><span class="ident" id="6117401">m</span><span class="op" id="6117402">:</span><span class="op" id="6117403">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117407">n</span>&nbsp;<span class="op" id="6117409">+=</span>&nbsp;<span class="ident" id="6117412">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6117415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6117418">return</span>&nbsp;<span class="ident" id="6117425">n</span><br>
<span class="lineno"></span><span class="op" id="6117427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="6117430">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6117508">func</span>&nbsp;<span class="ident" id="6117513">MaxEncodedLen</span><span class="op" id="6117526">(</span><span class="ident" id="6117527">n</span>&nbsp;<span class="builtintype" id="6117529">int</span><span class="op" id="6117532">)</span>&nbsp;<span class="builtintype" id="6117534">int</span>&nbsp;<span class="op" id="6117538">{</span>&nbsp;<span class="keyword" id="6117540">return</span>&nbsp;<span class="op" id="6117547">(</span><span class="ident" id="6117548">n</span>&nbsp;<span class="op" id="6117550">+</span>&nbsp;<span class="num" id="6117552">3</span><span class="op" id="6117553">)</span>&nbsp;<span class="op" id="6117555">/</span>&nbsp;<span class="num" id="6117557">4</span>&nbsp;<span class="op" id="6117559">*</span>&nbsp;<span class="num" id="6117561">5</span>&nbsp;<span class="op" id="6117563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6117566">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6117635">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="6117697">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="6117758">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6117826">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="6117853">func</span>&nbsp;<span class="ident" id="6117858">NewEncoder</span><span class="op" id="6117868">(</span><span class="ident" id="6117869">w</span>&nbsp;<span class="ident" id="6117871">io</span><span class="op" id="6117873">.</span><span class="ident" id="6117874">Writer</span><span class="op" id="6117880">)</span>&nbsp;<span class="ident" id="6117882">io</span><span class="op" id="6117884">.</span><span class="ident" id="6117885">WriteCloser</span>&nbsp;<span class="op" id="6117897">{</span>&nbsp;<span class="keyword" id="6117899">return</span>&nbsp;<span class="op" id="6117906">&amp;</span><span class="ident" id="6117907">encoder</span><span class="op" id="6117914">{</span><span class="ident" id="6117915">w</span><span class="op" id="6117916">:</span>&nbsp;<span class="ident" id="6117918">w</span><span class="op" id="6117919">}</span>&nbsp;<span class="op" id="6117921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6117924">type</span>&nbsp;<span class="ident" id="6117929">encoder</span>&nbsp;<span class="keyword" id="6117937">struct</span>&nbsp;<span class="op" id="6117944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117947">err</span>&nbsp;&nbsp;<span class="builtintype" id="6117952">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117959">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117964">io</span><span class="op" id="6117966">.</span><span class="ident" id="6117967">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6117975">buf</span>&nbsp;&nbsp;<span class="op" id="6117980">[</span><span class="num" id="6117981">4</span><span class="op" id="6117982">]</span><span class="builtintype" id="6117983">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6117991">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118031">nbuf</span>&nbsp;<span class="builtintype" id="6118036">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6118047">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118074">out</span>&nbsp;&nbsp;<span class="op" id="6118079">[</span><span class="num" id="6118080">1024</span><span class="op" id="6118084">]</span><span class="builtintype" id="6118085">byte</span>&nbsp;<span class="comment" id="6118090">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="6118107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6118110">func</span>&nbsp;<span class="op" id="6118115">(</span><span class="ident" id="6118116">e</span>&nbsp;<span class="op" id="6118118">*</span><span class="ident" id="6118119">encoder</span><span class="op" id="6118126">)</span>&nbsp;<span class="ident" id="6118128">Write</span><span class="op" id="6118133">(</span><span class="ident" id="6118134">p</span>&nbsp;<span class="op" id="6118136">[</span><span class="op" id="6118137">]</span><span class="builtintype" id="6118138">byte</span><span class="op" id="6118142">)</span>&nbsp;<span class="op" id="6118144">(</span><span class="ident" id="6118145">n</span>&nbsp;<span class="builtintype" id="6118147">int</span><span class="op" id="6118150">,</span>&nbsp;<span class="ident" id="6118152">err</span>&nbsp;<span class="builtintype" id="6118156">error</span><span class="op" id="6118161">)</span>&nbsp;<span class="op" id="6118163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118166">if</span>&nbsp;<span class="ident" id="6118169">e</span><span class="op" id="6118170">.</span><span class="ident" id="6118171">err</span>&nbsp;<span class="op" id="6118175">!=</span>&nbsp;<span class="ident" id="6118178">nil</span>&nbsp;<span class="op" id="6118182">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118186">return</span>&nbsp;<span class="num" id="6118193">0</span><span class="op" id="6118194">,</span>&nbsp;<span class="ident" id="6118196">e</span><span class="op" id="6118197">.</span><span class="ident" id="6118198">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6118203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6118207">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118227">if</span>&nbsp;<span class="ident" id="6118230">e</span><span class="op" id="6118231">.</span><span class="ident" id="6118232">nbuf</span>&nbsp;<span class="op" id="6118237">&gt;</span>&nbsp;<span class="num" id="6118239">0</span>&nbsp;<span class="op" id="6118241">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118245">var</span>&nbsp;<span class="ident" id="6118249">i</span>&nbsp;<span class="builtintype" id="6118251">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118257">for</span>&nbsp;<span class="ident" id="6118261">i</span>&nbsp;<span class="op" id="6118263">=</span>&nbsp;<span class="num" id="6118265">0</span><span class="op" id="6118266">;</span>&nbsp;<span class="ident" id="6118268">i</span>&nbsp;<span class="op" id="6118270">&lt;</span>&nbsp;<span class="builtinfunc" id="6118272">len</span><span class="op" id="6118275">(</span><span class="ident" id="6118276">p</span><span class="op" id="6118277">)</span>&nbsp;<span class="op" id="6118279">&amp;&amp;</span>&nbsp;<span class="ident" id="6118282">e</span><span class="op" id="6118283">.</span><span class="ident" id="6118284">nbuf</span>&nbsp;<span class="op" id="6118289">&lt;</span>&nbsp;<span class="num" id="6118291">4</span><span class="op" id="6118292">;</span>&nbsp;<span class="ident" id="6118294">i</span><span class="op" id="6118295">++</span>&nbsp;<span class="op" id="6118298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118303">e</span><span class="op" id="6118304">.</span><span class="ident" id="6118305">buf</span><span class="op" id="6118308">[</span><span class="ident" id="6118309">e</span><span class="op" id="6118310">.</span><span class="ident" id="6118311">nbuf</span><span class="op" id="6118315">]</span>&nbsp;<span class="op" id="6118317">=</span>&nbsp;<span class="ident" id="6118319">p</span><span class="op" id="6118320">[</span><span class="ident" id="6118321">i</span><span class="op" id="6118322">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118327">e</span><span class="op" id="6118328">.</span><span class="ident" id="6118329">nbuf</span><span class="op" id="6118333">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6118338">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118342">n</span>&nbsp;<span class="op" id="6118344">+=</span>&nbsp;<span class="ident" id="6118347">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118351">p</span>&nbsp;<span class="op" id="6118353">=</span>&nbsp;<span class="ident" id="6118355">p</span><span class="op" id="6118356">[</span><span class="ident" id="6118357">i</span><span class="op" id="6118358">:</span><span class="op" id="6118359">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118363">if</span>&nbsp;<span class="ident" id="6118366">e</span><span class="op" id="6118367">.</span><span class="ident" id="6118368">nbuf</span>&nbsp;<span class="op" id="6118373">&lt;</span>&nbsp;<span class="num" id="6118375">4</span>&nbsp;<span class="op" id="6118377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118382">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6118391">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118395">nout</span>&nbsp;<span class="op" id="6118400">:=</span>&nbsp;<span class="ident" id="6118403">Encode</span><span class="op" id="6118409">(</span><span class="ident" id="6118410">e</span><span class="op" id="6118411">.</span><span class="ident" id="6118412">out</span><span class="op" id="6118415">[</span><span class="num" id="6118416">0</span><span class="op" id="6118417">:</span><span class="op" id="6118418">]</span><span class="op" id="6118419">,</span>&nbsp;<span class="ident" id="6118421">e</span><span class="op" id="6118422">.</span><span class="ident" id="6118423">buf</span><span class="op" id="6118426">[</span><span class="num" id="6118427">0</span><span class="op" id="6118428">:</span><span class="op" id="6118429">]</span><span class="op" id="6118430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118434">if</span>&nbsp;<span class="ident" id="6118437">_</span><span class="op" id="6118438">,</span>&nbsp;<span class="ident" id="6118440">e</span><span class="op" id="6118441">.</span><span class="ident" id="6118442">err</span>&nbsp;<span class="op" id="6118446">=</span>&nbsp;<span class="ident" id="6118448">e</span><span class="op" id="6118449">.</span><span class="ident" id="6118450">w</span><span class="op" id="6118451">.</span><span class="ident" id="6118452">Write</span><span class="op" id="6118457">(</span><span class="ident" id="6118458">e</span><span class="op" id="6118459">.</span><span class="ident" id="6118460">out</span><span class="op" id="6118463">[</span><span class="num" id="6118464">0</span><span class="op" id="6118465">:</span><span class="ident" id="6118466">nout</span><span class="op" id="6118470">]</span><span class="op" id="6118471">)</span><span class="op" id="6118472">;</span>&nbsp;<span class="ident" id="6118474">e</span><span class="op" id="6118475">.</span><span class="ident" id="6118476">err</span>&nbsp;<span class="op" id="6118480">!=</span>&nbsp;<span class="ident" id="6118483">nil</span>&nbsp;<span class="op" id="6118487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118492">return</span>&nbsp;<span class="ident" id="6118499">n</span><span class="op" id="6118500">,</span>&nbsp;<span class="ident" id="6118502">e</span><span class="op" id="6118503">.</span><span class="ident" id="6118504">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6118510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118514">e</span><span class="op" id="6118515">.</span><span class="ident" id="6118516">nbuf</span>&nbsp;<span class="op" id="6118521">=</span>&nbsp;<span class="num" id="6118523">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6118526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6118530">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118557">for</span>&nbsp;<span class="builtinfunc" id="6118561">len</span><span class="op" id="6118564">(</span><span class="ident" id="6118565">p</span><span class="op" id="6118566">)</span>&nbsp;<span class="op" id="6118568">&gt;=</span>&nbsp;<span class="num" id="6118571">4</span>&nbsp;<span class="op" id="6118573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118577">nn</span>&nbsp;<span class="op" id="6118580">:=</span>&nbsp;<span class="builtinfunc" id="6118583">len</span><span class="op" id="6118586">(</span><span class="ident" id="6118587">e</span><span class="op" id="6118588">.</span><span class="ident" id="6118589">out</span><span class="op" id="6118592">)</span>&nbsp;<span class="op" id="6118594">/</span>&nbsp;<span class="num" id="6118596">5</span>&nbsp;<span class="op" id="6118598">*</span>&nbsp;<span class="num" id="6118600">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118604">if</span>&nbsp;<span class="ident" id="6118607">nn</span>&nbsp;<span class="op" id="6118610">&gt;</span>&nbsp;<span class="builtinfunc" id="6118612">len</span><span class="op" id="6118615">(</span><span class="ident" id="6118616">p</span><span class="op" id="6118617">)</span>&nbsp;<span class="op" id="6118619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118624">nn</span>&nbsp;<span class="op" id="6118627">=</span>&nbsp;<span class="builtinfunc" id="6118629">len</span><span class="op" id="6118632">(</span><span class="ident" id="6118633">p</span><span class="op" id="6118634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6118638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118642">nn</span>&nbsp;<span class="op" id="6118645">-=</span>&nbsp;<span class="ident" id="6118648">nn</span>&nbsp;<span class="op" id="6118651">%</span>&nbsp;<span class="num" id="6118653">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118657">if</span>&nbsp;<span class="ident" id="6118660">nn</span>&nbsp;<span class="op" id="6118663">&gt;</span>&nbsp;<span class="num" id="6118665">0</span>&nbsp;<span class="op" id="6118667">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118672">nout</span>&nbsp;<span class="op" id="6118677">:=</span>&nbsp;<span class="ident" id="6118680">Encode</span><span class="op" id="6118686">(</span><span class="ident" id="6118687">e</span><span class="op" id="6118688">.</span><span class="ident" id="6118689">out</span><span class="op" id="6118692">[</span><span class="num" id="6118693">0</span><span class="op" id="6118694">:</span><span class="op" id="6118695">]</span><span class="op" id="6118696">,</span>&nbsp;<span class="ident" id="6118698">p</span><span class="op" id="6118699">[</span><span class="num" id="6118700">0</span><span class="op" id="6118701">:</span><span class="ident" id="6118702">nn</span><span class="op" id="6118704">]</span><span class="op" id="6118705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118710">if</span>&nbsp;<span class="ident" id="6118713">_</span><span class="op" id="6118714">,</span>&nbsp;<span class="ident" id="6118716">e</span><span class="op" id="6118717">.</span><span class="ident" id="6118718">err</span>&nbsp;<span class="op" id="6118722">=</span>&nbsp;<span class="ident" id="6118724">e</span><span class="op" id="6118725">.</span><span class="ident" id="6118726">w</span><span class="op" id="6118727">.</span><span class="ident" id="6118728">Write</span><span class="op" id="6118733">(</span><span class="ident" id="6118734">e</span><span class="op" id="6118735">.</span><span class="ident" id="6118736">out</span><span class="op" id="6118739">[</span><span class="num" id="6118740">0</span><span class="op" id="6118741">:</span><span class="ident" id="6118742">nout</span><span class="op" id="6118746">]</span><span class="op" id="6118747">)</span><span class="op" id="6118748">;</span>&nbsp;<span class="ident" id="6118750">e</span><span class="op" id="6118751">.</span><span class="ident" id="6118752">err</span>&nbsp;<span class="op" id="6118756">!=</span>&nbsp;<span class="ident" id="6118759">nil</span>&nbsp;<span class="op" id="6118763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118769">return</span>&nbsp;<span class="ident" id="6118776">n</span><span class="op" id="6118777">,</span>&nbsp;<span class="ident" id="6118779">e</span><span class="op" id="6118780">.</span><span class="ident" id="6118781">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6118788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6118792">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118796">n</span>&nbsp;<span class="op" id="6118798">+=</span>&nbsp;<span class="ident" id="6118801">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118806">p</span>&nbsp;<span class="op" id="6118808">=</span>&nbsp;<span class="ident" id="6118810">p</span><span class="op" id="6118811">[</span><span class="ident" id="6118812">nn</span><span class="op" id="6118814">:</span><span class="op" id="6118815">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6118818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6118822">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118843">for</span>&nbsp;<span class="ident" id="6118847">i</span>&nbsp;<span class="op" id="6118849">:=</span>&nbsp;<span class="num" id="6118852">0</span><span class="op" id="6118853">;</span>&nbsp;<span class="ident" id="6118855">i</span>&nbsp;<span class="op" id="6118857">&lt;</span>&nbsp;<span class="builtinfunc" id="6118859">len</span><span class="op" id="6118862">(</span><span class="ident" id="6118863">p</span><span class="op" id="6118864">)</span><span class="op" id="6118865">;</span>&nbsp;<span class="ident" id="6118867">i</span><span class="op" id="6118868">++</span>&nbsp;<span class="op" id="6118871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118875">e</span><span class="op" id="6118876">.</span><span class="ident" id="6118877">buf</span><span class="op" id="6118880">[</span><span class="ident" id="6118881">i</span><span class="op" id="6118882">]</span>&nbsp;<span class="op" id="6118884">=</span>&nbsp;<span class="ident" id="6118886">p</span><span class="op" id="6118887">[</span><span class="ident" id="6118888">i</span><span class="op" id="6118889">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6118892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118895">e</span><span class="op" id="6118896">.</span><span class="ident" id="6118897">nbuf</span>&nbsp;<span class="op" id="6118902">=</span>&nbsp;<span class="builtinfunc" id="6118904">len</span><span class="op" id="6118907">(</span><span class="ident" id="6118908">p</span><span class="op" id="6118909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6118912">n</span>&nbsp;<span class="op" id="6118914">+=</span>&nbsp;<span class="builtinfunc" id="6118917">len</span><span class="op" id="6118920">(</span><span class="ident" id="6118921">p</span><span class="op" id="6118922">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6118925">return</span><br>
<span class="lineno"></span><span class="op" id="6118932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6118935">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6118989">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="6119042">func</span>&nbsp;<span class="op" id="6119047">(</span><span class="ident" id="6119048">e</span>&nbsp;<span class="op" id="6119050">*</span><span class="ident" id="6119051">encoder</span><span class="op" id="6119058">)</span>&nbsp;<span class="ident" id="6119060">Close</span><span class="op" id="6119065">(</span><span class="op" id="6119066">)</span>&nbsp;<span class="builtintype" id="6119068">error</span>&nbsp;<span class="op" id="6119074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6119077">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6119134">if</span>&nbsp;<span class="ident" id="6119137">e</span><span class="op" id="6119138">.</span><span class="ident" id="6119139">err</span>&nbsp;<span class="op" id="6119143">==</span>&nbsp;<span class="ident" id="6119146">nil</span>&nbsp;<span class="op" id="6119150">&amp;&amp;</span>&nbsp;<span class="ident" id="6119153">e</span><span class="op" id="6119154">.</span><span class="ident" id="6119155">nbuf</span>&nbsp;<span class="op" id="6119160">&gt;</span>&nbsp;<span class="num" id="6119162">0</span>&nbsp;<span class="op" id="6119164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6119168">nout</span>&nbsp;<span class="op" id="6119173">:=</span>&nbsp;<span class="ident" id="6119176">Encode</span><span class="op" id="6119182">(</span><span class="ident" id="6119183">e</span><span class="op" id="6119184">.</span><span class="ident" id="6119185">out</span><span class="op" id="6119188">[</span><span class="num" id="6119189">0</span><span class="op" id="6119190">:</span><span class="op" id="6119191">]</span><span class="op" id="6119192">,</span>&nbsp;<span class="ident" id="6119194">e</span><span class="op" id="6119195">.</span><span class="ident" id="6119196">buf</span><span class="op" id="6119199">[</span><span class="num" id="6119200">0</span><span class="op" id="6119201">:</span><span class="ident" id="6119202">e</span><span class="op" id="6119203">.</span><span class="ident" id="6119204">nbuf</span><span class="op" id="6119208">]</span><span class="op" id="6119209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6119213">e</span><span class="op" id="6119214">.</span><span class="ident" id="6119215">nbuf</span>&nbsp;<span class="op" id="6119220">=</span>&nbsp;<span class="num" id="6119222">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6119226">_</span><span class="op" id="6119227">,</span>&nbsp;<span class="ident" id="6119229">e</span><span class="op" id="6119230">.</span><span class="ident" id="6119231">err</span>&nbsp;<span class="op" id="6119235">=</span>&nbsp;<span class="ident" id="6119237">e</span><span class="op" id="6119238">.</span><span class="ident" id="6119239">w</span><span class="op" id="6119240">.</span><span class="ident" id="6119241">Write</span><span class="op" id="6119246">(</span><span class="ident" id="6119247">e</span><span class="op" id="6119248">.</span><span class="ident" id="6119249">out</span><span class="op" id="6119252">[</span><span class="num" id="6119253">0</span><span class="op" id="6119254">:</span><span class="ident" id="6119255">nout</span><span class="op" id="6119259">]</span><span class="op" id="6119260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6119263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6119266">return</span>&nbsp;<span class="ident" id="6119273">e</span><span class="op" id="6119274">.</span><span class="ident" id="6119275">err</span><br>
<span class="lineno"></span><span class="op" id="6119279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="6119282">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6119301">type</span>&nbsp;<span class="ident" id="6119306">CorruptInputError</span>&nbsp;<span class="ident" id="6119324">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6119331">func</span>&nbsp;<span class="op" id="6119336">(</span><span class="ident" id="6119337">e</span>&nbsp;<span class="ident" id="6119339">CorruptInputError</span><span class="op" id="6119356">)</span>&nbsp;<span class="ident" id="6119358">Error</span><span class="op" id="6119363">(</span><span class="op" id="6119364">)</span>&nbsp;<span class="builtintype" id="6119366">string</span>&nbsp;<span class="op" id="6119373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6119376">return</span>&nbsp;<span class="string" id="6119383">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="6119421">+</span>&nbsp;<span class="ident" id="6119423">strconv</span><span class="op" id="6119430">.</span><span class="ident" id="6119431">FormatInt</span><span class="op" id="6119440">(</span><span class="ident" id="6119441">int64</span><span class="op" id="6119446">(</span><span class="ident" id="6119447">e</span><span class="op" id="6119448">)</span><span class="op" id="6119449">,</span>&nbsp;<span class="num" id="6119451">10</span><span class="op" id="6119453">)</span><br>
<span class="lineno"></span><span class="op" id="6119455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6119458">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="6119516">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="6119577">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6119641">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="6119706">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="6119761">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6119825">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="6119886">//</span><br>
<span class="lineno"></span><span class="comment" id="6119889">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6119949">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="6120011">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="6120068">//</span><br>
<span class="lineno"></span><span class="comment" id="6120071">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="6120129">//</span><br>
<span class="lineno"></span><span class="keyword" id="6120132">func</span>&nbsp;<span class="ident" id="6120137">Decode</span><span class="op" id="6120143">(</span><span class="ident" id="6120144">dst</span><span class="op" id="6120147">,</span>&nbsp;<span class="ident" id="6120149">src</span>&nbsp;<span class="op" id="6120153">[</span><span class="op" id="6120154">]</span><span class="builtintype" id="6120155">byte</span><span class="op" id="6120159">,</span>&nbsp;<span class="ident" id="6120161">flush</span>&nbsp;<span class="builtintype" id="6120167">bool</span><span class="op" id="6120171">)</span>&nbsp;<span class="op" id="6120173">(</span><span class="ident" id="6120174">ndst</span><span class="op" id="6120178">,</span>&nbsp;<span class="ident" id="6120180">nsrc</span>&nbsp;<span class="builtintype" id="6120185">int</span><span class="op" id="6120188">,</span>&nbsp;<span class="ident" id="6120190">err</span>&nbsp;<span class="builtintype" id="6120194">error</span><span class="op" id="6120199">)</span>&nbsp;<span class="op" id="6120201">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120204">var</span>&nbsp;<span class="ident" id="6120208">v</span>&nbsp;<span class="builtintype" id="6120210">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120218">var</span>&nbsp;<span class="ident" id="6120222">nb</span>&nbsp;<span class="builtintype" id="6120225">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120230">for</span>&nbsp;<span class="ident" id="6120234">i</span><span class="op" id="6120235">,</span>&nbsp;<span class="ident" id="6120237">b</span>&nbsp;<span class="op" id="6120239">:=</span>&nbsp;<span class="keyword" id="6120242">range</span>&nbsp;<span class="ident" id="6120248">src</span>&nbsp;<span class="op" id="6120252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120256">if</span>&nbsp;<span class="builtinfunc" id="6120259">len</span><span class="op" id="6120262">(</span><span class="ident" id="6120263">dst</span><span class="op" id="6120266">)</span><span class="op" id="6120267">-</span><span class="ident" id="6120268">ndst</span>&nbsp;<span class="op" id="6120273">&lt;</span>&nbsp;<span class="num" id="6120275">4</span>&nbsp;<span class="op" id="6120277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120282">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6120291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120295">switch</span>&nbsp;<span class="op" id="6120302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120306">case</span>&nbsp;<span class="ident" id="6120311">b</span>&nbsp;<span class="op" id="6120313">&lt;=</span>&nbsp;<span class="string" id="6120316">&#39;&nbsp;&#39;</span><span class="op" id="6120319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120324">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120335">case</span>&nbsp;<span class="ident" id="6120340">b</span>&nbsp;<span class="op" id="6120342">==</span>&nbsp;<span class="string" id="6120345">&#39;z&#39;</span>&nbsp;<span class="op" id="6120349">&amp;&amp;</span>&nbsp;<span class="ident" id="6120352">nb</span>&nbsp;<span class="op" id="6120355">==</span>&nbsp;<span class="num" id="6120358">0</span><span class="op" id="6120359">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120364">nb</span>&nbsp;<span class="op" id="6120367">=</span>&nbsp;<span class="num" id="6120369">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120374">v</span>&nbsp;<span class="op" id="6120376">=</span>&nbsp;<span class="num" id="6120378">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120382">case</span>&nbsp;<span class="string" id="6120387">&#39;!&#39;</span>&nbsp;<span class="op" id="6120391">&lt;=</span>&nbsp;<span class="ident" id="6120394">b</span>&nbsp;<span class="op" id="6120396">&amp;&amp;</span>&nbsp;<span class="ident" id="6120399">b</span>&nbsp;<span class="op" id="6120401">&lt;=</span>&nbsp;<span class="string" id="6120404">&#39;u&#39;</span><span class="op" id="6120407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120412">v</span>&nbsp;<span class="op" id="6120414">=</span>&nbsp;<span class="ident" id="6120416">v</span><span class="op" id="6120417">*</span><span class="num" id="6120418">85</span>&nbsp;<span class="op" id="6120421">+</span>&nbsp;<span class="builtintype" id="6120423">uint32</span><span class="op" id="6120429">(</span><span class="ident" id="6120430">b</span><span class="op" id="6120431">-</span><span class="string" id="6120432">&#39;!&#39;</span><span class="op" id="6120435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120440">nb</span><span class="op" id="6120442">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120447">default</span><span class="op" id="6120454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120459">return</span>&nbsp;<span class="num" id="6120466">0</span><span class="op" id="6120467">,</span>&nbsp;<span class="num" id="6120469">0</span><span class="op" id="6120470">,</span>&nbsp;<span class="ident" id="6120472">CorruptInputError</span><span class="op" id="6120489">(</span><span class="ident" id="6120490">i</span><span class="op" id="6120491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6120495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120499">if</span>&nbsp;<span class="ident" id="6120502">nb</span>&nbsp;<span class="op" id="6120505">==</span>&nbsp;<span class="num" id="6120508">5</span>&nbsp;<span class="op" id="6120510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120515">nsrc</span>&nbsp;<span class="op" id="6120520">=</span>&nbsp;<span class="ident" id="6120522">i</span>&nbsp;<span class="op" id="6120524">+</span>&nbsp;<span class="num" id="6120526">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120531">dst</span><span class="op" id="6120534">[</span><span class="ident" id="6120535">ndst</span><span class="op" id="6120539">]</span>&nbsp;<span class="op" id="6120541">=</span>&nbsp;<span class="builtintype" id="6120543">byte</span><span class="op" id="6120547">(</span><span class="ident" id="6120548">v</span>&nbsp;<span class="op" id="6120550">&gt;&gt;</span>&nbsp;<span class="num" id="6120553">24</span><span class="op" id="6120555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120560">dst</span><span class="op" id="6120563">[</span><span class="ident" id="6120564">ndst</span><span class="op" id="6120568">+</span><span class="num" id="6120569">1</span><span class="op" id="6120570">]</span>&nbsp;<span class="op" id="6120572">=</span>&nbsp;<span class="builtintype" id="6120574">byte</span><span class="op" id="6120578">(</span><span class="ident" id="6120579">v</span>&nbsp;<span class="op" id="6120581">&gt;&gt;</span>&nbsp;<span class="num" id="6120584">16</span><span class="op" id="6120586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120591">dst</span><span class="op" id="6120594">[</span><span class="ident" id="6120595">ndst</span><span class="op" id="6120599">+</span><span class="num" id="6120600">2</span><span class="op" id="6120601">]</span>&nbsp;<span class="op" id="6120603">=</span>&nbsp;<span class="builtintype" id="6120605">byte</span><span class="op" id="6120609">(</span><span class="ident" id="6120610">v</span>&nbsp;<span class="op" id="6120612">&gt;&gt;</span>&nbsp;<span class="num" id="6120615">8</span><span class="op" id="6120616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120621">dst</span><span class="op" id="6120624">[</span><span class="ident" id="6120625">ndst</span><span class="op" id="6120629">+</span><span class="num" id="6120630">3</span><span class="op" id="6120631">]</span>&nbsp;<span class="op" id="6120633">=</span>&nbsp;<span class="builtintype" id="6120635">byte</span><span class="op" id="6120639">(</span><span class="ident" id="6120640">v</span><span class="op" id="6120641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120646">ndst</span>&nbsp;<span class="op" id="6120651">+=</span>&nbsp;<span class="num" id="6120654">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120659">nb</span>&nbsp;<span class="op" id="6120662">=</span>&nbsp;<span class="num" id="6120664">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120669">v</span>&nbsp;<span class="op" id="6120671">=</span>&nbsp;<span class="num" id="6120673">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6120677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6120680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120683">if</span>&nbsp;<span class="ident" id="6120686">flush</span>&nbsp;<span class="op" id="6120692">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120696">nsrc</span>&nbsp;<span class="op" id="6120701">=</span>&nbsp;<span class="builtinfunc" id="6120703">len</span><span class="op" id="6120706">(</span><span class="ident" id="6120707">src</span><span class="op" id="6120710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120714">if</span>&nbsp;<span class="ident" id="6120717">nb</span>&nbsp;<span class="op" id="6120720">&gt;</span>&nbsp;<span class="num" id="6120722">0</span>&nbsp;<span class="op" id="6120724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6120729">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6120783">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6120832">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6120883">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120937">if</span>&nbsp;<span class="ident" id="6120940">nb</span>&nbsp;<span class="op" id="6120943">==</span>&nbsp;<span class="num" id="6120946">1</span>&nbsp;<span class="op" id="6120948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6120954">return</span>&nbsp;<span class="num" id="6120961">0</span><span class="op" id="6120962">,</span>&nbsp;<span class="num" id="6120964">0</span><span class="op" id="6120965">,</span>&nbsp;<span class="ident" id="6120967">CorruptInputError</span><span class="op" id="6120984">(</span><span class="builtinfunc" id="6120985">len</span><span class="op" id="6120988">(</span><span class="ident" id="6120989">src</span><span class="op" id="6120992">)</span><span class="op" id="6120993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6120998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6121003">for</span>&nbsp;<span class="ident" id="6121007">i</span>&nbsp;<span class="op" id="6121009">:=</span>&nbsp;<span class="ident" id="6121012">nb</span><span class="op" id="6121014">;</span>&nbsp;<span class="ident" id="6121016">i</span>&nbsp;<span class="op" id="6121018">&lt;</span>&nbsp;<span class="num" id="6121020">5</span><span class="op" id="6121021">;</span>&nbsp;<span class="ident" id="6121023">i</span><span class="op" id="6121024">++</span>&nbsp;<span class="op" id="6121027">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6121033">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6121087">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6121145">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121202">v</span>&nbsp;<span class="op" id="6121204">=</span>&nbsp;<span class="ident" id="6121206">v</span><span class="op" id="6121207">*</span><span class="num" id="6121208">85</span>&nbsp;<span class="op" id="6121211">+</span>&nbsp;<span class="num" id="6121213">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121219">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6121224">for</span>&nbsp;<span class="ident" id="6121228">i</span>&nbsp;<span class="op" id="6121230">:=</span>&nbsp;<span class="num" id="6121233">0</span><span class="op" id="6121234">;</span>&nbsp;<span class="ident" id="6121236">i</span>&nbsp;<span class="op" id="6121238">&lt;</span>&nbsp;<span class="ident" id="6121240">nb</span><span class="op" id="6121242">-</span><span class="num" id="6121243">1</span><span class="op" id="6121244">;</span>&nbsp;<span class="ident" id="6121246">i</span><span class="op" id="6121247">++</span>&nbsp;<span class="op" id="6121250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121256">dst</span><span class="op" id="6121259">[</span><span class="ident" id="6121260">ndst</span><span class="op" id="6121264">]</span>&nbsp;<span class="op" id="6121266">=</span>&nbsp;<span class="builtintype" id="6121268">byte</span><span class="op" id="6121272">(</span><span class="ident" id="6121273">v</span>&nbsp;<span class="op" id="6121275">&gt;&gt;</span>&nbsp;<span class="num" id="6121278">24</span><span class="op" id="6121280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121286">v</span>&nbsp;<span class="op" id="6121288">&lt;&lt;=</span>&nbsp;<span class="num" id="6121292">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121298">ndst</span><span class="op" id="6121302">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121308">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6121318">return</span><br>
<span class="lineno"></span><span class="op" id="6121325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="6121328">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6121383">func</span>&nbsp;<span class="ident" id="6121388">NewDecoder</span><span class="op" id="6121398">(</span><span class="ident" id="6121399">r</span>&nbsp;<span class="ident" id="6121401">io</span><span class="op" id="6121403">.</span><span class="ident" id="6121404">Reader</span><span class="op" id="6121410">)</span>&nbsp;<span class="ident" id="6121412">io</span><span class="op" id="6121414">.</span><span class="ident" id="6121415">Reader</span>&nbsp;<span class="op" id="6121422">{</span>&nbsp;<span class="keyword" id="6121424">return</span>&nbsp;<span class="op" id="6121431">&amp;</span><span class="ident" id="6121432">decoder</span><span class="op" id="6121439">{</span><span class="ident" id="6121440">r</span><span class="op" id="6121441">:</span>&nbsp;<span class="ident" id="6121443">r</span><span class="op" id="6121444">}</span>&nbsp;<span class="op" id="6121446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6121449">type</span>&nbsp;<span class="ident" id="6121454">decoder</span>&nbsp;<span class="keyword" id="6121462">struct</span>&nbsp;<span class="op" id="6121469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121472">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6121480">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121487">readErr</span>&nbsp;<span class="builtintype" id="6121495">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121502">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121510">io</span><span class="op" id="6121512">.</span><span class="ident" id="6121513">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121521">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121529">[</span><span class="num" id="6121530">1024</span><span class="op" id="6121534">]</span><span class="builtintype" id="6121535">byte</span>&nbsp;<span class="comment" id="6121540">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121559">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6121567">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121572">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121580">[</span><span class="op" id="6121581">]</span><span class="builtintype" id="6121582">byte</span>&nbsp;<span class="comment" id="6121587">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121615">outbuf</span>&nbsp;&nbsp;<span class="op" id="6121623">[</span><span class="num" id="6121624">1024</span><span class="op" id="6121628">]</span><span class="builtintype" id="6121629">byte</span><br>
<span class="lineno"></span><span class="op" id="6121634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6121637">func</span>&nbsp;<span class="op" id="6121642">(</span><span class="ident" id="6121643">d</span>&nbsp;<span class="op" id="6121645">*</span><span class="ident" id="6121646">decoder</span><span class="op" id="6121653">)</span>&nbsp;<span class="ident" id="6121655">Read</span><span class="op" id="6121659">(</span><span class="ident" id="6121660">p</span>&nbsp;<span class="op" id="6121662">[</span><span class="op" id="6121663">]</span><span class="builtintype" id="6121664">byte</span><span class="op" id="6121668">)</span>&nbsp;<span class="op" id="6121670">(</span><span class="ident" id="6121671">n</span>&nbsp;<span class="builtintype" id="6121673">int</span><span class="op" id="6121676">,</span>&nbsp;<span class="ident" id="6121678">err</span>&nbsp;<span class="builtintype" id="6121682">error</span><span class="op" id="6121687">)</span>&nbsp;<span class="op" id="6121689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6121692">if</span>&nbsp;<span class="builtinfunc" id="6121695">len</span><span class="op" id="6121698">(</span><span class="ident" id="6121699">p</span><span class="op" id="6121700">)</span>&nbsp;<span class="op" id="6121702">==</span>&nbsp;<span class="num" id="6121705">0</span>&nbsp;<span class="op" id="6121707">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6121711">return</span>&nbsp;<span class="num" id="6121718">0</span><span class="op" id="6121719">,</span>&nbsp;<span class="ident" id="6121721">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6121729">if</span>&nbsp;<span class="ident" id="6121732">d</span><span class="op" id="6121733">.</span><span class="ident" id="6121734">err</span>&nbsp;<span class="op" id="6121738">!=</span>&nbsp;<span class="ident" id="6121741">nil</span>&nbsp;<span class="op" id="6121745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6121749">return</span>&nbsp;<span class="num" id="6121756">0</span><span class="op" id="6121757">,</span>&nbsp;<span class="ident" id="6121759">d</span><span class="op" id="6121760">.</span><span class="ident" id="6121761">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121766">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6121770">for</span>&nbsp;<span class="op" id="6121774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6121778">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6121822">if</span>&nbsp;<span class="builtinfunc" id="6121825">len</span><span class="op" id="6121828">(</span><span class="ident" id="6121829">d</span><span class="op" id="6121830">.</span><span class="ident" id="6121831">out</span><span class="op" id="6121834">)</span>&nbsp;<span class="op" id="6121836">&gt;</span>&nbsp;<span class="num" id="6121838">0</span>&nbsp;<span class="op" id="6121840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121845">n</span>&nbsp;<span class="op" id="6121847">=</span>&nbsp;<span class="builtinfunc" id="6121849">copy</span><span class="op" id="6121853">(</span><span class="ident" id="6121854">p</span><span class="op" id="6121855">,</span>&nbsp;<span class="ident" id="6121857">d</span><span class="op" id="6121858">.</span><span class="ident" id="6121859">out</span><span class="op" id="6121862">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121867">d</span><span class="op" id="6121868">.</span><span class="ident" id="6121869">out</span>&nbsp;<span class="op" id="6121873">=</span>&nbsp;<span class="ident" id="6121875">d</span><span class="op" id="6121876">.</span><span class="ident" id="6121877">out</span><span class="op" id="6121880">[</span><span class="ident" id="6121881">n</span><span class="op" id="6121882">:</span><span class="op" id="6121883">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6121888">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6121902">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6121945">var</span>&nbsp;<span class="ident" id="6121949">nn</span><span class="op" id="6121951">,</span>&nbsp;<span class="ident" id="6121953">nsrc</span><span class="op" id="6121957">,</span>&nbsp;<span class="ident" id="6121959">ndst</span>&nbsp;<span class="builtintype" id="6121964">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6121970">if</span>&nbsp;<span class="ident" id="6121973">d</span><span class="op" id="6121974">.</span><span class="ident" id="6121975">nbuf</span>&nbsp;<span class="op" id="6121980">&gt;</span>&nbsp;<span class="num" id="6121982">0</span>&nbsp;<span class="op" id="6121984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6121989">ndst</span><span class="op" id="6121993">,</span>&nbsp;<span class="ident" id="6121995">nsrc</span><span class="op" id="6121999">,</span>&nbsp;<span class="ident" id="6122001">d</span><span class="op" id="6122002">.</span><span class="ident" id="6122003">err</span>&nbsp;<span class="op" id="6122007">=</span>&nbsp;<span class="ident" id="6122009">Decode</span><span class="op" id="6122015">(</span><span class="ident" id="6122016">d</span><span class="op" id="6122017">.</span><span class="ident" id="6122018">outbuf</span><span class="op" id="6122024">[</span><span class="num" id="6122025">0</span><span class="op" id="6122026">:</span><span class="op" id="6122027">]</span><span class="op" id="6122028">,</span>&nbsp;<span class="ident" id="6122030">d</span><span class="op" id="6122031">.</span><span class="ident" id="6122032">buf</span><span class="op" id="6122035">[</span><span class="num" id="6122036">0</span><span class="op" id="6122037">:</span><span class="ident" id="6122038">d</span><span class="op" id="6122039">.</span><span class="ident" id="6122040">nbuf</span><span class="op" id="6122044">]</span><span class="op" id="6122045">,</span>&nbsp;<span class="ident" id="6122047">d</span><span class="op" id="6122048">.</span><span class="ident" id="6122049">readErr</span>&nbsp;<span class="op" id="6122057">!=</span>&nbsp;<span class="ident" id="6122060">nil</span><span class="op" id="6122063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6122068">if</span>&nbsp;<span class="ident" id="6122071">ndst</span>&nbsp;<span class="op" id="6122076">&gt;</span>&nbsp;<span class="num" id="6122078">0</span>&nbsp;<span class="op" id="6122080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122086">d</span><span class="op" id="6122087">.</span><span class="ident" id="6122088">out</span>&nbsp;<span class="op" id="6122092">=</span>&nbsp;<span class="ident" id="6122094">d</span><span class="op" id="6122095">.</span><span class="ident" id="6122096">outbuf</span><span class="op" id="6122102">[</span><span class="num" id="6122103">0</span><span class="op" id="6122104">:</span><span class="ident" id="6122105">ndst</span><span class="op" id="6122109">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122115">d</span><span class="op" id="6122116">.</span><span class="ident" id="6122117">nbuf</span>&nbsp;<span class="op" id="6122122">=</span>&nbsp;<span class="builtinfunc" id="6122124">copy</span><span class="op" id="6122128">(</span><span class="ident" id="6122129">d</span><span class="op" id="6122130">.</span><span class="ident" id="6122131">buf</span><span class="op" id="6122134">[</span><span class="num" id="6122135">0</span><span class="op" id="6122136">:</span><span class="op" id="6122137">]</span><span class="op" id="6122138">,</span>&nbsp;<span class="ident" id="6122140">d</span><span class="op" id="6122141">.</span><span class="ident" id="6122142">buf</span><span class="op" id="6122145">[</span><span class="ident" id="6122146">nsrc</span><span class="op" id="6122150">:</span><span class="ident" id="6122151">d</span><span class="op" id="6122152">.</span><span class="ident" id="6122153">nbuf</span><span class="op" id="6122157">]</span><span class="op" id="6122158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6122164">continue</span>&nbsp;<span class="comment" id="6122173">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6122199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6122204">if</span>&nbsp;<span class="ident" id="6122207">ndst</span>&nbsp;<span class="op" id="6122212">==</span>&nbsp;<span class="num" id="6122215">0</span>&nbsp;<span class="op" id="6122217">&amp;&amp;</span>&nbsp;<span class="ident" id="6122220">d</span><span class="op" id="6122221">.</span><span class="ident" id="6122222">err</span>&nbsp;<span class="op" id="6122226">==</span>&nbsp;<span class="ident" id="6122229">nil</span>&nbsp;<span class="op" id="6122233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6122239">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6122311">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122369">off</span>&nbsp;<span class="op" id="6122373">:=</span>&nbsp;<span class="num" id="6122376">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6122382">for</span>&nbsp;<span class="ident" id="6122386">i</span>&nbsp;<span class="op" id="6122388">:=</span>&nbsp;<span class="num" id="6122391">0</span><span class="op" id="6122392">;</span>&nbsp;<span class="ident" id="6122394">i</span>&nbsp;<span class="op" id="6122396">&lt;</span>&nbsp;<span class="ident" id="6122398">d</span><span class="op" id="6122399">.</span><span class="ident" id="6122400">nbuf</span><span class="op" id="6122404">;</span>&nbsp;<span class="ident" id="6122406">i</span><span class="op" id="6122407">++</span>&nbsp;<span class="op" id="6122410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6122417">if</span>&nbsp;<span class="ident" id="6122420">d</span><span class="op" id="6122421">.</span><span class="ident" id="6122422">buf</span><span class="op" id="6122425">[</span><span class="ident" id="6122426">i</span><span class="op" id="6122427">]</span>&nbsp;<span class="op" id="6122429">&gt;</span>&nbsp;<span class="string" id="6122431">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6122435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122443">d</span><span class="op" id="6122444">.</span><span class="ident" id="6122445">buf</span><span class="op" id="6122448">[</span><span class="ident" id="6122449">off</span><span class="op" id="6122452">]</span>&nbsp;<span class="op" id="6122454">=</span>&nbsp;<span class="ident" id="6122456">d</span><span class="op" id="6122457">.</span><span class="ident" id="6122458">buf</span><span class="op" id="6122461">[</span><span class="ident" id="6122462">i</span><span class="op" id="6122463">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122471">off</span><span class="op" id="6122474">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6122482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6122488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122494">d</span><span class="op" id="6122495">.</span><span class="ident" id="6122496">nbuf</span>&nbsp;<span class="op" id="6122501">=</span>&nbsp;<span class="ident" id="6122503">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6122510">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6122514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6122519">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6122576">if</span>&nbsp;<span class="ident" id="6122579">d</span><span class="op" id="6122580">.</span><span class="ident" id="6122581">err</span>&nbsp;<span class="op" id="6122585">!=</span>&nbsp;<span class="ident" id="6122588">nil</span>&nbsp;<span class="op" id="6122592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6122597">return</span>&nbsp;<span class="num" id="6122604">0</span><span class="op" id="6122605">,</span>&nbsp;<span class="ident" id="6122607">d</span><span class="op" id="6122608">.</span><span class="ident" id="6122609">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6122615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6122619">if</span>&nbsp;<span class="ident" id="6122622">d</span><span class="op" id="6122623">.</span><span class="ident" id="6122624">readErr</span>&nbsp;<span class="op" id="6122632">!=</span>&nbsp;<span class="ident" id="6122635">nil</span>&nbsp;<span class="op" id="6122639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122644">d</span><span class="op" id="6122645">.</span><span class="ident" id="6122646">err</span>&nbsp;<span class="op" id="6122650">=</span>&nbsp;<span class="ident" id="6122652">d</span><span class="op" id="6122653">.</span><span class="ident" id="6122654">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6122665">return</span>&nbsp;<span class="num" id="6122672">0</span><span class="op" id="6122673">,</span>&nbsp;<span class="ident" id="6122675">d</span><span class="op" id="6122676">.</span><span class="ident" id="6122677">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6122683">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6122688">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122709">nn</span><span class="op" id="6122711">,</span>&nbsp;<span class="ident" id="6122713">d</span><span class="op" id="6122714">.</span><span class="ident" id="6122715">readErr</span>&nbsp;<span class="op" id="6122723">=</span>&nbsp;<span class="ident" id="6122725">d</span><span class="op" id="6122726">.</span><span class="ident" id="6122727">r</span><span class="op" id="6122728">.</span><span class="ident" id="6122729">Read</span><span class="op" id="6122733">(</span><span class="ident" id="6122734">d</span><span class="op" id="6122735">.</span><span class="ident" id="6122736">buf</span><span class="op" id="6122739">[</span><span class="ident" id="6122740">d</span><span class="op" id="6122741">.</span><span class="ident" id="6122742">nbuf</span><span class="op" id="6122746">:</span><span class="op" id="6122747">]</span><span class="op" id="6122748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122752">d</span><span class="op" id="6122753">.</span><span class="ident" id="6122754">nbuf</span>&nbsp;<span class="op" id="6122759">+=</span>&nbsp;<span class="ident" id="6122762">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6122766">}</span><br>
<span class="lineno">310</span><span class="op" id="6122768">}</span>
</div>
</body>
</html>
