<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>internal/syscall</h2>
<ul>
<li><a href="/gostd/internal/syscall/getrandom_linux.go.html" class="current">getrandom_linux.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3430892">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3430948">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3431002">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3431053">package</span>&nbsp;<span class="ident" id="3431061">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3431070">import</span>&nbsp;<span class="op" id="3431077">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3431080">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3431091">&#34;sync/atomic&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431106">stdsyscall</span>&nbsp;<span class="string" id="3431117">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3431128">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="3431137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3431140">var</span>&nbsp;<span class="ident" id="3431144">randomTrap</span>&nbsp;<span class="op" id="3431155">=</span>&nbsp;<span class="keyword" id="3431157">map</span><span class="op" id="3431160">[</span><span class="builtintype" id="3431161">string</span><span class="op" id="3431167">]</span><span class="builtintype" id="3431168">uintptr</span><span class="op" id="3431175">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3431178">&#34;386&#34;</span><span class="op" id="3431183">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3431187">355</span><span class="op" id="3431190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3431193">&#34;amd64&#34;</span><span class="op" id="3431200">:</span>&nbsp;<span class="num" id="3431202">318</span><span class="op" id="3431205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3431208">&#34;arm&#34;</span><span class="op" id="3431213">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3431217">384</span><span class="op" id="3431220">,</span><br>
<span class="lineno"></span><span class="op" id="3431222">}</span><span class="op" id="3431223">[</span><span class="ident" id="3431224">runtime</span><span class="op" id="3431231">.</span><span class="ident" id="3431232">GOARCH</span><span class="op" id="3431238">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3431241">var</span>&nbsp;<span class="ident" id="3431245">randomUnsupported</span>&nbsp;<span class="builtintype" id="3431263">int32</span>&nbsp;<span class="comment" id="3431269">//&nbsp;atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3431280">//&nbsp;GetRandomFlag&nbsp;is&nbsp;a&nbsp;flag&nbsp;supported&nbsp;by&nbsp;the&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="3431347">type</span>&nbsp;<span class="ident" id="3431352">GetRandomFlag</span>&nbsp;<span class="builtintype" id="3431366">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3431375">const</span>&nbsp;<span class="op" id="3431381">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3431384">//&nbsp;GRND_NONBLOCK&nbsp;means&nbsp;return&nbsp;EAGAIN&nbsp;rather&nbsp;than&nbsp;blocking.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431444">GRND_NONBLOCK</span>&nbsp;<span class="ident" id="3431458">GetRandomFlag</span>&nbsp;<span class="op" id="3431472">=</span>&nbsp;<span class="num" id="3431474">0x0001</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3431483">//&nbsp;GRND_RANDOM&nbsp;means&nbsp;use&nbsp;the&nbsp;/dev/random&nbsp;pool&nbsp;instead&nbsp;of&nbsp;/dev/urandom.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431555">GRND_RANDOM</span>&nbsp;<span class="ident" id="3431567">GetRandomFlag</span>&nbsp;<span class="op" id="3431581">=</span>&nbsp;<span class="num" id="3431583">0x0002</span><br>
<span class="lineno"></span><span class="op" id="3431590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3431593">//&nbsp;GetRandom&nbsp;calls&nbsp;the&nbsp;Linux&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="3431645">//&nbsp;See&nbsp;https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=c6e9d6f38894798696f23c8084ca7edbf16ee895</span><br>
<span class="lineno">35</span><span class="keyword" id="3431768">func</span>&nbsp;<span class="ident" id="3431773">GetRandom</span><span class="op" id="3431782">(</span><span class="ident" id="3431783">p</span>&nbsp;<span class="op" id="3431785">[</span><span class="op" id="3431786">]</span><span class="builtintype" id="3431787">byte</span><span class="op" id="3431791">,</span>&nbsp;<span class="ident" id="3431793">flags</span>&nbsp;<span class="ident" id="3431799">GetRandomFlag</span><span class="op" id="3431812">)</span>&nbsp;<span class="op" id="3431814">(</span><span class="ident" id="3431815">n</span>&nbsp;<span class="builtintype" id="3431817">int</span><span class="op" id="3431820">,</span>&nbsp;<span class="ident" id="3431822">err</span>&nbsp;<span class="builtintype" id="3431826">error</span><span class="op" id="3431831">)</span>&nbsp;<span class="op" id="3431833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431836">if</span>&nbsp;<span class="ident" id="3431839">randomTrap</span>&nbsp;<span class="op" id="3431850">==</span>&nbsp;<span class="num" id="3431853">0</span>&nbsp;<span class="op" id="3431855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431859">return</span>&nbsp;<span class="num" id="3431866">0</span><span class="op" id="3431867">,</span>&nbsp;<span class="ident" id="3431869">stdsyscall</span><span class="op" id="3431879">.</span><span class="ident" id="3431880">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431891">if</span>&nbsp;<span class="builtinfunc" id="3431894">len</span><span class="op" id="3431897">(</span><span class="ident" id="3431898">p</span><span class="op" id="3431899">)</span>&nbsp;<span class="op" id="3431901">==</span>&nbsp;<span class="num" id="3431904">0</span>&nbsp;<span class="op" id="3431906">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431910">return</span>&nbsp;<span class="num" id="3431917">0</span><span class="op" id="3431918">,</span>&nbsp;<span class="ident" id="3431920">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431928">if</span>&nbsp;<span class="ident" id="3431931">atomic</span><span class="op" id="3431937">.</span><span class="ident" id="3431938">LoadInt32</span><span class="op" id="3431947">(</span><span class="op" id="3431948">&amp;</span><span class="ident" id="3431949">randomUnsupported</span><span class="op" id="3431966">)</span>&nbsp;<span class="op" id="3431968">!=</span>&nbsp;<span class="num" id="3431971">0</span>&nbsp;<span class="op" id="3431973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431977">return</span>&nbsp;<span class="num" id="3431984">0</span><span class="op" id="3431985">,</span>&nbsp;<span class="ident" id="3431987">stdsyscall</span><span class="op" id="3431997">.</span><span class="ident" id="3431998">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3432006">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432009">r1</span><span class="op" id="3432011">,</span>&nbsp;<span class="ident" id="3432013">_</span><span class="op" id="3432014">,</span>&nbsp;<span class="ident" id="3432016">errno</span>&nbsp;<span class="op" id="3432022">:=</span>&nbsp;<span class="ident" id="3432025">stdsyscall</span><span class="op" id="3432035">.</span><span class="ident" id="3432036">Syscall</span><span class="op" id="3432043">(</span><span class="ident" id="3432044">randomTrap</span><span class="op" id="3432054">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3432058">uintptr</span><span class="op" id="3432065">(</span><span class="ident" id="3432066">unsafe</span><span class="op" id="3432072">.</span><span class="ident" id="3432073">Pointer</span><span class="op" id="3432080">(</span><span class="op" id="3432081">&amp;</span><span class="ident" id="3432082">p</span><span class="op" id="3432083">[</span><span class="num" id="3432084">0</span><span class="op" id="3432085">]</span><span class="op" id="3432086">)</span><span class="op" id="3432087">)</span><span class="op" id="3432088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3432092">uintptr</span><span class="op" id="3432099">(</span><span class="builtinfunc" id="3432100">len</span><span class="op" id="3432103">(</span><span class="ident" id="3432104">p</span><span class="op" id="3432105">)</span><span class="op" id="3432106">)</span><span class="op" id="3432107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3432111">uintptr</span><span class="op" id="3432118">(</span><span class="ident" id="3432119">flags</span><span class="op" id="3432124">)</span><span class="op" id="3432125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432128">if</span>&nbsp;<span class="ident" id="3432131">errno</span>&nbsp;<span class="op" id="3432137">!=</span>&nbsp;<span class="num" id="3432140">0</span>&nbsp;<span class="op" id="3432142">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432146">if</span>&nbsp;<span class="ident" id="3432149">errno</span>&nbsp;<span class="op" id="3432155">==</span>&nbsp;<span class="ident" id="3432158">stdsyscall</span><span class="op" id="3432168">.</span><span class="ident" id="3432169">ENOSYS</span>&nbsp;<span class="op" id="3432176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432181">atomic</span><span class="op" id="3432187">.</span><span class="ident" id="3432188">StoreInt32</span><span class="op" id="3432198">(</span><span class="op" id="3432199">&amp;</span><span class="ident" id="3432200">randomUnsupported</span><span class="op" id="3432217">,</span>&nbsp;<span class="num" id="3432219">1</span><span class="op" id="3432220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3432224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432228">return</span>&nbsp;<span class="num" id="3432235">0</span><span class="op" id="3432236">,</span>&nbsp;<span class="ident" id="3432238">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3432245">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432248">return</span>&nbsp;<span class="builtintype" id="3432255">int</span><span class="op" id="3432258">(</span><span class="ident" id="3432259">r1</span><span class="op" id="3432261">)</span><span class="op" id="3432262">,</span>&nbsp;<span class="ident" id="3432264">nil</span><br>
<span class="lineno"></span><span class="op" id="3432268">}</span>
</div>
</body>
</html>
