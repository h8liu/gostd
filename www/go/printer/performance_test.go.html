<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7089310">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7089365">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7089419">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7089470">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;simple&nbsp;printer&nbsp;performance&nbsp;benchmark:</span><br>
<span class="lineno"></span><span class="comment" id="7089534">//&nbsp;go&nbsp;test&nbsp;-bench=BenchmarkPrint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7089568">package</span>&nbsp;<span class="ident" id="7089576">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7089585">import</span>&nbsp;<span class="op" id="7089592">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7089595">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7089604">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7089614">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7089627">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7089633">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7089646">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7089653">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7089663">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7089666">var</span>&nbsp;<span class="ident" id="7089670">testfile</span>&nbsp;<span class="op" id="7089679">*</span><span class="ident" id="7089680">ast</span><span class="op" id="7089683">.</span><span class="ident" id="7089684">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7089690">func</span>&nbsp;<span class="ident" id="7089695">testprint</span><span class="op" id="7089704">(</span><span class="ident" id="7089705">out</span>&nbsp;<span class="ident" id="7089709">io</span><span class="op" id="7089711">.</span><span class="ident" id="7089712">Writer</span><span class="op" id="7089718">,</span>&nbsp;<span class="ident" id="7089720">file</span>&nbsp;<span class="op" id="7089725">*</span><span class="ident" id="7089726">ast</span><span class="op" id="7089729">.</span><span class="ident" id="7089730">File</span><span class="op" id="7089734">)</span>&nbsp;<span class="op" id="7089736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7089739">if</span>&nbsp;<span class="ident" id="7089742">err</span>&nbsp;<span class="op" id="7089746">:=</span>&nbsp;<span class="op" id="7089749">(</span><span class="op" id="7089750">&amp;</span><span class="ident" id="7089751">Config</span><span class="op" id="7089757">{</span><span class="ident" id="7089758">TabIndent</span>&nbsp;<span class="op" id="7089768">|</span>&nbsp;<span class="ident" id="7089770">UseSpaces</span><span class="op" id="7089779">,</span>&nbsp;<span class="num" id="7089781">8</span><span class="op" id="7089782">,</span>&nbsp;<span class="num" id="7089784">0</span><span class="op" id="7089785">}</span><span class="op" id="7089786">)</span><span class="op" id="7089787">.</span><span class="ident" id="7089788">Fprint</span><span class="op" id="7089794">(</span><span class="ident" id="7089795">out</span><span class="op" id="7089798">,</span>&nbsp;<span class="ident" id="7089800">fset</span><span class="op" id="7089804">,</span>&nbsp;<span class="ident" id="7089806">file</span><span class="op" id="7089810">)</span><span class="op" id="7089811">;</span>&nbsp;<span class="ident" id="7089813">err</span>&nbsp;<span class="op" id="7089817">!=</span>&nbsp;<span class="ident" id="7089820">nil</span>&nbsp;<span class="op" id="7089824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089828">log</span><span class="op" id="7089831">.</span><span class="ident" id="7089832">Fatalf</span><span class="op" id="7089838">(</span><span class="string" id="7089839">&#34;print&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7089856">,</span>&nbsp;<span class="ident" id="7089858">err</span><span class="op" id="7089861">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7089864">}</span><br>
<span class="lineno"></span><span class="op" id="7089866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7089869">//&nbsp;cannot&nbsp;initialize&nbsp;in&nbsp;init&nbsp;because&nbsp;(printer)&nbsp;Fprint&nbsp;launches&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="7089944">func</span>&nbsp;<span class="ident" id="7089949">initialize</span><span class="op" id="7089959">(</span><span class="op" id="7089960">)</span>&nbsp;<span class="op" id="7089962">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7089965">const</span>&nbsp;<span class="ident" id="7089971">filename</span>&nbsp;<span class="op" id="7089980">=</span>&nbsp;<span class="string" id="7089982">&#34;testdata/parser.go&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090005">src</span><span class="op" id="7090008">,</span>&nbsp;<span class="ident" id="7090010">err</span>&nbsp;<span class="op" id="7090014">:=</span>&nbsp;<span class="ident" id="7090017">ioutil</span><span class="op" id="7090023">.</span><span class="ident" id="7090024">ReadFile</span><span class="op" id="7090032">(</span><span class="ident" id="7090033">filename</span><span class="op" id="7090041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090044">if</span>&nbsp;<span class="ident" id="7090047">err</span>&nbsp;<span class="op" id="7090051">!=</span>&nbsp;<span class="ident" id="7090054">nil</span>&nbsp;<span class="op" id="7090058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090062">log</span><span class="op" id="7090065">.</span><span class="ident" id="7090066">Fatalf</span><span class="op" id="7090072">(</span><span class="string" id="7090073">&#34;%s&#34;</span><span class="op" id="7090077">,</span>&nbsp;<span class="ident" id="7090079">err</span><span class="op" id="7090082">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090089">file</span><span class="op" id="7090093">,</span>&nbsp;<span class="ident" id="7090095">err</span>&nbsp;<span class="op" id="7090099">:=</span>&nbsp;<span class="ident" id="7090102">parser</span><span class="op" id="7090108">.</span><span class="ident" id="7090109">ParseFile</span><span class="op" id="7090118">(</span><span class="ident" id="7090119">fset</span><span class="op" id="7090123">,</span>&nbsp;<span class="ident" id="7090125">filename</span><span class="op" id="7090133">,</span>&nbsp;<span class="ident" id="7090135">src</span><span class="op" id="7090138">,</span>&nbsp;<span class="ident" id="7090140">parser</span><span class="op" id="7090146">.</span><span class="ident" id="7090147">ParseComments</span><span class="op" id="7090160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090163">if</span>&nbsp;<span class="ident" id="7090166">err</span>&nbsp;<span class="op" id="7090170">!=</span>&nbsp;<span class="ident" id="7090173">nil</span>&nbsp;<span class="op" id="7090177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090181">log</span><span class="op" id="7090184">.</span><span class="ident" id="7090185">Fatalf</span><span class="op" id="7090191">(</span><span class="string" id="7090192">&#34;%s&#34;</span><span class="op" id="7090196">,</span>&nbsp;<span class="ident" id="7090198">err</span><span class="op" id="7090201">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090208">var</span>&nbsp;<span class="ident" id="7090212">buf</span>&nbsp;<span class="ident" id="7090216">bytes</span><span class="op" id="7090221">.</span><span class="ident" id="7090222">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090230">testprint</span><span class="op" id="7090239">(</span><span class="op" id="7090240">&amp;</span><span class="ident" id="7090241">buf</span><span class="op" id="7090244">,</span>&nbsp;<span class="ident" id="7090246">file</span><span class="op" id="7090250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090253">if</span>&nbsp;<span class="op" id="7090256">!</span><span class="ident" id="7090257">bytes</span><span class="op" id="7090262">.</span><span class="ident" id="7090263">Equal</span><span class="op" id="7090268">(</span><span class="ident" id="7090269">buf</span><span class="op" id="7090272">.</span><span class="ident" id="7090273">Bytes</span><span class="op" id="7090278">(</span><span class="op" id="7090279">)</span><span class="op" id="7090280">,</span>&nbsp;<span class="ident" id="7090282">src</span><span class="op" id="7090285">)</span>&nbsp;<span class="op" id="7090287">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090291">log</span><span class="op" id="7090294">.</span><span class="ident" id="7090295">Fatalf</span><span class="op" id="7090301">(</span><span class="string" id="7090302">&#34;print&nbsp;error:&nbsp;%s&nbsp;not&nbsp;idempotent&#34;</span><span class="op" id="7090334">,</span>&nbsp;<span class="ident" id="7090336">filename</span><span class="op" id="7090344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090351">testfile</span>&nbsp;<span class="op" id="7090360">=</span>&nbsp;<span class="ident" id="7090362">file</span><br>
<span class="lineno"></span><span class="op" id="7090367">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="7090370">func</span>&nbsp;<span class="ident" id="7090375">BenchmarkPrint</span><span class="op" id="7090389">(</span><span class="ident" id="7090390">b</span>&nbsp;<span class="op" id="7090392">*</span><span class="ident" id="7090393">testing</span><span class="op" id="7090400">.</span><span class="ident" id="7090401">B</span><span class="op" id="7090402">)</span>&nbsp;<span class="op" id="7090404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090407">if</span>&nbsp;<span class="ident" id="7090410">testfile</span>&nbsp;<span class="op" id="7090419">==</span>&nbsp;<span class="ident" id="7090422">nil</span>&nbsp;<span class="op" id="7090426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090430">initialize</span><span class="op" id="7090440">(</span><span class="op" id="7090441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090444">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090447">for</span>&nbsp;<span class="ident" id="7090451">i</span>&nbsp;<span class="op" id="7090453">:=</span>&nbsp;<span class="num" id="7090456">0</span><span class="op" id="7090457">;</span>&nbsp;<span class="ident" id="7090459">i</span>&nbsp;<span class="op" id="7090461">&lt;</span>&nbsp;<span class="ident" id="7090463">b</span><span class="op" id="7090464">.</span><span class="ident" id="7090465">N</span><span class="op" id="7090466">;</span>&nbsp;<span class="ident" id="7090468">i</span><span class="op" id="7090469">++</span>&nbsp;<span class="op" id="7090472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090476">testprint</span><span class="op" id="7090485">(</span><span class="ident" id="7090486">ioutil</span><span class="op" id="7090492">.</span><span class="ident" id="7090493">Discard</span><span class="op" id="7090500">,</span>&nbsp;<span class="ident" id="7090502">testfile</span><span class="op" id="7090510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090513">}</span><br>
<span class="lineno"></span><span class="op" id="7090515">}</span>
</div>
</body>
</html>
