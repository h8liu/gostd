<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2899788">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2899843">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2899897">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2899948">package</span>&nbsp;<span class="ident" id="2899956">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2899966">import</span>&nbsp;<span class="op" id="2899973">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2899976">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2899985">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2899992">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="2900002">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2900005">//&nbsp;urlFilter&nbsp;returns&nbsp;its&nbsp;input&nbsp;unless&nbsp;it&nbsp;contains&nbsp;an&nbsp;unsafe&nbsp;protocol&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2900083">//&nbsp;case&nbsp;it&nbsp;defangs&nbsp;the&nbsp;entire&nbsp;URL.</span><br>
<span class="lineno">15</span><span class="keyword" id="2900118">func</span>&nbsp;<span class="ident" id="2900123">urlFilter</span><span class="op" id="2900132">(</span><span class="ident" id="2900133">args</span>&nbsp;<span class="op" id="2900138">...</span><span class="keyword" id="2900141">interface</span><span class="op" id="2900150">{</span><span class="op" id="2900151">}</span><span class="op" id="2900152">)</span>&nbsp;<span class="builtintype" id="2900154">string</span>&nbsp;<span class="op" id="2900161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900164">s</span><span class="op" id="2900165">,</span>&nbsp;<span class="ident" id="2900167">t</span>&nbsp;<span class="op" id="2900169">:=</span>&nbsp;<span class="ident" id="2900172">stringify</span><span class="op" id="2900181">(</span><span class="ident" id="2900182">args</span><span class="op" id="2900186">...</span><span class="op" id="2900189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2900192">if</span>&nbsp;<span class="ident" id="2900195">t</span>&nbsp;<span class="op" id="2900197">==</span>&nbsp;<span class="ident" id="2900200">contentTypeURL</span>&nbsp;<span class="op" id="2900215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2900219">return</span>&nbsp;<span class="ident" id="2900226">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2900229">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2900232">if</span>&nbsp;<span class="ident" id="2900235">i</span>&nbsp;<span class="op" id="2900237">:=</span>&nbsp;<span class="ident" id="2900240">strings</span><span class="op" id="2900247">.</span><span class="ident" id="2900248">IndexRune</span><span class="op" id="2900257">(</span><span class="ident" id="2900258">s</span><span class="op" id="2900259">,</span>&nbsp;<span class="string" id="2900261">&#39;:&#39;</span><span class="op" id="2900264">)</span><span class="op" id="2900265">;</span>&nbsp;<span class="ident" id="2900267">i</span>&nbsp;<span class="op" id="2900269">&gt;=</span>&nbsp;<span class="num" id="2900272">0</span>&nbsp;<span class="op" id="2900274">&amp;&amp;</span>&nbsp;<span class="ident" id="2900277">strings</span><span class="op" id="2900284">.</span><span class="ident" id="2900285">IndexRune</span><span class="op" id="2900294">(</span><span class="ident" id="2900295">s</span><span class="op" id="2900296">[</span><span class="op" id="2900297">:</span><span class="ident" id="2900298">i</span><span class="op" id="2900299">]</span><span class="op" id="2900300">,</span>&nbsp;<span class="string" id="2900302">&#39;/&#39;</span><span class="op" id="2900305">)</span>&nbsp;<span class="op" id="2900307">&lt;</span>&nbsp;<span class="num" id="2900309">0</span>&nbsp;<span class="op" id="2900311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900315">protocol</span>&nbsp;<span class="op" id="2900324">:=</span>&nbsp;<span class="ident" id="2900327">strings</span><span class="op" id="2900334">.</span><span class="ident" id="2900335">ToLower</span><span class="op" id="2900342">(</span><span class="ident" id="2900343">s</span><span class="op" id="2900344">[</span><span class="op" id="2900345">:</span><span class="ident" id="2900346">i</span><span class="op" id="2900347">]</span><span class="op" id="2900348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2900352">if</span>&nbsp;<span class="ident" id="2900355">protocol</span>&nbsp;<span class="op" id="2900364">!=</span>&nbsp;<span class="string" id="2900367">&#34;http&#34;</span>&nbsp;<span class="op" id="2900374">&amp;&amp;</span>&nbsp;<span class="ident" id="2900377">protocol</span>&nbsp;<span class="op" id="2900386">!=</span>&nbsp;<span class="string" id="2900389">&#34;https&#34;</span>&nbsp;<span class="op" id="2900397">&amp;&amp;</span>&nbsp;<span class="ident" id="2900400">protocol</span>&nbsp;<span class="op" id="2900409">!=</span>&nbsp;<span class="string" id="2900412">&#34;mailto&#34;</span>&nbsp;<span class="op" id="2900421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2900426">return</span>&nbsp;<span class="string" id="2900433">&#34;#&#34;</span>&nbsp;<span class="op" id="2900437">+</span>&nbsp;<span class="ident" id="2900439">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2900456">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2900459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2900462">return</span>&nbsp;<span class="ident" id="2900469">s</span><br>
<span class="lineno"></span><span class="op" id="2900471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2900474">//&nbsp;urlEscaper&nbsp;produces&nbsp;an&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno">30</span><span class="comment" id="2900544">//&nbsp;The&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;without&nbsp;further&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="keyword" id="2900621">func</span>&nbsp;<span class="ident" id="2900626">urlEscaper</span><span class="op" id="2900636">(</span><span class="ident" id="2900637">args</span>&nbsp;<span class="op" id="2900642">...</span><span class="keyword" id="2900645">interface</span><span class="op" id="2900654">{</span><span class="op" id="2900655">}</span><span class="op" id="2900656">)</span>&nbsp;<span class="builtintype" id="2900658">string</span>&nbsp;<span class="op" id="2900665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2900668">return</span>&nbsp;<span class="ident" id="2900675">urlProcessor</span><span class="op" id="2900687">(</span><span class="builtintype" id="2900688">false</span><span class="op" id="2900693">,</span>&nbsp;<span class="ident" id="2900695">args</span><span class="op" id="2900699">...</span><span class="op" id="2900702">)</span><br>
<span class="lineno"></span><span class="op" id="2900704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="2900707">//&nbsp;urlEscaper&nbsp;normalizes&nbsp;URL&nbsp;content&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;quote-delimited</span><br>
<span class="lineno"></span><span class="comment" id="2900787">//&nbsp;string&nbsp;or&nbsp;parenthesis&nbsp;delimited&nbsp;url(...).</span><br>
<span class="lineno"></span><span class="comment" id="2900832">//&nbsp;The&nbsp;normalizer&nbsp;does&nbsp;not&nbsp;encode&nbsp;all&nbsp;HTML&nbsp;specials.&nbsp;Specifically,&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="2900911">//&nbsp;encode&nbsp;&#39;&amp;&#39;&nbsp;so&nbsp;correct&nbsp;embedding&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;requires&nbsp;escaping&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2900988">//&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;&#39;&amp;amp;&#39;.</span><br>
<span class="lineno">40</span><span class="keyword" id="2901007">func</span>&nbsp;<span class="ident" id="2901012">urlNormalizer</span><span class="op" id="2901025">(</span><span class="ident" id="2901026">args</span>&nbsp;<span class="op" id="2901031">...</span><span class="keyword" id="2901034">interface</span><span class="op" id="2901043">{</span><span class="op" id="2901044">}</span><span class="op" id="2901045">)</span>&nbsp;<span class="builtintype" id="2901047">string</span>&nbsp;<span class="op" id="2901054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2901057">return</span>&nbsp;<span class="ident" id="2901064">urlProcessor</span><span class="op" id="2901076">(</span><span class="builtintype" id="2901077">true</span><span class="op" id="2901081">,</span>&nbsp;<span class="ident" id="2901083">args</span><span class="op" id="2901087">...</span><span class="op" id="2901090">)</span><br>
<span class="lineno"></span><span class="op" id="2901092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2901095">//&nbsp;urlProcessor&nbsp;normalizes&nbsp;(when&nbsp;norm&nbsp;is&nbsp;true)&nbsp;or&nbsp;escapes&nbsp;its&nbsp;input&nbsp;to&nbsp;produce</span><br>
<span class="lineno">45</span><span class="comment" id="2901174">//&nbsp;a&nbsp;valid&nbsp;hierarchical&nbsp;or&nbsp;opaque&nbsp;URL&nbsp;part.</span><br>
<span class="lineno"></span><span class="keyword" id="2901218">func</span>&nbsp;<span class="ident" id="2901223">urlProcessor</span><span class="op" id="2901235">(</span><span class="ident" id="2901236">norm</span>&nbsp;<span class="builtintype" id="2901241">bool</span><span class="op" id="2901245">,</span>&nbsp;<span class="ident" id="2901247">args</span>&nbsp;<span class="op" id="2901252">...</span><span class="keyword" id="2901255">interface</span><span class="op" id="2901264">{</span><span class="op" id="2901265">}</span><span class="op" id="2901266">)</span>&nbsp;<span class="builtintype" id="2901268">string</span>&nbsp;<span class="op" id="2901275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901278">s</span><span class="op" id="2901279">,</span>&nbsp;<span class="ident" id="2901281">t</span>&nbsp;<span class="op" id="2901283">:=</span>&nbsp;<span class="ident" id="2901286">stringify</span><span class="op" id="2901295">(</span><span class="ident" id="2901296">args</span><span class="op" id="2901300">...</span><span class="op" id="2901303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2901306">if</span>&nbsp;<span class="ident" id="2901309">t</span>&nbsp;<span class="op" id="2901311">==</span>&nbsp;<span class="ident" id="2901314">contentTypeURL</span>&nbsp;<span class="op" id="2901329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901333">norm</span>&nbsp;<span class="op" id="2901338">=</span>&nbsp;<span class="builtintype" id="2901340">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2901346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2901349">var</span>&nbsp;<span class="ident" id="2901353">b</span>&nbsp;<span class="ident" id="2901355">bytes</span><span class="op" id="2901360">.</span><span class="ident" id="2901361">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901369">written</span>&nbsp;<span class="op" id="2901377">:=</span>&nbsp;<span class="num" id="2901380">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901383">//&nbsp;The&nbsp;byte&nbsp;loop&nbsp;below&nbsp;assumes&nbsp;that&nbsp;all&nbsp;URLs&nbsp;use&nbsp;UTF-8&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901446">//&nbsp;content-encoding.&nbsp;This&nbsp;is&nbsp;similar&nbsp;to&nbsp;the&nbsp;URI&nbsp;to&nbsp;IRI&nbsp;encoding&nbsp;scheme</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901518">//&nbsp;defined&nbsp;in&nbsp;section&nbsp;3.1&nbsp;of&nbsp;&nbsp;RFC&nbsp;3987,&nbsp;and&nbsp;behaves&nbsp;the&nbsp;same&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901587">//&nbsp;EcmaScript&nbsp;builtin&nbsp;encodeURIComponent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901630">//&nbsp;It&nbsp;should&nbsp;not&nbsp;cause&nbsp;any&nbsp;misencoding&nbsp;of&nbsp;URLs&nbsp;in&nbsp;pages&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901692">//&nbsp;Content-type:&nbsp;text/html;charset=UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2901735">for</span>&nbsp;<span class="ident" id="2901739">i</span><span class="op" id="2901740">,</span>&nbsp;<span class="ident" id="2901742">n</span>&nbsp;<span class="op" id="2901744">:=</span>&nbsp;<span class="num" id="2901747">0</span><span class="op" id="2901748">,</span>&nbsp;<span class="builtinfunc" id="2901750">len</span><span class="op" id="2901753">(</span><span class="ident" id="2901754">s</span><span class="op" id="2901755">)</span><span class="op" id="2901756">;</span>&nbsp;<span class="ident" id="2901758">i</span>&nbsp;<span class="op" id="2901760">&lt;</span>&nbsp;<span class="ident" id="2901762">n</span><span class="op" id="2901763">;</span>&nbsp;<span class="ident" id="2901765">i</span><span class="op" id="2901766">++</span>&nbsp;<span class="op" id="2901769">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901773">c</span>&nbsp;<span class="op" id="2901775">:=</span>&nbsp;<span class="ident" id="2901778">s</span><span class="op" id="2901779">[</span><span class="ident" id="2901780">i</span><span class="op" id="2901781">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2901785">switch</span>&nbsp;<span class="ident" id="2901792">c</span>&nbsp;<span class="op" id="2901794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901798">//&nbsp;Single&nbsp;quote&nbsp;and&nbsp;parens&nbsp;are&nbsp;sub-delims&nbsp;in&nbsp;RFC&nbsp;3986,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901862">//&nbsp;escape&nbsp;them&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901919">//&nbsp;quoted&nbsp;attributes&nbsp;and&nbsp;unquoted&nbsp;CSS&nbsp;url(...)&nbsp;constructs.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901980">//&nbsp;Single&nbsp;quotes&nbsp;are&nbsp;reserved&nbsp;in&nbsp;URLs,&nbsp;but&nbsp;are&nbsp;only&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2902042">//&nbsp;the&nbsp;obsolete&nbsp;&#34;mark&#34;&nbsp;rule&nbsp;in&nbsp;an&nbsp;appendix&nbsp;in&nbsp;RFC&nbsp;3986</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2902099">//&nbsp;so&nbsp;can&nbsp;be&nbsp;safely&nbsp;encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902130">case</span>&nbsp;<span class="string" id="2902135">&#39;!&#39;</span><span class="op" id="2902138">,</span>&nbsp;<span class="string" id="2902140">&#39;#&#39;</span><span class="op" id="2902143">,</span>&nbsp;<span class="string" id="2902145">&#39;$&#39;</span><span class="op" id="2902148">,</span>&nbsp;<span class="string" id="2902150">&#39;&amp;&#39;</span><span class="op" id="2902153">,</span>&nbsp;<span class="string" id="2902155">&#39;*&#39;</span><span class="op" id="2902158">,</span>&nbsp;<span class="string" id="2902160">&#39;+&#39;</span><span class="op" id="2902163">,</span>&nbsp;<span class="string" id="2902165">&#39;,&#39;</span><span class="op" id="2902168">,</span>&nbsp;<span class="string" id="2902170">&#39;/&#39;</span><span class="op" id="2902173">,</span>&nbsp;<span class="string" id="2902175">&#39;:&#39;</span><span class="op" id="2902178">,</span>&nbsp;<span class="string" id="2902180">&#39;;&#39;</span><span class="op" id="2902183">,</span>&nbsp;<span class="string" id="2902185">&#39;=&#39;</span><span class="op" id="2902188">,</span>&nbsp;<span class="string" id="2902190">&#39;?&#39;</span><span class="op" id="2902193">,</span>&nbsp;<span class="string" id="2902195">&#39;@&#39;</span><span class="op" id="2902198">,</span>&nbsp;<span class="string" id="2902200">&#39;[&#39;</span><span class="op" id="2902203">,</span>&nbsp;<span class="string" id="2902205">&#39;]&#39;</span><span class="op" id="2902208">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902213">if</span>&nbsp;<span class="ident" id="2902216">norm</span>&nbsp;<span class="op" id="2902221">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902227">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2902239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2902243">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2902289">//&nbsp;&#34;For&nbsp;consistency,&nbsp;percent-encoded&nbsp;octets&nbsp;in&nbsp;the&nbsp;ranges&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2902352">//&nbsp;ALPHA&nbsp;(%41-%5A&nbsp;and&nbsp;%61-%7A),&nbsp;DIGIT&nbsp;(%30-%39),&nbsp;hyphen&nbsp;(%2D),</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2902417">//&nbsp;period&nbsp;(%2E),&nbsp;underscore&nbsp;(%5F),&nbsp;or&nbsp;tilde&nbsp;(%7E)&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2902483">//&nbsp;created&nbsp;by&nbsp;URI&nbsp;producers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902513">case</span>&nbsp;<span class="string" id="2902518">&#39;-&#39;</span><span class="op" id="2902521">,</span>&nbsp;<span class="string" id="2902523">&#39;.&#39;</span><span class="op" id="2902526">,</span>&nbsp;<span class="string" id="2902528">&#39;_&#39;</span><span class="op" id="2902531">,</span>&nbsp;<span class="string" id="2902533">&#39;~&#39;</span><span class="op" id="2902536">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902541">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902552">case</span>&nbsp;<span class="string" id="2902557">&#39;%&#39;</span><span class="op" id="2902560">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2902565">//&nbsp;When&nbsp;normalizing&nbsp;do&nbsp;not&nbsp;re-encode&nbsp;valid&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902620">if</span>&nbsp;<span class="ident" id="2902623">norm</span>&nbsp;<span class="op" id="2902628">&amp;&amp;</span>&nbsp;<span class="ident" id="2902631">i</span><span class="op" id="2902632">+</span><span class="num" id="2902633">2</span>&nbsp;<span class="op" id="2902635">&lt;</span>&nbsp;<span class="builtinfunc" id="2902637">len</span><span class="op" id="2902640">(</span><span class="ident" id="2902641">s</span><span class="op" id="2902642">)</span>&nbsp;<span class="op" id="2902644">&amp;&amp;</span>&nbsp;<span class="ident" id="2902647">isHex</span><span class="op" id="2902652">(</span><span class="ident" id="2902653">s</span><span class="op" id="2902654">[</span><span class="ident" id="2902655">i</span><span class="op" id="2902656">+</span><span class="num" id="2902657">1</span><span class="op" id="2902658">]</span><span class="op" id="2902659">)</span>&nbsp;<span class="op" id="2902661">&amp;&amp;</span>&nbsp;<span class="ident" id="2902664">isHex</span><span class="op" id="2902669">(</span><span class="ident" id="2902670">s</span><span class="op" id="2902671">[</span><span class="ident" id="2902672">i</span><span class="op" id="2902673">+</span><span class="num" id="2902674">2</span><span class="op" id="2902675">]</span><span class="op" id="2902676">)</span>&nbsp;<span class="op" id="2902678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902684">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2902696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902700">default</span><span class="op" id="2902707">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2902712">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902759">if</span>&nbsp;<span class="string" id="2902762">&#39;a&#39;</span>&nbsp;<span class="op" id="2902766">&lt;=</span>&nbsp;<span class="ident" id="2902769">c</span>&nbsp;<span class="op" id="2902771">&amp;&amp;</span>&nbsp;<span class="ident" id="2902774">c</span>&nbsp;<span class="op" id="2902776">&lt;=</span>&nbsp;<span class="string" id="2902779">&#39;z&#39;</span>&nbsp;<span class="op" id="2902783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902789">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2902801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902806">if</span>&nbsp;<span class="string" id="2902809">&#39;A&#39;</span>&nbsp;<span class="op" id="2902813">&lt;=</span>&nbsp;<span class="ident" id="2902816">c</span>&nbsp;<span class="op" id="2902818">&amp;&amp;</span>&nbsp;<span class="ident" id="2902821">c</span>&nbsp;<span class="op" id="2902823">&lt;=</span>&nbsp;<span class="string" id="2902826">&#39;Z&#39;</span>&nbsp;<span class="op" id="2902830">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902836">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2902848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902853">if</span>&nbsp;<span class="string" id="2902856">&#39;0&#39;</span>&nbsp;<span class="op" id="2902860">&lt;=</span>&nbsp;<span class="ident" id="2902863">c</span>&nbsp;<span class="op" id="2902865">&amp;&amp;</span>&nbsp;<span class="ident" id="2902868">c</span>&nbsp;<span class="op" id="2902870">&lt;=</span>&nbsp;<span class="string" id="2902873">&#39;9&#39;</span>&nbsp;<span class="op" id="2902877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902883">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2902895">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2902899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2902903">b</span><span class="op" id="2902904">.</span><span class="ident" id="2902905">WriteString</span><span class="op" id="2902916">(</span><span class="ident" id="2902917">s</span><span class="op" id="2902918">[</span><span class="ident" id="2902919">written</span><span class="op" id="2902926">:</span><span class="ident" id="2902927">i</span><span class="op" id="2902928">]</span><span class="op" id="2902929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2902933">fmt</span><span class="op" id="2902936">.</span><span class="ident" id="2902937">Fprintf</span><span class="op" id="2902944">(</span><span class="op" id="2902945">&amp;</span><span class="ident" id="2902946">b</span><span class="op" id="2902947">,</span>&nbsp;<span class="string" id="2902949">&#34;%%%02x&#34;</span><span class="op" id="2902957">,</span>&nbsp;<span class="ident" id="2902959">c</span><span class="op" id="2902960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2902964">written</span>&nbsp;<span class="op" id="2902972">=</span>&nbsp;<span class="ident" id="2902974">i</span>&nbsp;<span class="op" id="2902976">+</span>&nbsp;<span class="num" id="2902978">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2902981">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902984">if</span>&nbsp;<span class="ident" id="2902987">written</span>&nbsp;<span class="op" id="2902995">==</span>&nbsp;<span class="num" id="2902998">0</span>&nbsp;<span class="op" id="2903000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2903004">return</span>&nbsp;<span class="ident" id="2903011">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2903014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903017">b</span><span class="op" id="2903018">.</span><span class="ident" id="2903019">WriteString</span><span class="op" id="2903030">(</span><span class="ident" id="2903031">s</span><span class="op" id="2903032">[</span><span class="ident" id="2903033">written</span><span class="op" id="2903040">:</span><span class="op" id="2903041">]</span><span class="op" id="2903042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2903045">return</span>&nbsp;<span class="ident" id="2903052">b</span><span class="op" id="2903053">.</span><span class="ident" id="2903054">String</span><span class="op" id="2903060">(</span><span class="op" id="2903061">)</span><br>
<span class="lineno">105</span><span class="op" id="2903063">}</span>
</div>
</body>
</html>
