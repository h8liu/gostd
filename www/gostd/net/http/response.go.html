<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html" class="current">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3868806">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3868861">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3868915">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3868966">//&nbsp;HTTP&nbsp;Response&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3869005">package</span>&nbsp;<span class="ident" id="3869013">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3869019">import</span>&nbsp;<span class="op" id="3869026">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3869029">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3869038">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3869047">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3869061">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3869071">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3869077">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3869094">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3869105">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3869116">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3869126">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3869129">var</span>&nbsp;<span class="ident" id="3869133">respExcludeHeader</span>&nbsp;<span class="op" id="3869151">=</span>&nbsp;<span class="keyword" id="3869153">map</span><span class="op" id="3869156">[</span><span class="builtintype" id="3869157">string</span><span class="op" id="3869163">]</span><span class="builtintype" id="3869164">bool</span><span class="op" id="3869168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3869171">&#34;Content-Length&#34;</span><span class="op" id="3869187">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3869192">true</span><span class="op" id="3869196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3869199">&#34;Transfer-Encoding&#34;</span><span class="op" id="3869218">:</span>&nbsp;<span class="builtintype" id="3869220">true</span><span class="op" id="3869224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3869227">&#34;Trailer&#34;</span><span class="op" id="3869236">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3869248">true</span><span class="op" id="3869252">,</span><br>
<span class="lineno">25</span><span class="op" id="3869254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3869257">//&nbsp;Response&nbsp;represents&nbsp;the&nbsp;response&nbsp;from&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3869315">//</span><br>
<span class="lineno"></span><span class="keyword" id="3869318">type</span>&nbsp;<span class="ident" id="3869323">Response</span>&nbsp;<span class="keyword" id="3869332">struct</span>&nbsp;<span class="op" id="3869339">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869342">Status</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3869353">string</span>&nbsp;<span class="comment" id="3869360">//&nbsp;e.g.&nbsp;&#34;200&nbsp;OK&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869378">StatusCode</span>&nbsp;<span class="builtintype" id="3869389">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869396">//&nbsp;e.g.&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869409">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3869420">string</span>&nbsp;<span class="comment" id="3869427">//&nbsp;e.g.&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869447">ProtoMajor</span>&nbsp;<span class="builtintype" id="3869458">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869465">//&nbsp;e.g.&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869476">ProtoMinor</span>&nbsp;<span class="builtintype" id="3869487">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869494">//&nbsp;e.g.&nbsp;0</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3869506">//&nbsp;Header&nbsp;maps&nbsp;header&nbsp;keys&nbsp;to&nbsp;values.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;had&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3869575">//&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;key,&nbsp;they&nbsp;may&nbsp;be&nbsp;concatenated,&nbsp;with&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3869643">//&nbsp;delimiters.&nbsp;&nbsp;(Section&nbsp;4.2&nbsp;of&nbsp;RFC&nbsp;2616&nbsp;requires&nbsp;that&nbsp;multiple&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3869716">//&nbsp;be&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;comma-delimited&nbsp;sequence.)&nbsp;Values</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3869786">//&nbsp;duplicated&nbsp;by&nbsp;other&nbsp;fields&nbsp;in&nbsp;this&nbsp;struct&nbsp;(e.g.,&nbsp;ContentLength)&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3869858">//&nbsp;omitted&nbsp;from&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3869883">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3869887">//&nbsp;Keys&nbsp;in&nbsp;the&nbsp;map&nbsp;are&nbsp;canonicalized&nbsp;(see&nbsp;CanonicalHeaderKey).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869951">Header</span>&nbsp;<span class="ident" id="3869958">Header</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3869967">//&nbsp;Body&nbsp;represents&nbsp;the&nbsp;response&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870006">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870010">//&nbsp;The&nbsp;http&nbsp;Client&nbsp;and&nbsp;Transport&nbsp;guarantee&nbsp;that&nbsp;Body&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870074">//&nbsp;non-nil,&nbsp;even&nbsp;on&nbsp;responses&nbsp;without&nbsp;a&nbsp;body&nbsp;or&nbsp;responses&nbsp;with</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870138">//&nbsp;a&nbsp;zero-length&nbsp;body.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870199">//&nbsp;close&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870215">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870219">//&nbsp;The&nbsp;Body&nbsp;is&nbsp;automatically&nbsp;dechunked&nbsp;if&nbsp;the&nbsp;server&nbsp;replied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870281">//&nbsp;with&nbsp;a&nbsp;&#34;chunked&#34;&nbsp;Transfer-Encoding.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870321">Body</span>&nbsp;<span class="ident" id="3870326">io</span><span class="op" id="3870328">.</span><span class="ident" id="3870329">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870342">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870411">//&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.&nbsp;&nbsp;Unless&nbsp;Request.Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870485">//&nbsp;is&nbsp;&#34;HEAD&#34;,&nbsp;values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870556">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870579">ContentLength</span>&nbsp;<span class="ident" id="3870593">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870601">//&nbsp;Contains&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outer-most&nbsp;to&nbsp;inner-most.&nbsp;Value&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870673">//&nbsp;nil,&nbsp;means&nbsp;that&nbsp;&#34;identity&#34;&nbsp;encoding&nbsp;is&nbsp;used.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870722">TransferEncoding</span>&nbsp;<span class="op" id="3870739">[</span><span class="op" id="3870740">]</span><span class="builtintype" id="3870741">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870750">//&nbsp;Close&nbsp;records&nbsp;whether&nbsp;the&nbsp;header&nbsp;directed&nbsp;that&nbsp;the&nbsp;connection&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870819">//&nbsp;closed&nbsp;after&nbsp;reading&nbsp;Body.&nbsp;&nbsp;The&nbsp;value&nbsp;is&nbsp;advice&nbsp;for&nbsp;clients:&nbsp;neither</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870892">//&nbsp;ReadResponse&nbsp;nor&nbsp;Response.Write&nbsp;ever&nbsp;closes&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870954">Close</span>&nbsp;<span class="builtintype" id="3870960">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870967">//&nbsp;Trailer&nbsp;maps&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;values,&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3871020">//&nbsp;format&nbsp;as&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871046">Trailer</span>&nbsp;<span class="ident" id="3871054">Header</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3871063">//&nbsp;The&nbsp;Request&nbsp;that&nbsp;was&nbsp;sent&nbsp;to&nbsp;obtain&nbsp;this&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3871118">//&nbsp;Request&#39;s&nbsp;Body&nbsp;is&nbsp;nil&nbsp;(having&nbsp;already&nbsp;been&nbsp;consumed).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3871176">//&nbsp;This&nbsp;is&nbsp;only&nbsp;populated&nbsp;for&nbsp;Client&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871224">Request</span>&nbsp;<span class="op" id="3871232">*</span><span class="ident" id="3871233">Request</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3871243">//&nbsp;TLS&nbsp;contains&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3871310">//&nbsp;response&nbsp;was&nbsp;received.&nbsp;It&nbsp;is&nbsp;nil&nbsp;for&nbsp;unencrypted&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3871374">//&nbsp;The&nbsp;pointer&nbsp;is&nbsp;shared&nbsp;between&nbsp;responses&nbsp;and&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3871436">//&nbsp;modified.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871450">TLS</span>&nbsp;<span class="op" id="3871454">*</span><span class="ident" id="3871455">tls</span><span class="op" id="3871458">.</span><span class="ident" id="3871459">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="3871475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3871478">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;cookies&nbsp;set&nbsp;in&nbsp;the&nbsp;Set-Cookie&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="3871551">func</span>&nbsp;<span class="op" id="3871556">(</span><span class="ident" id="3871557">r</span>&nbsp;<span class="op" id="3871559">*</span><span class="ident" id="3871560">Response</span><span class="op" id="3871568">)</span>&nbsp;<span class="ident" id="3871570">Cookies</span><span class="op" id="3871577">(</span><span class="op" id="3871578">)</span>&nbsp;<span class="op" id="3871580">[</span><span class="op" id="3871581">]</span><span class="op" id="3871582">*</span><span class="ident" id="3871583">Cookie</span>&nbsp;<span class="op" id="3871590">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3871593">return</span>&nbsp;<span class="ident" id="3871600">readSetCookies</span><span class="op" id="3871614">(</span><span class="ident" id="3871615">r</span><span class="op" id="3871616">.</span><span class="ident" id="3871617">Header</span><span class="op" id="3871623">)</span><br>
<span class="lineno"></span><span class="op" id="3871625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3871628">var</span>&nbsp;<span class="ident" id="3871632">ErrNoLocation</span>&nbsp;<span class="op" id="3871646">=</span>&nbsp;<span class="ident" id="3871648">errors</span><span class="op" id="3871654">.</span><span class="ident" id="3871655">New</span><span class="op" id="3871658">(</span><span class="string" id="3871659">&#34;http:&nbsp;no&nbsp;Location&nbsp;header&nbsp;in&nbsp;response&#34;</span><span class="op" id="3871697">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3871700">//&nbsp;Location&nbsp;returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;&#34;Location&#34;&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="3871765">//&nbsp;if&nbsp;present.&nbsp;&nbsp;Relative&nbsp;redirects&nbsp;are&nbsp;resolved&nbsp;relative&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3871825">//&nbsp;the&nbsp;Response&#39;s&nbsp;Request.&nbsp;&nbsp;ErrNoLocation&nbsp;is&nbsp;returned&nbsp;if&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="3871885">//&nbsp;Location&nbsp;header&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span><span class="keyword" id="3871916">func</span>&nbsp;<span class="op" id="3871921">(</span><span class="ident" id="3871922">r</span>&nbsp;<span class="op" id="3871924">*</span><span class="ident" id="3871925">Response</span><span class="op" id="3871933">)</span>&nbsp;<span class="ident" id="3871935">Location</span><span class="op" id="3871943">(</span><span class="op" id="3871944">)</span>&nbsp;<span class="op" id="3871946">(</span><span class="op" id="3871947">*</span><span class="ident" id="3871948">url</span><span class="op" id="3871951">.</span><span class="ident" id="3871952">URL</span><span class="op" id="3871955">,</span>&nbsp;<span class="builtintype" id="3871957">error</span><span class="op" id="3871962">)</span>&nbsp;<span class="op" id="3871964">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871967">lv</span>&nbsp;<span class="op" id="3871970">:=</span>&nbsp;<span class="ident" id="3871973">r</span><span class="op" id="3871974">.</span><span class="ident" id="3871975">Header</span><span class="op" id="3871981">.</span><span class="ident" id="3871982">Get</span><span class="op" id="3871985">(</span><span class="string" id="3871986">&#34;Location&#34;</span><span class="op" id="3871996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3871999">if</span>&nbsp;<span class="ident" id="3872002">lv</span>&nbsp;<span class="op" id="3872005">==</span>&nbsp;<span class="string" id="3872008">&#34;&#34;</span>&nbsp;<span class="op" id="3872011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872015">return</span>&nbsp;<span class="ident" id="3872022">nil</span><span class="op" id="3872025">,</span>&nbsp;<span class="ident" id="3872027">ErrNoLocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872045">if</span>&nbsp;<span class="ident" id="3872048">r</span><span class="op" id="3872049">.</span><span class="ident" id="3872050">Request</span>&nbsp;<span class="op" id="3872058">!=</span>&nbsp;<span class="ident" id="3872061">nil</span>&nbsp;<span class="op" id="3872065">&amp;&amp;</span>&nbsp;<span class="ident" id="3872068">r</span><span class="op" id="3872069">.</span><span class="ident" id="3872070">Request</span><span class="op" id="3872077">.</span><span class="ident" id="3872078">URL</span>&nbsp;<span class="op" id="3872082">!=</span>&nbsp;<span class="ident" id="3872085">nil</span>&nbsp;<span class="op" id="3872089">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872093">return</span>&nbsp;<span class="ident" id="3872100">r</span><span class="op" id="3872101">.</span><span class="ident" id="3872102">Request</span><span class="op" id="3872109">.</span><span class="ident" id="3872110">URL</span><span class="op" id="3872113">.</span><span class="ident" id="3872114">Parse</span><span class="op" id="3872119">(</span><span class="ident" id="3872120">lv</span><span class="op" id="3872122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872128">return</span>&nbsp;<span class="ident" id="3872135">url</span><span class="op" id="3872138">.</span><span class="ident" id="3872139">Parse</span><span class="op" id="3872144">(</span><span class="ident" id="3872145">lv</span><span class="op" id="3872147">)</span><br>
<span class="lineno"></span><span class="op" id="3872149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3872152">//&nbsp;ReadResponse&nbsp;reads&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3872211">//&nbsp;The&nbsp;req&nbsp;parameter&nbsp;optionally&nbsp;specifies&nbsp;the&nbsp;Request&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="3872282">//&nbsp;to&nbsp;this&nbsp;Response.&nbsp;If&nbsp;nil,&nbsp;a&nbsp;GET&nbsp;request&nbsp;is&nbsp;assumed.</span><br>
<span class="lineno"></span><span class="comment" id="3872337">//&nbsp;Clients&nbsp;must&nbsp;call&nbsp;resp.Body.Close&nbsp;when&nbsp;finished&nbsp;reading&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3872407">//&nbsp;After&nbsp;that&nbsp;call,&nbsp;clients&nbsp;can&nbsp;inspect&nbsp;resp.Trailer&nbsp;to&nbsp;find&nbsp;key/value</span><br>
<span class="lineno">115</span><span class="comment" id="3872478">//&nbsp;pairs&nbsp;included&nbsp;in&nbsp;the&nbsp;response&nbsp;trailer.</span><br>
<span class="lineno"></span><span class="keyword" id="3872521">func</span>&nbsp;<span class="ident" id="3872526">ReadResponse</span><span class="op" id="3872538">(</span><span class="ident" id="3872539">r</span>&nbsp;<span class="op" id="3872541">*</span><span class="ident" id="3872542">bufio</span><span class="op" id="3872547">.</span><span class="ident" id="3872548">Reader</span><span class="op" id="3872554">,</span>&nbsp;<span class="ident" id="3872556">req</span>&nbsp;<span class="op" id="3872560">*</span><span class="ident" id="3872561">Request</span><span class="op" id="3872568">)</span>&nbsp;<span class="op" id="3872570">(</span><span class="op" id="3872571">*</span><span class="ident" id="3872572">Response</span><span class="op" id="3872580">,</span>&nbsp;<span class="builtintype" id="3872582">error</span><span class="op" id="3872587">)</span>&nbsp;<span class="op" id="3872589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872592">tp</span>&nbsp;<span class="op" id="3872595">:=</span>&nbsp;<span class="ident" id="3872598">textproto</span><span class="op" id="3872607">.</span><span class="ident" id="3872608">NewReader</span><span class="op" id="3872617">(</span><span class="ident" id="3872618">r</span><span class="op" id="3872619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872622">resp</span>&nbsp;<span class="op" id="3872627">:=</span>&nbsp;<span class="op" id="3872630">&amp;</span><span class="ident" id="3872631">Response</span><span class="op" id="3872639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872643">Request</span><span class="op" id="3872650">:</span>&nbsp;<span class="ident" id="3872652">req</span><span class="op" id="3872655">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3872662">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872704">line</span><span class="op" id="3872708">,</span>&nbsp;<span class="ident" id="3872710">err</span>&nbsp;<span class="op" id="3872714">:=</span>&nbsp;<span class="ident" id="3872717">tp</span><span class="op" id="3872719">.</span><span class="ident" id="3872720">ReadLine</span><span class="op" id="3872728">(</span><span class="op" id="3872729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872732">if</span>&nbsp;<span class="ident" id="3872735">err</span>&nbsp;<span class="op" id="3872739">!=</span>&nbsp;<span class="ident" id="3872742">nil</span>&nbsp;<span class="op" id="3872746">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872750">if</span>&nbsp;<span class="ident" id="3872753">err</span>&nbsp;<span class="op" id="3872757">==</span>&nbsp;<span class="ident" id="3872760">io</span><span class="op" id="3872762">.</span><span class="ident" id="3872763">EOF</span>&nbsp;<span class="op" id="3872767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872772">err</span>&nbsp;<span class="op" id="3872776">=</span>&nbsp;<span class="ident" id="3872778">io</span><span class="op" id="3872780">.</span><span class="ident" id="3872781">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872804">return</span>&nbsp;<span class="ident" id="3872811">nil</span><span class="op" id="3872814">,</span>&nbsp;<span class="ident" id="3872816">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872821">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872824">f</span>&nbsp;<span class="op" id="3872826">:=</span>&nbsp;<span class="ident" id="3872829">strings</span><span class="op" id="3872836">.</span><span class="ident" id="3872837">SplitN</span><span class="op" id="3872843">(</span><span class="ident" id="3872844">line</span><span class="op" id="3872848">,</span>&nbsp;<span class="string" id="3872850">&#34;&nbsp;&#34;</span><span class="op" id="3872853">,</span>&nbsp;<span class="num" id="3872855">3</span><span class="op" id="3872856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872859">if</span>&nbsp;<span class="builtinfunc" id="3872862">len</span><span class="op" id="3872865">(</span><span class="ident" id="3872866">f</span><span class="op" id="3872867">)</span>&nbsp;<span class="op" id="3872869">&lt;</span>&nbsp;<span class="num" id="3872871">2</span>&nbsp;<span class="op" id="3872873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872877">return</span>&nbsp;<span class="ident" id="3872884">nil</span><span class="op" id="3872887">,</span>&nbsp;<span class="op" id="3872889">&amp;</span><span class="ident" id="3872890">badStringError</span><span class="op" id="3872904">{</span><span class="string" id="3872905">&#34;malformed&nbsp;HTTP&nbsp;response&#34;</span><span class="op" id="3872930">,</span>&nbsp;<span class="ident" id="3872932">line</span><span class="op" id="3872936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872942">reasonPhrase</span>&nbsp;<span class="op" id="3872955">:=</span>&nbsp;<span class="string" id="3872958">&#34;&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872962">if</span>&nbsp;<span class="builtinfunc" id="3872965">len</span><span class="op" id="3872968">(</span><span class="ident" id="3872969">f</span><span class="op" id="3872970">)</span>&nbsp;<span class="op" id="3872972">&gt;</span>&nbsp;<span class="num" id="3872974">2</span>&nbsp;<span class="op" id="3872976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872980">reasonPhrase</span>&nbsp;<span class="op" id="3872993">=</span>&nbsp;<span class="ident" id="3872995">f</span><span class="op" id="3872996">[</span><span class="num" id="3872997">2</span><span class="op" id="3872998">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873004">resp</span><span class="op" id="3873008">.</span><span class="ident" id="3873009">Status</span>&nbsp;<span class="op" id="3873016">=</span>&nbsp;<span class="ident" id="3873018">f</span><span class="op" id="3873019">[</span><span class="num" id="3873020">1</span><span class="op" id="3873021">]</span>&nbsp;<span class="op" id="3873023">+</span>&nbsp;<span class="string" id="3873025">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3873029">+</span>&nbsp;<span class="ident" id="3873031">reasonPhrase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873045">resp</span><span class="op" id="3873049">.</span><span class="ident" id="3873050">StatusCode</span><span class="op" id="3873060">,</span>&nbsp;<span class="ident" id="3873062">err</span>&nbsp;<span class="op" id="3873066">=</span>&nbsp;<span class="ident" id="3873068">strconv</span><span class="op" id="3873075">.</span><span class="ident" id="3873076">Atoi</span><span class="op" id="3873080">(</span><span class="ident" id="3873081">f</span><span class="op" id="3873082">[</span><span class="num" id="3873083">1</span><span class="op" id="3873084">]</span><span class="op" id="3873085">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873088">if</span>&nbsp;<span class="ident" id="3873091">err</span>&nbsp;<span class="op" id="3873095">!=</span>&nbsp;<span class="ident" id="3873098">nil</span>&nbsp;<span class="op" id="3873102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873106">return</span>&nbsp;<span class="ident" id="3873113">nil</span><span class="op" id="3873116">,</span>&nbsp;<span class="op" id="3873118">&amp;</span><span class="ident" id="3873119">badStringError</span><span class="op" id="3873133">{</span><span class="string" id="3873134">&#34;malformed&nbsp;HTTP&nbsp;status&nbsp;code&#34;</span><span class="op" id="3873162">,</span>&nbsp;<span class="ident" id="3873164">f</span><span class="op" id="3873165">[</span><span class="num" id="3873166">1</span><span class="op" id="3873167">]</span><span class="op" id="3873168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873175">resp</span><span class="op" id="3873179">.</span><span class="ident" id="3873180">Proto</span>&nbsp;<span class="op" id="3873186">=</span>&nbsp;<span class="ident" id="3873188">f</span><span class="op" id="3873189">[</span><span class="num" id="3873190">0</span><span class="op" id="3873191">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873194">var</span>&nbsp;<span class="ident" id="3873198">ok</span>&nbsp;<span class="builtintype" id="3873201">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873207">if</span>&nbsp;<span class="ident" id="3873210">resp</span><span class="op" id="3873214">.</span><span class="ident" id="3873215">ProtoMajor</span><span class="op" id="3873225">,</span>&nbsp;<span class="ident" id="3873227">resp</span><span class="op" id="3873231">.</span><span class="ident" id="3873232">ProtoMinor</span><span class="op" id="3873242">,</span>&nbsp;<span class="ident" id="3873244">ok</span>&nbsp;<span class="op" id="3873247">=</span>&nbsp;<span class="ident" id="3873249">ParseHTTPVersion</span><span class="op" id="3873265">(</span><span class="ident" id="3873266">resp</span><span class="op" id="3873270">.</span><span class="ident" id="3873271">Proto</span><span class="op" id="3873276">)</span><span class="op" id="3873277">;</span>&nbsp;<span class="op" id="3873279">!</span><span class="ident" id="3873280">ok</span>&nbsp;<span class="op" id="3873283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873287">return</span>&nbsp;<span class="ident" id="3873294">nil</span><span class="op" id="3873297">,</span>&nbsp;<span class="op" id="3873299">&amp;</span><span class="ident" id="3873300">badStringError</span><span class="op" id="3873314">{</span><span class="string" id="3873315">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="3873339">,</span>&nbsp;<span class="ident" id="3873341">resp</span><span class="op" id="3873345">.</span><span class="ident" id="3873346">Proto</span><span class="op" id="3873351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3873358">//&nbsp;Parse&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873390">mimeHeader</span><span class="op" id="3873400">,</span>&nbsp;<span class="ident" id="3873402">err</span>&nbsp;<span class="op" id="3873406">:=</span>&nbsp;<span class="ident" id="3873409">tp</span><span class="op" id="3873411">.</span><span class="ident" id="3873412">ReadMIMEHeader</span><span class="op" id="3873426">(</span><span class="op" id="3873427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873430">if</span>&nbsp;<span class="ident" id="3873433">err</span>&nbsp;<span class="op" id="3873437">!=</span>&nbsp;<span class="ident" id="3873440">nil</span>&nbsp;<span class="op" id="3873444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873448">if</span>&nbsp;<span class="ident" id="3873451">err</span>&nbsp;<span class="op" id="3873455">==</span>&nbsp;<span class="ident" id="3873458">io</span><span class="op" id="3873460">.</span><span class="ident" id="3873461">EOF</span>&nbsp;<span class="op" id="3873465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873470">err</span>&nbsp;<span class="op" id="3873474">=</span>&nbsp;<span class="ident" id="3873476">io</span><span class="op" id="3873478">.</span><span class="ident" id="3873479">ErrUnexpectedEOF</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873502">return</span>&nbsp;<span class="ident" id="3873509">nil</span><span class="op" id="3873512">,</span>&nbsp;<span class="ident" id="3873514">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873522">resp</span><span class="op" id="3873526">.</span><span class="ident" id="3873527">Header</span>&nbsp;<span class="op" id="3873534">=</span>&nbsp;<span class="ident" id="3873536">Header</span><span class="op" id="3873542">(</span><span class="ident" id="3873543">mimeHeader</span><span class="op" id="3873553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873557">fixPragmaCacheControl</span><span class="op" id="3873578">(</span><span class="ident" id="3873579">resp</span><span class="op" id="3873583">.</span><span class="ident" id="3873584">Header</span><span class="op" id="3873590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873594">err</span>&nbsp;<span class="op" id="3873598">=</span>&nbsp;<span class="ident" id="3873600">readTransfer</span><span class="op" id="3873612">(</span><span class="ident" id="3873613">resp</span><span class="op" id="3873617">,</span>&nbsp;<span class="ident" id="3873619">r</span><span class="op" id="3873620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873623">if</span>&nbsp;<span class="ident" id="3873626">err</span>&nbsp;<span class="op" id="3873630">!=</span>&nbsp;<span class="ident" id="3873633">nil</span>&nbsp;<span class="op" id="3873637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873641">return</span>&nbsp;<span class="ident" id="3873648">nil</span><span class="op" id="3873651">,</span>&nbsp;<span class="ident" id="3873653">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873662">return</span>&nbsp;<span class="ident" id="3873669">resp</span><span class="op" id="3873673">,</span>&nbsp;<span class="ident" id="3873675">nil</span><br>
<span class="lineno"></span><span class="op" id="3873679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="3873682">//&nbsp;RFC2616:&nbsp;Should&nbsp;treat</span><br>
<span class="lineno"></span><span class="comment" id="3873707">//&nbsp;&nbsp;&nbsp;&nbspPragma:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="comment" id="3873727">//&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="3873735">//&nbsp;&nbsp;&nbsp;&nbspCache-Control:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="keyword" id="3873762">func</span>&nbsp;<span class="ident" id="3873767">fixPragmaCacheControl</span><span class="op" id="3873788">(</span><span class="ident" id="3873789">header</span>&nbsp;<span class="ident" id="3873796">Header</span><span class="op" id="3873802">)</span>&nbsp;<span class="op" id="3873804">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873807">if</span>&nbsp;<span class="ident" id="3873810">hp</span><span class="op" id="3873812">,</span>&nbsp;<span class="ident" id="3873814">ok</span>&nbsp;<span class="op" id="3873817">:=</span>&nbsp;<span class="ident" id="3873820">header</span><span class="op" id="3873826">[</span><span class="string" id="3873827">&#34;Pragma&#34;</span><span class="op" id="3873835">]</span><span class="op" id="3873836">;</span>&nbsp;<span class="ident" id="3873838">ok</span>&nbsp;<span class="op" id="3873841">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3873844">len</span><span class="op" id="3873847">(</span><span class="ident" id="3873848">hp</span><span class="op" id="3873850">)</span>&nbsp;<span class="op" id="3873852">&gt;</span>&nbsp;<span class="num" id="3873854">0</span>&nbsp;<span class="op" id="3873856">&amp;&amp;</span>&nbsp;<span class="ident" id="3873859">hp</span><span class="op" id="3873861">[</span><span class="num" id="3873862">0</span><span class="op" id="3873863">]</span>&nbsp;<span class="op" id="3873865">==</span>&nbsp;<span class="string" id="3873868">&#34;no-cache&#34;</span>&nbsp;<span class="op" id="3873879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873883">if</span>&nbsp;<span class="ident" id="3873886">_</span><span class="op" id="3873887">,</span>&nbsp;<span class="ident" id="3873889">presentcc</span>&nbsp;<span class="op" id="3873899">:=</span>&nbsp;<span class="ident" id="3873902">header</span><span class="op" id="3873908">[</span><span class="string" id="3873909">&#34;Cache-Control&#34;</span><span class="op" id="3873924">]</span><span class="op" id="3873925">;</span>&nbsp;<span class="op" id="3873927">!</span><span class="ident" id="3873928">presentcc</span>&nbsp;<span class="op" id="3873938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873943">header</span><span class="op" id="3873949">[</span><span class="string" id="3873950">&#34;Cache-Control&#34;</span><span class="op" id="3873965">]</span>&nbsp;<span class="op" id="3873967">=</span>&nbsp;<span class="op" id="3873969">[</span><span class="op" id="3873970">]</span><span class="builtintype" id="3873971">string</span><span class="op" id="3873977">{</span><span class="string" id="3873978">&#34;no-cache&#34;</span><span class="op" id="3873988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873995">}</span><br>
<span class="lineno">180</span><span class="op" id="3873997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3874000">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3874055">//&nbsp;in&nbsp;the&nbsp;response&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="3874099">func</span>&nbsp;<span class="op" id="3874104">(</span><span class="ident" id="3874105">r</span>&nbsp;<span class="op" id="3874107">*</span><span class="ident" id="3874108">Response</span><span class="op" id="3874116">)</span>&nbsp;<span class="ident" id="3874118">ProtoAtLeast</span><span class="op" id="3874130">(</span><span class="ident" id="3874131">major</span><span class="op" id="3874136">,</span>&nbsp;<span class="ident" id="3874138">minor</span>&nbsp;<span class="builtintype" id="3874144">int</span><span class="op" id="3874147">)</span>&nbsp;<span class="builtintype" id="3874149">bool</span>&nbsp;<span class="op" id="3874154">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874157">return</span>&nbsp;<span class="ident" id="3874164">r</span><span class="op" id="3874165">.</span><span class="ident" id="3874166">ProtoMajor</span>&nbsp;<span class="op" id="3874177">&gt;</span>&nbsp;<span class="ident" id="3874179">major</span>&nbsp;<span class="op" id="3874185">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874190">r</span><span class="op" id="3874191">.</span><span class="ident" id="3874192">ProtoMajor</span>&nbsp;<span class="op" id="3874203">==</span>&nbsp;<span class="ident" id="3874206">major</span>&nbsp;<span class="op" id="3874212">&amp;&amp;</span>&nbsp;<span class="ident" id="3874215">r</span><span class="op" id="3874216">.</span><span class="ident" id="3874217">ProtoMinor</span>&nbsp;<span class="op" id="3874228">&gt;=</span>&nbsp;<span class="ident" id="3874231">minor</span><br>
<span class="lineno"></span><span class="op" id="3874237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3874240">//&nbsp;Writes&nbsp;the&nbsp;response&nbsp;(header,&nbsp;body&nbsp;and&nbsp;trailer)&nbsp;in&nbsp;wire&nbsp;format.&nbsp;This&nbsp;method</span><br>
<span class="lineno">190</span><span class="comment" id="3874318">//&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;response:</span><br>
<span class="lineno"></span><span class="comment" id="3874368">//</span><br>
<span class="lineno"></span><span class="comment" id="3874371">//&nbsp;&nbsp;StatusCode</span><br>
<span class="lineno"></span><span class="comment" id="3874386">//&nbsp;&nbsp;ProtoMajor</span><br>
<span class="lineno"></span><span class="comment" id="3874401">//&nbsp;&nbsp;ProtoMinor</span><br>
<span class="lineno">195</span><span class="comment" id="3874416">//&nbsp;&nbsp;Request.Method</span><br>
<span class="lineno"></span><span class="comment" id="3874435">//&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3874456">//&nbsp;&nbsp;Trailer</span><br>
<span class="lineno"></span><span class="comment" id="3874468">//&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="3874477">//&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">200</span><span class="comment" id="3874495">//&nbsp;&nbsp;Header,&nbsp;values&nbsp;for&nbsp;non-canonical&nbsp;keys&nbsp;will&nbsp;have&nbsp;unpredictable&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="3874570">//</span><br>
<span class="lineno"></span><span class="comment" id="3874573">//&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3874609">func</span>&nbsp;<span class="op" id="3874614">(</span><span class="ident" id="3874615">r</span>&nbsp;<span class="op" id="3874617">*</span><span class="ident" id="3874618">Response</span><span class="op" id="3874626">)</span>&nbsp;<span class="ident" id="3874628">Write</span><span class="op" id="3874633">(</span><span class="ident" id="3874634">w</span>&nbsp;<span class="ident" id="3874636">io</span><span class="op" id="3874638">.</span><span class="ident" id="3874639">Writer</span><span class="op" id="3874645">)</span>&nbsp;<span class="builtintype" id="3874647">error</span>&nbsp;<span class="op" id="3874653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3874656">//&nbsp;Status&nbsp;line</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874672">text</span>&nbsp;<span class="op" id="3874677">:=</span>&nbsp;<span class="ident" id="3874680">r</span><span class="op" id="3874681">.</span><span class="ident" id="3874682">Status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874690">if</span>&nbsp;<span class="ident" id="3874693">text</span>&nbsp;<span class="op" id="3874698">==</span>&nbsp;<span class="string" id="3874701">&#34;&#34;</span>&nbsp;<span class="op" id="3874704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874708">var</span>&nbsp;<span class="ident" id="3874712">ok</span>&nbsp;<span class="builtintype" id="3874715">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874722">text</span><span class="op" id="3874726">,</span>&nbsp;<span class="ident" id="3874728">ok</span>&nbsp;<span class="op" id="3874731">=</span>&nbsp;<span class="ident" id="3874733">statusText</span><span class="op" id="3874743">[</span><span class="ident" id="3874744">r</span><span class="op" id="3874745">.</span><span class="ident" id="3874746">StatusCode</span><span class="op" id="3874756">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874760">if</span>&nbsp;<span class="op" id="3874763">!</span><span class="ident" id="3874764">ok</span>&nbsp;<span class="op" id="3874767">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874772">text</span>&nbsp;<span class="op" id="3874777">=</span>&nbsp;<span class="string" id="3874779">&#34;status&nbsp;code&nbsp;&#34;</span>&nbsp;<span class="op" id="3874794">+</span>&nbsp;<span class="ident" id="3874796">strconv</span><span class="op" id="3874803">.</span><span class="ident" id="3874804">Itoa</span><span class="op" id="3874808">(</span><span class="ident" id="3874809">r</span><span class="op" id="3874810">.</span><span class="ident" id="3874811">StatusCode</span><span class="op" id="3874821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3874825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3874828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874831">protoMajor</span><span class="op" id="3874841">,</span>&nbsp;<span class="ident" id="3874843">protoMinor</span>&nbsp;<span class="op" id="3874854">:=</span>&nbsp;<span class="ident" id="3874857">strconv</span><span class="op" id="3874864">.</span><span class="ident" id="3874865">Itoa</span><span class="op" id="3874869">(</span><span class="ident" id="3874870">r</span><span class="op" id="3874871">.</span><span class="ident" id="3874872">ProtoMajor</span><span class="op" id="3874882">)</span><span class="op" id="3874883">,</span>&nbsp;<span class="ident" id="3874885">strconv</span><span class="op" id="3874892">.</span><span class="ident" id="3874893">Itoa</span><span class="op" id="3874897">(</span><span class="ident" id="3874898">r</span><span class="op" id="3874899">.</span><span class="ident" id="3874900">ProtoMinor</span><span class="op" id="3874910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874913">statusCode</span>&nbsp;<span class="op" id="3874924">:=</span>&nbsp;<span class="ident" id="3874927">strconv</span><span class="op" id="3874934">.</span><span class="ident" id="3874935">Itoa</span><span class="op" id="3874939">(</span><span class="ident" id="3874940">r</span><span class="op" id="3874941">.</span><span class="ident" id="3874942">StatusCode</span><span class="op" id="3874952">)</span>&nbsp;<span class="op" id="3874954">+</span>&nbsp;<span class="string" id="3874956">&#34;&nbsp;&#34;</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874961">text</span>&nbsp;<span class="op" id="3874966">=</span>&nbsp;<span class="ident" id="3874968">strings</span><span class="op" id="3874975">.</span><span class="ident" id="3874976">TrimPrefix</span><span class="op" id="3874986">(</span><span class="ident" id="3874987">text</span><span class="op" id="3874991">,</span>&nbsp;<span class="ident" id="3874993">statusCode</span><span class="op" id="3875003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875006">if</span>&nbsp;<span class="ident" id="3875009">_</span><span class="op" id="3875010">,</span>&nbsp;<span class="ident" id="3875012">err</span>&nbsp;<span class="op" id="3875016">:=</span>&nbsp;<span class="ident" id="3875019">io</span><span class="op" id="3875021">.</span><span class="ident" id="3875022">WriteString</span><span class="op" id="3875033">(</span><span class="ident" id="3875034">w</span><span class="op" id="3875035">,</span>&nbsp;<span class="string" id="3875037">&#34;HTTP/&#34;</span><span class="op" id="3875044">+</span><span class="ident" id="3875045">protoMajor</span><span class="op" id="3875055">+</span><span class="string" id="3875056">&#34;.&#34;</span><span class="op" id="3875059">+</span><span class="ident" id="3875060">protoMinor</span><span class="op" id="3875070">+</span><span class="string" id="3875071">&#34;&nbsp;&#34;</span><span class="op" id="3875074">+</span><span class="ident" id="3875075">statusCode</span><span class="op" id="3875085">+</span><span class="ident" id="3875086">text</span><span class="op" id="3875090">+</span><span class="string" id="3875091">&#34;\r\n&#34;</span><span class="op" id="3875097">)</span><span class="op" id="3875098">;</span>&nbsp;<span class="ident" id="3875100">err</span>&nbsp;<span class="op" id="3875104">!=</span>&nbsp;<span class="ident" id="3875107">nil</span>&nbsp;<span class="op" id="3875111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875115">return</span>&nbsp;<span class="ident" id="3875122">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3875131">//&nbsp;Clone&nbsp;it,&nbsp;so&nbsp;we&nbsp;can&nbsp;modify&nbsp;r1&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875176">r1</span>&nbsp;<span class="op" id="3875179">:=</span>&nbsp;<span class="builtinfunc" id="3875182">new</span><span class="op" id="3875185">(</span><span class="ident" id="3875186">Response</span><span class="op" id="3875194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875197">*</span><span class="ident" id="3875198">r1</span>&nbsp;<span class="op" id="3875201">=</span>&nbsp;<span class="op" id="3875203">*</span><span class="ident" id="3875204">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875207">if</span>&nbsp;<span class="ident" id="3875210">r1</span><span class="op" id="3875212">.</span><span class="ident" id="3875213">ContentLength</span>&nbsp;<span class="op" id="3875227">==</span>&nbsp;<span class="num" id="3875230">0</span>&nbsp;<span class="op" id="3875232">&amp;&amp;</span>&nbsp;<span class="ident" id="3875235">r1</span><span class="op" id="3875237">.</span><span class="ident" id="3875238">Body</span>&nbsp;<span class="op" id="3875243">!=</span>&nbsp;<span class="ident" id="3875246">nil</span>&nbsp;<span class="op" id="3875250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3875254">//&nbsp;Is&nbsp;it&nbsp;actually&nbsp;0&nbsp;length?&nbsp;Or&nbsp;just&nbsp;unknown?</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875301">var</span>&nbsp;<span class="ident" id="3875305">buf</span>&nbsp;<span class="op" id="3875309">[</span><span class="num" id="3875310">1</span><span class="op" id="3875311">]</span><span class="builtintype" id="3875312">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875319">n</span><span class="op" id="3875320">,</span>&nbsp;<span class="ident" id="3875322">err</span>&nbsp;<span class="op" id="3875326">:=</span>&nbsp;<span class="ident" id="3875329">r1</span><span class="op" id="3875331">.</span><span class="ident" id="3875332">Body</span><span class="op" id="3875336">.</span><span class="ident" id="3875337">Read</span><span class="op" id="3875341">(</span><span class="ident" id="3875342">buf</span><span class="op" id="3875345">[</span><span class="op" id="3875346">:</span><span class="op" id="3875347">]</span><span class="op" id="3875348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875352">if</span>&nbsp;<span class="ident" id="3875355">err</span>&nbsp;<span class="op" id="3875359">!=</span>&nbsp;<span class="ident" id="3875362">nil</span>&nbsp;<span class="op" id="3875366">&amp;&amp;</span>&nbsp;<span class="ident" id="3875369">err</span>&nbsp;<span class="op" id="3875373">!=</span>&nbsp;<span class="ident" id="3875376">io</span><span class="op" id="3875378">.</span><span class="ident" id="3875379">EOF</span>&nbsp;<span class="op" id="3875383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875388">return</span>&nbsp;<span class="ident" id="3875395">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875401">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875405">if</span>&nbsp;<span class="ident" id="3875408">n</span>&nbsp;<span class="op" id="3875410">==</span>&nbsp;<span class="num" id="3875413">0</span>&nbsp;<span class="op" id="3875415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3875420">//&nbsp;Reset&nbsp;it&nbsp;to&nbsp;a&nbsp;known&nbsp;zero&nbsp;reader,&nbsp;in&nbsp;case&nbsp;underlying&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3875482">//&nbsp;is&nbsp;unhappy&nbsp;being&nbsp;read&nbsp;repeatedly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875522">r1</span><span class="op" id="3875524">.</span><span class="ident" id="3875525">Body</span>&nbsp;<span class="op" id="3875530">=</span>&nbsp;<span class="ident" id="3875532">eofReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875544">}</span>&nbsp;<span class="keyword" id="3875546">else</span>&nbsp;<span class="op" id="3875551">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875556">r1</span><span class="op" id="3875558">.</span><span class="ident" id="3875559">ContentLength</span>&nbsp;<span class="op" id="3875573">=</span>&nbsp;<span class="op" id="3875575">-</span><span class="num" id="3875576">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875581">r1</span><span class="op" id="3875583">.</span><span class="ident" id="3875584">Body</span>&nbsp;<span class="op" id="3875589">=</span>&nbsp;<span class="keyword" id="3875591">struct</span>&nbsp;<span class="op" id="3875598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875604">io</span><span class="op" id="3875606">.</span><span class="ident" id="3875607">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875618">io</span><span class="op" id="3875620">.</span><span class="ident" id="3875621">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875631">}</span><span class="op" id="3875632">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875638">io</span><span class="op" id="3875640">.</span><span class="ident" id="3875641">MultiReader</span><span class="op" id="3875652">(</span><span class="ident" id="3875653">bytes</span><span class="op" id="3875658">.</span><span class="ident" id="3875659">NewReader</span><span class="op" id="3875668">(</span><span class="ident" id="3875669">buf</span><span class="op" id="3875672">[</span><span class="op" id="3875673">:</span><span class="num" id="3875674">1</span><span class="op" id="3875675">]</span><span class="op" id="3875676">)</span><span class="op" id="3875677">,</span>&nbsp;<span class="ident" id="3875679">r</span><span class="op" id="3875680">.</span><span class="ident" id="3875681">Body</span><span class="op" id="3875685">)</span><span class="op" id="3875686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875692">r</span><span class="op" id="3875693">.</span><span class="ident" id="3875694">Body</span><span class="op" id="3875698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875710">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3875713">//&nbsp;If&nbsp;we&#39;re&nbsp;sending&nbsp;a&nbsp;non-chunked&nbsp;HTTP/1.1&nbsp;response&nbsp;without&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3875776">//&nbsp;content-length,&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;the&nbsp;old&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3875840">//&nbsp;way,&nbsp;by&nbsp;noting&nbsp;the&nbsp;EOF&nbsp;with&nbsp;a&nbsp;connection&nbsp;close,&nbsp;so&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3875903">//&nbsp;to&nbsp;set&nbsp;Close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875921">if</span>&nbsp;<span class="ident" id="3875924">r1</span><span class="op" id="3875926">.</span><span class="ident" id="3875927">ContentLength</span>&nbsp;<span class="op" id="3875941">==</span>&nbsp;<span class="op" id="3875944">-</span><span class="num" id="3875945">1</span>&nbsp;<span class="op" id="3875947">&amp;&amp;</span>&nbsp;<span class="op" id="3875950">!</span><span class="ident" id="3875951">r1</span><span class="op" id="3875953">.</span><span class="ident" id="3875954">Close</span>&nbsp;<span class="op" id="3875960">&amp;&amp;</span>&nbsp;<span class="ident" id="3875963">r1</span><span class="op" id="3875965">.</span><span class="ident" id="3875966">ProtoAtLeast</span><span class="op" id="3875978">(</span><span class="num" id="3875979">1</span><span class="op" id="3875980">,</span>&nbsp;<span class="num" id="3875982">1</span><span class="op" id="3875983">)</span>&nbsp;<span class="op" id="3875985">&amp;&amp;</span>&nbsp;<span class="op" id="3875988">!</span><span class="ident" id="3875989">chunked</span><span class="op" id="3875996">(</span><span class="ident" id="3875997">r1</span><span class="op" id="3875999">.</span><span class="ident" id="3876000">TransferEncoding</span><span class="op" id="3876016">)</span>&nbsp;<span class="op" id="3876018">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876022">r1</span><span class="op" id="3876024">.</span><span class="ident" id="3876025">Close</span>&nbsp;<span class="op" id="3876031">=</span>&nbsp;<span class="builtintype" id="3876033">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3876043">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876088">tw</span><span class="op" id="3876090">,</span>&nbsp;<span class="ident" id="3876092">err</span>&nbsp;<span class="op" id="3876096">:=</span>&nbsp;<span class="ident" id="3876099">newTransferWriter</span><span class="op" id="3876116">(</span><span class="ident" id="3876117">r1</span><span class="op" id="3876119">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876122">if</span>&nbsp;<span class="ident" id="3876125">err</span>&nbsp;<span class="op" id="3876129">!=</span>&nbsp;<span class="ident" id="3876132">nil</span>&nbsp;<span class="op" id="3876136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876140">return</span>&nbsp;<span class="ident" id="3876147">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876155">err</span>&nbsp;<span class="op" id="3876159">=</span>&nbsp;<span class="ident" id="3876161">tw</span><span class="op" id="3876163">.</span><span class="ident" id="3876164">WriteHeader</span><span class="op" id="3876175">(</span><span class="ident" id="3876176">w</span><span class="op" id="3876177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876180">if</span>&nbsp;<span class="ident" id="3876183">err</span>&nbsp;<span class="op" id="3876187">!=</span>&nbsp;<span class="ident" id="3876190">nil</span>&nbsp;<span class="op" id="3876194">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876198">return</span>&nbsp;<span class="ident" id="3876205">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3876214">//&nbsp;Rest&nbsp;of&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876233">err</span>&nbsp;<span class="op" id="3876237">=</span>&nbsp;<span class="ident" id="3876239">r</span><span class="op" id="3876240">.</span><span class="ident" id="3876241">Header</span><span class="op" id="3876247">.</span><span class="ident" id="3876248">WriteSubset</span><span class="op" id="3876259">(</span><span class="ident" id="3876260">w</span><span class="op" id="3876261">,</span>&nbsp;<span class="ident" id="3876263">respExcludeHeader</span><span class="op" id="3876280">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876283">if</span>&nbsp;<span class="ident" id="3876286">err</span>&nbsp;<span class="op" id="3876290">!=</span>&nbsp;<span class="ident" id="3876293">nil</span>&nbsp;<span class="op" id="3876297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876301">return</span>&nbsp;<span class="ident" id="3876308">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3876317">//&nbsp;contentLengthAlreadySent&nbsp;may&nbsp;have&nbsp;been&nbsp;already&nbsp;sent&nbsp;for</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3876377">//&nbsp;POST/PUT&nbsp;requests,&nbsp;even&nbsp;if&nbsp;zero&nbsp;length.&nbsp;See&nbsp;Issue&nbsp;8180.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876437">contentLengthAlreadySent</span>&nbsp;<span class="op" id="3876462">:=</span>&nbsp;<span class="ident" id="3876465">tw</span><span class="op" id="3876467">.</span><span class="ident" id="3876468">shouldSendContentLength</span><span class="op" id="3876491">(</span><span class="op" id="3876492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876495">if</span>&nbsp;<span class="ident" id="3876498">r1</span><span class="op" id="3876500">.</span><span class="ident" id="3876501">ContentLength</span>&nbsp;<span class="op" id="3876515">==</span>&nbsp;<span class="num" id="3876518">0</span>&nbsp;<span class="op" id="3876520">&amp;&amp;</span>&nbsp;<span class="op" id="3876523">!</span><span class="ident" id="3876524">chunked</span><span class="op" id="3876531">(</span><span class="ident" id="3876532">r1</span><span class="op" id="3876534">.</span><span class="ident" id="3876535">TransferEncoding</span><span class="op" id="3876551">)</span>&nbsp;<span class="op" id="3876553">&amp;&amp;</span>&nbsp;<span class="op" id="3876556">!</span><span class="ident" id="3876557">contentLengthAlreadySent</span>&nbsp;<span class="op" id="3876582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876586">if</span>&nbsp;<span class="ident" id="3876589">_</span><span class="op" id="3876590">,</span>&nbsp;<span class="ident" id="3876592">err</span>&nbsp;<span class="op" id="3876596">:=</span>&nbsp;<span class="ident" id="3876599">io</span><span class="op" id="3876601">.</span><span class="ident" id="3876602">WriteString</span><span class="op" id="3876613">(</span><span class="ident" id="3876614">w</span><span class="op" id="3876615">,</span>&nbsp;<span class="string" id="3876617">&#34;Content-Length:&nbsp;0\r\n&#34;</span><span class="op" id="3876640">)</span><span class="op" id="3876641">;</span>&nbsp;<span class="ident" id="3876643">err</span>&nbsp;<span class="op" id="3876647">!=</span>&nbsp;<span class="ident" id="3876650">nil</span>&nbsp;<span class="op" id="3876654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876659">return</span>&nbsp;<span class="ident" id="3876666">err</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3876679">//&nbsp;End-of-header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876697">if</span>&nbsp;<span class="ident" id="3876700">_</span><span class="op" id="3876701">,</span>&nbsp;<span class="ident" id="3876703">err</span>&nbsp;<span class="op" id="3876707">:=</span>&nbsp;<span class="ident" id="3876710">io</span><span class="op" id="3876712">.</span><span class="ident" id="3876713">WriteString</span><span class="op" id="3876724">(</span><span class="ident" id="3876725">w</span><span class="op" id="3876726">,</span>&nbsp;<span class="string" id="3876728">&#34;\r\n&#34;</span><span class="op" id="3876734">)</span><span class="op" id="3876735">;</span>&nbsp;<span class="ident" id="3876737">err</span>&nbsp;<span class="op" id="3876741">!=</span>&nbsp;<span class="ident" id="3876744">nil</span>&nbsp;<span class="op" id="3876748">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876752">return</span>&nbsp;<span class="ident" id="3876759">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3876768">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876795">err</span>&nbsp;<span class="op" id="3876799">=</span>&nbsp;<span class="ident" id="3876801">tw</span><span class="op" id="3876803">.</span><span class="ident" id="3876804">WriteBody</span><span class="op" id="3876813">(</span><span class="ident" id="3876814">w</span><span class="op" id="3876815">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876818">if</span>&nbsp;<span class="ident" id="3876821">err</span>&nbsp;<span class="op" id="3876825">!=</span>&nbsp;<span class="ident" id="3876828">nil</span>&nbsp;<span class="op" id="3876832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876836">return</span>&nbsp;<span class="ident" id="3876843">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3876852">//&nbsp;Success</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876864">return</span>&nbsp;<span class="ident" id="3876871">nil</span><br>
<span class="lineno"></span><span class="op" id="3876875">}</span>
</div>
</body>
</html>
