<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html" class="current">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7681639">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7681694">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7681748">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7681799">package</span>&nbsp;<span class="ident" id="7681807">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7681816">import</span>&nbsp;<span class="op" id="7681823">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7681826">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7681835">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7681845">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7681853">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7681860">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7681870">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7681883">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7681895">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7681908">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7681925">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7681936">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7681943">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7681946">const</span>&nbsp;<span class="op" id="7681952">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681955">dataDir</span>&nbsp;&nbsp;<span class="op" id="7681964">=</span>&nbsp;<span class="string" id="7681966">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681978">tabwidth</span>&nbsp;<span class="op" id="7681987">=</span>&nbsp;<span class="num" id="7681989">8</span><br>
<span class="lineno"></span><span class="op" id="7681991">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="7681994">var</span>&nbsp;<span class="ident" id="7681998">update</span>&nbsp;<span class="op" id="7682005">=</span>&nbsp;<span class="ident" id="7682007">flag</span><span class="op" id="7682011">.</span><span class="ident" id="7682012">Bool</span><span class="op" id="7682016">(</span><span class="string" id="7682017">&#34;update&#34;</span><span class="op" id="7682025">,</span>&nbsp;<span class="builtintype" id="7682027">false</span><span class="op" id="7682032">,</span>&nbsp;<span class="string" id="7682034">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="7682055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7682058">var</span>&nbsp;<span class="ident" id="7682062">fset</span>&nbsp;<span class="op" id="7682067">=</span>&nbsp;<span class="ident" id="7682069">token</span><span class="op" id="7682074">.</span><span class="ident" id="7682075">NewFileSet</span><span class="op" id="7682085">(</span><span class="op" id="7682086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7682089">type</span>&nbsp;<span class="ident" id="7682094">checkMode</span>&nbsp;<span class="builtintype" id="7682104">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7682110">const</span>&nbsp;<span class="op" id="7682116">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682119">export</span>&nbsp;<span class="ident" id="7682126">checkMode</span>&nbsp;<span class="op" id="7682136">=</span>&nbsp;<span class="num" id="7682138">1</span>&nbsp;<span class="op" id="7682140">&lt;&lt;</span>&nbsp;<span class="ident" id="7682143">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682149">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682160">idempotent</span><br>
<span class="lineno"></span><span class="op" id="7682171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7682174">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7682249">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="7682324">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="7682335">func</span>&nbsp;<span class="ident" id="7682340">format</span><span class="op" id="7682346">(</span><span class="ident" id="7682347">src</span>&nbsp;<span class="op" id="7682351">[</span><span class="op" id="7682352">]</span><span class="builtintype" id="7682353">byte</span><span class="op" id="7682357">,</span>&nbsp;<span class="ident" id="7682359">mode</span>&nbsp;<span class="ident" id="7682364">checkMode</span><span class="op" id="7682373">)</span>&nbsp;<span class="op" id="7682375">(</span><span class="op" id="7682376">[</span><span class="op" id="7682377">]</span><span class="builtintype" id="7682378">byte</span><span class="op" id="7682382">,</span>&nbsp;<span class="builtintype" id="7682384">error</span><span class="op" id="7682389">)</span>&nbsp;<span class="op" id="7682391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7682394">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682408">f</span><span class="op" id="7682409">,</span>&nbsp;<span class="ident" id="7682411">err</span>&nbsp;<span class="op" id="7682415">:=</span>&nbsp;<span class="ident" id="7682418">parser</span><span class="op" id="7682424">.</span><span class="ident" id="7682425">ParseFile</span><span class="op" id="7682434">(</span><span class="ident" id="7682435">fset</span><span class="op" id="7682439">,</span>&nbsp;<span class="string" id="7682441">&#34;&#34;</span><span class="op" id="7682443">,</span>&nbsp;<span class="ident" id="7682445">src</span><span class="op" id="7682448">,</span>&nbsp;<span class="ident" id="7682450">parser</span><span class="op" id="7682456">.</span><span class="ident" id="7682457">ParseComments</span><span class="op" id="7682470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682473">if</span>&nbsp;<span class="ident" id="7682476">err</span>&nbsp;<span class="op" id="7682480">!=</span>&nbsp;<span class="builtintype" id="7682483">nil</span>&nbsp;<span class="op" id="7682487">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682491">return</span>&nbsp;<span class="builtintype" id="7682498">nil</span><span class="op" id="7682501">,</span>&nbsp;<span class="ident" id="7682503">fmt</span><span class="op" id="7682506">.</span><span class="ident" id="7682507">Errorf</span><span class="op" id="7682513">(</span><span class="string" id="7682514">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7682529">,</span>&nbsp;<span class="ident" id="7682531">err</span><span class="op" id="7682534">,</span>&nbsp;<span class="ident" id="7682536">src</span><span class="op" id="7682539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7682546">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682578">if</span>&nbsp;<span class="ident" id="7682581">mode</span><span class="op" id="7682585">&amp;</span><span class="ident" id="7682586">export</span>&nbsp;<span class="op" id="7682593">!=</span>&nbsp;<span class="num" id="7682596">0</span>&nbsp;<span class="op" id="7682598">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682602">ast</span><span class="op" id="7682605">.</span><span class="ident" id="7682606">FileExports</span><span class="op" id="7682617">(</span><span class="ident" id="7682618">f</span><span class="op" id="7682619">)</span>&nbsp;<span class="comment" id="7682621">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682640">f</span><span class="op" id="7682641">.</span><span class="ident" id="7682642">Comments</span>&nbsp;<span class="op" id="7682651">=</span>&nbsp;<span class="builtintype" id="7682653">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7682659">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7682708">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682744">cfg</span>&nbsp;<span class="op" id="7682748">:=</span>&nbsp;<span class="ident" id="7682751">Config</span><span class="op" id="7682757">{</span><span class="ident" id="7682758">Tabwidth</span><span class="op" id="7682766">:</span>&nbsp;<span class="ident" id="7682768">tabwidth</span><span class="op" id="7682776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682779">if</span>&nbsp;<span class="ident" id="7682782">mode</span><span class="op" id="7682786">&amp;</span><span class="ident" id="7682787">rawFormat</span>&nbsp;<span class="op" id="7682797">!=</span>&nbsp;<span class="num" id="7682800">0</span>&nbsp;<span class="op" id="7682802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682806">cfg</span><span class="op" id="7682809">.</span><span class="ident" id="7682810">Mode</span>&nbsp;<span class="op" id="7682815">|=</span>&nbsp;<span class="ident" id="7682818">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7682833">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682847">var</span>&nbsp;<span class="ident" id="7682851">buf</span>&nbsp;<span class="ident" id="7682855">bytes</span><span class="op" id="7682860">.</span><span class="ident" id="7682861">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682869">if</span>&nbsp;<span class="ident" id="7682872">err</span>&nbsp;<span class="op" id="7682876">:=</span>&nbsp;<span class="ident" id="7682879">cfg</span><span class="op" id="7682882">.</span><span class="ident" id="7682883">Fprint</span><span class="op" id="7682889">(</span><span class="op" id="7682890">&amp;</span><span class="ident" id="7682891">buf</span><span class="op" id="7682894">,</span>&nbsp;<span class="ident" id="7682896">fset</span><span class="op" id="7682900">,</span>&nbsp;<span class="ident" id="7682902">f</span><span class="op" id="7682903">)</span><span class="op" id="7682904">;</span>&nbsp;<span class="ident" id="7682906">err</span>&nbsp;<span class="op" id="7682910">!=</span>&nbsp;<span class="builtintype" id="7682913">nil</span>&nbsp;<span class="op" id="7682917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682921">return</span>&nbsp;<span class="builtintype" id="7682928">nil</span><span class="op" id="7682931">,</span>&nbsp;<span class="ident" id="7682933">fmt</span><span class="op" id="7682936">.</span><span class="ident" id="7682937">Errorf</span><span class="op" id="7682943">(</span><span class="string" id="7682944">&#34;print:&nbsp;%s&#34;</span><span class="op" id="7682955">,</span>&nbsp;<span class="ident" id="7682957">err</span><span class="op" id="7682960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682963">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7682967">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683023">res</span>&nbsp;<span class="op" id="7683027">:=</span>&nbsp;<span class="ident" id="7683030">buf</span><span class="op" id="7683033">.</span><span class="ident" id="7683034">Bytes</span><span class="op" id="7683039">(</span><span class="op" id="7683040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683043">if</span>&nbsp;<span class="ident" id="7683046">_</span><span class="op" id="7683047">,</span>&nbsp;<span class="ident" id="7683049">err</span>&nbsp;<span class="op" id="7683053">:=</span>&nbsp;<span class="ident" id="7683056">parser</span><span class="op" id="7683062">.</span><span class="ident" id="7683063">ParseFile</span><span class="op" id="7683072">(</span><span class="ident" id="7683073">fset</span><span class="op" id="7683077">,</span>&nbsp;<span class="string" id="7683079">&#34;&#34;</span><span class="op" id="7683081">,</span>&nbsp;<span class="ident" id="7683083">res</span><span class="op" id="7683086">,</span>&nbsp;<span class="num" id="7683088">0</span><span class="op" id="7683089">)</span><span class="op" id="7683090">;</span>&nbsp;<span class="ident" id="7683092">err</span>&nbsp;<span class="op" id="7683096">!=</span>&nbsp;<span class="builtintype" id="7683099">nil</span>&nbsp;<span class="op" id="7683103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683107">return</span>&nbsp;<span class="builtintype" id="7683114">nil</span><span class="op" id="7683117">,</span>&nbsp;<span class="ident" id="7683119">fmt</span><span class="op" id="7683122">.</span><span class="ident" id="7683123">Errorf</span><span class="op" id="7683129">(</span><span class="string" id="7683130">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7683148">,</span>&nbsp;<span class="ident" id="7683150">err</span><span class="op" id="7683153">,</span>&nbsp;<span class="ident" id="7683155">buf</span><span class="op" id="7683158">.</span><span class="ident" id="7683159">Bytes</span><span class="op" id="7683164">(</span><span class="op" id="7683165">)</span><span class="op" id="7683166">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7683169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683173">return</span>&nbsp;<span class="ident" id="7683180">res</span><span class="op" id="7683183">,</span>&nbsp;<span class="builtintype" id="7683185">nil</span><br>
<span class="lineno"></span><span class="op" id="7683189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="7683192">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="7683252">func</span>&nbsp;<span class="ident" id="7683257">lineAt</span><span class="op" id="7683263">(</span><span class="ident" id="7683264">text</span>&nbsp;<span class="op" id="7683269">[</span><span class="op" id="7683270">]</span><span class="builtintype" id="7683271">byte</span><span class="op" id="7683275">,</span>&nbsp;<span class="ident" id="7683277">offs</span>&nbsp;<span class="builtintype" id="7683282">int</span><span class="op" id="7683285">)</span>&nbsp;<span class="op" id="7683287">[</span><span class="op" id="7683288">]</span><span class="builtintype" id="7683289">byte</span>&nbsp;<span class="op" id="7683294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683297">i</span>&nbsp;<span class="op" id="7683299">:=</span>&nbsp;<span class="ident" id="7683302">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683308">for</span>&nbsp;<span class="ident" id="7683312">i</span>&nbsp;<span class="op" id="7683314">&lt;</span>&nbsp;<span class="builtinfunc" id="7683316">len</span><span class="op" id="7683319">(</span><span class="ident" id="7683320">text</span><span class="op" id="7683324">)</span>&nbsp;<span class="op" id="7683326">&amp;&amp;</span>&nbsp;<span class="ident" id="7683329">text</span><span class="op" id="7683333">[</span><span class="ident" id="7683334">i</span><span class="op" id="7683335">]</span>&nbsp;<span class="op" id="7683337">!=</span>&nbsp;<span class="string" id="7683340">&#39;\n&#39;</span>&nbsp;<span class="op" id="7683345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683349">i</span><span class="op" id="7683350">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7683354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683357">return</span>&nbsp;<span class="ident" id="7683364">text</span><span class="op" id="7683368">[</span><span class="ident" id="7683369">offs</span><span class="op" id="7683373">:</span><span class="ident" id="7683374">i</span><span class="op" id="7683375">]</span><br>
<span class="lineno"></span><span class="op" id="7683377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7683380">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="7683406">func</span>&nbsp;<span class="ident" id="7683411">diff</span><span class="op" id="7683415">(</span><span class="ident" id="7683416">aname</span><span class="op" id="7683421">,</span>&nbsp;<span class="ident" id="7683423">bname</span>&nbsp;<span class="builtintype" id="7683429">string</span><span class="op" id="7683435">,</span>&nbsp;<span class="ident" id="7683437">a</span><span class="op" id="7683438">,</span>&nbsp;<span class="ident" id="7683440">b</span>&nbsp;<span class="op" id="7683442">[</span><span class="op" id="7683443">]</span><span class="builtintype" id="7683444">byte</span><span class="op" id="7683448">)</span>&nbsp;<span class="builtintype" id="7683450">error</span>&nbsp;<span class="op" id="7683456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683459">var</span>&nbsp;<span class="ident" id="7683463">buf</span>&nbsp;<span class="ident" id="7683467">bytes</span><span class="op" id="7683472">.</span><span class="ident" id="7683473">Buffer</span>&nbsp;<span class="comment" id="7683480">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7683512">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683532">if</span>&nbsp;<span class="builtinfunc" id="7683535">len</span><span class="op" id="7683538">(</span><span class="ident" id="7683539">a</span><span class="op" id="7683540">)</span>&nbsp;<span class="op" id="7683542">!=</span>&nbsp;<span class="builtinfunc" id="7683545">len</span><span class="op" id="7683548">(</span><span class="ident" id="7683549">b</span><span class="op" id="7683550">)</span>&nbsp;<span class="op" id="7683552">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683556">fmt</span><span class="op" id="7683559">.</span><span class="ident" id="7683560">Fprintf</span><span class="op" id="7683567">(</span><span class="op" id="7683568">&amp;</span><span class="ident" id="7683569">buf</span><span class="op" id="7683572">,</span>&nbsp;<span class="string" id="7683574">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7683620">,</span>&nbsp;<span class="ident" id="7683622">aname</span><span class="op" id="7683627">,</span>&nbsp;<span class="builtinfunc" id="7683629">len</span><span class="op" id="7683632">(</span><span class="ident" id="7683633">a</span><span class="op" id="7683634">)</span><span class="op" id="7683635">,</span>&nbsp;<span class="ident" id="7683637">bname</span><span class="op" id="7683642">,</span>&nbsp;<span class="builtinfunc" id="7683644">len</span><span class="op" id="7683647">(</span><span class="ident" id="7683648">b</span><span class="op" id="7683649">)</span><span class="op" id="7683650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7683653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7683657">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683678">line</span>&nbsp;<span class="op" id="7683683">:=</span>&nbsp;<span class="num" id="7683686">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683689">offs</span>&nbsp;<span class="op" id="7683694">:=</span>&nbsp;<span class="num" id="7683697">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683700">for</span>&nbsp;<span class="ident" id="7683704">i</span>&nbsp;<span class="op" id="7683706">:=</span>&nbsp;<span class="num" id="7683709">0</span><span class="op" id="7683710">;</span>&nbsp;<span class="ident" id="7683712">i</span>&nbsp;<span class="op" id="7683714">&lt;</span>&nbsp;<span class="builtinfunc" id="7683716">len</span><span class="op" id="7683719">(</span><span class="ident" id="7683720">a</span><span class="op" id="7683721">)</span>&nbsp;<span class="op" id="7683723">&amp;&amp;</span>&nbsp;<span class="ident" id="7683726">i</span>&nbsp;<span class="op" id="7683728">&lt;</span>&nbsp;<span class="builtinfunc" id="7683730">len</span><span class="op" id="7683733">(</span><span class="ident" id="7683734">b</span><span class="op" id="7683735">)</span><span class="op" id="7683736">;</span>&nbsp;<span class="ident" id="7683738">i</span><span class="op" id="7683739">++</span>&nbsp;<span class="op" id="7683742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683746">ch</span>&nbsp;<span class="op" id="7683749">:=</span>&nbsp;<span class="ident" id="7683752">a</span><span class="op" id="7683753">[</span><span class="ident" id="7683754">i</span><span class="op" id="7683755">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683759">if</span>&nbsp;<span class="ident" id="7683762">ch</span>&nbsp;<span class="op" id="7683765">!=</span>&nbsp;<span class="ident" id="7683768">b</span><span class="op" id="7683769">[</span><span class="ident" id="7683770">i</span><span class="op" id="7683771">]</span>&nbsp;<span class="op" id="7683773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683778">fmt</span><span class="op" id="7683781">.</span><span class="ident" id="7683782">Fprintf</span><span class="op" id="7683789">(</span><span class="op" id="7683790">&amp;</span><span class="ident" id="7683791">buf</span><span class="op" id="7683794">,</span>&nbsp;<span class="string" id="7683796">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7683812">,</span>&nbsp;<span class="ident" id="7683814">aname</span><span class="op" id="7683819">,</span>&nbsp;<span class="ident" id="7683821">line</span><span class="op" id="7683825">,</span>&nbsp;<span class="ident" id="7683827">i</span><span class="op" id="7683828">-</span><span class="ident" id="7683829">offs</span><span class="op" id="7683833">+</span><span class="num" id="7683834">1</span><span class="op" id="7683835">,</span>&nbsp;<span class="ident" id="7683837">lineAt</span><span class="op" id="7683843">(</span><span class="ident" id="7683844">a</span><span class="op" id="7683845">,</span>&nbsp;<span class="ident" id="7683847">offs</span><span class="op" id="7683851">)</span><span class="op" id="7683852">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683857">fmt</span><span class="op" id="7683860">.</span><span class="ident" id="7683861">Fprintf</span><span class="op" id="7683868">(</span><span class="op" id="7683869">&amp;</span><span class="ident" id="7683870">buf</span><span class="op" id="7683873">,</span>&nbsp;<span class="string" id="7683875">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7683891">,</span>&nbsp;<span class="ident" id="7683893">bname</span><span class="op" id="7683898">,</span>&nbsp;<span class="ident" id="7683900">line</span><span class="op" id="7683904">,</span>&nbsp;<span class="ident" id="7683906">i</span><span class="op" id="7683907">-</span><span class="ident" id="7683908">offs</span><span class="op" id="7683912">+</span><span class="num" id="7683913">1</span><span class="op" id="7683914">,</span>&nbsp;<span class="ident" id="7683916">lineAt</span><span class="op" id="7683922">(</span><span class="ident" id="7683923">b</span><span class="op" id="7683924">,</span>&nbsp;<span class="ident" id="7683926">offs</span><span class="op" id="7683930">)</span><span class="op" id="7683931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683936">fmt</span><span class="op" id="7683939">.</span><span class="ident" id="7683940">Fprintf</span><span class="op" id="7683947">(</span><span class="op" id="7683948">&amp;</span><span class="ident" id="7683949">buf</span><span class="op" id="7683952">,</span>&nbsp;<span class="string" id="7683954">&#34;\n\n&#34;</span><span class="op" id="7683960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683965">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7683973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683977">if</span>&nbsp;<span class="ident" id="7683980">ch</span>&nbsp;<span class="op" id="7683983">==</span>&nbsp;<span class="string" id="7683986">&#39;\n&#39;</span>&nbsp;<span class="op" id="7683991">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683996">line</span><span class="op" id="7684000">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684006">offs</span>&nbsp;<span class="op" id="7684011">=</span>&nbsp;<span class="ident" id="7684013">i</span>&nbsp;<span class="op" id="7684015">+</span>&nbsp;<span class="num" id="7684017">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684028">if</span>&nbsp;<span class="ident" id="7684031">buf</span><span class="op" id="7684034">.</span><span class="ident" id="7684035">Len</span><span class="op" id="7684038">(</span><span class="op" id="7684039">)</span>&nbsp;<span class="op" id="7684041">&gt;</span>&nbsp;<span class="num" id="7684043">0</span>&nbsp;<span class="op" id="7684045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684049">return</span>&nbsp;<span class="ident" id="7684056">errors</span><span class="op" id="7684062">.</span><span class="ident" id="7684063">New</span><span class="op" id="7684066">(</span><span class="ident" id="7684067">buf</span><span class="op" id="7684070">.</span><span class="ident" id="7684071">String</span><span class="op" id="7684077">(</span><span class="op" id="7684078">)</span><span class="op" id="7684079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684085">return</span>&nbsp;<span class="builtintype" id="7684092">nil</span><br>
<span class="lineno"></span><span class="op" id="7684096">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="7684099">func</span>&nbsp;<span class="ident" id="7684104">runcheck</span><span class="op" id="7684112">(</span><span class="ident" id="7684113">t</span>&nbsp;<span class="op" id="7684115">*</span><span class="ident" id="7684116">testing</span><span class="op" id="7684123">.</span><span class="ident" id="7684124">T</span><span class="op" id="7684125">,</span>&nbsp;<span class="ident" id="7684127">source</span><span class="op" id="7684133">,</span>&nbsp;<span class="ident" id="7684135">golden</span>&nbsp;<span class="builtintype" id="7684142">string</span><span class="op" id="7684148">,</span>&nbsp;<span class="ident" id="7684150">mode</span>&nbsp;<span class="ident" id="7684155">checkMode</span><span class="op" id="7684164">)</span>&nbsp;<span class="op" id="7684166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684169">src</span><span class="op" id="7684172">,</span>&nbsp;<span class="ident" id="7684174">err</span>&nbsp;<span class="op" id="7684178">:=</span>&nbsp;<span class="ident" id="7684181">ioutil</span><span class="op" id="7684187">.</span><span class="ident" id="7684188">ReadFile</span><span class="op" id="7684196">(</span><span class="ident" id="7684197">source</span><span class="op" id="7684203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684206">if</span>&nbsp;<span class="ident" id="7684209">err</span>&nbsp;<span class="op" id="7684213">!=</span>&nbsp;<span class="builtintype" id="7684216">nil</span>&nbsp;<span class="op" id="7684220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684224">t</span><span class="op" id="7684225">.</span><span class="ident" id="7684226">Error</span><span class="op" id="7684231">(</span><span class="ident" id="7684232">err</span><span class="op" id="7684235">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684239">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684251">res</span><span class="op" id="7684254">,</span>&nbsp;<span class="ident" id="7684256">err</span>&nbsp;<span class="op" id="7684260">:=</span>&nbsp;<span class="ident" id="7684263">format</span><span class="op" id="7684269">(</span><span class="ident" id="7684270">src</span><span class="op" id="7684273">,</span>&nbsp;<span class="ident" id="7684275">mode</span><span class="op" id="7684279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684282">if</span>&nbsp;<span class="ident" id="7684285">err</span>&nbsp;<span class="op" id="7684289">!=</span>&nbsp;<span class="builtintype" id="7684292">nil</span>&nbsp;<span class="op" id="7684296">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684300">t</span><span class="op" id="7684301">.</span><span class="ident" id="7684302">Error</span><span class="op" id="7684307">(</span><span class="ident" id="7684308">err</span><span class="op" id="7684311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684315">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7684327">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684364">if</span>&nbsp;<span class="op" id="7684367">*</span><span class="ident" id="7684368">update</span>&nbsp;<span class="op" id="7684375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684379">if</span>&nbsp;<span class="ident" id="7684382">err</span>&nbsp;<span class="op" id="7684386">:=</span>&nbsp;<span class="ident" id="7684389">ioutil</span><span class="op" id="7684395">.</span><span class="ident" id="7684396">WriteFile</span><span class="op" id="7684405">(</span><span class="ident" id="7684406">golden</span><span class="op" id="7684412">,</span>&nbsp;<span class="ident" id="7684414">res</span><span class="op" id="7684417">,</span>&nbsp;<span class="num" id="7684419">0644</span><span class="op" id="7684423">)</span><span class="op" id="7684424">;</span>&nbsp;<span class="ident" id="7684426">err</span>&nbsp;<span class="op" id="7684430">!=</span>&nbsp;<span class="builtintype" id="7684433">nil</span>&nbsp;<span class="op" id="7684437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684442">t</span><span class="op" id="7684443">.</span><span class="ident" id="7684444">Error</span><span class="op" id="7684449">(</span><span class="ident" id="7684450">err</span><span class="op" id="7684453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684461">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7684473">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684488">gld</span><span class="op" id="7684491">,</span>&nbsp;<span class="ident" id="7684493">err</span>&nbsp;<span class="op" id="7684497">:=</span>&nbsp;<span class="ident" id="7684500">ioutil</span><span class="op" id="7684506">.</span><span class="ident" id="7684507">ReadFile</span><span class="op" id="7684515">(</span><span class="ident" id="7684516">golden</span><span class="op" id="7684522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684525">if</span>&nbsp;<span class="ident" id="7684528">err</span>&nbsp;<span class="op" id="7684532">!=</span>&nbsp;<span class="builtintype" id="7684535">nil</span>&nbsp;<span class="op" id="7684539">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684543">t</span><span class="op" id="7684544">.</span><span class="ident" id="7684545">Error</span><span class="op" id="7684550">(</span><span class="ident" id="7684551">err</span><span class="op" id="7684554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684558">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7684570">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684619">if</span>&nbsp;<span class="ident" id="7684622">err</span>&nbsp;<span class="op" id="7684626">:=</span>&nbsp;<span class="ident" id="7684629">diff</span><span class="op" id="7684633">(</span><span class="ident" id="7684634">source</span><span class="op" id="7684640">,</span>&nbsp;<span class="ident" id="7684642">golden</span><span class="op" id="7684648">,</span>&nbsp;<span class="ident" id="7684650">res</span><span class="op" id="7684653">,</span>&nbsp;<span class="ident" id="7684655">gld</span><span class="op" id="7684658">)</span><span class="op" id="7684659">;</span>&nbsp;<span class="ident" id="7684661">err</span>&nbsp;<span class="op" id="7684665">!=</span>&nbsp;<span class="builtintype" id="7684668">nil</span>&nbsp;<span class="op" id="7684672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684676">t</span><span class="op" id="7684677">.</span><span class="ident" id="7684678">Error</span><span class="op" id="7684683">(</span><span class="ident" id="7684684">err</span><span class="op" id="7684687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684691">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684703">if</span>&nbsp;<span class="ident" id="7684706">mode</span><span class="op" id="7684710">&amp;</span><span class="ident" id="7684711">idempotent</span>&nbsp;<span class="op" id="7684722">!=</span>&nbsp;<span class="num" id="7684725">0</span>&nbsp;<span class="op" id="7684727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7684731">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7684773">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7684836">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684898">res</span><span class="op" id="7684901">,</span>&nbsp;<span class="ident" id="7684903">err</span>&nbsp;<span class="op" id="7684907">=</span>&nbsp;<span class="ident" id="7684909">format</span><span class="op" id="7684915">(</span><span class="ident" id="7684916">gld</span><span class="op" id="7684919">,</span>&nbsp;<span class="ident" id="7684921">mode</span><span class="op" id="7684925">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684929">if</span>&nbsp;<span class="ident" id="7684932">err</span>&nbsp;<span class="op" id="7684936">:=</span>&nbsp;<span class="ident" id="7684939">diff</span><span class="op" id="7684943">(</span><span class="ident" id="7684944">golden</span><span class="op" id="7684950">,</span>&nbsp;<span class="ident" id="7684952">fmt</span><span class="op" id="7684955">.</span><span class="ident" id="7684956">Sprintf</span><span class="op" id="7684963">(</span><span class="string" id="7684964">&#34;format(%s)&#34;</span><span class="op" id="7684976">,</span>&nbsp;<span class="ident" id="7684978">golden</span><span class="op" id="7684984">)</span><span class="op" id="7684985">,</span>&nbsp;<span class="ident" id="7684987">gld</span><span class="op" id="7684990">,</span>&nbsp;<span class="ident" id="7684992">res</span><span class="op" id="7684995">)</span><span class="op" id="7684996">;</span>&nbsp;<span class="ident" id="7684998">err</span>&nbsp;<span class="op" id="7685002">!=</span>&nbsp;<span class="builtintype" id="7685005">nil</span>&nbsp;<span class="op" id="7685009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685014">t</span><span class="op" id="7685015">.</span><span class="ident" id="7685016">Errorf</span><span class="op" id="7685022">(</span><span class="string" id="7685023">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="7685053">,</span>&nbsp;<span class="ident" id="7685055">err</span><span class="op" id="7685058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685065">}</span><br>
<span class="lineno"></span><span class="op" id="7685067">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="7685070">func</span>&nbsp;<span class="ident" id="7685075">check</span><span class="op" id="7685080">(</span><span class="ident" id="7685081">t</span>&nbsp;<span class="op" id="7685083">*</span><span class="ident" id="7685084">testing</span><span class="op" id="7685091">.</span><span class="ident" id="7685092">T</span><span class="op" id="7685093">,</span>&nbsp;<span class="ident" id="7685095">source</span><span class="op" id="7685101">,</span>&nbsp;<span class="ident" id="7685103">golden</span>&nbsp;<span class="builtintype" id="7685110">string</span><span class="op" id="7685116">,</span>&nbsp;<span class="ident" id="7685118">mode</span>&nbsp;<span class="ident" id="7685123">checkMode</span><span class="op" id="7685132">)</span>&nbsp;<span class="op" id="7685134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7685137">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685154">cc</span>&nbsp;<span class="op" id="7685157">:=</span>&nbsp;<span class="builtinfunc" id="7685160">make</span><span class="op" id="7685164">(</span><span class="keyword" id="7685165">chan</span>&nbsp;<span class="builtintype" id="7685170">int</span><span class="op" id="7685173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7685176">go</span>&nbsp;<span class="keyword" id="7685179">func</span><span class="op" id="7685183">(</span><span class="op" id="7685184">)</span>&nbsp;<span class="op" id="7685186">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685190">runcheck</span><span class="op" id="7685198">(</span><span class="ident" id="7685199">t</span><span class="op" id="7685200">,</span>&nbsp;<span class="ident" id="7685202">source</span><span class="op" id="7685208">,</span>&nbsp;<span class="ident" id="7685210">golden</span><span class="op" id="7685216">,</span>&nbsp;<span class="ident" id="7685218">mode</span><span class="op" id="7685222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685226">cc</span>&nbsp;<span class="op" id="7685229">&lt;-</span>&nbsp;<span class="num" id="7685232">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685235">}</span><span class="op" id="7685236">(</span><span class="op" id="7685237">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7685241">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7685263">select</span>&nbsp;<span class="op" id="7685270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7685273">case</span>&nbsp;<span class="op" id="7685278">&lt;-</span><span class="ident" id="7685280">time</span><span class="op" id="7685284">.</span><span class="ident" id="7685285">After</span><span class="op" id="7685290">(</span><span class="num" id="7685291">10</span>&nbsp;<span class="op" id="7685294">*</span>&nbsp;<span class="ident" id="7685296">time</span><span class="op" id="7685300">.</span><span class="ident" id="7685301">Second</span><span class="op" id="7685307">)</span><span class="op" id="7685308">:</span>&nbsp;<span class="comment" id="7685310">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7685370">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685402">t</span><span class="op" id="7685403">.</span><span class="ident" id="7685404">Errorf</span><span class="op" id="7685410">(</span><span class="string" id="7685411">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="7685435">,</span>&nbsp;<span class="ident" id="7685437">source</span><span class="op" id="7685443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7685446">case</span>&nbsp;<span class="op" id="7685451">&lt;-</span><span class="ident" id="7685453">cc</span><span class="op" id="7685455">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7685459">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685505">}</span><br>
<span class="lineno"></span><span class="op" id="7685507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7685510">type</span>&nbsp;<span class="ident" id="7685515">entry</span>&nbsp;<span class="keyword" id="7685521">struct</span>&nbsp;<span class="op" id="7685528">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685531">source</span><span class="op" id="7685537">,</span>&nbsp;<span class="ident" id="7685539">golden</span>&nbsp;<span class="builtintype" id="7685546">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685554">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685569">checkMode</span><br>
<span class="lineno"></span><span class="op" id="7685579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7685582">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="7685651">var</span>&nbsp;<span class="ident" id="7685655">data</span>&nbsp;<span class="op" id="7685660">=</span>&nbsp;<span class="op" id="7685662">[</span><span class="op" id="7685663">]</span><span class="ident" id="7685664">entry</span><span class="op" id="7685669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685672">{</span><span class="string" id="7685673">&#34;empty.input&#34;</span><span class="op" id="7685686">,</span>&nbsp;<span class="string" id="7685688">&#34;empty.golden&#34;</span><span class="op" id="7685702">,</span>&nbsp;<span class="ident" id="7685704">idempotent</span><span class="op" id="7685714">}</span><span class="op" id="7685715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685718">{</span><span class="string" id="7685719">&#34;comments.input&#34;</span><span class="op" id="7685735">,</span>&nbsp;<span class="string" id="7685737">&#34;comments.golden&#34;</span><span class="op" id="7685754">,</span>&nbsp;<span class="num" id="7685756">0</span><span class="op" id="7685757">}</span><span class="op" id="7685758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685761">{</span><span class="string" id="7685762">&#34;comments.input&#34;</span><span class="op" id="7685778">,</span>&nbsp;<span class="string" id="7685780">&#34;comments.x&#34;</span><span class="op" id="7685792">,</span>&nbsp;<span class="ident" id="7685794">export</span><span class="op" id="7685800">}</span><span class="op" id="7685801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685804">{</span><span class="string" id="7685805">&#34;comments2.input&#34;</span><span class="op" id="7685822">,</span>&nbsp;<span class="string" id="7685824">&#34;comments2.golden&#34;</span><span class="op" id="7685842">,</span>&nbsp;<span class="ident" id="7685844">idempotent</span><span class="op" id="7685854">}</span><span class="op" id="7685855">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685858">{</span><span class="string" id="7685859">&#34;linebreaks.input&#34;</span><span class="op" id="7685877">,</span>&nbsp;<span class="string" id="7685879">&#34;linebreaks.golden&#34;</span><span class="op" id="7685898">,</span>&nbsp;<span class="ident" id="7685900">idempotent</span><span class="op" id="7685910">}</span><span class="op" id="7685911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685914">{</span><span class="string" id="7685915">&#34;expressions.input&#34;</span><span class="op" id="7685934">,</span>&nbsp;<span class="string" id="7685936">&#34;expressions.golden&#34;</span><span class="op" id="7685956">,</span>&nbsp;<span class="ident" id="7685958">idempotent</span><span class="op" id="7685968">}</span><span class="op" id="7685969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685972">{</span><span class="string" id="7685973">&#34;expressions.input&#34;</span><span class="op" id="7685992">,</span>&nbsp;<span class="string" id="7685994">&#34;expressions.raw&#34;</span><span class="op" id="7686011">,</span>&nbsp;<span class="ident" id="7686013">rawFormat</span>&nbsp;<span class="op" id="7686023">|</span>&nbsp;<span class="ident" id="7686025">idempotent</span><span class="op" id="7686035">}</span><span class="op" id="7686036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7686039">{</span><span class="string" id="7686040">&#34;declarations.input&#34;</span><span class="op" id="7686060">,</span>&nbsp;<span class="string" id="7686062">&#34;declarations.golden&#34;</span><span class="op" id="7686083">,</span>&nbsp;<span class="num" id="7686085">0</span><span class="op" id="7686086">}</span><span class="op" id="7686087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7686090">{</span><span class="string" id="7686091">&#34;statements.input&#34;</span><span class="op" id="7686109">,</span>&nbsp;<span class="string" id="7686111">&#34;statements.golden&#34;</span><span class="op" id="7686130">,</span>&nbsp;<span class="num" id="7686132">0</span><span class="op" id="7686133">}</span><span class="op" id="7686134">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7686137">{</span><span class="string" id="7686138">&#34;slow.input&#34;</span><span class="op" id="7686150">,</span>&nbsp;<span class="string" id="7686152">&#34;slow.golden&#34;</span><span class="op" id="7686165">,</span>&nbsp;<span class="ident" id="7686167">idempotent</span><span class="op" id="7686177">}</span><span class="op" id="7686178">,</span><br>
<span class="lineno"></span><span class="op" id="7686180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7686183">func</span>&nbsp;<span class="ident" id="7686188">TestFiles</span><span class="op" id="7686197">(</span><span class="ident" id="7686198">t</span>&nbsp;<span class="op" id="7686200">*</span><span class="ident" id="7686201">testing</span><span class="op" id="7686208">.</span><span class="ident" id="7686209">T</span><span class="op" id="7686210">)</span>&nbsp;<span class="op" id="7686212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7686215">for</span>&nbsp;<span class="ident" id="7686219">_</span><span class="op" id="7686220">,</span>&nbsp;<span class="ident" id="7686222">e</span>&nbsp;<span class="op" id="7686224">:=</span>&nbsp;<span class="keyword" id="7686227">range</span>&nbsp;<span class="ident" id="7686233">data</span>&nbsp;<span class="op" id="7686238">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7686242">source</span>&nbsp;<span class="op" id="7686249">:=</span>&nbsp;<span class="ident" id="7686252">filepath</span><span class="op" id="7686260">.</span><span class="ident" id="7686261">Join</span><span class="op" id="7686265">(</span><span class="ident" id="7686266">dataDir</span><span class="op" id="7686273">,</span>&nbsp;<span class="ident" id="7686275">e</span><span class="op" id="7686276">.</span><span class="ident" id="7686277">source</span><span class="op" id="7686283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7686287">golden</span>&nbsp;<span class="op" id="7686294">:=</span>&nbsp;<span class="ident" id="7686297">filepath</span><span class="op" id="7686305">.</span><span class="ident" id="7686306">Join</span><span class="op" id="7686310">(</span><span class="ident" id="7686311">dataDir</span><span class="op" id="7686318">,</span>&nbsp;<span class="ident" id="7686320">e</span><span class="op" id="7686321">.</span><span class="ident" id="7686322">golden</span><span class="op" id="7686328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7686332">check</span><span class="op" id="7686337">(</span><span class="ident" id="7686338">t</span><span class="op" id="7686339">,</span>&nbsp;<span class="ident" id="7686341">source</span><span class="op" id="7686347">,</span>&nbsp;<span class="ident" id="7686349">golden</span><span class="op" id="7686355">,</span>&nbsp;<span class="ident" id="7686357">e</span><span class="op" id="7686358">.</span><span class="ident" id="7686359">mode</span><span class="op" id="7686363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7686367">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7686414">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7686450">}</span><br>
<span class="lineno"></span><span class="op" id="7686452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7686455">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="7686531">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="7686607">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="7686636">//</span><br>
<span class="lineno"></span><span class="keyword" id="7686639">func</span>&nbsp;<span class="ident" id="7686644">TestLineComments</span><span class="op" id="7686660">(</span><span class="ident" id="7686661">t</span>&nbsp;<span class="op" id="7686663">*</span><span class="ident" id="7686664">testing</span><span class="op" id="7686671">.</span><span class="ident" id="7686672">T</span><span class="op" id="7686673">)</span>&nbsp;<span class="op" id="7686675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7686678">const</span>&nbsp;<span class="ident" id="7686684">src</span>&nbsp;<span class="op" id="7686688">=</span>&nbsp;<span class="string" id="7686690">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7686751">fset</span>&nbsp;<span class="op" id="7686756">:=</span>&nbsp;<span class="ident" id="7686759">token</span><span class="op" id="7686764">.</span><span class="ident" id="7686765">NewFileSet</span><span class="op" id="7686775">(</span><span class="op" id="7686776">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7686779">f</span><span class="op" id="7686780">,</span>&nbsp;<span class="ident" id="7686782">err</span>&nbsp;<span class="op" id="7686786">:=</span>&nbsp;<span class="ident" id="7686789">parser</span><span class="op" id="7686795">.</span><span class="ident" id="7686796">ParseFile</span><span class="op" id="7686805">(</span><span class="ident" id="7686806">fset</span><span class="op" id="7686810">,</span>&nbsp;<span class="string" id="7686812">&#34;&#34;</span><span class="op" id="7686814">,</span>&nbsp;<span class="ident" id="7686816">src</span><span class="op" id="7686819">,</span>&nbsp;<span class="ident" id="7686821">parser</span><span class="op" id="7686827">.</span><span class="ident" id="7686828">ParseComments</span><span class="op" id="7686841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7686844">if</span>&nbsp;<span class="ident" id="7686847">err</span>&nbsp;<span class="op" id="7686851">!=</span>&nbsp;<span class="builtintype" id="7686854">nil</span>&nbsp;<span class="op" id="7686858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7686862">panic</span><span class="op" id="7686867">(</span><span class="ident" id="7686868">err</span><span class="op" id="7686871">)</span>&nbsp;<span class="comment" id="7686873">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7686891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7686895">var</span>&nbsp;<span class="ident" id="7686899">buf</span>&nbsp;<span class="ident" id="7686903">bytes</span><span class="op" id="7686908">.</span><span class="ident" id="7686909">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7686917">fset</span>&nbsp;<span class="op" id="7686922">=</span>&nbsp;<span class="ident" id="7686924">token</span><span class="op" id="7686929">.</span><span class="ident" id="7686930">NewFileSet</span><span class="op" id="7686940">(</span><span class="op" id="7686941">)</span>&nbsp;<span class="comment" id="7686943">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7686970">Fprint</span><span class="op" id="7686976">(</span><span class="op" id="7686977">&amp;</span><span class="ident" id="7686978">buf</span><span class="op" id="7686981">,</span>&nbsp;<span class="ident" id="7686983">fset</span><span class="op" id="7686987">,</span>&nbsp;<span class="ident" id="7686989">f</span><span class="op" id="7686990">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7686994">nlines</span>&nbsp;<span class="op" id="7687001">:=</span>&nbsp;<span class="num" id="7687004">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687007">for</span>&nbsp;<span class="ident" id="7687011">_</span><span class="op" id="7687012">,</span>&nbsp;<span class="ident" id="7687014">ch</span>&nbsp;<span class="op" id="7687017">:=</span>&nbsp;<span class="keyword" id="7687020">range</span>&nbsp;<span class="ident" id="7687026">buf</span><span class="op" id="7687029">.</span><span class="ident" id="7687030">Bytes</span><span class="op" id="7687035">(</span><span class="op" id="7687036">)</span>&nbsp;<span class="op" id="7687038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687042">if</span>&nbsp;<span class="ident" id="7687045">ch</span>&nbsp;<span class="op" id="7687048">==</span>&nbsp;<span class="string" id="7687051">&#39;\n&#39;</span>&nbsp;<span class="op" id="7687056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7687061">nlines</span><span class="op" id="7687067">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7687072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7687075">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687079">const</span>&nbsp;<span class="ident" id="7687085">expected</span>&nbsp;<span class="op" id="7687094">=</span>&nbsp;<span class="num" id="7687096">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687099">if</span>&nbsp;<span class="ident" id="7687102">nlines</span>&nbsp;<span class="op" id="7687109">&lt;</span>&nbsp;<span class="ident" id="7687111">expected</span>&nbsp;<span class="op" id="7687120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7687124">t</span><span class="op" id="7687125">.</span><span class="ident" id="7687126">Errorf</span><span class="op" id="7687132">(</span><span class="string" id="7687133">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="7687156">,</span>&nbsp;<span class="ident" id="7687158">nlines</span><span class="op" id="7687164">,</span>&nbsp;<span class="ident" id="7687166">expected</span><span class="op" id="7687174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7687178">t</span><span class="op" id="7687179">.</span><span class="ident" id="7687180">Errorf</span><span class="op" id="7687186">(</span><span class="string" id="7687187">&#34;result:\n%s&#34;</span><span class="op" id="7687200">,</span>&nbsp;<span class="ident" id="7687202">buf</span><span class="op" id="7687205">.</span><span class="ident" id="7687206">Bytes</span><span class="op" id="7687211">(</span><span class="op" id="7687212">)</span><span class="op" id="7687213">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7687216">}</span><br>
<span class="lineno"></span><span class="op" id="7687218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7687221">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="7687286">func</span>&nbsp;<span class="ident" id="7687291">init</span><span class="op" id="7687295">(</span><span class="op" id="7687296">)</span>&nbsp;<span class="op" id="7687298">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687301">const</span>&nbsp;<span class="ident" id="7687307">name</span>&nbsp;<span class="op" id="7687312">=</span>&nbsp;<span class="string" id="7687314">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687324">var</span>&nbsp;<span class="ident" id="7687328">buf</span>&nbsp;<span class="ident" id="7687332">bytes</span><span class="op" id="7687337">.</span><span class="ident" id="7687338">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687346">if</span>&nbsp;<span class="ident" id="7687349">err</span>&nbsp;<span class="op" id="7687353">:=</span>&nbsp;<span class="ident" id="7687356">Fprint</span><span class="op" id="7687362">(</span><span class="op" id="7687363">&amp;</span><span class="ident" id="7687364">buf</span><span class="op" id="7687367">,</span>&nbsp;<span class="ident" id="7687369">fset</span><span class="op" id="7687373">,</span>&nbsp;<span class="op" id="7687375">&amp;</span><span class="ident" id="7687376">ast</span><span class="op" id="7687379">.</span><span class="ident" id="7687380">Ident</span><span class="op" id="7687385">{</span><span class="ident" id="7687386">Name</span><span class="op" id="7687390">:</span>&nbsp;<span class="ident" id="7687392">name</span><span class="op" id="7687396">}</span><span class="op" id="7687397">)</span><span class="op" id="7687398">;</span>&nbsp;<span class="ident" id="7687400">err</span>&nbsp;<span class="op" id="7687404">!=</span>&nbsp;<span class="builtintype" id="7687407">nil</span>&nbsp;<span class="op" id="7687411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7687415">panic</span><span class="op" id="7687420">(</span><span class="ident" id="7687421">err</span><span class="op" id="7687424">)</span>&nbsp;<span class="comment" id="7687426">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7687444">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7687447">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7687510">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687524">if</span>&nbsp;<span class="ident" id="7687527">s</span>&nbsp;<span class="op" id="7687529">:=</span>&nbsp;<span class="ident" id="7687532">buf</span><span class="op" id="7687535">.</span><span class="ident" id="7687536">String</span><span class="op" id="7687542">(</span><span class="op" id="7687543">)</span><span class="op" id="7687544">;</span>&nbsp;<span class="op" id="7687546">!</span><span class="ident" id="7687547">debug</span>&nbsp;<span class="op" id="7687553">&amp;&amp;</span>&nbsp;<span class="ident" id="7687556">s</span>&nbsp;<span class="op" id="7687558">!=</span>&nbsp;<span class="ident" id="7687561">name</span>&nbsp;<span class="op" id="7687566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7687570">panic</span><span class="op" id="7687575">(</span><span class="string" id="7687576">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="7687583">+</span>&nbsp;<span class="ident" id="7687585">s</span>&nbsp;<span class="op" id="7687587">+</span>&nbsp;<span class="string" id="7687589">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="7687599">+</span>&nbsp;<span class="ident" id="7687601">name</span><span class="op" id="7687605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7687608">}</span><br>
<span class="lineno">255</span><span class="op" id="7687610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7687613">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="7687688">func</span>&nbsp;<span class="ident" id="7687693">TestBadNodes</span><span class="op" id="7687705">(</span><span class="ident" id="7687706">t</span>&nbsp;<span class="op" id="7687708">*</span><span class="ident" id="7687709">testing</span><span class="op" id="7687716">.</span><span class="ident" id="7687717">T</span><span class="op" id="7687718">)</span>&nbsp;<span class="op" id="7687720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687723">const</span>&nbsp;<span class="ident" id="7687729">src</span>&nbsp;<span class="op" id="7687733">=</span>&nbsp;<span class="string" id="7687735">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687751">const</span>&nbsp;<span class="ident" id="7687757">res</span>&nbsp;<span class="op" id="7687761">=</span>&nbsp;<span class="string" id="7687763">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7687787">f</span><span class="op" id="7687788">,</span>&nbsp;<span class="ident" id="7687790">err</span>&nbsp;<span class="op" id="7687794">:=</span>&nbsp;<span class="ident" id="7687797">parser</span><span class="op" id="7687803">.</span><span class="ident" id="7687804">ParseFile</span><span class="op" id="7687813">(</span><span class="ident" id="7687814">fset</span><span class="op" id="7687818">,</span>&nbsp;<span class="string" id="7687820">&#34;&#34;</span><span class="op" id="7687822">,</span>&nbsp;<span class="ident" id="7687824">src</span><span class="op" id="7687827">,</span>&nbsp;<span class="ident" id="7687829">parser</span><span class="op" id="7687835">.</span><span class="ident" id="7687836">ParseComments</span><span class="op" id="7687849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687852">if</span>&nbsp;<span class="ident" id="7687855">err</span>&nbsp;<span class="op" id="7687859">==</span>&nbsp;<span class="builtintype" id="7687862">nil</span>&nbsp;<span class="op" id="7687866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7687870">t</span><span class="op" id="7687871">.</span><span class="ident" id="7687872">Error</span><span class="op" id="7687877">(</span><span class="string" id="7687878">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="7687904">)</span>&nbsp;<span class="comment" id="7687906">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7687924">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687927">var</span>&nbsp;<span class="ident" id="7687931">buf</span>&nbsp;<span class="ident" id="7687935">bytes</span><span class="op" id="7687940">.</span><span class="ident" id="7687941">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7687949">Fprint</span><span class="op" id="7687955">(</span><span class="op" id="7687956">&amp;</span><span class="ident" id="7687957">buf</span><span class="op" id="7687960">,</span>&nbsp;<span class="ident" id="7687962">fset</span><span class="op" id="7687966">,</span>&nbsp;<span class="ident" id="7687968">f</span><span class="op" id="7687969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7687972">if</span>&nbsp;<span class="ident" id="7687975">buf</span><span class="op" id="7687978">.</span><span class="ident" id="7687979">String</span><span class="op" id="7687985">(</span><span class="op" id="7687986">)</span>&nbsp;<span class="op" id="7687988">!=</span>&nbsp;<span class="ident" id="7687991">res</span>&nbsp;<span class="op" id="7687995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7687999">t</span><span class="op" id="7688000">.</span><span class="ident" id="7688001">Errorf</span><span class="op" id="7688007">(</span><span class="string" id="7688008">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7688029">,</span>&nbsp;<span class="ident" id="7688031">buf</span><span class="op" id="7688034">.</span><span class="ident" id="7688035">String</span><span class="op" id="7688041">(</span><span class="op" id="7688042">)</span><span class="op" id="7688043">,</span>&nbsp;<span class="ident" id="7688045">res</span><span class="op" id="7688048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7688051">}</span><br>
<span class="lineno">270</span><span class="op" id="7688053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7688056">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="7688125">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="7688197">func</span>&nbsp;<span class="ident" id="7688202">testComment</span><span class="op" id="7688213">(</span><span class="ident" id="7688214">t</span>&nbsp;<span class="op" id="7688216">*</span><span class="ident" id="7688217">testing</span><span class="op" id="7688224">.</span><span class="ident" id="7688225">T</span><span class="op" id="7688226">,</span>&nbsp;<span class="ident" id="7688228">f</span>&nbsp;<span class="op" id="7688230">*</span><span class="ident" id="7688231">ast</span><span class="op" id="7688234">.</span><span class="ident" id="7688235">File</span><span class="op" id="7688239">,</span>&nbsp;<span class="ident" id="7688241">srclen</span>&nbsp;<span class="builtintype" id="7688248">int</span><span class="op" id="7688251">,</span>&nbsp;<span class="ident" id="7688253">comment</span>&nbsp;<span class="op" id="7688261">*</span><span class="ident" id="7688262">ast</span><span class="op" id="7688265">.</span><span class="ident" id="7688266">Comment</span><span class="op" id="7688273">)</span>&nbsp;<span class="op" id="7688275">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7688278">f</span><span class="op" id="7688279">.</span><span class="ident" id="7688280">Comments</span><span class="op" id="7688288">[</span><span class="num" id="7688289">0</span><span class="op" id="7688290">]</span><span class="op" id="7688291">.</span><span class="ident" id="7688292">List</span><span class="op" id="7688296">[</span><span class="num" id="7688297">0</span><span class="op" id="7688298">]</span>&nbsp;<span class="op" id="7688300">=</span>&nbsp;<span class="ident" id="7688302">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7688311">var</span>&nbsp;<span class="ident" id="7688315">buf</span>&nbsp;<span class="ident" id="7688319">bytes</span><span class="op" id="7688324">.</span><span class="ident" id="7688325">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7688333">for</span>&nbsp;<span class="ident" id="7688337">offs</span>&nbsp;<span class="op" id="7688342">:=</span>&nbsp;<span class="num" id="7688345">0</span><span class="op" id="7688346">;</span>&nbsp;<span class="ident" id="7688348">offs</span>&nbsp;<span class="op" id="7688353">&lt;=</span>&nbsp;<span class="ident" id="7688356">srclen</span><span class="op" id="7688362">;</span>&nbsp;<span class="ident" id="7688364">offs</span><span class="op" id="7688368">++</span>&nbsp;<span class="op" id="7688371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7688375">buf</span><span class="op" id="7688378">.</span><span class="ident" id="7688379">Reset</span><span class="op" id="7688384">(</span><span class="op" id="7688385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7688389">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7688443">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7688497">if</span>&nbsp;<span class="ident" id="7688500">err</span>&nbsp;<span class="op" id="7688504">:=</span>&nbsp;<span class="ident" id="7688507">Fprint</span><span class="op" id="7688513">(</span><span class="op" id="7688514">&amp;</span><span class="ident" id="7688515">buf</span><span class="op" id="7688518">,</span>&nbsp;<span class="ident" id="7688520">fset</span><span class="op" id="7688524">,</span>&nbsp;<span class="ident" id="7688526">f</span><span class="op" id="7688527">)</span><span class="op" id="7688528">;</span>&nbsp;<span class="ident" id="7688530">err</span>&nbsp;<span class="op" id="7688534">!=</span>&nbsp;<span class="builtintype" id="7688537">nil</span>&nbsp;<span class="op" id="7688541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7688546">t</span><span class="op" id="7688547">.</span><span class="ident" id="7688548">Error</span><span class="op" id="7688553">(</span><span class="ident" id="7688554">err</span><span class="op" id="7688557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7688561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7688565">if</span>&nbsp;<span class="ident" id="7688568">_</span><span class="op" id="7688569">,</span>&nbsp;<span class="ident" id="7688571">err</span>&nbsp;<span class="op" id="7688575">:=</span>&nbsp;<span class="ident" id="7688578">parser</span><span class="op" id="7688584">.</span><span class="ident" id="7688585">ParseFile</span><span class="op" id="7688594">(</span><span class="ident" id="7688595">fset</span><span class="op" id="7688599">,</span>&nbsp;<span class="string" id="7688601">&#34;&#34;</span><span class="op" id="7688603">,</span>&nbsp;<span class="ident" id="7688605">buf</span><span class="op" id="7688608">.</span><span class="ident" id="7688609">Bytes</span><span class="op" id="7688614">(</span><span class="op" id="7688615">)</span><span class="op" id="7688616">,</span>&nbsp;<span class="num" id="7688618">0</span><span class="op" id="7688619">)</span><span class="op" id="7688620">;</span>&nbsp;<span class="ident" id="7688622">err</span>&nbsp;<span class="op" id="7688626">!=</span>&nbsp;<span class="builtintype" id="7688629">nil</span>&nbsp;<span class="op" id="7688633">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7688638">t</span><span class="op" id="7688639">.</span><span class="ident" id="7688640">Fatalf</span><span class="op" id="7688646">(</span><span class="string" id="7688647">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="7688684">,</span>&nbsp;<span class="ident" id="7688686">comment</span><span class="op" id="7688693">.</span><span class="ident" id="7688694">Slash</span><span class="op" id="7688699">,</span>&nbsp;<span class="ident" id="7688701">buf</span><span class="op" id="7688704">.</span><span class="ident" id="7688705">String</span><span class="op" id="7688711">(</span><span class="op" id="7688712">)</span><span class="op" id="7688713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7688717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7688721">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7688766">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7688813">comment</span><span class="op" id="7688820">.</span><span class="ident" id="7688821">Slash</span><span class="op" id="7688826">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7688830">}</span><br>
<span class="lineno"></span><span class="op" id="7688832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7688835">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="7688889">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="7688958">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="7688975">func</span>&nbsp;<span class="ident" id="7688980">TestBadComments</span><span class="op" id="7688995">(</span><span class="ident" id="7688996">t</span>&nbsp;<span class="op" id="7688998">*</span><span class="ident" id="7688999">testing</span><span class="op" id="7689006">.</span><span class="ident" id="7689007">T</span><span class="op" id="7689008">)</span>&nbsp;<span class="op" id="7689010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7689013">const</span>&nbsp;<span class="ident" id="7689019">src</span>&nbsp;<span class="op" id="7689023">=</span>&nbsp;<span class="string" id="7689025">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;u,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7689279">f</span><span class="op" id="7689280">,</span>&nbsp;<span class="ident" id="7689282">err</span>&nbsp;<span class="op" id="7689286">:=</span>&nbsp;<span class="ident" id="7689289">parser</span><span class="op" id="7689295">.</span><span class="ident" id="7689296">ParseFile</span><span class="op" id="7689305">(</span><span class="ident" id="7689306">fset</span><span class="op" id="7689310">,</span>&nbsp;<span class="string" id="7689312">&#34;&#34;</span><span class="op" id="7689314">,</span>&nbsp;<span class="ident" id="7689316">src</span><span class="op" id="7689319">,</span>&nbsp;<span class="ident" id="7689321">parser</span><span class="op" id="7689327">.</span><span class="ident" id="7689328">ParseComments</span><span class="op" id="7689341">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7689344">if</span>&nbsp;<span class="ident" id="7689347">err</span>&nbsp;<span class="op" id="7689351">!=</span>&nbsp;<span class="builtintype" id="7689354">nil</span>&nbsp;<span class="op" id="7689358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7689362">t</span><span class="op" id="7689363">.</span><span class="ident" id="7689364">Error</span><span class="op" id="7689369">(</span><span class="ident" id="7689370">err</span><span class="op" id="7689373">)</span>&nbsp;<span class="comment" id="7689375">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7689393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7689397">comment</span>&nbsp;<span class="op" id="7689405">:=</span>&nbsp;<span class="ident" id="7689408">f</span><span class="op" id="7689409">.</span><span class="ident" id="7689410">Comments</span><span class="op" id="7689418">[</span><span class="num" id="7689419">0</span><span class="op" id="7689420">]</span><span class="op" id="7689421">.</span><span class="ident" id="7689422">List</span><span class="op" id="7689426">[</span><span class="num" id="7689427">0</span><span class="op" id="7689428">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7689431">pos</span>&nbsp;<span class="op" id="7689435">:=</span>&nbsp;<span class="ident" id="7689438">comment</span><span class="op" id="7689445">.</span><span class="ident" id="7689446">Pos</span><span class="op" id="7689449">(</span><span class="op" id="7689450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7689453">if</span>&nbsp;<span class="ident" id="7689456">fset</span><span class="op" id="7689460">.</span><span class="ident" id="7689461">Position</span><span class="op" id="7689469">(</span><span class="ident" id="7689470">pos</span><span class="op" id="7689473">)</span><span class="op" id="7689474">.</span><span class="ident" id="7689475">Offset</span>&nbsp;<span class="op" id="7689482">!=</span>&nbsp;<span class="num" id="7689485">1</span>&nbsp;<span class="op" id="7689487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7689491">t</span><span class="op" id="7689492">.</span><span class="ident" id="7689493">Error</span><span class="op" id="7689498">(</span><span class="string" id="7689499">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="7689518">)</span>&nbsp;<span class="comment" id="7689520">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7689538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7689542">testComment</span><span class="op" id="7689553">(</span><span class="ident" id="7689554">t</span><span class="op" id="7689555">,</span>&nbsp;<span class="ident" id="7689557">f</span><span class="op" id="7689558">,</span>&nbsp;<span class="builtinfunc" id="7689560">len</span><span class="op" id="7689563">(</span><span class="ident" id="7689564">src</span><span class="op" id="7689567">)</span><span class="op" id="7689568">,</span>&nbsp;<span class="op" id="7689570">&amp;</span><span class="ident" id="7689571">ast</span><span class="op" id="7689574">.</span><span class="ident" id="7689575">Comment</span><span class="op" id="7689582">{</span><span class="ident" id="7689583">Slash</span><span class="op" id="7689588">:</span>&nbsp;<span class="ident" id="7689590">pos</span><span class="op" id="7689593">,</span>&nbsp;<span class="ident" id="7689595">Text</span><span class="op" id="7689599">:</span>&nbsp;<span class="string" id="7689601">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="7689619">}</span><span class="op" id="7689620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7689623">testComment</span><span class="op" id="7689634">(</span><span class="ident" id="7689635">t</span><span class="op" id="7689636">,</span>&nbsp;<span class="ident" id="7689638">f</span><span class="op" id="7689639">,</span>&nbsp;<span class="builtinfunc" id="7689641">len</span><span class="op" id="7689644">(</span><span class="ident" id="7689645">src</span><span class="op" id="7689648">)</span><span class="op" id="7689649">,</span>&nbsp;<span class="op" id="7689651">&amp;</span><span class="ident" id="7689652">ast</span><span class="op" id="7689655">.</span><span class="ident" id="7689656">Comment</span><span class="op" id="7689663">{</span><span class="ident" id="7689664">Slash</span><span class="op" id="7689669">:</span>&nbsp;<span class="ident" id="7689671">pos</span><span class="op" id="7689674">,</span>&nbsp;<span class="ident" id="7689676">Text</span><span class="op" id="7689680">:</span>&nbsp;<span class="string" id="7689682">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="7689703">}</span><span class="op" id="7689704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7689707">testComment</span><span class="op" id="7689718">(</span><span class="ident" id="7689719">t</span><span class="op" id="7689720">,</span>&nbsp;<span class="ident" id="7689722">f</span><span class="op" id="7689723">,</span>&nbsp;<span class="builtinfunc" id="7689725">len</span><span class="op" id="7689728">(</span><span class="ident" id="7689729">src</span><span class="op" id="7689732">)</span><span class="op" id="7689733">,</span>&nbsp;<span class="op" id="7689735">&amp;</span><span class="ident" id="7689736">ast</span><span class="op" id="7689739">.</span><span class="ident" id="7689740">Comment</span><span class="op" id="7689747">{</span><span class="ident" id="7689748">Slash</span><span class="op" id="7689753">:</span>&nbsp;<span class="ident" id="7689755">pos</span><span class="op" id="7689758">,</span>&nbsp;<span class="ident" id="7689760">Text</span><span class="op" id="7689764">:</span>&nbsp;<span class="string" id="7689766">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="7689790">}</span><span class="op" id="7689791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7689794">testComment</span><span class="op" id="7689805">(</span><span class="ident" id="7689806">t</span><span class="op" id="7689807">,</span>&nbsp;<span class="ident" id="7689809">f</span><span class="op" id="7689810">,</span>&nbsp;<span class="builtinfunc" id="7689812">len</span><span class="op" id="7689815">(</span><span class="ident" id="7689816">src</span><span class="op" id="7689819">)</span><span class="op" id="7689820">,</span>&nbsp;<span class="op" id="7689822">&amp;</span><span class="ident" id="7689823">ast</span><span class="op" id="7689826">.</span><span class="ident" id="7689827">Comment</span><span class="op" id="7689834">{</span><span class="ident" id="7689835">Slash</span><span class="op" id="7689840">:</span>&nbsp;<span class="ident" id="7689842">pos</span><span class="op" id="7689845">,</span>&nbsp;<span class="ident" id="7689847">Text</span><span class="op" id="7689851">:</span>&nbsp;<span class="string" id="7689853">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="7689881">}</span><span class="op" id="7689882">)</span><br>
<span class="lineno"></span><span class="op" id="7689884">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="7689887">type</span>&nbsp;<span class="ident" id="7689892">visitor</span>&nbsp;<span class="keyword" id="7689900">chan</span>&nbsp;<span class="op" id="7689905">*</span><span class="ident" id="7689906">ast</span><span class="op" id="7689909">.</span><span class="ident" id="7689910">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7689917">func</span>&nbsp;<span class="op" id="7689922">(</span><span class="ident" id="7689923">v</span>&nbsp;<span class="ident" id="7689925">visitor</span><span class="op" id="7689932">)</span>&nbsp;<span class="ident" id="7689934">Visit</span><span class="op" id="7689939">(</span><span class="ident" id="7689940">n</span>&nbsp;<span class="ident" id="7689942">ast</span><span class="op" id="7689945">.</span><span class="ident" id="7689946">Node</span><span class="op" id="7689950">)</span>&nbsp;<span class="op" id="7689952">(</span><span class="ident" id="7689953">w</span>&nbsp;<span class="ident" id="7689955">ast</span><span class="op" id="7689958">.</span><span class="ident" id="7689959">Visitor</span><span class="op" id="7689966">)</span>&nbsp;<span class="op" id="7689968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7689971">if</span>&nbsp;<span class="ident" id="7689974">ident</span><span class="op" id="7689979">,</span>&nbsp;<span class="ident" id="7689981">ok</span>&nbsp;<span class="op" id="7689984">:=</span>&nbsp;<span class="ident" id="7689987">n</span><span class="op" id="7689988">.</span><span class="op" id="7689989">(</span><span class="op" id="7689990">*</span><span class="ident" id="7689991">ast</span><span class="op" id="7689994">.</span><span class="ident" id="7689995">Ident</span><span class="op" id="7690000">)</span><span class="op" id="7690001">;</span>&nbsp;<span class="ident" id="7690003">ok</span>&nbsp;<span class="op" id="7690006">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7690010">v</span>&nbsp;<span class="op" id="7690012">&lt;-</span>&nbsp;<span class="ident" id="7690015">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7690022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7690025">return</span>&nbsp;<span class="ident" id="7690032">v</span><br>
<span class="lineno"></span><span class="op" id="7690034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="7690037">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="7690115">func</span>&nbsp;<span class="ident" id="7690120">idents</span><span class="op" id="7690126">(</span><span class="ident" id="7690127">f</span>&nbsp;<span class="op" id="7690129">*</span><span class="ident" id="7690130">ast</span><span class="op" id="7690133">.</span><span class="ident" id="7690134">File</span><span class="op" id="7690138">)</span>&nbsp;<span class="op" id="7690140">&lt;-</span><span class="keyword" id="7690142">chan</span>&nbsp;<span class="op" id="7690147">*</span><span class="ident" id="7690148">ast</span><span class="op" id="7690151">.</span><span class="ident" id="7690152">Ident</span>&nbsp;<span class="op" id="7690158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7690161">v</span>&nbsp;<span class="op" id="7690163">:=</span>&nbsp;<span class="builtinfunc" id="7690166">make</span><span class="op" id="7690170">(</span><span class="ident" id="7690171">visitor</span><span class="op" id="7690178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7690181">go</span>&nbsp;<span class="keyword" id="7690184">func</span><span class="op" id="7690188">(</span><span class="op" id="7690189">)</span>&nbsp;<span class="op" id="7690191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7690195">ast</span><span class="op" id="7690198">.</span><span class="ident" id="7690199">Walk</span><span class="op" id="7690203">(</span><span class="ident" id="7690204">v</span><span class="op" id="7690205">,</span>&nbsp;<span class="ident" id="7690207">f</span><span class="op" id="7690208">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7690212">close</span><span class="op" id="7690217">(</span><span class="ident" id="7690218">v</span><span class="op" id="7690219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7690222">}</span><span class="op" id="7690223">(</span><span class="op" id="7690224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7690227">return</span>&nbsp;<span class="ident" id="7690234">v</span><br>
<span class="lineno"></span><span class="op" id="7690236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="7690239">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="7690299">func</span>&nbsp;<span class="ident" id="7690304">identCount</span><span class="op" id="7690314">(</span><span class="ident" id="7690315">f</span>&nbsp;<span class="op" id="7690317">*</span><span class="ident" id="7690318">ast</span><span class="op" id="7690321">.</span><span class="ident" id="7690322">File</span><span class="op" id="7690326">)</span>&nbsp;<span class="builtintype" id="7690328">int</span>&nbsp;<span class="op" id="7690332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7690335">n</span>&nbsp;<span class="op" id="7690337">:=</span>&nbsp;<span class="num" id="7690340">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7690343">for</span>&nbsp;<span class="keyword" id="7690347">range</span>&nbsp;<span class="ident" id="7690353">idents</span><span class="op" id="7690359">(</span><span class="ident" id="7690360">f</span><span class="op" id="7690361">)</span>&nbsp;<span class="op" id="7690363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7690367">n</span><span class="op" id="7690368">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7690372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7690375">return</span>&nbsp;<span class="ident" id="7690382">n</span><br>
<span class="lineno"></span><span class="op" id="7690384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7690387">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="7690451">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="7690516">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="7690534">func</span>&nbsp;<span class="ident" id="7690539">TestSourcePos</span><span class="op" id="7690552">(</span><span class="ident" id="7690553">t</span>&nbsp;<span class="op" id="7690555">*</span><span class="ident" id="7690556">testing</span><span class="op" id="7690563">.</span><span class="ident" id="7690564">T</span><span class="op" id="7690565">)</span>&nbsp;<span class="op" id="7690567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7690570">const</span>&nbsp;<span class="ident" id="7690576">src</span>&nbsp;<span class="op" id="7690580">=</span>&nbsp;<span class="string" id="7690582">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7690807">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7690826">f1</span><span class="op" id="7690828">,</span>&nbsp;<span class="ident" id="7690830">err</span>&nbsp;<span class="op" id="7690834">:=</span>&nbsp;<span class="ident" id="7690837">parser</span><span class="op" id="7690843">.</span><span class="ident" id="7690844">ParseFile</span><span class="op" id="7690853">(</span><span class="ident" id="7690854">fset</span><span class="op" id="7690858">,</span>&nbsp;<span class="string" id="7690860">&#34;src&#34;</span><span class="op" id="7690865">,</span>&nbsp;<span class="ident" id="7690867">src</span><span class="op" id="7690870">,</span>&nbsp;<span class="ident" id="7690872">parser</span><span class="op" id="7690878">.</span><span class="ident" id="7690879">ParseComments</span><span class="op" id="7690892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7690895">if</span>&nbsp;<span class="ident" id="7690898">err</span>&nbsp;<span class="op" id="7690902">!=</span>&nbsp;<span class="builtintype" id="7690905">nil</span>&nbsp;<span class="op" id="7690909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7690913">t</span><span class="op" id="7690914">.</span><span class="ident" id="7690915">Fatal</span><span class="op" id="7690920">(</span><span class="ident" id="7690921">err</span><span class="op" id="7690924">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7690927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7690931">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7690957">var</span>&nbsp;<span class="ident" id="7690961">buf</span>&nbsp;<span class="ident" id="7690965">bytes</span><span class="op" id="7690970">.</span><span class="ident" id="7690971">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7690979">err</span>&nbsp;<span class="op" id="7690983">=</span>&nbsp;<span class="op" id="7690985">(</span><span class="op" id="7690986">&amp;</span><span class="ident" id="7690987">Config</span><span class="op" id="7690993">{</span><span class="ident" id="7690994">Mode</span><span class="op" id="7690998">:</span>&nbsp;<span class="ident" id="7691000">UseSpaces</span>&nbsp;<span class="op" id="7691010">|</span>&nbsp;<span class="ident" id="7691012">SourcePos</span><span class="op" id="7691021">,</span>&nbsp;<span class="ident" id="7691023">Tabwidth</span><span class="op" id="7691031">:</span>&nbsp;<span class="num" id="7691033">8</span><span class="op" id="7691034">}</span><span class="op" id="7691035">)</span><span class="op" id="7691036">.</span><span class="ident" id="7691037">Fprint</span><span class="op" id="7691043">(</span><span class="op" id="7691044">&amp;</span><span class="ident" id="7691045">buf</span><span class="op" id="7691048">,</span>&nbsp;<span class="ident" id="7691050">fset</span><span class="op" id="7691054">,</span>&nbsp;<span class="ident" id="7691056">f1</span><span class="op" id="7691058">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7691061">if</span>&nbsp;<span class="ident" id="7691064">err</span>&nbsp;<span class="op" id="7691068">!=</span>&nbsp;<span class="builtintype" id="7691071">nil</span>&nbsp;<span class="op" id="7691075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7691079">t</span><span class="op" id="7691080">.</span><span class="ident" id="7691081">Fatal</span><span class="op" id="7691086">(</span><span class="ident" id="7691087">err</span><span class="op" id="7691090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7691093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7691097">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7691131">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7691207">f2</span><span class="op" id="7691209">,</span>&nbsp;<span class="ident" id="7691211">err</span>&nbsp;<span class="op" id="7691215">:=</span>&nbsp;<span class="ident" id="7691218">parser</span><span class="op" id="7691224">.</span><span class="ident" id="7691225">ParseFile</span><span class="op" id="7691234">(</span><span class="ident" id="7691235">fset</span><span class="op" id="7691239">,</span>&nbsp;<span class="string" id="7691241">&#34;&#34;</span><span class="op" id="7691243">,</span>&nbsp;<span class="ident" id="7691245">buf</span><span class="op" id="7691248">.</span><span class="ident" id="7691249">Bytes</span><span class="op" id="7691254">(</span><span class="op" id="7691255">)</span><span class="op" id="7691256">,</span>&nbsp;<span class="num" id="7691258">0</span><span class="op" id="7691259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7691262">if</span>&nbsp;<span class="ident" id="7691265">err</span>&nbsp;<span class="op" id="7691269">!=</span>&nbsp;<span class="builtintype" id="7691272">nil</span>&nbsp;<span class="op" id="7691276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7691280">t</span><span class="op" id="7691281">.</span><span class="ident" id="7691282">Fatalf</span><span class="op" id="7691288">(</span><span class="string" id="7691289">&#34;%s\n%s&#34;</span><span class="op" id="7691297">,</span>&nbsp;<span class="ident" id="7691299">err</span><span class="op" id="7691302">,</span>&nbsp;<span class="ident" id="7691304">buf</span><span class="op" id="7691307">.</span><span class="ident" id="7691308">Bytes</span><span class="op" id="7691313">(</span><span class="op" id="7691314">)</span><span class="op" id="7691315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7691318">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7691322">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7691393">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7691465">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7691536">n1</span>&nbsp;<span class="op" id="7691539">:=</span>&nbsp;<span class="ident" id="7691542">identCount</span><span class="op" id="7691552">(</span><span class="ident" id="7691553">f1</span><span class="op" id="7691555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7691558">n2</span>&nbsp;<span class="op" id="7691561">:=</span>&nbsp;<span class="ident" id="7691564">identCount</span><span class="op" id="7691574">(</span><span class="ident" id="7691575">f2</span><span class="op" id="7691577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7691580">if</span>&nbsp;<span class="ident" id="7691583">n1</span>&nbsp;<span class="op" id="7691586">==</span>&nbsp;<span class="num" id="7691589">0</span>&nbsp;<span class="op" id="7691591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7691595">t</span><span class="op" id="7691596">.</span><span class="ident" id="7691597">Fatal</span><span class="op" id="7691602">(</span><span class="string" id="7691603">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="7691618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7691621">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7691624">if</span>&nbsp;<span class="ident" id="7691627">n2</span>&nbsp;<span class="op" id="7691630">!=</span>&nbsp;<span class="ident" id="7691633">n1</span>&nbsp;<span class="op" id="7691636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7691640">t</span><span class="op" id="7691641">.</span><span class="ident" id="7691642">Errorf</span><span class="op" id="7691648">(</span><span class="string" id="7691649">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7691673">,</span>&nbsp;<span class="ident" id="7691675">n2</span><span class="op" id="7691677">,</span>&nbsp;<span class="ident" id="7691679">n1</span><span class="op" id="7691681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7691684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7691688">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7691750">i2range</span>&nbsp;<span class="op" id="7691758">:=</span>&nbsp;<span class="ident" id="7691761">idents</span><span class="op" id="7691767">(</span><span class="ident" id="7691768">f2</span><span class="op" id="7691770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7691773">for</span>&nbsp;<span class="ident" id="7691777">i1</span>&nbsp;<span class="op" id="7691780">:=</span>&nbsp;<span class="keyword" id="7691783">range</span>&nbsp;<span class="ident" id="7691789">idents</span><span class="op" id="7691795">(</span><span class="ident" id="7691796">f1</span><span class="op" id="7691798">)</span>&nbsp;<span class="op" id="7691800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7691804">i2</span>&nbsp;<span class="op" id="7691807">:=</span>&nbsp;<span class="op" id="7691810">&lt;-</span><span class="ident" id="7691812">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7691823">if</span>&nbsp;<span class="ident" id="7691826">i2</span><span class="op" id="7691828">.</span><span class="ident" id="7691829">Name</span>&nbsp;<span class="op" id="7691834">!=</span>&nbsp;<span class="ident" id="7691837">i1</span><span class="op" id="7691839">.</span><span class="ident" id="7691840">Name</span>&nbsp;<span class="op" id="7691845">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7691850">t</span><span class="op" id="7691851">.</span><span class="ident" id="7691852">Errorf</span><span class="op" id="7691858">(</span><span class="string" id="7691859">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7691882">,</span>&nbsp;<span class="ident" id="7691884">i2</span><span class="op" id="7691886">.</span><span class="ident" id="7691887">Name</span><span class="op" id="7691891">,</span>&nbsp;<span class="ident" id="7691893">i1</span><span class="op" id="7691895">.</span><span class="ident" id="7691896">Name</span><span class="op" id="7691900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7691904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7691909">l1</span>&nbsp;<span class="op" id="7691912">:=</span>&nbsp;<span class="ident" id="7691915">fset</span><span class="op" id="7691919">.</span><span class="ident" id="7691920">Position</span><span class="op" id="7691928">(</span><span class="ident" id="7691929">i1</span><span class="op" id="7691931">.</span><span class="ident" id="7691932">Pos</span><span class="op" id="7691935">(</span><span class="op" id="7691936">)</span><span class="op" id="7691937">)</span><span class="op" id="7691938">.</span><span class="ident" id="7691939">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7691946">l2</span>&nbsp;<span class="op" id="7691949">:=</span>&nbsp;<span class="ident" id="7691952">fset</span><span class="op" id="7691956">.</span><span class="ident" id="7691957">Position</span><span class="op" id="7691965">(</span><span class="ident" id="7691966">i2</span><span class="op" id="7691968">.</span><span class="ident" id="7691969">Pos</span><span class="op" id="7691972">(</span><span class="op" id="7691973">)</span><span class="op" id="7691974">)</span><span class="op" id="7691975">.</span><span class="ident" id="7691976">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7691983">if</span>&nbsp;<span class="ident" id="7691986">l2</span>&nbsp;<span class="op" id="7691989">!=</span>&nbsp;<span class="ident" id="7691992">l1</span>&nbsp;<span class="op" id="7691995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7692000">t</span><span class="op" id="7692001">.</span><span class="ident" id="7692002">Errorf</span><span class="op" id="7692008">(</span><span class="string" id="7692009">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="7692038">,</span>&nbsp;<span class="ident" id="7692040">l2</span><span class="op" id="7692042">,</span>&nbsp;<span class="ident" id="7692044">l1</span><span class="op" id="7692046">,</span>&nbsp;<span class="ident" id="7692048">i1</span><span class="op" id="7692050">.</span><span class="ident" id="7692051">Name</span><span class="op" id="7692055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7692059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7692062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7692066">if</span>&nbsp;<span class="ident" id="7692069">t</span><span class="op" id="7692070">.</span><span class="ident" id="7692071">Failed</span><span class="op" id="7692077">(</span><span class="op" id="7692078">)</span>&nbsp;<span class="op" id="7692080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7692084">t</span><span class="op" id="7692085">.</span><span class="ident" id="7692086">Logf</span><span class="op" id="7692090">(</span><span class="string" id="7692091">&#34;\n%s&#34;</span><span class="op" id="7692097">,</span>&nbsp;<span class="ident" id="7692099">buf</span><span class="op" id="7692102">.</span><span class="ident" id="7692103">Bytes</span><span class="op" id="7692108">(</span><span class="op" id="7692109">)</span><span class="op" id="7692110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7692113">}</span><br>
<span class="lineno"></span><span class="op" id="7692115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7692118">var</span>&nbsp;<span class="ident" id="7692122">decls</span>&nbsp;<span class="op" id="7692128">=</span>&nbsp;<span class="op" id="7692130">[</span><span class="op" id="7692131">]</span><span class="builtintype" id="7692132">string</span><span class="op" id="7692138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7692141">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="7692155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7692158">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="7692210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7692213">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="7692255">,</span><br>
<span class="lineno"></span><span class="op" id="7692257">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="7692260">func</span>&nbsp;<span class="ident" id="7692265">TestDeclLists</span><span class="op" id="7692278">(</span><span class="ident" id="7692279">t</span>&nbsp;<span class="op" id="7692281">*</span><span class="ident" id="7692282">testing</span><span class="op" id="7692289">.</span><span class="ident" id="7692290">T</span><span class="op" id="7692291">)</span>&nbsp;<span class="op" id="7692293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7692296">for</span>&nbsp;<span class="ident" id="7692300">_</span><span class="op" id="7692301">,</span>&nbsp;<span class="ident" id="7692303">src</span>&nbsp;<span class="op" id="7692307">:=</span>&nbsp;<span class="keyword" id="7692310">range</span>&nbsp;<span class="ident" id="7692316">decls</span>&nbsp;<span class="op" id="7692322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7692326">file</span><span class="op" id="7692330">,</span>&nbsp;<span class="ident" id="7692332">err</span>&nbsp;<span class="op" id="7692336">:=</span>&nbsp;<span class="ident" id="7692339">parser</span><span class="op" id="7692345">.</span><span class="ident" id="7692346">ParseFile</span><span class="op" id="7692355">(</span><span class="ident" id="7692356">fset</span><span class="op" id="7692360">,</span>&nbsp;<span class="string" id="7692362">&#34;&#34;</span><span class="op" id="7692364">,</span>&nbsp;<span class="string" id="7692366">&#34;package&nbsp;p;&#34;</span><span class="op" id="7692378">+</span><span class="ident" id="7692379">src</span><span class="op" id="7692382">,</span>&nbsp;<span class="ident" id="7692384">parser</span><span class="op" id="7692390">.</span><span class="ident" id="7692391">ParseComments</span><span class="op" id="7692404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7692408">if</span>&nbsp;<span class="ident" id="7692411">err</span>&nbsp;<span class="op" id="7692415">!=</span>&nbsp;<span class="builtintype" id="7692418">nil</span>&nbsp;<span class="op" id="7692422">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7692427">panic</span><span class="op" id="7692432">(</span><span class="ident" id="7692433">err</span><span class="op" id="7692436">)</span>&nbsp;<span class="comment" id="7692438">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7692457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7692462">var</span>&nbsp;<span class="ident" id="7692466">buf</span>&nbsp;<span class="ident" id="7692470">bytes</span><span class="op" id="7692475">.</span><span class="ident" id="7692476">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7692485">err</span>&nbsp;<span class="op" id="7692489">=</span>&nbsp;<span class="ident" id="7692491">Fprint</span><span class="op" id="7692497">(</span><span class="op" id="7692498">&amp;</span><span class="ident" id="7692499">buf</span><span class="op" id="7692502">,</span>&nbsp;<span class="ident" id="7692504">fset</span><span class="op" id="7692508">,</span>&nbsp;<span class="ident" id="7692510">file</span><span class="op" id="7692514">.</span><span class="ident" id="7692515">Decls</span><span class="op" id="7692520">)</span>&nbsp;<span class="comment" id="7692522">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7692551">if</span>&nbsp;<span class="ident" id="7692554">err</span>&nbsp;<span class="op" id="7692558">!=</span>&nbsp;<span class="builtintype" id="7692561">nil</span>&nbsp;<span class="op" id="7692565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7692570">panic</span><span class="op" id="7692575">(</span><span class="ident" id="7692576">err</span><span class="op" id="7692579">)</span>&nbsp;<span class="comment" id="7692581">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7692600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7692605">out</span>&nbsp;<span class="op" id="7692609">:=</span>&nbsp;<span class="ident" id="7692612">buf</span><span class="op" id="7692615">.</span><span class="ident" id="7692616">String</span><span class="op" id="7692622">(</span><span class="op" id="7692623">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7692627">if</span>&nbsp;<span class="ident" id="7692630">out</span>&nbsp;<span class="op" id="7692634">!=</span>&nbsp;<span class="ident" id="7692637">src</span>&nbsp;<span class="op" id="7692641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7692646">t</span><span class="op" id="7692647">.</span><span class="ident" id="7692648">Errorf</span><span class="op" id="7692654">(</span><span class="string" id="7692655">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7692679">,</span>&nbsp;<span class="ident" id="7692681">out</span><span class="op" id="7692684">,</span>&nbsp;<span class="ident" id="7692686">src</span><span class="op" id="7692689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7692693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7692696">}</span><br>
<span class="lineno"></span><span class="op" id="7692698">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="7692701">var</span>&nbsp;<span class="ident" id="7692705">stmts</span>&nbsp;<span class="op" id="7692711">=</span>&nbsp;<span class="op" id="7692713">[</span><span class="op" id="7692714">]</span><span class="builtintype" id="7692715">string</span><span class="op" id="7692721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7692724">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="7692732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7692735">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="7692777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7692780">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="7692807">,</span><br>
<span class="lineno">460</span><span class="op" id="7692809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7692812">func</span>&nbsp;<span class="ident" id="7692817">TestStmtLists</span><span class="op" id="7692830">(</span><span class="ident" id="7692831">t</span>&nbsp;<span class="op" id="7692833">*</span><span class="ident" id="7692834">testing</span><span class="op" id="7692841">.</span><span class="ident" id="7692842">T</span><span class="op" id="7692843">)</span>&nbsp;<span class="op" id="7692845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7692848">for</span>&nbsp;<span class="ident" id="7692852">_</span><span class="op" id="7692853">,</span>&nbsp;<span class="ident" id="7692855">src</span>&nbsp;<span class="op" id="7692859">:=</span>&nbsp;<span class="keyword" id="7692862">range</span>&nbsp;<span class="ident" id="7692868">stmts</span>&nbsp;<span class="op" id="7692874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7692878">file</span><span class="op" id="7692882">,</span>&nbsp;<span class="ident" id="7692884">err</span>&nbsp;<span class="op" id="7692888">:=</span>&nbsp;<span class="ident" id="7692891">parser</span><span class="op" id="7692897">.</span><span class="ident" id="7692898">ParseFile</span><span class="op" id="7692907">(</span><span class="ident" id="7692908">fset</span><span class="op" id="7692912">,</span>&nbsp;<span class="string" id="7692914">&#34;&#34;</span><span class="op" id="7692916">,</span>&nbsp;<span class="string" id="7692918">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="7692941">+</span><span class="ident" id="7692942">src</span><span class="op" id="7692945">+</span><span class="string" id="7692946">&#34;}&#34;</span><span class="op" id="7692949">,</span>&nbsp;<span class="ident" id="7692951">parser</span><span class="op" id="7692957">.</span><span class="ident" id="7692958">ParseComments</span><span class="op" id="7692971">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7692975">if</span>&nbsp;<span class="ident" id="7692978">err</span>&nbsp;<span class="op" id="7692982">!=</span>&nbsp;<span class="builtintype" id="7692985">nil</span>&nbsp;<span class="op" id="7692989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7692994">panic</span><span class="op" id="7692999">(</span><span class="ident" id="7693000">err</span><span class="op" id="7693003">)</span>&nbsp;<span class="comment" id="7693005">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7693024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7693029">var</span>&nbsp;<span class="ident" id="7693033">buf</span>&nbsp;<span class="ident" id="7693037">bytes</span><span class="op" id="7693042">.</span><span class="ident" id="7693043">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7693052">err</span>&nbsp;<span class="op" id="7693056">=</span>&nbsp;<span class="ident" id="7693058">Fprint</span><span class="op" id="7693064">(</span><span class="op" id="7693065">&amp;</span><span class="ident" id="7693066">buf</span><span class="op" id="7693069">,</span>&nbsp;<span class="ident" id="7693071">fset</span><span class="op" id="7693075">,</span>&nbsp;<span class="ident" id="7693077">file</span><span class="op" id="7693081">.</span><span class="ident" id="7693082">Decls</span><span class="op" id="7693087">[</span><span class="num" id="7693088">0</span><span class="op" id="7693089">]</span><span class="op" id="7693090">.</span><span class="op" id="7693091">(</span><span class="op" id="7693092">*</span><span class="ident" id="7693093">ast</span><span class="op" id="7693096">.</span><span class="ident" id="7693097">FuncDecl</span><span class="op" id="7693105">)</span><span class="op" id="7693106">.</span><span class="ident" id="7693107">Body</span><span class="op" id="7693111">.</span><span class="ident" id="7693112">List</span><span class="op" id="7693116">)</span>&nbsp;<span class="comment" id="7693118">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7693145">if</span>&nbsp;<span class="ident" id="7693148">err</span>&nbsp;<span class="op" id="7693152">!=</span>&nbsp;<span class="builtintype" id="7693155">nil</span>&nbsp;<span class="op" id="7693159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7693164">panic</span><span class="op" id="7693169">(</span><span class="ident" id="7693170">err</span><span class="op" id="7693173">)</span>&nbsp;<span class="comment" id="7693175">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7693194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7693199">out</span>&nbsp;<span class="op" id="7693203">:=</span>&nbsp;<span class="ident" id="7693206">buf</span><span class="op" id="7693209">.</span><span class="ident" id="7693210">String</span><span class="op" id="7693216">(</span><span class="op" id="7693217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7693221">if</span>&nbsp;<span class="ident" id="7693224">out</span>&nbsp;<span class="op" id="7693228">!=</span>&nbsp;<span class="ident" id="7693231">src</span>&nbsp;<span class="op" id="7693235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7693240">t</span><span class="op" id="7693241">.</span><span class="ident" id="7693242">Errorf</span><span class="op" id="7693248">(</span><span class="string" id="7693249">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7693273">,</span>&nbsp;<span class="ident" id="7693275">out</span><span class="op" id="7693278">,</span>&nbsp;<span class="ident" id="7693280">src</span><span class="op" id="7693283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7693287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7693290">}</span><br>
<span class="lineno">480</span><span class="op" id="7693292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7693295">func</span>&nbsp;<span class="ident" id="7693300">TestBaseIndent</span><span class="op" id="7693314">(</span><span class="ident" id="7693315">t</span>&nbsp;<span class="op" id="7693317">*</span><span class="ident" id="7693318">testing</span><span class="op" id="7693325">.</span><span class="ident" id="7693326">T</span><span class="op" id="7693327">)</span>&nbsp;<span class="op" id="7693329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7693332">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7693401">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7693470">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7693490">const</span>&nbsp;<span class="ident" id="7693496">filename</span>&nbsp;<span class="op" id="7693505">=</span>&nbsp;<span class="string" id="7693507">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7693521">src</span><span class="op" id="7693524">,</span>&nbsp;<span class="ident" id="7693526">err</span>&nbsp;<span class="op" id="7693530">:=</span>&nbsp;<span class="ident" id="7693533">ioutil</span><span class="op" id="7693539">.</span><span class="ident" id="7693540">ReadFile</span><span class="op" id="7693548">(</span><span class="ident" id="7693549">filename</span><span class="op" id="7693557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7693560">if</span>&nbsp;<span class="ident" id="7693563">err</span>&nbsp;<span class="op" id="7693567">!=</span>&nbsp;<span class="builtintype" id="7693570">nil</span>&nbsp;<span class="op" id="7693574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7693578">panic</span><span class="op" id="7693583">(</span><span class="ident" id="7693584">err</span><span class="op" id="7693587">)</span>&nbsp;<span class="comment" id="7693589">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7693607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7693611">file</span><span class="op" id="7693615">,</span>&nbsp;<span class="ident" id="7693617">err</span>&nbsp;<span class="op" id="7693621">:=</span>&nbsp;<span class="ident" id="7693624">parser</span><span class="op" id="7693630">.</span><span class="ident" id="7693631">ParseFile</span><span class="op" id="7693640">(</span><span class="ident" id="7693641">fset</span><span class="op" id="7693645">,</span>&nbsp;<span class="ident" id="7693647">filename</span><span class="op" id="7693655">,</span>&nbsp;<span class="ident" id="7693657">src</span><span class="op" id="7693660">,</span>&nbsp;<span class="num" id="7693662">0</span><span class="op" id="7693663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7693666">if</span>&nbsp;<span class="ident" id="7693669">err</span>&nbsp;<span class="op" id="7693673">!=</span>&nbsp;<span class="builtintype" id="7693676">nil</span>&nbsp;<span class="op" id="7693680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7693684">panic</span><span class="op" id="7693689">(</span><span class="ident" id="7693690">err</span><span class="op" id="7693693">)</span>&nbsp;<span class="comment" id="7693695">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7693713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7693717">var</span>&nbsp;<span class="ident" id="7693721">buf</span>&nbsp;<span class="ident" id="7693725">bytes</span><span class="op" id="7693730">.</span><span class="ident" id="7693731">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7693739">for</span>&nbsp;<span class="ident" id="7693743">indent</span>&nbsp;<span class="op" id="7693750">:=</span>&nbsp;<span class="num" id="7693753">0</span><span class="op" id="7693754">;</span>&nbsp;<span class="ident" id="7693756">indent</span>&nbsp;<span class="op" id="7693763">&lt;</span>&nbsp;<span class="num" id="7693765">4</span><span class="op" id="7693766">;</span>&nbsp;<span class="ident" id="7693768">indent</span><span class="op" id="7693774">++</span>&nbsp;<span class="op" id="7693777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7693781">buf</span><span class="op" id="7693784">.</span><span class="ident" id="7693785">Reset</span><span class="op" id="7693790">(</span><span class="op" id="7693791">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7693795">(</span><span class="op" id="7693796">&amp;</span><span class="ident" id="7693797">Config</span><span class="op" id="7693803">{</span><span class="ident" id="7693804">Tabwidth</span><span class="op" id="7693812">:</span>&nbsp;<span class="ident" id="7693814">tabwidth</span><span class="op" id="7693822">,</span>&nbsp;<span class="ident" id="7693824">Indent</span><span class="op" id="7693830">:</span>&nbsp;<span class="ident" id="7693832">indent</span><span class="op" id="7693838">}</span><span class="op" id="7693839">)</span><span class="op" id="7693840">.</span><span class="ident" id="7693841">Fprint</span><span class="op" id="7693847">(</span><span class="op" id="7693848">&amp;</span><span class="ident" id="7693849">buf</span><span class="op" id="7693852">,</span>&nbsp;<span class="ident" id="7693854">fset</span><span class="op" id="7693858">,</span>&nbsp;<span class="ident" id="7693860">file</span><span class="op" id="7693864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7693868">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7693925">lines</span>&nbsp;<span class="op" id="7693931">:=</span>&nbsp;<span class="ident" id="7693934">bytes</span><span class="op" id="7693939">.</span><span class="ident" id="7693940">Split</span><span class="op" id="7693945">(</span><span class="ident" id="7693946">buf</span><span class="op" id="7693949">.</span><span class="ident" id="7693950">Bytes</span><span class="op" id="7693955">(</span><span class="op" id="7693956">)</span><span class="op" id="7693957">,</span>&nbsp;<span class="op" id="7693959">[</span><span class="op" id="7693960">]</span><span class="builtintype" id="7693961">byte</span><span class="op" id="7693965">{</span><span class="string" id="7693966">&#39;\n&#39;</span><span class="op" id="7693970">}</span><span class="op" id="7693971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7693975">for</span>&nbsp;<span class="ident" id="7693979">i</span><span class="op" id="7693980">,</span>&nbsp;<span class="ident" id="7693982">line</span>&nbsp;<span class="op" id="7693987">:=</span>&nbsp;<span class="keyword" id="7693990">range</span>&nbsp;<span class="ident" id="7693996">lines</span>&nbsp;<span class="op" id="7694002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7694007">if</span>&nbsp;<span class="builtinfunc" id="7694010">len</span><span class="op" id="7694013">(</span><span class="ident" id="7694014">line</span><span class="op" id="7694018">)</span>&nbsp;<span class="op" id="7694020">==</span>&nbsp;<span class="num" id="7694023">0</span>&nbsp;<span class="op" id="7694025">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7694031">continue</span>&nbsp;<span class="comment" id="7694040">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7694081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7694086">n</span>&nbsp;<span class="op" id="7694088">:=</span>&nbsp;<span class="num" id="7694091">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7694096">for</span>&nbsp;<span class="ident" id="7694100">j</span><span class="op" id="7694101">,</span>&nbsp;<span class="ident" id="7694103">b</span>&nbsp;<span class="op" id="7694105">:=</span>&nbsp;<span class="keyword" id="7694108">range</span>&nbsp;<span class="ident" id="7694114">line</span>&nbsp;<span class="op" id="7694119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7694125">if</span>&nbsp;<span class="ident" id="7694128">b</span>&nbsp;<span class="op" id="7694130">!=</span>&nbsp;<span class="string" id="7694133">&#39;\t&#39;</span>&nbsp;<span class="op" id="7694138">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7694145">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7694172">n</span>&nbsp;<span class="op" id="7694174">=</span>&nbsp;<span class="ident" id="7694176">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7694183">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7694193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7694198">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7694203">if</span>&nbsp;<span class="ident" id="7694206">n</span>&nbsp;<span class="op" id="7694208">&lt;</span>&nbsp;<span class="ident" id="7694210">indent</span>&nbsp;<span class="op" id="7694217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7694223">t</span><span class="op" id="7694224">.</span><span class="ident" id="7694225">Errorf</span><span class="op" id="7694231">(</span><span class="string" id="7694232">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="7694281">,</span>&nbsp;<span class="ident" id="7694283">i</span><span class="op" id="7694284">,</span>&nbsp;<span class="ident" id="7694286">n</span><span class="op" id="7694287">,</span>&nbsp;<span class="ident" id="7694289">indent</span><span class="op" id="7694295">,</span>&nbsp;<span class="ident" id="7694297">line</span><span class="op" id="7694301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7694306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7694310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7694313">}</span><br>
<span class="lineno">520</span><span class="op" id="7694315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7694318">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="7694385">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="7694457">func</span>&nbsp;<span class="ident" id="7694462">TestFuncType</span><span class="op" id="7694474">(</span><span class="ident" id="7694475">t</span>&nbsp;<span class="op" id="7694477">*</span><span class="ident" id="7694478">testing</span><span class="op" id="7694485">.</span><span class="ident" id="7694486">T</span><span class="op" id="7694487">)</span>&nbsp;<span class="op" id="7694489">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7694492">src</span>&nbsp;<span class="op" id="7694496">:=</span>&nbsp;<span class="op" id="7694499">&amp;</span><span class="ident" id="7694500">ast</span><span class="op" id="7694503">.</span><span class="ident" id="7694504">File</span><span class="op" id="7694508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7694512">Name</span><span class="op" id="7694516">:</span>&nbsp;<span class="op" id="7694518">&amp;</span><span class="ident" id="7694519">ast</span><span class="op" id="7694522">.</span><span class="ident" id="7694523">Ident</span><span class="op" id="7694528">{</span><span class="ident" id="7694529">Name</span><span class="op" id="7694533">:</span>&nbsp;<span class="string" id="7694535">&#34;p&#34;</span><span class="op" id="7694538">}</span><span class="op" id="7694539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7694543">Decls</span><span class="op" id="7694548">:</span>&nbsp;<span class="op" id="7694550">[</span><span class="op" id="7694551">]</span><span class="ident" id="7694552">ast</span><span class="op" id="7694555">.</span><span class="ident" id="7694556">Decl</span><span class="op" id="7694560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7694565">&amp;</span><span class="ident" id="7694566">ast</span><span class="op" id="7694569">.</span><span class="ident" id="7694570">FuncDecl</span><span class="op" id="7694578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7694584">Name</span><span class="op" id="7694588">:</span>&nbsp;<span class="op" id="7694590">&amp;</span><span class="ident" id="7694591">ast</span><span class="op" id="7694594">.</span><span class="ident" id="7694595">Ident</span><span class="op" id="7694600">{</span><span class="ident" id="7694601">Name</span><span class="op" id="7694605">:</span>&nbsp;<span class="string" id="7694607">&#34;f&#34;</span><span class="op" id="7694610">}</span><span class="op" id="7694611">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7694617">Type</span><span class="op" id="7694621">:</span>&nbsp;<span class="op" id="7694623">&amp;</span><span class="ident" id="7694624">ast</span><span class="op" id="7694627">.</span><span class="ident" id="7694628">FuncType</span><span class="op" id="7694636">{</span><span class="op" id="7694637">}</span><span class="op" id="7694638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7694643">}</span><span class="op" id="7694644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7694648">}</span><span class="op" id="7694649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7694652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7694656">var</span>&nbsp;<span class="ident" id="7694660">buf</span>&nbsp;<span class="ident" id="7694664">bytes</span><span class="op" id="7694669">.</span><span class="ident" id="7694670">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7694678">if</span>&nbsp;<span class="ident" id="7694681">err</span>&nbsp;<span class="op" id="7694685">:=</span>&nbsp;<span class="ident" id="7694688">Fprint</span><span class="op" id="7694694">(</span><span class="op" id="7694695">&amp;</span><span class="ident" id="7694696">buf</span><span class="op" id="7694699">,</span>&nbsp;<span class="ident" id="7694701">fset</span><span class="op" id="7694705">,</span>&nbsp;<span class="ident" id="7694707">src</span><span class="op" id="7694710">)</span><span class="op" id="7694711">;</span>&nbsp;<span class="ident" id="7694713">err</span>&nbsp;<span class="op" id="7694717">!=</span>&nbsp;<span class="builtintype" id="7694720">nil</span>&nbsp;<span class="op" id="7694724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7694728">t</span><span class="op" id="7694729">.</span><span class="ident" id="7694730">Fatal</span><span class="op" id="7694735">(</span><span class="ident" id="7694736">err</span><span class="op" id="7694739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7694742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7694745">got</span>&nbsp;<span class="op" id="7694749">:=</span>&nbsp;<span class="ident" id="7694752">buf</span><span class="op" id="7694755">.</span><span class="ident" id="7694756">String</span><span class="op" id="7694762">(</span><span class="op" id="7694763">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7694767">const</span>&nbsp;<span class="ident" id="7694773">want</span>&nbsp;<span class="op" id="7694778">=</span>&nbsp;<span class="string" id="7694780">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7694805">if</span>&nbsp;<span class="ident" id="7694808">got</span>&nbsp;<span class="op" id="7694812">!=</span>&nbsp;<span class="ident" id="7694815">want</span>&nbsp;<span class="op" id="7694820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7694824">t</span><span class="op" id="7694825">.</span><span class="ident" id="7694826">Fatalf</span><span class="op" id="7694832">(</span><span class="string" id="7694833">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="7694856">,</span>&nbsp;<span class="ident" id="7694858">got</span><span class="op" id="7694861">,</span>&nbsp;<span class="ident" id="7694863">want</span><span class="op" id="7694867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7694870">}</span><br>
<span class="lineno"></span><span class="op" id="7694872">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="7694875">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="7694954">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="7694972">func</span>&nbsp;<span class="ident" id="7694977">TestX</span><span class="op" id="7694982">(</span><span class="ident" id="7694983">t</span>&nbsp;<span class="op" id="7694985">*</span><span class="ident" id="7694986">testing</span><span class="op" id="7694993">.</span><span class="ident" id="7694994">T</span><span class="op" id="7694995">)</span>&nbsp;<span class="op" id="7694997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7695000">const</span>&nbsp;<span class="ident" id="7695006">src</span>&nbsp;<span class="op" id="7695010">=</span>&nbsp;<span class="string" id="7695012">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7695039">_</span><span class="op" id="7695040">,</span>&nbsp;<span class="ident" id="7695042">err</span>&nbsp;<span class="op" id="7695046">:=</span>&nbsp;<span class="ident" id="7695049">format</span><span class="op" id="7695055">(</span><span class="op" id="7695056">[</span><span class="op" id="7695057">]</span><span class="builtintype" id="7695058">byte</span><span class="op" id="7695062">(</span><span class="ident" id="7695063">src</span><span class="op" id="7695066">)</span><span class="op" id="7695067">,</span>&nbsp;<span class="num" id="7695069">0</span><span class="op" id="7695070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7695073">if</span>&nbsp;<span class="ident" id="7695076">err</span>&nbsp;<span class="op" id="7695080">!=</span>&nbsp;<span class="builtintype" id="7695083">nil</span>&nbsp;<span class="op" id="7695087">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7695091">t</span><span class="op" id="7695092">.</span><span class="ident" id="7695093">Error</span><span class="op" id="7695098">(</span><span class="ident" id="7695099">err</span><span class="op" id="7695102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7695105">}</span><br>
<span class="lineno"></span><span class="op" id="7695107">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
