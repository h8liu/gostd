<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5424863">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5424918">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5424972">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5425023">package</span>&nbsp;<span class="ident" id="5425031">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5425037">import</span>&nbsp;<span class="op" id="5425044">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5425047">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5425062">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5425076">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5425086">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="5425092">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5425095">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="5425155">type</span>&nbsp;<span class="ident" id="5425160">Auth</span>&nbsp;<span class="keyword" id="5425165">interface</span>&nbsp;<span class="op" id="5425175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425178">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425228">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425283">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425346">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425408">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425455">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425513">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5425571">Start</span><span class="op" id="5425576">(</span><span class="ident" id="5425577">server</span>&nbsp;<span class="op" id="5425584">*</span><span class="ident" id="5425585">ServerInfo</span><span class="op" id="5425595">)</span>&nbsp;<span class="op" id="5425597">(</span><span class="ident" id="5425598">proto</span>&nbsp;<span class="builtintype" id="5425604">string</span><span class="op" id="5425610">,</span>&nbsp;<span class="ident" id="5425612">toServer</span>&nbsp;<span class="op" id="5425621">[</span><span class="op" id="5425622">]</span><span class="builtintype" id="5425623">byte</span><span class="op" id="5425627">,</span>&nbsp;<span class="ident" id="5425629">err</span>&nbsp;<span class="builtintype" id="5425633">error</span><span class="op" id="5425638">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425642">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425706">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425769">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425831">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425871">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425931">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5425989">Next</span><span class="op" id="5425993">(</span><span class="ident" id="5425994">fromServer</span>&nbsp;<span class="op" id="5426005">[</span><span class="op" id="5426006">]</span><span class="builtintype" id="5426007">byte</span><span class="op" id="5426011">,</span>&nbsp;<span class="ident" id="5426013">more</span>&nbsp;<span class="builtintype" id="5426018">bool</span><span class="op" id="5426022">)</span>&nbsp;<span class="op" id="5426024">(</span><span class="ident" id="5426025">toServer</span>&nbsp;<span class="op" id="5426034">[</span><span class="op" id="5426035">]</span><span class="builtintype" id="5426036">byte</span><span class="op" id="5426040">,</span>&nbsp;<span class="ident" id="5426042">err</span>&nbsp;<span class="builtintype" id="5426046">error</span><span class="op" id="5426051">)</span><br>
<span class="lineno"></span><span class="op" id="5426053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5426056">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="5426112">type</span>&nbsp;<span class="ident" id="5426117">ServerInfo</span>&nbsp;<span class="keyword" id="5426128">struct</span>&nbsp;<span class="op" id="5426135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426138">Name</span>&nbsp;<span class="builtintype" id="5426143">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5426152">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426173">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="5426178">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5426187">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426234">Auth</span>&nbsp;<span class="op" id="5426239">[</span><span class="op" id="5426240">]</span><span class="builtintype" id="5426241">string</span>&nbsp;<span class="comment" id="5426248">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="5426288">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5426291">type</span>&nbsp;<span class="ident" id="5426296">plainAuth</span>&nbsp;<span class="keyword" id="5426306">struct</span>&nbsp;<span class="op" id="5426313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426316">identity</span><span class="op" id="5426324">,</span>&nbsp;<span class="ident" id="5426326">username</span><span class="op" id="5426334">,</span>&nbsp;<span class="ident" id="5426336">password</span>&nbsp;<span class="builtintype" id="5426345">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426353">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5426382">string</span><br>
<span class="lineno"></span><span class="op" id="5426389">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5426392">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="5426462">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="5426499">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="5426573">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="5426649">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="5426683">func</span>&nbsp;<span class="ident" id="5426688">PlainAuth</span><span class="op" id="5426697">(</span><span class="ident" id="5426698">identity</span><span class="op" id="5426706">,</span>&nbsp;<span class="ident" id="5426708">username</span><span class="op" id="5426716">,</span>&nbsp;<span class="ident" id="5426718">password</span><span class="op" id="5426726">,</span>&nbsp;<span class="ident" id="5426728">host</span>&nbsp;<span class="builtintype" id="5426733">string</span><span class="op" id="5426739">)</span>&nbsp;<span class="ident" id="5426741">Auth</span>&nbsp;<span class="op" id="5426746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426749">return</span>&nbsp;<span class="op" id="5426756">&amp;</span><span class="ident" id="5426757">plainAuth</span><span class="op" id="5426766">{</span><span class="ident" id="5426767">identity</span><span class="op" id="5426775">,</span>&nbsp;<span class="ident" id="5426777">username</span><span class="op" id="5426785">,</span>&nbsp;<span class="ident" id="5426787">password</span><span class="op" id="5426795">,</span>&nbsp;<span class="ident" id="5426797">host</span><span class="op" id="5426801">}</span><br>
<span class="lineno"></span><span class="op" id="5426803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5426806">func</span>&nbsp;<span class="op" id="5426811">(</span><span class="ident" id="5426812">a</span>&nbsp;<span class="op" id="5426814">*</span><span class="ident" id="5426815">plainAuth</span><span class="op" id="5426824">)</span>&nbsp;<span class="ident" id="5426826">Start</span><span class="op" id="5426831">(</span><span class="ident" id="5426832">server</span>&nbsp;<span class="op" id="5426839">*</span><span class="ident" id="5426840">ServerInfo</span><span class="op" id="5426850">)</span>&nbsp;<span class="op" id="5426852">(</span><span class="builtintype" id="5426853">string</span><span class="op" id="5426859">,</span>&nbsp;<span class="op" id="5426861">[</span><span class="op" id="5426862">]</span><span class="builtintype" id="5426863">byte</span><span class="op" id="5426867">,</span>&nbsp;<span class="builtintype" id="5426869">error</span><span class="op" id="5426874">)</span>&nbsp;<span class="op" id="5426876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426879">if</span>&nbsp;<span class="op" id="5426882">!</span><span class="ident" id="5426883">server</span><span class="op" id="5426889">.</span><span class="ident" id="5426890">TLS</span>&nbsp;<span class="op" id="5426894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426898">advertised</span>&nbsp;<span class="op" id="5426909">:=</span>&nbsp;<span class="builtintype" id="5426912">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426920">for</span>&nbsp;<span class="ident" id="5426924">_</span><span class="op" id="5426925">,</span>&nbsp;<span class="ident" id="5426927">mechanism</span>&nbsp;<span class="op" id="5426937">:=</span>&nbsp;<span class="keyword" id="5426940">range</span>&nbsp;<span class="ident" id="5426946">server</span><span class="op" id="5426952">.</span><span class="ident" id="5426953">Auth</span>&nbsp;<span class="op" id="5426958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426963">if</span>&nbsp;<span class="ident" id="5426966">mechanism</span>&nbsp;<span class="op" id="5426976">==</span>&nbsp;<span class="string" id="5426979">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="5426987">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426993">advertised</span>&nbsp;<span class="op" id="5427004">=</span>&nbsp;<span class="builtintype" id="5427006">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427015">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5427024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5427028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427032">if</span>&nbsp;<span class="op" id="5427035">!</span><span class="ident" id="5427036">advertised</span>&nbsp;<span class="op" id="5427047">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427052">return</span>&nbsp;<span class="string" id="5427059">&#34;&#34;</span><span class="op" id="5427061">,</span>&nbsp;<span class="ident" id="5427063">nil</span><span class="op" id="5427066">,</span>&nbsp;<span class="ident" id="5427068">errors</span><span class="op" id="5427074">.</span><span class="ident" id="5427075">New</span><span class="op" id="5427078">(</span><span class="string" id="5427079">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="5427103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5427107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5427110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427113">if</span>&nbsp;<span class="ident" id="5427116">server</span><span class="op" id="5427122">.</span><span class="ident" id="5427123">Name</span>&nbsp;<span class="op" id="5427128">!=</span>&nbsp;<span class="ident" id="5427131">a</span><span class="op" id="5427132">.</span><span class="ident" id="5427133">host</span>&nbsp;<span class="op" id="5427138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427142">return</span>&nbsp;<span class="string" id="5427149">&#34;&#34;</span><span class="op" id="5427151">,</span>&nbsp;<span class="ident" id="5427153">nil</span><span class="op" id="5427156">,</span>&nbsp;<span class="ident" id="5427158">errors</span><span class="op" id="5427164">.</span><span class="ident" id="5427165">New</span><span class="op" id="5427168">(</span><span class="string" id="5427169">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="5427186">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5427189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427192">resp</span>&nbsp;<span class="op" id="5427197">:=</span>&nbsp;<span class="op" id="5427200">[</span><span class="op" id="5427201">]</span><span class="builtintype" id="5427202">byte</span><span class="op" id="5427206">(</span><span class="ident" id="5427207">a</span><span class="op" id="5427208">.</span><span class="ident" id="5427209">identity</span>&nbsp;<span class="op" id="5427218">+</span>&nbsp;<span class="string" id="5427220">&#34;\x00&#34;</span>&nbsp;<span class="op" id="5427227">+</span>&nbsp;<span class="ident" id="5427229">a</span><span class="op" id="5427230">.</span><span class="ident" id="5427231">username</span>&nbsp;<span class="op" id="5427240">+</span>&nbsp;<span class="string" id="5427242">&#34;\x00&#34;</span>&nbsp;<span class="op" id="5427249">+</span>&nbsp;<span class="ident" id="5427251">a</span><span class="op" id="5427252">.</span><span class="ident" id="5427253">password</span><span class="op" id="5427261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427264">return</span>&nbsp;<span class="string" id="5427271">&#34;PLAIN&#34;</span><span class="op" id="5427278">,</span>&nbsp;<span class="ident" id="5427280">resp</span><span class="op" id="5427284">,</span>&nbsp;<span class="ident" id="5427286">nil</span><br>
<span class="lineno"></span><span class="op" id="5427290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5427293">func</span>&nbsp;<span class="op" id="5427298">(</span><span class="ident" id="5427299">a</span>&nbsp;<span class="op" id="5427301">*</span><span class="ident" id="5427302">plainAuth</span><span class="op" id="5427311">)</span>&nbsp;<span class="ident" id="5427313">Next</span><span class="op" id="5427317">(</span><span class="ident" id="5427318">fromServer</span>&nbsp;<span class="op" id="5427329">[</span><span class="op" id="5427330">]</span><span class="builtintype" id="5427331">byte</span><span class="op" id="5427335">,</span>&nbsp;<span class="ident" id="5427337">more</span>&nbsp;<span class="builtintype" id="5427342">bool</span><span class="op" id="5427346">)</span>&nbsp;<span class="op" id="5427348">(</span><span class="op" id="5427349">[</span><span class="op" id="5427350">]</span><span class="builtintype" id="5427351">byte</span><span class="op" id="5427355">,</span>&nbsp;<span class="builtintype" id="5427357">error</span><span class="op" id="5427362">)</span>&nbsp;<span class="op" id="5427364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427367">if</span>&nbsp;<span class="ident" id="5427370">more</span>&nbsp;<span class="op" id="5427375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5427379">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427415">return</span>&nbsp;<span class="ident" id="5427422">nil</span><span class="op" id="5427425">,</span>&nbsp;<span class="ident" id="5427427">errors</span><span class="op" id="5427433">.</span><span class="ident" id="5427434">New</span><span class="op" id="5427437">(</span><span class="string" id="5427438">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="5427467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5427470">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427473">return</span>&nbsp;<span class="ident" id="5427480">nil</span><span class="op" id="5427483">,</span>&nbsp;<span class="ident" id="5427485">nil</span><br>
<span class="lineno"></span><span class="op" id="5427489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5427492">type</span>&nbsp;<span class="ident" id="5427497">cramMD5Auth</span>&nbsp;<span class="keyword" id="5427509">struct</span>&nbsp;<span class="op" id="5427516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427519">username</span><span class="op" id="5427527">,</span>&nbsp;<span class="ident" id="5427529">secret</span>&nbsp;<span class="builtintype" id="5427536">string</span><br>
<span class="lineno">85</span><span class="op" id="5427543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5427546">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="5427621">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="5427658">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="5427730">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="5427787">func</span>&nbsp;<span class="ident" id="5427792">CRAMMD5Auth</span><span class="op" id="5427803">(</span><span class="ident" id="5427804">username</span><span class="op" id="5427812">,</span>&nbsp;<span class="ident" id="5427814">secret</span>&nbsp;<span class="builtintype" id="5427821">string</span><span class="op" id="5427827">)</span>&nbsp;<span class="ident" id="5427829">Auth</span>&nbsp;<span class="op" id="5427834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427837">return</span>&nbsp;<span class="op" id="5427844">&amp;</span><span class="ident" id="5427845">cramMD5Auth</span><span class="op" id="5427856">{</span><span class="ident" id="5427857">username</span><span class="op" id="5427865">,</span>&nbsp;<span class="ident" id="5427867">secret</span><span class="op" id="5427873">}</span><br>
<span class="lineno"></span><span class="op" id="5427875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5427878">func</span>&nbsp;<span class="op" id="5427883">(</span><span class="ident" id="5427884">a</span>&nbsp;<span class="op" id="5427886">*</span><span class="ident" id="5427887">cramMD5Auth</span><span class="op" id="5427898">)</span>&nbsp;<span class="ident" id="5427900">Start</span><span class="op" id="5427905">(</span><span class="ident" id="5427906">server</span>&nbsp;<span class="op" id="5427913">*</span><span class="ident" id="5427914">ServerInfo</span><span class="op" id="5427924">)</span>&nbsp;<span class="op" id="5427926">(</span><span class="builtintype" id="5427927">string</span><span class="op" id="5427933">,</span>&nbsp;<span class="op" id="5427935">[</span><span class="op" id="5427936">]</span><span class="builtintype" id="5427937">byte</span><span class="op" id="5427941">,</span>&nbsp;<span class="builtintype" id="5427943">error</span><span class="op" id="5427948">)</span>&nbsp;<span class="op" id="5427950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427953">return</span>&nbsp;<span class="string" id="5427960">&#34;CRAM-MD5&#34;</span><span class="op" id="5427970">,</span>&nbsp;<span class="ident" id="5427972">nil</span><span class="op" id="5427975">,</span>&nbsp;<span class="ident" id="5427977">nil</span><br>
<span class="lineno"></span><span class="op" id="5427981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5427984">func</span>&nbsp;<span class="op" id="5427989">(</span><span class="ident" id="5427990">a</span>&nbsp;<span class="op" id="5427992">*</span><span class="ident" id="5427993">cramMD5Auth</span><span class="op" id="5428004">)</span>&nbsp;<span class="ident" id="5428006">Next</span><span class="op" id="5428010">(</span><span class="ident" id="5428011">fromServer</span>&nbsp;<span class="op" id="5428022">[</span><span class="op" id="5428023">]</span><span class="builtintype" id="5428024">byte</span><span class="op" id="5428028">,</span>&nbsp;<span class="ident" id="5428030">more</span>&nbsp;<span class="builtintype" id="5428035">bool</span><span class="op" id="5428039">)</span>&nbsp;<span class="op" id="5428041">(</span><span class="op" id="5428042">[</span><span class="op" id="5428043">]</span><span class="builtintype" id="5428044">byte</span><span class="op" id="5428048">,</span>&nbsp;<span class="builtintype" id="5428050">error</span><span class="op" id="5428055">)</span>&nbsp;<span class="op" id="5428057">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428060">if</span>&nbsp;<span class="ident" id="5428063">more</span>&nbsp;<span class="op" id="5428068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428072">d</span>&nbsp;<span class="op" id="5428074">:=</span>&nbsp;<span class="ident" id="5428077">hmac</span><span class="op" id="5428081">.</span><span class="ident" id="5428082">New</span><span class="op" id="5428085">(</span><span class="ident" id="5428086">md5</span><span class="op" id="5428089">.</span><span class="ident" id="5428090">New</span><span class="op" id="5428093">,</span>&nbsp;<span class="op" id="5428095">[</span><span class="op" id="5428096">]</span><span class="builtintype" id="5428097">byte</span><span class="op" id="5428101">(</span><span class="ident" id="5428102">a</span><span class="op" id="5428103">.</span><span class="ident" id="5428104">secret</span><span class="op" id="5428110">)</span><span class="op" id="5428111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428115">d</span><span class="op" id="5428116">.</span><span class="ident" id="5428117">Write</span><span class="op" id="5428122">(</span><span class="ident" id="5428123">fromServer</span><span class="op" id="5428133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428137">s</span>&nbsp;<span class="op" id="5428139">:=</span>&nbsp;<span class="builtinfunc" id="5428142">make</span><span class="op" id="5428146">(</span><span class="op" id="5428147">[</span><span class="op" id="5428148">]</span><span class="builtintype" id="5428149">byte</span><span class="op" id="5428153">,</span>&nbsp;<span class="num" id="5428155">0</span><span class="op" id="5428156">,</span>&nbsp;<span class="ident" id="5428158">d</span><span class="op" id="5428159">.</span><span class="ident" id="5428160">Size</span><span class="op" id="5428164">(</span><span class="op" id="5428165">)</span><span class="op" id="5428166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428170">return</span>&nbsp;<span class="op" id="5428177">[</span><span class="op" id="5428178">]</span><span class="builtintype" id="5428179">byte</span><span class="op" id="5428183">(</span><span class="ident" id="5428184">fmt</span><span class="op" id="5428187">.</span><span class="ident" id="5428188">Sprintf</span><span class="op" id="5428195">(</span><span class="string" id="5428196">&#34;%s&nbsp;%x&#34;</span><span class="op" id="5428203">,</span>&nbsp;<span class="ident" id="5428205">a</span><span class="op" id="5428206">.</span><span class="ident" id="5428207">username</span><span class="op" id="5428215">,</span>&nbsp;<span class="ident" id="5428217">d</span><span class="op" id="5428218">.</span><span class="ident" id="5428219">Sum</span><span class="op" id="5428222">(</span><span class="ident" id="5428223">s</span><span class="op" id="5428224">)</span><span class="op" id="5428225">)</span><span class="op" id="5428226">)</span><span class="op" id="5428227">,</span>&nbsp;<span class="ident" id="5428229">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428237">return</span>&nbsp;<span class="ident" id="5428244">nil</span><span class="op" id="5428247">,</span>&nbsp;<span class="ident" id="5428249">nil</span><br>
<span class="lineno"></span><span class="op" id="5428253">}</span>
</div>
</body>
</html>
