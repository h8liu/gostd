<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html" class="current">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4384046">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4384101">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4384155">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4384206">package</span>&nbsp;<span class="ident" id="4384214">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4384221">import</span>&nbsp;<span class="op" id="4384228">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4384231">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4384239">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4384246">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4384249">type</span>&nbsp;<span class="ident" id="4384254">huffmanEncoder</span>&nbsp;<span class="keyword" id="4384269">struct</span>&nbsp;<span class="op" id="4384276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384279">codeBits</span>&nbsp;<span class="op" id="4384288">[</span><span class="op" id="4384289">]</span><span class="builtintype" id="4384290">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384297">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4384306">[</span><span class="op" id="4384307">]</span><span class="builtintype" id="4384308">uint16</span><br>
<span class="lineno">15</span><span class="op" id="4384315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4384318">type</span>&nbsp;<span class="ident" id="4384323">literalNode</span>&nbsp;<span class="keyword" id="4384335">struct</span>&nbsp;<span class="op" id="4384342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384345">literal</span>&nbsp;<span class="builtintype" id="4384353">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384361">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4384369">int32</span><br>
<span class="lineno">20</span><span class="op" id="4384375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4384378">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4384456">type</span>&nbsp;<span class="ident" id="4384461">levelInfo</span>&nbsp;<span class="keyword" id="4384471">struct</span>&nbsp;<span class="op" id="4384478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4384481">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384517">level</span>&nbsp;<span class="builtintype" id="4384523">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4384531">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384580">lastFreq</span>&nbsp;<span class="builtintype" id="4384589">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4384597">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384658">nextCharFreq</span>&nbsp;<span class="builtintype" id="4384671">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4384679">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4384755">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384822">nextPairFreq</span>&nbsp;<span class="builtintype" id="4384835">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4384843">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4384919">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384944">needed</span>&nbsp;<span class="builtintype" id="4384951">int32</span><br>
<span class="lineno">40</span><span class="op" id="4384957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4384960">func</span>&nbsp;<span class="ident" id="4384965">maxNode</span><span class="op" id="4384972">(</span><span class="op" id="4384973">)</span>&nbsp;<span class="ident" id="4384975">literalNode</span>&nbsp;<span class="op" id="4384987">{</span>&nbsp;<span class="keyword" id="4384989">return</span>&nbsp;<span class="ident" id="4384996">literalNode</span><span class="op" id="4385007">{</span><span class="ident" id="4385008">math</span><span class="op" id="4385012">.</span><span class="ident" id="4385013">MaxUint16</span><span class="op" id="4385022">,</span>&nbsp;<span class="ident" id="4385024">math</span><span class="op" id="4385028">.</span><span class="ident" id="4385029">MaxInt32</span><span class="op" id="4385037">}</span>&nbsp;<span class="op" id="4385039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4385042">func</span>&nbsp;<span class="ident" id="4385047">newHuffmanEncoder</span><span class="op" id="4385064">(</span><span class="ident" id="4385065">size</span>&nbsp;<span class="builtintype" id="4385070">int</span><span class="op" id="4385073">)</span>&nbsp;<span class="op" id="4385075">*</span><span class="ident" id="4385076">huffmanEncoder</span>&nbsp;<span class="op" id="4385091">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385094">return</span>&nbsp;<span class="op" id="4385101">&amp;</span><span class="ident" id="4385102">huffmanEncoder</span><span class="op" id="4385116">{</span><span class="builtinfunc" id="4385117">make</span><span class="op" id="4385121">(</span><span class="op" id="4385122">[</span><span class="op" id="4385123">]</span><span class="builtintype" id="4385124">uint8</span><span class="op" id="4385129">,</span>&nbsp;<span class="ident" id="4385131">size</span><span class="op" id="4385135">)</span><span class="op" id="4385136">,</span>&nbsp;<span class="builtinfunc" id="4385138">make</span><span class="op" id="4385142">(</span><span class="op" id="4385143">[</span><span class="op" id="4385144">]</span><span class="builtintype" id="4385145">uint16</span><span class="op" id="4385151">,</span>&nbsp;<span class="ident" id="4385153">size</span><span class="op" id="4385157">)</span><span class="op" id="4385158">}</span><br>
<span class="lineno"></span><span class="op" id="4385160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4385163">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="4385231">func</span>&nbsp;<span class="ident" id="4385236">generateFixedLiteralEncoding</span><span class="op" id="4385264">(</span><span class="op" id="4385265">)</span>&nbsp;<span class="op" id="4385267">*</span><span class="ident" id="4385268">huffmanEncoder</span>&nbsp;<span class="op" id="4385283">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385286">h</span>&nbsp;<span class="op" id="4385288">:=</span>&nbsp;<span class="ident" id="4385291">newHuffmanEncoder</span><span class="op" id="4385308">(</span><span class="ident" id="4385309">maxLit</span><span class="op" id="4385315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385318">codeBits</span>&nbsp;<span class="op" id="4385327">:=</span>&nbsp;<span class="ident" id="4385330">h</span><span class="op" id="4385331">.</span><span class="ident" id="4385332">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385342">code</span>&nbsp;<span class="op" id="4385347">:=</span>&nbsp;<span class="ident" id="4385350">h</span><span class="op" id="4385351">.</span><span class="ident" id="4385352">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385358">var</span>&nbsp;<span class="ident" id="4385362">ch</span>&nbsp;<span class="builtintype" id="4385365">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385373">for</span>&nbsp;<span class="ident" id="4385377">ch</span>&nbsp;<span class="op" id="4385380">=</span>&nbsp;<span class="num" id="4385382">0</span><span class="op" id="4385383">;</span>&nbsp;<span class="ident" id="4385385">ch</span>&nbsp;<span class="op" id="4385388">&lt;</span>&nbsp;<span class="ident" id="4385390">maxLit</span><span class="op" id="4385396">;</span>&nbsp;<span class="ident" id="4385398">ch</span><span class="op" id="4385400">++</span>&nbsp;<span class="op" id="4385403">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385407">var</span>&nbsp;<span class="ident" id="4385411">bits</span>&nbsp;<span class="builtintype" id="4385416">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385425">var</span>&nbsp;<span class="ident" id="4385429">size</span>&nbsp;<span class="builtintype" id="4385434">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385442">switch</span>&nbsp;<span class="op" id="4385449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385453">case</span>&nbsp;<span class="ident" id="4385458">ch</span>&nbsp;<span class="op" id="4385461">&lt;</span>&nbsp;<span class="num" id="4385463">144</span><span class="op" id="4385466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4385471">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385508">bits</span>&nbsp;<span class="op" id="4385513">=</span>&nbsp;<span class="ident" id="4385515">ch</span>&nbsp;<span class="op" id="4385518">+</span>&nbsp;<span class="num" id="4385520">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385526">size</span>&nbsp;<span class="op" id="4385531">=</span>&nbsp;<span class="num" id="4385533">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385538">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385546">case</span>&nbsp;<span class="ident" id="4385551">ch</span>&nbsp;<span class="op" id="4385554">&lt;</span>&nbsp;<span class="num" id="4385556">256</span><span class="op" id="4385559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4385564">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385601">bits</span>&nbsp;<span class="op" id="4385606">=</span>&nbsp;<span class="ident" id="4385608">ch</span>&nbsp;<span class="op" id="4385611">+</span>&nbsp;<span class="num" id="4385613">400</span>&nbsp;<span class="op" id="4385617">-</span>&nbsp;<span class="num" id="4385619">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385626">size</span>&nbsp;<span class="op" id="4385631">=</span>&nbsp;<span class="num" id="4385633">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385638">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385646">case</span>&nbsp;<span class="ident" id="4385651">ch</span>&nbsp;<span class="op" id="4385654">&lt;</span>&nbsp;<span class="num" id="4385656">280</span><span class="op" id="4385659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4385664">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385697">bits</span>&nbsp;<span class="op" id="4385702">=</span>&nbsp;<span class="ident" id="4385704">ch</span>&nbsp;<span class="op" id="4385707">-</span>&nbsp;<span class="num" id="4385709">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385716">size</span>&nbsp;<span class="op" id="4385721">=</span>&nbsp;<span class="num" id="4385723">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385728">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385736">default</span><span class="op" id="4385743">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4385748">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385783">bits</span>&nbsp;<span class="op" id="4385788">=</span>&nbsp;<span class="ident" id="4385790">ch</span>&nbsp;<span class="op" id="4385793">+</span>&nbsp;<span class="num" id="4385795">192</span>&nbsp;<span class="op" id="4385799">-</span>&nbsp;<span class="num" id="4385801">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385808">size</span>&nbsp;<span class="op" id="4385813">=</span>&nbsp;<span class="num" id="4385815">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4385819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385823">codeBits</span><span class="op" id="4385831">[</span><span class="ident" id="4385832">ch</span><span class="op" id="4385834">]</span>&nbsp;<span class="op" id="4385836">=</span>&nbsp;<span class="ident" id="4385838">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385845">code</span><span class="op" id="4385849">[</span><span class="ident" id="4385850">ch</span><span class="op" id="4385852">]</span>&nbsp;<span class="op" id="4385854">=</span>&nbsp;<span class="ident" id="4385856">reverseBits</span><span class="op" id="4385867">(</span><span class="ident" id="4385868">bits</span><span class="op" id="4385872">,</span>&nbsp;<span class="ident" id="4385874">size</span><span class="op" id="4385878">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4385881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385884">return</span>&nbsp;<span class="ident" id="4385891">h</span><br>
<span class="lineno"></span><span class="op" id="4385893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4385896">func</span>&nbsp;<span class="ident" id="4385901">generateFixedOffsetEncoding</span><span class="op" id="4385928">(</span><span class="op" id="4385929">)</span>&nbsp;<span class="op" id="4385931">*</span><span class="ident" id="4385932">huffmanEncoder</span>&nbsp;<span class="op" id="4385947">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385950">h</span>&nbsp;<span class="op" id="4385952">:=</span>&nbsp;<span class="ident" id="4385955">newHuffmanEncoder</span><span class="op" id="4385972">(</span><span class="num" id="4385973">30</span><span class="op" id="4385975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385978">codeBits</span>&nbsp;<span class="op" id="4385987">:=</span>&nbsp;<span class="ident" id="4385990">h</span><span class="op" id="4385991">.</span><span class="ident" id="4385992">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4386002">code</span>&nbsp;<span class="op" id="4386007">:=</span>&nbsp;<span class="ident" id="4386010">h</span><span class="op" id="4386011">.</span><span class="ident" id="4386012">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386018">for</span>&nbsp;<span class="ident" id="4386022">ch</span>&nbsp;<span class="op" id="4386025">:=</span>&nbsp;<span class="builtintype" id="4386028">uint16</span><span class="op" id="4386034">(</span><span class="num" id="4386035">0</span><span class="op" id="4386036">)</span><span class="op" id="4386037">;</span>&nbsp;<span class="ident" id="4386039">ch</span>&nbsp;<span class="op" id="4386042">&lt;</span>&nbsp;<span class="num" id="4386044">30</span><span class="op" id="4386046">;</span>&nbsp;<span class="ident" id="4386048">ch</span><span class="op" id="4386050">++</span>&nbsp;<span class="op" id="4386053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4386057">codeBits</span><span class="op" id="4386065">[</span><span class="ident" id="4386066">ch</span><span class="op" id="4386068">]</span>&nbsp;<span class="op" id="4386070">=</span>&nbsp;<span class="num" id="4386072">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4386076">code</span><span class="op" id="4386080">[</span><span class="ident" id="4386081">ch</span><span class="op" id="4386083">]</span>&nbsp;<span class="op" id="4386085">=</span>&nbsp;<span class="ident" id="4386087">reverseBits</span><span class="op" id="4386098">(</span><span class="ident" id="4386099">ch</span><span class="op" id="4386101">,</span>&nbsp;<span class="num" id="4386103">5</span><span class="op" id="4386104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4386107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386110">return</span>&nbsp;<span class="ident" id="4386117">h</span><br>
<span class="lineno"></span><span class="op" id="4386119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4386122">var</span>&nbsp;<span class="ident" id="4386126">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4386147">*</span><span class="ident" id="4386148">huffmanEncoder</span>&nbsp;<span class="op" id="4386163">=</span>&nbsp;<span class="ident" id="4386165">generateFixedLiteralEncoding</span><span class="op" id="4386193">(</span><span class="op" id="4386194">)</span><br>
<span class="lineno"></span><span class="keyword" id="4386196">var</span>&nbsp;<span class="ident" id="4386200">fixedOffsetEncoding</span>&nbsp;<span class="op" id="4386220">*</span><span class="ident" id="4386221">huffmanEncoder</span>&nbsp;<span class="op" id="4386236">=</span>&nbsp;<span class="ident" id="4386238">generateFixedOffsetEncoding</span><span class="op" id="4386265">(</span><span class="op" id="4386266">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4386269">func</span>&nbsp;<span class="op" id="4386274">(</span><span class="ident" id="4386275">h</span>&nbsp;<span class="op" id="4386277">*</span><span class="ident" id="4386278">huffmanEncoder</span><span class="op" id="4386292">)</span>&nbsp;<span class="ident" id="4386294">bitLength</span><span class="op" id="4386303">(</span><span class="ident" id="4386304">freq</span>&nbsp;<span class="op" id="4386309">[</span><span class="op" id="4386310">]</span><span class="builtintype" id="4386311">int32</span><span class="op" id="4386316">)</span>&nbsp;<span class="ident" id="4386318">int64</span>&nbsp;<span class="op" id="4386324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386327">var</span>&nbsp;<span class="ident" id="4386331">total</span>&nbsp;<span class="ident" id="4386337">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386344">for</span>&nbsp;<span class="ident" id="4386348">i</span><span class="op" id="4386349">,</span>&nbsp;<span class="ident" id="4386351">f</span>&nbsp;<span class="op" id="4386353">:=</span>&nbsp;<span class="keyword" id="4386356">range</span>&nbsp;<span class="ident" id="4386362">freq</span>&nbsp;<span class="op" id="4386367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386371">if</span>&nbsp;<span class="ident" id="4386374">f</span>&nbsp;<span class="op" id="4386376">!=</span>&nbsp;<span class="num" id="4386379">0</span>&nbsp;<span class="op" id="4386381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4386386">total</span>&nbsp;<span class="op" id="4386392">+=</span>&nbsp;<span class="ident" id="4386395">int64</span><span class="op" id="4386400">(</span><span class="ident" id="4386401">f</span><span class="op" id="4386402">)</span>&nbsp;<span class="op" id="4386404">*</span>&nbsp;<span class="ident" id="4386406">int64</span><span class="op" id="4386411">(</span><span class="ident" id="4386412">h</span><span class="op" id="4386413">.</span><span class="ident" id="4386414">codeBits</span><span class="op" id="4386422">[</span><span class="ident" id="4386423">i</span><span class="op" id="4386424">]</span><span class="op" id="4386425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4386429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4386432">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386435">return</span>&nbsp;<span class="ident" id="4386442">total</span><br>
<span class="lineno"></span><span class="op" id="4386448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4386451">const</span>&nbsp;<span class="ident" id="4386457">maxBitsLimit</span>&nbsp;<span class="op" id="4386470">=</span>&nbsp;<span class="num" id="4386472">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4386476">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4386559">//</span><br>
<span class="lineno"></span><span class="comment" id="4386562">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="4386614">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4386685">//</span><br>
<span class="lineno">115</span><span class="comment" id="4386688">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4386748">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="4386834">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="4386921">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="4386945">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="4387030">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="4387067">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="4387150">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4387199">func</span>&nbsp;<span class="op" id="4387204">(</span><span class="ident" id="4387205">h</span>&nbsp;<span class="op" id="4387207">*</span><span class="ident" id="4387208">huffmanEncoder</span><span class="op" id="4387222">)</span>&nbsp;<span class="ident" id="4387224">bitCounts</span><span class="op" id="4387233">(</span><span class="ident" id="4387234">list</span>&nbsp;<span class="op" id="4387239">[</span><span class="op" id="4387240">]</span><span class="ident" id="4387241">literalNode</span><span class="op" id="4387252">,</span>&nbsp;<span class="ident" id="4387254">maxBits</span>&nbsp;<span class="builtintype" id="4387262">int32</span><span class="op" id="4387267">)</span>&nbsp;<span class="op" id="4387269">[</span><span class="op" id="4387270">]</span><span class="builtintype" id="4387271">int32</span>&nbsp;<span class="op" id="4387277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387280">if</span>&nbsp;<span class="ident" id="4387283">maxBits</span>&nbsp;<span class="op" id="4387291">&gt;=</span>&nbsp;<span class="ident" id="4387294">maxBitsLimit</span>&nbsp;<span class="op" id="4387307">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4387311">panic</span><span class="op" id="4387316">(</span><span class="string" id="4387317">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="4387343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4387346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387349">n</span>&nbsp;<span class="op" id="4387351">:=</span>&nbsp;<span class="builtintype" id="4387354">int32</span><span class="op" id="4387359">(</span><span class="builtinfunc" id="4387360">len</span><span class="op" id="4387363">(</span><span class="ident" id="4387364">list</span><span class="op" id="4387368">)</span><span class="op" id="4387369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387372">list</span>&nbsp;<span class="op" id="4387377">=</span>&nbsp;<span class="ident" id="4387379">list</span><span class="op" id="4387383">[</span><span class="num" id="4387384">0</span>&nbsp;<span class="op" id="4387386">:</span>&nbsp;<span class="ident" id="4387388">n</span><span class="op" id="4387389">+</span><span class="num" id="4387390">1</span><span class="op" id="4387391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387394">list</span><span class="op" id="4387398">[</span><span class="ident" id="4387399">n</span><span class="op" id="4387400">]</span>&nbsp;<span class="op" id="4387402">=</span>&nbsp;<span class="ident" id="4387404">maxNode</span><span class="op" id="4387411">(</span><span class="op" id="4387412">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4387416">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4387488">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387539">if</span>&nbsp;<span class="ident" id="4387542">maxBits</span>&nbsp;<span class="op" id="4387550">&gt;</span>&nbsp;<span class="ident" id="4387552">n</span><span class="op" id="4387553">-</span><span class="num" id="4387554">1</span>&nbsp;<span class="op" id="4387556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387560">maxBits</span>&nbsp;<span class="op" id="4387568">=</span>&nbsp;<span class="ident" id="4387570">n</span>&nbsp;<span class="op" id="4387572">-</span>&nbsp;<span class="num" id="4387574">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4387577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4387581">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4387630">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4387682">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4387741">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387791">var</span>&nbsp;<span class="ident" id="4387795">levels</span>&nbsp;<span class="op" id="4387802">[</span><span class="ident" id="4387803">maxBitsLimit</span><span class="op" id="4387815">]</span><span class="ident" id="4387816">levelInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4387827">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4387887">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4387938">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4387997">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388026">var</span>&nbsp;<span class="ident" id="4388030">leafCounts</span>&nbsp;<span class="op" id="4388041">[</span><span class="ident" id="4388042">maxBitsLimit</span><span class="op" id="4388054">]</span><span class="op" id="4388055">[</span><span class="ident" id="4388056">maxBitsLimit</span><span class="op" id="4388068">]</span><span class="builtintype" id="4388069">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388077">for</span>&nbsp;<span class="ident" id="4388081">level</span>&nbsp;<span class="op" id="4388087">:=</span>&nbsp;<span class="builtintype" id="4388090">int32</span><span class="op" id="4388095">(</span><span class="num" id="4388096">1</span><span class="op" id="4388097">)</span><span class="op" id="4388098">;</span>&nbsp;<span class="ident" id="4388100">level</span>&nbsp;<span class="op" id="4388106">&lt;=</span>&nbsp;<span class="ident" id="4388109">maxBits</span><span class="op" id="4388116">;</span>&nbsp;<span class="ident" id="4388118">level</span><span class="op" id="4388123">++</span>&nbsp;<span class="op" id="4388126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4388130">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4388202">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388271">levels</span><span class="op" id="4388277">[</span><span class="ident" id="4388278">level</span><span class="op" id="4388283">]</span>&nbsp;<span class="op" id="4388285">=</span>&nbsp;<span class="ident" id="4388287">levelInfo</span><span class="op" id="4388296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388301">level</span><span class="op" id="4388306">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388315">level</span><span class="op" id="4388320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388325">lastFreq</span><span class="op" id="4388333">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388339">list</span><span class="op" id="4388343">[</span><span class="num" id="4388344">1</span><span class="op" id="4388345">]</span><span class="op" id="4388346">.</span><span class="ident" id="4388347">freq</span><span class="op" id="4388351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388356">nextCharFreq</span><span class="op" id="4388368">:</span>&nbsp;<span class="ident" id="4388370">list</span><span class="op" id="4388374">[</span><span class="num" id="4388375">2</span><span class="op" id="4388376">]</span><span class="op" id="4388377">.</span><span class="ident" id="4388378">freq</span><span class="op" id="4388382">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388387">nextPairFreq</span><span class="op" id="4388399">:</span>&nbsp;<span class="ident" id="4388401">list</span><span class="op" id="4388405">[</span><span class="num" id="4388406">0</span><span class="op" id="4388407">]</span><span class="op" id="4388408">.</span><span class="ident" id="4388409">freq</span>&nbsp;<span class="op" id="4388414">+</span>&nbsp;<span class="ident" id="4388416">list</span><span class="op" id="4388420">[</span><span class="num" id="4388421">1</span><span class="op" id="4388422">]</span><span class="op" id="4388423">.</span><span class="ident" id="4388424">freq</span><span class="op" id="4388428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4388432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388436">leafCounts</span><span class="op" id="4388446">[</span><span class="ident" id="4388447">level</span><span class="op" id="4388452">]</span><span class="op" id="4388453">[</span><span class="ident" id="4388454">level</span><span class="op" id="4388459">]</span>&nbsp;<span class="op" id="4388461">=</span>&nbsp;<span class="num" id="4388463">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388467">if</span>&nbsp;<span class="ident" id="4388470">level</span>&nbsp;<span class="op" id="4388476">==</span>&nbsp;<span class="num" id="4388479">1</span>&nbsp;<span class="op" id="4388481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388486">levels</span><span class="op" id="4388492">[</span><span class="ident" id="4388493">level</span><span class="op" id="4388498">]</span><span class="op" id="4388499">.</span><span class="ident" id="4388500">nextPairFreq</span>&nbsp;<span class="op" id="4388513">=</span>&nbsp;<span class="ident" id="4388515">math</span><span class="op" id="4388519">.</span><span class="ident" id="4388520">MaxInt32</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4388531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4388534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4388538">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388618">levels</span><span class="op" id="4388624">[</span><span class="ident" id="4388625">maxBits</span><span class="op" id="4388632">]</span><span class="op" id="4388633">.</span><span class="ident" id="4388634">needed</span>&nbsp;<span class="op" id="4388641">=</span>&nbsp;<span class="num" id="4388643">2</span><span class="op" id="4388644">*</span><span class="ident" id="4388645">n</span>&nbsp;<span class="op" id="4388647">-</span>&nbsp;<span class="num" id="4388649">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388653">level</span>&nbsp;<span class="op" id="4388659">:=</span>&nbsp;<span class="ident" id="4388662">maxBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388671">for</span>&nbsp;<span class="op" id="4388675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388679">l</span>&nbsp;<span class="op" id="4388681">:=</span>&nbsp;<span class="op" id="4388684">&amp;</span><span class="ident" id="4388685">levels</span><span class="op" id="4388691">[</span><span class="ident" id="4388692">level</span><span class="op" id="4388697">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388701">if</span>&nbsp;<span class="ident" id="4388704">l</span><span class="op" id="4388705">.</span><span class="ident" id="4388706">nextPairFreq</span>&nbsp;<span class="op" id="4388719">==</span>&nbsp;<span class="ident" id="4388722">math</span><span class="op" id="4388726">.</span><span class="ident" id="4388727">MaxInt32</span>&nbsp;<span class="op" id="4388736">&amp;&amp;</span>&nbsp;<span class="ident" id="4388739">l</span><span class="op" id="4388740">.</span><span class="ident" id="4388741">nextCharFreq</span>&nbsp;<span class="op" id="4388754">==</span>&nbsp;<span class="ident" id="4388757">math</span><span class="op" id="4388761">.</span><span class="ident" id="4388762">MaxInt32</span>&nbsp;<span class="op" id="4388771">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4388776">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4388821">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4388864">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4388936">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388977">l</span><span class="op" id="4388978">.</span><span class="ident" id="4388979">needed</span>&nbsp;<span class="op" id="4388986">=</span>&nbsp;<span class="num" id="4388988">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388993">levels</span><span class="op" id="4388999">[</span><span class="ident" id="4389000">level</span><span class="op" id="4389005">+</span><span class="num" id="4389006">1</span><span class="op" id="4389007">]</span><span class="op" id="4389008">.</span><span class="ident" id="4389009">nextPairFreq</span>&nbsp;<span class="op" id="4389022">=</span>&nbsp;<span class="ident" id="4389024">math</span><span class="op" id="4389028">.</span><span class="ident" id="4389029">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4389041">level</span><span class="op" id="4389046">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4389052">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4389063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4389068">prevFreq</span>&nbsp;<span class="op" id="4389077">:=</span>&nbsp;<span class="ident" id="4389080">l</span><span class="op" id="4389081">.</span><span class="ident" id="4389082">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4389093">if</span>&nbsp;<span class="ident" id="4389096">l</span><span class="op" id="4389097">.</span><span class="ident" id="4389098">nextCharFreq</span>&nbsp;<span class="op" id="4389111">&lt;</span>&nbsp;<span class="ident" id="4389113">l</span><span class="op" id="4389114">.</span><span class="ident" id="4389115">nextPairFreq</span>&nbsp;<span class="op" id="4389128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389133">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4389181">n</span>&nbsp;<span class="op" id="4389183">:=</span>&nbsp;<span class="ident" id="4389186">leafCounts</span><span class="op" id="4389196">[</span><span class="ident" id="4389197">level</span><span class="op" id="4389202">]</span><span class="op" id="4389203">[</span><span class="ident" id="4389204">level</span><span class="op" id="4389209">]</span>&nbsp;<span class="op" id="4389211">+</span>&nbsp;<span class="num" id="4389213">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4389218">l</span><span class="op" id="4389219">.</span><span class="ident" id="4389220">lastFreq</span>&nbsp;<span class="op" id="4389229">=</span>&nbsp;<span class="ident" id="4389231">l</span><span class="op" id="4389232">.</span><span class="ident" id="4389233">nextCharFreq</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389249">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4389307">leafCounts</span><span class="op" id="4389317">[</span><span class="ident" id="4389318">level</span><span class="op" id="4389323">]</span><span class="op" id="4389324">[</span><span class="ident" id="4389325">level</span><span class="op" id="4389330">]</span>&nbsp;<span class="op" id="4389332">=</span>&nbsp;<span class="ident" id="4389334">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4389339">l</span><span class="op" id="4389340">.</span><span class="ident" id="4389341">nextCharFreq</span>&nbsp;<span class="op" id="4389354">=</span>&nbsp;<span class="ident" id="4389356">list</span><span class="op" id="4389360">[</span><span class="ident" id="4389361">n</span><span class="op" id="4389362">]</span><span class="op" id="4389363">.</span><span class="ident" id="4389364">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4389371">}</span>&nbsp;<span class="keyword" id="4389373">else</span>&nbsp;<span class="op" id="4389378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389383">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389448">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389501">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4389538">l</span><span class="op" id="4389539">.</span><span class="ident" id="4389540">lastFreq</span>&nbsp;<span class="op" id="4389549">=</span>&nbsp;<span class="ident" id="4389551">l</span><span class="op" id="4389552">.</span><span class="ident" id="4389553">nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389569">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4389653">copy</span><span class="op" id="4389657">(</span><span class="ident" id="4389658">leafCounts</span><span class="op" id="4389668">[</span><span class="ident" id="4389669">level</span><span class="op" id="4389674">]</span><span class="op" id="4389675">[</span><span class="op" id="4389676">:</span><span class="ident" id="4389677">level</span><span class="op" id="4389682">]</span><span class="op" id="4389683">,</span>&nbsp;<span class="ident" id="4389685">leafCounts</span><span class="op" id="4389695">[</span><span class="ident" id="4389696">level</span><span class="op" id="4389701">-</span><span class="num" id="4389702">1</span><span class="op" id="4389703">]</span><span class="op" id="4389704">[</span><span class="op" id="4389705">:</span><span class="ident" id="4389706">level</span><span class="op" id="4389711">]</span><span class="op" id="4389712">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4389717">levels</span><span class="op" id="4389723">[</span><span class="ident" id="4389724">l</span><span class="op" id="4389725">.</span><span class="ident" id="4389726">level</span><span class="op" id="4389731">-</span><span class="num" id="4389732">1</span><span class="op" id="4389733">]</span><span class="op" id="4389734">.</span><span class="ident" id="4389735">needed</span>&nbsp;<span class="op" id="4389742">=</span>&nbsp;<span class="num" id="4389744">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4389748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4389753">if</span>&nbsp;<span class="ident" id="4389756">l</span><span class="op" id="4389757">.</span><span class="ident" id="4389758">needed</span><span class="op" id="4389764">--</span><span class="op" id="4389766">;</span>&nbsp;<span class="ident" id="4389768">l</span><span class="op" id="4389769">.</span><span class="ident" id="4389770">needed</span>&nbsp;<span class="op" id="4389777">==</span>&nbsp;<span class="num" id="4389780">0</span>&nbsp;<span class="op" id="4389782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389787">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389845">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389908">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389983">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4390001">if</span>&nbsp;<span class="ident" id="4390004">l</span><span class="op" id="4390005">.</span><span class="ident" id="4390006">level</span>&nbsp;<span class="op" id="4390012">==</span>&nbsp;<span class="ident" id="4390015">maxBits</span>&nbsp;<span class="op" id="4390023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390029">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4390046">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4390055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4390060">levels</span><span class="op" id="4390066">[</span><span class="ident" id="4390067">l</span><span class="op" id="4390068">.</span><span class="ident" id="4390069">level</span><span class="op" id="4390074">+</span><span class="num" id="4390075">1</span><span class="op" id="4390076">]</span><span class="op" id="4390077">.</span><span class="ident" id="4390078">nextPairFreq</span>&nbsp;<span class="op" id="4390091">=</span>&nbsp;<span class="ident" id="4390093">prevFreq</span>&nbsp;<span class="op" id="4390102">+</span>&nbsp;<span class="ident" id="4390104">l</span><span class="op" id="4390105">.</span><span class="ident" id="4390106">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4390118">level</span><span class="op" id="4390123">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4390128">}</span>&nbsp;<span class="keyword" id="4390130">else</span>&nbsp;<span class="op" id="4390135">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390140">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4390209">for</span>&nbsp;<span class="ident" id="4390213">levels</span><span class="op" id="4390219">[</span><span class="ident" id="4390220">level</span><span class="op" id="4390225">-</span><span class="num" id="4390226">1</span><span class="op" id="4390227">]</span><span class="op" id="4390228">.</span><span class="ident" id="4390229">needed</span>&nbsp;<span class="op" id="4390236">&gt;</span>&nbsp;<span class="num" id="4390238">0</span>&nbsp;<span class="op" id="4390240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4390246">level</span><span class="op" id="4390251">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4390257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4390261">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4390264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390268">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390344">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4390367">if</span>&nbsp;<span class="ident" id="4390370">leafCounts</span><span class="op" id="4390380">[</span><span class="ident" id="4390381">maxBits</span><span class="op" id="4390388">]</span><span class="op" id="4390389">[</span><span class="ident" id="4390390">maxBits</span><span class="op" id="4390397">]</span>&nbsp;<span class="op" id="4390399">!=</span>&nbsp;<span class="ident" id="4390402">n</span>&nbsp;<span class="op" id="4390404">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4390408">panic</span><span class="op" id="4390413">(</span><span class="string" id="4390414">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="4390449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4390452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4390456">bitCount</span>&nbsp;<span class="op" id="4390465">:=</span>&nbsp;<span class="builtinfunc" id="4390468">make</span><span class="op" id="4390472">(</span><span class="op" id="4390473">[</span><span class="op" id="4390474">]</span><span class="builtintype" id="4390475">int32</span><span class="op" id="4390480">,</span>&nbsp;<span class="ident" id="4390482">maxBits</span><span class="op" id="4390489">+</span><span class="num" id="4390490">1</span><span class="op" id="4390491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4390494">bits</span>&nbsp;<span class="op" id="4390499">:=</span>&nbsp;<span class="num" id="4390502">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4390505">counts</span>&nbsp;<span class="op" id="4390512">:=</span>&nbsp;<span class="op" id="4390515">&amp;</span><span class="ident" id="4390516">leafCounts</span><span class="op" id="4390526">[</span><span class="ident" id="4390527">maxBits</span><span class="op" id="4390534">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4390537">for</span>&nbsp;<span class="ident" id="4390541">level</span>&nbsp;<span class="op" id="4390547">:=</span>&nbsp;<span class="ident" id="4390550">maxBits</span><span class="op" id="4390557">;</span>&nbsp;<span class="ident" id="4390559">level</span>&nbsp;<span class="op" id="4390565">&gt;</span>&nbsp;<span class="num" id="4390567">0</span><span class="op" id="4390568">;</span>&nbsp;<span class="ident" id="4390570">level</span><span class="op" id="4390575">--</span>&nbsp;<span class="op" id="4390578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390582">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390658">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4390679">bitCount</span><span class="op" id="4390687">[</span><span class="ident" id="4390688">bits</span><span class="op" id="4390692">]</span>&nbsp;<span class="op" id="4390694">=</span>&nbsp;<span class="ident" id="4390696">counts</span><span class="op" id="4390702">[</span><span class="ident" id="4390703">level</span><span class="op" id="4390708">]</span>&nbsp;<span class="op" id="4390710">-</span>&nbsp;<span class="ident" id="4390712">counts</span><span class="op" id="4390718">[</span><span class="ident" id="4390719">level</span><span class="op" id="4390724">-</span><span class="num" id="4390725">1</span><span class="op" id="4390726">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4390730">bits</span><span class="op" id="4390734">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4390738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4390741">return</span>&nbsp;<span class="ident" id="4390748">bitCount</span><br>
<span class="lineno"></span><span class="op" id="4390757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4390760">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4390839">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="4390860">func</span>&nbsp;<span class="op" id="4390865">(</span><span class="ident" id="4390866">h</span>&nbsp;<span class="op" id="4390868">*</span><span class="ident" id="4390869">huffmanEncoder</span><span class="op" id="4390883">)</span>&nbsp;<span class="ident" id="4390885">assignEncodingAndSize</span><span class="op" id="4390906">(</span><span class="ident" id="4390907">bitCount</span>&nbsp;<span class="op" id="4390916">[</span><span class="op" id="4390917">]</span><span class="builtintype" id="4390918">int32</span><span class="op" id="4390923">,</span>&nbsp;<span class="ident" id="4390925">list</span>&nbsp;<span class="op" id="4390930">[</span><span class="op" id="4390931">]</span><span class="ident" id="4390932">literalNode</span><span class="op" id="4390943">)</span>&nbsp;<span class="op" id="4390945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4390948">code</span>&nbsp;<span class="op" id="4390953">:=</span>&nbsp;<span class="builtintype" id="4390956">uint16</span><span class="op" id="4390962">(</span><span class="num" id="4390963">0</span><span class="op" id="4390964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4390967">for</span>&nbsp;<span class="ident" id="4390971">n</span><span class="op" id="4390972">,</span>&nbsp;<span class="ident" id="4390974">bits</span>&nbsp;<span class="op" id="4390979">:=</span>&nbsp;<span class="keyword" id="4390982">range</span>&nbsp;<span class="ident" id="4390988">bitCount</span>&nbsp;<span class="op" id="4390997">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391001">code</span>&nbsp;<span class="op" id="4391006">&lt;&lt;=</span>&nbsp;<span class="num" id="4391010">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391014">if</span>&nbsp;<span class="ident" id="4391017">n</span>&nbsp;<span class="op" id="4391019">==</span>&nbsp;<span class="num" id="4391022">0</span>&nbsp;<span class="op" id="4391024">||</span>&nbsp;<span class="ident" id="4391027">bits</span>&nbsp;<span class="op" id="4391032">==</span>&nbsp;<span class="num" id="4391035">0</span>&nbsp;<span class="op" id="4391037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391042">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4391053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391057">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391120">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391175">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391222">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391276">chunk</span>&nbsp;<span class="op" id="4391282">:=</span>&nbsp;<span class="ident" id="4391285">list</span><span class="op" id="4391289">[</span><span class="builtinfunc" id="4391290">len</span><span class="op" id="4391293">(</span><span class="ident" id="4391294">list</span><span class="op" id="4391298">)</span><span class="op" id="4391299">-</span><span class="builtintype" id="4391300">int</span><span class="op" id="4391303">(</span><span class="ident" id="4391304">bits</span><span class="op" id="4391308">)</span><span class="op" id="4391309">:</span><span class="op" id="4391310">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391314">sortByLiteral</span><span class="op" id="4391327">(</span><span class="ident" id="4391328">chunk</span><span class="op" id="4391333">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391337">for</span>&nbsp;<span class="ident" id="4391341">_</span><span class="op" id="4391342">,</span>&nbsp;<span class="ident" id="4391344">node</span>&nbsp;<span class="op" id="4391349">:=</span>&nbsp;<span class="keyword" id="4391352">range</span>&nbsp;<span class="ident" id="4391358">chunk</span>&nbsp;<span class="op" id="4391364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391369">h</span><span class="op" id="4391370">.</span><span class="ident" id="4391371">codeBits</span><span class="op" id="4391379">[</span><span class="ident" id="4391380">node</span><span class="op" id="4391384">.</span><span class="ident" id="4391385">literal</span><span class="op" id="4391392">]</span>&nbsp;<span class="op" id="4391394">=</span>&nbsp;<span class="builtintype" id="4391396">uint8</span><span class="op" id="4391401">(</span><span class="ident" id="4391402">n</span><span class="op" id="4391403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391408">h</span><span class="op" id="4391409">.</span><span class="ident" id="4391410">code</span><span class="op" id="4391414">[</span><span class="ident" id="4391415">node</span><span class="op" id="4391419">.</span><span class="ident" id="4391420">literal</span><span class="op" id="4391427">]</span>&nbsp;<span class="op" id="4391429">=</span>&nbsp;<span class="ident" id="4391431">reverseBits</span><span class="op" id="4391442">(</span><span class="ident" id="4391443">code</span><span class="op" id="4391447">,</span>&nbsp;<span class="builtintype" id="4391449">uint8</span><span class="op" id="4391454">(</span><span class="ident" id="4391455">n</span><span class="op" id="4391456">)</span><span class="op" id="4391457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391462">code</span><span class="op" id="4391466">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4391471">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391475">list</span>&nbsp;<span class="op" id="4391480">=</span>&nbsp;<span class="ident" id="4391482">list</span><span class="op" id="4391486">[</span><span class="num" id="4391487">0</span>&nbsp;<span class="op" id="4391489">:</span>&nbsp;<span class="builtinfunc" id="4391491">len</span><span class="op" id="4391494">(</span><span class="ident" id="4391495">list</span><span class="op" id="4391499">)</span><span class="op" id="4391500">-</span><span class="builtintype" id="4391501">int</span><span class="op" id="4391504">(</span><span class="ident" id="4391505">bits</span><span class="op" id="4391509">)</span><span class="op" id="4391510">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4391513">}</span><br>
<span class="lineno"></span><span class="op" id="4391515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4391518">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="4391611">//</span><br>
<span class="lineno"></span><span class="comment" id="4391614">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="4391704">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="4391767">func</span>&nbsp;<span class="op" id="4391772">(</span><span class="ident" id="4391773">h</span>&nbsp;<span class="op" id="4391775">*</span><span class="ident" id="4391776">huffmanEncoder</span><span class="op" id="4391790">)</span>&nbsp;<span class="ident" id="4391792">generate</span><span class="op" id="4391800">(</span><span class="ident" id="4391801">freq</span>&nbsp;<span class="op" id="4391806">[</span><span class="op" id="4391807">]</span><span class="builtintype" id="4391808">int32</span><span class="op" id="4391813">,</span>&nbsp;<span class="ident" id="4391815">maxBits</span>&nbsp;<span class="builtintype" id="4391823">int32</span><span class="op" id="4391828">)</span>&nbsp;<span class="op" id="4391830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391833">list</span>&nbsp;<span class="op" id="4391838">:=</span>&nbsp;<span class="builtinfunc" id="4391841">make</span><span class="op" id="4391845">(</span><span class="op" id="4391846">[</span><span class="op" id="4391847">]</span><span class="ident" id="4391848">literalNode</span><span class="op" id="4391859">,</span>&nbsp;<span class="builtinfunc" id="4391861">len</span><span class="op" id="4391864">(</span><span class="ident" id="4391865">freq</span><span class="op" id="4391869">)</span><span class="op" id="4391870">+</span><span class="num" id="4391871">1</span><span class="op" id="4391872">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391875">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391907">count</span>&nbsp;<span class="op" id="4391913">:=</span>&nbsp;<span class="num" id="4391916">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391919">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391993">for</span>&nbsp;<span class="ident" id="4391997">i</span><span class="op" id="4391998">,</span>&nbsp;<span class="ident" id="4392000">f</span>&nbsp;<span class="op" id="4392002">:=</span>&nbsp;<span class="keyword" id="4392005">range</span>&nbsp;<span class="ident" id="4392011">freq</span>&nbsp;<span class="op" id="4392016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392020">if</span>&nbsp;<span class="ident" id="4392023">f</span>&nbsp;<span class="op" id="4392025">!=</span>&nbsp;<span class="num" id="4392028">0</span>&nbsp;<span class="op" id="4392030">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392035">list</span><span class="op" id="4392039">[</span><span class="ident" id="4392040">count</span><span class="op" id="4392045">]</span>&nbsp;<span class="op" id="4392047">=</span>&nbsp;<span class="ident" id="4392049">literalNode</span><span class="op" id="4392060">{</span><span class="builtintype" id="4392061">uint16</span><span class="op" id="4392067">(</span><span class="ident" id="4392068">i</span><span class="op" id="4392069">)</span><span class="op" id="4392070">,</span>&nbsp;<span class="ident" id="4392072">f</span><span class="op" id="4392073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392078">count</span><span class="op" id="4392083">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4392088">}</span>&nbsp;<span class="keyword" id="4392090">else</span>&nbsp;<span class="op" id="4392095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392100">h</span><span class="op" id="4392101">.</span><span class="ident" id="4392102">codeBits</span><span class="op" id="4392110">[</span><span class="ident" id="4392111">i</span><span class="op" id="4392112">]</span>&nbsp;<span class="op" id="4392114">=</span>&nbsp;<span class="num" id="4392116">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4392120">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4392123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4392126">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392203">h</span><span class="op" id="4392204">.</span><span class="ident" id="4392205">codeBits</span>&nbsp;<span class="op" id="4392214">=</span>&nbsp;<span class="ident" id="4392216">h</span><span class="op" id="4392217">.</span><span class="ident" id="4392218">codeBits</span><span class="op" id="4392226">[</span><span class="num" id="4392227">0</span><span class="op" id="4392228">:</span><span class="builtinfunc" id="4392229">len</span><span class="op" id="4392232">(</span><span class="ident" id="4392233">freq</span><span class="op" id="4392237">)</span><span class="op" id="4392238">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392241">list</span>&nbsp;<span class="op" id="4392246">=</span>&nbsp;<span class="ident" id="4392248">list</span><span class="op" id="4392252">[</span><span class="num" id="4392253">0</span><span class="op" id="4392254">:</span><span class="ident" id="4392255">count</span><span class="op" id="4392260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392263">if</span>&nbsp;<span class="ident" id="4392266">count</span>&nbsp;<span class="op" id="4392272">&lt;=</span>&nbsp;<span class="num" id="4392275">2</span>&nbsp;<span class="op" id="4392277">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4392281">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4392373">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392430">for</span>&nbsp;<span class="ident" id="4392434">i</span><span class="op" id="4392435">,</span>&nbsp;<span class="ident" id="4392437">node</span>&nbsp;<span class="op" id="4392442">:=</span>&nbsp;<span class="keyword" id="4392445">range</span>&nbsp;<span class="ident" id="4392451">list</span>&nbsp;<span class="op" id="4392456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4392461">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392515">h</span><span class="op" id="4392516">.</span><span class="ident" id="4392517">codeBits</span><span class="op" id="4392525">[</span><span class="ident" id="4392526">node</span><span class="op" id="4392530">.</span><span class="ident" id="4392531">literal</span><span class="op" id="4392538">]</span>&nbsp;<span class="op" id="4392540">=</span>&nbsp;<span class="num" id="4392542">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392547">h</span><span class="op" id="4392548">.</span><span class="ident" id="4392549">code</span><span class="op" id="4392553">[</span><span class="ident" id="4392554">node</span><span class="op" id="4392558">.</span><span class="ident" id="4392559">literal</span><span class="op" id="4392566">]</span>&nbsp;<span class="op" id="4392568">=</span>&nbsp;<span class="builtintype" id="4392570">uint16</span><span class="op" id="4392576">(</span><span class="ident" id="4392577">i</span><span class="op" id="4392578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4392582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392586">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4392594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392597">sortByFreq</span><span class="op" id="4392607">(</span><span class="ident" id="4392608">list</span><span class="op" id="4392612">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4392616">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392666">bitCount</span>&nbsp;<span class="op" id="4392675">:=</span>&nbsp;<span class="ident" id="4392678">h</span><span class="op" id="4392679">.</span><span class="ident" id="4392680">bitCounts</span><span class="op" id="4392689">(</span><span class="ident" id="4392690">list</span><span class="op" id="4392694">,</span>&nbsp;<span class="ident" id="4392696">maxBits</span><span class="op" id="4392703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4392706">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392732">h</span><span class="op" id="4392733">.</span><span class="ident" id="4392734">assignEncodingAndSize</span><span class="op" id="4392755">(</span><span class="ident" id="4392756">bitCount</span><span class="op" id="4392764">,</span>&nbsp;<span class="ident" id="4392766">list</span><span class="op" id="4392770">)</span><br>
<span class="lineno">295</span><span class="op" id="4392772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4392775">type</span>&nbsp;<span class="ident" id="4392780">literalNodeSorter</span>&nbsp;<span class="keyword" id="4392798">struct</span>&nbsp;<span class="op" id="4392805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392808">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4392813">[</span><span class="op" id="4392814">]</span><span class="ident" id="4392815">literalNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392828">less</span>&nbsp;<span class="keyword" id="4392833">func</span><span class="op" id="4392837">(</span><span class="ident" id="4392838">i</span><span class="op" id="4392839">,</span>&nbsp;<span class="ident" id="4392841">j</span>&nbsp;<span class="builtintype" id="4392843">int</span><span class="op" id="4392846">)</span>&nbsp;<span class="builtintype" id="4392848">bool</span><br>
<span class="lineno">300</span><span class="op" id="4392853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4392856">func</span>&nbsp;<span class="op" id="4392861">(</span><span class="ident" id="4392862">s</span>&nbsp;<span class="ident" id="4392864">literalNodeSorter</span><span class="op" id="4392881">)</span>&nbsp;<span class="ident" id="4392883">Len</span><span class="op" id="4392886">(</span><span class="op" id="4392887">)</span>&nbsp;<span class="builtintype" id="4392889">int</span>&nbsp;<span class="op" id="4392893">{</span>&nbsp;<span class="keyword" id="4392895">return</span>&nbsp;<span class="builtinfunc" id="4392902">len</span><span class="op" id="4392905">(</span><span class="ident" id="4392906">s</span><span class="op" id="4392907">.</span><span class="ident" id="4392908">a</span><span class="op" id="4392909">)</span>&nbsp;<span class="op" id="4392911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4392914">func</span>&nbsp;<span class="op" id="4392919">(</span><span class="ident" id="4392920">s</span>&nbsp;<span class="ident" id="4392922">literalNodeSorter</span><span class="op" id="4392939">)</span>&nbsp;<span class="ident" id="4392941">Less</span><span class="op" id="4392945">(</span><span class="ident" id="4392946">i</span><span class="op" id="4392947">,</span>&nbsp;<span class="ident" id="4392949">j</span>&nbsp;<span class="builtintype" id="4392951">int</span><span class="op" id="4392954">)</span>&nbsp;<span class="builtintype" id="4392956">bool</span>&nbsp;<span class="op" id="4392961">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392964">return</span>&nbsp;<span class="ident" id="4392971">s</span><span class="op" id="4392972">.</span><span class="ident" id="4392973">less</span><span class="op" id="4392977">(</span><span class="ident" id="4392978">i</span><span class="op" id="4392979">,</span>&nbsp;<span class="ident" id="4392981">j</span><span class="op" id="4392982">)</span><br>
<span class="lineno"></span><span class="op" id="4392984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4392987">func</span>&nbsp;<span class="op" id="4392992">(</span><span class="ident" id="4392993">s</span>&nbsp;<span class="ident" id="4392995">literalNodeSorter</span><span class="op" id="4393012">)</span>&nbsp;<span class="ident" id="4393014">Swap</span><span class="op" id="4393018">(</span><span class="ident" id="4393019">i</span><span class="op" id="4393020">,</span>&nbsp;<span class="ident" id="4393022">j</span>&nbsp;<span class="builtintype" id="4393024">int</span><span class="op" id="4393027">)</span>&nbsp;<span class="op" id="4393029">{</span>&nbsp;<span class="ident" id="4393031">s</span><span class="op" id="4393032">.</span><span class="ident" id="4393033">a</span><span class="op" id="4393034">[</span><span class="ident" id="4393035">i</span><span class="op" id="4393036">]</span><span class="op" id="4393037">,</span>&nbsp;<span class="ident" id="4393039">s</span><span class="op" id="4393040">.</span><span class="ident" id="4393041">a</span><span class="op" id="4393042">[</span><span class="ident" id="4393043">j</span><span class="op" id="4393044">]</span>&nbsp;<span class="op" id="4393046">=</span>&nbsp;<span class="ident" id="4393048">s</span><span class="op" id="4393049">.</span><span class="ident" id="4393050">a</span><span class="op" id="4393051">[</span><span class="ident" id="4393052">j</span><span class="op" id="4393053">]</span><span class="op" id="4393054">,</span>&nbsp;<span class="ident" id="4393056">s</span><span class="op" id="4393057">.</span><span class="ident" id="4393058">a</span><span class="op" id="4393059">[</span><span class="ident" id="4393060">i</span><span class="op" id="4393061">]</span>&nbsp;<span class="op" id="4393063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="4393066">func</span>&nbsp;<span class="ident" id="4393071">sortByFreq</span><span class="op" id="4393081">(</span><span class="ident" id="4393082">a</span>&nbsp;<span class="op" id="4393084">[</span><span class="op" id="4393085">]</span><span class="ident" id="4393086">literalNode</span><span class="op" id="4393097">)</span>&nbsp;<span class="op" id="4393099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4393102">s</span>&nbsp;<span class="op" id="4393104">:=</span>&nbsp;<span class="op" id="4393107">&amp;</span><span class="ident" id="4393108">literalNodeSorter</span><span class="op" id="4393125">{</span><span class="ident" id="4393126">a</span><span class="op" id="4393127">,</span>&nbsp;<span class="keyword" id="4393129">func</span><span class="op" id="4393133">(</span><span class="ident" id="4393134">i</span><span class="op" id="4393135">,</span>&nbsp;<span class="ident" id="4393137">j</span>&nbsp;<span class="builtintype" id="4393139">int</span><span class="op" id="4393142">)</span>&nbsp;<span class="builtintype" id="4393144">bool</span>&nbsp;<span class="op" id="4393149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4393153">if</span>&nbsp;<span class="ident" id="4393156">a</span><span class="op" id="4393157">[</span><span class="ident" id="4393158">i</span><span class="op" id="4393159">]</span><span class="op" id="4393160">.</span><span class="ident" id="4393161">freq</span>&nbsp;<span class="op" id="4393166">==</span>&nbsp;<span class="ident" id="4393169">a</span><span class="op" id="4393170">[</span><span class="ident" id="4393171">j</span><span class="op" id="4393172">]</span><span class="op" id="4393173">.</span><span class="ident" id="4393174">freq</span>&nbsp;<span class="op" id="4393179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4393184">return</span>&nbsp;<span class="ident" id="4393191">a</span><span class="op" id="4393192">[</span><span class="ident" id="4393193">i</span><span class="op" id="4393194">]</span><span class="op" id="4393195">.</span><span class="ident" id="4393196">literal</span>&nbsp;<span class="op" id="4393204">&lt;</span>&nbsp;<span class="ident" id="4393206">a</span><span class="op" id="4393207">[</span><span class="ident" id="4393208">j</span><span class="op" id="4393209">]</span><span class="op" id="4393210">.</span><span class="ident" id="4393211">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4393221">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4393225">return</span>&nbsp;<span class="ident" id="4393232">a</span><span class="op" id="4393233">[</span><span class="ident" id="4393234">i</span><span class="op" id="4393235">]</span><span class="op" id="4393236">.</span><span class="ident" id="4393237">freq</span>&nbsp;<span class="op" id="4393242">&lt;</span>&nbsp;<span class="ident" id="4393244">a</span><span class="op" id="4393245">[</span><span class="ident" id="4393246">j</span><span class="op" id="4393247">]</span><span class="op" id="4393248">.</span><span class="ident" id="4393249">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4393255">}</span><span class="op" id="4393256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4393259">sort</span><span class="op" id="4393263">.</span><span class="ident" id="4393264">Sort</span><span class="op" id="4393268">(</span><span class="ident" id="4393269">s</span><span class="op" id="4393270">)</span><br>
<span class="lineno"></span><span class="op" id="4393272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="4393275">func</span>&nbsp;<span class="ident" id="4393280">sortByLiteral</span><span class="op" id="4393293">(</span><span class="ident" id="4393294">a</span>&nbsp;<span class="op" id="4393296">[</span><span class="op" id="4393297">]</span><span class="ident" id="4393298">literalNode</span><span class="op" id="4393309">)</span>&nbsp;<span class="op" id="4393311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4393314">s</span>&nbsp;<span class="op" id="4393316">:=</span>&nbsp;<span class="op" id="4393319">&amp;</span><span class="ident" id="4393320">literalNodeSorter</span><span class="op" id="4393337">{</span><span class="ident" id="4393338">a</span><span class="op" id="4393339">,</span>&nbsp;<span class="keyword" id="4393341">func</span><span class="op" id="4393345">(</span><span class="ident" id="4393346">i</span><span class="op" id="4393347">,</span>&nbsp;<span class="ident" id="4393349">j</span>&nbsp;<span class="builtintype" id="4393351">int</span><span class="op" id="4393354">)</span>&nbsp;<span class="builtintype" id="4393356">bool</span>&nbsp;<span class="op" id="4393361">{</span>&nbsp;<span class="keyword" id="4393363">return</span>&nbsp;<span class="ident" id="4393370">a</span><span class="op" id="4393371">[</span><span class="ident" id="4393372">i</span><span class="op" id="4393373">]</span><span class="op" id="4393374">.</span><span class="ident" id="4393375">literal</span>&nbsp;<span class="op" id="4393383">&lt;</span>&nbsp;<span class="ident" id="4393385">a</span><span class="op" id="4393386">[</span><span class="ident" id="4393387">j</span><span class="op" id="4393388">]</span><span class="op" id="4393389">.</span><span class="ident" id="4393390">literal</span>&nbsp;<span class="op" id="4393398">}</span><span class="op" id="4393399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4393402">sort</span><span class="op" id="4393406">.</span><span class="ident" id="4393407">Sort</span><span class="op" id="4393411">(</span><span class="ident" id="4393412">s</span><span class="op" id="4393413">)</span><br>
<span class="lineno"></span><span class="op" id="4393415">}</span>
</div>
</body>
</html>
