<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4798428">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4798483">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4798537">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4798588">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="4798668">package</span>&nbsp;<span class="ident" id="4798676">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4798687">import</span>&nbsp;<span class="op" id="4798694">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4798697">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4798707">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4798714">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4798721">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4798733">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4798744">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4798752">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4798763">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4798771">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4798778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4798781">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="4798854">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4798909">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4798979">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4799050">//</span><br>
<span class="lineno">25</span><span class="comment" id="4799053">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4799127">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="4799151">//</span><br>
<span class="lineno"></span><span class="comment" id="4799154">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4799229">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="4799308">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="4799337">//</span><br>
<span class="lineno"></span><span class="comment" id="4799340">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4799397">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="4799431">type</span>&nbsp;<span class="ident" id="4799436">PublicSuffixList</span>&nbsp;<span class="keyword" id="4799453">interface</span>&nbsp;<span class="op" id="4799463">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799466">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799520">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799524">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799595">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799667">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799689">PublicSuffix</span><span class="op" id="4799701">(</span><span class="ident" id="4799702">domain</span>&nbsp;<span class="builtintype" id="4799709">string</span><span class="op" id="4799715">)</span>&nbsp;<span class="builtintype" id="4799717">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799726">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799795">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799866">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799895">String</span><span class="op" id="4799901">(</span><span class="op" id="4799902">)</span>&nbsp;<span class="builtintype" id="4799904">string</span><br>
<span class="lineno"></span><span class="op" id="4799911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4799914">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="4799965">type</span>&nbsp;<span class="ident" id="4799970">Options</span>&nbsp;<span class="keyword" id="4799978">struct</span>&nbsp;<span class="op" id="4799985">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799988">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800059">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800109">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800113">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800182">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800255">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800274">PublicSuffixList</span>&nbsp;<span class="ident" id="4800291">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="4800308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4800311">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="4800385">type</span>&nbsp;<span class="ident" id="4800390">Jar</span>&nbsp;<span class="keyword" id="4800394">struct</span>&nbsp;<span class="op" id="4800401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800404">psList</span>&nbsp;<span class="ident" id="4800411">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800430">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800465">mu</span>&nbsp;<span class="ident" id="4800468">sync</span><span class="op" id="4800472">.</span><span class="ident" id="4800473">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800481">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800552">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800580">entries</span>&nbsp;<span class="keyword" id="4800588">map</span><span class="op" id="4800591">[</span><span class="builtintype" id="4800592">string</span><span class="op" id="4800598">]</span><span class="keyword" id="4800599">map</span><span class="op" id="4800602">[</span><span class="builtintype" id="4800603">string</span><span class="op" id="4800609">]</span><span class="ident" id="4800610">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800618">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800686">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800710">nextSeqNum</span>&nbsp;<span class="ident" id="4800721">uint64</span><br>
<span class="lineno"></span><span class="op" id="4800728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="4800731">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="4800803">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="4800815">func</span>&nbsp;<span class="ident" id="4800820">New</span><span class="op" id="4800823">(</span><span class="ident" id="4800824">o</span>&nbsp;<span class="op" id="4800826">*</span><span class="ident" id="4800827">Options</span><span class="op" id="4800834">)</span>&nbsp;<span class="op" id="4800836">(</span><span class="op" id="4800837">*</span><span class="ident" id="4800838">Jar</span><span class="op" id="4800841">,</span>&nbsp;<span class="builtintype" id="4800843">error</span><span class="op" id="4800848">)</span>&nbsp;<span class="op" id="4800850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800853">jar</span>&nbsp;<span class="op" id="4800857">:=</span>&nbsp;<span class="op" id="4800860">&amp;</span><span class="ident" id="4800861">Jar</span><span class="op" id="4800864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800868">entries</span><span class="op" id="4800875">:</span>&nbsp;<span class="builtinfunc" id="4800877">make</span><span class="op" id="4800881">(</span><span class="keyword" id="4800882">map</span><span class="op" id="4800885">[</span><span class="builtintype" id="4800886">string</span><span class="op" id="4800892">]</span><span class="keyword" id="4800893">map</span><span class="op" id="4800896">[</span><span class="builtintype" id="4800897">string</span><span class="op" id="4800903">]</span><span class="ident" id="4800904">entry</span><span class="op" id="4800909">)</span><span class="op" id="4800910">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800916">if</span>&nbsp;<span class="ident" id="4800919">o</span>&nbsp;<span class="op" id="4800921">!=</span>&nbsp;<span class="ident" id="4800924">nil</span>&nbsp;<span class="op" id="4800928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800932">jar</span><span class="op" id="4800935">.</span><span class="ident" id="4800936">psList</span>&nbsp;<span class="op" id="4800943">=</span>&nbsp;<span class="ident" id="4800945">o</span><span class="op" id="4800946">.</span><span class="ident" id="4800947">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800968">return</span>&nbsp;<span class="ident" id="4800975">jar</span><span class="op" id="4800978">,</span>&nbsp;<span class="ident" id="4800980">nil</span><br>
<span class="lineno">85</span><span class="op" id="4800984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4800987">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="4801040">//</span><br>
<span class="lineno"></span><span class="comment" id="4801043">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="4801124">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="4801157">type</span>&nbsp;<span class="ident" id="4801162">entry</span>&nbsp;<span class="keyword" id="4801168">struct</span>&nbsp;<span class="op" id="4801175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801178">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4801189">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801197">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4801208">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801216">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4801227">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801235">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4801246">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801254">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4801265">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801271">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4801282">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801288">Persistent</span>&nbsp;<span class="builtintype" id="4801299">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801305">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4801316">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801322">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801333">time</span><span class="op" id="4801337">.</span><span class="ident" id="4801338">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801344">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4801355">time</span><span class="op" id="4801359">.</span><span class="ident" id="4801360">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801366">LastAccess</span>&nbsp;<span class="ident" id="4801377">time</span><span class="op" id="4801381">.</span><span class="ident" id="4801382">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4801389">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4801458">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4801532">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801582">seqNum</span>&nbsp;<span class="ident" id="4801589">uint64</span><br>
<span class="lineno"></span><span class="op" id="4801596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4801599">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="4801656">func</span>&nbsp;<span class="op" id="4801661">(</span><span class="ident" id="4801662">e</span>&nbsp;<span class="op" id="4801664">*</span><span class="ident" id="4801665">entry</span><span class="op" id="4801670">)</span>&nbsp;<span class="ident" id="4801672">id</span><span class="op" id="4801674">(</span><span class="op" id="4801675">)</span>&nbsp;<span class="builtintype" id="4801677">string</span>&nbsp;<span class="op" id="4801684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801687">return</span>&nbsp;<span class="ident" id="4801694">fmt</span><span class="op" id="4801697">.</span><span class="ident" id="4801698">Sprintf</span><span class="op" id="4801705">(</span><span class="string" id="4801706">&#34;%s;%s;%s&#34;</span><span class="op" id="4801716">,</span>&nbsp;<span class="ident" id="4801718">e</span><span class="op" id="4801719">.</span><span class="ident" id="4801720">Domain</span><span class="op" id="4801726">,</span>&nbsp;<span class="ident" id="4801728">e</span><span class="op" id="4801729">.</span><span class="ident" id="4801730">Path</span><span class="op" id="4801734">,</span>&nbsp;<span class="ident" id="4801736">e</span><span class="op" id="4801737">.</span><span class="ident" id="4801738">Name</span><span class="op" id="4801742">)</span><br>
<span class="lineno"></span><span class="op" id="4801744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4801747">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4801821">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4801896">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="4801918">func</span>&nbsp;<span class="op" id="4801923">(</span><span class="ident" id="4801924">e</span>&nbsp;<span class="op" id="4801926">*</span><span class="ident" id="4801927">entry</span><span class="op" id="4801932">)</span>&nbsp;<span class="ident" id="4801934">shouldSend</span><span class="op" id="4801944">(</span><span class="ident" id="4801945">https</span>&nbsp;<span class="builtintype" id="4801951">bool</span><span class="op" id="4801955">,</span>&nbsp;<span class="ident" id="4801957">host</span><span class="op" id="4801961">,</span>&nbsp;<span class="ident" id="4801963">path</span>&nbsp;<span class="builtintype" id="4801968">string</span><span class="op" id="4801974">)</span>&nbsp;<span class="builtintype" id="4801976">bool</span>&nbsp;<span class="op" id="4801981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801984">return</span>&nbsp;<span class="ident" id="4801991">e</span><span class="op" id="4801992">.</span><span class="ident" id="4801993">domainMatch</span><span class="op" id="4802004">(</span><span class="ident" id="4802005">host</span><span class="op" id="4802009">)</span>&nbsp;<span class="op" id="4802011">&amp;&amp;</span>&nbsp;<span class="ident" id="4802014">e</span><span class="op" id="4802015">.</span><span class="ident" id="4802016">pathMatch</span><span class="op" id="4802025">(</span><span class="ident" id="4802026">path</span><span class="op" id="4802030">)</span>&nbsp;<span class="op" id="4802032">&amp;&amp;</span>&nbsp;<span class="op" id="4802035">(</span><span class="ident" id="4802036">https</span>&nbsp;<span class="op" id="4802042">||</span>&nbsp;<span class="op" id="4802045">!</span><span class="ident" id="4802046">e</span><span class="op" id="4802047">.</span><span class="ident" id="4802048">Secure</span><span class="op" id="4802054">)</span><br>
<span class="lineno">120</span><span class="op" id="4802056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4802059">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="4802127">func</span>&nbsp;<span class="op" id="4802132">(</span><span class="ident" id="4802133">e</span>&nbsp;<span class="op" id="4802135">*</span><span class="ident" id="4802136">entry</span><span class="op" id="4802141">)</span>&nbsp;<span class="ident" id="4802143">domainMatch</span><span class="op" id="4802154">(</span><span class="ident" id="4802155">host</span>&nbsp;<span class="builtintype" id="4802160">string</span><span class="op" id="4802166">)</span>&nbsp;<span class="builtintype" id="4802168">bool</span>&nbsp;<span class="op" id="4802173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802176">if</span>&nbsp;<span class="ident" id="4802179">e</span><span class="op" id="4802180">.</span><span class="ident" id="4802181">Domain</span>&nbsp;<span class="op" id="4802188">==</span>&nbsp;<span class="ident" id="4802191">host</span>&nbsp;<span class="op" id="4802196">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802200">return</span>&nbsp;<span class="ident" id="4802207">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802216">return</span>&nbsp;<span class="op" id="4802223">!</span><span class="ident" id="4802224">e</span><span class="op" id="4802225">.</span><span class="ident" id="4802226">HostOnly</span>&nbsp;<span class="op" id="4802235">&amp;&amp;</span>&nbsp;<span class="ident" id="4802238">hasDotSuffix</span><span class="op" id="4802250">(</span><span class="ident" id="4802251">host</span><span class="op" id="4802255">,</span>&nbsp;<span class="ident" id="4802257">e</span><span class="op" id="4802258">.</span><span class="ident" id="4802259">Domain</span><span class="op" id="4802265">)</span><br>
<span class="lineno"></span><span class="op" id="4802267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4802270">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="4802344">func</span>&nbsp;<span class="op" id="4802349">(</span><span class="ident" id="4802350">e</span>&nbsp;<span class="op" id="4802352">*</span><span class="ident" id="4802353">entry</span><span class="op" id="4802358">)</span>&nbsp;<span class="ident" id="4802360">pathMatch</span><span class="op" id="4802369">(</span><span class="ident" id="4802370">requestPath</span>&nbsp;<span class="builtintype" id="4802382">string</span><span class="op" id="4802388">)</span>&nbsp;<span class="builtintype" id="4802390">bool</span>&nbsp;<span class="op" id="4802395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802398">if</span>&nbsp;<span class="ident" id="4802401">requestPath</span>&nbsp;<span class="op" id="4802413">==</span>&nbsp;<span class="ident" id="4802416">e</span><span class="op" id="4802417">.</span><span class="ident" id="4802418">Path</span>&nbsp;<span class="op" id="4802423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802427">return</span>&nbsp;<span class="ident" id="4802434">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802440">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802443">if</span>&nbsp;<span class="ident" id="4802446">strings</span><span class="op" id="4802453">.</span><span class="ident" id="4802454">HasPrefix</span><span class="op" id="4802463">(</span><span class="ident" id="4802464">requestPath</span><span class="op" id="4802475">,</span>&nbsp;<span class="ident" id="4802477">e</span><span class="op" id="4802478">.</span><span class="ident" id="4802479">Path</span><span class="op" id="4802483">)</span>&nbsp;<span class="op" id="4802485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802489">if</span>&nbsp;<span class="ident" id="4802492">e</span><span class="op" id="4802493">.</span><span class="ident" id="4802494">Path</span><span class="op" id="4802498">[</span><span class="builtinfunc" id="4802499">len</span><span class="op" id="4802502">(</span><span class="ident" id="4802503">e</span><span class="op" id="4802504">.</span><span class="ident" id="4802505">Path</span><span class="op" id="4802509">)</span><span class="op" id="4802510">-</span><span class="num" id="4802511">1</span><span class="op" id="4802512">]</span>&nbsp;<span class="op" id="4802514">==</span>&nbsp;<span class="string" id="4802517">&#39;/&#39;</span>&nbsp;<span class="op" id="4802521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802526">return</span>&nbsp;<span class="ident" id="4802533">true</span>&nbsp;<span class="comment" id="4802538">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802581">}</span>&nbsp;<span class="keyword" id="4802583">else</span>&nbsp;<span class="keyword" id="4802588">if</span>&nbsp;<span class="ident" id="4802591">requestPath</span><span class="op" id="4802602">[</span><span class="builtinfunc" id="4802603">len</span><span class="op" id="4802606">(</span><span class="ident" id="4802607">e</span><span class="op" id="4802608">.</span><span class="ident" id="4802609">Path</span><span class="op" id="4802613">)</span><span class="op" id="4802614">]</span>&nbsp;<span class="op" id="4802616">==</span>&nbsp;<span class="string" id="4802619">&#39;/&#39;</span>&nbsp;<span class="op" id="4802623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802628">return</span>&nbsp;<span class="ident" id="4802635">true</span>&nbsp;<span class="comment" id="4802640">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802688">return</span>&nbsp;<span class="ident" id="4802695">false</span><br>
<span class="lineno"></span><span class="op" id="4802701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="4802704">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="4802758">func</span>&nbsp;<span class="ident" id="4802763">hasDotSuffix</span><span class="op" id="4802775">(</span><span class="ident" id="4802776">s</span><span class="op" id="4802777">,</span>&nbsp;<span class="ident" id="4802779">suffix</span>&nbsp;<span class="builtintype" id="4802786">string</span><span class="op" id="4802792">)</span>&nbsp;<span class="builtintype" id="4802794">bool</span>&nbsp;<span class="op" id="4802799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802802">return</span>&nbsp;<span class="builtinfunc" id="4802809">len</span><span class="op" id="4802812">(</span><span class="ident" id="4802813">s</span><span class="op" id="4802814">)</span>&nbsp;<span class="op" id="4802816">&gt;</span>&nbsp;<span class="builtinfunc" id="4802818">len</span><span class="op" id="4802821">(</span><span class="ident" id="4802822">suffix</span><span class="op" id="4802828">)</span>&nbsp;<span class="op" id="4802830">&amp;&amp;</span>&nbsp;<span class="ident" id="4802833">s</span><span class="op" id="4802834">[</span><span class="builtinfunc" id="4802835">len</span><span class="op" id="4802838">(</span><span class="ident" id="4802839">s</span><span class="op" id="4802840">)</span><span class="op" id="4802841">-</span><span class="builtinfunc" id="4802842">len</span><span class="op" id="4802845">(</span><span class="ident" id="4802846">suffix</span><span class="op" id="4802852">)</span><span class="op" id="4802853">-</span><span class="num" id="4802854">1</span><span class="op" id="4802855">]</span>&nbsp;<span class="op" id="4802857">==</span>&nbsp;<span class="string" id="4802860">&#39;.&#39;</span>&nbsp;<span class="op" id="4802864">&amp;&amp;</span>&nbsp;<span class="ident" id="4802867">s</span><span class="op" id="4802868">[</span><span class="builtinfunc" id="4802869">len</span><span class="op" id="4802872">(</span><span class="ident" id="4802873">s</span><span class="op" id="4802874">)</span><span class="op" id="4802875">-</span><span class="builtinfunc" id="4802876">len</span><span class="op" id="4802879">(</span><span class="ident" id="4802880">suffix</span><span class="op" id="4802886">)</span><span class="op" id="4802887">:</span><span class="op" id="4802888">]</span>&nbsp;<span class="op" id="4802890">==</span>&nbsp;<span class="ident" id="4802893">suffix</span><br>
<span class="lineno"></span><span class="op" id="4802900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="4802903">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="4802980">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="4803056">type</span>&nbsp;<span class="ident" id="4803061">byPathLength</span>&nbsp;<span class="op" id="4803074">[</span><span class="op" id="4803075">]</span><span class="ident" id="4803076">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4803083">func</span>&nbsp;<span class="op" id="4803088">(</span><span class="ident" id="4803089">s</span>&nbsp;<span class="ident" id="4803091">byPathLength</span><span class="op" id="4803103">)</span>&nbsp;<span class="ident" id="4803105">Len</span><span class="op" id="4803108">(</span><span class="op" id="4803109">)</span>&nbsp;<span class="builtintype" id="4803111">int</span>&nbsp;<span class="op" id="4803115">{</span>&nbsp;<span class="keyword" id="4803117">return</span>&nbsp;<span class="builtinfunc" id="4803124">len</span><span class="op" id="4803127">(</span><span class="ident" id="4803128">s</span><span class="op" id="4803129">)</span>&nbsp;<span class="op" id="4803131">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="4803134">func</span>&nbsp;<span class="op" id="4803139">(</span><span class="ident" id="4803140">s</span>&nbsp;<span class="ident" id="4803142">byPathLength</span><span class="op" id="4803154">)</span>&nbsp;<span class="ident" id="4803156">Less</span><span class="op" id="4803160">(</span><span class="ident" id="4803161">i</span><span class="op" id="4803162">,</span>&nbsp;<span class="ident" id="4803164">j</span>&nbsp;<span class="builtintype" id="4803166">int</span><span class="op" id="4803169">)</span>&nbsp;<span class="builtintype" id="4803171">bool</span>&nbsp;<span class="op" id="4803176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803179">if</span>&nbsp;<span class="builtinfunc" id="4803182">len</span><span class="op" id="4803185">(</span><span class="ident" id="4803186">s</span><span class="op" id="4803187">[</span><span class="ident" id="4803188">i</span><span class="op" id="4803189">]</span><span class="op" id="4803190">.</span><span class="ident" id="4803191">Path</span><span class="op" id="4803195">)</span>&nbsp;<span class="op" id="4803197">!=</span>&nbsp;<span class="builtinfunc" id="4803200">len</span><span class="op" id="4803203">(</span><span class="ident" id="4803204">s</span><span class="op" id="4803205">[</span><span class="ident" id="4803206">j</span><span class="op" id="4803207">]</span><span class="op" id="4803208">.</span><span class="ident" id="4803209">Path</span><span class="op" id="4803213">)</span>&nbsp;<span class="op" id="4803215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803219">return</span>&nbsp;<span class="builtinfunc" id="4803226">len</span><span class="op" id="4803229">(</span><span class="ident" id="4803230">s</span><span class="op" id="4803231">[</span><span class="ident" id="4803232">i</span><span class="op" id="4803233">]</span><span class="op" id="4803234">.</span><span class="ident" id="4803235">Path</span><span class="op" id="4803239">)</span>&nbsp;<span class="op" id="4803241">&gt;</span>&nbsp;<span class="builtinfunc" id="4803243">len</span><span class="op" id="4803246">(</span><span class="ident" id="4803247">s</span><span class="op" id="4803248">[</span><span class="ident" id="4803249">j</span><span class="op" id="4803250">]</span><span class="op" id="4803251">.</span><span class="ident" id="4803252">Path</span><span class="op" id="4803256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803259">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803262">if</span>&nbsp;<span class="op" id="4803265">!</span><span class="ident" id="4803266">s</span><span class="op" id="4803267">[</span><span class="ident" id="4803268">i</span><span class="op" id="4803269">]</span><span class="op" id="4803270">.</span><span class="ident" id="4803271">Creation</span><span class="op" id="4803279">.</span><span class="ident" id="4803280">Equal</span><span class="op" id="4803285">(</span><span class="ident" id="4803286">s</span><span class="op" id="4803287">[</span><span class="ident" id="4803288">j</span><span class="op" id="4803289">]</span><span class="op" id="4803290">.</span><span class="ident" id="4803291">Creation</span><span class="op" id="4803299">)</span>&nbsp;<span class="op" id="4803301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803305">return</span>&nbsp;<span class="ident" id="4803312">s</span><span class="op" id="4803313">[</span><span class="ident" id="4803314">i</span><span class="op" id="4803315">]</span><span class="op" id="4803316">.</span><span class="ident" id="4803317">Creation</span><span class="op" id="4803325">.</span><span class="ident" id="4803326">Before</span><span class="op" id="4803332">(</span><span class="ident" id="4803333">s</span><span class="op" id="4803334">[</span><span class="ident" id="4803335">j</span><span class="op" id="4803336">]</span><span class="op" id="4803337">.</span><span class="ident" id="4803338">Creation</span><span class="op" id="4803346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803352">return</span>&nbsp;<span class="ident" id="4803359">s</span><span class="op" id="4803360">[</span><span class="ident" id="4803361">i</span><span class="op" id="4803362">]</span><span class="op" id="4803363">.</span><span class="ident" id="4803364">seqNum</span>&nbsp;<span class="op" id="4803371">&lt;</span>&nbsp;<span class="ident" id="4803373">s</span><span class="op" id="4803374">[</span><span class="ident" id="4803375">j</span><span class="op" id="4803376">]</span><span class="op" id="4803377">.</span><span class="ident" id="4803378">seqNum</span><br>
<span class="lineno"></span><span class="op" id="4803385">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="4803388">func</span>&nbsp;<span class="op" id="4803393">(</span><span class="ident" id="4803394">s</span>&nbsp;<span class="ident" id="4803396">byPathLength</span><span class="op" id="4803408">)</span>&nbsp;<span class="ident" id="4803410">Swap</span><span class="op" id="4803414">(</span><span class="ident" id="4803415">i</span><span class="op" id="4803416">,</span>&nbsp;<span class="ident" id="4803418">j</span>&nbsp;<span class="builtintype" id="4803420">int</span><span class="op" id="4803423">)</span>&nbsp;<span class="op" id="4803425">{</span>&nbsp;<span class="ident" id="4803427">s</span><span class="op" id="4803428">[</span><span class="ident" id="4803429">i</span><span class="op" id="4803430">]</span><span class="op" id="4803431">,</span>&nbsp;<span class="ident" id="4803433">s</span><span class="op" id="4803434">[</span><span class="ident" id="4803435">j</span><span class="op" id="4803436">]</span>&nbsp;<span class="op" id="4803438">=</span>&nbsp;<span class="ident" id="4803440">s</span><span class="op" id="4803441">[</span><span class="ident" id="4803442">j</span><span class="op" id="4803443">]</span><span class="op" id="4803444">,</span>&nbsp;<span class="ident" id="4803446">s</span><span class="op" id="4803447">[</span><span class="ident" id="4803448">i</span><span class="op" id="4803449">]</span>&nbsp;<span class="op" id="4803451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4803454">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4803528">//</span><br>
<span class="lineno">170</span><span class="comment" id="4803531">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="4803602">func</span>&nbsp;<span class="op" id="4803607">(</span><span class="ident" id="4803608">j</span>&nbsp;<span class="op" id="4803610">*</span><span class="ident" id="4803611">Jar</span><span class="op" id="4803614">)</span>&nbsp;<span class="ident" id="4803616">Cookies</span><span class="op" id="4803623">(</span><span class="ident" id="4803624">u</span>&nbsp;<span class="op" id="4803626">*</span><span class="ident" id="4803627">url</span><span class="op" id="4803630">.</span><span class="ident" id="4803631">URL</span><span class="op" id="4803634">)</span>&nbsp;<span class="op" id="4803636">(</span><span class="ident" id="4803637">cookies</span>&nbsp;<span class="op" id="4803645">[</span><span class="op" id="4803646">]</span><span class="op" id="4803647">*</span><span class="ident" id="4803648">http</span><span class="op" id="4803652">.</span><span class="ident" id="4803653">Cookie</span><span class="op" id="4803659">)</span>&nbsp;<span class="op" id="4803661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803664">return</span>&nbsp;<span class="ident" id="4803671">j</span><span class="op" id="4803672">.</span><span class="ident" id="4803673">cookies</span><span class="op" id="4803680">(</span><span class="ident" id="4803681">u</span><span class="op" id="4803682">,</span>&nbsp;<span class="ident" id="4803684">time</span><span class="op" id="4803688">.</span><span class="ident" id="4803689">Now</span><span class="op" id="4803692">(</span><span class="op" id="4803693">)</span><span class="op" id="4803694">)</span><br>
<span class="lineno"></span><span class="op" id="4803696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="4803699">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="4803769">func</span>&nbsp;<span class="op" id="4803774">(</span><span class="ident" id="4803775">j</span>&nbsp;<span class="op" id="4803777">*</span><span class="ident" id="4803778">Jar</span><span class="op" id="4803781">)</span>&nbsp;<span class="ident" id="4803783">cookies</span><span class="op" id="4803790">(</span><span class="ident" id="4803791">u</span>&nbsp;<span class="op" id="4803793">*</span><span class="ident" id="4803794">url</span><span class="op" id="4803797">.</span><span class="ident" id="4803798">URL</span><span class="op" id="4803801">,</span>&nbsp;<span class="ident" id="4803803">now</span>&nbsp;<span class="ident" id="4803807">time</span><span class="op" id="4803811">.</span><span class="ident" id="4803812">Time</span><span class="op" id="4803816">)</span>&nbsp;<span class="op" id="4803818">(</span><span class="ident" id="4803819">cookies</span>&nbsp;<span class="op" id="4803827">[</span><span class="op" id="4803828">]</span><span class="op" id="4803829">*</span><span class="ident" id="4803830">http</span><span class="op" id="4803834">.</span><span class="ident" id="4803835">Cookie</span><span class="op" id="4803841">)</span>&nbsp;<span class="op" id="4803843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803846">if</span>&nbsp;<span class="ident" id="4803849">u</span><span class="op" id="4803850">.</span><span class="ident" id="4803851">Scheme</span>&nbsp;<span class="op" id="4803858">!=</span>&nbsp;<span class="string" id="4803861">&#34;http&#34;</span>&nbsp;<span class="op" id="4803868">&amp;&amp;</span>&nbsp;<span class="ident" id="4803871">u</span><span class="op" id="4803872">.</span><span class="ident" id="4803873">Scheme</span>&nbsp;<span class="op" id="4803880">!=</span>&nbsp;<span class="string" id="4803883">&#34;https&#34;</span>&nbsp;<span class="op" id="4803891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803895">return</span>&nbsp;<span class="ident" id="4803902">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803911">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4803914">host</span><span class="op" id="4803918">,</span>&nbsp;<span class="ident" id="4803920">err</span>&nbsp;<span class="op" id="4803924">:=</span>&nbsp;<span class="ident" id="4803927">canonicalHost</span><span class="op" id="4803940">(</span><span class="ident" id="4803941">u</span><span class="op" id="4803942">.</span><span class="ident" id="4803943">Host</span><span class="op" id="4803947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803950">if</span>&nbsp;<span class="ident" id="4803953">err</span>&nbsp;<span class="op" id="4803957">!=</span>&nbsp;<span class="ident" id="4803960">nil</span>&nbsp;<span class="op" id="4803964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803968">return</span>&nbsp;<span class="ident" id="4803975">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4803987">key</span>&nbsp;<span class="op" id="4803991">:=</span>&nbsp;<span class="ident" id="4803994">jarKey</span><span class="op" id="4804000">(</span><span class="ident" id="4804001">host</span><span class="op" id="4804005">,</span>&nbsp;<span class="ident" id="4804007">j</span><span class="op" id="4804008">.</span><span class="ident" id="4804009">psList</span><span class="op" id="4804015">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804019">j</span><span class="op" id="4804020">.</span><span class="ident" id="4804021">mu</span><span class="op" id="4804023">.</span><span class="ident" id="4804024">Lock</span><span class="op" id="4804028">(</span><span class="op" id="4804029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804032">defer</span>&nbsp;<span class="ident" id="4804038">j</span><span class="op" id="4804039">.</span><span class="ident" id="4804040">mu</span><span class="op" id="4804042">.</span><span class="ident" id="4804043">Unlock</span><span class="op" id="4804049">(</span><span class="op" id="4804050">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804054">submap</span>&nbsp;<span class="op" id="4804061">:=</span>&nbsp;<span class="ident" id="4804064">j</span><span class="op" id="4804065">.</span><span class="ident" id="4804066">entries</span><span class="op" id="4804073">[</span><span class="ident" id="4804074">key</span><span class="op" id="4804077">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804080">if</span>&nbsp;<span class="ident" id="4804083">submap</span>&nbsp;<span class="op" id="4804090">==</span>&nbsp;<span class="ident" id="4804093">nil</span>&nbsp;<span class="op" id="4804097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804101">return</span>&nbsp;<span class="ident" id="4804108">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804121">https</span>&nbsp;<span class="op" id="4804127">:=</span>&nbsp;<span class="ident" id="4804130">u</span><span class="op" id="4804131">.</span><span class="ident" id="4804132">Scheme</span>&nbsp;<span class="op" id="4804139">==</span>&nbsp;<span class="string" id="4804142">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804151">path</span>&nbsp;<span class="op" id="4804156">:=</span>&nbsp;<span class="ident" id="4804159">u</span><span class="op" id="4804160">.</span><span class="ident" id="4804161">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804167">if</span>&nbsp;<span class="ident" id="4804170">path</span>&nbsp;<span class="op" id="4804175">==</span>&nbsp;<span class="string" id="4804178">&#34;&#34;</span>&nbsp;<span class="op" id="4804181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804185">path</span>&nbsp;<span class="op" id="4804190">=</span>&nbsp;<span class="string" id="4804192">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804201">modified</span>&nbsp;<span class="op" id="4804210">:=</span>&nbsp;<span class="ident" id="4804213">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804220">var</span>&nbsp;<span class="ident" id="4804224">selected</span>&nbsp;<span class="op" id="4804233">[</span><span class="op" id="4804234">]</span><span class="ident" id="4804235">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804242">for</span>&nbsp;<span class="ident" id="4804246">id</span><span class="op" id="4804248">,</span>&nbsp;<span class="ident" id="4804250">e</span>&nbsp;<span class="op" id="4804252">:=</span>&nbsp;<span class="keyword" id="4804255">range</span>&nbsp;<span class="ident" id="4804261">submap</span>&nbsp;<span class="op" id="4804268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804272">if</span>&nbsp;<span class="ident" id="4804275">e</span><span class="op" id="4804276">.</span><span class="ident" id="4804277">Persistent</span>&nbsp;<span class="op" id="4804288">&amp;&amp;</span>&nbsp;<span class="op" id="4804291">!</span><span class="ident" id="4804292">e</span><span class="op" id="4804293">.</span><span class="ident" id="4804294">Expires</span><span class="op" id="4804301">.</span><span class="ident" id="4804302">After</span><span class="op" id="4804307">(</span><span class="ident" id="4804308">now</span><span class="op" id="4804311">)</span>&nbsp;<span class="op" id="4804313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4804318">delete</span><span class="op" id="4804324">(</span><span class="ident" id="4804325">submap</span><span class="op" id="4804331">,</span>&nbsp;<span class="ident" id="4804333">id</span><span class="op" id="4804335">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804340">modified</span>&nbsp;<span class="op" id="4804349">=</span>&nbsp;<span class="ident" id="4804351">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804359">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804374">if</span>&nbsp;<span class="op" id="4804377">!</span><span class="ident" id="4804378">e</span><span class="op" id="4804379">.</span><span class="ident" id="4804380">shouldSend</span><span class="op" id="4804390">(</span><span class="ident" id="4804391">https</span><span class="op" id="4804396">,</span>&nbsp;<span class="ident" id="4804398">host</span><span class="op" id="4804402">,</span>&nbsp;<span class="ident" id="4804404">path</span><span class="op" id="4804408">)</span>&nbsp;<span class="op" id="4804410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804415">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804430">e</span><span class="op" id="4804431">.</span><span class="ident" id="4804432">LastAccess</span>&nbsp;<span class="op" id="4804443">=</span>&nbsp;<span class="ident" id="4804445">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804451">submap</span><span class="op" id="4804457">[</span><span class="ident" id="4804458">id</span><span class="op" id="4804460">]</span>&nbsp;<span class="op" id="4804462">=</span>&nbsp;<span class="ident" id="4804464">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804468">selected</span>&nbsp;<span class="op" id="4804477">=</span>&nbsp;<span class="builtinfunc" id="4804479">append</span><span class="op" id="4804485">(</span><span class="ident" id="4804486">selected</span><span class="op" id="4804494">,</span>&nbsp;<span class="ident" id="4804496">e</span><span class="op" id="4804497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804501">modified</span>&nbsp;<span class="op" id="4804510">=</span>&nbsp;<span class="ident" id="4804512">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804521">if</span>&nbsp;<span class="ident" id="4804524">modified</span>&nbsp;<span class="op" id="4804533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804537">if</span>&nbsp;<span class="builtinfunc" id="4804540">len</span><span class="op" id="4804543">(</span><span class="ident" id="4804544">submap</span><span class="op" id="4804550">)</span>&nbsp;<span class="op" id="4804552">==</span>&nbsp;<span class="num" id="4804555">0</span>&nbsp;<span class="op" id="4804557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4804562">delete</span><span class="op" id="4804568">(</span><span class="ident" id="4804569">j</span><span class="op" id="4804570">.</span><span class="ident" id="4804571">entries</span><span class="op" id="4804578">,</span>&nbsp;<span class="ident" id="4804580">key</span><span class="op" id="4804583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804587">}</span>&nbsp;<span class="keyword" id="4804589">else</span>&nbsp;<span class="op" id="4804594">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804599">j</span><span class="op" id="4804600">.</span><span class="ident" id="4804601">entries</span><span class="op" id="4804608">[</span><span class="ident" id="4804609">key</span><span class="op" id="4804612">]</span>&nbsp;<span class="op" id="4804614">=</span>&nbsp;<span class="ident" id="4804616">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804632">sort</span><span class="op" id="4804636">.</span><span class="ident" id="4804637">Sort</span><span class="op" id="4804641">(</span><span class="ident" id="4804642">byPathLength</span><span class="op" id="4804654">(</span><span class="ident" id="4804655">selected</span><span class="op" id="4804663">)</span><span class="op" id="4804664">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804667">for</span>&nbsp;<span class="ident" id="4804671">_</span><span class="op" id="4804672">,</span>&nbsp;<span class="ident" id="4804674">e</span>&nbsp;<span class="op" id="4804676">:=</span>&nbsp;<span class="keyword" id="4804679">range</span>&nbsp;<span class="ident" id="4804685">selected</span>&nbsp;<span class="op" id="4804694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804698">cookies</span>&nbsp;<span class="op" id="4804706">=</span>&nbsp;<span class="builtinfunc" id="4804708">append</span><span class="op" id="4804714">(</span><span class="ident" id="4804715">cookies</span><span class="op" id="4804722">,</span>&nbsp;<span class="op" id="4804724">&amp;</span><span class="ident" id="4804725">http</span><span class="op" id="4804729">.</span><span class="ident" id="4804730">Cookie</span><span class="op" id="4804736">{</span><span class="ident" id="4804737">Name</span><span class="op" id="4804741">:</span>&nbsp;<span class="ident" id="4804743">e</span><span class="op" id="4804744">.</span><span class="ident" id="4804745">Name</span><span class="op" id="4804749">,</span>&nbsp;<span class="ident" id="4804751">Value</span><span class="op" id="4804756">:</span>&nbsp;<span class="ident" id="4804758">e</span><span class="op" id="4804759">.</span><span class="ident" id="4804760">Value</span><span class="op" id="4804765">}</span><span class="op" id="4804766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4804769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4804773">return</span>&nbsp;<span class="ident" id="4804780">cookies</span><br>
<span class="lineno">230</span><span class="op" id="4804788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4804791">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4804871">//</span><br>
<span class="lineno"></span><span class="comment" id="4804874">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="4804935">func</span>&nbsp;<span class="op" id="4804940">(</span><span class="ident" id="4804941">j</span>&nbsp;<span class="op" id="4804943">*</span><span class="ident" id="4804944">Jar</span><span class="op" id="4804947">)</span>&nbsp;<span class="ident" id="4804949">SetCookies</span><span class="op" id="4804959">(</span><span class="ident" id="4804960">u</span>&nbsp;<span class="op" id="4804962">*</span><span class="ident" id="4804963">url</span><span class="op" id="4804966">.</span><span class="ident" id="4804967">URL</span><span class="op" id="4804970">,</span>&nbsp;<span class="ident" id="4804972">cookies</span>&nbsp;<span class="op" id="4804980">[</span><span class="op" id="4804981">]</span><span class="op" id="4804982">*</span><span class="ident" id="4804983">http</span><span class="op" id="4804987">.</span><span class="ident" id="4804988">Cookie</span><span class="op" id="4804994">)</span>&nbsp;<span class="op" id="4804996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4804999">j</span><span class="op" id="4805000">.</span><span class="ident" id="4805001">setCookies</span><span class="op" id="4805011">(</span><span class="ident" id="4805012">u</span><span class="op" id="4805013">,</span>&nbsp;<span class="ident" id="4805015">cookies</span><span class="op" id="4805022">,</span>&nbsp;<span class="ident" id="4805024">time</span><span class="op" id="4805028">.</span><span class="ident" id="4805029">Now</span><span class="op" id="4805032">(</span><span class="op" id="4805033">)</span><span class="op" id="4805034">)</span><br>
<span class="lineno"></span><span class="op" id="4805036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4805039">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="4805113">func</span>&nbsp;<span class="op" id="4805118">(</span><span class="ident" id="4805119">j</span>&nbsp;<span class="op" id="4805121">*</span><span class="ident" id="4805122">Jar</span><span class="op" id="4805125">)</span>&nbsp;<span class="ident" id="4805127">setCookies</span><span class="op" id="4805137">(</span><span class="ident" id="4805138">u</span>&nbsp;<span class="op" id="4805140">*</span><span class="ident" id="4805141">url</span><span class="op" id="4805144">.</span><span class="ident" id="4805145">URL</span><span class="op" id="4805148">,</span>&nbsp;<span class="ident" id="4805150">cookies</span>&nbsp;<span class="op" id="4805158">[</span><span class="op" id="4805159">]</span><span class="op" id="4805160">*</span><span class="ident" id="4805161">http</span><span class="op" id="4805165">.</span><span class="ident" id="4805166">Cookie</span><span class="op" id="4805172">,</span>&nbsp;<span class="ident" id="4805174">now</span>&nbsp;<span class="ident" id="4805178">time</span><span class="op" id="4805182">.</span><span class="ident" id="4805183">Time</span><span class="op" id="4805187">)</span>&nbsp;<span class="op" id="4805189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805192">if</span>&nbsp;<span class="builtinfunc" id="4805195">len</span><span class="op" id="4805198">(</span><span class="ident" id="4805199">cookies</span><span class="op" id="4805206">)</span>&nbsp;<span class="op" id="4805208">==</span>&nbsp;<span class="num" id="4805211">0</span>&nbsp;<span class="op" id="4805213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805217">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805228">if</span>&nbsp;<span class="ident" id="4805231">u</span><span class="op" id="4805232">.</span><span class="ident" id="4805233">Scheme</span>&nbsp;<span class="op" id="4805240">!=</span>&nbsp;<span class="string" id="4805243">&#34;http&#34;</span>&nbsp;<span class="op" id="4805250">&amp;&amp;</span>&nbsp;<span class="ident" id="4805253">u</span><span class="op" id="4805254">.</span><span class="ident" id="4805255">Scheme</span>&nbsp;<span class="op" id="4805262">!=</span>&nbsp;<span class="string" id="4805265">&#34;https&#34;</span>&nbsp;<span class="op" id="4805273">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805277">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805288">host</span><span class="op" id="4805292">,</span>&nbsp;<span class="ident" id="4805294">err</span>&nbsp;<span class="op" id="4805298">:=</span>&nbsp;<span class="ident" id="4805301">canonicalHost</span><span class="op" id="4805314">(</span><span class="ident" id="4805315">u</span><span class="op" id="4805316">.</span><span class="ident" id="4805317">Host</span><span class="op" id="4805321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805324">if</span>&nbsp;<span class="ident" id="4805327">err</span>&nbsp;<span class="op" id="4805331">!=</span>&nbsp;<span class="ident" id="4805334">nil</span>&nbsp;<span class="op" id="4805338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805342">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805353">key</span>&nbsp;<span class="op" id="4805357">:=</span>&nbsp;<span class="ident" id="4805360">jarKey</span><span class="op" id="4805366">(</span><span class="ident" id="4805367">host</span><span class="op" id="4805371">,</span>&nbsp;<span class="ident" id="4805373">j</span><span class="op" id="4805374">.</span><span class="ident" id="4805375">psList</span><span class="op" id="4805381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805384">defPath</span>&nbsp;<span class="op" id="4805392">:=</span>&nbsp;<span class="ident" id="4805395">defaultPath</span><span class="op" id="4805406">(</span><span class="ident" id="4805407">u</span><span class="op" id="4805408">.</span><span class="ident" id="4805409">Path</span><span class="op" id="4805413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805417">j</span><span class="op" id="4805418">.</span><span class="ident" id="4805419">mu</span><span class="op" id="4805421">.</span><span class="ident" id="4805422">Lock</span><span class="op" id="4805426">(</span><span class="op" id="4805427">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805430">defer</span>&nbsp;<span class="ident" id="4805436">j</span><span class="op" id="4805437">.</span><span class="ident" id="4805438">mu</span><span class="op" id="4805440">.</span><span class="ident" id="4805441">Unlock</span><span class="op" id="4805447">(</span><span class="op" id="4805448">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805452">submap</span>&nbsp;<span class="op" id="4805459">:=</span>&nbsp;<span class="ident" id="4805462">j</span><span class="op" id="4805463">.</span><span class="ident" id="4805464">entries</span><span class="op" id="4805471">[</span><span class="ident" id="4805472">key</span><span class="op" id="4805475">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805479">modified</span>&nbsp;<span class="op" id="4805488">:=</span>&nbsp;<span class="ident" id="4805491">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805498">for</span>&nbsp;<span class="ident" id="4805502">_</span><span class="op" id="4805503">,</span>&nbsp;<span class="ident" id="4805505">cookie</span>&nbsp;<span class="op" id="4805512">:=</span>&nbsp;<span class="keyword" id="4805515">range</span>&nbsp;<span class="ident" id="4805521">cookies</span>&nbsp;<span class="op" id="4805529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805533">e</span><span class="op" id="4805534">,</span>&nbsp;<span class="ident" id="4805536">remove</span><span class="op" id="4805542">,</span>&nbsp;<span class="ident" id="4805544">err</span>&nbsp;<span class="op" id="4805548">:=</span>&nbsp;<span class="ident" id="4805551">j</span><span class="op" id="4805552">.</span><span class="ident" id="4805553">newEntry</span><span class="op" id="4805561">(</span><span class="ident" id="4805562">cookie</span><span class="op" id="4805568">,</span>&nbsp;<span class="ident" id="4805570">now</span><span class="op" id="4805573">,</span>&nbsp;<span class="ident" id="4805575">defPath</span><span class="op" id="4805582">,</span>&nbsp;<span class="ident" id="4805584">host</span><span class="op" id="4805588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805592">if</span>&nbsp;<span class="ident" id="4805595">err</span>&nbsp;<span class="op" id="4805599">!=</span>&nbsp;<span class="ident" id="4805602">nil</span>&nbsp;<span class="op" id="4805606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805611">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805622">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805626">id</span>&nbsp;<span class="op" id="4805629">:=</span>&nbsp;<span class="ident" id="4805632">e</span><span class="op" id="4805633">.</span><span class="ident" id="4805634">id</span><span class="op" id="4805636">(</span><span class="op" id="4805637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805641">if</span>&nbsp;<span class="ident" id="4805644">remove</span>&nbsp;<span class="op" id="4805651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805656">if</span>&nbsp;<span class="ident" id="4805659">submap</span>&nbsp;<span class="op" id="4805666">!=</span>&nbsp;<span class="ident" id="4805669">nil</span>&nbsp;<span class="op" id="4805673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805679">if</span>&nbsp;<span class="ident" id="4805682">_</span><span class="op" id="4805683">,</span>&nbsp;<span class="ident" id="4805685">ok</span>&nbsp;<span class="op" id="4805688">:=</span>&nbsp;<span class="ident" id="4805691">submap</span><span class="op" id="4805697">[</span><span class="ident" id="4805698">id</span><span class="op" id="4805700">]</span><span class="op" id="4805701">;</span>&nbsp;<span class="ident" id="4805703">ok</span>&nbsp;<span class="op" id="4805706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4805713">delete</span><span class="op" id="4805719">(</span><span class="ident" id="4805720">submap</span><span class="op" id="4805726">,</span>&nbsp;<span class="ident" id="4805728">id</span><span class="op" id="4805730">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805737">modified</span>&nbsp;<span class="op" id="4805746">=</span>&nbsp;<span class="ident" id="4805748">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805767">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805778">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805782">if</span>&nbsp;<span class="ident" id="4805785">submap</span>&nbsp;<span class="op" id="4805792">==</span>&nbsp;<span class="ident" id="4805795">nil</span>&nbsp;<span class="op" id="4805799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805804">submap</span>&nbsp;<span class="op" id="4805811">=</span>&nbsp;<span class="builtinfunc" id="4805813">make</span><span class="op" id="4805817">(</span><span class="keyword" id="4805818">map</span><span class="op" id="4805821">[</span><span class="builtintype" id="4805822">string</span><span class="op" id="4805828">]</span><span class="ident" id="4805829">entry</span><span class="op" id="4805834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4805843">if</span>&nbsp;<span class="ident" id="4805846">old</span><span class="op" id="4805849">,</span>&nbsp;<span class="ident" id="4805851">ok</span>&nbsp;<span class="op" id="4805854">:=</span>&nbsp;<span class="ident" id="4805857">submap</span><span class="op" id="4805863">[</span><span class="ident" id="4805864">id</span><span class="op" id="4805866">]</span><span class="op" id="4805867">;</span>&nbsp;<span class="ident" id="4805869">ok</span>&nbsp;<span class="op" id="4805872">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805877">e</span><span class="op" id="4805878">.</span><span class="ident" id="4805879">Creation</span>&nbsp;<span class="op" id="4805888">=</span>&nbsp;<span class="ident" id="4805890">old</span><span class="op" id="4805893">.</span><span class="ident" id="4805894">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805906">e</span><span class="op" id="4805907">.</span><span class="ident" id="4805908">seqNum</span>&nbsp;<span class="op" id="4805915">=</span>&nbsp;<span class="ident" id="4805917">old</span><span class="op" id="4805920">.</span><span class="ident" id="4805921">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4805930">}</span>&nbsp;<span class="keyword" id="4805932">else</span>&nbsp;<span class="op" id="4805937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805942">e</span><span class="op" id="4805943">.</span><span class="ident" id="4805944">Creation</span>&nbsp;<span class="op" id="4805953">=</span>&nbsp;<span class="ident" id="4805955">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805962">e</span><span class="op" id="4805963">.</span><span class="ident" id="4805964">seqNum</span>&nbsp;<span class="op" id="4805971">=</span>&nbsp;<span class="ident" id="4805973">j</span><span class="op" id="4805974">.</span><span class="ident" id="4805975">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4805989">j</span><span class="op" id="4805990">.</span><span class="ident" id="4805991">nextSeqNum</span><span class="op" id="4806001">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806010">e</span><span class="op" id="4806011">.</span><span class="ident" id="4806012">LastAccess</span>&nbsp;<span class="op" id="4806023">=</span>&nbsp;<span class="ident" id="4806025">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806031">submap</span><span class="op" id="4806037">[</span><span class="ident" id="4806038">id</span><span class="op" id="4806040">]</span>&nbsp;<span class="op" id="4806042">=</span>&nbsp;<span class="ident" id="4806044">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806048">modified</span>&nbsp;<span class="op" id="4806057">=</span>&nbsp;<span class="ident" id="4806059">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806069">if</span>&nbsp;<span class="ident" id="4806072">modified</span>&nbsp;<span class="op" id="4806081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806085">if</span>&nbsp;<span class="builtinfunc" id="4806088">len</span><span class="op" id="4806091">(</span><span class="ident" id="4806092">submap</span><span class="op" id="4806098">)</span>&nbsp;<span class="op" id="4806100">==</span>&nbsp;<span class="num" id="4806103">0</span>&nbsp;<span class="op" id="4806105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4806110">delete</span><span class="op" id="4806116">(</span><span class="ident" id="4806117">j</span><span class="op" id="4806118">.</span><span class="ident" id="4806119">entries</span><span class="op" id="4806126">,</span>&nbsp;<span class="ident" id="4806128">key</span><span class="op" id="4806131">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806135">}</span>&nbsp;<span class="keyword" id="4806137">else</span>&nbsp;<span class="op" id="4806142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806147">j</span><span class="op" id="4806148">.</span><span class="ident" id="4806149">entries</span><span class="op" id="4806156">[</span><span class="ident" id="4806157">key</span><span class="op" id="4806160">]</span>&nbsp;<span class="op" id="4806162">=</span>&nbsp;<span class="ident" id="4806164">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806176">}</span><br>
<span class="lineno"></span><span class="op" id="4806178">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="4806181">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="4806261">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4806275">func</span>&nbsp;<span class="ident" id="4806280">canonicalHost</span><span class="op" id="4806293">(</span><span class="ident" id="4806294">host</span>&nbsp;<span class="builtintype" id="4806299">string</span><span class="op" id="4806305">)</span>&nbsp;<span class="op" id="4806307">(</span><span class="builtintype" id="4806308">string</span><span class="op" id="4806314">,</span>&nbsp;<span class="builtintype" id="4806316">error</span><span class="op" id="4806321">)</span>&nbsp;<span class="op" id="4806323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806326">var</span>&nbsp;<span class="ident" id="4806330">err</span>&nbsp;<span class="builtintype" id="4806334">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806341">host</span>&nbsp;<span class="op" id="4806346">=</span>&nbsp;<span class="ident" id="4806348">strings</span><span class="op" id="4806355">.</span><span class="ident" id="4806356">ToLower</span><span class="op" id="4806363">(</span><span class="ident" id="4806364">host</span><span class="op" id="4806368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806371">if</span>&nbsp;<span class="ident" id="4806374">hasPort</span><span class="op" id="4806381">(</span><span class="ident" id="4806382">host</span><span class="op" id="4806386">)</span>&nbsp;<span class="op" id="4806388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806392">host</span><span class="op" id="4806396">,</span>&nbsp;<span class="ident" id="4806398">_</span><span class="op" id="4806399">,</span>&nbsp;<span class="ident" id="4806401">err</span>&nbsp;<span class="op" id="4806405">=</span>&nbsp;<span class="ident" id="4806407">net</span><span class="op" id="4806410">.</span><span class="ident" id="4806411">SplitHostPort</span><span class="op" id="4806424">(</span><span class="ident" id="4806425">host</span><span class="op" id="4806429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806433">if</span>&nbsp;<span class="ident" id="4806436">err</span>&nbsp;<span class="op" id="4806440">!=</span>&nbsp;<span class="ident" id="4806443">nil</span>&nbsp;<span class="op" id="4806447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806452">return</span>&nbsp;<span class="string" id="4806459">&#34;&#34;</span><span class="op" id="4806461">,</span>&nbsp;<span class="ident" id="4806463">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806475">if</span>&nbsp;<span class="ident" id="4806478">strings</span><span class="op" id="4806485">.</span><span class="ident" id="4806486">HasSuffix</span><span class="op" id="4806495">(</span><span class="ident" id="4806496">host</span><span class="op" id="4806500">,</span>&nbsp;<span class="string" id="4806502">&#34;.&#34;</span><span class="op" id="4806505">)</span>&nbsp;<span class="op" id="4806507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4806511">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806570">host</span>&nbsp;<span class="op" id="4806575">=</span>&nbsp;<span class="ident" id="4806577">host</span><span class="op" id="4806581">[</span><span class="op" id="4806582">:</span><span class="builtinfunc" id="4806583">len</span><span class="op" id="4806586">(</span><span class="ident" id="4806587">host</span><span class="op" id="4806591">)</span><span class="op" id="4806592">-</span><span class="num" id="4806593">1</span><span class="op" id="4806594">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806600">return</span>&nbsp;<span class="ident" id="4806607">toASCII</span><span class="op" id="4806614">(</span><span class="ident" id="4806615">host</span><span class="op" id="4806619">)</span><br>
<span class="lineno"></span><span class="op" id="4806621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4806624">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="4806699">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="4806736">func</span>&nbsp;<span class="ident" id="4806741">hasPort</span><span class="op" id="4806748">(</span><span class="ident" id="4806749">host</span>&nbsp;<span class="builtintype" id="4806754">string</span><span class="op" id="4806760">)</span>&nbsp;<span class="builtintype" id="4806762">bool</span>&nbsp;<span class="op" id="4806767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4806770">colons</span>&nbsp;<span class="op" id="4806777">:=</span>&nbsp;<span class="ident" id="4806780">strings</span><span class="op" id="4806787">.</span><span class="ident" id="4806788">Count</span><span class="op" id="4806793">(</span><span class="ident" id="4806794">host</span><span class="op" id="4806798">,</span>&nbsp;<span class="string" id="4806800">&#34;:&#34;</span><span class="op" id="4806803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806806">if</span>&nbsp;<span class="ident" id="4806809">colons</span>&nbsp;<span class="op" id="4806816">==</span>&nbsp;<span class="num" id="4806819">0</span>&nbsp;<span class="op" id="4806821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806825">return</span>&nbsp;<span class="ident" id="4806832">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806842">if</span>&nbsp;<span class="ident" id="4806845">colons</span>&nbsp;<span class="op" id="4806852">==</span>&nbsp;<span class="num" id="4806855">1</span>&nbsp;<span class="op" id="4806857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806861">return</span>&nbsp;<span class="ident" id="4806868">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4806874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4806877">return</span>&nbsp;<span class="ident" id="4806884">host</span><span class="op" id="4806888">[</span><span class="num" id="4806889">0</span><span class="op" id="4806890">]</span>&nbsp;<span class="op" id="4806892">==</span>&nbsp;<span class="string" id="4806895">&#39;[&#39;</span>&nbsp;<span class="op" id="4806899">&amp;&amp;</span>&nbsp;<span class="ident" id="4806902">strings</span><span class="op" id="4806909">.</span><span class="ident" id="4806910">Contains</span><span class="op" id="4806918">(</span><span class="ident" id="4806919">host</span><span class="op" id="4806923">,</span>&nbsp;<span class="string" id="4806925">&#34;]:&#34;</span><span class="op" id="4806929">)</span><br>
<span class="lineno">330</span><span class="op" id="4806931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4806934">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="4806978">func</span>&nbsp;<span class="ident" id="4806983">jarKey</span><span class="op" id="4806989">(</span><span class="ident" id="4806990">host</span>&nbsp;<span class="builtintype" id="4806995">string</span><span class="op" id="4807001">,</span>&nbsp;<span class="ident" id="4807003">psl</span>&nbsp;<span class="ident" id="4807007">PublicSuffixList</span><span class="op" id="4807023">)</span>&nbsp;<span class="builtintype" id="4807025">string</span>&nbsp;<span class="op" id="4807032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807035">if</span>&nbsp;<span class="ident" id="4807038">isIP</span><span class="op" id="4807042">(</span><span class="ident" id="4807043">host</span><span class="op" id="4807047">)</span>&nbsp;<span class="op" id="4807049">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807053">return</span>&nbsp;<span class="ident" id="4807060">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807070">var</span>&nbsp;<span class="ident" id="4807074">i</span>&nbsp;<span class="builtintype" id="4807076">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807081">if</span>&nbsp;<span class="ident" id="4807084">psl</span>&nbsp;<span class="op" id="4807088">==</span>&nbsp;<span class="ident" id="4807091">nil</span>&nbsp;<span class="op" id="4807095">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807099">i</span>&nbsp;<span class="op" id="4807101">=</span>&nbsp;<span class="ident" id="4807103">strings</span><span class="op" id="4807110">.</span><span class="ident" id="4807111">LastIndex</span><span class="op" id="4807120">(</span><span class="ident" id="4807121">host</span><span class="op" id="4807125">,</span>&nbsp;<span class="string" id="4807127">&#34;.&#34;</span><span class="op" id="4807130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807134">if</span>&nbsp;<span class="ident" id="4807137">i</span>&nbsp;<span class="op" id="4807139">==</span>&nbsp;<span class="op" id="4807142">-</span><span class="num" id="4807143">1</span>&nbsp;<span class="op" id="4807145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807150">return</span>&nbsp;<span class="ident" id="4807157">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807167">}</span>&nbsp;<span class="keyword" id="4807169">else</span>&nbsp;<span class="op" id="4807174">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807178">suffix</span>&nbsp;<span class="op" id="4807185">:=</span>&nbsp;<span class="ident" id="4807188">psl</span><span class="op" id="4807191">.</span><span class="ident" id="4807192">PublicSuffix</span><span class="op" id="4807204">(</span><span class="ident" id="4807205">host</span><span class="op" id="4807209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807213">if</span>&nbsp;<span class="ident" id="4807216">suffix</span>&nbsp;<span class="op" id="4807223">==</span>&nbsp;<span class="ident" id="4807226">host</span>&nbsp;<span class="op" id="4807231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807236">return</span>&nbsp;<span class="ident" id="4807243">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807254">i</span>&nbsp;<span class="op" id="4807256">=</span>&nbsp;<span class="builtinfunc" id="4807258">len</span><span class="op" id="4807261">(</span><span class="ident" id="4807262">host</span><span class="op" id="4807266">)</span>&nbsp;<span class="op" id="4807268">-</span>&nbsp;<span class="builtinfunc" id="4807270">len</span><span class="op" id="4807273">(</span><span class="ident" id="4807274">suffix</span><span class="op" id="4807280">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807284">if</span>&nbsp;<span class="ident" id="4807287">i</span>&nbsp;<span class="op" id="4807289">&lt;=</span>&nbsp;<span class="num" id="4807292">0</span>&nbsp;<span class="op" id="4807294">||</span>&nbsp;<span class="ident" id="4807297">host</span><span class="op" id="4807301">[</span><span class="ident" id="4807302">i</span><span class="op" id="4807303">-</span><span class="num" id="4807304">1</span><span class="op" id="4807305">]</span>&nbsp;<span class="op" id="4807307">!=</span>&nbsp;<span class="string" id="4807310">&#39;.&#39;</span>&nbsp;<span class="op" id="4807314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4807319">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4807372">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807424">return</span>&nbsp;<span class="ident" id="4807431">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807438">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807444">prevDot</span>&nbsp;<span class="op" id="4807452">:=</span>&nbsp;<span class="ident" id="4807455">strings</span><span class="op" id="4807462">.</span><span class="ident" id="4807463">LastIndex</span><span class="op" id="4807472">(</span><span class="ident" id="4807473">host</span><span class="op" id="4807477">[</span><span class="op" id="4807478">:</span><span class="ident" id="4807479">i</span><span class="op" id="4807480">-</span><span class="num" id="4807481">1</span><span class="op" id="4807482">]</span><span class="op" id="4807483">,</span>&nbsp;<span class="string" id="4807485">&#34;.&#34;</span><span class="op" id="4807488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807491">return</span>&nbsp;<span class="ident" id="4807498">host</span><span class="op" id="4807502">[</span><span class="ident" id="4807503">prevDot</span><span class="op" id="4807510">+</span><span class="num" id="4807511">1</span><span class="op" id="4807512">:</span><span class="op" id="4807513">]</span><br>
<span class="lineno"></span><span class="op" id="4807515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="4807518">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="4807565">func</span>&nbsp;<span class="ident" id="4807570">isIP</span><span class="op" id="4807574">(</span><span class="ident" id="4807575">host</span>&nbsp;<span class="builtintype" id="4807580">string</span><span class="op" id="4807586">)</span>&nbsp;<span class="builtintype" id="4807588">bool</span>&nbsp;<span class="op" id="4807593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807596">return</span>&nbsp;<span class="ident" id="4807603">net</span><span class="op" id="4807606">.</span><span class="ident" id="4807607">ParseIP</span><span class="op" id="4807614">(</span><span class="ident" id="4807615">host</span><span class="op" id="4807619">)</span>&nbsp;<span class="op" id="4807621">!=</span>&nbsp;<span class="ident" id="4807624">nil</span><br>
<span class="lineno"></span><span class="op" id="4807628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4807631">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4807703">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="4807730">func</span>&nbsp;<span class="ident" id="4807735">defaultPath</span><span class="op" id="4807746">(</span><span class="ident" id="4807747">path</span>&nbsp;<span class="builtintype" id="4807752">string</span><span class="op" id="4807758">)</span>&nbsp;<span class="builtintype" id="4807760">string</span>&nbsp;<span class="op" id="4807767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807770">if</span>&nbsp;<span class="builtinfunc" id="4807773">len</span><span class="op" id="4807776">(</span><span class="ident" id="4807777">path</span><span class="op" id="4807781">)</span>&nbsp;<span class="op" id="4807783">==</span>&nbsp;<span class="num" id="4807786">0</span>&nbsp;<span class="op" id="4807788">||</span>&nbsp;<span class="ident" id="4807791">path</span><span class="op" id="4807795">[</span><span class="num" id="4807796">0</span><span class="op" id="4807797">]</span>&nbsp;<span class="op" id="4807799">!=</span>&nbsp;<span class="string" id="4807802">&#39;/&#39;</span>&nbsp;<span class="op" id="4807806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807810">return</span>&nbsp;<span class="string" id="4807817">&#34;/&#34;</span>&nbsp;<span class="comment" id="4807821">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4807857">i</span>&nbsp;<span class="op" id="4807859">:=</span>&nbsp;<span class="ident" id="4807862">strings</span><span class="op" id="4807869">.</span><span class="ident" id="4807870">LastIndex</span><span class="op" id="4807879">(</span><span class="ident" id="4807880">path</span><span class="op" id="4807884">,</span>&nbsp;<span class="string" id="4807886">&#34;/&#34;</span><span class="op" id="4807889">)</span>&nbsp;<span class="comment" id="4807891">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807929">if</span>&nbsp;<span class="ident" id="4807932">i</span>&nbsp;<span class="op" id="4807934">==</span>&nbsp;<span class="num" id="4807937">0</span>&nbsp;<span class="op" id="4807939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807943">return</span>&nbsp;<span class="string" id="4807950">&#34;/&#34;</span>&nbsp;<span class="comment" id="4807954">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4807984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4807987">return</span>&nbsp;<span class="ident" id="4807994">path</span><span class="op" id="4807998">[</span><span class="op" id="4807999">:</span><span class="ident" id="4808000">i</span><span class="op" id="4808001">]</span>&nbsp;<span class="comment" id="4808003">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="4808056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4808059">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="4808138">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4808219">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="4808295">//</span><br>
<span class="lineno"></span><span class="comment" id="4808298">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="4808377">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="4808456">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="4808527">//</span><br>
<span class="lineno"></span><span class="comment" id="4808530">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="4808579">func</span>&nbsp;<span class="op" id="4808584">(</span><span class="ident" id="4808585">j</span>&nbsp;<span class="op" id="4808587">*</span><span class="ident" id="4808588">Jar</span><span class="op" id="4808591">)</span>&nbsp;<span class="ident" id="4808593">newEntry</span><span class="op" id="4808601">(</span><span class="ident" id="4808602">c</span>&nbsp;<span class="op" id="4808604">*</span><span class="ident" id="4808605">http</span><span class="op" id="4808609">.</span><span class="ident" id="4808610">Cookie</span><span class="op" id="4808616">,</span>&nbsp;<span class="ident" id="4808618">now</span>&nbsp;<span class="ident" id="4808622">time</span><span class="op" id="4808626">.</span><span class="ident" id="4808627">Time</span><span class="op" id="4808631">,</span>&nbsp;<span class="ident" id="4808633">defPath</span><span class="op" id="4808640">,</span>&nbsp;<span class="ident" id="4808642">host</span>&nbsp;<span class="builtintype" id="4808647">string</span><span class="op" id="4808653">)</span>&nbsp;<span class="op" id="4808655">(</span><span class="ident" id="4808656">e</span>&nbsp;<span class="ident" id="4808658">entry</span><span class="op" id="4808663">,</span>&nbsp;<span class="ident" id="4808665">remove</span>&nbsp;<span class="builtintype" id="4808672">bool</span><span class="op" id="4808676">,</span>&nbsp;<span class="ident" id="4808678">err</span>&nbsp;<span class="builtintype" id="4808682">error</span><span class="op" id="4808687">)</span>&nbsp;<span class="op" id="4808689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808692">e</span><span class="op" id="4808693">.</span><span class="ident" id="4808694">Name</span>&nbsp;<span class="op" id="4808699">=</span>&nbsp;<span class="ident" id="4808701">c</span><span class="op" id="4808702">.</span><span class="ident" id="4808703">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808710">if</span>&nbsp;<span class="ident" id="4808713">c</span><span class="op" id="4808714">.</span><span class="ident" id="4808715">Path</span>&nbsp;<span class="op" id="4808720">==</span>&nbsp;<span class="string" id="4808723">&#34;&#34;</span>&nbsp;<span class="op" id="4808726">||</span>&nbsp;<span class="ident" id="4808729">c</span><span class="op" id="4808730">.</span><span class="ident" id="4808731">Path</span><span class="op" id="4808735">[</span><span class="num" id="4808736">0</span><span class="op" id="4808737">]</span>&nbsp;<span class="op" id="4808739">!=</span>&nbsp;<span class="string" id="4808742">&#39;/&#39;</span>&nbsp;<span class="op" id="4808746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808750">e</span><span class="op" id="4808751">.</span><span class="ident" id="4808752">Path</span>&nbsp;<span class="op" id="4808757">=</span>&nbsp;<span class="ident" id="4808759">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808768">}</span>&nbsp;<span class="keyword" id="4808770">else</span>&nbsp;<span class="op" id="4808775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808779">e</span><span class="op" id="4808780">.</span><span class="ident" id="4808781">Path</span>&nbsp;<span class="op" id="4808786">=</span>&nbsp;<span class="ident" id="4808788">c</span><span class="op" id="4808789">.</span><span class="ident" id="4808790">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808800">e</span><span class="op" id="4808801">.</span><span class="ident" id="4808802">Domain</span><span class="op" id="4808808">,</span>&nbsp;<span class="ident" id="4808810">e</span><span class="op" id="4808811">.</span><span class="ident" id="4808812">HostOnly</span><span class="op" id="4808820">,</span>&nbsp;<span class="ident" id="4808822">err</span>&nbsp;<span class="op" id="4808826">=</span>&nbsp;<span class="ident" id="4808828">j</span><span class="op" id="4808829">.</span><span class="ident" id="4808830">domainAndType</span><span class="op" id="4808843">(</span><span class="ident" id="4808844">host</span><span class="op" id="4808848">,</span>&nbsp;<span class="ident" id="4808850">c</span><span class="op" id="4808851">.</span><span class="ident" id="4808852">Domain</span><span class="op" id="4808858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808861">if</span>&nbsp;<span class="ident" id="4808864">err</span>&nbsp;<span class="op" id="4808868">!=</span>&nbsp;<span class="ident" id="4808871">nil</span>&nbsp;<span class="op" id="4808875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808879">return</span>&nbsp;<span class="ident" id="4808886">e</span><span class="op" id="4808887">,</span>&nbsp;<span class="ident" id="4808889">false</span><span class="op" id="4808894">,</span>&nbsp;<span class="ident" id="4808896">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808905">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808947">if</span>&nbsp;<span class="ident" id="4808950">c</span><span class="op" id="4808951">.</span><span class="ident" id="4808952">MaxAge</span>&nbsp;<span class="op" id="4808959">&lt;</span>&nbsp;<span class="num" id="4808961">0</span>&nbsp;<span class="op" id="4808963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808967">return</span>&nbsp;<span class="ident" id="4808974">e</span><span class="op" id="4808975">,</span>&nbsp;<span class="ident" id="4808977">true</span><span class="op" id="4808981">,</span>&nbsp;<span class="ident" id="4808983">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808988">}</span>&nbsp;<span class="keyword" id="4808990">else</span>&nbsp;<span class="keyword" id="4808995">if</span>&nbsp;<span class="ident" id="4808998">c</span><span class="op" id="4808999">.</span><span class="ident" id="4809000">MaxAge</span>&nbsp;<span class="op" id="4809007">&gt;</span>&nbsp;<span class="num" id="4809009">0</span>&nbsp;<span class="op" id="4809011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809015">e</span><span class="op" id="4809016">.</span><span class="ident" id="4809017">Expires</span>&nbsp;<span class="op" id="4809025">=</span>&nbsp;<span class="ident" id="4809027">now</span><span class="op" id="4809030">.</span><span class="ident" id="4809031">Add</span><span class="op" id="4809034">(</span><span class="ident" id="4809035">time</span><span class="op" id="4809039">.</span><span class="ident" id="4809040">Duration</span><span class="op" id="4809048">(</span><span class="ident" id="4809049">c</span><span class="op" id="4809050">.</span><span class="ident" id="4809051">MaxAge</span><span class="op" id="4809057">)</span>&nbsp;<span class="op" id="4809059">*</span>&nbsp;<span class="ident" id="4809061">time</span><span class="op" id="4809065">.</span><span class="ident" id="4809066">Second</span><span class="op" id="4809072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809076">e</span><span class="op" id="4809077">.</span><span class="ident" id="4809078">Persistent</span>&nbsp;<span class="op" id="4809089">=</span>&nbsp;<span class="ident" id="4809091">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809097">}</span>&nbsp;<span class="keyword" id="4809099">else</span>&nbsp;<span class="op" id="4809104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809108">if</span>&nbsp;<span class="ident" id="4809111">c</span><span class="op" id="4809112">.</span><span class="ident" id="4809113">Expires</span><span class="op" id="4809120">.</span><span class="ident" id="4809121">IsZero</span><span class="op" id="4809127">(</span><span class="op" id="4809128">)</span>&nbsp;<span class="op" id="4809130">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809135">e</span><span class="op" id="4809136">.</span><span class="ident" id="4809137">Expires</span>&nbsp;<span class="op" id="4809145">=</span>&nbsp;<span class="ident" id="4809147">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809160">e</span><span class="op" id="4809161">.</span><span class="ident" id="4809162">Persistent</span>&nbsp;<span class="op" id="4809173">=</span>&nbsp;<span class="ident" id="4809175">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809183">}</span>&nbsp;<span class="keyword" id="4809185">else</span>&nbsp;<span class="op" id="4809190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809195">if</span>&nbsp;<span class="op" id="4809198">!</span><span class="ident" id="4809199">c</span><span class="op" id="4809200">.</span><span class="ident" id="4809201">Expires</span><span class="op" id="4809208">.</span><span class="ident" id="4809209">After</span><span class="op" id="4809214">(</span><span class="ident" id="4809215">now</span><span class="op" id="4809218">)</span>&nbsp;<span class="op" id="4809220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809226">return</span>&nbsp;<span class="ident" id="4809233">e</span><span class="op" id="4809234">,</span>&nbsp;<span class="ident" id="4809236">true</span><span class="op" id="4809240">,</span>&nbsp;<span class="ident" id="4809242">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809254">e</span><span class="op" id="4809255">.</span><span class="ident" id="4809256">Expires</span>&nbsp;<span class="op" id="4809264">=</span>&nbsp;<span class="ident" id="4809266">c</span><span class="op" id="4809267">.</span><span class="ident" id="4809268">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809279">e</span><span class="op" id="4809280">.</span><span class="ident" id="4809281">Persistent</span>&nbsp;<span class="op" id="4809292">=</span>&nbsp;<span class="ident" id="4809294">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809304">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809308">e</span><span class="op" id="4809309">.</span><span class="ident" id="4809310">Value</span>&nbsp;<span class="op" id="4809316">=</span>&nbsp;<span class="ident" id="4809318">c</span><span class="op" id="4809319">.</span><span class="ident" id="4809320">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809327">e</span><span class="op" id="4809328">.</span><span class="ident" id="4809329">Secure</span>&nbsp;<span class="op" id="4809336">=</span>&nbsp;<span class="ident" id="4809338">c</span><span class="op" id="4809339">.</span><span class="ident" id="4809340">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809348">e</span><span class="op" id="4809349">.</span><span class="ident" id="4809350">HttpOnly</span>&nbsp;<span class="op" id="4809359">=</span>&nbsp;<span class="ident" id="4809361">c</span><span class="op" id="4809362">.</span><span class="ident" id="4809363">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809374">return</span>&nbsp;<span class="ident" id="4809381">e</span><span class="op" id="4809382">,</span>&nbsp;<span class="ident" id="4809384">false</span><span class="op" id="4809389">,</span>&nbsp;<span class="ident" id="4809391">nil</span><br>
<span class="lineno"></span><span class="op" id="4809395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4809398">var</span>&nbsp;<span class="op" id="4809402">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809405">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4809424">=</span>&nbsp;<span class="ident" id="4809426">errors</span><span class="op" id="4809432">.</span><span class="ident" id="4809433">New</span><span class="op" id="4809436">(</span><span class="string" id="4809437">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="4809481">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809484">errMalformedDomain</span>&nbsp;<span class="op" id="4809503">=</span>&nbsp;<span class="ident" id="4809505">errors</span><span class="op" id="4809511">.</span><span class="ident" id="4809512">New</span><span class="op" id="4809515">(</span><span class="string" id="4809516">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="4809562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809565">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809584">=</span>&nbsp;<span class="ident" id="4809586">errors</span><span class="op" id="4809592">.</span><span class="ident" id="4809593">New</span><span class="op" id="4809596">(</span><span class="string" id="4809597">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="4809642">)</span><br>
<span class="lineno"></span><span class="op" id="4809644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4809647">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="4809718">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="4809787">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="4809846">var</span>&nbsp;<span class="ident" id="4809850">endOfTime</span>&nbsp;<span class="op" id="4809860">=</span>&nbsp;<span class="ident" id="4809862">time</span><span class="op" id="4809866">.</span><span class="ident" id="4809867">Date</span><span class="op" id="4809871">(</span><span class="num" id="4809872">9999</span><span class="op" id="4809876">,</span>&nbsp;<span class="num" id="4809878">12</span><span class="op" id="4809880">,</span>&nbsp;<span class="num" id="4809882">31</span><span class="op" id="4809884">,</span>&nbsp;<span class="num" id="4809886">23</span><span class="op" id="4809888">,</span>&nbsp;<span class="num" id="4809890">59</span><span class="op" id="4809892">,</span>&nbsp;<span class="num" id="4809894">59</span><span class="op" id="4809896">,</span>&nbsp;<span class="num" id="4809898">0</span><span class="op" id="4809899">,</span>&nbsp;<span class="ident" id="4809901">time</span><span class="op" id="4809905">.</span><span class="ident" id="4809906">UTC</span><span class="op" id="4809909">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4809912">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="4809984">func</span>&nbsp;<span class="op" id="4809989">(</span><span class="ident" id="4809990">j</span>&nbsp;<span class="op" id="4809992">*</span><span class="ident" id="4809993">Jar</span><span class="op" id="4809996">)</span>&nbsp;<span class="ident" id="4809998">domainAndType</span><span class="op" id="4810011">(</span><span class="ident" id="4810012">host</span><span class="op" id="4810016">,</span>&nbsp;<span class="ident" id="4810018">domain</span>&nbsp;<span class="builtintype" id="4810025">string</span><span class="op" id="4810031">)</span>&nbsp;<span class="op" id="4810033">(</span><span class="builtintype" id="4810034">string</span><span class="op" id="4810040">,</span>&nbsp;<span class="builtintype" id="4810042">bool</span><span class="op" id="4810046">,</span>&nbsp;<span class="builtintype" id="4810048">error</span><span class="op" id="4810053">)</span>&nbsp;<span class="op" id="4810055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810058">if</span>&nbsp;<span class="ident" id="4810061">domain</span>&nbsp;<span class="op" id="4810068">==</span>&nbsp;<span class="string" id="4810071">&#34;&#34;</span>&nbsp;<span class="op" id="4810074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810078">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810139">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810157">return</span>&nbsp;<span class="ident" id="4810164">host</span><span class="op" id="4810168">,</span>&nbsp;<span class="ident" id="4810170">true</span><span class="op" id="4810174">,</span>&nbsp;<span class="ident" id="4810176">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810185">if</span>&nbsp;<span class="ident" id="4810188">isIP</span><span class="op" id="4810192">(</span><span class="ident" id="4810193">host</span><span class="op" id="4810197">)</span>&nbsp;<span class="op" id="4810199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810203">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810265">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810285">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810341">return</span>&nbsp;<span class="string" id="4810348">&#34;&#34;</span><span class="op" id="4810350">,</span>&nbsp;<span class="ident" id="4810352">false</span><span class="op" id="4810357">,</span>&nbsp;<span class="ident" id="4810359">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810378">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810448">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810497">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810529">if</span>&nbsp;<span class="ident" id="4810532">domain</span><span class="op" id="4810538">[</span><span class="num" id="4810539">0</span><span class="op" id="4810540">]</span>&nbsp;<span class="op" id="4810542">==</span>&nbsp;<span class="string" id="4810545">&#39;.&#39;</span>&nbsp;<span class="op" id="4810549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810553">domain</span>&nbsp;<span class="op" id="4810560">=</span>&nbsp;<span class="ident" id="4810562">domain</span><span class="op" id="4810568">[</span><span class="num" id="4810569">1</span><span class="op" id="4810570">:</span><span class="op" id="4810571">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810574">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810578">if</span>&nbsp;<span class="builtinfunc" id="4810581">len</span><span class="op" id="4810584">(</span><span class="ident" id="4810585">domain</span><span class="op" id="4810591">)</span>&nbsp;<span class="op" id="4810593">==</span>&nbsp;<span class="num" id="4810596">0</span>&nbsp;<span class="op" id="4810598">||</span>&nbsp;<span class="ident" id="4810601">domain</span><span class="op" id="4810607">[</span><span class="num" id="4810608">0</span><span class="op" id="4810609">]</span>&nbsp;<span class="op" id="4810611">==</span>&nbsp;<span class="string" id="4810614">&#39;.&#39;</span>&nbsp;<span class="op" id="4810618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810622">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810680">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810703">return</span>&nbsp;<span class="string" id="4810710">&#34;&#34;</span><span class="op" id="4810712">,</span>&nbsp;<span class="ident" id="4810714">false</span><span class="op" id="4810719">,</span>&nbsp;<span class="ident" id="4810721">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810744">domain</span>&nbsp;<span class="op" id="4810751">=</span>&nbsp;<span class="ident" id="4810753">strings</span><span class="op" id="4810760">.</span><span class="ident" id="4810761">ToLower</span><span class="op" id="4810768">(</span><span class="ident" id="4810769">domain</span><span class="op" id="4810775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810779">if</span>&nbsp;<span class="ident" id="4810782">domain</span><span class="op" id="4810788">[</span><span class="builtinfunc" id="4810789">len</span><span class="op" id="4810792">(</span><span class="ident" id="4810793">domain</span><span class="op" id="4810799">)</span><span class="op" id="4810800">-</span><span class="num" id="4810801">1</span><span class="op" id="4810802">]</span>&nbsp;<span class="op" id="4810804">==</span>&nbsp;<span class="string" id="4810807">&#39;.&#39;</span>&nbsp;<span class="op" id="4810811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810815">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810870">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810932">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810995">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811051">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811113">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811131">return</span>&nbsp;<span class="string" id="4811138">&#34;&#34;</span><span class="op" id="4811140">,</span>&nbsp;<span class="ident" id="4811142">false</span><span class="op" id="4811147">,</span>&nbsp;<span class="ident" id="4811149">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811173">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811206">if</span>&nbsp;<span class="ident" id="4811209">j</span><span class="op" id="4811210">.</span><span class="ident" id="4811211">psList</span>&nbsp;<span class="op" id="4811218">!=</span>&nbsp;<span class="ident" id="4811221">nil</span>&nbsp;<span class="op" id="4811225">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811229">if</span>&nbsp;<span class="ident" id="4811232">ps</span>&nbsp;<span class="op" id="4811235">:=</span>&nbsp;<span class="ident" id="4811238">j</span><span class="op" id="4811239">.</span><span class="ident" id="4811240">psList</span><span class="op" id="4811246">.</span><span class="ident" id="4811247">PublicSuffix</span><span class="op" id="4811259">(</span><span class="ident" id="4811260">domain</span><span class="op" id="4811266">)</span><span class="op" id="4811267">;</span>&nbsp;<span class="ident" id="4811269">ps</span>&nbsp;<span class="op" id="4811272">!=</span>&nbsp;<span class="string" id="4811275">&#34;&#34;</span>&nbsp;<span class="op" id="4811278">&amp;&amp;</span>&nbsp;<span class="op" id="4811281">!</span><span class="ident" id="4811282">hasDotSuffix</span><span class="op" id="4811294">(</span><span class="ident" id="4811295">domain</span><span class="op" id="4811301">,</span>&nbsp;<span class="ident" id="4811303">ps</span><span class="op" id="4811305">)</span>&nbsp;<span class="op" id="4811307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811312">if</span>&nbsp;<span class="ident" id="4811315">host</span>&nbsp;<span class="op" id="4811320">==</span>&nbsp;<span class="ident" id="4811323">domain</span>&nbsp;<span class="op" id="4811330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811336">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811387">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811436">return</span>&nbsp;<span class="ident" id="4811443">host</span><span class="op" id="4811447">,</span>&nbsp;<span class="ident" id="4811449">true</span><span class="op" id="4811453">,</span>&nbsp;<span class="ident" id="4811455">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811467">return</span>&nbsp;<span class="string" id="4811474">&#34;&#34;</span><span class="op" id="4811476">,</span>&nbsp;<span class="ident" id="4811478">false</span><span class="op" id="4811483">,</span>&nbsp;<span class="ident" id="4811485">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811511">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811575">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811616">if</span>&nbsp;<span class="ident" id="4811619">host</span>&nbsp;<span class="op" id="4811624">!=</span>&nbsp;<span class="ident" id="4811627">domain</span>&nbsp;<span class="op" id="4811634">&amp;&amp;</span>&nbsp;<span class="op" id="4811637">!</span><span class="ident" id="4811638">hasDotSuffix</span><span class="op" id="4811650">(</span><span class="ident" id="4811651">host</span><span class="op" id="4811655">,</span>&nbsp;<span class="ident" id="4811657">domain</span><span class="op" id="4811663">)</span>&nbsp;<span class="op" id="4811665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811669">return</span>&nbsp;<span class="string" id="4811676">&#34;&#34;</span><span class="op" id="4811678">,</span>&nbsp;<span class="ident" id="4811680">false</span><span class="op" id="4811685">,</span>&nbsp;<span class="ident" id="4811687">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811705">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811709">return</span>&nbsp;<span class="ident" id="4811716">domain</span><span class="op" id="4811722">,</span>&nbsp;<span class="ident" id="4811724">false</span><span class="op" id="4811729">,</span>&nbsp;<span class="ident" id="4811731">nil</span><br>
<span class="lineno"></span><span class="op" id="4811735">}</span>
</div>
</body>
</html>
