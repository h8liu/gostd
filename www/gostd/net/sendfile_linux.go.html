<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html" class="current">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3159088">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3159144">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3159198">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3159249">package</span>&nbsp;<span class="ident" id="3159257">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3159262">import</span>&nbsp;<span class="op" id="3159269">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3159272">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3159278">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3159284">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="3159294">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3159297">//&nbsp;maxSendfileSize&nbsp;is&nbsp;the&nbsp;largest&nbsp;chunk&nbsp;size&nbsp;we&nbsp;ask&nbsp;the&nbsp;kernel&nbsp;to&nbsp;copy</span><br>
<span class="lineno"></span><span class="comment" id="3159368">//&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno">15</span><span class="keyword" id="3159382">const</span>&nbsp;<span class="ident" id="3159388">maxSendfileSize</span>&nbsp;<span class="builtintype" id="3159404">int</span>&nbsp;<span class="op" id="3159408">=</span>&nbsp;<span class="num" id="3159410">4</span>&nbsp;<span class="op" id="3159412">&lt;&lt;</span>&nbsp;<span class="num" id="3159415">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3159419">//&nbsp;sendFile&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;r&nbsp;to&nbsp;c&nbsp;using&nbsp;the&nbsp;sendfile</span><br>
<span class="lineno"></span><span class="comment" id="3159480">//&nbsp;system&nbsp;call&nbsp;to&nbsp;minimize&nbsp;copies.</span><br>
<span class="lineno"></span><span class="comment" id="3159515">//</span><br>
<span class="lineno">20</span><span class="comment" id="3159518">//&nbsp;if&nbsp;handled&nbsp;==&nbsp;true,&nbsp;sendFile&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;and&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="3159593">//&nbsp;non-EOF&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3159611">//</span><br>
<span class="lineno"></span><span class="comment" id="3159614">//&nbsp;if&nbsp;handled&nbsp;==&nbsp;false,&nbsp;sendFile&nbsp;performed&nbsp;no&nbsp;work.</span><br>
<span class="lineno"></span><span class="keyword" id="3159666">func</span>&nbsp;<span class="ident" id="3159671">sendFile</span><span class="op" id="3159679">(</span><span class="ident" id="3159680">c</span>&nbsp;<span class="op" id="3159682">*</span><span class="ident" id="3159683">netFD</span><span class="op" id="3159688">,</span>&nbsp;<span class="ident" id="3159690">r</span>&nbsp;<span class="ident" id="3159692">io</span><span class="op" id="3159694">.</span><span class="ident" id="3159695">Reader</span><span class="op" id="3159701">)</span>&nbsp;<span class="op" id="3159703">(</span><span class="ident" id="3159704">written</span>&nbsp;<span class="ident" id="3159712">int64</span><span class="op" id="3159717">,</span>&nbsp;<span class="ident" id="3159719">err</span>&nbsp;<span class="builtintype" id="3159723">error</span><span class="op" id="3159728">,</span>&nbsp;<span class="ident" id="3159730">handled</span>&nbsp;<span class="builtintype" id="3159738">bool</span><span class="op" id="3159742">)</span>&nbsp;<span class="op" id="3159744">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159747">var</span>&nbsp;<span class="ident" id="3159751">remain</span>&nbsp;<span class="ident" id="3159758">int64</span>&nbsp;<span class="op" id="3159764">=</span>&nbsp;<span class="num" id="3159766">1</span>&nbsp;<span class="op" id="3159768">&lt;&lt;</span>&nbsp;<span class="num" id="3159771">62</span>&nbsp;<span class="comment" id="3159774">//&nbsp;by&nbsp;default,&nbsp;copy&nbsp;until&nbsp;EOF</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159806">lr</span><span class="op" id="3159808">,</span>&nbsp;<span class="ident" id="3159810">ok</span>&nbsp;<span class="op" id="3159813">:=</span>&nbsp;<span class="ident" id="3159816">r</span><span class="op" id="3159817">.</span><span class="op" id="3159818">(</span><span class="op" id="3159819">*</span><span class="ident" id="3159820">io</span><span class="op" id="3159822">.</span><span class="ident" id="3159823">LimitedReader</span><span class="op" id="3159836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159839">if</span>&nbsp;<span class="ident" id="3159842">ok</span>&nbsp;<span class="op" id="3159845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159849">remain</span><span class="op" id="3159855">,</span>&nbsp;<span class="ident" id="3159857">r</span>&nbsp;<span class="op" id="3159859">=</span>&nbsp;<span class="ident" id="3159861">lr</span><span class="op" id="3159863">.</span><span class="ident" id="3159864">N</span><span class="op" id="3159865">,</span>&nbsp;<span class="ident" id="3159867">lr</span><span class="op" id="3159869">.</span><span class="ident" id="3159870">R</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159874">if</span>&nbsp;<span class="ident" id="3159877">remain</span>&nbsp;<span class="op" id="3159884">&lt;=</span>&nbsp;<span class="num" id="3159887">0</span>&nbsp;<span class="op" id="3159889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159894">return</span>&nbsp;<span class="num" id="3159901">0</span><span class="op" id="3159902">,</span>&nbsp;<span class="ident" id="3159904">nil</span><span class="op" id="3159907">,</span>&nbsp;<span class="builtintype" id="3159909">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3159916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3159919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159922">f</span><span class="op" id="3159923">,</span>&nbsp;<span class="ident" id="3159925">ok</span>&nbsp;<span class="op" id="3159928">:=</span>&nbsp;<span class="ident" id="3159931">r</span><span class="op" id="3159932">.</span><span class="op" id="3159933">(</span><span class="op" id="3159934">*</span><span class="ident" id="3159935">os</span><span class="op" id="3159937">.</span><span class="ident" id="3159938">File</span><span class="op" id="3159942">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159945">if</span>&nbsp;<span class="op" id="3159948">!</span><span class="ident" id="3159949">ok</span>&nbsp;<span class="op" id="3159952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159956">return</span>&nbsp;<span class="num" id="3159963">0</span><span class="op" id="3159964">,</span>&nbsp;<span class="ident" id="3159966">nil</span><span class="op" id="3159969">,</span>&nbsp;<span class="builtintype" id="3159971">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3159978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159982">if</span>&nbsp;<span class="ident" id="3159985">err</span>&nbsp;<span class="op" id="3159989">:=</span>&nbsp;<span class="ident" id="3159992">c</span><span class="op" id="3159993">.</span><span class="ident" id="3159994">writeLock</span><span class="op" id="3160003">(</span><span class="op" id="3160004">)</span><span class="op" id="3160005">;</span>&nbsp;<span class="ident" id="3160007">err</span>&nbsp;<span class="op" id="3160011">!=</span>&nbsp;<span class="ident" id="3160014">nil</span>&nbsp;<span class="op" id="3160018">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160022">return</span>&nbsp;<span class="num" id="3160029">0</span><span class="op" id="3160030">,</span>&nbsp;<span class="ident" id="3160032">err</span><span class="op" id="3160035">,</span>&nbsp;<span class="builtintype" id="3160037">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160046">defer</span>&nbsp;<span class="ident" id="3160052">c</span><span class="op" id="3160053">.</span><span class="ident" id="3160054">writeUnlock</span><span class="op" id="3160065">(</span><span class="op" id="3160066">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160070">dst</span>&nbsp;<span class="op" id="3160074">:=</span>&nbsp;<span class="ident" id="3160077">c</span><span class="op" id="3160078">.</span><span class="ident" id="3160079">sysfd</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160086">src</span>&nbsp;<span class="op" id="3160090">:=</span>&nbsp;<span class="builtintype" id="3160093">int</span><span class="op" id="3160096">(</span><span class="ident" id="3160097">f</span><span class="op" id="3160098">.</span><span class="ident" id="3160099">Fd</span><span class="op" id="3160101">(</span><span class="op" id="3160102">)</span><span class="op" id="3160103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160106">for</span>&nbsp;<span class="ident" id="3160110">remain</span>&nbsp;<span class="op" id="3160117">&gt;</span>&nbsp;<span class="num" id="3160119">0</span>&nbsp;<span class="op" id="3160121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160125">n</span>&nbsp;<span class="op" id="3160127">:=</span>&nbsp;<span class="ident" id="3160130">maxSendfileSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160148">if</span>&nbsp;<span class="ident" id="3160151">int64</span><span class="op" id="3160156">(</span><span class="ident" id="3160157">n</span><span class="op" id="3160158">)</span>&nbsp;<span class="op" id="3160160">&gt;</span>&nbsp;<span class="ident" id="3160162">remain</span>&nbsp;<span class="op" id="3160169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160174">n</span>&nbsp;<span class="op" id="3160176">=</span>&nbsp;<span class="builtintype" id="3160178">int</span><span class="op" id="3160181">(</span><span class="ident" id="3160182">remain</span><span class="op" id="3160188">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160196">n</span><span class="op" id="3160197">,</span>&nbsp;<span class="ident" id="3160199">err1</span>&nbsp;<span class="op" id="3160204">:=</span>&nbsp;<span class="ident" id="3160207">syscall</span><span class="op" id="3160214">.</span><span class="ident" id="3160215">Sendfile</span><span class="op" id="3160223">(</span><span class="ident" id="3160224">dst</span><span class="op" id="3160227">,</span>&nbsp;<span class="ident" id="3160229">src</span><span class="op" id="3160232">,</span>&nbsp;<span class="ident" id="3160234">nil</span><span class="op" id="3160237">,</span>&nbsp;<span class="ident" id="3160239">n</span><span class="op" id="3160240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160244">if</span>&nbsp;<span class="ident" id="3160247">n</span>&nbsp;<span class="op" id="3160249">&gt;</span>&nbsp;<span class="num" id="3160251">0</span>&nbsp;<span class="op" id="3160253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160258">written</span>&nbsp;<span class="op" id="3160266">+=</span>&nbsp;<span class="ident" id="3160269">int64</span><span class="op" id="3160274">(</span><span class="ident" id="3160275">n</span><span class="op" id="3160276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160281">remain</span>&nbsp;<span class="op" id="3160288">-=</span>&nbsp;<span class="ident" id="3160291">int64</span><span class="op" id="3160296">(</span><span class="ident" id="3160297">n</span><span class="op" id="3160298">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160306">if</span>&nbsp;<span class="ident" id="3160309">n</span>&nbsp;<span class="op" id="3160311">==</span>&nbsp;<span class="num" id="3160314">0</span>&nbsp;<span class="op" id="3160316">&amp;&amp;</span>&nbsp;<span class="ident" id="3160319">err1</span>&nbsp;<span class="op" id="3160324">==</span>&nbsp;<span class="ident" id="3160327">nil</span>&nbsp;<span class="op" id="3160331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160336">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160348">if</span>&nbsp;<span class="ident" id="3160351">err1</span>&nbsp;<span class="op" id="3160356">==</span>&nbsp;<span class="ident" id="3160359">syscall</span><span class="op" id="3160366">.</span><span class="ident" id="3160367">EAGAIN</span>&nbsp;<span class="op" id="3160374">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160379">if</span>&nbsp;<span class="ident" id="3160382">err1</span>&nbsp;<span class="op" id="3160387">=</span>&nbsp;<span class="ident" id="3160389">c</span><span class="op" id="3160390">.</span><span class="ident" id="3160391">pd</span><span class="op" id="3160393">.</span><span class="ident" id="3160394">WaitWrite</span><span class="op" id="3160403">(</span><span class="op" id="3160404">)</span><span class="op" id="3160405">;</span>&nbsp;<span class="ident" id="3160407">err1</span>&nbsp;<span class="op" id="3160412">==</span>&nbsp;<span class="ident" id="3160415">nil</span>&nbsp;<span class="op" id="3160419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160425">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160445">if</span>&nbsp;<span class="ident" id="3160448">err1</span>&nbsp;<span class="op" id="3160453">!=</span>&nbsp;<span class="ident" id="3160456">nil</span>&nbsp;<span class="op" id="3160460">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3160465">//&nbsp;This&nbsp;includes&nbsp;syscall.ENOSYS&nbsp;(no&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3160511">//&nbsp;support)&nbsp;and&nbsp;syscall.EINVAL&nbsp;(fd&nbsp;types&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3160561">//&nbsp;don&#39;t&nbsp;implement&nbsp;sendfile&nbsp;together)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160602">err</span>&nbsp;<span class="op" id="3160606">=</span>&nbsp;<span class="op" id="3160608">&amp;</span><span class="ident" id="3160609">OpError</span><span class="op" id="3160616">{</span><span class="string" id="3160617">&#34;sendfile&#34;</span><span class="op" id="3160627">,</span>&nbsp;<span class="ident" id="3160629">c</span><span class="op" id="3160630">.</span><span class="ident" id="3160631">net</span><span class="op" id="3160634">,</span>&nbsp;<span class="ident" id="3160636">c</span><span class="op" id="3160637">.</span><span class="ident" id="3160638">raddr</span><span class="op" id="3160643">,</span>&nbsp;<span class="ident" id="3160645">err1</span><span class="op" id="3160649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160654">break</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160668">if</span>&nbsp;<span class="ident" id="3160671">lr</span>&nbsp;<span class="op" id="3160674">!=</span>&nbsp;<span class="ident" id="3160677">nil</span>&nbsp;<span class="op" id="3160681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160685">lr</span><span class="op" id="3160687">.</span><span class="ident" id="3160688">N</span>&nbsp;<span class="op" id="3160690">=</span>&nbsp;<span class="ident" id="3160692">remain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160700">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160703">return</span>&nbsp;<span class="ident" id="3160710">written</span><span class="op" id="3160717">,</span>&nbsp;<span class="ident" id="3160719">err</span><span class="op" id="3160722">,</span>&nbsp;<span class="ident" id="3160724">written</span>&nbsp;<span class="op" id="3160732">&gt;</span>&nbsp;<span class="num" id="3160734">0</span><br>
<span class="lineno"></span><span class="op" id="3160736">}</span>
</div>
</body>
</html>
