<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html" class="current">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3862261">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3862316">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3862370">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3862421">package</span>&nbsp;<span class="ident" id="3862429">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3862434">import</span>&nbsp;<span class="op" id="3862441">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862444">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862462">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862472">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862487">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862502">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862509">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862515">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862527">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862538">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862546">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3862553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3862556">const</span>&nbsp;<span class="op" id="3862562">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862565">VersionSSL30</span>&nbsp;<span class="op" id="3862578">=</span>&nbsp;<span class="num" id="3862580">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862588">VersionTLS10</span>&nbsp;<span class="op" id="3862601">=</span>&nbsp;<span class="num" id="3862603">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862611">VersionTLS11</span>&nbsp;<span class="op" id="3862624">=</span>&nbsp;<span class="num" id="3862626">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862634">VersionTLS12</span>&nbsp;<span class="op" id="3862647">=</span>&nbsp;<span class="num" id="3862649">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="3862656">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3862659">const</span>&nbsp;<span class="op" id="3862665">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862668">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3862684">=</span>&nbsp;<span class="num" id="3862686">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3862699">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862736">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3862752">=</span>&nbsp;<span class="num" id="3862754">16384</span>&nbsp;<span class="op" id="3862760">+</span>&nbsp;<span class="num" id="3862762">2048</span>&nbsp;<span class="comment" id="3862767">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862805">recordHeaderLen</span>&nbsp;<span class="op" id="3862821">=</span>&nbsp;<span class="num" id="3862823">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3862836">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862861">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3862877">=</span>&nbsp;<span class="num" id="3862879">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3862892">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862950">minVersion</span>&nbsp;<span class="op" id="3862961">=</span>&nbsp;<span class="ident" id="3862963">VersionSSL30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862977">maxVersion</span>&nbsp;<span class="op" id="3862988">=</span>&nbsp;<span class="ident" id="3862990">VersionTLS12</span><br>
<span class="lineno">35</span><span class="op" id="3863003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3863006">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3863027">type</span>&nbsp;<span class="ident" id="3863032">recordType</span>&nbsp;<span class="builtintype" id="3863043">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3863050">const</span>&nbsp;<span class="op" id="3863056">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863059">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="3863086">recordType</span>&nbsp;<span class="op" id="3863097">=</span>&nbsp;<span class="num" id="3863099">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863103">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863130">recordType</span>&nbsp;<span class="op" id="3863141">=</span>&nbsp;<span class="num" id="3863143">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863147">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863174">recordType</span>&nbsp;<span class="op" id="3863185">=</span>&nbsp;<span class="num" id="3863187">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863191">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="3863218">recordType</span>&nbsp;<span class="op" id="3863229">=</span>&nbsp;<span class="num" id="3863231">23</span><br>
<span class="lineno">45</span><span class="op" id="3863234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3863237">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3863269">const</span>&nbsp;<span class="op" id="3863275">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863278">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3863301">uint8</span>&nbsp;<span class="op" id="3863307">=</span>&nbsp;<span class="num" id="3863309">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863312">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3863335">uint8</span>&nbsp;<span class="op" id="3863341">=</span>&nbsp;<span class="num" id="3863343">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863346">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3863369">uint8</span>&nbsp;<span class="op" id="3863375">=</span>&nbsp;<span class="num" id="3863377">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863380">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3863403">uint8</span>&nbsp;<span class="op" id="3863409">=</span>&nbsp;<span class="num" id="3863411">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863415">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="3863438">uint8</span>&nbsp;<span class="op" id="3863444">=</span>&nbsp;<span class="num" id="3863446">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863450">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="3863473">uint8</span>&nbsp;<span class="op" id="3863479">=</span>&nbsp;<span class="num" id="3863481">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863485">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3863508">uint8</span>&nbsp;<span class="op" id="3863514">=</span>&nbsp;<span class="num" id="3863516">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863520">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="3863543">uint8</span>&nbsp;<span class="op" id="3863549">=</span>&nbsp;<span class="num" id="3863551">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863555">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="3863578">uint8</span>&nbsp;<span class="op" id="3863584">=</span>&nbsp;<span class="num" id="3863586">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863590">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3863613">uint8</span>&nbsp;<span class="op" id="3863619">=</span>&nbsp;<span class="num" id="3863621">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863625">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="3863648">uint8</span>&nbsp;<span class="op" id="3863654">=</span>&nbsp;<span class="num" id="3863656">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863660">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3863683">uint8</span>&nbsp;<span class="op" id="3863689">=</span>&nbsp;<span class="num" id="3863691">67</span>&nbsp;<span class="comment" id="3863694">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="3863715">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3863718">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3863744">const</span>&nbsp;<span class="op" id="3863750">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863753">compressionNone</span>&nbsp;<span class="builtintype" id="3863769">uint8</span>&nbsp;<span class="op" id="3863775">=</span>&nbsp;<span class="num" id="3863777">0</span><br>
<span class="lineno"></span><span class="op" id="3863779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3863782">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="3863807">const</span>&nbsp;<span class="op" id="3863813">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863816">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3863845">uint16</span>&nbsp;<span class="op" id="3863852">=</span>&nbsp;<span class="num" id="3863854">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863857">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3863886">uint16</span>&nbsp;<span class="op" id="3863893">=</span>&nbsp;<span class="num" id="3863895">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863898">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3863927">uint16</span>&nbsp;<span class="op" id="3863934">=</span>&nbsp;<span class="num" id="3863936">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863940">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3863969">uint16</span>&nbsp;<span class="op" id="3863976">=</span>&nbsp;<span class="num" id="3863978">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863982">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="3864011">uint16</span>&nbsp;<span class="op" id="3864018">=</span>&nbsp;<span class="num" id="3864020">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864024">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3864053">uint16</span>&nbsp;<span class="op" id="3864060">=</span>&nbsp;<span class="num" id="3864062">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864066">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3864095">uint16</span>&nbsp;<span class="op" id="3864102">=</span>&nbsp;<span class="num" id="3864104">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864108">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3864137">uint16</span>&nbsp;<span class="op" id="3864144">=</span>&nbsp;<span class="num" id="3864146">13172</span>&nbsp;<span class="comment" id="3864152">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864174">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3864203">uint16</span>&nbsp;<span class="op" id="3864210">=</span>&nbsp;<span class="num" id="3864212">0xff01</span><br>
<span class="lineno"></span><span class="op" id="3864219">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="3864222">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="3864259">const</span>&nbsp;<span class="op" id="3864265">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864268">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="3864286">uint16</span>&nbsp;<span class="op" id="3864293">=</span>&nbsp;<span class="num" id="3864295">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="3864302">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3864305">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="3864375">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="3864461">type</span>&nbsp;<span class="ident" id="3864466">CurveID</span>&nbsp;<span class="builtintype" id="3864474">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3864482">const</span>&nbsp;<span class="op" id="3864488">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864491">CurveP256</span>&nbsp;<span class="ident" id="3864501">CurveID</span>&nbsp;<span class="op" id="3864509">=</span>&nbsp;<span class="num" id="3864511">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864515">CurveP384</span>&nbsp;<span class="ident" id="3864525">CurveID</span>&nbsp;<span class="op" id="3864533">=</span>&nbsp;<span class="num" id="3864535">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864539">CurveP521</span>&nbsp;<span class="ident" id="3864549">CurveID</span>&nbsp;<span class="op" id="3864557">=</span>&nbsp;<span class="num" id="3864559">25</span><br>
<span class="lineno"></span><span class="op" id="3864562">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="3864565">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="3864601">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="3864687">const</span>&nbsp;<span class="op" id="3864693">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864696">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="3864720">uint8</span>&nbsp;<span class="op" id="3864726">=</span>&nbsp;<span class="num" id="3864728">0</span><br>
<span class="lineno">100</span><span class="op" id="3864730">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3864733">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="3864773">const</span>&nbsp;<span class="op" id="3864779">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864782">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="3864797">uint8</span>&nbsp;<span class="op" id="3864803">=</span>&nbsp;<span class="num" id="3864805">1</span><br>
<span class="lineno">105</span><span class="op" id="3864807">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3864810">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="3864859">const</span>&nbsp;<span class="op" id="3864865">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864868">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864887">=</span>&nbsp;<span class="num" id="3864889">1</span>&nbsp;<span class="comment" id="3864891">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864931">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864950">=</span>&nbsp;<span class="num" id="3864952">2</span>&nbsp;<span class="comment" id="3864954">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864993">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="3865012">=</span>&nbsp;<span class="num" id="3865014">3</span>&nbsp;<span class="comment" id="3865016">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865061">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="3865080">=</span>&nbsp;<span class="num" id="3865082">4</span>&nbsp;<span class="comment" id="3865084">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3865130">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865166">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3865189">=</span>&nbsp;<span class="num" id="3865191">64</span>&nbsp;<span class="comment" id="3865194">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865271">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3865294">=</span>&nbsp;<span class="num" id="3865296">65</span>&nbsp;<span class="comment" id="3865299">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865373">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="3865396">=</span>&nbsp;<span class="num" id="3865398">66</span>&nbsp;<span class="comment" id="3865401">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3865478">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="3865524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3865527">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="3865587">const</span>&nbsp;<span class="op" id="3865593">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865596">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3865607">uint8</span>&nbsp;<span class="op" id="3865613">=</span>&nbsp;<span class="num" id="3865615">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865618">hashSHA256</span>&nbsp;<span class="builtintype" id="3865629">uint8</span>&nbsp;<span class="op" id="3865635">=</span>&nbsp;<span class="num" id="3865637">4</span><br>
<span class="lineno"></span><span class="op" id="3865639">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3865642">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="3865708">const</span>&nbsp;<span class="op" id="3865714">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865717">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3865732">uint8</span>&nbsp;<span class="op" id="3865738">=</span>&nbsp;<span class="num" id="3865740">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865743">signatureECDSA</span>&nbsp;<span class="builtintype" id="3865758">uint8</span>&nbsp;<span class="op" id="3865764">=</span>&nbsp;<span class="num" id="3865766">3</span><br>
<span class="lineno"></span><span class="op" id="3865768">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3865771">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="3865850">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="3865878">type</span>&nbsp;<span class="ident" id="3865883">signatureAndHash</span>&nbsp;<span class="keyword" id="3865900">struct</span>&nbsp;<span class="op" id="3865907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865910">hash</span><span class="op" id="3865914">,</span>&nbsp;<span class="ident" id="3865916">signature</span>&nbsp;<span class="builtintype" id="3865926">uint8</span><br>
<span class="lineno"></span><span class="op" id="3865932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3865935">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="3866013">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="3866080">var</span>&nbsp;<span class="ident" id="3866084">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="3866116">=</span>&nbsp;<span class="op" id="3866118">[</span><span class="op" id="3866119">]</span><span class="ident" id="3866120">signatureAndHash</span><span class="op" id="3866136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866139">{</span><span class="ident" id="3866140">hashSHA256</span><span class="op" id="3866150">,</span>&nbsp;<span class="ident" id="3866152">signatureRSA</span><span class="op" id="3866164">}</span><span class="op" id="3866165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866168">{</span><span class="ident" id="3866169">hashSHA256</span><span class="op" id="3866179">,</span>&nbsp;<span class="ident" id="3866181">signatureECDSA</span><span class="op" id="3866195">}</span><span class="op" id="3866196">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866199">{</span><span class="ident" id="3866200">hashSHA1</span><span class="op" id="3866208">,</span>&nbsp;<span class="ident" id="3866210">signatureRSA</span><span class="op" id="3866222">}</span><span class="op" id="3866223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866226">{</span><span class="ident" id="3866227">hashSHA1</span><span class="op" id="3866235">,</span>&nbsp;<span class="ident" id="3866237">signatureECDSA</span><span class="op" id="3866251">}</span><span class="op" id="3866252">,</span><br>
<span class="lineno"></span><span class="op" id="3866254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3866257">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="3866331">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="3866396">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="3866419">var</span>&nbsp;<span class="ident" id="3866423">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="3866462">=</span>&nbsp;<span class="op" id="3866464">[</span><span class="op" id="3866465">]</span><span class="ident" id="3866466">signatureAndHash</span><span class="op" id="3866482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866485">{</span><span class="ident" id="3866486">hashSHA256</span><span class="op" id="3866496">,</span>&nbsp;<span class="ident" id="3866498">signatureRSA</span><span class="op" id="3866510">}</span><span class="op" id="3866511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866514">{</span><span class="ident" id="3866515">hashSHA256</span><span class="op" id="3866525">,</span>&nbsp;<span class="ident" id="3866527">signatureECDSA</span><span class="op" id="3866541">}</span><span class="op" id="3866542">,</span><br>
<span class="lineno">155</span><span class="op" id="3866544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3866547">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3866614">type</span>&nbsp;<span class="ident" id="3866619">ConnectionState</span>&nbsp;<span class="keyword" id="3866635">struct</span>&nbsp;<span class="op" id="3866642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866645">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3866672">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3866694">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866753">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3866780">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3866802">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866832">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3866859">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3866881">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866930">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3866957">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3866979">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3867035">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3867062">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3867084">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3867138">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="3867165">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3867187">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3867236">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3867263">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3867285">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3867348">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3867375">[</span><span class="op" id="3867376">]</span><span class="op" id="3867377">*</span><span class="ident" id="3867378">x509</span><span class="op" id="3867382">.</span><span class="ident" id="3867383">Certificate</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3867397">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3867444">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3867471">[</span><span class="op" id="3867472">]</span><span class="op" id="3867473">[</span><span class="op" id="3867474">]</span><span class="op" id="3867475">*</span><span class="ident" id="3867476">x509</span><span class="op" id="3867480">.</span><span class="ident" id="3867481">Certificate</span>&nbsp;<span class="comment" id="3867493">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3867542">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3867613">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3867679">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3867739">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3867812">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3867878">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3867912">TLSUnique</span>&nbsp;<span class="op" id="3867922">[</span><span class="op" id="3867923">]</span><span class="builtintype" id="3867924">byte</span><br>
<span class="lineno"></span><span class="op" id="3867929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3867932">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3867997">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="3868027">type</span>&nbsp;<span class="ident" id="3868032">ClientAuthType</span>&nbsp;<span class="builtintype" id="3868047">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3868052">const</span>&nbsp;<span class="op" id="3868058">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3868061">NoClientCert</span>&nbsp;<span class="ident" id="3868074">ClientAuthType</span>&nbsp;<span class="op" id="3868089">=</span>&nbsp;<span class="ident" id="3868091">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3868097">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3868116">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3868138">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3868163">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="3868190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3868193">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="3868266">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="3868279">type</span>&nbsp;<span class="ident" id="3868284">ClientSessionState</span>&nbsp;<span class="keyword" id="3868303">struct</span>&nbsp;<span class="op" id="3868310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3868313">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3868332">[</span><span class="op" id="3868333">]</span><span class="builtintype" id="3868334">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3868352">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3868413">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3868432">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3868452">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3868499">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3868518">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3868538">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3868581">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3868600">[</span><span class="op" id="3868601">]</span><span class="builtintype" id="3868602">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3868620">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3868677">serverCertificates</span>&nbsp;<span class="op" id="3868696">[</span><span class="op" id="3868697">]</span><span class="op" id="3868698">*</span><span class="ident" id="3868699">x509</span><span class="op" id="3868703">.</span><span class="ident" id="3868704">Certificate</span>&nbsp;<span class="comment" id="3868716">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="3868761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3868764">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3868844">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="3868923">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3868997">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3869012">type</span>&nbsp;<span class="ident" id="3869017">ClientSessionCache</span>&nbsp;<span class="keyword" id="3869036">interface</span>&nbsp;<span class="op" id="3869046">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869049">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869122">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3869166">Get</span><span class="op" id="3869169">(</span><span class="ident" id="3869170">sessionKey</span>&nbsp;<span class="builtintype" id="3869181">string</span><span class="op" id="3869187">)</span>&nbsp;<span class="op" id="3869189">(</span><span class="ident" id="3869190">session</span>&nbsp;<span class="op" id="3869198">*</span><span class="ident" id="3869199">ClientSessionState</span><span class="op" id="3869217">,</span>&nbsp;<span class="ident" id="3869219">ok</span>&nbsp;<span class="builtintype" id="3869222">bool</span><span class="op" id="3869226">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869230">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3869299">Put</span><span class="op" id="3869302">(</span><span class="ident" id="3869303">sessionKey</span>&nbsp;<span class="builtintype" id="3869314">string</span><span class="op" id="3869320">,</span>&nbsp;<span class="ident" id="3869322">cs</span>&nbsp;<span class="op" id="3869325">*</span><span class="ident" id="3869326">ClientSessionState</span><span class="op" id="3869344">)</span><br>
<span class="lineno"></span><span class="op" id="3869346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3869349">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3869428">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="3869491">type</span>&nbsp;<span class="ident" id="3869496">ClientHelloInfo</span>&nbsp;<span class="keyword" id="3869512">struct</span>&nbsp;<span class="op" id="3869519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869522">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869592">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3869623">CipherSuites</span>&nbsp;<span class="op" id="3869636">[</span><span class="op" id="3869637">]</span><span class="builtintype" id="3869638">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869647">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869719">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869790">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869819">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3869872">ServerName</span>&nbsp;<span class="builtintype" id="3869883">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869892">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3869963">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870028">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870061">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3870116">SupportedCurves</span>&nbsp;<span class="op" id="3870132">[</span><span class="op" id="3870133">]</span><span class="ident" id="3870134">CurveID</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870144">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870213">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870286">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870309">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3870364">SupportedPoints</span>&nbsp;<span class="op" id="3870380">[</span><span class="op" id="3870381">]</span><span class="builtintype" id="3870382">uint8</span><br>
<span class="lineno"></span><span class="op" id="3870388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3870391">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="3870458">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3870520">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3870587">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3870601">type</span>&nbsp;<span class="ident" id="3870606">Config</span>&nbsp;<span class="keyword" id="3870613">struct</span>&nbsp;<span class="op" id="3870620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870623">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870692">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870764">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870781">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3870841">Rand</span>&nbsp;<span class="ident" id="3870846">io</span><span class="op" id="3870848">.</span><span class="ident" id="3870849">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870858">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870934">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3870973">Time</span>&nbsp;<span class="keyword" id="3870978">func</span><span class="op" id="3870982">(</span><span class="op" id="3870983">)</span>&nbsp;<span class="ident" id="3870985">time</span><span class="op" id="3870989">.</span><span class="ident" id="3870990">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3870997">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871054">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871106">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3871171">Certificates</span>&nbsp;<span class="op" id="3871184">[</span><span class="op" id="3871185">]</span><span class="ident" id="3871186">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871200">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871268">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871334">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871403">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871441">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871511">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3871536">NameToCertificate</span>&nbsp;<span class="keyword" id="3871554">map</span><span class="op" id="3871557">[</span><span class="builtintype" id="3871558">string</span><span class="op" id="3871564">]</span><span class="op" id="3871565">*</span><span class="ident" id="3871566">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871580">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871640">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871711">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871767">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871839">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3871849">GetCertificate</span>&nbsp;<span class="keyword" id="3871864">func</span><span class="op" id="3871868">(</span><span class="ident" id="3871869">clientHello</span>&nbsp;<span class="op" id="3871881">*</span><span class="ident" id="3871882">ClientHelloInfo</span><span class="op" id="3871897">)</span>&nbsp;<span class="op" id="3871899">(</span><span class="op" id="3871900">*</span><span class="ident" id="3871901">Certificate</span><span class="op" id="3871912">,</span>&nbsp;<span class="builtintype" id="3871914">error</span><span class="op" id="3871919">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871923">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3871983">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872040">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3872096">RootCAs</span>&nbsp;<span class="op" id="3872104">*</span><span class="ident" id="3872105">x509</span><span class="op" id="3872109">.</span><span class="ident" id="3872110">CertPool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872121">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3872189">NextProtos</span>&nbsp;<span class="op" id="3872200">[</span><span class="op" id="3872201">]</span><span class="builtintype" id="3872202">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872211">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872273">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872346">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3872404">ServerName</span>&nbsp;<span class="builtintype" id="3872415">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872424">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872474">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3872534">ClientAuth</span>&nbsp;<span class="ident" id="3872545">ClientAuthType</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872562">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872624">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872688">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3872721">ClientCAs</span>&nbsp;<span class="op" id="3872731">*</span><span class="ident" id="3872732">x509</span><span class="op" id="3872736">.</span><span class="ident" id="3872737">CertPool</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872748">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872810">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872856">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872919">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3872986">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873053">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3873095">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="3873114">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873121">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873192">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3873263">CipherSuites</span>&nbsp;<span class="op" id="3873276">[</span><span class="op" id="3873277">]</span><span class="builtintype" id="3873278">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873287">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873356">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873428">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873499">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3873551">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="3873576">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873583">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873655">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3873681">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="3873704">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873711">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873774">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873836">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873887">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873891">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3873961">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874020">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874083">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3874131">SessionTicketKey</span>&nbsp;<span class="op" id="3874148">[</span><span class="num" id="3874149">32</span><span class="op" id="3874151">]</span><span class="builtintype" id="3874152">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874159">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874233">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3874249">ClientSessionCache</span>&nbsp;<span class="ident" id="3874268">ClientSessionCache</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874289">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874361">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3874410">MinVersion</span>&nbsp;<span class="builtintype" id="3874421">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874430">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874502">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874575">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3874607">MaxVersion</span>&nbsp;<span class="builtintype" id="3874618">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874627">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874698">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874770">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3874783">CurvePreferences</span>&nbsp;<span class="op" id="3874800">[</span><span class="op" id="3874801">]</span><span class="ident" id="3874802">CurveID</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3874812">serverInitOnce</span>&nbsp;<span class="ident" id="3874827">sync</span><span class="op" id="3874831">.</span><span class="ident" id="3874832">Once</span>&nbsp;<span class="comment" id="3874837">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="3874876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3874879">func</span>&nbsp;<span class="op" id="3874884">(</span><span class="ident" id="3874885">c</span>&nbsp;<span class="op" id="3874887">*</span><span class="ident" id="3874888">Config</span><span class="op" id="3874894">)</span>&nbsp;<span class="ident" id="3874896">serverInit</span><span class="op" id="3874906">(</span><span class="op" id="3874907">)</span>&nbsp;<span class="op" id="3874909">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874912">if</span>&nbsp;<span class="ident" id="3874915">c</span><span class="op" id="3874916">.</span><span class="ident" id="3874917">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3874940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874944">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3874952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3874956">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875020">for</span>&nbsp;<span class="ident" id="3875024">_</span><span class="op" id="3875025">,</span>&nbsp;<span class="ident" id="3875027">b</span>&nbsp;<span class="op" id="3875029">:=</span>&nbsp;<span class="keyword" id="3875032">range</span>&nbsp;<span class="ident" id="3875038">c</span><span class="op" id="3875039">.</span><span class="ident" id="3875040">SessionTicketKey</span>&nbsp;<span class="op" id="3875057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875061">if</span>&nbsp;<span class="ident" id="3875064">b</span>&nbsp;<span class="op" id="3875066">!=</span>&nbsp;<span class="num" id="3875069">0</span>&nbsp;<span class="op" id="3875071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875076">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875088">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875092">if</span>&nbsp;<span class="ident" id="3875095">_</span><span class="op" id="3875096">,</span>&nbsp;<span class="ident" id="3875098">err</span>&nbsp;<span class="op" id="3875102">:=</span>&nbsp;<span class="ident" id="3875105">io</span><span class="op" id="3875107">.</span><span class="ident" id="3875108">ReadFull</span><span class="op" id="3875116">(</span><span class="ident" id="3875117">c</span><span class="op" id="3875118">.</span><span class="ident" id="3875119">rand</span><span class="op" id="3875123">(</span><span class="op" id="3875124">)</span><span class="op" id="3875125">,</span>&nbsp;<span class="ident" id="3875127">c</span><span class="op" id="3875128">.</span><span class="ident" id="3875129">SessionTicketKey</span><span class="op" id="3875145">[</span><span class="op" id="3875146">:</span><span class="op" id="3875147">]</span><span class="op" id="3875148">)</span><span class="op" id="3875149">;</span>&nbsp;<span class="ident" id="3875151">err</span>&nbsp;<span class="op" id="3875155">!=</span>&nbsp;<span class="ident" id="3875158">nil</span>&nbsp;<span class="op" id="3875162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875166">c</span><span class="op" id="3875167">.</span><span class="ident" id="3875168">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3875191">=</span>&nbsp;<span class="builtintype" id="3875193">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875199">}</span><br>
<span class="lineno"></span><span class="op" id="3875201">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="3875204">func</span>&nbsp;<span class="op" id="3875209">(</span><span class="ident" id="3875210">c</span>&nbsp;<span class="op" id="3875212">*</span><span class="ident" id="3875213">Config</span><span class="op" id="3875219">)</span>&nbsp;<span class="ident" id="3875221">rand</span><span class="op" id="3875225">(</span><span class="op" id="3875226">)</span>&nbsp;<span class="ident" id="3875228">io</span><span class="op" id="3875230">.</span><span class="ident" id="3875231">Reader</span>&nbsp;<span class="op" id="3875238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875241">r</span>&nbsp;<span class="op" id="3875243">:=</span>&nbsp;<span class="ident" id="3875246">c</span><span class="op" id="3875247">.</span><span class="ident" id="3875248">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875254">if</span>&nbsp;<span class="ident" id="3875257">r</span>&nbsp;<span class="op" id="3875259">==</span>&nbsp;<span class="ident" id="3875262">nil</span>&nbsp;<span class="op" id="3875266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875270">return</span>&nbsp;<span class="ident" id="3875277">rand</span><span class="op" id="3875281">.</span><span class="ident" id="3875282">Reader</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875293">return</span>&nbsp;<span class="ident" id="3875300">r</span><br>
<span class="lineno"></span><span class="op" id="3875302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3875305">func</span>&nbsp;<span class="op" id="3875310">(</span><span class="ident" id="3875311">c</span>&nbsp;<span class="op" id="3875313">*</span><span class="ident" id="3875314">Config</span><span class="op" id="3875320">)</span>&nbsp;<span class="ident" id="3875322">time</span><span class="op" id="3875326">(</span><span class="op" id="3875327">)</span>&nbsp;<span class="ident" id="3875329">time</span><span class="op" id="3875333">.</span><span class="ident" id="3875334">Time</span>&nbsp;<span class="op" id="3875339">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875342">t</span>&nbsp;<span class="op" id="3875344">:=</span>&nbsp;<span class="ident" id="3875347">c</span><span class="op" id="3875348">.</span><span class="ident" id="3875349">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875355">if</span>&nbsp;<span class="ident" id="3875358">t</span>&nbsp;<span class="op" id="3875360">==</span>&nbsp;<span class="ident" id="3875363">nil</span>&nbsp;<span class="op" id="3875367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875371">t</span>&nbsp;<span class="op" id="3875373">=</span>&nbsp;<span class="ident" id="3875375">time</span><span class="op" id="3875379">.</span><span class="ident" id="3875380">Now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875388">return</span>&nbsp;<span class="ident" id="3875395">t</span><span class="op" id="3875396">(</span><span class="op" id="3875397">)</span><br>
<span class="lineno">380</span><span class="op" id="3875399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3875402">func</span>&nbsp;<span class="op" id="3875407">(</span><span class="ident" id="3875408">c</span>&nbsp;<span class="op" id="3875410">*</span><span class="ident" id="3875411">Config</span><span class="op" id="3875417">)</span>&nbsp;<span class="ident" id="3875419">cipherSuites</span><span class="op" id="3875431">(</span><span class="op" id="3875432">)</span>&nbsp;<span class="op" id="3875434">[</span><span class="op" id="3875435">]</span><span class="builtintype" id="3875436">uint16</span>&nbsp;<span class="op" id="3875443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875446">s</span>&nbsp;<span class="op" id="3875448">:=</span>&nbsp;<span class="ident" id="3875451">c</span><span class="op" id="3875452">.</span><span class="ident" id="3875453">CipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875467">if</span>&nbsp;<span class="ident" id="3875470">s</span>&nbsp;<span class="op" id="3875472">==</span>&nbsp;<span class="ident" id="3875475">nil</span>&nbsp;<span class="op" id="3875479">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875483">s</span>&nbsp;<span class="op" id="3875485">=</span>&nbsp;<span class="ident" id="3875487">defaultCipherSuites</span><span class="op" id="3875506">(</span><span class="op" id="3875507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875513">return</span>&nbsp;<span class="ident" id="3875520">s</span><br>
<span class="lineno"></span><span class="op" id="3875522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="3875525">func</span>&nbsp;<span class="op" id="3875530">(</span><span class="ident" id="3875531">c</span>&nbsp;<span class="op" id="3875533">*</span><span class="ident" id="3875534">Config</span><span class="op" id="3875540">)</span>&nbsp;<span class="ident" id="3875542">minVersion</span><span class="op" id="3875552">(</span><span class="op" id="3875553">)</span>&nbsp;<span class="builtintype" id="3875555">uint16</span>&nbsp;<span class="op" id="3875562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875565">if</span>&nbsp;<span class="ident" id="3875568">c</span>&nbsp;<span class="op" id="3875570">==</span>&nbsp;<span class="ident" id="3875573">nil</span>&nbsp;<span class="op" id="3875577">||</span>&nbsp;<span class="ident" id="3875580">c</span><span class="op" id="3875581">.</span><span class="ident" id="3875582">MinVersion</span>&nbsp;<span class="op" id="3875593">==</span>&nbsp;<span class="num" id="3875596">0</span>&nbsp;<span class="op" id="3875598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875602">return</span>&nbsp;<span class="ident" id="3875609">minVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875624">return</span>&nbsp;<span class="ident" id="3875631">c</span><span class="op" id="3875632">.</span><span class="ident" id="3875633">MinVersion</span><br>
<span class="lineno">395</span><span class="op" id="3875644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3875647">func</span>&nbsp;<span class="op" id="3875652">(</span><span class="ident" id="3875653">c</span>&nbsp;<span class="op" id="3875655">*</span><span class="ident" id="3875656">Config</span><span class="op" id="3875662">)</span>&nbsp;<span class="ident" id="3875664">maxVersion</span><span class="op" id="3875674">(</span><span class="op" id="3875675">)</span>&nbsp;<span class="builtintype" id="3875677">uint16</span>&nbsp;<span class="op" id="3875684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875687">if</span>&nbsp;<span class="ident" id="3875690">c</span>&nbsp;<span class="op" id="3875692">==</span>&nbsp;<span class="ident" id="3875695">nil</span>&nbsp;<span class="op" id="3875699">||</span>&nbsp;<span class="ident" id="3875702">c</span><span class="op" id="3875703">.</span><span class="ident" id="3875704">MaxVersion</span>&nbsp;<span class="op" id="3875715">==</span>&nbsp;<span class="num" id="3875718">0</span>&nbsp;<span class="op" id="3875720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875724">return</span>&nbsp;<span class="ident" id="3875731">maxVersion</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875746">return</span>&nbsp;<span class="ident" id="3875753">c</span><span class="op" id="3875754">.</span><span class="ident" id="3875755">MaxVersion</span><br>
<span class="lineno"></span><span class="op" id="3875766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3875769">var</span>&nbsp;<span class="ident" id="3875773">defaultCurvePreferences</span>&nbsp;<span class="op" id="3875797">=</span>&nbsp;<span class="op" id="3875799">[</span><span class="op" id="3875800">]</span><span class="ident" id="3875801">CurveID</span><span class="op" id="3875808">{</span><span class="ident" id="3875809">CurveP256</span><span class="op" id="3875818">,</span>&nbsp;<span class="ident" id="3875820">CurveP384</span><span class="op" id="3875829">,</span>&nbsp;<span class="ident" id="3875831">CurveP521</span><span class="op" id="3875840">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="3875843">func</span>&nbsp;<span class="op" id="3875848">(</span><span class="ident" id="3875849">c</span>&nbsp;<span class="op" id="3875851">*</span><span class="ident" id="3875852">Config</span><span class="op" id="3875858">)</span>&nbsp;<span class="ident" id="3875860">curvePreferences</span><span class="op" id="3875876">(</span><span class="op" id="3875877">)</span>&nbsp;<span class="op" id="3875879">[</span><span class="op" id="3875880">]</span><span class="ident" id="3875881">CurveID</span>&nbsp;<span class="op" id="3875889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875892">if</span>&nbsp;<span class="ident" id="3875895">c</span>&nbsp;<span class="op" id="3875897">==</span>&nbsp;<span class="ident" id="3875900">nil</span>&nbsp;<span class="op" id="3875904">||</span>&nbsp;<span class="builtinfunc" id="3875907">len</span><span class="op" id="3875910">(</span><span class="ident" id="3875911">c</span><span class="op" id="3875912">.</span><span class="ident" id="3875913">CurvePreferences</span><span class="op" id="3875929">)</span>&nbsp;<span class="op" id="3875931">==</span>&nbsp;<span class="num" id="3875934">0</span>&nbsp;<span class="op" id="3875936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875940">return</span>&nbsp;<span class="ident" id="3875947">defaultCurvePreferences</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875972">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875975">return</span>&nbsp;<span class="ident" id="3875982">c</span><span class="op" id="3875983">.</span><span class="ident" id="3875984">CurvePreferences</span><br>
<span class="lineno"></span><span class="op" id="3876001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3876004">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="3876078">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="3876102">func</span>&nbsp;<span class="op" id="3876107">(</span><span class="ident" id="3876108">c</span>&nbsp;<span class="op" id="3876110">*</span><span class="ident" id="3876111">Config</span><span class="op" id="3876117">)</span>&nbsp;<span class="ident" id="3876119">mutualVersion</span><span class="op" id="3876132">(</span><span class="ident" id="3876133">vers</span>&nbsp;<span class="builtintype" id="3876138">uint16</span><span class="op" id="3876144">)</span>&nbsp;<span class="op" id="3876146">(</span><span class="builtintype" id="3876147">uint16</span><span class="op" id="3876153">,</span>&nbsp;<span class="builtintype" id="3876155">bool</span><span class="op" id="3876159">)</span>&nbsp;<span class="op" id="3876161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3876164">minVersion</span>&nbsp;<span class="op" id="3876175">:=</span>&nbsp;<span class="ident" id="3876178">c</span><span class="op" id="3876179">.</span><span class="ident" id="3876180">minVersion</span><span class="op" id="3876190">(</span><span class="op" id="3876191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3876194">maxVersion</span>&nbsp;<span class="op" id="3876205">:=</span>&nbsp;<span class="ident" id="3876208">c</span><span class="op" id="3876209">.</span><span class="ident" id="3876210">maxVersion</span><span class="op" id="3876220">(</span><span class="op" id="3876221">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876225">if</span>&nbsp;<span class="ident" id="3876228">vers</span>&nbsp;<span class="op" id="3876233">&lt;</span>&nbsp;<span class="ident" id="3876235">minVersion</span>&nbsp;<span class="op" id="3876246">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876250">return</span>&nbsp;<span class="num" id="3876257">0</span><span class="op" id="3876258">,</span>&nbsp;<span class="builtintype" id="3876260">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3876267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876270">if</span>&nbsp;<span class="ident" id="3876273">vers</span>&nbsp;<span class="op" id="3876278">&gt;</span>&nbsp;<span class="ident" id="3876280">maxVersion</span>&nbsp;<span class="op" id="3876291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3876295">vers</span>&nbsp;<span class="op" id="3876300">=</span>&nbsp;<span class="ident" id="3876302">maxVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3876314">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876317">return</span>&nbsp;<span class="ident" id="3876324">vers</span><span class="op" id="3876328">,</span>&nbsp;<span class="builtintype" id="3876330">true</span><br>
<span class="lineno"></span><span class="op" id="3876335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3876338">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="3876416">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="3876470">func</span>&nbsp;<span class="op" id="3876475">(</span><span class="ident" id="3876476">c</span>&nbsp;<span class="op" id="3876478">*</span><span class="ident" id="3876479">Config</span><span class="op" id="3876485">)</span>&nbsp;<span class="ident" id="3876487">getCertificate</span><span class="op" id="3876501">(</span><span class="ident" id="3876502">clientHello</span>&nbsp;<span class="op" id="3876514">*</span><span class="ident" id="3876515">ClientHelloInfo</span><span class="op" id="3876530">)</span>&nbsp;<span class="op" id="3876532">(</span><span class="op" id="3876533">*</span><span class="ident" id="3876534">Certificate</span><span class="op" id="3876545">,</span>&nbsp;<span class="builtintype" id="3876547">error</span><span class="op" id="3876552">)</span>&nbsp;<span class="op" id="3876554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876557">if</span>&nbsp;<span class="ident" id="3876560">c</span><span class="op" id="3876561">.</span><span class="ident" id="3876562">GetCertificate</span>&nbsp;<span class="op" id="3876577">!=</span>&nbsp;<span class="ident" id="3876580">nil</span>&nbsp;<span class="op" id="3876584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3876588">cert</span><span class="op" id="3876592">,</span>&nbsp;<span class="ident" id="3876594">err</span>&nbsp;<span class="op" id="3876598">:=</span>&nbsp;<span class="ident" id="3876601">c</span><span class="op" id="3876602">.</span><span class="ident" id="3876603">GetCertificate</span><span class="op" id="3876617">(</span><span class="ident" id="3876618">clientHello</span><span class="op" id="3876629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876633">if</span>&nbsp;<span class="ident" id="3876636">cert</span>&nbsp;<span class="op" id="3876641">!=</span>&nbsp;<span class="ident" id="3876644">nil</span>&nbsp;<span class="op" id="3876648">||</span>&nbsp;<span class="ident" id="3876651">err</span>&nbsp;<span class="op" id="3876655">!=</span>&nbsp;<span class="ident" id="3876658">nil</span>&nbsp;<span class="op" id="3876662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876667">return</span>&nbsp;<span class="ident" id="3876674">cert</span><span class="op" id="3876678">,</span>&nbsp;<span class="ident" id="3876680">err</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3876686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3876689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876693">if</span>&nbsp;<span class="builtinfunc" id="3876696">len</span><span class="op" id="3876699">(</span><span class="ident" id="3876700">c</span><span class="op" id="3876701">.</span><span class="ident" id="3876702">Certificates</span><span class="op" id="3876714">)</span>&nbsp;<span class="op" id="3876716">==</span>&nbsp;<span class="num" id="3876719">1</span>&nbsp;<span class="op" id="3876721">||</span>&nbsp;<span class="ident" id="3876724">c</span><span class="op" id="3876725">.</span><span class="ident" id="3876726">NameToCertificate</span>&nbsp;<span class="op" id="3876744">==</span>&nbsp;<span class="ident" id="3876747">nil</span>&nbsp;<span class="op" id="3876751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3876755">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876813">return</span>&nbsp;<span class="op" id="3876820">&amp;</span><span class="ident" id="3876821">c</span><span class="op" id="3876822">.</span><span class="ident" id="3876823">Certificates</span><span class="op" id="3876835">[</span><span class="num" id="3876836">0</span><span class="op" id="3876837">]</span><span class="op" id="3876838">,</span>&nbsp;<span class="ident" id="3876840">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3876845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3876849">name</span>&nbsp;<span class="op" id="3876854">:=</span>&nbsp;<span class="ident" id="3876857">strings</span><span class="op" id="3876864">.</span><span class="ident" id="3876865">ToLower</span><span class="op" id="3876872">(</span><span class="ident" id="3876873">clientHello</span><span class="op" id="3876884">.</span><span class="ident" id="3876885">ServerName</span><span class="op" id="3876895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876898">for</span>&nbsp;<span class="builtinfunc" id="3876902">len</span><span class="op" id="3876905">(</span><span class="ident" id="3876906">name</span><span class="op" id="3876910">)</span>&nbsp;<span class="op" id="3876912">&gt;</span>&nbsp;<span class="num" id="3876914">0</span>&nbsp;<span class="op" id="3876916">&amp;&amp;</span>&nbsp;<span class="ident" id="3876919">name</span><span class="op" id="3876923">[</span><span class="builtinfunc" id="3876924">len</span><span class="op" id="3876927">(</span><span class="ident" id="3876928">name</span><span class="op" id="3876932">)</span><span class="op" id="3876933">-</span><span class="num" id="3876934">1</span><span class="op" id="3876935">]</span>&nbsp;<span class="op" id="3876937">==</span>&nbsp;<span class="string" id="3876940">&#39;.&#39;</span>&nbsp;<span class="op" id="3876944">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3876948">name</span>&nbsp;<span class="op" id="3876953">=</span>&nbsp;<span class="ident" id="3876955">name</span><span class="op" id="3876959">[</span><span class="op" id="3876960">:</span><span class="builtinfunc" id="3876961">len</span><span class="op" id="3876964">(</span><span class="ident" id="3876965">name</span><span class="op" id="3876969">)</span><span class="op" id="3876970">-</span><span class="num" id="3876971">1</span><span class="op" id="3876972">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3876975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876979">if</span>&nbsp;<span class="ident" id="3876982">cert</span><span class="op" id="3876986">,</span>&nbsp;<span class="ident" id="3876988">ok</span>&nbsp;<span class="op" id="3876991">:=</span>&nbsp;<span class="ident" id="3876994">c</span><span class="op" id="3876995">.</span><span class="ident" id="3876996">NameToCertificate</span><span class="op" id="3877013">[</span><span class="ident" id="3877014">name</span><span class="op" id="3877018">]</span><span class="op" id="3877019">;</span>&nbsp;<span class="ident" id="3877021">ok</span>&nbsp;<span class="op" id="3877024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877028">return</span>&nbsp;<span class="ident" id="3877035">cert</span><span class="op" id="3877039">,</span>&nbsp;<span class="ident" id="3877041">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3877046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3877050">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3877117">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3877128">labels</span>&nbsp;<span class="op" id="3877135">:=</span>&nbsp;<span class="ident" id="3877138">strings</span><span class="op" id="3877145">.</span><span class="ident" id="3877146">Split</span><span class="op" id="3877151">(</span><span class="ident" id="3877152">name</span><span class="op" id="3877156">,</span>&nbsp;<span class="string" id="3877158">&#34;.&#34;</span><span class="op" id="3877161">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877164">for</span>&nbsp;<span class="ident" id="3877168">i</span>&nbsp;<span class="op" id="3877170">:=</span>&nbsp;<span class="keyword" id="3877173">range</span>&nbsp;<span class="ident" id="3877179">labels</span>&nbsp;<span class="op" id="3877186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3877190">labels</span><span class="op" id="3877196">[</span><span class="ident" id="3877197">i</span><span class="op" id="3877198">]</span>&nbsp;<span class="op" id="3877200">=</span>&nbsp;<span class="string" id="3877202">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3877208">candidate</span>&nbsp;<span class="op" id="3877218">:=</span>&nbsp;<span class="ident" id="3877221">strings</span><span class="op" id="3877228">.</span><span class="ident" id="3877229">Join</span><span class="op" id="3877233">(</span><span class="ident" id="3877234">labels</span><span class="op" id="3877240">,</span>&nbsp;<span class="string" id="3877242">&#34;.&#34;</span><span class="op" id="3877245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877249">if</span>&nbsp;<span class="ident" id="3877252">cert</span><span class="op" id="3877256">,</span>&nbsp;<span class="ident" id="3877258">ok</span>&nbsp;<span class="op" id="3877261">:=</span>&nbsp;<span class="ident" id="3877264">c</span><span class="op" id="3877265">.</span><span class="ident" id="3877266">NameToCertificate</span><span class="op" id="3877283">[</span><span class="ident" id="3877284">candidate</span><span class="op" id="3877293">]</span><span class="op" id="3877294">;</span>&nbsp;<span class="ident" id="3877296">ok</span>&nbsp;<span class="op" id="3877299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877304">return</span>&nbsp;<span class="ident" id="3877311">cert</span><span class="op" id="3877315">,</span>&nbsp;<span class="ident" id="3877317">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3877323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3877326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3877330">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877384">return</span>&nbsp;<span class="op" id="3877391">&amp;</span><span class="ident" id="3877392">c</span><span class="op" id="3877393">.</span><span class="ident" id="3877394">Certificates</span><span class="op" id="3877406">[</span><span class="num" id="3877407">0</span><span class="op" id="3877408">]</span><span class="op" id="3877409">,</span>&nbsp;<span class="ident" id="3877411">nil</span><br>
<span class="lineno">465</span><span class="op" id="3877415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3877418">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="3877497">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="3877572">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="3877589">func</span>&nbsp;<span class="op" id="3877594">(</span><span class="ident" id="3877595">c</span>&nbsp;<span class="op" id="3877597">*</span><span class="ident" id="3877598">Config</span><span class="op" id="3877604">)</span>&nbsp;<span class="ident" id="3877606">BuildNameToCertificate</span><span class="op" id="3877628">(</span><span class="op" id="3877629">)</span>&nbsp;<span class="op" id="3877631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3877634">c</span><span class="op" id="3877635">.</span><span class="ident" id="3877636">NameToCertificate</span>&nbsp;<span class="op" id="3877654">=</span>&nbsp;<span class="builtinfunc" id="3877656">make</span><span class="op" id="3877660">(</span><span class="keyword" id="3877661">map</span><span class="op" id="3877664">[</span><span class="builtintype" id="3877665">string</span><span class="op" id="3877671">]</span><span class="op" id="3877672">*</span><span class="ident" id="3877673">Certificate</span><span class="op" id="3877684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877687">for</span>&nbsp;<span class="ident" id="3877691">i</span>&nbsp;<span class="op" id="3877693">:=</span>&nbsp;<span class="keyword" id="3877696">range</span>&nbsp;<span class="ident" id="3877702">c</span><span class="op" id="3877703">.</span><span class="ident" id="3877704">Certificates</span>&nbsp;<span class="op" id="3877717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3877721">cert</span>&nbsp;<span class="op" id="3877726">:=</span>&nbsp;<span class="op" id="3877729">&amp;</span><span class="ident" id="3877730">c</span><span class="op" id="3877731">.</span><span class="ident" id="3877732">Certificates</span><span class="op" id="3877744">[</span><span class="ident" id="3877745">i</span><span class="op" id="3877746">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3877750">x509Cert</span><span class="op" id="3877758">,</span>&nbsp;<span class="ident" id="3877760">err</span>&nbsp;<span class="op" id="3877764">:=</span>&nbsp;<span class="ident" id="3877767">x509</span><span class="op" id="3877771">.</span><span class="ident" id="3877772">ParseCertificate</span><span class="op" id="3877788">(</span><span class="ident" id="3877789">cert</span><span class="op" id="3877793">.</span><span class="ident" id="3877794">Certificate</span><span class="op" id="3877805">[</span><span class="num" id="3877806">0</span><span class="op" id="3877807">]</span><span class="op" id="3877808">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877812">if</span>&nbsp;<span class="ident" id="3877815">err</span>&nbsp;<span class="op" id="3877819">!=</span>&nbsp;<span class="ident" id="3877822">nil</span>&nbsp;<span class="op" id="3877826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877831">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3877842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877846">if</span>&nbsp;<span class="builtinfunc" id="3877849">len</span><span class="op" id="3877852">(</span><span class="ident" id="3877853">x509Cert</span><span class="op" id="3877861">.</span><span class="ident" id="3877862">Subject</span><span class="op" id="3877869">.</span><span class="ident" id="3877870">CommonName</span><span class="op" id="3877880">)</span>&nbsp;<span class="op" id="3877882">&gt;</span>&nbsp;<span class="num" id="3877884">0</span>&nbsp;<span class="op" id="3877886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3877891">c</span><span class="op" id="3877892">.</span><span class="ident" id="3877893">NameToCertificate</span><span class="op" id="3877910">[</span><span class="ident" id="3877911">x509Cert</span><span class="op" id="3877919">.</span><span class="ident" id="3877920">Subject</span><span class="op" id="3877927">.</span><span class="ident" id="3877928">CommonName</span><span class="op" id="3877938">]</span>&nbsp;<span class="op" id="3877940">=</span>&nbsp;<span class="ident" id="3877942">cert</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3877949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877953">for</span>&nbsp;<span class="ident" id="3877957">_</span><span class="op" id="3877958">,</span>&nbsp;<span class="ident" id="3877960">san</span>&nbsp;<span class="op" id="3877964">:=</span>&nbsp;<span class="keyword" id="3877967">range</span>&nbsp;<span class="ident" id="3877973">x509Cert</span><span class="op" id="3877981">.</span><span class="ident" id="3877982">DNSNames</span>&nbsp;<span class="op" id="3877991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3877996">c</span><span class="op" id="3877997">.</span><span class="ident" id="3877998">NameToCertificate</span><span class="op" id="3878015">[</span><span class="ident" id="3878016">san</span><span class="op" id="3878019">]</span>&nbsp;<span class="op" id="3878021">=</span>&nbsp;<span class="ident" id="3878023">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3878030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3878033">}</span><br>
<span class="lineno">485</span><span class="op" id="3878035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3878038">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="3878107">type</span>&nbsp;<span class="ident" id="3878112">Certificate</span>&nbsp;<span class="keyword" id="3878124">struct</span>&nbsp;<span class="op" id="3878131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3878134">Certificate</span>&nbsp;<span class="op" id="3878146">[</span><span class="op" id="3878147">]</span><span class="op" id="3878148">[</span><span class="op" id="3878149">]</span><span class="builtintype" id="3878150">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3878156">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3878228">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3878289">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3878359">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3878429">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3878458">PrivateKey</span>&nbsp;<span class="ident" id="3878469">crypto</span><span class="op" id="3878475">.</span><span class="ident" id="3878476">PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3878488">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3878559">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3878591">OCSPStaple</span>&nbsp;<span class="op" id="3878602">[</span><span class="op" id="3878603">]</span><span class="builtintype" id="3878604">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3878610">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3878676">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3878744">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3878816">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3878863">Leaf</span>&nbsp;<span class="op" id="3878868">*</span><span class="ident" id="3878869">x509</span><span class="op" id="3878873">.</span><span class="ident" id="3878874">Certificate</span><br>
<span class="lineno"></span><span class="op" id="3878886">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="3878889">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="3878906">type</span>&nbsp;<span class="ident" id="3878911">record</span>&nbsp;<span class="keyword" id="3878918">struct</span>&nbsp;<span class="op" id="3878925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3878928">contentType</span>&nbsp;&nbsp;<span class="ident" id="3878941">recordType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3878953">major</span><span class="op" id="3878958">,</span>&nbsp;<span class="ident" id="3878960">minor</span>&nbsp;<span class="builtintype" id="3878966">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3878973">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3878986">[</span><span class="op" id="3878987">]</span><span class="builtintype" id="3878988">byte</span><br>
<span class="lineno"></span><span class="op" id="3878993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3878996">type</span>&nbsp;<span class="ident" id="3879001">handshakeMessage</span>&nbsp;<span class="keyword" id="3879018">interface</span>&nbsp;<span class="op" id="3879028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879031">marshal</span><span class="op" id="3879038">(</span><span class="op" id="3879039">)</span>&nbsp;<span class="op" id="3879041">[</span><span class="op" id="3879042">]</span><span class="builtintype" id="3879043">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879049">unmarshal</span><span class="op" id="3879058">(</span><span class="op" id="3879059">[</span><span class="op" id="3879060">]</span><span class="builtintype" id="3879061">byte</span><span class="op" id="3879065">)</span>&nbsp;<span class="builtintype" id="3879067">bool</span><br>
<span class="lineno"></span><span class="op" id="3879072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3879075">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="3879150">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="3879171">type</span>&nbsp;<span class="ident" id="3879176">lruSessionCache</span>&nbsp;<span class="keyword" id="3879192">struct</span>&nbsp;<span class="op" id="3879199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879202">sync</span><span class="op" id="3879206">.</span><span class="ident" id="3879207">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879215">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879224">map</span><span class="op" id="3879227">[</span><span class="builtintype" id="3879228">string</span><span class="op" id="3879234">]</span><span class="op" id="3879235">*</span><span class="ident" id="3879236">list</span><span class="op" id="3879240">.</span><span class="ident" id="3879241">Element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879250">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3879259">*</span><span class="ident" id="3879260">list</span><span class="op" id="3879264">.</span><span class="ident" id="3879265">List</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879271">capacity</span>&nbsp;<span class="builtintype" id="3879280">int</span><br>
<span class="lineno"></span><span class="op" id="3879284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3879287">type</span>&nbsp;<span class="ident" id="3879292">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="3879313">struct</span>&nbsp;<span class="op" id="3879320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879323">sessionKey</span>&nbsp;<span class="builtintype" id="3879334">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879342">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3879353">*</span><span class="ident" id="3879354">ClientSessionState</span><br>
<span class="lineno"></span><span class="op" id="3879373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3879376">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="3879448">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="3879526">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3879546">func</span>&nbsp;<span class="ident" id="3879551">NewLRUClientSessionCache</span><span class="op" id="3879575">(</span><span class="ident" id="3879576">capacity</span>&nbsp;<span class="builtintype" id="3879585">int</span><span class="op" id="3879588">)</span>&nbsp;<span class="ident" id="3879590">ClientSessionCache</span>&nbsp;<span class="op" id="3879609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879612">const</span>&nbsp;<span class="ident" id="3879618">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="3879646">=</span>&nbsp;<span class="num" id="3879648">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879653">if</span>&nbsp;<span class="ident" id="3879656">capacity</span>&nbsp;<span class="op" id="3879665">&lt;</span>&nbsp;<span class="num" id="3879667">1</span>&nbsp;<span class="op" id="3879669">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879673">capacity</span>&nbsp;<span class="op" id="3879682">=</span>&nbsp;<span class="ident" id="3879684">defaultSessionCacheCapacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3879713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879716">return</span>&nbsp;<span class="op" id="3879723">&amp;</span><span class="ident" id="3879724">lruSessionCache</span><span class="op" id="3879739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879743">m</span><span class="op" id="3879744">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3879753">make</span><span class="op" id="3879757">(</span><span class="keyword" id="3879758">map</span><span class="op" id="3879761">[</span><span class="builtintype" id="3879762">string</span><span class="op" id="3879768">]</span><span class="op" id="3879769">*</span><span class="ident" id="3879770">list</span><span class="op" id="3879774">.</span><span class="ident" id="3879775">Element</span><span class="op" id="3879782">)</span><span class="op" id="3879783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879787">q</span><span class="op" id="3879788">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879797">list</span><span class="op" id="3879801">.</span><span class="ident" id="3879802">New</span><span class="op" id="3879805">(</span><span class="op" id="3879806">)</span><span class="op" id="3879807">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879811">capacity</span><span class="op" id="3879819">:</span>&nbsp;<span class="ident" id="3879821">capacity</span><span class="op" id="3879829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3879832">}</span><br>
<span class="lineno"></span><span class="op" id="3879834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3879837">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="3879898">func</span>&nbsp;<span class="op" id="3879903">(</span><span class="ident" id="3879904">c</span>&nbsp;<span class="op" id="3879906">*</span><span class="ident" id="3879907">lruSessionCache</span><span class="op" id="3879922">)</span>&nbsp;<span class="ident" id="3879924">Put</span><span class="op" id="3879927">(</span><span class="ident" id="3879928">sessionKey</span>&nbsp;<span class="builtintype" id="3879939">string</span><span class="op" id="3879945">,</span>&nbsp;<span class="ident" id="3879947">cs</span>&nbsp;<span class="op" id="3879950">*</span><span class="ident" id="3879951">ClientSessionState</span><span class="op" id="3879969">)</span>&nbsp;<span class="op" id="3879971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879974">c</span><span class="op" id="3879975">.</span><span class="ident" id="3879976">Lock</span><span class="op" id="3879980">(</span><span class="op" id="3879981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879984">defer</span>&nbsp;<span class="ident" id="3879990">c</span><span class="op" id="3879991">.</span><span class="ident" id="3879992">Unlock</span><span class="op" id="3879998">(</span><span class="op" id="3879999">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880003">if</span>&nbsp;<span class="ident" id="3880006">elem</span><span class="op" id="3880010">,</span>&nbsp;<span class="ident" id="3880012">ok</span>&nbsp;<span class="op" id="3880015">:=</span>&nbsp;<span class="ident" id="3880018">c</span><span class="op" id="3880019">.</span><span class="ident" id="3880020">m</span><span class="op" id="3880021">[</span><span class="ident" id="3880022">sessionKey</span><span class="op" id="3880032">]</span><span class="op" id="3880033">;</span>&nbsp;<span class="ident" id="3880035">ok</span>&nbsp;<span class="op" id="3880038">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880042">entry</span>&nbsp;<span class="op" id="3880048">:=</span>&nbsp;<span class="ident" id="3880051">elem</span><span class="op" id="3880055">.</span><span class="ident" id="3880056">Value</span><span class="op" id="3880061">.</span><span class="op" id="3880062">(</span><span class="op" id="3880063">*</span><span class="ident" id="3880064">lruSessionCacheEntry</span><span class="op" id="3880084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880088">entry</span><span class="op" id="3880093">.</span><span class="ident" id="3880094">state</span>&nbsp;<span class="op" id="3880100">=</span>&nbsp;<span class="ident" id="3880102">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880107">c</span><span class="op" id="3880108">.</span><span class="ident" id="3880109">q</span><span class="op" id="3880110">.</span><span class="ident" id="3880111">MoveToFront</span><span class="op" id="3880122">(</span><span class="ident" id="3880123">elem</span><span class="op" id="3880127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880131">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3880139">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880143">if</span>&nbsp;<span class="ident" id="3880146">c</span><span class="op" id="3880147">.</span><span class="ident" id="3880148">q</span><span class="op" id="3880149">.</span><span class="ident" id="3880150">Len</span><span class="op" id="3880153">(</span><span class="op" id="3880154">)</span>&nbsp;<span class="op" id="3880156">&lt;</span>&nbsp;<span class="ident" id="3880158">c</span><span class="op" id="3880159">.</span><span class="ident" id="3880160">capacity</span>&nbsp;<span class="op" id="3880169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880173">entry</span>&nbsp;<span class="op" id="3880179">:=</span>&nbsp;<span class="op" id="3880182">&amp;</span><span class="ident" id="3880183">lruSessionCacheEntry</span><span class="op" id="3880203">{</span><span class="ident" id="3880204">sessionKey</span><span class="op" id="3880214">,</span>&nbsp;<span class="ident" id="3880216">cs</span><span class="op" id="3880218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880222">c</span><span class="op" id="3880223">.</span><span class="ident" id="3880224">m</span><span class="op" id="3880225">[</span><span class="ident" id="3880226">sessionKey</span><span class="op" id="3880236">]</span>&nbsp;<span class="op" id="3880238">=</span>&nbsp;<span class="ident" id="3880240">c</span><span class="op" id="3880241">.</span><span class="ident" id="3880242">q</span><span class="op" id="3880243">.</span><span class="ident" id="3880244">PushFront</span><span class="op" id="3880253">(</span><span class="ident" id="3880254">entry</span><span class="op" id="3880259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880263">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3880271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880275">elem</span>&nbsp;<span class="op" id="3880280">:=</span>&nbsp;<span class="ident" id="3880283">c</span><span class="op" id="3880284">.</span><span class="ident" id="3880285">q</span><span class="op" id="3880286">.</span><span class="ident" id="3880287">Back</span><span class="op" id="3880291">(</span><span class="op" id="3880292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880295">entry</span>&nbsp;<span class="op" id="3880301">:=</span>&nbsp;<span class="ident" id="3880304">elem</span><span class="op" id="3880308">.</span><span class="ident" id="3880309">Value</span><span class="op" id="3880314">.</span><span class="op" id="3880315">(</span><span class="op" id="3880316">*</span><span class="ident" id="3880317">lruSessionCacheEntry</span><span class="op" id="3880337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3880340">delete</span><span class="op" id="3880346">(</span><span class="ident" id="3880347">c</span><span class="op" id="3880348">.</span><span class="ident" id="3880349">m</span><span class="op" id="3880350">,</span>&nbsp;<span class="ident" id="3880352">entry</span><span class="op" id="3880357">.</span><span class="ident" id="3880358">sessionKey</span><span class="op" id="3880368">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880371">entry</span><span class="op" id="3880376">.</span><span class="ident" id="3880377">sessionKey</span>&nbsp;<span class="op" id="3880388">=</span>&nbsp;<span class="ident" id="3880390">sessionKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880402">entry</span><span class="op" id="3880407">.</span><span class="ident" id="3880408">state</span>&nbsp;<span class="op" id="3880414">=</span>&nbsp;<span class="ident" id="3880416">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880420">c</span><span class="op" id="3880421">.</span><span class="ident" id="3880422">q</span><span class="op" id="3880423">.</span><span class="ident" id="3880424">MoveToFront</span><span class="op" id="3880435">(</span><span class="ident" id="3880436">elem</span><span class="op" id="3880440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880443">c</span><span class="op" id="3880444">.</span><span class="ident" id="3880445">m</span><span class="op" id="3880446">[</span><span class="ident" id="3880447">sessionKey</span><span class="op" id="3880457">]</span>&nbsp;<span class="op" id="3880459">=</span>&nbsp;<span class="ident" id="3880461">elem</span><br>
<span class="lineno"></span><span class="op" id="3880466">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="3880469">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="3880545">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="3880591">func</span>&nbsp;<span class="op" id="3880596">(</span><span class="ident" id="3880597">c</span>&nbsp;<span class="op" id="3880599">*</span><span class="ident" id="3880600">lruSessionCache</span><span class="op" id="3880615">)</span>&nbsp;<span class="ident" id="3880617">Get</span><span class="op" id="3880620">(</span><span class="ident" id="3880621">sessionKey</span>&nbsp;<span class="builtintype" id="3880632">string</span><span class="op" id="3880638">)</span>&nbsp;<span class="op" id="3880640">(</span><span class="op" id="3880641">*</span><span class="ident" id="3880642">ClientSessionState</span><span class="op" id="3880660">,</span>&nbsp;<span class="builtintype" id="3880662">bool</span><span class="op" id="3880666">)</span>&nbsp;<span class="op" id="3880668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880671">c</span><span class="op" id="3880672">.</span><span class="ident" id="3880673">Lock</span><span class="op" id="3880677">(</span><span class="op" id="3880678">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880681">defer</span>&nbsp;<span class="ident" id="3880687">c</span><span class="op" id="3880688">.</span><span class="ident" id="3880689">Unlock</span><span class="op" id="3880695">(</span><span class="op" id="3880696">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880700">if</span>&nbsp;<span class="ident" id="3880703">elem</span><span class="op" id="3880707">,</span>&nbsp;<span class="ident" id="3880709">ok</span>&nbsp;<span class="op" id="3880712">:=</span>&nbsp;<span class="ident" id="3880715">c</span><span class="op" id="3880716">.</span><span class="ident" id="3880717">m</span><span class="op" id="3880718">[</span><span class="ident" id="3880719">sessionKey</span><span class="op" id="3880729">]</span><span class="op" id="3880730">;</span>&nbsp;<span class="ident" id="3880732">ok</span>&nbsp;<span class="op" id="3880735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880739">c</span><span class="op" id="3880740">.</span><span class="ident" id="3880741">q</span><span class="op" id="3880742">.</span><span class="ident" id="3880743">MoveToFront</span><span class="op" id="3880754">(</span><span class="ident" id="3880755">elem</span><span class="op" id="3880759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880763">return</span>&nbsp;<span class="ident" id="3880770">elem</span><span class="op" id="3880774">.</span><span class="ident" id="3880775">Value</span><span class="op" id="3880780">.</span><span class="op" id="3880781">(</span><span class="op" id="3880782">*</span><span class="ident" id="3880783">lruSessionCacheEntry</span><span class="op" id="3880803">)</span><span class="op" id="3880804">.</span><span class="ident" id="3880805">state</span><span class="op" id="3880810">,</span>&nbsp;<span class="builtintype" id="3880812">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3880818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880821">return</span>&nbsp;<span class="ident" id="3880828">nil</span><span class="op" id="3880831">,</span>&nbsp;<span class="builtintype" id="3880833">false</span><br>
<span class="lineno"></span><span class="op" id="3880839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3880842">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="3880915">type</span>&nbsp;<span class="ident" id="3880920">dsaSignature</span>&nbsp;<span class="keyword" id="3880933">struct</span>&nbsp;<span class="op" id="3880940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880943">R</span><span class="op" id="3880944">,</span>&nbsp;<span class="ident" id="3880946">S</span>&nbsp;<span class="op" id="3880948">*</span><span class="ident" id="3880949">big</span><span class="op" id="3880952">.</span><span class="ident" id="3880953">Int</span><br>
<span class="lineno"></span><span class="op" id="3880957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3880960">type</span>&nbsp;<span class="ident" id="3880965">ecdsaSignature</span>&nbsp;<span class="ident" id="3880980">dsaSignature</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="3880994">var</span>&nbsp;<span class="ident" id="3880998">emptyConfig</span>&nbsp;<span class="ident" id="3881010">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3881018">func</span>&nbsp;<span class="ident" id="3881023">defaultConfig</span><span class="op" id="3881036">(</span><span class="op" id="3881037">)</span>&nbsp;<span class="op" id="3881039">*</span><span class="ident" id="3881040">Config</span>&nbsp;<span class="op" id="3881047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3881050">return</span>&nbsp;<span class="op" id="3881057">&amp;</span><span class="ident" id="3881058">emptyConfig</span><br>
<span class="lineno">600</span><span class="op" id="3881070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3881073">var</span>&nbsp;<span class="op" id="3881077">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3881080">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3881103">sync</span><span class="op" id="3881107">.</span><span class="ident" id="3881108">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3881114">varDefaultCipherSuites</span>&nbsp;<span class="op" id="3881137">[</span><span class="op" id="3881138">]</span><span class="builtintype" id="3881139">uint16</span><br>
<span class="lineno">605</span><span class="op" id="3881146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3881149">func</span>&nbsp;<span class="ident" id="3881154">defaultCipherSuites</span><span class="op" id="3881173">(</span><span class="op" id="3881174">)</span>&nbsp;<span class="op" id="3881176">[</span><span class="op" id="3881177">]</span><span class="builtintype" id="3881178">uint16</span>&nbsp;<span class="op" id="3881185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3881188">once</span><span class="op" id="3881192">.</span><span class="ident" id="3881193">Do</span><span class="op" id="3881195">(</span><span class="ident" id="3881196">initDefaultCipherSuites</span><span class="op" id="3881219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3881222">return</span>&nbsp;<span class="ident" id="3881229">varDefaultCipherSuites</span><br>
<span class="lineno">610</span><span class="op" id="3881252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3881255">func</span>&nbsp;<span class="ident" id="3881260">initDefaultCipherSuites</span><span class="op" id="3881283">(</span><span class="op" id="3881284">)</span>&nbsp;<span class="op" id="3881286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3881289">varDefaultCipherSuites</span>&nbsp;<span class="op" id="3881312">=</span>&nbsp;<span class="builtinfunc" id="3881314">make</span><span class="op" id="3881318">(</span><span class="op" id="3881319">[</span><span class="op" id="3881320">]</span><span class="builtintype" id="3881321">uint16</span><span class="op" id="3881327">,</span>&nbsp;<span class="builtinfunc" id="3881329">len</span><span class="op" id="3881332">(</span><span class="ident" id="3881333">cipherSuites</span><span class="op" id="3881345">)</span><span class="op" id="3881346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3881349">for</span>&nbsp;<span class="ident" id="3881353">i</span><span class="op" id="3881354">,</span>&nbsp;<span class="ident" id="3881356">suite</span>&nbsp;<span class="op" id="3881362">:=</span>&nbsp;<span class="keyword" id="3881365">range</span>&nbsp;<span class="ident" id="3881371">cipherSuites</span>&nbsp;<span class="op" id="3881384">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3881388">varDefaultCipherSuites</span><span class="op" id="3881410">[</span><span class="ident" id="3881411">i</span><span class="op" id="3881412">]</span>&nbsp;<span class="op" id="3881414">=</span>&nbsp;<span class="ident" id="3881416">suite</span><span class="op" id="3881421">.</span><span class="ident" id="3881422">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3881426">}</span><br>
<span class="lineno"></span><span class="op" id="3881428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3881431">func</span>&nbsp;<span class="ident" id="3881436">unexpectedMessageError</span><span class="op" id="3881458">(</span><span class="ident" id="3881459">wanted</span><span class="op" id="3881465">,</span>&nbsp;<span class="ident" id="3881467">got</span>&nbsp;<span class="keyword" id="3881471">interface</span><span class="op" id="3881480">{</span><span class="op" id="3881481">}</span><span class="op" id="3881482">)</span>&nbsp;<span class="builtintype" id="3881484">error</span>&nbsp;<span class="op" id="3881490">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3881493">return</span>&nbsp;<span class="ident" id="3881500">fmt</span><span class="op" id="3881503">.</span><span class="ident" id="3881504">Errorf</span><span class="op" id="3881510">(</span><span class="string" id="3881511">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="3881586">,</span>&nbsp;<span class="ident" id="3881588">got</span><span class="op" id="3881591">,</span>&nbsp;<span class="ident" id="3881593">wanted</span><span class="op" id="3881599">)</span><br>
<span class="lineno"></span><span class="op" id="3881601">}</span>
</div>
</body>
</html>
