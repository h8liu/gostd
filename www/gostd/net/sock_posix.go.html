<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html" class="current">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4163847">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4163903">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4163957">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4164008">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4164086">package</span>&nbsp;<span class="ident" id="4164094">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4164099">import</span>&nbsp;<span class="op" id="4164106">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4164109">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4164115">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4164126">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4164133">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4164136">//&nbsp;A&nbsp;sockaddr&nbsp;represents&nbsp;a&nbsp;TCP,&nbsp;UDP,&nbsp;IP&nbsp;or&nbsp;Unix&nbsp;network&nbsp;endpoint</span><br>
<span class="lineno"></span><span class="comment" id="4164201">//&nbsp;address&nbsp;that&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall.Sockaddr.</span><br>
<span class="lineno"></span><span class="keyword" id="4164259">type</span>&nbsp;<span class="ident" id="4164264">sockaddr</span>&nbsp;<span class="keyword" id="4164273">interface</span>&nbsp;<span class="op" id="4164283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164286">Addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164293">netaddr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164303">//&nbsp;family&nbsp;returns&nbsp;the&nbsp;platform-dependent&nbsp;address&nbsp;family</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164360">//&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164376">family</span><span class="op" id="4164382">(</span><span class="op" id="4164383">)</span>&nbsp;<span class="builtintype" id="4164385">int</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164391">//&nbsp;isWildcard&nbsp;reports&nbsp;whether&nbsp;the&nbsp;address&nbsp;is&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164448">//&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164461">isWildcard</span><span class="op" id="4164471">(</span><span class="op" id="4164472">)</span>&nbsp;<span class="builtintype" id="4164474">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164481">//&nbsp;sockaddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164539">//&nbsp;sockaddr&nbsp;type&nbsp;that&nbsp;implements&nbsp;syscall.Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164590">//&nbsp;interface.&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164652">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164661">sockaddr</span><span class="op" id="4164669">(</span><span class="ident" id="4164670">family</span>&nbsp;<span class="builtintype" id="4164677">int</span><span class="op" id="4164680">)</span>&nbsp;<span class="op" id="4164682">(</span><span class="ident" id="4164683">syscall</span><span class="op" id="4164690">.</span><span class="ident" id="4164691">Sockaddr</span><span class="op" id="4164699">,</span>&nbsp;<span class="builtintype" id="4164701">error</span><span class="op" id="4164706">)</span><br>
<span class="lineno">35</span><span class="op" id="4164708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4164711">//&nbsp;socket&nbsp;returns&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;is&nbsp;ready&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4164773">//&nbsp;asynchronous&nbsp;I/O&nbsp;using&nbsp;the&nbsp;network&nbsp;poller.</span><br>
<span class="lineno"></span><span class="keyword" id="4164819">func</span>&nbsp;<span class="ident" id="4164824">socket</span><span class="op" id="4164830">(</span><span class="ident" id="4164831">net</span>&nbsp;<span class="builtintype" id="4164835">string</span><span class="op" id="4164841">,</span>&nbsp;<span class="ident" id="4164843">family</span><span class="op" id="4164849">,</span>&nbsp;<span class="ident" id="4164851">sotype</span><span class="op" id="4164857">,</span>&nbsp;<span class="ident" id="4164859">proto</span>&nbsp;<span class="builtintype" id="4164865">int</span><span class="op" id="4164868">,</span>&nbsp;<span class="ident" id="4164870">ipv6only</span>&nbsp;<span class="builtintype" id="4164879">bool</span><span class="op" id="4164883">,</span>&nbsp;<span class="ident" id="4164885">laddr</span><span class="op" id="4164890">,</span>&nbsp;<span class="ident" id="4164892">raddr</span>&nbsp;<span class="ident" id="4164898">sockaddr</span><span class="op" id="4164906">,</span>&nbsp;<span class="ident" id="4164908">deadline</span>&nbsp;<span class="ident" id="4164917">time</span><span class="op" id="4164921">.</span><span class="ident" id="4164922">Time</span><span class="op" id="4164926">)</span>&nbsp;<span class="op" id="4164928">(</span><span class="ident" id="4164929">fd</span>&nbsp;<span class="op" id="4164932">*</span><span class="ident" id="4164933">netFD</span><span class="op" id="4164938">,</span>&nbsp;<span class="ident" id="4164940">err</span>&nbsp;<span class="builtintype" id="4164944">error</span><span class="op" id="4164949">)</span>&nbsp;<span class="op" id="4164951">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164954">s</span><span class="op" id="4164955">,</span>&nbsp;<span class="ident" id="4164957">err</span>&nbsp;<span class="op" id="4164961">:=</span>&nbsp;<span class="ident" id="4164964">sysSocket</span><span class="op" id="4164973">(</span><span class="ident" id="4164974">family</span><span class="op" id="4164980">,</span>&nbsp;<span class="ident" id="4164982">sotype</span><span class="op" id="4164988">,</span>&nbsp;<span class="ident" id="4164990">proto</span><span class="op" id="4164995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164998">if</span>&nbsp;<span class="ident" id="4165001">err</span>&nbsp;<span class="op" id="4165005">!=</span>&nbsp;<span class="ident" id="4165008">nil</span>&nbsp;<span class="op" id="4165012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165016">return</span>&nbsp;<span class="ident" id="4165023">nil</span><span class="op" id="4165026">,</span>&nbsp;<span class="ident" id="4165028">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165036">if</span>&nbsp;<span class="ident" id="4165039">err</span>&nbsp;<span class="op" id="4165043">=</span>&nbsp;<span class="ident" id="4165045">setDefaultSockopts</span><span class="op" id="4165063">(</span><span class="ident" id="4165064">s</span><span class="op" id="4165065">,</span>&nbsp;<span class="ident" id="4165067">family</span><span class="op" id="4165073">,</span>&nbsp;<span class="ident" id="4165075">sotype</span><span class="op" id="4165081">,</span>&nbsp;<span class="ident" id="4165083">ipv6only</span><span class="op" id="4165091">)</span><span class="op" id="4165092">;</span>&nbsp;<span class="ident" id="4165094">err</span>&nbsp;<span class="op" id="4165098">!=</span>&nbsp;<span class="ident" id="4165101">nil</span>&nbsp;<span class="op" id="4165105">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165109">closesocket</span><span class="op" id="4165120">(</span><span class="ident" id="4165121">s</span><span class="op" id="4165122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165126">return</span>&nbsp;<span class="ident" id="4165133">nil</span><span class="op" id="4165136">,</span>&nbsp;<span class="ident" id="4165138">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165146">if</span>&nbsp;<span class="ident" id="4165149">fd</span><span class="op" id="4165151">,</span>&nbsp;<span class="ident" id="4165153">err</span>&nbsp;<span class="op" id="4165157">=</span>&nbsp;<span class="ident" id="4165159">newFD</span><span class="op" id="4165164">(</span><span class="ident" id="4165165">s</span><span class="op" id="4165166">,</span>&nbsp;<span class="ident" id="4165168">family</span><span class="op" id="4165174">,</span>&nbsp;<span class="ident" id="4165176">sotype</span><span class="op" id="4165182">,</span>&nbsp;<span class="ident" id="4165184">net</span><span class="op" id="4165187">)</span><span class="op" id="4165188">;</span>&nbsp;<span class="ident" id="4165190">err</span>&nbsp;<span class="op" id="4165194">!=</span>&nbsp;<span class="ident" id="4165197">nil</span>&nbsp;<span class="op" id="4165201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165205">closesocket</span><span class="op" id="4165216">(</span><span class="ident" id="4165217">s</span><span class="op" id="4165218">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165222">return</span>&nbsp;<span class="ident" id="4165229">nil</span><span class="op" id="4165232">,</span>&nbsp;<span class="ident" id="4165234">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165243">//&nbsp;This&nbsp;function&nbsp;makes&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165301">//&nbsp;following&nbsp;applications:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165329">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165333">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;passive&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165386">//&nbsp;&nbsp;&nbsp;connenction,&nbsp;known&nbsp;as&nbsp;a&nbsp;stream&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165432">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165436">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;destination-unspecific</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165497">//&nbsp;&nbsp;&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a&nbsp;datagram&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165553">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165557">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;an&nbsp;active&nbsp;stream&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165615">//&nbsp;&nbsp;&nbsp;destination-specific&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165674">//&nbsp;&nbsp;&nbsp;dialer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165687">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165691">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;the&nbsp;other&nbsp;connection,&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165754">//&nbsp;&nbsp;&nbsp;as&nbsp;talking&nbsp;to&nbsp;the&nbsp;protocol&nbsp;stack&nbsp;inside&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165811">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165815">//&nbsp;For&nbsp;stream&nbsp;and&nbsp;datagram&nbsp;listeners,&nbsp;they&nbsp;will&nbsp;only&nbsp;require</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165877">//&nbsp;named&nbsp;sockets,&nbsp;so&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165938">//&nbsp;from&nbsp;stream&nbsp;or&nbsp;datagram&nbsp;listeners&nbsp;when&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4166002">//&nbsp;raddr&nbsp;is&nbsp;nil.&nbsp;Otherwise&nbsp;we&nbsp;assume&nbsp;it&#39;s&nbsp;just&nbsp;for&nbsp;dialers&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4166065">//&nbsp;the&nbsp;other&nbsp;connection&nbsp;holders.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166100">if</span>&nbsp;<span class="ident" id="4166103">laddr</span>&nbsp;<span class="op" id="4166109">!=</span>&nbsp;<span class="ident" id="4166112">nil</span>&nbsp;<span class="op" id="4166116">&amp;&amp;</span>&nbsp;<span class="ident" id="4166119">raddr</span>&nbsp;<span class="op" id="4166125">==</span>&nbsp;<span class="ident" id="4166128">nil</span>&nbsp;<span class="op" id="4166132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166136">switch</span>&nbsp;<span class="ident" id="4166143">sotype</span>&nbsp;<span class="op" id="4166150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166154">case</span>&nbsp;<span class="ident" id="4166159">syscall</span><span class="op" id="4166166">.</span><span class="ident" id="4166167">SOCK_STREAM</span><span class="op" id="4166178">,</span>&nbsp;<span class="ident" id="4166180">syscall</span><span class="op" id="4166187">.</span><span class="ident" id="4166188">SOCK_SEQPACKET</span><span class="op" id="4166202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166207">if</span>&nbsp;<span class="ident" id="4166210">err</span>&nbsp;<span class="op" id="4166214">:=</span>&nbsp;<span class="ident" id="4166217">fd</span><span class="op" id="4166219">.</span><span class="ident" id="4166220">listenStream</span><span class="op" id="4166232">(</span><span class="ident" id="4166233">laddr</span><span class="op" id="4166238">,</span>&nbsp;<span class="ident" id="4166240">listenerBacklog</span><span class="op" id="4166255">)</span><span class="op" id="4166256">;</span>&nbsp;<span class="ident" id="4166258">err</span>&nbsp;<span class="op" id="4166262">!=</span>&nbsp;<span class="ident" id="4166265">nil</span>&nbsp;<span class="op" id="4166269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166275">fd</span><span class="op" id="4166277">.</span><span class="ident" id="4166278">Close</span><span class="op" id="4166283">(</span><span class="op" id="4166284">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166290">return</span>&nbsp;<span class="ident" id="4166297">nil</span><span class="op" id="4166300">,</span>&nbsp;<span class="ident" id="4166302">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166314">return</span>&nbsp;<span class="ident" id="4166321">fd</span><span class="op" id="4166323">,</span>&nbsp;<span class="ident" id="4166325">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166331">case</span>&nbsp;<span class="ident" id="4166336">syscall</span><span class="op" id="4166343">.</span><span class="ident" id="4166344">SOCK_DGRAM</span><span class="op" id="4166354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166359">if</span>&nbsp;<span class="ident" id="4166362">err</span>&nbsp;<span class="op" id="4166366">:=</span>&nbsp;<span class="ident" id="4166369">fd</span><span class="op" id="4166371">.</span><span class="ident" id="4166372">listenDatagram</span><span class="op" id="4166386">(</span><span class="ident" id="4166387">laddr</span><span class="op" id="4166392">)</span><span class="op" id="4166393">;</span>&nbsp;<span class="ident" id="4166395">err</span>&nbsp;<span class="op" id="4166399">!=</span>&nbsp;<span class="ident" id="4166402">nil</span>&nbsp;<span class="op" id="4166406">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166412">fd</span><span class="op" id="4166414">.</span><span class="ident" id="4166415">Close</span><span class="op" id="4166420">(</span><span class="op" id="4166421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166427">return</span>&nbsp;<span class="ident" id="4166434">nil</span><span class="op" id="4166437">,</span>&nbsp;<span class="ident" id="4166439">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166451">return</span>&nbsp;<span class="ident" id="4166458">fd</span><span class="op" id="4166460">,</span>&nbsp;<span class="ident" id="4166462">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166468">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166474">if</span>&nbsp;<span class="ident" id="4166477">err</span>&nbsp;<span class="op" id="4166481">:=</span>&nbsp;<span class="ident" id="4166484">fd</span><span class="op" id="4166486">.</span><span class="ident" id="4166487">dial</span><span class="op" id="4166491">(</span><span class="ident" id="4166492">laddr</span><span class="op" id="4166497">,</span>&nbsp;<span class="ident" id="4166499">raddr</span><span class="op" id="4166504">,</span>&nbsp;<span class="ident" id="4166506">deadline</span><span class="op" id="4166514">)</span><span class="op" id="4166515">;</span>&nbsp;<span class="ident" id="4166517">err</span>&nbsp;<span class="op" id="4166521">!=</span>&nbsp;<span class="ident" id="4166524">nil</span>&nbsp;<span class="op" id="4166528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166532">fd</span><span class="op" id="4166534">.</span><span class="ident" id="4166535">Close</span><span class="op" id="4166540">(</span><span class="op" id="4166541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166545">return</span>&nbsp;<span class="ident" id="4166552">nil</span><span class="op" id="4166555">,</span>&nbsp;<span class="ident" id="4166557">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166562">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166565">return</span>&nbsp;<span class="ident" id="4166572">fd</span><span class="op" id="4166574">,</span>&nbsp;<span class="ident" id="4166576">nil</span><br>
<span class="lineno"></span><span class="op" id="4166580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4166583">func</span>&nbsp;<span class="op" id="4166588">(</span><span class="ident" id="4166589">fd</span>&nbsp;<span class="op" id="4166592">*</span><span class="ident" id="4166593">netFD</span><span class="op" id="4166598">)</span>&nbsp;<span class="ident" id="4166600">addrFunc</span><span class="op" id="4166608">(</span><span class="op" id="4166609">)</span>&nbsp;<span class="keyword" id="4166611">func</span><span class="op" id="4166615">(</span><span class="ident" id="4166616">syscall</span><span class="op" id="4166623">.</span><span class="ident" id="4166624">Sockaddr</span><span class="op" id="4166632">)</span>&nbsp;<span class="ident" id="4166634">Addr</span>&nbsp;<span class="op" id="4166639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166642">switch</span>&nbsp;<span class="ident" id="4166649">fd</span><span class="op" id="4166651">.</span><span class="ident" id="4166652">family</span>&nbsp;<span class="op" id="4166659">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166662">case</span>&nbsp;<span class="ident" id="4166667">syscall</span><span class="op" id="4166674">.</span><span class="ident" id="4166675">AF_INET</span><span class="op" id="4166682">,</span>&nbsp;<span class="ident" id="4166684">syscall</span><span class="op" id="4166691">.</span><span class="ident" id="4166692">AF_INET6</span><span class="op" id="4166700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166704">switch</span>&nbsp;<span class="ident" id="4166711">fd</span><span class="op" id="4166713">.</span><span class="ident" id="4166714">sotype</span>&nbsp;<span class="op" id="4166721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166725">case</span>&nbsp;<span class="ident" id="4166730">syscall</span><span class="op" id="4166737">.</span><span class="ident" id="4166738">SOCK_STREAM</span><span class="op" id="4166749">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166754">return</span>&nbsp;<span class="ident" id="4166761">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166777">case</span>&nbsp;<span class="ident" id="4166782">syscall</span><span class="op" id="4166789">.</span><span class="ident" id="4166790">SOCK_DGRAM</span><span class="op" id="4166800">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166805">return</span>&nbsp;<span class="ident" id="4166812">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166828">case</span>&nbsp;<span class="ident" id="4166833">syscall</span><span class="op" id="4166840">.</span><span class="ident" id="4166841">SOCK_RAW</span><span class="op" id="4166849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166854">return</span>&nbsp;<span class="ident" id="4166861">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166879">case</span>&nbsp;<span class="ident" id="4166884">syscall</span><span class="op" id="4166891">.</span><span class="ident" id="4166892">AF_UNIX</span><span class="op" id="4166899">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166903">switch</span>&nbsp;<span class="ident" id="4166910">fd</span><span class="op" id="4166912">.</span><span class="ident" id="4166913">sotype</span>&nbsp;<span class="op" id="4166920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166924">case</span>&nbsp;<span class="ident" id="4166929">syscall</span><span class="op" id="4166936">.</span><span class="ident" id="4166937">SOCK_STREAM</span><span class="op" id="4166948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166953">return</span>&nbsp;<span class="ident" id="4166960">sockaddrToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166977">case</span>&nbsp;<span class="ident" id="4166982">syscall</span><span class="op" id="4166989">.</span><span class="ident" id="4166990">SOCK_DGRAM</span><span class="op" id="4167000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167005">return</span>&nbsp;<span class="ident" id="4167012">sockaddrToUnixgram</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167033">case</span>&nbsp;<span class="ident" id="4167038">syscall</span><span class="op" id="4167045">.</span><span class="ident" id="4167046">SOCK_SEQPACKET</span><span class="op" id="4167060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167065">return</span>&nbsp;<span class="ident" id="4167072">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167101">return</span>&nbsp;<span class="keyword" id="4167108">func</span><span class="op" id="4167112">(</span><span class="ident" id="4167113">syscall</span><span class="op" id="4167120">.</span><span class="ident" id="4167121">Sockaddr</span><span class="op" id="4167129">)</span>&nbsp;<span class="ident" id="4167131">Addr</span>&nbsp;<span class="op" id="4167136">{</span>&nbsp;<span class="keyword" id="4167138">return</span>&nbsp;<span class="ident" id="4167145">nil</span>&nbsp;<span class="op" id="4167149">}</span><br>
<span class="lineno">120</span><span class="op" id="4167151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4167154">func</span>&nbsp;<span class="op" id="4167159">(</span><span class="ident" id="4167160">fd</span>&nbsp;<span class="op" id="4167163">*</span><span class="ident" id="4167164">netFD</span><span class="op" id="4167169">)</span>&nbsp;<span class="ident" id="4167171">dial</span><span class="op" id="4167175">(</span><span class="ident" id="4167176">laddr</span><span class="op" id="4167181">,</span>&nbsp;<span class="ident" id="4167183">raddr</span>&nbsp;<span class="ident" id="4167189">sockaddr</span><span class="op" id="4167197">,</span>&nbsp;<span class="ident" id="4167199">deadline</span>&nbsp;<span class="ident" id="4167208">time</span><span class="op" id="4167212">.</span><span class="ident" id="4167213">Time</span><span class="op" id="4167217">)</span>&nbsp;<span class="builtintype" id="4167219">error</span>&nbsp;<span class="op" id="4167225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167228">var</span>&nbsp;<span class="ident" id="4167232">err</span>&nbsp;<span class="builtintype" id="4167236">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167243">var</span>&nbsp;<span class="ident" id="4167247">lsa</span>&nbsp;<span class="ident" id="4167251">syscall</span><span class="op" id="4167258">.</span><span class="ident" id="4167259">Sockaddr</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167269">if</span>&nbsp;<span class="ident" id="4167272">laddr</span>&nbsp;<span class="op" id="4167278">!=</span>&nbsp;<span class="ident" id="4167281">nil</span>&nbsp;<span class="op" id="4167285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167289">if</span>&nbsp;<span class="ident" id="4167292">lsa</span><span class="op" id="4167295">,</span>&nbsp;<span class="ident" id="4167297">err</span>&nbsp;<span class="op" id="4167301">=</span>&nbsp;<span class="ident" id="4167303">laddr</span><span class="op" id="4167308">.</span><span class="ident" id="4167309">sockaddr</span><span class="op" id="4167317">(</span><span class="ident" id="4167318">fd</span><span class="op" id="4167320">.</span><span class="ident" id="4167321">family</span><span class="op" id="4167327">)</span><span class="op" id="4167328">;</span>&nbsp;<span class="ident" id="4167330">err</span>&nbsp;<span class="op" id="4167334">!=</span>&nbsp;<span class="ident" id="4167337">nil</span>&nbsp;<span class="op" id="4167341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167346">return</span>&nbsp;<span class="ident" id="4167353">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167359">}</span>&nbsp;<span class="keyword" id="4167361">else</span>&nbsp;<span class="keyword" id="4167366">if</span>&nbsp;<span class="ident" id="4167369">lsa</span>&nbsp;<span class="op" id="4167373">!=</span>&nbsp;<span class="ident" id="4167376">nil</span>&nbsp;<span class="op" id="4167380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167385">if</span>&nbsp;<span class="ident" id="4167388">err</span>&nbsp;<span class="op" id="4167392">:=</span>&nbsp;<span class="ident" id="4167395">syscall</span><span class="op" id="4167402">.</span><span class="ident" id="4167403">Bind</span><span class="op" id="4167407">(</span><span class="ident" id="4167408">fd</span><span class="op" id="4167410">.</span><span class="ident" id="4167411">sysfd</span><span class="op" id="4167416">,</span>&nbsp;<span class="ident" id="4167418">lsa</span><span class="op" id="4167421">)</span><span class="op" id="4167422">;</span>&nbsp;<span class="ident" id="4167424">err</span>&nbsp;<span class="op" id="4167428">!=</span>&nbsp;<span class="ident" id="4167431">nil</span>&nbsp;<span class="op" id="4167435">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167441">return</span>&nbsp;<span class="ident" id="4167448">os</span><span class="op" id="4167450">.</span><span class="ident" id="4167451">NewSyscallError</span><span class="op" id="4167466">(</span><span class="string" id="4167467">&#34;bind&#34;</span><span class="op" id="4167473">,</span>&nbsp;<span class="ident" id="4167475">err</span><span class="op" id="4167478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167493">var</span>&nbsp;<span class="ident" id="4167497">rsa</span>&nbsp;<span class="ident" id="4167501">syscall</span><span class="op" id="4167508">.</span><span class="ident" id="4167509">Sockaddr</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167519">if</span>&nbsp;<span class="ident" id="4167522">raddr</span>&nbsp;<span class="op" id="4167528">!=</span>&nbsp;<span class="ident" id="4167531">nil</span>&nbsp;<span class="op" id="4167535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167539">if</span>&nbsp;<span class="ident" id="4167542">rsa</span><span class="op" id="4167545">,</span>&nbsp;<span class="ident" id="4167547">err</span>&nbsp;<span class="op" id="4167551">=</span>&nbsp;<span class="ident" id="4167553">raddr</span><span class="op" id="4167558">.</span><span class="ident" id="4167559">sockaddr</span><span class="op" id="4167567">(</span><span class="ident" id="4167568">fd</span><span class="op" id="4167570">.</span><span class="ident" id="4167571">family</span><span class="op" id="4167577">)</span><span class="op" id="4167578">;</span>&nbsp;<span class="ident" id="4167580">err</span>&nbsp;<span class="op" id="4167584">!=</span>&nbsp;<span class="ident" id="4167587">nil</span>&nbsp;<span class="op" id="4167591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167596">return</span>&nbsp;<span class="ident" id="4167603">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167613">if</span>&nbsp;<span class="ident" id="4167616">err</span>&nbsp;<span class="op" id="4167620">:=</span>&nbsp;<span class="ident" id="4167623">fd</span><span class="op" id="4167625">.</span><span class="ident" id="4167626">connect</span><span class="op" id="4167633">(</span><span class="ident" id="4167634">lsa</span><span class="op" id="4167637">,</span>&nbsp;<span class="ident" id="4167639">rsa</span><span class="op" id="4167642">,</span>&nbsp;<span class="ident" id="4167644">deadline</span><span class="op" id="4167652">)</span><span class="op" id="4167653">;</span>&nbsp;<span class="ident" id="4167655">err</span>&nbsp;<span class="op" id="4167659">!=</span>&nbsp;<span class="ident" id="4167662">nil</span>&nbsp;<span class="op" id="4167666">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167671">return</span>&nbsp;<span class="ident" id="4167678">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167688">fd</span><span class="op" id="4167690">.</span><span class="ident" id="4167691">isConnected</span>&nbsp;<span class="op" id="4167703">=</span>&nbsp;<span class="builtintype" id="4167705">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167711">}</span>&nbsp;<span class="keyword" id="4167713">else</span>&nbsp;<span class="op" id="4167718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167722">if</span>&nbsp;<span class="ident" id="4167725">err</span>&nbsp;<span class="op" id="4167729">:=</span>&nbsp;<span class="ident" id="4167732">fd</span><span class="op" id="4167734">.</span><span class="ident" id="4167735">init</span><span class="op" id="4167739">(</span><span class="op" id="4167740">)</span><span class="op" id="4167741">;</span>&nbsp;<span class="ident" id="4167743">err</span>&nbsp;<span class="op" id="4167747">!=</span>&nbsp;<span class="ident" id="4167750">nil</span>&nbsp;<span class="op" id="4167754">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167759">return</span>&nbsp;<span class="ident" id="4167766">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167778">lsa</span><span class="op" id="4167781">,</span>&nbsp;<span class="ident" id="4167783">_</span>&nbsp;<span class="op" id="4167785">=</span>&nbsp;<span class="ident" id="4167787">syscall</span><span class="op" id="4167794">.</span><span class="ident" id="4167795">Getsockname</span><span class="op" id="4167806">(</span><span class="ident" id="4167807">fd</span><span class="op" id="4167809">.</span><span class="ident" id="4167810">sysfd</span><span class="op" id="4167815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167818">if</span>&nbsp;<span class="ident" id="4167821">rsa</span><span class="op" id="4167824">,</span>&nbsp;<span class="ident" id="4167826">_</span>&nbsp;<span class="op" id="4167828">=</span>&nbsp;<span class="ident" id="4167830">syscall</span><span class="op" id="4167837">.</span><span class="ident" id="4167838">Getpeername</span><span class="op" id="4167849">(</span><span class="ident" id="4167850">fd</span><span class="op" id="4167852">.</span><span class="ident" id="4167853">sysfd</span><span class="op" id="4167858">)</span><span class="op" id="4167859">;</span>&nbsp;<span class="ident" id="4167861">rsa</span>&nbsp;<span class="op" id="4167865">!=</span>&nbsp;<span class="ident" id="4167868">nil</span>&nbsp;<span class="op" id="4167872">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167876">fd</span><span class="op" id="4167878">.</span><span class="ident" id="4167879">setAddr</span><span class="op" id="4167886">(</span><span class="ident" id="4167887">fd</span><span class="op" id="4167889">.</span><span class="ident" id="4167890">addrFunc</span><span class="op" id="4167898">(</span><span class="op" id="4167899">)</span><span class="op" id="4167900">(</span><span class="ident" id="4167901">lsa</span><span class="op" id="4167904">)</span><span class="op" id="4167905">,</span>&nbsp;<span class="ident" id="4167907">fd</span><span class="op" id="4167909">.</span><span class="ident" id="4167910">addrFunc</span><span class="op" id="4167918">(</span><span class="op" id="4167919">)</span><span class="op" id="4167920">(</span><span class="ident" id="4167921">rsa</span><span class="op" id="4167924">)</span><span class="op" id="4167925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167928">}</span>&nbsp;<span class="keyword" id="4167930">else</span>&nbsp;<span class="op" id="4167935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167939">fd</span><span class="op" id="4167941">.</span><span class="ident" id="4167942">setAddr</span><span class="op" id="4167949">(</span><span class="ident" id="4167950">fd</span><span class="op" id="4167952">.</span><span class="ident" id="4167953">addrFunc</span><span class="op" id="4167961">(</span><span class="op" id="4167962">)</span><span class="op" id="4167963">(</span><span class="ident" id="4167964">lsa</span><span class="op" id="4167967">)</span><span class="op" id="4167968">,</span>&nbsp;<span class="ident" id="4167970">raddr</span><span class="op" id="4167975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167981">return</span>&nbsp;<span class="ident" id="4167988">nil</span><br>
<span class="lineno">155</span><span class="op" id="4167992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4167995">func</span>&nbsp;<span class="op" id="4168000">(</span><span class="ident" id="4168001">fd</span>&nbsp;<span class="op" id="4168004">*</span><span class="ident" id="4168005">netFD</span><span class="op" id="4168010">)</span>&nbsp;<span class="ident" id="4168012">listenStream</span><span class="op" id="4168024">(</span><span class="ident" id="4168025">laddr</span>&nbsp;<span class="ident" id="4168031">sockaddr</span><span class="op" id="4168039">,</span>&nbsp;<span class="ident" id="4168041">backlog</span>&nbsp;<span class="builtintype" id="4168049">int</span><span class="op" id="4168052">)</span>&nbsp;<span class="builtintype" id="4168054">error</span>&nbsp;<span class="op" id="4168060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168063">if</span>&nbsp;<span class="ident" id="4168066">err</span>&nbsp;<span class="op" id="4168070">:=</span>&nbsp;<span class="ident" id="4168073">setDefaultListenerSockopts</span><span class="op" id="4168099">(</span><span class="ident" id="4168100">fd</span><span class="op" id="4168102">.</span><span class="ident" id="4168103">sysfd</span><span class="op" id="4168108">)</span><span class="op" id="4168109">;</span>&nbsp;<span class="ident" id="4168111">err</span>&nbsp;<span class="op" id="4168115">!=</span>&nbsp;<span class="ident" id="4168118">nil</span>&nbsp;<span class="op" id="4168122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168126">return</span>&nbsp;<span class="ident" id="4168133">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4168138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168141">if</span>&nbsp;<span class="ident" id="4168144">lsa</span><span class="op" id="4168147">,</span>&nbsp;<span class="ident" id="4168149">err</span>&nbsp;<span class="op" id="4168153">:=</span>&nbsp;<span class="ident" id="4168156">laddr</span><span class="op" id="4168161">.</span><span class="ident" id="4168162">sockaddr</span><span class="op" id="4168170">(</span><span class="ident" id="4168171">fd</span><span class="op" id="4168173">.</span><span class="ident" id="4168174">family</span><span class="op" id="4168180">)</span><span class="op" id="4168181">;</span>&nbsp;<span class="ident" id="4168183">err</span>&nbsp;<span class="op" id="4168187">!=</span>&nbsp;<span class="ident" id="4168190">nil</span>&nbsp;<span class="op" id="4168194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168198">return</span>&nbsp;<span class="ident" id="4168205">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4168210">}</span>&nbsp;<span class="keyword" id="4168212">else</span>&nbsp;<span class="keyword" id="4168217">if</span>&nbsp;<span class="ident" id="4168220">lsa</span>&nbsp;<span class="op" id="4168224">!=</span>&nbsp;<span class="ident" id="4168227">nil</span>&nbsp;<span class="op" id="4168231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168235">if</span>&nbsp;<span class="ident" id="4168238">err</span>&nbsp;<span class="op" id="4168242">:=</span>&nbsp;<span class="ident" id="4168245">syscall</span><span class="op" id="4168252">.</span><span class="ident" id="4168253">Bind</span><span class="op" id="4168257">(</span><span class="ident" id="4168258">fd</span><span class="op" id="4168260">.</span><span class="ident" id="4168261">sysfd</span><span class="op" id="4168266">,</span>&nbsp;<span class="ident" id="4168268">lsa</span><span class="op" id="4168271">)</span><span class="op" id="4168272">;</span>&nbsp;<span class="ident" id="4168274">err</span>&nbsp;<span class="op" id="4168278">!=</span>&nbsp;<span class="ident" id="4168281">nil</span>&nbsp;<span class="op" id="4168285">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168290">return</span>&nbsp;<span class="ident" id="4168297">os</span><span class="op" id="4168299">.</span><span class="ident" id="4168300">NewSyscallError</span><span class="op" id="4168315">(</span><span class="string" id="4168316">&#34;bind&#34;</span><span class="op" id="4168322">,</span>&nbsp;<span class="ident" id="4168324">err</span><span class="op" id="4168327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4168331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4168334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168337">if</span>&nbsp;<span class="ident" id="4168340">err</span>&nbsp;<span class="op" id="4168344">:=</span>&nbsp;<span class="ident" id="4168347">syscall</span><span class="op" id="4168354">.</span><span class="ident" id="4168355">Listen</span><span class="op" id="4168361">(</span><span class="ident" id="4168362">fd</span><span class="op" id="4168364">.</span><span class="ident" id="4168365">sysfd</span><span class="op" id="4168370">,</span>&nbsp;<span class="ident" id="4168372">backlog</span><span class="op" id="4168379">)</span><span class="op" id="4168380">;</span>&nbsp;<span class="ident" id="4168382">err</span>&nbsp;<span class="op" id="4168386">!=</span>&nbsp;<span class="ident" id="4168389">nil</span>&nbsp;<span class="op" id="4168393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168397">return</span>&nbsp;<span class="ident" id="4168404">os</span><span class="op" id="4168406">.</span><span class="ident" id="4168407">NewSyscallError</span><span class="op" id="4168422">(</span><span class="string" id="4168423">&#34;listen&#34;</span><span class="op" id="4168431">,</span>&nbsp;<span class="ident" id="4168433">err</span><span class="op" id="4168436">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4168439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168442">if</span>&nbsp;<span class="ident" id="4168445">err</span>&nbsp;<span class="op" id="4168449">:=</span>&nbsp;<span class="ident" id="4168452">fd</span><span class="op" id="4168454">.</span><span class="ident" id="4168455">init</span><span class="op" id="4168459">(</span><span class="op" id="4168460">)</span><span class="op" id="4168461">;</span>&nbsp;<span class="ident" id="4168463">err</span>&nbsp;<span class="op" id="4168467">!=</span>&nbsp;<span class="ident" id="4168470">nil</span>&nbsp;<span class="op" id="4168474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168478">return</span>&nbsp;<span class="ident" id="4168485">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4168490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168493">lsa</span><span class="op" id="4168496">,</span>&nbsp;<span class="ident" id="4168498">_</span>&nbsp;<span class="op" id="4168500">:=</span>&nbsp;<span class="ident" id="4168503">syscall</span><span class="op" id="4168510">.</span><span class="ident" id="4168511">Getsockname</span><span class="op" id="4168522">(</span><span class="ident" id="4168523">fd</span><span class="op" id="4168525">.</span><span class="ident" id="4168526">sysfd</span><span class="op" id="4168531">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168534">fd</span><span class="op" id="4168536">.</span><span class="ident" id="4168537">setAddr</span><span class="op" id="4168544">(</span><span class="ident" id="4168545">fd</span><span class="op" id="4168547">.</span><span class="ident" id="4168548">addrFunc</span><span class="op" id="4168556">(</span><span class="op" id="4168557">)</span><span class="op" id="4168558">(</span><span class="ident" id="4168559">lsa</span><span class="op" id="4168562">)</span><span class="op" id="4168563">,</span>&nbsp;<span class="ident" id="4168565">nil</span><span class="op" id="4168568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168571">return</span>&nbsp;<span class="ident" id="4168578">nil</span><br>
<span class="lineno"></span><span class="op" id="4168582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4168585">func</span>&nbsp;<span class="op" id="4168590">(</span><span class="ident" id="4168591">fd</span>&nbsp;<span class="op" id="4168594">*</span><span class="ident" id="4168595">netFD</span><span class="op" id="4168600">)</span>&nbsp;<span class="ident" id="4168602">listenDatagram</span><span class="op" id="4168616">(</span><span class="ident" id="4168617">laddr</span>&nbsp;<span class="ident" id="4168623">sockaddr</span><span class="op" id="4168631">)</span>&nbsp;<span class="builtintype" id="4168633">error</span>&nbsp;<span class="op" id="4168639">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168642">switch</span>&nbsp;<span class="ident" id="4168649">addr</span>&nbsp;<span class="op" id="4168654">:=</span>&nbsp;<span class="ident" id="4168657">laddr</span><span class="op" id="4168662">.</span><span class="op" id="4168663">(</span><span class="keyword" id="4168664">type</span><span class="op" id="4168668">)</span>&nbsp;<span class="op" id="4168670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168673">case</span>&nbsp;<span class="op" id="4168678">*</span><span class="ident" id="4168679">UDPAddr</span><span class="op" id="4168686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4168690">//&nbsp;We&nbsp;provide&nbsp;a&nbsp;socket&nbsp;that&nbsp;listens&nbsp;to&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4168742">//&nbsp;address&nbsp;with&nbsp;reusable&nbsp;UDP&nbsp;port&nbsp;when&nbsp;the&nbsp;given&nbsp;laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4168799">//&nbsp;is&nbsp;an&nbsp;appropriate&nbsp;UDP&nbsp;multicast&nbsp;address&nbsp;prefix.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4168852">//&nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;for&nbsp;a&nbsp;single&nbsp;UDP&nbsp;listener&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4168909">//&nbsp;join&nbsp;multiple&nbsp;different&nbsp;group&nbsp;addresses,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4168959">//&nbsp;multiple&nbsp;UDP&nbsp;listeners&nbsp;that&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;UDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4169015">//&nbsp;port&nbsp;to&nbsp;join&nbsp;the&nbsp;same&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169057">if</span>&nbsp;<span class="ident" id="4169060">addr</span><span class="op" id="4169064">.</span><span class="ident" id="4169065">IP</span>&nbsp;<span class="op" id="4169068">!=</span>&nbsp;<span class="ident" id="4169071">nil</span>&nbsp;<span class="op" id="4169075">&amp;&amp;</span>&nbsp;<span class="ident" id="4169078">addr</span><span class="op" id="4169082">.</span><span class="ident" id="4169083">IP</span><span class="op" id="4169085">.</span><span class="ident" id="4169086">IsMulticast</span><span class="op" id="4169097">(</span><span class="op" id="4169098">)</span>&nbsp;<span class="op" id="4169100">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169105">if</span>&nbsp;<span class="ident" id="4169108">err</span>&nbsp;<span class="op" id="4169112">:=</span>&nbsp;<span class="ident" id="4169115">setDefaultMulticastSockopts</span><span class="op" id="4169142">(</span><span class="ident" id="4169143">fd</span><span class="op" id="4169145">.</span><span class="ident" id="4169146">sysfd</span><span class="op" id="4169151">)</span><span class="op" id="4169152">;</span>&nbsp;<span class="ident" id="4169154">err</span>&nbsp;<span class="op" id="4169158">!=</span>&nbsp;<span class="ident" id="4169161">nil</span>&nbsp;<span class="op" id="4169165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169171">return</span>&nbsp;<span class="ident" id="4169178">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4169185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169190">addr</span>&nbsp;<span class="op" id="4169195">:=</span>&nbsp;<span class="op" id="4169198">*</span><span class="ident" id="4169199">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169207">switch</span>&nbsp;<span class="ident" id="4169214">fd</span><span class="op" id="4169216">.</span><span class="ident" id="4169217">family</span>&nbsp;<span class="op" id="4169224">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169229">case</span>&nbsp;<span class="ident" id="4169234">syscall</span><span class="op" id="4169241">.</span><span class="ident" id="4169242">AF_INET</span><span class="op" id="4169249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169255">addr</span><span class="op" id="4169259">.</span><span class="ident" id="4169260">IP</span>&nbsp;<span class="op" id="4169263">=</span>&nbsp;<span class="ident" id="4169265">IPv4zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169277">case</span>&nbsp;<span class="ident" id="4169282">syscall</span><span class="op" id="4169289">.</span><span class="ident" id="4169290">AF_INET6</span><span class="op" id="4169298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169304">addr</span><span class="op" id="4169308">.</span><span class="ident" id="4169309">IP</span>&nbsp;<span class="op" id="4169312">=</span>&nbsp;<span class="ident" id="4169314">IPv6unspecified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4169333">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169338">laddr</span>&nbsp;<span class="op" id="4169344">=</span>&nbsp;<span class="op" id="4169346">&amp;</span><span class="ident" id="4169347">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4169354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4169357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169360">if</span>&nbsp;<span class="ident" id="4169363">lsa</span><span class="op" id="4169366">,</span>&nbsp;<span class="ident" id="4169368">err</span>&nbsp;<span class="op" id="4169372">:=</span>&nbsp;<span class="ident" id="4169375">laddr</span><span class="op" id="4169380">.</span><span class="ident" id="4169381">sockaddr</span><span class="op" id="4169389">(</span><span class="ident" id="4169390">fd</span><span class="op" id="4169392">.</span><span class="ident" id="4169393">family</span><span class="op" id="4169399">)</span><span class="op" id="4169400">;</span>&nbsp;<span class="ident" id="4169402">err</span>&nbsp;<span class="op" id="4169406">!=</span>&nbsp;<span class="ident" id="4169409">nil</span>&nbsp;<span class="op" id="4169413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169417">return</span>&nbsp;<span class="ident" id="4169424">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4169429">}</span>&nbsp;<span class="keyword" id="4169431">else</span>&nbsp;<span class="keyword" id="4169436">if</span>&nbsp;<span class="ident" id="4169439">lsa</span>&nbsp;<span class="op" id="4169443">!=</span>&nbsp;<span class="ident" id="4169446">nil</span>&nbsp;<span class="op" id="4169450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169454">if</span>&nbsp;<span class="ident" id="4169457">err</span>&nbsp;<span class="op" id="4169461">:=</span>&nbsp;<span class="ident" id="4169464">syscall</span><span class="op" id="4169471">.</span><span class="ident" id="4169472">Bind</span><span class="op" id="4169476">(</span><span class="ident" id="4169477">fd</span><span class="op" id="4169479">.</span><span class="ident" id="4169480">sysfd</span><span class="op" id="4169485">,</span>&nbsp;<span class="ident" id="4169487">lsa</span><span class="op" id="4169490">)</span><span class="op" id="4169491">;</span>&nbsp;<span class="ident" id="4169493">err</span>&nbsp;<span class="op" id="4169497">!=</span>&nbsp;<span class="ident" id="4169500">nil</span>&nbsp;<span class="op" id="4169504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169509">return</span>&nbsp;<span class="ident" id="4169516">os</span><span class="op" id="4169518">.</span><span class="ident" id="4169519">NewSyscallError</span><span class="op" id="4169534">(</span><span class="string" id="4169535">&#34;bind&#34;</span><span class="op" id="4169541">,</span>&nbsp;<span class="ident" id="4169543">err</span><span class="op" id="4169546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4169550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4169553">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169556">if</span>&nbsp;<span class="ident" id="4169559">err</span>&nbsp;<span class="op" id="4169563">:=</span>&nbsp;<span class="ident" id="4169566">fd</span><span class="op" id="4169568">.</span><span class="ident" id="4169569">init</span><span class="op" id="4169573">(</span><span class="op" id="4169574">)</span><span class="op" id="4169575">;</span>&nbsp;<span class="ident" id="4169577">err</span>&nbsp;<span class="op" id="4169581">!=</span>&nbsp;<span class="ident" id="4169584">nil</span>&nbsp;<span class="op" id="4169588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169592">return</span>&nbsp;<span class="ident" id="4169599">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4169604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169607">lsa</span><span class="op" id="4169610">,</span>&nbsp;<span class="ident" id="4169612">_</span>&nbsp;<span class="op" id="4169614">:=</span>&nbsp;<span class="ident" id="4169617">syscall</span><span class="op" id="4169624">.</span><span class="ident" id="4169625">Getsockname</span><span class="op" id="4169636">(</span><span class="ident" id="4169637">fd</span><span class="op" id="4169639">.</span><span class="ident" id="4169640">sysfd</span><span class="op" id="4169645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169648">fd</span><span class="op" id="4169650">.</span><span class="ident" id="4169651">setAddr</span><span class="op" id="4169658">(</span><span class="ident" id="4169659">fd</span><span class="op" id="4169661">.</span><span class="ident" id="4169662">addrFunc</span><span class="op" id="4169670">(</span><span class="op" id="4169671">)</span><span class="op" id="4169672">(</span><span class="ident" id="4169673">lsa</span><span class="op" id="4169676">)</span><span class="op" id="4169677">,</span>&nbsp;<span class="ident" id="4169679">nil</span><span class="op" id="4169682">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169685">return</span>&nbsp;<span class="ident" id="4169692">nil</span><br>
<span class="lineno"></span><span class="op" id="4169696">}</span>
</div>
</body>
</html>
