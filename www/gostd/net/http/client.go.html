<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html" class="current">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3460990">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3461045">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3461099">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3461150">//&nbsp;HTTP&nbsp;client.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="3461180">//</span><br>
<span class="lineno"></span><span class="comment" id="3461183">//&nbsp;This&nbsp;is&nbsp;the&nbsp;high-level&nbsp;Client&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="3461227">//&nbsp;The&nbsp;low-level&nbsp;implementation&nbsp;is&nbsp;in&nbsp;transport.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3461280">package</span>&nbsp;<span class="ident" id="3461288">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3461294">import</span>&nbsp;<span class="op" id="3461301">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461304">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461323">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461333">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461340">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461346">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461359">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461366">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461377">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461388">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461396">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3461403">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3461406">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;client.&nbsp;Its&nbsp;zero&nbsp;value&nbsp;(DefaultClient)&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3461473">//&nbsp;usable&nbsp;client&nbsp;that&nbsp;uses&nbsp;DefaultTransport.</span><br>
<span class="lineno"></span><span class="comment" id="3461518">//</span><br>
<span class="lineno"></span><span class="comment" id="3461521">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;typically&nbsp;has&nbsp;internal&nbsp;state&nbsp;(cached&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="3461588">//&nbsp;connections),&nbsp;so&nbsp;Clients&nbsp;should&nbsp;be&nbsp;reused&nbsp;instead&nbsp;of&nbsp;created&nbsp;as</span><br>
<span class="lineno">30</span><span class="comment" id="3461655">//&nbsp;needed.&nbsp;Clients&nbsp;are&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="3461726">//</span><br>
<span class="lineno"></span><span class="comment" id="3461729">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;higher-level&nbsp;than&nbsp;a&nbsp;RoundTripper&nbsp;(such&nbsp;as&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="3461797">//&nbsp;and&nbsp;additionally&nbsp;handles&nbsp;HTTP&nbsp;details&nbsp;such&nbsp;as&nbsp;cookies&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3461858">//&nbsp;redirects.</span><br>
<span class="lineno">35</span><span class="keyword" id="3461872">type</span>&nbsp;<span class="ident" id="3461877">Client</span>&nbsp;<span class="keyword" id="3461884">struct</span>&nbsp;<span class="op" id="3461891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3461894">//&nbsp;Transport&nbsp;specifies&nbsp;the&nbsp;mechanism&nbsp;by&nbsp;which&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3461952">//&nbsp;HTTP&nbsp;requests&nbsp;are&nbsp;made.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3461980">//&nbsp;If&nbsp;nil,&nbsp;DefaultTransport&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462018">Transport</span>&nbsp;<span class="ident" id="3462028">RoundTripper</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462043">//&nbsp;CheckRedirect&nbsp;specifies&nbsp;the&nbsp;policy&nbsp;for&nbsp;handling&nbsp;redirects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462106">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;not&nbsp;nil,&nbsp;the&nbsp;client&nbsp;calls&nbsp;it&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462166">//&nbsp;following&nbsp;an&nbsp;HTTP&nbsp;redirect.&nbsp;The&nbsp;arguments&nbsp;req&nbsp;and&nbsp;via&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462228">//&nbsp;the&nbsp;upcoming&nbsp;request&nbsp;and&nbsp;the&nbsp;requests&nbsp;made&nbsp;already,&nbsp;oldest</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462291">//&nbsp;first.&nbsp;If&nbsp;CheckRedirect&nbsp;returns&nbsp;an&nbsp;error,&nbsp;the&nbsp;Client&#39;s&nbsp;Get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462354">//&nbsp;method&nbsp;returns&nbsp;both&nbsp;the&nbsp;previous&nbsp;Response&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462404">//&nbsp;CheckRedirect&#39;s&nbsp;error&nbsp;(wrapped&nbsp;in&nbsp;a&nbsp;url.Error)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462466">//&nbsp;issuing&nbsp;the&nbsp;Request&nbsp;req.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462495">//</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462499">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;nil,&nbsp;the&nbsp;Client&nbsp;uses&nbsp;its&nbsp;default&nbsp;policy,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462564">//&nbsp;which&nbsp;is&nbsp;to&nbsp;stop&nbsp;after&nbsp;10&nbsp;consecutive&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462616">CheckRedirect</span>&nbsp;<span class="keyword" id="3462630">func</span><span class="op" id="3462634">(</span><span class="ident" id="3462635">req</span>&nbsp;<span class="op" id="3462639">*</span><span class="ident" id="3462640">Request</span><span class="op" id="3462647">,</span>&nbsp;<span class="ident" id="3462649">via</span>&nbsp;<span class="op" id="3462653">[</span><span class="op" id="3462654">]</span><span class="op" id="3462655">*</span><span class="ident" id="3462656">Request</span><span class="op" id="3462663">)</span>&nbsp;<span class="builtintype" id="3462665">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462673">//&nbsp;Jar&nbsp;specifies&nbsp;the&nbsp;cookie&nbsp;jar.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462707">//&nbsp;If&nbsp;Jar&nbsp;is&nbsp;nil,&nbsp;cookies&nbsp;are&nbsp;not&nbsp;sent&nbsp;in&nbsp;requests&nbsp;and&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462771">//&nbsp;in&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462789">Jar</span>&nbsp;<span class="ident" id="3462793">CookieJar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462805">//&nbsp;Timeout&nbsp;specifies&nbsp;a&nbsp;time&nbsp;limit&nbsp;for&nbsp;requests&nbsp;made&nbsp;by&nbsp;this</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462866">//&nbsp;Client.&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;connection&nbsp;time,&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462920">//&nbsp;redirects,&nbsp;and&nbsp;reading&nbsp;the&nbsp;response&nbsp;body.&nbsp;The&nbsp;timer&nbsp;remains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462984">//&nbsp;running&nbsp;after&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do&nbsp;return&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463041">//&nbsp;interrupt&nbsp;reading&nbsp;of&nbsp;the&nbsp;Response.Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463085">//</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463089">//&nbsp;A&nbsp;Timeout&nbsp;of&nbsp;zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463129">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463133">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;must&nbsp;support&nbsp;the&nbsp;CancelRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463191">//&nbsp;method&nbsp;or&nbsp;Client&nbsp;will&nbsp;return&nbsp;errors&nbsp;when&nbsp;attempting&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463255">//&nbsp;a&nbsp;request&nbsp;with&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do.&nbsp;Client&#39;s&nbsp;default</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463315">//&nbsp;Transport&nbsp;(DefaultTransport)&nbsp;supports&nbsp;CancelRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463372">Timeout</span>&nbsp;<span class="ident" id="3463380">time</span><span class="op" id="3463384">.</span><span class="ident" id="3463385">Duration</span><br>
<span class="lineno"></span><span class="op" id="3463394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3463397">//&nbsp;DefaultClient&nbsp;is&nbsp;the&nbsp;default&nbsp;Client&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;Get,&nbsp;Head,&nbsp;and&nbsp;Post.</span><br>
<span class="lineno">75</span><span class="keyword" id="3463472">var</span>&nbsp;<span class="ident" id="3463476">DefaultClient</span>&nbsp;<span class="op" id="3463490">=</span>&nbsp;<span class="op" id="3463492">&amp;</span><span class="ident" id="3463493">Client</span><span class="op" id="3463499">{</span><span class="op" id="3463500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3463503">//&nbsp;RoundTripper&nbsp;is&nbsp;an&nbsp;interface&nbsp;representing&nbsp;the&nbsp;ability&nbsp;to&nbsp;execute&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3463573">//&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;obtaining&nbsp;the&nbsp;Response&nbsp;for&nbsp;a&nbsp;given&nbsp;Request.</span><br>
<span class="lineno"></span><span class="comment" id="3463645">//</span><br>
<span class="lineno">80</span><span class="comment" id="3463648">//&nbsp;A&nbsp;RoundTripper&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="3463710">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3463725">type</span>&nbsp;<span class="ident" id="3463730">RoundTripper</span>&nbsp;<span class="keyword" id="3463743">interface</span>&nbsp;<span class="op" id="3463753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463756">//&nbsp;RoundTrip&nbsp;executes&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463816">//&nbsp;the&nbsp;Response&nbsp;for&nbsp;the&nbsp;request&nbsp;req.&nbsp;&nbsp;RoundTrip&nbsp;should&nbsp;not</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463876">//&nbsp;attempt&nbsp;to&nbsp;interpret&nbsp;the&nbsp;response.&nbsp;&nbsp;In&nbsp;particular,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463931">//&nbsp;RoundTrip&nbsp;must&nbsp;return&nbsp;err&nbsp;==&nbsp;nil&nbsp;if&nbsp;it&nbsp;obtained&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463995">//&nbsp;regardless&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;HTTP&nbsp;status&nbsp;code.&nbsp;&nbsp;A&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464057">//&nbsp;err&nbsp;should&nbsp;be&nbsp;reserved&nbsp;for&nbsp;failure&nbsp;to&nbsp;obtain&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464118">//&nbsp;Similarly,&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;attempt&nbsp;to&nbsp;handle</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464172">//&nbsp;higher-level&nbsp;protocol&nbsp;details&nbsp;such&nbsp;as&nbsp;redirects,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464225">//&nbsp;authentication,&nbsp;or&nbsp;cookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464257">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464261">//&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;modify&nbsp;the&nbsp;request,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464317">//&nbsp;consuming&nbsp;and&nbsp;closing&nbsp;the&nbsp;Body,&nbsp;including&nbsp;on&nbsp;errors.&nbsp;The</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464378">//&nbsp;request&#39;s&nbsp;URL&nbsp;and&nbsp;Header&nbsp;fields&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464435">//&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464452">RoundTrip</span><span class="op" id="3464461">(</span><span class="op" id="3464462">*</span><span class="ident" id="3464463">Request</span><span class="op" id="3464470">)</span>&nbsp;<span class="op" id="3464472">(</span><span class="op" id="3464473">*</span><span class="ident" id="3464474">Response</span><span class="op" id="3464482">,</span>&nbsp;<span class="builtintype" id="3464484">error</span><span class="op" id="3464489">)</span><br>
<span class="lineno"></span><span class="op" id="3464491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="3464494">//&nbsp;Given&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host&#34;,&nbsp;&#34;host:port&#34;,&nbsp;or&nbsp;&#34;[ipv6::address]:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3464572">//&nbsp;return&nbsp;true&nbsp;if&nbsp;the&nbsp;string&nbsp;includes&nbsp;a&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="3464618">func</span>&nbsp;<span class="ident" id="3464623">hasPort</span><span class="op" id="3464630">(</span><span class="ident" id="3464631">s</span>&nbsp;<span class="builtintype" id="3464633">string</span><span class="op" id="3464639">)</span>&nbsp;<span class="builtintype" id="3464641">bool</span>&nbsp;<span class="op" id="3464646">{</span>&nbsp;<span class="keyword" id="3464648">return</span>&nbsp;<span class="ident" id="3464655">strings</span><span class="op" id="3464662">.</span><span class="ident" id="3464663">LastIndex</span><span class="op" id="3464672">(</span><span class="ident" id="3464673">s</span><span class="op" id="3464674">,</span>&nbsp;<span class="string" id="3464676">&#34;:&#34;</span><span class="op" id="3464679">)</span>&nbsp;<span class="op" id="3464681">&gt;</span>&nbsp;<span class="ident" id="3464683">strings</span><span class="op" id="3464690">.</span><span class="ident" id="3464691">LastIndex</span><span class="op" id="3464700">(</span><span class="ident" id="3464701">s</span><span class="op" id="3464702">,</span>&nbsp;<span class="string" id="3464704">&#34;]&#34;</span><span class="op" id="3464707">)</span>&nbsp;<span class="op" id="3464709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3464712">//&nbsp;refererForURL&nbsp;returns&nbsp;a&nbsp;referer&nbsp;without&nbsp;any&nbsp;authentication&nbsp;info&nbsp;or</span><br>
<span class="lineno">105</span><span class="comment" id="3464782">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;if&nbsp;lastReq&nbsp;scheme&nbsp;is&nbsp;https&nbsp;and&nbsp;newReq&nbsp;scheme&nbsp;is&nbsp;http.</span><br>
<span class="lineno"></span><span class="keyword" id="3464855">func</span>&nbsp;<span class="ident" id="3464860">refererForURL</span><span class="op" id="3464873">(</span><span class="ident" id="3464874">lastReq</span><span class="op" id="3464881">,</span>&nbsp;<span class="ident" id="3464883">newReq</span>&nbsp;<span class="op" id="3464890">*</span><span class="ident" id="3464891">url</span><span class="op" id="3464894">.</span><span class="ident" id="3464895">URL</span><span class="op" id="3464898">)</span>&nbsp;<span class="builtintype" id="3464900">string</span>&nbsp;<span class="op" id="3464907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464910">//&nbsp;https://tools.ietf.org/html/rfc7231#section-5.5.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464964">//&nbsp;&nbsp;&nbsp;&#34;Clients&nbsp;SHOULD&nbsp;NOT&nbsp;include&nbsp;a&nbsp;Referer&nbsp;header&nbsp;field&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3465026">//&nbsp;&nbsp;&nbsp;&nbsp;(non-secure)&nbsp;HTTP&nbsp;request&nbsp;if&nbsp;the&nbsp;referring&nbsp;page&nbsp;was</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3465085">//&nbsp;&nbsp;&nbsp;&nbsp;transferred&nbsp;with&nbsp;a&nbsp;secure&nbsp;protocol.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465129">if</span>&nbsp;<span class="ident" id="3465132">lastReq</span><span class="op" id="3465139">.</span><span class="ident" id="3465140">Scheme</span>&nbsp;<span class="op" id="3465147">==</span>&nbsp;<span class="string" id="3465150">&#34;https&#34;</span>&nbsp;<span class="op" id="3465158">&amp;&amp;</span>&nbsp;<span class="ident" id="3465161">newReq</span><span class="op" id="3465167">.</span><span class="ident" id="3465168">Scheme</span>&nbsp;<span class="op" id="3465175">==</span>&nbsp;<span class="string" id="3465178">&#34;http&#34;</span>&nbsp;<span class="op" id="3465185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465189">return</span>&nbsp;<span class="string" id="3465196">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465203">referer</span>&nbsp;<span class="op" id="3465211">:=</span>&nbsp;<span class="ident" id="3465214">lastReq</span><span class="op" id="3465221">.</span><span class="ident" id="3465222">String</span><span class="op" id="3465228">(</span><span class="op" id="3465229">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465232">if</span>&nbsp;<span class="ident" id="3465235">lastReq</span><span class="op" id="3465242">.</span><span class="ident" id="3465243">User</span>&nbsp;<span class="op" id="3465248">!=</span>&nbsp;<span class="builtintype" id="3465251">nil</span>&nbsp;<span class="op" id="3465255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3465259">//&nbsp;This&nbsp;is&nbsp;not&nbsp;very&nbsp;efficient,&nbsp;but&nbsp;is&nbsp;the&nbsp;best&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3465315">//&nbsp;do&nbsp;without:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3465332">//&nbsp;-&nbsp;introducing&nbsp;a&nbsp;new&nbsp;method&nbsp;on&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3465371">//&nbsp;-&nbsp;creating&nbsp;a&nbsp;race&nbsp;condition</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3465404">//&nbsp;-&nbsp;copying&nbsp;the&nbsp;URL&nbsp;struct&nbsp;manually,&nbsp;which&nbsp;would&nbsp;cause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3465462">//&nbsp;&nbsp;&nbsp;maintenance&nbsp;problems&nbsp;down&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465504">auth</span>&nbsp;<span class="op" id="3465509">:=</span>&nbsp;<span class="ident" id="3465512">lastReq</span><span class="op" id="3465519">.</span><span class="ident" id="3465520">User</span><span class="op" id="3465524">.</span><span class="ident" id="3465525">String</span><span class="op" id="3465531">(</span><span class="op" id="3465532">)</span>&nbsp;<span class="op" id="3465534">+</span>&nbsp;<span class="string" id="3465536">&#34;@&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465542">referer</span>&nbsp;<span class="op" id="3465550">=</span>&nbsp;<span class="ident" id="3465552">strings</span><span class="op" id="3465559">.</span><span class="ident" id="3465560">Replace</span><span class="op" id="3465567">(</span><span class="ident" id="3465568">referer</span><span class="op" id="3465575">,</span>&nbsp;<span class="ident" id="3465577">auth</span><span class="op" id="3465581">,</span>&nbsp;<span class="string" id="3465583">&#34;&#34;</span><span class="op" id="3465585">,</span>&nbsp;<span class="num" id="3465587">1</span><span class="op" id="3465588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465591">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465594">return</span>&nbsp;<span class="ident" id="3465601">referer</span><br>
<span class="lineno"></span><span class="op" id="3465609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3465612">//&nbsp;Used&nbsp;in&nbsp;Send&nbsp;to&nbsp;implement&nbsp;io.ReadCloser&nbsp;by&nbsp;bundling&nbsp;together&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3465680">//&nbsp;bufio.Reader&nbsp;through&nbsp;which&nbsp;we&nbsp;read&nbsp;the&nbsp;response,&nbsp;and&nbsp;the&nbsp;underlying</span><br>
<span class="lineno">130</span><span class="comment" id="3465751">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3465774">type</span>&nbsp;<span class="ident" id="3465779">readClose</span>&nbsp;<span class="keyword" id="3465789">struct</span>&nbsp;<span class="op" id="3465796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465799">io</span><span class="op" id="3465801">.</span><span class="ident" id="3465802">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465810">io</span><span class="op" id="3465812">.</span><span class="ident" id="3465813">Closer</span><br>
<span class="lineno"></span><span class="op" id="3465820">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="3465823">func</span>&nbsp;<span class="op" id="3465828">(</span><span class="ident" id="3465829">c</span>&nbsp;<span class="op" id="3465831">*</span><span class="ident" id="3465832">Client</span><span class="op" id="3465838">)</span>&nbsp;<span class="ident" id="3465840">send</span><span class="op" id="3465844">(</span><span class="ident" id="3465845">req</span>&nbsp;<span class="op" id="3465849">*</span><span class="ident" id="3465850">Request</span><span class="op" id="3465857">)</span>&nbsp;<span class="op" id="3465859">(</span><span class="op" id="3465860">*</span><span class="ident" id="3465861">Response</span><span class="op" id="3465869">,</span>&nbsp;<span class="builtintype" id="3465871">error</span><span class="op" id="3465876">)</span>&nbsp;<span class="op" id="3465878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465881">if</span>&nbsp;<span class="ident" id="3465884">c</span><span class="op" id="3465885">.</span><span class="ident" id="3465886">Jar</span>&nbsp;<span class="op" id="3465890">!=</span>&nbsp;<span class="builtintype" id="3465893">nil</span>&nbsp;<span class="op" id="3465897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465901">for</span>&nbsp;<span class="ident" id="3465905">_</span><span class="op" id="3465906">,</span>&nbsp;<span class="ident" id="3465908">cookie</span>&nbsp;<span class="op" id="3465915">:=</span>&nbsp;<span class="keyword" id="3465918">range</span>&nbsp;<span class="ident" id="3465924">c</span><span class="op" id="3465925">.</span><span class="ident" id="3465926">Jar</span><span class="op" id="3465929">.</span><span class="ident" id="3465930">Cookies</span><span class="op" id="3465937">(</span><span class="ident" id="3465938">req</span><span class="op" id="3465941">.</span><span class="ident" id="3465942">URL</span><span class="op" id="3465945">)</span>&nbsp;<span class="op" id="3465947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465952">req</span><span class="op" id="3465955">.</span><span class="ident" id="3465956">AddCookie</span><span class="op" id="3465965">(</span><span class="ident" id="3465966">cookie</span><span class="op" id="3465972">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465982">resp</span><span class="op" id="3465986">,</span>&nbsp;<span class="ident" id="3465988">err</span>&nbsp;<span class="op" id="3465992">:=</span>&nbsp;<span class="ident" id="3465995">send</span><span class="op" id="3465999">(</span><span class="ident" id="3466000">req</span><span class="op" id="3466003">,</span>&nbsp;<span class="ident" id="3466005">c</span><span class="op" id="3466006">.</span><span class="ident" id="3466007">transport</span><span class="op" id="3466016">(</span><span class="op" id="3466017">)</span><span class="op" id="3466018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466021">if</span>&nbsp;<span class="ident" id="3466024">err</span>&nbsp;<span class="op" id="3466028">!=</span>&nbsp;<span class="builtintype" id="3466031">nil</span>&nbsp;<span class="op" id="3466035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466039">return</span>&nbsp;<span class="builtintype" id="3466046">nil</span><span class="op" id="3466049">,</span>&nbsp;<span class="ident" id="3466051">err</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466059">if</span>&nbsp;<span class="ident" id="3466062">c</span><span class="op" id="3466063">.</span><span class="ident" id="3466064">Jar</span>&nbsp;<span class="op" id="3466068">!=</span>&nbsp;<span class="builtintype" id="3466071">nil</span>&nbsp;<span class="op" id="3466075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466079">if</span>&nbsp;<span class="ident" id="3466082">rc</span>&nbsp;<span class="op" id="3466085">:=</span>&nbsp;<span class="ident" id="3466088">resp</span><span class="op" id="3466092">.</span><span class="ident" id="3466093">Cookies</span><span class="op" id="3466100">(</span><span class="op" id="3466101">)</span><span class="op" id="3466102">;</span>&nbsp;<span class="builtinfunc" id="3466104">len</span><span class="op" id="3466107">(</span><span class="ident" id="3466108">rc</span><span class="op" id="3466110">)</span>&nbsp;<span class="op" id="3466112">&gt;</span>&nbsp;<span class="num" id="3466114">0</span>&nbsp;<span class="op" id="3466116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466121">c</span><span class="op" id="3466122">.</span><span class="ident" id="3466123">Jar</span><span class="op" id="3466126">.</span><span class="ident" id="3466127">SetCookies</span><span class="op" id="3466137">(</span><span class="ident" id="3466138">req</span><span class="op" id="3466141">.</span><span class="ident" id="3466142">URL</span><span class="op" id="3466145">,</span>&nbsp;<span class="ident" id="3466147">rc</span><span class="op" id="3466149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466153">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466159">return</span>&nbsp;<span class="ident" id="3466166">resp</span><span class="op" id="3466170">,</span>&nbsp;<span class="ident" id="3466172">err</span><br>
<span class="lineno"></span><span class="op" id="3466176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3466179">//&nbsp;Do&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response,&nbsp;following</span><br>
<span class="lineno">155</span><span class="comment" id="3466247">//&nbsp;policy&nbsp;(e.g.&nbsp;redirects,&nbsp;cookies,&nbsp;auth)&nbsp;as&nbsp;configured&nbsp;on&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="3466318">//</span><br>
<span class="lineno"></span><span class="comment" id="3466321">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;caused&nbsp;by&nbsp;client&nbsp;policy&nbsp;(such&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3466381">//&nbsp;CheckRedirect),&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3466440">//&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno">160</span><span class="comment" id="3466486">//</span><br>
<span class="lineno"></span><span class="comment" id="3466489">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3466551">//</span><br>
<span class="lineno"></span><span class="comment" id="3466554">//&nbsp;Callers&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3466618">//&nbsp;resp.Body&nbsp;is&nbsp;not&nbsp;closed,&nbsp;the&nbsp;Client&#39;s&nbsp;underlying&nbsp;RoundTripper</span><br>
<span class="lineno">165</span><span class="comment" id="3466683">//&nbsp;(typically&nbsp;Transport)&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;re-use&nbsp;a&nbsp;persistent&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="3466751">//&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;for&nbsp;a&nbsp;subsequent&nbsp;&#34;keep-alive&#34;&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3466818">//</span><br>
<span class="lineno"></span><span class="comment" id="3466821">//&nbsp;The&nbsp;request&nbsp;Body,&nbsp;if&nbsp;non-nil,&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="3466887">//&nbsp;Transport,&nbsp;even&nbsp;on&nbsp;errors.</span><br>
<span class="lineno">170</span><span class="comment" id="3466917">//</span><br>
<span class="lineno"></span><span class="comment" id="3466920">//&nbsp;Generally&nbsp;Get,&nbsp;Post,&nbsp;or&nbsp;PostForm&nbsp;will&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&nbsp;Do.</span><br>
<span class="lineno"></span><span class="keyword" id="3466984">func</span>&nbsp;<span class="op" id="3466989">(</span><span class="ident" id="3466990">c</span>&nbsp;<span class="op" id="3466992">*</span><span class="ident" id="3466993">Client</span><span class="op" id="3466999">)</span>&nbsp;<span class="ident" id="3467001">Do</span><span class="op" id="3467003">(</span><span class="ident" id="3467004">req</span>&nbsp;<span class="op" id="3467008">*</span><span class="ident" id="3467009">Request</span><span class="op" id="3467016">)</span>&nbsp;<span class="op" id="3467018">(</span><span class="ident" id="3467019">resp</span>&nbsp;<span class="op" id="3467024">*</span><span class="ident" id="3467025">Response</span><span class="op" id="3467033">,</span>&nbsp;<span class="ident" id="3467035">err</span>&nbsp;<span class="builtintype" id="3467039">error</span><span class="op" id="3467044">)</span>&nbsp;<span class="op" id="3467046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467049">if</span>&nbsp;<span class="ident" id="3467052">req</span><span class="op" id="3467055">.</span><span class="ident" id="3467056">Method</span>&nbsp;<span class="op" id="3467063">==</span>&nbsp;<span class="string" id="3467066">&#34;GET&#34;</span>&nbsp;<span class="op" id="3467072">||</span>&nbsp;<span class="ident" id="3467075">req</span><span class="op" id="3467078">.</span><span class="ident" id="3467079">Method</span>&nbsp;<span class="op" id="3467086">==</span>&nbsp;<span class="string" id="3467089">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3467096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467100">return</span>&nbsp;<span class="ident" id="3467107">c</span><span class="op" id="3467108">.</span><span class="ident" id="3467109">doFollowingRedirects</span><span class="op" id="3467129">(</span><span class="ident" id="3467130">req</span><span class="op" id="3467133">,</span>&nbsp;<span class="ident" id="3467135">shouldRedirectGet</span><span class="op" id="3467152">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467158">if</span>&nbsp;<span class="ident" id="3467161">req</span><span class="op" id="3467164">.</span><span class="ident" id="3467165">Method</span>&nbsp;<span class="op" id="3467172">==</span>&nbsp;<span class="string" id="3467175">&#34;POST&#34;</span>&nbsp;<span class="op" id="3467182">||</span>&nbsp;<span class="ident" id="3467185">req</span><span class="op" id="3467188">.</span><span class="ident" id="3467189">Method</span>&nbsp;<span class="op" id="3467196">==</span>&nbsp;<span class="string" id="3467199">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3467205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467209">return</span>&nbsp;<span class="ident" id="3467216">c</span><span class="op" id="3467217">.</span><span class="ident" id="3467218">doFollowingRedirects</span><span class="op" id="3467238">(</span><span class="ident" id="3467239">req</span><span class="op" id="3467242">,</span>&nbsp;<span class="ident" id="3467244">shouldRedirectPost</span><span class="op" id="3467262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467268">return</span>&nbsp;<span class="ident" id="3467275">c</span><span class="op" id="3467276">.</span><span class="ident" id="3467277">send</span><span class="op" id="3467281">(</span><span class="ident" id="3467282">req</span><span class="op" id="3467285">)</span><br>
<span class="lineno">180</span><span class="op" id="3467287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3467290">func</span>&nbsp;<span class="op" id="3467295">(</span><span class="ident" id="3467296">c</span>&nbsp;<span class="op" id="3467298">*</span><span class="ident" id="3467299">Client</span><span class="op" id="3467305">)</span>&nbsp;<span class="ident" id="3467307">transport</span><span class="op" id="3467316">(</span><span class="op" id="3467317">)</span>&nbsp;<span class="ident" id="3467319">RoundTripper</span>&nbsp;<span class="op" id="3467332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467335">if</span>&nbsp;<span class="ident" id="3467338">c</span><span class="op" id="3467339">.</span><span class="ident" id="3467340">Transport</span>&nbsp;<span class="op" id="3467350">!=</span>&nbsp;<span class="builtintype" id="3467353">nil</span>&nbsp;<span class="op" id="3467357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467361">return</span>&nbsp;<span class="ident" id="3467368">c</span><span class="op" id="3467369">.</span><span class="ident" id="3467370">Transport</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467384">return</span>&nbsp;<span class="ident" id="3467391">DefaultTransport</span><br>
<span class="lineno"></span><span class="op" id="3467408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3467411">//&nbsp;send&nbsp;issues&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno">190</span><span class="comment" id="3467443">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3467503">func</span>&nbsp;<span class="ident" id="3467508">send</span><span class="op" id="3467512">(</span><span class="ident" id="3467513">req</span>&nbsp;<span class="op" id="3467517">*</span><span class="ident" id="3467518">Request</span><span class="op" id="3467525">,</span>&nbsp;<span class="ident" id="3467527">t</span>&nbsp;<span class="ident" id="3467529">RoundTripper</span><span class="op" id="3467541">)</span>&nbsp;<span class="op" id="3467543">(</span><span class="ident" id="3467544">resp</span>&nbsp;<span class="op" id="3467549">*</span><span class="ident" id="3467550">Response</span><span class="op" id="3467558">,</span>&nbsp;<span class="ident" id="3467560">err</span>&nbsp;<span class="builtintype" id="3467564">error</span><span class="op" id="3467569">)</span>&nbsp;<span class="op" id="3467571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467574">if</span>&nbsp;<span class="ident" id="3467577">t</span>&nbsp;<span class="op" id="3467579">==</span>&nbsp;<span class="builtintype" id="3467582">nil</span>&nbsp;<span class="op" id="3467586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467590">req</span><span class="op" id="3467593">.</span><span class="ident" id="3467594">closeBody</span><span class="op" id="3467603">(</span><span class="op" id="3467604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467608">return</span>&nbsp;<span class="builtintype" id="3467615">nil</span><span class="op" id="3467618">,</span>&nbsp;<span class="ident" id="3467620">errors</span><span class="op" id="3467626">.</span><span class="ident" id="3467627">New</span><span class="op" id="3467630">(</span><span class="string" id="3467631">&#34;http:&nbsp;no&nbsp;Client.Transport&nbsp;or&nbsp;DefaultTransport&#34;</span><span class="op" id="3467678">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467685">if</span>&nbsp;<span class="ident" id="3467688">req</span><span class="op" id="3467691">.</span><span class="ident" id="3467692">URL</span>&nbsp;<span class="op" id="3467696">==</span>&nbsp;<span class="builtintype" id="3467699">nil</span>&nbsp;<span class="op" id="3467703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467707">req</span><span class="op" id="3467710">.</span><span class="ident" id="3467711">closeBody</span><span class="op" id="3467720">(</span><span class="op" id="3467721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467725">return</span>&nbsp;<span class="builtintype" id="3467732">nil</span><span class="op" id="3467735">,</span>&nbsp;<span class="ident" id="3467737">errors</span><span class="op" id="3467743">.</span><span class="ident" id="3467744">New</span><span class="op" id="3467747">(</span><span class="string" id="3467748">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="3467771">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467778">if</span>&nbsp;<span class="ident" id="3467781">req</span><span class="op" id="3467784">.</span><span class="ident" id="3467785">RequestURI</span>&nbsp;<span class="op" id="3467796">!=</span>&nbsp;<span class="string" id="3467799">&#34;&#34;</span>&nbsp;<span class="op" id="3467802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467806">req</span><span class="op" id="3467809">.</span><span class="ident" id="3467810">closeBody</span><span class="op" id="3467819">(</span><span class="op" id="3467820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467824">return</span>&nbsp;<span class="builtintype" id="3467831">nil</span><span class="op" id="3467834">,</span>&nbsp;<span class="ident" id="3467836">errors</span><span class="op" id="3467842">.</span><span class="ident" id="3467843">New</span><span class="op" id="3467846">(</span><span class="string" id="3467847">&#34;http:&nbsp;Request.RequestURI&nbsp;can&#39;t&nbsp;be&nbsp;set&nbsp;in&nbsp;client&nbsp;requests.&#34;</span><span class="op" id="3467906">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3467913">//&nbsp;Most&nbsp;the&nbsp;callers&nbsp;of&nbsp;send&nbsp;(Get,&nbsp;Post,&nbsp;et&nbsp;al)&nbsp;don&#39;t&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3467972">//&nbsp;Headers,&nbsp;leaving&nbsp;it&nbsp;uninitialized.&nbsp;&nbsp;We&nbsp;guarantee&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3468032">//&nbsp;Transport&nbsp;that&nbsp;this&nbsp;has&nbsp;been&nbsp;initialized,&nbsp;though.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3468086">if</span>&nbsp;<span class="ident" id="3468089">req</span><span class="op" id="3468092">.</span><span class="ident" id="3468093">Header</span>&nbsp;<span class="op" id="3468100">==</span>&nbsp;<span class="builtintype" id="3468103">nil</span>&nbsp;<span class="op" id="3468107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468111">req</span><span class="op" id="3468114">.</span><span class="ident" id="3468115">Header</span>&nbsp;<span class="op" id="3468122">=</span>&nbsp;<span class="builtinfunc" id="3468124">make</span><span class="op" id="3468128">(</span><span class="ident" id="3468129">Header</span><span class="op" id="3468135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3468138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3468142">if</span>&nbsp;<span class="ident" id="3468145">u</span>&nbsp;<span class="op" id="3468147">:=</span>&nbsp;<span class="ident" id="3468150">req</span><span class="op" id="3468153">.</span><span class="ident" id="3468154">URL</span><span class="op" id="3468157">.</span><span class="ident" id="3468158">User</span><span class="op" id="3468162">;</span>&nbsp;<span class="ident" id="3468164">u</span>&nbsp;<span class="op" id="3468166">!=</span>&nbsp;<span class="builtintype" id="3468169">nil</span>&nbsp;<span class="op" id="3468173">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468177">username</span>&nbsp;<span class="op" id="3468186">:=</span>&nbsp;<span class="ident" id="3468189">u</span><span class="op" id="3468190">.</span><span class="ident" id="3468191">Username</span><span class="op" id="3468199">(</span><span class="op" id="3468200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468204">password</span><span class="op" id="3468212">,</span>&nbsp;<span class="ident" id="3468214">_</span>&nbsp;<span class="op" id="3468216">:=</span>&nbsp;<span class="ident" id="3468219">u</span><span class="op" id="3468220">.</span><span class="ident" id="3468221">Password</span><span class="op" id="3468229">(</span><span class="op" id="3468230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468234">req</span><span class="op" id="3468237">.</span><span class="ident" id="3468238">Header</span><span class="op" id="3468244">.</span><span class="ident" id="3468245">Set</span><span class="op" id="3468248">(</span><span class="string" id="3468249">&#34;Authorization&#34;</span><span class="op" id="3468264">,</span>&nbsp;<span class="string" id="3468266">&#34;Basic&nbsp;&#34;</span><span class="op" id="3468274">+</span><span class="ident" id="3468275">basicAuth</span><span class="op" id="3468284">(</span><span class="ident" id="3468285">username</span><span class="op" id="3468293">,</span>&nbsp;<span class="ident" id="3468295">password</span><span class="op" id="3468303">)</span><span class="op" id="3468304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3468307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468310">resp</span><span class="op" id="3468314">,</span>&nbsp;<span class="ident" id="3468316">err</span>&nbsp;<span class="op" id="3468320">=</span>&nbsp;<span class="ident" id="3468322">t</span><span class="op" id="3468323">.</span><span class="ident" id="3468324">RoundTrip</span><span class="op" id="3468333">(</span><span class="ident" id="3468334">req</span><span class="op" id="3468337">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3468340">if</span>&nbsp;<span class="ident" id="3468343">err</span>&nbsp;<span class="op" id="3468347">!=</span>&nbsp;<span class="builtintype" id="3468350">nil</span>&nbsp;<span class="op" id="3468354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3468358">if</span>&nbsp;<span class="ident" id="3468361">resp</span>&nbsp;<span class="op" id="3468366">!=</span>&nbsp;<span class="builtintype" id="3468369">nil</span>&nbsp;<span class="op" id="3468373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468378">log</span><span class="op" id="3468381">.</span><span class="ident" id="3468382">Printf</span><span class="op" id="3468388">(</span><span class="string" id="3468389">&#34;RoundTripper&nbsp;returned&nbsp;a&nbsp;response&nbsp;&amp;&nbsp;error;&nbsp;ignoring&nbsp;response&#34;</span><span class="op" id="3468450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3468454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3468458">return</span>&nbsp;<span class="builtintype" id="3468465">nil</span><span class="op" id="3468468">,</span>&nbsp;<span class="ident" id="3468470">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3468475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3468478">return</span>&nbsp;<span class="ident" id="3468485">resp</span><span class="op" id="3468489">,</span>&nbsp;<span class="builtintype" id="3468491">nil</span><br>
<span class="lineno"></span><span class="op" id="3468495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3468498">//&nbsp;See&nbsp;2&nbsp;(end&nbsp;of&nbsp;page&nbsp;4)&nbsp;http://www.ietf.org/rfc/rfc2617.txt</span><br>
<span class="lineno">230</span><span class="comment" id="3468559">//&nbsp;&#34;To&nbsp;receive&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;userid&nbsp;and&nbsp;password,</span><br>
<span class="lineno"></span><span class="comment" id="3468631">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;single&nbsp;colon&nbsp;(&#34;:&#34;)&nbsp;character,&nbsp;within&nbsp;a&nbsp;base64</span><br>
<span class="lineno"></span><span class="comment" id="3468695">//&nbsp;encoded&nbsp;string&nbsp;in&nbsp;the&nbsp;credentials.&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3468734">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;urlencoded.</span><br>
<span class="lineno"></span><span class="keyword" id="3468771">func</span>&nbsp;<span class="ident" id="3468776">basicAuth</span><span class="op" id="3468785">(</span><span class="ident" id="3468786">username</span><span class="op" id="3468794">,</span>&nbsp;<span class="ident" id="3468796">password</span>&nbsp;<span class="builtintype" id="3468805">string</span><span class="op" id="3468811">)</span>&nbsp;<span class="builtintype" id="3468813">string</span>&nbsp;<span class="op" id="3468820">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468823">auth</span>&nbsp;<span class="op" id="3468828">:=</span>&nbsp;<span class="ident" id="3468831">username</span>&nbsp;<span class="op" id="3468840">+</span>&nbsp;<span class="string" id="3468842">&#34;:&#34;</span>&nbsp;<span class="op" id="3468846">+</span>&nbsp;<span class="ident" id="3468848">password</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3468858">return</span>&nbsp;<span class="ident" id="3468865">base64</span><span class="op" id="3468871">.</span><span class="ident" id="3468872">StdEncoding</span><span class="op" id="3468883">.</span><span class="ident" id="3468884">EncodeToString</span><span class="op" id="3468898">(</span><span class="op" id="3468899">[</span><span class="op" id="3468900">]</span><span class="builtintype" id="3468901">byte</span><span class="op" id="3468905">(</span><span class="ident" id="3468906">auth</span><span class="op" id="3468910">)</span><span class="op" id="3468911">)</span><br>
<span class="lineno"></span><span class="op" id="3468913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3468916">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Get&nbsp;utility&nbsp;should</span><br>
<span class="lineno">240</span><span class="comment" id="3468998">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="3469025">func</span>&nbsp;<span class="ident" id="3469030">shouldRedirectGet</span><span class="op" id="3469047">(</span><span class="ident" id="3469048">statusCode</span>&nbsp;<span class="builtintype" id="3469059">int</span><span class="op" id="3469062">)</span>&nbsp;<span class="builtintype" id="3469064">bool</span>&nbsp;<span class="op" id="3469069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469072">switch</span>&nbsp;<span class="ident" id="3469079">statusCode</span>&nbsp;<span class="op" id="3469090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469093">case</span>&nbsp;<span class="ident" id="3469098">StatusMovedPermanently</span><span class="op" id="3469120">,</span>&nbsp;<span class="ident" id="3469122">StatusFound</span><span class="op" id="3469133">,</span>&nbsp;<span class="ident" id="3469135">StatusSeeOther</span><span class="op" id="3469149">,</span>&nbsp;<span class="ident" id="3469151">StatusTemporaryRedirect</span><span class="op" id="3469174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469178">return</span>&nbsp;<span class="builtintype" id="3469185">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3469191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469194">return</span>&nbsp;<span class="builtintype" id="3469201">false</span><br>
<span class="lineno"></span><span class="op" id="3469207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3469210">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Post&nbsp;utility&nbsp;should</span><br>
<span class="lineno">250</span><span class="comment" id="3469293">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="3469320">func</span>&nbsp;<span class="ident" id="3469325">shouldRedirectPost</span><span class="op" id="3469343">(</span><span class="ident" id="3469344">statusCode</span>&nbsp;<span class="builtintype" id="3469355">int</span><span class="op" id="3469358">)</span>&nbsp;<span class="builtintype" id="3469360">bool</span>&nbsp;<span class="op" id="3469365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469368">switch</span>&nbsp;<span class="ident" id="3469375">statusCode</span>&nbsp;<span class="op" id="3469386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469389">case</span>&nbsp;<span class="ident" id="3469394">StatusFound</span><span class="op" id="3469405">,</span>&nbsp;<span class="ident" id="3469407">StatusSeeOther</span><span class="op" id="3469421">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469425">return</span>&nbsp;<span class="builtintype" id="3469432">true</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3469438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469441">return</span>&nbsp;<span class="builtintype" id="3469448">false</span><br>
<span class="lineno"></span><span class="op" id="3469454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3469457">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="3469540">//&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect,&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;10&nbsp;redirects:</span><br>
<span class="lineno"></span><span class="comment" id="3469618">//</span><br>
<span class="lineno"></span><span class="comment" id="3469621">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3469651">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="3469669">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">265</span><span class="comment" id="3469691">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3469722">//</span><br>
<span class="lineno"></span><span class="comment" id="3469725">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;redirects&nbsp;or&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="3469794">//&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3469861">//&nbsp;error.</span><br>
<span class="lineno">270</span><span class="comment" id="3469871">//</span><br>
<span class="lineno"></span><span class="comment" id="3469874">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3469936">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3469996">//</span><br>
<span class="lineno"></span><span class="comment" id="3469999">//&nbsp;Get&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Get.</span><br>
<span class="lineno">275</span><span class="keyword" id="3470045">func</span>&nbsp;<span class="ident" id="3470050">Get</span><span class="op" id="3470053">(</span><span class="ident" id="3470054">url</span>&nbsp;<span class="builtintype" id="3470058">string</span><span class="op" id="3470064">)</span>&nbsp;<span class="op" id="3470066">(</span><span class="ident" id="3470067">resp</span>&nbsp;<span class="op" id="3470072">*</span><span class="ident" id="3470073">Response</span><span class="op" id="3470081">,</span>&nbsp;<span class="ident" id="3470083">err</span>&nbsp;<span class="builtintype" id="3470087">error</span><span class="op" id="3470092">)</span>&nbsp;<span class="op" id="3470094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470097">return</span>&nbsp;<span class="ident" id="3470104">DefaultClient</span><span class="op" id="3470117">.</span><span class="ident" id="3470118">Get</span><span class="op" id="3470121">(</span><span class="ident" id="3470122">url</span><span class="op" id="3470125">)</span><br>
<span class="lineno"></span><span class="op" id="3470127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3470130">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">280</span><span class="comment" id="3470203">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3470275">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3470311">//</span><br>
<span class="lineno"></span><span class="comment" id="3470314">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3470344">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">285</span><span class="comment" id="3470362">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="3470384">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3470415">//</span><br>
<span class="lineno"></span><span class="comment" id="3470418">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="3470487">//&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t</span><br>
<span class="lineno">290</span><span class="comment" id="3470557">//&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3470576">//</span><br>
<span class="lineno"></span><span class="comment" id="3470579">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3470641">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3470701">func</span>&nbsp;<span class="op" id="3470706">(</span><span class="ident" id="3470707">c</span>&nbsp;<span class="op" id="3470709">*</span><span class="ident" id="3470710">Client</span><span class="op" id="3470716">)</span>&nbsp;<span class="ident" id="3470718">Get</span><span class="op" id="3470721">(</span><span class="ident" id="3470722">url</span>&nbsp;<span class="builtintype" id="3470726">string</span><span class="op" id="3470732">)</span>&nbsp;<span class="op" id="3470734">(</span><span class="ident" id="3470735">resp</span>&nbsp;<span class="op" id="3470740">*</span><span class="ident" id="3470741">Response</span><span class="op" id="3470749">,</span>&nbsp;<span class="ident" id="3470751">err</span>&nbsp;<span class="builtintype" id="3470755">error</span><span class="op" id="3470760">)</span>&nbsp;<span class="op" id="3470762">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470765">req</span><span class="op" id="3470768">,</span>&nbsp;<span class="ident" id="3470770">err</span>&nbsp;<span class="op" id="3470774">:=</span>&nbsp;<span class="ident" id="3470777">NewRequest</span><span class="op" id="3470787">(</span><span class="string" id="3470788">&#34;GET&#34;</span><span class="op" id="3470793">,</span>&nbsp;<span class="ident" id="3470795">url</span><span class="op" id="3470798">,</span>&nbsp;<span class="builtintype" id="3470800">nil</span><span class="op" id="3470803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470806">if</span>&nbsp;<span class="ident" id="3470809">err</span>&nbsp;<span class="op" id="3470813">!=</span>&nbsp;<span class="builtintype" id="3470816">nil</span>&nbsp;<span class="op" id="3470820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470824">return</span>&nbsp;<span class="builtintype" id="3470831">nil</span><span class="op" id="3470834">,</span>&nbsp;<span class="ident" id="3470836">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3470841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470844">return</span>&nbsp;<span class="ident" id="3470851">c</span><span class="op" id="3470852">.</span><span class="ident" id="3470853">doFollowingRedirects</span><span class="op" id="3470873">(</span><span class="ident" id="3470874">req</span><span class="op" id="3470877">,</span>&nbsp;<span class="ident" id="3470879">shouldRedirectGet</span><span class="op" id="3470896">)</span><br>
<span class="lineno">300</span><span class="op" id="3470898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3470901">func</span>&nbsp;<span class="op" id="3470906">(</span><span class="ident" id="3470907">c</span>&nbsp;<span class="op" id="3470909">*</span><span class="ident" id="3470910">Client</span><span class="op" id="3470916">)</span>&nbsp;<span class="ident" id="3470918">doFollowingRedirects</span><span class="op" id="3470938">(</span><span class="ident" id="3470939">ireq</span>&nbsp;<span class="op" id="3470944">*</span><span class="ident" id="3470945">Request</span><span class="op" id="3470952">,</span>&nbsp;<span class="ident" id="3470954">shouldRedirect</span>&nbsp;<span class="keyword" id="3470969">func</span><span class="op" id="3470973">(</span><span class="builtintype" id="3470974">int</span><span class="op" id="3470977">)</span>&nbsp;<span class="builtintype" id="3470979">bool</span><span class="op" id="3470983">)</span>&nbsp;<span class="op" id="3470985">(</span><span class="ident" id="3470986">resp</span>&nbsp;<span class="op" id="3470991">*</span><span class="ident" id="3470992">Response</span><span class="op" id="3471000">,</span>&nbsp;<span class="ident" id="3471002">err</span>&nbsp;<span class="builtintype" id="3471006">error</span><span class="op" id="3471011">)</span>&nbsp;<span class="op" id="3471013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471016">var</span>&nbsp;<span class="ident" id="3471020">base</span>&nbsp;<span class="op" id="3471025">*</span><span class="ident" id="3471026">url</span><span class="op" id="3471029">.</span><span class="ident" id="3471030">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471035">redirectChecker</span>&nbsp;<span class="op" id="3471051">:=</span>&nbsp;<span class="ident" id="3471054">c</span><span class="op" id="3471055">.</span><span class="ident" id="3471056">CheckRedirect</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471071">if</span>&nbsp;<span class="ident" id="3471074">redirectChecker</span>&nbsp;<span class="op" id="3471090">==</span>&nbsp;<span class="builtintype" id="3471093">nil</span>&nbsp;<span class="op" id="3471097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471101">redirectChecker</span>&nbsp;<span class="op" id="3471117">=</span>&nbsp;<span class="ident" id="3471119">defaultCheckRedirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471144">var</span>&nbsp;<span class="ident" id="3471148">via</span>&nbsp;<span class="op" id="3471152">[</span><span class="op" id="3471153">]</span><span class="op" id="3471154">*</span><span class="ident" id="3471155">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471165">if</span>&nbsp;<span class="ident" id="3471168">ireq</span><span class="op" id="3471172">.</span><span class="ident" id="3471173">URL</span>&nbsp;<span class="op" id="3471177">==</span>&nbsp;<span class="builtintype" id="3471180">nil</span>&nbsp;<span class="op" id="3471184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471188">ireq</span><span class="op" id="3471192">.</span><span class="ident" id="3471193">closeBody</span><span class="op" id="3471202">(</span><span class="op" id="3471203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471207">return</span>&nbsp;<span class="builtintype" id="3471214">nil</span><span class="op" id="3471217">,</span>&nbsp;<span class="ident" id="3471219">errors</span><span class="op" id="3471225">.</span><span class="ident" id="3471226">New</span><span class="op" id="3471229">(</span><span class="string" id="3471230">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="3471253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471260">var</span>&nbsp;<span class="ident" id="3471264">reqmu</span>&nbsp;<span class="ident" id="3471270">sync</span><span class="op" id="3471274">.</span><span class="ident" id="3471275">Mutex</span>&nbsp;<span class="comment" id="3471281">//&nbsp;guards&nbsp;req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471296">req</span>&nbsp;<span class="op" id="3471300">:=</span>&nbsp;<span class="ident" id="3471303">ireq</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471310">var</span>&nbsp;<span class="ident" id="3471314">timer</span>&nbsp;<span class="op" id="3471320">*</span><span class="ident" id="3471321">time</span><span class="op" id="3471325">.</span><span class="ident" id="3471326">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471333">if</span>&nbsp;<span class="ident" id="3471336">c</span><span class="op" id="3471337">.</span><span class="ident" id="3471338">Timeout</span>&nbsp;<span class="op" id="3471346">&gt;</span>&nbsp;<span class="num" id="3471348">0</span>&nbsp;<span class="op" id="3471350">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471354">type</span>&nbsp;<span class="ident" id="3471359">canceler</span>&nbsp;<span class="keyword" id="3471368">interface</span>&nbsp;<span class="op" id="3471378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471383">CancelRequest</span><span class="op" id="3471396">(</span><span class="op" id="3471397">*</span><span class="ident" id="3471398">Request</span><span class="op" id="3471405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471413">tr</span><span class="op" id="3471415">,</span>&nbsp;<span class="ident" id="3471417">ok</span>&nbsp;<span class="op" id="3471420">:=</span>&nbsp;<span class="ident" id="3471423">c</span><span class="op" id="3471424">.</span><span class="ident" id="3471425">transport</span><span class="op" id="3471434">(</span><span class="op" id="3471435">)</span><span class="op" id="3471436">.</span><span class="op" id="3471437">(</span><span class="ident" id="3471438">canceler</span><span class="op" id="3471446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471450">if</span>&nbsp;<span class="op" id="3471453">!</span><span class="ident" id="3471454">ok</span>&nbsp;<span class="op" id="3471457">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471462">return</span>&nbsp;<span class="builtintype" id="3471469">nil</span><span class="op" id="3471472">,</span>&nbsp;<span class="ident" id="3471474">fmt</span><span class="op" id="3471477">.</span><span class="ident" id="3471478">Errorf</span><span class="op" id="3471484">(</span><span class="string" id="3471485">&#34;net/http:&nbsp;Client&nbsp;Transport&nbsp;of&nbsp;type&nbsp;%T&nbsp;doesn&#39;t&nbsp;support&nbsp;CancelRequest;&nbsp;Timeout&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3471577">,</span>&nbsp;<span class="ident" id="3471579">c</span><span class="op" id="3471580">.</span><span class="ident" id="3471581">transport</span><span class="op" id="3471590">(</span><span class="op" id="3471591">)</span><span class="op" id="3471592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471600">timer</span>&nbsp;<span class="op" id="3471606">=</span>&nbsp;<span class="ident" id="3471608">time</span><span class="op" id="3471612">.</span><span class="ident" id="3471613">AfterFunc</span><span class="op" id="3471622">(</span><span class="ident" id="3471623">c</span><span class="op" id="3471624">.</span><span class="ident" id="3471625">Timeout</span><span class="op" id="3471632">,</span>&nbsp;<span class="keyword" id="3471634">func</span><span class="op" id="3471638">(</span><span class="op" id="3471639">)</span>&nbsp;<span class="op" id="3471641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471646">reqmu</span><span class="op" id="3471651">.</span><span class="ident" id="3471652">Lock</span><span class="op" id="3471656">(</span><span class="op" id="3471657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471662">defer</span>&nbsp;<span class="ident" id="3471668">reqmu</span><span class="op" id="3471673">.</span><span class="ident" id="3471674">Unlock</span><span class="op" id="3471680">(</span><span class="op" id="3471681">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471686">tr</span><span class="op" id="3471688">.</span><span class="ident" id="3471689">CancelRequest</span><span class="op" id="3471702">(</span><span class="ident" id="3471703">req</span><span class="op" id="3471706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471710">}</span><span class="op" id="3471711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471718">urlStr</span>&nbsp;<span class="op" id="3471725">:=</span>&nbsp;<span class="string" id="3471728">&#34;&#34;</span>&nbsp;<span class="comment" id="3471731">//&nbsp;next&nbsp;relative&nbsp;or&nbsp;absolute&nbsp;URL&nbsp;to&nbsp;fetch&nbsp;(after&nbsp;first&nbsp;request)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471796">redirectFailed</span>&nbsp;<span class="op" id="3471811">:=</span>&nbsp;<span class="builtintype" id="3471814">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471821">for</span>&nbsp;<span class="ident" id="3471825">redirect</span>&nbsp;<span class="op" id="3471834">:=</span>&nbsp;<span class="num" id="3471837">0</span><span class="op" id="3471838">;</span>&nbsp;<span class="op" id="3471840">;</span>&nbsp;<span class="ident" id="3471842">redirect</span><span class="op" id="3471850">++</span>&nbsp;<span class="op" id="3471853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471857">if</span>&nbsp;<span class="ident" id="3471860">redirect</span>&nbsp;<span class="op" id="3471869">!=</span>&nbsp;<span class="num" id="3471872">0</span>&nbsp;<span class="op" id="3471874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471879">nreq</span>&nbsp;<span class="op" id="3471884">:=</span>&nbsp;<span class="builtinfunc" id="3471887">new</span><span class="op" id="3471890">(</span><span class="ident" id="3471891">Request</span><span class="op" id="3471898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471903">nreq</span><span class="op" id="3471907">.</span><span class="ident" id="3471908">Method</span>&nbsp;<span class="op" id="3471915">=</span>&nbsp;<span class="ident" id="3471917">ireq</span><span class="op" id="3471921">.</span><span class="ident" id="3471922">Method</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471932">if</span>&nbsp;<span class="ident" id="3471935">ireq</span><span class="op" id="3471939">.</span><span class="ident" id="3471940">Method</span>&nbsp;<span class="op" id="3471947">==</span>&nbsp;<span class="string" id="3471950">&#34;POST&#34;</span>&nbsp;<span class="op" id="3471957">||</span>&nbsp;<span class="ident" id="3471960">ireq</span><span class="op" id="3471964">.</span><span class="ident" id="3471965">Method</span>&nbsp;<span class="op" id="3471972">==</span>&nbsp;<span class="string" id="3471975">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3471981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471987">nreq</span><span class="op" id="3471991">.</span><span class="ident" id="3471992">Method</span>&nbsp;<span class="op" id="3471999">=</span>&nbsp;<span class="string" id="3472001">&#34;GET&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472015">nreq</span><span class="op" id="3472019">.</span><span class="ident" id="3472020">Header</span>&nbsp;<span class="op" id="3472027">=</span>&nbsp;<span class="builtinfunc" id="3472029">make</span><span class="op" id="3472033">(</span><span class="ident" id="3472034">Header</span><span class="op" id="3472040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472045">nreq</span><span class="op" id="3472049">.</span><span class="ident" id="3472050">URL</span><span class="op" id="3472053">,</span>&nbsp;<span class="ident" id="3472055">err</span>&nbsp;<span class="op" id="3472059">=</span>&nbsp;<span class="ident" id="3472061">base</span><span class="op" id="3472065">.</span><span class="ident" id="3472066">Parse</span><span class="op" id="3472071">(</span><span class="ident" id="3472072">urlStr</span><span class="op" id="3472078">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472083">if</span>&nbsp;<span class="ident" id="3472086">err</span>&nbsp;<span class="op" id="3472090">!=</span>&nbsp;<span class="builtintype" id="3472093">nil</span>&nbsp;<span class="op" id="3472097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472103">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472117">if</span>&nbsp;<span class="builtinfunc" id="3472120">len</span><span class="op" id="3472123">(</span><span class="ident" id="3472124">via</span><span class="op" id="3472127">)</span>&nbsp;<span class="op" id="3472129">&gt;</span>&nbsp;<span class="num" id="3472131">0</span>&nbsp;<span class="op" id="3472133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472139">//&nbsp;Add&nbsp;the&nbsp;Referer&nbsp;header.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472170">lastReq</span>&nbsp;<span class="op" id="3472178">:=</span>&nbsp;<span class="ident" id="3472181">via</span><span class="op" id="3472184">[</span><span class="builtinfunc" id="3472185">len</span><span class="op" id="3472188">(</span><span class="ident" id="3472189">via</span><span class="op" id="3472192">)</span><span class="op" id="3472193">-</span><span class="num" id="3472194">1</span><span class="op" id="3472195">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472201">if</span>&nbsp;<span class="ident" id="3472204">ref</span>&nbsp;<span class="op" id="3472208">:=</span>&nbsp;<span class="ident" id="3472211">refererForURL</span><span class="op" id="3472224">(</span><span class="ident" id="3472225">lastReq</span><span class="op" id="3472232">.</span><span class="ident" id="3472233">URL</span><span class="op" id="3472236">,</span>&nbsp;<span class="ident" id="3472238">nreq</span><span class="op" id="3472242">.</span><span class="ident" id="3472243">URL</span><span class="op" id="3472246">)</span><span class="op" id="3472247">;</span>&nbsp;<span class="ident" id="3472249">ref</span>&nbsp;<span class="op" id="3472253">!=</span>&nbsp;<span class="string" id="3472256">&#34;&#34;</span>&nbsp;<span class="op" id="3472259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472266">nreq</span><span class="op" id="3472270">.</span><span class="ident" id="3472271">Header</span><span class="op" id="3472277">.</span><span class="ident" id="3472278">Set</span><span class="op" id="3472281">(</span><span class="string" id="3472282">&#34;Referer&#34;</span><span class="op" id="3472291">,</span>&nbsp;<span class="ident" id="3472293">ref</span><span class="op" id="3472296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472309">err</span>&nbsp;<span class="op" id="3472313">=</span>&nbsp;<span class="ident" id="3472315">redirectChecker</span><span class="op" id="3472330">(</span><span class="ident" id="3472331">nreq</span><span class="op" id="3472335">,</span>&nbsp;<span class="ident" id="3472337">via</span><span class="op" id="3472340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472346">if</span>&nbsp;<span class="ident" id="3472349">err</span>&nbsp;<span class="op" id="3472353">!=</span>&nbsp;<span class="builtintype" id="3472356">nil</span>&nbsp;<span class="op" id="3472360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472367">redirectFailed</span>&nbsp;<span class="op" id="3472382">=</span>&nbsp;<span class="builtintype" id="3472384">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472394">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472404">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472414">reqmu</span><span class="op" id="3472419">.</span><span class="ident" id="3472420">Lock</span><span class="op" id="3472424">(</span><span class="op" id="3472425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472430">req</span>&nbsp;<span class="op" id="3472434">=</span>&nbsp;<span class="ident" id="3472436">nreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472444">reqmu</span><span class="op" id="3472449">.</span><span class="ident" id="3472450">Unlock</span><span class="op" id="3472456">(</span><span class="op" id="3472457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472461">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472466">urlStr</span>&nbsp;<span class="op" id="3472473">=</span>&nbsp;<span class="ident" id="3472475">req</span><span class="op" id="3472478">.</span><span class="ident" id="3472479">URL</span><span class="op" id="3472482">.</span><span class="ident" id="3472483">String</span><span class="op" id="3472489">(</span><span class="op" id="3472490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472494">if</span>&nbsp;<span class="ident" id="3472497">resp</span><span class="op" id="3472501">,</span>&nbsp;<span class="ident" id="3472503">err</span>&nbsp;<span class="op" id="3472507">=</span>&nbsp;<span class="ident" id="3472509">c</span><span class="op" id="3472510">.</span><span class="ident" id="3472511">send</span><span class="op" id="3472515">(</span><span class="ident" id="3472516">req</span><span class="op" id="3472519">)</span><span class="op" id="3472520">;</span>&nbsp;<span class="ident" id="3472522">err</span>&nbsp;<span class="op" id="3472526">!=</span>&nbsp;<span class="builtintype" id="3472529">nil</span>&nbsp;<span class="op" id="3472533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472538">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472546">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472551">if</span>&nbsp;<span class="ident" id="3472554">shouldRedirect</span><span class="op" id="3472568">(</span><span class="ident" id="3472569">resp</span><span class="op" id="3472573">.</span><span class="ident" id="3472574">StatusCode</span><span class="op" id="3472584">)</span>&nbsp;<span class="op" id="3472586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472591">//&nbsp;Read&nbsp;the&nbsp;body&nbsp;if&nbsp;small&nbsp;so&nbsp;underlying&nbsp;TCP&nbsp;connection&nbsp;will&nbsp;be&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472666">//&nbsp;No&nbsp;need&nbsp;to&nbsp;check&nbsp;for&nbsp;errors:&nbsp;if&nbsp;it&nbsp;fails,&nbsp;Transport&nbsp;won&#39;t&nbsp;reuse&nbsp;it&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472747">const</span>&nbsp;<span class="ident" id="3472753">maxBodySlurpSize</span>&nbsp;<span class="op" id="3472770">=</span>&nbsp;<span class="num" id="3472772">2</span>&nbsp;<span class="op" id="3472774">&lt;&lt;</span>&nbsp;<span class="num" id="3472777">10</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472783">if</span>&nbsp;<span class="ident" id="3472786">resp</span><span class="op" id="3472790">.</span><span class="ident" id="3472791">ContentLength</span>&nbsp;<span class="op" id="3472805">==</span>&nbsp;<span class="op" id="3472808">-</span><span class="num" id="3472809">1</span>&nbsp;<span class="op" id="3472811">||</span>&nbsp;<span class="ident" id="3472814">resp</span><span class="op" id="3472818">.</span><span class="ident" id="3472819">ContentLength</span>&nbsp;<span class="op" id="3472833">&lt;=</span>&nbsp;<span class="ident" id="3472836">maxBodySlurpSize</span>&nbsp;<span class="op" id="3472853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472859">io</span><span class="op" id="3472861">.</span><span class="ident" id="3472862">CopyN</span><span class="op" id="3472867">(</span><span class="ident" id="3472868">ioutil</span><span class="op" id="3472874">.</span><span class="ident" id="3472875">Discard</span><span class="op" id="3472882">,</span>&nbsp;<span class="ident" id="3472884">resp</span><span class="op" id="3472888">.</span><span class="ident" id="3472889">Body</span><span class="op" id="3472893">,</span>&nbsp;<span class="ident" id="3472895">maxBodySlurpSize</span><span class="op" id="3472911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472921">resp</span><span class="op" id="3472925">.</span><span class="ident" id="3472926">Body</span><span class="op" id="3472930">.</span><span class="ident" id="3472931">Close</span><span class="op" id="3472936">(</span><span class="op" id="3472937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472942">if</span>&nbsp;<span class="ident" id="3472945">urlStr</span>&nbsp;<span class="op" id="3472952">=</span>&nbsp;<span class="ident" id="3472954">resp</span><span class="op" id="3472958">.</span><span class="ident" id="3472959">Header</span><span class="op" id="3472965">.</span><span class="ident" id="3472966">Get</span><span class="op" id="3472969">(</span><span class="string" id="3472970">&#34;Location&#34;</span><span class="op" id="3472980">)</span><span class="op" id="3472981">;</span>&nbsp;<span class="ident" id="3472983">urlStr</span>&nbsp;<span class="op" id="3472990">==</span>&nbsp;<span class="string" id="3472993">&#34;&#34;</span>&nbsp;<span class="op" id="3472996">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473002">err</span>&nbsp;<span class="op" id="3473006">=</span>&nbsp;<span class="ident" id="3473008">errors</span><span class="op" id="3473014">.</span><span class="ident" id="3473015">New</span><span class="op" id="3473018">(</span><span class="ident" id="3473019">fmt</span><span class="op" id="3473022">.</span><span class="ident" id="3473023">Sprintf</span><span class="op" id="3473030">(</span><span class="string" id="3473031">&#34;%d&nbsp;response&nbsp;missing&nbsp;Location&nbsp;header&#34;</span><span class="op" id="3473068">,</span>&nbsp;<span class="ident" id="3473070">resp</span><span class="op" id="3473074">.</span><span class="ident" id="3473075">StatusCode</span><span class="op" id="3473085">)</span><span class="op" id="3473086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473092">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473106">base</span>&nbsp;<span class="op" id="3473111">=</span>&nbsp;<span class="ident" id="3473113">req</span><span class="op" id="3473116">.</span><span class="ident" id="3473117">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473124">via</span>&nbsp;<span class="op" id="3473128">=</span>&nbsp;<span class="builtinfunc" id="3473130">append</span><span class="op" id="3473136">(</span><span class="ident" id="3473137">via</span><span class="op" id="3473140">,</span>&nbsp;<span class="ident" id="3473142">req</span><span class="op" id="3473145">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473150">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473165">if</span>&nbsp;<span class="ident" id="3473168">timer</span>&nbsp;<span class="op" id="3473174">!=</span>&nbsp;<span class="builtintype" id="3473177">nil</span>&nbsp;<span class="op" id="3473181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473186">resp</span><span class="op" id="3473190">.</span><span class="ident" id="3473191">Body</span>&nbsp;<span class="op" id="3473196">=</span>&nbsp;<span class="op" id="3473198">&amp;</span><span class="ident" id="3473199">cancelTimerBody</span><span class="op" id="3473214">{</span><span class="ident" id="3473215">timer</span><span class="op" id="3473220">,</span>&nbsp;<span class="ident" id="3473222">resp</span><span class="op" id="3473226">.</span><span class="ident" id="3473227">Body</span><span class="op" id="3473231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473235">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473239">return</span>&nbsp;<span class="ident" id="3473246">resp</span><span class="op" id="3473250">,</span>&nbsp;<span class="builtintype" id="3473252">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473261">method</span>&nbsp;<span class="op" id="3473268">:=</span>&nbsp;<span class="ident" id="3473271">ireq</span><span class="op" id="3473275">.</span><span class="ident" id="3473276">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473284">urlErr</span>&nbsp;<span class="op" id="3473291">:=</span>&nbsp;<span class="op" id="3473294">&amp;</span><span class="ident" id="3473295">url</span><span class="op" id="3473298">.</span><span class="ident" id="3473299">Error</span><span class="op" id="3473304">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473308">Op</span><span class="op" id="3473310">:</span>&nbsp;&nbsp;<span class="ident" id="3473313">method</span><span class="op" id="3473319">[</span><span class="num" id="3473320">0</span><span class="op" id="3473321">:</span><span class="num" id="3473322">1</span><span class="op" id="3473323">]</span>&nbsp;<span class="op" id="3473325">+</span>&nbsp;<span class="ident" id="3473327">strings</span><span class="op" id="3473334">.</span><span class="ident" id="3473335">ToLower</span><span class="op" id="3473342">(</span><span class="ident" id="3473343">method</span><span class="op" id="3473349">[</span><span class="num" id="3473350">1</span><span class="op" id="3473351">:</span><span class="op" id="3473352">]</span><span class="op" id="3473353">)</span><span class="op" id="3473354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473358">URL</span><span class="op" id="3473361">:</span>&nbsp;<span class="ident" id="3473363">urlStr</span><span class="op" id="3473369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473373">Err</span><span class="op" id="3473376">:</span>&nbsp;<span class="ident" id="3473378">err</span><span class="op" id="3473381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473388">if</span>&nbsp;<span class="ident" id="3473391">redirectFailed</span>&nbsp;<span class="op" id="3473406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473410">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;Go&nbsp;1&nbsp;compatibility:&nbsp;return&nbsp;both&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473477">//&nbsp;and&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;CheckRedirect&nbsp;function&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473533">//&nbsp;See&nbsp;http://golang.org/issue/3795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473571">return</span>&nbsp;<span class="ident" id="3473578">resp</span><span class="op" id="3473582">,</span>&nbsp;<span class="ident" id="3473584">urlErr</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473596">if</span>&nbsp;<span class="ident" id="3473599">resp</span>&nbsp;<span class="op" id="3473604">!=</span>&nbsp;<span class="builtintype" id="3473607">nil</span>&nbsp;<span class="op" id="3473611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473615">resp</span><span class="op" id="3473619">.</span><span class="ident" id="3473620">Body</span><span class="op" id="3473624">.</span><span class="ident" id="3473625">Close</span><span class="op" id="3473630">(</span><span class="op" id="3473631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473634">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473637">return</span>&nbsp;<span class="builtintype" id="3473644">nil</span><span class="op" id="3473647">,</span>&nbsp;<span class="ident" id="3473649">urlErr</span><br>
<span class="lineno"></span><span class="op" id="3473656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3473659">func</span>&nbsp;<span class="ident" id="3473664">defaultCheckRedirect</span><span class="op" id="3473684">(</span><span class="ident" id="3473685">req</span>&nbsp;<span class="op" id="3473689">*</span><span class="ident" id="3473690">Request</span><span class="op" id="3473697">,</span>&nbsp;<span class="ident" id="3473699">via</span>&nbsp;<span class="op" id="3473703">[</span><span class="op" id="3473704">]</span><span class="op" id="3473705">*</span><span class="ident" id="3473706">Request</span><span class="op" id="3473713">)</span>&nbsp;<span class="builtintype" id="3473715">error</span>&nbsp;<span class="op" id="3473721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473724">if</span>&nbsp;<span class="builtinfunc" id="3473727">len</span><span class="op" id="3473730">(</span><span class="ident" id="3473731">via</span><span class="op" id="3473734">)</span>&nbsp;<span class="op" id="3473736">&gt;=</span>&nbsp;<span class="num" id="3473739">10</span>&nbsp;<span class="op" id="3473742">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473746">return</span>&nbsp;<span class="ident" id="3473753">errors</span><span class="op" id="3473759">.</span><span class="ident" id="3473760">New</span><span class="op" id="3473763">(</span><span class="string" id="3473764">&#34;stopped&nbsp;after&nbsp;10&nbsp;redirects&#34;</span><span class="op" id="3473792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473798">return</span>&nbsp;<span class="builtintype" id="3473805">nil</span><br>
<span class="lineno"></span><span class="op" id="3473809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="3473812">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno"></span><span class="comment" id="3473856">//</span><br>
<span class="lineno"></span><span class="comment" id="3473859">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3473919">//</span><br>
<span class="lineno"></span><span class="comment" id="3473922">//&nbsp;Post&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Post</span><br>
<span class="lineno">425</span><span class="keyword" id="3473969">func</span>&nbsp;<span class="ident" id="3473974">Post</span><span class="op" id="3473978">(</span><span class="ident" id="3473979">url</span>&nbsp;<span class="builtintype" id="3473983">string</span><span class="op" id="3473989">,</span>&nbsp;<span class="ident" id="3473991">bodyType</span>&nbsp;<span class="builtintype" id="3474000">string</span><span class="op" id="3474006">,</span>&nbsp;<span class="ident" id="3474008">body</span>&nbsp;<span class="ident" id="3474013">io</span><span class="op" id="3474015">.</span><span class="ident" id="3474016">Reader</span><span class="op" id="3474022">)</span>&nbsp;<span class="op" id="3474024">(</span><span class="ident" id="3474025">resp</span>&nbsp;<span class="op" id="3474030">*</span><span class="ident" id="3474031">Response</span><span class="op" id="3474039">,</span>&nbsp;<span class="ident" id="3474041">err</span>&nbsp;<span class="builtintype" id="3474045">error</span><span class="op" id="3474050">)</span>&nbsp;<span class="op" id="3474052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474055">return</span>&nbsp;<span class="ident" id="3474062">DefaultClient</span><span class="op" id="3474075">.</span><span class="ident" id="3474076">Post</span><span class="op" id="3474080">(</span><span class="ident" id="3474081">url</span><span class="op" id="3474084">,</span>&nbsp;<span class="ident" id="3474086">bodyType</span><span class="op" id="3474094">,</span>&nbsp;<span class="ident" id="3474096">body</span><span class="op" id="3474100">)</span><br>
<span class="lineno"></span><span class="op" id="3474102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3474105">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno">430</span><span class="comment" id="3474149">//</span><br>
<span class="lineno"></span><span class="comment" id="3474152">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3474212">//</span><br>
<span class="lineno"></span><span class="comment" id="3474215">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;it&nbsp;is&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3474284">//&nbsp;request.</span><br>
<span class="lineno">435</span><span class="keyword" id="3474296">func</span>&nbsp;<span class="op" id="3474301">(</span><span class="ident" id="3474302">c</span>&nbsp;<span class="op" id="3474304">*</span><span class="ident" id="3474305">Client</span><span class="op" id="3474311">)</span>&nbsp;<span class="ident" id="3474313">Post</span><span class="op" id="3474317">(</span><span class="ident" id="3474318">url</span>&nbsp;<span class="builtintype" id="3474322">string</span><span class="op" id="3474328">,</span>&nbsp;<span class="ident" id="3474330">bodyType</span>&nbsp;<span class="builtintype" id="3474339">string</span><span class="op" id="3474345">,</span>&nbsp;<span class="ident" id="3474347">body</span>&nbsp;<span class="ident" id="3474352">io</span><span class="op" id="3474354">.</span><span class="ident" id="3474355">Reader</span><span class="op" id="3474361">)</span>&nbsp;<span class="op" id="3474363">(</span><span class="ident" id="3474364">resp</span>&nbsp;<span class="op" id="3474369">*</span><span class="ident" id="3474370">Response</span><span class="op" id="3474378">,</span>&nbsp;<span class="ident" id="3474380">err</span>&nbsp;<span class="builtintype" id="3474384">error</span><span class="op" id="3474389">)</span>&nbsp;<span class="op" id="3474391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474394">req</span><span class="op" id="3474397">,</span>&nbsp;<span class="ident" id="3474399">err</span>&nbsp;<span class="op" id="3474403">:=</span>&nbsp;<span class="ident" id="3474406">NewRequest</span><span class="op" id="3474416">(</span><span class="string" id="3474417">&#34;POST&#34;</span><span class="op" id="3474423">,</span>&nbsp;<span class="ident" id="3474425">url</span><span class="op" id="3474428">,</span>&nbsp;<span class="ident" id="3474430">body</span><span class="op" id="3474434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474437">if</span>&nbsp;<span class="ident" id="3474440">err</span>&nbsp;<span class="op" id="3474444">!=</span>&nbsp;<span class="builtintype" id="3474447">nil</span>&nbsp;<span class="op" id="3474451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474455">return</span>&nbsp;<span class="builtintype" id="3474462">nil</span><span class="op" id="3474465">,</span>&nbsp;<span class="ident" id="3474467">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3474472">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474475">req</span><span class="op" id="3474478">.</span><span class="ident" id="3474479">Header</span><span class="op" id="3474485">.</span><span class="ident" id="3474486">Set</span><span class="op" id="3474489">(</span><span class="string" id="3474490">&#34;Content-Type&#34;</span><span class="op" id="3474504">,</span>&nbsp;<span class="ident" id="3474506">bodyType</span><span class="op" id="3474514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474517">return</span>&nbsp;<span class="ident" id="3474524">c</span><span class="op" id="3474525">.</span><span class="ident" id="3474526">doFollowingRedirects</span><span class="op" id="3474546">(</span><span class="ident" id="3474547">req</span><span class="op" id="3474550">,</span>&nbsp;<span class="ident" id="3474552">shouldRedirectPost</span><span class="op" id="3474570">)</span><br>
<span class="lineno"></span><span class="op" id="3474572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3474575">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and</span><br>
<span class="lineno">445</span><span class="comment" id="3474644">//&nbsp;values&nbsp;URL-encoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3474687">//</span><br>
<span class="lineno"></span><span class="comment" id="3474690">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3474752">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3474812">//</span><br>
<span class="lineno">450</span><span class="comment" id="3474815">//&nbsp;PostForm&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.PostForm</span><br>
<span class="lineno"></span><span class="keyword" id="3474870">func</span>&nbsp;<span class="ident" id="3474875">PostForm</span><span class="op" id="3474883">(</span><span class="ident" id="3474884">url</span>&nbsp;<span class="builtintype" id="3474888">string</span><span class="op" id="3474894">,</span>&nbsp;<span class="ident" id="3474896">data</span>&nbsp;<span class="ident" id="3474901">url</span><span class="op" id="3474904">.</span><span class="ident" id="3474905">Values</span><span class="op" id="3474911">)</span>&nbsp;<span class="op" id="3474913">(</span><span class="ident" id="3474914">resp</span>&nbsp;<span class="op" id="3474919">*</span><span class="ident" id="3474920">Response</span><span class="op" id="3474928">,</span>&nbsp;<span class="ident" id="3474930">err</span>&nbsp;<span class="builtintype" id="3474934">error</span><span class="op" id="3474939">)</span>&nbsp;<span class="op" id="3474941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474944">return</span>&nbsp;<span class="ident" id="3474951">DefaultClient</span><span class="op" id="3474964">.</span><span class="ident" id="3474965">PostForm</span><span class="op" id="3474973">(</span><span class="ident" id="3474974">url</span><span class="op" id="3474977">,</span>&nbsp;<span class="ident" id="3474979">data</span><span class="op" id="3474983">)</span><br>
<span class="lineno"></span><span class="op" id="3474985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="3474988">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,</span><br>
<span class="lineno"></span><span class="comment" id="3475036">//&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and&nbsp;values&nbsp;urlencoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3475099">//</span><br>
<span class="lineno"></span><span class="comment" id="3475102">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3475164">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno">460</span><span class="keyword" id="3475224">func</span>&nbsp;<span class="op" id="3475229">(</span><span class="ident" id="3475230">c</span>&nbsp;<span class="op" id="3475232">*</span><span class="ident" id="3475233">Client</span><span class="op" id="3475239">)</span>&nbsp;<span class="ident" id="3475241">PostForm</span><span class="op" id="3475249">(</span><span class="ident" id="3475250">url</span>&nbsp;<span class="builtintype" id="3475254">string</span><span class="op" id="3475260">,</span>&nbsp;<span class="ident" id="3475262">data</span>&nbsp;<span class="ident" id="3475267">url</span><span class="op" id="3475270">.</span><span class="ident" id="3475271">Values</span><span class="op" id="3475277">)</span>&nbsp;<span class="op" id="3475279">(</span><span class="ident" id="3475280">resp</span>&nbsp;<span class="op" id="3475285">*</span><span class="ident" id="3475286">Response</span><span class="op" id="3475294">,</span>&nbsp;<span class="ident" id="3475296">err</span>&nbsp;<span class="builtintype" id="3475300">error</span><span class="op" id="3475305">)</span>&nbsp;<span class="op" id="3475307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475310">return</span>&nbsp;<span class="ident" id="3475317">c</span><span class="op" id="3475318">.</span><span class="ident" id="3475319">Post</span><span class="op" id="3475323">(</span><span class="ident" id="3475324">url</span><span class="op" id="3475327">,</span>&nbsp;<span class="string" id="3475329">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="3475364">,</span>&nbsp;<span class="ident" id="3475366">strings</span><span class="op" id="3475373">.</span><span class="ident" id="3475374">NewReader</span><span class="op" id="3475383">(</span><span class="ident" id="3475384">data</span><span class="op" id="3475388">.</span><span class="ident" id="3475389">Encode</span><span class="op" id="3475395">(</span><span class="op" id="3475396">)</span><span class="op" id="3475397">)</span><span class="op" id="3475398">)</span><br>
<span class="lineno"></span><span class="op" id="3475400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3475403">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="3475478">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3475551">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3475587">//</span><br>
<span class="lineno"></span><span class="comment" id="3475590">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3475620">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">470</span><span class="comment" id="3475638">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="3475660">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3475691">//</span><br>
<span class="lineno"></span><span class="comment" id="3475694">//&nbsp;Head&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Head</span><br>
<span class="lineno"></span><span class="keyword" id="3475741">func</span>&nbsp;<span class="ident" id="3475746">Head</span><span class="op" id="3475750">(</span><span class="ident" id="3475751">url</span>&nbsp;<span class="builtintype" id="3475755">string</span><span class="op" id="3475761">)</span>&nbsp;<span class="op" id="3475763">(</span><span class="ident" id="3475764">resp</span>&nbsp;<span class="op" id="3475769">*</span><span class="ident" id="3475770">Response</span><span class="op" id="3475778">,</span>&nbsp;<span class="ident" id="3475780">err</span>&nbsp;<span class="builtintype" id="3475784">error</span><span class="op" id="3475789">)</span>&nbsp;<span class="op" id="3475791">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475794">return</span>&nbsp;<span class="ident" id="3475801">DefaultClient</span><span class="op" id="3475814">.</span><span class="ident" id="3475815">Head</span><span class="op" id="3475819">(</span><span class="ident" id="3475820">url</span><span class="op" id="3475823">)</span><br>
<span class="lineno"></span><span class="op" id="3475825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3475828">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3475903">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="3475976">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3476012">//</span><br>
<span class="lineno"></span><span class="comment" id="3476015">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3476045">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="3476063">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">485</span><span class="comment" id="3476085">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="keyword" id="3476116">func</span>&nbsp;<span class="op" id="3476121">(</span><span class="ident" id="3476122">c</span>&nbsp;<span class="op" id="3476124">*</span><span class="ident" id="3476125">Client</span><span class="op" id="3476131">)</span>&nbsp;<span class="ident" id="3476133">Head</span><span class="op" id="3476137">(</span><span class="ident" id="3476138">url</span>&nbsp;<span class="builtintype" id="3476142">string</span><span class="op" id="3476148">)</span>&nbsp;<span class="op" id="3476150">(</span><span class="ident" id="3476151">resp</span>&nbsp;<span class="op" id="3476156">*</span><span class="ident" id="3476157">Response</span><span class="op" id="3476165">,</span>&nbsp;<span class="ident" id="3476167">err</span>&nbsp;<span class="builtintype" id="3476171">error</span><span class="op" id="3476176">)</span>&nbsp;<span class="op" id="3476178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476181">req</span><span class="op" id="3476184">,</span>&nbsp;<span class="ident" id="3476186">err</span>&nbsp;<span class="op" id="3476190">:=</span>&nbsp;<span class="ident" id="3476193">NewRequest</span><span class="op" id="3476203">(</span><span class="string" id="3476204">&#34;HEAD&#34;</span><span class="op" id="3476210">,</span>&nbsp;<span class="ident" id="3476212">url</span><span class="op" id="3476215">,</span>&nbsp;<span class="builtintype" id="3476217">nil</span><span class="op" id="3476220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476223">if</span>&nbsp;<span class="ident" id="3476226">err</span>&nbsp;<span class="op" id="3476230">!=</span>&nbsp;<span class="builtintype" id="3476233">nil</span>&nbsp;<span class="op" id="3476237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476241">return</span>&nbsp;<span class="builtintype" id="3476248">nil</span><span class="op" id="3476251">,</span>&nbsp;<span class="ident" id="3476253">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3476258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476261">return</span>&nbsp;<span class="ident" id="3476268">c</span><span class="op" id="3476269">.</span><span class="ident" id="3476270">doFollowingRedirects</span><span class="op" id="3476290">(</span><span class="ident" id="3476291">req</span><span class="op" id="3476294">,</span>&nbsp;<span class="ident" id="3476296">shouldRedirectGet</span><span class="op" id="3476313">)</span><br>
<span class="lineno"></span><span class="op" id="3476315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3476318">type</span>&nbsp;<span class="ident" id="3476323">cancelTimerBody</span>&nbsp;<span class="keyword" id="3476339">struct</span>&nbsp;<span class="op" id="3476346">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476349">t</span>&nbsp;&nbsp;<span class="op" id="3476352">*</span><span class="ident" id="3476353">time</span><span class="op" id="3476357">.</span><span class="ident" id="3476358">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476365">rc</span>&nbsp;<span class="ident" id="3476368">io</span><span class="op" id="3476370">.</span><span class="ident" id="3476371">ReadCloser</span><br>
<span class="lineno"></span><span class="op" id="3476382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3476385">func</span>&nbsp;<span class="op" id="3476390">(</span><span class="ident" id="3476391">b</span>&nbsp;<span class="op" id="3476393">*</span><span class="ident" id="3476394">cancelTimerBody</span><span class="op" id="3476409">)</span>&nbsp;<span class="ident" id="3476411">Read</span><span class="op" id="3476415">(</span><span class="ident" id="3476416">p</span>&nbsp;<span class="op" id="3476418">[</span><span class="op" id="3476419">]</span><span class="builtintype" id="3476420">byte</span><span class="op" id="3476424">)</span>&nbsp;<span class="op" id="3476426">(</span><span class="ident" id="3476427">n</span>&nbsp;<span class="builtintype" id="3476429">int</span><span class="op" id="3476432">,</span>&nbsp;<span class="ident" id="3476434">err</span>&nbsp;<span class="builtintype" id="3476438">error</span><span class="op" id="3476443">)</span>&nbsp;<span class="op" id="3476445">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476448">n</span><span class="op" id="3476449">,</span>&nbsp;<span class="ident" id="3476451">err</span>&nbsp;<span class="op" id="3476455">=</span>&nbsp;<span class="ident" id="3476457">b</span><span class="op" id="3476458">.</span><span class="ident" id="3476459">rc</span><span class="op" id="3476461">.</span><span class="ident" id="3476462">Read</span><span class="op" id="3476466">(</span><span class="ident" id="3476467">p</span><span class="op" id="3476468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476471">if</span>&nbsp;<span class="ident" id="3476474">err</span>&nbsp;<span class="op" id="3476478">==</span>&nbsp;<span class="ident" id="3476481">io</span><span class="op" id="3476483">.</span><span class="ident" id="3476484">EOF</span>&nbsp;<span class="op" id="3476488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476492">b</span><span class="op" id="3476493">.</span><span class="ident" id="3476494">t</span><span class="op" id="3476495">.</span><span class="ident" id="3476496">Stop</span><span class="op" id="3476500">(</span><span class="op" id="3476501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3476504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476507">return</span><br>
<span class="lineno">505</span><span class="op" id="3476514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3476517">func</span>&nbsp;<span class="op" id="3476522">(</span><span class="ident" id="3476523">b</span>&nbsp;<span class="op" id="3476525">*</span><span class="ident" id="3476526">cancelTimerBody</span><span class="op" id="3476541">)</span>&nbsp;<span class="ident" id="3476543">Close</span><span class="op" id="3476548">(</span><span class="op" id="3476549">)</span>&nbsp;<span class="builtintype" id="3476551">error</span>&nbsp;<span class="op" id="3476557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476560">err</span>&nbsp;<span class="op" id="3476564">:=</span>&nbsp;<span class="ident" id="3476567">b</span><span class="op" id="3476568">.</span><span class="ident" id="3476569">rc</span><span class="op" id="3476571">.</span><span class="ident" id="3476572">Close</span><span class="op" id="3476577">(</span><span class="op" id="3476578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476581">b</span><span class="op" id="3476582">.</span><span class="ident" id="3476583">t</span><span class="op" id="3476584">.</span><span class="ident" id="3476585">Stop</span><span class="op" id="3476589">(</span><span class="op" id="3476590">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476593">return</span>&nbsp;<span class="ident" id="3476600">err</span><br>
<span class="lineno"></span><span class="op" id="3476604">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
