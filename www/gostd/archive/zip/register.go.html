<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5896366">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5896421">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5896475">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5896526">package</span>&nbsp;<span class="ident" id="5896534">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5896539">import</span>&nbsp;<span class="op" id="5896546">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5896549">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5896567">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5896577">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5896583">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5896596">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5896603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5896606">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5896667">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5896733">type</span>&nbsp;<span class="ident" id="5896738">Compressor</span>&nbsp;<span class="keyword" id="5896749">func</span><span class="op" id="5896753">(</span><span class="ident" id="5896754">io</span><span class="op" id="5896756">.</span><span class="ident" id="5896757">Writer</span><span class="op" id="5896763">)</span>&nbsp;<span class="op" id="5896765">(</span><span class="ident" id="5896766">io</span><span class="op" id="5896768">.</span><span class="ident" id="5896769">WriteCloser</span><span class="op" id="5896780">,</span>&nbsp;<span class="builtintype" id="5896782">error</span><span class="op" id="5896787">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5896790">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="5896869">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5896943">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="5897021">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="5897055">type</span>&nbsp;<span class="ident" id="5897060">Decompressor</span>&nbsp;<span class="keyword" id="5897073">func</span><span class="op" id="5897077">(</span><span class="ident" id="5897078">io</span><span class="op" id="5897080">.</span><span class="ident" id="5897081">Reader</span><span class="op" id="5897087">)</span>&nbsp;<span class="ident" id="5897089">io</span><span class="op" id="5897091">.</span><span class="ident" id="5897092">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5897104">var</span>&nbsp;<span class="ident" id="5897108">flateWriterPool</span>&nbsp;<span class="ident" id="5897124">sync</span><span class="op" id="5897128">.</span><span class="ident" id="5897129">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5897135">func</span>&nbsp;<span class="ident" id="5897140">newFlateWriter</span><span class="op" id="5897154">(</span><span class="ident" id="5897155">w</span>&nbsp;<span class="ident" id="5897157">io</span><span class="op" id="5897159">.</span><span class="ident" id="5897160">Writer</span><span class="op" id="5897166">)</span>&nbsp;<span class="ident" id="5897168">io</span><span class="op" id="5897170">.</span><span class="ident" id="5897171">WriteCloser</span>&nbsp;<span class="op" id="5897183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897186">fw</span><span class="op" id="5897188">,</span>&nbsp;<span class="ident" id="5897190">ok</span>&nbsp;<span class="op" id="5897193">:=</span>&nbsp;<span class="ident" id="5897196">flateWriterPool</span><span class="op" id="5897211">.</span><span class="ident" id="5897212">Get</span><span class="op" id="5897215">(</span><span class="op" id="5897216">)</span><span class="op" id="5897217">.</span><span class="op" id="5897218">(</span><span class="op" id="5897219">*</span><span class="ident" id="5897220">flate</span><span class="op" id="5897225">.</span><span class="ident" id="5897226">Writer</span><span class="op" id="5897232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897235">if</span>&nbsp;<span class="ident" id="5897238">ok</span>&nbsp;<span class="op" id="5897241">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897245">fw</span><span class="op" id="5897247">.</span><span class="ident" id="5897248">Reset</span><span class="op" id="5897253">(</span><span class="ident" id="5897254">w</span><span class="op" id="5897255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5897258">}</span>&nbsp;<span class="keyword" id="5897260">else</span>&nbsp;<span class="op" id="5897265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897269">fw</span><span class="op" id="5897271">,</span>&nbsp;<span class="ident" id="5897273">_</span>&nbsp;<span class="op" id="5897275">=</span>&nbsp;<span class="ident" id="5897277">flate</span><span class="op" id="5897282">.</span><span class="ident" id="5897283">NewWriter</span><span class="op" id="5897292">(</span><span class="ident" id="5897293">w</span><span class="op" id="5897294">,</span>&nbsp;<span class="num" id="5897296">5</span><span class="op" id="5897297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5897300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897303">return</span>&nbsp;<span class="op" id="5897310">&amp;</span><span class="ident" id="5897311">pooledFlateWriter</span><span class="op" id="5897328">{</span><span class="ident" id="5897329">fw</span><span class="op" id="5897331">:</span>&nbsp;<span class="ident" id="5897333">fw</span><span class="op" id="5897335">}</span><br>
<span class="lineno">35</span><span class="op" id="5897337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5897340">type</span>&nbsp;<span class="ident" id="5897345">pooledFlateWriter</span>&nbsp;<span class="keyword" id="5897363">struct</span>&nbsp;<span class="op" id="5897370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897373">mu</span>&nbsp;<span class="ident" id="5897376">sync</span><span class="op" id="5897380">.</span><span class="ident" id="5897381">Mutex</span>&nbsp;<span class="comment" id="5897387">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897414">fw</span>&nbsp;<span class="op" id="5897417">*</span><span class="ident" id="5897418">flate</span><span class="op" id="5897423">.</span><span class="ident" id="5897424">Writer</span><br>
<span class="lineno">40</span><span class="op" id="5897431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5897434">func</span>&nbsp;<span class="op" id="5897439">(</span><span class="ident" id="5897440">w</span>&nbsp;<span class="op" id="5897442">*</span><span class="ident" id="5897443">pooledFlateWriter</span><span class="op" id="5897460">)</span>&nbsp;<span class="ident" id="5897462">Write</span><span class="op" id="5897467">(</span><span class="ident" id="5897468">p</span>&nbsp;<span class="op" id="5897470">[</span><span class="op" id="5897471">]</span><span class="builtintype" id="5897472">byte</span><span class="op" id="5897476">)</span>&nbsp;<span class="op" id="5897478">(</span><span class="ident" id="5897479">n</span>&nbsp;<span class="builtintype" id="5897481">int</span><span class="op" id="5897484">,</span>&nbsp;<span class="ident" id="5897486">err</span>&nbsp;<span class="builtintype" id="5897490">error</span><span class="op" id="5897495">)</span>&nbsp;<span class="op" id="5897497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897500">w</span><span class="op" id="5897501">.</span><span class="ident" id="5897502">mu</span><span class="op" id="5897504">.</span><span class="ident" id="5897505">Lock</span><span class="op" id="5897509">(</span><span class="op" id="5897510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897513">defer</span>&nbsp;<span class="ident" id="5897519">w</span><span class="op" id="5897520">.</span><span class="ident" id="5897521">mu</span><span class="op" id="5897523">.</span><span class="ident" id="5897524">Unlock</span><span class="op" id="5897530">(</span><span class="op" id="5897531">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897534">if</span>&nbsp;<span class="ident" id="5897537">w</span><span class="op" id="5897538">.</span><span class="ident" id="5897539">fw</span>&nbsp;<span class="op" id="5897542">==</span>&nbsp;<span class="ident" id="5897545">nil</span>&nbsp;<span class="op" id="5897549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897553">return</span>&nbsp;<span class="num" id="5897560">0</span><span class="op" id="5897561">,</span>&nbsp;<span class="ident" id="5897563">errors</span><span class="op" id="5897569">.</span><span class="ident" id="5897570">New</span><span class="op" id="5897573">(</span><span class="string" id="5897574">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="5897593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5897596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897599">return</span>&nbsp;<span class="ident" id="5897606">w</span><span class="op" id="5897607">.</span><span class="ident" id="5897608">fw</span><span class="op" id="5897610">.</span><span class="ident" id="5897611">Write</span><span class="op" id="5897616">(</span><span class="ident" id="5897617">p</span><span class="op" id="5897618">)</span><br>
<span class="lineno"></span><span class="op" id="5897620">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5897623">func</span>&nbsp;<span class="op" id="5897628">(</span><span class="ident" id="5897629">w</span>&nbsp;<span class="op" id="5897631">*</span><span class="ident" id="5897632">pooledFlateWriter</span><span class="op" id="5897649">)</span>&nbsp;<span class="ident" id="5897651">Close</span><span class="op" id="5897656">(</span><span class="op" id="5897657">)</span>&nbsp;<span class="builtintype" id="5897659">error</span>&nbsp;<span class="op" id="5897665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897668">w</span><span class="op" id="5897669">.</span><span class="ident" id="5897670">mu</span><span class="op" id="5897672">.</span><span class="ident" id="5897673">Lock</span><span class="op" id="5897677">(</span><span class="op" id="5897678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897681">defer</span>&nbsp;<span class="ident" id="5897687">w</span><span class="op" id="5897688">.</span><span class="ident" id="5897689">mu</span><span class="op" id="5897691">.</span><span class="ident" id="5897692">Unlock</span><span class="op" id="5897698">(</span><span class="op" id="5897699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897702">var</span>&nbsp;<span class="ident" id="5897706">err</span>&nbsp;<span class="builtintype" id="5897710">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897717">if</span>&nbsp;<span class="ident" id="5897720">w</span><span class="op" id="5897721">.</span><span class="ident" id="5897722">fw</span>&nbsp;<span class="op" id="5897725">!=</span>&nbsp;<span class="ident" id="5897728">nil</span>&nbsp;<span class="op" id="5897732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897736">err</span>&nbsp;<span class="op" id="5897740">=</span>&nbsp;<span class="ident" id="5897742">w</span><span class="op" id="5897743">.</span><span class="ident" id="5897744">fw</span><span class="op" id="5897746">.</span><span class="ident" id="5897747">Close</span><span class="op" id="5897752">(</span><span class="op" id="5897753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897757">flateWriterPool</span><span class="op" id="5897772">.</span><span class="ident" id="5897773">Put</span><span class="op" id="5897776">(</span><span class="ident" id="5897777">w</span><span class="op" id="5897778">.</span><span class="ident" id="5897779">fw</span><span class="op" id="5897781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897785">w</span><span class="op" id="5897786">.</span><span class="ident" id="5897787">fw</span>&nbsp;<span class="op" id="5897790">=</span>&nbsp;<span class="ident" id="5897792">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5897797">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897800">return</span>&nbsp;<span class="ident" id="5897807">err</span><br>
<span class="lineno"></span><span class="op" id="5897811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5897814">var</span>&nbsp;<span class="op" id="5897818">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897821">mu</span>&nbsp;<span class="ident" id="5897824">sync</span><span class="op" id="5897828">.</span><span class="ident" id="5897829">RWMutex</span>&nbsp;<span class="comment" id="5897837">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897882">compressors</span>&nbsp;<span class="op" id="5897894">=</span>&nbsp;<span class="keyword" id="5897896">map</span><span class="op" id="5897899">[</span><span class="builtintype" id="5897900">uint16</span><span class="op" id="5897906">]</span><span class="ident" id="5897907">Compressor</span><span class="op" id="5897917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897921">Store</span><span class="op" id="5897926">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5897930">func</span><span class="op" id="5897934">(</span><span class="ident" id="5897935">w</span>&nbsp;<span class="ident" id="5897937">io</span><span class="op" id="5897939">.</span><span class="ident" id="5897940">Writer</span><span class="op" id="5897946">)</span>&nbsp;<span class="op" id="5897948">(</span><span class="ident" id="5897949">io</span><span class="op" id="5897951">.</span><span class="ident" id="5897952">WriteCloser</span><span class="op" id="5897963">,</span>&nbsp;<span class="builtintype" id="5897965">error</span><span class="op" id="5897970">)</span>&nbsp;<span class="op" id="5897972">{</span>&nbsp;<span class="keyword" id="5897974">return</span>&nbsp;<span class="op" id="5897981">&amp;</span><span class="ident" id="5897982">nopCloser</span><span class="op" id="5897991">{</span><span class="ident" id="5897992">w</span><span class="op" id="5897993">}</span><span class="op" id="5897994">,</span>&nbsp;<span class="ident" id="5897996">nil</span>&nbsp;<span class="op" id="5898000">}</span><span class="op" id="5898001">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898005">Deflate</span><span class="op" id="5898012">:</span>&nbsp;<span class="keyword" id="5898014">func</span><span class="op" id="5898018">(</span><span class="ident" id="5898019">w</span>&nbsp;<span class="ident" id="5898021">io</span><span class="op" id="5898023">.</span><span class="ident" id="5898024">Writer</span><span class="op" id="5898030">)</span>&nbsp;<span class="op" id="5898032">(</span><span class="ident" id="5898033">io</span><span class="op" id="5898035">.</span><span class="ident" id="5898036">WriteCloser</span><span class="op" id="5898047">,</span>&nbsp;<span class="builtintype" id="5898049">error</span><span class="op" id="5898054">)</span>&nbsp;<span class="op" id="5898056">{</span>&nbsp;<span class="keyword" id="5898058">return</span>&nbsp;<span class="ident" id="5898065">newFlateWriter</span><span class="op" id="5898079">(</span><span class="ident" id="5898080">w</span><span class="op" id="5898081">)</span><span class="op" id="5898082">,</span>&nbsp;<span class="ident" id="5898084">nil</span>&nbsp;<span class="op" id="5898088">}</span><span class="op" id="5898089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898092">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898096">decompressors</span>&nbsp;<span class="op" id="5898110">=</span>&nbsp;<span class="keyword" id="5898112">map</span><span class="op" id="5898115">[</span><span class="builtintype" id="5898116">uint16</span><span class="op" id="5898122">]</span><span class="ident" id="5898123">Decompressor</span><span class="op" id="5898135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898139">Store</span><span class="op" id="5898144">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5898148">ioutil</span><span class="op" id="5898154">.</span><span class="ident" id="5898155">NopCloser</span><span class="op" id="5898164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898168">Deflate</span><span class="op" id="5898175">:</span>&nbsp;<span class="ident" id="5898177">flate</span><span class="op" id="5898182">.</span><span class="ident" id="5898183">NewReader</span><span class="op" id="5898192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898195">}</span><br>
<span class="lineno">75</span><span class="op" id="5898197">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5898200">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="5898279">func</span>&nbsp;<span class="ident" id="5898284">RegisterDecompressor</span><span class="op" id="5898304">(</span><span class="ident" id="5898305">method</span>&nbsp;<span class="builtintype" id="5898312">uint16</span><span class="op" id="5898318">,</span>&nbsp;<span class="ident" id="5898320">d</span>&nbsp;<span class="ident" id="5898322">Decompressor</span><span class="op" id="5898334">)</span>&nbsp;<span class="op" id="5898336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898339">mu</span><span class="op" id="5898341">.</span><span class="ident" id="5898342">Lock</span><span class="op" id="5898346">(</span><span class="op" id="5898347">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898350">defer</span>&nbsp;<span class="ident" id="5898356">mu</span><span class="op" id="5898358">.</span><span class="ident" id="5898359">Unlock</span><span class="op" id="5898365">(</span><span class="op" id="5898366">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898370">if</span>&nbsp;<span class="ident" id="5898373">_</span><span class="op" id="5898374">,</span>&nbsp;<span class="ident" id="5898376">ok</span>&nbsp;<span class="op" id="5898379">:=</span>&nbsp;<span class="ident" id="5898382">decompressors</span><span class="op" id="5898395">[</span><span class="ident" id="5898396">method</span><span class="op" id="5898402">]</span><span class="op" id="5898403">;</span>&nbsp;<span class="ident" id="5898405">ok</span>&nbsp;<span class="op" id="5898408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5898412">panic</span><span class="op" id="5898417">(</span><span class="string" id="5898418">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="5898451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898454">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898457">decompressors</span><span class="op" id="5898470">[</span><span class="ident" id="5898471">method</span><span class="op" id="5898477">]</span>&nbsp;<span class="op" id="5898479">=</span>&nbsp;<span class="ident" id="5898481">d</span><br>
<span class="lineno"></span><span class="op" id="5898483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5898486">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="5898564">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="5898618">func</span>&nbsp;<span class="ident" id="5898623">RegisterCompressor</span><span class="op" id="5898641">(</span><span class="ident" id="5898642">method</span>&nbsp;<span class="builtintype" id="5898649">uint16</span><span class="op" id="5898655">,</span>&nbsp;<span class="ident" id="5898657">comp</span>&nbsp;<span class="ident" id="5898662">Compressor</span><span class="op" id="5898672">)</span>&nbsp;<span class="op" id="5898674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898677">mu</span><span class="op" id="5898679">.</span><span class="ident" id="5898680">Lock</span><span class="op" id="5898684">(</span><span class="op" id="5898685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898688">defer</span>&nbsp;<span class="ident" id="5898694">mu</span><span class="op" id="5898696">.</span><span class="ident" id="5898697">Unlock</span><span class="op" id="5898703">(</span><span class="op" id="5898704">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898708">if</span>&nbsp;<span class="ident" id="5898711">_</span><span class="op" id="5898712">,</span>&nbsp;<span class="ident" id="5898714">ok</span>&nbsp;<span class="op" id="5898717">:=</span>&nbsp;<span class="ident" id="5898720">compressors</span><span class="op" id="5898731">[</span><span class="ident" id="5898732">method</span><span class="op" id="5898738">]</span><span class="op" id="5898739">;</span>&nbsp;<span class="ident" id="5898741">ok</span>&nbsp;<span class="op" id="5898744">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5898748">panic</span><span class="op" id="5898753">(</span><span class="string" id="5898754">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="5898785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898791">compressors</span><span class="op" id="5898802">[</span><span class="ident" id="5898803">method</span><span class="op" id="5898809">]</span>&nbsp;<span class="op" id="5898811">=</span>&nbsp;<span class="ident" id="5898813">comp</span><br>
<span class="lineno"></span><span class="op" id="5898818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5898821">func</span>&nbsp;<span class="ident" id="5898826">compressor</span><span class="op" id="5898836">(</span><span class="ident" id="5898837">method</span>&nbsp;<span class="builtintype" id="5898844">uint16</span><span class="op" id="5898850">)</span>&nbsp;<span class="ident" id="5898852">Compressor</span>&nbsp;<span class="op" id="5898863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898866">mu</span><span class="op" id="5898868">.</span><span class="ident" id="5898869">RLock</span><span class="op" id="5898874">(</span><span class="op" id="5898875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898878">defer</span>&nbsp;<span class="ident" id="5898884">mu</span><span class="op" id="5898886">.</span><span class="ident" id="5898887">RUnlock</span><span class="op" id="5898894">(</span><span class="op" id="5898895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898898">return</span>&nbsp;<span class="ident" id="5898905">compressors</span><span class="op" id="5898916">[</span><span class="ident" id="5898917">method</span><span class="op" id="5898923">]</span><br>
<span class="lineno"></span><span class="op" id="5898925">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5898928">func</span>&nbsp;<span class="ident" id="5898933">decompressor</span><span class="op" id="5898945">(</span><span class="ident" id="5898946">method</span>&nbsp;<span class="builtintype" id="5898953">uint16</span><span class="op" id="5898959">)</span>&nbsp;<span class="ident" id="5898961">Decompressor</span>&nbsp;<span class="op" id="5898974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898977">mu</span><span class="op" id="5898979">.</span><span class="ident" id="5898980">RLock</span><span class="op" id="5898985">(</span><span class="op" id="5898986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898989">defer</span>&nbsp;<span class="ident" id="5898995">mu</span><span class="op" id="5898997">.</span><span class="ident" id="5898998">RUnlock</span><span class="op" id="5899005">(</span><span class="op" id="5899006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5899009">return</span>&nbsp;<span class="ident" id="5899016">decompressors</span><span class="op" id="5899029">[</span><span class="ident" id="5899030">method</span><span class="op" id="5899036">]</span><br>
<span class="lineno">110</span><span class="op" id="5899038">}</span>
</div>
</body>
</html>
