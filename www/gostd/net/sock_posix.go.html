<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3385529">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3385585">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3385639">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3385690">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385768">package</span>&nbsp;<span class="ident" id="3385776">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385781">import</span>&nbsp;<span class="op" id="3385788">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3385791">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3385797">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3385808">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3385815">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3385818">//&nbsp;A&nbsp;sockaddr&nbsp;represents&nbsp;a&nbsp;TCP,&nbsp;UDP,&nbsp;IP&nbsp;or&nbsp;Unix&nbsp;network&nbsp;endpoint</span><br>
<span class="lineno"></span><span class="comment" id="3385883">//&nbsp;address&nbsp;that&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall.Sockaddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3385941">type</span>&nbsp;<span class="ident" id="3385946">sockaddr</span>&nbsp;<span class="keyword" id="3385955">interface</span>&nbsp;<span class="op" id="3385965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385968">Addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385975">netaddr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385985">//&nbsp;family&nbsp;returns&nbsp;the&nbsp;platform-dependent&nbsp;address&nbsp;family</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386042">//&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386058">family</span><span class="op" id="3386064">(</span><span class="op" id="3386065">)</span>&nbsp;<span class="builtintype" id="3386067">int</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386073">//&nbsp;isWildcard&nbsp;reports&nbsp;whether&nbsp;the&nbsp;address&nbsp;is&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386130">//&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386143">isWildcard</span><span class="op" id="3386153">(</span><span class="op" id="3386154">)</span>&nbsp;<span class="builtintype" id="3386156">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386163">//&nbsp;sockaddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386221">//&nbsp;sockaddr&nbsp;type&nbsp;that&nbsp;implements&nbsp;syscall.Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386272">//&nbsp;interface.&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386334">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386343">sockaddr</span><span class="op" id="3386351">(</span><span class="ident" id="3386352">family</span>&nbsp;<span class="builtintype" id="3386359">int</span><span class="op" id="3386362">)</span>&nbsp;<span class="op" id="3386364">(</span><span class="ident" id="3386365">syscall</span><span class="op" id="3386372">.</span><span class="ident" id="3386373">Sockaddr</span><span class="op" id="3386381">,</span>&nbsp;<span class="builtintype" id="3386383">error</span><span class="op" id="3386388">)</span><br>
<span class="lineno">35</span><span class="op" id="3386390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3386393">//&nbsp;socket&nbsp;returns&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;is&nbsp;ready&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3386455">//&nbsp;asynchronous&nbsp;I/O&nbsp;using&nbsp;the&nbsp;network&nbsp;poller.</span><br>
<span class="lineno"></span><span class="keyword" id="3386501">func</span>&nbsp;<span class="ident" id="3386506">socket</span><span class="op" id="3386512">(</span><span class="ident" id="3386513">net</span>&nbsp;<span class="builtintype" id="3386517">string</span><span class="op" id="3386523">,</span>&nbsp;<span class="ident" id="3386525">family</span><span class="op" id="3386531">,</span>&nbsp;<span class="ident" id="3386533">sotype</span><span class="op" id="3386539">,</span>&nbsp;<span class="ident" id="3386541">proto</span>&nbsp;<span class="builtintype" id="3386547">int</span><span class="op" id="3386550">,</span>&nbsp;<span class="ident" id="3386552">ipv6only</span>&nbsp;<span class="builtintype" id="3386561">bool</span><span class="op" id="3386565">,</span>&nbsp;<span class="ident" id="3386567">laddr</span><span class="op" id="3386572">,</span>&nbsp;<span class="ident" id="3386574">raddr</span>&nbsp;<span class="ident" id="3386580">sockaddr</span><span class="op" id="3386588">,</span>&nbsp;<span class="ident" id="3386590">deadline</span>&nbsp;<span class="ident" id="3386599">time</span><span class="op" id="3386603">.</span><span class="ident" id="3386604">Time</span><span class="op" id="3386608">)</span>&nbsp;<span class="op" id="3386610">(</span><span class="ident" id="3386611">fd</span>&nbsp;<span class="op" id="3386614">*</span><span class="ident" id="3386615">netFD</span><span class="op" id="3386620">,</span>&nbsp;<span class="ident" id="3386622">err</span>&nbsp;<span class="builtintype" id="3386626">error</span><span class="op" id="3386631">)</span>&nbsp;<span class="op" id="3386633">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386636">s</span><span class="op" id="3386637">,</span>&nbsp;<span class="ident" id="3386639">err</span>&nbsp;<span class="op" id="3386643">:=</span>&nbsp;<span class="ident" id="3386646">sysSocket</span><span class="op" id="3386655">(</span><span class="ident" id="3386656">family</span><span class="op" id="3386662">,</span>&nbsp;<span class="ident" id="3386664">sotype</span><span class="op" id="3386670">,</span>&nbsp;<span class="ident" id="3386672">proto</span><span class="op" id="3386677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386680">if</span>&nbsp;<span class="ident" id="3386683">err</span>&nbsp;<span class="op" id="3386687">!=</span>&nbsp;<span class="ident" id="3386690">nil</span>&nbsp;<span class="op" id="3386694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386698">return</span>&nbsp;<span class="ident" id="3386705">nil</span><span class="op" id="3386708">,</span>&nbsp;<span class="ident" id="3386710">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386718">if</span>&nbsp;<span class="ident" id="3386721">err</span>&nbsp;<span class="op" id="3386725">=</span>&nbsp;<span class="ident" id="3386727">setDefaultSockopts</span><span class="op" id="3386745">(</span><span class="ident" id="3386746">s</span><span class="op" id="3386747">,</span>&nbsp;<span class="ident" id="3386749">family</span><span class="op" id="3386755">,</span>&nbsp;<span class="ident" id="3386757">sotype</span><span class="op" id="3386763">,</span>&nbsp;<span class="ident" id="3386765">ipv6only</span><span class="op" id="3386773">)</span><span class="op" id="3386774">;</span>&nbsp;<span class="ident" id="3386776">err</span>&nbsp;<span class="op" id="3386780">!=</span>&nbsp;<span class="ident" id="3386783">nil</span>&nbsp;<span class="op" id="3386787">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386791">closesocket</span><span class="op" id="3386802">(</span><span class="ident" id="3386803">s</span><span class="op" id="3386804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386808">return</span>&nbsp;<span class="ident" id="3386815">nil</span><span class="op" id="3386818">,</span>&nbsp;<span class="ident" id="3386820">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386828">if</span>&nbsp;<span class="ident" id="3386831">fd</span><span class="op" id="3386833">,</span>&nbsp;<span class="ident" id="3386835">err</span>&nbsp;<span class="op" id="3386839">=</span>&nbsp;<span class="ident" id="3386841">newFD</span><span class="op" id="3386846">(</span><span class="ident" id="3386847">s</span><span class="op" id="3386848">,</span>&nbsp;<span class="ident" id="3386850">family</span><span class="op" id="3386856">,</span>&nbsp;<span class="ident" id="3386858">sotype</span><span class="op" id="3386864">,</span>&nbsp;<span class="ident" id="3386866">net</span><span class="op" id="3386869">)</span><span class="op" id="3386870">;</span>&nbsp;<span class="ident" id="3386872">err</span>&nbsp;<span class="op" id="3386876">!=</span>&nbsp;<span class="ident" id="3386879">nil</span>&nbsp;<span class="op" id="3386883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386887">closesocket</span><span class="op" id="3386898">(</span><span class="ident" id="3386899">s</span><span class="op" id="3386900">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386904">return</span>&nbsp;<span class="ident" id="3386911">nil</span><span class="op" id="3386914">,</span>&nbsp;<span class="ident" id="3386916">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386925">//&nbsp;This&nbsp;function&nbsp;makes&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386983">//&nbsp;following&nbsp;applications:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387011">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387015">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;passive&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387068">//&nbsp;&nbsp;&nbsp;connenction,&nbsp;known&nbsp;as&nbsp;a&nbsp;stream&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387114">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387118">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;destination-unspecific</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387179">//&nbsp;&nbsp;&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a&nbsp;datagram&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387235">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387239">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;an&nbsp;active&nbsp;stream&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387297">//&nbsp;&nbsp;&nbsp;destination-specific&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387356">//&nbsp;&nbsp;&nbsp;dialer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387369">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387373">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;the&nbsp;other&nbsp;connection,&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387436">//&nbsp;&nbsp;&nbsp;as&nbsp;talking&nbsp;to&nbsp;the&nbsp;protocol&nbsp;stack&nbsp;inside&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387493">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387497">//&nbsp;For&nbsp;stream&nbsp;and&nbsp;datagram&nbsp;listeners,&nbsp;they&nbsp;will&nbsp;only&nbsp;require</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387559">//&nbsp;named&nbsp;sockets,&nbsp;so&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387620">//&nbsp;from&nbsp;stream&nbsp;or&nbsp;datagram&nbsp;listeners&nbsp;when&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387684">//&nbsp;raddr&nbsp;is&nbsp;nil.&nbsp;Otherwise&nbsp;we&nbsp;assume&nbsp;it&#39;s&nbsp;just&nbsp;for&nbsp;dialers&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387747">//&nbsp;the&nbsp;other&nbsp;connection&nbsp;holders.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387782">if</span>&nbsp;<span class="ident" id="3387785">laddr</span>&nbsp;<span class="op" id="3387791">!=</span>&nbsp;<span class="ident" id="3387794">nil</span>&nbsp;<span class="op" id="3387798">&amp;&amp;</span>&nbsp;<span class="ident" id="3387801">raddr</span>&nbsp;<span class="op" id="3387807">==</span>&nbsp;<span class="ident" id="3387810">nil</span>&nbsp;<span class="op" id="3387814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387818">switch</span>&nbsp;<span class="ident" id="3387825">sotype</span>&nbsp;<span class="op" id="3387832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387836">case</span>&nbsp;<span class="ident" id="3387841">syscall</span><span class="op" id="3387848">.</span><span class="ident" id="3387849">SOCK_STREAM</span><span class="op" id="3387860">,</span>&nbsp;<span class="ident" id="3387862">syscall</span><span class="op" id="3387869">.</span><span class="ident" id="3387870">SOCK_SEQPACKET</span><span class="op" id="3387884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387889">if</span>&nbsp;<span class="ident" id="3387892">err</span>&nbsp;<span class="op" id="3387896">:=</span>&nbsp;<span class="ident" id="3387899">fd</span><span class="op" id="3387901">.</span><span class="ident" id="3387902">listenStream</span><span class="op" id="3387914">(</span><span class="ident" id="3387915">laddr</span><span class="op" id="3387920">,</span>&nbsp;<span class="ident" id="3387922">listenerBacklog</span><span class="op" id="3387937">)</span><span class="op" id="3387938">;</span>&nbsp;<span class="ident" id="3387940">err</span>&nbsp;<span class="op" id="3387944">!=</span>&nbsp;<span class="ident" id="3387947">nil</span>&nbsp;<span class="op" id="3387951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387957">fd</span><span class="op" id="3387959">.</span><span class="ident" id="3387960">Close</span><span class="op" id="3387965">(</span><span class="op" id="3387966">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387972">return</span>&nbsp;<span class="ident" id="3387979">nil</span><span class="op" id="3387982">,</span>&nbsp;<span class="ident" id="3387984">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387996">return</span>&nbsp;<span class="ident" id="3388003">fd</span><span class="op" id="3388005">,</span>&nbsp;<span class="ident" id="3388007">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388013">case</span>&nbsp;<span class="ident" id="3388018">syscall</span><span class="op" id="3388025">.</span><span class="ident" id="3388026">SOCK_DGRAM</span><span class="op" id="3388036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388041">if</span>&nbsp;<span class="ident" id="3388044">err</span>&nbsp;<span class="op" id="3388048">:=</span>&nbsp;<span class="ident" id="3388051">fd</span><span class="op" id="3388053">.</span><span class="ident" id="3388054">listenDatagram</span><span class="op" id="3388068">(</span><span class="ident" id="3388069">laddr</span><span class="op" id="3388074">)</span><span class="op" id="3388075">;</span>&nbsp;<span class="ident" id="3388077">err</span>&nbsp;<span class="op" id="3388081">!=</span>&nbsp;<span class="ident" id="3388084">nil</span>&nbsp;<span class="op" id="3388088">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388094">fd</span><span class="op" id="3388096">.</span><span class="ident" id="3388097">Close</span><span class="op" id="3388102">(</span><span class="op" id="3388103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388109">return</span>&nbsp;<span class="ident" id="3388116">nil</span><span class="op" id="3388119">,</span>&nbsp;<span class="ident" id="3388121">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388133">return</span>&nbsp;<span class="ident" id="3388140">fd</span><span class="op" id="3388142">,</span>&nbsp;<span class="ident" id="3388144">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388150">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388156">if</span>&nbsp;<span class="ident" id="3388159">err</span>&nbsp;<span class="op" id="3388163">:=</span>&nbsp;<span class="ident" id="3388166">fd</span><span class="op" id="3388168">.</span><span class="ident" id="3388169">dial</span><span class="op" id="3388173">(</span><span class="ident" id="3388174">laddr</span><span class="op" id="3388179">,</span>&nbsp;<span class="ident" id="3388181">raddr</span><span class="op" id="3388186">,</span>&nbsp;<span class="ident" id="3388188">deadline</span><span class="op" id="3388196">)</span><span class="op" id="3388197">;</span>&nbsp;<span class="ident" id="3388199">err</span>&nbsp;<span class="op" id="3388203">!=</span>&nbsp;<span class="ident" id="3388206">nil</span>&nbsp;<span class="op" id="3388210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388214">fd</span><span class="op" id="3388216">.</span><span class="ident" id="3388217">Close</span><span class="op" id="3388222">(</span><span class="op" id="3388223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388227">return</span>&nbsp;<span class="ident" id="3388234">nil</span><span class="op" id="3388237">,</span>&nbsp;<span class="ident" id="3388239">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388244">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388247">return</span>&nbsp;<span class="ident" id="3388254">fd</span><span class="op" id="3388256">,</span>&nbsp;<span class="ident" id="3388258">nil</span><br>
<span class="lineno"></span><span class="op" id="3388262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3388265">func</span>&nbsp;<span class="op" id="3388270">(</span><span class="ident" id="3388271">fd</span>&nbsp;<span class="op" id="3388274">*</span><span class="ident" id="3388275">netFD</span><span class="op" id="3388280">)</span>&nbsp;<span class="ident" id="3388282">addrFunc</span><span class="op" id="3388290">(</span><span class="op" id="3388291">)</span>&nbsp;<span class="keyword" id="3388293">func</span><span class="op" id="3388297">(</span><span class="ident" id="3388298">syscall</span><span class="op" id="3388305">.</span><span class="ident" id="3388306">Sockaddr</span><span class="op" id="3388314">)</span>&nbsp;<span class="ident" id="3388316">Addr</span>&nbsp;<span class="op" id="3388321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388324">switch</span>&nbsp;<span class="ident" id="3388331">fd</span><span class="op" id="3388333">.</span><span class="ident" id="3388334">family</span>&nbsp;<span class="op" id="3388341">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388344">case</span>&nbsp;<span class="ident" id="3388349">syscall</span><span class="op" id="3388356">.</span><span class="ident" id="3388357">AF_INET</span><span class="op" id="3388364">,</span>&nbsp;<span class="ident" id="3388366">syscall</span><span class="op" id="3388373">.</span><span class="ident" id="3388374">AF_INET6</span><span class="op" id="3388382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388386">switch</span>&nbsp;<span class="ident" id="3388393">fd</span><span class="op" id="3388395">.</span><span class="ident" id="3388396">sotype</span>&nbsp;<span class="op" id="3388403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388407">case</span>&nbsp;<span class="ident" id="3388412">syscall</span><span class="op" id="3388419">.</span><span class="ident" id="3388420">SOCK_STREAM</span><span class="op" id="3388431">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388436">return</span>&nbsp;<span class="ident" id="3388443">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388459">case</span>&nbsp;<span class="ident" id="3388464">syscall</span><span class="op" id="3388471">.</span><span class="ident" id="3388472">SOCK_DGRAM</span><span class="op" id="3388482">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388487">return</span>&nbsp;<span class="ident" id="3388494">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388510">case</span>&nbsp;<span class="ident" id="3388515">syscall</span><span class="op" id="3388522">.</span><span class="ident" id="3388523">SOCK_RAW</span><span class="op" id="3388531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388536">return</span>&nbsp;<span class="ident" id="3388543">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388561">case</span>&nbsp;<span class="ident" id="3388566">syscall</span><span class="op" id="3388573">.</span><span class="ident" id="3388574">AF_UNIX</span><span class="op" id="3388581">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388585">switch</span>&nbsp;<span class="ident" id="3388592">fd</span><span class="op" id="3388594">.</span><span class="ident" id="3388595">sotype</span>&nbsp;<span class="op" id="3388602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388606">case</span>&nbsp;<span class="ident" id="3388611">syscall</span><span class="op" id="3388618">.</span><span class="ident" id="3388619">SOCK_STREAM</span><span class="op" id="3388630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388635">return</span>&nbsp;<span class="ident" id="3388642">sockaddrToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388659">case</span>&nbsp;<span class="ident" id="3388664">syscall</span><span class="op" id="3388671">.</span><span class="ident" id="3388672">SOCK_DGRAM</span><span class="op" id="3388682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388687">return</span>&nbsp;<span class="ident" id="3388694">sockaddrToUnixgram</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388715">case</span>&nbsp;<span class="ident" id="3388720">syscall</span><span class="op" id="3388727">.</span><span class="ident" id="3388728">SOCK_SEQPACKET</span><span class="op" id="3388742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388747">return</span>&nbsp;<span class="ident" id="3388754">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388783">return</span>&nbsp;<span class="keyword" id="3388790">func</span><span class="op" id="3388794">(</span><span class="ident" id="3388795">syscall</span><span class="op" id="3388802">.</span><span class="ident" id="3388803">Sockaddr</span><span class="op" id="3388811">)</span>&nbsp;<span class="ident" id="3388813">Addr</span>&nbsp;<span class="op" id="3388818">{</span>&nbsp;<span class="keyword" id="3388820">return</span>&nbsp;<span class="ident" id="3388827">nil</span>&nbsp;<span class="op" id="3388831">}</span><br>
<span class="lineno">120</span><span class="op" id="3388833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3388836">func</span>&nbsp;<span class="op" id="3388841">(</span><span class="ident" id="3388842">fd</span>&nbsp;<span class="op" id="3388845">*</span><span class="ident" id="3388846">netFD</span><span class="op" id="3388851">)</span>&nbsp;<span class="ident" id="3388853">dial</span><span class="op" id="3388857">(</span><span class="ident" id="3388858">laddr</span><span class="op" id="3388863">,</span>&nbsp;<span class="ident" id="3388865">raddr</span>&nbsp;<span class="ident" id="3388871">sockaddr</span><span class="op" id="3388879">,</span>&nbsp;<span class="ident" id="3388881">deadline</span>&nbsp;<span class="ident" id="3388890">time</span><span class="op" id="3388894">.</span><span class="ident" id="3388895">Time</span><span class="op" id="3388899">)</span>&nbsp;<span class="builtintype" id="3388901">error</span>&nbsp;<span class="op" id="3388907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388910">var</span>&nbsp;<span class="ident" id="3388914">err</span>&nbsp;<span class="builtintype" id="3388918">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388925">var</span>&nbsp;<span class="ident" id="3388929">lsa</span>&nbsp;<span class="ident" id="3388933">syscall</span><span class="op" id="3388940">.</span><span class="ident" id="3388941">Sockaddr</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388951">if</span>&nbsp;<span class="ident" id="3388954">laddr</span>&nbsp;<span class="op" id="3388960">!=</span>&nbsp;<span class="ident" id="3388963">nil</span>&nbsp;<span class="op" id="3388967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388971">if</span>&nbsp;<span class="ident" id="3388974">lsa</span><span class="op" id="3388977">,</span>&nbsp;<span class="ident" id="3388979">err</span>&nbsp;<span class="op" id="3388983">=</span>&nbsp;<span class="ident" id="3388985">laddr</span><span class="op" id="3388990">.</span><span class="ident" id="3388991">sockaddr</span><span class="op" id="3388999">(</span><span class="ident" id="3389000">fd</span><span class="op" id="3389002">.</span><span class="ident" id="3389003">family</span><span class="op" id="3389009">)</span><span class="op" id="3389010">;</span>&nbsp;<span class="ident" id="3389012">err</span>&nbsp;<span class="op" id="3389016">!=</span>&nbsp;<span class="ident" id="3389019">nil</span>&nbsp;<span class="op" id="3389023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389028">return</span>&nbsp;<span class="ident" id="3389035">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389041">}</span>&nbsp;<span class="keyword" id="3389043">else</span>&nbsp;<span class="keyword" id="3389048">if</span>&nbsp;<span class="ident" id="3389051">lsa</span>&nbsp;<span class="op" id="3389055">!=</span>&nbsp;<span class="ident" id="3389058">nil</span>&nbsp;<span class="op" id="3389062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389067">if</span>&nbsp;<span class="ident" id="3389070">err</span>&nbsp;<span class="op" id="3389074">:=</span>&nbsp;<span class="ident" id="3389077">syscall</span><span class="op" id="3389084">.</span><span class="ident" id="3389085">Bind</span><span class="op" id="3389089">(</span><span class="ident" id="3389090">fd</span><span class="op" id="3389092">.</span><span class="ident" id="3389093">sysfd</span><span class="op" id="3389098">,</span>&nbsp;<span class="ident" id="3389100">lsa</span><span class="op" id="3389103">)</span><span class="op" id="3389104">;</span>&nbsp;<span class="ident" id="3389106">err</span>&nbsp;<span class="op" id="3389110">!=</span>&nbsp;<span class="ident" id="3389113">nil</span>&nbsp;<span class="op" id="3389117">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389123">return</span>&nbsp;<span class="ident" id="3389130">os</span><span class="op" id="3389132">.</span><span class="ident" id="3389133">NewSyscallError</span><span class="op" id="3389148">(</span><span class="string" id="3389149">&#34;bind&#34;</span><span class="op" id="3389155">,</span>&nbsp;<span class="ident" id="3389157">err</span><span class="op" id="3389160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389175">var</span>&nbsp;<span class="ident" id="3389179">rsa</span>&nbsp;<span class="ident" id="3389183">syscall</span><span class="op" id="3389190">.</span><span class="ident" id="3389191">Sockaddr</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389201">if</span>&nbsp;<span class="ident" id="3389204">raddr</span>&nbsp;<span class="op" id="3389210">!=</span>&nbsp;<span class="ident" id="3389213">nil</span>&nbsp;<span class="op" id="3389217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389221">if</span>&nbsp;<span class="ident" id="3389224">rsa</span><span class="op" id="3389227">,</span>&nbsp;<span class="ident" id="3389229">err</span>&nbsp;<span class="op" id="3389233">=</span>&nbsp;<span class="ident" id="3389235">raddr</span><span class="op" id="3389240">.</span><span class="ident" id="3389241">sockaddr</span><span class="op" id="3389249">(</span><span class="ident" id="3389250">fd</span><span class="op" id="3389252">.</span><span class="ident" id="3389253">family</span><span class="op" id="3389259">)</span><span class="op" id="3389260">;</span>&nbsp;<span class="ident" id="3389262">err</span>&nbsp;<span class="op" id="3389266">!=</span>&nbsp;<span class="ident" id="3389269">nil</span>&nbsp;<span class="op" id="3389273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389278">return</span>&nbsp;<span class="ident" id="3389285">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389295">if</span>&nbsp;<span class="ident" id="3389298">err</span>&nbsp;<span class="op" id="3389302">:=</span>&nbsp;<span class="ident" id="3389305">fd</span><span class="op" id="3389307">.</span><span class="ident" id="3389308">connect</span><span class="op" id="3389315">(</span><span class="ident" id="3389316">lsa</span><span class="op" id="3389319">,</span>&nbsp;<span class="ident" id="3389321">rsa</span><span class="op" id="3389324">,</span>&nbsp;<span class="ident" id="3389326">deadline</span><span class="op" id="3389334">)</span><span class="op" id="3389335">;</span>&nbsp;<span class="ident" id="3389337">err</span>&nbsp;<span class="op" id="3389341">!=</span>&nbsp;<span class="ident" id="3389344">nil</span>&nbsp;<span class="op" id="3389348">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389353">return</span>&nbsp;<span class="ident" id="3389360">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389370">fd</span><span class="op" id="3389372">.</span><span class="ident" id="3389373">isConnected</span>&nbsp;<span class="op" id="3389385">=</span>&nbsp;<span class="builtintype" id="3389387">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389393">}</span>&nbsp;<span class="keyword" id="3389395">else</span>&nbsp;<span class="op" id="3389400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389404">if</span>&nbsp;<span class="ident" id="3389407">err</span>&nbsp;<span class="op" id="3389411">:=</span>&nbsp;<span class="ident" id="3389414">fd</span><span class="op" id="3389416">.</span><span class="ident" id="3389417">init</span><span class="op" id="3389421">(</span><span class="op" id="3389422">)</span><span class="op" id="3389423">;</span>&nbsp;<span class="ident" id="3389425">err</span>&nbsp;<span class="op" id="3389429">!=</span>&nbsp;<span class="ident" id="3389432">nil</span>&nbsp;<span class="op" id="3389436">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389441">return</span>&nbsp;<span class="ident" id="3389448">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389460">lsa</span><span class="op" id="3389463">,</span>&nbsp;<span class="ident" id="3389465">_</span>&nbsp;<span class="op" id="3389467">=</span>&nbsp;<span class="ident" id="3389469">syscall</span><span class="op" id="3389476">.</span><span class="ident" id="3389477">Getsockname</span><span class="op" id="3389488">(</span><span class="ident" id="3389489">fd</span><span class="op" id="3389491">.</span><span class="ident" id="3389492">sysfd</span><span class="op" id="3389497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389500">if</span>&nbsp;<span class="ident" id="3389503">rsa</span><span class="op" id="3389506">,</span>&nbsp;<span class="ident" id="3389508">_</span>&nbsp;<span class="op" id="3389510">=</span>&nbsp;<span class="ident" id="3389512">syscall</span><span class="op" id="3389519">.</span><span class="ident" id="3389520">Getpeername</span><span class="op" id="3389531">(</span><span class="ident" id="3389532">fd</span><span class="op" id="3389534">.</span><span class="ident" id="3389535">sysfd</span><span class="op" id="3389540">)</span><span class="op" id="3389541">;</span>&nbsp;<span class="ident" id="3389543">rsa</span>&nbsp;<span class="op" id="3389547">!=</span>&nbsp;<span class="ident" id="3389550">nil</span>&nbsp;<span class="op" id="3389554">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389558">fd</span><span class="op" id="3389560">.</span><span class="ident" id="3389561">setAddr</span><span class="op" id="3389568">(</span><span class="ident" id="3389569">fd</span><span class="op" id="3389571">.</span><span class="ident" id="3389572">addrFunc</span><span class="op" id="3389580">(</span><span class="op" id="3389581">)</span><span class="op" id="3389582">(</span><span class="ident" id="3389583">lsa</span><span class="op" id="3389586">)</span><span class="op" id="3389587">,</span>&nbsp;<span class="ident" id="3389589">fd</span><span class="op" id="3389591">.</span><span class="ident" id="3389592">addrFunc</span><span class="op" id="3389600">(</span><span class="op" id="3389601">)</span><span class="op" id="3389602">(</span><span class="ident" id="3389603">rsa</span><span class="op" id="3389606">)</span><span class="op" id="3389607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389610">}</span>&nbsp;<span class="keyword" id="3389612">else</span>&nbsp;<span class="op" id="3389617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389621">fd</span><span class="op" id="3389623">.</span><span class="ident" id="3389624">setAddr</span><span class="op" id="3389631">(</span><span class="ident" id="3389632">fd</span><span class="op" id="3389634">.</span><span class="ident" id="3389635">addrFunc</span><span class="op" id="3389643">(</span><span class="op" id="3389644">)</span><span class="op" id="3389645">(</span><span class="ident" id="3389646">lsa</span><span class="op" id="3389649">)</span><span class="op" id="3389650">,</span>&nbsp;<span class="ident" id="3389652">raddr</span><span class="op" id="3389657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389663">return</span>&nbsp;<span class="ident" id="3389670">nil</span><br>
<span class="lineno">155</span><span class="op" id="3389674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3389677">func</span>&nbsp;<span class="op" id="3389682">(</span><span class="ident" id="3389683">fd</span>&nbsp;<span class="op" id="3389686">*</span><span class="ident" id="3389687">netFD</span><span class="op" id="3389692">)</span>&nbsp;<span class="ident" id="3389694">listenStream</span><span class="op" id="3389706">(</span><span class="ident" id="3389707">laddr</span>&nbsp;<span class="ident" id="3389713">sockaddr</span><span class="op" id="3389721">,</span>&nbsp;<span class="ident" id="3389723">backlog</span>&nbsp;<span class="builtintype" id="3389731">int</span><span class="op" id="3389734">)</span>&nbsp;<span class="builtintype" id="3389736">error</span>&nbsp;<span class="op" id="3389742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389745">if</span>&nbsp;<span class="ident" id="3389748">err</span>&nbsp;<span class="op" id="3389752">:=</span>&nbsp;<span class="ident" id="3389755">setDefaultListenerSockopts</span><span class="op" id="3389781">(</span><span class="ident" id="3389782">fd</span><span class="op" id="3389784">.</span><span class="ident" id="3389785">sysfd</span><span class="op" id="3389790">)</span><span class="op" id="3389791">;</span>&nbsp;<span class="ident" id="3389793">err</span>&nbsp;<span class="op" id="3389797">!=</span>&nbsp;<span class="ident" id="3389800">nil</span>&nbsp;<span class="op" id="3389804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389808">return</span>&nbsp;<span class="ident" id="3389815">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389823">if</span>&nbsp;<span class="ident" id="3389826">lsa</span><span class="op" id="3389829">,</span>&nbsp;<span class="ident" id="3389831">err</span>&nbsp;<span class="op" id="3389835">:=</span>&nbsp;<span class="ident" id="3389838">laddr</span><span class="op" id="3389843">.</span><span class="ident" id="3389844">sockaddr</span><span class="op" id="3389852">(</span><span class="ident" id="3389853">fd</span><span class="op" id="3389855">.</span><span class="ident" id="3389856">family</span><span class="op" id="3389862">)</span><span class="op" id="3389863">;</span>&nbsp;<span class="ident" id="3389865">err</span>&nbsp;<span class="op" id="3389869">!=</span>&nbsp;<span class="ident" id="3389872">nil</span>&nbsp;<span class="op" id="3389876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389880">return</span>&nbsp;<span class="ident" id="3389887">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389892">}</span>&nbsp;<span class="keyword" id="3389894">else</span>&nbsp;<span class="keyword" id="3389899">if</span>&nbsp;<span class="ident" id="3389902">lsa</span>&nbsp;<span class="op" id="3389906">!=</span>&nbsp;<span class="ident" id="3389909">nil</span>&nbsp;<span class="op" id="3389913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389917">if</span>&nbsp;<span class="ident" id="3389920">err</span>&nbsp;<span class="op" id="3389924">:=</span>&nbsp;<span class="ident" id="3389927">syscall</span><span class="op" id="3389934">.</span><span class="ident" id="3389935">Bind</span><span class="op" id="3389939">(</span><span class="ident" id="3389940">fd</span><span class="op" id="3389942">.</span><span class="ident" id="3389943">sysfd</span><span class="op" id="3389948">,</span>&nbsp;<span class="ident" id="3389950">lsa</span><span class="op" id="3389953">)</span><span class="op" id="3389954">;</span>&nbsp;<span class="ident" id="3389956">err</span>&nbsp;<span class="op" id="3389960">!=</span>&nbsp;<span class="ident" id="3389963">nil</span>&nbsp;<span class="op" id="3389967">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389972">return</span>&nbsp;<span class="ident" id="3389979">os</span><span class="op" id="3389981">.</span><span class="ident" id="3389982">NewSyscallError</span><span class="op" id="3389997">(</span><span class="string" id="3389998">&#34;bind&#34;</span><span class="op" id="3390004">,</span>&nbsp;<span class="ident" id="3390006">err</span><span class="op" id="3390009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390019">if</span>&nbsp;<span class="ident" id="3390022">err</span>&nbsp;<span class="op" id="3390026">:=</span>&nbsp;<span class="ident" id="3390029">syscall</span><span class="op" id="3390036">.</span><span class="ident" id="3390037">Listen</span><span class="op" id="3390043">(</span><span class="ident" id="3390044">fd</span><span class="op" id="3390046">.</span><span class="ident" id="3390047">sysfd</span><span class="op" id="3390052">,</span>&nbsp;<span class="ident" id="3390054">backlog</span><span class="op" id="3390061">)</span><span class="op" id="3390062">;</span>&nbsp;<span class="ident" id="3390064">err</span>&nbsp;<span class="op" id="3390068">!=</span>&nbsp;<span class="ident" id="3390071">nil</span>&nbsp;<span class="op" id="3390075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390079">return</span>&nbsp;<span class="ident" id="3390086">os</span><span class="op" id="3390088">.</span><span class="ident" id="3390089">NewSyscallError</span><span class="op" id="3390104">(</span><span class="string" id="3390105">&#34;listen&#34;</span><span class="op" id="3390113">,</span>&nbsp;<span class="ident" id="3390115">err</span><span class="op" id="3390118">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390124">if</span>&nbsp;<span class="ident" id="3390127">err</span>&nbsp;<span class="op" id="3390131">:=</span>&nbsp;<span class="ident" id="3390134">fd</span><span class="op" id="3390136">.</span><span class="ident" id="3390137">init</span><span class="op" id="3390141">(</span><span class="op" id="3390142">)</span><span class="op" id="3390143">;</span>&nbsp;<span class="ident" id="3390145">err</span>&nbsp;<span class="op" id="3390149">!=</span>&nbsp;<span class="ident" id="3390152">nil</span>&nbsp;<span class="op" id="3390156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390160">return</span>&nbsp;<span class="ident" id="3390167">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390175">lsa</span><span class="op" id="3390178">,</span>&nbsp;<span class="ident" id="3390180">_</span>&nbsp;<span class="op" id="3390182">:=</span>&nbsp;<span class="ident" id="3390185">syscall</span><span class="op" id="3390192">.</span><span class="ident" id="3390193">Getsockname</span><span class="op" id="3390204">(</span><span class="ident" id="3390205">fd</span><span class="op" id="3390207">.</span><span class="ident" id="3390208">sysfd</span><span class="op" id="3390213">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390216">fd</span><span class="op" id="3390218">.</span><span class="ident" id="3390219">setAddr</span><span class="op" id="3390226">(</span><span class="ident" id="3390227">fd</span><span class="op" id="3390229">.</span><span class="ident" id="3390230">addrFunc</span><span class="op" id="3390238">(</span><span class="op" id="3390239">)</span><span class="op" id="3390240">(</span><span class="ident" id="3390241">lsa</span><span class="op" id="3390244">)</span><span class="op" id="3390245">,</span>&nbsp;<span class="ident" id="3390247">nil</span><span class="op" id="3390250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390253">return</span>&nbsp;<span class="ident" id="3390260">nil</span><br>
<span class="lineno"></span><span class="op" id="3390264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3390267">func</span>&nbsp;<span class="op" id="3390272">(</span><span class="ident" id="3390273">fd</span>&nbsp;<span class="op" id="3390276">*</span><span class="ident" id="3390277">netFD</span><span class="op" id="3390282">)</span>&nbsp;<span class="ident" id="3390284">listenDatagram</span><span class="op" id="3390298">(</span><span class="ident" id="3390299">laddr</span>&nbsp;<span class="ident" id="3390305">sockaddr</span><span class="op" id="3390313">)</span>&nbsp;<span class="builtintype" id="3390315">error</span>&nbsp;<span class="op" id="3390321">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390324">switch</span>&nbsp;<span class="ident" id="3390331">addr</span>&nbsp;<span class="op" id="3390336">:=</span>&nbsp;<span class="ident" id="3390339">laddr</span><span class="op" id="3390344">.</span><span class="op" id="3390345">(</span><span class="keyword" id="3390346">type</span><span class="op" id="3390350">)</span>&nbsp;<span class="op" id="3390352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390355">case</span>&nbsp;<span class="op" id="3390360">*</span><span class="ident" id="3390361">UDPAddr</span><span class="op" id="3390368">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3390372">//&nbsp;We&nbsp;provide&nbsp;a&nbsp;socket&nbsp;that&nbsp;listens&nbsp;to&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3390424">//&nbsp;address&nbsp;with&nbsp;reusable&nbsp;UDP&nbsp;port&nbsp;when&nbsp;the&nbsp;given&nbsp;laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3390481">//&nbsp;is&nbsp;an&nbsp;appropriate&nbsp;UDP&nbsp;multicast&nbsp;address&nbsp;prefix.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3390534">//&nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;for&nbsp;a&nbsp;single&nbsp;UDP&nbsp;listener&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3390591">//&nbsp;join&nbsp;multiple&nbsp;different&nbsp;group&nbsp;addresses,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3390641">//&nbsp;multiple&nbsp;UDP&nbsp;listeners&nbsp;that&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;UDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3390697">//&nbsp;port&nbsp;to&nbsp;join&nbsp;the&nbsp;same&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390739">if</span>&nbsp;<span class="ident" id="3390742">addr</span><span class="op" id="3390746">.</span><span class="ident" id="3390747">IP</span>&nbsp;<span class="op" id="3390750">!=</span>&nbsp;<span class="ident" id="3390753">nil</span>&nbsp;<span class="op" id="3390757">&amp;&amp;</span>&nbsp;<span class="ident" id="3390760">addr</span><span class="op" id="3390764">.</span><span class="ident" id="3390765">IP</span><span class="op" id="3390767">.</span><span class="ident" id="3390768">IsMulticast</span><span class="op" id="3390779">(</span><span class="op" id="3390780">)</span>&nbsp;<span class="op" id="3390782">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390787">if</span>&nbsp;<span class="ident" id="3390790">err</span>&nbsp;<span class="op" id="3390794">:=</span>&nbsp;<span class="ident" id="3390797">setDefaultMulticastSockopts</span><span class="op" id="3390824">(</span><span class="ident" id="3390825">fd</span><span class="op" id="3390827">.</span><span class="ident" id="3390828">sysfd</span><span class="op" id="3390833">)</span><span class="op" id="3390834">;</span>&nbsp;<span class="ident" id="3390836">err</span>&nbsp;<span class="op" id="3390840">!=</span>&nbsp;<span class="ident" id="3390843">nil</span>&nbsp;<span class="op" id="3390847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390853">return</span>&nbsp;<span class="ident" id="3390860">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390872">addr</span>&nbsp;<span class="op" id="3390877">:=</span>&nbsp;<span class="op" id="3390880">*</span><span class="ident" id="3390881">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390889">switch</span>&nbsp;<span class="ident" id="3390896">fd</span><span class="op" id="3390898">.</span><span class="ident" id="3390899">family</span>&nbsp;<span class="op" id="3390906">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390911">case</span>&nbsp;<span class="ident" id="3390916">syscall</span><span class="op" id="3390923">.</span><span class="ident" id="3390924">AF_INET</span><span class="op" id="3390931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390937">addr</span><span class="op" id="3390941">.</span><span class="ident" id="3390942">IP</span>&nbsp;<span class="op" id="3390945">=</span>&nbsp;<span class="ident" id="3390947">IPv4zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390959">case</span>&nbsp;<span class="ident" id="3390964">syscall</span><span class="op" id="3390971">.</span><span class="ident" id="3390972">AF_INET6</span><span class="op" id="3390980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390986">addr</span><span class="op" id="3390990">.</span><span class="ident" id="3390991">IP</span>&nbsp;<span class="op" id="3390994">=</span>&nbsp;<span class="ident" id="3390996">IPv6unspecified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391015">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391020">laddr</span>&nbsp;<span class="op" id="3391026">=</span>&nbsp;<span class="op" id="3391028">&amp;</span><span class="ident" id="3391029">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391042">if</span>&nbsp;<span class="ident" id="3391045">lsa</span><span class="op" id="3391048">,</span>&nbsp;<span class="ident" id="3391050">err</span>&nbsp;<span class="op" id="3391054">:=</span>&nbsp;<span class="ident" id="3391057">laddr</span><span class="op" id="3391062">.</span><span class="ident" id="3391063">sockaddr</span><span class="op" id="3391071">(</span><span class="ident" id="3391072">fd</span><span class="op" id="3391074">.</span><span class="ident" id="3391075">family</span><span class="op" id="3391081">)</span><span class="op" id="3391082">;</span>&nbsp;<span class="ident" id="3391084">err</span>&nbsp;<span class="op" id="3391088">!=</span>&nbsp;<span class="ident" id="3391091">nil</span>&nbsp;<span class="op" id="3391095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391099">return</span>&nbsp;<span class="ident" id="3391106">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391111">}</span>&nbsp;<span class="keyword" id="3391113">else</span>&nbsp;<span class="keyword" id="3391118">if</span>&nbsp;<span class="ident" id="3391121">lsa</span>&nbsp;<span class="op" id="3391125">!=</span>&nbsp;<span class="ident" id="3391128">nil</span>&nbsp;<span class="op" id="3391132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391136">if</span>&nbsp;<span class="ident" id="3391139">err</span>&nbsp;<span class="op" id="3391143">:=</span>&nbsp;<span class="ident" id="3391146">syscall</span><span class="op" id="3391153">.</span><span class="ident" id="3391154">Bind</span><span class="op" id="3391158">(</span><span class="ident" id="3391159">fd</span><span class="op" id="3391161">.</span><span class="ident" id="3391162">sysfd</span><span class="op" id="3391167">,</span>&nbsp;<span class="ident" id="3391169">lsa</span><span class="op" id="3391172">)</span><span class="op" id="3391173">;</span>&nbsp;<span class="ident" id="3391175">err</span>&nbsp;<span class="op" id="3391179">!=</span>&nbsp;<span class="ident" id="3391182">nil</span>&nbsp;<span class="op" id="3391186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391191">return</span>&nbsp;<span class="ident" id="3391198">os</span><span class="op" id="3391200">.</span><span class="ident" id="3391201">NewSyscallError</span><span class="op" id="3391216">(</span><span class="string" id="3391217">&#34;bind&#34;</span><span class="op" id="3391223">,</span>&nbsp;<span class="ident" id="3391225">err</span><span class="op" id="3391228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391235">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391238">if</span>&nbsp;<span class="ident" id="3391241">err</span>&nbsp;<span class="op" id="3391245">:=</span>&nbsp;<span class="ident" id="3391248">fd</span><span class="op" id="3391250">.</span><span class="ident" id="3391251">init</span><span class="op" id="3391255">(</span><span class="op" id="3391256">)</span><span class="op" id="3391257">;</span>&nbsp;<span class="ident" id="3391259">err</span>&nbsp;<span class="op" id="3391263">!=</span>&nbsp;<span class="ident" id="3391266">nil</span>&nbsp;<span class="op" id="3391270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391274">return</span>&nbsp;<span class="ident" id="3391281">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391289">lsa</span><span class="op" id="3391292">,</span>&nbsp;<span class="ident" id="3391294">_</span>&nbsp;<span class="op" id="3391296">:=</span>&nbsp;<span class="ident" id="3391299">syscall</span><span class="op" id="3391306">.</span><span class="ident" id="3391307">Getsockname</span><span class="op" id="3391318">(</span><span class="ident" id="3391319">fd</span><span class="op" id="3391321">.</span><span class="ident" id="3391322">sysfd</span><span class="op" id="3391327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391330">fd</span><span class="op" id="3391332">.</span><span class="ident" id="3391333">setAddr</span><span class="op" id="3391340">(</span><span class="ident" id="3391341">fd</span><span class="op" id="3391343">.</span><span class="ident" id="3391344">addrFunc</span><span class="op" id="3391352">(</span><span class="op" id="3391353">)</span><span class="op" id="3391354">(</span><span class="ident" id="3391355">lsa</span><span class="op" id="3391358">)</span><span class="op" id="3391359">,</span>&nbsp;<span class="ident" id="3391361">nil</span><span class="op" id="3391364">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391367">return</span>&nbsp;<span class="ident" id="3391374">nil</span><br>
<span class="lineno"></span><span class="op" id="3391378">}</span>
</div>
</body>
</html>
