<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7556920">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7556975">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7557029">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7557080">package</span>&nbsp;<span class="ident" id="7557088">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7557093">import</span>&nbsp;<span class="op" id="7557100">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557103">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557112">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557121">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557136">_</span>&nbsp;<span class="string" id="7557138">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557151">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557164">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557177">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557183">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7557193">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7557196">func</span>&nbsp;<span class="ident" id="7557201">readImg</span><span class="op" id="7557208">(</span><span class="ident" id="7557209">filename</span>&nbsp;<span class="builtintype" id="7557218">string</span><span class="op" id="7557224">)</span>&nbsp;<span class="op" id="7557226">(</span><span class="ident" id="7557227">image</span><span class="op" id="7557232">.</span><span class="ident" id="7557233">Image</span><span class="op" id="7557238">,</span>&nbsp;<span class="builtintype" id="7557240">error</span><span class="op" id="7557245">)</span>&nbsp;<span class="op" id="7557247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557250">f</span><span class="op" id="7557251">,</span>&nbsp;<span class="ident" id="7557253">err</span>&nbsp;<span class="op" id="7557257">:=</span>&nbsp;<span class="ident" id="7557260">os</span><span class="op" id="7557262">.</span><span class="ident" id="7557263">Open</span><span class="op" id="7557267">(</span><span class="ident" id="7557268">filename</span><span class="op" id="7557276">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557279">if</span>&nbsp;<span class="ident" id="7557282">err</span>&nbsp;<span class="op" id="7557286">!=</span>&nbsp;<span class="ident" id="7557289">nil</span>&nbsp;<span class="op" id="7557293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557297">return</span>&nbsp;<span class="ident" id="7557304">nil</span><span class="op" id="7557307">,</span>&nbsp;<span class="ident" id="7557309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557317">defer</span>&nbsp;<span class="ident" id="7557323">f</span><span class="op" id="7557324">.</span><span class="ident" id="7557325">Close</span><span class="op" id="7557330">(</span><span class="op" id="7557331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557334">m</span><span class="op" id="7557335">,</span>&nbsp;<span class="ident" id="7557337">_</span><span class="op" id="7557338">,</span>&nbsp;<span class="ident" id="7557340">err</span>&nbsp;<span class="op" id="7557344">:=</span>&nbsp;<span class="ident" id="7557347">image</span><span class="op" id="7557352">.</span><span class="ident" id="7557353">Decode</span><span class="op" id="7557359">(</span><span class="ident" id="7557360">f</span><span class="op" id="7557361">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557364">return</span>&nbsp;<span class="ident" id="7557371">m</span><span class="op" id="7557372">,</span>&nbsp;<span class="ident" id="7557374">err</span><br>
<span class="lineno"></span><span class="op" id="7557378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7557381">func</span>&nbsp;<span class="ident" id="7557386">readGIF</span><span class="op" id="7557393">(</span><span class="ident" id="7557394">filename</span>&nbsp;<span class="builtintype" id="7557403">string</span><span class="op" id="7557409">)</span>&nbsp;<span class="op" id="7557411">(</span><span class="op" id="7557412">*</span><span class="ident" id="7557413">GIF</span><span class="op" id="7557416">,</span>&nbsp;<span class="builtintype" id="7557418">error</span><span class="op" id="7557423">)</span>&nbsp;<span class="op" id="7557425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557428">f</span><span class="op" id="7557429">,</span>&nbsp;<span class="ident" id="7557431">err</span>&nbsp;<span class="op" id="7557435">:=</span>&nbsp;<span class="ident" id="7557438">os</span><span class="op" id="7557440">.</span><span class="ident" id="7557441">Open</span><span class="op" id="7557445">(</span><span class="ident" id="7557446">filename</span><span class="op" id="7557454">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557457">if</span>&nbsp;<span class="ident" id="7557460">err</span>&nbsp;<span class="op" id="7557464">!=</span>&nbsp;<span class="ident" id="7557467">nil</span>&nbsp;<span class="op" id="7557471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557475">return</span>&nbsp;<span class="ident" id="7557482">nil</span><span class="op" id="7557485">,</span>&nbsp;<span class="ident" id="7557487">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557495">defer</span>&nbsp;<span class="ident" id="7557501">f</span><span class="op" id="7557502">.</span><span class="ident" id="7557503">Close</span><span class="op" id="7557508">(</span><span class="op" id="7557509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557512">return</span>&nbsp;<span class="ident" id="7557519">DecodeAll</span><span class="op" id="7557528">(</span><span class="ident" id="7557529">f</span><span class="op" id="7557530">)</span><br>
<span class="lineno">35</span><span class="op" id="7557532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7557535">func</span>&nbsp;<span class="ident" id="7557540">delta</span><span class="op" id="7557545">(</span><span class="ident" id="7557546">u0</span><span class="op" id="7557548">,</span>&nbsp;<span class="ident" id="7557550">u1</span>&nbsp;<span class="builtintype" id="7557553">uint32</span><span class="op" id="7557559">)</span>&nbsp;<span class="ident" id="7557561">int64</span>&nbsp;<span class="op" id="7557567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557570">d</span>&nbsp;<span class="op" id="7557572">:=</span>&nbsp;<span class="ident" id="7557575">int64</span><span class="op" id="7557580">(</span><span class="ident" id="7557581">u0</span><span class="op" id="7557583">)</span>&nbsp;<span class="op" id="7557585">-</span>&nbsp;<span class="ident" id="7557587">int64</span><span class="op" id="7557592">(</span><span class="ident" id="7557593">u1</span><span class="op" id="7557595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557598">if</span>&nbsp;<span class="ident" id="7557601">d</span>&nbsp;<span class="op" id="7557603">&lt;</span>&nbsp;<span class="num" id="7557605">0</span>&nbsp;<span class="op" id="7557607">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557611">return</span>&nbsp;<span class="op" id="7557618">-</span><span class="ident" id="7557619">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557625">return</span>&nbsp;<span class="ident" id="7557632">d</span><br>
<span class="lineno"></span><span class="op" id="7557634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="7557637">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="7557713">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7557738">func</span>&nbsp;<span class="ident" id="7557743">averageDelta</span><span class="op" id="7557755">(</span><span class="ident" id="7557756">m0</span><span class="op" id="7557758">,</span>&nbsp;<span class="ident" id="7557760">m1</span>&nbsp;<span class="ident" id="7557763">image</span><span class="op" id="7557768">.</span><span class="ident" id="7557769">Image</span><span class="op" id="7557774">)</span>&nbsp;<span class="ident" id="7557776">int64</span>&nbsp;<span class="op" id="7557782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557785">b</span>&nbsp;<span class="op" id="7557787">:=</span>&nbsp;<span class="ident" id="7557790">m0</span><span class="op" id="7557792">.</span><span class="ident" id="7557793">Bounds</span><span class="op" id="7557799">(</span><span class="op" id="7557800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557803">var</span>&nbsp;<span class="ident" id="7557807">sum</span><span class="op" id="7557810">,</span>&nbsp;<span class="ident" id="7557812">n</span>&nbsp;<span class="ident" id="7557814">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557821">for</span>&nbsp;<span class="ident" id="7557825">y</span>&nbsp;<span class="op" id="7557827">:=</span>&nbsp;<span class="ident" id="7557830">b</span><span class="op" id="7557831">.</span><span class="ident" id="7557832">Min</span><span class="op" id="7557835">.</span><span class="ident" id="7557836">Y</span><span class="op" id="7557837">;</span>&nbsp;<span class="ident" id="7557839">y</span>&nbsp;<span class="op" id="7557841">&lt;</span>&nbsp;<span class="ident" id="7557843">b</span><span class="op" id="7557844">.</span><span class="ident" id="7557845">Max</span><span class="op" id="7557848">.</span><span class="ident" id="7557849">Y</span><span class="op" id="7557850">;</span>&nbsp;<span class="ident" id="7557852">y</span><span class="op" id="7557853">++</span>&nbsp;<span class="op" id="7557856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7557860">for</span>&nbsp;<span class="ident" id="7557864">x</span>&nbsp;<span class="op" id="7557866">:=</span>&nbsp;<span class="ident" id="7557869">b</span><span class="op" id="7557870">.</span><span class="ident" id="7557871">Min</span><span class="op" id="7557874">.</span><span class="ident" id="7557875">X</span><span class="op" id="7557876">;</span>&nbsp;<span class="ident" id="7557878">x</span>&nbsp;<span class="op" id="7557880">&lt;</span>&nbsp;<span class="ident" id="7557882">b</span><span class="op" id="7557883">.</span><span class="ident" id="7557884">Max</span><span class="op" id="7557887">.</span><span class="ident" id="7557888">X</span><span class="op" id="7557889">;</span>&nbsp;<span class="ident" id="7557891">x</span><span class="op" id="7557892">++</span>&nbsp;<span class="op" id="7557895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557900">c0</span>&nbsp;<span class="op" id="7557903">:=</span>&nbsp;<span class="ident" id="7557906">m0</span><span class="op" id="7557908">.</span><span class="ident" id="7557909">At</span><span class="op" id="7557911">(</span><span class="ident" id="7557912">x</span><span class="op" id="7557913">,</span>&nbsp;<span class="ident" id="7557915">y</span><span class="op" id="7557916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557921">c1</span>&nbsp;<span class="op" id="7557924">:=</span>&nbsp;<span class="ident" id="7557927">m1</span><span class="op" id="7557929">.</span><span class="ident" id="7557930">At</span><span class="op" id="7557932">(</span><span class="ident" id="7557933">x</span><span class="op" id="7557934">,</span>&nbsp;<span class="ident" id="7557936">y</span><span class="op" id="7557937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557942">r0</span><span class="op" id="7557944">,</span>&nbsp;<span class="ident" id="7557946">g0</span><span class="op" id="7557948">,</span>&nbsp;<span class="ident" id="7557950">b0</span><span class="op" id="7557952">,</span>&nbsp;<span class="ident" id="7557954">_</span>&nbsp;<span class="op" id="7557956">:=</span>&nbsp;<span class="ident" id="7557959">c0</span><span class="op" id="7557961">.</span><span class="ident" id="7557962">RGBA</span><span class="op" id="7557966">(</span><span class="op" id="7557967">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557972">r1</span><span class="op" id="7557974">,</span>&nbsp;<span class="ident" id="7557976">g1</span><span class="op" id="7557978">,</span>&nbsp;<span class="ident" id="7557980">b1</span><span class="op" id="7557982">,</span>&nbsp;<span class="ident" id="7557984">_</span>&nbsp;<span class="op" id="7557986">:=</span>&nbsp;<span class="ident" id="7557989">c1</span><span class="op" id="7557991">.</span><span class="ident" id="7557992">RGBA</span><span class="op" id="7557996">(</span><span class="op" id="7557997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558002">sum</span>&nbsp;<span class="op" id="7558006">+=</span>&nbsp;<span class="ident" id="7558009">delta</span><span class="op" id="7558014">(</span><span class="ident" id="7558015">r0</span><span class="op" id="7558017">,</span>&nbsp;<span class="ident" id="7558019">r1</span><span class="op" id="7558021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558026">sum</span>&nbsp;<span class="op" id="7558030">+=</span>&nbsp;<span class="ident" id="7558033">delta</span><span class="op" id="7558038">(</span><span class="ident" id="7558039">g0</span><span class="op" id="7558041">,</span>&nbsp;<span class="ident" id="7558043">g1</span><span class="op" id="7558045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558050">sum</span>&nbsp;<span class="op" id="7558054">+=</span>&nbsp;<span class="ident" id="7558057">delta</span><span class="op" id="7558062">(</span><span class="ident" id="7558063">b0</span><span class="op" id="7558065">,</span>&nbsp;<span class="ident" id="7558067">b1</span><span class="op" id="7558069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558074">n</span>&nbsp;<span class="op" id="7558076">+=</span>&nbsp;<span class="num" id="7558079">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558089">return</span>&nbsp;<span class="ident" id="7558096">sum</span>&nbsp;<span class="op" id="7558100">/</span>&nbsp;<span class="ident" id="7558102">n</span><br>
<span class="lineno"></span><span class="op" id="7558104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7558107">var</span>&nbsp;<span class="ident" id="7558111">testCase</span>&nbsp;<span class="op" id="7558120">=</span>&nbsp;<span class="op" id="7558122">[</span><span class="op" id="7558123">]</span><span class="keyword" id="7558124">struct</span>&nbsp;<span class="op" id="7558131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558134">filename</span>&nbsp;&nbsp;<span class="builtintype" id="7558144">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558152">tolerance</span>&nbsp;<span class="ident" id="7558162">int64</span><br>
<span class="lineno"></span><span class="op" id="7558168">}</span><span class="op" id="7558169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558172">{</span><span class="string" id="7558173">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7558200">,</span>&nbsp;<span class="num" id="7558202">1</span>&nbsp;<span class="op" id="7558204">&lt;&lt;</span>&nbsp;<span class="num" id="7558207">12</span><span class="op" id="7558209">}</span><span class="op" id="7558210">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558213">{</span><span class="string" id="7558214">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7558241">,</span>&nbsp;<span class="num" id="7558243">0</span><span class="op" id="7558244">}</span><span class="op" id="7558245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558248">{</span><span class="string" id="7558249">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="7558287">,</span>&nbsp;<span class="num" id="7558289">0</span><span class="op" id="7558290">}</span><span class="op" id="7558291">,</span><br>
<span class="lineno"></span><span class="op" id="7558293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7558296">func</span>&nbsp;<span class="ident" id="7558301">TestWriter</span><span class="op" id="7558311">(</span><span class="ident" id="7558312">t</span>&nbsp;<span class="op" id="7558314">*</span><span class="ident" id="7558315">testing</span><span class="op" id="7558322">.</span><span class="ident" id="7558323">T</span><span class="op" id="7558324">)</span>&nbsp;<span class="op" id="7558326">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558329">for</span>&nbsp;<span class="ident" id="7558333">_</span><span class="op" id="7558334">,</span>&nbsp;<span class="ident" id="7558336">tc</span>&nbsp;<span class="op" id="7558339">:=</span>&nbsp;<span class="keyword" id="7558342">range</span>&nbsp;<span class="ident" id="7558348">testCase</span>&nbsp;<span class="op" id="7558357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558361">m0</span><span class="op" id="7558363">,</span>&nbsp;<span class="ident" id="7558365">err</span>&nbsp;<span class="op" id="7558369">:=</span>&nbsp;<span class="ident" id="7558372">readImg</span><span class="op" id="7558379">(</span><span class="ident" id="7558380">tc</span><span class="op" id="7558382">.</span><span class="ident" id="7558383">filename</span><span class="op" id="7558391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558395">if</span>&nbsp;<span class="ident" id="7558398">err</span>&nbsp;<span class="op" id="7558402">!=</span>&nbsp;<span class="ident" id="7558405">nil</span>&nbsp;<span class="op" id="7558409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558414">t</span><span class="op" id="7558415">.</span><span class="ident" id="7558416">Error</span><span class="op" id="7558421">(</span><span class="ident" id="7558422">tc</span><span class="op" id="7558424">.</span><span class="ident" id="7558425">filename</span><span class="op" id="7558433">,</span>&nbsp;<span class="ident" id="7558435">err</span><span class="op" id="7558438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558443">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558458">var</span>&nbsp;<span class="ident" id="7558462">buf</span>&nbsp;<span class="ident" id="7558466">bytes</span><span class="op" id="7558471">.</span><span class="ident" id="7558472">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558481">err</span>&nbsp;<span class="op" id="7558485">=</span>&nbsp;<span class="ident" id="7558487">Encode</span><span class="op" id="7558493">(</span><span class="op" id="7558494">&amp;</span><span class="ident" id="7558495">buf</span><span class="op" id="7558498">,</span>&nbsp;<span class="ident" id="7558500">m0</span><span class="op" id="7558502">,</span>&nbsp;<span class="ident" id="7558504">nil</span><span class="op" id="7558507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558511">if</span>&nbsp;<span class="ident" id="7558514">err</span>&nbsp;<span class="op" id="7558518">!=</span>&nbsp;<span class="ident" id="7558521">nil</span>&nbsp;<span class="op" id="7558525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558530">t</span><span class="op" id="7558531">.</span><span class="ident" id="7558532">Error</span><span class="op" id="7558537">(</span><span class="ident" id="7558538">tc</span><span class="op" id="7558540">.</span><span class="ident" id="7558541">filename</span><span class="op" id="7558549">,</span>&nbsp;<span class="ident" id="7558551">err</span><span class="op" id="7558554">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558559">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558574">m1</span><span class="op" id="7558576">,</span>&nbsp;<span class="ident" id="7558578">err</span>&nbsp;<span class="op" id="7558582">:=</span>&nbsp;<span class="ident" id="7558585">Decode</span><span class="op" id="7558591">(</span><span class="op" id="7558592">&amp;</span><span class="ident" id="7558593">buf</span><span class="op" id="7558596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558600">if</span>&nbsp;<span class="ident" id="7558603">err</span>&nbsp;<span class="op" id="7558607">!=</span>&nbsp;<span class="ident" id="7558610">nil</span>&nbsp;<span class="op" id="7558614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558619">t</span><span class="op" id="7558620">.</span><span class="ident" id="7558621">Error</span><span class="op" id="7558626">(</span><span class="ident" id="7558627">tc</span><span class="op" id="7558629">.</span><span class="ident" id="7558630">filename</span><span class="op" id="7558638">,</span>&nbsp;<span class="ident" id="7558640">err</span><span class="op" id="7558643">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558648">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558663">if</span>&nbsp;<span class="ident" id="7558666">m0</span><span class="op" id="7558668">.</span><span class="ident" id="7558669">Bounds</span><span class="op" id="7558675">(</span><span class="op" id="7558676">)</span>&nbsp;<span class="op" id="7558678">!=</span>&nbsp;<span class="ident" id="7558681">m1</span><span class="op" id="7558683">.</span><span class="ident" id="7558684">Bounds</span><span class="op" id="7558690">(</span><span class="op" id="7558691">)</span>&nbsp;<span class="op" id="7558693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558698">t</span><span class="op" id="7558699">.</span><span class="ident" id="7558700">Errorf</span><span class="op" id="7558706">(</span><span class="string" id="7558707">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7558737">,</span>&nbsp;<span class="ident" id="7558739">tc</span><span class="op" id="7558741">.</span><span class="ident" id="7558742">filename</span><span class="op" id="7558750">,</span>&nbsp;<span class="ident" id="7558752">m0</span><span class="op" id="7558754">.</span><span class="ident" id="7558755">Bounds</span><span class="op" id="7558761">(</span><span class="op" id="7558762">)</span><span class="op" id="7558763">,</span>&nbsp;<span class="ident" id="7558765">m1</span><span class="op" id="7558767">.</span><span class="ident" id="7558768">Bounds</span><span class="op" id="7558774">(</span><span class="op" id="7558775">)</span><span class="op" id="7558776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558781">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7558796">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558851">avgDelta</span>&nbsp;<span class="op" id="7558860">:=</span>&nbsp;<span class="ident" id="7558863">averageDelta</span><span class="op" id="7558875">(</span><span class="ident" id="7558876">m0</span><span class="op" id="7558878">,</span>&nbsp;<span class="ident" id="7558880">m1</span><span class="op" id="7558882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558886">if</span>&nbsp;<span class="ident" id="7558889">avgDelta</span>&nbsp;<span class="op" id="7558898">&gt;</span>&nbsp;<span class="ident" id="7558900">tc</span><span class="op" id="7558902">.</span><span class="ident" id="7558903">tolerance</span>&nbsp;<span class="op" id="7558913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558918">t</span><span class="op" id="7558919">.</span><span class="ident" id="7558920">Errorf</span><span class="op" id="7558926">(</span><span class="string" id="7558927">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7558980">,</span>&nbsp;<span class="ident" id="7558982">tc</span><span class="op" id="7558984">.</span><span class="ident" id="7558985">filename</span><span class="op" id="7558993">,</span>&nbsp;<span class="ident" id="7558995">tc</span><span class="op" id="7558997">.</span><span class="ident" id="7558998">tolerance</span><span class="op" id="7559007">,</span>&nbsp;<span class="ident" id="7559009">avgDelta</span><span class="op" id="7559017">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559022">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559036">}</span><br>
<span class="lineno"></span><span class="op" id="7559038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7559041">func</span>&nbsp;<span class="ident" id="7559046">TestSubImage</span><span class="op" id="7559058">(</span><span class="ident" id="7559059">t</span>&nbsp;<span class="op" id="7559061">*</span><span class="ident" id="7559062">testing</span><span class="op" id="7559069">.</span><span class="ident" id="7559070">T</span><span class="op" id="7559071">)</span>&nbsp;<span class="op" id="7559073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559076">m0</span><span class="op" id="7559078">,</span>&nbsp;<span class="ident" id="7559080">err</span>&nbsp;<span class="op" id="7559084">:=</span>&nbsp;<span class="ident" id="7559087">readImg</span><span class="op" id="7559094">(</span><span class="string" id="7559095">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7559122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559125">if</span>&nbsp;<span class="ident" id="7559128">err</span>&nbsp;<span class="op" id="7559132">!=</span>&nbsp;<span class="ident" id="7559135">nil</span>&nbsp;<span class="op" id="7559139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559143">t</span><span class="op" id="7559144">.</span><span class="ident" id="7559145">Fatalf</span><span class="op" id="7559151">(</span><span class="string" id="7559152">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="7559165">,</span>&nbsp;<span class="ident" id="7559167">err</span><span class="op" id="7559170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559173">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559176">m0</span>&nbsp;<span class="op" id="7559179">=</span>&nbsp;<span class="ident" id="7559181">m0</span><span class="op" id="7559183">.</span><span class="op" id="7559184">(</span><span class="op" id="7559185">*</span><span class="ident" id="7559186">image</span><span class="op" id="7559191">.</span><span class="ident" id="7559192">Paletted</span><span class="op" id="7559200">)</span><span class="op" id="7559201">.</span><span class="ident" id="7559202">SubImage</span><span class="op" id="7559210">(</span><span class="ident" id="7559211">image</span><span class="op" id="7559216">.</span><span class="ident" id="7559217">Rect</span><span class="op" id="7559221">(</span><span class="num" id="7559222">0</span><span class="op" id="7559223">,</span>&nbsp;<span class="num" id="7559225">0</span><span class="op" id="7559226">,</span>&nbsp;<span class="num" id="7559228">50</span><span class="op" id="7559230">,</span>&nbsp;<span class="num" id="7559232">30</span><span class="op" id="7559234">)</span><span class="op" id="7559235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559238">var</span>&nbsp;<span class="ident" id="7559242">buf</span>&nbsp;<span class="ident" id="7559246">bytes</span><span class="op" id="7559251">.</span><span class="ident" id="7559252">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559260">err</span>&nbsp;<span class="op" id="7559264">=</span>&nbsp;<span class="ident" id="7559266">Encode</span><span class="op" id="7559272">(</span><span class="op" id="7559273">&amp;</span><span class="ident" id="7559274">buf</span><span class="op" id="7559277">,</span>&nbsp;<span class="ident" id="7559279">m0</span><span class="op" id="7559281">,</span>&nbsp;<span class="ident" id="7559283">nil</span><span class="op" id="7559286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559289">if</span>&nbsp;<span class="ident" id="7559292">err</span>&nbsp;<span class="op" id="7559296">!=</span>&nbsp;<span class="ident" id="7559299">nil</span>&nbsp;<span class="op" id="7559303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559307">t</span><span class="op" id="7559308">.</span><span class="ident" id="7559309">Fatalf</span><span class="op" id="7559315">(</span><span class="string" id="7559316">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="7559328">,</span>&nbsp;<span class="ident" id="7559330">err</span><span class="op" id="7559333">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559339">m1</span><span class="op" id="7559341">,</span>&nbsp;<span class="ident" id="7559343">err</span>&nbsp;<span class="op" id="7559347">:=</span>&nbsp;<span class="ident" id="7559350">Decode</span><span class="op" id="7559356">(</span><span class="op" id="7559357">&amp;</span><span class="ident" id="7559358">buf</span><span class="op" id="7559361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559364">if</span>&nbsp;<span class="ident" id="7559367">err</span>&nbsp;<span class="op" id="7559371">!=</span>&nbsp;<span class="ident" id="7559374">nil</span>&nbsp;<span class="op" id="7559378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559382">t</span><span class="op" id="7559383">.</span><span class="ident" id="7559384">Fatalf</span><span class="op" id="7559390">(</span><span class="string" id="7559391">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="7559403">,</span>&nbsp;<span class="ident" id="7559405">err</span><span class="op" id="7559408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559411">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559414">if</span>&nbsp;<span class="ident" id="7559417">m0</span><span class="op" id="7559419">.</span><span class="ident" id="7559420">Bounds</span><span class="op" id="7559426">(</span><span class="op" id="7559427">)</span>&nbsp;<span class="op" id="7559429">!=</span>&nbsp;<span class="ident" id="7559432">m1</span><span class="op" id="7559434">.</span><span class="ident" id="7559435">Bounds</span><span class="op" id="7559441">(</span><span class="op" id="7559442">)</span>&nbsp;<span class="op" id="7559444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559448">t</span><span class="op" id="7559449">.</span><span class="ident" id="7559450">Fatalf</span><span class="op" id="7559456">(</span><span class="string" id="7559457">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7559483">,</span>&nbsp;<span class="ident" id="7559485">m0</span><span class="op" id="7559487">.</span><span class="ident" id="7559488">Bounds</span><span class="op" id="7559494">(</span><span class="op" id="7559495">)</span><span class="op" id="7559496">,</span>&nbsp;<span class="ident" id="7559498">m1</span><span class="op" id="7559500">.</span><span class="ident" id="7559501">Bounds</span><span class="op" id="7559507">(</span><span class="op" id="7559508">)</span><span class="op" id="7559509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559515">if</span>&nbsp;<span class="ident" id="7559518">averageDelta</span><span class="op" id="7559530">(</span><span class="ident" id="7559531">m0</span><span class="op" id="7559533">,</span>&nbsp;<span class="ident" id="7559535">m1</span><span class="op" id="7559537">)</span>&nbsp;<span class="op" id="7559539">!=</span>&nbsp;<span class="num" id="7559542">0</span>&nbsp;<span class="op" id="7559544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559548">t</span><span class="op" id="7559549">.</span><span class="ident" id="7559550">Fatalf</span><span class="op" id="7559556">(</span><span class="string" id="7559557">&#34;images&nbsp;differ&#34;</span><span class="op" id="7559572">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559575">}</span><br>
<span class="lineno"></span><span class="op" id="7559577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7559580">var</span>&nbsp;<span class="ident" id="7559584">frames</span>&nbsp;<span class="op" id="7559591">=</span>&nbsp;<span class="op" id="7559593">[</span><span class="op" id="7559594">]</span><span class="builtintype" id="7559595">string</span><span class="op" id="7559601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7559604">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7559631">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7559634">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="7559666">,</span><br>
<span class="lineno"></span><span class="op" id="7559668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7559671">func</span>&nbsp;<span class="ident" id="7559676">TestEncodeAll</span><span class="op" id="7559689">(</span><span class="ident" id="7559690">t</span>&nbsp;<span class="op" id="7559692">*</span><span class="ident" id="7559693">testing</span><span class="op" id="7559700">.</span><span class="ident" id="7559701">T</span><span class="op" id="7559702">)</span>&nbsp;<span class="op" id="7559704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559707">g0</span>&nbsp;<span class="op" id="7559710">:=</span>&nbsp;<span class="op" id="7559713">&amp;</span><span class="ident" id="7559714">GIF</span><span class="op" id="7559717">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559721">Image</span><span class="op" id="7559726">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7559732">make</span><span class="op" id="7559736">(</span><span class="op" id="7559737">[</span><span class="op" id="7559738">]</span><span class="op" id="7559739">*</span><span class="ident" id="7559740">image</span><span class="op" id="7559745">.</span><span class="ident" id="7559746">Paletted</span><span class="op" id="7559754">,</span>&nbsp;<span class="builtinfunc" id="7559756">len</span><span class="op" id="7559759">(</span><span class="ident" id="7559760">frames</span><span class="op" id="7559766">)</span><span class="op" id="7559767">)</span><span class="op" id="7559768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559772">Delay</span><span class="op" id="7559777">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7559783">make</span><span class="op" id="7559787">(</span><span class="op" id="7559788">[</span><span class="op" id="7559789">]</span><span class="builtintype" id="7559790">int</span><span class="op" id="7559793">,</span>&nbsp;<span class="builtinfunc" id="7559795">len</span><span class="op" id="7559798">(</span><span class="ident" id="7559799">frames</span><span class="op" id="7559805">)</span><span class="op" id="7559806">)</span><span class="op" id="7559807">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559811">LoopCount</span><span class="op" id="7559820">:</span>&nbsp;<span class="num" id="7559822">5</span><span class="op" id="7559823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559829">for</span>&nbsp;<span class="ident" id="7559833">i</span><span class="op" id="7559834">,</span>&nbsp;<span class="ident" id="7559836">f</span>&nbsp;<span class="op" id="7559838">:=</span>&nbsp;<span class="keyword" id="7559841">range</span>&nbsp;<span class="ident" id="7559847">frames</span>&nbsp;<span class="op" id="7559854">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559858">m</span><span class="op" id="7559859">,</span>&nbsp;<span class="ident" id="7559861">err</span>&nbsp;<span class="op" id="7559865">:=</span>&nbsp;<span class="ident" id="7559868">readGIF</span><span class="op" id="7559875">(</span><span class="ident" id="7559876">f</span><span class="op" id="7559877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559881">if</span>&nbsp;<span class="ident" id="7559884">err</span>&nbsp;<span class="op" id="7559888">!=</span>&nbsp;<span class="ident" id="7559891">nil</span>&nbsp;<span class="op" id="7559895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559900">t</span><span class="op" id="7559901">.</span><span class="ident" id="7559902">Fatal</span><span class="op" id="7559907">(</span><span class="ident" id="7559908">f</span><span class="op" id="7559909">,</span>&nbsp;<span class="ident" id="7559911">err</span><span class="op" id="7559914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559922">g0</span><span class="op" id="7559924">.</span><span class="ident" id="7559925">Image</span><span class="op" id="7559930">[</span><span class="ident" id="7559931">i</span><span class="op" id="7559932">]</span>&nbsp;<span class="op" id="7559934">=</span>&nbsp;<span class="ident" id="7559936">m</span><span class="op" id="7559937">.</span><span class="ident" id="7559938">Image</span><span class="op" id="7559943">[</span><span class="num" id="7559944">0</span><span class="op" id="7559945">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559951">var</span>&nbsp;<span class="ident" id="7559955">buf</span>&nbsp;<span class="ident" id="7559959">bytes</span><span class="op" id="7559964">.</span><span class="ident" id="7559965">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559973">if</span>&nbsp;<span class="ident" id="7559976">err</span>&nbsp;<span class="op" id="7559980">:=</span>&nbsp;<span class="ident" id="7559983">EncodeAll</span><span class="op" id="7559992">(</span><span class="op" id="7559993">&amp;</span><span class="ident" id="7559994">buf</span><span class="op" id="7559997">,</span>&nbsp;<span class="ident" id="7559999">g0</span><span class="op" id="7560001">)</span><span class="op" id="7560002">;</span>&nbsp;<span class="ident" id="7560004">err</span>&nbsp;<span class="op" id="7560008">!=</span>&nbsp;<span class="ident" id="7560011">nil</span>&nbsp;<span class="op" id="7560015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560019">t</span><span class="op" id="7560020">.</span><span class="ident" id="7560021">Fatal</span><span class="op" id="7560026">(</span><span class="string" id="7560027">&#34;EncodeAll:&#34;</span><span class="op" id="7560039">,</span>&nbsp;<span class="ident" id="7560041">err</span><span class="op" id="7560044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560047">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560050">g1</span><span class="op" id="7560052">,</span>&nbsp;<span class="ident" id="7560054">err</span>&nbsp;<span class="op" id="7560058">:=</span>&nbsp;<span class="ident" id="7560061">DecodeAll</span><span class="op" id="7560070">(</span><span class="op" id="7560071">&amp;</span><span class="ident" id="7560072">buf</span><span class="op" id="7560075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560078">if</span>&nbsp;<span class="ident" id="7560081">err</span>&nbsp;<span class="op" id="7560085">!=</span>&nbsp;<span class="ident" id="7560088">nil</span>&nbsp;<span class="op" id="7560092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560096">t</span><span class="op" id="7560097">.</span><span class="ident" id="7560098">Fatal</span><span class="op" id="7560103">(</span><span class="string" id="7560104">&#34;DecodeAll:&#34;</span><span class="op" id="7560116">,</span>&nbsp;<span class="ident" id="7560118">err</span><span class="op" id="7560121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560127">if</span>&nbsp;<span class="ident" id="7560130">g0</span><span class="op" id="7560132">.</span><span class="ident" id="7560133">LoopCount</span>&nbsp;<span class="op" id="7560143">!=</span>&nbsp;<span class="ident" id="7560146">g1</span><span class="op" id="7560148">.</span><span class="ident" id="7560149">LoopCount</span>&nbsp;<span class="op" id="7560159">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560163">t</span><span class="op" id="7560164">.</span><span class="ident" id="7560165">Errorf</span><span class="op" id="7560171">(</span><span class="string" id="7560172">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7560203">,</span>&nbsp;<span class="ident" id="7560205">g0</span><span class="op" id="7560207">.</span><span class="ident" id="7560208">LoopCount</span><span class="op" id="7560217">,</span>&nbsp;<span class="ident" id="7560219">g1</span><span class="op" id="7560221">.</span><span class="ident" id="7560222">LoopCount</span><span class="op" id="7560231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560237">for</span>&nbsp;<span class="ident" id="7560241">i</span>&nbsp;<span class="op" id="7560243">:=</span>&nbsp;<span class="keyword" id="7560246">range</span>&nbsp;<span class="ident" id="7560252">g0</span><span class="op" id="7560254">.</span><span class="ident" id="7560255">Image</span>&nbsp;<span class="op" id="7560261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560265">m0</span><span class="op" id="7560267">,</span>&nbsp;<span class="ident" id="7560269">m1</span>&nbsp;<span class="op" id="7560272">:=</span>&nbsp;<span class="ident" id="7560275">g0</span><span class="op" id="7560277">.</span><span class="ident" id="7560278">Image</span><span class="op" id="7560283">[</span><span class="ident" id="7560284">i</span><span class="op" id="7560285">]</span><span class="op" id="7560286">,</span>&nbsp;<span class="ident" id="7560288">g1</span><span class="op" id="7560290">.</span><span class="ident" id="7560291">Image</span><span class="op" id="7560296">[</span><span class="ident" id="7560297">i</span><span class="op" id="7560298">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560302">if</span>&nbsp;<span class="ident" id="7560305">m0</span><span class="op" id="7560307">.</span><span class="ident" id="7560308">Bounds</span><span class="op" id="7560314">(</span><span class="op" id="7560315">)</span>&nbsp;<span class="op" id="7560317">!=</span>&nbsp;<span class="ident" id="7560320">m1</span><span class="op" id="7560322">.</span><span class="ident" id="7560323">Bounds</span><span class="op" id="7560329">(</span><span class="op" id="7560330">)</span>&nbsp;<span class="op" id="7560332">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560337">t</span><span class="op" id="7560338">.</span><span class="ident" id="7560339">Errorf</span><span class="op" id="7560345">(</span><span class="string" id="7560346">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7560376">,</span>&nbsp;<span class="ident" id="7560378">frames</span><span class="op" id="7560384">[</span><span class="ident" id="7560385">i</span><span class="op" id="7560386">]</span><span class="op" id="7560387">,</span>&nbsp;<span class="ident" id="7560389">m0</span><span class="op" id="7560391">.</span><span class="ident" id="7560392">Bounds</span><span class="op" id="7560398">(</span><span class="op" id="7560399">)</span><span class="op" id="7560400">,</span>&nbsp;<span class="ident" id="7560402">m1</span><span class="op" id="7560404">.</span><span class="ident" id="7560405">Bounds</span><span class="op" id="7560411">(</span><span class="op" id="7560412">)</span><span class="op" id="7560413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560421">d0</span><span class="op" id="7560423">,</span>&nbsp;<span class="ident" id="7560425">d1</span>&nbsp;<span class="op" id="7560428">:=</span>&nbsp;<span class="ident" id="7560431">g0</span><span class="op" id="7560433">.</span><span class="ident" id="7560434">Delay</span><span class="op" id="7560439">[</span><span class="ident" id="7560440">i</span><span class="op" id="7560441">]</span><span class="op" id="7560442">,</span>&nbsp;<span class="ident" id="7560444">g1</span><span class="op" id="7560446">.</span><span class="ident" id="7560447">Delay</span><span class="op" id="7560452">[</span><span class="ident" id="7560453">i</span><span class="op" id="7560454">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560458">if</span>&nbsp;<span class="ident" id="7560461">d0</span>&nbsp;<span class="op" id="7560464">!=</span>&nbsp;<span class="ident" id="7560467">d1</span>&nbsp;<span class="op" id="7560470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560475">t</span><span class="op" id="7560476">.</span><span class="ident" id="7560477">Errorf</span><span class="op" id="7560483">(</span><span class="string" id="7560484">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7560520">,</span>&nbsp;<span class="ident" id="7560522">frames</span><span class="op" id="7560528">[</span><span class="ident" id="7560529">i</span><span class="op" id="7560530">]</span><span class="op" id="7560531">,</span>&nbsp;<span class="ident" id="7560533">d0</span><span class="op" id="7560535">,</span>&nbsp;<span class="ident" id="7560537">d1</span><span class="op" id="7560539">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560550">g1</span><span class="op" id="7560552">.</span><span class="ident" id="7560553">Delay</span>&nbsp;<span class="op" id="7560559">=</span>&nbsp;<span class="builtinfunc" id="7560561">make</span><span class="op" id="7560565">(</span><span class="op" id="7560566">[</span><span class="op" id="7560567">]</span><span class="builtintype" id="7560568">int</span><span class="op" id="7560571">,</span>&nbsp;<span class="num" id="7560573">1</span><span class="op" id="7560574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560577">if</span>&nbsp;<span class="ident" id="7560580">err</span>&nbsp;<span class="op" id="7560584">:=</span>&nbsp;<span class="ident" id="7560587">EncodeAll</span><span class="op" id="7560596">(</span><span class="ident" id="7560597">ioutil</span><span class="op" id="7560603">.</span><span class="ident" id="7560604">Discard</span><span class="op" id="7560611">,</span>&nbsp;<span class="ident" id="7560613">g1</span><span class="op" id="7560615">)</span><span class="op" id="7560616">;</span>&nbsp;<span class="ident" id="7560618">err</span>&nbsp;<span class="op" id="7560622">==</span>&nbsp;<span class="ident" id="7560625">nil</span>&nbsp;<span class="op" id="7560629">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560633">t</span><span class="op" id="7560634">.</span><span class="ident" id="7560635">Error</span><span class="op" id="7560640">(</span><span class="string" id="7560641">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="7560703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560709">if</span>&nbsp;<span class="ident" id="7560712">err</span>&nbsp;<span class="op" id="7560716">:=</span>&nbsp;<span class="ident" id="7560719">EncodeAll</span><span class="op" id="7560728">(</span><span class="ident" id="7560729">ioutil</span><span class="op" id="7560735">.</span><span class="ident" id="7560736">Discard</span><span class="op" id="7560743">,</span>&nbsp;<span class="op" id="7560745">&amp;</span><span class="ident" id="7560746">GIF</span><span class="op" id="7560749">{</span><span class="op" id="7560750">}</span><span class="op" id="7560751">)</span><span class="op" id="7560752">;</span>&nbsp;<span class="ident" id="7560754">err</span>&nbsp;<span class="op" id="7560758">==</span>&nbsp;<span class="ident" id="7560761">nil</span>&nbsp;<span class="op" id="7560765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560769">t</span><span class="op" id="7560770">.</span><span class="ident" id="7560771">Error</span><span class="op" id="7560776">(</span><span class="string" id="7560777">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="7560818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560821">}</span><br>
<span class="lineno">175</span><span class="op" id="7560823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7560826">func</span>&nbsp;<span class="ident" id="7560831">BenchmarkEncode</span><span class="op" id="7560846">(</span><span class="ident" id="7560847">b</span>&nbsp;<span class="op" id="7560849">*</span><span class="ident" id="7560850">testing</span><span class="op" id="7560857">.</span><span class="ident" id="7560858">B</span><span class="op" id="7560859">)</span>&nbsp;<span class="op" id="7560861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560864">b</span><span class="op" id="7560865">.</span><span class="ident" id="7560866">StopTimer</span><span class="op" id="7560875">(</span><span class="op" id="7560876">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560880">bo</span>&nbsp;<span class="op" id="7560883">:=</span>&nbsp;<span class="ident" id="7560886">image</span><span class="op" id="7560891">.</span><span class="ident" id="7560892">Rect</span><span class="op" id="7560896">(</span><span class="num" id="7560897">0</span><span class="op" id="7560898">,</span>&nbsp;<span class="num" id="7560900">0</span><span class="op" id="7560901">,</span>&nbsp;<span class="num" id="7560903">640</span><span class="op" id="7560906">,</span>&nbsp;<span class="num" id="7560908">480</span><span class="op" id="7560911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560914">rnd</span>&nbsp;<span class="op" id="7560918">:=</span>&nbsp;<span class="ident" id="7560921">rand</span><span class="op" id="7560925">.</span><span class="ident" id="7560926">New</span><span class="op" id="7560929">(</span><span class="ident" id="7560930">rand</span><span class="op" id="7560934">.</span><span class="ident" id="7560935">NewSource</span><span class="op" id="7560944">(</span><span class="num" id="7560945">123</span><span class="op" id="7560948">)</span><span class="op" id="7560949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7560953">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561024">palette</span>&nbsp;<span class="op" id="7561032">:=</span>&nbsp;<span class="builtinfunc" id="7561035">make</span><span class="op" id="7561039">(</span><span class="ident" id="7561040">color</span><span class="op" id="7561045">.</span><span class="ident" id="7561046">Palette</span><span class="op" id="7561053">,</span>&nbsp;<span class="num" id="7561055">256</span><span class="op" id="7561058">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561061">for</span>&nbsp;<span class="ident" id="7561065">i</span>&nbsp;<span class="op" id="7561067">:=</span>&nbsp;<span class="keyword" id="7561070">range</span>&nbsp;<span class="ident" id="7561076">palette</span>&nbsp;<span class="op" id="7561084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561088">palette</span><span class="op" id="7561095">[</span><span class="ident" id="7561096">i</span><span class="op" id="7561097">]</span>&nbsp;<span class="op" id="7561099">=</span>&nbsp;<span class="ident" id="7561101">color</span><span class="op" id="7561106">.</span><span class="ident" id="7561107">RGBA</span><span class="op" id="7561111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7561116">uint8</span><span class="op" id="7561121">(</span><span class="ident" id="7561122">rnd</span><span class="op" id="7561125">.</span><span class="ident" id="7561126">Intn</span><span class="op" id="7561130">(</span><span class="num" id="7561131">256</span><span class="op" id="7561134">)</span><span class="op" id="7561135">)</span><span class="op" id="7561136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7561141">uint8</span><span class="op" id="7561146">(</span><span class="ident" id="7561147">rnd</span><span class="op" id="7561150">.</span><span class="ident" id="7561151">Intn</span><span class="op" id="7561155">(</span><span class="num" id="7561156">256</span><span class="op" id="7561159">)</span><span class="op" id="7561160">)</span><span class="op" id="7561161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7561166">uint8</span><span class="op" id="7561171">(</span><span class="ident" id="7561172">rnd</span><span class="op" id="7561175">.</span><span class="ident" id="7561176">Intn</span><span class="op" id="7561180">(</span><span class="num" id="7561181">256</span><span class="op" id="7561184">)</span><span class="op" id="7561185">)</span><span class="op" id="7561186">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7561191">255</span><span class="op" id="7561194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561204">img</span>&nbsp;<span class="op" id="7561208">:=</span>&nbsp;<span class="ident" id="7561211">image</span><span class="op" id="7561216">.</span><span class="ident" id="7561217">NewPaletted</span><span class="op" id="7561228">(</span><span class="ident" id="7561229">image</span><span class="op" id="7561234">.</span><span class="ident" id="7561235">Rect</span><span class="op" id="7561239">(</span><span class="num" id="7561240">0</span><span class="op" id="7561241">,</span>&nbsp;<span class="num" id="7561243">0</span><span class="op" id="7561244">,</span>&nbsp;<span class="num" id="7561246">640</span><span class="op" id="7561249">,</span>&nbsp;<span class="num" id="7561251">480</span><span class="op" id="7561254">)</span><span class="op" id="7561255">,</span>&nbsp;<span class="ident" id="7561257">palette</span><span class="op" id="7561264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561267">for</span>&nbsp;<span class="ident" id="7561271">y</span>&nbsp;<span class="op" id="7561273">:=</span>&nbsp;<span class="ident" id="7561276">bo</span><span class="op" id="7561278">.</span><span class="ident" id="7561279">Min</span><span class="op" id="7561282">.</span><span class="ident" id="7561283">Y</span><span class="op" id="7561284">;</span>&nbsp;<span class="ident" id="7561286">y</span>&nbsp;<span class="op" id="7561288">&lt;</span>&nbsp;<span class="ident" id="7561290">bo</span><span class="op" id="7561292">.</span><span class="ident" id="7561293">Max</span><span class="op" id="7561296">.</span><span class="ident" id="7561297">Y</span><span class="op" id="7561298">;</span>&nbsp;<span class="ident" id="7561300">y</span><span class="op" id="7561301">++</span>&nbsp;<span class="op" id="7561304">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561308">for</span>&nbsp;<span class="ident" id="7561312">x</span>&nbsp;<span class="op" id="7561314">:=</span>&nbsp;<span class="ident" id="7561317">bo</span><span class="op" id="7561319">.</span><span class="ident" id="7561320">Min</span><span class="op" id="7561323">.</span><span class="ident" id="7561324">X</span><span class="op" id="7561325">;</span>&nbsp;<span class="ident" id="7561327">x</span>&nbsp;<span class="op" id="7561329">&lt;</span>&nbsp;<span class="ident" id="7561331">bo</span><span class="op" id="7561333">.</span><span class="ident" id="7561334">Max</span><span class="op" id="7561337">.</span><span class="ident" id="7561338">X</span><span class="op" id="7561339">;</span>&nbsp;<span class="ident" id="7561341">x</span><span class="op" id="7561342">++</span>&nbsp;<span class="op" id="7561345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561350">img</span><span class="op" id="7561353">.</span><span class="ident" id="7561354">Set</span><span class="op" id="7561357">(</span><span class="ident" id="7561358">x</span><span class="op" id="7561359">,</span>&nbsp;<span class="ident" id="7561361">y</span><span class="op" id="7561362">,</span>&nbsp;<span class="ident" id="7561364">palette</span><span class="op" id="7561371">[</span><span class="ident" id="7561372">rnd</span><span class="op" id="7561375">.</span><span class="ident" id="7561376">Intn</span><span class="op" id="7561380">(</span><span class="num" id="7561381">256</span><span class="op" id="7561384">)</span><span class="op" id="7561385">]</span><span class="op" id="7561386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561397">b</span><span class="op" id="7561398">.</span><span class="ident" id="7561399">SetBytes</span><span class="op" id="7561407">(</span><span class="num" id="7561408">640</span>&nbsp;<span class="op" id="7561412">*</span>&nbsp;<span class="num" id="7561414">480</span>&nbsp;<span class="op" id="7561418">*</span>&nbsp;<span class="num" id="7561420">4</span><span class="op" id="7561421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561424">b</span><span class="op" id="7561425">.</span><span class="ident" id="7561426">StartTimer</span><span class="op" id="7561436">(</span><span class="op" id="7561437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561440">for</span>&nbsp;<span class="ident" id="7561444">i</span>&nbsp;<span class="op" id="7561446">:=</span>&nbsp;<span class="num" id="7561449">0</span><span class="op" id="7561450">;</span>&nbsp;<span class="ident" id="7561452">i</span>&nbsp;<span class="op" id="7561454">&lt;</span>&nbsp;<span class="ident" id="7561456">b</span><span class="op" id="7561457">.</span><span class="ident" id="7561458">N</span><span class="op" id="7561459">;</span>&nbsp;<span class="ident" id="7561461">i</span><span class="op" id="7561462">++</span>&nbsp;<span class="op" id="7561465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561469">Encode</span><span class="op" id="7561475">(</span><span class="ident" id="7561476">ioutil</span><span class="op" id="7561482">.</span><span class="ident" id="7561483">Discard</span><span class="op" id="7561490">,</span>&nbsp;<span class="ident" id="7561492">img</span><span class="op" id="7561495">,</span>&nbsp;<span class="ident" id="7561497">nil</span><span class="op" id="7561500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561503">}</span><br>
<span class="lineno">205</span><span class="op" id="7561505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7561508">func</span>&nbsp;<span class="ident" id="7561513">BenchmarkQuantizedEncode</span><span class="op" id="7561537">(</span><span class="ident" id="7561538">b</span>&nbsp;<span class="op" id="7561540">*</span><span class="ident" id="7561541">testing</span><span class="op" id="7561548">.</span><span class="ident" id="7561549">B</span><span class="op" id="7561550">)</span>&nbsp;<span class="op" id="7561552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561555">b</span><span class="op" id="7561556">.</span><span class="ident" id="7561557">StopTimer</span><span class="op" id="7561566">(</span><span class="op" id="7561567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561570">img</span>&nbsp;<span class="op" id="7561574">:=</span>&nbsp;<span class="ident" id="7561577">image</span><span class="op" id="7561582">.</span><span class="ident" id="7561583">NewRGBA</span><span class="op" id="7561590">(</span><span class="ident" id="7561591">image</span><span class="op" id="7561596">.</span><span class="ident" id="7561597">Rect</span><span class="op" id="7561601">(</span><span class="num" id="7561602">0</span><span class="op" id="7561603">,</span>&nbsp;<span class="num" id="7561605">0</span><span class="op" id="7561606">,</span>&nbsp;<span class="num" id="7561608">640</span><span class="op" id="7561611">,</span>&nbsp;<span class="num" id="7561613">480</span><span class="op" id="7561616">)</span><span class="op" id="7561617">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561620">bo</span>&nbsp;<span class="op" id="7561623">:=</span>&nbsp;<span class="ident" id="7561626">img</span><span class="op" id="7561629">.</span><span class="ident" id="7561630">Bounds</span><span class="op" id="7561636">(</span><span class="op" id="7561637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561640">rnd</span>&nbsp;<span class="op" id="7561644">:=</span>&nbsp;<span class="ident" id="7561647">rand</span><span class="op" id="7561651">.</span><span class="ident" id="7561652">New</span><span class="op" id="7561655">(</span><span class="ident" id="7561656">rand</span><span class="op" id="7561660">.</span><span class="ident" id="7561661">NewSource</span><span class="op" id="7561670">(</span><span class="num" id="7561671">123</span><span class="op" id="7561674">)</span><span class="op" id="7561675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561678">for</span>&nbsp;<span class="ident" id="7561682">y</span>&nbsp;<span class="op" id="7561684">:=</span>&nbsp;<span class="ident" id="7561687">bo</span><span class="op" id="7561689">.</span><span class="ident" id="7561690">Min</span><span class="op" id="7561693">.</span><span class="ident" id="7561694">Y</span><span class="op" id="7561695">;</span>&nbsp;<span class="ident" id="7561697">y</span>&nbsp;<span class="op" id="7561699">&lt;</span>&nbsp;<span class="ident" id="7561701">bo</span><span class="op" id="7561703">.</span><span class="ident" id="7561704">Max</span><span class="op" id="7561707">.</span><span class="ident" id="7561708">Y</span><span class="op" id="7561709">;</span>&nbsp;<span class="ident" id="7561711">y</span><span class="op" id="7561712">++</span>&nbsp;<span class="op" id="7561715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561719">for</span>&nbsp;<span class="ident" id="7561723">x</span>&nbsp;<span class="op" id="7561725">:=</span>&nbsp;<span class="ident" id="7561728">bo</span><span class="op" id="7561730">.</span><span class="ident" id="7561731">Min</span><span class="op" id="7561734">.</span><span class="ident" id="7561735">X</span><span class="op" id="7561736">;</span>&nbsp;<span class="ident" id="7561738">x</span>&nbsp;<span class="op" id="7561740">&lt;</span>&nbsp;<span class="ident" id="7561742">bo</span><span class="op" id="7561744">.</span><span class="ident" id="7561745">Max</span><span class="op" id="7561748">.</span><span class="ident" id="7561749">X</span><span class="op" id="7561750">;</span>&nbsp;<span class="ident" id="7561752">x</span><span class="op" id="7561753">++</span>&nbsp;<span class="op" id="7561756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561761">img</span><span class="op" id="7561764">.</span><span class="ident" id="7561765">SetRGBA</span><span class="op" id="7561772">(</span><span class="ident" id="7561773">x</span><span class="op" id="7561774">,</span>&nbsp;<span class="ident" id="7561776">y</span><span class="op" id="7561777">,</span>&nbsp;<span class="ident" id="7561779">color</span><span class="op" id="7561784">.</span><span class="ident" id="7561785">RGBA</span><span class="op" id="7561789">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7561795">uint8</span><span class="op" id="7561800">(</span><span class="ident" id="7561801">rnd</span><span class="op" id="7561804">.</span><span class="ident" id="7561805">Intn</span><span class="op" id="7561809">(</span><span class="num" id="7561810">256</span><span class="op" id="7561813">)</span><span class="op" id="7561814">)</span><span class="op" id="7561815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7561821">uint8</span><span class="op" id="7561826">(</span><span class="ident" id="7561827">rnd</span><span class="op" id="7561830">.</span><span class="ident" id="7561831">Intn</span><span class="op" id="7561835">(</span><span class="num" id="7561836">256</span><span class="op" id="7561839">)</span><span class="op" id="7561840">)</span><span class="op" id="7561841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7561847">uint8</span><span class="op" id="7561852">(</span><span class="ident" id="7561853">rnd</span><span class="op" id="7561856">.</span><span class="ident" id="7561857">Intn</span><span class="op" id="7561861">(</span><span class="num" id="7561862">256</span><span class="op" id="7561865">)</span><span class="op" id="7561866">)</span><span class="op" id="7561867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7561873">255</span><span class="op" id="7561876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561881">}</span><span class="op" id="7561882">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561892">b</span><span class="op" id="7561893">.</span><span class="ident" id="7561894">SetBytes</span><span class="op" id="7561902">(</span><span class="num" id="7561903">640</span>&nbsp;<span class="op" id="7561907">*</span>&nbsp;<span class="num" id="7561909">480</span>&nbsp;<span class="op" id="7561913">*</span>&nbsp;<span class="num" id="7561915">4</span><span class="op" id="7561916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561919">b</span><span class="op" id="7561920">.</span><span class="ident" id="7561921">StartTimer</span><span class="op" id="7561931">(</span><span class="op" id="7561932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561935">for</span>&nbsp;<span class="ident" id="7561939">i</span>&nbsp;<span class="op" id="7561941">:=</span>&nbsp;<span class="num" id="7561944">0</span><span class="op" id="7561945">;</span>&nbsp;<span class="ident" id="7561947">i</span>&nbsp;<span class="op" id="7561949">&lt;</span>&nbsp;<span class="ident" id="7561951">b</span><span class="op" id="7561952">.</span><span class="ident" id="7561953">N</span><span class="op" id="7561954">;</span>&nbsp;<span class="ident" id="7561956">i</span><span class="op" id="7561957">++</span>&nbsp;<span class="op" id="7561960">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561964">Encode</span><span class="op" id="7561970">(</span><span class="ident" id="7561971">ioutil</span><span class="op" id="7561977">.</span><span class="ident" id="7561978">Discard</span><span class="op" id="7561985">,</span>&nbsp;<span class="ident" id="7561987">img</span><span class="op" id="7561990">,</span>&nbsp;<span class="ident" id="7561992">nil</span><span class="op" id="7561995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561998">}</span><br>
<span class="lineno"></span><span class="op" id="7562000">}</span>
</div>
</body>
</html>
