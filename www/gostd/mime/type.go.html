<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html" class="current">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1338700">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1338755">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1338809">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1338860">//&nbsp;Package&nbsp;mime&nbsp;implements&nbsp;parts&nbsp;of&nbsp;the&nbsp;MIME&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="1338911">package</span>&nbsp;<span class="ident" id="1338919">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1338925">import</span>&nbsp;<span class="op" id="1338932">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1338935">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1338942">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1338953">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="1338960">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1338963">var</span>&nbsp;<span class="op" id="1338967">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338970">mimeLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338985">sync</span><span class="op" id="1338989">.</span><span class="ident" id="1338990">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338999">mimeTypesLower</span>&nbsp;<span class="op" id="1339014">=</span>&nbsp;<span class="keyword" id="1339016">map</span><span class="op" id="1339019">[</span><span class="builtintype" id="1339020">string</span><span class="op" id="1339026">]</span><span class="builtintype" id="1339027">string</span><span class="op" id="1339033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1339037">&#34;.css&#34;</span><span class="op" id="1339043">:</span>&nbsp;&nbsp;<span class="string" id="1339046">&#34;text/css;&nbsp;charset=utf-8&#34;</span><span class="op" id="1339071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1339075">&#34;.gif&#34;</span><span class="op" id="1339081">:</span>&nbsp;&nbsp;<span class="string" id="1339084">&#34;image/gif&#34;</span><span class="op" id="1339095">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1339099">&#34;.htm&#34;</span><span class="op" id="1339105">:</span>&nbsp;&nbsp;<span class="string" id="1339108">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="1339134">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1339138">&#34;.html&#34;</span><span class="op" id="1339145">:</span>&nbsp;<span class="string" id="1339147">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="1339173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1339177">&#34;.jpg&#34;</span><span class="op" id="1339183">:</span>&nbsp;&nbsp;<span class="string" id="1339186">&#34;image/jpeg&#34;</span><span class="op" id="1339198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1339202">&#34;.js&#34;</span><span class="op" id="1339207">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1339211">&#34;application/x-javascript&#34;</span><span class="op" id="1339237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1339241">&#34;.pdf&#34;</span><span class="op" id="1339247">:</span>&nbsp;&nbsp;<span class="string" id="1339250">&#34;application/pdf&#34;</span><span class="op" id="1339267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1339271">&#34;.png&#34;</span><span class="op" id="1339277">:</span>&nbsp;&nbsp;<span class="string" id="1339280">&#34;image/png&#34;</span><span class="op" id="1339291">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1339295">&#34;.xml&#34;</span><span class="op" id="1339301">:</span>&nbsp;&nbsp;<span class="string" id="1339304">&#34;text/xml;&nbsp;charset=utf-8&#34;</span><span class="op" id="1339329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339335">mimeTypes</span>&nbsp;<span class="op" id="1339345">=</span>&nbsp;<span class="ident" id="1339347">clone</span><span class="op" id="1339352">(</span><span class="ident" id="1339353">mimeTypesLower</span><span class="op" id="1339367">)</span><br>
<span class="lineno"></span><span class="op" id="1339369">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="1339372">func</span>&nbsp;<span class="ident" id="1339377">clone</span><span class="op" id="1339382">(</span><span class="ident" id="1339383">m</span>&nbsp;<span class="keyword" id="1339385">map</span><span class="op" id="1339388">[</span><span class="builtintype" id="1339389">string</span><span class="op" id="1339395">]</span><span class="builtintype" id="1339396">string</span><span class="op" id="1339402">)</span>&nbsp;<span class="keyword" id="1339404">map</span><span class="op" id="1339407">[</span><span class="builtintype" id="1339408">string</span><span class="op" id="1339414">]</span><span class="builtintype" id="1339415">string</span>&nbsp;<span class="op" id="1339422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339425">m2</span>&nbsp;<span class="op" id="1339428">:=</span>&nbsp;<span class="builtinfunc" id="1339431">make</span><span class="op" id="1339435">(</span><span class="keyword" id="1339436">map</span><span class="op" id="1339439">[</span><span class="builtintype" id="1339440">string</span><span class="op" id="1339446">]</span><span class="builtintype" id="1339447">string</span><span class="op" id="1339453">,</span>&nbsp;<span class="builtinfunc" id="1339455">len</span><span class="op" id="1339458">(</span><span class="ident" id="1339459">m</span><span class="op" id="1339460">)</span><span class="op" id="1339461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339464">for</span>&nbsp;<span class="ident" id="1339468">k</span><span class="op" id="1339469">,</span>&nbsp;<span class="ident" id="1339471">v</span>&nbsp;<span class="op" id="1339473">:=</span>&nbsp;<span class="keyword" id="1339476">range</span>&nbsp;<span class="ident" id="1339482">m</span>&nbsp;<span class="op" id="1339484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339488">m2</span><span class="op" id="1339490">[</span><span class="ident" id="1339491">k</span><span class="op" id="1339492">]</span>&nbsp;<span class="op" id="1339494">=</span>&nbsp;<span class="ident" id="1339496">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339500">if</span>&nbsp;<span class="ident" id="1339503">strings</span><span class="op" id="1339510">.</span><span class="ident" id="1339511">ToLower</span><span class="op" id="1339518">(</span><span class="ident" id="1339519">k</span><span class="op" id="1339520">)</span>&nbsp;<span class="op" id="1339522">!=</span>&nbsp;<span class="ident" id="1339525">k</span>&nbsp;<span class="op" id="1339527">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1339532">panic</span><span class="op" id="1339537">(</span><span class="string" id="1339538">&#34;keys&nbsp;in&nbsp;mimeTypesLower&nbsp;must&nbsp;be&nbsp;lowercase&#34;</span><span class="op" id="1339580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339590">return</span>&nbsp;<span class="ident" id="1339597">m2</span><br>
<span class="lineno"></span><span class="op" id="1339600">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1339603">var</span>&nbsp;<span class="ident" id="1339607">once</span>&nbsp;<span class="ident" id="1339612">sync</span><span class="op" id="1339616">.</span><span class="ident" id="1339617">Once</span>&nbsp;<span class="comment" id="1339622">//&nbsp;guards&nbsp;initMime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1339642">//&nbsp;TypeByExtension&nbsp;returns&nbsp;the&nbsp;MIME&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;file&nbsp;extension&nbsp;ext.</span><br>
<span class="lineno"></span><span class="comment" id="1339723">//&nbsp;The&nbsp;extension&nbsp;ext&nbsp;should&nbsp;begin&nbsp;with&nbsp;a&nbsp;leading&nbsp;dot,&nbsp;as&nbsp;in&nbsp;&#34;.html&#34;.</span><br>
<span class="lineno">45</span><span class="comment" id="1339792">//&nbsp;When&nbsp;ext&nbsp;has&nbsp;no&nbsp;associated&nbsp;type,&nbsp;TypeByExtension&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1339856">//</span><br>
<span class="lineno"></span><span class="comment" id="1339859">//&nbsp;Extensions&nbsp;are&nbsp;looked&nbsp;up&nbsp;first&nbsp;case-sensitively,&nbsp;then&nbsp;case-insensitively.</span><br>
<span class="lineno"></span><span class="comment" id="1339936">//</span><br>
<span class="lineno"></span><span class="comment" id="1339939">//&nbsp;The&nbsp;built-in&nbsp;table&nbsp;is&nbsp;small&nbsp;but&nbsp;on&nbsp;unix&nbsp;it&nbsp;is&nbsp;augmented&nbsp;by&nbsp;the&nbsp;local</span><br>
<span class="lineno">50</span><span class="comment" id="1340011">//&nbsp;system&#39;s&nbsp;mime.types&nbsp;file(s)&nbsp;if&nbsp;available&nbsp;under&nbsp;one&nbsp;or&nbsp;more&nbsp;of&nbsp;these</span><br>
<span class="lineno"></span><span class="comment" id="1340082">//&nbsp;names:</span><br>
<span class="lineno"></span><span class="comment" id="1340092">//</span><br>
<span class="lineno"></span><span class="comment" id="1340095">//&nbsp;&nbsp;&nbsp;/etc/mime.types</span><br>
<span class="lineno"></span><span class="comment" id="1340116">//&nbsp;&nbsp;&nbsp;/etc/apache2/mime.types</span><br>
<span class="lineno">55</span><span class="comment" id="1340145">//&nbsp;&nbsp;&nbsp;/etc/apache/mime.types</span><br>
<span class="lineno"></span><span class="comment" id="1340173">//</span><br>
<span class="lineno"></span><span class="comment" id="1340176">//&nbsp;On&nbsp;Windows,&nbsp;MIME&nbsp;types&nbsp;are&nbsp;extracted&nbsp;from&nbsp;the&nbsp;registry.</span><br>
<span class="lineno"></span><span class="comment" id="1340235">//</span><br>
<span class="lineno"></span><span class="comment" id="1340238">//&nbsp;Text&nbsp;types&nbsp;have&nbsp;the&nbsp;charset&nbsp;parameter&nbsp;set&nbsp;to&nbsp;&#34;utf-8&#34;&nbsp;by&nbsp;default.</span><br>
<span class="lineno">60</span><span class="keyword" id="1340306">func</span>&nbsp;<span class="ident" id="1340311">TypeByExtension</span><span class="op" id="1340326">(</span><span class="ident" id="1340327">ext</span>&nbsp;<span class="builtintype" id="1340331">string</span><span class="op" id="1340337">)</span>&nbsp;<span class="builtintype" id="1340339">string</span>&nbsp;<span class="op" id="1340346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340349">once</span><span class="op" id="1340353">.</span><span class="ident" id="1340354">Do</span><span class="op" id="1340356">(</span><span class="ident" id="1340357">initMime</span><span class="op" id="1340365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340368">mimeLock</span><span class="op" id="1340376">.</span><span class="ident" id="1340377">RLock</span><span class="op" id="1340382">(</span><span class="op" id="1340383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340386">defer</span>&nbsp;<span class="ident" id="1340392">mimeLock</span><span class="op" id="1340400">.</span><span class="ident" id="1340401">RUnlock</span><span class="op" id="1340408">(</span><span class="op" id="1340409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340413">//&nbsp;Case-sensitive&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340440">v</span>&nbsp;<span class="op" id="1340442">:=</span>&nbsp;<span class="ident" id="1340445">mimeTypes</span><span class="op" id="1340454">[</span><span class="ident" id="1340455">ext</span><span class="op" id="1340458">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340461">if</span>&nbsp;<span class="ident" id="1340464">v</span>&nbsp;<span class="op" id="1340466">!=</span>&nbsp;<span class="string" id="1340469">&#34;&#34;</span>&nbsp;<span class="op" id="1340472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340476">return</span>&nbsp;<span class="ident" id="1340483">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340486">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340490">//&nbsp;Case-insensitive&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340519">//&nbsp;Optimistically&nbsp;assume&nbsp;a&nbsp;short&nbsp;ASCII&nbsp;extension&nbsp;and&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340576">//&nbsp;allocation-free&nbsp;in&nbsp;that&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340610">var</span>&nbsp;<span class="ident" id="1340614">buf</span>&nbsp;<span class="op" id="1340618">[</span><span class="num" id="1340619">10</span><span class="op" id="1340621">]</span><span class="builtintype" id="1340622">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340628">lower</span>&nbsp;<span class="op" id="1340634">:=</span>&nbsp;<span class="ident" id="1340637">buf</span><span class="op" id="1340640">[</span><span class="op" id="1340641">:</span><span class="num" id="1340642">0</span><span class="op" id="1340643">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340646">const</span>&nbsp;<span class="ident" id="1340652">utf8RuneSelf</span>&nbsp;<span class="op" id="1340665">=</span>&nbsp;<span class="num" id="1340667">0x80</span>&nbsp;<span class="comment" id="1340672">//&nbsp;from&nbsp;utf8&nbsp;package,&nbsp;but&nbsp;not&nbsp;importing&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340717">for</span>&nbsp;<span class="ident" id="1340721">i</span>&nbsp;<span class="op" id="1340723">:=</span>&nbsp;<span class="num" id="1340726">0</span><span class="op" id="1340727">;</span>&nbsp;<span class="ident" id="1340729">i</span>&nbsp;<span class="op" id="1340731">&lt;</span>&nbsp;<span class="builtinfunc" id="1340733">len</span><span class="op" id="1340736">(</span><span class="ident" id="1340737">ext</span><span class="op" id="1340740">)</span><span class="op" id="1340741">;</span>&nbsp;<span class="ident" id="1340743">i</span><span class="op" id="1340744">++</span>&nbsp;<span class="op" id="1340747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340751">c</span>&nbsp;<span class="op" id="1340753">:=</span>&nbsp;<span class="ident" id="1340756">ext</span><span class="op" id="1340759">[</span><span class="ident" id="1340760">i</span><span class="op" id="1340761">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340765">if</span>&nbsp;<span class="ident" id="1340768">c</span>&nbsp;<span class="op" id="1340770">&gt;=</span>&nbsp;<span class="ident" id="1340773">utf8RuneSelf</span>&nbsp;<span class="op" id="1340786">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340791">//&nbsp;Slow&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340808">return</span>&nbsp;<span class="ident" id="1340815">mimeTypesLower</span><span class="op" id="1340829">[</span><span class="ident" id="1340830">strings</span><span class="op" id="1340837">.</span><span class="ident" id="1340838">ToLower</span><span class="op" id="1340845">(</span><span class="ident" id="1340846">ext</span><span class="op" id="1340849">)</span><span class="op" id="1340850">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340858">if</span>&nbsp;<span class="string" id="1340861">&#39;A&#39;</span>&nbsp;<span class="op" id="1340865">&lt;=</span>&nbsp;<span class="ident" id="1340868">c</span>&nbsp;<span class="op" id="1340870">&amp;&amp;</span>&nbsp;<span class="ident" id="1340873">c</span>&nbsp;<span class="op" id="1340875">&lt;=</span>&nbsp;<span class="string" id="1340878">&#39;Z&#39;</span>&nbsp;<span class="op" id="1340882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340887">lower</span>&nbsp;<span class="op" id="1340893">=</span>&nbsp;<span class="builtinfunc" id="1340895">append</span><span class="op" id="1340901">(</span><span class="ident" id="1340902">lower</span><span class="op" id="1340907">,</span>&nbsp;<span class="ident" id="1340909">c</span><span class="op" id="1340910">+</span><span class="op" id="1340911">(</span><span class="string" id="1340912">&#39;a&#39;</span><span class="op" id="1340915">-</span><span class="string" id="1340916">&#39;A&#39;</span><span class="op" id="1340919">)</span><span class="op" id="1340920">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340924">}</span>&nbsp;<span class="keyword" id="1340926">else</span>&nbsp;<span class="op" id="1340931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340936">lower</span>&nbsp;<span class="op" id="1340942">=</span>&nbsp;<span class="builtinfunc" id="1340944">append</span><span class="op" id="1340950">(</span><span class="ident" id="1340951">lower</span><span class="op" id="1340956">,</span>&nbsp;<span class="ident" id="1340958">c</span><span class="op" id="1340959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340969">//&nbsp;The&nbsp;conversion&nbsp;from&nbsp;[]byte&nbsp;to&nbsp;string&nbsp;doesn&#39;t&nbsp;allocate&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1341030">//&nbsp;a&nbsp;map&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341048">return</span>&nbsp;<span class="ident" id="1341055">mimeTypesLower</span><span class="op" id="1341069">[</span><span class="builtintype" id="1341070">string</span><span class="op" id="1341076">(</span><span class="ident" id="1341077">lower</span><span class="op" id="1341082">)</span><span class="op" id="1341083">]</span><br>
<span class="lineno"></span><span class="op" id="1341085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1341088">//&nbsp;AddExtensionType&nbsp;sets&nbsp;the&nbsp;MIME&nbsp;type&nbsp;associated&nbsp;with</span><br>
<span class="lineno">95</span><span class="comment" id="1341143">//&nbsp;the&nbsp;extension&nbsp;ext&nbsp;to&nbsp;typ.&nbsp;The&nbsp;extension&nbsp;should&nbsp;begin&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="1341204">//&nbsp;a&nbsp;leading&nbsp;dot,&nbsp;as&nbsp;in&nbsp;&#34;.html&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="1341237">func</span>&nbsp;<span class="ident" id="1341242">AddExtensionType</span><span class="op" id="1341258">(</span><span class="ident" id="1341259">ext</span><span class="op" id="1341262">,</span>&nbsp;<span class="ident" id="1341264">typ</span>&nbsp;<span class="builtintype" id="1341268">string</span><span class="op" id="1341274">)</span>&nbsp;<span class="builtintype" id="1341276">error</span>&nbsp;<span class="op" id="1341282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341285">if</span>&nbsp;<span class="op" id="1341288">!</span><span class="ident" id="1341289">strings</span><span class="op" id="1341296">.</span><span class="ident" id="1341297">HasPrefix</span><span class="op" id="1341306">(</span><span class="ident" id="1341307">ext</span><span class="op" id="1341310">,</span>&nbsp;<span class="string" id="1341312">&#34;.&#34;</span><span class="op" id="1341315">)</span>&nbsp;<span class="op" id="1341317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341321">return</span>&nbsp;<span class="ident" id="1341328">fmt</span><span class="op" id="1341331">.</span><span class="ident" id="1341332">Errorf</span><span class="op" id="1341338">(</span><span class="string" id="1341339">`mime:&nbsp;extension&nbsp;%q&nbsp;misses&nbsp;dot`</span><span class="op" id="1341370">,</span>&nbsp;<span class="ident" id="1341372">ext</span><span class="op" id="1341375">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341381">once</span><span class="op" id="1341385">.</span><span class="ident" id="1341386">Do</span><span class="op" id="1341388">(</span><span class="ident" id="1341389">initMime</span><span class="op" id="1341397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341400">return</span>&nbsp;<span class="ident" id="1341407">setExtensionType</span><span class="op" id="1341423">(</span><span class="ident" id="1341424">ext</span><span class="op" id="1341427">,</span>&nbsp;<span class="ident" id="1341429">typ</span><span class="op" id="1341432">)</span><br>
<span class="lineno"></span><span class="op" id="1341434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="1341437">func</span>&nbsp;<span class="ident" id="1341442">setExtensionType</span><span class="op" id="1341458">(</span><span class="ident" id="1341459">extension</span><span class="op" id="1341468">,</span>&nbsp;<span class="ident" id="1341470">mimeType</span>&nbsp;<span class="builtintype" id="1341479">string</span><span class="op" id="1341485">)</span>&nbsp;<span class="builtintype" id="1341487">error</span>&nbsp;<span class="op" id="1341493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341496">_</span><span class="op" id="1341497">,</span>&nbsp;<span class="ident" id="1341499">param</span><span class="op" id="1341504">,</span>&nbsp;<span class="ident" id="1341506">err</span>&nbsp;<span class="op" id="1341510">:=</span>&nbsp;<span class="ident" id="1341513">ParseMediaType</span><span class="op" id="1341527">(</span><span class="ident" id="1341528">mimeType</span><span class="op" id="1341536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341539">if</span>&nbsp;<span class="ident" id="1341542">err</span>&nbsp;<span class="op" id="1341546">!=</span>&nbsp;<span class="builtintype" id="1341549">nil</span>&nbsp;<span class="op" id="1341553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341557">return</span>&nbsp;<span class="ident" id="1341564">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341569">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341572">if</span>&nbsp;<span class="ident" id="1341575">strings</span><span class="op" id="1341582">.</span><span class="ident" id="1341583">HasPrefix</span><span class="op" id="1341592">(</span><span class="ident" id="1341593">mimeType</span><span class="op" id="1341601">,</span>&nbsp;<span class="string" id="1341603">&#34;text/&#34;</span><span class="op" id="1341610">)</span>&nbsp;<span class="op" id="1341612">&amp;&amp;</span>&nbsp;<span class="ident" id="1341615">param</span><span class="op" id="1341620">[</span><span class="string" id="1341621">&#34;charset&#34;</span><span class="op" id="1341630">]</span>&nbsp;<span class="op" id="1341632">==</span>&nbsp;<span class="string" id="1341635">&#34;&#34;</span>&nbsp;<span class="op" id="1341638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341642">param</span><span class="op" id="1341647">[</span><span class="string" id="1341648">&#34;charset&#34;</span><span class="op" id="1341657">]</span>&nbsp;<span class="op" id="1341659">=</span>&nbsp;<span class="string" id="1341661">&#34;utf-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341671">mimeType</span>&nbsp;<span class="op" id="1341680">=</span>&nbsp;<span class="ident" id="1341682">FormatMediaType</span><span class="op" id="1341697">(</span><span class="ident" id="1341698">mimeType</span><span class="op" id="1341706">,</span>&nbsp;<span class="ident" id="1341708">param</span><span class="op" id="1341713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341719">extLower</span>&nbsp;<span class="op" id="1341728">:=</span>&nbsp;<span class="ident" id="1341731">strings</span><span class="op" id="1341738">.</span><span class="ident" id="1341739">ToLower</span><span class="op" id="1341746">(</span><span class="ident" id="1341747">extension</span><span class="op" id="1341756">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341760">mimeLock</span><span class="op" id="1341768">.</span><span class="ident" id="1341769">Lock</span><span class="op" id="1341773">(</span><span class="op" id="1341774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341777">mimeTypes</span><span class="op" id="1341786">[</span><span class="ident" id="1341787">extension</span><span class="op" id="1341796">]</span>&nbsp;<span class="op" id="1341798">=</span>&nbsp;<span class="ident" id="1341800">mimeType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341810">mimeTypesLower</span><span class="op" id="1341824">[</span><span class="ident" id="1341825">extLower</span><span class="op" id="1341833">]</span>&nbsp;<span class="op" id="1341835">=</span>&nbsp;<span class="ident" id="1341837">mimeType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341847">mimeLock</span><span class="op" id="1341855">.</span><span class="ident" id="1341856">Unlock</span><span class="op" id="1341862">(</span><span class="op" id="1341863">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341866">return</span>&nbsp;<span class="builtintype" id="1341873">nil</span><br>
<span class="lineno"></span><span class="op" id="1341877">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
