<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cookiejar</h2>
<ul>
<li><a href="/gostd/net/http/cookiejar/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/cookiejar/jar_test.go.html">jar_test.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode.go.html">punycode.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode_test.go.html">punycode_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5658482">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5658537">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5658591">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5658642">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="5658722">package</span>&nbsp;<span class="ident" id="5658730">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5658741">import</span>&nbsp;<span class="op" id="5658748">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5658751">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5658761">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5658768">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5658775">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5658787">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5658798">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5658806">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5658817">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5658825">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5658832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5658835">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="5658908">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5658963">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5659033">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5659104">//</span><br>
<span class="lineno">25</span><span class="comment" id="5659107">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5659181">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="5659205">//</span><br>
<span class="lineno"></span><span class="comment" id="5659208">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5659283">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="5659362">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="5659391">//</span><br>
<span class="lineno"></span><span class="comment" id="5659394">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5659451">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5659485">type</span>&nbsp;<span class="ident" id="5659490">PublicSuffixList</span>&nbsp;<span class="keyword" id="5659507">interface</span>&nbsp;<span class="op" id="5659517">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5659520">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5659574">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5659578">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5659649">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5659721">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659743">PublicSuffix</span><span class="op" id="5659755">(</span><span class="ident" id="5659756">domain</span>&nbsp;<span class="builtintype" id="5659763">string</span><span class="op" id="5659769">)</span>&nbsp;<span class="builtintype" id="5659771">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5659780">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5659849">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5659920">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659949">String</span><span class="op" id="5659955">(</span><span class="op" id="5659956">)</span>&nbsp;<span class="builtintype" id="5659958">string</span><br>
<span class="lineno"></span><span class="op" id="5659965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5659968">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5660019">type</span>&nbsp;<span class="ident" id="5660024">Options</span>&nbsp;<span class="keyword" id="5660032">struct</span>&nbsp;<span class="op" id="5660039">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5660042">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5660113">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5660163">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5660167">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5660236">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5660309">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660328">PublicSuffixList</span>&nbsp;<span class="ident" id="5660345">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="5660362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5660365">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="5660439">type</span>&nbsp;<span class="ident" id="5660444">Jar</span>&nbsp;<span class="keyword" id="5660448">struct</span>&nbsp;<span class="op" id="5660455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660458">psList</span>&nbsp;<span class="ident" id="5660465">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5660484">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660519">mu</span>&nbsp;<span class="ident" id="5660522">sync</span><span class="op" id="5660526">.</span><span class="ident" id="5660527">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5660535">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5660606">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660634">entries</span>&nbsp;<span class="keyword" id="5660642">map</span><span class="op" id="5660645">[</span><span class="builtintype" id="5660646">string</span><span class="op" id="5660652">]</span><span class="keyword" id="5660653">map</span><span class="op" id="5660656">[</span><span class="builtintype" id="5660657">string</span><span class="op" id="5660663">]</span><span class="ident" id="5660664">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5660672">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5660740">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660764">nextSeqNum</span>&nbsp;<span class="ident" id="5660775">uint64</span><br>
<span class="lineno"></span><span class="op" id="5660782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="5660785">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="5660857">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="5660869">func</span>&nbsp;<span class="ident" id="5660874">New</span><span class="op" id="5660877">(</span><span class="ident" id="5660878">o</span>&nbsp;<span class="op" id="5660880">*</span><span class="ident" id="5660881">Options</span><span class="op" id="5660888">)</span>&nbsp;<span class="op" id="5660890">(</span><span class="op" id="5660891">*</span><span class="ident" id="5660892">Jar</span><span class="op" id="5660895">,</span>&nbsp;<span class="builtintype" id="5660897">error</span><span class="op" id="5660902">)</span>&nbsp;<span class="op" id="5660904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660907">jar</span>&nbsp;<span class="op" id="5660911">:=</span>&nbsp;<span class="op" id="5660914">&amp;</span><span class="ident" id="5660915">Jar</span><span class="op" id="5660918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660922">entries</span><span class="op" id="5660929">:</span>&nbsp;<span class="builtinfunc" id="5660931">make</span><span class="op" id="5660935">(</span><span class="keyword" id="5660936">map</span><span class="op" id="5660939">[</span><span class="builtintype" id="5660940">string</span><span class="op" id="5660946">]</span><span class="keyword" id="5660947">map</span><span class="op" id="5660950">[</span><span class="builtintype" id="5660951">string</span><span class="op" id="5660957">]</span><span class="ident" id="5660958">entry</span><span class="op" id="5660963">)</span><span class="op" id="5660964">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5660967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660970">if</span>&nbsp;<span class="ident" id="5660973">o</span>&nbsp;<span class="op" id="5660975">!=</span>&nbsp;<span class="ident" id="5660978">nil</span>&nbsp;<span class="op" id="5660982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660986">jar</span><span class="op" id="5660989">.</span><span class="ident" id="5660990">psList</span>&nbsp;<span class="op" id="5660997">=</span>&nbsp;<span class="ident" id="5660999">o</span><span class="op" id="5661000">.</span><span class="ident" id="5661001">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5661019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661022">return</span>&nbsp;<span class="ident" id="5661029">jar</span><span class="op" id="5661032">,</span>&nbsp;<span class="ident" id="5661034">nil</span><br>
<span class="lineno">85</span><span class="op" id="5661038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5661041">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="5661094">//</span><br>
<span class="lineno"></span><span class="comment" id="5661097">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="5661178">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="5661211">type</span>&nbsp;<span class="ident" id="5661216">entry</span>&nbsp;<span class="keyword" id="5661222">struct</span>&nbsp;<span class="op" id="5661229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661232">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5661243">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661251">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5661262">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661270">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5661281">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661289">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5661300">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661308">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5661319">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661325">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5661336">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661342">Persistent</span>&nbsp;<span class="builtintype" id="5661353">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661359">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5661370">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661376">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661387">time</span><span class="op" id="5661391">.</span><span class="ident" id="5661392">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661398">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5661409">time</span><span class="op" id="5661413">.</span><span class="ident" id="5661414">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661420">LastAccess</span>&nbsp;<span class="ident" id="5661431">time</span><span class="op" id="5661435">.</span><span class="ident" id="5661436">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661443">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661512">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661586">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661636">seqNum</span>&nbsp;<span class="ident" id="5661643">uint64</span><br>
<span class="lineno"></span><span class="op" id="5661650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5661653">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="5661710">func</span>&nbsp;<span class="op" id="5661715">(</span><span class="ident" id="5661716">e</span>&nbsp;<span class="op" id="5661718">*</span><span class="ident" id="5661719">entry</span><span class="op" id="5661724">)</span>&nbsp;<span class="ident" id="5661726">id</span><span class="op" id="5661728">(</span><span class="op" id="5661729">)</span>&nbsp;<span class="builtintype" id="5661731">string</span>&nbsp;<span class="op" id="5661738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661741">return</span>&nbsp;<span class="ident" id="5661748">fmt</span><span class="op" id="5661751">.</span><span class="ident" id="5661752">Sprintf</span><span class="op" id="5661759">(</span><span class="string" id="5661760">&#34;%s;%s;%s&#34;</span><span class="op" id="5661770">,</span>&nbsp;<span class="ident" id="5661772">e</span><span class="op" id="5661773">.</span><span class="ident" id="5661774">Domain</span><span class="op" id="5661780">,</span>&nbsp;<span class="ident" id="5661782">e</span><span class="op" id="5661783">.</span><span class="ident" id="5661784">Path</span><span class="op" id="5661788">,</span>&nbsp;<span class="ident" id="5661790">e</span><span class="op" id="5661791">.</span><span class="ident" id="5661792">Name</span><span class="op" id="5661796">)</span><br>
<span class="lineno"></span><span class="op" id="5661798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5661801">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5661875">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5661950">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="5661972">func</span>&nbsp;<span class="op" id="5661977">(</span><span class="ident" id="5661978">e</span>&nbsp;<span class="op" id="5661980">*</span><span class="ident" id="5661981">entry</span><span class="op" id="5661986">)</span>&nbsp;<span class="ident" id="5661988">shouldSend</span><span class="op" id="5661998">(</span><span class="ident" id="5661999">https</span>&nbsp;<span class="builtintype" id="5662005">bool</span><span class="op" id="5662009">,</span>&nbsp;<span class="ident" id="5662011">host</span><span class="op" id="5662015">,</span>&nbsp;<span class="ident" id="5662017">path</span>&nbsp;<span class="builtintype" id="5662022">string</span><span class="op" id="5662028">)</span>&nbsp;<span class="builtintype" id="5662030">bool</span>&nbsp;<span class="op" id="5662035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662038">return</span>&nbsp;<span class="ident" id="5662045">e</span><span class="op" id="5662046">.</span><span class="ident" id="5662047">domainMatch</span><span class="op" id="5662058">(</span><span class="ident" id="5662059">host</span><span class="op" id="5662063">)</span>&nbsp;<span class="op" id="5662065">&amp;&amp;</span>&nbsp;<span class="ident" id="5662068">e</span><span class="op" id="5662069">.</span><span class="ident" id="5662070">pathMatch</span><span class="op" id="5662079">(</span><span class="ident" id="5662080">path</span><span class="op" id="5662084">)</span>&nbsp;<span class="op" id="5662086">&amp;&amp;</span>&nbsp;<span class="op" id="5662089">(</span><span class="ident" id="5662090">https</span>&nbsp;<span class="op" id="5662096">||</span>&nbsp;<span class="op" id="5662099">!</span><span class="ident" id="5662100">e</span><span class="op" id="5662101">.</span><span class="ident" id="5662102">Secure</span><span class="op" id="5662108">)</span><br>
<span class="lineno">120</span><span class="op" id="5662110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5662113">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5662181">func</span>&nbsp;<span class="op" id="5662186">(</span><span class="ident" id="5662187">e</span>&nbsp;<span class="op" id="5662189">*</span><span class="ident" id="5662190">entry</span><span class="op" id="5662195">)</span>&nbsp;<span class="ident" id="5662197">domainMatch</span><span class="op" id="5662208">(</span><span class="ident" id="5662209">host</span>&nbsp;<span class="builtintype" id="5662214">string</span><span class="op" id="5662220">)</span>&nbsp;<span class="builtintype" id="5662222">bool</span>&nbsp;<span class="op" id="5662227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662230">if</span>&nbsp;<span class="ident" id="5662233">e</span><span class="op" id="5662234">.</span><span class="ident" id="5662235">Domain</span>&nbsp;<span class="op" id="5662242">==</span>&nbsp;<span class="ident" id="5662245">host</span>&nbsp;<span class="op" id="5662250">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662254">return</span>&nbsp;<span class="builtintype" id="5662261">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662270">return</span>&nbsp;<span class="op" id="5662277">!</span><span class="ident" id="5662278">e</span><span class="op" id="5662279">.</span><span class="ident" id="5662280">HostOnly</span>&nbsp;<span class="op" id="5662289">&amp;&amp;</span>&nbsp;<span class="ident" id="5662292">hasDotSuffix</span><span class="op" id="5662304">(</span><span class="ident" id="5662305">host</span><span class="op" id="5662309">,</span>&nbsp;<span class="ident" id="5662311">e</span><span class="op" id="5662312">.</span><span class="ident" id="5662313">Domain</span><span class="op" id="5662319">)</span><br>
<span class="lineno"></span><span class="op" id="5662321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5662324">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5662398">func</span>&nbsp;<span class="op" id="5662403">(</span><span class="ident" id="5662404">e</span>&nbsp;<span class="op" id="5662406">*</span><span class="ident" id="5662407">entry</span><span class="op" id="5662412">)</span>&nbsp;<span class="ident" id="5662414">pathMatch</span><span class="op" id="5662423">(</span><span class="ident" id="5662424">requestPath</span>&nbsp;<span class="builtintype" id="5662436">string</span><span class="op" id="5662442">)</span>&nbsp;<span class="builtintype" id="5662444">bool</span>&nbsp;<span class="op" id="5662449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662452">if</span>&nbsp;<span class="ident" id="5662455">requestPath</span>&nbsp;<span class="op" id="5662467">==</span>&nbsp;<span class="ident" id="5662470">e</span><span class="op" id="5662471">.</span><span class="ident" id="5662472">Path</span>&nbsp;<span class="op" id="5662477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662481">return</span>&nbsp;<span class="builtintype" id="5662488">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662494">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662497">if</span>&nbsp;<span class="ident" id="5662500">strings</span><span class="op" id="5662507">.</span><span class="ident" id="5662508">HasPrefix</span><span class="op" id="5662517">(</span><span class="ident" id="5662518">requestPath</span><span class="op" id="5662529">,</span>&nbsp;<span class="ident" id="5662531">e</span><span class="op" id="5662532">.</span><span class="ident" id="5662533">Path</span><span class="op" id="5662537">)</span>&nbsp;<span class="op" id="5662539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662543">if</span>&nbsp;<span class="ident" id="5662546">e</span><span class="op" id="5662547">.</span><span class="ident" id="5662548">Path</span><span class="op" id="5662552">[</span><span class="builtinfunc" id="5662553">len</span><span class="op" id="5662556">(</span><span class="ident" id="5662557">e</span><span class="op" id="5662558">.</span><span class="ident" id="5662559">Path</span><span class="op" id="5662563">)</span><span class="op" id="5662564">-</span><span class="num" id="5662565">1</span><span class="op" id="5662566">]</span>&nbsp;<span class="op" id="5662568">==</span>&nbsp;<span class="string" id="5662571">&#39;/&#39;</span>&nbsp;<span class="op" id="5662575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662580">return</span>&nbsp;<span class="builtintype" id="5662587">true</span>&nbsp;<span class="comment" id="5662592">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662635">}</span>&nbsp;<span class="keyword" id="5662637">else</span>&nbsp;<span class="keyword" id="5662642">if</span>&nbsp;<span class="ident" id="5662645">requestPath</span><span class="op" id="5662656">[</span><span class="builtinfunc" id="5662657">len</span><span class="op" id="5662660">(</span><span class="ident" id="5662661">e</span><span class="op" id="5662662">.</span><span class="ident" id="5662663">Path</span><span class="op" id="5662667">)</span><span class="op" id="5662668">]</span>&nbsp;<span class="op" id="5662670">==</span>&nbsp;<span class="string" id="5662673">&#39;/&#39;</span>&nbsp;<span class="op" id="5662677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662682">return</span>&nbsp;<span class="builtintype" id="5662689">true</span>&nbsp;<span class="comment" id="5662694">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662742">return</span>&nbsp;<span class="builtintype" id="5662749">false</span><br>
<span class="lineno"></span><span class="op" id="5662755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5662758">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5662812">func</span>&nbsp;<span class="ident" id="5662817">hasDotSuffix</span><span class="op" id="5662829">(</span><span class="ident" id="5662830">s</span><span class="op" id="5662831">,</span>&nbsp;<span class="ident" id="5662833">suffix</span>&nbsp;<span class="builtintype" id="5662840">string</span><span class="op" id="5662846">)</span>&nbsp;<span class="builtintype" id="5662848">bool</span>&nbsp;<span class="op" id="5662853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662856">return</span>&nbsp;<span class="builtinfunc" id="5662863">len</span><span class="op" id="5662866">(</span><span class="ident" id="5662867">s</span><span class="op" id="5662868">)</span>&nbsp;<span class="op" id="5662870">&gt;</span>&nbsp;<span class="builtinfunc" id="5662872">len</span><span class="op" id="5662875">(</span><span class="ident" id="5662876">suffix</span><span class="op" id="5662882">)</span>&nbsp;<span class="op" id="5662884">&amp;&amp;</span>&nbsp;<span class="ident" id="5662887">s</span><span class="op" id="5662888">[</span><span class="builtinfunc" id="5662889">len</span><span class="op" id="5662892">(</span><span class="ident" id="5662893">s</span><span class="op" id="5662894">)</span><span class="op" id="5662895">-</span><span class="builtinfunc" id="5662896">len</span><span class="op" id="5662899">(</span><span class="ident" id="5662900">suffix</span><span class="op" id="5662906">)</span><span class="op" id="5662907">-</span><span class="num" id="5662908">1</span><span class="op" id="5662909">]</span>&nbsp;<span class="op" id="5662911">==</span>&nbsp;<span class="string" id="5662914">&#39;.&#39;</span>&nbsp;<span class="op" id="5662918">&amp;&amp;</span>&nbsp;<span class="ident" id="5662921">s</span><span class="op" id="5662922">[</span><span class="builtinfunc" id="5662923">len</span><span class="op" id="5662926">(</span><span class="ident" id="5662927">s</span><span class="op" id="5662928">)</span><span class="op" id="5662929">-</span><span class="builtinfunc" id="5662930">len</span><span class="op" id="5662933">(</span><span class="ident" id="5662934">suffix</span><span class="op" id="5662940">)</span><span class="op" id="5662941">:</span><span class="op" id="5662942">]</span>&nbsp;<span class="op" id="5662944">==</span>&nbsp;<span class="ident" id="5662947">suffix</span><br>
<span class="lineno"></span><span class="op" id="5662954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5662957">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="5663034">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5663110">type</span>&nbsp;<span class="ident" id="5663115">byPathLength</span>&nbsp;<span class="op" id="5663128">[</span><span class="op" id="5663129">]</span><span class="ident" id="5663130">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5663137">func</span>&nbsp;<span class="op" id="5663142">(</span><span class="ident" id="5663143">s</span>&nbsp;<span class="ident" id="5663145">byPathLength</span><span class="op" id="5663157">)</span>&nbsp;<span class="ident" id="5663159">Len</span><span class="op" id="5663162">(</span><span class="op" id="5663163">)</span>&nbsp;<span class="builtintype" id="5663165">int</span>&nbsp;<span class="op" id="5663169">{</span>&nbsp;<span class="keyword" id="5663171">return</span>&nbsp;<span class="builtinfunc" id="5663178">len</span><span class="op" id="5663181">(</span><span class="ident" id="5663182">s</span><span class="op" id="5663183">)</span>&nbsp;<span class="op" id="5663185">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5663188">func</span>&nbsp;<span class="op" id="5663193">(</span><span class="ident" id="5663194">s</span>&nbsp;<span class="ident" id="5663196">byPathLength</span><span class="op" id="5663208">)</span>&nbsp;<span class="ident" id="5663210">Less</span><span class="op" id="5663214">(</span><span class="ident" id="5663215">i</span><span class="op" id="5663216">,</span>&nbsp;<span class="ident" id="5663218">j</span>&nbsp;<span class="builtintype" id="5663220">int</span><span class="op" id="5663223">)</span>&nbsp;<span class="builtintype" id="5663225">bool</span>&nbsp;<span class="op" id="5663230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663233">if</span>&nbsp;<span class="builtinfunc" id="5663236">len</span><span class="op" id="5663239">(</span><span class="ident" id="5663240">s</span><span class="op" id="5663241">[</span><span class="ident" id="5663242">i</span><span class="op" id="5663243">]</span><span class="op" id="5663244">.</span><span class="ident" id="5663245">Path</span><span class="op" id="5663249">)</span>&nbsp;<span class="op" id="5663251">!=</span>&nbsp;<span class="builtinfunc" id="5663254">len</span><span class="op" id="5663257">(</span><span class="ident" id="5663258">s</span><span class="op" id="5663259">[</span><span class="ident" id="5663260">j</span><span class="op" id="5663261">]</span><span class="op" id="5663262">.</span><span class="ident" id="5663263">Path</span><span class="op" id="5663267">)</span>&nbsp;<span class="op" id="5663269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663273">return</span>&nbsp;<span class="builtinfunc" id="5663280">len</span><span class="op" id="5663283">(</span><span class="ident" id="5663284">s</span><span class="op" id="5663285">[</span><span class="ident" id="5663286">i</span><span class="op" id="5663287">]</span><span class="op" id="5663288">.</span><span class="ident" id="5663289">Path</span><span class="op" id="5663293">)</span>&nbsp;<span class="op" id="5663295">&gt;</span>&nbsp;<span class="builtinfunc" id="5663297">len</span><span class="op" id="5663300">(</span><span class="ident" id="5663301">s</span><span class="op" id="5663302">[</span><span class="ident" id="5663303">j</span><span class="op" id="5663304">]</span><span class="op" id="5663305">.</span><span class="ident" id="5663306">Path</span><span class="op" id="5663310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663313">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663316">if</span>&nbsp;<span class="op" id="5663319">!</span><span class="ident" id="5663320">s</span><span class="op" id="5663321">[</span><span class="ident" id="5663322">i</span><span class="op" id="5663323">]</span><span class="op" id="5663324">.</span><span class="ident" id="5663325">Creation</span><span class="op" id="5663333">.</span><span class="ident" id="5663334">Equal</span><span class="op" id="5663339">(</span><span class="ident" id="5663340">s</span><span class="op" id="5663341">[</span><span class="ident" id="5663342">j</span><span class="op" id="5663343">]</span><span class="op" id="5663344">.</span><span class="ident" id="5663345">Creation</span><span class="op" id="5663353">)</span>&nbsp;<span class="op" id="5663355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663359">return</span>&nbsp;<span class="ident" id="5663366">s</span><span class="op" id="5663367">[</span><span class="ident" id="5663368">i</span><span class="op" id="5663369">]</span><span class="op" id="5663370">.</span><span class="ident" id="5663371">Creation</span><span class="op" id="5663379">.</span><span class="ident" id="5663380">Before</span><span class="op" id="5663386">(</span><span class="ident" id="5663387">s</span><span class="op" id="5663388">[</span><span class="ident" id="5663389">j</span><span class="op" id="5663390">]</span><span class="op" id="5663391">.</span><span class="ident" id="5663392">Creation</span><span class="op" id="5663400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663406">return</span>&nbsp;<span class="ident" id="5663413">s</span><span class="op" id="5663414">[</span><span class="ident" id="5663415">i</span><span class="op" id="5663416">]</span><span class="op" id="5663417">.</span><span class="ident" id="5663418">seqNum</span>&nbsp;<span class="op" id="5663425">&lt;</span>&nbsp;<span class="ident" id="5663427">s</span><span class="op" id="5663428">[</span><span class="ident" id="5663429">j</span><span class="op" id="5663430">]</span><span class="op" id="5663431">.</span><span class="ident" id="5663432">seqNum</span><br>
<span class="lineno"></span><span class="op" id="5663439">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5663442">func</span>&nbsp;<span class="op" id="5663447">(</span><span class="ident" id="5663448">s</span>&nbsp;<span class="ident" id="5663450">byPathLength</span><span class="op" id="5663462">)</span>&nbsp;<span class="ident" id="5663464">Swap</span><span class="op" id="5663468">(</span><span class="ident" id="5663469">i</span><span class="op" id="5663470">,</span>&nbsp;<span class="ident" id="5663472">j</span>&nbsp;<span class="builtintype" id="5663474">int</span><span class="op" id="5663477">)</span>&nbsp;<span class="op" id="5663479">{</span>&nbsp;<span class="ident" id="5663481">s</span><span class="op" id="5663482">[</span><span class="ident" id="5663483">i</span><span class="op" id="5663484">]</span><span class="op" id="5663485">,</span>&nbsp;<span class="ident" id="5663487">s</span><span class="op" id="5663488">[</span><span class="ident" id="5663489">j</span><span class="op" id="5663490">]</span>&nbsp;<span class="op" id="5663492">=</span>&nbsp;<span class="ident" id="5663494">s</span><span class="op" id="5663495">[</span><span class="ident" id="5663496">j</span><span class="op" id="5663497">]</span><span class="op" id="5663498">,</span>&nbsp;<span class="ident" id="5663500">s</span><span class="op" id="5663501">[</span><span class="ident" id="5663502">i</span><span class="op" id="5663503">]</span>&nbsp;<span class="op" id="5663505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5663508">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5663582">//</span><br>
<span class="lineno">170</span><span class="comment" id="5663585">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="5663656">func</span>&nbsp;<span class="op" id="5663661">(</span><span class="ident" id="5663662">j</span>&nbsp;<span class="op" id="5663664">*</span><span class="ident" id="5663665">Jar</span><span class="op" id="5663668">)</span>&nbsp;<span class="ident" id="5663670">Cookies</span><span class="op" id="5663677">(</span><span class="ident" id="5663678">u</span>&nbsp;<span class="op" id="5663680">*</span><span class="ident" id="5663681">url</span><span class="op" id="5663684">.</span><span class="ident" id="5663685">URL</span><span class="op" id="5663688">)</span>&nbsp;<span class="op" id="5663690">(</span><span class="ident" id="5663691">cookies</span>&nbsp;<span class="op" id="5663699">[</span><span class="op" id="5663700">]</span><span class="op" id="5663701">*</span><span class="ident" id="5663702">http</span><span class="op" id="5663706">.</span><span class="ident" id="5663707">Cookie</span><span class="op" id="5663713">)</span>&nbsp;<span class="op" id="5663715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663718">return</span>&nbsp;<span class="ident" id="5663725">j</span><span class="op" id="5663726">.</span><span class="ident" id="5663727">cookies</span><span class="op" id="5663734">(</span><span class="ident" id="5663735">u</span><span class="op" id="5663736">,</span>&nbsp;<span class="ident" id="5663738">time</span><span class="op" id="5663742">.</span><span class="ident" id="5663743">Now</span><span class="op" id="5663746">(</span><span class="op" id="5663747">)</span><span class="op" id="5663748">)</span><br>
<span class="lineno"></span><span class="op" id="5663750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5663753">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5663823">func</span>&nbsp;<span class="op" id="5663828">(</span><span class="ident" id="5663829">j</span>&nbsp;<span class="op" id="5663831">*</span><span class="ident" id="5663832">Jar</span><span class="op" id="5663835">)</span>&nbsp;<span class="ident" id="5663837">cookies</span><span class="op" id="5663844">(</span><span class="ident" id="5663845">u</span>&nbsp;<span class="op" id="5663847">*</span><span class="ident" id="5663848">url</span><span class="op" id="5663851">.</span><span class="ident" id="5663852">URL</span><span class="op" id="5663855">,</span>&nbsp;<span class="ident" id="5663857">now</span>&nbsp;<span class="ident" id="5663861">time</span><span class="op" id="5663865">.</span><span class="ident" id="5663866">Time</span><span class="op" id="5663870">)</span>&nbsp;<span class="op" id="5663872">(</span><span class="ident" id="5663873">cookies</span>&nbsp;<span class="op" id="5663881">[</span><span class="op" id="5663882">]</span><span class="op" id="5663883">*</span><span class="ident" id="5663884">http</span><span class="op" id="5663888">.</span><span class="ident" id="5663889">Cookie</span><span class="op" id="5663895">)</span>&nbsp;<span class="op" id="5663897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663900">if</span>&nbsp;<span class="ident" id="5663903">u</span><span class="op" id="5663904">.</span><span class="ident" id="5663905">Scheme</span>&nbsp;<span class="op" id="5663912">!=</span>&nbsp;<span class="string" id="5663915">&#34;http&#34;</span>&nbsp;<span class="op" id="5663922">&amp;&amp;</span>&nbsp;<span class="ident" id="5663925">u</span><span class="op" id="5663926">.</span><span class="ident" id="5663927">Scheme</span>&nbsp;<span class="op" id="5663934">!=</span>&nbsp;<span class="string" id="5663937">&#34;https&#34;</span>&nbsp;<span class="op" id="5663945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663949">return</span>&nbsp;<span class="ident" id="5663956">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663965">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663968">host</span><span class="op" id="5663972">,</span>&nbsp;<span class="ident" id="5663974">err</span>&nbsp;<span class="op" id="5663978">:=</span>&nbsp;<span class="ident" id="5663981">canonicalHost</span><span class="op" id="5663994">(</span><span class="ident" id="5663995">u</span><span class="op" id="5663996">.</span><span class="ident" id="5663997">Host</span><span class="op" id="5664001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664004">if</span>&nbsp;<span class="ident" id="5664007">err</span>&nbsp;<span class="op" id="5664011">!=</span>&nbsp;<span class="ident" id="5664014">nil</span>&nbsp;<span class="op" id="5664018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664022">return</span>&nbsp;<span class="ident" id="5664029">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664041">key</span>&nbsp;<span class="op" id="5664045">:=</span>&nbsp;<span class="ident" id="5664048">jarKey</span><span class="op" id="5664054">(</span><span class="ident" id="5664055">host</span><span class="op" id="5664059">,</span>&nbsp;<span class="ident" id="5664061">j</span><span class="op" id="5664062">.</span><span class="ident" id="5664063">psList</span><span class="op" id="5664069">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664073">j</span><span class="op" id="5664074">.</span><span class="ident" id="5664075">mu</span><span class="op" id="5664077">.</span><span class="ident" id="5664078">Lock</span><span class="op" id="5664082">(</span><span class="op" id="5664083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664086">defer</span>&nbsp;<span class="ident" id="5664092">j</span><span class="op" id="5664093">.</span><span class="ident" id="5664094">mu</span><span class="op" id="5664096">.</span><span class="ident" id="5664097">Unlock</span><span class="op" id="5664103">(</span><span class="op" id="5664104">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664108">submap</span>&nbsp;<span class="op" id="5664115">:=</span>&nbsp;<span class="ident" id="5664118">j</span><span class="op" id="5664119">.</span><span class="ident" id="5664120">entries</span><span class="op" id="5664127">[</span><span class="ident" id="5664128">key</span><span class="op" id="5664131">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664134">if</span>&nbsp;<span class="ident" id="5664137">submap</span>&nbsp;<span class="op" id="5664144">==</span>&nbsp;<span class="ident" id="5664147">nil</span>&nbsp;<span class="op" id="5664151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664155">return</span>&nbsp;<span class="ident" id="5664162">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664175">https</span>&nbsp;<span class="op" id="5664181">:=</span>&nbsp;<span class="ident" id="5664184">u</span><span class="op" id="5664185">.</span><span class="ident" id="5664186">Scheme</span>&nbsp;<span class="op" id="5664193">==</span>&nbsp;<span class="string" id="5664196">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664205">path</span>&nbsp;<span class="op" id="5664210">:=</span>&nbsp;<span class="ident" id="5664213">u</span><span class="op" id="5664214">.</span><span class="ident" id="5664215">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664221">if</span>&nbsp;<span class="ident" id="5664224">path</span>&nbsp;<span class="op" id="5664229">==</span>&nbsp;<span class="string" id="5664232">&#34;&#34;</span>&nbsp;<span class="op" id="5664235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664239">path</span>&nbsp;<span class="op" id="5664244">=</span>&nbsp;<span class="string" id="5664246">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664255">modified</span>&nbsp;<span class="op" id="5664264">:=</span>&nbsp;<span class="builtintype" id="5664267">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664274">var</span>&nbsp;<span class="ident" id="5664278">selected</span>&nbsp;<span class="op" id="5664287">[</span><span class="op" id="5664288">]</span><span class="ident" id="5664289">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664296">for</span>&nbsp;<span class="ident" id="5664300">id</span><span class="op" id="5664302">,</span>&nbsp;<span class="ident" id="5664304">e</span>&nbsp;<span class="op" id="5664306">:=</span>&nbsp;<span class="keyword" id="5664309">range</span>&nbsp;<span class="ident" id="5664315">submap</span>&nbsp;<span class="op" id="5664322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664326">if</span>&nbsp;<span class="ident" id="5664329">e</span><span class="op" id="5664330">.</span><span class="ident" id="5664331">Persistent</span>&nbsp;<span class="op" id="5664342">&amp;&amp;</span>&nbsp;<span class="op" id="5664345">!</span><span class="ident" id="5664346">e</span><span class="op" id="5664347">.</span><span class="ident" id="5664348">Expires</span><span class="op" id="5664355">.</span><span class="ident" id="5664356">After</span><span class="op" id="5664361">(</span><span class="ident" id="5664362">now</span><span class="op" id="5664365">)</span>&nbsp;<span class="op" id="5664367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5664372">delete</span><span class="op" id="5664378">(</span><span class="ident" id="5664379">submap</span><span class="op" id="5664385">,</span>&nbsp;<span class="ident" id="5664387">id</span><span class="op" id="5664389">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664394">modified</span>&nbsp;<span class="op" id="5664403">=</span>&nbsp;<span class="builtintype" id="5664405">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664413">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664428">if</span>&nbsp;<span class="op" id="5664431">!</span><span class="ident" id="5664432">e</span><span class="op" id="5664433">.</span><span class="ident" id="5664434">shouldSend</span><span class="op" id="5664444">(</span><span class="ident" id="5664445">https</span><span class="op" id="5664450">,</span>&nbsp;<span class="ident" id="5664452">host</span><span class="op" id="5664456">,</span>&nbsp;<span class="ident" id="5664458">path</span><span class="op" id="5664462">)</span>&nbsp;<span class="op" id="5664464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664469">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664484">e</span><span class="op" id="5664485">.</span><span class="ident" id="5664486">LastAccess</span>&nbsp;<span class="op" id="5664497">=</span>&nbsp;<span class="ident" id="5664499">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664505">submap</span><span class="op" id="5664511">[</span><span class="ident" id="5664512">id</span><span class="op" id="5664514">]</span>&nbsp;<span class="op" id="5664516">=</span>&nbsp;<span class="ident" id="5664518">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664522">selected</span>&nbsp;<span class="op" id="5664531">=</span>&nbsp;<span class="builtinfunc" id="5664533">append</span><span class="op" id="5664539">(</span><span class="ident" id="5664540">selected</span><span class="op" id="5664548">,</span>&nbsp;<span class="ident" id="5664550">e</span><span class="op" id="5664551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664555">modified</span>&nbsp;<span class="op" id="5664564">=</span>&nbsp;<span class="builtintype" id="5664566">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664575">if</span>&nbsp;<span class="ident" id="5664578">modified</span>&nbsp;<span class="op" id="5664587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664591">if</span>&nbsp;<span class="builtinfunc" id="5664594">len</span><span class="op" id="5664597">(</span><span class="ident" id="5664598">submap</span><span class="op" id="5664604">)</span>&nbsp;<span class="op" id="5664606">==</span>&nbsp;<span class="num" id="5664609">0</span>&nbsp;<span class="op" id="5664611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5664616">delete</span><span class="op" id="5664622">(</span><span class="ident" id="5664623">j</span><span class="op" id="5664624">.</span><span class="ident" id="5664625">entries</span><span class="op" id="5664632">,</span>&nbsp;<span class="ident" id="5664634">key</span><span class="op" id="5664637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664641">}</span>&nbsp;<span class="keyword" id="5664643">else</span>&nbsp;<span class="op" id="5664648">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664653">j</span><span class="op" id="5664654">.</span><span class="ident" id="5664655">entries</span><span class="op" id="5664662">[</span><span class="ident" id="5664663">key</span><span class="op" id="5664666">]</span>&nbsp;<span class="op" id="5664668">=</span>&nbsp;<span class="ident" id="5664670">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664686">sort</span><span class="op" id="5664690">.</span><span class="ident" id="5664691">Sort</span><span class="op" id="5664695">(</span><span class="ident" id="5664696">byPathLength</span><span class="op" id="5664708">(</span><span class="ident" id="5664709">selected</span><span class="op" id="5664717">)</span><span class="op" id="5664718">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664721">for</span>&nbsp;<span class="ident" id="5664725">_</span><span class="op" id="5664726">,</span>&nbsp;<span class="ident" id="5664728">e</span>&nbsp;<span class="op" id="5664730">:=</span>&nbsp;<span class="keyword" id="5664733">range</span>&nbsp;<span class="ident" id="5664739">selected</span>&nbsp;<span class="op" id="5664748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664752">cookies</span>&nbsp;<span class="op" id="5664760">=</span>&nbsp;<span class="builtinfunc" id="5664762">append</span><span class="op" id="5664768">(</span><span class="ident" id="5664769">cookies</span><span class="op" id="5664776">,</span>&nbsp;<span class="op" id="5664778">&amp;</span><span class="ident" id="5664779">http</span><span class="op" id="5664783">.</span><span class="ident" id="5664784">Cookie</span><span class="op" id="5664790">{</span><span class="ident" id="5664791">Name</span><span class="op" id="5664795">:</span>&nbsp;<span class="ident" id="5664797">e</span><span class="op" id="5664798">.</span><span class="ident" id="5664799">Name</span><span class="op" id="5664803">,</span>&nbsp;<span class="ident" id="5664805">Value</span><span class="op" id="5664810">:</span>&nbsp;<span class="ident" id="5664812">e</span><span class="op" id="5664813">.</span><span class="ident" id="5664814">Value</span><span class="op" id="5664819">}</span><span class="op" id="5664820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664827">return</span>&nbsp;<span class="ident" id="5664834">cookies</span><br>
<span class="lineno">230</span><span class="op" id="5664842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5664845">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5664925">//</span><br>
<span class="lineno"></span><span class="comment" id="5664928">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="5664989">func</span>&nbsp;<span class="op" id="5664994">(</span><span class="ident" id="5664995">j</span>&nbsp;<span class="op" id="5664997">*</span><span class="ident" id="5664998">Jar</span><span class="op" id="5665001">)</span>&nbsp;<span class="ident" id="5665003">SetCookies</span><span class="op" id="5665013">(</span><span class="ident" id="5665014">u</span>&nbsp;<span class="op" id="5665016">*</span><span class="ident" id="5665017">url</span><span class="op" id="5665020">.</span><span class="ident" id="5665021">URL</span><span class="op" id="5665024">,</span>&nbsp;<span class="ident" id="5665026">cookies</span>&nbsp;<span class="op" id="5665034">[</span><span class="op" id="5665035">]</span><span class="op" id="5665036">*</span><span class="ident" id="5665037">http</span><span class="op" id="5665041">.</span><span class="ident" id="5665042">Cookie</span><span class="op" id="5665048">)</span>&nbsp;<span class="op" id="5665050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665053">j</span><span class="op" id="5665054">.</span><span class="ident" id="5665055">setCookies</span><span class="op" id="5665065">(</span><span class="ident" id="5665066">u</span><span class="op" id="5665067">,</span>&nbsp;<span class="ident" id="5665069">cookies</span><span class="op" id="5665076">,</span>&nbsp;<span class="ident" id="5665078">time</span><span class="op" id="5665082">.</span><span class="ident" id="5665083">Now</span><span class="op" id="5665086">(</span><span class="op" id="5665087">)</span><span class="op" id="5665088">)</span><br>
<span class="lineno"></span><span class="op" id="5665090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5665093">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="5665167">func</span>&nbsp;<span class="op" id="5665172">(</span><span class="ident" id="5665173">j</span>&nbsp;<span class="op" id="5665175">*</span><span class="ident" id="5665176">Jar</span><span class="op" id="5665179">)</span>&nbsp;<span class="ident" id="5665181">setCookies</span><span class="op" id="5665191">(</span><span class="ident" id="5665192">u</span>&nbsp;<span class="op" id="5665194">*</span><span class="ident" id="5665195">url</span><span class="op" id="5665198">.</span><span class="ident" id="5665199">URL</span><span class="op" id="5665202">,</span>&nbsp;<span class="ident" id="5665204">cookies</span>&nbsp;<span class="op" id="5665212">[</span><span class="op" id="5665213">]</span><span class="op" id="5665214">*</span><span class="ident" id="5665215">http</span><span class="op" id="5665219">.</span><span class="ident" id="5665220">Cookie</span><span class="op" id="5665226">,</span>&nbsp;<span class="ident" id="5665228">now</span>&nbsp;<span class="ident" id="5665232">time</span><span class="op" id="5665236">.</span><span class="ident" id="5665237">Time</span><span class="op" id="5665241">)</span>&nbsp;<span class="op" id="5665243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665246">if</span>&nbsp;<span class="builtinfunc" id="5665249">len</span><span class="op" id="5665252">(</span><span class="ident" id="5665253">cookies</span><span class="op" id="5665260">)</span>&nbsp;<span class="op" id="5665262">==</span>&nbsp;<span class="num" id="5665265">0</span>&nbsp;<span class="op" id="5665267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665271">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665282">if</span>&nbsp;<span class="ident" id="5665285">u</span><span class="op" id="5665286">.</span><span class="ident" id="5665287">Scheme</span>&nbsp;<span class="op" id="5665294">!=</span>&nbsp;<span class="string" id="5665297">&#34;http&#34;</span>&nbsp;<span class="op" id="5665304">&amp;&amp;</span>&nbsp;<span class="ident" id="5665307">u</span><span class="op" id="5665308">.</span><span class="ident" id="5665309">Scheme</span>&nbsp;<span class="op" id="5665316">!=</span>&nbsp;<span class="string" id="5665319">&#34;https&#34;</span>&nbsp;<span class="op" id="5665327">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665331">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665342">host</span><span class="op" id="5665346">,</span>&nbsp;<span class="ident" id="5665348">err</span>&nbsp;<span class="op" id="5665352">:=</span>&nbsp;<span class="ident" id="5665355">canonicalHost</span><span class="op" id="5665368">(</span><span class="ident" id="5665369">u</span><span class="op" id="5665370">.</span><span class="ident" id="5665371">Host</span><span class="op" id="5665375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665378">if</span>&nbsp;<span class="ident" id="5665381">err</span>&nbsp;<span class="op" id="5665385">!=</span>&nbsp;<span class="ident" id="5665388">nil</span>&nbsp;<span class="op" id="5665392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665396">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665407">key</span>&nbsp;<span class="op" id="5665411">:=</span>&nbsp;<span class="ident" id="5665414">jarKey</span><span class="op" id="5665420">(</span><span class="ident" id="5665421">host</span><span class="op" id="5665425">,</span>&nbsp;<span class="ident" id="5665427">j</span><span class="op" id="5665428">.</span><span class="ident" id="5665429">psList</span><span class="op" id="5665435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665438">defPath</span>&nbsp;<span class="op" id="5665446">:=</span>&nbsp;<span class="ident" id="5665449">defaultPath</span><span class="op" id="5665460">(</span><span class="ident" id="5665461">u</span><span class="op" id="5665462">.</span><span class="ident" id="5665463">Path</span><span class="op" id="5665467">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665471">j</span><span class="op" id="5665472">.</span><span class="ident" id="5665473">mu</span><span class="op" id="5665475">.</span><span class="ident" id="5665476">Lock</span><span class="op" id="5665480">(</span><span class="op" id="5665481">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665484">defer</span>&nbsp;<span class="ident" id="5665490">j</span><span class="op" id="5665491">.</span><span class="ident" id="5665492">mu</span><span class="op" id="5665494">.</span><span class="ident" id="5665495">Unlock</span><span class="op" id="5665501">(</span><span class="op" id="5665502">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665506">submap</span>&nbsp;<span class="op" id="5665513">:=</span>&nbsp;<span class="ident" id="5665516">j</span><span class="op" id="5665517">.</span><span class="ident" id="5665518">entries</span><span class="op" id="5665525">[</span><span class="ident" id="5665526">key</span><span class="op" id="5665529">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665533">modified</span>&nbsp;<span class="op" id="5665542">:=</span>&nbsp;<span class="builtintype" id="5665545">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665552">for</span>&nbsp;<span class="ident" id="5665556">_</span><span class="op" id="5665557">,</span>&nbsp;<span class="ident" id="5665559">cookie</span>&nbsp;<span class="op" id="5665566">:=</span>&nbsp;<span class="keyword" id="5665569">range</span>&nbsp;<span class="ident" id="5665575">cookies</span>&nbsp;<span class="op" id="5665583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665587">e</span><span class="op" id="5665588">,</span>&nbsp;<span class="ident" id="5665590">remove</span><span class="op" id="5665596">,</span>&nbsp;<span class="ident" id="5665598">err</span>&nbsp;<span class="op" id="5665602">:=</span>&nbsp;<span class="ident" id="5665605">j</span><span class="op" id="5665606">.</span><span class="ident" id="5665607">newEntry</span><span class="op" id="5665615">(</span><span class="ident" id="5665616">cookie</span><span class="op" id="5665622">,</span>&nbsp;<span class="ident" id="5665624">now</span><span class="op" id="5665627">,</span>&nbsp;<span class="ident" id="5665629">defPath</span><span class="op" id="5665636">,</span>&nbsp;<span class="ident" id="5665638">host</span><span class="op" id="5665642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665646">if</span>&nbsp;<span class="ident" id="5665649">err</span>&nbsp;<span class="op" id="5665653">!=</span>&nbsp;<span class="ident" id="5665656">nil</span>&nbsp;<span class="op" id="5665660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665665">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665676">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665680">id</span>&nbsp;<span class="op" id="5665683">:=</span>&nbsp;<span class="ident" id="5665686">e</span><span class="op" id="5665687">.</span><span class="ident" id="5665688">id</span><span class="op" id="5665690">(</span><span class="op" id="5665691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665695">if</span>&nbsp;<span class="ident" id="5665698">remove</span>&nbsp;<span class="op" id="5665705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665710">if</span>&nbsp;<span class="ident" id="5665713">submap</span>&nbsp;<span class="op" id="5665720">!=</span>&nbsp;<span class="ident" id="5665723">nil</span>&nbsp;<span class="op" id="5665727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665733">if</span>&nbsp;<span class="ident" id="5665736">_</span><span class="op" id="5665737">,</span>&nbsp;<span class="ident" id="5665739">ok</span>&nbsp;<span class="op" id="5665742">:=</span>&nbsp;<span class="ident" id="5665745">submap</span><span class="op" id="5665751">[</span><span class="ident" id="5665752">id</span><span class="op" id="5665754">]</span><span class="op" id="5665755">;</span>&nbsp;<span class="ident" id="5665757">ok</span>&nbsp;<span class="op" id="5665760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5665767">delete</span><span class="op" id="5665773">(</span><span class="ident" id="5665774">submap</span><span class="op" id="5665780">,</span>&nbsp;<span class="ident" id="5665782">id</span><span class="op" id="5665784">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665791">modified</span>&nbsp;<span class="op" id="5665800">=</span>&nbsp;<span class="builtintype" id="5665802">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665821">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665832">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665836">if</span>&nbsp;<span class="ident" id="5665839">submap</span>&nbsp;<span class="op" id="5665846">==</span>&nbsp;<span class="ident" id="5665849">nil</span>&nbsp;<span class="op" id="5665853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665858">submap</span>&nbsp;<span class="op" id="5665865">=</span>&nbsp;<span class="builtinfunc" id="5665867">make</span><span class="op" id="5665871">(</span><span class="keyword" id="5665872">map</span><span class="op" id="5665875">[</span><span class="builtintype" id="5665876">string</span><span class="op" id="5665882">]</span><span class="ident" id="5665883">entry</span><span class="op" id="5665888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665897">if</span>&nbsp;<span class="ident" id="5665900">old</span><span class="op" id="5665903">,</span>&nbsp;<span class="ident" id="5665905">ok</span>&nbsp;<span class="op" id="5665908">:=</span>&nbsp;<span class="ident" id="5665911">submap</span><span class="op" id="5665917">[</span><span class="ident" id="5665918">id</span><span class="op" id="5665920">]</span><span class="op" id="5665921">;</span>&nbsp;<span class="ident" id="5665923">ok</span>&nbsp;<span class="op" id="5665926">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665931">e</span><span class="op" id="5665932">.</span><span class="ident" id="5665933">Creation</span>&nbsp;<span class="op" id="5665942">=</span>&nbsp;<span class="ident" id="5665944">old</span><span class="op" id="5665947">.</span><span class="ident" id="5665948">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665960">e</span><span class="op" id="5665961">.</span><span class="ident" id="5665962">seqNum</span>&nbsp;<span class="op" id="5665969">=</span>&nbsp;<span class="ident" id="5665971">old</span><span class="op" id="5665974">.</span><span class="ident" id="5665975">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665984">}</span>&nbsp;<span class="keyword" id="5665986">else</span>&nbsp;<span class="op" id="5665991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665996">e</span><span class="op" id="5665997">.</span><span class="ident" id="5665998">Creation</span>&nbsp;<span class="op" id="5666007">=</span>&nbsp;<span class="ident" id="5666009">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666016">e</span><span class="op" id="5666017">.</span><span class="ident" id="5666018">seqNum</span>&nbsp;<span class="op" id="5666025">=</span>&nbsp;<span class="ident" id="5666027">j</span><span class="op" id="5666028">.</span><span class="ident" id="5666029">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666043">j</span><span class="op" id="5666044">.</span><span class="ident" id="5666045">nextSeqNum</span><span class="op" id="5666055">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666064">e</span><span class="op" id="5666065">.</span><span class="ident" id="5666066">LastAccess</span>&nbsp;<span class="op" id="5666077">=</span>&nbsp;<span class="ident" id="5666079">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666085">submap</span><span class="op" id="5666091">[</span><span class="ident" id="5666092">id</span><span class="op" id="5666094">]</span>&nbsp;<span class="op" id="5666096">=</span>&nbsp;<span class="ident" id="5666098">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666102">modified</span>&nbsp;<span class="op" id="5666111">=</span>&nbsp;<span class="builtintype" id="5666113">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666123">if</span>&nbsp;<span class="ident" id="5666126">modified</span>&nbsp;<span class="op" id="5666135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666139">if</span>&nbsp;<span class="builtinfunc" id="5666142">len</span><span class="op" id="5666145">(</span><span class="ident" id="5666146">submap</span><span class="op" id="5666152">)</span>&nbsp;<span class="op" id="5666154">==</span>&nbsp;<span class="num" id="5666157">0</span>&nbsp;<span class="op" id="5666159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5666164">delete</span><span class="op" id="5666170">(</span><span class="ident" id="5666171">j</span><span class="op" id="5666172">.</span><span class="ident" id="5666173">entries</span><span class="op" id="5666180">,</span>&nbsp;<span class="ident" id="5666182">key</span><span class="op" id="5666185">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666189">}</span>&nbsp;<span class="keyword" id="5666191">else</span>&nbsp;<span class="op" id="5666196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666201">j</span><span class="op" id="5666202">.</span><span class="ident" id="5666203">entries</span><span class="op" id="5666210">[</span><span class="ident" id="5666211">key</span><span class="op" id="5666214">]</span>&nbsp;<span class="op" id="5666216">=</span>&nbsp;<span class="ident" id="5666218">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666230">}</span><br>
<span class="lineno"></span><span class="op" id="5666232">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="5666235">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="5666315">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5666329">func</span>&nbsp;<span class="ident" id="5666334">canonicalHost</span><span class="op" id="5666347">(</span><span class="ident" id="5666348">host</span>&nbsp;<span class="builtintype" id="5666353">string</span><span class="op" id="5666359">)</span>&nbsp;<span class="op" id="5666361">(</span><span class="builtintype" id="5666362">string</span><span class="op" id="5666368">,</span>&nbsp;<span class="builtintype" id="5666370">error</span><span class="op" id="5666375">)</span>&nbsp;<span class="op" id="5666377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666380">var</span>&nbsp;<span class="ident" id="5666384">err</span>&nbsp;<span class="builtintype" id="5666388">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666395">host</span>&nbsp;<span class="op" id="5666400">=</span>&nbsp;<span class="ident" id="5666402">strings</span><span class="op" id="5666409">.</span><span class="ident" id="5666410">ToLower</span><span class="op" id="5666417">(</span><span class="ident" id="5666418">host</span><span class="op" id="5666422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666425">if</span>&nbsp;<span class="ident" id="5666428">hasPort</span><span class="op" id="5666435">(</span><span class="ident" id="5666436">host</span><span class="op" id="5666440">)</span>&nbsp;<span class="op" id="5666442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666446">host</span><span class="op" id="5666450">,</span>&nbsp;<span class="ident" id="5666452">_</span><span class="op" id="5666453">,</span>&nbsp;<span class="ident" id="5666455">err</span>&nbsp;<span class="op" id="5666459">=</span>&nbsp;<span class="ident" id="5666461">net</span><span class="op" id="5666464">.</span><span class="ident" id="5666465">SplitHostPort</span><span class="op" id="5666478">(</span><span class="ident" id="5666479">host</span><span class="op" id="5666483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666487">if</span>&nbsp;<span class="ident" id="5666490">err</span>&nbsp;<span class="op" id="5666494">!=</span>&nbsp;<span class="ident" id="5666497">nil</span>&nbsp;<span class="op" id="5666501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666506">return</span>&nbsp;<span class="string" id="5666513">&#34;&#34;</span><span class="op" id="5666515">,</span>&nbsp;<span class="ident" id="5666517">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666529">if</span>&nbsp;<span class="ident" id="5666532">strings</span><span class="op" id="5666539">.</span><span class="ident" id="5666540">HasSuffix</span><span class="op" id="5666549">(</span><span class="ident" id="5666550">host</span><span class="op" id="5666554">,</span>&nbsp;<span class="string" id="5666556">&#34;.&#34;</span><span class="op" id="5666559">)</span>&nbsp;<span class="op" id="5666561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666565">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666624">host</span>&nbsp;<span class="op" id="5666629">=</span>&nbsp;<span class="ident" id="5666631">host</span><span class="op" id="5666635">[</span><span class="op" id="5666636">:</span><span class="builtinfunc" id="5666637">len</span><span class="op" id="5666640">(</span><span class="ident" id="5666641">host</span><span class="op" id="5666645">)</span><span class="op" id="5666646">-</span><span class="num" id="5666647">1</span><span class="op" id="5666648">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666654">return</span>&nbsp;<span class="ident" id="5666661">toASCII</span><span class="op" id="5666668">(</span><span class="ident" id="5666669">host</span><span class="op" id="5666673">)</span><br>
<span class="lineno"></span><span class="op" id="5666675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5666678">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="5666753">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5666790">func</span>&nbsp;<span class="ident" id="5666795">hasPort</span><span class="op" id="5666802">(</span><span class="ident" id="5666803">host</span>&nbsp;<span class="builtintype" id="5666808">string</span><span class="op" id="5666814">)</span>&nbsp;<span class="builtintype" id="5666816">bool</span>&nbsp;<span class="op" id="5666821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666824">colons</span>&nbsp;<span class="op" id="5666831">:=</span>&nbsp;<span class="ident" id="5666834">strings</span><span class="op" id="5666841">.</span><span class="ident" id="5666842">Count</span><span class="op" id="5666847">(</span><span class="ident" id="5666848">host</span><span class="op" id="5666852">,</span>&nbsp;<span class="string" id="5666854">&#34;:&#34;</span><span class="op" id="5666857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666860">if</span>&nbsp;<span class="ident" id="5666863">colons</span>&nbsp;<span class="op" id="5666870">==</span>&nbsp;<span class="num" id="5666873">0</span>&nbsp;<span class="op" id="5666875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666879">return</span>&nbsp;<span class="builtintype" id="5666886">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666896">if</span>&nbsp;<span class="ident" id="5666899">colons</span>&nbsp;<span class="op" id="5666906">==</span>&nbsp;<span class="num" id="5666909">1</span>&nbsp;<span class="op" id="5666911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666915">return</span>&nbsp;<span class="builtintype" id="5666922">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666931">return</span>&nbsp;<span class="ident" id="5666938">host</span><span class="op" id="5666942">[</span><span class="num" id="5666943">0</span><span class="op" id="5666944">]</span>&nbsp;<span class="op" id="5666946">==</span>&nbsp;<span class="string" id="5666949">&#39;[&#39;</span>&nbsp;<span class="op" id="5666953">&amp;&amp;</span>&nbsp;<span class="ident" id="5666956">strings</span><span class="op" id="5666963">.</span><span class="ident" id="5666964">Contains</span><span class="op" id="5666972">(</span><span class="ident" id="5666973">host</span><span class="op" id="5666977">,</span>&nbsp;<span class="string" id="5666979">&#34;]:&#34;</span><span class="op" id="5666983">)</span><br>
<span class="lineno">330</span><span class="op" id="5666985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5666988">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5667032">func</span>&nbsp;<span class="ident" id="5667037">jarKey</span><span class="op" id="5667043">(</span><span class="ident" id="5667044">host</span>&nbsp;<span class="builtintype" id="5667049">string</span><span class="op" id="5667055">,</span>&nbsp;<span class="ident" id="5667057">psl</span>&nbsp;<span class="ident" id="5667061">PublicSuffixList</span><span class="op" id="5667077">)</span>&nbsp;<span class="builtintype" id="5667079">string</span>&nbsp;<span class="op" id="5667086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667089">if</span>&nbsp;<span class="ident" id="5667092">isIP</span><span class="op" id="5667096">(</span><span class="ident" id="5667097">host</span><span class="op" id="5667101">)</span>&nbsp;<span class="op" id="5667103">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667107">return</span>&nbsp;<span class="ident" id="5667114">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667124">var</span>&nbsp;<span class="ident" id="5667128">i</span>&nbsp;<span class="builtintype" id="5667130">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667135">if</span>&nbsp;<span class="ident" id="5667138">psl</span>&nbsp;<span class="op" id="5667142">==</span>&nbsp;<span class="ident" id="5667145">nil</span>&nbsp;<span class="op" id="5667149">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667153">i</span>&nbsp;<span class="op" id="5667155">=</span>&nbsp;<span class="ident" id="5667157">strings</span><span class="op" id="5667164">.</span><span class="ident" id="5667165">LastIndex</span><span class="op" id="5667174">(</span><span class="ident" id="5667175">host</span><span class="op" id="5667179">,</span>&nbsp;<span class="string" id="5667181">&#34;.&#34;</span><span class="op" id="5667184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667188">if</span>&nbsp;<span class="ident" id="5667191">i</span>&nbsp;<span class="op" id="5667193">==</span>&nbsp;<span class="op" id="5667196">-</span><span class="num" id="5667197">1</span>&nbsp;<span class="op" id="5667199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667204">return</span>&nbsp;<span class="ident" id="5667211">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667221">}</span>&nbsp;<span class="keyword" id="5667223">else</span>&nbsp;<span class="op" id="5667228">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667232">suffix</span>&nbsp;<span class="op" id="5667239">:=</span>&nbsp;<span class="ident" id="5667242">psl</span><span class="op" id="5667245">.</span><span class="ident" id="5667246">PublicSuffix</span><span class="op" id="5667258">(</span><span class="ident" id="5667259">host</span><span class="op" id="5667263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667267">if</span>&nbsp;<span class="ident" id="5667270">suffix</span>&nbsp;<span class="op" id="5667277">==</span>&nbsp;<span class="ident" id="5667280">host</span>&nbsp;<span class="op" id="5667285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667290">return</span>&nbsp;<span class="ident" id="5667297">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667308">i</span>&nbsp;<span class="op" id="5667310">=</span>&nbsp;<span class="builtinfunc" id="5667312">len</span><span class="op" id="5667315">(</span><span class="ident" id="5667316">host</span><span class="op" id="5667320">)</span>&nbsp;<span class="op" id="5667322">-</span>&nbsp;<span class="builtinfunc" id="5667324">len</span><span class="op" id="5667327">(</span><span class="ident" id="5667328">suffix</span><span class="op" id="5667334">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667338">if</span>&nbsp;<span class="ident" id="5667341">i</span>&nbsp;<span class="op" id="5667343">&lt;=</span>&nbsp;<span class="num" id="5667346">0</span>&nbsp;<span class="op" id="5667348">||</span>&nbsp;<span class="ident" id="5667351">host</span><span class="op" id="5667355">[</span><span class="ident" id="5667356">i</span><span class="op" id="5667357">-</span><span class="num" id="5667358">1</span><span class="op" id="5667359">]</span>&nbsp;<span class="op" id="5667361">!=</span>&nbsp;<span class="string" id="5667364">&#39;.&#39;</span>&nbsp;<span class="op" id="5667368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667373">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667426">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667478">return</span>&nbsp;<span class="ident" id="5667485">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667492">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667498">prevDot</span>&nbsp;<span class="op" id="5667506">:=</span>&nbsp;<span class="ident" id="5667509">strings</span><span class="op" id="5667516">.</span><span class="ident" id="5667517">LastIndex</span><span class="op" id="5667526">(</span><span class="ident" id="5667527">host</span><span class="op" id="5667531">[</span><span class="op" id="5667532">:</span><span class="ident" id="5667533">i</span><span class="op" id="5667534">-</span><span class="num" id="5667535">1</span><span class="op" id="5667536">]</span><span class="op" id="5667537">,</span>&nbsp;<span class="string" id="5667539">&#34;.&#34;</span><span class="op" id="5667542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667545">return</span>&nbsp;<span class="ident" id="5667552">host</span><span class="op" id="5667556">[</span><span class="ident" id="5667557">prevDot</span><span class="op" id="5667564">+</span><span class="num" id="5667565">1</span><span class="op" id="5667566">:</span><span class="op" id="5667567">]</span><br>
<span class="lineno"></span><span class="op" id="5667569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="5667572">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5667619">func</span>&nbsp;<span class="ident" id="5667624">isIP</span><span class="op" id="5667628">(</span><span class="ident" id="5667629">host</span>&nbsp;<span class="builtintype" id="5667634">string</span><span class="op" id="5667640">)</span>&nbsp;<span class="builtintype" id="5667642">bool</span>&nbsp;<span class="op" id="5667647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667650">return</span>&nbsp;<span class="ident" id="5667657">net</span><span class="op" id="5667660">.</span><span class="ident" id="5667661">ParseIP</span><span class="op" id="5667668">(</span><span class="ident" id="5667669">host</span><span class="op" id="5667673">)</span>&nbsp;<span class="op" id="5667675">!=</span>&nbsp;<span class="ident" id="5667678">nil</span><br>
<span class="lineno"></span><span class="op" id="5667682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5667685">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5667757">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5667784">func</span>&nbsp;<span class="ident" id="5667789">defaultPath</span><span class="op" id="5667800">(</span><span class="ident" id="5667801">path</span>&nbsp;<span class="builtintype" id="5667806">string</span><span class="op" id="5667812">)</span>&nbsp;<span class="builtintype" id="5667814">string</span>&nbsp;<span class="op" id="5667821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667824">if</span>&nbsp;<span class="builtinfunc" id="5667827">len</span><span class="op" id="5667830">(</span><span class="ident" id="5667831">path</span><span class="op" id="5667835">)</span>&nbsp;<span class="op" id="5667837">==</span>&nbsp;<span class="num" id="5667840">0</span>&nbsp;<span class="op" id="5667842">||</span>&nbsp;<span class="ident" id="5667845">path</span><span class="op" id="5667849">[</span><span class="num" id="5667850">0</span><span class="op" id="5667851">]</span>&nbsp;<span class="op" id="5667853">!=</span>&nbsp;<span class="string" id="5667856">&#39;/&#39;</span>&nbsp;<span class="op" id="5667860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667864">return</span>&nbsp;<span class="string" id="5667871">&#34;/&#34;</span>&nbsp;<span class="comment" id="5667875">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667911">i</span>&nbsp;<span class="op" id="5667913">:=</span>&nbsp;<span class="ident" id="5667916">strings</span><span class="op" id="5667923">.</span><span class="ident" id="5667924">LastIndex</span><span class="op" id="5667933">(</span><span class="ident" id="5667934">path</span><span class="op" id="5667938">,</span>&nbsp;<span class="string" id="5667940">&#34;/&#34;</span><span class="op" id="5667943">)</span>&nbsp;<span class="comment" id="5667945">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667983">if</span>&nbsp;<span class="ident" id="5667986">i</span>&nbsp;<span class="op" id="5667988">==</span>&nbsp;<span class="num" id="5667991">0</span>&nbsp;<span class="op" id="5667993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667997">return</span>&nbsp;<span class="string" id="5668004">&#34;/&#34;</span>&nbsp;<span class="comment" id="5668008">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668041">return</span>&nbsp;<span class="ident" id="5668048">path</span><span class="op" id="5668052">[</span><span class="op" id="5668053">:</span><span class="ident" id="5668054">i</span><span class="op" id="5668055">]</span>&nbsp;<span class="comment" id="5668057">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="5668110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5668113">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="5668192">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5668273">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="5668349">//</span><br>
<span class="lineno"></span><span class="comment" id="5668352">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="5668431">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="5668510">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="5668581">//</span><br>
<span class="lineno"></span><span class="comment" id="5668584">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5668633">func</span>&nbsp;<span class="op" id="5668638">(</span><span class="ident" id="5668639">j</span>&nbsp;<span class="op" id="5668641">*</span><span class="ident" id="5668642">Jar</span><span class="op" id="5668645">)</span>&nbsp;<span class="ident" id="5668647">newEntry</span><span class="op" id="5668655">(</span><span class="ident" id="5668656">c</span>&nbsp;<span class="op" id="5668658">*</span><span class="ident" id="5668659">http</span><span class="op" id="5668663">.</span><span class="ident" id="5668664">Cookie</span><span class="op" id="5668670">,</span>&nbsp;<span class="ident" id="5668672">now</span>&nbsp;<span class="ident" id="5668676">time</span><span class="op" id="5668680">.</span><span class="ident" id="5668681">Time</span><span class="op" id="5668685">,</span>&nbsp;<span class="ident" id="5668687">defPath</span><span class="op" id="5668694">,</span>&nbsp;<span class="ident" id="5668696">host</span>&nbsp;<span class="builtintype" id="5668701">string</span><span class="op" id="5668707">)</span>&nbsp;<span class="op" id="5668709">(</span><span class="ident" id="5668710">e</span>&nbsp;<span class="ident" id="5668712">entry</span><span class="op" id="5668717">,</span>&nbsp;<span class="ident" id="5668719">remove</span>&nbsp;<span class="builtintype" id="5668726">bool</span><span class="op" id="5668730">,</span>&nbsp;<span class="ident" id="5668732">err</span>&nbsp;<span class="builtintype" id="5668736">error</span><span class="op" id="5668741">)</span>&nbsp;<span class="op" id="5668743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668746">e</span><span class="op" id="5668747">.</span><span class="ident" id="5668748">Name</span>&nbsp;<span class="op" id="5668753">=</span>&nbsp;<span class="ident" id="5668755">c</span><span class="op" id="5668756">.</span><span class="ident" id="5668757">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668764">if</span>&nbsp;<span class="ident" id="5668767">c</span><span class="op" id="5668768">.</span><span class="ident" id="5668769">Path</span>&nbsp;<span class="op" id="5668774">==</span>&nbsp;<span class="string" id="5668777">&#34;&#34;</span>&nbsp;<span class="op" id="5668780">||</span>&nbsp;<span class="ident" id="5668783">c</span><span class="op" id="5668784">.</span><span class="ident" id="5668785">Path</span><span class="op" id="5668789">[</span><span class="num" id="5668790">0</span><span class="op" id="5668791">]</span>&nbsp;<span class="op" id="5668793">!=</span>&nbsp;<span class="string" id="5668796">&#39;/&#39;</span>&nbsp;<span class="op" id="5668800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668804">e</span><span class="op" id="5668805">.</span><span class="ident" id="5668806">Path</span>&nbsp;<span class="op" id="5668811">=</span>&nbsp;<span class="ident" id="5668813">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668822">}</span>&nbsp;<span class="keyword" id="5668824">else</span>&nbsp;<span class="op" id="5668829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668833">e</span><span class="op" id="5668834">.</span><span class="ident" id="5668835">Path</span>&nbsp;<span class="op" id="5668840">=</span>&nbsp;<span class="ident" id="5668842">c</span><span class="op" id="5668843">.</span><span class="ident" id="5668844">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668854">e</span><span class="op" id="5668855">.</span><span class="ident" id="5668856">Domain</span><span class="op" id="5668862">,</span>&nbsp;<span class="ident" id="5668864">e</span><span class="op" id="5668865">.</span><span class="ident" id="5668866">HostOnly</span><span class="op" id="5668874">,</span>&nbsp;<span class="ident" id="5668876">err</span>&nbsp;<span class="op" id="5668880">=</span>&nbsp;<span class="ident" id="5668882">j</span><span class="op" id="5668883">.</span><span class="ident" id="5668884">domainAndType</span><span class="op" id="5668897">(</span><span class="ident" id="5668898">host</span><span class="op" id="5668902">,</span>&nbsp;<span class="ident" id="5668904">c</span><span class="op" id="5668905">.</span><span class="ident" id="5668906">Domain</span><span class="op" id="5668912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668915">if</span>&nbsp;<span class="ident" id="5668918">err</span>&nbsp;<span class="op" id="5668922">!=</span>&nbsp;<span class="ident" id="5668925">nil</span>&nbsp;<span class="op" id="5668929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668933">return</span>&nbsp;<span class="ident" id="5668940">e</span><span class="op" id="5668941">,</span>&nbsp;<span class="builtintype" id="5668943">false</span><span class="op" id="5668948">,</span>&nbsp;<span class="ident" id="5668950">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5668959">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669001">if</span>&nbsp;<span class="ident" id="5669004">c</span><span class="op" id="5669005">.</span><span class="ident" id="5669006">MaxAge</span>&nbsp;<span class="op" id="5669013">&lt;</span>&nbsp;<span class="num" id="5669015">0</span>&nbsp;<span class="op" id="5669017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669021">return</span>&nbsp;<span class="ident" id="5669028">e</span><span class="op" id="5669029">,</span>&nbsp;<span class="builtintype" id="5669031">true</span><span class="op" id="5669035">,</span>&nbsp;<span class="ident" id="5669037">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669042">}</span>&nbsp;<span class="keyword" id="5669044">else</span>&nbsp;<span class="keyword" id="5669049">if</span>&nbsp;<span class="ident" id="5669052">c</span><span class="op" id="5669053">.</span><span class="ident" id="5669054">MaxAge</span>&nbsp;<span class="op" id="5669061">&gt;</span>&nbsp;<span class="num" id="5669063">0</span>&nbsp;<span class="op" id="5669065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669069">e</span><span class="op" id="5669070">.</span><span class="ident" id="5669071">Expires</span>&nbsp;<span class="op" id="5669079">=</span>&nbsp;<span class="ident" id="5669081">now</span><span class="op" id="5669084">.</span><span class="ident" id="5669085">Add</span><span class="op" id="5669088">(</span><span class="ident" id="5669089">time</span><span class="op" id="5669093">.</span><span class="ident" id="5669094">Duration</span><span class="op" id="5669102">(</span><span class="ident" id="5669103">c</span><span class="op" id="5669104">.</span><span class="ident" id="5669105">MaxAge</span><span class="op" id="5669111">)</span>&nbsp;<span class="op" id="5669113">*</span>&nbsp;<span class="ident" id="5669115">time</span><span class="op" id="5669119">.</span><span class="ident" id="5669120">Second</span><span class="op" id="5669126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669130">e</span><span class="op" id="5669131">.</span><span class="ident" id="5669132">Persistent</span>&nbsp;<span class="op" id="5669143">=</span>&nbsp;<span class="builtintype" id="5669145">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669151">}</span>&nbsp;<span class="keyword" id="5669153">else</span>&nbsp;<span class="op" id="5669158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669162">if</span>&nbsp;<span class="ident" id="5669165">c</span><span class="op" id="5669166">.</span><span class="ident" id="5669167">Expires</span><span class="op" id="5669174">.</span><span class="ident" id="5669175">IsZero</span><span class="op" id="5669181">(</span><span class="op" id="5669182">)</span>&nbsp;<span class="op" id="5669184">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669189">e</span><span class="op" id="5669190">.</span><span class="ident" id="5669191">Expires</span>&nbsp;<span class="op" id="5669199">=</span>&nbsp;<span class="ident" id="5669201">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669214">e</span><span class="op" id="5669215">.</span><span class="ident" id="5669216">Persistent</span>&nbsp;<span class="op" id="5669227">=</span>&nbsp;<span class="builtintype" id="5669229">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669237">}</span>&nbsp;<span class="keyword" id="5669239">else</span>&nbsp;<span class="op" id="5669244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669249">if</span>&nbsp;<span class="op" id="5669252">!</span><span class="ident" id="5669253">c</span><span class="op" id="5669254">.</span><span class="ident" id="5669255">Expires</span><span class="op" id="5669262">.</span><span class="ident" id="5669263">After</span><span class="op" id="5669268">(</span><span class="ident" id="5669269">now</span><span class="op" id="5669272">)</span>&nbsp;<span class="op" id="5669274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669280">return</span>&nbsp;<span class="ident" id="5669287">e</span><span class="op" id="5669288">,</span>&nbsp;<span class="builtintype" id="5669290">true</span><span class="op" id="5669294">,</span>&nbsp;<span class="ident" id="5669296">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669308">e</span><span class="op" id="5669309">.</span><span class="ident" id="5669310">Expires</span>&nbsp;<span class="op" id="5669318">=</span>&nbsp;<span class="ident" id="5669320">c</span><span class="op" id="5669321">.</span><span class="ident" id="5669322">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669333">e</span><span class="op" id="5669334">.</span><span class="ident" id="5669335">Persistent</span>&nbsp;<span class="op" id="5669346">=</span>&nbsp;<span class="builtintype" id="5669348">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669358">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669362">e</span><span class="op" id="5669363">.</span><span class="ident" id="5669364">Value</span>&nbsp;<span class="op" id="5669370">=</span>&nbsp;<span class="ident" id="5669372">c</span><span class="op" id="5669373">.</span><span class="ident" id="5669374">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669381">e</span><span class="op" id="5669382">.</span><span class="ident" id="5669383">Secure</span>&nbsp;<span class="op" id="5669390">=</span>&nbsp;<span class="ident" id="5669392">c</span><span class="op" id="5669393">.</span><span class="ident" id="5669394">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669402">e</span><span class="op" id="5669403">.</span><span class="ident" id="5669404">HttpOnly</span>&nbsp;<span class="op" id="5669413">=</span>&nbsp;<span class="ident" id="5669415">c</span><span class="op" id="5669416">.</span><span class="ident" id="5669417">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669428">return</span>&nbsp;<span class="ident" id="5669435">e</span><span class="op" id="5669436">,</span>&nbsp;<span class="builtintype" id="5669438">false</span><span class="op" id="5669443">,</span>&nbsp;<span class="ident" id="5669445">nil</span><br>
<span class="lineno"></span><span class="op" id="5669449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5669452">var</span>&nbsp;<span class="op" id="5669456">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669459">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5669478">=</span>&nbsp;<span class="ident" id="5669480">errors</span><span class="op" id="5669486">.</span><span class="ident" id="5669487">New</span><span class="op" id="5669490">(</span><span class="string" id="5669491">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5669535">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669538">errMalformedDomain</span>&nbsp;<span class="op" id="5669557">=</span>&nbsp;<span class="ident" id="5669559">errors</span><span class="op" id="5669565">.</span><span class="ident" id="5669566">New</span><span class="op" id="5669569">(</span><span class="string" id="5669570">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5669616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669619">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5669638">=</span>&nbsp;<span class="ident" id="5669640">errors</span><span class="op" id="5669646">.</span><span class="ident" id="5669647">New</span><span class="op" id="5669650">(</span><span class="string" id="5669651">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="5669696">)</span><br>
<span class="lineno"></span><span class="op" id="5669698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5669701">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="5669772">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="5669841">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="5669900">var</span>&nbsp;<span class="ident" id="5669904">endOfTime</span>&nbsp;<span class="op" id="5669914">=</span>&nbsp;<span class="ident" id="5669916">time</span><span class="op" id="5669920">.</span><span class="ident" id="5669921">Date</span><span class="op" id="5669925">(</span><span class="num" id="5669926">9999</span><span class="op" id="5669930">,</span>&nbsp;<span class="num" id="5669932">12</span><span class="op" id="5669934">,</span>&nbsp;<span class="num" id="5669936">31</span><span class="op" id="5669938">,</span>&nbsp;<span class="num" id="5669940">23</span><span class="op" id="5669942">,</span>&nbsp;<span class="num" id="5669944">59</span><span class="op" id="5669946">,</span>&nbsp;<span class="num" id="5669948">59</span><span class="op" id="5669950">,</span>&nbsp;<span class="num" id="5669952">0</span><span class="op" id="5669953">,</span>&nbsp;<span class="ident" id="5669955">time</span><span class="op" id="5669959">.</span><span class="ident" id="5669960">UTC</span><span class="op" id="5669963">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5669966">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="5670038">func</span>&nbsp;<span class="op" id="5670043">(</span><span class="ident" id="5670044">j</span>&nbsp;<span class="op" id="5670046">*</span><span class="ident" id="5670047">Jar</span><span class="op" id="5670050">)</span>&nbsp;<span class="ident" id="5670052">domainAndType</span><span class="op" id="5670065">(</span><span class="ident" id="5670066">host</span><span class="op" id="5670070">,</span>&nbsp;<span class="ident" id="5670072">domain</span>&nbsp;<span class="builtintype" id="5670079">string</span><span class="op" id="5670085">)</span>&nbsp;<span class="op" id="5670087">(</span><span class="builtintype" id="5670088">string</span><span class="op" id="5670094">,</span>&nbsp;<span class="builtintype" id="5670096">bool</span><span class="op" id="5670100">,</span>&nbsp;<span class="builtintype" id="5670102">error</span><span class="op" id="5670107">)</span>&nbsp;<span class="op" id="5670109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670112">if</span>&nbsp;<span class="ident" id="5670115">domain</span>&nbsp;<span class="op" id="5670122">==</span>&nbsp;<span class="string" id="5670125">&#34;&#34;</span>&nbsp;<span class="op" id="5670128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670132">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670193">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670211">return</span>&nbsp;<span class="ident" id="5670218">host</span><span class="op" id="5670222">,</span>&nbsp;<span class="builtintype" id="5670224">true</span><span class="op" id="5670228">,</span>&nbsp;<span class="ident" id="5670230">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670239">if</span>&nbsp;<span class="ident" id="5670242">isIP</span><span class="op" id="5670246">(</span><span class="ident" id="5670247">host</span><span class="op" id="5670251">)</span>&nbsp;<span class="op" id="5670253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670257">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670319">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670339">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670395">return</span>&nbsp;<span class="string" id="5670402">&#34;&#34;</span><span class="op" id="5670404">,</span>&nbsp;<span class="builtintype" id="5670406">false</span><span class="op" id="5670411">,</span>&nbsp;<span class="ident" id="5670413">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670432">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670502">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670551">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670583">if</span>&nbsp;<span class="ident" id="5670586">domain</span><span class="op" id="5670592">[</span><span class="num" id="5670593">0</span><span class="op" id="5670594">]</span>&nbsp;<span class="op" id="5670596">==</span>&nbsp;<span class="string" id="5670599">&#39;.&#39;</span>&nbsp;<span class="op" id="5670603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670607">domain</span>&nbsp;<span class="op" id="5670614">=</span>&nbsp;<span class="ident" id="5670616">domain</span><span class="op" id="5670622">[</span><span class="num" id="5670623">1</span><span class="op" id="5670624">:</span><span class="op" id="5670625">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670628">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670632">if</span>&nbsp;<span class="builtinfunc" id="5670635">len</span><span class="op" id="5670638">(</span><span class="ident" id="5670639">domain</span><span class="op" id="5670645">)</span>&nbsp;<span class="op" id="5670647">==</span>&nbsp;<span class="num" id="5670650">0</span>&nbsp;<span class="op" id="5670652">||</span>&nbsp;<span class="ident" id="5670655">domain</span><span class="op" id="5670661">[</span><span class="num" id="5670662">0</span><span class="op" id="5670663">]</span>&nbsp;<span class="op" id="5670665">==</span>&nbsp;<span class="string" id="5670668">&#39;.&#39;</span>&nbsp;<span class="op" id="5670672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670676">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670734">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670757">return</span>&nbsp;<span class="string" id="5670764">&#34;&#34;</span><span class="op" id="5670766">,</span>&nbsp;<span class="builtintype" id="5670768">false</span><span class="op" id="5670773">,</span>&nbsp;<span class="ident" id="5670775">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670798">domain</span>&nbsp;<span class="op" id="5670805">=</span>&nbsp;<span class="ident" id="5670807">strings</span><span class="op" id="5670814">.</span><span class="ident" id="5670815">ToLower</span><span class="op" id="5670822">(</span><span class="ident" id="5670823">domain</span><span class="op" id="5670829">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670833">if</span>&nbsp;<span class="ident" id="5670836">domain</span><span class="op" id="5670842">[</span><span class="builtinfunc" id="5670843">len</span><span class="op" id="5670846">(</span><span class="ident" id="5670847">domain</span><span class="op" id="5670853">)</span><span class="op" id="5670854">-</span><span class="num" id="5670855">1</span><span class="op" id="5670856">]</span>&nbsp;<span class="op" id="5670858">==</span>&nbsp;<span class="string" id="5670861">&#39;.&#39;</span>&nbsp;<span class="op" id="5670865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670869">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670924">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670986">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671049">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671105">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671167">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671185">return</span>&nbsp;<span class="string" id="5671192">&#34;&#34;</span><span class="op" id="5671194">,</span>&nbsp;<span class="builtintype" id="5671196">false</span><span class="op" id="5671201">,</span>&nbsp;<span class="ident" id="5671203">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671227">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671260">if</span>&nbsp;<span class="ident" id="5671263">j</span><span class="op" id="5671264">.</span><span class="ident" id="5671265">psList</span>&nbsp;<span class="op" id="5671272">!=</span>&nbsp;<span class="ident" id="5671275">nil</span>&nbsp;<span class="op" id="5671279">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671283">if</span>&nbsp;<span class="ident" id="5671286">ps</span>&nbsp;<span class="op" id="5671289">:=</span>&nbsp;<span class="ident" id="5671292">j</span><span class="op" id="5671293">.</span><span class="ident" id="5671294">psList</span><span class="op" id="5671300">.</span><span class="ident" id="5671301">PublicSuffix</span><span class="op" id="5671313">(</span><span class="ident" id="5671314">domain</span><span class="op" id="5671320">)</span><span class="op" id="5671321">;</span>&nbsp;<span class="ident" id="5671323">ps</span>&nbsp;<span class="op" id="5671326">!=</span>&nbsp;<span class="string" id="5671329">&#34;&#34;</span>&nbsp;<span class="op" id="5671332">&amp;&amp;</span>&nbsp;<span class="op" id="5671335">!</span><span class="ident" id="5671336">hasDotSuffix</span><span class="op" id="5671348">(</span><span class="ident" id="5671349">domain</span><span class="op" id="5671355">,</span>&nbsp;<span class="ident" id="5671357">ps</span><span class="op" id="5671359">)</span>&nbsp;<span class="op" id="5671361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671366">if</span>&nbsp;<span class="ident" id="5671369">host</span>&nbsp;<span class="op" id="5671374">==</span>&nbsp;<span class="ident" id="5671377">domain</span>&nbsp;<span class="op" id="5671384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671390">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671441">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671490">return</span>&nbsp;<span class="ident" id="5671497">host</span><span class="op" id="5671501">,</span>&nbsp;<span class="builtintype" id="5671503">true</span><span class="op" id="5671507">,</span>&nbsp;<span class="ident" id="5671509">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671521">return</span>&nbsp;<span class="string" id="5671528">&#34;&#34;</span><span class="op" id="5671530">,</span>&nbsp;<span class="builtintype" id="5671532">false</span><span class="op" id="5671537">,</span>&nbsp;<span class="ident" id="5671539">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671565">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671629">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671670">if</span>&nbsp;<span class="ident" id="5671673">host</span>&nbsp;<span class="op" id="5671678">!=</span>&nbsp;<span class="ident" id="5671681">domain</span>&nbsp;<span class="op" id="5671688">&amp;&amp;</span>&nbsp;<span class="op" id="5671691">!</span><span class="ident" id="5671692">hasDotSuffix</span><span class="op" id="5671704">(</span><span class="ident" id="5671705">host</span><span class="op" id="5671709">,</span>&nbsp;<span class="ident" id="5671711">domain</span><span class="op" id="5671717">)</span>&nbsp;<span class="op" id="5671719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671723">return</span>&nbsp;<span class="string" id="5671730">&#34;&#34;</span><span class="op" id="5671732">,</span>&nbsp;<span class="builtintype" id="5671734">false</span><span class="op" id="5671739">,</span>&nbsp;<span class="ident" id="5671741">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671759">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671763">return</span>&nbsp;<span class="ident" id="5671770">domain</span><span class="op" id="5671776">,</span>&nbsp;<span class="builtintype" id="5671778">false</span><span class="op" id="5671783">,</span>&nbsp;<span class="ident" id="5671785">nil</span><br>
<span class="lineno"></span><span class="op" id="5671789">}</span>
</div>
</body>
</html>
