<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html" class="current">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5621660">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5621715">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5621769">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5621820">package</span>&nbsp;<span class="ident" id="5621828">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5621835">import</span>&nbsp;<span class="op" id="5621842">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5621845">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5621859">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5621862">//&nbsp;YCbCrSubsampleRatio&nbsp;is&nbsp;the&nbsp;chroma&nbsp;subsample&nbsp;ratio&nbsp;used&nbsp;in&nbsp;a&nbsp;YCbCr&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5621938">type</span>&nbsp;<span class="ident" id="5621943">YCbCrSubsampleRatio</span>&nbsp;<span class="builtintype" id="5621963">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5621968">const</span>&nbsp;<span class="op" id="5621974">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5621977">YCbCrSubsampleRatio444</span>&nbsp;<span class="ident" id="5622000">YCbCrSubsampleRatio</span>&nbsp;<span class="op" id="5622020">=</span>&nbsp;<span class="ident" id="5622022">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622028">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622052">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5622076">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span><span class="op" id="5622099">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5622102">func</span>&nbsp;<span class="op" id="5622107">(</span><span class="ident" id="5622108">s</span>&nbsp;<span class="ident" id="5622110">YCbCrSubsampleRatio</span><span class="op" id="5622129">)</span>&nbsp;<span class="ident" id="5622131">String</span><span class="op" id="5622137">(</span><span class="op" id="5622138">)</span>&nbsp;<span class="builtintype" id="5622140">string</span>&nbsp;<span class="op" id="5622147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622150">switch</span>&nbsp;<span class="ident" id="5622157">s</span>&nbsp;<span class="op" id="5622159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622162">case</span>&nbsp;<span class="ident" id="5622167">YCbCrSubsampleRatio444</span><span class="op" id="5622189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622193">return</span>&nbsp;<span class="string" id="5622200">&#34;YCbCrSubsampleRatio444&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622226">case</span>&nbsp;<span class="ident" id="5622231">YCbCrSubsampleRatio422</span><span class="op" id="5622253">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622257">return</span>&nbsp;<span class="string" id="5622264">&#34;YCbCrSubsampleRatio422&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622290">case</span>&nbsp;<span class="ident" id="5622295">YCbCrSubsampleRatio420</span><span class="op" id="5622317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622321">return</span>&nbsp;<span class="string" id="5622328">&#34;YCbCrSubsampleRatio420&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622354">case</span>&nbsp;<span class="ident" id="5622359">YCbCrSubsampleRatio440</span><span class="op" id="5622381">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622385">return</span>&nbsp;<span class="string" id="5622392">&#34;YCbCrSubsampleRatio440&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5622418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5622421">return</span>&nbsp;<span class="string" id="5622428">&#34;YCbCrSubsampleRatioUnknown&#34;</span><br>
<span class="lineno"></span><span class="op" id="5622457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5622460">//&nbsp;YCbCr&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;Y&#39;CbCr&nbsp;colors.&nbsp;There&nbsp;is&nbsp;one&nbsp;Y&nbsp;sample&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="5622535">//&nbsp;pixel,&nbsp;but&nbsp;each&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;sample&nbsp;can&nbsp;span&nbsp;one&nbsp;or&nbsp;more&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="5622600">//&nbsp;YStride&nbsp;is&nbsp;the&nbsp;Y&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="5622674">//&nbsp;CStride&nbsp;is&nbsp;the&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels</span><br>
<span class="lineno"></span><span class="comment" id="5622755">//&nbsp;that&nbsp;map&nbsp;to&nbsp;separate&nbsp;chroma&nbsp;samples.</span><br>
<span class="lineno">40</span><span class="comment" id="5622795">//&nbsp;It&nbsp;is&nbsp;not&nbsp;an&nbsp;absolute&nbsp;requirement,&nbsp;but&nbsp;YStride&nbsp;and&nbsp;len(Y)&nbsp;are&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="5622870">//&nbsp;multiples&nbsp;of&nbsp;8,&nbsp;and:</span><br>
<span class="lineno"></span><span class="comment" id="5622894">//&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;4:4:4,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/1.</span><br>
<span class="lineno"></span><span class="comment" id="5622964">//&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;4:2:2,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="comment" id="5623034">//&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;4:2:0,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/4.</span><br>
<span class="lineno">45</span><span class="comment" id="5623104">//&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;4:4:0,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="keyword" id="5623174">type</span>&nbsp;<span class="ident" id="5623179">YCbCr</span>&nbsp;<span class="keyword" id="5623185">struct</span>&nbsp;<span class="op" id="5623192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623195">Y</span><span class="op" id="5623196">,</span>&nbsp;<span class="ident" id="5623198">Cb</span><span class="op" id="5623200">,</span>&nbsp;<span class="ident" id="5623202">Cr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5623210">[</span><span class="op" id="5623211">]</span><span class="builtintype" id="5623212">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623219">YStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5623234">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623239">CStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5623254">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623259">SubsampleRatio</span>&nbsp;<span class="ident" id="5623274">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623295">Rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623310">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5623320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5623323">func</span>&nbsp;<span class="op" id="5623328">(</span><span class="ident" id="5623329">p</span>&nbsp;<span class="op" id="5623331">*</span><span class="ident" id="5623332">YCbCr</span><span class="op" id="5623337">)</span>&nbsp;<span class="ident" id="5623339">ColorModel</span><span class="op" id="5623349">(</span><span class="op" id="5623350">)</span>&nbsp;<span class="ident" id="5623352">color</span><span class="op" id="5623357">.</span><span class="ident" id="5623358">Model</span>&nbsp;<span class="op" id="5623364">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5623367">return</span>&nbsp;<span class="ident" id="5623374">color</span><span class="op" id="5623379">.</span><span class="ident" id="5623380">YCbCrModel</span><br>
<span class="lineno"></span><span class="op" id="5623391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5623394">func</span>&nbsp;<span class="op" id="5623399">(</span><span class="ident" id="5623400">p</span>&nbsp;<span class="op" id="5623402">*</span><span class="ident" id="5623403">YCbCr</span><span class="op" id="5623408">)</span>&nbsp;<span class="ident" id="5623410">Bounds</span><span class="op" id="5623416">(</span><span class="op" id="5623417">)</span>&nbsp;<span class="ident" id="5623419">Rectangle</span>&nbsp;<span class="op" id="5623429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5623432">return</span>&nbsp;<span class="ident" id="5623439">p</span><span class="op" id="5623440">.</span><span class="ident" id="5623441">Rect</span><br>
<span class="lineno">60</span><span class="op" id="5623446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5623449">func</span>&nbsp;<span class="op" id="5623454">(</span><span class="ident" id="5623455">p</span>&nbsp;<span class="op" id="5623457">*</span><span class="ident" id="5623458">YCbCr</span><span class="op" id="5623463">)</span>&nbsp;<span class="ident" id="5623465">At</span><span class="op" id="5623467">(</span><span class="ident" id="5623468">x</span><span class="op" id="5623469">,</span>&nbsp;<span class="ident" id="5623471">y</span>&nbsp;<span class="builtintype" id="5623473">int</span><span class="op" id="5623476">)</span>&nbsp;<span class="ident" id="5623478">color</span><span class="op" id="5623483">.</span><span class="ident" id="5623484">Color</span>&nbsp;<span class="op" id="5623490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5623493">return</span>&nbsp;<span class="ident" id="5623500">p</span><span class="op" id="5623501">.</span><span class="ident" id="5623502">YCbCrAt</span><span class="op" id="5623509">(</span><span class="ident" id="5623510">x</span><span class="op" id="5623511">,</span>&nbsp;<span class="ident" id="5623513">y</span><span class="op" id="5623514">)</span><br>
<span class="lineno"></span><span class="op" id="5623516">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="5623519">func</span>&nbsp;<span class="op" id="5623524">(</span><span class="ident" id="5623525">p</span>&nbsp;<span class="op" id="5623527">*</span><span class="ident" id="5623528">YCbCr</span><span class="op" id="5623533">)</span>&nbsp;<span class="ident" id="5623535">YCbCrAt</span><span class="op" id="5623542">(</span><span class="ident" id="5623543">x</span><span class="op" id="5623544">,</span>&nbsp;<span class="ident" id="5623546">y</span>&nbsp;<span class="builtintype" id="5623548">int</span><span class="op" id="5623551">)</span>&nbsp;<span class="ident" id="5623553">color</span><span class="op" id="5623558">.</span><span class="ident" id="5623559">YCbCr</span>&nbsp;<span class="op" id="5623565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5623568">if</span>&nbsp;<span class="op" id="5623571">!</span><span class="op" id="5623572">(</span><span class="ident" id="5623573">Point</span><span class="op" id="5623578">{</span><span class="ident" id="5623579">x</span><span class="op" id="5623580">,</span>&nbsp;<span class="ident" id="5623582">y</span><span class="op" id="5623583">}</span><span class="op" id="5623584">.</span><span class="ident" id="5623585">In</span><span class="op" id="5623587">(</span><span class="ident" id="5623588">p</span><span class="op" id="5623589">.</span><span class="ident" id="5623590">Rect</span><span class="op" id="5623594">)</span><span class="op" id="5623595">)</span>&nbsp;<span class="op" id="5623597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5623601">return</span>&nbsp;<span class="ident" id="5623608">color</span><span class="op" id="5623613">.</span><span class="ident" id="5623614">YCbCr</span><span class="op" id="5623619">{</span><span class="op" id="5623620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5623623">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623626">yi</span>&nbsp;<span class="op" id="5623629">:=</span>&nbsp;<span class="ident" id="5623632">p</span><span class="op" id="5623633">.</span><span class="ident" id="5623634">YOffset</span><span class="op" id="5623641">(</span><span class="ident" id="5623642">x</span><span class="op" id="5623643">,</span>&nbsp;<span class="ident" id="5623645">y</span><span class="op" id="5623646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623649">ci</span>&nbsp;<span class="op" id="5623652">:=</span>&nbsp;<span class="ident" id="5623655">p</span><span class="op" id="5623656">.</span><span class="ident" id="5623657">COffset</span><span class="op" id="5623664">(</span><span class="ident" id="5623665">x</span><span class="op" id="5623666">,</span>&nbsp;<span class="ident" id="5623668">y</span><span class="op" id="5623669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5623672">return</span>&nbsp;<span class="ident" id="5623679">color</span><span class="op" id="5623684">.</span><span class="ident" id="5623685">YCbCr</span><span class="op" id="5623690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623694">p</span><span class="op" id="5623695">.</span><span class="ident" id="5623696">Y</span><span class="op" id="5623697">[</span><span class="ident" id="5623698">yi</span><span class="op" id="5623700">]</span><span class="op" id="5623701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623705">p</span><span class="op" id="5623706">.</span><span class="ident" id="5623707">Cb</span><span class="op" id="5623709">[</span><span class="ident" id="5623710">ci</span><span class="op" id="5623712">]</span><span class="op" id="5623713">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5623717">p</span><span class="op" id="5623718">.</span><span class="ident" id="5623719">Cr</span><span class="op" id="5623721">[</span><span class="ident" id="5623722">ci</span><span class="op" id="5623724">]</span><span class="op" id="5623725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5623728">}</span><br>
<span class="lineno"></span><span class="op" id="5623730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5623733">//&nbsp;YOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Y&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">80</span><span class="comment" id="5623808">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5623832">func</span>&nbsp;<span class="op" id="5623837">(</span><span class="ident" id="5623838">p</span>&nbsp;<span class="op" id="5623840">*</span><span class="ident" id="5623841">YCbCr</span><span class="op" id="5623846">)</span>&nbsp;<span class="ident" id="5623848">YOffset</span><span class="op" id="5623855">(</span><span class="ident" id="5623856">x</span><span class="op" id="5623857">,</span>&nbsp;<span class="ident" id="5623859">y</span>&nbsp;<span class="builtintype" id="5623861">int</span><span class="op" id="5623864">)</span>&nbsp;<span class="builtintype" id="5623866">int</span>&nbsp;<span class="op" id="5623870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5623873">return</span>&nbsp;<span class="op" id="5623880">(</span><span class="ident" id="5623881">y</span><span class="op" id="5623882">-</span><span class="ident" id="5623883">p</span><span class="op" id="5623884">.</span><span class="ident" id="5623885">Rect</span><span class="op" id="5623889">.</span><span class="ident" id="5623890">Min</span><span class="op" id="5623893">.</span><span class="ident" id="5623894">Y</span><span class="op" id="5623895">)</span><span class="op" id="5623896">*</span><span class="ident" id="5623897">p</span><span class="op" id="5623898">.</span><span class="ident" id="5623899">YStride</span>&nbsp;<span class="op" id="5623907">+</span>&nbsp;<span class="op" id="5623909">(</span><span class="ident" id="5623910">x</span>&nbsp;<span class="op" id="5623912">-</span>&nbsp;<span class="ident" id="5623914">p</span><span class="op" id="5623915">.</span><span class="ident" id="5623916">Rect</span><span class="op" id="5623920">.</span><span class="ident" id="5623921">Min</span><span class="op" id="5623924">.</span><span class="ident" id="5623925">X</span><span class="op" id="5623926">)</span><br>
<span class="lineno"></span><span class="op" id="5623928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5623931">//&nbsp;COffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Cb&nbsp;or&nbsp;Cr&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="5624010">//&nbsp;to&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5624037">func</span>&nbsp;<span class="op" id="5624042">(</span><span class="ident" id="5624043">p</span>&nbsp;<span class="op" id="5624045">*</span><span class="ident" id="5624046">YCbCr</span><span class="op" id="5624051">)</span>&nbsp;<span class="ident" id="5624053">COffset</span><span class="op" id="5624060">(</span><span class="ident" id="5624061">x</span><span class="op" id="5624062">,</span>&nbsp;<span class="ident" id="5624064">y</span>&nbsp;<span class="builtintype" id="5624066">int</span><span class="op" id="5624069">)</span>&nbsp;<span class="builtintype" id="5624071">int</span>&nbsp;<span class="op" id="5624075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624078">switch</span>&nbsp;<span class="ident" id="5624085">p</span><span class="op" id="5624086">.</span><span class="ident" id="5624087">SubsampleRatio</span>&nbsp;<span class="op" id="5624102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624105">case</span>&nbsp;<span class="ident" id="5624110">YCbCrSubsampleRatio422</span><span class="op" id="5624132">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624136">return</span>&nbsp;<span class="op" id="5624143">(</span><span class="ident" id="5624144">y</span><span class="op" id="5624145">-</span><span class="ident" id="5624146">p</span><span class="op" id="5624147">.</span><span class="ident" id="5624148">Rect</span><span class="op" id="5624152">.</span><span class="ident" id="5624153">Min</span><span class="op" id="5624156">.</span><span class="ident" id="5624157">Y</span><span class="op" id="5624158">)</span><span class="op" id="5624159">*</span><span class="ident" id="5624160">p</span><span class="op" id="5624161">.</span><span class="ident" id="5624162">CStride</span>&nbsp;<span class="op" id="5624170">+</span>&nbsp;<span class="op" id="5624172">(</span><span class="ident" id="5624173">x</span><span class="op" id="5624174">/</span><span class="num" id="5624175">2</span>&nbsp;<span class="op" id="5624177">-</span>&nbsp;<span class="ident" id="5624179">p</span><span class="op" id="5624180">.</span><span class="ident" id="5624181">Rect</span><span class="op" id="5624185">.</span><span class="ident" id="5624186">Min</span><span class="op" id="5624189">.</span><span class="ident" id="5624190">X</span><span class="op" id="5624191">/</span><span class="num" id="5624192">2</span><span class="op" id="5624193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624196">case</span>&nbsp;<span class="ident" id="5624201">YCbCrSubsampleRatio420</span><span class="op" id="5624223">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624227">return</span>&nbsp;<span class="op" id="5624234">(</span><span class="ident" id="5624235">y</span><span class="op" id="5624236">/</span><span class="num" id="5624237">2</span><span class="op" id="5624238">-</span><span class="ident" id="5624239">p</span><span class="op" id="5624240">.</span><span class="ident" id="5624241">Rect</span><span class="op" id="5624245">.</span><span class="ident" id="5624246">Min</span><span class="op" id="5624249">.</span><span class="ident" id="5624250">Y</span><span class="op" id="5624251">/</span><span class="num" id="5624252">2</span><span class="op" id="5624253">)</span><span class="op" id="5624254">*</span><span class="ident" id="5624255">p</span><span class="op" id="5624256">.</span><span class="ident" id="5624257">CStride</span>&nbsp;<span class="op" id="5624265">+</span>&nbsp;<span class="op" id="5624267">(</span><span class="ident" id="5624268">x</span><span class="op" id="5624269">/</span><span class="num" id="5624270">2</span>&nbsp;<span class="op" id="5624272">-</span>&nbsp;<span class="ident" id="5624274">p</span><span class="op" id="5624275">.</span><span class="ident" id="5624276">Rect</span><span class="op" id="5624280">.</span><span class="ident" id="5624281">Min</span><span class="op" id="5624284">.</span><span class="ident" id="5624285">X</span><span class="op" id="5624286">/</span><span class="num" id="5624287">2</span><span class="op" id="5624288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624291">case</span>&nbsp;<span class="ident" id="5624296">YCbCrSubsampleRatio440</span><span class="op" id="5624318">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624322">return</span>&nbsp;<span class="op" id="5624329">(</span><span class="ident" id="5624330">y</span><span class="op" id="5624331">/</span><span class="num" id="5624332">2</span><span class="op" id="5624333">-</span><span class="ident" id="5624334">p</span><span class="op" id="5624335">.</span><span class="ident" id="5624336">Rect</span><span class="op" id="5624340">.</span><span class="ident" id="5624341">Min</span><span class="op" id="5624344">.</span><span class="ident" id="5624345">Y</span><span class="op" id="5624346">/</span><span class="num" id="5624347">2</span><span class="op" id="5624348">)</span><span class="op" id="5624349">*</span><span class="ident" id="5624350">p</span><span class="op" id="5624351">.</span><span class="ident" id="5624352">CStride</span>&nbsp;<span class="op" id="5624360">+</span>&nbsp;<span class="op" id="5624362">(</span><span class="ident" id="5624363">x</span>&nbsp;<span class="op" id="5624365">-</span>&nbsp;<span class="ident" id="5624367">p</span><span class="op" id="5624368">.</span><span class="ident" id="5624369">Rect</span><span class="op" id="5624373">.</span><span class="ident" id="5624374">Min</span><span class="op" id="5624377">.</span><span class="ident" id="5624378">X</span><span class="op" id="5624379">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624385">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624419">return</span>&nbsp;<span class="op" id="5624426">(</span><span class="ident" id="5624427">y</span><span class="op" id="5624428">-</span><span class="ident" id="5624429">p</span><span class="op" id="5624430">.</span><span class="ident" id="5624431">Rect</span><span class="op" id="5624435">.</span><span class="ident" id="5624436">Min</span><span class="op" id="5624439">.</span><span class="ident" id="5624440">Y</span><span class="op" id="5624441">)</span><span class="op" id="5624442">*</span><span class="ident" id="5624443">p</span><span class="op" id="5624444">.</span><span class="ident" id="5624445">CStride</span>&nbsp;<span class="op" id="5624453">+</span>&nbsp;<span class="op" id="5624455">(</span><span class="ident" id="5624456">x</span>&nbsp;<span class="op" id="5624458">-</span>&nbsp;<span class="ident" id="5624460">p</span><span class="op" id="5624461">.</span><span class="ident" id="5624462">Rect</span><span class="op" id="5624466">.</span><span class="ident" id="5624467">Min</span><span class="op" id="5624470">.</span><span class="ident" id="5624471">X</span><span class="op" id="5624472">)</span><br>
<span class="lineno"></span><span class="op" id="5624474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5624477">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5624554">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5624626">func</span>&nbsp;<span class="op" id="5624631">(</span><span class="ident" id="5624632">p</span>&nbsp;<span class="op" id="5624634">*</span><span class="ident" id="5624635">YCbCr</span><span class="op" id="5624640">)</span>&nbsp;<span class="ident" id="5624642">SubImage</span><span class="op" id="5624650">(</span><span class="ident" id="5624651">r</span>&nbsp;<span class="ident" id="5624653">Rectangle</span><span class="op" id="5624662">)</span>&nbsp;<span class="ident" id="5624664">Image</span>&nbsp;<span class="op" id="5624670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624673">r</span>&nbsp;<span class="op" id="5624675">=</span>&nbsp;<span class="ident" id="5624677">r</span><span class="op" id="5624678">.</span><span class="ident" id="5624679">Intersect</span><span class="op" id="5624688">(</span><span class="ident" id="5624689">p</span><span class="op" id="5624690">.</span><span class="ident" id="5624691">Rect</span><span class="op" id="5624695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624698">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624779">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624861">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624911">if</span>&nbsp;<span class="ident" id="5624914">r</span><span class="op" id="5624915">.</span><span class="ident" id="5624916">Empty</span><span class="op" id="5624921">(</span><span class="op" id="5624922">)</span>&nbsp;<span class="op" id="5624924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5624928">return</span>&nbsp;<span class="op" id="5624935">&amp;</span><span class="ident" id="5624936">YCbCr</span><span class="op" id="5624941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624946">SubsampleRatio</span><span class="op" id="5624960">:</span>&nbsp;<span class="ident" id="5624962">p</span><span class="op" id="5624963">.</span><span class="ident" id="5624964">SubsampleRatio</span><span class="op" id="5624978">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5624988">yi</span>&nbsp;<span class="op" id="5624991">:=</span>&nbsp;<span class="ident" id="5624994">p</span><span class="op" id="5624995">.</span><span class="ident" id="5624996">YOffset</span><span class="op" id="5625003">(</span><span class="ident" id="5625004">r</span><span class="op" id="5625005">.</span><span class="ident" id="5625006">Min</span><span class="op" id="5625009">.</span><span class="ident" id="5625010">X</span><span class="op" id="5625011">,</span>&nbsp;<span class="ident" id="5625013">r</span><span class="op" id="5625014">.</span><span class="ident" id="5625015">Min</span><span class="op" id="5625018">.</span><span class="ident" id="5625019">Y</span><span class="op" id="5625020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625023">ci</span>&nbsp;<span class="op" id="5625026">:=</span>&nbsp;<span class="ident" id="5625029">p</span><span class="op" id="5625030">.</span><span class="ident" id="5625031">COffset</span><span class="op" id="5625038">(</span><span class="ident" id="5625039">r</span><span class="op" id="5625040">.</span><span class="ident" id="5625041">Min</span><span class="op" id="5625044">.</span><span class="ident" id="5625045">X</span><span class="op" id="5625046">,</span>&nbsp;<span class="ident" id="5625048">r</span><span class="op" id="5625049">.</span><span class="ident" id="5625050">Min</span><span class="op" id="5625053">.</span><span class="ident" id="5625054">Y</span><span class="op" id="5625055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5625058">return</span>&nbsp;<span class="op" id="5625065">&amp;</span><span class="ident" id="5625066">YCbCr</span><span class="op" id="5625071">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625075">Y</span><span class="op" id="5625076">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625091">p</span><span class="op" id="5625092">.</span><span class="ident" id="5625093">Y</span><span class="op" id="5625094">[</span><span class="ident" id="5625095">yi</span><span class="op" id="5625097">:</span><span class="op" id="5625098">]</span><span class="op" id="5625099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625103">Cb</span><span class="op" id="5625105">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625119">p</span><span class="op" id="5625120">.</span><span class="ident" id="5625121">Cb</span><span class="op" id="5625123">[</span><span class="ident" id="5625124">ci</span><span class="op" id="5625126">:</span><span class="op" id="5625127">]</span><span class="op" id="5625128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625132">Cr</span><span class="op" id="5625134">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625148">p</span><span class="op" id="5625149">.</span><span class="ident" id="5625150">Cr</span><span class="op" id="5625152">[</span><span class="ident" id="5625153">ci</span><span class="op" id="5625155">:</span><span class="op" id="5625156">]</span><span class="op" id="5625157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625161">SubsampleRatio</span><span class="op" id="5625175">:</span>&nbsp;<span class="ident" id="5625177">p</span><span class="op" id="5625178">.</span><span class="ident" id="5625179">SubsampleRatio</span><span class="op" id="5625193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625197">YStride</span><span class="op" id="5625204">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625213">p</span><span class="op" id="5625214">.</span><span class="ident" id="5625215">YStride</span><span class="op" id="5625222">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625226">CStride</span><span class="op" id="5625233">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625242">p</span><span class="op" id="5625243">.</span><span class="ident" id="5625244">CStride</span><span class="op" id="5625251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625255">Rect</span><span class="op" id="5625259">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625271">r</span><span class="op" id="5625272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5625275">}</span><br>
<span class="lineno"></span><span class="op" id="5625277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5625280">func</span>&nbsp;<span class="op" id="5625285">(</span><span class="ident" id="5625286">p</span>&nbsp;<span class="op" id="5625288">*</span><span class="ident" id="5625289">YCbCr</span><span class="op" id="5625294">)</span>&nbsp;<span class="ident" id="5625296">Opaque</span><span class="op" id="5625302">(</span><span class="op" id="5625303">)</span>&nbsp;<span class="builtintype" id="5625305">bool</span>&nbsp;<span class="op" id="5625310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5625313">return</span>&nbsp;<span class="builtintype" id="5625320">true</span><br>
<span class="lineno"></span><span class="op" id="5625325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5625328">//&nbsp;NewYCbCr&nbsp;returns&nbsp;a&nbsp;new&nbsp;YCbCr&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds&nbsp;and&nbsp;subsample&nbsp;ratio.</span><br>
<span class="lineno">130</span><span class="keyword" id="5625403">func</span>&nbsp;<span class="ident" id="5625408">NewYCbCr</span><span class="op" id="5625416">(</span><span class="ident" id="5625417">r</span>&nbsp;<span class="ident" id="5625419">Rectangle</span><span class="op" id="5625428">,</span>&nbsp;<span class="ident" id="5625430">subsampleRatio</span>&nbsp;<span class="ident" id="5625445">YCbCrSubsampleRatio</span><span class="op" id="5625464">)</span>&nbsp;<span class="op" id="5625466">*</span><span class="ident" id="5625467">YCbCr</span>&nbsp;<span class="op" id="5625473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625476">w</span><span class="op" id="5625477">,</span>&nbsp;<span class="ident" id="5625479">h</span><span class="op" id="5625480">,</span>&nbsp;<span class="ident" id="5625482">cw</span><span class="op" id="5625484">,</span>&nbsp;<span class="ident" id="5625486">ch</span>&nbsp;<span class="op" id="5625489">:=</span>&nbsp;<span class="ident" id="5625492">r</span><span class="op" id="5625493">.</span><span class="ident" id="5625494">Dx</span><span class="op" id="5625496">(</span><span class="op" id="5625497">)</span><span class="op" id="5625498">,</span>&nbsp;<span class="ident" id="5625500">r</span><span class="op" id="5625501">.</span><span class="ident" id="5625502">Dy</span><span class="op" id="5625504">(</span><span class="op" id="5625505">)</span><span class="op" id="5625506">,</span>&nbsp;<span class="num" id="5625508">0</span><span class="op" id="5625509">,</span>&nbsp;<span class="num" id="5625511">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5625514">switch</span>&nbsp;<span class="ident" id="5625521">subsampleRatio</span>&nbsp;<span class="op" id="5625536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5625539">case</span>&nbsp;<span class="ident" id="5625544">YCbCrSubsampleRatio422</span><span class="op" id="5625566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625570">cw</span>&nbsp;<span class="op" id="5625573">=</span>&nbsp;<span class="op" id="5625575">(</span><span class="ident" id="5625576">r</span><span class="op" id="5625577">.</span><span class="ident" id="5625578">Max</span><span class="op" id="5625581">.</span><span class="ident" id="5625582">X</span><span class="op" id="5625583">+</span><span class="num" id="5625584">1</span><span class="op" id="5625585">)</span><span class="op" id="5625586">/</span><span class="num" id="5625587">2</span>&nbsp;<span class="op" id="5625589">-</span>&nbsp;<span class="ident" id="5625591">r</span><span class="op" id="5625592">.</span><span class="ident" id="5625593">Min</span><span class="op" id="5625596">.</span><span class="ident" id="5625597">X</span><span class="op" id="5625598">/</span><span class="num" id="5625599">2</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625603">ch</span>&nbsp;<span class="op" id="5625606">=</span>&nbsp;<span class="ident" id="5625608">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5625611">case</span>&nbsp;<span class="ident" id="5625616">YCbCrSubsampleRatio420</span><span class="op" id="5625638">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625642">cw</span>&nbsp;<span class="op" id="5625645">=</span>&nbsp;<span class="op" id="5625647">(</span><span class="ident" id="5625648">r</span><span class="op" id="5625649">.</span><span class="ident" id="5625650">Max</span><span class="op" id="5625653">.</span><span class="ident" id="5625654">X</span><span class="op" id="5625655">+</span><span class="num" id="5625656">1</span><span class="op" id="5625657">)</span><span class="op" id="5625658">/</span><span class="num" id="5625659">2</span>&nbsp;<span class="op" id="5625661">-</span>&nbsp;<span class="ident" id="5625663">r</span><span class="op" id="5625664">.</span><span class="ident" id="5625665">Min</span><span class="op" id="5625668">.</span><span class="ident" id="5625669">X</span><span class="op" id="5625670">/</span><span class="num" id="5625671">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625675">ch</span>&nbsp;<span class="op" id="5625678">=</span>&nbsp;<span class="op" id="5625680">(</span><span class="ident" id="5625681">r</span><span class="op" id="5625682">.</span><span class="ident" id="5625683">Max</span><span class="op" id="5625686">.</span><span class="ident" id="5625687">Y</span><span class="op" id="5625688">+</span><span class="num" id="5625689">1</span><span class="op" id="5625690">)</span><span class="op" id="5625691">/</span><span class="num" id="5625692">2</span>&nbsp;<span class="op" id="5625694">-</span>&nbsp;<span class="ident" id="5625696">r</span><span class="op" id="5625697">.</span><span class="ident" id="5625698">Min</span><span class="op" id="5625701">.</span><span class="ident" id="5625702">Y</span><span class="op" id="5625703">/</span><span class="num" id="5625704">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5625707">case</span>&nbsp;<span class="ident" id="5625712">YCbCrSubsampleRatio440</span><span class="op" id="5625734">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625738">cw</span>&nbsp;<span class="op" id="5625741">=</span>&nbsp;<span class="ident" id="5625743">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625747">ch</span>&nbsp;<span class="op" id="5625750">=</span>&nbsp;<span class="op" id="5625752">(</span><span class="ident" id="5625753">r</span><span class="op" id="5625754">.</span><span class="ident" id="5625755">Max</span><span class="op" id="5625758">.</span><span class="ident" id="5625759">Y</span><span class="op" id="5625760">+</span><span class="num" id="5625761">1</span><span class="op" id="5625762">)</span><span class="op" id="5625763">/</span><span class="num" id="5625764">2</span>&nbsp;<span class="op" id="5625766">-</span>&nbsp;<span class="ident" id="5625768">r</span><span class="op" id="5625769">.</span><span class="ident" id="5625770">Min</span><span class="op" id="5625773">.</span><span class="ident" id="5625774">Y</span><span class="op" id="5625775">/</span><span class="num" id="5625776">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5625779">default</span><span class="op" id="5625786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5625790">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625825">cw</span>&nbsp;<span class="op" id="5625828">=</span>&nbsp;<span class="ident" id="5625830">w</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625834">ch</span>&nbsp;<span class="op" id="5625837">=</span>&nbsp;<span class="ident" id="5625839">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5625842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625845">b</span>&nbsp;<span class="op" id="5625847">:=</span>&nbsp;<span class="builtinfunc" id="5625850">make</span><span class="op" id="5625854">(</span><span class="op" id="5625855">[</span><span class="op" id="5625856">]</span><span class="builtintype" id="5625857">byte</span><span class="op" id="5625861">,</span>&nbsp;<span class="ident" id="5625863">w</span><span class="op" id="5625864">*</span><span class="ident" id="5625865">h</span><span class="op" id="5625866">+</span><span class="num" id="5625867">2</span><span class="op" id="5625868">*</span><span class="ident" id="5625869">cw</span><span class="op" id="5625871">*</span><span class="ident" id="5625872">ch</span><span class="op" id="5625874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5625877">return</span>&nbsp;<span class="op" id="5625884">&amp;</span><span class="ident" id="5625885">YCbCr</span><span class="op" id="5625890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625894">Y</span><span class="op" id="5625895">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625910">b</span><span class="op" id="5625911">[</span><span class="op" id="5625912">:</span><span class="ident" id="5625913">w</span><span class="op" id="5625914">*</span><span class="ident" id="5625915">h</span><span class="op" id="5625916">]</span><span class="op" id="5625917">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625921">Cb</span><span class="op" id="5625923">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625937">b</span><span class="op" id="5625938">[</span><span class="ident" id="5625939">w</span><span class="op" id="5625940">*</span><span class="ident" id="5625941">h</span><span class="op" id="5625942">+</span><span class="num" id="5625943">0</span><span class="op" id="5625944">*</span><span class="ident" id="5625945">cw</span><span class="op" id="5625947">*</span><span class="ident" id="5625948">ch</span>&nbsp;<span class="op" id="5625951">:</span>&nbsp;<span class="ident" id="5625953">w</span><span class="op" id="5625954">*</span><span class="ident" id="5625955">h</span><span class="op" id="5625956">+</span><span class="num" id="5625957">1</span><span class="op" id="5625958">*</span><span class="ident" id="5625959">cw</span><span class="op" id="5625961">*</span><span class="ident" id="5625962">ch</span><span class="op" id="5625964">]</span><span class="op" id="5625965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625969">Cr</span><span class="op" id="5625971">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5625985">b</span><span class="op" id="5625986">[</span><span class="ident" id="5625987">w</span><span class="op" id="5625988">*</span><span class="ident" id="5625989">h</span><span class="op" id="5625990">+</span><span class="num" id="5625991">1</span><span class="op" id="5625992">*</span><span class="ident" id="5625993">cw</span><span class="op" id="5625995">*</span><span class="ident" id="5625996">ch</span>&nbsp;<span class="op" id="5625999">:</span>&nbsp;<span class="ident" id="5626001">w</span><span class="op" id="5626002">*</span><span class="ident" id="5626003">h</span><span class="op" id="5626004">+</span><span class="num" id="5626005">2</span><span class="op" id="5626006">*</span><span class="ident" id="5626007">cw</span><span class="op" id="5626009">*</span><span class="ident" id="5626010">ch</span><span class="op" id="5626012">]</span><span class="op" id="5626013">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5626017">SubsampleRatio</span><span class="op" id="5626031">:</span>&nbsp;<span class="ident" id="5626033">subsampleRatio</span><span class="op" id="5626047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5626051">YStride</span><span class="op" id="5626058">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5626067">w</span><span class="op" id="5626068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5626072">CStride</span><span class="op" id="5626079">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5626088">cw</span><span class="op" id="5626090">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5626094">Rect</span><span class="op" id="5626098">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5626110">r</span><span class="op" id="5626111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5626114">}</span><br>
<span class="lineno"></span><span class="op" id="5626116">}</span>
</div>
</body>
</html>
