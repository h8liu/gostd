<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/des</h2>
<ul>
<li><a href="/gostd/crypto/des/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/des/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/des/const.go.html">const.go</a></li>
<li><a href="/gostd/crypto/des/des_test.go.html">des_test.go</a></li>
<li><a href="/gostd/crypto/des/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4218338">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4218393">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4218447">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4218498">package</span>&nbsp;<span class="ident" id="4218506">des</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4218511">import</span>&nbsp;<span class="op" id="4218518">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4218521">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span><span class="op" id="4218539">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4218542">func</span>&nbsp;<span class="ident" id="4218547">cryptBlock</span><span class="op" id="4218557">(</span><span class="ident" id="4218558">subkeys</span>&nbsp;<span class="op" id="4218566">[</span><span class="op" id="4218567">]</span><span class="ident" id="4218568">uint64</span><span class="op" id="4218574">,</span>&nbsp;<span class="ident" id="4218576">dst</span><span class="op" id="4218579">,</span>&nbsp;<span class="ident" id="4218581">src</span>&nbsp;<span class="op" id="4218585">[</span><span class="op" id="4218586">]</span><span class="builtintype" id="4218587">byte</span><span class="op" id="4218591">,</span>&nbsp;<span class="ident" id="4218593">decrypt</span>&nbsp;<span class="builtintype" id="4218601">bool</span><span class="op" id="4218605">)</span>&nbsp;<span class="op" id="4218607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218610">b</span>&nbsp;<span class="op" id="4218612">:=</span>&nbsp;<span class="ident" id="4218615">binary</span><span class="op" id="4218621">.</span><span class="ident" id="4218622">BigEndian</span><span class="op" id="4218631">.</span><span class="ident" id="4218632">Uint64</span><span class="op" id="4218638">(</span><span class="ident" id="4218639">src</span><span class="op" id="4218642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218645">b</span>&nbsp;<span class="op" id="4218647">=</span>&nbsp;<span class="ident" id="4218649">permuteInitialBlock</span><span class="op" id="4218668">(</span><span class="ident" id="4218669">b</span><span class="op" id="4218670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218673">left</span><span class="op" id="4218677">,</span>&nbsp;<span class="ident" id="4218679">right</span>&nbsp;<span class="op" id="4218685">:=</span>&nbsp;<span class="builtintype" id="4218688">uint32</span><span class="op" id="4218694">(</span><span class="ident" id="4218695">b</span><span class="op" id="4218696">&gt;&gt;</span><span class="num" id="4218698">32</span><span class="op" id="4218700">)</span><span class="op" id="4218701">,</span>&nbsp;<span class="builtintype" id="4218703">uint32</span><span class="op" id="4218709">(</span><span class="ident" id="4218710">b</span><span class="op" id="4218711">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4218715">var</span>&nbsp;<span class="ident" id="4218719">subkey</span>&nbsp;<span class="ident" id="4218726">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4218734">for</span>&nbsp;<span class="ident" id="4218738">i</span>&nbsp;<span class="op" id="4218740">:=</span>&nbsp;<span class="num" id="4218743">0</span><span class="op" id="4218744">;</span>&nbsp;<span class="ident" id="4218746">i</span>&nbsp;<span class="op" id="4218748">&lt;</span>&nbsp;<span class="num" id="4218750">16</span><span class="op" id="4218752">;</span>&nbsp;<span class="ident" id="4218754">i</span><span class="op" id="4218755">++</span>&nbsp;<span class="op" id="4218758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4218762">if</span>&nbsp;<span class="ident" id="4218765">decrypt</span>&nbsp;<span class="op" id="4218773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218778">subkey</span>&nbsp;<span class="op" id="4218785">=</span>&nbsp;<span class="ident" id="4218787">subkeys</span><span class="op" id="4218794">[</span><span class="num" id="4218795">15</span><span class="op" id="4218797">-</span><span class="ident" id="4218798">i</span><span class="op" id="4218799">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4218803">}</span>&nbsp;<span class="keyword" id="4218805">else</span>&nbsp;<span class="op" id="4218810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218815">subkey</span>&nbsp;<span class="op" id="4218822">=</span>&nbsp;<span class="ident" id="4218824">subkeys</span><span class="op" id="4218831">[</span><span class="ident" id="4218832">i</span><span class="op" id="4218833">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4218837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218842">left</span><span class="op" id="4218846">,</span>&nbsp;<span class="ident" id="4218848">right</span>&nbsp;<span class="op" id="4218854">=</span>&nbsp;<span class="ident" id="4218856">right</span><span class="op" id="4218861">,</span>&nbsp;<span class="ident" id="4218863">left</span><span class="op" id="4218867">^</span><span class="ident" id="4218868">feistel</span><span class="op" id="4218875">(</span><span class="ident" id="4218876">right</span><span class="op" id="4218881">,</span>&nbsp;<span class="ident" id="4218883">subkey</span><span class="op" id="4218889">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4218892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4218895">//&nbsp;switch&nbsp;left&nbsp;&amp;&nbsp;right&nbsp;and&nbsp;perform&nbsp;final&nbsp;permutation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4218949">preOutput</span>&nbsp;<span class="op" id="4218959">:=</span>&nbsp;<span class="op" id="4218962">(</span><span class="ident" id="4218963">uint64</span><span class="op" id="4218969">(</span><span class="ident" id="4218970">right</span><span class="op" id="4218975">)</span>&nbsp;<span class="op" id="4218977">&lt;&lt;</span>&nbsp;<span class="num" id="4218980">32</span><span class="op" id="4218982">)</span>&nbsp;<span class="op" id="4218984">|</span>&nbsp;<span class="ident" id="4218986">uint64</span><span class="op" id="4218992">(</span><span class="ident" id="4218993">left</span><span class="op" id="4218997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219000">binary</span><span class="op" id="4219006">.</span><span class="ident" id="4219007">BigEndian</span><span class="op" id="4219016">.</span><span class="ident" id="4219017">PutUint64</span><span class="op" id="4219026">(</span><span class="ident" id="4219027">dst</span><span class="op" id="4219030">,</span>&nbsp;<span class="ident" id="4219032">permuteFinalBlock</span><span class="op" id="4219049">(</span><span class="ident" id="4219050">preOutput</span><span class="op" id="4219059">)</span><span class="op" id="4219060">)</span><br>
<span class="lineno"></span><span class="op" id="4219062">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4219065">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;subkeys.</span><br>
<span class="lineno"></span><span class="keyword" id="4219124">func</span>&nbsp;<span class="ident" id="4219129">encryptBlock</span><span class="op" id="4219141">(</span><span class="ident" id="4219142">subkeys</span>&nbsp;<span class="op" id="4219150">[</span><span class="op" id="4219151">]</span><span class="ident" id="4219152">uint64</span><span class="op" id="4219158">,</span>&nbsp;<span class="ident" id="4219160">dst</span><span class="op" id="4219163">,</span>&nbsp;<span class="ident" id="4219165">src</span>&nbsp;<span class="op" id="4219169">[</span><span class="op" id="4219170">]</span><span class="builtintype" id="4219171">byte</span><span class="op" id="4219175">)</span>&nbsp;<span class="op" id="4219177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219180">cryptBlock</span><span class="op" id="4219190">(</span><span class="ident" id="4219191">subkeys</span><span class="op" id="4219198">,</span>&nbsp;<span class="ident" id="4219200">dst</span><span class="op" id="4219203">,</span>&nbsp;<span class="ident" id="4219205">src</span><span class="op" id="4219208">,</span>&nbsp;<span class="builtintype" id="4219210">false</span><span class="op" id="4219215">)</span><br>
<span class="lineno"></span><span class="op" id="4219217">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="4219220">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;subkeys.</span><br>
<span class="lineno"></span><span class="keyword" id="4219279">func</span>&nbsp;<span class="ident" id="4219284">decryptBlock</span><span class="op" id="4219296">(</span><span class="ident" id="4219297">subkeys</span>&nbsp;<span class="op" id="4219305">[</span><span class="op" id="4219306">]</span><span class="ident" id="4219307">uint64</span><span class="op" id="4219313">,</span>&nbsp;<span class="ident" id="4219315">dst</span><span class="op" id="4219318">,</span>&nbsp;<span class="ident" id="4219320">src</span>&nbsp;<span class="op" id="4219324">[</span><span class="op" id="4219325">]</span><span class="builtintype" id="4219326">byte</span><span class="op" id="4219330">)</span>&nbsp;<span class="op" id="4219332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219335">cryptBlock</span><span class="op" id="4219345">(</span><span class="ident" id="4219346">subkeys</span><span class="op" id="4219353">,</span>&nbsp;<span class="ident" id="4219355">dst</span><span class="op" id="4219358">,</span>&nbsp;<span class="ident" id="4219360">src</span><span class="op" id="4219363">,</span>&nbsp;<span class="builtintype" id="4219365">true</span><span class="op" id="4219369">)</span><br>
<span class="lineno"></span><span class="op" id="4219371">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4219374">//&nbsp;DES&nbsp;Feistel&nbsp;function</span><br>
<span class="lineno"></span><span class="keyword" id="4219398">func</span>&nbsp;<span class="ident" id="4219403">feistel</span><span class="op" id="4219410">(</span><span class="ident" id="4219411">right</span>&nbsp;<span class="builtintype" id="4219417">uint32</span><span class="op" id="4219423">,</span>&nbsp;<span class="ident" id="4219425">key</span>&nbsp;<span class="ident" id="4219429">uint64</span><span class="op" id="4219435">)</span>&nbsp;<span class="op" id="4219437">(</span><span class="ident" id="4219438">result</span>&nbsp;<span class="builtintype" id="4219445">uint32</span><span class="op" id="4219451">)</span>&nbsp;<span class="op" id="4219453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219456">sBoxLocations</span>&nbsp;<span class="op" id="4219470">:=</span>&nbsp;<span class="ident" id="4219473">key</span>&nbsp;<span class="op" id="4219477">^</span>&nbsp;<span class="ident" id="4219479">expandBlock</span><span class="op" id="4219490">(</span><span class="ident" id="4219491">right</span><span class="op" id="4219496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4219499">var</span>&nbsp;<span class="ident" id="4219503">sBoxResult</span>&nbsp;<span class="builtintype" id="4219514">uint32</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4219522">for</span>&nbsp;<span class="ident" id="4219526">i</span>&nbsp;<span class="op" id="4219528">:=</span>&nbsp;<span class="builtintype" id="4219531">uint8</span><span class="op" id="4219536">(</span><span class="num" id="4219537">0</span><span class="op" id="4219538">)</span><span class="op" id="4219539">;</span>&nbsp;<span class="ident" id="4219541">i</span>&nbsp;<span class="op" id="4219543">&lt;</span>&nbsp;<span class="num" id="4219545">8</span><span class="op" id="4219546">;</span>&nbsp;<span class="ident" id="4219548">i</span><span class="op" id="4219549">++</span>&nbsp;<span class="op" id="4219552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219556">sBoxLocation</span>&nbsp;<span class="op" id="4219569">:=</span>&nbsp;<span class="builtintype" id="4219572">uint8</span><span class="op" id="4219577">(</span><span class="ident" id="4219578">sBoxLocations</span><span class="op" id="4219591">&gt;&gt;</span><span class="num" id="4219593">42</span><span class="op" id="4219595">)</span>&nbsp;<span class="op" id="4219597">&amp;</span>&nbsp;<span class="num" id="4219599">0x3f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219606">sBoxLocations</span>&nbsp;<span class="op" id="4219620">&lt;&lt;=</span>&nbsp;<span class="num" id="4219624">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4219628">//&nbsp;row&nbsp;determined&nbsp;by&nbsp;1st&nbsp;and&nbsp;6th&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4219667">//&nbsp;column&nbsp;is&nbsp;middle&nbsp;four&nbsp;bits</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219699">row</span>&nbsp;<span class="op" id="4219703">:=</span>&nbsp;<span class="op" id="4219706">(</span><span class="ident" id="4219707">sBoxLocation</span>&nbsp;<span class="op" id="4219720">&amp;</span>&nbsp;<span class="num" id="4219722">0x1</span><span class="op" id="4219725">)</span>&nbsp;<span class="op" id="4219727">|</span>&nbsp;<span class="op" id="4219729">(</span><span class="op" id="4219730">(</span><span class="ident" id="4219731">sBoxLocation</span>&nbsp;<span class="op" id="4219744">&amp;</span>&nbsp;<span class="num" id="4219746">0x20</span><span class="op" id="4219750">)</span>&nbsp;<span class="op" id="4219752">&gt;&gt;</span>&nbsp;<span class="num" id="4219755">4</span><span class="op" id="4219756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219760">column</span>&nbsp;<span class="op" id="4219767">:=</span>&nbsp;<span class="op" id="4219770">(</span><span class="ident" id="4219771">sBoxLocation</span>&nbsp;<span class="op" id="4219784">&gt;&gt;</span>&nbsp;<span class="num" id="4219787">1</span><span class="op" id="4219788">)</span>&nbsp;<span class="op" id="4219790">&amp;</span>&nbsp;<span class="num" id="4219792">0xf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4219798">sBoxResult</span>&nbsp;<span class="op" id="4219809">^=</span>&nbsp;<span class="ident" id="4219812">feistelBox</span><span class="op" id="4219822">[</span><span class="ident" id="4219823">i</span><span class="op" id="4219824">]</span><span class="op" id="4219825">[</span><span class="num" id="4219826">16</span><span class="op" id="4219828">*</span><span class="ident" id="4219829">row</span><span class="op" id="4219832">+</span><span class="ident" id="4219833">column</span><span class="op" id="4219839">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4219842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4219845">return</span>&nbsp;<span class="ident" id="4219852">sBoxResult</span><br>
<span class="lineno">55</span><span class="op" id="4219863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4219866">//&nbsp;feistelBox[s][16*i+j]&nbsp;contains&nbsp;the&nbsp;output&nbsp;of&nbsp;permutationFunction</span><br>
<span class="lineno"></span><span class="comment" id="4219934">//&nbsp;for&nbsp;sBoxes[s][i][j]&nbsp;&lt;&lt;&nbsp;4*(7-s)</span><br>
<span class="lineno"></span><span class="keyword" id="4219968">var</span>&nbsp;<span class="ident" id="4219972">feistelBox</span>&nbsp;<span class="op" id="4219983">[</span><span class="num" id="4219984">8</span><span class="op" id="4219985">]</span><span class="op" id="4219986">[</span><span class="num" id="4219987">64</span><span class="op" id="4219989">]</span><span class="builtintype" id="4219990">uint32</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="4219998">//&nbsp;general&nbsp;purpose&nbsp;function&nbsp;to&nbsp;perform&nbsp;DES&nbsp;block&nbsp;permutations</span><br>
<span class="lineno"></span><span class="keyword" id="4220060">func</span>&nbsp;<span class="ident" id="4220065">permuteBlock</span><span class="op" id="4220077">(</span><span class="ident" id="4220078">src</span>&nbsp;<span class="ident" id="4220082">uint64</span><span class="op" id="4220088">,</span>&nbsp;<span class="ident" id="4220090">permutation</span>&nbsp;<span class="op" id="4220102">[</span><span class="op" id="4220103">]</span><span class="builtintype" id="4220104">uint8</span><span class="op" id="4220109">)</span>&nbsp;<span class="op" id="4220111">(</span><span class="ident" id="4220112">block</span>&nbsp;<span class="ident" id="4220118">uint64</span><span class="op" id="4220124">)</span>&nbsp;<span class="op" id="4220126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220129">for</span>&nbsp;<span class="ident" id="4220133">position</span><span class="op" id="4220141">,</span>&nbsp;<span class="ident" id="4220143">n</span>&nbsp;<span class="op" id="4220145">:=</span>&nbsp;<span class="keyword" id="4220148">range</span>&nbsp;<span class="ident" id="4220154">permutation</span>&nbsp;<span class="op" id="4220166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220170">bit</span>&nbsp;<span class="op" id="4220174">:=</span>&nbsp;<span class="op" id="4220177">(</span><span class="ident" id="4220178">src</span>&nbsp;<span class="op" id="4220182">&gt;&gt;</span>&nbsp;<span class="ident" id="4220185">n</span><span class="op" id="4220186">)</span>&nbsp;<span class="op" id="4220188">&amp;</span>&nbsp;<span class="num" id="4220190">1</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220194">block</span>&nbsp;<span class="op" id="4220200">|=</span>&nbsp;<span class="ident" id="4220203">bit</span>&nbsp;<span class="op" id="4220207">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4220210">uint</span><span class="op" id="4220214">(</span><span class="op" id="4220215">(</span><span class="builtinfunc" id="4220216">len</span><span class="op" id="4220219">(</span><span class="ident" id="4220220">permutation</span><span class="op" id="4220231">)</span><span class="op" id="4220232">-</span><span class="num" id="4220233">1</span><span class="op" id="4220234">)</span><span class="op" id="4220235">-</span><span class="ident" id="4220236">position</span><span class="op" id="4220244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4220247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220250">return</span><br>
<span class="lineno"></span><span class="op" id="4220257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="4220260">func</span>&nbsp;<span class="ident" id="4220265">init</span><span class="op" id="4220269">(</span><span class="op" id="4220270">)</span>&nbsp;<span class="op" id="4220272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220275">for</span>&nbsp;<span class="ident" id="4220279">s</span>&nbsp;<span class="op" id="4220281">:=</span>&nbsp;<span class="keyword" id="4220284">range</span>&nbsp;<span class="ident" id="4220290">sBoxes</span>&nbsp;<span class="op" id="4220297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220301">for</span>&nbsp;<span class="ident" id="4220305">i</span>&nbsp;<span class="op" id="4220307">:=</span>&nbsp;<span class="num" id="4220310">0</span><span class="op" id="4220311">;</span>&nbsp;<span class="ident" id="4220313">i</span>&nbsp;<span class="op" id="4220315">&lt;</span>&nbsp;<span class="num" id="4220317">4</span><span class="op" id="4220318">;</span>&nbsp;<span class="ident" id="4220320">i</span><span class="op" id="4220321">++</span>&nbsp;<span class="op" id="4220324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220329">for</span>&nbsp;<span class="ident" id="4220333">j</span>&nbsp;<span class="op" id="4220335">:=</span>&nbsp;<span class="num" id="4220338">0</span><span class="op" id="4220339">;</span>&nbsp;<span class="ident" id="4220341">j</span>&nbsp;<span class="op" id="4220343">&lt;</span>&nbsp;<span class="num" id="4220345">16</span><span class="op" id="4220347">;</span>&nbsp;<span class="ident" id="4220349">j</span><span class="op" id="4220350">++</span>&nbsp;<span class="op" id="4220353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220359">f</span>&nbsp;<span class="op" id="4220361">:=</span>&nbsp;<span class="ident" id="4220364">uint64</span><span class="op" id="4220370">(</span><span class="ident" id="4220371">sBoxes</span><span class="op" id="4220377">[</span><span class="ident" id="4220378">s</span><span class="op" id="4220379">]</span><span class="op" id="4220380">[</span><span class="ident" id="4220381">i</span><span class="op" id="4220382">]</span><span class="op" id="4220383">[</span><span class="ident" id="4220384">j</span><span class="op" id="4220385">]</span><span class="op" id="4220386">)</span>&nbsp;<span class="op" id="4220388">&lt;&lt;</span>&nbsp;<span class="op" id="4220391">(</span><span class="num" id="4220392">4</span>&nbsp;<span class="op" id="4220394">*</span>&nbsp;<span class="op" id="4220396">(</span><span class="num" id="4220397">7</span>&nbsp;<span class="op" id="4220399">-</span>&nbsp;<span class="builtintype" id="4220401">uint</span><span class="op" id="4220405">(</span><span class="ident" id="4220406">s</span><span class="op" id="4220407">)</span><span class="op" id="4220408">)</span><span class="op" id="4220409">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220415">f</span>&nbsp;<span class="op" id="4220417">=</span>&nbsp;<span class="ident" id="4220419">permuteBlock</span><span class="op" id="4220431">(</span><span class="ident" id="4220432">uint64</span><span class="op" id="4220438">(</span><span class="ident" id="4220439">f</span><span class="op" id="4220440">)</span><span class="op" id="4220441">,</span>&nbsp;<span class="ident" id="4220443">permutationFunction</span><span class="op" id="4220462">[</span><span class="op" id="4220463">:</span><span class="op" id="4220464">]</span><span class="op" id="4220465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220471">feistelBox</span><span class="op" id="4220481">[</span><span class="ident" id="4220482">s</span><span class="op" id="4220483">]</span><span class="op" id="4220484">[</span><span class="num" id="4220485">16</span><span class="op" id="4220487">*</span><span class="ident" id="4220488">i</span><span class="op" id="4220489">+</span><span class="ident" id="4220490">j</span><span class="op" id="4220491">]</span>&nbsp;<span class="op" id="4220493">=</span>&nbsp;<span class="builtintype" id="4220495">uint32</span><span class="op" id="4220501">(</span><span class="ident" id="4220502">f</span><span class="op" id="4220503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4220508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4220512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4220515">}</span><br>
<span class="lineno">80</span><span class="op" id="4220517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4220520">//&nbsp;expandBlock&nbsp;expands&nbsp;an&nbsp;input&nbsp;block&nbsp;of&nbsp;32&nbsp;bits,</span><br>
<span class="lineno"></span><span class="comment" id="4220570">//&nbsp;producing&nbsp;an&nbsp;output&nbsp;block&nbsp;of&nbsp;48&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4220611">func</span>&nbsp;<span class="ident" id="4220616">expandBlock</span><span class="op" id="4220627">(</span><span class="ident" id="4220628">src</span>&nbsp;<span class="builtintype" id="4220632">uint32</span><span class="op" id="4220638">)</span>&nbsp;<span class="op" id="4220640">(</span><span class="ident" id="4220641">block</span>&nbsp;<span class="ident" id="4220647">uint64</span><span class="op" id="4220653">)</span>&nbsp;<span class="op" id="4220655">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4220658">//&nbsp;rotate&nbsp;the&nbsp;5&nbsp;highest&nbsp;bits&nbsp;to&nbsp;the&nbsp;right.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220702">src</span>&nbsp;<span class="op" id="4220706">=</span>&nbsp;<span class="op" id="4220708">(</span><span class="ident" id="4220709">src</span>&nbsp;<span class="op" id="4220713">&lt;&lt;</span>&nbsp;<span class="num" id="4220716">5</span><span class="op" id="4220717">)</span>&nbsp;<span class="op" id="4220719">|</span>&nbsp;<span class="op" id="4220721">(</span><span class="ident" id="4220722">src</span>&nbsp;<span class="op" id="4220726">&gt;&gt;</span>&nbsp;<span class="num" id="4220729">27</span><span class="op" id="4220731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220734">for</span>&nbsp;<span class="ident" id="4220738">i</span>&nbsp;<span class="op" id="4220740">:=</span>&nbsp;<span class="num" id="4220743">0</span><span class="op" id="4220744">;</span>&nbsp;<span class="ident" id="4220746">i</span>&nbsp;<span class="op" id="4220748">&lt;</span>&nbsp;<span class="num" id="4220750">8</span><span class="op" id="4220751">;</span>&nbsp;<span class="ident" id="4220753">i</span><span class="op" id="4220754">++</span>&nbsp;<span class="op" id="4220757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220761">block</span>&nbsp;<span class="op" id="4220767">&lt;&lt;=</span>&nbsp;<span class="num" id="4220771">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4220775">//&nbsp;take&nbsp;the&nbsp;6&nbsp;bits&nbsp;on&nbsp;the&nbsp;right</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220809">block</span>&nbsp;<span class="op" id="4220815">|=</span>&nbsp;<span class="ident" id="4220818">uint64</span><span class="op" id="4220824">(</span><span class="ident" id="4220825">src</span><span class="op" id="4220828">)</span>&nbsp;<span class="op" id="4220830">&amp;</span>&nbsp;<span class="op" id="4220832">(</span><span class="num" id="4220833">1</span><span class="op" id="4220834">&lt;&lt;</span><span class="num" id="4220836">6</span>&nbsp;<span class="op" id="4220838">-</span>&nbsp;<span class="num" id="4220840">1</span><span class="op" id="4220841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4220845">//&nbsp;advance&nbsp;by&nbsp;4&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4220869">src</span>&nbsp;<span class="op" id="4220873">=</span>&nbsp;<span class="op" id="4220875">(</span><span class="ident" id="4220876">src</span>&nbsp;<span class="op" id="4220880">&lt;&lt;</span>&nbsp;<span class="num" id="4220883">4</span><span class="op" id="4220884">)</span>&nbsp;<span class="op" id="4220886">|</span>&nbsp;<span class="op" id="4220888">(</span><span class="ident" id="4220889">src</span>&nbsp;<span class="op" id="4220893">&gt;&gt;</span>&nbsp;<span class="num" id="4220896">28</span><span class="op" id="4220898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4220901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4220904">return</span><br>
<span class="lineno">95</span><span class="op" id="4220911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4220914">//&nbsp;permuteInitialBlock&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;permutation&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="4220978">//&nbsp;by&nbsp;initialPermutation.</span><br>
<span class="lineno"></span><span class="keyword" id="4221004">func</span>&nbsp;<span class="ident" id="4221009">permuteInitialBlock</span><span class="op" id="4221028">(</span><span class="ident" id="4221029">block</span>&nbsp;<span class="ident" id="4221035">uint64</span><span class="op" id="4221041">)</span>&nbsp;<span class="ident" id="4221043">uint64</span>&nbsp;<span class="op" id="4221050">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221053">//&nbsp;block&nbsp;=&nbsp;b7&nbsp;b6&nbsp;b5&nbsp;b4&nbsp;b3&nbsp;b2&nbsp;b1&nbsp;b0&nbsp;(8&nbsp;bytes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221099">b1</span>&nbsp;<span class="op" id="4221102">:=</span>&nbsp;<span class="ident" id="4221105">block</span>&nbsp;<span class="op" id="4221111">&gt;&gt;</span>&nbsp;<span class="num" id="4221114">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221118">b2</span>&nbsp;<span class="op" id="4221121">:=</span>&nbsp;<span class="ident" id="4221124">block</span>&nbsp;<span class="op" id="4221130">&lt;&lt;</span>&nbsp;<span class="num" id="4221133">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221137">block</span>&nbsp;<span class="op" id="4221143">^=</span>&nbsp;<span class="ident" id="4221146">b1</span>&nbsp;<span class="op" id="4221149">^</span>&nbsp;<span class="ident" id="4221151">b2</span>&nbsp;<span class="op" id="4221154">^</span>&nbsp;<span class="ident" id="4221156">b1</span><span class="op" id="4221158">&lt;&lt;</span><span class="num" id="4221160">48</span>&nbsp;<span class="op" id="4221163">^</span>&nbsp;<span class="ident" id="4221165">b2</span><span class="op" id="4221167">&gt;&gt;</span><span class="num" id="4221169">48</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221174">//&nbsp;block&nbsp;=&nbsp;b1&nbsp;b0&nbsp;b5&nbsp;b4&nbsp;b3&nbsp;b2&nbsp;b7&nbsp;b6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221210">b1</span>&nbsp;<span class="op" id="4221213">=</span>&nbsp;<span class="ident" id="4221215">block</span>&nbsp;<span class="op" id="4221221">&gt;&gt;</span>&nbsp;<span class="num" id="4221224">32</span>&nbsp;<span class="op" id="4221227">&amp;</span>&nbsp;<span class="num" id="4221229">0xff00ff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221239">b2</span>&nbsp;<span class="op" id="4221242">=</span>&nbsp;<span class="op" id="4221244">(</span><span class="ident" id="4221245">block</span>&nbsp;<span class="op" id="4221251">&amp;</span>&nbsp;<span class="num" id="4221253">0xff00ff00</span><span class="op" id="4221263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221266">block</span>&nbsp;<span class="op" id="4221272">^=</span>&nbsp;<span class="ident" id="4221275">b1</span><span class="op" id="4221277">&lt;&lt;</span><span class="num" id="4221279">32</span>&nbsp;<span class="op" id="4221282">^</span>&nbsp;<span class="ident" id="4221284">b2</span>&nbsp;<span class="op" id="4221287">^</span>&nbsp;<span class="ident" id="4221289">b1</span><span class="op" id="4221291">&lt;&lt;</span><span class="num" id="4221293">8</span>&nbsp;<span class="op" id="4221295">^</span>&nbsp;<span class="ident" id="4221297">b2</span><span class="op" id="4221299">&lt;&lt;</span><span class="num" id="4221301">24</span>&nbsp;<span class="comment" id="4221304">//&nbsp;exchange&nbsp;b0&nbsp;b4&nbsp;with&nbsp;b3&nbsp;b7</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221335">//&nbsp;block&nbsp;is&nbsp;now&nbsp;b1&nbsp;b3&nbsp;b5&nbsp;b7&nbsp;b0&nbsp;b2&nbsp;b4&nbsp;b7,&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221394">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221422">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221450">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221478">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;56</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221506">//&nbsp;&nbsp;7&nbsp;&nbsp;6&nbsp;&nbsp;5&nbsp;&nbsp;4&nbsp;&nbsp;3&nbsp;&nbsp;2&nbsp;&nbsp;1&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221534">//&nbsp;23&nbsp;22&nbsp;21&nbsp;20&nbsp;19&nbsp;18&nbsp;17&nbsp;16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221562">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221590">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;48</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221619">//&nbsp;exchange&nbsp;4,5,6,7&nbsp;with&nbsp;32,33,34,35&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221662">b1</span>&nbsp;<span class="op" id="4221665">=</span>&nbsp;<span class="ident" id="4221667">block</span>&nbsp;<span class="op" id="4221673">&amp;</span>&nbsp;<span class="num" id="4221675">0x0f0f00000f0f0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221695">b2</span>&nbsp;<span class="op" id="4221698">=</span>&nbsp;<span class="ident" id="4221700">block</span>&nbsp;<span class="op" id="4221706">&amp;</span>&nbsp;<span class="num" id="4221708">0x0000f0f00000f0f0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221728">block</span>&nbsp;<span class="op" id="4221734">^=</span>&nbsp;<span class="ident" id="4221737">b1</span>&nbsp;<span class="op" id="4221740">^</span>&nbsp;<span class="ident" id="4221742">b2</span>&nbsp;<span class="op" id="4221745">^</span>&nbsp;<span class="ident" id="4221747">b1</span><span class="op" id="4221749">&gt;&gt;</span><span class="num" id="4221751">12</span>&nbsp;<span class="op" id="4221754">^</span>&nbsp;<span class="ident" id="4221756">b2</span><span class="op" id="4221758">&lt;&lt;</span><span class="num" id="4221760">12</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221765">//&nbsp;block&nbsp;is&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221795">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221799">//&nbsp;&nbsp;&nbsp;[+8]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[+40]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221824">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221828">//&nbsp;&nbsp;7&nbsp;&nbsp;6&nbsp;&nbsp;5&nbsp;&nbsp;4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221844">//&nbsp;23&nbsp;22&nbsp;21&nbsp;20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221860">//&nbsp;&nbsp;3&nbsp;&nbsp;2&nbsp;&nbsp;1&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221876">//&nbsp;19&nbsp;18&nbsp;17&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;[+32]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4221902">//&nbsp;exchange&nbsp;0,1,4,5&nbsp;with&nbsp;18,19,22,23</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221940">b1</span>&nbsp;<span class="op" id="4221943">=</span>&nbsp;<span class="ident" id="4221945">block</span>&nbsp;<span class="op" id="4221951">&amp;</span>&nbsp;<span class="num" id="4221953">0x3300330033003300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4221973">b2</span>&nbsp;<span class="op" id="4221976">=</span>&nbsp;<span class="ident" id="4221978">block</span>&nbsp;<span class="op" id="4221984">&amp;</span>&nbsp;<span class="num" id="4221986">0x00cc00cc00cc00cc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222006">block</span>&nbsp;<span class="op" id="4222012">^=</span>&nbsp;<span class="ident" id="4222015">b1</span>&nbsp;<span class="op" id="4222018">^</span>&nbsp;<span class="ident" id="4222020">b2</span>&nbsp;<span class="op" id="4222023">^</span>&nbsp;<span class="ident" id="4222025">b1</span><span class="op" id="4222027">&gt;&gt;</span><span class="num" id="4222029">6</span>&nbsp;<span class="op" id="4222031">^</span>&nbsp;<span class="ident" id="4222033">b2</span><span class="op" id="4222035">&lt;&lt;</span><span class="num" id="4222037">6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222041">//&nbsp;block&nbsp;is&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222071">//&nbsp;15&nbsp;14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222081">//&nbsp;13&nbsp;12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222091">//&nbsp;11&nbsp;10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222101">//&nbsp;&nbsp;9&nbsp;&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222111">//&nbsp;&nbsp;7&nbsp;&nbsp;6</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222121">//&nbsp;&nbsp;5&nbsp;&nbsp;4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222131">//&nbsp;&nbsp;3&nbsp;&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222141">//&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;[+16]&nbsp;[+32]&nbsp;[+64]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222170">//&nbsp;exchange&nbsp;0,2,4,6&nbsp;with&nbsp;9,11,13,15:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222208">b1</span>&nbsp;<span class="op" id="4222211">=</span>&nbsp;<span class="ident" id="4222213">block</span>&nbsp;<span class="op" id="4222219">&amp;</span>&nbsp;<span class="num" id="4222221">0xaaaaaaaa55555555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222241">block</span>&nbsp;<span class="op" id="4222247">^=</span>&nbsp;<span class="ident" id="4222250">b1</span>&nbsp;<span class="op" id="4222253">^</span>&nbsp;<span class="ident" id="4222255">b1</span><span class="op" id="4222257">&gt;&gt;</span><span class="num" id="4222259">33</span>&nbsp;<span class="op" id="4222262">^</span>&nbsp;<span class="ident" id="4222264">b1</span><span class="op" id="4222266">&lt;&lt;</span><span class="num" id="4222268">33</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222273">//&nbsp;block&nbsp;is&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222303">//&nbsp;6&nbsp;14&nbsp;22&nbsp;30&nbsp;38&nbsp;46&nbsp;54&nbsp;62</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222330">//&nbsp;4&nbsp;12&nbsp;20&nbsp;28&nbsp;36&nbsp;44&nbsp;52&nbsp;60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222357">//&nbsp;2&nbsp;10&nbsp;18&nbsp;26&nbsp;34&nbsp;42&nbsp;50&nbsp;58</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222384">//&nbsp;0&nbsp;&nbsp;8&nbsp;16&nbsp;24&nbsp;32&nbsp;40&nbsp;48&nbsp;56</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222411">//&nbsp;7&nbsp;15&nbsp;23&nbsp;31&nbsp;39&nbsp;47&nbsp;55&nbsp;63</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222438">//&nbsp;5&nbsp;13&nbsp;21&nbsp;29&nbsp;37&nbsp;45&nbsp;53&nbsp;61</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222465">//&nbsp;3&nbsp;11&nbsp;19&nbsp;27&nbsp;35&nbsp;43&nbsp;51&nbsp;59</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222492">//&nbsp;1&nbsp;&nbsp;9&nbsp;17&nbsp;25&nbsp;33&nbsp;41&nbsp;49&nbsp;57</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4222519">return</span>&nbsp;<span class="ident" id="4222526">block</span><br>
<span class="lineno"></span><span class="op" id="4222532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4222535">//&nbsp;permuteInitialBlock&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;permutation&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="4222599">//&nbsp;by&nbsp;finalPermutation.</span><br>
<span class="lineno"></span><span class="keyword" id="4222623">func</span>&nbsp;<span class="ident" id="4222628">permuteFinalBlock</span><span class="op" id="4222645">(</span><span class="ident" id="4222646">block</span>&nbsp;<span class="ident" id="4222652">uint64</span><span class="op" id="4222658">)</span>&nbsp;<span class="ident" id="4222660">uint64</span>&nbsp;<span class="op" id="4222667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222670">//&nbsp;Perform&nbsp;the&nbsp;same&nbsp;bit&nbsp;exchanges&nbsp;as&nbsp;permuteInitialBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4222728">//&nbsp;but&nbsp;in&nbsp;reverse&nbsp;order.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222754">b1</span>&nbsp;<span class="op" id="4222757">:=</span>&nbsp;<span class="ident" id="4222760">block</span>&nbsp;<span class="op" id="4222766">&amp;</span>&nbsp;<span class="num" id="4222768">0xaaaaaaaa55555555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222788">block</span>&nbsp;<span class="op" id="4222794">^=</span>&nbsp;<span class="ident" id="4222797">b1</span>&nbsp;<span class="op" id="4222800">^</span>&nbsp;<span class="ident" id="4222802">b1</span><span class="op" id="4222804">&gt;&gt;</span><span class="num" id="4222806">33</span>&nbsp;<span class="op" id="4222809">^</span>&nbsp;<span class="ident" id="4222811">b1</span><span class="op" id="4222813">&lt;&lt;</span><span class="num" id="4222815">33</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222820">b1</span>&nbsp;<span class="op" id="4222823">=</span>&nbsp;<span class="ident" id="4222825">block</span>&nbsp;<span class="op" id="4222831">&amp;</span>&nbsp;<span class="num" id="4222833">0x3300330033003300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222853">b2</span>&nbsp;<span class="op" id="4222856">:=</span>&nbsp;<span class="ident" id="4222859">block</span>&nbsp;<span class="op" id="4222865">&amp;</span>&nbsp;<span class="num" id="4222867">0x00cc00cc00cc00cc</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222887">block</span>&nbsp;<span class="op" id="4222893">^=</span>&nbsp;<span class="ident" id="4222896">b1</span>&nbsp;<span class="op" id="4222899">^</span>&nbsp;<span class="ident" id="4222901">b2</span>&nbsp;<span class="op" id="4222904">^</span>&nbsp;<span class="ident" id="4222906">b1</span><span class="op" id="4222908">&gt;&gt;</span><span class="num" id="4222910">6</span>&nbsp;<span class="op" id="4222912">^</span>&nbsp;<span class="ident" id="4222914">b2</span><span class="op" id="4222916">&lt;&lt;</span><span class="num" id="4222918">6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222922">b1</span>&nbsp;<span class="op" id="4222925">=</span>&nbsp;<span class="ident" id="4222927">block</span>&nbsp;<span class="op" id="4222933">&amp;</span>&nbsp;<span class="num" id="4222935">0x0f0f00000f0f0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222955">b2</span>&nbsp;<span class="op" id="4222958">=</span>&nbsp;<span class="ident" id="4222960">block</span>&nbsp;<span class="op" id="4222966">&amp;</span>&nbsp;<span class="num" id="4222968">0x0000f0f00000f0f0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222988">block</span>&nbsp;<span class="op" id="4222994">^=</span>&nbsp;<span class="ident" id="4222997">b1</span>&nbsp;<span class="op" id="4223000">^</span>&nbsp;<span class="ident" id="4223002">b2</span>&nbsp;<span class="op" id="4223005">^</span>&nbsp;<span class="ident" id="4223007">b1</span><span class="op" id="4223009">&gt;&gt;</span><span class="num" id="4223011">12</span>&nbsp;<span class="op" id="4223014">^</span>&nbsp;<span class="ident" id="4223016">b2</span><span class="op" id="4223018">&lt;&lt;</span><span class="num" id="4223020">12</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223025">b1</span>&nbsp;<span class="op" id="4223028">=</span>&nbsp;<span class="ident" id="4223030">block</span>&nbsp;<span class="op" id="4223036">&gt;&gt;</span>&nbsp;<span class="num" id="4223039">32</span>&nbsp;<span class="op" id="4223042">&amp;</span>&nbsp;<span class="num" id="4223044">0xff00ff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223054">b2</span>&nbsp;<span class="op" id="4223057">=</span>&nbsp;<span class="op" id="4223059">(</span><span class="ident" id="4223060">block</span>&nbsp;<span class="op" id="4223066">&amp;</span>&nbsp;<span class="num" id="4223068">0xff00ff00</span><span class="op" id="4223078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223081">block</span>&nbsp;<span class="op" id="4223087">^=</span>&nbsp;<span class="ident" id="4223090">b1</span><span class="op" id="4223092">&lt;&lt;</span><span class="num" id="4223094">32</span>&nbsp;<span class="op" id="4223097">^</span>&nbsp;<span class="ident" id="4223099">b2</span>&nbsp;<span class="op" id="4223102">^</span>&nbsp;<span class="ident" id="4223104">b1</span><span class="op" id="4223106">&lt;&lt;</span><span class="num" id="4223108">8</span>&nbsp;<span class="op" id="4223110">^</span>&nbsp;<span class="ident" id="4223112">b2</span><span class="op" id="4223114">&lt;&lt;</span><span class="num" id="4223116">24</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223121">b1</span>&nbsp;<span class="op" id="4223124">=</span>&nbsp;<span class="ident" id="4223126">block</span>&nbsp;<span class="op" id="4223132">&gt;&gt;</span>&nbsp;<span class="num" id="4223135">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223139">b2</span>&nbsp;<span class="op" id="4223142">=</span>&nbsp;<span class="ident" id="4223144">block</span>&nbsp;<span class="op" id="4223150">&lt;&lt;</span>&nbsp;<span class="num" id="4223153">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223157">block</span>&nbsp;<span class="op" id="4223163">^=</span>&nbsp;<span class="ident" id="4223166">b1</span>&nbsp;<span class="op" id="4223169">^</span>&nbsp;<span class="ident" id="4223171">b2</span>&nbsp;<span class="op" id="4223174">^</span>&nbsp;<span class="ident" id="4223176">b1</span><span class="op" id="4223178">&lt;&lt;</span><span class="num" id="4223180">48</span>&nbsp;<span class="op" id="4223183">^</span>&nbsp;<span class="ident" id="4223185">b2</span><span class="op" id="4223187">&gt;&gt;</span><span class="num" id="4223189">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4223193">return</span>&nbsp;<span class="ident" id="4223200">block</span><br>
<span class="lineno"></span><span class="op" id="4223206">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="4223209">//&nbsp;creates&nbsp;16&nbsp;28-bit&nbsp;blocks&nbsp;rotated&nbsp;according</span><br>
<span class="lineno"></span><span class="comment" id="4223255">//&nbsp;to&nbsp;the&nbsp;rotation&nbsp;schedule</span><br>
<span class="lineno"></span><span class="keyword" id="4223283">func</span>&nbsp;<span class="ident" id="4223288">ksRotate</span><span class="op" id="4223296">(</span><span class="ident" id="4223297">in</span>&nbsp;<span class="builtintype" id="4223300">uint32</span><span class="op" id="4223306">)</span>&nbsp;<span class="op" id="4223308">(</span><span class="ident" id="4223309">out</span>&nbsp;<span class="op" id="4223313">[</span><span class="op" id="4223314">]</span><span class="builtintype" id="4223315">uint32</span><span class="op" id="4223321">)</span>&nbsp;<span class="op" id="4223323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223326">out</span>&nbsp;<span class="op" id="4223330">=</span>&nbsp;<span class="builtinfunc" id="4223332">make</span><span class="op" id="4223336">(</span><span class="op" id="4223337">[</span><span class="op" id="4223338">]</span><span class="builtintype" id="4223339">uint32</span><span class="op" id="4223345">,</span>&nbsp;<span class="num" id="4223347">16</span><span class="op" id="4223349">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223352">last</span>&nbsp;<span class="op" id="4223357">:=</span>&nbsp;<span class="ident" id="4223360">in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4223364">for</span>&nbsp;<span class="ident" id="4223368">i</span>&nbsp;<span class="op" id="4223370">:=</span>&nbsp;<span class="num" id="4223373">0</span><span class="op" id="4223374">;</span>&nbsp;<span class="ident" id="4223376">i</span>&nbsp;<span class="op" id="4223378">&lt;</span>&nbsp;<span class="num" id="4223380">16</span><span class="op" id="4223382">;</span>&nbsp;<span class="ident" id="4223384">i</span><span class="op" id="4223385">++</span>&nbsp;<span class="op" id="4223388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4223392">//&nbsp;28-bit&nbsp;circular&nbsp;left&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223424">left</span>&nbsp;<span class="op" id="4223429">:=</span>&nbsp;<span class="op" id="4223432">(</span><span class="ident" id="4223433">last</span>&nbsp;<span class="op" id="4223438">&lt;&lt;</span>&nbsp;<span class="op" id="4223441">(</span><span class="num" id="4223442">4</span>&nbsp;<span class="op" id="4223444">+</span>&nbsp;<span class="ident" id="4223446">ksRotations</span><span class="op" id="4223457">[</span><span class="ident" id="4223458">i</span><span class="op" id="4223459">]</span><span class="op" id="4223460">)</span><span class="op" id="4223461">)</span>&nbsp;<span class="op" id="4223463">&gt;&gt;</span>&nbsp;<span class="num" id="4223466">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223470">right</span>&nbsp;<span class="op" id="4223476">:=</span>&nbsp;<span class="op" id="4223479">(</span><span class="ident" id="4223480">last</span>&nbsp;<span class="op" id="4223485">&lt;&lt;</span>&nbsp;<span class="num" id="4223488">4</span><span class="op" id="4223489">)</span>&nbsp;<span class="op" id="4223491">&gt;&gt;</span>&nbsp;<span class="op" id="4223494">(</span><span class="num" id="4223495">32</span>&nbsp;<span class="op" id="4223498">-</span>&nbsp;<span class="ident" id="4223500">ksRotations</span><span class="op" id="4223511">[</span><span class="ident" id="4223512">i</span><span class="op" id="4223513">]</span><span class="op" id="4223514">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223518">out</span><span class="op" id="4223521">[</span><span class="ident" id="4223522">i</span><span class="op" id="4223523">]</span>&nbsp;<span class="op" id="4223525">=</span>&nbsp;<span class="ident" id="4223527">left</span>&nbsp;<span class="op" id="4223532">|</span>&nbsp;<span class="ident" id="4223534">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223542">last</span>&nbsp;<span class="op" id="4223547">=</span>&nbsp;<span class="ident" id="4223549">out</span><span class="op" id="4223552">[</span><span class="ident" id="4223553">i</span><span class="op" id="4223554">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4223557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4223560">return</span><br>
<span class="lineno"></span><span class="op" id="4223567">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="4223570">//&nbsp;creates&nbsp;16&nbsp;56-bit&nbsp;subkeys&nbsp;from&nbsp;the&nbsp;original&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="4223621">func</span>&nbsp;<span class="op" id="4223626">(</span><span class="ident" id="4223627">c</span>&nbsp;<span class="op" id="4223629">*</span><span class="ident" id="4223630">desCipher</span><span class="op" id="4223639">)</span>&nbsp;<span class="ident" id="4223641">generateSubkeys</span><span class="op" id="4223656">(</span><span class="ident" id="4223657">keyBytes</span>&nbsp;<span class="op" id="4223666">[</span><span class="op" id="4223667">]</span><span class="builtintype" id="4223668">byte</span><span class="op" id="4223672">)</span>&nbsp;<span class="op" id="4223674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4223677">//&nbsp;apply&nbsp;PC1&nbsp;permutation&nbsp;to&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223710">key</span>&nbsp;<span class="op" id="4223714">:=</span>&nbsp;<span class="ident" id="4223717">binary</span><span class="op" id="4223723">.</span><span class="ident" id="4223724">BigEndian</span><span class="op" id="4223733">.</span><span class="ident" id="4223734">Uint64</span><span class="op" id="4223740">(</span><span class="ident" id="4223741">keyBytes</span><span class="op" id="4223749">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223752">permutedKey</span>&nbsp;<span class="op" id="4223764">:=</span>&nbsp;<span class="ident" id="4223767">permuteBlock</span><span class="op" id="4223779">(</span><span class="ident" id="4223780">key</span><span class="op" id="4223783">,</span>&nbsp;<span class="ident" id="4223785">permutedChoice1</span><span class="op" id="4223800">[</span><span class="op" id="4223801">:</span><span class="op" id="4223802">]</span><span class="op" id="4223803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4223807">//&nbsp;rotate&nbsp;halves&nbsp;of&nbsp;permuted&nbsp;key&nbsp;according&nbsp;to&nbsp;the&nbsp;rotation&nbsp;schedule</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223876">leftRotations</span>&nbsp;<span class="op" id="4223890">:=</span>&nbsp;<span class="ident" id="4223893">ksRotate</span><span class="op" id="4223901">(</span><span class="builtintype" id="4223902">uint32</span><span class="op" id="4223908">(</span><span class="ident" id="4223909">permutedKey</span>&nbsp;<span class="op" id="4223921">&gt;&gt;</span>&nbsp;<span class="num" id="4223924">28</span><span class="op" id="4223926">)</span><span class="op" id="4223927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223930">rightRotations</span>&nbsp;<span class="op" id="4223945">:=</span>&nbsp;<span class="ident" id="4223948">ksRotate</span><span class="op" id="4223956">(</span><span class="builtintype" id="4223957">uint32</span><span class="op" id="4223963">(</span><span class="ident" id="4223964">permutedKey</span><span class="op" id="4223975">&lt;&lt;</span><span class="num" id="4223977">4</span><span class="op" id="4223978">)</span>&nbsp;<span class="op" id="4223980">&gt;&gt;</span>&nbsp;<span class="num" id="4223983">4</span><span class="op" id="4223984">)</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4223988">//&nbsp;generate&nbsp;subkeys</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4224009">for</span>&nbsp;<span class="ident" id="4224013">i</span>&nbsp;<span class="op" id="4224015">:=</span>&nbsp;<span class="num" id="4224018">0</span><span class="op" id="4224019">;</span>&nbsp;<span class="ident" id="4224021">i</span>&nbsp;<span class="op" id="4224023">&lt;</span>&nbsp;<span class="num" id="4224025">16</span><span class="op" id="4224027">;</span>&nbsp;<span class="ident" id="4224029">i</span><span class="op" id="4224030">++</span>&nbsp;<span class="op" id="4224033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4224037">//&nbsp;combine&nbsp;halves&nbsp;to&nbsp;form&nbsp;56-bit&nbsp;input&nbsp;to&nbsp;PC2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224085">pc2Input</span>&nbsp;<span class="op" id="4224094">:=</span>&nbsp;<span class="ident" id="4224097">uint64</span><span class="op" id="4224103">(</span><span class="ident" id="4224104">leftRotations</span><span class="op" id="4224117">[</span><span class="ident" id="4224118">i</span><span class="op" id="4224119">]</span><span class="op" id="4224120">)</span><span class="op" id="4224121">&lt;&lt;</span><span class="num" id="4224123">28</span>&nbsp;<span class="op" id="4224126">|</span>&nbsp;<span class="ident" id="4224128">uint64</span><span class="op" id="4224134">(</span><span class="ident" id="4224135">rightRotations</span><span class="op" id="4224149">[</span><span class="ident" id="4224150">i</span><span class="op" id="4224151">]</span><span class="op" id="4224152">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4224156">//&nbsp;apply&nbsp;PC2&nbsp;permutation&nbsp;to&nbsp;7&nbsp;byte&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224199">c</span><span class="op" id="4224200">.</span><span class="ident" id="4224201">subkeys</span><span class="op" id="4224208">[</span><span class="ident" id="4224209">i</span><span class="op" id="4224210">]</span>&nbsp;<span class="op" id="4224212">=</span>&nbsp;<span class="ident" id="4224214">permuteBlock</span><span class="op" id="4224226">(</span><span class="ident" id="4224227">pc2Input</span><span class="op" id="4224235">,</span>&nbsp;<span class="ident" id="4224237">permutedChoice2</span><span class="op" id="4224252">[</span><span class="op" id="4224253">:</span><span class="op" id="4224254">]</span><span class="op" id="4224255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4224258">}</span><br>
<span class="lineno"></span><span class="op" id="4224260">}</span>
</div>
</body>
</html>
