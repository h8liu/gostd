<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6459699">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6459754">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6459808">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6459859">package</span>&nbsp;<span class="ident" id="6459867">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6459876">import</span>&nbsp;<span class="op" id="6459883">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6459886">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6459894">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6459901">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6459907">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6459918">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6459926">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6459941">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6459948">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6459951">var</span>&nbsp;<span class="ident" id="6459955">matchBenchmarks</span>&nbsp;<span class="op" id="6459971">=</span>&nbsp;<span class="ident" id="6459973"><a href="/testing/benchmark.go.html#6459886">flag</a></span><span class="op" id="6459977">.</span><span class="ident" id="6459978">String</span><span class="op" id="6459984">(</span><span class="string" id="6459985">&#34;test.bench&#34;</span><span class="op" id="6459997">,</span>&nbsp;<span class="string" id="6459999">&#34;&#34;</span><span class="op" id="6460001">,</span>&nbsp;<span class="string" id="6460003">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="6460051">)</span><br>
<span class="lineno"></span><span class="keyword" id="6460053">var</span>&nbsp;<span class="ident" id="6460057">benchTime</span>&nbsp;<span class="op" id="6460067">=</span>&nbsp;<span class="ident" id="6460069"><a href="/testing/benchmark.go.html#6459886">flag</a></span><span class="op" id="6460073">.</span><span class="ident" id="6460074">Duration</span><span class="op" id="6460082">(</span><span class="string" id="6460083">&#34;test.benchtime&#34;</span><span class="op" id="6460099">,</span>&nbsp;<span class="num" id="6460101">1</span><span class="op" id="6460102">*</span><span class="ident" id="6460103"><a href="/testing/benchmark.go.html#6459941">time</a></span><span class="op" id="6460107">.</span><span class="ident" id="6460108">Second</span><span class="op" id="6460114">,</span>&nbsp;<span class="string" id="6460116">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="6460157">)</span><br>
<span class="lineno"></span><span class="keyword" id="6460159">var</span>&nbsp;<span class="ident" id="6460163">benchmarkMemory</span>&nbsp;<span class="op" id="6460179">=</span>&nbsp;<span class="ident" id="6460181"><a href="/testing/benchmark.go.html#6459886">flag</a></span><span class="op" id="6460185">.</span><span class="ident" id="6460186">Bool</span><span class="op" id="6460190">(</span><span class="string" id="6460191">&#34;test.benchmem&#34;</span><span class="op" id="6460206">,</span>&nbsp;<span class="ident" id="6460208">false</span><span class="op" id="6460213">,</span>&nbsp;<span class="string" id="6460215">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="6460256">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6460259">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6460319">var</span>&nbsp;<span class="ident" id="6460323">benchmarkLock</span>&nbsp;<span class="ident" id="6460337"><a href="/testing/benchmark.go.html#6459918">sync</a></span><span class="op" id="6460341">.</span><span class="ident" id="6460342">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6460349">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="6460399">var</span>&nbsp;<span class="ident" id="6460403">memStats</span>&nbsp;<span class="ident" id="6460412"><a href="/testing/benchmark.go.html#6459907">runtime</a></span><span class="op" id="6460419">.</span><span class="ident" id="6460420">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6460430">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6460519">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6460548">type</span>&nbsp;<span class="ident" id="6460553">InternalBenchmark</span>&nbsp;<span class="keyword" id="6460571">struct</span>&nbsp;<span class="op" id="6460578">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460581">Name</span>&nbsp;<span class="builtintype" id="6460586">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460594">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6460599">func</span><span class="op" id="6460603">(</span><span class="ident" id="6460604">b</span>&nbsp;<span class="op" id="6460606">*</span><span class="ident" id="6460607"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6460608">)</span><br>
<span class="lineno"></span><span class="op" id="6460610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6460613">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="6460678">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6460736">type</span>&nbsp;<span class="ident" id="6460741">B</span>&nbsp;<span class="keyword" id="6460743">struct</span>&nbsp;<span class="op" id="6460750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460753"><a href="/testing/testing.go.html#6484606">common</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460761">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6460778">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460783">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6460800">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6460814">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460859">previousDuration</span>&nbsp;<span class="ident" id="6460876"><a href="/testing/benchmark.go.html#6459941">time</a></span><span class="op" id="6460880">.</span><span class="ident" id="6460881">Duration</span>&nbsp;<span class="comment" id="6460890">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460929">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460946"><a href="/testing/benchmark.go.html#6460553">InternalBenchmark</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460965">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460982">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460989">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6461006">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461012">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="6461029">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461035">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461052"><a href="/testing/benchmark.go.html#6465494">BenchmarkResult</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461069">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6461086">int</span>&nbsp;<span class="comment" id="6461090">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6461148">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461216">startAllocs</span>&nbsp;<span class="ident" id="6461228">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461236">startBytes</span>&nbsp;&nbsp;<span class="ident" id="6461248">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6461256">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461304">netAllocs</span>&nbsp;<span class="ident" id="6461314">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461322">netBytes</span>&nbsp;&nbsp;<span class="ident" id="6461332">uint64</span><br>
<span class="lineno"></span><span class="op" id="6461339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="6461342">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="6461417">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="6461491">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="6461515">func</span>&nbsp;<span class="op" id="6461520">(</span><span class="ident" id="6461521">b</span>&nbsp;<span class="op" id="6461523">*</span><span class="ident" id="6461524"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6461525">)</span>&nbsp;<span class="ident" id="6461527">StartTimer</span><span class="op" id="6461537">(</span><span class="op" id="6461538">)</span>&nbsp;<span class="op" id="6461540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6461543">if</span>&nbsp;<span class="op" id="6461546">!</span><span class="ident" id="6461547"><a href="/testing/benchmark.go.html#6461521">b</a></span><span class="op" id="6461548">.</span><span class="ident" id="6461549">timerOn</span>&nbsp;<span class="op" id="6461557">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461561"><a href="/testing/benchmark.go.html#6459907">runtime</a></span><span class="op" id="6461568">.</span><span class="ident" id="6461569">ReadMemStats</span><span class="op" id="6461581">(</span><span class="op" id="6461582">&amp;</span><span class="ident" id="6461583"><a href="/testing/benchmark.go.html#6460403">memStats</a></span><span class="op" id="6461591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461595"><a href="/testing/benchmark.go.html#6461521">b</a></span><span class="op" id="6461596">.</span><span class="ident" id="6461597">startAllocs</span>&nbsp;<span class="op" id="6461609">=</span>&nbsp;<span class="ident" id="6461611"><a href="/testing/benchmark.go.html#6460403">memStats</a></span><span class="op" id="6461619">.</span><span class="ident" id="6461620">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461630"><a href="/testing/benchmark.go.html#6461521">b</a></span><span class="op" id="6461631">.</span><span class="ident" id="6461632">startBytes</span>&nbsp;<span class="op" id="6461643">=</span>&nbsp;<span class="ident" id="6461645"><a href="/testing/benchmark.go.html#6460403">memStats</a></span><span class="op" id="6461653">.</span><span class="ident" id="6461654">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461667"><a href="/testing/benchmark.go.html#6461521">b</a></span><span class="op" id="6461668">.</span><span class="ident" id="6461669">start</span>&nbsp;<span class="op" id="6461675">=</span>&nbsp;<span class="ident" id="6461677"><a href="/testing/benchmark.go.html#6459941">time</a></span><span class="op" id="6461681">.</span><span class="ident" id="6461682">Now</span><span class="op" id="6461685">(</span><span class="op" id="6461686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461690"><a href="/testing/benchmark.go.html#6461521">b</a></span><span class="op" id="6461691">.</span><span class="ident" id="6461692">timerOn</span>&nbsp;<span class="op" id="6461700">=</span>&nbsp;<span class="ident" id="6461702">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6461708">}</span><br>
<span class="lineno"></span><span class="op" id="6461710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6461713">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6461784">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="6461842">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="6461862">func</span>&nbsp;<span class="op" id="6461867">(</span><span class="ident" id="6461868">b</span>&nbsp;<span class="op" id="6461870">*</span><span class="ident" id="6461871"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6461872">)</span>&nbsp;<span class="ident" id="6461874">StopTimer</span><span class="op" id="6461883">(</span><span class="op" id="6461884">)</span>&nbsp;<span class="op" id="6461886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6461889">if</span>&nbsp;<span class="ident" id="6461892"><a href="/testing/benchmark.go.html#6461868">b</a></span><span class="op" id="6461893">.</span><span class="ident" id="6461894">timerOn</span>&nbsp;<span class="op" id="6461902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461906"><a href="/testing/benchmark.go.html#6461868">b</a></span><span class="op" id="6461907">.</span><span class="ident" id="6461908">duration</span>&nbsp;<span class="op" id="6461917">+=</span>&nbsp;<span class="ident" id="6461920"><a href="/testing/benchmark.go.html#6459941">time</a></span><span class="op" id="6461924">.</span><span class="ident" id="6461925">Now</span><span class="op" id="6461928">(</span><span class="op" id="6461929">)</span><span class="op" id="6461930">.</span><span class="ident" id="6461931">Sub</span><span class="op" id="6461934">(</span><span class="ident" id="6461935"><a href="/testing/benchmark.go.html#6461868">b</a></span><span class="op" id="6461936">.</span><span class="ident" id="6461937">start</span><span class="op" id="6461942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461946"><a href="/testing/benchmark.go.html#6459907">runtime</a></span><span class="op" id="6461953">.</span><span class="ident" id="6461954">ReadMemStats</span><span class="op" id="6461966">(</span><span class="op" id="6461967">&amp;</span><span class="ident" id="6461968"><a href="/testing/benchmark.go.html#6460403">memStats</a></span><span class="op" id="6461976">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461980"><a href="/testing/benchmark.go.html#6461868">b</a></span><span class="op" id="6461981">.</span><span class="ident" id="6461982">netAllocs</span>&nbsp;<span class="op" id="6461992">+=</span>&nbsp;<span class="ident" id="6461995"><a href="/testing/benchmark.go.html#6460403">memStats</a></span><span class="op" id="6462003">.</span><span class="ident" id="6462004">Mallocs</span>&nbsp;<span class="op" id="6462012">-</span>&nbsp;<span class="ident" id="6462014"><a href="/testing/benchmark.go.html#6461868">b</a></span><span class="op" id="6462015">.</span><span class="ident" id="6462016">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6462030"><a href="/testing/benchmark.go.html#6461868">b</a></span><span class="op" id="6462031">.</span><span class="ident" id="6462032">netBytes</span>&nbsp;<span class="op" id="6462041">+=</span>&nbsp;<span class="ident" id="6462044"><a href="/testing/benchmark.go.html#6460403">memStats</a></span><span class="op" id="6462052">.</span><span class="ident" id="6462053">TotalAlloc</span>&nbsp;<span class="op" id="6462064">-</span>&nbsp;<span class="ident" id="6462066"><a href="/testing/benchmark.go.html#6461868">b</a></span><span class="op" id="6462067">.</span><span class="ident" id="6462068">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6462081"><a href="/testing/benchmark.go.html#6461868">b</a></span><span class="op" id="6462082">.</span><span class="ident" id="6462083">timerOn</span>&nbsp;<span class="op" id="6462091">=</span>&nbsp;<span class="ident" id="6462093">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6462100">}</span><br>
<span class="lineno"></span><span class="op" id="6462102">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="6462105">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="6462184">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6462236">func</span>&nbsp;<span class="op" id="6462241">(</span><span class="ident" id="6462242">b</span>&nbsp;<span class="op" id="6462244">*</span><span class="ident" id="6462245"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6462246">)</span>&nbsp;<span class="ident" id="6462248">ResetTimer</span><span class="op" id="6462258">(</span><span class="op" id="6462259">)</span>&nbsp;<span class="op" id="6462261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6462264">if</span>&nbsp;<span class="ident" id="6462267"><a href="/testing/benchmark.go.html#6462242">b</a></span><span class="op" id="6462268">.</span><span class="ident" id="6462269">timerOn</span>&nbsp;<span class="op" id="6462277">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6462281"><a href="/testing/benchmark.go.html#6459907">runtime</a></span><span class="op" id="6462288">.</span><span class="ident" id="6462289">ReadMemStats</span><span class="op" id="6462301">(</span><span class="op" id="6462302">&amp;</span><span class="ident" id="6462303"><a href="/testing/benchmark.go.html#6460403">memStats</a></span><span class="op" id="6462311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6462315"><a href="/testing/benchmark.go.html#6462242">b</a></span><span class="op" id="6462316">.</span><span class="ident" id="6462317">startAllocs</span>&nbsp;<span class="op" id="6462329">=</span>&nbsp;<span class="ident" id="6462331"><a href="/testing/benchmark.go.html#6460403">memStats</a></span><span class="op" id="6462339">.</span><span class="ident" id="6462340">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6462350"><a href="/testing/benchmark.go.html#6462242">b</a></span><span class="op" id="6462351">.</span><span class="ident" id="6462352">startBytes</span>&nbsp;<span class="op" id="6462363">=</span>&nbsp;<span class="ident" id="6462365"><a href="/testing/benchmark.go.html#6460403">memStats</a></span><span class="op" id="6462373">.</span><span class="ident" id="6462374">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6462387"><a href="/testing/benchmark.go.html#6462242">b</a></span><span class="op" id="6462388">.</span><span class="ident" id="6462389">start</span>&nbsp;<span class="op" id="6462395">=</span>&nbsp;<span class="ident" id="6462397"><a href="/testing/benchmark.go.html#6459941">time</a></span><span class="op" id="6462401">.</span><span class="ident" id="6462402">Now</span><span class="op" id="6462405">(</span><span class="op" id="6462406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6462409">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6462412"><a href="/testing/benchmark.go.html#6462242">b</a></span><span class="op" id="6462413">.</span><span class="ident" id="6462414">duration</span>&nbsp;<span class="op" id="6462423">=</span>&nbsp;<span class="num" id="6462425">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6462428"><a href="/testing/benchmark.go.html#6462242">b</a></span><span class="op" id="6462429">.</span><span class="ident" id="6462430">netAllocs</span>&nbsp;<span class="op" id="6462440">=</span>&nbsp;<span class="num" id="6462442">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6462445"><a href="/testing/benchmark.go.html#6462242">b</a></span><span class="op" id="6462446">.</span><span class="ident" id="6462447">netBytes</span>&nbsp;<span class="op" id="6462456">=</span>&nbsp;<span class="num" id="6462458">0</span><br>
<span class="lineno"></span><span class="op" id="6462460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6462463">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="6462536">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="6462600">func</span>&nbsp;<span class="op" id="6462605">(</span><span class="ident" id="6462606">b</span>&nbsp;<span class="op" id="6462608">*</span><span class="ident" id="6462609"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6462610">)</span>&nbsp;<span class="ident" id="6462612">SetBytes</span><span class="op" id="6462620">(</span><span class="ident" id="6462621">n</span>&nbsp;<span class="ident" id="6462623">int64</span><span class="op" id="6462628">)</span>&nbsp;<span class="op" id="6462630">{</span>&nbsp;<span class="ident" id="6462632"><a href="/testing/benchmark.go.html#6462606">b</a></span><span class="op" id="6462633">.</span><span class="ident" id="6462634">bytes</span>&nbsp;<span class="op" id="6462640">=</span>&nbsp;<span class="ident" id="6462642"><a href="/testing/benchmark.go.html#6462621">n</a></span>&nbsp;<span class="op" id="6462644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6462647">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="6462709">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6462780">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="6462827">func</span>&nbsp;<span class="op" id="6462832">(</span><span class="ident" id="6462833">b</span>&nbsp;<span class="op" id="6462835">*</span><span class="ident" id="6462836"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6462837">)</span>&nbsp;<span class="ident" id="6462839">ReportAllocs</span><span class="op" id="6462851">(</span><span class="op" id="6462852">)</span>&nbsp;<span class="op" id="6462854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6462857"><a href="/testing/benchmark.go.html#6462833">b</a></span><span class="op" id="6462858">.</span><span class="ident" id="6462859">showAllocResult</span>&nbsp;<span class="op" id="6462875">=</span>&nbsp;<span class="ident" id="6462877">true</span><br>
<span class="lineno"></span><span class="op" id="6462882">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6462885">func</span>&nbsp;<span class="op" id="6462890">(</span><span class="ident" id="6462891">b</span>&nbsp;<span class="op" id="6462893">*</span><span class="ident" id="6462894"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6462895">)</span>&nbsp;<span class="ident" id="6462897">nsPerOp</span><span class="op" id="6462904">(</span><span class="op" id="6462905">)</span>&nbsp;<span class="ident" id="6462907">int64</span>&nbsp;<span class="op" id="6462913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6462916">if</span>&nbsp;<span class="ident" id="6462919"><a href="/testing/benchmark.go.html#6462891">b</a></span><span class="op" id="6462920">.</span><span class="ident" id="6462921">N</span>&nbsp;<span class="op" id="6462923">&lt;=</span>&nbsp;<span class="num" id="6462926">0</span>&nbsp;<span class="op" id="6462928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6462932">return</span>&nbsp;<span class="num" id="6462939">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6462942">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6462945">return</span>&nbsp;<span class="ident" id="6462952"><a href="/testing/benchmark.go.html#6462891">b</a></span><span class="op" id="6462953">.</span><span class="ident" id="6462954">duration</span><span class="op" id="6462962">.</span><span class="ident" id="6462963">Nanoseconds</span><span class="op" id="6462974">(</span><span class="op" id="6462975">)</span>&nbsp;<span class="op" id="6462977">/</span>&nbsp;<span class="ident" id="6462979">int64</span><span class="op" id="6462984">(</span><span class="ident" id="6462985"><a href="/testing/benchmark.go.html#6462891">b</a></span><span class="op" id="6462986">.</span><span class="ident" id="6462987">N</span><span class="op" id="6462988">)</span><br>
<span class="lineno"></span><span class="op" id="6462990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6462993">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="6463065">func</span>&nbsp;<span class="op" id="6463070">(</span><span class="ident" id="6463071">b</span>&nbsp;<span class="op" id="6463073">*</span><span class="ident" id="6463074"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6463075">)</span>&nbsp;<span class="ident" id="6463077">runN</span><span class="op" id="6463081">(</span><span class="ident" id="6463082">n</span>&nbsp;<span class="builtintype" id="6463084">int</span><span class="op" id="6463087">)</span>&nbsp;<span class="op" id="6463089">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463092"><a href="/testing/benchmark.go.html#6460323">benchmarkLock</a></span><span class="op" id="6463105">.</span><span class="ident" id="6463106">Lock</span><span class="op" id="6463110">(</span><span class="op" id="6463111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463114">defer</span>&nbsp;<span class="ident" id="6463120"><a href="/testing/benchmark.go.html#6460323">benchmarkLock</a></span><span class="op" id="6463133">.</span><span class="ident" id="6463134">Unlock</span><span class="op" id="6463140">(</span><span class="op" id="6463141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6463144">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6463197">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463241"><a href="/testing/benchmark.go.html#6459907">runtime</a></span><span class="op" id="6463248">.</span><span class="ident" id="6463249">GC</span><span class="op" id="6463251">(</span><span class="op" id="6463252">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463255"><a href="/testing/benchmark.go.html#6463071">b</a></span><span class="op" id="6463256">.</span><span class="ident" id="6463257">N</span>&nbsp;<span class="op" id="6463259">=</span>&nbsp;<span class="ident" id="6463261"><a href="/testing/benchmark.go.html#6463082">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463264"><a href="/testing/benchmark.go.html#6463071">b</a></span><span class="op" id="6463265">.</span><span class="ident" id="6463266">parallelism</span>&nbsp;<span class="op" id="6463278">=</span>&nbsp;<span class="num" id="6463280">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463283"><a href="/testing/benchmark.go.html#6463071">b</a></span><span class="op" id="6463284">.</span><span class="ident" id="6463285">ResetTimer</span><span class="op" id="6463295">(</span><span class="op" id="6463296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463299"><a href="/testing/benchmark.go.html#6463071">b</a></span><span class="op" id="6463300">.</span><span class="ident" id="6463301">StartTimer</span><span class="op" id="6463311">(</span><span class="op" id="6463312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463315"><a href="/testing/benchmark.go.html#6463071">b</a></span><span class="op" id="6463316">.</span><span class="ident" id="6463317">benchmark</span><span class="op" id="6463326">.</span><span class="ident" id="6463327">F</span><span class="op" id="6463328">(</span><span class="ident" id="6463329"><a href="/testing/benchmark.go.html#6463071">b</a></span><span class="op" id="6463330">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463333"><a href="/testing/benchmark.go.html#6463071">b</a></span><span class="op" id="6463334">.</span><span class="ident" id="6463335">StopTimer</span><span class="op" id="6463344">(</span><span class="op" id="6463345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463348"><a href="/testing/benchmark.go.html#6463071">b</a></span><span class="op" id="6463349">.</span><span class="ident" id="6463350">previousN</span>&nbsp;<span class="op" id="6463360">=</span>&nbsp;<span class="ident" id="6463362"><a href="/testing/benchmark.go.html#6463082">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463365"><a href="/testing/benchmark.go.html#6463071">b</a></span><span class="op" id="6463366">.</span><span class="ident" id="6463367">previousDuration</span>&nbsp;<span class="op" id="6463384">=</span>&nbsp;<span class="ident" id="6463386"><a href="/testing/benchmark.go.html#6463071">b</a></span><span class="op" id="6463387">.</span><span class="ident" id="6463388">duration</span><br>
<span class="lineno"></span><span class="op" id="6463397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6463400">func</span>&nbsp;<span class="ident" id="6463405">min</span><span class="op" id="6463408">(</span><span class="ident" id="6463409">x</span><span class="op" id="6463410">,</span>&nbsp;<span class="ident" id="6463412">y</span>&nbsp;<span class="builtintype" id="6463414">int</span><span class="op" id="6463417">)</span>&nbsp;<span class="builtintype" id="6463419">int</span>&nbsp;<span class="op" id="6463423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463426">if</span>&nbsp;<span class="ident" id="6463429"><a href="/testing/benchmark.go.html#6463409">x</a></span>&nbsp;<span class="op" id="6463431">&gt;</span>&nbsp;<span class="ident" id="6463433"><a href="/testing/benchmark.go.html#6463412">y</a></span>&nbsp;<span class="op" id="6463435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463439">return</span>&nbsp;<span class="ident" id="6463446"><a href="/testing/benchmark.go.html#6463412">y</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6463449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463452">return</span>&nbsp;<span class="ident" id="6463459"><a href="/testing/benchmark.go.html#6463409">x</a></span><br>
<span class="lineno">135</span><span class="op" id="6463461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6463464">func</span>&nbsp;<span class="ident" id="6463469">max</span><span class="op" id="6463472">(</span><span class="ident" id="6463473">x</span><span class="op" id="6463474">,</span>&nbsp;<span class="ident" id="6463476">y</span>&nbsp;<span class="builtintype" id="6463478">int</span><span class="op" id="6463481">)</span>&nbsp;<span class="builtintype" id="6463483">int</span>&nbsp;<span class="op" id="6463487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463490">if</span>&nbsp;<span class="ident" id="6463493"><a href="/testing/benchmark.go.html#6463473">x</a></span>&nbsp;<span class="op" id="6463495">&lt;</span>&nbsp;<span class="ident" id="6463497"><a href="/testing/benchmark.go.html#6463476">y</a></span>&nbsp;<span class="op" id="6463499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463503">return</span>&nbsp;<span class="ident" id="6463510"><a href="/testing/benchmark.go.html#6463476">y</a></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6463513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463516">return</span>&nbsp;<span class="ident" id="6463523"><a href="/testing/benchmark.go.html#6463473">x</a></span><br>
<span class="lineno"></span><span class="op" id="6463525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6463528">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="6463592">func</span>&nbsp;<span class="ident" id="6463597">roundDown10</span><span class="op" id="6463608">(</span><span class="ident" id="6463609">n</span>&nbsp;<span class="builtintype" id="6463611">int</span><span class="op" id="6463614">)</span>&nbsp;<span class="builtintype" id="6463616">int</span>&nbsp;<span class="op" id="6463620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463623">var</span>&nbsp;<span class="ident" id="6463627">tens</span>&nbsp;<span class="op" id="6463632">=</span>&nbsp;<span class="num" id="6463634">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6463637">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463665">for</span>&nbsp;<span class="ident" id="6463669"><a href="/testing/benchmark.go.html#6463609">n</a></span>&nbsp;<span class="op" id="6463671">&gt;=</span>&nbsp;<span class="num" id="6463674">10</span>&nbsp;<span class="op" id="6463677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463681"><a href="/testing/benchmark.go.html#6463609">n</a></span>&nbsp;<span class="op" id="6463683">=</span>&nbsp;<span class="ident" id="6463685"><a href="/testing/benchmark.go.html#6463609">n</a></span>&nbsp;<span class="op" id="6463687">/</span>&nbsp;<span class="num" id="6463689">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463694"><a href="/testing/benchmark.go.html#6463627">tens</a></span><span class="op" id="6463698">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6463702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6463705">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463726">result</span>&nbsp;<span class="op" id="6463733">:=</span>&nbsp;<span class="num" id="6463736">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463739">for</span>&nbsp;<span class="ident" id="6463743">i</span>&nbsp;<span class="op" id="6463745">:=</span>&nbsp;<span class="num" id="6463748">0</span><span class="op" id="6463749">;</span>&nbsp;<span class="ident" id="6463751"><a href="/testing/benchmark.go.html#6463743">i</a></span>&nbsp;<span class="op" id="6463753">&lt;</span>&nbsp;<span class="ident" id="6463755"><a href="/testing/benchmark.go.html#6463627">tens</a></span><span class="op" id="6463759">;</span>&nbsp;<span class="ident" id="6463761"><a href="/testing/benchmark.go.html#6463743">i</a></span><span class="op" id="6463762">++</span>&nbsp;<span class="op" id="6463765">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463769"><a href="/testing/benchmark.go.html#6463726">result</a></span>&nbsp;<span class="op" id="6463776">*=</span>&nbsp;<span class="num" id="6463779">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6463783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463786">return</span>&nbsp;<span class="ident" id="6463793"><a href="/testing/benchmark.go.html#6463726">result</a></span><br>
<span class="lineno"></span><span class="op" id="6463800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6463803">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="6463872">func</span>&nbsp;<span class="ident" id="6463877">roundUp</span><span class="op" id="6463884">(</span><span class="ident" id="6463885">n</span>&nbsp;<span class="builtintype" id="6463887">int</span><span class="op" id="6463890">)</span>&nbsp;<span class="builtintype" id="6463892">int</span>&nbsp;<span class="op" id="6463896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6463899">base</span>&nbsp;<span class="op" id="6463904">:=</span>&nbsp;<span class="ident" id="6463907"><a href="/testing/benchmark.go.html#6463597">roundDown10</a></span><span class="op" id="6463918">(</span><span class="ident" id="6463919"><a href="/testing/benchmark.go.html#6463885">n</a></span><span class="op" id="6463920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463923">switch</span>&nbsp;<span class="op" id="6463930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463933">case</span>&nbsp;<span class="ident" id="6463938"><a href="/testing/benchmark.go.html#6463885">n</a></span>&nbsp;<span class="op" id="6463940">&lt;=</span>&nbsp;<span class="ident" id="6463943"><a href="/testing/benchmark.go.html#6463899">base</a></span><span class="op" id="6463947">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463951">return</span>&nbsp;<span class="ident" id="6463958"><a href="/testing/benchmark.go.html#6463899">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463964">case</span>&nbsp;<span class="ident" id="6463969"><a href="/testing/benchmark.go.html#6463885">n</a></span>&nbsp;<span class="op" id="6463971">&lt;=</span>&nbsp;<span class="op" id="6463974">(</span><span class="num" id="6463975">2</span>&nbsp;<span class="op" id="6463977">*</span>&nbsp;<span class="ident" id="6463979"><a href="/testing/benchmark.go.html#6463899">base</a></span><span class="op" id="6463983">)</span><span class="op" id="6463984">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6463988">return</span>&nbsp;<span class="num" id="6463995">2</span>&nbsp;<span class="op" id="6463997">*</span>&nbsp;<span class="ident" id="6463999"><a href="/testing/benchmark.go.html#6463899">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6464005">case</span>&nbsp;<span class="ident" id="6464010"><a href="/testing/benchmark.go.html#6463885">n</a></span>&nbsp;<span class="op" id="6464012">&lt;=</span>&nbsp;<span class="op" id="6464015">(</span><span class="num" id="6464016">3</span>&nbsp;<span class="op" id="6464018">*</span>&nbsp;<span class="ident" id="6464020"><a href="/testing/benchmark.go.html#6463899">base</a></span><span class="op" id="6464024">)</span><span class="op" id="6464025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6464029">return</span>&nbsp;<span class="num" id="6464036">3</span>&nbsp;<span class="op" id="6464038">*</span>&nbsp;<span class="ident" id="6464040"><a href="/testing/benchmark.go.html#6463899">base</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6464046">case</span>&nbsp;<span class="ident" id="6464051"><a href="/testing/benchmark.go.html#6463885">n</a></span>&nbsp;<span class="op" id="6464053">&lt;=</span>&nbsp;<span class="op" id="6464056">(</span><span class="num" id="6464057">5</span>&nbsp;<span class="op" id="6464059">*</span>&nbsp;<span class="ident" id="6464061"><a href="/testing/benchmark.go.html#6463899">base</a></span><span class="op" id="6464065">)</span><span class="op" id="6464066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6464070">return</span>&nbsp;<span class="num" id="6464077">5</span>&nbsp;<span class="op" id="6464079">*</span>&nbsp;<span class="ident" id="6464081"><a href="/testing/benchmark.go.html#6463899">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6464087">default</span><span class="op" id="6464094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6464098">return</span>&nbsp;<span class="num" id="6464105">10</span>&nbsp;<span class="op" id="6464108">*</span>&nbsp;<span class="ident" id="6464110"><a href="/testing/benchmark.go.html#6463899">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6464116">}</span><br>
<span class="lineno">175</span><span class="op" id="6464118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6464121">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6464182">func</span>&nbsp;<span class="op" id="6464187">(</span><span class="ident" id="6464188">b</span>&nbsp;<span class="op" id="6464190">*</span><span class="ident" id="6464191"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6464192">)</span>&nbsp;<span class="ident" id="6464194">run</span><span class="op" id="6464197">(</span><span class="op" id="6464198">)</span>&nbsp;<span class="ident" id="6464200"><a href="/testing/benchmark.go.html#6465494">BenchmarkResult</a></span>&nbsp;<span class="op" id="6464216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6464219">go</span>&nbsp;<span class="ident" id="6464222"><a href="/testing/benchmark.go.html#6464188">b</a></span><span class="op" id="6464223">.</span><span class="ident" id="6464224">launch</span><span class="op" id="6464230">(</span><span class="op" id="6464231">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6464234">&lt;-</span><span class="ident" id="6464236"><a href="/testing/benchmark.go.html#6464188">b</a></span><span class="op" id="6464237">.</span><span class="ident" id="6464238">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6464246">return</span>&nbsp;<span class="ident" id="6464253"><a href="/testing/benchmark.go.html#6464188">b</a></span><span class="op" id="6464254">.</span><span class="ident" id="6464255">result</span><br>
<span class="lineno"></span><span class="op" id="6464262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6464265">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="6464343">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="6464424">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6464469">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptesting.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp100000&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="6464513">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6464575">func</span>&nbsp;<span class="op" id="6464580">(</span><span class="ident" id="6464581">b</span>&nbsp;<span class="op" id="6464583">*</span><span class="ident" id="6464584"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6464585">)</span>&nbsp;<span class="ident" id="6464587">launch</span><span class="op" id="6464593">(</span><span class="op" id="6464594">)</span>&nbsp;<span class="op" id="6464596">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6464599">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6464668">n</span>&nbsp;<span class="op" id="6464670">:=</span>&nbsp;<span class="num" id="6464673">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6464677">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6464731">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6464767">defer</span>&nbsp;<span class="keyword" id="6464773">func</span><span class="op" id="6464777">(</span><span class="op" id="6464778">)</span>&nbsp;<span class="op" id="6464780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6464784"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6464785">.</span><span class="ident" id="6464786">signal</span>&nbsp;<span class="op" id="6464793">&lt;-</span>&nbsp;<span class="ident" id="6464796"><a href="/testing/benchmark.go.html#6464581">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6464799">}</span><span class="op" id="6464800">(</span><span class="op" id="6464801">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6464805"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6464806">.</span><span class="ident" id="6464807">runN</span><span class="op" id="6464811">(</span><span class="ident" id="6464812"><a href="/testing/benchmark.go.html#6464668">n</a></span><span class="op" id="6464813">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6464816">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6464881">d</span>&nbsp;<span class="op" id="6464883">:=</span>&nbsp;<span class="op" id="6464886">*</span><span class="ident" id="6464887"><a href="/testing/benchmark.go.html#6460057">benchTime</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6464898">for</span>&nbsp;<span class="op" id="6464902">!</span><span class="ident" id="6464903"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6464904">.</span><span class="ident" id="6464905">failed</span>&nbsp;<span class="op" id="6464912">&amp;&amp;</span>&nbsp;<span class="ident" id="6464915"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6464916">.</span><span class="ident" id="6464917">duration</span>&nbsp;<span class="op" id="6464926">&lt;</span>&nbsp;<span class="ident" id="6464928"><a href="/testing/benchmark.go.html#6464881">d</a></span>&nbsp;<span class="op" id="6464930">&amp;&amp;</span>&nbsp;<span class="ident" id="6464933"><a href="/testing/benchmark.go.html#6464668">n</a></span>&nbsp;<span class="op" id="6464935">&lt;</span>&nbsp;<span class="num" id="6464937">1e9</span>&nbsp;<span class="op" id="6464941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6464945">last</span>&nbsp;<span class="op" id="6464950">:=</span>&nbsp;<span class="ident" id="6464953"><a href="/testing/benchmark.go.html#6464668">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6464957">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6464991">if</span>&nbsp;<span class="ident" id="6464994"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6464995">.</span><span class="ident" id="6464996">nsPerOp</span><span class="op" id="6465003">(</span><span class="op" id="6465004">)</span>&nbsp;<span class="op" id="6465006">==</span>&nbsp;<span class="num" id="6465009">0</span>&nbsp;<span class="op" id="6465011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6465016"><a href="/testing/benchmark.go.html#6464668">n</a></span>&nbsp;<span class="op" id="6465018">=</span>&nbsp;<span class="num" id="6465020">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6465026">}</span>&nbsp;<span class="keyword" id="6465028">else</span>&nbsp;<span class="op" id="6465033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6465038"><a href="/testing/benchmark.go.html#6464668">n</a></span>&nbsp;<span class="op" id="6465040">=</span>&nbsp;<span class="builtintype" id="6465042">int</span><span class="op" id="6465045">(</span><span class="ident" id="6465046"><a href="/testing/benchmark.go.html#6464881">d</a></span><span class="op" id="6465047">.</span><span class="ident" id="6465048">Nanoseconds</span><span class="op" id="6465059">(</span><span class="op" id="6465060">)</span>&nbsp;<span class="op" id="6465062">/</span>&nbsp;<span class="ident" id="6465064"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6465065">.</span><span class="ident" id="6465066">nsPerOp</span><span class="op" id="6465073">(</span><span class="op" id="6465074">)</span><span class="op" id="6465075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6465079">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6465083">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6465141">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6465207">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6465261"><a href="/testing/benchmark.go.html#6464668">n</a></span>&nbsp;<span class="op" id="6465263">=</span>&nbsp;<span class="ident" id="6465265"><a href="/testing/benchmark.go.html#6463469">max</a></span><span class="op" id="6465268">(</span><span class="ident" id="6465269"><a href="/testing/benchmark.go.html#6463405">min</a></span><span class="op" id="6465272">(</span><span class="ident" id="6465273"><a href="/testing/benchmark.go.html#6464668">n</a></span><span class="op" id="6465274">+</span><span class="ident" id="6465275"><a href="/testing/benchmark.go.html#6464668">n</a></span><span class="op" id="6465276">/</span><span class="num" id="6465277">5</span><span class="op" id="6465278">,</span>&nbsp;<span class="num" id="6465280">100</span><span class="op" id="6465283">*</span><span class="ident" id="6465284"><a href="/testing/benchmark.go.html#6464945">last</a></span><span class="op" id="6465288">)</span><span class="op" id="6465289">,</span>&nbsp;<span class="ident" id="6465291"><a href="/testing/benchmark.go.html#6464945">last</a></span><span class="op" id="6465295">+</span><span class="num" id="6465296">1</span><span class="op" id="6465297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6465301">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6465342"><a href="/testing/benchmark.go.html#6464668">n</a></span>&nbsp;<span class="op" id="6465344">=</span>&nbsp;<span class="ident" id="6465346"><a href="/testing/benchmark.go.html#6463877">roundUp</a></span><span class="op" id="6465353">(</span><span class="ident" id="6465354"><a href="/testing/benchmark.go.html#6464668">n</a></span><span class="op" id="6465355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6465359"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6465360">.</span><span class="ident" id="6465361">runN</span><span class="op" id="6465365">(</span><span class="ident" id="6465366"><a href="/testing/benchmark.go.html#6464668">n</a></span><span class="op" id="6465367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6465370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6465373"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6465374">.</span><span class="ident" id="6465375">result</span>&nbsp;<span class="op" id="6465382">=</span>&nbsp;<span class="ident" id="6465384"><a href="/testing/benchmark.go.html#6465494">BenchmarkResult</a></span><span class="op" id="6465399">{</span><span class="ident" id="6465400"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6465401">.</span><span class="ident" id="6465402">N</span><span class="op" id="6465403">,</span>&nbsp;<span class="ident" id="6465405"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6465406">.</span><span class="ident" id="6465407">duration</span><span class="op" id="6465415">,</span>&nbsp;<span class="ident" id="6465417"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6465418">.</span><span class="ident" id="6465419">bytes</span><span class="op" id="6465424">,</span>&nbsp;<span class="ident" id="6465426"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6465427">.</span><span class="ident" id="6465428">netAllocs</span><span class="op" id="6465437">,</span>&nbsp;<span class="ident" id="6465439"><a href="/testing/benchmark.go.html#6464581">b</a></span><span class="op" id="6465440">.</span><span class="ident" id="6465441">netBytes</span><span class="op" id="6465449">}</span><br>
<span class="lineno"></span><span class="op" id="6465451">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="6465454">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6465489">type</span>&nbsp;<span class="ident" id="6465494">BenchmarkResult</span>&nbsp;<span class="keyword" id="6465510">struct</span>&nbsp;<span class="op" id="6465517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6465520">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6465530">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6465544">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6465574">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465584"><a href="/testing/benchmark.go.html#6459941">time</a></span><span class="op" id="6465588">.</span><span class="ident" id="6465589">Duration</span>&nbsp;<span class="comment" id="6465598">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6465624">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465634">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6465648">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6465686">MemAllocs</span>&nbsp;<span class="ident" id="6465696">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6465710">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6465754">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="6465764">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6465778">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="6465818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6465821">func</span>&nbsp;<span class="op" id="6465826">(</span><span class="ident" id="6465827">r</span>&nbsp;<span class="ident" id="6465829"><a href="/testing/benchmark.go.html#6465494">BenchmarkResult</a></span><span class="op" id="6465844">)</span>&nbsp;<span class="ident" id="6465846">NsPerOp</span><span class="op" id="6465853">(</span><span class="op" id="6465854">)</span>&nbsp;<span class="ident" id="6465856">int64</span>&nbsp;<span class="op" id="6465862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6465865">if</span>&nbsp;<span class="ident" id="6465868"><a href="/testing/benchmark.go.html#6465827">r</a></span><span class="op" id="6465869">.</span><span class="ident" id="6465870">N</span>&nbsp;<span class="op" id="6465872">&lt;=</span>&nbsp;<span class="num" id="6465875">0</span>&nbsp;<span class="op" id="6465877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6465881">return</span>&nbsp;<span class="num" id="6465888">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6465891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6465894">return</span>&nbsp;<span class="ident" id="6465901"><a href="/testing/benchmark.go.html#6465827">r</a></span><span class="op" id="6465902">.</span><span class="ident" id="6465903">T</span><span class="op" id="6465904">.</span><span class="ident" id="6465905">Nanoseconds</span><span class="op" id="6465916">(</span><span class="op" id="6465917">)</span>&nbsp;<span class="op" id="6465919">/</span>&nbsp;<span class="ident" id="6465921">int64</span><span class="op" id="6465926">(</span><span class="ident" id="6465927"><a href="/testing/benchmark.go.html#6465827">r</a></span><span class="op" id="6465928">.</span><span class="ident" id="6465929">N</span><span class="op" id="6465930">)</span><br>
<span class="lineno">235</span><span class="op" id="6465932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6465935">func</span>&nbsp;<span class="op" id="6465940">(</span><span class="ident" id="6465941">r</span>&nbsp;<span class="ident" id="6465943"><a href="/testing/benchmark.go.html#6465494">BenchmarkResult</a></span><span class="op" id="6465958">)</span>&nbsp;<span class="ident" id="6465960">mbPerSec</span><span class="op" id="6465968">(</span><span class="op" id="6465969">)</span>&nbsp;<span class="builtintype" id="6465971">float64</span>&nbsp;<span class="op" id="6465979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6465982">if</span>&nbsp;<span class="ident" id="6465985"><a href="/testing/benchmark.go.html#6465941">r</a></span><span class="op" id="6465986">.</span><span class="ident" id="6465987">Bytes</span>&nbsp;<span class="op" id="6465993">&lt;=</span>&nbsp;<span class="num" id="6465996">0</span>&nbsp;<span class="op" id="6465998">||</span>&nbsp;<span class="ident" id="6466001"><a href="/testing/benchmark.go.html#6465941">r</a></span><span class="op" id="6466002">.</span><span class="ident" id="6466003">T</span>&nbsp;<span class="op" id="6466005">&lt;=</span>&nbsp;<span class="num" id="6466008">0</span>&nbsp;<span class="op" id="6466010">||</span>&nbsp;<span class="ident" id="6466013"><a href="/testing/benchmark.go.html#6465941">r</a></span><span class="op" id="6466014">.</span><span class="ident" id="6466015">N</span>&nbsp;<span class="op" id="6466017">&lt;=</span>&nbsp;<span class="num" id="6466020">0</span>&nbsp;<span class="op" id="6466022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466026">return</span>&nbsp;<span class="num" id="6466033">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6466036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466039">return</span>&nbsp;<span class="op" id="6466046">(</span><span class="builtintype" id="6466047">float64</span><span class="op" id="6466054">(</span><span class="ident" id="6466055"><a href="/testing/benchmark.go.html#6465941">r</a></span><span class="op" id="6466056">.</span><span class="ident" id="6466057">Bytes</span><span class="op" id="6466062">)</span>&nbsp;<span class="op" id="6466064">*</span>&nbsp;<span class="builtintype" id="6466066">float64</span><span class="op" id="6466073">(</span><span class="ident" id="6466074"><a href="/testing/benchmark.go.html#6465941">r</a></span><span class="op" id="6466075">.</span><span class="ident" id="6466076">N</span><span class="op" id="6466077">)</span>&nbsp;<span class="op" id="6466079">/</span>&nbsp;<span class="num" id="6466081">1e6</span><span class="op" id="6466084">)</span>&nbsp;<span class="op" id="6466086">/</span>&nbsp;<span class="ident" id="6466088"><a href="/testing/benchmark.go.html#6465941">r</a></span><span class="op" id="6466089">.</span><span class="ident" id="6466090">T</span><span class="op" id="6466091">.</span><span class="ident" id="6466092">Seconds</span><span class="op" id="6466099">(</span><span class="op" id="6466100">)</span><br>
<span class="lineno"></span><span class="op" id="6466102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6466105">func</span>&nbsp;<span class="op" id="6466110">(</span><span class="ident" id="6466111">r</span>&nbsp;<span class="ident" id="6466113"><a href="/testing/benchmark.go.html#6465494">BenchmarkResult</a></span><span class="op" id="6466128">)</span>&nbsp;<span class="ident" id="6466130">AllocsPerOp</span><span class="op" id="6466141">(</span><span class="op" id="6466142">)</span>&nbsp;<span class="ident" id="6466144">int64</span>&nbsp;<span class="op" id="6466150">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466153">if</span>&nbsp;<span class="ident" id="6466156"><a href="/testing/benchmark.go.html#6466111">r</a></span><span class="op" id="6466157">.</span><span class="ident" id="6466158">N</span>&nbsp;<span class="op" id="6466160">&lt;=</span>&nbsp;<span class="num" id="6466163">0</span>&nbsp;<span class="op" id="6466165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466169">return</span>&nbsp;<span class="num" id="6466176">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6466179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466182">return</span>&nbsp;<span class="ident" id="6466189">int64</span><span class="op" id="6466194">(</span><span class="ident" id="6466195"><a href="/testing/benchmark.go.html#6466111">r</a></span><span class="op" id="6466196">.</span><span class="ident" id="6466197">MemAllocs</span><span class="op" id="6466206">)</span>&nbsp;<span class="op" id="6466208">/</span>&nbsp;<span class="ident" id="6466210">int64</span><span class="op" id="6466215">(</span><span class="ident" id="6466216"><a href="/testing/benchmark.go.html#6466111">r</a></span><span class="op" id="6466217">.</span><span class="ident" id="6466218">N</span><span class="op" id="6466219">)</span><br>
<span class="lineno"></span><span class="op" id="6466221">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6466224">func</span>&nbsp;<span class="op" id="6466229">(</span><span class="ident" id="6466230">r</span>&nbsp;<span class="ident" id="6466232"><a href="/testing/benchmark.go.html#6465494">BenchmarkResult</a></span><span class="op" id="6466247">)</span>&nbsp;<span class="ident" id="6466249">AllocedBytesPerOp</span><span class="op" id="6466266">(</span><span class="op" id="6466267">)</span>&nbsp;<span class="ident" id="6466269">int64</span>&nbsp;<span class="op" id="6466275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466278">if</span>&nbsp;<span class="ident" id="6466281"><a href="/testing/benchmark.go.html#6466230">r</a></span><span class="op" id="6466282">.</span><span class="ident" id="6466283">N</span>&nbsp;<span class="op" id="6466285">&lt;=</span>&nbsp;<span class="num" id="6466288">0</span>&nbsp;<span class="op" id="6466290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466294">return</span>&nbsp;<span class="num" id="6466301">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6466304">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466307">return</span>&nbsp;<span class="ident" id="6466314">int64</span><span class="op" id="6466319">(</span><span class="ident" id="6466320"><a href="/testing/benchmark.go.html#6466230">r</a></span><span class="op" id="6466321">.</span><span class="ident" id="6466322">MemBytes</span><span class="op" id="6466330">)</span>&nbsp;<span class="op" id="6466332">/</span>&nbsp;<span class="ident" id="6466334">int64</span><span class="op" id="6466339">(</span><span class="ident" id="6466340"><a href="/testing/benchmark.go.html#6466230">r</a></span><span class="op" id="6466341">.</span><span class="ident" id="6466342">N</span><span class="op" id="6466343">)</span><br>
<span class="lineno"></span><span class="op" id="6466345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6466348">func</span>&nbsp;<span class="op" id="6466353">(</span><span class="ident" id="6466354">r</span>&nbsp;<span class="ident" id="6466356"><a href="/testing/benchmark.go.html#6465494">BenchmarkResult</a></span><span class="op" id="6466371">)</span>&nbsp;<span class="ident" id="6466373">String</span><span class="op" id="6466379">(</span><span class="op" id="6466380">)</span>&nbsp;<span class="builtintype" id="6466382">string</span>&nbsp;<span class="op" id="6466389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6466392">mbs</span>&nbsp;<span class="op" id="6466396">:=</span>&nbsp;<span class="ident" id="6466399"><a href="/testing/benchmark.go.html#6466354">r</a></span><span class="op" id="6466400">.</span><span class="ident" id="6466401">mbPerSec</span><span class="op" id="6466409">(</span><span class="op" id="6466410">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6466413">mb</span>&nbsp;<span class="op" id="6466416">:=</span>&nbsp;<span class="string" id="6466419">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466423">if</span>&nbsp;<span class="ident" id="6466426"><a href="/testing/benchmark.go.html#6466392">mbs</a></span>&nbsp;<span class="op" id="6466430">!=</span>&nbsp;<span class="num" id="6466433">0</span>&nbsp;<span class="op" id="6466435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6466439"><a href="/testing/benchmark.go.html#6466413">mb</a></span>&nbsp;<span class="op" id="6466442">=</span>&nbsp;<span class="ident" id="6466444"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6466447">.</span><span class="ident" id="6466448">Sprintf</span><span class="op" id="6466455">(</span><span class="string" id="6466456">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="6466470">,</span>&nbsp;<span class="ident" id="6466472"><a href="/testing/benchmark.go.html#6466392">mbs</a></span><span class="op" id="6466475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6466478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6466481">nsop</span>&nbsp;<span class="op" id="6466486">:=</span>&nbsp;<span class="ident" id="6466489"><a href="/testing/benchmark.go.html#6466354">r</a></span><span class="op" id="6466490">.</span><span class="ident" id="6466491">NsPerOp</span><span class="op" id="6466498">(</span><span class="op" id="6466499">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6466502">ns</span>&nbsp;<span class="op" id="6466505">:=</span>&nbsp;<span class="ident" id="6466508"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6466511">.</span><span class="ident" id="6466512">Sprintf</span><span class="op" id="6466519">(</span><span class="string" id="6466520">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="6466532">,</span>&nbsp;<span class="ident" id="6466534"><a href="/testing/benchmark.go.html#6466481">nsop</a></span><span class="op" id="6466538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466541">if</span>&nbsp;<span class="ident" id="6466544"><a href="/testing/benchmark.go.html#6466354">r</a></span><span class="op" id="6466545">.</span><span class="ident" id="6466546">N</span>&nbsp;<span class="op" id="6466548">&gt;</span>&nbsp;<span class="num" id="6466550">0</span>&nbsp;<span class="op" id="6466552">&amp;&amp;</span>&nbsp;<span class="ident" id="6466555"><a href="/testing/benchmark.go.html#6466481">nsop</a></span>&nbsp;<span class="op" id="6466560">&lt;</span>&nbsp;<span class="num" id="6466562">100</span>&nbsp;<span class="op" id="6466566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6466570">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6466617">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466678">if</span>&nbsp;<span class="ident" id="6466681"><a href="/testing/benchmark.go.html#6466481">nsop</a></span>&nbsp;<span class="op" id="6466686">&lt;</span>&nbsp;<span class="num" id="6466688">10</span>&nbsp;<span class="op" id="6466691">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6466696"><a href="/testing/benchmark.go.html#6466502">ns</a></span>&nbsp;<span class="op" id="6466699">=</span>&nbsp;<span class="ident" id="6466701"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6466704">.</span><span class="ident" id="6466705">Sprintf</span><span class="op" id="6466712">(</span><span class="string" id="6466713">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="6466727">,</span>&nbsp;<span class="builtintype" id="6466729">float64</span><span class="op" id="6466736">(</span><span class="ident" id="6466737"><a href="/testing/benchmark.go.html#6466354">r</a></span><span class="op" id="6466738">.</span><span class="ident" id="6466739">T</span><span class="op" id="6466740">.</span><span class="ident" id="6466741">Nanoseconds</span><span class="op" id="6466752">(</span><span class="op" id="6466753">)</span><span class="op" id="6466754">)</span><span class="op" id="6466755">/</span><span class="builtintype" id="6466756">float64</span><span class="op" id="6466763">(</span><span class="ident" id="6466764"><a href="/testing/benchmark.go.html#6466354">r</a></span><span class="op" id="6466765">.</span><span class="ident" id="6466766">N</span><span class="op" id="6466767">)</span><span class="op" id="6466768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6466772">}</span>&nbsp;<span class="keyword" id="6466774">else</span>&nbsp;<span class="op" id="6466779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6466784"><a href="/testing/benchmark.go.html#6466502">ns</a></span>&nbsp;<span class="op" id="6466787">=</span>&nbsp;<span class="ident" id="6466789"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6466792">.</span><span class="ident" id="6466793">Sprintf</span><span class="op" id="6466800">(</span><span class="string" id="6466801">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="6466815">,</span>&nbsp;<span class="builtintype" id="6466817">float64</span><span class="op" id="6466824">(</span><span class="ident" id="6466825"><a href="/testing/benchmark.go.html#6466354">r</a></span><span class="op" id="6466826">.</span><span class="ident" id="6466827">T</span><span class="op" id="6466828">.</span><span class="ident" id="6466829">Nanoseconds</span><span class="op" id="6466840">(</span><span class="op" id="6466841">)</span><span class="op" id="6466842">)</span><span class="op" id="6466843">/</span><span class="builtintype" id="6466844">float64</span><span class="op" id="6466851">(</span><span class="ident" id="6466852"><a href="/testing/benchmark.go.html#6466354">r</a></span><span class="op" id="6466853">.</span><span class="ident" id="6466854">N</span><span class="op" id="6466855">)</span><span class="op" id="6466856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6466860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6466863">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466866">return</span>&nbsp;<span class="ident" id="6466873"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6466876">.</span><span class="ident" id="6466877">Sprintf</span><span class="op" id="6466884">(</span><span class="string" id="6466885">&#34;%8d\t%s%s&#34;</span><span class="op" id="6466896">,</span>&nbsp;<span class="ident" id="6466898"><a href="/testing/benchmark.go.html#6466354">r</a></span><span class="op" id="6466899">.</span><span class="ident" id="6466900">N</span><span class="op" id="6466901">,</span>&nbsp;<span class="ident" id="6466903"><a href="/testing/benchmark.go.html#6466502">ns</a></span><span class="op" id="6466905">,</span>&nbsp;<span class="ident" id="6466907"><a href="/testing/benchmark.go.html#6466413">mb</a></span><span class="op" id="6466909">)</span><br>
<span class="lineno"></span><span class="op" id="6466911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6466914">func</span>&nbsp;<span class="op" id="6466919">(</span><span class="ident" id="6466920">r</span>&nbsp;<span class="ident" id="6466922"><a href="/testing/benchmark.go.html#6465494">BenchmarkResult</a></span><span class="op" id="6466937">)</span>&nbsp;<span class="ident" id="6466939">MemString</span><span class="op" id="6466948">(</span><span class="op" id="6466949">)</span>&nbsp;<span class="builtintype" id="6466951">string</span>&nbsp;<span class="op" id="6466958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6466961">return</span>&nbsp;<span class="ident" id="6466968"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6466971">.</span><span class="ident" id="6466972">Sprintf</span><span class="op" id="6466979">(</span><span class="string" id="6466980">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="6467005">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467009"><a href="/testing/benchmark.go.html#6466920">r</a></span><span class="op" id="6467010">.</span><span class="ident" id="6467011">AllocedBytesPerOp</span><span class="op" id="6467028">(</span><span class="op" id="6467029">)</span><span class="op" id="6467030">,</span>&nbsp;<span class="ident" id="6467032"><a href="/testing/benchmark.go.html#6466920">r</a></span><span class="op" id="6467033">.</span><span class="ident" id="6467034">AllocsPerOp</span><span class="op" id="6467045">(</span><span class="op" id="6467046">)</span><span class="op" id="6467047">)</span><br>
<span class="lineno"></span><span class="op" id="6467049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6467052">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6467145">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="6467174">func</span>&nbsp;<span class="ident" id="6467179">RunBenchmarks</span><span class="op" id="6467192">(</span><span class="ident" id="6467193">matchString</span>&nbsp;<span class="keyword" id="6467205">func</span><span class="op" id="6467209">(</span><span class="ident" id="6467210">pat</span><span class="op" id="6467213">,</span>&nbsp;<span class="ident" id="6467215">str</span>&nbsp;<span class="builtintype" id="6467219">string</span><span class="op" id="6467225">)</span>&nbsp;<span class="op" id="6467227">(</span><span class="builtintype" id="6467228">bool</span><span class="op" id="6467232">,</span>&nbsp;<span class="builtintype" id="6467234">error</span><span class="op" id="6467239">)</span><span class="op" id="6467240">,</span>&nbsp;<span class="ident" id="6467242">benchmarks</span>&nbsp;<span class="op" id="6467253">[</span><span class="op" id="6467254">]</span><span class="ident" id="6467255"><a href="/testing/benchmark.go.html#6460553">InternalBenchmark</a></span><span class="op" id="6467272">)</span>&nbsp;<span class="op" id="6467274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6467277">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6467329">if</span>&nbsp;<span class="builtinfunc" id="6467332">len</span><span class="op" id="6467335">(</span><span class="op" id="6467336">*</span><span class="ident" id="6467337"><a href="/testing/benchmark.go.html#6459955">matchBenchmarks</a></span><span class="op" id="6467352">)</span>&nbsp;<span class="op" id="6467354">==</span>&nbsp;<span class="num" id="6467357">0</span>&nbsp;<span class="op" id="6467359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6467363">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6467371">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6467374">for</span>&nbsp;<span class="ident" id="6467378">_</span><span class="op" id="6467379">,</span>&nbsp;<span class="ident" id="6467381">Benchmark</span>&nbsp;<span class="op" id="6467391">:=</span>&nbsp;<span class="keyword" id="6467394">range</span>&nbsp;<span class="ident" id="6467400"><a href="/testing/benchmark.go.html#6467242">benchmarks</a></span>&nbsp;<span class="op" id="6467411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467415">matched</span><span class="op" id="6467422">,</span>&nbsp;<span class="ident" id="6467424">err</span>&nbsp;<span class="op" id="6467428">:=</span>&nbsp;<span class="ident" id="6467431"><a href="/testing/benchmark.go.html#6467193">matchString</a></span><span class="op" id="6467442">(</span><span class="op" id="6467443">*</span><span class="ident" id="6467444"><a href="/testing/benchmark.go.html#6459955">matchBenchmarks</a></span><span class="op" id="6467459">,</span>&nbsp;<span class="ident" id="6467461"><a href="/testing/benchmark.go.html#6467381">Benchmark</a></span><span class="op" id="6467470">.</span><span class="ident" id="6467471">Name</span><span class="op" id="6467475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6467479">if</span>&nbsp;<span class="ident" id="6467482"><a href="/testing/benchmark.go.html#6467424">err</a></span>&nbsp;<span class="op" id="6467486">!=</span>&nbsp;<span class="ident" id="6467489">nil</span>&nbsp;<span class="op" id="6467493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467498"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6467501">.</span><span class="ident" id="6467502">Fprintf</span><span class="op" id="6467509">(</span><span class="ident" id="6467510"><a href="/testing/benchmark.go.html#6459901">os</a></span><span class="op" id="6467512">.</span><span class="ident" id="6467513">Stderr</span><span class="op" id="6467519">,</span>&nbsp;<span class="string" id="6467521">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="6467568">,</span>&nbsp;<span class="ident" id="6467570"><a href="/testing/benchmark.go.html#6467424">err</a></span><span class="op" id="6467573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467578"><a href="/testing/benchmark.go.html#6459901">os</a></span><span class="op" id="6467580">.</span><span class="ident" id="6467581">Exit</span><span class="op" id="6467585">(</span><span class="num" id="6467586">1</span><span class="op" id="6467587">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6467591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6467595">if</span>&nbsp;<span class="op" id="6467598">!</span><span class="ident" id="6467599"><a href="/testing/benchmark.go.html#6467415">matched</a></span>&nbsp;<span class="op" id="6467607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6467612">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6467623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6467627">for</span>&nbsp;<span class="ident" id="6467631">_</span><span class="op" id="6467632">,</span>&nbsp;<span class="ident" id="6467634">procs</span>&nbsp;<span class="op" id="6467640">:=</span>&nbsp;<span class="keyword" id="6467643">range</span>&nbsp;<span class="ident" id="6467649"><a href="/testing/testing.go.html#6484485">cpuList</a></span>&nbsp;<span class="op" id="6467657">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467662"><a href="/testing/benchmark.go.html#6459907">runtime</a></span><span class="op" id="6467669">.</span><span class="ident" id="6467670">GOMAXPROCS</span><span class="op" id="6467680">(</span><span class="ident" id="6467681"><a href="/testing/benchmark.go.html#6467634">procs</a></span><span class="op" id="6467686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467691">b</span>&nbsp;<span class="op" id="6467693">:=</span>&nbsp;<span class="op" id="6467696">&amp;</span><span class="ident" id="6467697"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6467698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467704">common</span><span class="op" id="6467710">:</span>&nbsp;<span class="ident" id="6467712"><a href="/testing/testing.go.html#6484606">common</a></span><span class="op" id="6467718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467725">signal</span><span class="op" id="6467731">:</span>&nbsp;<span class="builtinfunc" id="6467733">make</span><span class="op" id="6467737">(</span><span class="keyword" id="6467738">chan</span>&nbsp;<span class="keyword" id="6467743">interface</span><span class="op" id="6467752">{</span><span class="op" id="6467753">}</span><span class="op" id="6467754">)</span><span class="op" id="6467755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6467761">}</span><span class="op" id="6467762">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467768">benchmark</span><span class="op" id="6467777">:</span>&nbsp;<span class="ident" id="6467779"><a href="/testing/benchmark.go.html#6467381">Benchmark</a></span><span class="op" id="6467788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6467793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467798">benchName</span>&nbsp;<span class="op" id="6467808">:=</span>&nbsp;<span class="ident" id="6467811"><a href="/testing/benchmark.go.html#6467381">Benchmark</a></span><span class="op" id="6467820">.</span><span class="ident" id="6467821">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6467829">if</span>&nbsp;<span class="ident" id="6467832"><a href="/testing/benchmark.go.html#6467634">procs</a></span>&nbsp;<span class="op" id="6467838">!=</span>&nbsp;<span class="num" id="6467841">1</span>&nbsp;<span class="op" id="6467843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467849"><a href="/testing/benchmark.go.html#6467798">benchName</a></span>&nbsp;<span class="op" id="6467859">=</span>&nbsp;<span class="ident" id="6467861"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6467864">.</span><span class="ident" id="6467865">Sprintf</span><span class="op" id="6467872">(</span><span class="string" id="6467873">&#34;%s-%d&#34;</span><span class="op" id="6467880">,</span>&nbsp;<span class="ident" id="6467882"><a href="/testing/benchmark.go.html#6467381">Benchmark</a></span><span class="op" id="6467891">.</span><span class="ident" id="6467892">Name</span><span class="op" id="6467896">,</span>&nbsp;<span class="ident" id="6467898"><a href="/testing/benchmark.go.html#6467634">procs</a></span><span class="op" id="6467903">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6467908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467913"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6467916">.</span><span class="ident" id="6467917">Printf</span><span class="op" id="6467923">(</span><span class="string" id="6467924">&#34;%s\t&#34;</span><span class="op" id="6467930">,</span>&nbsp;<span class="ident" id="6467932"><a href="/testing/benchmark.go.html#6467798">benchName</a></span><span class="op" id="6467941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6467946">r</span>&nbsp;<span class="op" id="6467948">:=</span>&nbsp;<span class="ident" id="6467951"><a href="/testing/benchmark.go.html#6467691">b</a></span><span class="op" id="6467952">.</span><span class="ident" id="6467953">run</span><span class="op" id="6467956">(</span><span class="op" id="6467957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6467962">if</span>&nbsp;<span class="ident" id="6467965"><a href="/testing/benchmark.go.html#6467691">b</a></span><span class="op" id="6467966">.</span><span class="ident" id="6467967">failed</span>&nbsp;<span class="op" id="6467974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6467980">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6468043">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6468120">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6468149"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6468152">.</span><span class="ident" id="6468153">Printf</span><span class="op" id="6468159">(</span><span class="string" id="6468160">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="6468178">,</span>&nbsp;<span class="ident" id="6468180"><a href="/testing/benchmark.go.html#6467798">benchName</a></span><span class="op" id="6468189">,</span>&nbsp;<span class="ident" id="6468191"><a href="/testing/benchmark.go.html#6467691">b</a></span><span class="op" id="6468192">.</span><span class="ident" id="6468193">output</span><span class="op" id="6468199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6468205">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6468217">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6468222">results</span>&nbsp;<span class="op" id="6468230">:=</span>&nbsp;<span class="ident" id="6468233"><a href="/testing/benchmark.go.html#6467946">r</a></span><span class="op" id="6468234">.</span><span class="ident" id="6468235">String</span><span class="op" id="6468241">(</span><span class="op" id="6468242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6468247">if</span>&nbsp;<span class="op" id="6468250">*</span><span class="ident" id="6468251"><a href="/testing/benchmark.go.html#6460163">benchmarkMemory</a></span>&nbsp;<span class="op" id="6468267">||</span>&nbsp;<span class="ident" id="6468270"><a href="/testing/benchmark.go.html#6467691">b</a></span><span class="op" id="6468271">.</span><span class="ident" id="6468272">showAllocResult</span>&nbsp;<span class="op" id="6468288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6468294"><a href="/testing/benchmark.go.html#6468222">results</a></span>&nbsp;<span class="op" id="6468302">+=</span>&nbsp;<span class="string" id="6468305">&#34;\t&#34;</span>&nbsp;<span class="op" id="6468310">+</span>&nbsp;<span class="ident" id="6468312"><a href="/testing/benchmark.go.html#6467946">r</a></span><span class="op" id="6468313">.</span><span class="ident" id="6468314">MemString</span><span class="op" id="6468323">(</span><span class="op" id="6468324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6468329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6468334"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6468337">.</span><span class="ident" id="6468338">Println</span><span class="op" id="6468345">(</span><span class="ident" id="6468346"><a href="/testing/benchmark.go.html#6468222">results</a></span><span class="op" id="6468353">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6468358">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6468438">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6468511">if</span>&nbsp;<span class="builtinfunc" id="6468514">len</span><span class="op" id="6468517">(</span><span class="ident" id="6468518"><a href="/testing/benchmark.go.html#6467691">b</a></span><span class="op" id="6468519">.</span><span class="ident" id="6468520">output</span><span class="op" id="6468526">)</span>&nbsp;<span class="op" id="6468528">&gt;</span>&nbsp;<span class="num" id="6468530">0</span>&nbsp;<span class="op" id="6468532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6468538"><a href="/testing/benchmark.go.html#6467691">b</a></span><span class="op" id="6468539">.</span><span class="ident" id="6468540">trimOutput</span><span class="op" id="6468550">(</span><span class="op" id="6468551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6468557"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6468560">.</span><span class="ident" id="6468561">Printf</span><span class="op" id="6468567">(</span><span class="string" id="6468568">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="6468587">,</span>&nbsp;<span class="ident" id="6468589"><a href="/testing/benchmark.go.html#6467798">benchName</a></span><span class="op" id="6468598">,</span>&nbsp;<span class="ident" id="6468600"><a href="/testing/benchmark.go.html#6467691">b</a></span><span class="op" id="6468601">.</span><span class="ident" id="6468602">output</span><span class="op" id="6468608">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6468613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6468618">if</span>&nbsp;<span class="ident" id="6468621">p</span>&nbsp;<span class="op" id="6468623">:=</span>&nbsp;<span class="ident" id="6468626"><a href="/testing/benchmark.go.html#6459907">runtime</a></span><span class="op" id="6468633">.</span><span class="ident" id="6468634">GOMAXPROCS</span><span class="op" id="6468644">(</span><span class="op" id="6468645">-</span><span class="num" id="6468646">1</span><span class="op" id="6468647">)</span><span class="op" id="6468648">;</span>&nbsp;<span class="ident" id="6468650"><a href="/testing/benchmark.go.html#6468621">p</a></span>&nbsp;<span class="op" id="6468652">!=</span>&nbsp;<span class="ident" id="6468655"><a href="/testing/benchmark.go.html#6467634">procs</a></span>&nbsp;<span class="op" id="6468661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6468667"><a href="/testing/benchmark.go.html#6459894">fmt</a></span><span class="op" id="6468670">.</span><span class="ident" id="6468671">Fprintf</span><span class="op" id="6468678">(</span><span class="ident" id="6468679"><a href="/testing/benchmark.go.html#6459901">os</a></span><span class="op" id="6468681">.</span><span class="ident" id="6468682">Stderr</span><span class="op" id="6468688">,</span>&nbsp;<span class="string" id="6468690">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="6468731">,</span>&nbsp;<span class="ident" id="6468733"><a href="/testing/benchmark.go.html#6467798">benchName</a></span><span class="op" id="6468742">,</span>&nbsp;<span class="ident" id="6468744"><a href="/testing/benchmark.go.html#6468621">p</a></span><span class="op" id="6468745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6468750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6468754">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6468757">}</span><br>
<span class="lineno"></span><span class="op" id="6468759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6468762">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="6468838">func</span>&nbsp;<span class="op" id="6468843">(</span><span class="ident" id="6468844">b</span>&nbsp;<span class="op" id="6468846">*</span><span class="ident" id="6468847"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6468848">)</span>&nbsp;<span class="ident" id="6468850">trimOutput</span><span class="op" id="6468860">(</span><span class="op" id="6468861">)</span>&nbsp;<span class="op" id="6468863">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6468866">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6468938">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6469018">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6469102">const</span>&nbsp;<span class="ident" id="6469108">maxNewlines</span>&nbsp;<span class="op" id="6469120">=</span>&nbsp;<span class="num" id="6469122">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6469126">for</span>&nbsp;<span class="ident" id="6469130">nlCount</span><span class="op" id="6469137">,</span>&nbsp;<span class="ident" id="6469139">j</span>&nbsp;<span class="op" id="6469141">:=</span>&nbsp;<span class="num" id="6469144">0</span><span class="op" id="6469145">,</span>&nbsp;<span class="num" id="6469147">0</span><span class="op" id="6469148">;</span>&nbsp;<span class="ident" id="6469150"><a href="/testing/benchmark.go.html#6469139">j</a></span>&nbsp;<span class="op" id="6469152">&lt;</span>&nbsp;<span class="builtinfunc" id="6469154">len</span><span class="op" id="6469157">(</span><span class="ident" id="6469158"><a href="/testing/benchmark.go.html#6468844">b</a></span><span class="op" id="6469159">.</span><span class="ident" id="6469160">output</span><span class="op" id="6469166">)</span><span class="op" id="6469167">;</span>&nbsp;<span class="ident" id="6469169"><a href="/testing/benchmark.go.html#6469139">j</a></span><span class="op" id="6469170">++</span>&nbsp;<span class="op" id="6469173">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6469177">if</span>&nbsp;<span class="ident" id="6469180"><a href="/testing/benchmark.go.html#6468844">b</a></span><span class="op" id="6469181">.</span><span class="ident" id="6469182">output</span><span class="op" id="6469188">[</span><span class="ident" id="6469189"><a href="/testing/benchmark.go.html#6469139">j</a></span><span class="op" id="6469190">]</span>&nbsp;<span class="op" id="6469192">==</span>&nbsp;<span class="string" id="6469195">&#39;\n&#39;</span>&nbsp;<span class="op" id="6469200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6469205"><a href="/testing/benchmark.go.html#6469130">nlCount</a></span><span class="op" id="6469212">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6469218">if</span>&nbsp;<span class="ident" id="6469221"><a href="/testing/benchmark.go.html#6469130">nlCount</a></span>&nbsp;<span class="op" id="6469229">&gt;=</span>&nbsp;<span class="ident" id="6469232"><a href="/testing/benchmark.go.html#6469108">maxNewlines</a></span>&nbsp;<span class="op" id="6469244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6469250"><a href="/testing/benchmark.go.html#6468844">b</a></span><span class="op" id="6469251">.</span><span class="ident" id="6469252">output</span>&nbsp;<span class="op" id="6469259">=</span>&nbsp;<span class="builtinfunc" id="6469261">append</span><span class="op" id="6469267">(</span><span class="ident" id="6469268"><a href="/testing/benchmark.go.html#6468844">b</a></span><span class="op" id="6469269">.</span><span class="ident" id="6469270">output</span><span class="op" id="6469276">[</span><span class="op" id="6469277">:</span><span class="ident" id="6469278"><a href="/testing/benchmark.go.html#6469139">j</a></span><span class="op" id="6469279">]</span><span class="op" id="6469280">,</span>&nbsp;<span class="string" id="6469282">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="6469312">...</span><span class="op" id="6469315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6469321">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6469330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6469334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6469337">}</span><br>
<span class="lineno"></span><span class="op" id="6469339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6469342">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="6469406">type</span>&nbsp;<span class="ident" id="6469411">PB</span>&nbsp;<span class="keyword" id="6469414">struct</span>&nbsp;<span class="op" id="6469421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6469424">globalN</span>&nbsp;<span class="op" id="6469432">*</span><span class="ident" id="6469433">uint64</span>&nbsp;<span class="comment" id="6469440">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6469499">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6469507">uint64</span>&nbsp;&nbsp;<span class="comment" id="6469515">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6469569">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6469577">uint64</span>&nbsp;&nbsp;<span class="comment" id="6469585">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6469624">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6469632">uint64</span>&nbsp;&nbsp;<span class="comment" id="6469640">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="6469687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6469690">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="6469752">func</span>&nbsp;<span class="op" id="6469757">(</span><span class="ident" id="6469758">pb</span>&nbsp;<span class="op" id="6469761">*</span><span class="ident" id="6469762"><a href="/testing/benchmark.go.html#6469411">PB</a></span><span class="op" id="6469764">)</span>&nbsp;<span class="ident" id="6469766">Next</span><span class="op" id="6469770">(</span><span class="op" id="6469771">)</span>&nbsp;<span class="builtintype" id="6469773">bool</span>&nbsp;<span class="op" id="6469778">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6469781">if</span>&nbsp;<span class="ident" id="6469784"><a href="/testing/benchmark.go.html#6469758">pb</a></span><span class="op" id="6469786">.</span><span class="ident" id="6469787">cache</span>&nbsp;<span class="op" id="6469793">==</span>&nbsp;<span class="num" id="6469796">0</span>&nbsp;<span class="op" id="6469798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6469802">n</span>&nbsp;<span class="op" id="6469804">:=</span>&nbsp;<span class="ident" id="6469807"><a href="/testing/benchmark.go.html#6459926">atomic</a></span><span class="op" id="6469813">.</span><span class="ident" id="6469814">AddUint64</span><span class="op" id="6469823">(</span><span class="ident" id="6469824"><a href="/testing/benchmark.go.html#6469758">pb</a></span><span class="op" id="6469826">.</span><span class="ident" id="6469827">globalN</span><span class="op" id="6469834">,</span>&nbsp;<span class="ident" id="6469836"><a href="/testing/benchmark.go.html#6469758">pb</a></span><span class="op" id="6469838">.</span><span class="ident" id="6469839">grain</span><span class="op" id="6469844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6469848">if</span>&nbsp;<span class="ident" id="6469851"><a href="/testing/benchmark.go.html#6469802">n</a></span>&nbsp;<span class="op" id="6469853">&lt;=</span>&nbsp;<span class="ident" id="6469856"><a href="/testing/benchmark.go.html#6469758">pb</a></span><span class="op" id="6469858">.</span><span class="ident" id="6469859">bN</span>&nbsp;<span class="op" id="6469862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6469867"><a href="/testing/benchmark.go.html#6469758">pb</a></span><span class="op" id="6469869">.</span><span class="ident" id="6469870">cache</span>&nbsp;<span class="op" id="6469876">=</span>&nbsp;<span class="ident" id="6469878"><a href="/testing/benchmark.go.html#6469758">pb</a></span><span class="op" id="6469880">.</span><span class="ident" id="6469881">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6469889">}</span>&nbsp;<span class="keyword" id="6469891">else</span>&nbsp;<span class="keyword" id="6469896">if</span>&nbsp;<span class="ident" id="6469899"><a href="/testing/benchmark.go.html#6469802">n</a></span>&nbsp;<span class="op" id="6469901">&lt;</span>&nbsp;<span class="ident" id="6469903"><a href="/testing/benchmark.go.html#6469758">pb</a></span><span class="op" id="6469905">.</span><span class="ident" id="6469906">bN</span><span class="op" id="6469908">+</span><span class="ident" id="6469909"><a href="/testing/benchmark.go.html#6469758">pb</a></span><span class="op" id="6469911">.</span><span class="ident" id="6469912">grain</span>&nbsp;<span class="op" id="6469918">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6469923"><a href="/testing/benchmark.go.html#6469758">pb</a></span><span class="op" id="6469925">.</span><span class="ident" id="6469926">cache</span>&nbsp;<span class="op" id="6469932">=</span>&nbsp;<span class="ident" id="6469934"><a href="/testing/benchmark.go.html#6469758">pb</a></span><span class="op" id="6469936">.</span><span class="ident" id="6469937">bN</span>&nbsp;<span class="op" id="6469940">+</span>&nbsp;<span class="ident" id="6469942"><a href="/testing/benchmark.go.html#6469758">pb</a></span><span class="op" id="6469944">.</span><span class="ident" id="6469945">grain</span>&nbsp;<span class="op" id="6469951">-</span>&nbsp;<span class="ident" id="6469953"><a href="/testing/benchmark.go.html#6469802">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6469957">}</span>&nbsp;<span class="keyword" id="6469959">else</span>&nbsp;<span class="op" id="6469964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6469969">return</span>&nbsp;<span class="ident" id="6469976">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6469984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6469987">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6469990"><a href="/testing/benchmark.go.html#6469758">pb</a></span><span class="op" id="6469992">.</span><span class="ident" id="6469993">cache</span><span class="op" id="6469998">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6470002">return</span>&nbsp;<span class="ident" id="6470009">true</span><br>
<span class="lineno"></span><span class="op" id="6470014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6470017">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="6470062">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="6470139">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6470219">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="6470288">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="6470347">//</span><br>
<span class="lineno">385</span><span class="comment" id="6470350">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6470423">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="6470494">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="6470567">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="6470603">func</span>&nbsp;<span class="op" id="6470608">(</span><span class="ident" id="6470609">b</span>&nbsp;<span class="op" id="6470611">*</span><span class="ident" id="6470612"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6470613">)</span>&nbsp;<span class="ident" id="6470615">RunParallel</span><span class="op" id="6470626">(</span><span class="ident" id="6470627">body</span>&nbsp;<span class="keyword" id="6470632">func</span><span class="op" id="6470636">(</span><span class="op" id="6470637">*</span><span class="ident" id="6470638"><a href="/testing/benchmark.go.html#6469411">PB</a></span><span class="op" id="6470640">)</span><span class="op" id="6470641">)</span>&nbsp;<span class="op" id="6470643">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6470646">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100µs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6470714">//&nbsp;100µs&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6470783">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6470811">grain</span>&nbsp;<span class="op" id="6470817">:=</span>&nbsp;<span class="ident" id="6470820">uint64</span><span class="op" id="6470826">(</span><span class="num" id="6470827">0</span><span class="op" id="6470828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6470831">if</span>&nbsp;<span class="ident" id="6470834"><a href="/testing/benchmark.go.html#6470609">b</a></span><span class="op" id="6470835">.</span><span class="ident" id="6470836">previousN</span>&nbsp;<span class="op" id="6470846">&gt;</span>&nbsp;<span class="num" id="6470848">0</span>&nbsp;<span class="op" id="6470850">&amp;&amp;</span>&nbsp;<span class="ident" id="6470853"><a href="/testing/benchmark.go.html#6470609">b</a></span><span class="op" id="6470854">.</span><span class="ident" id="6470855">previousDuration</span>&nbsp;<span class="op" id="6470872">&gt;</span>&nbsp;<span class="num" id="6470874">0</span>&nbsp;<span class="op" id="6470876">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6470880"><a href="/testing/benchmark.go.html#6470811">grain</a></span>&nbsp;<span class="op" id="6470886">=</span>&nbsp;<span class="num" id="6470888">1e5</span>&nbsp;<span class="op" id="6470892">*</span>&nbsp;<span class="ident" id="6470894">uint64</span><span class="op" id="6470900">(</span><span class="ident" id="6470901"><a href="/testing/benchmark.go.html#6470609">b</a></span><span class="op" id="6470902">.</span><span class="ident" id="6470903">previousN</span><span class="op" id="6470912">)</span>&nbsp;<span class="op" id="6470914">/</span>&nbsp;<span class="ident" id="6470916">uint64</span><span class="op" id="6470922">(</span><span class="ident" id="6470923"><a href="/testing/benchmark.go.html#6470609">b</a></span><span class="op" id="6470924">.</span><span class="ident" id="6470925">previousDuration</span><span class="op" id="6470941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6470944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6470947">if</span>&nbsp;<span class="ident" id="6470950"><a href="/testing/benchmark.go.html#6470811">grain</a></span>&nbsp;<span class="op" id="6470956">&lt;</span>&nbsp;<span class="num" id="6470958">1</span>&nbsp;<span class="op" id="6470960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6470964"><a href="/testing/benchmark.go.html#6470811">grain</a></span>&nbsp;<span class="op" id="6470970">=</span>&nbsp;<span class="num" id="6470972">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6470975">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6470978">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6471048">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100µs/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6471103">if</span>&nbsp;<span class="ident" id="6471106"><a href="/testing/benchmark.go.html#6470811">grain</a></span>&nbsp;<span class="op" id="6471112">&gt;</span>&nbsp;<span class="num" id="6471114">1e4</span>&nbsp;<span class="op" id="6471118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471122"><a href="/testing/benchmark.go.html#6470811">grain</a></span>&nbsp;<span class="op" id="6471128">=</span>&nbsp;<span class="num" id="6471130">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6471135">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471139">n</span>&nbsp;<span class="op" id="6471141">:=</span>&nbsp;<span class="ident" id="6471144">uint64</span><span class="op" id="6471150">(</span><span class="num" id="6471151">0</span><span class="op" id="6471152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471155">numProcs</span>&nbsp;<span class="op" id="6471164">:=</span>&nbsp;<span class="ident" id="6471167"><a href="/testing/benchmark.go.html#6470609">b</a></span><span class="op" id="6471168">.</span><span class="ident" id="6471169">parallelism</span>&nbsp;<span class="op" id="6471181">*</span>&nbsp;<span class="ident" id="6471183"><a href="/testing/benchmark.go.html#6459907">runtime</a></span><span class="op" id="6471190">.</span><span class="ident" id="6471191">GOMAXPROCS</span><span class="op" id="6471201">(</span><span class="num" id="6471202">0</span><span class="op" id="6471203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6471206">var</span>&nbsp;<span class="ident" id="6471210">wg</span>&nbsp;<span class="ident" id="6471213"><a href="/testing/benchmark.go.html#6459918">sync</a></span><span class="op" id="6471217">.</span><span class="ident" id="6471218">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471229"><a href="/testing/benchmark.go.html#6471210">wg</a></span><span class="op" id="6471231">.</span><span class="ident" id="6471232">Add</span><span class="op" id="6471235">(</span><span class="ident" id="6471236"><a href="/testing/benchmark.go.html#6471155">numProcs</a></span><span class="op" id="6471244">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6471247">for</span>&nbsp;<span class="ident" id="6471251">p</span>&nbsp;<span class="op" id="6471253">:=</span>&nbsp;<span class="num" id="6471256">0</span><span class="op" id="6471257">;</span>&nbsp;<span class="ident" id="6471259"><a href="/testing/benchmark.go.html#6471251">p</a></span>&nbsp;<span class="op" id="6471261">&lt;</span>&nbsp;<span class="ident" id="6471263"><a href="/testing/benchmark.go.html#6471155">numProcs</a></span><span class="op" id="6471271">;</span>&nbsp;<span class="ident" id="6471273"><a href="/testing/benchmark.go.html#6471251">p</a></span><span class="op" id="6471274">++</span>&nbsp;<span class="op" id="6471277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6471281">go</span>&nbsp;<span class="keyword" id="6471284">func</span><span class="op" id="6471288">(</span><span class="op" id="6471289">)</span>&nbsp;<span class="op" id="6471291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6471296">defer</span>&nbsp;<span class="ident" id="6471302"><a href="/testing/benchmark.go.html#6471210">wg</a></span><span class="op" id="6471304">.</span><span class="ident" id="6471305">Done</span><span class="op" id="6471309">(</span><span class="op" id="6471310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471315">pb</span>&nbsp;<span class="op" id="6471318">:=</span>&nbsp;<span class="op" id="6471321">&amp;</span><span class="ident" id="6471322"><a href="/testing/benchmark.go.html#6469411">PB</a></span><span class="op" id="6471324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471330">globalN</span><span class="op" id="6471337">:</span>&nbsp;<span class="op" id="6471339">&amp;</span><span class="ident" id="6471340"><a href="/testing/benchmark.go.html#6471139">n</a></span><span class="op" id="6471341">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471347">grain</span><span class="op" id="6471352">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6471356"><a href="/testing/benchmark.go.html#6470811">grain</a></span><span class="op" id="6471361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471367">bN</span><span class="op" id="6471369">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6471376">uint64</span><span class="op" id="6471382">(</span><span class="ident" id="6471383"><a href="/testing/benchmark.go.html#6470609">b</a></span><span class="op" id="6471384">.</span><span class="ident" id="6471385">N</span><span class="op" id="6471386">)</span><span class="op" id="6471387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6471392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471397"><a href="/testing/benchmark.go.html#6470627">body</a></span><span class="op" id="6471401">(</span><span class="ident" id="6471402"><a href="/testing/benchmark.go.html#6471315">pb</a></span><span class="op" id="6471404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6471408">}</span><span class="op" id="6471409">(</span><span class="op" id="6471410">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6471413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471416"><a href="/testing/benchmark.go.html#6471210">wg</a></span><span class="op" id="6471418">.</span><span class="ident" id="6471419">Wait</span><span class="op" id="6471423">(</span><span class="op" id="6471424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6471427">if</span>&nbsp;<span class="ident" id="6471430"><a href="/testing/benchmark.go.html#6471139">n</a></span>&nbsp;<span class="op" id="6471432">&lt;=</span>&nbsp;<span class="ident" id="6471435">uint64</span><span class="op" id="6471441">(</span><span class="ident" id="6471442"><a href="/testing/benchmark.go.html#6470609">b</a></span><span class="op" id="6471443">.</span><span class="ident" id="6471444">N</span><span class="op" id="6471445">)</span>&nbsp;<span class="op" id="6471447">&amp;&amp;</span>&nbsp;<span class="op" id="6471450">!</span><span class="ident" id="6471451"><a href="/testing/benchmark.go.html#6470609">b</a></span><span class="op" id="6471452">.</span><span class="ident" id="6471453">Failed</span><span class="op" id="6471459">(</span><span class="op" id="6471460">)</span>&nbsp;<span class="op" id="6471462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471466"><a href="/testing/benchmark.go.html#6470609">b</a></span><span class="op" id="6471467">.</span><span class="ident" id="6471468">Fatal</span><span class="op" id="6471473">(</span><span class="string" id="6471474">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="6471527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6471530">}</span><br>
<span class="lineno">425</span><span class="op" id="6471532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6471535">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="6471620">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="6471697">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="6471752">func</span>&nbsp;<span class="op" id="6471757">(</span><span class="ident" id="6471758">b</span>&nbsp;<span class="op" id="6471760">*</span><span class="ident" id="6471761"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6471762">)</span>&nbsp;<span class="ident" id="6471764">SetParallelism</span><span class="op" id="6471778">(</span><span class="ident" id="6471779">p</span>&nbsp;<span class="builtintype" id="6471781">int</span><span class="op" id="6471784">)</span>&nbsp;<span class="op" id="6471786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6471789">if</span>&nbsp;<span class="ident" id="6471792"><a href="/testing/benchmark.go.html#6471779">p</a></span>&nbsp;<span class="op" id="6471794">&gt;=</span>&nbsp;<span class="num" id="6471797">1</span>&nbsp;<span class="op" id="6471799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471803"><a href="/testing/benchmark.go.html#6471758">b</a></span><span class="op" id="6471804">.</span><span class="ident" id="6471805">parallelism</span>&nbsp;<span class="op" id="6471817">=</span>&nbsp;<span class="ident" id="6471819"><a href="/testing/benchmark.go.html#6471779">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6471822">}</span><br>
<span class="lineno"></span><span class="op" id="6471824">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="6471827">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="6471890">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6471950">func</span>&nbsp;<span class="ident" id="6471955">Benchmark</span><span class="op" id="6471964">(</span><span class="ident" id="6471965">f</span>&nbsp;<span class="keyword" id="6471967">func</span><span class="op" id="6471971">(</span><span class="ident" id="6471972">b</span>&nbsp;<span class="op" id="6471974">*</span><span class="ident" id="6471975"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6471976">)</span><span class="op" id="6471977">)</span>&nbsp;<span class="ident" id="6471979"><a href="/testing/benchmark.go.html#6465494">BenchmarkResult</a></span>&nbsp;<span class="op" id="6471995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6471998">b</span>&nbsp;<span class="op" id="6472000">:=</span>&nbsp;<span class="op" id="6472003">&amp;</span><span class="ident" id="6472004"><a href="/testing/benchmark.go.html#6460741">B</a></span><span class="op" id="6472005">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6472009">common</span><span class="op" id="6472015">:</span>&nbsp;<span class="ident" id="6472017"><a href="/testing/testing.go.html#6484606">common</a></span><span class="op" id="6472023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6472028">signal</span><span class="op" id="6472034">:</span>&nbsp;<span class="builtinfunc" id="6472036">make</span><span class="op" id="6472040">(</span><span class="keyword" id="6472041">chan</span>&nbsp;<span class="keyword" id="6472046">interface</span><span class="op" id="6472055">{</span><span class="op" id="6472056">}</span><span class="op" id="6472057">)</span><span class="op" id="6472058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6472062">}</span><span class="op" id="6472063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6472067">benchmark</span><span class="op" id="6472076">:</span>&nbsp;<span class="ident" id="6472078"><a href="/testing/benchmark.go.html#6460553">InternalBenchmark</a></span><span class="op" id="6472095">{</span><span class="string" id="6472096">&#34;&#34;</span><span class="op" id="6472098">,</span>&nbsp;<span class="ident" id="6472100"><a href="/testing/benchmark.go.html#6471965">f</a></span><span class="op" id="6472101">}</span><span class="op" id="6472102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6472105">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6472108">return</span>&nbsp;<span class="ident" id="6472115"><a href="/testing/benchmark.go.html#6471998">b</a></span><span class="op" id="6472116">.</span><span class="ident" id="6472117">run</span><span class="op" id="6472120">(</span><span class="op" id="6472121">)</span><br>
<span class="lineno"></span><span class="op" id="6472123">}</span>
</div>
</body>
</html>
