<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4152273">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4152329">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4152383">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4152434">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4152512">package</span>&nbsp;<span class="ident" id="4152520">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4152525">import</span>&nbsp;<span class="op" id="4152532">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4152535">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4152541">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4152552">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4152559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4152562">//&nbsp;A&nbsp;sockaddr&nbsp;represents&nbsp;a&nbsp;TCP,&nbsp;UDP,&nbsp;IP&nbsp;or&nbsp;Unix&nbsp;network&nbsp;endpoint</span><br>
<span class="lineno"></span><span class="comment" id="4152627">//&nbsp;address&nbsp;that&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall.Sockaddr.</span><br>
<span class="lineno"></span><span class="keyword" id="4152685">type</span>&nbsp;<span class="ident" id="4152690">sockaddr</span>&nbsp;<span class="keyword" id="4152699">interface</span>&nbsp;<span class="op" id="4152709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152712">Addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152719">netaddr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152729">//&nbsp;family&nbsp;returns&nbsp;the&nbsp;platform-dependent&nbsp;address&nbsp;family</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152786">//&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152802">family</span><span class="op" id="4152808">(</span><span class="op" id="4152809">)</span>&nbsp;<span class="builtintype" id="4152811">int</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152817">//&nbsp;isWildcard&nbsp;reports&nbsp;whether&nbsp;the&nbsp;address&nbsp;is&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152874">//&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152887">isWildcard</span><span class="op" id="4152897">(</span><span class="op" id="4152898">)</span>&nbsp;<span class="builtintype" id="4152900">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152907">//&nbsp;sockaddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152965">//&nbsp;sockaddr&nbsp;type&nbsp;that&nbsp;implements&nbsp;syscall.Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153016">//&nbsp;interface.&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153078">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153087">sockaddr</span><span class="op" id="4153095">(</span><span class="ident" id="4153096">family</span>&nbsp;<span class="builtintype" id="4153103">int</span><span class="op" id="4153106">)</span>&nbsp;<span class="op" id="4153108">(</span><span class="ident" id="4153109">syscall</span><span class="op" id="4153116">.</span><span class="ident" id="4153117">Sockaddr</span><span class="op" id="4153125">,</span>&nbsp;<span class="builtintype" id="4153127">error</span><span class="op" id="4153132">)</span><br>
<span class="lineno">35</span><span class="op" id="4153134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4153137">//&nbsp;socket&nbsp;returns&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;is&nbsp;ready&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4153199">//&nbsp;asynchronous&nbsp;I/O&nbsp;using&nbsp;the&nbsp;network&nbsp;poller.</span><br>
<span class="lineno"></span><span class="keyword" id="4153245">func</span>&nbsp;<span class="ident" id="4153250">socket</span><span class="op" id="4153256">(</span><span class="ident" id="4153257">net</span>&nbsp;<span class="builtintype" id="4153261">string</span><span class="op" id="4153267">,</span>&nbsp;<span class="ident" id="4153269">family</span><span class="op" id="4153275">,</span>&nbsp;<span class="ident" id="4153277">sotype</span><span class="op" id="4153283">,</span>&nbsp;<span class="ident" id="4153285">proto</span>&nbsp;<span class="builtintype" id="4153291">int</span><span class="op" id="4153294">,</span>&nbsp;<span class="ident" id="4153296">ipv6only</span>&nbsp;<span class="builtintype" id="4153305">bool</span><span class="op" id="4153309">,</span>&nbsp;<span class="ident" id="4153311">laddr</span><span class="op" id="4153316">,</span>&nbsp;<span class="ident" id="4153318">raddr</span>&nbsp;<span class="ident" id="4153324">sockaddr</span><span class="op" id="4153332">,</span>&nbsp;<span class="ident" id="4153334">deadline</span>&nbsp;<span class="ident" id="4153343">time</span><span class="op" id="4153347">.</span><span class="ident" id="4153348">Time</span><span class="op" id="4153352">)</span>&nbsp;<span class="op" id="4153354">(</span><span class="ident" id="4153355">fd</span>&nbsp;<span class="op" id="4153358">*</span><span class="ident" id="4153359">netFD</span><span class="op" id="4153364">,</span>&nbsp;<span class="ident" id="4153366">err</span>&nbsp;<span class="builtintype" id="4153370">error</span><span class="op" id="4153375">)</span>&nbsp;<span class="op" id="4153377">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153380">s</span><span class="op" id="4153381">,</span>&nbsp;<span class="ident" id="4153383">err</span>&nbsp;<span class="op" id="4153387">:=</span>&nbsp;<span class="ident" id="4153390">sysSocket</span><span class="op" id="4153399">(</span><span class="ident" id="4153400">family</span><span class="op" id="4153406">,</span>&nbsp;<span class="ident" id="4153408">sotype</span><span class="op" id="4153414">,</span>&nbsp;<span class="ident" id="4153416">proto</span><span class="op" id="4153421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153424">if</span>&nbsp;<span class="ident" id="4153427">err</span>&nbsp;<span class="op" id="4153431">!=</span>&nbsp;<span class="ident" id="4153434">nil</span>&nbsp;<span class="op" id="4153438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153442">return</span>&nbsp;<span class="ident" id="4153449">nil</span><span class="op" id="4153452">,</span>&nbsp;<span class="ident" id="4153454">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4153459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153462">if</span>&nbsp;<span class="ident" id="4153465">err</span>&nbsp;<span class="op" id="4153469">=</span>&nbsp;<span class="ident" id="4153471">setDefaultSockopts</span><span class="op" id="4153489">(</span><span class="ident" id="4153490">s</span><span class="op" id="4153491">,</span>&nbsp;<span class="ident" id="4153493">family</span><span class="op" id="4153499">,</span>&nbsp;<span class="ident" id="4153501">sotype</span><span class="op" id="4153507">,</span>&nbsp;<span class="ident" id="4153509">ipv6only</span><span class="op" id="4153517">)</span><span class="op" id="4153518">;</span>&nbsp;<span class="ident" id="4153520">err</span>&nbsp;<span class="op" id="4153524">!=</span>&nbsp;<span class="ident" id="4153527">nil</span>&nbsp;<span class="op" id="4153531">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153535">closesocket</span><span class="op" id="4153546">(</span><span class="ident" id="4153547">s</span><span class="op" id="4153548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153552">return</span>&nbsp;<span class="ident" id="4153559">nil</span><span class="op" id="4153562">,</span>&nbsp;<span class="ident" id="4153564">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4153569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153572">if</span>&nbsp;<span class="ident" id="4153575">fd</span><span class="op" id="4153577">,</span>&nbsp;<span class="ident" id="4153579">err</span>&nbsp;<span class="op" id="4153583">=</span>&nbsp;<span class="ident" id="4153585">newFD</span><span class="op" id="4153590">(</span><span class="ident" id="4153591">s</span><span class="op" id="4153592">,</span>&nbsp;<span class="ident" id="4153594">family</span><span class="op" id="4153600">,</span>&nbsp;<span class="ident" id="4153602">sotype</span><span class="op" id="4153608">,</span>&nbsp;<span class="ident" id="4153610">net</span><span class="op" id="4153613">)</span><span class="op" id="4153614">;</span>&nbsp;<span class="ident" id="4153616">err</span>&nbsp;<span class="op" id="4153620">!=</span>&nbsp;<span class="ident" id="4153623">nil</span>&nbsp;<span class="op" id="4153627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153631">closesocket</span><span class="op" id="4153642">(</span><span class="ident" id="4153643">s</span><span class="op" id="4153644">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153648">return</span>&nbsp;<span class="ident" id="4153655">nil</span><span class="op" id="4153658">,</span>&nbsp;<span class="ident" id="4153660">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4153665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153669">//&nbsp;This&nbsp;function&nbsp;makes&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153727">//&nbsp;following&nbsp;applications:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153755">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153759">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;passive&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153812">//&nbsp;&nbsp;&nbsp;connenction,&nbsp;known&nbsp;as&nbsp;a&nbsp;stream&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153858">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153862">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;destination-unspecific</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153923">//&nbsp;&nbsp;&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a&nbsp;datagram&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153979">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153983">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;an&nbsp;active&nbsp;stream&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154041">//&nbsp;&nbsp;&nbsp;destination-specific&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154100">//&nbsp;&nbsp;&nbsp;dialer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154113">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154117">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;the&nbsp;other&nbsp;connection,&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154180">//&nbsp;&nbsp;&nbsp;as&nbsp;talking&nbsp;to&nbsp;the&nbsp;protocol&nbsp;stack&nbsp;inside&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154237">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154241">//&nbsp;For&nbsp;stream&nbsp;and&nbsp;datagram&nbsp;listeners,&nbsp;they&nbsp;will&nbsp;only&nbsp;require</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154303">//&nbsp;named&nbsp;sockets,&nbsp;so&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154364">//&nbsp;from&nbsp;stream&nbsp;or&nbsp;datagram&nbsp;listeners&nbsp;when&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154428">//&nbsp;raddr&nbsp;is&nbsp;nil.&nbsp;Otherwise&nbsp;we&nbsp;assume&nbsp;it&#39;s&nbsp;just&nbsp;for&nbsp;dialers&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154491">//&nbsp;the&nbsp;other&nbsp;connection&nbsp;holders.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154526">if</span>&nbsp;<span class="ident" id="4154529">laddr</span>&nbsp;<span class="op" id="4154535">!=</span>&nbsp;<span class="ident" id="4154538">nil</span>&nbsp;<span class="op" id="4154542">&amp;&amp;</span>&nbsp;<span class="ident" id="4154545">raddr</span>&nbsp;<span class="op" id="4154551">==</span>&nbsp;<span class="ident" id="4154554">nil</span>&nbsp;<span class="op" id="4154558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154562">switch</span>&nbsp;<span class="ident" id="4154569">sotype</span>&nbsp;<span class="op" id="4154576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154580">case</span>&nbsp;<span class="ident" id="4154585">syscall</span><span class="op" id="4154592">.</span><span class="ident" id="4154593">SOCK_STREAM</span><span class="op" id="4154604">,</span>&nbsp;<span class="ident" id="4154606">syscall</span><span class="op" id="4154613">.</span><span class="ident" id="4154614">SOCK_SEQPACKET</span><span class="op" id="4154628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154633">if</span>&nbsp;<span class="ident" id="4154636">err</span>&nbsp;<span class="op" id="4154640">:=</span>&nbsp;<span class="ident" id="4154643">fd</span><span class="op" id="4154645">.</span><span class="ident" id="4154646">listenStream</span><span class="op" id="4154658">(</span><span class="ident" id="4154659">laddr</span><span class="op" id="4154664">,</span>&nbsp;<span class="ident" id="4154666">listenerBacklog</span><span class="op" id="4154681">)</span><span class="op" id="4154682">;</span>&nbsp;<span class="ident" id="4154684">err</span>&nbsp;<span class="op" id="4154688">!=</span>&nbsp;<span class="ident" id="4154691">nil</span>&nbsp;<span class="op" id="4154695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154701">fd</span><span class="op" id="4154703">.</span><span class="ident" id="4154704">Close</span><span class="op" id="4154709">(</span><span class="op" id="4154710">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154716">return</span>&nbsp;<span class="ident" id="4154723">nil</span><span class="op" id="4154726">,</span>&nbsp;<span class="ident" id="4154728">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154740">return</span>&nbsp;<span class="ident" id="4154747">fd</span><span class="op" id="4154749">,</span>&nbsp;<span class="ident" id="4154751">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154757">case</span>&nbsp;<span class="ident" id="4154762">syscall</span><span class="op" id="4154769">.</span><span class="ident" id="4154770">SOCK_DGRAM</span><span class="op" id="4154780">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154785">if</span>&nbsp;<span class="ident" id="4154788">err</span>&nbsp;<span class="op" id="4154792">:=</span>&nbsp;<span class="ident" id="4154795">fd</span><span class="op" id="4154797">.</span><span class="ident" id="4154798">listenDatagram</span><span class="op" id="4154812">(</span><span class="ident" id="4154813">laddr</span><span class="op" id="4154818">)</span><span class="op" id="4154819">;</span>&nbsp;<span class="ident" id="4154821">err</span>&nbsp;<span class="op" id="4154825">!=</span>&nbsp;<span class="ident" id="4154828">nil</span>&nbsp;<span class="op" id="4154832">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154838">fd</span><span class="op" id="4154840">.</span><span class="ident" id="4154841">Close</span><span class="op" id="4154846">(</span><span class="op" id="4154847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154853">return</span>&nbsp;<span class="ident" id="4154860">nil</span><span class="op" id="4154863">,</span>&nbsp;<span class="ident" id="4154865">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154877">return</span>&nbsp;<span class="ident" id="4154884">fd</span><span class="op" id="4154886">,</span>&nbsp;<span class="ident" id="4154888">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154894">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154900">if</span>&nbsp;<span class="ident" id="4154903">err</span>&nbsp;<span class="op" id="4154907">:=</span>&nbsp;<span class="ident" id="4154910">fd</span><span class="op" id="4154912">.</span><span class="ident" id="4154913">dial</span><span class="op" id="4154917">(</span><span class="ident" id="4154918">laddr</span><span class="op" id="4154923">,</span>&nbsp;<span class="ident" id="4154925">raddr</span><span class="op" id="4154930">,</span>&nbsp;<span class="ident" id="4154932">deadline</span><span class="op" id="4154940">)</span><span class="op" id="4154941">;</span>&nbsp;<span class="ident" id="4154943">err</span>&nbsp;<span class="op" id="4154947">!=</span>&nbsp;<span class="ident" id="4154950">nil</span>&nbsp;<span class="op" id="4154954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154958">fd</span><span class="op" id="4154960">.</span><span class="ident" id="4154961">Close</span><span class="op" id="4154966">(</span><span class="op" id="4154967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154971">return</span>&nbsp;<span class="ident" id="4154978">nil</span><span class="op" id="4154981">,</span>&nbsp;<span class="ident" id="4154983">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154988">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154991">return</span>&nbsp;<span class="ident" id="4154998">fd</span><span class="op" id="4155000">,</span>&nbsp;<span class="ident" id="4155002">nil</span><br>
<span class="lineno"></span><span class="op" id="4155006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4155009">func</span>&nbsp;<span class="op" id="4155014">(</span><span class="ident" id="4155015">fd</span>&nbsp;<span class="op" id="4155018">*</span><span class="ident" id="4155019">netFD</span><span class="op" id="4155024">)</span>&nbsp;<span class="ident" id="4155026">addrFunc</span><span class="op" id="4155034">(</span><span class="op" id="4155035">)</span>&nbsp;<span class="keyword" id="4155037">func</span><span class="op" id="4155041">(</span><span class="ident" id="4155042">syscall</span><span class="op" id="4155049">.</span><span class="ident" id="4155050">Sockaddr</span><span class="op" id="4155058">)</span>&nbsp;<span class="ident" id="4155060">Addr</span>&nbsp;<span class="op" id="4155065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155068">switch</span>&nbsp;<span class="ident" id="4155075">fd</span><span class="op" id="4155077">.</span><span class="ident" id="4155078">family</span>&nbsp;<span class="op" id="4155085">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155088">case</span>&nbsp;<span class="ident" id="4155093">syscall</span><span class="op" id="4155100">.</span><span class="ident" id="4155101">AF_INET</span><span class="op" id="4155108">,</span>&nbsp;<span class="ident" id="4155110">syscall</span><span class="op" id="4155117">.</span><span class="ident" id="4155118">AF_INET6</span><span class="op" id="4155126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155130">switch</span>&nbsp;<span class="ident" id="4155137">fd</span><span class="op" id="4155139">.</span><span class="ident" id="4155140">sotype</span>&nbsp;<span class="op" id="4155147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155151">case</span>&nbsp;<span class="ident" id="4155156">syscall</span><span class="op" id="4155163">.</span><span class="ident" id="4155164">SOCK_STREAM</span><span class="op" id="4155175">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155180">return</span>&nbsp;<span class="ident" id="4155187">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155203">case</span>&nbsp;<span class="ident" id="4155208">syscall</span><span class="op" id="4155215">.</span><span class="ident" id="4155216">SOCK_DGRAM</span><span class="op" id="4155226">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155231">return</span>&nbsp;<span class="ident" id="4155238">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155254">case</span>&nbsp;<span class="ident" id="4155259">syscall</span><span class="op" id="4155266">.</span><span class="ident" id="4155267">SOCK_RAW</span><span class="op" id="4155275">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155280">return</span>&nbsp;<span class="ident" id="4155287">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155305">case</span>&nbsp;<span class="ident" id="4155310">syscall</span><span class="op" id="4155317">.</span><span class="ident" id="4155318">AF_UNIX</span><span class="op" id="4155325">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155329">switch</span>&nbsp;<span class="ident" id="4155336">fd</span><span class="op" id="4155338">.</span><span class="ident" id="4155339">sotype</span>&nbsp;<span class="op" id="4155346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155350">case</span>&nbsp;<span class="ident" id="4155355">syscall</span><span class="op" id="4155362">.</span><span class="ident" id="4155363">SOCK_STREAM</span><span class="op" id="4155374">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155379">return</span>&nbsp;<span class="ident" id="4155386">sockaddrToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155403">case</span>&nbsp;<span class="ident" id="4155408">syscall</span><span class="op" id="4155415">.</span><span class="ident" id="4155416">SOCK_DGRAM</span><span class="op" id="4155426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155431">return</span>&nbsp;<span class="ident" id="4155438">sockaddrToUnixgram</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155459">case</span>&nbsp;<span class="ident" id="4155464">syscall</span><span class="op" id="4155471">.</span><span class="ident" id="4155472">SOCK_SEQPACKET</span><span class="op" id="4155486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155491">return</span>&nbsp;<span class="ident" id="4155498">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155527">return</span>&nbsp;<span class="keyword" id="4155534">func</span><span class="op" id="4155538">(</span><span class="ident" id="4155539">syscall</span><span class="op" id="4155546">.</span><span class="ident" id="4155547">Sockaddr</span><span class="op" id="4155555">)</span>&nbsp;<span class="ident" id="4155557">Addr</span>&nbsp;<span class="op" id="4155562">{</span>&nbsp;<span class="keyword" id="4155564">return</span>&nbsp;<span class="ident" id="4155571">nil</span>&nbsp;<span class="op" id="4155575">}</span><br>
<span class="lineno">120</span><span class="op" id="4155577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4155580">func</span>&nbsp;<span class="op" id="4155585">(</span><span class="ident" id="4155586">fd</span>&nbsp;<span class="op" id="4155589">*</span><span class="ident" id="4155590">netFD</span><span class="op" id="4155595">)</span>&nbsp;<span class="ident" id="4155597">dial</span><span class="op" id="4155601">(</span><span class="ident" id="4155602">laddr</span><span class="op" id="4155607">,</span>&nbsp;<span class="ident" id="4155609">raddr</span>&nbsp;<span class="ident" id="4155615">sockaddr</span><span class="op" id="4155623">,</span>&nbsp;<span class="ident" id="4155625">deadline</span>&nbsp;<span class="ident" id="4155634">time</span><span class="op" id="4155638">.</span><span class="ident" id="4155639">Time</span><span class="op" id="4155643">)</span>&nbsp;<span class="builtintype" id="4155645">error</span>&nbsp;<span class="op" id="4155651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155654">var</span>&nbsp;<span class="ident" id="4155658">err</span>&nbsp;<span class="builtintype" id="4155662">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155669">var</span>&nbsp;<span class="ident" id="4155673">lsa</span>&nbsp;<span class="ident" id="4155677">syscall</span><span class="op" id="4155684">.</span><span class="ident" id="4155685">Sockaddr</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155695">if</span>&nbsp;<span class="ident" id="4155698">laddr</span>&nbsp;<span class="op" id="4155704">!=</span>&nbsp;<span class="ident" id="4155707">nil</span>&nbsp;<span class="op" id="4155711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155715">if</span>&nbsp;<span class="ident" id="4155718">lsa</span><span class="op" id="4155721">,</span>&nbsp;<span class="ident" id="4155723">err</span>&nbsp;<span class="op" id="4155727">=</span>&nbsp;<span class="ident" id="4155729">laddr</span><span class="op" id="4155734">.</span><span class="ident" id="4155735">sockaddr</span><span class="op" id="4155743">(</span><span class="ident" id="4155744">fd</span><span class="op" id="4155746">.</span><span class="ident" id="4155747">family</span><span class="op" id="4155753">)</span><span class="op" id="4155754">;</span>&nbsp;<span class="ident" id="4155756">err</span>&nbsp;<span class="op" id="4155760">!=</span>&nbsp;<span class="ident" id="4155763">nil</span>&nbsp;<span class="op" id="4155767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155772">return</span>&nbsp;<span class="ident" id="4155779">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155785">}</span>&nbsp;<span class="keyword" id="4155787">else</span>&nbsp;<span class="keyword" id="4155792">if</span>&nbsp;<span class="ident" id="4155795">lsa</span>&nbsp;<span class="op" id="4155799">!=</span>&nbsp;<span class="ident" id="4155802">nil</span>&nbsp;<span class="op" id="4155806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155811">if</span>&nbsp;<span class="ident" id="4155814">err</span>&nbsp;<span class="op" id="4155818">:=</span>&nbsp;<span class="ident" id="4155821">syscall</span><span class="op" id="4155828">.</span><span class="ident" id="4155829">Bind</span><span class="op" id="4155833">(</span><span class="ident" id="4155834">fd</span><span class="op" id="4155836">.</span><span class="ident" id="4155837">sysfd</span><span class="op" id="4155842">,</span>&nbsp;<span class="ident" id="4155844">lsa</span><span class="op" id="4155847">)</span><span class="op" id="4155848">;</span>&nbsp;<span class="ident" id="4155850">err</span>&nbsp;<span class="op" id="4155854">!=</span>&nbsp;<span class="ident" id="4155857">nil</span>&nbsp;<span class="op" id="4155861">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155867">return</span>&nbsp;<span class="ident" id="4155874">os</span><span class="op" id="4155876">.</span><span class="ident" id="4155877">NewSyscallError</span><span class="op" id="4155892">(</span><span class="string" id="4155893">&#34;bind&#34;</span><span class="op" id="4155899">,</span>&nbsp;<span class="ident" id="4155901">err</span><span class="op" id="4155904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155919">var</span>&nbsp;<span class="ident" id="4155923">rsa</span>&nbsp;<span class="ident" id="4155927">syscall</span><span class="op" id="4155934">.</span><span class="ident" id="4155935">Sockaddr</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155945">if</span>&nbsp;<span class="ident" id="4155948">raddr</span>&nbsp;<span class="op" id="4155954">!=</span>&nbsp;<span class="ident" id="4155957">nil</span>&nbsp;<span class="op" id="4155961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155965">if</span>&nbsp;<span class="ident" id="4155968">rsa</span><span class="op" id="4155971">,</span>&nbsp;<span class="ident" id="4155973">err</span>&nbsp;<span class="op" id="4155977">=</span>&nbsp;<span class="ident" id="4155979">raddr</span><span class="op" id="4155984">.</span><span class="ident" id="4155985">sockaddr</span><span class="op" id="4155993">(</span><span class="ident" id="4155994">fd</span><span class="op" id="4155996">.</span><span class="ident" id="4155997">family</span><span class="op" id="4156003">)</span><span class="op" id="4156004">;</span>&nbsp;<span class="ident" id="4156006">err</span>&nbsp;<span class="op" id="4156010">!=</span>&nbsp;<span class="ident" id="4156013">nil</span>&nbsp;<span class="op" id="4156017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156022">return</span>&nbsp;<span class="ident" id="4156029">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156039">if</span>&nbsp;<span class="ident" id="4156042">err</span>&nbsp;<span class="op" id="4156046">:=</span>&nbsp;<span class="ident" id="4156049">fd</span><span class="op" id="4156051">.</span><span class="ident" id="4156052">connect</span><span class="op" id="4156059">(</span><span class="ident" id="4156060">lsa</span><span class="op" id="4156063">,</span>&nbsp;<span class="ident" id="4156065">rsa</span><span class="op" id="4156068">,</span>&nbsp;<span class="ident" id="4156070">deadline</span><span class="op" id="4156078">)</span><span class="op" id="4156079">;</span>&nbsp;<span class="ident" id="4156081">err</span>&nbsp;<span class="op" id="4156085">!=</span>&nbsp;<span class="ident" id="4156088">nil</span>&nbsp;<span class="op" id="4156092">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156097">return</span>&nbsp;<span class="ident" id="4156104">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156114">fd</span><span class="op" id="4156116">.</span><span class="ident" id="4156117">isConnected</span>&nbsp;<span class="op" id="4156129">=</span>&nbsp;<span class="builtintype" id="4156131">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156137">}</span>&nbsp;<span class="keyword" id="4156139">else</span>&nbsp;<span class="op" id="4156144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156148">if</span>&nbsp;<span class="ident" id="4156151">err</span>&nbsp;<span class="op" id="4156155">:=</span>&nbsp;<span class="ident" id="4156158">fd</span><span class="op" id="4156160">.</span><span class="ident" id="4156161">init</span><span class="op" id="4156165">(</span><span class="op" id="4156166">)</span><span class="op" id="4156167">;</span>&nbsp;<span class="ident" id="4156169">err</span>&nbsp;<span class="op" id="4156173">!=</span>&nbsp;<span class="ident" id="4156176">nil</span>&nbsp;<span class="op" id="4156180">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156185">return</span>&nbsp;<span class="ident" id="4156192">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156204">lsa</span><span class="op" id="4156207">,</span>&nbsp;<span class="ident" id="4156209">_</span>&nbsp;<span class="op" id="4156211">=</span>&nbsp;<span class="ident" id="4156213">syscall</span><span class="op" id="4156220">.</span><span class="ident" id="4156221">Getsockname</span><span class="op" id="4156232">(</span><span class="ident" id="4156233">fd</span><span class="op" id="4156235">.</span><span class="ident" id="4156236">sysfd</span><span class="op" id="4156241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156244">if</span>&nbsp;<span class="ident" id="4156247">rsa</span><span class="op" id="4156250">,</span>&nbsp;<span class="ident" id="4156252">_</span>&nbsp;<span class="op" id="4156254">=</span>&nbsp;<span class="ident" id="4156256">syscall</span><span class="op" id="4156263">.</span><span class="ident" id="4156264">Getpeername</span><span class="op" id="4156275">(</span><span class="ident" id="4156276">fd</span><span class="op" id="4156278">.</span><span class="ident" id="4156279">sysfd</span><span class="op" id="4156284">)</span><span class="op" id="4156285">;</span>&nbsp;<span class="ident" id="4156287">rsa</span>&nbsp;<span class="op" id="4156291">!=</span>&nbsp;<span class="ident" id="4156294">nil</span>&nbsp;<span class="op" id="4156298">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156302">fd</span><span class="op" id="4156304">.</span><span class="ident" id="4156305">setAddr</span><span class="op" id="4156312">(</span><span class="ident" id="4156313">fd</span><span class="op" id="4156315">.</span><span class="ident" id="4156316">addrFunc</span><span class="op" id="4156324">(</span><span class="op" id="4156325">)</span><span class="op" id="4156326">(</span><span class="ident" id="4156327">lsa</span><span class="op" id="4156330">)</span><span class="op" id="4156331">,</span>&nbsp;<span class="ident" id="4156333">fd</span><span class="op" id="4156335">.</span><span class="ident" id="4156336">addrFunc</span><span class="op" id="4156344">(</span><span class="op" id="4156345">)</span><span class="op" id="4156346">(</span><span class="ident" id="4156347">rsa</span><span class="op" id="4156350">)</span><span class="op" id="4156351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156354">}</span>&nbsp;<span class="keyword" id="4156356">else</span>&nbsp;<span class="op" id="4156361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156365">fd</span><span class="op" id="4156367">.</span><span class="ident" id="4156368">setAddr</span><span class="op" id="4156375">(</span><span class="ident" id="4156376">fd</span><span class="op" id="4156378">.</span><span class="ident" id="4156379">addrFunc</span><span class="op" id="4156387">(</span><span class="op" id="4156388">)</span><span class="op" id="4156389">(</span><span class="ident" id="4156390">lsa</span><span class="op" id="4156393">)</span><span class="op" id="4156394">,</span>&nbsp;<span class="ident" id="4156396">raddr</span><span class="op" id="4156401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156407">return</span>&nbsp;<span class="ident" id="4156414">nil</span><br>
<span class="lineno">155</span><span class="op" id="4156418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4156421">func</span>&nbsp;<span class="op" id="4156426">(</span><span class="ident" id="4156427">fd</span>&nbsp;<span class="op" id="4156430">*</span><span class="ident" id="4156431">netFD</span><span class="op" id="4156436">)</span>&nbsp;<span class="ident" id="4156438">listenStream</span><span class="op" id="4156450">(</span><span class="ident" id="4156451">laddr</span>&nbsp;<span class="ident" id="4156457">sockaddr</span><span class="op" id="4156465">,</span>&nbsp;<span class="ident" id="4156467">backlog</span>&nbsp;<span class="builtintype" id="4156475">int</span><span class="op" id="4156478">)</span>&nbsp;<span class="builtintype" id="4156480">error</span>&nbsp;<span class="op" id="4156486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156489">if</span>&nbsp;<span class="ident" id="4156492">err</span>&nbsp;<span class="op" id="4156496">:=</span>&nbsp;<span class="ident" id="4156499">setDefaultListenerSockopts</span><span class="op" id="4156525">(</span><span class="ident" id="4156526">fd</span><span class="op" id="4156528">.</span><span class="ident" id="4156529">sysfd</span><span class="op" id="4156534">)</span><span class="op" id="4156535">;</span>&nbsp;<span class="ident" id="4156537">err</span>&nbsp;<span class="op" id="4156541">!=</span>&nbsp;<span class="ident" id="4156544">nil</span>&nbsp;<span class="op" id="4156548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156552">return</span>&nbsp;<span class="ident" id="4156559">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156567">if</span>&nbsp;<span class="ident" id="4156570">lsa</span><span class="op" id="4156573">,</span>&nbsp;<span class="ident" id="4156575">err</span>&nbsp;<span class="op" id="4156579">:=</span>&nbsp;<span class="ident" id="4156582">laddr</span><span class="op" id="4156587">.</span><span class="ident" id="4156588">sockaddr</span><span class="op" id="4156596">(</span><span class="ident" id="4156597">fd</span><span class="op" id="4156599">.</span><span class="ident" id="4156600">family</span><span class="op" id="4156606">)</span><span class="op" id="4156607">;</span>&nbsp;<span class="ident" id="4156609">err</span>&nbsp;<span class="op" id="4156613">!=</span>&nbsp;<span class="ident" id="4156616">nil</span>&nbsp;<span class="op" id="4156620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156624">return</span>&nbsp;<span class="ident" id="4156631">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156636">}</span>&nbsp;<span class="keyword" id="4156638">else</span>&nbsp;<span class="keyword" id="4156643">if</span>&nbsp;<span class="ident" id="4156646">lsa</span>&nbsp;<span class="op" id="4156650">!=</span>&nbsp;<span class="ident" id="4156653">nil</span>&nbsp;<span class="op" id="4156657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156661">if</span>&nbsp;<span class="ident" id="4156664">err</span>&nbsp;<span class="op" id="4156668">:=</span>&nbsp;<span class="ident" id="4156671">syscall</span><span class="op" id="4156678">.</span><span class="ident" id="4156679">Bind</span><span class="op" id="4156683">(</span><span class="ident" id="4156684">fd</span><span class="op" id="4156686">.</span><span class="ident" id="4156687">sysfd</span><span class="op" id="4156692">,</span>&nbsp;<span class="ident" id="4156694">lsa</span><span class="op" id="4156697">)</span><span class="op" id="4156698">;</span>&nbsp;<span class="ident" id="4156700">err</span>&nbsp;<span class="op" id="4156704">!=</span>&nbsp;<span class="ident" id="4156707">nil</span>&nbsp;<span class="op" id="4156711">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156716">return</span>&nbsp;<span class="ident" id="4156723">os</span><span class="op" id="4156725">.</span><span class="ident" id="4156726">NewSyscallError</span><span class="op" id="4156741">(</span><span class="string" id="4156742">&#34;bind&#34;</span><span class="op" id="4156748">,</span>&nbsp;<span class="ident" id="4156750">err</span><span class="op" id="4156753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156763">if</span>&nbsp;<span class="ident" id="4156766">err</span>&nbsp;<span class="op" id="4156770">:=</span>&nbsp;<span class="ident" id="4156773">syscall</span><span class="op" id="4156780">.</span><span class="ident" id="4156781">Listen</span><span class="op" id="4156787">(</span><span class="ident" id="4156788">fd</span><span class="op" id="4156790">.</span><span class="ident" id="4156791">sysfd</span><span class="op" id="4156796">,</span>&nbsp;<span class="ident" id="4156798">backlog</span><span class="op" id="4156805">)</span><span class="op" id="4156806">;</span>&nbsp;<span class="ident" id="4156808">err</span>&nbsp;<span class="op" id="4156812">!=</span>&nbsp;<span class="ident" id="4156815">nil</span>&nbsp;<span class="op" id="4156819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156823">return</span>&nbsp;<span class="ident" id="4156830">os</span><span class="op" id="4156832">.</span><span class="ident" id="4156833">NewSyscallError</span><span class="op" id="4156848">(</span><span class="string" id="4156849">&#34;listen&#34;</span><span class="op" id="4156857">,</span>&nbsp;<span class="ident" id="4156859">err</span><span class="op" id="4156862">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156868">if</span>&nbsp;<span class="ident" id="4156871">err</span>&nbsp;<span class="op" id="4156875">:=</span>&nbsp;<span class="ident" id="4156878">fd</span><span class="op" id="4156880">.</span><span class="ident" id="4156881">init</span><span class="op" id="4156885">(</span><span class="op" id="4156886">)</span><span class="op" id="4156887">;</span>&nbsp;<span class="ident" id="4156889">err</span>&nbsp;<span class="op" id="4156893">!=</span>&nbsp;<span class="ident" id="4156896">nil</span>&nbsp;<span class="op" id="4156900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156904">return</span>&nbsp;<span class="ident" id="4156911">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156919">lsa</span><span class="op" id="4156922">,</span>&nbsp;<span class="ident" id="4156924">_</span>&nbsp;<span class="op" id="4156926">:=</span>&nbsp;<span class="ident" id="4156929">syscall</span><span class="op" id="4156936">.</span><span class="ident" id="4156937">Getsockname</span><span class="op" id="4156948">(</span><span class="ident" id="4156949">fd</span><span class="op" id="4156951">.</span><span class="ident" id="4156952">sysfd</span><span class="op" id="4156957">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156960">fd</span><span class="op" id="4156962">.</span><span class="ident" id="4156963">setAddr</span><span class="op" id="4156970">(</span><span class="ident" id="4156971">fd</span><span class="op" id="4156973">.</span><span class="ident" id="4156974">addrFunc</span><span class="op" id="4156982">(</span><span class="op" id="4156983">)</span><span class="op" id="4156984">(</span><span class="ident" id="4156985">lsa</span><span class="op" id="4156988">)</span><span class="op" id="4156989">,</span>&nbsp;<span class="ident" id="4156991">nil</span><span class="op" id="4156994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156997">return</span>&nbsp;<span class="ident" id="4157004">nil</span><br>
<span class="lineno"></span><span class="op" id="4157008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4157011">func</span>&nbsp;<span class="op" id="4157016">(</span><span class="ident" id="4157017">fd</span>&nbsp;<span class="op" id="4157020">*</span><span class="ident" id="4157021">netFD</span><span class="op" id="4157026">)</span>&nbsp;<span class="ident" id="4157028">listenDatagram</span><span class="op" id="4157042">(</span><span class="ident" id="4157043">laddr</span>&nbsp;<span class="ident" id="4157049">sockaddr</span><span class="op" id="4157057">)</span>&nbsp;<span class="builtintype" id="4157059">error</span>&nbsp;<span class="op" id="4157065">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157068">switch</span>&nbsp;<span class="ident" id="4157075">addr</span>&nbsp;<span class="op" id="4157080">:=</span>&nbsp;<span class="ident" id="4157083">laddr</span><span class="op" id="4157088">.</span><span class="op" id="4157089">(</span><span class="keyword" id="4157090">type</span><span class="op" id="4157094">)</span>&nbsp;<span class="op" id="4157096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157099">case</span>&nbsp;<span class="op" id="4157104">*</span><span class="ident" id="4157105">UDPAddr</span><span class="op" id="4157112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157116">//&nbsp;We&nbsp;provide&nbsp;a&nbsp;socket&nbsp;that&nbsp;listens&nbsp;to&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157168">//&nbsp;address&nbsp;with&nbsp;reusable&nbsp;UDP&nbsp;port&nbsp;when&nbsp;the&nbsp;given&nbsp;laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157225">//&nbsp;is&nbsp;an&nbsp;appropriate&nbsp;UDP&nbsp;multicast&nbsp;address&nbsp;prefix.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157278">//&nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;for&nbsp;a&nbsp;single&nbsp;UDP&nbsp;listener&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157335">//&nbsp;join&nbsp;multiple&nbsp;different&nbsp;group&nbsp;addresses,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157385">//&nbsp;multiple&nbsp;UDP&nbsp;listeners&nbsp;that&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;UDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157441">//&nbsp;port&nbsp;to&nbsp;join&nbsp;the&nbsp;same&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157483">if</span>&nbsp;<span class="ident" id="4157486">addr</span><span class="op" id="4157490">.</span><span class="ident" id="4157491">IP</span>&nbsp;<span class="op" id="4157494">!=</span>&nbsp;<span class="ident" id="4157497">nil</span>&nbsp;<span class="op" id="4157501">&amp;&amp;</span>&nbsp;<span class="ident" id="4157504">addr</span><span class="op" id="4157508">.</span><span class="ident" id="4157509">IP</span><span class="op" id="4157511">.</span><span class="ident" id="4157512">IsMulticast</span><span class="op" id="4157523">(</span><span class="op" id="4157524">)</span>&nbsp;<span class="op" id="4157526">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157531">if</span>&nbsp;<span class="ident" id="4157534">err</span>&nbsp;<span class="op" id="4157538">:=</span>&nbsp;<span class="ident" id="4157541">setDefaultMulticastSockopts</span><span class="op" id="4157568">(</span><span class="ident" id="4157569">fd</span><span class="op" id="4157571">.</span><span class="ident" id="4157572">sysfd</span><span class="op" id="4157577">)</span><span class="op" id="4157578">;</span>&nbsp;<span class="ident" id="4157580">err</span>&nbsp;<span class="op" id="4157584">!=</span>&nbsp;<span class="ident" id="4157587">nil</span>&nbsp;<span class="op" id="4157591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157597">return</span>&nbsp;<span class="ident" id="4157604">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157616">addr</span>&nbsp;<span class="op" id="4157621">:=</span>&nbsp;<span class="op" id="4157624">*</span><span class="ident" id="4157625">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157633">switch</span>&nbsp;<span class="ident" id="4157640">fd</span><span class="op" id="4157642">.</span><span class="ident" id="4157643">family</span>&nbsp;<span class="op" id="4157650">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157655">case</span>&nbsp;<span class="ident" id="4157660">syscall</span><span class="op" id="4157667">.</span><span class="ident" id="4157668">AF_INET</span><span class="op" id="4157675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157681">addr</span><span class="op" id="4157685">.</span><span class="ident" id="4157686">IP</span>&nbsp;<span class="op" id="4157689">=</span>&nbsp;<span class="ident" id="4157691">IPv4zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157703">case</span>&nbsp;<span class="ident" id="4157708">syscall</span><span class="op" id="4157715">.</span><span class="ident" id="4157716">AF_INET6</span><span class="op" id="4157724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157730">addr</span><span class="op" id="4157734">.</span><span class="ident" id="4157735">IP</span>&nbsp;<span class="op" id="4157738">=</span>&nbsp;<span class="ident" id="4157740">IPv6unspecified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157759">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157764">laddr</span>&nbsp;<span class="op" id="4157770">=</span>&nbsp;<span class="op" id="4157772">&amp;</span><span class="ident" id="4157773">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157786">if</span>&nbsp;<span class="ident" id="4157789">lsa</span><span class="op" id="4157792">,</span>&nbsp;<span class="ident" id="4157794">err</span>&nbsp;<span class="op" id="4157798">:=</span>&nbsp;<span class="ident" id="4157801">laddr</span><span class="op" id="4157806">.</span><span class="ident" id="4157807">sockaddr</span><span class="op" id="4157815">(</span><span class="ident" id="4157816">fd</span><span class="op" id="4157818">.</span><span class="ident" id="4157819">family</span><span class="op" id="4157825">)</span><span class="op" id="4157826">;</span>&nbsp;<span class="ident" id="4157828">err</span>&nbsp;<span class="op" id="4157832">!=</span>&nbsp;<span class="ident" id="4157835">nil</span>&nbsp;<span class="op" id="4157839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157843">return</span>&nbsp;<span class="ident" id="4157850">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157855">}</span>&nbsp;<span class="keyword" id="4157857">else</span>&nbsp;<span class="keyword" id="4157862">if</span>&nbsp;<span class="ident" id="4157865">lsa</span>&nbsp;<span class="op" id="4157869">!=</span>&nbsp;<span class="ident" id="4157872">nil</span>&nbsp;<span class="op" id="4157876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157880">if</span>&nbsp;<span class="ident" id="4157883">err</span>&nbsp;<span class="op" id="4157887">:=</span>&nbsp;<span class="ident" id="4157890">syscall</span><span class="op" id="4157897">.</span><span class="ident" id="4157898">Bind</span><span class="op" id="4157902">(</span><span class="ident" id="4157903">fd</span><span class="op" id="4157905">.</span><span class="ident" id="4157906">sysfd</span><span class="op" id="4157911">,</span>&nbsp;<span class="ident" id="4157913">lsa</span><span class="op" id="4157916">)</span><span class="op" id="4157917">;</span>&nbsp;<span class="ident" id="4157919">err</span>&nbsp;<span class="op" id="4157923">!=</span>&nbsp;<span class="ident" id="4157926">nil</span>&nbsp;<span class="op" id="4157930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157935">return</span>&nbsp;<span class="ident" id="4157942">os</span><span class="op" id="4157944">.</span><span class="ident" id="4157945">NewSyscallError</span><span class="op" id="4157960">(</span><span class="string" id="4157961">&#34;bind&#34;</span><span class="op" id="4157967">,</span>&nbsp;<span class="ident" id="4157969">err</span><span class="op" id="4157972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157979">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157982">if</span>&nbsp;<span class="ident" id="4157985">err</span>&nbsp;<span class="op" id="4157989">:=</span>&nbsp;<span class="ident" id="4157992">fd</span><span class="op" id="4157994">.</span><span class="ident" id="4157995">init</span><span class="op" id="4157999">(</span><span class="op" id="4158000">)</span><span class="op" id="4158001">;</span>&nbsp;<span class="ident" id="4158003">err</span>&nbsp;<span class="op" id="4158007">!=</span>&nbsp;<span class="ident" id="4158010">nil</span>&nbsp;<span class="op" id="4158014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158018">return</span>&nbsp;<span class="ident" id="4158025">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158033">lsa</span><span class="op" id="4158036">,</span>&nbsp;<span class="ident" id="4158038">_</span>&nbsp;<span class="op" id="4158040">:=</span>&nbsp;<span class="ident" id="4158043">syscall</span><span class="op" id="4158050">.</span><span class="ident" id="4158051">Getsockname</span><span class="op" id="4158062">(</span><span class="ident" id="4158063">fd</span><span class="op" id="4158065">.</span><span class="ident" id="4158066">sysfd</span><span class="op" id="4158071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158074">fd</span><span class="op" id="4158076">.</span><span class="ident" id="4158077">setAddr</span><span class="op" id="4158084">(</span><span class="ident" id="4158085">fd</span><span class="op" id="4158087">.</span><span class="ident" id="4158088">addrFunc</span><span class="op" id="4158096">(</span><span class="op" id="4158097">)</span><span class="op" id="4158098">(</span><span class="ident" id="4158099">lsa</span><span class="op" id="4158102">)</span><span class="op" id="4158103">,</span>&nbsp;<span class="ident" id="4158105">nil</span><span class="op" id="4158108">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158111">return</span>&nbsp;<span class="ident" id="4158118">nil</span><br>
<span class="lineno"></span><span class="op" id="4158122">}</span>
</div>
</body>
</html>
