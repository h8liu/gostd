<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7679644">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7679699">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7679753">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7679804">package</span>&nbsp;<span class="ident" id="7679812">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7679819">import</span>&nbsp;<span class="op" id="7679826">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7679829">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7679838">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7679845">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7679851">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7679864">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7679875">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7679883">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7679893">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7679896">type</span>&nbsp;<span class="ident" id="7679901">deflateTest</span>&nbsp;<span class="keyword" id="7679913">struct</span>&nbsp;<span class="op" id="7679920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679923">in</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7679929">[</span><span class="op" id="7679930">]</span><span class="builtintype" id="7679931">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679937">level</span>&nbsp;<span class="builtintype" id="7679943">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679948">out</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7679954">[</span><span class="op" id="7679955">]</span><span class="builtintype" id="7679956">byte</span><br>
<span class="lineno"></span><span class="op" id="7679961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7679964">type</span>&nbsp;<span class="ident" id="7679969">deflateInflateTest</span>&nbsp;<span class="keyword" id="7679988">struct</span>&nbsp;<span class="op" id="7679995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679998">in</span>&nbsp;<span class="op" id="7680001">[</span><span class="op" id="7680002">]</span><span class="builtintype" id="7680003">byte</span><br>
<span class="lineno">25</span><span class="op" id="7680008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7680011">type</span>&nbsp;<span class="ident" id="7680016">reverseBitsTest</span>&nbsp;<span class="keyword" id="7680032">struct</span>&nbsp;<span class="op" id="7680039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680042">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7680051">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680059">bitCount</span>&nbsp;<span class="builtintype" id="7680068">uint8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680075">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7680084">uint16</span><br>
<span class="lineno"></span><span class="op" id="7680091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7680094">var</span>&nbsp;<span class="ident" id="7680098">deflateTests</span>&nbsp;<span class="op" id="7680111">=</span>&nbsp;<span class="op" id="7680113">[</span><span class="op" id="7680114">]</span><span class="op" id="7680115">*</span><span class="ident" id="7680116">deflateTest</span><span class="op" id="7680127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680130">{</span><span class="op" id="7680131">[</span><span class="op" id="7680132">]</span><span class="builtintype" id="7680133">byte</span><span class="op" id="7680137">{</span><span class="op" id="7680138">}</span><span class="op" id="7680139">,</span>&nbsp;<span class="num" id="7680141">0</span><span class="op" id="7680142">,</span>&nbsp;<span class="op" id="7680144">[</span><span class="op" id="7680145">]</span><span class="builtintype" id="7680146">byte</span><span class="op" id="7680150">{</span><span class="num" id="7680151">1</span><span class="op" id="7680152">,</span>&nbsp;<span class="num" id="7680154">0</span><span class="op" id="7680155">,</span>&nbsp;<span class="num" id="7680157">0</span><span class="op" id="7680158">,</span>&nbsp;<span class="num" id="7680160">255</span><span class="op" id="7680163">,</span>&nbsp;<span class="num" id="7680165">255</span><span class="op" id="7680168">}</span><span class="op" id="7680169">}</span><span class="op" id="7680170">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680173">{</span><span class="op" id="7680174">[</span><span class="op" id="7680175">]</span><span class="builtintype" id="7680176">byte</span><span class="op" id="7680180">{</span><span class="num" id="7680181">0x11</span><span class="op" id="7680185">}</span><span class="op" id="7680186">,</span>&nbsp;<span class="op" id="7680188">-</span><span class="num" id="7680189">1</span><span class="op" id="7680190">,</span>&nbsp;<span class="op" id="7680192">[</span><span class="op" id="7680193">]</span><span class="builtintype" id="7680194">byte</span><span class="op" id="7680198">{</span><span class="num" id="7680199">18</span><span class="op" id="7680201">,</span>&nbsp;<span class="num" id="7680203">4</span><span class="op" id="7680204">,</span>&nbsp;<span class="num" id="7680206">4</span><span class="op" id="7680207">,</span>&nbsp;<span class="num" id="7680209">0</span><span class="op" id="7680210">,</span>&nbsp;<span class="num" id="7680212">0</span><span class="op" id="7680213">,</span>&nbsp;<span class="num" id="7680215">255</span><span class="op" id="7680218">,</span>&nbsp;<span class="num" id="7680220">255</span><span class="op" id="7680223">}</span><span class="op" id="7680224">}</span><span class="op" id="7680225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680228">{</span><span class="op" id="7680229">[</span><span class="op" id="7680230">]</span><span class="builtintype" id="7680231">byte</span><span class="op" id="7680235">{</span><span class="num" id="7680236">0x11</span><span class="op" id="7680240">}</span><span class="op" id="7680241">,</span>&nbsp;<span class="ident" id="7680243">DefaultCompression</span><span class="op" id="7680261">,</span>&nbsp;<span class="op" id="7680263">[</span><span class="op" id="7680264">]</span><span class="builtintype" id="7680265">byte</span><span class="op" id="7680269">{</span><span class="num" id="7680270">18</span><span class="op" id="7680272">,</span>&nbsp;<span class="num" id="7680274">4</span><span class="op" id="7680275">,</span>&nbsp;<span class="num" id="7680277">4</span><span class="op" id="7680278">,</span>&nbsp;<span class="num" id="7680280">0</span><span class="op" id="7680281">,</span>&nbsp;<span class="num" id="7680283">0</span><span class="op" id="7680284">,</span>&nbsp;<span class="num" id="7680286">255</span><span class="op" id="7680289">,</span>&nbsp;<span class="num" id="7680291">255</span><span class="op" id="7680294">}</span><span class="op" id="7680295">}</span><span class="op" id="7680296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680299">{</span><span class="op" id="7680300">[</span><span class="op" id="7680301">]</span><span class="builtintype" id="7680302">byte</span><span class="op" id="7680306">{</span><span class="num" id="7680307">0x11</span><span class="op" id="7680311">}</span><span class="op" id="7680312">,</span>&nbsp;<span class="num" id="7680314">4</span><span class="op" id="7680315">,</span>&nbsp;<span class="op" id="7680317">[</span><span class="op" id="7680318">]</span><span class="builtintype" id="7680319">byte</span><span class="op" id="7680323">{</span><span class="num" id="7680324">18</span><span class="op" id="7680326">,</span>&nbsp;<span class="num" id="7680328">4</span><span class="op" id="7680329">,</span>&nbsp;<span class="num" id="7680331">4</span><span class="op" id="7680332">,</span>&nbsp;<span class="num" id="7680334">0</span><span class="op" id="7680335">,</span>&nbsp;<span class="num" id="7680337">0</span><span class="op" id="7680338">,</span>&nbsp;<span class="num" id="7680340">255</span><span class="op" id="7680343">,</span>&nbsp;<span class="num" id="7680345">255</span><span class="op" id="7680348">}</span><span class="op" id="7680349">}</span><span class="op" id="7680350">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680354">{</span><span class="op" id="7680355">[</span><span class="op" id="7680356">]</span><span class="builtintype" id="7680357">byte</span><span class="op" id="7680361">{</span><span class="num" id="7680362">0x11</span><span class="op" id="7680366">}</span><span class="op" id="7680367">,</span>&nbsp;<span class="num" id="7680369">0</span><span class="op" id="7680370">,</span>&nbsp;<span class="op" id="7680372">[</span><span class="op" id="7680373">]</span><span class="builtintype" id="7680374">byte</span><span class="op" id="7680378">{</span><span class="num" id="7680379">0</span><span class="op" id="7680380">,</span>&nbsp;<span class="num" id="7680382">1</span><span class="op" id="7680383">,</span>&nbsp;<span class="num" id="7680385">0</span><span class="op" id="7680386">,</span>&nbsp;<span class="num" id="7680388">254</span><span class="op" id="7680391">,</span>&nbsp;<span class="num" id="7680393">255</span><span class="op" id="7680396">,</span>&nbsp;<span class="num" id="7680398">17</span><span class="op" id="7680400">,</span>&nbsp;<span class="num" id="7680402">1</span><span class="op" id="7680403">,</span>&nbsp;<span class="num" id="7680405">0</span><span class="op" id="7680406">,</span>&nbsp;<span class="num" id="7680408">0</span><span class="op" id="7680409">,</span>&nbsp;<span class="num" id="7680411">255</span><span class="op" id="7680414">,</span>&nbsp;<span class="num" id="7680416">255</span><span class="op" id="7680419">}</span><span class="op" id="7680420">}</span><span class="op" id="7680421">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680424">{</span><span class="op" id="7680425">[</span><span class="op" id="7680426">]</span><span class="builtintype" id="7680427">byte</span><span class="op" id="7680431">{</span><span class="num" id="7680432">0x11</span><span class="op" id="7680436">,</span>&nbsp;<span class="num" id="7680438">0x12</span><span class="op" id="7680442">}</span><span class="op" id="7680443">,</span>&nbsp;<span class="num" id="7680445">0</span><span class="op" id="7680446">,</span>&nbsp;<span class="op" id="7680448">[</span><span class="op" id="7680449">]</span><span class="builtintype" id="7680450">byte</span><span class="op" id="7680454">{</span><span class="num" id="7680455">0</span><span class="op" id="7680456">,</span>&nbsp;<span class="num" id="7680458">2</span><span class="op" id="7680459">,</span>&nbsp;<span class="num" id="7680461">0</span><span class="op" id="7680462">,</span>&nbsp;<span class="num" id="7680464">253</span><span class="op" id="7680467">,</span>&nbsp;<span class="num" id="7680469">255</span><span class="op" id="7680472">,</span>&nbsp;<span class="num" id="7680474">17</span><span class="op" id="7680476">,</span>&nbsp;<span class="num" id="7680478">18</span><span class="op" id="7680480">,</span>&nbsp;<span class="num" id="7680482">1</span><span class="op" id="7680483">,</span>&nbsp;<span class="num" id="7680485">0</span><span class="op" id="7680486">,</span>&nbsp;<span class="num" id="7680488">0</span><span class="op" id="7680489">,</span>&nbsp;<span class="num" id="7680491">255</span><span class="op" id="7680494">,</span>&nbsp;<span class="num" id="7680496">255</span><span class="op" id="7680499">}</span><span class="op" id="7680500">}</span><span class="op" id="7680501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680504">{</span><span class="op" id="7680505">[</span><span class="op" id="7680506">]</span><span class="builtintype" id="7680507">byte</span><span class="op" id="7680511">{</span><span class="num" id="7680512">0x11</span><span class="op" id="7680516">,</span>&nbsp;<span class="num" id="7680518">0x11</span><span class="op" id="7680522">,</span>&nbsp;<span class="num" id="7680524">0x11</span><span class="op" id="7680528">,</span>&nbsp;<span class="num" id="7680530">0x11</span><span class="op" id="7680534">,</span>&nbsp;<span class="num" id="7680536">0x11</span><span class="op" id="7680540">,</span>&nbsp;<span class="num" id="7680542">0x11</span><span class="op" id="7680546">,</span>&nbsp;<span class="num" id="7680548">0x11</span><span class="op" id="7680552">,</span>&nbsp;<span class="num" id="7680554">0x11</span><span class="op" id="7680558">}</span><span class="op" id="7680559">,</span>&nbsp;<span class="num" id="7680561">0</span><span class="op" id="7680562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680566">[</span><span class="op" id="7680567">]</span><span class="builtintype" id="7680568">byte</span><span class="op" id="7680572">{</span><span class="num" id="7680573">0</span><span class="op" id="7680574">,</span>&nbsp;<span class="num" id="7680576">8</span><span class="op" id="7680577">,</span>&nbsp;<span class="num" id="7680579">0</span><span class="op" id="7680580">,</span>&nbsp;<span class="num" id="7680582">247</span><span class="op" id="7680585">,</span>&nbsp;<span class="num" id="7680587">255</span><span class="op" id="7680590">,</span>&nbsp;<span class="num" id="7680592">17</span><span class="op" id="7680594">,</span>&nbsp;<span class="num" id="7680596">17</span><span class="op" id="7680598">,</span>&nbsp;<span class="num" id="7680600">17</span><span class="op" id="7680602">,</span>&nbsp;<span class="num" id="7680604">17</span><span class="op" id="7680606">,</span>&nbsp;<span class="num" id="7680608">17</span><span class="op" id="7680610">,</span>&nbsp;<span class="num" id="7680612">17</span><span class="op" id="7680614">,</span>&nbsp;<span class="num" id="7680616">17</span><span class="op" id="7680618">,</span>&nbsp;<span class="num" id="7680620">17</span><span class="op" id="7680622">,</span>&nbsp;<span class="num" id="7680624">1</span><span class="op" id="7680625">,</span>&nbsp;<span class="num" id="7680627">0</span><span class="op" id="7680628">,</span>&nbsp;<span class="num" id="7680630">0</span><span class="op" id="7680631">,</span>&nbsp;<span class="num" id="7680633">255</span><span class="op" id="7680636">,</span>&nbsp;<span class="num" id="7680638">255</span><span class="op" id="7680641">}</span><span class="op" id="7680642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680645">}</span><span class="op" id="7680646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680649">{</span><span class="op" id="7680650">[</span><span class="op" id="7680651">]</span><span class="builtintype" id="7680652">byte</span><span class="op" id="7680656">{</span><span class="op" id="7680657">}</span><span class="op" id="7680658">,</span>&nbsp;<span class="num" id="7680660">1</span><span class="op" id="7680661">,</span>&nbsp;<span class="op" id="7680663">[</span><span class="op" id="7680664">]</span><span class="builtintype" id="7680665">byte</span><span class="op" id="7680669">{</span><span class="num" id="7680670">1</span><span class="op" id="7680671">,</span>&nbsp;<span class="num" id="7680673">0</span><span class="op" id="7680674">,</span>&nbsp;<span class="num" id="7680676">0</span><span class="op" id="7680677">,</span>&nbsp;<span class="num" id="7680679">255</span><span class="op" id="7680682">,</span>&nbsp;<span class="num" id="7680684">255</span><span class="op" id="7680687">}</span><span class="op" id="7680688">}</span><span class="op" id="7680689">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680692">{</span><span class="op" id="7680693">[</span><span class="op" id="7680694">]</span><span class="builtintype" id="7680695">byte</span><span class="op" id="7680699">{</span><span class="num" id="7680700">0x11</span><span class="op" id="7680704">}</span><span class="op" id="7680705">,</span>&nbsp;<span class="num" id="7680707">1</span><span class="op" id="7680708">,</span>&nbsp;<span class="op" id="7680710">[</span><span class="op" id="7680711">]</span><span class="builtintype" id="7680712">byte</span><span class="op" id="7680716">{</span><span class="num" id="7680717">18</span><span class="op" id="7680719">,</span>&nbsp;<span class="num" id="7680721">4</span><span class="op" id="7680722">,</span>&nbsp;<span class="num" id="7680724">4</span><span class="op" id="7680725">,</span>&nbsp;<span class="num" id="7680727">0</span><span class="op" id="7680728">,</span>&nbsp;<span class="num" id="7680730">0</span><span class="op" id="7680731">,</span>&nbsp;<span class="num" id="7680733">255</span><span class="op" id="7680736">,</span>&nbsp;<span class="num" id="7680738">255</span><span class="op" id="7680741">}</span><span class="op" id="7680742">}</span><span class="op" id="7680743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680746">{</span><span class="op" id="7680747">[</span><span class="op" id="7680748">]</span><span class="builtintype" id="7680749">byte</span><span class="op" id="7680753">{</span><span class="num" id="7680754">0x11</span><span class="op" id="7680758">,</span>&nbsp;<span class="num" id="7680760">0x12</span><span class="op" id="7680764">}</span><span class="op" id="7680765">,</span>&nbsp;<span class="num" id="7680767">1</span><span class="op" id="7680768">,</span>&nbsp;<span class="op" id="7680770">[</span><span class="op" id="7680771">]</span><span class="builtintype" id="7680772">byte</span><span class="op" id="7680776">{</span><span class="num" id="7680777">18</span><span class="op" id="7680779">,</span>&nbsp;<span class="num" id="7680781">20</span><span class="op" id="7680783">,</span>&nbsp;<span class="num" id="7680785">2</span><span class="op" id="7680786">,</span>&nbsp;<span class="num" id="7680788">4</span><span class="op" id="7680789">,</span>&nbsp;<span class="num" id="7680791">0</span><span class="op" id="7680792">,</span>&nbsp;<span class="num" id="7680794">0</span><span class="op" id="7680795">,</span>&nbsp;<span class="num" id="7680797">255</span><span class="op" id="7680800">,</span>&nbsp;<span class="num" id="7680802">255</span><span class="op" id="7680805">}</span><span class="op" id="7680806">}</span><span class="op" id="7680807">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680810">{</span><span class="op" id="7680811">[</span><span class="op" id="7680812">]</span><span class="builtintype" id="7680813">byte</span><span class="op" id="7680817">{</span><span class="num" id="7680818">0x11</span><span class="op" id="7680822">,</span>&nbsp;<span class="num" id="7680824">0x11</span><span class="op" id="7680828">,</span>&nbsp;<span class="num" id="7680830">0x11</span><span class="op" id="7680834">,</span>&nbsp;<span class="num" id="7680836">0x11</span><span class="op" id="7680840">,</span>&nbsp;<span class="num" id="7680842">0x11</span><span class="op" id="7680846">,</span>&nbsp;<span class="num" id="7680848">0x11</span><span class="op" id="7680852">,</span>&nbsp;<span class="num" id="7680854">0x11</span><span class="op" id="7680858">,</span>&nbsp;<span class="num" id="7680860">0x11</span><span class="op" id="7680864">}</span><span class="op" id="7680865">,</span>&nbsp;<span class="num" id="7680867">1</span><span class="op" id="7680868">,</span>&nbsp;<span class="op" id="7680870">[</span><span class="op" id="7680871">]</span><span class="builtintype" id="7680872">byte</span><span class="op" id="7680876">{</span><span class="num" id="7680877">18</span><span class="op" id="7680879">,</span>&nbsp;<span class="num" id="7680881">132</span><span class="op" id="7680884">,</span>&nbsp;<span class="num" id="7680886">2</span><span class="op" id="7680887">,</span>&nbsp;<span class="num" id="7680889">64</span><span class="op" id="7680891">,</span>&nbsp;<span class="num" id="7680893">0</span><span class="op" id="7680894">,</span>&nbsp;<span class="num" id="7680896">0</span><span class="op" id="7680897">,</span>&nbsp;<span class="num" id="7680899">0</span><span class="op" id="7680900">,</span>&nbsp;<span class="num" id="7680902">255</span><span class="op" id="7680905">,</span>&nbsp;<span class="num" id="7680907">255</span><span class="op" id="7680910">}</span><span class="op" id="7680911">}</span><span class="op" id="7680912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680915">{</span><span class="op" id="7680916">[</span><span class="op" id="7680917">]</span><span class="builtintype" id="7680918">byte</span><span class="op" id="7680922">{</span><span class="op" id="7680923">}</span><span class="op" id="7680924">,</span>&nbsp;<span class="num" id="7680926">9</span><span class="op" id="7680927">,</span>&nbsp;<span class="op" id="7680929">[</span><span class="op" id="7680930">]</span><span class="builtintype" id="7680931">byte</span><span class="op" id="7680935">{</span><span class="num" id="7680936">1</span><span class="op" id="7680937">,</span>&nbsp;<span class="num" id="7680939">0</span><span class="op" id="7680940">,</span>&nbsp;<span class="num" id="7680942">0</span><span class="op" id="7680943">,</span>&nbsp;<span class="num" id="7680945">255</span><span class="op" id="7680948">,</span>&nbsp;<span class="num" id="7680950">255</span><span class="op" id="7680953">}</span><span class="op" id="7680954">}</span><span class="op" id="7680955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680958">{</span><span class="op" id="7680959">[</span><span class="op" id="7680960">]</span><span class="builtintype" id="7680961">byte</span><span class="op" id="7680965">{</span><span class="num" id="7680966">0x11</span><span class="op" id="7680970">}</span><span class="op" id="7680971">,</span>&nbsp;<span class="num" id="7680973">9</span><span class="op" id="7680974">,</span>&nbsp;<span class="op" id="7680976">[</span><span class="op" id="7680977">]</span><span class="builtintype" id="7680978">byte</span><span class="op" id="7680982">{</span><span class="num" id="7680983">18</span><span class="op" id="7680985">,</span>&nbsp;<span class="num" id="7680987">4</span><span class="op" id="7680988">,</span>&nbsp;<span class="num" id="7680990">4</span><span class="op" id="7680991">,</span>&nbsp;<span class="num" id="7680993">0</span><span class="op" id="7680994">,</span>&nbsp;<span class="num" id="7680996">0</span><span class="op" id="7680997">,</span>&nbsp;<span class="num" id="7680999">255</span><span class="op" id="7681002">,</span>&nbsp;<span class="num" id="7681004">255</span><span class="op" id="7681007">}</span><span class="op" id="7681008">}</span><span class="op" id="7681009">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681012">{</span><span class="op" id="7681013">[</span><span class="op" id="7681014">]</span><span class="builtintype" id="7681015">byte</span><span class="op" id="7681019">{</span><span class="num" id="7681020">0x11</span><span class="op" id="7681024">,</span>&nbsp;<span class="num" id="7681026">0x12</span><span class="op" id="7681030">}</span><span class="op" id="7681031">,</span>&nbsp;<span class="num" id="7681033">9</span><span class="op" id="7681034">,</span>&nbsp;<span class="op" id="7681036">[</span><span class="op" id="7681037">]</span><span class="builtintype" id="7681038">byte</span><span class="op" id="7681042">{</span><span class="num" id="7681043">18</span><span class="op" id="7681045">,</span>&nbsp;<span class="num" id="7681047">20</span><span class="op" id="7681049">,</span>&nbsp;<span class="num" id="7681051">2</span><span class="op" id="7681052">,</span>&nbsp;<span class="num" id="7681054">4</span><span class="op" id="7681055">,</span>&nbsp;<span class="num" id="7681057">0</span><span class="op" id="7681058">,</span>&nbsp;<span class="num" id="7681060">0</span><span class="op" id="7681061">,</span>&nbsp;<span class="num" id="7681063">255</span><span class="op" id="7681066">,</span>&nbsp;<span class="num" id="7681068">255</span><span class="op" id="7681071">}</span><span class="op" id="7681072">}</span><span class="op" id="7681073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681076">{</span><span class="op" id="7681077">[</span><span class="op" id="7681078">]</span><span class="builtintype" id="7681079">byte</span><span class="op" id="7681083">{</span><span class="num" id="7681084">0x11</span><span class="op" id="7681088">,</span>&nbsp;<span class="num" id="7681090">0x11</span><span class="op" id="7681094">,</span>&nbsp;<span class="num" id="7681096">0x11</span><span class="op" id="7681100">,</span>&nbsp;<span class="num" id="7681102">0x11</span><span class="op" id="7681106">,</span>&nbsp;<span class="num" id="7681108">0x11</span><span class="op" id="7681112">,</span>&nbsp;<span class="num" id="7681114">0x11</span><span class="op" id="7681118">,</span>&nbsp;<span class="num" id="7681120">0x11</span><span class="op" id="7681124">,</span>&nbsp;<span class="num" id="7681126">0x11</span><span class="op" id="7681130">}</span><span class="op" id="7681131">,</span>&nbsp;<span class="num" id="7681133">9</span><span class="op" id="7681134">,</span>&nbsp;<span class="op" id="7681136">[</span><span class="op" id="7681137">]</span><span class="builtintype" id="7681138">byte</span><span class="op" id="7681142">{</span><span class="num" id="7681143">18</span><span class="op" id="7681145">,</span>&nbsp;<span class="num" id="7681147">132</span><span class="op" id="7681150">,</span>&nbsp;<span class="num" id="7681152">2</span><span class="op" id="7681153">,</span>&nbsp;<span class="num" id="7681155">64</span><span class="op" id="7681157">,</span>&nbsp;<span class="num" id="7681159">0</span><span class="op" id="7681160">,</span>&nbsp;<span class="num" id="7681162">0</span><span class="op" id="7681163">,</span>&nbsp;<span class="num" id="7681165">0</span><span class="op" id="7681166">,</span>&nbsp;<span class="num" id="7681168">255</span><span class="op" id="7681171">,</span>&nbsp;<span class="num" id="7681173">255</span><span class="op" id="7681176">}</span><span class="op" id="7681177">}</span><span class="op" id="7681178">,</span><br>
<span class="lineno"></span><span class="op" id="7681180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7681183">var</span>&nbsp;<span class="ident" id="7681187">deflateInflateTests</span>&nbsp;<span class="op" id="7681207">=</span>&nbsp;<span class="op" id="7681209">[</span><span class="op" id="7681210">]</span><span class="op" id="7681211">*</span><span class="ident" id="7681212">deflateInflateTest</span><span class="op" id="7681230">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681233">{</span><span class="op" id="7681234">[</span><span class="op" id="7681235">]</span><span class="builtintype" id="7681236">byte</span><span class="op" id="7681240">{</span><span class="op" id="7681241">}</span><span class="op" id="7681242">}</span><span class="op" id="7681243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681246">{</span><span class="op" id="7681247">[</span><span class="op" id="7681248">]</span><span class="builtintype" id="7681249">byte</span><span class="op" id="7681253">{</span><span class="num" id="7681254">0x11</span><span class="op" id="7681258">}</span><span class="op" id="7681259">}</span><span class="op" id="7681260">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681263">{</span><span class="op" id="7681264">[</span><span class="op" id="7681265">]</span><span class="builtintype" id="7681266">byte</span><span class="op" id="7681270">{</span><span class="num" id="7681271">0x11</span><span class="op" id="7681275">,</span>&nbsp;<span class="num" id="7681277">0x12</span><span class="op" id="7681281">}</span><span class="op" id="7681282">}</span><span class="op" id="7681283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681286">{</span><span class="op" id="7681287">[</span><span class="op" id="7681288">]</span><span class="builtintype" id="7681289">byte</span><span class="op" id="7681293">{</span><span class="num" id="7681294">0x11</span><span class="op" id="7681298">,</span>&nbsp;<span class="num" id="7681300">0x11</span><span class="op" id="7681304">,</span>&nbsp;<span class="num" id="7681306">0x11</span><span class="op" id="7681310">,</span>&nbsp;<span class="num" id="7681312">0x11</span><span class="op" id="7681316">,</span>&nbsp;<span class="num" id="7681318">0x11</span><span class="op" id="7681322">,</span>&nbsp;<span class="num" id="7681324">0x11</span><span class="op" id="7681328">,</span>&nbsp;<span class="num" id="7681330">0x11</span><span class="op" id="7681334">,</span>&nbsp;<span class="num" id="7681336">0x11</span><span class="op" id="7681340">}</span><span class="op" id="7681341">}</span><span class="op" id="7681342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681345">{</span><span class="op" id="7681346">[</span><span class="op" id="7681347">]</span><span class="builtintype" id="7681348">byte</span><span class="op" id="7681352">{</span><span class="num" id="7681353">0x11</span><span class="op" id="7681357">,</span>&nbsp;<span class="num" id="7681359">0x10</span><span class="op" id="7681363">,</span>&nbsp;<span class="num" id="7681365">0x13</span><span class="op" id="7681369">,</span>&nbsp;<span class="num" id="7681371">0x41</span><span class="op" id="7681375">,</span>&nbsp;<span class="num" id="7681377">0x21</span><span class="op" id="7681381">,</span>&nbsp;<span class="num" id="7681383">0x21</span><span class="op" id="7681387">,</span>&nbsp;<span class="num" id="7681389">0x41</span><span class="op" id="7681393">,</span>&nbsp;<span class="num" id="7681395">0x13</span><span class="op" id="7681399">,</span>&nbsp;<span class="num" id="7681401">0x87</span><span class="op" id="7681405">,</span>&nbsp;<span class="num" id="7681407">0x78</span><span class="op" id="7681411">,</span>&nbsp;<span class="num" id="7681413">0x13</span><span class="op" id="7681417">}</span><span class="op" id="7681418">}</span><span class="op" id="7681419">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681422">{</span><span class="ident" id="7681423">largeDataChunk</span><span class="op" id="7681437">(</span><span class="op" id="7681438">)</span><span class="op" id="7681439">}</span><span class="op" id="7681440">,</span><br>
<span class="lineno"></span><span class="op" id="7681442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7681445">var</span>&nbsp;<span class="ident" id="7681449">reverseBitsTests</span>&nbsp;<span class="op" id="7681466">=</span>&nbsp;<span class="op" id="7681468">[</span><span class="op" id="7681469">]</span><span class="op" id="7681470">*</span><span class="ident" id="7681471">reverseBitsTest</span><span class="op" id="7681486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681489">{</span><span class="num" id="7681490">1</span><span class="op" id="7681491">,</span>&nbsp;<span class="num" id="7681493">1</span><span class="op" id="7681494">,</span>&nbsp;<span class="num" id="7681496">1</span><span class="op" id="7681497">}</span><span class="op" id="7681498">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681501">{</span><span class="num" id="7681502">1</span><span class="op" id="7681503">,</span>&nbsp;<span class="num" id="7681505">2</span><span class="op" id="7681506">,</span>&nbsp;<span class="num" id="7681508">2</span><span class="op" id="7681509">}</span><span class="op" id="7681510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681513">{</span><span class="num" id="7681514">1</span><span class="op" id="7681515">,</span>&nbsp;<span class="num" id="7681517">3</span><span class="op" id="7681518">,</span>&nbsp;<span class="num" id="7681520">4</span><span class="op" id="7681521">}</span><span class="op" id="7681522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681525">{</span><span class="num" id="7681526">1</span><span class="op" id="7681527">,</span>&nbsp;<span class="num" id="7681529">4</span><span class="op" id="7681530">,</span>&nbsp;<span class="num" id="7681532">8</span><span class="op" id="7681533">}</span><span class="op" id="7681534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681537">{</span><span class="num" id="7681538">1</span><span class="op" id="7681539">,</span>&nbsp;<span class="num" id="7681541">5</span><span class="op" id="7681542">,</span>&nbsp;<span class="num" id="7681544">16</span><span class="op" id="7681546">}</span><span class="op" id="7681547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681550">{</span><span class="num" id="7681551">17</span><span class="op" id="7681553">,</span>&nbsp;<span class="num" id="7681555">5</span><span class="op" id="7681556">,</span>&nbsp;<span class="num" id="7681558">17</span><span class="op" id="7681560">}</span><span class="op" id="7681561">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681564">{</span><span class="num" id="7681565">257</span><span class="op" id="7681568">,</span>&nbsp;<span class="num" id="7681570">9</span><span class="op" id="7681571">,</span>&nbsp;<span class="num" id="7681573">257</span><span class="op" id="7681576">}</span><span class="op" id="7681577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681580">{</span><span class="num" id="7681581">29</span><span class="op" id="7681583">,</span>&nbsp;<span class="num" id="7681585">5</span><span class="op" id="7681586">,</span>&nbsp;<span class="num" id="7681588">23</span><span class="op" id="7681590">}</span><span class="op" id="7681591">,</span><br>
<span class="lineno"></span><span class="op" id="7681593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7681596">func</span>&nbsp;<span class="ident" id="7681601">largeDataChunk</span><span class="op" id="7681615">(</span><span class="op" id="7681616">)</span>&nbsp;<span class="op" id="7681618">[</span><span class="op" id="7681619">]</span><span class="builtintype" id="7681620">byte</span>&nbsp;<span class="op" id="7681625">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681628">result</span>&nbsp;<span class="op" id="7681635">:=</span>&nbsp;<span class="builtinfunc" id="7681638">make</span><span class="op" id="7681642">(</span><span class="op" id="7681643">[</span><span class="op" id="7681644">]</span><span class="builtintype" id="7681645">byte</span><span class="op" id="7681649">,</span>&nbsp;<span class="num" id="7681651">100000</span><span class="op" id="7681657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681660">for</span>&nbsp;<span class="ident" id="7681664">i</span>&nbsp;<span class="op" id="7681666">:=</span>&nbsp;<span class="keyword" id="7681669">range</span>&nbsp;<span class="ident" id="7681675">result</span>&nbsp;<span class="op" id="7681682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681686">result</span><span class="op" id="7681692">[</span><span class="ident" id="7681693">i</span><span class="op" id="7681694">]</span>&nbsp;<span class="op" id="7681696">=</span>&nbsp;<span class="builtintype" id="7681698">byte</span><span class="op" id="7681702">(</span><span class="ident" id="7681703">i</span>&nbsp;<span class="op" id="7681705">*</span>&nbsp;<span class="ident" id="7681707">i</span>&nbsp;<span class="op" id="7681709">&amp;</span>&nbsp;<span class="num" id="7681711">0xFF</span><span class="op" id="7681715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681721">return</span>&nbsp;<span class="ident" id="7681728">result</span><br>
<span class="lineno">80</span><span class="op" id="7681735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7681738">func</span>&nbsp;<span class="ident" id="7681743">TestDeflate</span><span class="op" id="7681754">(</span><span class="ident" id="7681755">t</span>&nbsp;<span class="op" id="7681757">*</span><span class="ident" id="7681758">testing</span><span class="op" id="7681765">.</span><span class="ident" id="7681766">T</span><span class="op" id="7681767">)</span>&nbsp;<span class="op" id="7681769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681772">for</span>&nbsp;<span class="ident" id="7681776">_</span><span class="op" id="7681777">,</span>&nbsp;<span class="ident" id="7681779">h</span>&nbsp;<span class="op" id="7681781">:=</span>&nbsp;<span class="keyword" id="7681784">range</span>&nbsp;<span class="ident" id="7681790">deflateTests</span>&nbsp;<span class="op" id="7681803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681807">var</span>&nbsp;<span class="ident" id="7681811">buf</span>&nbsp;<span class="ident" id="7681815">bytes</span><span class="op" id="7681820">.</span><span class="ident" id="7681821">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681830">w</span><span class="op" id="7681831">,</span>&nbsp;<span class="ident" id="7681833">err</span>&nbsp;<span class="op" id="7681837">:=</span>&nbsp;<span class="ident" id="7681840">NewWriter</span><span class="op" id="7681849">(</span><span class="op" id="7681850">&amp;</span><span class="ident" id="7681851">buf</span><span class="op" id="7681854">,</span>&nbsp;<span class="ident" id="7681856">h</span><span class="op" id="7681857">.</span><span class="ident" id="7681858">level</span><span class="op" id="7681863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681867">if</span>&nbsp;<span class="ident" id="7681870">err</span>&nbsp;<span class="op" id="7681874">!=</span>&nbsp;<span class="ident" id="7681877">nil</span>&nbsp;<span class="op" id="7681881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681886">t</span><span class="op" id="7681887">.</span><span class="ident" id="7681888">Errorf</span><span class="op" id="7681894">(</span><span class="string" id="7681895">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7681910">,</span>&nbsp;<span class="ident" id="7681912">err</span><span class="op" id="7681915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681920">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681931">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681935">w</span><span class="op" id="7681936">.</span><span class="ident" id="7681937">Write</span><span class="op" id="7681942">(</span><span class="ident" id="7681943">h</span><span class="op" id="7681944">.</span><span class="ident" id="7681945">in</span><span class="op" id="7681947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681951">w</span><span class="op" id="7681952">.</span><span class="ident" id="7681953">Close</span><span class="op" id="7681958">(</span><span class="op" id="7681959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681963">if</span>&nbsp;<span class="op" id="7681966">!</span><span class="ident" id="7681967">bytes</span><span class="op" id="7681972">.</span><span class="ident" id="7681973">Equal</span><span class="op" id="7681978">(</span><span class="ident" id="7681979">buf</span><span class="op" id="7681982">.</span><span class="ident" id="7681983">Bytes</span><span class="op" id="7681988">(</span><span class="op" id="7681989">)</span><span class="op" id="7681990">,</span>&nbsp;<span class="ident" id="7681992">h</span><span class="op" id="7681993">.</span><span class="ident" id="7681994">out</span><span class="op" id="7681997">)</span>&nbsp;<span class="op" id="7681999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682004">t</span><span class="op" id="7682005">.</span><span class="ident" id="7682006">Errorf</span><span class="op" id="7682012">(</span><span class="string" id="7682013">&#34;Deflate(%d,&nbsp;%x)&nbsp;=&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="7682044">,</span>&nbsp;<span class="ident" id="7682046">h</span><span class="op" id="7682047">.</span><span class="ident" id="7682048">level</span><span class="op" id="7682053">,</span>&nbsp;<span class="ident" id="7682055">h</span><span class="op" id="7682056">.</span><span class="ident" id="7682057">in</span><span class="op" id="7682059">,</span>&nbsp;<span class="ident" id="7682061">buf</span><span class="op" id="7682064">.</span><span class="ident" id="7682065">Bytes</span><span class="op" id="7682070">(</span><span class="op" id="7682071">)</span><span class="op" id="7682072">,</span>&nbsp;<span class="ident" id="7682074">h</span><span class="op" id="7682075">.</span><span class="ident" id="7682076">out</span><span class="op" id="7682079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682083">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682086">}</span><br>
<span class="lineno"></span><span class="op" id="7682088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7682091">//&nbsp;A&nbsp;sparseReader&nbsp;returns&nbsp;a&nbsp;stream&nbsp;consisting&nbsp;of&nbsp;0s&nbsp;followed&nbsp;by&nbsp;1&lt;&lt;16&nbsp;1s.</span><br>
<span class="lineno"></span><span class="comment" id="7682165">//&nbsp;This&nbsp;tests&nbsp;missing&nbsp;hash&nbsp;references&nbsp;in&nbsp;a&nbsp;very&nbsp;large&nbsp;input.</span><br>
<span class="lineno">100</span><span class="keyword" id="7682226">type</span>&nbsp;<span class="ident" id="7682231">sparseReader</span>&nbsp;<span class="keyword" id="7682244">struct</span>&nbsp;<span class="op" id="7682251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682254">l</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7682258">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682265">cur</span>&nbsp;<span class="ident" id="7682269">int64</span><br>
<span class="lineno"></span><span class="op" id="7682275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7682278">func</span>&nbsp;<span class="op" id="7682283">(</span><span class="ident" id="7682284">r</span>&nbsp;<span class="op" id="7682286">*</span><span class="ident" id="7682287">sparseReader</span><span class="op" id="7682299">)</span>&nbsp;<span class="ident" id="7682301">Read</span><span class="op" id="7682305">(</span><span class="ident" id="7682306">b</span>&nbsp;<span class="op" id="7682308">[</span><span class="op" id="7682309">]</span><span class="builtintype" id="7682310">byte</span><span class="op" id="7682314">)</span>&nbsp;<span class="op" id="7682316">(</span><span class="ident" id="7682317">n</span>&nbsp;<span class="builtintype" id="7682319">int</span><span class="op" id="7682322">,</span>&nbsp;<span class="ident" id="7682324">err</span>&nbsp;<span class="builtintype" id="7682328">error</span><span class="op" id="7682333">)</span>&nbsp;<span class="op" id="7682335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682338">if</span>&nbsp;<span class="ident" id="7682341">r</span><span class="op" id="7682342">.</span><span class="ident" id="7682343">cur</span>&nbsp;<span class="op" id="7682347">&gt;=</span>&nbsp;<span class="ident" id="7682350">r</span><span class="op" id="7682351">.</span><span class="ident" id="7682352">l</span>&nbsp;<span class="op" id="7682354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682358">return</span>&nbsp;<span class="num" id="7682365">0</span><span class="op" id="7682366">,</span>&nbsp;<span class="ident" id="7682368">io</span><span class="op" id="7682370">.</span><span class="ident" id="7682371">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682379">n</span>&nbsp;<span class="op" id="7682381">=</span>&nbsp;<span class="builtinfunc" id="7682383">len</span><span class="op" id="7682386">(</span><span class="ident" id="7682387">b</span><span class="op" id="7682388">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682391">cur</span>&nbsp;<span class="op" id="7682395">:=</span>&nbsp;<span class="ident" id="7682398">r</span><span class="op" id="7682399">.</span><span class="ident" id="7682400">cur</span>&nbsp;<span class="op" id="7682404">+</span>&nbsp;<span class="ident" id="7682406">int64</span><span class="op" id="7682411">(</span><span class="ident" id="7682412">n</span><span class="op" id="7682413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682416">if</span>&nbsp;<span class="ident" id="7682419">cur</span>&nbsp;<span class="op" id="7682423">&gt;</span>&nbsp;<span class="ident" id="7682425">r</span><span class="op" id="7682426">.</span><span class="ident" id="7682427">l</span>&nbsp;<span class="op" id="7682429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682433">n</span>&nbsp;<span class="op" id="7682435">-=</span>&nbsp;<span class="builtintype" id="7682438">int</span><span class="op" id="7682441">(</span><span class="ident" id="7682442">cur</span>&nbsp;<span class="op" id="7682446">-</span>&nbsp;<span class="ident" id="7682448">r</span><span class="op" id="7682449">.</span><span class="ident" id="7682450">l</span><span class="op" id="7682451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682455">cur</span>&nbsp;<span class="op" id="7682459">=</span>&nbsp;<span class="ident" id="7682461">r</span><span class="op" id="7682462">.</span><span class="ident" id="7682463">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682466">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682469">for</span>&nbsp;<span class="ident" id="7682473">i</span>&nbsp;<span class="op" id="7682475">:=</span>&nbsp;<span class="keyword" id="7682478">range</span>&nbsp;<span class="ident" id="7682484">b</span><span class="op" id="7682485">[</span><span class="num" id="7682486">0</span><span class="op" id="7682487">:</span><span class="ident" id="7682488">n</span><span class="op" id="7682489">]</span>&nbsp;<span class="op" id="7682491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682495">if</span>&nbsp;<span class="ident" id="7682498">r</span><span class="op" id="7682499">.</span><span class="ident" id="7682500">cur</span><span class="op" id="7682503">+</span><span class="ident" id="7682504">int64</span><span class="op" id="7682509">(</span><span class="ident" id="7682510">i</span><span class="op" id="7682511">)</span>&nbsp;<span class="op" id="7682513">&gt;=</span>&nbsp;<span class="ident" id="7682516">r</span><span class="op" id="7682517">.</span><span class="ident" id="7682518">l</span><span class="op" id="7682519">-</span><span class="num" id="7682520">1</span><span class="op" id="7682521">&lt;&lt;</span><span class="num" id="7682523">16</span>&nbsp;<span class="op" id="7682526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682531">b</span><span class="op" id="7682532">[</span><span class="ident" id="7682533">i</span><span class="op" id="7682534">]</span>&nbsp;<span class="op" id="7682536">=</span>&nbsp;<span class="num" id="7682538">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682542">}</span>&nbsp;<span class="keyword" id="7682544">else</span>&nbsp;<span class="op" id="7682549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682554">b</span><span class="op" id="7682555">[</span><span class="ident" id="7682556">i</span><span class="op" id="7682557">]</span>&nbsp;<span class="op" id="7682559">=</span>&nbsp;<span class="num" id="7682561">0</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682571">r</span><span class="op" id="7682572">.</span><span class="ident" id="7682573">cur</span>&nbsp;<span class="op" id="7682577">=</span>&nbsp;<span class="ident" id="7682579">cur</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682584">return</span><br>
<span class="lineno"></span><span class="op" id="7682591">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7682594">func</span>&nbsp;<span class="ident" id="7682599">TestVeryLongSparseChunk</span><span class="op" id="7682622">(</span><span class="ident" id="7682623">t</span>&nbsp;<span class="op" id="7682625">*</span><span class="ident" id="7682626">testing</span><span class="op" id="7682633">.</span><span class="ident" id="7682634">T</span><span class="op" id="7682635">)</span>&nbsp;<span class="op" id="7682637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682640">if</span>&nbsp;<span class="ident" id="7682643">testing</span><span class="op" id="7682650">.</span><span class="ident" id="7682651">Short</span><span class="op" id="7682656">(</span><span class="op" id="7682657">)</span>&nbsp;<span class="op" id="7682659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682663">t</span><span class="op" id="7682664">.</span><span class="ident" id="7682665">Skip</span><span class="op" id="7682669">(</span><span class="string" id="7682670">&#34;skipping&nbsp;sparse&nbsp;chunk&nbsp;during&nbsp;short&nbsp;test&#34;</span><span class="op" id="7682711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682714">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682717">w</span><span class="op" id="7682718">,</span>&nbsp;<span class="ident" id="7682720">err</span>&nbsp;<span class="op" id="7682724">:=</span>&nbsp;<span class="ident" id="7682727">NewWriter</span><span class="op" id="7682736">(</span><span class="ident" id="7682737">ioutil</span><span class="op" id="7682743">.</span><span class="ident" id="7682744">Discard</span><span class="op" id="7682751">,</span>&nbsp;<span class="num" id="7682753">1</span><span class="op" id="7682754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682757">if</span>&nbsp;<span class="ident" id="7682760">err</span>&nbsp;<span class="op" id="7682764">!=</span>&nbsp;<span class="ident" id="7682767">nil</span>&nbsp;<span class="op" id="7682771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682775">t</span><span class="op" id="7682776">.</span><span class="ident" id="7682777">Errorf</span><span class="op" id="7682783">(</span><span class="string" id="7682784">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7682799">,</span>&nbsp;<span class="ident" id="7682801">err</span><span class="op" id="7682804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682808">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682816">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682819">if</span>&nbsp;<span class="ident" id="7682822">_</span><span class="op" id="7682823">,</span>&nbsp;<span class="ident" id="7682825">err</span>&nbsp;<span class="op" id="7682829">=</span>&nbsp;<span class="ident" id="7682831">io</span><span class="op" id="7682833">.</span><span class="ident" id="7682834">Copy</span><span class="op" id="7682838">(</span><span class="ident" id="7682839">w</span><span class="op" id="7682840">,</span>&nbsp;<span class="op" id="7682842">&amp;</span><span class="ident" id="7682843">sparseReader</span><span class="op" id="7682855">{</span><span class="ident" id="7682856">l</span><span class="op" id="7682857">:</span>&nbsp;<span class="num" id="7682859">23E8</span><span class="op" id="7682863">}</span><span class="op" id="7682864">)</span><span class="op" id="7682865">;</span>&nbsp;<span class="ident" id="7682867">err</span>&nbsp;<span class="op" id="7682871">!=</span>&nbsp;<span class="ident" id="7682874">nil</span>&nbsp;<span class="op" id="7682878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682882">t</span><span class="op" id="7682883">.</span><span class="ident" id="7682884">Errorf</span><span class="op" id="7682890">(</span><span class="string" id="7682891">&#34;Compress&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7682912">,</span>&nbsp;<span class="ident" id="7682914">err</span><span class="op" id="7682917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682921">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682929">}</span><br>
<span class="lineno"></span><span class="op" id="7682931">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="7682934">type</span>&nbsp;<span class="ident" id="7682939">syncBuffer</span>&nbsp;<span class="keyword" id="7682950">struct</span>&nbsp;<span class="op" id="7682957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682960">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682967">bytes</span><span class="op" id="7682972">.</span><span class="ident" id="7682973">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682981">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682988">sync</span><span class="op" id="7682992">.</span><span class="ident" id="7682993">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683002">closed</span>&nbsp;<span class="builtintype" id="7683009">bool</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683015">ready</span>&nbsp;&nbsp;<span class="keyword" id="7683022">chan</span>&nbsp;<span class="builtintype" id="7683027">bool</span><br>
<span class="lineno"></span><span class="op" id="7683032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7683035">func</span>&nbsp;<span class="ident" id="7683040">newSyncBuffer</span><span class="op" id="7683053">(</span><span class="op" id="7683054">)</span>&nbsp;<span class="op" id="7683056">*</span><span class="ident" id="7683057">syncBuffer</span>&nbsp;<span class="op" id="7683068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683071">return</span>&nbsp;<span class="op" id="7683078">&amp;</span><span class="ident" id="7683079">syncBuffer</span><span class="op" id="7683089">{</span><span class="ident" id="7683090">ready</span><span class="op" id="7683095">:</span>&nbsp;<span class="builtinfunc" id="7683097">make</span><span class="op" id="7683101">(</span><span class="keyword" id="7683102">chan</span>&nbsp;<span class="builtintype" id="7683107">bool</span><span class="op" id="7683111">,</span>&nbsp;<span class="num" id="7683113">1</span><span class="op" id="7683114">)</span><span class="op" id="7683115">}</span><br>
<span class="lineno">150</span><span class="op" id="7683117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7683120">func</span>&nbsp;<span class="op" id="7683125">(</span><span class="ident" id="7683126">b</span>&nbsp;<span class="op" id="7683128">*</span><span class="ident" id="7683129">syncBuffer</span><span class="op" id="7683139">)</span>&nbsp;<span class="ident" id="7683141">Read</span><span class="op" id="7683145">(</span><span class="ident" id="7683146">p</span>&nbsp;<span class="op" id="7683148">[</span><span class="op" id="7683149">]</span><span class="builtintype" id="7683150">byte</span><span class="op" id="7683154">)</span>&nbsp;<span class="op" id="7683156">(</span><span class="ident" id="7683157">n</span>&nbsp;<span class="builtintype" id="7683159">int</span><span class="op" id="7683162">,</span>&nbsp;<span class="ident" id="7683164">err</span>&nbsp;<span class="builtintype" id="7683168">error</span><span class="op" id="7683173">)</span>&nbsp;<span class="op" id="7683175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683178">for</span>&nbsp;<span class="op" id="7683182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683186">b</span><span class="op" id="7683187">.</span><span class="ident" id="7683188">mu</span><span class="op" id="7683190">.</span><span class="ident" id="7683191">RLock</span><span class="op" id="7683196">(</span><span class="op" id="7683197">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683201">n</span><span class="op" id="7683202">,</span>&nbsp;<span class="ident" id="7683204">err</span>&nbsp;<span class="op" id="7683208">=</span>&nbsp;<span class="ident" id="7683210">b</span><span class="op" id="7683211">.</span><span class="ident" id="7683212">buf</span><span class="op" id="7683215">.</span><span class="ident" id="7683216">Read</span><span class="op" id="7683220">(</span><span class="ident" id="7683221">p</span><span class="op" id="7683222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683226">b</span><span class="op" id="7683227">.</span><span class="ident" id="7683228">mu</span><span class="op" id="7683230">.</span><span class="ident" id="7683231">RUnlock</span><span class="op" id="7683238">(</span><span class="op" id="7683239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683243">if</span>&nbsp;<span class="ident" id="7683246">n</span>&nbsp;<span class="op" id="7683248">&gt;</span>&nbsp;<span class="num" id="7683250">0</span>&nbsp;<span class="op" id="7683252">||</span>&nbsp;<span class="ident" id="7683255">b</span><span class="op" id="7683256">.</span><span class="ident" id="7683257">closed</span>&nbsp;<span class="op" id="7683264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683269">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683278">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683282">&lt;-</span><span class="ident" id="7683284">b</span><span class="op" id="7683285">.</span><span class="ident" id="7683286">ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683293">}</span><br>
<span class="lineno"></span><span class="op" id="7683295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7683298">func</span>&nbsp;<span class="op" id="7683303">(</span><span class="ident" id="7683304">b</span>&nbsp;<span class="op" id="7683306">*</span><span class="ident" id="7683307">syncBuffer</span><span class="op" id="7683317">)</span>&nbsp;<span class="ident" id="7683319">signal</span><span class="op" id="7683325">(</span><span class="op" id="7683326">)</span>&nbsp;<span class="op" id="7683328">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683331">select</span>&nbsp;<span class="op" id="7683338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683341">case</span>&nbsp;<span class="ident" id="7683346">b</span><span class="op" id="7683347">.</span><span class="ident" id="7683348">ready</span>&nbsp;<span class="op" id="7683354">&lt;-</span>&nbsp;<span class="builtintype" id="7683357">true</span><span class="op" id="7683361">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683364">default</span><span class="op" id="7683371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683374">}</span><br>
<span class="lineno"></span><span class="op" id="7683376">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7683379">func</span>&nbsp;<span class="op" id="7683384">(</span><span class="ident" id="7683385">b</span>&nbsp;<span class="op" id="7683387">*</span><span class="ident" id="7683388">syncBuffer</span><span class="op" id="7683398">)</span>&nbsp;<span class="ident" id="7683400">Write</span><span class="op" id="7683405">(</span><span class="ident" id="7683406">p</span>&nbsp;<span class="op" id="7683408">[</span><span class="op" id="7683409">]</span><span class="builtintype" id="7683410">byte</span><span class="op" id="7683414">)</span>&nbsp;<span class="op" id="7683416">(</span><span class="ident" id="7683417">n</span>&nbsp;<span class="builtintype" id="7683419">int</span><span class="op" id="7683422">,</span>&nbsp;<span class="ident" id="7683424">err</span>&nbsp;<span class="builtintype" id="7683428">error</span><span class="op" id="7683433">)</span>&nbsp;<span class="op" id="7683435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683438">n</span><span class="op" id="7683439">,</span>&nbsp;<span class="ident" id="7683441">err</span>&nbsp;<span class="op" id="7683445">=</span>&nbsp;<span class="ident" id="7683447">b</span><span class="op" id="7683448">.</span><span class="ident" id="7683449">buf</span><span class="op" id="7683452">.</span><span class="ident" id="7683453">Write</span><span class="op" id="7683458">(</span><span class="ident" id="7683459">p</span><span class="op" id="7683460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683463">b</span><span class="op" id="7683464">.</span><span class="ident" id="7683465">signal</span><span class="op" id="7683471">(</span><span class="op" id="7683472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683475">return</span><br>
<span class="lineno">175</span><span class="op" id="7683482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7683485">func</span>&nbsp;<span class="op" id="7683490">(</span><span class="ident" id="7683491">b</span>&nbsp;<span class="op" id="7683493">*</span><span class="ident" id="7683494">syncBuffer</span><span class="op" id="7683504">)</span>&nbsp;<span class="ident" id="7683506">WriteMode</span><span class="op" id="7683515">(</span><span class="op" id="7683516">)</span>&nbsp;<span class="op" id="7683518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683521">b</span><span class="op" id="7683522">.</span><span class="ident" id="7683523">mu</span><span class="op" id="7683525">.</span><span class="ident" id="7683526">Lock</span><span class="op" id="7683530">(</span><span class="op" id="7683531">)</span><br>
<span class="lineno"></span><span class="op" id="7683533">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="7683536">func</span>&nbsp;<span class="op" id="7683541">(</span><span class="ident" id="7683542">b</span>&nbsp;<span class="op" id="7683544">*</span><span class="ident" id="7683545">syncBuffer</span><span class="op" id="7683555">)</span>&nbsp;<span class="ident" id="7683557">ReadMode</span><span class="op" id="7683565">(</span><span class="op" id="7683566">)</span>&nbsp;<span class="op" id="7683568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683571">b</span><span class="op" id="7683572">.</span><span class="ident" id="7683573">mu</span><span class="op" id="7683575">.</span><span class="ident" id="7683576">Unlock</span><span class="op" id="7683582">(</span><span class="op" id="7683583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683586">b</span><span class="op" id="7683587">.</span><span class="ident" id="7683588">signal</span><span class="op" id="7683594">(</span><span class="op" id="7683595">)</span><br>
<span class="lineno"></span><span class="op" id="7683597">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="7683600">func</span>&nbsp;<span class="op" id="7683605">(</span><span class="ident" id="7683606">b</span>&nbsp;<span class="op" id="7683608">*</span><span class="ident" id="7683609">syncBuffer</span><span class="op" id="7683619">)</span>&nbsp;<span class="ident" id="7683621">Close</span><span class="op" id="7683626">(</span><span class="op" id="7683627">)</span>&nbsp;<span class="builtintype" id="7683629">error</span>&nbsp;<span class="op" id="7683635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683638">b</span><span class="op" id="7683639">.</span><span class="ident" id="7683640">closed</span>&nbsp;<span class="op" id="7683647">=</span>&nbsp;<span class="builtintype" id="7683649">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683655">b</span><span class="op" id="7683656">.</span><span class="ident" id="7683657">signal</span><span class="op" id="7683663">(</span><span class="op" id="7683664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683667">return</span>&nbsp;<span class="ident" id="7683674">nil</span><br>
<span class="lineno">190</span><span class="op" id="7683678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7683681">func</span>&nbsp;<span class="ident" id="7683686">testSync</span><span class="op" id="7683694">(</span><span class="ident" id="7683695">t</span>&nbsp;<span class="op" id="7683697">*</span><span class="ident" id="7683698">testing</span><span class="op" id="7683705">.</span><span class="ident" id="7683706">T</span><span class="op" id="7683707">,</span>&nbsp;<span class="ident" id="7683709">level</span>&nbsp;<span class="builtintype" id="7683715">int</span><span class="op" id="7683718">,</span>&nbsp;<span class="ident" id="7683720">input</span>&nbsp;<span class="op" id="7683726">[</span><span class="op" id="7683727">]</span><span class="builtintype" id="7683728">byte</span><span class="op" id="7683732">,</span>&nbsp;<span class="ident" id="7683734">name</span>&nbsp;<span class="builtintype" id="7683739">string</span><span class="op" id="7683745">)</span>&nbsp;<span class="op" id="7683747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683750">if</span>&nbsp;<span class="builtinfunc" id="7683753">len</span><span class="op" id="7683756">(</span><span class="ident" id="7683757">input</span><span class="op" id="7683762">)</span>&nbsp;<span class="op" id="7683764">==</span>&nbsp;<span class="num" id="7683767">0</span>&nbsp;<span class="op" id="7683769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683773">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683785">t</span><span class="op" id="7683786">.</span><span class="ident" id="7683787">Logf</span><span class="op" id="7683791">(</span><span class="string" id="7683792">&#34;--testSync&nbsp;%d,&nbsp;%d,&nbsp;%s&#34;</span><span class="op" id="7683815">,</span>&nbsp;<span class="ident" id="7683817">level</span><span class="op" id="7683822">,</span>&nbsp;<span class="builtinfunc" id="7683824">len</span><span class="op" id="7683827">(</span><span class="ident" id="7683828">input</span><span class="op" id="7683833">)</span><span class="op" id="7683834">,</span>&nbsp;<span class="ident" id="7683836">name</span><span class="op" id="7683840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683843">buf</span>&nbsp;<span class="op" id="7683847">:=</span>&nbsp;<span class="ident" id="7683850">newSyncBuffer</span><span class="op" id="7683863">(</span><span class="op" id="7683864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683867">buf1</span>&nbsp;<span class="op" id="7683872">:=</span>&nbsp;<span class="builtinfunc" id="7683875">new</span><span class="op" id="7683878">(</span><span class="ident" id="7683879">bytes</span><span class="op" id="7683884">.</span><span class="ident" id="7683885">Buffer</span><span class="op" id="7683891">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683894">buf</span><span class="op" id="7683897">.</span><span class="ident" id="7683898">WriteMode</span><span class="op" id="7683907">(</span><span class="op" id="7683908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683911">w</span><span class="op" id="7683912">,</span>&nbsp;<span class="ident" id="7683914">err</span>&nbsp;<span class="op" id="7683918">:=</span>&nbsp;<span class="ident" id="7683921">NewWriter</span><span class="op" id="7683930">(</span><span class="ident" id="7683931">io</span><span class="op" id="7683933">.</span><span class="ident" id="7683934">MultiWriter</span><span class="op" id="7683945">(</span><span class="ident" id="7683946">buf</span><span class="op" id="7683949">,</span>&nbsp;<span class="ident" id="7683951">buf1</span><span class="op" id="7683955">)</span><span class="op" id="7683956">,</span>&nbsp;<span class="ident" id="7683958">level</span><span class="op" id="7683963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683966">if</span>&nbsp;<span class="ident" id="7683969">err</span>&nbsp;<span class="op" id="7683973">!=</span>&nbsp;<span class="ident" id="7683976">nil</span>&nbsp;<span class="op" id="7683980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683984">t</span><span class="op" id="7683985">.</span><span class="ident" id="7683986">Errorf</span><span class="op" id="7683992">(</span><span class="string" id="7683993">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7684008">,</span>&nbsp;<span class="ident" id="7684010">err</span><span class="op" id="7684013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684017">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684028">r</span>&nbsp;<span class="op" id="7684030">:=</span>&nbsp;<span class="ident" id="7684033">NewReader</span><span class="op" id="7684042">(</span><span class="ident" id="7684043">buf</span><span class="op" id="7684046">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7684050">//&nbsp;Write&nbsp;half&nbsp;the&nbsp;input&nbsp;and&nbsp;read&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684090">for</span>&nbsp;<span class="ident" id="7684094">i</span>&nbsp;<span class="op" id="7684096">:=</span>&nbsp;<span class="num" id="7684099">0</span><span class="op" id="7684100">;</span>&nbsp;<span class="ident" id="7684102">i</span>&nbsp;<span class="op" id="7684104">&lt;</span>&nbsp;<span class="num" id="7684106">2</span><span class="op" id="7684107">;</span>&nbsp;<span class="ident" id="7684109">i</span><span class="op" id="7684110">++</span>&nbsp;<span class="op" id="7684113">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684117">var</span>&nbsp;<span class="ident" id="7684121">lo</span><span class="op" id="7684123">,</span>&nbsp;<span class="ident" id="7684125">hi</span>&nbsp;<span class="builtintype" id="7684128">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684134">if</span>&nbsp;<span class="ident" id="7684137">i</span>&nbsp;<span class="op" id="7684139">==</span>&nbsp;<span class="num" id="7684142">0</span>&nbsp;<span class="op" id="7684144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684149">lo</span><span class="op" id="7684151">,</span>&nbsp;<span class="ident" id="7684153">hi</span>&nbsp;<span class="op" id="7684156">=</span>&nbsp;<span class="num" id="7684158">0</span><span class="op" id="7684159">,</span>&nbsp;<span class="op" id="7684161">(</span><span class="builtinfunc" id="7684162">len</span><span class="op" id="7684165">(</span><span class="ident" id="7684166">input</span><span class="op" id="7684171">)</span><span class="op" id="7684172">+</span><span class="num" id="7684173">1</span><span class="op" id="7684174">)</span><span class="op" id="7684175">/</span><span class="num" id="7684176">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684180">}</span>&nbsp;<span class="keyword" id="7684182">else</span>&nbsp;<span class="op" id="7684187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684192">lo</span><span class="op" id="7684194">,</span>&nbsp;<span class="ident" id="7684196">hi</span>&nbsp;<span class="op" id="7684199">=</span>&nbsp;<span class="op" id="7684201">(</span><span class="builtinfunc" id="7684202">len</span><span class="op" id="7684205">(</span><span class="ident" id="7684206">input</span><span class="op" id="7684211">)</span><span class="op" id="7684212">+</span><span class="num" id="7684213">1</span><span class="op" id="7684214">)</span><span class="op" id="7684215">/</span><span class="num" id="7684216">2</span><span class="op" id="7684217">,</span>&nbsp;<span class="builtinfunc" id="7684219">len</span><span class="op" id="7684222">(</span><span class="ident" id="7684223">input</span><span class="op" id="7684228">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684236">t</span><span class="op" id="7684237">.</span><span class="ident" id="7684238">Logf</span><span class="op" id="7684242">(</span><span class="string" id="7684243">&#34;#%d:&nbsp;write&nbsp;%d-%d&#34;</span><span class="op" id="7684261">,</span>&nbsp;<span class="ident" id="7684263">i</span><span class="op" id="7684264">,</span>&nbsp;<span class="ident" id="7684266">lo</span><span class="op" id="7684268">,</span>&nbsp;<span class="ident" id="7684270">hi</span><span class="op" id="7684272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684276">if</span>&nbsp;<span class="ident" id="7684279">_</span><span class="op" id="7684280">,</span>&nbsp;<span class="ident" id="7684282">err</span>&nbsp;<span class="op" id="7684286">:=</span>&nbsp;<span class="ident" id="7684289">w</span><span class="op" id="7684290">.</span><span class="ident" id="7684291">Write</span><span class="op" id="7684296">(</span><span class="ident" id="7684297">input</span><span class="op" id="7684302">[</span><span class="ident" id="7684303">lo</span><span class="op" id="7684305">:</span><span class="ident" id="7684306">hi</span><span class="op" id="7684308">]</span><span class="op" id="7684309">)</span><span class="op" id="7684310">;</span>&nbsp;<span class="ident" id="7684312">err</span>&nbsp;<span class="op" id="7684316">!=</span>&nbsp;<span class="ident" id="7684319">nil</span>&nbsp;<span class="op" id="7684323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684328">t</span><span class="op" id="7684329">.</span><span class="ident" id="7684330">Errorf</span><span class="op" id="7684336">(</span><span class="string" id="7684337">&#34;testSync:&nbsp;write:&nbsp;%v&#34;</span><span class="op" id="7684358">,</span>&nbsp;<span class="ident" id="7684360">err</span><span class="op" id="7684363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684368">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684381">if</span>&nbsp;<span class="ident" id="7684384">i</span>&nbsp;<span class="op" id="7684386">==</span>&nbsp;<span class="num" id="7684389">0</span>&nbsp;<span class="op" id="7684391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684396">if</span>&nbsp;<span class="ident" id="7684399">err</span>&nbsp;<span class="op" id="7684403">:=</span>&nbsp;<span class="ident" id="7684406">w</span><span class="op" id="7684407">.</span><span class="ident" id="7684408">Flush</span><span class="op" id="7684413">(</span><span class="op" id="7684414">)</span><span class="op" id="7684415">;</span>&nbsp;<span class="ident" id="7684417">err</span>&nbsp;<span class="op" id="7684421">!=</span>&nbsp;<span class="ident" id="7684424">nil</span>&nbsp;<span class="op" id="7684428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684434">t</span><span class="op" id="7684435">.</span><span class="ident" id="7684436">Errorf</span><span class="op" id="7684442">(</span><span class="string" id="7684443">&#34;testSync:&nbsp;flush:&nbsp;%v&#34;</span><span class="op" id="7684464">,</span>&nbsp;<span class="ident" id="7684466">err</span><span class="op" id="7684469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684475">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684489">}</span>&nbsp;<span class="keyword" id="7684491">else</span>&nbsp;<span class="op" id="7684496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684501">if</span>&nbsp;<span class="ident" id="7684504">err</span>&nbsp;<span class="op" id="7684508">:=</span>&nbsp;<span class="ident" id="7684511">w</span><span class="op" id="7684512">.</span><span class="ident" id="7684513">Close</span><span class="op" id="7684518">(</span><span class="op" id="7684519">)</span><span class="op" id="7684520">;</span>&nbsp;<span class="ident" id="7684522">err</span>&nbsp;<span class="op" id="7684526">!=</span>&nbsp;<span class="ident" id="7684529">nil</span>&nbsp;<span class="op" id="7684533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684539">t</span><span class="op" id="7684540">.</span><span class="ident" id="7684541">Errorf</span><span class="op" id="7684547">(</span><span class="string" id="7684548">&#34;testSync:&nbsp;close:&nbsp;%v&#34;</span><span class="op" id="7684569">,</span>&nbsp;<span class="ident" id="7684571">err</span><span class="op" id="7684574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684579">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684587">buf</span><span class="op" id="7684590">.</span><span class="ident" id="7684591">ReadMode</span><span class="op" id="7684599">(</span><span class="op" id="7684600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684604">out</span>&nbsp;<span class="op" id="7684608">:=</span>&nbsp;<span class="builtinfunc" id="7684611">make</span><span class="op" id="7684615">(</span><span class="op" id="7684616">[</span><span class="op" id="7684617">]</span><span class="builtintype" id="7684618">byte</span><span class="op" id="7684622">,</span>&nbsp;<span class="ident" id="7684624">hi</span><span class="op" id="7684626">-</span><span class="ident" id="7684627">lo</span><span class="op" id="7684629">+</span><span class="num" id="7684630">1</span><span class="op" id="7684631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684635">m</span><span class="op" id="7684636">,</span>&nbsp;<span class="ident" id="7684638">err</span>&nbsp;<span class="op" id="7684642">:=</span>&nbsp;<span class="ident" id="7684645">io</span><span class="op" id="7684647">.</span><span class="ident" id="7684648">ReadAtLeast</span><span class="op" id="7684659">(</span><span class="ident" id="7684660">r</span><span class="op" id="7684661">,</span>&nbsp;<span class="ident" id="7684663">out</span><span class="op" id="7684666">,</span>&nbsp;<span class="ident" id="7684668">hi</span><span class="op" id="7684670">-</span><span class="ident" id="7684671">lo</span><span class="op" id="7684673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684677">t</span><span class="op" id="7684678">.</span><span class="ident" id="7684679">Logf</span><span class="op" id="7684683">(</span><span class="string" id="7684684">&#34;#%d:&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7684698">,</span>&nbsp;<span class="ident" id="7684700">i</span><span class="op" id="7684701">,</span>&nbsp;<span class="ident" id="7684703">m</span><span class="op" id="7684704">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684708">if</span>&nbsp;<span class="ident" id="7684711">m</span>&nbsp;<span class="op" id="7684713">!=</span>&nbsp;<span class="ident" id="7684716">hi</span><span class="op" id="7684718">-</span><span class="ident" id="7684719">lo</span>&nbsp;<span class="op" id="7684722">||</span>&nbsp;<span class="ident" id="7684725">err</span>&nbsp;<span class="op" id="7684729">!=</span>&nbsp;<span class="ident" id="7684732">nil</span>&nbsp;<span class="op" id="7684736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684741">t</span><span class="op" id="7684742">.</span><span class="ident" id="7684743">Errorf</span><span class="op" id="7684749">(</span><span class="string" id="7684750">&#34;testSync/%d&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;read&nbsp;%d:&nbsp;%d,&nbsp;%v&nbsp;(%d&nbsp;left)&#34;</span><span class="op" id="7684803">,</span>&nbsp;<span class="ident" id="7684805">i</span><span class="op" id="7684806">,</span>&nbsp;<span class="ident" id="7684808">level</span><span class="op" id="7684813">,</span>&nbsp;<span class="builtinfunc" id="7684815">len</span><span class="op" id="7684818">(</span><span class="ident" id="7684819">input</span><span class="op" id="7684824">)</span><span class="op" id="7684825">,</span>&nbsp;<span class="ident" id="7684827">name</span><span class="op" id="7684831">,</span>&nbsp;<span class="ident" id="7684833">hi</span><span class="op" id="7684835">-</span><span class="ident" id="7684836">lo</span><span class="op" id="7684838">,</span>&nbsp;<span class="ident" id="7684840">m</span><span class="op" id="7684841">,</span>&nbsp;<span class="ident" id="7684843">err</span><span class="op" id="7684846">,</span>&nbsp;<span class="ident" id="7684848">buf</span><span class="op" id="7684851">.</span><span class="ident" id="7684852">buf</span><span class="op" id="7684855">.</span><span class="ident" id="7684856">Len</span><span class="op" id="7684859">(</span><span class="op" id="7684860">)</span><span class="op" id="7684861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684866">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684879">if</span>&nbsp;<span class="op" id="7684882">!</span><span class="ident" id="7684883">bytes</span><span class="op" id="7684888">.</span><span class="ident" id="7684889">Equal</span><span class="op" id="7684894">(</span><span class="ident" id="7684895">input</span><span class="op" id="7684900">[</span><span class="ident" id="7684901">lo</span><span class="op" id="7684903">:</span><span class="ident" id="7684904">hi</span><span class="op" id="7684906">]</span><span class="op" id="7684907">,</span>&nbsp;<span class="ident" id="7684909">out</span><span class="op" id="7684912">[</span><span class="op" id="7684913">:</span><span class="ident" id="7684914">hi</span><span class="op" id="7684916">-</span><span class="ident" id="7684917">lo</span><span class="op" id="7684919">]</span><span class="op" id="7684920">)</span>&nbsp;<span class="op" id="7684922">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684927">t</span><span class="op" id="7684928">.</span><span class="ident" id="7684929">Errorf</span><span class="op" id="7684935">(</span><span class="string" id="7684936">&#34;testSync/%d:&nbsp;read&nbsp;wrong&nbsp;bytes:&nbsp;%x&nbsp;vs&nbsp;%x&#34;</span><span class="op" id="7684977">,</span>&nbsp;<span class="ident" id="7684979">i</span><span class="op" id="7684980">,</span>&nbsp;<span class="ident" id="7684982">input</span><span class="op" id="7684987">[</span><span class="ident" id="7684988">lo</span><span class="op" id="7684990">:</span><span class="ident" id="7684991">hi</span><span class="op" id="7684993">]</span><span class="op" id="7684994">,</span>&nbsp;<span class="ident" id="7684996">out</span><span class="op" id="7684999">[</span><span class="op" id="7685000">:</span><span class="ident" id="7685001">hi</span><span class="op" id="7685003">-</span><span class="ident" id="7685004">lo</span><span class="op" id="7685006">]</span><span class="op" id="7685007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685012">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685025">//&nbsp;This&nbsp;test&nbsp;originally&nbsp;checked&nbsp;that&nbsp;after&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685078">//&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;input,&nbsp;there&nbsp;was&nbsp;nothing&nbsp;left</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685135">//&nbsp;in&nbsp;the&nbsp;read&nbsp;buffer&nbsp;(buf.buf.Len()&nbsp;!=&nbsp;0)&nbsp;but&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685192">//&nbsp;not&nbsp;necessarily&nbsp;the&nbsp;case:&nbsp;the&nbsp;write&nbsp;Flush&nbsp;may&nbsp;emit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685248">//&nbsp;some&nbsp;extra&nbsp;framing&nbsp;bits&nbsp;that&nbsp;are&nbsp;not&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685300">//&nbsp;to&nbsp;process&nbsp;to&nbsp;obtain&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;uncompressed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685361">//&nbsp;data.&nbsp;&nbsp;The&nbsp;test&nbsp;ran&nbsp;correctly&nbsp;most&nbsp;of&nbsp;the&nbsp;time,&nbsp;because</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685422">//&nbsp;the&nbsp;background&nbsp;goroutine&nbsp;had&nbsp;usually&nbsp;read&nbsp;even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685474">//&nbsp;those&nbsp;extra&nbsp;bits&nbsp;by&nbsp;now,&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;useful&nbsp;thing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685535">//&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685547">buf</span><span class="op" id="7685550">.</span><span class="ident" id="7685551">WriteMode</span><span class="op" id="7685560">(</span><span class="op" id="7685561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685564">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685567">buf</span><span class="op" id="7685570">.</span><span class="ident" id="7685571">ReadMode</span><span class="op" id="7685579">(</span><span class="op" id="7685580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685583">out</span>&nbsp;<span class="op" id="7685587">:=</span>&nbsp;<span class="builtinfunc" id="7685590">make</span><span class="op" id="7685594">(</span><span class="op" id="7685595">[</span><span class="op" id="7685596">]</span><span class="builtintype" id="7685597">byte</span><span class="op" id="7685601">,</span>&nbsp;<span class="num" id="7685603">10</span><span class="op" id="7685605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685608">if</span>&nbsp;<span class="ident" id="7685611">n</span><span class="op" id="7685612">,</span>&nbsp;<span class="ident" id="7685614">err</span>&nbsp;<span class="op" id="7685618">:=</span>&nbsp;<span class="ident" id="7685621">r</span><span class="op" id="7685622">.</span><span class="ident" id="7685623">Read</span><span class="op" id="7685627">(</span><span class="ident" id="7685628">out</span><span class="op" id="7685631">)</span><span class="op" id="7685632">;</span>&nbsp;<span class="ident" id="7685634">n</span>&nbsp;<span class="op" id="7685636">&gt;</span>&nbsp;<span class="num" id="7685638">0</span>&nbsp;<span class="op" id="7685640">||</span>&nbsp;<span class="ident" id="7685643">err</span>&nbsp;<span class="op" id="7685647">!=</span>&nbsp;<span class="ident" id="7685650">io</span><span class="op" id="7685652">.</span><span class="ident" id="7685653">EOF</span>&nbsp;<span class="op" id="7685657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685661">t</span><span class="op" id="7685662">.</span><span class="ident" id="7685663">Errorf</span><span class="op" id="7685669">(</span><span class="string" id="7685670">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;final&nbsp;Read:&nbsp;%d,&nbsp;%v&nbsp;(hex:&nbsp;%x)&#34;</span><span class="op" id="7685723">,</span>&nbsp;<span class="ident" id="7685725">level</span><span class="op" id="7685730">,</span>&nbsp;<span class="builtinfunc" id="7685732">len</span><span class="op" id="7685735">(</span><span class="ident" id="7685736">input</span><span class="op" id="7685741">)</span><span class="op" id="7685742">,</span>&nbsp;<span class="ident" id="7685744">name</span><span class="op" id="7685748">,</span>&nbsp;<span class="ident" id="7685750">n</span><span class="op" id="7685751">,</span>&nbsp;<span class="ident" id="7685753">err</span><span class="op" id="7685756">,</span>&nbsp;<span class="ident" id="7685758">out</span><span class="op" id="7685761">[</span><span class="num" id="7685762">0</span><span class="op" id="7685763">:</span><span class="ident" id="7685764">n</span><span class="op" id="7685765">]</span><span class="op" id="7685766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685769">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685772">if</span>&nbsp;<span class="ident" id="7685775">buf</span><span class="op" id="7685778">.</span><span class="ident" id="7685779">buf</span><span class="op" id="7685782">.</span><span class="ident" id="7685783">Len</span><span class="op" id="7685786">(</span><span class="op" id="7685787">)</span>&nbsp;<span class="op" id="7685789">!=</span>&nbsp;<span class="num" id="7685792">0</span>&nbsp;<span class="op" id="7685794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685798">t</span><span class="op" id="7685799">.</span><span class="ident" id="7685800">Errorf</span><span class="op" id="7685806">(</span><span class="string" id="7685807">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;extra&nbsp;data&nbsp;at&nbsp;end&#34;</span><span class="op" id="7685849">,</span>&nbsp;<span class="ident" id="7685851">level</span><span class="op" id="7685856">,</span>&nbsp;<span class="builtinfunc" id="7685858">len</span><span class="op" id="7685861">(</span><span class="ident" id="7685862">input</span><span class="op" id="7685867">)</span><span class="op" id="7685868">,</span>&nbsp;<span class="ident" id="7685870">name</span><span class="op" id="7685874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685880">r</span><span class="op" id="7685881">.</span><span class="ident" id="7685882">Close</span><span class="op" id="7685887">(</span><span class="op" id="7685888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685892">//&nbsp;stream&nbsp;should&nbsp;work&nbsp;for&nbsp;ordinary&nbsp;reader&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685939">r</span>&nbsp;<span class="op" id="7685941">=</span>&nbsp;<span class="ident" id="7685943">NewReader</span><span class="op" id="7685952">(</span><span class="ident" id="7685953">buf1</span><span class="op" id="7685957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685960">out</span><span class="op" id="7685963">,</span>&nbsp;<span class="ident" id="7685965">err</span>&nbsp;<span class="op" id="7685969">=</span>&nbsp;<span class="ident" id="7685971">ioutil</span><span class="op" id="7685977">.</span><span class="ident" id="7685978">ReadAll</span><span class="op" id="7685985">(</span><span class="ident" id="7685986">r</span><span class="op" id="7685987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685990">if</span>&nbsp;<span class="ident" id="7685993">err</span>&nbsp;<span class="op" id="7685997">!=</span>&nbsp;<span class="ident" id="7686000">nil</span>&nbsp;<span class="op" id="7686004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686008">t</span><span class="op" id="7686009">.</span><span class="ident" id="7686010">Errorf</span><span class="op" id="7686016">(</span><span class="string" id="7686017">&#34;testSync:&nbsp;read:&nbsp;%s&#34;</span><span class="op" id="7686037">,</span>&nbsp;<span class="ident" id="7686039">err</span><span class="op" id="7686042">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686046">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686057">r</span><span class="op" id="7686058">.</span><span class="ident" id="7686059">Close</span><span class="op" id="7686064">(</span><span class="op" id="7686065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686068">if</span>&nbsp;<span class="op" id="7686071">!</span><span class="ident" id="7686072">bytes</span><span class="op" id="7686077">.</span><span class="ident" id="7686078">Equal</span><span class="op" id="7686083">(</span><span class="ident" id="7686084">input</span><span class="op" id="7686089">,</span>&nbsp;<span class="ident" id="7686091">out</span><span class="op" id="7686094">)</span>&nbsp;<span class="op" id="7686096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686100">t</span><span class="op" id="7686101">.</span><span class="ident" id="7686102">Errorf</span><span class="op" id="7686108">(</span><span class="string" id="7686109">&#34;testSync:&nbsp;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="7686174">,</span>&nbsp;<span class="ident" id="7686176">level</span><span class="op" id="7686181">,</span>&nbsp;<span class="ident" id="7686183">name</span><span class="op" id="7686187">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686190">}</span><br>
<span class="lineno"></span><span class="op" id="7686192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7686195">func</span>&nbsp;<span class="ident" id="7686200">testToFromWithLevelAndLimit</span><span class="op" id="7686227">(</span><span class="ident" id="7686228">t</span>&nbsp;<span class="op" id="7686230">*</span><span class="ident" id="7686231">testing</span><span class="op" id="7686238">.</span><span class="ident" id="7686239">T</span><span class="op" id="7686240">,</span>&nbsp;<span class="ident" id="7686242">level</span>&nbsp;<span class="builtintype" id="7686248">int</span><span class="op" id="7686251">,</span>&nbsp;<span class="ident" id="7686253">input</span>&nbsp;<span class="op" id="7686259">[</span><span class="op" id="7686260">]</span><span class="builtintype" id="7686261">byte</span><span class="op" id="7686265">,</span>&nbsp;<span class="ident" id="7686267">name</span>&nbsp;<span class="builtintype" id="7686272">string</span><span class="op" id="7686278">,</span>&nbsp;<span class="ident" id="7686280">limit</span>&nbsp;<span class="builtintype" id="7686286">int</span><span class="op" id="7686289">)</span>&nbsp;<span class="op" id="7686291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686294">var</span>&nbsp;<span class="ident" id="7686298">buffer</span>&nbsp;<span class="ident" id="7686305">bytes</span><span class="op" id="7686310">.</span><span class="ident" id="7686311">Buffer</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686319">w</span><span class="op" id="7686320">,</span>&nbsp;<span class="ident" id="7686322">err</span>&nbsp;<span class="op" id="7686326">:=</span>&nbsp;<span class="ident" id="7686329">NewWriter</span><span class="op" id="7686338">(</span><span class="op" id="7686339">&amp;</span><span class="ident" id="7686340">buffer</span><span class="op" id="7686346">,</span>&nbsp;<span class="ident" id="7686348">level</span><span class="op" id="7686353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686356">if</span>&nbsp;<span class="ident" id="7686359">err</span>&nbsp;<span class="op" id="7686363">!=</span>&nbsp;<span class="ident" id="7686366">nil</span>&nbsp;<span class="op" id="7686370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686374">t</span><span class="op" id="7686375">.</span><span class="ident" id="7686376">Errorf</span><span class="op" id="7686382">(</span><span class="string" id="7686383">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7686398">,</span>&nbsp;<span class="ident" id="7686400">err</span><span class="op" id="7686403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686407">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686415">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686418">w</span><span class="op" id="7686419">.</span><span class="ident" id="7686420">Write</span><span class="op" id="7686425">(</span><span class="ident" id="7686426">input</span><span class="op" id="7686431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686434">w</span><span class="op" id="7686435">.</span><span class="ident" id="7686436">Close</span><span class="op" id="7686441">(</span><span class="op" id="7686442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686445">if</span>&nbsp;<span class="ident" id="7686448">limit</span>&nbsp;<span class="op" id="7686454">&gt;</span>&nbsp;<span class="num" id="7686456">0</span>&nbsp;<span class="op" id="7686458">&amp;&amp;</span>&nbsp;<span class="ident" id="7686461">buffer</span><span class="op" id="7686467">.</span><span class="ident" id="7686468">Len</span><span class="op" id="7686471">(</span><span class="op" id="7686472">)</span>&nbsp;<span class="op" id="7686474">&gt;</span>&nbsp;<span class="ident" id="7686476">limit</span>&nbsp;<span class="op" id="7686482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686486">t</span><span class="op" id="7686487">.</span><span class="ident" id="7686488">Errorf</span><span class="op" id="7686494">(</span><span class="string" id="7686495">&#34;level:&nbsp;%d,&nbsp;len(compress(data))&nbsp;=&nbsp;%d&nbsp;&gt;&nbsp;limit&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7686545">,</span>&nbsp;<span class="ident" id="7686547">level</span><span class="op" id="7686552">,</span>&nbsp;<span class="ident" id="7686554">buffer</span><span class="op" id="7686560">.</span><span class="ident" id="7686561">Len</span><span class="op" id="7686564">(</span><span class="op" id="7686565">)</span><span class="op" id="7686566">,</span>&nbsp;<span class="ident" id="7686568">limit</span><span class="op" id="7686573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686577">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686588">r</span>&nbsp;<span class="op" id="7686590">:=</span>&nbsp;<span class="ident" id="7686593">NewReader</span><span class="op" id="7686602">(</span><span class="op" id="7686603">&amp;</span><span class="ident" id="7686604">buffer</span><span class="op" id="7686610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686613">out</span><span class="op" id="7686616">,</span>&nbsp;<span class="ident" id="7686618">err</span>&nbsp;<span class="op" id="7686622">:=</span>&nbsp;<span class="ident" id="7686625">ioutil</span><span class="op" id="7686631">.</span><span class="ident" id="7686632">ReadAll</span><span class="op" id="7686639">(</span><span class="ident" id="7686640">r</span><span class="op" id="7686641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686644">if</span>&nbsp;<span class="ident" id="7686647">err</span>&nbsp;<span class="op" id="7686651">!=</span>&nbsp;<span class="ident" id="7686654">nil</span>&nbsp;<span class="op" id="7686658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686662">t</span><span class="op" id="7686663">.</span><span class="ident" id="7686664">Errorf</span><span class="op" id="7686670">(</span><span class="string" id="7686671">&#34;read:&nbsp;%s&#34;</span><span class="op" id="7686681">,</span>&nbsp;<span class="ident" id="7686683">err</span><span class="op" id="7686686">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686690">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686701">r</span><span class="op" id="7686702">.</span><span class="ident" id="7686703">Close</span><span class="op" id="7686708">(</span><span class="op" id="7686709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686712">if</span>&nbsp;<span class="op" id="7686715">!</span><span class="ident" id="7686716">bytes</span><span class="op" id="7686721">.</span><span class="ident" id="7686722">Equal</span><span class="op" id="7686727">(</span><span class="ident" id="7686728">input</span><span class="op" id="7686733">,</span>&nbsp;<span class="ident" id="7686735">out</span><span class="op" id="7686738">)</span>&nbsp;<span class="op" id="7686740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686744">t</span><span class="op" id="7686745">.</span><span class="ident" id="7686746">Errorf</span><span class="op" id="7686752">(</span><span class="string" id="7686753">&#34;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="7686808">,</span>&nbsp;<span class="ident" id="7686810">level</span><span class="op" id="7686815">,</span>&nbsp;<span class="ident" id="7686817">name</span><span class="op" id="7686821">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686825">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686836">testSync</span><span class="op" id="7686844">(</span><span class="ident" id="7686845">t</span><span class="op" id="7686846">,</span>&nbsp;<span class="ident" id="7686848">level</span><span class="op" id="7686853">,</span>&nbsp;<span class="ident" id="7686855">input</span><span class="op" id="7686860">,</span>&nbsp;<span class="ident" id="7686862">name</span><span class="op" id="7686866">)</span><br>
<span class="lineno"></span><span class="op" id="7686868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="7686871">func</span>&nbsp;<span class="ident" id="7686876">testToFromWithLimit</span><span class="op" id="7686895">(</span><span class="ident" id="7686896">t</span>&nbsp;<span class="op" id="7686898">*</span><span class="ident" id="7686899">testing</span><span class="op" id="7686906">.</span><span class="ident" id="7686907">T</span><span class="op" id="7686908">,</span>&nbsp;<span class="ident" id="7686910">input</span>&nbsp;<span class="op" id="7686916">[</span><span class="op" id="7686917">]</span><span class="builtintype" id="7686918">byte</span><span class="op" id="7686922">,</span>&nbsp;<span class="ident" id="7686924">name</span>&nbsp;<span class="builtintype" id="7686929">string</span><span class="op" id="7686935">,</span>&nbsp;<span class="ident" id="7686937">limit</span>&nbsp;<span class="op" id="7686943">[</span><span class="num" id="7686944">10</span><span class="op" id="7686946">]</span><span class="builtintype" id="7686947">int</span><span class="op" id="7686950">)</span>&nbsp;<span class="op" id="7686952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686955">for</span>&nbsp;<span class="ident" id="7686959">i</span>&nbsp;<span class="op" id="7686961">:=</span>&nbsp;<span class="num" id="7686964">0</span><span class="op" id="7686965">;</span>&nbsp;<span class="ident" id="7686967">i</span>&nbsp;<span class="op" id="7686969">&lt;</span>&nbsp;<span class="num" id="7686971">10</span><span class="op" id="7686973">;</span>&nbsp;<span class="ident" id="7686975">i</span><span class="op" id="7686976">++</span>&nbsp;<span class="op" id="7686979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686983">testToFromWithLevelAndLimit</span><span class="op" id="7687010">(</span><span class="ident" id="7687011">t</span><span class="op" id="7687012">,</span>&nbsp;<span class="ident" id="7687014">i</span><span class="op" id="7687015">,</span>&nbsp;<span class="ident" id="7687017">input</span><span class="op" id="7687022">,</span>&nbsp;<span class="ident" id="7687024">name</span><span class="op" id="7687028">,</span>&nbsp;<span class="ident" id="7687030">limit</span><span class="op" id="7687035">[</span><span class="ident" id="7687036">i</span><span class="op" id="7687037">]</span><span class="op" id="7687038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687041">}</span><br>
<span class="lineno"></span><span class="op" id="7687043">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="7687046">func</span>&nbsp;<span class="ident" id="7687051">TestDeflateInflate</span><span class="op" id="7687069">(</span><span class="ident" id="7687070">t</span>&nbsp;<span class="op" id="7687072">*</span><span class="ident" id="7687073">testing</span><span class="op" id="7687080">.</span><span class="ident" id="7687081">T</span><span class="op" id="7687082">)</span>&nbsp;<span class="op" id="7687084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687087">for</span>&nbsp;<span class="ident" id="7687091">i</span><span class="op" id="7687092">,</span>&nbsp;<span class="ident" id="7687094">h</span>&nbsp;<span class="op" id="7687096">:=</span>&nbsp;<span class="keyword" id="7687099">range</span>&nbsp;<span class="ident" id="7687105">deflateInflateTests</span>&nbsp;<span class="op" id="7687125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687129">testToFromWithLimit</span><span class="op" id="7687148">(</span><span class="ident" id="7687149">t</span><span class="op" id="7687150">,</span>&nbsp;<span class="ident" id="7687152">h</span><span class="op" id="7687153">.</span><span class="ident" id="7687154">in</span><span class="op" id="7687156">,</span>&nbsp;<span class="ident" id="7687158">fmt</span><span class="op" id="7687161">.</span><span class="ident" id="7687162">Sprintf</span><span class="op" id="7687169">(</span><span class="string" id="7687170">&#34;#%d&#34;</span><span class="op" id="7687175">,</span>&nbsp;<span class="ident" id="7687177">i</span><span class="op" id="7687178">)</span><span class="op" id="7687179">,</span>&nbsp;<span class="op" id="7687181">[</span><span class="num" id="7687182">10</span><span class="op" id="7687184">]</span><span class="builtintype" id="7687185">int</span><span class="op" id="7687188">{</span><span class="op" id="7687189">}</span><span class="op" id="7687190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687193">}</span><br>
<span class="lineno">315</span><span class="op" id="7687195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7687198">func</span>&nbsp;<span class="ident" id="7687203">TestReverseBits</span><span class="op" id="7687218">(</span><span class="ident" id="7687219">t</span>&nbsp;<span class="op" id="7687221">*</span><span class="ident" id="7687222">testing</span><span class="op" id="7687229">.</span><span class="ident" id="7687230">T</span><span class="op" id="7687231">)</span>&nbsp;<span class="op" id="7687233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687236">for</span>&nbsp;<span class="ident" id="7687240">_</span><span class="op" id="7687241">,</span>&nbsp;<span class="ident" id="7687243">h</span>&nbsp;<span class="op" id="7687245">:=</span>&nbsp;<span class="keyword" id="7687248">range</span>&nbsp;<span class="ident" id="7687254">reverseBitsTests</span>&nbsp;<span class="op" id="7687271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687275">if</span>&nbsp;<span class="ident" id="7687278">v</span>&nbsp;<span class="op" id="7687280">:=</span>&nbsp;<span class="ident" id="7687283">reverseBits</span><span class="op" id="7687294">(</span><span class="ident" id="7687295">h</span><span class="op" id="7687296">.</span><span class="ident" id="7687297">in</span><span class="op" id="7687299">,</span>&nbsp;<span class="ident" id="7687301">h</span><span class="op" id="7687302">.</span><span class="ident" id="7687303">bitCount</span><span class="op" id="7687311">)</span><span class="op" id="7687312">;</span>&nbsp;<span class="ident" id="7687314">v</span>&nbsp;<span class="op" id="7687316">!=</span>&nbsp;<span class="ident" id="7687319">h</span><span class="op" id="7687320">.</span><span class="ident" id="7687321">out</span>&nbsp;<span class="op" id="7687325">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687330">t</span><span class="op" id="7687331">.</span><span class="ident" id="7687332">Errorf</span><span class="op" id="7687338">(</span><span class="string" id="7687339">&#34;reverseBits(%v,%v)&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7687373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687379">h</span><span class="op" id="7687380">.</span><span class="ident" id="7687381">in</span><span class="op" id="7687383">,</span>&nbsp;<span class="ident" id="7687385">h</span><span class="op" id="7687386">.</span><span class="ident" id="7687387">bitCount</span><span class="op" id="7687395">,</span>&nbsp;<span class="ident" id="7687397">v</span><span class="op" id="7687398">,</span>&nbsp;<span class="ident" id="7687400">h</span><span class="op" id="7687401">.</span><span class="ident" id="7687402">out</span><span class="op" id="7687405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687412">}</span><br>
<span class="lineno"></span><span class="op" id="7687414">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="7687417">type</span>&nbsp;<span class="ident" id="7687422">deflateInflateStringTest</span>&nbsp;<span class="keyword" id="7687447">struct</span>&nbsp;<span class="op" id="7687454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687457">filename</span>&nbsp;<span class="builtintype" id="7687466">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687474">label</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7687483">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687491">limit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7687500">[</span><span class="num" id="7687501">10</span><span class="op" id="7687503">]</span><span class="builtintype" id="7687504">int</span><br>
<span class="lineno">330</span><span class="op" id="7687508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7687511">var</span>&nbsp;<span class="ident" id="7687515">deflateInflateStringTests</span>&nbsp;<span class="op" id="7687541">=</span>&nbsp;<span class="op" id="7687543">[</span><span class="op" id="7687544">]</span><span class="ident" id="7687545">deflateInflateStringTest</span><span class="op" id="7687569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7687576">&#34;../testdata/e.txt&#34;</span><span class="op" id="7687595">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7687599">&#34;2.718281828...&#34;</span><span class="op" id="7687615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687619">[</span><span class="op" id="7687620">...</span><span class="op" id="7687623">]</span><span class="builtintype" id="7687624">int</span><span class="op" id="7687627">{</span><span class="num" id="7687628">100018</span><span class="op" id="7687634">,</span>&nbsp;<span class="num" id="7687636">50650</span><span class="op" id="7687641">,</span>&nbsp;<span class="num" id="7687643">50960</span><span class="op" id="7687648">,</span>&nbsp;<span class="num" id="7687650">51150</span><span class="op" id="7687655">,</span>&nbsp;<span class="num" id="7687657">50930</span><span class="op" id="7687662">,</span>&nbsp;<span class="num" id="7687664">50790</span><span class="op" id="7687669">,</span>&nbsp;<span class="num" id="7687671">50790</span><span class="op" id="7687676">,</span>&nbsp;<span class="num" id="7687678">50790</span><span class="op" id="7687683">,</span>&nbsp;<span class="num" id="7687685">50790</span><span class="op" id="7687690">,</span>&nbsp;<span class="num" id="7687692">50790</span><span class="op" id="7687697">}</span><span class="op" id="7687698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687701">}</span><span class="op" id="7687702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7687709">&#34;../testdata/Mark.Twain-Tom.Sawyer.txt&#34;</span><span class="op" id="7687748">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7687752">&#34;Mark.Twain-Tom.Sawyer&#34;</span><span class="op" id="7687775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687779">[</span><span class="op" id="7687780">...</span><span class="op" id="7687783">]</span><span class="builtintype" id="7687784">int</span><span class="op" id="7687787">{</span><span class="num" id="7687788">407330</span><span class="op" id="7687794">,</span>&nbsp;<span class="num" id="7687796">187598</span><span class="op" id="7687802">,</span>&nbsp;<span class="num" id="7687804">180361</span><span class="op" id="7687810">,</span>&nbsp;<span class="num" id="7687812">172974</span><span class="op" id="7687818">,</span>&nbsp;<span class="num" id="7687820">169160</span><span class="op" id="7687826">,</span>&nbsp;<span class="num" id="7687828">163476</span><span class="op" id="7687834">,</span>&nbsp;<span class="num" id="7687836">160936</span><span class="op" id="7687842">,</span>&nbsp;<span class="num" id="7687844">160506</span><span class="op" id="7687850">,</span>&nbsp;<span class="num" id="7687852">160295</span><span class="op" id="7687858">,</span>&nbsp;<span class="num" id="7687860">160295</span><span class="op" id="7687866">}</span><span class="op" id="7687867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687870">}</span><span class="op" id="7687871">,</span><br>
<span class="lineno"></span><span class="op" id="7687873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="7687876">func</span>&nbsp;<span class="ident" id="7687881">TestDeflateInflateString</span><span class="op" id="7687905">(</span><span class="ident" id="7687906">t</span>&nbsp;<span class="op" id="7687908">*</span><span class="ident" id="7687909">testing</span><span class="op" id="7687916">.</span><span class="ident" id="7687917">T</span><span class="op" id="7687918">)</span>&nbsp;<span class="op" id="7687920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687923">for</span>&nbsp;<span class="ident" id="7687927">_</span><span class="op" id="7687928">,</span>&nbsp;<span class="ident" id="7687930">test</span>&nbsp;<span class="op" id="7687935">:=</span>&nbsp;<span class="keyword" id="7687938">range</span>&nbsp;<span class="ident" id="7687944">deflateInflateStringTests</span>&nbsp;<span class="op" id="7687970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687974">gold</span><span class="op" id="7687978">,</span>&nbsp;<span class="ident" id="7687980">err</span>&nbsp;<span class="op" id="7687984">:=</span>&nbsp;<span class="ident" id="7687987">ioutil</span><span class="op" id="7687993">.</span><span class="ident" id="7687994">ReadFile</span><span class="op" id="7688002">(</span><span class="ident" id="7688003">test</span><span class="op" id="7688007">.</span><span class="ident" id="7688008">filename</span><span class="op" id="7688016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688020">if</span>&nbsp;<span class="ident" id="7688023">err</span>&nbsp;<span class="op" id="7688027">!=</span>&nbsp;<span class="ident" id="7688030">nil</span>&nbsp;<span class="op" id="7688034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688039">t</span><span class="op" id="7688040">.</span><span class="ident" id="7688041">Error</span><span class="op" id="7688046">(</span><span class="ident" id="7688047">err</span><span class="op" id="7688050">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688058">testToFromWithLimit</span><span class="op" id="7688077">(</span><span class="ident" id="7688078">t</span><span class="op" id="7688079">,</span>&nbsp;<span class="ident" id="7688081">gold</span><span class="op" id="7688085">,</span>&nbsp;<span class="ident" id="7688087">test</span><span class="op" id="7688091">.</span><span class="ident" id="7688092">label</span><span class="op" id="7688097">,</span>&nbsp;<span class="ident" id="7688099">test</span><span class="op" id="7688103">.</span><span class="ident" id="7688104">limit</span><span class="op" id="7688109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688113">if</span>&nbsp;<span class="ident" id="7688116">testing</span><span class="op" id="7688123">.</span><span class="ident" id="7688124">Short</span><span class="op" id="7688129">(</span><span class="op" id="7688130">)</span>&nbsp;<span class="op" id="7688132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688137">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688145">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688148">}</span><br>
<span class="lineno"></span><span class="op" id="7688150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7688153">func</span>&nbsp;<span class="ident" id="7688158">TestReaderDict</span><span class="op" id="7688172">(</span><span class="ident" id="7688173">t</span>&nbsp;<span class="op" id="7688175">*</span><span class="ident" id="7688176">testing</span><span class="op" id="7688183">.</span><span class="ident" id="7688184">T</span><span class="op" id="7688185">)</span>&nbsp;<span class="op" id="7688187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688190">const</span>&nbsp;<span class="op" id="7688196">(</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688200">dict</span>&nbsp;<span class="op" id="7688205">=</span>&nbsp;<span class="string" id="7688207">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688223">text</span>&nbsp;<span class="op" id="7688228">=</span>&nbsp;<span class="string" id="7688230">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688254">var</span>&nbsp;<span class="ident" id="7688258">b</span>&nbsp;<span class="ident" id="7688260">bytes</span><span class="op" id="7688265">.</span><span class="ident" id="7688266">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688274">w</span><span class="op" id="7688275">,</span>&nbsp;<span class="ident" id="7688277">err</span>&nbsp;<span class="op" id="7688281">:=</span>&nbsp;<span class="ident" id="7688284">NewWriter</span><span class="op" id="7688293">(</span><span class="op" id="7688294">&amp;</span><span class="ident" id="7688295">b</span><span class="op" id="7688296">,</span>&nbsp;<span class="num" id="7688298">5</span><span class="op" id="7688299">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688302">if</span>&nbsp;<span class="ident" id="7688305">err</span>&nbsp;<span class="op" id="7688309">!=</span>&nbsp;<span class="ident" id="7688312">nil</span>&nbsp;<span class="op" id="7688316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688320">t</span><span class="op" id="7688321">.</span><span class="ident" id="7688322">Fatalf</span><span class="op" id="7688328">(</span><span class="string" id="7688329">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7688344">,</span>&nbsp;<span class="ident" id="7688346">err</span><span class="op" id="7688349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688355">w</span><span class="op" id="7688356">.</span><span class="ident" id="7688357">Write</span><span class="op" id="7688362">(</span><span class="op" id="7688363">[</span><span class="op" id="7688364">]</span><span class="builtintype" id="7688365">byte</span><span class="op" id="7688369">(</span><span class="ident" id="7688370">dict</span><span class="op" id="7688374">)</span><span class="op" id="7688375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688378">w</span><span class="op" id="7688379">.</span><span class="ident" id="7688380">Flush</span><span class="op" id="7688385">(</span><span class="op" id="7688386">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688389">b</span><span class="op" id="7688390">.</span><span class="ident" id="7688391">Reset</span><span class="op" id="7688396">(</span><span class="op" id="7688397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688400">w</span><span class="op" id="7688401">.</span><span class="ident" id="7688402">Write</span><span class="op" id="7688407">(</span><span class="op" id="7688408">[</span><span class="op" id="7688409">]</span><span class="builtintype" id="7688410">byte</span><span class="op" id="7688414">(</span><span class="ident" id="7688415">text</span><span class="op" id="7688419">)</span><span class="op" id="7688420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688423">w</span><span class="op" id="7688424">.</span><span class="ident" id="7688425">Close</span><span class="op" id="7688430">(</span><span class="op" id="7688431">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688435">r</span>&nbsp;<span class="op" id="7688437">:=</span>&nbsp;<span class="ident" id="7688440">NewReaderDict</span><span class="op" id="7688453">(</span><span class="op" id="7688454">&amp;</span><span class="ident" id="7688455">b</span><span class="op" id="7688456">,</span>&nbsp;<span class="op" id="7688458">[</span><span class="op" id="7688459">]</span><span class="builtintype" id="7688460">byte</span><span class="op" id="7688464">(</span><span class="ident" id="7688465">dict</span><span class="op" id="7688469">)</span><span class="op" id="7688470">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688473">data</span><span class="op" id="7688477">,</span>&nbsp;<span class="ident" id="7688479">err</span>&nbsp;<span class="op" id="7688483">:=</span>&nbsp;<span class="ident" id="7688486">ioutil</span><span class="op" id="7688492">.</span><span class="ident" id="7688493">ReadAll</span><span class="op" id="7688500">(</span><span class="ident" id="7688501">r</span><span class="op" id="7688502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688505">if</span>&nbsp;<span class="ident" id="7688508">err</span>&nbsp;<span class="op" id="7688512">!=</span>&nbsp;<span class="ident" id="7688515">nil</span>&nbsp;<span class="op" id="7688519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688523">t</span><span class="op" id="7688524">.</span><span class="ident" id="7688525">Fatal</span><span class="op" id="7688530">(</span><span class="ident" id="7688531">err</span><span class="op" id="7688534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688540">if</span>&nbsp;<span class="builtintype" id="7688543">string</span><span class="op" id="7688549">(</span><span class="ident" id="7688550">data</span><span class="op" id="7688554">)</span>&nbsp;<span class="op" id="7688556">!=</span>&nbsp;<span class="string" id="7688559">&#34;hello&nbsp;again&nbsp;world&#34;</span>&nbsp;<span class="op" id="7688579">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688583">t</span><span class="op" id="7688584">.</span><span class="ident" id="7688585">Fatalf</span><span class="op" id="7688591">(</span><span class="string" id="7688592">&#34;read&nbsp;returned&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7688618">,</span>&nbsp;<span class="builtintype" id="7688620">string</span><span class="op" id="7688626">(</span><span class="ident" id="7688627">data</span><span class="op" id="7688631">)</span><span class="op" id="7688632">,</span>&nbsp;<span class="ident" id="7688634">text</span><span class="op" id="7688638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688641">}</span><br>
<span class="lineno"></span><span class="op" id="7688643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7688646">func</span>&nbsp;<span class="ident" id="7688651">TestWriterDict</span><span class="op" id="7688665">(</span><span class="ident" id="7688666">t</span>&nbsp;<span class="op" id="7688668">*</span><span class="ident" id="7688669">testing</span><span class="op" id="7688676">.</span><span class="ident" id="7688677">T</span><span class="op" id="7688678">)</span>&nbsp;<span class="op" id="7688680">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688683">const</span>&nbsp;<span class="op" id="7688689">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688693">dict</span>&nbsp;<span class="op" id="7688698">=</span>&nbsp;<span class="string" id="7688700">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688716">text</span>&nbsp;<span class="op" id="7688721">=</span>&nbsp;<span class="string" id="7688723">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688747">var</span>&nbsp;<span class="ident" id="7688751">b</span>&nbsp;<span class="ident" id="7688753">bytes</span><span class="op" id="7688758">.</span><span class="ident" id="7688759">Buffer</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688767">w</span><span class="op" id="7688768">,</span>&nbsp;<span class="ident" id="7688770">err</span>&nbsp;<span class="op" id="7688774">:=</span>&nbsp;<span class="ident" id="7688777">NewWriter</span><span class="op" id="7688786">(</span><span class="op" id="7688787">&amp;</span><span class="ident" id="7688788">b</span><span class="op" id="7688789">,</span>&nbsp;<span class="num" id="7688791">5</span><span class="op" id="7688792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688795">if</span>&nbsp;<span class="ident" id="7688798">err</span>&nbsp;<span class="op" id="7688802">!=</span>&nbsp;<span class="ident" id="7688805">nil</span>&nbsp;<span class="op" id="7688809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688813">t</span><span class="op" id="7688814">.</span><span class="ident" id="7688815">Fatalf</span><span class="op" id="7688821">(</span><span class="string" id="7688822">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7688837">,</span>&nbsp;<span class="ident" id="7688839">err</span><span class="op" id="7688842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688848">w</span><span class="op" id="7688849">.</span><span class="ident" id="7688850">Write</span><span class="op" id="7688855">(</span><span class="op" id="7688856">[</span><span class="op" id="7688857">]</span><span class="builtintype" id="7688858">byte</span><span class="op" id="7688862">(</span><span class="ident" id="7688863">dict</span><span class="op" id="7688867">)</span><span class="op" id="7688868">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688871">w</span><span class="op" id="7688872">.</span><span class="ident" id="7688873">Flush</span><span class="op" id="7688878">(</span><span class="op" id="7688879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688882">b</span><span class="op" id="7688883">.</span><span class="ident" id="7688884">Reset</span><span class="op" id="7688889">(</span><span class="op" id="7688890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688893">w</span><span class="op" id="7688894">.</span><span class="ident" id="7688895">Write</span><span class="op" id="7688900">(</span><span class="op" id="7688901">[</span><span class="op" id="7688902">]</span><span class="builtintype" id="7688903">byte</span><span class="op" id="7688907">(</span><span class="ident" id="7688908">text</span><span class="op" id="7688912">)</span><span class="op" id="7688913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688916">w</span><span class="op" id="7688917">.</span><span class="ident" id="7688918">Close</span><span class="op" id="7688923">(</span><span class="op" id="7688924">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688928">var</span>&nbsp;<span class="ident" id="7688932">b1</span>&nbsp;<span class="ident" id="7688935">bytes</span><span class="op" id="7688940">.</span><span class="ident" id="7688941">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688949">w</span><span class="op" id="7688950">,</span>&nbsp;<span class="ident" id="7688952">_</span>&nbsp;<span class="op" id="7688954">=</span>&nbsp;<span class="ident" id="7688956">NewWriterDict</span><span class="op" id="7688969">(</span><span class="op" id="7688970">&amp;</span><span class="ident" id="7688971">b1</span><span class="op" id="7688973">,</span>&nbsp;<span class="num" id="7688975">5</span><span class="op" id="7688976">,</span>&nbsp;<span class="op" id="7688978">[</span><span class="op" id="7688979">]</span><span class="builtintype" id="7688980">byte</span><span class="op" id="7688984">(</span><span class="ident" id="7688985">dict</span><span class="op" id="7688989">)</span><span class="op" id="7688990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688993">w</span><span class="op" id="7688994">.</span><span class="ident" id="7688995">Write</span><span class="op" id="7689000">(</span><span class="op" id="7689001">[</span><span class="op" id="7689002">]</span><span class="builtintype" id="7689003">byte</span><span class="op" id="7689007">(</span><span class="ident" id="7689008">text</span><span class="op" id="7689012">)</span><span class="op" id="7689013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689016">w</span><span class="op" id="7689017">.</span><span class="ident" id="7689018">Close</span><span class="op" id="7689023">(</span><span class="op" id="7689024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689028">if</span>&nbsp;<span class="op" id="7689031">!</span><span class="ident" id="7689032">bytes</span><span class="op" id="7689037">.</span><span class="ident" id="7689038">Equal</span><span class="op" id="7689043">(</span><span class="ident" id="7689044">b1</span><span class="op" id="7689046">.</span><span class="ident" id="7689047">Bytes</span><span class="op" id="7689052">(</span><span class="op" id="7689053">)</span><span class="op" id="7689054">,</span>&nbsp;<span class="ident" id="7689056">b</span><span class="op" id="7689057">.</span><span class="ident" id="7689058">Bytes</span><span class="op" id="7689063">(</span><span class="op" id="7689064">)</span><span class="op" id="7689065">)</span>&nbsp;<span class="op" id="7689067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689071">t</span><span class="op" id="7689072">.</span><span class="ident" id="7689073">Fatalf</span><span class="op" id="7689079">(</span><span class="string" id="7689080">&#34;writer&nbsp;wrote&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7689105">,</span>&nbsp;<span class="ident" id="7689107">b1</span><span class="op" id="7689109">.</span><span class="ident" id="7689110">Bytes</span><span class="op" id="7689115">(</span><span class="op" id="7689116">)</span><span class="op" id="7689117">,</span>&nbsp;<span class="ident" id="7689119">b</span><span class="op" id="7689120">.</span><span class="ident" id="7689121">Bytes</span><span class="op" id="7689126">(</span><span class="op" id="7689127">)</span><span class="op" id="7689128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689131">}</span><br>
<span class="lineno"></span><span class="op" id="7689133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="7689136">//&nbsp;See&nbsp;http://code.google.com/p/go/issues/detail?id=2508</span><br>
<span class="lineno"></span><span class="keyword" id="7689193">func</span>&nbsp;<span class="ident" id="7689198">TestRegression2508</span><span class="op" id="7689216">(</span><span class="ident" id="7689217">t</span>&nbsp;<span class="op" id="7689219">*</span><span class="ident" id="7689220">testing</span><span class="op" id="7689227">.</span><span class="ident" id="7689228">T</span><span class="op" id="7689229">)</span>&nbsp;<span class="op" id="7689231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689234">if</span>&nbsp;<span class="ident" id="7689237">testing</span><span class="op" id="7689244">.</span><span class="ident" id="7689245">Short</span><span class="op" id="7689250">(</span><span class="op" id="7689251">)</span>&nbsp;<span class="op" id="7689253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689257">t</span><span class="op" id="7689258">.</span><span class="ident" id="7689259">Logf</span><span class="op" id="7689263">(</span><span class="string" id="7689264">&#34;test&nbsp;disabled&nbsp;with&nbsp;-short&#34;</span><span class="op" id="7689291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689295">return</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689306">w</span><span class="op" id="7689307">,</span>&nbsp;<span class="ident" id="7689309">err</span>&nbsp;<span class="op" id="7689313">:=</span>&nbsp;<span class="ident" id="7689316">NewWriter</span><span class="op" id="7689325">(</span><span class="ident" id="7689326">ioutil</span><span class="op" id="7689332">.</span><span class="ident" id="7689333">Discard</span><span class="op" id="7689340">,</span>&nbsp;<span class="num" id="7689342">1</span><span class="op" id="7689343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689346">if</span>&nbsp;<span class="ident" id="7689349">err</span>&nbsp;<span class="op" id="7689353">!=</span>&nbsp;<span class="ident" id="7689356">nil</span>&nbsp;<span class="op" id="7689360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689364">t</span><span class="op" id="7689365">.</span><span class="ident" id="7689366">Fatalf</span><span class="op" id="7689372">(</span><span class="string" id="7689373">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7689388">,</span>&nbsp;<span class="ident" id="7689390">err</span><span class="op" id="7689393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689396">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689399">buf</span>&nbsp;<span class="op" id="7689403">:=</span>&nbsp;<span class="builtinfunc" id="7689406">make</span><span class="op" id="7689410">(</span><span class="op" id="7689411">[</span><span class="op" id="7689412">]</span><span class="builtintype" id="7689413">byte</span><span class="op" id="7689417">,</span>&nbsp;<span class="num" id="7689419">1024</span><span class="op" id="7689423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689426">for</span>&nbsp;<span class="ident" id="7689430">i</span>&nbsp;<span class="op" id="7689432">:=</span>&nbsp;<span class="num" id="7689435">0</span><span class="op" id="7689436">;</span>&nbsp;<span class="ident" id="7689438">i</span>&nbsp;<span class="op" id="7689440">&lt;</span>&nbsp;<span class="num" id="7689442">131072</span><span class="op" id="7689448">;</span>&nbsp;<span class="ident" id="7689450">i</span><span class="op" id="7689451">++</span>&nbsp;<span class="op" id="7689454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689458">if</span>&nbsp;<span class="ident" id="7689461">_</span><span class="op" id="7689462">,</span>&nbsp;<span class="ident" id="7689464">err</span>&nbsp;<span class="op" id="7689468">:=</span>&nbsp;<span class="ident" id="7689471">w</span><span class="op" id="7689472">.</span><span class="ident" id="7689473">Write</span><span class="op" id="7689478">(</span><span class="ident" id="7689479">buf</span><span class="op" id="7689482">)</span><span class="op" id="7689483">;</span>&nbsp;<span class="ident" id="7689485">err</span>&nbsp;<span class="op" id="7689489">!=</span>&nbsp;<span class="ident" id="7689492">nil</span>&nbsp;<span class="op" id="7689496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689501">t</span><span class="op" id="7689502">.</span><span class="ident" id="7689503">Fatalf</span><span class="op" id="7689509">(</span><span class="string" id="7689510">&#34;writer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7689529">,</span>&nbsp;<span class="ident" id="7689531">err</span><span class="op" id="7689534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689538">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689544">w</span><span class="op" id="7689545">.</span><span class="ident" id="7689546">Close</span><span class="op" id="7689551">(</span><span class="op" id="7689552">)</span><br>
<span class="lineno"></span><span class="op" id="7689554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7689557">func</span>&nbsp;<span class="ident" id="7689562">TestWriterReset</span><span class="op" id="7689577">(</span><span class="ident" id="7689578">t</span>&nbsp;<span class="op" id="7689580">*</span><span class="ident" id="7689581">testing</span><span class="op" id="7689588">.</span><span class="ident" id="7689589">T</span><span class="op" id="7689590">)</span>&nbsp;<span class="op" id="7689592">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689595">for</span>&nbsp;<span class="ident" id="7689599">level</span>&nbsp;<span class="op" id="7689605">:=</span>&nbsp;<span class="num" id="7689608">0</span><span class="op" id="7689609">;</span>&nbsp;<span class="ident" id="7689611">level</span>&nbsp;<span class="op" id="7689617">&lt;=</span>&nbsp;<span class="num" id="7689620">9</span><span class="op" id="7689621">;</span>&nbsp;<span class="ident" id="7689623">level</span><span class="op" id="7689628">++</span>&nbsp;<span class="op" id="7689631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689635">if</span>&nbsp;<span class="ident" id="7689638">testing</span><span class="op" id="7689645">.</span><span class="ident" id="7689646">Short</span><span class="op" id="7689651">(</span><span class="op" id="7689652">)</span>&nbsp;<span class="op" id="7689654">&amp;&amp;</span>&nbsp;<span class="ident" id="7689657">level</span>&nbsp;<span class="op" id="7689663">&gt;</span>&nbsp;<span class="num" id="7689665">1</span>&nbsp;<span class="op" id="7689667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689672">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689684">w</span><span class="op" id="7689685">,</span>&nbsp;<span class="ident" id="7689687">err</span>&nbsp;<span class="op" id="7689691">:=</span>&nbsp;<span class="ident" id="7689694">NewWriter</span><span class="op" id="7689703">(</span><span class="ident" id="7689704">ioutil</span><span class="op" id="7689710">.</span><span class="ident" id="7689711">Discard</span><span class="op" id="7689718">,</span>&nbsp;<span class="ident" id="7689720">level</span><span class="op" id="7689725">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689729">if</span>&nbsp;<span class="ident" id="7689732">err</span>&nbsp;<span class="op" id="7689736">!=</span>&nbsp;<span class="ident" id="7689739">nil</span>&nbsp;<span class="op" id="7689743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689748">t</span><span class="op" id="7689749">.</span><span class="ident" id="7689750">Fatalf</span><span class="op" id="7689756">(</span><span class="string" id="7689757">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7689772">,</span>&nbsp;<span class="ident" id="7689774">err</span><span class="op" id="7689777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689785">buf</span>&nbsp;<span class="op" id="7689789">:=</span>&nbsp;<span class="op" id="7689792">[</span><span class="op" id="7689793">]</span><span class="builtintype" id="7689794">byte</span><span class="op" id="7689798">(</span><span class="string" id="7689799">&#34;hello&nbsp;world&#34;</span><span class="op" id="7689812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689816">for</span>&nbsp;<span class="ident" id="7689820">i</span>&nbsp;<span class="op" id="7689822">:=</span>&nbsp;<span class="num" id="7689825">0</span><span class="op" id="7689826">;</span>&nbsp;<span class="ident" id="7689828">i</span>&nbsp;<span class="op" id="7689830">&lt;</span>&nbsp;<span class="num" id="7689832">1024</span><span class="op" id="7689836">;</span>&nbsp;<span class="ident" id="7689838">i</span><span class="op" id="7689839">++</span>&nbsp;<span class="op" id="7689842">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689847">w</span><span class="op" id="7689848">.</span><span class="ident" id="7689849">Write</span><span class="op" id="7689854">(</span><span class="ident" id="7689855">buf</span><span class="op" id="7689858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689866">w</span><span class="op" id="7689867">.</span><span class="ident" id="7689868">Reset</span><span class="op" id="7689873">(</span><span class="ident" id="7689874">ioutil</span><span class="op" id="7689880">.</span><span class="ident" id="7689881">Discard</span><span class="op" id="7689888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689893">wref</span><span class="op" id="7689897">,</span>&nbsp;<span class="ident" id="7689899">err</span>&nbsp;<span class="op" id="7689903">:=</span>&nbsp;<span class="ident" id="7689906">NewWriter</span><span class="op" id="7689915">(</span><span class="ident" id="7689916">ioutil</span><span class="op" id="7689922">.</span><span class="ident" id="7689923">Discard</span><span class="op" id="7689930">,</span>&nbsp;<span class="ident" id="7689932">level</span><span class="op" id="7689937">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689941">if</span>&nbsp;<span class="ident" id="7689944">err</span>&nbsp;<span class="op" id="7689948">!=</span>&nbsp;<span class="ident" id="7689951">nil</span>&nbsp;<span class="op" id="7689955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689960">t</span><span class="op" id="7689961">.</span><span class="ident" id="7689962">Fatalf</span><span class="op" id="7689968">(</span><span class="string" id="7689969">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7689984">,</span>&nbsp;<span class="ident" id="7689986">err</span><span class="op" id="7689989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7689998">//&nbsp;DeepEqual&nbsp;doesn&#39;t&nbsp;compare&nbsp;functions.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690040">w</span><span class="op" id="7690041">.</span><span class="ident" id="7690042">d</span><span class="op" id="7690043">.</span><span class="ident" id="7690044">fill</span><span class="op" id="7690048">,</span>&nbsp;<span class="ident" id="7690050">wref</span><span class="op" id="7690054">.</span><span class="ident" id="7690055">d</span><span class="op" id="7690056">.</span><span class="ident" id="7690057">fill</span>&nbsp;<span class="op" id="7690062">=</span>&nbsp;<span class="ident" id="7690064">nil</span><span class="op" id="7690067">,</span>&nbsp;<span class="ident" id="7690069">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690075">w</span><span class="op" id="7690076">.</span><span class="ident" id="7690077">d</span><span class="op" id="7690078">.</span><span class="ident" id="7690079">step</span><span class="op" id="7690083">,</span>&nbsp;<span class="ident" id="7690085">wref</span><span class="op" id="7690089">.</span><span class="ident" id="7690090">d</span><span class="op" id="7690091">.</span><span class="ident" id="7690092">step</span>&nbsp;<span class="op" id="7690097">=</span>&nbsp;<span class="ident" id="7690099">nil</span><span class="op" id="7690102">,</span>&nbsp;<span class="ident" id="7690104">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690110">if</span>&nbsp;<span class="op" id="7690113">!</span><span class="ident" id="7690114">reflect</span><span class="op" id="7690121">.</span><span class="ident" id="7690122">DeepEqual</span><span class="op" id="7690131">(</span><span class="ident" id="7690132">w</span><span class="op" id="7690133">,</span>&nbsp;<span class="ident" id="7690135">wref</span><span class="op" id="7690139">)</span>&nbsp;<span class="op" id="7690141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690146">t</span><span class="op" id="7690147">.</span><span class="ident" id="7690148">Errorf</span><span class="op" id="7690154">(</span><span class="string" id="7690155">&#34;level&nbsp;%d&nbsp;Writer&nbsp;not&nbsp;reset&nbsp;after&nbsp;Reset&#34;</span><span class="op" id="7690194">,</span>&nbsp;<span class="ident" id="7690196">level</span><span class="op" id="7690201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690205">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690211">testResetOutput</span><span class="op" id="7690226">(</span><span class="ident" id="7690227">t</span><span class="op" id="7690228">,</span>&nbsp;<span class="keyword" id="7690230">func</span><span class="op" id="7690234">(</span><span class="ident" id="7690235">w</span>&nbsp;<span class="ident" id="7690237">io</span><span class="op" id="7690239">.</span><span class="ident" id="7690240">Writer</span><span class="op" id="7690246">)</span>&nbsp;<span class="op" id="7690248">(</span><span class="op" id="7690249">*</span><span class="ident" id="7690250">Writer</span><span class="op" id="7690256">,</span>&nbsp;<span class="builtintype" id="7690258">error</span><span class="op" id="7690263">)</span>&nbsp;<span class="op" id="7690265">{</span>&nbsp;<span class="keyword" id="7690267">return</span>&nbsp;<span class="ident" id="7690274">NewWriter</span><span class="op" id="7690283">(</span><span class="ident" id="7690284">w</span><span class="op" id="7690285">,</span>&nbsp;<span class="ident" id="7690287">NoCompression</span><span class="op" id="7690300">)</span>&nbsp;<span class="op" id="7690302">}</span><span class="op" id="7690303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690306">testResetOutput</span><span class="op" id="7690321">(</span><span class="ident" id="7690322">t</span><span class="op" id="7690323">,</span>&nbsp;<span class="keyword" id="7690325">func</span><span class="op" id="7690329">(</span><span class="ident" id="7690330">w</span>&nbsp;<span class="ident" id="7690332">io</span><span class="op" id="7690334">.</span><span class="ident" id="7690335">Writer</span><span class="op" id="7690341">)</span>&nbsp;<span class="op" id="7690343">(</span><span class="op" id="7690344">*</span><span class="ident" id="7690345">Writer</span><span class="op" id="7690351">,</span>&nbsp;<span class="builtintype" id="7690353">error</span><span class="op" id="7690358">)</span>&nbsp;<span class="op" id="7690360">{</span>&nbsp;<span class="keyword" id="7690362">return</span>&nbsp;<span class="ident" id="7690369">NewWriter</span><span class="op" id="7690378">(</span><span class="ident" id="7690379">w</span><span class="op" id="7690380">,</span>&nbsp;<span class="ident" id="7690382">DefaultCompression</span><span class="op" id="7690400">)</span>&nbsp;<span class="op" id="7690402">}</span><span class="op" id="7690403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690406">testResetOutput</span><span class="op" id="7690421">(</span><span class="ident" id="7690422">t</span><span class="op" id="7690423">,</span>&nbsp;<span class="keyword" id="7690425">func</span><span class="op" id="7690429">(</span><span class="ident" id="7690430">w</span>&nbsp;<span class="ident" id="7690432">io</span><span class="op" id="7690434">.</span><span class="ident" id="7690435">Writer</span><span class="op" id="7690441">)</span>&nbsp;<span class="op" id="7690443">(</span><span class="op" id="7690444">*</span><span class="ident" id="7690445">Writer</span><span class="op" id="7690451">,</span>&nbsp;<span class="builtintype" id="7690453">error</span><span class="op" id="7690458">)</span>&nbsp;<span class="op" id="7690460">{</span>&nbsp;<span class="keyword" id="7690462">return</span>&nbsp;<span class="ident" id="7690469">NewWriter</span><span class="op" id="7690478">(</span><span class="ident" id="7690479">w</span><span class="op" id="7690480">,</span>&nbsp;<span class="ident" id="7690482">BestCompression</span><span class="op" id="7690497">)</span>&nbsp;<span class="op" id="7690499">}</span><span class="op" id="7690500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690503">dict</span>&nbsp;<span class="op" id="7690508">:=</span>&nbsp;<span class="op" id="7690511">[</span><span class="op" id="7690512">]</span><span class="builtintype" id="7690513">byte</span><span class="op" id="7690517">(</span><span class="string" id="7690518">&#34;we&nbsp;are&nbsp;the&nbsp;world&#34;</span><span class="op" id="7690536">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690539">testResetOutput</span><span class="op" id="7690554">(</span><span class="ident" id="7690555">t</span><span class="op" id="7690556">,</span>&nbsp;<span class="keyword" id="7690558">func</span><span class="op" id="7690562">(</span><span class="ident" id="7690563">w</span>&nbsp;<span class="ident" id="7690565">io</span><span class="op" id="7690567">.</span><span class="ident" id="7690568">Writer</span><span class="op" id="7690574">)</span>&nbsp;<span class="op" id="7690576">(</span><span class="op" id="7690577">*</span><span class="ident" id="7690578">Writer</span><span class="op" id="7690584">,</span>&nbsp;<span class="builtintype" id="7690586">error</span><span class="op" id="7690591">)</span>&nbsp;<span class="op" id="7690593">{</span>&nbsp;<span class="keyword" id="7690595">return</span>&nbsp;<span class="ident" id="7690602">NewWriterDict</span><span class="op" id="7690615">(</span><span class="ident" id="7690616">w</span><span class="op" id="7690617">,</span>&nbsp;<span class="ident" id="7690619">NoCompression</span><span class="op" id="7690632">,</span>&nbsp;<span class="ident" id="7690634">dict</span><span class="op" id="7690638">)</span>&nbsp;<span class="op" id="7690640">}</span><span class="op" id="7690641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690644">testResetOutput</span><span class="op" id="7690659">(</span><span class="ident" id="7690660">t</span><span class="op" id="7690661">,</span>&nbsp;<span class="keyword" id="7690663">func</span><span class="op" id="7690667">(</span><span class="ident" id="7690668">w</span>&nbsp;<span class="ident" id="7690670">io</span><span class="op" id="7690672">.</span><span class="ident" id="7690673">Writer</span><span class="op" id="7690679">)</span>&nbsp;<span class="op" id="7690681">(</span><span class="op" id="7690682">*</span><span class="ident" id="7690683">Writer</span><span class="op" id="7690689">,</span>&nbsp;<span class="builtintype" id="7690691">error</span><span class="op" id="7690696">)</span>&nbsp;<span class="op" id="7690698">{</span>&nbsp;<span class="keyword" id="7690700">return</span>&nbsp;<span class="ident" id="7690707">NewWriterDict</span><span class="op" id="7690720">(</span><span class="ident" id="7690721">w</span><span class="op" id="7690722">,</span>&nbsp;<span class="ident" id="7690724">DefaultCompression</span><span class="op" id="7690742">,</span>&nbsp;<span class="ident" id="7690744">dict</span><span class="op" id="7690748">)</span>&nbsp;<span class="op" id="7690750">}</span><span class="op" id="7690751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690754">testResetOutput</span><span class="op" id="7690769">(</span><span class="ident" id="7690770">t</span><span class="op" id="7690771">,</span>&nbsp;<span class="keyword" id="7690773">func</span><span class="op" id="7690777">(</span><span class="ident" id="7690778">w</span>&nbsp;<span class="ident" id="7690780">io</span><span class="op" id="7690782">.</span><span class="ident" id="7690783">Writer</span><span class="op" id="7690789">)</span>&nbsp;<span class="op" id="7690791">(</span><span class="op" id="7690792">*</span><span class="ident" id="7690793">Writer</span><span class="op" id="7690799">,</span>&nbsp;<span class="builtintype" id="7690801">error</span><span class="op" id="7690806">)</span>&nbsp;<span class="op" id="7690808">{</span>&nbsp;<span class="keyword" id="7690810">return</span>&nbsp;<span class="ident" id="7690817">NewWriterDict</span><span class="op" id="7690830">(</span><span class="ident" id="7690831">w</span><span class="op" id="7690832">,</span>&nbsp;<span class="ident" id="7690834">BestCompression</span><span class="op" id="7690849">,</span>&nbsp;<span class="ident" id="7690851">dict</span><span class="op" id="7690855">)</span>&nbsp;<span class="op" id="7690857">}</span><span class="op" id="7690858">)</span><br>
<span class="lineno"></span><span class="op" id="7690860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="keyword" id="7690863">func</span>&nbsp;<span class="ident" id="7690868">testResetOutput</span><span class="op" id="7690883">(</span><span class="ident" id="7690884">t</span>&nbsp;<span class="op" id="7690886">*</span><span class="ident" id="7690887">testing</span><span class="op" id="7690894">.</span><span class="ident" id="7690895">T</span><span class="op" id="7690896">,</span>&nbsp;<span class="ident" id="7690898">newWriter</span>&nbsp;<span class="keyword" id="7690908">func</span><span class="op" id="7690912">(</span><span class="ident" id="7690913">w</span>&nbsp;<span class="ident" id="7690915">io</span><span class="op" id="7690917">.</span><span class="ident" id="7690918">Writer</span><span class="op" id="7690924">)</span>&nbsp;<span class="op" id="7690926">(</span><span class="op" id="7690927">*</span><span class="ident" id="7690928">Writer</span><span class="op" id="7690934">,</span>&nbsp;<span class="builtintype" id="7690936">error</span><span class="op" id="7690941">)</span><span class="op" id="7690942">)</span>&nbsp;<span class="op" id="7690944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690947">buf</span>&nbsp;<span class="op" id="7690951">:=</span>&nbsp;<span class="builtinfunc" id="7690954">new</span><span class="op" id="7690957">(</span><span class="ident" id="7690958">bytes</span><span class="op" id="7690963">.</span><span class="ident" id="7690964">Buffer</span><span class="op" id="7690970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690973">w</span><span class="op" id="7690974">,</span>&nbsp;<span class="ident" id="7690976">err</span>&nbsp;<span class="op" id="7690980">:=</span>&nbsp;<span class="ident" id="7690983">newWriter</span><span class="op" id="7690992">(</span><span class="ident" id="7690993">buf</span><span class="op" id="7690996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690999">if</span>&nbsp;<span class="ident" id="7691002">err</span>&nbsp;<span class="op" id="7691006">!=</span>&nbsp;<span class="ident" id="7691009">nil</span>&nbsp;<span class="op" id="7691013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691017">t</span><span class="op" id="7691018">.</span><span class="ident" id="7691019">Fatalf</span><span class="op" id="7691025">(</span><span class="string" id="7691026">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7691041">,</span>&nbsp;<span class="ident" id="7691043">err</span><span class="op" id="7691046">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691052">b</span>&nbsp;<span class="op" id="7691054">:=</span>&nbsp;<span class="op" id="7691057">[</span><span class="op" id="7691058">]</span><span class="builtintype" id="7691059">byte</span><span class="op" id="7691063">(</span><span class="string" id="7691064">&#34;hello&nbsp;world&#34;</span><span class="op" id="7691077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691080">for</span>&nbsp;<span class="ident" id="7691084">i</span>&nbsp;<span class="op" id="7691086">:=</span>&nbsp;<span class="num" id="7691089">0</span><span class="op" id="7691090">;</span>&nbsp;<span class="ident" id="7691092">i</span>&nbsp;<span class="op" id="7691094">&lt;</span>&nbsp;<span class="num" id="7691096">1024</span><span class="op" id="7691100">;</span>&nbsp;<span class="ident" id="7691102">i</span><span class="op" id="7691103">++</span>&nbsp;<span class="op" id="7691106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691110">w</span><span class="op" id="7691111">.</span><span class="ident" id="7691112">Write</span><span class="op" id="7691117">(</span><span class="ident" id="7691118">b</span><span class="op" id="7691119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691122">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691125">w</span><span class="op" id="7691126">.</span><span class="ident" id="7691127">Close</span><span class="op" id="7691132">(</span><span class="op" id="7691133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691136">out1</span>&nbsp;<span class="op" id="7691141">:=</span>&nbsp;<span class="ident" id="7691144">buf</span><span class="op" id="7691147">.</span><span class="ident" id="7691148">String</span><span class="op" id="7691154">(</span><span class="op" id="7691155">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691159">buf2</span>&nbsp;<span class="op" id="7691164">:=</span>&nbsp;<span class="builtinfunc" id="7691167">new</span><span class="op" id="7691170">(</span><span class="ident" id="7691171">bytes</span><span class="op" id="7691176">.</span><span class="ident" id="7691177">Buffer</span><span class="op" id="7691183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691186">w</span><span class="op" id="7691187">.</span><span class="ident" id="7691188">Reset</span><span class="op" id="7691193">(</span><span class="ident" id="7691194">buf2</span><span class="op" id="7691198">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691201">for</span>&nbsp;<span class="ident" id="7691205">i</span>&nbsp;<span class="op" id="7691207">:=</span>&nbsp;<span class="num" id="7691210">0</span><span class="op" id="7691211">;</span>&nbsp;<span class="ident" id="7691213">i</span>&nbsp;<span class="op" id="7691215">&lt;</span>&nbsp;<span class="num" id="7691217">1024</span><span class="op" id="7691221">;</span>&nbsp;<span class="ident" id="7691223">i</span><span class="op" id="7691224">++</span>&nbsp;<span class="op" id="7691227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691231">w</span><span class="op" id="7691232">.</span><span class="ident" id="7691233">Write</span><span class="op" id="7691238">(</span><span class="ident" id="7691239">b</span><span class="op" id="7691240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691246">w</span><span class="op" id="7691247">.</span><span class="ident" id="7691248">Close</span><span class="op" id="7691253">(</span><span class="op" id="7691254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691257">out2</span>&nbsp;<span class="op" id="7691262">:=</span>&nbsp;<span class="ident" id="7691265">buf2</span><span class="op" id="7691269">.</span><span class="ident" id="7691270">String</span><span class="op" id="7691276">(</span><span class="op" id="7691277">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691281">if</span>&nbsp;<span class="ident" id="7691284">out1</span>&nbsp;<span class="op" id="7691289">!=</span>&nbsp;<span class="ident" id="7691292">out2</span>&nbsp;<span class="op" id="7691297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691301">t</span><span class="op" id="7691302">.</span><span class="ident" id="7691303">Errorf</span><span class="op" id="7691309">(</span><span class="string" id="7691310">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7691331">,</span>&nbsp;<span class="ident" id="7691333">out2</span><span class="op" id="7691337">,</span>&nbsp;<span class="ident" id="7691339">out1</span><span class="op" id="7691343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691349">t</span><span class="op" id="7691350">.</span><span class="ident" id="7691351">Logf</span><span class="op" id="7691355">(</span><span class="string" id="7691356">&#34;got&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7691370">,</span>&nbsp;<span class="builtinfunc" id="7691372">len</span><span class="op" id="7691375">(</span><span class="ident" id="7691376">out1</span><span class="op" id="7691380">)</span><span class="op" id="7691381">)</span><br>
<span class="lineno">490</span><span class="op" id="7691383">}</span>
</div>
</body>
</html>
