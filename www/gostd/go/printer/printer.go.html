<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2002071">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2002126">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2002180">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2002231">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="2002284">package</span>&nbsp;<span class="ident" id="2002292">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2002301">import</span>&nbsp;<span class="op" id="2002308">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2002311">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2002318">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2002328">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2002340">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2002346">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2002352">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2002363">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2002374">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2002392">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="2002402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="2002405">const</span>&nbsp;<span class="op" id="2002411">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002414">maxNewlines</span>&nbsp;<span class="op" id="2002426">=</span>&nbsp;<span class="num" id="2002428">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2002434">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002482">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2002494">=</span>&nbsp;<span class="builtintype" id="2002496">false</span>&nbsp;<span class="comment" id="2002502">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002527">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2002539">=</span>&nbsp;<span class="num" id="2002541">1</span>&nbsp;<span class="op" id="2002543">&lt;&lt;</span>&nbsp;<span class="num" id="2002546">30</span><br>
<span class="lineno"></span><span class="op" id="2002549">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="2002552">type</span>&nbsp;<span class="ident" id="2002557">whiteSpace</span>&nbsp;<span class="builtintype" id="2002568">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2002574">const</span>&nbsp;<span class="op" id="2002580">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002583">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2002592">=</span>&nbsp;<span class="ident" id="2002594">whiteSpace</span><span class="op" id="2002604">(</span><span class="num" id="2002605">0</span><span class="op" id="2002606">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002609">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2002618">=</span>&nbsp;<span class="ident" id="2002620">whiteSpace</span><span class="op" id="2002630">(</span><span class="string" id="2002631">&#39;&nbsp;&#39;</span><span class="op" id="2002634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002637">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2002646">=</span>&nbsp;<span class="ident" id="2002648">whiteSpace</span><span class="op" id="2002658">(</span><span class="string" id="2002659">&#39;\v&#39;</span><span class="op" id="2002663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002666">newline</span>&nbsp;&nbsp;<span class="op" id="2002675">=</span>&nbsp;<span class="ident" id="2002677">whiteSpace</span><span class="op" id="2002687">(</span><span class="string" id="2002688">&#39;\n&#39;</span><span class="op" id="2002692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002695">formfeed</span>&nbsp;<span class="op" id="2002704">=</span>&nbsp;<span class="ident" id="2002706">whiteSpace</span><span class="op" id="2002716">(</span><span class="string" id="2002717">&#39;\f&#39;</span><span class="op" id="2002721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002724">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2002733">=</span>&nbsp;<span class="ident" id="2002735">whiteSpace</span><span class="op" id="2002745">(</span><span class="string" id="2002746">&#39;&gt;&#39;</span><span class="op" id="2002749">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002752">unindent</span>&nbsp;<span class="op" id="2002761">=</span>&nbsp;<span class="ident" id="2002763">whiteSpace</span><span class="op" id="2002773">(</span><span class="string" id="2002774">&#39;&lt;&#39;</span><span class="op" id="2002777">)</span><br>
<span class="lineno"></span><span class="op" id="2002779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2002782">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="2002836">type</span>&nbsp;<span class="ident" id="2002841">pmode</span>&nbsp;<span class="builtintype" id="2002847">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2002852">const</span>&nbsp;<span class="op" id="2002858">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002861">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2002878">pmode</span>&nbsp;<span class="op" id="2002884">=</span>&nbsp;<span class="num" id="2002886">1</span>&nbsp;<span class="op" id="2002888">&lt;&lt;</span>&nbsp;<span class="ident" id="2002891">iota</span>&nbsp;<span class="comment" id="2002896">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002944">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2002979">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="2003031">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="2003034">type</span>&nbsp;<span class="ident" id="2003039">commentInfo</span>&nbsp;<span class="keyword" id="2003051">struct</span>&nbsp;<span class="op" id="2003058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003061">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2003076">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2003094">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003120">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2003135">*</span><span class="ident" id="2003136">ast</span><span class="op" id="2003139">.</span><span class="ident" id="2003140">CommentGroup</span>&nbsp;<span class="comment" id="2003153">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003192">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="2003207">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2003225">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003306">commentNewline</span>&nbsp;<span class="builtintype" id="2003321">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2003339">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="2003386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2003389">type</span>&nbsp;<span class="ident" id="2003394">printer</span>&nbsp;<span class="keyword" id="2003402">struct</span>&nbsp;<span class="op" id="2003409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2003412">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003469">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003477">fset</span>&nbsp;<span class="op" id="2003482">*</span><span class="ident" id="2003483">token</span><span class="op" id="2003488">.</span><span class="ident" id="2003489">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2003499">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003517">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2003529">[</span><span class="op" id="2003530">]</span><span class="builtintype" id="2003531">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2003542">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003565">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2003577">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2003590">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003614">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003626">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2003639">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003664">impliedSemi</span>&nbsp;<span class="builtintype" id="2003676">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2003689">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003733">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003745">token</span><span class="op" id="2003750">.</span><span class="ident" id="2003751">Token</span>&nbsp;&nbsp;<span class="comment" id="2003758">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003816">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003828">token</span><span class="op" id="2003833">.</span><span class="ident" id="2003834">Token</span>&nbsp;&nbsp;<span class="comment" id="2003841">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003900">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2003912">[</span><span class="op" id="2003913">]</span><span class="ident" id="2003914">whiteSpace</span>&nbsp;<span class="comment" id="2003925">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2003950">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2003964">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004031">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004099">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004165">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004231">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004275">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2004283">token</span><span class="op" id="2004288">.</span><span class="ident" id="2004289">Position</span>&nbsp;<span class="comment" id="2004298">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004341">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2004349">token</span><span class="op" id="2004354">.</span><span class="ident" id="2004355">Position</span>&nbsp;<span class="comment" id="2004364">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004401">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2004409">token</span><span class="op" id="2004414">.</span><span class="ident" id="2004415">Position</span>&nbsp;<span class="comment" id="2004424">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004467">linePtr</span>&nbsp;<span class="op" id="2004475">*</span><span class="builtintype" id="2004476">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2004490">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004550">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004611">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2004627">[</span><span class="op" id="2004628">]</span><span class="op" id="2004629">*</span><span class="ident" id="2004630">ast</span><span class="op" id="2004633">.</span><span class="ident" id="2004634">CommentGroup</span>&nbsp;<span class="comment" id="2004647">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004662">useNodeComments</span>&nbsp;<span class="builtintype" id="2004678">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2004698">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004754">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004821">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004835">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004877">nodeSizes</span>&nbsp;<span class="keyword" id="2004887">map</span><span class="op" id="2004890">[</span><span class="ident" id="2004891">ast</span><span class="op" id="2004894">.</span><span class="ident" id="2004895">Node</span><span class="op" id="2004899">]</span><span class="builtintype" id="2004900">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004906">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004957">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="2004968">token</span><span class="op" id="2004973">.</span><span class="ident" id="2004974">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004979">cachedLine</span>&nbsp;<span class="builtintype" id="2004990">int</span>&nbsp;<span class="comment" id="2004994">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="2005029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2005032">func</span>&nbsp;<span class="op" id="2005037">(</span><span class="ident" id="2005038">p</span>&nbsp;<span class="op" id="2005040">*</span><span class="ident" id="2005041">printer</span><span class="op" id="2005048">)</span>&nbsp;<span class="ident" id="2005050">init</span><span class="op" id="2005054">(</span><span class="ident" id="2005055">cfg</span>&nbsp;<span class="op" id="2005059">*</span><span class="ident" id="2005060">Config</span><span class="op" id="2005066">,</span>&nbsp;<span class="ident" id="2005068">fset</span>&nbsp;<span class="op" id="2005073">*</span><span class="ident" id="2005074">token</span><span class="op" id="2005079">.</span><span class="ident" id="2005080">FileSet</span><span class="op" id="2005087">,</span>&nbsp;<span class="ident" id="2005089">nodeSizes</span>&nbsp;<span class="keyword" id="2005099">map</span><span class="op" id="2005102">[</span><span class="ident" id="2005103">ast</span><span class="op" id="2005106">.</span><span class="ident" id="2005107">Node</span><span class="op" id="2005111">]</span><span class="builtintype" id="2005112">int</span><span class="op" id="2005115">)</span>&nbsp;<span class="op" id="2005117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005120">p</span><span class="op" id="2005121">.</span><span class="ident" id="2005122">Config</span>&nbsp;<span class="op" id="2005129">=</span>&nbsp;<span class="op" id="2005131">*</span><span class="ident" id="2005132">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005137">p</span><span class="op" id="2005138">.</span><span class="ident" id="2005139">fset</span>&nbsp;<span class="op" id="2005144">=</span>&nbsp;<span class="ident" id="2005146">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005152">p</span><span class="op" id="2005153">.</span><span class="ident" id="2005154">pos</span>&nbsp;<span class="op" id="2005158">=</span>&nbsp;<span class="ident" id="2005160">token</span><span class="op" id="2005165">.</span><span class="ident" id="2005166">Position</span><span class="op" id="2005174">{</span><span class="ident" id="2005175">Line</span><span class="op" id="2005179">:</span>&nbsp;<span class="num" id="2005181">1</span><span class="op" id="2005182">,</span>&nbsp;<span class="ident" id="2005184">Column</span><span class="op" id="2005190">:</span>&nbsp;<span class="num" id="2005192">1</span><span class="op" id="2005193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005196">p</span><span class="op" id="2005197">.</span><span class="ident" id="2005198">out</span>&nbsp;<span class="op" id="2005202">=</span>&nbsp;<span class="ident" id="2005204">token</span><span class="op" id="2005209">.</span><span class="ident" id="2005210">Position</span><span class="op" id="2005218">{</span><span class="ident" id="2005219">Line</span><span class="op" id="2005223">:</span>&nbsp;<span class="num" id="2005225">1</span><span class="op" id="2005226">,</span>&nbsp;<span class="ident" id="2005228">Column</span><span class="op" id="2005234">:</span>&nbsp;<span class="num" id="2005236">1</span><span class="op" id="2005237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005240">p</span><span class="op" id="2005241">.</span><span class="ident" id="2005242">wsbuf</span>&nbsp;<span class="op" id="2005248">=</span>&nbsp;<span class="builtinfunc" id="2005250">make</span><span class="op" id="2005254">(</span><span class="op" id="2005255">[</span><span class="op" id="2005256">]</span><span class="ident" id="2005257">whiteSpace</span><span class="op" id="2005267">,</span>&nbsp;<span class="num" id="2005269">0</span><span class="op" id="2005270">,</span>&nbsp;<span class="num" id="2005272">16</span><span class="op" id="2005274">)</span>&nbsp;<span class="comment" id="2005276">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005311">p</span><span class="op" id="2005312">.</span><span class="ident" id="2005313">nodeSizes</span>&nbsp;<span class="op" id="2005323">=</span>&nbsp;<span class="ident" id="2005325">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005336">p</span><span class="op" id="2005337">.</span><span class="ident" id="2005338">cachedPos</span>&nbsp;<span class="op" id="2005348">=</span>&nbsp;<span class="op" id="2005350">-</span><span class="num" id="2005351">1</span><br>
<span class="lineno"></span><span class="op" id="2005353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2005356">func</span>&nbsp;<span class="op" id="2005361">(</span><span class="ident" id="2005362">p</span>&nbsp;<span class="op" id="2005364">*</span><span class="ident" id="2005365">printer</span><span class="op" id="2005372">)</span>&nbsp;<span class="ident" id="2005374">internalError</span><span class="op" id="2005387">(</span><span class="ident" id="2005388">msg</span>&nbsp;<span class="op" id="2005392">...</span><span class="keyword" id="2005395">interface</span><span class="op" id="2005404">{</span><span class="op" id="2005405">}</span><span class="op" id="2005406">)</span>&nbsp;<span class="op" id="2005408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005411">if</span>&nbsp;<span class="ident" id="2005414">debug</span>&nbsp;<span class="op" id="2005420">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005424">fmt</span><span class="op" id="2005427">.</span><span class="ident" id="2005428">Print</span><span class="op" id="2005433">(</span><span class="ident" id="2005434">p</span><span class="op" id="2005435">.</span><span class="ident" id="2005436">pos</span><span class="op" id="2005439">.</span><span class="ident" id="2005440">String</span><span class="op" id="2005446">(</span><span class="op" id="2005447">)</span>&nbsp;<span class="op" id="2005449">+</span>&nbsp;<span class="string" id="2005451">&#34;:&nbsp;&#34;</span><span class="op" id="2005455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005459">fmt</span><span class="op" id="2005462">.</span><span class="ident" id="2005463">Println</span><span class="op" id="2005470">(</span><span class="ident" id="2005471">msg</span><span class="op" id="2005474">...</span><span class="op" id="2005477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2005481">panic</span><span class="op" id="2005486">(</span><span class="string" id="2005487">&#34;go/printer&#34;</span><span class="op" id="2005499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2005502">}</span><br>
<span class="lineno"></span><span class="op" id="2005504">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="2005507">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2005578">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="2005654">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="2005727">func</span>&nbsp;<span class="op" id="2005732">(</span><span class="ident" id="2005733">p</span>&nbsp;<span class="op" id="2005735">*</span><span class="ident" id="2005736">printer</span><span class="op" id="2005743">)</span>&nbsp;<span class="ident" id="2005745">commentsHaveNewline</span><span class="op" id="2005764">(</span><span class="ident" id="2005765">list</span>&nbsp;<span class="op" id="2005770">[</span><span class="op" id="2005771">]</span><span class="op" id="2005772">*</span><span class="ident" id="2005773">ast</span><span class="op" id="2005776">.</span><span class="ident" id="2005777">Comment</span><span class="op" id="2005784">)</span>&nbsp;<span class="builtintype" id="2005786">bool</span>&nbsp;<span class="op" id="2005791">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2005794">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005812">line</span>&nbsp;<span class="op" id="2005817">:=</span>&nbsp;<span class="ident" id="2005820">p</span><span class="op" id="2005821">.</span><span class="ident" id="2005822">lineFor</span><span class="op" id="2005829">(</span><span class="ident" id="2005830">list</span><span class="op" id="2005834">[</span><span class="num" id="2005835">0</span><span class="op" id="2005836">]</span><span class="op" id="2005837">.</span><span class="ident" id="2005838">Pos</span><span class="op" id="2005841">(</span><span class="op" id="2005842">)</span><span class="op" id="2005843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005846">for</span>&nbsp;<span class="ident" id="2005850">i</span><span class="op" id="2005851">,</span>&nbsp;<span class="ident" id="2005853">c</span>&nbsp;<span class="op" id="2005855">:=</span>&nbsp;<span class="keyword" id="2005858">range</span>&nbsp;<span class="ident" id="2005864">list</span>&nbsp;<span class="op" id="2005869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005873">if</span>&nbsp;<span class="ident" id="2005876">i</span>&nbsp;<span class="op" id="2005878">&gt;</span>&nbsp;<span class="num" id="2005880">0</span>&nbsp;<span class="op" id="2005882">&amp;&amp;</span>&nbsp;<span class="ident" id="2005885">p</span><span class="op" id="2005886">.</span><span class="ident" id="2005887">lineFor</span><span class="op" id="2005894">(</span><span class="ident" id="2005895">list</span><span class="op" id="2005899">[</span><span class="ident" id="2005900">i</span><span class="op" id="2005901">]</span><span class="op" id="2005902">.</span><span class="ident" id="2005903">Pos</span><span class="op" id="2005906">(</span><span class="op" id="2005907">)</span><span class="op" id="2005908">)</span>&nbsp;<span class="op" id="2005910">!=</span>&nbsp;<span class="ident" id="2005913">line</span>&nbsp;<span class="op" id="2005918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2005923">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005963">return</span>&nbsp;<span class="builtintype" id="2005970">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2005977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005981">if</span>&nbsp;<span class="ident" id="2005984">t</span>&nbsp;<span class="op" id="2005986">:=</span>&nbsp;<span class="ident" id="2005989">c</span><span class="op" id="2005990">.</span><span class="ident" id="2005991">Text</span><span class="op" id="2005995">;</span>&nbsp;<span class="builtinfunc" id="2005997">len</span><span class="op" id="2006000">(</span><span class="ident" id="2006001">t</span><span class="op" id="2006002">)</span>&nbsp;<span class="op" id="2006004">&gt;=</span>&nbsp;<span class="num" id="2006007">2</span>&nbsp;<span class="op" id="2006009">&amp;&amp;</span>&nbsp;<span class="op" id="2006012">(</span><span class="ident" id="2006013">t</span><span class="op" id="2006014">[</span><span class="num" id="2006015">1</span><span class="op" id="2006016">]</span>&nbsp;<span class="op" id="2006018">==</span>&nbsp;<span class="string" id="2006021">&#39;/&#39;</span>&nbsp;<span class="op" id="2006025">||</span>&nbsp;<span class="ident" id="2006028">strings</span><span class="op" id="2006035">.</span><span class="ident" id="2006036">Contains</span><span class="op" id="2006044">(</span><span class="ident" id="2006045">t</span><span class="op" id="2006046">,</span>&nbsp;<span class="string" id="2006048">&#34;\n&#34;</span><span class="op" id="2006052">)</span><span class="op" id="2006053">)</span>&nbsp;<span class="op" id="2006055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2006060">return</span>&nbsp;<span class="builtintype" id="2006067">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2006074">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2006077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2006080">_</span>&nbsp;<span class="op" id="2006082">=</span>&nbsp;<span class="ident" id="2006084">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2006090">return</span>&nbsp;<span class="builtintype" id="2006097">false</span><br>
<span class="lineno"></span><span class="op" id="2006103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2006106">func</span>&nbsp;<span class="op" id="2006111">(</span><span class="ident" id="2006112">p</span>&nbsp;<span class="op" id="2006114">*</span><span class="ident" id="2006115">printer</span><span class="op" id="2006122">)</span>&nbsp;<span class="ident" id="2006124">nextComment</span><span class="op" id="2006135">(</span><span class="op" id="2006136">)</span>&nbsp;<span class="op" id="2006138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2006141">for</span>&nbsp;<span class="ident" id="2006145">p</span><span class="op" id="2006146">.</span><span class="ident" id="2006147">cindex</span>&nbsp;<span class="op" id="2006154">&lt;</span>&nbsp;<span class="builtinfunc" id="2006156">len</span><span class="op" id="2006159">(</span><span class="ident" id="2006160">p</span><span class="op" id="2006161">.</span><span class="ident" id="2006162">comments</span><span class="op" id="2006170">)</span>&nbsp;<span class="op" id="2006172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2006176">c</span>&nbsp;<span class="op" id="2006178">:=</span>&nbsp;<span class="ident" id="2006181">p</span><span class="op" id="2006182">.</span><span class="ident" id="2006183">comments</span><span class="op" id="2006191">[</span><span class="ident" id="2006192">p</span><span class="op" id="2006193">.</span><span class="ident" id="2006194">cindex</span><span class="op" id="2006200">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2006204">p</span><span class="op" id="2006205">.</span><span class="ident" id="2006206">cindex</span><span class="op" id="2006212">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2006217">if</span>&nbsp;<span class="ident" id="2006220">list</span>&nbsp;<span class="op" id="2006225">:=</span>&nbsp;<span class="ident" id="2006228">c</span><span class="op" id="2006229">.</span><span class="ident" id="2006230">List</span><span class="op" id="2006234">;</span>&nbsp;<span class="builtinfunc" id="2006236">len</span><span class="op" id="2006239">(</span><span class="ident" id="2006240">list</span><span class="op" id="2006244">)</span>&nbsp;<span class="op" id="2006246">&gt;</span>&nbsp;<span class="num" id="2006248">0</span>&nbsp;<span class="op" id="2006250">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2006255">p</span><span class="op" id="2006256">.</span><span class="ident" id="2006257">comment</span>&nbsp;<span class="op" id="2006265">=</span>&nbsp;<span class="ident" id="2006267">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2006272">p</span><span class="op" id="2006273">.</span><span class="ident" id="2006274">commentOffset</span>&nbsp;<span class="op" id="2006288">=</span>&nbsp;<span class="ident" id="2006290">p</span><span class="op" id="2006291">.</span><span class="ident" id="2006292">posFor</span><span class="op" id="2006298">(</span><span class="ident" id="2006299">list</span><span class="op" id="2006303">[</span><span class="num" id="2006304">0</span><span class="op" id="2006305">]</span><span class="op" id="2006306">.</span><span class="ident" id="2006307">Pos</span><span class="op" id="2006310">(</span><span class="op" id="2006311">)</span><span class="op" id="2006312">)</span><span class="op" id="2006313">.</span><span class="ident" id="2006314">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2006324">p</span><span class="op" id="2006325">.</span><span class="ident" id="2006326">commentNewline</span>&nbsp;<span class="op" id="2006341">=</span>&nbsp;<span class="ident" id="2006343">p</span><span class="op" id="2006344">.</span><span class="ident" id="2006345">commentsHaveNewline</span><span class="op" id="2006364">(</span><span class="ident" id="2006365">list</span><span class="op" id="2006369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2006374">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2006383">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2006387">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2006448">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2006511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2006514">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2006535">p</span><span class="op" id="2006536">.</span><span class="ident" id="2006537">commentOffset</span>&nbsp;<span class="op" id="2006551">=</span>&nbsp;<span class="ident" id="2006553">infinity</span><br>
<span class="lineno">145</span><span class="op" id="2006562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2006565">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="2006632">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="2006700">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="2006738">//</span><br>
<span class="lineno"></span><span class="keyword" id="2006741">func</span>&nbsp;<span class="op" id="2006746">(</span><span class="ident" id="2006747">p</span>&nbsp;<span class="op" id="2006749">*</span><span class="ident" id="2006750">printer</span><span class="op" id="2006757">)</span>&nbsp;<span class="ident" id="2006759">commentBefore</span><span class="op" id="2006772">(</span><span class="ident" id="2006773">next</span>&nbsp;<span class="ident" id="2006778">token</span><span class="op" id="2006783">.</span><span class="ident" id="2006784">Position</span><span class="op" id="2006792">)</span>&nbsp;<span class="builtintype" id="2006794">bool</span>&nbsp;<span class="op" id="2006799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2006802">return</span>&nbsp;<span class="ident" id="2006809">p</span><span class="op" id="2006810">.</span><span class="ident" id="2006811">commentOffset</span>&nbsp;<span class="op" id="2006825">&lt;</span>&nbsp;<span class="ident" id="2006827">next</span><span class="op" id="2006831">.</span><span class="ident" id="2006832">Offset</span>&nbsp;<span class="op" id="2006839">&amp;&amp;</span>&nbsp;<span class="op" id="2006842">(</span><span class="op" id="2006843">!</span><span class="ident" id="2006844">p</span><span class="op" id="2006845">.</span><span class="ident" id="2006846">impliedSemi</span>&nbsp;<span class="op" id="2006858">||</span>&nbsp;<span class="op" id="2006861">!</span><span class="ident" id="2006862">p</span><span class="op" id="2006863">.</span><span class="ident" id="2006864">commentNewline</span><span class="op" id="2006878">)</span><br>
<span class="lineno"></span><span class="op" id="2006880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="2006883">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2006938">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="2006993">//</span><br>
<span class="lineno"></span><span class="keyword" id="2006996">func</span>&nbsp;<span class="op" id="2007001">(</span><span class="ident" id="2007002">p</span>&nbsp;<span class="op" id="2007004">*</span><span class="ident" id="2007005">printer</span><span class="op" id="2007012">)</span>&nbsp;<span class="ident" id="2007014">commentSizeBefore</span><span class="op" id="2007031">(</span><span class="ident" id="2007032">next</span>&nbsp;<span class="ident" id="2007037">token</span><span class="op" id="2007042">.</span><span class="ident" id="2007043">Position</span><span class="op" id="2007051">)</span>&nbsp;<span class="builtintype" id="2007053">int</span>&nbsp;<span class="op" id="2007057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2007060">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2007129">defer</span>&nbsp;<span class="keyword" id="2007135">func</span><span class="op" id="2007139">(</span><span class="ident" id="2007140">info</span>&nbsp;<span class="ident" id="2007145">commentInfo</span><span class="op" id="2007156">)</span>&nbsp;<span class="op" id="2007158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2007162">p</span><span class="op" id="2007163">.</span><span class="ident" id="2007164">commentInfo</span>&nbsp;<span class="op" id="2007176">=</span>&nbsp;<span class="ident" id="2007178">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2007184">}</span><span class="op" id="2007185">(</span><span class="ident" id="2007186">p</span><span class="op" id="2007187">.</span><span class="ident" id="2007188">commentInfo</span><span class="op" id="2007199">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2007203">size</span>&nbsp;<span class="op" id="2007208">:=</span>&nbsp;<span class="num" id="2007211">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2007214">for</span>&nbsp;<span class="ident" id="2007218">p</span><span class="op" id="2007219">.</span><span class="ident" id="2007220">commentBefore</span><span class="op" id="2007233">(</span><span class="ident" id="2007234">next</span><span class="op" id="2007238">)</span>&nbsp;<span class="op" id="2007240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2007244">for</span>&nbsp;<span class="ident" id="2007248">_</span><span class="op" id="2007249">,</span>&nbsp;<span class="ident" id="2007251">c</span>&nbsp;<span class="op" id="2007253">:=</span>&nbsp;<span class="keyword" id="2007256">range</span>&nbsp;<span class="ident" id="2007262">p</span><span class="op" id="2007263">.</span><span class="ident" id="2007264">comment</span><span class="op" id="2007271">.</span><span class="ident" id="2007272">List</span>&nbsp;<span class="op" id="2007277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2007282">size</span>&nbsp;<span class="op" id="2007287">+=</span>&nbsp;<span class="builtinfunc" id="2007290">len</span><span class="op" id="2007293">(</span><span class="ident" id="2007294">c</span><span class="op" id="2007295">.</span><span class="ident" id="2007296">Text</span><span class="op" id="2007300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2007304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2007308">p</span><span class="op" id="2007309">.</span><span class="ident" id="2007310">nextComment</span><span class="op" id="2007321">(</span><span class="op" id="2007322">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2007325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2007328">return</span>&nbsp;<span class="ident" id="2007335">size</span><br>
<span class="lineno"></span><span class="op" id="2007340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2007343">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="2007416">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2007490">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="2007566">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="2007582">//</span><br>
<span class="lineno"></span><span class="keyword" id="2007585">func</span>&nbsp;<span class="op" id="2007590">(</span><span class="ident" id="2007591">p</span>&nbsp;<span class="op" id="2007593">*</span><span class="ident" id="2007594">printer</span><span class="op" id="2007601">)</span>&nbsp;<span class="ident" id="2007603">recordLine</span><span class="op" id="2007613">(</span><span class="ident" id="2007614">linePtr</span>&nbsp;<span class="op" id="2007622">*</span><span class="builtintype" id="2007623">int</span><span class="op" id="2007626">)</span>&nbsp;<span class="op" id="2007628">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2007631">p</span><span class="op" id="2007632">.</span><span class="ident" id="2007633">linePtr</span>&nbsp;<span class="op" id="2007641">=</span>&nbsp;<span class="ident" id="2007643">linePtr</span><br>
<span class="lineno"></span><span class="op" id="2007651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2007654">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="2007722">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="2007790">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="2007860">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="2007916">//</span><br>
<span class="lineno"></span><span class="keyword" id="2007919">func</span>&nbsp;<span class="op" id="2007924">(</span><span class="ident" id="2007925">p</span>&nbsp;<span class="op" id="2007927">*</span><span class="ident" id="2007928">printer</span><span class="op" id="2007935">)</span>&nbsp;<span class="ident" id="2007937">linesFrom</span><span class="op" id="2007946">(</span><span class="ident" id="2007947">line</span>&nbsp;<span class="builtintype" id="2007952">int</span><span class="op" id="2007955">)</span>&nbsp;<span class="builtintype" id="2007957">int</span>&nbsp;<span class="op" id="2007961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2007964">return</span>&nbsp;<span class="ident" id="2007971">p</span><span class="op" id="2007972">.</span><span class="ident" id="2007973">out</span><span class="op" id="2007976">.</span><span class="ident" id="2007977">Line</span>&nbsp;<span class="op" id="2007982">-</span>&nbsp;<span class="ident" id="2007984">line</span><br>
<span class="lineno">190</span><span class="op" id="2007989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2007992">func</span>&nbsp;<span class="op" id="2007997">(</span><span class="ident" id="2007998">p</span>&nbsp;<span class="op" id="2008000">*</span><span class="ident" id="2008001">printer</span><span class="op" id="2008008">)</span>&nbsp;<span class="ident" id="2008010">posFor</span><span class="op" id="2008016">(</span><span class="ident" id="2008017">pos</span>&nbsp;<span class="ident" id="2008021">token</span><span class="op" id="2008026">.</span><span class="ident" id="2008027">Pos</span><span class="op" id="2008030">)</span>&nbsp;<span class="ident" id="2008032">token</span><span class="op" id="2008037">.</span><span class="ident" id="2008038">Position</span>&nbsp;<span class="op" id="2008047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2008050">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2008112">return</span>&nbsp;<span class="ident" id="2008119">p</span><span class="op" id="2008120">.</span><span class="ident" id="2008121">fset</span><span class="op" id="2008125">.</span><span class="ident" id="2008126">Position</span><span class="op" id="2008134">(</span><span class="ident" id="2008135">pos</span><span class="op" id="2008138">)</span><br>
<span class="lineno">195</span><span class="op" id="2008140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2008143">func</span>&nbsp;<span class="op" id="2008148">(</span><span class="ident" id="2008149">p</span>&nbsp;<span class="op" id="2008151">*</span><span class="ident" id="2008152">printer</span><span class="op" id="2008159">)</span>&nbsp;<span class="ident" id="2008161">lineFor</span><span class="op" id="2008168">(</span><span class="ident" id="2008169">pos</span>&nbsp;<span class="ident" id="2008173">token</span><span class="op" id="2008178">.</span><span class="ident" id="2008179">Pos</span><span class="op" id="2008182">)</span>&nbsp;<span class="builtintype" id="2008184">int</span>&nbsp;<span class="op" id="2008188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2008191">if</span>&nbsp;<span class="ident" id="2008194">pos</span>&nbsp;<span class="op" id="2008198">!=</span>&nbsp;<span class="ident" id="2008201">p</span><span class="op" id="2008202">.</span><span class="ident" id="2008203">cachedPos</span>&nbsp;<span class="op" id="2008213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2008217">p</span><span class="op" id="2008218">.</span><span class="ident" id="2008219">cachedPos</span>&nbsp;<span class="op" id="2008229">=</span>&nbsp;<span class="ident" id="2008231">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2008237">p</span><span class="op" id="2008238">.</span><span class="ident" id="2008239">cachedLine</span>&nbsp;<span class="op" id="2008250">=</span>&nbsp;<span class="ident" id="2008252">p</span><span class="op" id="2008253">.</span><span class="ident" id="2008254">fset</span><span class="op" id="2008258">.</span><span class="ident" id="2008259">Position</span><span class="op" id="2008267">(</span><span class="ident" id="2008268">pos</span><span class="op" id="2008271">)</span><span class="op" id="2008272">.</span><span class="ident" id="2008273">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2008279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2008282">return</span>&nbsp;<span class="ident" id="2008289">p</span><span class="op" id="2008290">.</span><span class="ident" id="2008291">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="2008302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="2008305">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="2008380">func</span>&nbsp;<span class="op" id="2008385">(</span><span class="ident" id="2008386">p</span>&nbsp;<span class="op" id="2008388">*</span><span class="ident" id="2008389">printer</span><span class="op" id="2008396">)</span>&nbsp;<span class="ident" id="2008398">atLineBegin</span><span class="op" id="2008409">(</span><span class="ident" id="2008410">pos</span>&nbsp;<span class="ident" id="2008414">token</span><span class="op" id="2008419">.</span><span class="ident" id="2008420">Position</span><span class="op" id="2008428">)</span>&nbsp;<span class="op" id="2008430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2008433">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2008473">if</span>&nbsp;<span class="ident" id="2008476">p</span><span class="op" id="2008477">.</span><span class="ident" id="2008478">Config</span><span class="op" id="2008484">.</span><span class="ident" id="2008485">Mode</span><span class="op" id="2008489">&amp;</span><span class="ident" id="2008490">SourcePos</span>&nbsp;<span class="op" id="2008500">!=</span>&nbsp;<span class="num" id="2008503">0</span>&nbsp;<span class="op" id="2008505">&amp;&amp;</span>&nbsp;<span class="ident" id="2008508">pos</span><span class="op" id="2008511">.</span><span class="ident" id="2008512">IsValid</span><span class="op" id="2008519">(</span><span class="op" id="2008520">)</span>&nbsp;<span class="op" id="2008522">&amp;&amp;</span>&nbsp;<span class="op" id="2008525">(</span><span class="ident" id="2008526">p</span><span class="op" id="2008527">.</span><span class="ident" id="2008528">out</span><span class="op" id="2008531">.</span><span class="ident" id="2008532">Line</span>&nbsp;<span class="op" id="2008537">!=</span>&nbsp;<span class="ident" id="2008540">pos</span><span class="op" id="2008543">.</span><span class="ident" id="2008544">Line</span>&nbsp;<span class="op" id="2008549">||</span>&nbsp;<span class="ident" id="2008552">p</span><span class="op" id="2008553">.</span><span class="ident" id="2008554">out</span><span class="op" id="2008557">.</span><span class="ident" id="2008558">Filename</span>&nbsp;<span class="op" id="2008567">!=</span>&nbsp;<span class="ident" id="2008570">pos</span><span class="op" id="2008573">.</span><span class="ident" id="2008574">Filename</span><span class="op" id="2008582">)</span>&nbsp;<span class="op" id="2008584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2008588">p</span><span class="op" id="2008589">.</span><span class="ident" id="2008590">output</span>&nbsp;<span class="op" id="2008597">=</span>&nbsp;<span class="builtinfunc" id="2008599">append</span><span class="op" id="2008605">(</span><span class="ident" id="2008606">p</span><span class="op" id="2008607">.</span><span class="ident" id="2008608">output</span><span class="op" id="2008614">,</span>&nbsp;<span class="ident" id="2008616">tabwriter</span><span class="op" id="2008625">.</span><span class="ident" id="2008626">Escape</span><span class="op" id="2008632">)</span>&nbsp;<span class="comment" id="2008634">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2008692">p</span><span class="op" id="2008693">.</span><span class="ident" id="2008694">output</span>&nbsp;<span class="op" id="2008701">=</span>&nbsp;<span class="builtinfunc" id="2008703">append</span><span class="op" id="2008709">(</span><span class="ident" id="2008710">p</span><span class="op" id="2008711">.</span><span class="ident" id="2008712">output</span><span class="op" id="2008718">,</span>&nbsp;<span class="ident" id="2008720">fmt</span><span class="op" id="2008723">.</span><span class="ident" id="2008724">Sprintf</span><span class="op" id="2008731">(</span><span class="string" id="2008732">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="2008748">,</span>&nbsp;<span class="ident" id="2008750">pos</span><span class="op" id="2008753">.</span><span class="ident" id="2008754">Filename</span><span class="op" id="2008762">,</span>&nbsp;<span class="ident" id="2008764">pos</span><span class="op" id="2008767">.</span><span class="ident" id="2008768">Line</span><span class="op" id="2008772">)</span><span class="op" id="2008773">...</span><span class="op" id="2008776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2008780">p</span><span class="op" id="2008781">.</span><span class="ident" id="2008782">output</span>&nbsp;<span class="op" id="2008789">=</span>&nbsp;<span class="builtinfunc" id="2008791">append</span><span class="op" id="2008797">(</span><span class="ident" id="2008798">p</span><span class="op" id="2008799">.</span><span class="ident" id="2008800">output</span><span class="op" id="2008806">,</span>&nbsp;<span class="ident" id="2008808">tabwriter</span><span class="op" id="2008817">.</span><span class="ident" id="2008818">Escape</span><span class="op" id="2008824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2008828">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2008869">p</span><span class="op" id="2008870">.</span><span class="ident" id="2008871">out</span><span class="op" id="2008874">.</span><span class="ident" id="2008875">Filename</span>&nbsp;<span class="op" id="2008884">=</span>&nbsp;<span class="ident" id="2008886">pos</span><span class="op" id="2008889">.</span><span class="ident" id="2008890">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2008901">p</span><span class="op" id="2008902">.</span><span class="ident" id="2008903">out</span><span class="op" id="2008906">.</span><span class="ident" id="2008907">Line</span>&nbsp;<span class="op" id="2008912">=</span>&nbsp;<span class="ident" id="2008914">pos</span><span class="op" id="2008917">.</span><span class="ident" id="2008918">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2008924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2008928">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2008950">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2008993">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009036">n</span>&nbsp;<span class="op" id="2009038">:=</span>&nbsp;<span class="ident" id="2009041">p</span><span class="op" id="2009042">.</span><span class="ident" id="2009043">Config</span><span class="op" id="2009049">.</span><span class="ident" id="2009050">Indent</span>&nbsp;<span class="op" id="2009057">+</span>&nbsp;<span class="ident" id="2009059">p</span><span class="op" id="2009060">.</span><span class="ident" id="2009061">indent</span>&nbsp;<span class="comment" id="2009068">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2009097">for</span>&nbsp;<span class="ident" id="2009101">i</span>&nbsp;<span class="op" id="2009103">:=</span>&nbsp;<span class="num" id="2009106">0</span><span class="op" id="2009107">;</span>&nbsp;<span class="ident" id="2009109">i</span>&nbsp;<span class="op" id="2009111">&lt;</span>&nbsp;<span class="ident" id="2009113">n</span><span class="op" id="2009114">;</span>&nbsp;<span class="ident" id="2009116">i</span><span class="op" id="2009117">++</span>&nbsp;<span class="op" id="2009120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009124">p</span><span class="op" id="2009125">.</span><span class="ident" id="2009126">output</span>&nbsp;<span class="op" id="2009133">=</span>&nbsp;<span class="builtinfunc" id="2009135">append</span><span class="op" id="2009141">(</span><span class="ident" id="2009142">p</span><span class="op" id="2009143">.</span><span class="ident" id="2009144">output</span><span class="op" id="2009150">,</span>&nbsp;<span class="string" id="2009152">&#39;\t&#39;</span><span class="op" id="2009156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2009159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2009163">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009184">p</span><span class="op" id="2009185">.</span><span class="ident" id="2009186">pos</span><span class="op" id="2009189">.</span><span class="ident" id="2009190">Offset</span>&nbsp;<span class="op" id="2009197">+=</span>&nbsp;<span class="ident" id="2009200">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009203">p</span><span class="op" id="2009204">.</span><span class="ident" id="2009205">pos</span><span class="op" id="2009208">.</span><span class="ident" id="2009209">Column</span>&nbsp;<span class="op" id="2009216">+=</span>&nbsp;<span class="ident" id="2009219">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009222">p</span><span class="op" id="2009223">.</span><span class="ident" id="2009224">out</span><span class="op" id="2009227">.</span><span class="ident" id="2009228">Column</span>&nbsp;<span class="op" id="2009235">+=</span>&nbsp;<span class="ident" id="2009238">n</span><br>
<span class="lineno"></span><span class="op" id="2009240">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="2009243">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="2009305">func</span>&nbsp;<span class="op" id="2009310">(</span><span class="ident" id="2009311">p</span>&nbsp;<span class="op" id="2009313">*</span><span class="ident" id="2009314">printer</span><span class="op" id="2009321">)</span>&nbsp;<span class="ident" id="2009323">writeByte</span><span class="op" id="2009332">(</span><span class="ident" id="2009333">ch</span>&nbsp;<span class="builtintype" id="2009336">byte</span><span class="op" id="2009340">,</span>&nbsp;<span class="ident" id="2009342">n</span>&nbsp;<span class="builtintype" id="2009344">int</span><span class="op" id="2009347">)</span>&nbsp;<span class="op" id="2009349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2009352">if</span>&nbsp;<span class="ident" id="2009355">p</span><span class="op" id="2009356">.</span><span class="ident" id="2009357">out</span><span class="op" id="2009360">.</span><span class="ident" id="2009361">Column</span>&nbsp;<span class="op" id="2009368">==</span>&nbsp;<span class="num" id="2009371">1</span>&nbsp;<span class="op" id="2009373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009377">p</span><span class="op" id="2009378">.</span><span class="ident" id="2009379">atLineBegin</span><span class="op" id="2009390">(</span><span class="ident" id="2009391">p</span><span class="op" id="2009392">.</span><span class="ident" id="2009393">pos</span><span class="op" id="2009396">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2009399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2009403">for</span>&nbsp;<span class="ident" id="2009407">i</span>&nbsp;<span class="op" id="2009409">:=</span>&nbsp;<span class="num" id="2009412">0</span><span class="op" id="2009413">;</span>&nbsp;<span class="ident" id="2009415">i</span>&nbsp;<span class="op" id="2009417">&lt;</span>&nbsp;<span class="ident" id="2009419">n</span><span class="op" id="2009420">;</span>&nbsp;<span class="ident" id="2009422">i</span><span class="op" id="2009423">++</span>&nbsp;<span class="op" id="2009426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009430">p</span><span class="op" id="2009431">.</span><span class="ident" id="2009432">output</span>&nbsp;<span class="op" id="2009439">=</span>&nbsp;<span class="builtinfunc" id="2009441">append</span><span class="op" id="2009447">(</span><span class="ident" id="2009448">p</span><span class="op" id="2009449">.</span><span class="ident" id="2009450">output</span><span class="op" id="2009456">,</span>&nbsp;<span class="ident" id="2009458">ch</span><span class="op" id="2009460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2009463">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2009467">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009488">p</span><span class="op" id="2009489">.</span><span class="ident" id="2009490">pos</span><span class="op" id="2009493">.</span><span class="ident" id="2009494">Offset</span>&nbsp;<span class="op" id="2009501">+=</span>&nbsp;<span class="ident" id="2009504">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2009507">if</span>&nbsp;<span class="ident" id="2009510">ch</span>&nbsp;<span class="op" id="2009513">==</span>&nbsp;<span class="string" id="2009516">&#39;\n&#39;</span>&nbsp;<span class="op" id="2009521">||</span>&nbsp;<span class="ident" id="2009524">ch</span>&nbsp;<span class="op" id="2009527">==</span>&nbsp;<span class="string" id="2009530">&#39;\f&#39;</span>&nbsp;<span class="op" id="2009535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009539">p</span><span class="op" id="2009540">.</span><span class="ident" id="2009541">pos</span><span class="op" id="2009544">.</span><span class="ident" id="2009545">Line</span>&nbsp;<span class="op" id="2009550">+=</span>&nbsp;<span class="ident" id="2009553">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009557">p</span><span class="op" id="2009558">.</span><span class="ident" id="2009559">out</span><span class="op" id="2009562">.</span><span class="ident" id="2009563">Line</span>&nbsp;<span class="op" id="2009568">+=</span>&nbsp;<span class="ident" id="2009571">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009575">p</span><span class="op" id="2009576">.</span><span class="ident" id="2009577">pos</span><span class="op" id="2009580">.</span><span class="ident" id="2009581">Column</span>&nbsp;<span class="op" id="2009588">=</span>&nbsp;<span class="num" id="2009590">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009594">p</span><span class="op" id="2009595">.</span><span class="ident" id="2009596">out</span><span class="op" id="2009599">.</span><span class="ident" id="2009600">Column</span>&nbsp;<span class="op" id="2009607">=</span>&nbsp;<span class="num" id="2009609">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2009613">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2009621">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009624">p</span><span class="op" id="2009625">.</span><span class="ident" id="2009626">pos</span><span class="op" id="2009629">.</span><span class="ident" id="2009630">Column</span>&nbsp;<span class="op" id="2009637">+=</span>&nbsp;<span class="ident" id="2009640">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009643">p</span><span class="op" id="2009644">.</span><span class="ident" id="2009645">out</span><span class="op" id="2009648">.</span><span class="ident" id="2009649">Column</span>&nbsp;<span class="op" id="2009656">+=</span>&nbsp;<span class="ident" id="2009659">n</span><br>
<span class="lineno"></span><span class="op" id="2009661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2009664">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="2009737">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="2009813">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="2009870">//</span><br>
<span class="lineno"></span><span class="comment" id="2009873">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2009941">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="2010014">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="2010086">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="2010162">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2010235">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="2010270">//</span><br>
<span class="lineno">265</span><span class="keyword" id="2010273">func</span>&nbsp;<span class="op" id="2010278">(</span><span class="ident" id="2010279">p</span>&nbsp;<span class="op" id="2010281">*</span><span class="ident" id="2010282">printer</span><span class="op" id="2010289">)</span>&nbsp;<span class="ident" id="2010291">writeString</span><span class="op" id="2010302">(</span><span class="ident" id="2010303">pos</span>&nbsp;<span class="ident" id="2010307">token</span><span class="op" id="2010312">.</span><span class="ident" id="2010313">Position</span><span class="op" id="2010321">,</span>&nbsp;<span class="ident" id="2010323">s</span>&nbsp;<span class="builtintype" id="2010325">string</span><span class="op" id="2010331">,</span>&nbsp;<span class="ident" id="2010333">isLit</span>&nbsp;<span class="builtintype" id="2010339">bool</span><span class="op" id="2010343">)</span>&nbsp;<span class="op" id="2010345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010348">if</span>&nbsp;<span class="ident" id="2010351">p</span><span class="op" id="2010352">.</span><span class="ident" id="2010353">out</span><span class="op" id="2010356">.</span><span class="ident" id="2010357">Column</span>&nbsp;<span class="op" id="2010364">==</span>&nbsp;<span class="num" id="2010367">1</span>&nbsp;<span class="op" id="2010369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010373">p</span><span class="op" id="2010374">.</span><span class="ident" id="2010375">atLineBegin</span><span class="op" id="2010386">(</span><span class="ident" id="2010387">pos</span><span class="op" id="2010390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2010393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010397">if</span>&nbsp;<span class="ident" id="2010400">pos</span><span class="op" id="2010403">.</span><span class="ident" id="2010404">IsValid</span><span class="op" id="2010411">(</span><span class="op" id="2010412">)</span>&nbsp;<span class="op" id="2010414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010418">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010486">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010549">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010614">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010641">p</span><span class="op" id="2010642">.</span><span class="ident" id="2010643">pos</span>&nbsp;<span class="op" id="2010647">=</span>&nbsp;<span class="ident" id="2010649">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2010654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010658">if</span>&nbsp;<span class="ident" id="2010661">isLit</span>&nbsp;<span class="op" id="2010667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010671">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010728">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010787">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010849">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010871">p</span><span class="op" id="2010872">.</span><span class="ident" id="2010873">output</span>&nbsp;<span class="op" id="2010880">=</span>&nbsp;<span class="builtinfunc" id="2010882">append</span><span class="op" id="2010888">(</span><span class="ident" id="2010889">p</span><span class="op" id="2010890">.</span><span class="ident" id="2010891">output</span><span class="op" id="2010897">,</span>&nbsp;<span class="ident" id="2010899">tabwriter</span><span class="op" id="2010908">.</span><span class="ident" id="2010909">Escape</span><span class="op" id="2010915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2010918">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010922">if</span>&nbsp;<span class="ident" id="2010925">debug</span>&nbsp;<span class="op" id="2010931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010935">p</span><span class="op" id="2010936">.</span><span class="ident" id="2010937">output</span>&nbsp;<span class="op" id="2010944">=</span>&nbsp;<span class="builtinfunc" id="2010946">append</span><span class="op" id="2010952">(</span><span class="ident" id="2010953">p</span><span class="op" id="2010954">.</span><span class="ident" id="2010955">output</span><span class="op" id="2010961">,</span>&nbsp;<span class="ident" id="2010963">fmt</span><span class="op" id="2010966">.</span><span class="ident" id="2010967">Sprintf</span><span class="op" id="2010974">(</span><span class="string" id="2010975">&#34;/*%s*/&#34;</span><span class="op" id="2010983">,</span>&nbsp;<span class="ident" id="2010985">pos</span><span class="op" id="2010988">)</span><span class="op" id="2010989">...</span><span class="op" id="2010992">)</span>&nbsp;<span class="comment" id="2010994">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011022">p</span><span class="op" id="2011023">.</span><span class="ident" id="2011024">output</span>&nbsp;<span class="op" id="2011031">=</span>&nbsp;<span class="builtinfunc" id="2011033">append</span><span class="op" id="2011039">(</span><span class="ident" id="2011040">p</span><span class="op" id="2011041">.</span><span class="ident" id="2011042">output</span><span class="op" id="2011048">,</span>&nbsp;<span class="ident" id="2011050">s</span><span class="op" id="2011051">...</span><span class="op" id="2011054">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2011058">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011079">nlines</span>&nbsp;<span class="op" id="2011086">:=</span>&nbsp;<span class="num" id="2011089">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011092">var</span>&nbsp;<span class="ident" id="2011096">li</span>&nbsp;<span class="builtintype" id="2011099">int</span>&nbsp;<span class="comment" id="2011103">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011150">for</span>&nbsp;<span class="ident" id="2011154">i</span>&nbsp;<span class="op" id="2011156">:=</span>&nbsp;<span class="num" id="2011159">0</span><span class="op" id="2011160">;</span>&nbsp;<span class="ident" id="2011162">i</span>&nbsp;<span class="op" id="2011164">&lt;</span>&nbsp;<span class="builtinfunc" id="2011166">len</span><span class="op" id="2011169">(</span><span class="ident" id="2011170">s</span><span class="op" id="2011171">)</span><span class="op" id="2011172">;</span>&nbsp;<span class="ident" id="2011174">i</span><span class="op" id="2011175">++</span>&nbsp;<span class="op" id="2011178">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2011182">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011242">if</span>&nbsp;<span class="ident" id="2011245">s</span><span class="op" id="2011246">[</span><span class="ident" id="2011247">i</span><span class="op" id="2011248">]</span>&nbsp;<span class="op" id="2011250">==</span>&nbsp;<span class="string" id="2011253">&#39;\n&#39;</span>&nbsp;<span class="op" id="2011258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011263">nlines</span><span class="op" id="2011269">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011275">li</span>&nbsp;<span class="op" id="2011278">=</span>&nbsp;<span class="ident" id="2011280">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011284">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011290">p</span><span class="op" id="2011291">.</span><span class="ident" id="2011292">pos</span><span class="op" id="2011295">.</span><span class="ident" id="2011296">Offset</span>&nbsp;<span class="op" id="2011303">+=</span>&nbsp;<span class="builtinfunc" id="2011306">len</span><span class="op" id="2011309">(</span><span class="ident" id="2011310">s</span><span class="op" id="2011311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011314">if</span>&nbsp;<span class="ident" id="2011317">nlines</span>&nbsp;<span class="op" id="2011324">&gt;</span>&nbsp;<span class="num" id="2011326">0</span>&nbsp;<span class="op" id="2011328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011332">p</span><span class="op" id="2011333">.</span><span class="ident" id="2011334">pos</span><span class="op" id="2011337">.</span><span class="ident" id="2011338">Line</span>&nbsp;<span class="op" id="2011343">+=</span>&nbsp;<span class="ident" id="2011346">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011355">p</span><span class="op" id="2011356">.</span><span class="ident" id="2011357">out</span><span class="op" id="2011360">.</span><span class="ident" id="2011361">Line</span>&nbsp;<span class="op" id="2011366">+=</span>&nbsp;<span class="ident" id="2011369">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011378">c</span>&nbsp;<span class="op" id="2011380">:=</span>&nbsp;<span class="builtinfunc" id="2011383">len</span><span class="op" id="2011386">(</span><span class="ident" id="2011387">s</span><span class="op" id="2011388">)</span>&nbsp;<span class="op" id="2011390">-</span>&nbsp;<span class="ident" id="2011392">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011397">p</span><span class="op" id="2011398">.</span><span class="ident" id="2011399">pos</span><span class="op" id="2011402">.</span><span class="ident" id="2011403">Column</span>&nbsp;<span class="op" id="2011410">=</span>&nbsp;<span class="ident" id="2011412">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011416">p</span><span class="op" id="2011417">.</span><span class="ident" id="2011418">out</span><span class="op" id="2011421">.</span><span class="ident" id="2011422">Column</span>&nbsp;<span class="op" id="2011429">=</span>&nbsp;<span class="ident" id="2011431">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011434">}</span>&nbsp;<span class="keyword" id="2011436">else</span>&nbsp;<span class="op" id="2011441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011445">p</span><span class="op" id="2011446">.</span><span class="ident" id="2011447">pos</span><span class="op" id="2011450">.</span><span class="ident" id="2011451">Column</span>&nbsp;<span class="op" id="2011458">+=</span>&nbsp;<span class="builtinfunc" id="2011461">len</span><span class="op" id="2011464">(</span><span class="ident" id="2011465">s</span><span class="op" id="2011466">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011470">p</span><span class="op" id="2011471">.</span><span class="ident" id="2011472">out</span><span class="op" id="2011475">.</span><span class="ident" id="2011476">Column</span>&nbsp;<span class="op" id="2011483">+=</span>&nbsp;<span class="builtinfunc" id="2011486">len</span><span class="op" id="2011489">(</span><span class="ident" id="2011490">s</span><span class="op" id="2011491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011498">if</span>&nbsp;<span class="ident" id="2011501">isLit</span>&nbsp;<span class="op" id="2011507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011511">p</span><span class="op" id="2011512">.</span><span class="ident" id="2011513">output</span>&nbsp;<span class="op" id="2011520">=</span>&nbsp;<span class="builtinfunc" id="2011522">append</span><span class="op" id="2011528">(</span><span class="ident" id="2011529">p</span><span class="op" id="2011530">.</span><span class="ident" id="2011531">output</span><span class="op" id="2011537">,</span>&nbsp;<span class="ident" id="2011539">tabwriter</span><span class="op" id="2011548">.</span><span class="ident" id="2011549">Escape</span><span class="op" id="2011555">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011562">p</span><span class="op" id="2011563">.</span><span class="ident" id="2011564">last</span>&nbsp;<span class="op" id="2011569">=</span>&nbsp;<span class="ident" id="2011571">p</span><span class="op" id="2011572">.</span><span class="ident" id="2011573">pos</span><br>
<span class="lineno"></span><span class="op" id="2011577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="2011580">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="2011642">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2011704">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="2011760">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="2011822">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="2011885">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="2011945">//</span><br>
<span class="lineno"></span><span class="keyword" id="2011948">func</span>&nbsp;<span class="op" id="2011953">(</span><span class="ident" id="2011954">p</span>&nbsp;<span class="op" id="2011956">*</span><span class="ident" id="2011957">printer</span><span class="op" id="2011964">)</span>&nbsp;<span class="ident" id="2011966">writeCommentPrefix</span><span class="op" id="2011984">(</span><span class="ident" id="2011985">pos</span><span class="op" id="2011988">,</span>&nbsp;<span class="ident" id="2011990">next</span>&nbsp;<span class="ident" id="2011995">token</span><span class="op" id="2012000">.</span><span class="ident" id="2012001">Position</span><span class="op" id="2012009">,</span>&nbsp;<span class="ident" id="2012011">prev</span><span class="op" id="2012015">,</span>&nbsp;<span class="ident" id="2012017">comment</span>&nbsp;<span class="op" id="2012025">*</span><span class="ident" id="2012026">ast</span><span class="op" id="2012029">.</span><span class="ident" id="2012030">Comment</span><span class="op" id="2012037">,</span>&nbsp;<span class="ident" id="2012039">tok</span>&nbsp;<span class="ident" id="2012043">token</span><span class="op" id="2012048">.</span><span class="ident" id="2012049">Token</span><span class="op" id="2012054">)</span>&nbsp;<span class="op" id="2012056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012059">if</span>&nbsp;<span class="builtinfunc" id="2012062">len</span><span class="op" id="2012065">(</span><span class="ident" id="2012066">p</span><span class="op" id="2012067">.</span><span class="ident" id="2012068">output</span><span class="op" id="2012074">)</span>&nbsp;<span class="op" id="2012076">==</span>&nbsp;<span class="num" id="2012079">0</span>&nbsp;<span class="op" id="2012081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012085">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012163">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2012171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012175">if</span>&nbsp;<span class="ident" id="2012178">pos</span><span class="op" id="2012181">.</span><span class="ident" id="2012182">IsValid</span><span class="op" id="2012189">(</span><span class="op" id="2012190">)</span>&nbsp;<span class="op" id="2012192">&amp;&amp;</span>&nbsp;<span class="ident" id="2012195">pos</span><span class="op" id="2012198">.</span><span class="ident" id="2012199">Filename</span>&nbsp;<span class="op" id="2012208">!=</span>&nbsp;<span class="ident" id="2012211">p</span><span class="op" id="2012212">.</span><span class="ident" id="2012213">last</span><span class="op" id="2012217">.</span><span class="ident" id="2012218">Filename</span>&nbsp;<span class="op" id="2012227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012231">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012289">p</span><span class="op" id="2012290">.</span><span class="ident" id="2012291">writeByte</span><span class="op" id="2012300">(</span><span class="string" id="2012301">&#39;\f&#39;</span><span class="op" id="2012305">,</span>&nbsp;<span class="ident" id="2012307">maxNewlines</span><span class="op" id="2012318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012322">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2012330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012334">if</span>&nbsp;<span class="ident" id="2012337">pos</span><span class="op" id="2012340">.</span><span class="ident" id="2012341">Line</span>&nbsp;<span class="op" id="2012346">==</span>&nbsp;<span class="ident" id="2012349">p</span><span class="op" id="2012350">.</span><span class="ident" id="2012351">last</span><span class="op" id="2012355">.</span><span class="ident" id="2012356">Line</span>&nbsp;<span class="op" id="2012361">&amp;&amp;</span>&nbsp;<span class="op" id="2012364">(</span><span class="ident" id="2012365">prev</span>&nbsp;<span class="op" id="2012370">==</span>&nbsp;<span class="ident" id="2012373">nil</span>&nbsp;<span class="op" id="2012377">||</span>&nbsp;<span class="ident" id="2012380">prev</span><span class="op" id="2012384">.</span><span class="ident" id="2012385">Text</span><span class="op" id="2012389">[</span><span class="num" id="2012390">1</span><span class="op" id="2012391">]</span>&nbsp;<span class="op" id="2012393">!=</span>&nbsp;<span class="string" id="2012396">&#39;/&#39;</span><span class="op" id="2012399">)</span>&nbsp;<span class="op" id="2012401">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012405">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012449">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012491">hasSep</span>&nbsp;<span class="op" id="2012498">:=</span>&nbsp;<span class="builtintype" id="2012501">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012509">if</span>&nbsp;<span class="ident" id="2012512">prev</span>&nbsp;<span class="op" id="2012517">==</span>&nbsp;<span class="ident" id="2012520">nil</span>&nbsp;<span class="op" id="2012524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012529">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012568">j</span>&nbsp;<span class="op" id="2012570">:=</span>&nbsp;<span class="num" id="2012573">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012578">for</span>&nbsp;<span class="ident" id="2012582">i</span><span class="op" id="2012583">,</span>&nbsp;<span class="ident" id="2012585">ch</span>&nbsp;<span class="op" id="2012588">:=</span>&nbsp;<span class="keyword" id="2012591">range</span>&nbsp;<span class="ident" id="2012597">p</span><span class="op" id="2012598">.</span><span class="ident" id="2012599">wsbuf</span>&nbsp;<span class="op" id="2012605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012611">switch</span>&nbsp;<span class="ident" id="2012618">ch</span>&nbsp;<span class="op" id="2012621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012627">case</span>&nbsp;<span class="ident" id="2012632">blank</span><span class="op" id="2012637">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012644">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012687">p</span><span class="op" id="2012688">.</span><span class="ident" id="2012689">wsbuf</span><span class="op" id="2012694">[</span><span class="ident" id="2012695">i</span><span class="op" id="2012696">]</span>&nbsp;<span class="op" id="2012698">=</span>&nbsp;<span class="ident" id="2012700">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012712">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012725">case</span>&nbsp;<span class="ident" id="2012730">vtab</span><span class="op" id="2012734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012741">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012783">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012834">hasSep</span>&nbsp;<span class="op" id="2012841">=</span>&nbsp;<span class="builtintype" id="2012843">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012853">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012866">case</span>&nbsp;<span class="ident" id="2012871">indent</span><span class="op" id="2012877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012884">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012918">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2012931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012937">j</span>&nbsp;<span class="op" id="2012939">=</span>&nbsp;<span class="ident" id="2012941">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012947">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2012956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012961">p</span><span class="op" id="2012962">.</span><span class="ident" id="2012963">writeWhitespace</span><span class="op" id="2012978">(</span><span class="ident" id="2012979">j</span><span class="op" id="2012980">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2012984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012988">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013035">if</span>&nbsp;<span class="op" id="2013038">!</span><span class="ident" id="2013039">hasSep</span>&nbsp;<span class="op" id="2013046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013051">sep</span>&nbsp;<span class="op" id="2013055">:=</span>&nbsp;<span class="builtintype" id="2013058">byte</span><span class="op" id="2013062">(</span><span class="string" id="2013063">&#39;\t&#39;</span><span class="op" id="2013067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013072">if</span>&nbsp;<span class="ident" id="2013075">pos</span><span class="op" id="2013078">.</span><span class="ident" id="2013079">Line</span>&nbsp;<span class="op" id="2013084">==</span>&nbsp;<span class="ident" id="2013087">next</span><span class="op" id="2013091">.</span><span class="ident" id="2013092">Line</span>&nbsp;<span class="op" id="2013097">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013103">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013155">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013207">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013244">sep</span>&nbsp;<span class="op" id="2013248">=</span>&nbsp;<span class="string" id="2013250">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2013257">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013262">p</span><span class="op" id="2013263">.</span><span class="ident" id="2013264">writeByte</span><span class="op" id="2013273">(</span><span class="ident" id="2013274">sep</span><span class="op" id="2013277">,</span>&nbsp;<span class="num" id="2013279">1</span><span class="op" id="2013280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2013284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2013288">}</span>&nbsp;<span class="keyword" id="2013290">else</span>&nbsp;<span class="op" id="2013295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013299">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013333">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013376">droppedLinebreak</span>&nbsp;<span class="op" id="2013393">:=</span>&nbsp;<span class="builtintype" id="2013396">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013404">j</span>&nbsp;<span class="op" id="2013406">:=</span>&nbsp;<span class="num" id="2013409">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013413">for</span>&nbsp;<span class="ident" id="2013417">i</span><span class="op" id="2013418">,</span>&nbsp;<span class="ident" id="2013420">ch</span>&nbsp;<span class="op" id="2013423">:=</span>&nbsp;<span class="keyword" id="2013426">range</span>&nbsp;<span class="ident" id="2013432">p</span><span class="op" id="2013433">.</span><span class="ident" id="2013434">wsbuf</span>&nbsp;<span class="op" id="2013440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013445">switch</span>&nbsp;<span class="ident" id="2013452">ch</span>&nbsp;<span class="op" id="2013455">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013460">case</span>&nbsp;<span class="ident" id="2013465">blank</span><span class="op" id="2013470">,</span>&nbsp;<span class="ident" id="2013472">vtab</span><span class="op" id="2013476">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013482">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013541">p</span><span class="op" id="2013542">.</span><span class="ident" id="2013543">wsbuf</span><span class="op" id="2013548">[</span><span class="ident" id="2013549">i</span><span class="op" id="2013550">]</span>&nbsp;<span class="op" id="2013552">=</span>&nbsp;<span class="ident" id="2013554">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013565">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013577">case</span>&nbsp;<span class="ident" id="2013582">indent</span><span class="op" id="2013588">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013594">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013627">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013639">case</span>&nbsp;<span class="ident" id="2013644">unindent</span><span class="op" id="2013652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013658">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013708">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013755">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013809">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013851">if</span>&nbsp;<span class="ident" id="2013854">i</span><span class="op" id="2013855">+</span><span class="num" id="2013856">1</span>&nbsp;<span class="op" id="2013858">&lt;</span>&nbsp;<span class="builtinfunc" id="2013860">len</span><span class="op" id="2013863">(</span><span class="ident" id="2013864">p</span><span class="op" id="2013865">.</span><span class="ident" id="2013866">wsbuf</span><span class="op" id="2013871">)</span>&nbsp;<span class="op" id="2013873">&amp;&amp;</span>&nbsp;<span class="ident" id="2013876">p</span><span class="op" id="2013877">.</span><span class="ident" id="2013878">wsbuf</span><span class="op" id="2013883">[</span><span class="ident" id="2013884">i</span><span class="op" id="2013885">+</span><span class="num" id="2013886">1</span><span class="op" id="2013887">]</span>&nbsp;<span class="op" id="2013889">==</span>&nbsp;<span class="ident" id="2013892">unindent</span>&nbsp;<span class="op" id="2013901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013908">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2013921">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013927">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013991">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014049">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014106">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014164">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014219">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014277">if</span>&nbsp;<span class="ident" id="2014280">tok</span>&nbsp;<span class="op" id="2014284">!=</span>&nbsp;<span class="ident" id="2014287">token</span><span class="op" id="2014292">.</span><span class="ident" id="2014293">RBRACE</span>&nbsp;<span class="op" id="2014300">&amp;&amp;</span>&nbsp;<span class="ident" id="2014303">pos</span><span class="op" id="2014306">.</span><span class="ident" id="2014307">Column</span>&nbsp;<span class="op" id="2014314">==</span>&nbsp;<span class="ident" id="2014317">next</span><span class="op" id="2014321">.</span><span class="ident" id="2014322">Column</span>&nbsp;<span class="op" id="2014329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014336">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2014349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014354">case</span>&nbsp;<span class="ident" id="2014359">newline</span><span class="op" id="2014366">,</span>&nbsp;<span class="ident" id="2014368">formfeed</span><span class="op" id="2014376">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014382">p</span><span class="op" id="2014383">.</span><span class="ident" id="2014384">wsbuf</span><span class="op" id="2014389">[</span><span class="ident" id="2014390">i</span><span class="op" id="2014391">]</span>&nbsp;<span class="op" id="2014393">=</span>&nbsp;<span class="ident" id="2014395">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014406">droppedLinebreak</span>&nbsp;<span class="op" id="2014423">=</span>&nbsp;<span class="ident" id="2014425">prev</span>&nbsp;<span class="op" id="2014430">==</span>&nbsp;<span class="ident" id="2014433">nil</span>&nbsp;<span class="comment" id="2014437">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2014483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014488">j</span>&nbsp;<span class="op" id="2014490">=</span>&nbsp;<span class="ident" id="2014492">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014497">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2014505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014509">p</span><span class="op" id="2014510">.</span><span class="ident" id="2014511">writeWhitespace</span><span class="op" id="2014526">(</span><span class="ident" id="2014527">j</span><span class="op" id="2014528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014533">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014588">n</span>&nbsp;<span class="op" id="2014590">:=</span>&nbsp;<span class="num" id="2014593">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014597">if</span>&nbsp;<span class="ident" id="2014600">pos</span><span class="op" id="2014603">.</span><span class="ident" id="2014604">IsValid</span><span class="op" id="2014611">(</span><span class="op" id="2014612">)</span>&nbsp;<span class="op" id="2014614">&amp;&amp;</span>&nbsp;<span class="ident" id="2014617">p</span><span class="op" id="2014618">.</span><span class="ident" id="2014619">last</span><span class="op" id="2014623">.</span><span class="ident" id="2014624">IsValid</span><span class="op" id="2014631">(</span><span class="op" id="2014632">)</span>&nbsp;<span class="op" id="2014634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014639">n</span>&nbsp;<span class="op" id="2014641">=</span>&nbsp;<span class="ident" id="2014643">pos</span><span class="op" id="2014646">.</span><span class="ident" id="2014647">Line</span>&nbsp;<span class="op" id="2014652">-</span>&nbsp;<span class="ident" id="2014654">p</span><span class="op" id="2014655">.</span><span class="ident" id="2014656">last</span><span class="op" id="2014660">.</span><span class="ident" id="2014661">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014669">if</span>&nbsp;<span class="ident" id="2014672">n</span>&nbsp;<span class="op" id="2014674">&lt;</span>&nbsp;<span class="num" id="2014676">0</span>&nbsp;<span class="op" id="2014678">{</span>&nbsp;<span class="comment" id="2014680">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014707">n</span>&nbsp;<span class="op" id="2014709">=</span>&nbsp;<span class="num" id="2014711">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2014716">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2014720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014725">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014779">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014831">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014885">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014939">if</span>&nbsp;<span class="ident" id="2014942">p</span><span class="op" id="2014943">.</span><span class="ident" id="2014944">indent</span>&nbsp;<span class="op" id="2014951">==</span>&nbsp;<span class="num" id="2014954">0</span>&nbsp;<span class="op" id="2014956">&amp;&amp;</span>&nbsp;<span class="ident" id="2014959">droppedLinebreak</span>&nbsp;<span class="op" id="2014976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014981">n</span><span class="op" id="2014982">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2014987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014992">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015040">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015088">if</span>&nbsp;<span class="ident" id="2015091">n</span>&nbsp;<span class="op" id="2015093">==</span>&nbsp;<span class="num" id="2015096">0</span>&nbsp;<span class="op" id="2015098">&amp;&amp;</span>&nbsp;<span class="ident" id="2015101">prev</span>&nbsp;<span class="op" id="2015106">!=</span>&nbsp;<span class="ident" id="2015109">nil</span>&nbsp;<span class="op" id="2015113">&amp;&amp;</span>&nbsp;<span class="ident" id="2015116">prev</span><span class="op" id="2015120">.</span><span class="ident" id="2015121">Text</span><span class="op" id="2015125">[</span><span class="num" id="2015126">1</span><span class="op" id="2015127">]</span>&nbsp;<span class="op" id="2015129">==</span>&nbsp;<span class="string" id="2015132">&#39;/&#39;</span>&nbsp;<span class="op" id="2015136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015141">n</span>&nbsp;<span class="op" id="2015143">=</span>&nbsp;<span class="num" id="2015145">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015149">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015154">if</span>&nbsp;<span class="ident" id="2015157">n</span>&nbsp;<span class="op" id="2015159">&gt;</span>&nbsp;<span class="num" id="2015161">0</span>&nbsp;<span class="op" id="2015163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015168">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015223">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015278">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015322">p</span><span class="op" id="2015323">.</span><span class="ident" id="2015324">writeByte</span><span class="op" id="2015333">(</span><span class="string" id="2015334">&#39;\f&#39;</span><span class="op" id="2015338">,</span>&nbsp;<span class="ident" id="2015340">nlimit</span><span class="op" id="2015346">(</span><span class="ident" id="2015347">n</span><span class="op" id="2015348">)</span><span class="op" id="2015349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015356">}</span><br>
<span class="lineno"></span><span class="op" id="2015358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="2015361">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="2015408">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="2015471">//</span><br>
<span class="lineno"></span><span class="keyword" id="2015474">func</span>&nbsp;<span class="ident" id="2015479">isBlank</span><span class="op" id="2015486">(</span><span class="ident" id="2015487">s</span>&nbsp;<span class="builtintype" id="2015489">string</span><span class="op" id="2015495">)</span>&nbsp;<span class="builtintype" id="2015497">bool</span>&nbsp;<span class="op" id="2015502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015505">for</span>&nbsp;<span class="ident" id="2015509">i</span>&nbsp;<span class="op" id="2015511">:=</span>&nbsp;<span class="num" id="2015514">0</span><span class="op" id="2015515">;</span>&nbsp;<span class="ident" id="2015517">i</span>&nbsp;<span class="op" id="2015519">&lt;</span>&nbsp;<span class="builtinfunc" id="2015521">len</span><span class="op" id="2015524">(</span><span class="ident" id="2015525">s</span><span class="op" id="2015526">)</span><span class="op" id="2015527">;</span>&nbsp;<span class="ident" id="2015529">i</span><span class="op" id="2015530">++</span>&nbsp;<span class="op" id="2015533">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015537">if</span>&nbsp;<span class="ident" id="2015540">s</span><span class="op" id="2015541">[</span><span class="ident" id="2015542">i</span><span class="op" id="2015543">]</span>&nbsp;<span class="op" id="2015545">&gt;</span>&nbsp;<span class="string" id="2015547">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2015551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015556">return</span>&nbsp;<span class="builtintype" id="2015563">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015577">return</span>&nbsp;<span class="builtintype" id="2015584">true</span><br>
<span class="lineno">460</span><span class="op" id="2015589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2015592">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="2015646">func</span>&nbsp;<span class="ident" id="2015651">commonPrefix</span><span class="op" id="2015663">(</span><span class="ident" id="2015664">a</span><span class="op" id="2015665">,</span>&nbsp;<span class="ident" id="2015667">b</span>&nbsp;<span class="builtintype" id="2015669">string</span><span class="op" id="2015675">)</span>&nbsp;<span class="builtintype" id="2015677">string</span>&nbsp;<span class="op" id="2015684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015687">i</span>&nbsp;<span class="op" id="2015689">:=</span>&nbsp;<span class="num" id="2015692">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015695">for</span>&nbsp;<span class="ident" id="2015699">i</span>&nbsp;<span class="op" id="2015701">&lt;</span>&nbsp;<span class="builtinfunc" id="2015703">len</span><span class="op" id="2015706">(</span><span class="ident" id="2015707">a</span><span class="op" id="2015708">)</span>&nbsp;<span class="op" id="2015710">&amp;&amp;</span>&nbsp;<span class="ident" id="2015713">i</span>&nbsp;<span class="op" id="2015715">&lt;</span>&nbsp;<span class="builtinfunc" id="2015717">len</span><span class="op" id="2015720">(</span><span class="ident" id="2015721">b</span><span class="op" id="2015722">)</span>&nbsp;<span class="op" id="2015724">&amp;&amp;</span>&nbsp;<span class="ident" id="2015727">a</span><span class="op" id="2015728">[</span><span class="ident" id="2015729">i</span><span class="op" id="2015730">]</span>&nbsp;<span class="op" id="2015732">==</span>&nbsp;<span class="ident" id="2015735">b</span><span class="op" id="2015736">[</span><span class="ident" id="2015737">i</span><span class="op" id="2015738">]</span>&nbsp;<span class="op" id="2015740">&amp;&amp;</span>&nbsp;<span class="op" id="2015743">(</span><span class="ident" id="2015744">a</span><span class="op" id="2015745">[</span><span class="ident" id="2015746">i</span><span class="op" id="2015747">]</span>&nbsp;<span class="op" id="2015749">&lt;=</span>&nbsp;<span class="string" id="2015752">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2015756">||</span>&nbsp;<span class="ident" id="2015759">a</span><span class="op" id="2015760">[</span><span class="ident" id="2015761">i</span><span class="op" id="2015762">]</span>&nbsp;<span class="op" id="2015764">==</span>&nbsp;<span class="string" id="2015767">&#39;*&#39;</span><span class="op" id="2015770">)</span>&nbsp;<span class="op" id="2015772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015776">i</span><span class="op" id="2015777">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015784">return</span>&nbsp;<span class="ident" id="2015791">a</span><span class="op" id="2015792">[</span><span class="num" id="2015793">0</span><span class="op" id="2015794">:</span><span class="ident" id="2015795">i</span><span class="op" id="2015796">]</span><br>
<span class="lineno"></span><span class="op" id="2015798">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="2015801">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2015858">func</span>&nbsp;<span class="ident" id="2015863">trimRight</span><span class="op" id="2015872">(</span><span class="ident" id="2015873">s</span>&nbsp;<span class="builtintype" id="2015875">string</span><span class="op" id="2015881">)</span>&nbsp;<span class="builtintype" id="2015883">string</span>&nbsp;<span class="op" id="2015890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015893">return</span>&nbsp;<span class="ident" id="2015900">strings</span><span class="op" id="2015907">.</span><span class="ident" id="2015908">TrimRightFunc</span><span class="op" id="2015921">(</span><span class="ident" id="2015922">s</span><span class="op" id="2015923">,</span>&nbsp;<span class="ident" id="2015925">unicode</span><span class="op" id="2015932">.</span><span class="ident" id="2015933">IsSpace</span><span class="op" id="2015940">)</span><br>
<span class="lineno"></span><span class="op" id="2015942">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="2015945">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="2016029">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="2016114">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="2016194">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="2016274">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="2016298">//</span><br>
<span class="lineno"></span><span class="keyword" id="2016301">func</span>&nbsp;<span class="ident" id="2016306">stripCommonPrefix</span><span class="op" id="2016323">(</span><span class="ident" id="2016324">lines</span>&nbsp;<span class="op" id="2016330">[</span><span class="op" id="2016331">]</span><span class="builtintype" id="2016332">string</span><span class="op" id="2016338">)</span>&nbsp;<span class="op" id="2016340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016343">if</span>&nbsp;<span class="builtinfunc" id="2016346">len</span><span class="op" id="2016349">(</span><span class="ident" id="2016350">lines</span><span class="op" id="2016355">)</span>&nbsp;<span class="op" id="2016357">&lt;=</span>&nbsp;<span class="num" id="2016360">1</span>&nbsp;<span class="op" id="2016362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016366">return</span>&nbsp;<span class="comment" id="2016373">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016413">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016433">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016490">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016547">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016601">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016659">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016717">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016775">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016816">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016878">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016940">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017001">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017062">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017122">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017136">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017140">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017200">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017260">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017314">var</span>&nbsp;<span class="ident" id="2017318">prefix</span>&nbsp;<span class="builtintype" id="2017325">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017333">if</span>&nbsp;<span class="builtinfunc" id="2017336">len</span><span class="op" id="2017339">(</span><span class="ident" id="2017340">lines</span><span class="op" id="2017345">)</span>&nbsp;<span class="op" id="2017347">&gt;</span>&nbsp;<span class="num" id="2017349">2</span>&nbsp;<span class="op" id="2017351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017355">first</span>&nbsp;<span class="op" id="2017361">:=</span>&nbsp;<span class="builtintype" id="2017364">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017371">for</span>&nbsp;<span class="ident" id="2017375">i</span><span class="op" id="2017376">,</span>&nbsp;<span class="ident" id="2017378">line</span>&nbsp;<span class="op" id="2017383">:=</span>&nbsp;<span class="keyword" id="2017386">range</span>&nbsp;<span class="ident" id="2017392">lines</span><span class="op" id="2017397">[</span><span class="num" id="2017398">1</span>&nbsp;<span class="op" id="2017400">:</span>&nbsp;<span class="builtinfunc" id="2017402">len</span><span class="op" id="2017405">(</span><span class="ident" id="2017406">lines</span><span class="op" id="2017411">)</span><span class="op" id="2017412">-</span><span class="num" id="2017413">1</span><span class="op" id="2017414">]</span>&nbsp;<span class="op" id="2017416">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017421">switch</span>&nbsp;<span class="op" id="2017428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017433">case</span>&nbsp;<span class="ident" id="2017438">isBlank</span><span class="op" id="2017445">(</span><span class="ident" id="2017446">line</span><span class="op" id="2017450">)</span><span class="op" id="2017451">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017457">lines</span><span class="op" id="2017462">[</span><span class="num" id="2017463">1</span><span class="op" id="2017464">+</span><span class="ident" id="2017465">i</span><span class="op" id="2017466">]</span>&nbsp;<span class="op" id="2017468">=</span>&nbsp;<span class="string" id="2017470">&#34;&#34;</span>&nbsp;<span class="comment" id="2017473">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017506">case</span>&nbsp;<span class="ident" id="2017511">first</span><span class="op" id="2017516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017522">prefix</span>&nbsp;<span class="op" id="2017529">=</span>&nbsp;<span class="ident" id="2017531">commonPrefix</span><span class="op" id="2017543">(</span><span class="ident" id="2017544">line</span><span class="op" id="2017548">,</span>&nbsp;<span class="ident" id="2017550">line</span><span class="op" id="2017554">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017560">first</span>&nbsp;<span class="op" id="2017566">=</span>&nbsp;<span class="builtintype" id="2017568">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017577">default</span><span class="op" id="2017584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017590">prefix</span>&nbsp;<span class="op" id="2017597">=</span>&nbsp;<span class="ident" id="2017599">commonPrefix</span><span class="op" id="2017611">(</span><span class="ident" id="2017612">prefix</span><span class="op" id="2017618">,</span>&nbsp;<span class="ident" id="2017620">line</span><span class="op" id="2017624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017633">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017636">}</span>&nbsp;<span class="keyword" id="2017638">else</span>&nbsp;<span class="op" id="2017643">{</span>&nbsp;<span class="comment" id="2017645">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017709">line</span>&nbsp;<span class="op" id="2017714">:=</span>&nbsp;<span class="ident" id="2017717">lines</span><span class="op" id="2017722">[</span><span class="num" id="2017723">1</span><span class="op" id="2017724">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017728">prefix</span>&nbsp;<span class="op" id="2017735">=</span>&nbsp;<span class="ident" id="2017737">commonPrefix</span><span class="op" id="2017749">(</span><span class="ident" id="2017750">line</span><span class="op" id="2017754">,</span>&nbsp;<span class="ident" id="2017756">line</span><span class="op" id="2017760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017767">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017847">lineOfStars</span>&nbsp;<span class="op" id="2017859">:=</span>&nbsp;<span class="builtintype" id="2017862">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017869">if</span>&nbsp;<span class="ident" id="2017872">i</span>&nbsp;<span class="op" id="2017874">:=</span>&nbsp;<span class="ident" id="2017877">strings</span><span class="op" id="2017884">.</span><span class="ident" id="2017885">Index</span><span class="op" id="2017890">(</span><span class="ident" id="2017891">prefix</span><span class="op" id="2017897">,</span>&nbsp;<span class="string" id="2017899">&#34;*&#34;</span><span class="op" id="2017902">)</span><span class="op" id="2017903">;</span>&nbsp;<span class="ident" id="2017905">i</span>&nbsp;<span class="op" id="2017907">&gt;=</span>&nbsp;<span class="num" id="2017910">0</span>&nbsp;<span class="op" id="2017912">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017916">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017944">if</span>&nbsp;<span class="ident" id="2017947">i</span>&nbsp;<span class="op" id="2017949">&gt;</span>&nbsp;<span class="num" id="2017951">0</span>&nbsp;<span class="op" id="2017953">&amp;&amp;</span>&nbsp;<span class="ident" id="2017956">prefix</span><span class="op" id="2017962">[</span><span class="ident" id="2017963">i</span><span class="op" id="2017964">-</span><span class="num" id="2017965">1</span><span class="op" id="2017966">]</span>&nbsp;<span class="op" id="2017968">==</span>&nbsp;<span class="string" id="2017971">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2017975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017980">i</span><span class="op" id="2017981">--</span>&nbsp;<span class="comment" id="2017984">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018051">prefix</span>&nbsp;<span class="op" id="2018058">=</span>&nbsp;<span class="ident" id="2018060">prefix</span><span class="op" id="2018066">[</span><span class="num" id="2018067">0</span><span class="op" id="2018068">:</span><span class="ident" id="2018069">i</span><span class="op" id="2018070">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018074">lineOfStars</span>&nbsp;<span class="op" id="2018086">=</span>&nbsp;<span class="builtintype" id="2018088">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018094">}</span>&nbsp;<span class="keyword" id="2018096">else</span>&nbsp;<span class="op" id="2018101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018105">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018136">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018198">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018260">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018323">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018384">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018446">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018507">first</span>&nbsp;<span class="op" id="2018513">:=</span>&nbsp;<span class="ident" id="2018516">lines</span><span class="op" id="2018521">[</span><span class="num" id="2018522">0</span><span class="op" id="2018523">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018527">if</span>&nbsp;<span class="ident" id="2018530">isBlank</span><span class="op" id="2018537">(</span><span class="ident" id="2018538">first</span><span class="op" id="2018543">[</span><span class="num" id="2018544">2</span><span class="op" id="2018545">:</span><span class="op" id="2018546">]</span><span class="op" id="2018547">)</span>&nbsp;<span class="op" id="2018549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018554">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018595">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018642">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018694">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018747">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018772">i</span>&nbsp;<span class="op" id="2018774">:=</span>&nbsp;<span class="builtinfunc" id="2018777">len</span><span class="op" id="2018780">(</span><span class="ident" id="2018781">prefix</span><span class="op" id="2018787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018792">for</span>&nbsp;<span class="ident" id="2018796">n</span>&nbsp;<span class="op" id="2018798">:=</span>&nbsp;<span class="num" id="2018801">0</span><span class="op" id="2018802">;</span>&nbsp;<span class="ident" id="2018804">n</span>&nbsp;<span class="op" id="2018806">&lt;</span>&nbsp;<span class="num" id="2018808">3</span>&nbsp;<span class="op" id="2018810">&amp;&amp;</span>&nbsp;<span class="ident" id="2018813">i</span>&nbsp;<span class="op" id="2018815">&gt;</span>&nbsp;<span class="num" id="2018817">0</span>&nbsp;<span class="op" id="2018819">&amp;&amp;</span>&nbsp;<span class="ident" id="2018822">prefix</span><span class="op" id="2018828">[</span><span class="ident" id="2018829">i</span><span class="op" id="2018830">-</span><span class="num" id="2018831">1</span><span class="op" id="2018832">]</span>&nbsp;<span class="op" id="2018834">==</span>&nbsp;<span class="string" id="2018837">&#39;&nbsp;&#39;</span><span class="op" id="2018840">;</span>&nbsp;<span class="ident" id="2018842">n</span><span class="op" id="2018843">++</span>&nbsp;<span class="op" id="2018846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018852">i</span><span class="op" id="2018853">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018859">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018864">if</span>&nbsp;<span class="ident" id="2018867">i</span>&nbsp;<span class="op" id="2018869">==</span>&nbsp;<span class="builtinfunc" id="2018872">len</span><span class="op" id="2018875">(</span><span class="ident" id="2018876">prefix</span><span class="op" id="2018882">)</span>&nbsp;<span class="op" id="2018884">&amp;&amp;</span>&nbsp;<span class="ident" id="2018887">i</span>&nbsp;<span class="op" id="2018889">&gt;</span>&nbsp;<span class="num" id="2018891">0</span>&nbsp;<span class="op" id="2018893">&amp;&amp;</span>&nbsp;<span class="ident" id="2018896">prefix</span><span class="op" id="2018902">[</span><span class="ident" id="2018903">i</span><span class="op" id="2018904">-</span><span class="num" id="2018905">1</span><span class="op" id="2018906">]</span>&nbsp;<span class="op" id="2018908">==</span>&nbsp;<span class="string" id="2018911">&#39;\t&#39;</span>&nbsp;<span class="op" id="2018916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018922">i</span><span class="op" id="2018923">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018934">prefix</span>&nbsp;<span class="op" id="2018941">=</span>&nbsp;<span class="ident" id="2018943">prefix</span><span class="op" id="2018949">[</span><span class="num" id="2018950">0</span><span class="op" id="2018951">:</span><span class="ident" id="2018952">i</span><span class="op" id="2018953">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018957">}</span>&nbsp;<span class="keyword" id="2018959">else</span>&nbsp;<span class="op" id="2018964">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018969">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019006">suffix</span>&nbsp;<span class="op" id="2019013">:=</span>&nbsp;<span class="builtinfunc" id="2019016">make</span><span class="op" id="2019020">(</span><span class="op" id="2019021">[</span><span class="op" id="2019022">]</span><span class="builtintype" id="2019023">byte</span><span class="op" id="2019027">,</span>&nbsp;<span class="builtinfunc" id="2019029">len</span><span class="op" id="2019032">(</span><span class="ident" id="2019033">first</span><span class="op" id="2019038">)</span><span class="op" id="2019039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019044">n</span>&nbsp;<span class="op" id="2019046">:=</span>&nbsp;<span class="num" id="2019049">2</span>&nbsp;<span class="comment" id="2019051">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2019080">for</span>&nbsp;<span class="ident" id="2019084">n</span>&nbsp;<span class="op" id="2019086">&lt;</span>&nbsp;<span class="builtinfunc" id="2019088">len</span><span class="op" id="2019091">(</span><span class="ident" id="2019092">first</span><span class="op" id="2019097">)</span>&nbsp;<span class="op" id="2019099">&amp;&amp;</span>&nbsp;<span class="ident" id="2019102">first</span><span class="op" id="2019107">[</span><span class="ident" id="2019108">n</span><span class="op" id="2019109">]</span>&nbsp;<span class="op" id="2019111">&lt;=</span>&nbsp;<span class="string" id="2019114">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2019118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019124">suffix</span><span class="op" id="2019130">[</span><span class="ident" id="2019131">n</span><span class="op" id="2019132">]</span>&nbsp;<span class="op" id="2019134">=</span>&nbsp;<span class="ident" id="2019136">first</span><span class="op" id="2019141">[</span><span class="ident" id="2019142">n</span><span class="op" id="2019143">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019149">n</span><span class="op" id="2019150">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2019161">if</span>&nbsp;<span class="ident" id="2019164">n</span>&nbsp;<span class="op" id="2019166">&gt;</span>&nbsp;<span class="num" id="2019168">2</span>&nbsp;<span class="op" id="2019170">&amp;&amp;</span>&nbsp;<span class="ident" id="2019173">suffix</span><span class="op" id="2019179">[</span><span class="num" id="2019180">2</span><span class="op" id="2019181">]</span>&nbsp;<span class="op" id="2019183">==</span>&nbsp;<span class="string" id="2019186">&#39;\t&#39;</span>&nbsp;<span class="op" id="2019191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2019197">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019243">suffix</span>&nbsp;<span class="op" id="2019250">=</span>&nbsp;<span class="ident" id="2019252">suffix</span><span class="op" id="2019258">[</span><span class="num" id="2019259">2</span><span class="op" id="2019260">:</span><span class="ident" id="2019261">n</span><span class="op" id="2019262">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019267">}</span>&nbsp;<span class="keyword" id="2019269">else</span>&nbsp;<span class="op" id="2019274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2019280">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019315">suffix</span><span class="op" id="2019321">[</span><span class="num" id="2019322">0</span><span class="op" id="2019323">]</span><span class="op" id="2019324">,</span>&nbsp;<span class="ident" id="2019326">suffix</span><span class="op" id="2019332">[</span><span class="num" id="2019333">1</span><span class="op" id="2019334">]</span>&nbsp;<span class="op" id="2019336">=</span>&nbsp;<span class="string" id="2019338">&#39;&nbsp;&#39;</span><span class="op" id="2019341">,</span>&nbsp;<span class="string" id="2019343">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019351">suffix</span>&nbsp;<span class="op" id="2019358">=</span>&nbsp;<span class="ident" id="2019360">suffix</span><span class="op" id="2019366">[</span><span class="num" id="2019367">0</span><span class="op" id="2019368">:</span><span class="ident" id="2019369">n</span><span class="op" id="2019370">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019375">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2019380">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2019438">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019492">prefix</span>&nbsp;<span class="op" id="2019499">=</span>&nbsp;<span class="ident" id="2019501">strings</span><span class="op" id="2019508">.</span><span class="ident" id="2019509">TrimSuffix</span><span class="op" id="2019519">(</span><span class="ident" id="2019520">prefix</span><span class="op" id="2019526">,</span>&nbsp;<span class="builtintype" id="2019528">string</span><span class="op" id="2019534">(</span><span class="ident" id="2019535">suffix</span><span class="op" id="2019541">)</span><span class="op" id="2019542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019549">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2019553">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2019618">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2019683">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019694">last</span>&nbsp;<span class="op" id="2019699">:=</span>&nbsp;<span class="ident" id="2019702">lines</span><span class="op" id="2019707">[</span><span class="builtinfunc" id="2019708">len</span><span class="op" id="2019711">(</span><span class="ident" id="2019712">lines</span><span class="op" id="2019717">)</span><span class="op" id="2019718">-</span><span class="num" id="2019719">1</span><span class="op" id="2019720">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019723">closing</span>&nbsp;<span class="op" id="2019731">:=</span>&nbsp;<span class="string" id="2019734">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019740">i</span>&nbsp;<span class="op" id="2019742">:=</span>&nbsp;<span class="ident" id="2019745">strings</span><span class="op" id="2019752">.</span><span class="ident" id="2019753">Index</span><span class="op" id="2019758">(</span><span class="ident" id="2019759">last</span><span class="op" id="2019763">,</span>&nbsp;<span class="ident" id="2019765">closing</span><span class="op" id="2019772">)</span>&nbsp;<span class="comment" id="2019774">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2019813">if</span>&nbsp;<span class="ident" id="2019816">isBlank</span><span class="op" id="2019823">(</span><span class="ident" id="2019824">last</span><span class="op" id="2019828">[</span><span class="num" id="2019829">0</span><span class="op" id="2019830">:</span><span class="ident" id="2019831">i</span><span class="op" id="2019832">]</span><span class="op" id="2019833">)</span>&nbsp;<span class="op" id="2019835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2019839">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2019879">if</span>&nbsp;<span class="ident" id="2019882">lineOfStars</span>&nbsp;<span class="op" id="2019894">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019899">closing</span>&nbsp;<span class="op" id="2019907">=</span>&nbsp;<span class="string" id="2019909">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="2019915">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019954">lines</span><span class="op" id="2019959">[</span><span class="builtinfunc" id="2019960">len</span><span class="op" id="2019963">(</span><span class="ident" id="2019964">lines</span><span class="op" id="2019969">)</span><span class="op" id="2019970">-</span><span class="num" id="2019971">1</span><span class="op" id="2019972">]</span>&nbsp;<span class="op" id="2019974">=</span>&nbsp;<span class="ident" id="2019976">prefix</span>&nbsp;<span class="op" id="2019983">+</span>&nbsp;<span class="ident" id="2019985">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019994">}</span>&nbsp;<span class="keyword" id="2019996">else</span>&nbsp;<span class="op" id="2020001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2020005">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2020056">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2020108">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020135">prefix</span>&nbsp;<span class="op" id="2020142">=</span>&nbsp;<span class="ident" id="2020144">commonPrefix</span><span class="op" id="2020156">(</span><span class="ident" id="2020157">prefix</span><span class="op" id="2020163">,</span>&nbsp;<span class="ident" id="2020165">last</span><span class="op" id="2020169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2020172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2020176">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020245">for</span>&nbsp;<span class="ident" id="2020249">i</span><span class="op" id="2020250">,</span>&nbsp;<span class="ident" id="2020252">line</span>&nbsp;<span class="op" id="2020257">:=</span>&nbsp;<span class="keyword" id="2020260">range</span>&nbsp;<span class="ident" id="2020266">lines</span>&nbsp;<span class="op" id="2020272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020276">if</span>&nbsp;<span class="ident" id="2020279">i</span>&nbsp;<span class="op" id="2020281">&gt;</span>&nbsp;<span class="num" id="2020283">0</span>&nbsp;<span class="op" id="2020285">&amp;&amp;</span>&nbsp;<span class="ident" id="2020288">line</span>&nbsp;<span class="op" id="2020293">!=</span>&nbsp;<span class="string" id="2020296">&#34;&#34;</span>&nbsp;<span class="op" id="2020299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020304">lines</span><span class="op" id="2020309">[</span><span class="ident" id="2020310">i</span><span class="op" id="2020311">]</span>&nbsp;<span class="op" id="2020313">=</span>&nbsp;<span class="ident" id="2020315">line</span><span class="op" id="2020319">[</span><span class="builtinfunc" id="2020320">len</span><span class="op" id="2020323">(</span><span class="ident" id="2020324">prefix</span><span class="op" id="2020330">)</span><span class="op" id="2020331">:</span><span class="op" id="2020332">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2020336">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2020339">}</span><br>
<span class="lineno"></span><span class="op" id="2020341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2020344">func</span>&nbsp;<span class="op" id="2020349">(</span><span class="ident" id="2020350">p</span>&nbsp;<span class="op" id="2020352">*</span><span class="ident" id="2020353">printer</span><span class="op" id="2020360">)</span>&nbsp;<span class="ident" id="2020362">writeComment</span><span class="op" id="2020374">(</span><span class="ident" id="2020375">comment</span>&nbsp;<span class="op" id="2020383">*</span><span class="ident" id="2020384">ast</span><span class="op" id="2020387">.</span><span class="ident" id="2020388">Comment</span><span class="op" id="2020395">)</span>&nbsp;<span class="op" id="2020397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020400">text</span>&nbsp;<span class="op" id="2020405">:=</span>&nbsp;<span class="ident" id="2020408">comment</span><span class="op" id="2020415">.</span><span class="ident" id="2020416">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020422">pos</span>&nbsp;<span class="op" id="2020426">:=</span>&nbsp;<span class="ident" id="2020429">p</span><span class="op" id="2020430">.</span><span class="ident" id="2020431">posFor</span><span class="op" id="2020437">(</span><span class="ident" id="2020438">comment</span><span class="op" id="2020445">.</span><span class="ident" id="2020446">Pos</span><span class="op" id="2020449">(</span><span class="op" id="2020450">)</span><span class="op" id="2020451">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020455">const</span>&nbsp;<span class="ident" id="2020461">linePrefix</span>&nbsp;<span class="op" id="2020472">=</span>&nbsp;<span class="string" id="2020474">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020485">if</span>&nbsp;<span class="ident" id="2020488">strings</span><span class="op" id="2020495">.</span><span class="ident" id="2020496">HasPrefix</span><span class="op" id="2020505">(</span><span class="ident" id="2020506">text</span><span class="op" id="2020510">,</span>&nbsp;<span class="ident" id="2020512">linePrefix</span><span class="op" id="2020522">)</span>&nbsp;<span class="op" id="2020524">&amp;&amp;</span>&nbsp;<span class="op" id="2020527">(</span><span class="op" id="2020528">!</span><span class="ident" id="2020529">pos</span><span class="op" id="2020532">.</span><span class="ident" id="2020533">IsValid</span><span class="op" id="2020540">(</span><span class="op" id="2020541">)</span>&nbsp;<span class="op" id="2020543">||</span>&nbsp;<span class="ident" id="2020546">pos</span><span class="op" id="2020549">.</span><span class="ident" id="2020550">Column</span>&nbsp;<span class="op" id="2020557">==</span>&nbsp;<span class="num" id="2020560">1</span><span class="op" id="2020561">)</span>&nbsp;<span class="op" id="2020563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2020567">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020598">ldir</span>&nbsp;<span class="op" id="2020603">:=</span>&nbsp;<span class="ident" id="2020606">strings</span><span class="op" id="2020613">.</span><span class="ident" id="2020614">TrimSpace</span><span class="op" id="2020623">(</span><span class="ident" id="2020624">text</span><span class="op" id="2020628">[</span><span class="builtinfunc" id="2020629">len</span><span class="op" id="2020632">(</span><span class="ident" id="2020633">linePrefix</span><span class="op" id="2020643">)</span><span class="op" id="2020644">:</span><span class="op" id="2020645">]</span><span class="op" id="2020646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020650">if</span>&nbsp;<span class="ident" id="2020653">i</span>&nbsp;<span class="op" id="2020655">:=</span>&nbsp;<span class="ident" id="2020658">strings</span><span class="op" id="2020665">.</span><span class="ident" id="2020666">LastIndex</span><span class="op" id="2020675">(</span><span class="ident" id="2020676">ldir</span><span class="op" id="2020680">,</span>&nbsp;<span class="string" id="2020682">&#34;:&#34;</span><span class="op" id="2020685">)</span><span class="op" id="2020686">;</span>&nbsp;<span class="ident" id="2020688">i</span>&nbsp;<span class="op" id="2020690">&gt;=</span>&nbsp;<span class="num" id="2020693">0</span>&nbsp;<span class="op" id="2020695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2020700">if</span>&nbsp;<span class="ident" id="2020703">line</span><span class="op" id="2020707">,</span>&nbsp;<span class="ident" id="2020709">err</span>&nbsp;<span class="op" id="2020713">:=</span>&nbsp;<span class="ident" id="2020716">strconv</span><span class="op" id="2020723">.</span><span class="ident" id="2020724">Atoi</span><span class="op" id="2020728">(</span><span class="ident" id="2020729">ldir</span><span class="op" id="2020733">[</span><span class="ident" id="2020734">i</span><span class="op" id="2020735">+</span><span class="num" id="2020736">1</span><span class="op" id="2020737">:</span><span class="op" id="2020738">]</span><span class="op" id="2020739">)</span><span class="op" id="2020740">;</span>&nbsp;<span class="ident" id="2020742">err</span>&nbsp;<span class="op" id="2020746">==</span>&nbsp;<span class="ident" id="2020749">nil</span>&nbsp;<span class="op" id="2020753">&amp;&amp;</span>&nbsp;<span class="ident" id="2020756">line</span>&nbsp;<span class="op" id="2020761">&gt;</span>&nbsp;<span class="num" id="2020763">0</span>&nbsp;<span class="op" id="2020765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2020771">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2020827">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2020883">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2020939">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2020995">indent</span>&nbsp;<span class="op" id="2021002">:=</span>&nbsp;<span class="ident" id="2021005">p</span><span class="op" id="2021006">.</span><span class="ident" id="2021007">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2021018">p</span><span class="op" id="2021019">.</span><span class="ident" id="2021020">indent</span>&nbsp;<span class="op" id="2021027">=</span>&nbsp;<span class="num" id="2021029">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2021035">defer</span>&nbsp;<span class="keyword" id="2021041">func</span><span class="op" id="2021045">(</span><span class="op" id="2021046">)</span>&nbsp;<span class="op" id="2021048">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2021055">p</span><span class="op" id="2021056">.</span><span class="ident" id="2021057">pos</span><span class="op" id="2021060">.</span><span class="ident" id="2021061">Filename</span>&nbsp;<span class="op" id="2021070">=</span>&nbsp;<span class="ident" id="2021072">ldir</span><span class="op" id="2021076">[</span><span class="op" id="2021077">:</span><span class="ident" id="2021078">i</span><span class="op" id="2021079">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2021086">p</span><span class="op" id="2021087">.</span><span class="ident" id="2021088">pos</span><span class="op" id="2021091">.</span><span class="ident" id="2021092">Line</span>&nbsp;<span class="op" id="2021097">=</span>&nbsp;<span class="ident" id="2021099">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2021109">p</span><span class="op" id="2021110">.</span><span class="ident" id="2021111">pos</span><span class="op" id="2021114">.</span><span class="ident" id="2021115">Column</span>&nbsp;<span class="op" id="2021122">=</span>&nbsp;<span class="num" id="2021124">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2021131">p</span><span class="op" id="2021132">.</span><span class="ident" id="2021133">indent</span>&nbsp;<span class="op" id="2021140">=</span>&nbsp;<span class="ident" id="2021142">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2021153">}</span><span class="op" id="2021154">(</span><span class="op" id="2021155">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2021160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2021164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2021167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2021171">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2021217">if</span>&nbsp;<span class="ident" id="2021220">text</span><span class="op" id="2021224">[</span><span class="num" id="2021225">1</span><span class="op" id="2021226">]</span>&nbsp;<span class="op" id="2021228">==</span>&nbsp;<span class="string" id="2021231">&#39;/&#39;</span>&nbsp;<span class="op" id="2021235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2021239">p</span><span class="op" id="2021240">.</span><span class="ident" id="2021241">writeString</span><span class="op" id="2021252">(</span><span class="ident" id="2021253">pos</span><span class="op" id="2021256">,</span>&nbsp;<span class="ident" id="2021258">trimRight</span><span class="op" id="2021267">(</span><span class="ident" id="2021268">text</span><span class="op" id="2021272">)</span><span class="op" id="2021273">,</span>&nbsp;<span class="builtintype" id="2021275">true</span><span class="op" id="2021279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2021283">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2021291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2021295">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2021353">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2021408">lines</span>&nbsp;<span class="op" id="2021414">:=</span>&nbsp;<span class="ident" id="2021417">strings</span><span class="op" id="2021424">.</span><span class="ident" id="2021425">Split</span><span class="op" id="2021430">(</span><span class="ident" id="2021431">text</span><span class="op" id="2021435">,</span>&nbsp;<span class="string" id="2021437">&#34;\n&#34;</span><span class="op" id="2021441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2021445">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2021502">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2021564">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2021625">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2021688">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2021748">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2021778">if</span>&nbsp;<span class="ident" id="2021781">pos</span><span class="op" id="2021784">.</span><span class="ident" id="2021785">IsValid</span><span class="op" id="2021792">(</span><span class="op" id="2021793">)</span>&nbsp;<span class="op" id="2021795">&amp;&amp;</span>&nbsp;<span class="ident" id="2021798">pos</span><span class="op" id="2021801">.</span><span class="ident" id="2021802">Column</span>&nbsp;<span class="op" id="2021809">==</span>&nbsp;<span class="num" id="2021812">1</span>&nbsp;<span class="op" id="2021814">&amp;&amp;</span>&nbsp;<span class="ident" id="2021817">p</span><span class="op" id="2021818">.</span><span class="ident" id="2021819">indent</span>&nbsp;<span class="op" id="2021826">&gt;</span>&nbsp;<span class="num" id="2021828">0</span>&nbsp;<span class="op" id="2021830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2021834">for</span>&nbsp;<span class="ident" id="2021838">i</span><span class="op" id="2021839">,</span>&nbsp;<span class="ident" id="2021841">line</span>&nbsp;<span class="op" id="2021846">:=</span>&nbsp;<span class="keyword" id="2021849">range</span>&nbsp;<span class="ident" id="2021855">lines</span><span class="op" id="2021860">[</span><span class="num" id="2021861">1</span><span class="op" id="2021862">:</span><span class="op" id="2021863">]</span>&nbsp;<span class="op" id="2021865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2021870">lines</span><span class="op" id="2021875">[</span><span class="num" id="2021876">1</span><span class="op" id="2021877">+</span><span class="ident" id="2021878">i</span><span class="op" id="2021879">]</span>&nbsp;<span class="op" id="2021881">=</span>&nbsp;<span class="string" id="2021883">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="2021889">+</span>&nbsp;<span class="ident" id="2021891">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2021898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2021901">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2021905">stripCommonPrefix</span><span class="op" id="2021922">(</span><span class="ident" id="2021923">lines</span><span class="op" id="2021928">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2021932">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2021980">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022025">for</span>&nbsp;<span class="ident" id="2022029">i</span><span class="op" id="2022030">,</span>&nbsp;<span class="ident" id="2022032">line</span>&nbsp;<span class="op" id="2022037">:=</span>&nbsp;<span class="keyword" id="2022040">range</span>&nbsp;<span class="ident" id="2022046">lines</span>&nbsp;<span class="op" id="2022052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022056">if</span>&nbsp;<span class="ident" id="2022059">i</span>&nbsp;<span class="op" id="2022061">&gt;</span>&nbsp;<span class="num" id="2022063">0</span>&nbsp;<span class="op" id="2022065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2022070">p</span><span class="op" id="2022071">.</span><span class="ident" id="2022072">writeByte</span><span class="op" id="2022081">(</span><span class="string" id="2022082">&#39;\f&#39;</span><span class="op" id="2022086">,</span>&nbsp;<span class="num" id="2022088">1</span><span class="op" id="2022089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2022094">pos</span>&nbsp;<span class="op" id="2022098">=</span>&nbsp;<span class="ident" id="2022100">p</span><span class="op" id="2022101">.</span><span class="ident" id="2022102">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2022108">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022112">if</span>&nbsp;<span class="builtinfunc" id="2022115">len</span><span class="op" id="2022118">(</span><span class="ident" id="2022119">line</span><span class="op" id="2022123">)</span>&nbsp;<span class="op" id="2022125">&gt;</span>&nbsp;<span class="num" id="2022127">0</span>&nbsp;<span class="op" id="2022129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2022134">p</span><span class="op" id="2022135">.</span><span class="ident" id="2022136">writeString</span><span class="op" id="2022147">(</span><span class="ident" id="2022148">pos</span><span class="op" id="2022151">,</span>&nbsp;<span class="ident" id="2022153">trimRight</span><span class="op" id="2022162">(</span><span class="ident" id="2022163">line</span><span class="op" id="2022167">)</span><span class="op" id="2022168">,</span>&nbsp;<span class="builtintype" id="2022170">true</span><span class="op" id="2022174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2022178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2022181">}</span><br>
<span class="lineno"></span><span class="op" id="2022183">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="2022186">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="2022257">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="2022328">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2022397">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="2022465">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="2022537">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2022548">//</span><br>
<span class="lineno"></span><span class="keyword" id="2022551">func</span>&nbsp;<span class="op" id="2022556">(</span><span class="ident" id="2022557">p</span>&nbsp;<span class="op" id="2022559">*</span><span class="ident" id="2022560">printer</span><span class="op" id="2022567">)</span>&nbsp;<span class="ident" id="2022569">writeCommentSuffix</span><span class="op" id="2022587">(</span><span class="ident" id="2022588">needsLinebreak</span>&nbsp;<span class="builtintype" id="2022603">bool</span><span class="op" id="2022607">)</span>&nbsp;<span class="op" id="2022609">(</span><span class="ident" id="2022610">wroteNewline</span><span class="op" id="2022622">,</span>&nbsp;<span class="ident" id="2022624">droppedFF</span>&nbsp;<span class="builtintype" id="2022634">bool</span><span class="op" id="2022638">)</span>&nbsp;<span class="op" id="2022640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022643">for</span>&nbsp;<span class="ident" id="2022647">i</span><span class="op" id="2022648">,</span>&nbsp;<span class="ident" id="2022650">ch</span>&nbsp;<span class="op" id="2022653">:=</span>&nbsp;<span class="keyword" id="2022656">range</span>&nbsp;<span class="ident" id="2022662">p</span><span class="op" id="2022663">.</span><span class="ident" id="2022664">wsbuf</span>&nbsp;<span class="op" id="2022670">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022674">switch</span>&nbsp;<span class="ident" id="2022681">ch</span>&nbsp;<span class="op" id="2022684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022688">case</span>&nbsp;<span class="ident" id="2022693">blank</span><span class="op" id="2022698">,</span>&nbsp;<span class="ident" id="2022700">vtab</span><span class="op" id="2022704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2022709">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2022742">p</span><span class="op" id="2022743">.</span><span class="ident" id="2022744">wsbuf</span><span class="op" id="2022749">[</span><span class="ident" id="2022750">i</span><span class="op" id="2022751">]</span>&nbsp;<span class="op" id="2022753">=</span>&nbsp;<span class="ident" id="2022755">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022764">case</span>&nbsp;<span class="ident" id="2022769">indent</span><span class="op" id="2022775">,</span>&nbsp;<span class="ident" id="2022777">unindent</span><span class="op" id="2022785">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2022790">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022830">case</span>&nbsp;<span class="ident" id="2022835">newline</span><span class="op" id="2022842">,</span>&nbsp;<span class="ident" id="2022844">formfeed</span><span class="op" id="2022852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2022857">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2022905">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2022952">if</span>&nbsp;<span class="ident" id="2022955">needsLinebreak</span>&nbsp;<span class="op" id="2022970">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2022976">needsLinebreak</span>&nbsp;<span class="op" id="2022991">=</span>&nbsp;<span class="builtintype" id="2022993">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023003">wroteNewline</span>&nbsp;<span class="op" id="2023016">=</span>&nbsp;<span class="builtintype" id="2023018">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2023026">}</span>&nbsp;<span class="keyword" id="2023028">else</span>&nbsp;<span class="op" id="2023033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2023039">if</span>&nbsp;<span class="ident" id="2023042">ch</span>&nbsp;<span class="op" id="2023045">==</span>&nbsp;<span class="ident" id="2023048">formfeed</span>&nbsp;<span class="op" id="2023057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023064">droppedFF</span>&nbsp;<span class="op" id="2023074">=</span>&nbsp;<span class="builtintype" id="2023076">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2023085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023091">p</span><span class="op" id="2023092">.</span><span class="ident" id="2023093">wsbuf</span><span class="op" id="2023098">[</span><span class="ident" id="2023099">i</span><span class="op" id="2023100">]</span>&nbsp;<span class="op" id="2023102">=</span>&nbsp;<span class="ident" id="2023104">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2023114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2023118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2023121">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023124">p</span><span class="op" id="2023125">.</span><span class="ident" id="2023126">writeWhitespace</span><span class="op" id="2023141">(</span><span class="builtinfunc" id="2023142">len</span><span class="op" id="2023145">(</span><span class="ident" id="2023146">p</span><span class="op" id="2023147">.</span><span class="ident" id="2023148">wsbuf</span><span class="op" id="2023153">)</span><span class="op" id="2023154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2023158">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2023193">if</span>&nbsp;<span class="ident" id="2023196">needsLinebreak</span>&nbsp;<span class="op" id="2023211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023215">p</span><span class="op" id="2023216">.</span><span class="ident" id="2023217">writeByte</span><span class="op" id="2023226">(</span><span class="string" id="2023227">&#39;\n&#39;</span><span class="op" id="2023231">,</span>&nbsp;<span class="num" id="2023233">1</span><span class="op" id="2023234">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023238">wroteNewline</span>&nbsp;<span class="op" id="2023251">=</span>&nbsp;<span class="builtintype" id="2023253">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2023259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2023263">return</span><br>
<span class="lineno"></span><span class="op" id="2023270">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="2023273">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="2023352">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="2023433">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="2023512">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="2023590">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2023670">//</span><br>
<span class="lineno"></span><span class="keyword" id="2023673">func</span>&nbsp;<span class="op" id="2023678">(</span><span class="ident" id="2023679">p</span>&nbsp;<span class="op" id="2023681">*</span><span class="ident" id="2023682">printer</span><span class="op" id="2023689">)</span>&nbsp;<span class="ident" id="2023691">intersperseComments</span><span class="op" id="2023710">(</span><span class="ident" id="2023711">next</span>&nbsp;<span class="ident" id="2023716">token</span><span class="op" id="2023721">.</span><span class="ident" id="2023722">Position</span><span class="op" id="2023730">,</span>&nbsp;<span class="ident" id="2023732">tok</span>&nbsp;<span class="ident" id="2023736">token</span><span class="op" id="2023741">.</span><span class="ident" id="2023742">Token</span><span class="op" id="2023747">)</span>&nbsp;<span class="op" id="2023749">(</span><span class="ident" id="2023750">wroteNewline</span><span class="op" id="2023762">,</span>&nbsp;<span class="ident" id="2023764">droppedFF</span>&nbsp;<span class="builtintype" id="2023774">bool</span><span class="op" id="2023778">)</span>&nbsp;<span class="op" id="2023780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2023783">var</span>&nbsp;<span class="ident" id="2023787">last</span>&nbsp;<span class="op" id="2023792">*</span><span class="ident" id="2023793">ast</span><span class="op" id="2023796">.</span><span class="ident" id="2023797">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2023806">for</span>&nbsp;<span class="ident" id="2023810">p</span><span class="op" id="2023811">.</span><span class="ident" id="2023812">commentBefore</span><span class="op" id="2023825">(</span><span class="ident" id="2023826">next</span><span class="op" id="2023830">)</span>&nbsp;<span class="op" id="2023832">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2023836">for</span>&nbsp;<span class="ident" id="2023840">_</span><span class="op" id="2023841">,</span>&nbsp;<span class="ident" id="2023843">c</span>&nbsp;<span class="op" id="2023845">:=</span>&nbsp;<span class="keyword" id="2023848">range</span>&nbsp;<span class="ident" id="2023854">p</span><span class="op" id="2023855">.</span><span class="ident" id="2023856">comment</span><span class="op" id="2023863">.</span><span class="ident" id="2023864">List</span>&nbsp;<span class="op" id="2023869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023874">p</span><span class="op" id="2023875">.</span><span class="ident" id="2023876">writeCommentPrefix</span><span class="op" id="2023894">(</span><span class="ident" id="2023895">p</span><span class="op" id="2023896">.</span><span class="ident" id="2023897">posFor</span><span class="op" id="2023903">(</span><span class="ident" id="2023904">c</span><span class="op" id="2023905">.</span><span class="ident" id="2023906">Pos</span><span class="op" id="2023909">(</span><span class="op" id="2023910">)</span><span class="op" id="2023911">)</span><span class="op" id="2023912">,</span>&nbsp;<span class="ident" id="2023914">next</span><span class="op" id="2023918">,</span>&nbsp;<span class="ident" id="2023920">last</span><span class="op" id="2023924">,</span>&nbsp;<span class="ident" id="2023926">c</span><span class="op" id="2023927">,</span>&nbsp;<span class="ident" id="2023929">tok</span><span class="op" id="2023932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023937">p</span><span class="op" id="2023938">.</span><span class="ident" id="2023939">writeComment</span><span class="op" id="2023951">(</span><span class="ident" id="2023952">c</span><span class="op" id="2023953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023958">last</span>&nbsp;<span class="op" id="2023963">=</span>&nbsp;<span class="ident" id="2023965">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2023969">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2023973">p</span><span class="op" id="2023974">.</span><span class="ident" id="2023975">nextComment</span><span class="op" id="2023986">(</span><span class="op" id="2023987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2023990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2023994">if</span>&nbsp;<span class="ident" id="2023997">last</span>&nbsp;<span class="op" id="2024002">!=</span>&nbsp;<span class="ident" id="2024005">nil</span>&nbsp;<span class="op" id="2024009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2024013">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2024078">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2024148">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2024216">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2024282">if</span>&nbsp;<span class="ident" id="2024285">p</span><span class="op" id="2024286">.</span><span class="ident" id="2024287">mode</span><span class="op" id="2024291">&amp;</span><span class="ident" id="2024292">noExtraBlank</span>&nbsp;<span class="op" id="2024305">==</span>&nbsp;<span class="num" id="2024308">0</span>&nbsp;<span class="op" id="2024310">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024316">last</span><span class="op" id="2024320">.</span><span class="ident" id="2024321">Text</span><span class="op" id="2024325">[</span><span class="num" id="2024326">1</span><span class="op" id="2024327">]</span>&nbsp;<span class="op" id="2024329">==</span>&nbsp;<span class="string" id="2024332">&#39;*&#39;</span>&nbsp;<span class="op" id="2024336">&amp;&amp;</span>&nbsp;<span class="ident" id="2024339">p</span><span class="op" id="2024340">.</span><span class="ident" id="2024341">lineFor</span><span class="op" id="2024348">(</span><span class="ident" id="2024349">last</span><span class="op" id="2024353">.</span><span class="ident" id="2024354">Pos</span><span class="op" id="2024357">(</span><span class="op" id="2024358">)</span><span class="op" id="2024359">)</span>&nbsp;<span class="op" id="2024361">==</span>&nbsp;<span class="ident" id="2024364">next</span><span class="op" id="2024368">.</span><span class="ident" id="2024369">Line</span>&nbsp;<span class="op" id="2024374">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024380">tok</span>&nbsp;<span class="op" id="2024384">!=</span>&nbsp;<span class="ident" id="2024387">token</span><span class="op" id="2024392">.</span><span class="ident" id="2024393">COMMA</span>&nbsp;<span class="op" id="2024399">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2024405">(</span><span class="ident" id="2024406">tok</span>&nbsp;<span class="op" id="2024410">!=</span>&nbsp;<span class="ident" id="2024413">token</span><span class="op" id="2024418">.</span><span class="ident" id="2024419">RPAREN</span>&nbsp;<span class="op" id="2024426">||</span>&nbsp;<span class="ident" id="2024429">p</span><span class="op" id="2024430">.</span><span class="ident" id="2024431">prevOpen</span>&nbsp;<span class="op" id="2024440">==</span>&nbsp;<span class="ident" id="2024443">token</span><span class="op" id="2024448">.</span><span class="ident" id="2024449">LPAREN</span><span class="op" id="2024455">)</span>&nbsp;<span class="op" id="2024457">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2024463">(</span><span class="ident" id="2024464">tok</span>&nbsp;<span class="op" id="2024468">!=</span>&nbsp;<span class="ident" id="2024471">token</span><span class="op" id="2024476">.</span><span class="ident" id="2024477">RBRACK</span>&nbsp;<span class="op" id="2024484">||</span>&nbsp;<span class="ident" id="2024487">p</span><span class="op" id="2024488">.</span><span class="ident" id="2024489">prevOpen</span>&nbsp;<span class="op" id="2024498">==</span>&nbsp;<span class="ident" id="2024501">token</span><span class="op" id="2024506">.</span><span class="ident" id="2024507">LBRACK</span><span class="op" id="2024513">)</span>&nbsp;<span class="op" id="2024515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024520">p</span><span class="op" id="2024521">.</span><span class="ident" id="2024522">writeByte</span><span class="op" id="2024531">(</span><span class="string" id="2024532">&#39;&nbsp;&#39;</span><span class="op" id="2024535">,</span>&nbsp;<span class="num" id="2024537">1</span><span class="op" id="2024538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2024542">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2024546">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2024611">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024675">needsLinebreak</span>&nbsp;<span class="op" id="2024690">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024696">last</span><span class="op" id="2024700">.</span><span class="ident" id="2024701">Text</span><span class="op" id="2024705">[</span><span class="num" id="2024706">1</span><span class="op" id="2024707">]</span>&nbsp;<span class="op" id="2024709">==</span>&nbsp;<span class="string" id="2024712">&#39;/&#39;</span>&nbsp;<span class="op" id="2024716">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024723">tok</span>&nbsp;<span class="op" id="2024727">==</span>&nbsp;<span class="ident" id="2024730">token</span><span class="op" id="2024735">.</span><span class="ident" id="2024736">RBRACE</span>&nbsp;<span class="op" id="2024743">&amp;&amp;</span>&nbsp;<span class="ident" id="2024746">p</span><span class="op" id="2024747">.</span><span class="ident" id="2024748">mode</span><span class="op" id="2024752">&amp;</span><span class="ident" id="2024753">noExtraLinebreak</span>&nbsp;<span class="op" id="2024770">==</span>&nbsp;<span class="num" id="2024773">0</span>&nbsp;<span class="op" id="2024775">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024782">tok</span>&nbsp;<span class="op" id="2024786">==</span>&nbsp;<span class="ident" id="2024789">token</span><span class="op" id="2024794">.</span><span class="ident" id="2024795">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2024801">return</span>&nbsp;<span class="ident" id="2024808">p</span><span class="op" id="2024809">.</span><span class="ident" id="2024810">writeCommentSuffix</span><span class="op" id="2024828">(</span><span class="ident" id="2024829">needsLinebreak</span><span class="op" id="2024843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2024846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2024850">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2024912">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2024970">p</span><span class="op" id="2024971">.</span><span class="ident" id="2024972">internalError</span><span class="op" id="2024985">(</span><span class="string" id="2024986">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="2025039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025042">return</span><br>
<span class="lineno"></span><span class="op" id="2025049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="2025052">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="2025110">func</span>&nbsp;<span class="op" id="2025115">(</span><span class="ident" id="2025116">p</span>&nbsp;<span class="op" id="2025118">*</span><span class="ident" id="2025119">printer</span><span class="op" id="2025126">)</span>&nbsp;<span class="ident" id="2025128">writeWhitespace</span><span class="op" id="2025143">(</span><span class="ident" id="2025144">n</span>&nbsp;<span class="builtintype" id="2025146">int</span><span class="op" id="2025149">)</span>&nbsp;<span class="op" id="2025151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2025154">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025172">for</span>&nbsp;<span class="ident" id="2025176">i</span>&nbsp;<span class="op" id="2025178">:=</span>&nbsp;<span class="num" id="2025181">0</span><span class="op" id="2025182">;</span>&nbsp;<span class="ident" id="2025184">i</span>&nbsp;<span class="op" id="2025186">&lt;</span>&nbsp;<span class="ident" id="2025188">n</span><span class="op" id="2025189">;</span>&nbsp;<span class="ident" id="2025191">i</span><span class="op" id="2025192">++</span>&nbsp;<span class="op" id="2025195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025199">switch</span>&nbsp;<span class="ident" id="2025206">ch</span>&nbsp;<span class="op" id="2025209">:=</span>&nbsp;<span class="ident" id="2025212">p</span><span class="op" id="2025213">.</span><span class="ident" id="2025214">wsbuf</span><span class="op" id="2025219">[</span><span class="ident" id="2025220">i</span><span class="op" id="2025221">]</span><span class="op" id="2025222">;</span>&nbsp;<span class="ident" id="2025224">ch</span>&nbsp;<span class="op" id="2025227">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025231">case</span>&nbsp;<span class="ident" id="2025236">ignore</span><span class="op" id="2025242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2025247">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025260">case</span>&nbsp;<span class="ident" id="2025265">indent</span><span class="op" id="2025271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025276">p</span><span class="op" id="2025277">.</span><span class="ident" id="2025278">indent</span><span class="op" id="2025284">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025289">case</span>&nbsp;<span class="ident" id="2025294">unindent</span><span class="op" id="2025302">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025307">p</span><span class="op" id="2025308">.</span><span class="ident" id="2025309">indent</span><span class="op" id="2025315">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025321">if</span>&nbsp;<span class="ident" id="2025324">p</span><span class="op" id="2025325">.</span><span class="ident" id="2025326">indent</span>&nbsp;<span class="op" id="2025333">&lt;</span>&nbsp;<span class="num" id="2025335">0</span>&nbsp;<span class="op" id="2025337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025343">p</span><span class="op" id="2025344">.</span><span class="ident" id="2025345">internalError</span><span class="op" id="2025358">(</span><span class="string" id="2025359">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="2025382">,</span>&nbsp;<span class="ident" id="2025384">p</span><span class="op" id="2025385">.</span><span class="ident" id="2025386">indent</span><span class="op" id="2025392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2025398">p</span><span class="op" id="2025399">.</span><span class="ident" id="2025400">indent</span>&nbsp;<span class="op" id="2025407">=</span>&nbsp;<span class="num" id="2025409">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2025414">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025418">case</span>&nbsp;<span class="ident" id="2025423">newline</span><span class="op" id="2025430">,</span>&nbsp;<span class="ident" id="2025432">formfeed</span><span class="op" id="2025440">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2025445">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2025503">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2025562">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2025618">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2025674">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2025734">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2025779">if</span>&nbsp;<span class="ident" id="2025782">i</span><span class="op" id="2025783">+</span><span class="num" id="2025784">1</span>&nbsp;<span class="op" id="2025786">&lt;</span>&nbsp;<span class="ident" id="2025788">n</span>&nbsp;<span class="op" id="2025790">&amp;&amp;</span>&nbsp;<span class="ident" id="2025793">p</span><span class="op" id="2025794">.</span><span class="ident" id="2025795">wsbuf</span><span class="op" id="2025800">[</span><span class="ident" id="2025801">i</span><span class="op" id="2025802">+</span><span class="num" id="2025803">1</span><span class="op" id="2025804">]</span>&nbsp;<span class="op" id="2025806">==</span>&nbsp;<span class="ident" id="2025809">unindent</span>&nbsp;<span class="op" id="2025818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2025824">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2025880">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2025941">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2026001">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2026064">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026084">p</span><span class="op" id="2026085">.</span><span class="ident" id="2026086">wsbuf</span><span class="op" id="2026091">[</span><span class="ident" id="2026092">i</span><span class="op" id="2026093">]</span><span class="op" id="2026094">,</span>&nbsp;<span class="ident" id="2026096">p</span><span class="op" id="2026097">.</span><span class="ident" id="2026098">wsbuf</span><span class="op" id="2026103">[</span><span class="ident" id="2026104">i</span><span class="op" id="2026105">+</span><span class="num" id="2026106">1</span><span class="op" id="2026107">]</span>&nbsp;<span class="op" id="2026109">=</span>&nbsp;<span class="ident" id="2026111">unindent</span><span class="op" id="2026119">,</span>&nbsp;<span class="ident" id="2026121">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026134">i</span><span class="op" id="2026135">--</span>&nbsp;<span class="comment" id="2026138">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026157">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2026169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026174">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026188">default</span><span class="op" id="2026195">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026200">p</span><span class="op" id="2026201">.</span><span class="ident" id="2026202">writeByte</span><span class="op" id="2026211">(</span><span class="builtintype" id="2026212">byte</span><span class="op" id="2026216">(</span><span class="ident" id="2026217">ch</span><span class="op" id="2026219">)</span><span class="op" id="2026220">,</span>&nbsp;<span class="num" id="2026222">1</span><span class="op" id="2026223">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2026227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2026230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2026234">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026267">l</span>&nbsp;<span class="op" id="2026269">:=</span>&nbsp;<span class="builtinfunc" id="2026272">copy</span><span class="op" id="2026276">(</span><span class="ident" id="2026277">p</span><span class="op" id="2026278">.</span><span class="ident" id="2026279">wsbuf</span><span class="op" id="2026284">,</span>&nbsp;<span class="ident" id="2026286">p</span><span class="op" id="2026287">.</span><span class="ident" id="2026288">wsbuf</span><span class="op" id="2026293">[</span><span class="ident" id="2026294">n</span><span class="op" id="2026295">:</span><span class="op" id="2026296">]</span><span class="op" id="2026297">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026300">p</span><span class="op" id="2026301">.</span><span class="ident" id="2026302">wsbuf</span>&nbsp;<span class="op" id="2026308">=</span>&nbsp;<span class="ident" id="2026310">p</span><span class="op" id="2026311">.</span><span class="ident" id="2026312">wsbuf</span><span class="op" id="2026317">[</span><span class="op" id="2026318">:</span><span class="ident" id="2026319">l</span><span class="op" id="2026320">]</span><br>
<span class="lineno"></span><span class="op" id="2026322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2026325">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2026405">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="2026428">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="2026463">func</span>&nbsp;<span class="ident" id="2026468">nlimit</span><span class="op" id="2026474">(</span><span class="ident" id="2026475">n</span>&nbsp;<span class="builtintype" id="2026477">int</span><span class="op" id="2026480">)</span>&nbsp;<span class="builtintype" id="2026482">int</span>&nbsp;<span class="op" id="2026486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026489">if</span>&nbsp;<span class="ident" id="2026492">n</span>&nbsp;<span class="op" id="2026494">&gt;</span>&nbsp;<span class="ident" id="2026496">maxNewlines</span>&nbsp;<span class="op" id="2026508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026512">n</span>&nbsp;<span class="op" id="2026514">=</span>&nbsp;<span class="ident" id="2026516">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2026529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026532">return</span>&nbsp;<span class="ident" id="2026539">n</span><br>
<span class="lineno"></span><span class="op" id="2026541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2026544">func</span>&nbsp;<span class="ident" id="2026549">mayCombine</span><span class="op" id="2026559">(</span><span class="ident" id="2026560">prev</span>&nbsp;<span class="ident" id="2026565">token</span><span class="op" id="2026570">.</span><span class="ident" id="2026571">Token</span><span class="op" id="2026576">,</span>&nbsp;<span class="ident" id="2026578">next</span>&nbsp;<span class="builtintype" id="2026583">byte</span><span class="op" id="2026587">)</span>&nbsp;<span class="op" id="2026589">(</span><span class="ident" id="2026590">b</span>&nbsp;<span class="builtintype" id="2026592">bool</span><span class="op" id="2026596">)</span>&nbsp;<span class="op" id="2026598">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026601">switch</span>&nbsp;<span class="ident" id="2026608">prev</span>&nbsp;<span class="op" id="2026613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026616">case</span>&nbsp;<span class="ident" id="2026621">token</span><span class="op" id="2026626">.</span><span class="ident" id="2026627">INT</span><span class="op" id="2026630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026634">b</span>&nbsp;<span class="op" id="2026636">=</span>&nbsp;<span class="ident" id="2026638">next</span>&nbsp;<span class="op" id="2026643">==</span>&nbsp;<span class="string" id="2026646">&#39;.&#39;</span>&nbsp;<span class="comment" id="2026650">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026657">case</span>&nbsp;<span class="ident" id="2026662">token</span><span class="op" id="2026667">.</span><span class="ident" id="2026668">ADD</span><span class="op" id="2026671">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026675">b</span>&nbsp;<span class="op" id="2026677">=</span>&nbsp;<span class="ident" id="2026679">next</span>&nbsp;<span class="op" id="2026684">==</span>&nbsp;<span class="string" id="2026687">&#39;+&#39;</span>&nbsp;<span class="comment" id="2026691">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026698">case</span>&nbsp;<span class="ident" id="2026703">token</span><span class="op" id="2026708">.</span><span class="ident" id="2026709">SUB</span><span class="op" id="2026712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026716">b</span>&nbsp;<span class="op" id="2026718">=</span>&nbsp;<span class="ident" id="2026720">next</span>&nbsp;<span class="op" id="2026725">==</span>&nbsp;<span class="string" id="2026728">&#39;-&#39;</span>&nbsp;<span class="comment" id="2026732">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026739">case</span>&nbsp;<span class="ident" id="2026744">token</span><span class="op" id="2026749">.</span><span class="ident" id="2026750">QUO</span><span class="op" id="2026753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026757">b</span>&nbsp;<span class="op" id="2026759">=</span>&nbsp;<span class="ident" id="2026761">next</span>&nbsp;<span class="op" id="2026766">==</span>&nbsp;<span class="string" id="2026769">&#39;*&#39;</span>&nbsp;<span class="comment" id="2026773">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026780">case</span>&nbsp;<span class="ident" id="2026785">token</span><span class="op" id="2026790">.</span><span class="ident" id="2026791">LSS</span><span class="op" id="2026794">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026798">b</span>&nbsp;<span class="op" id="2026800">=</span>&nbsp;<span class="ident" id="2026802">next</span>&nbsp;<span class="op" id="2026807">==</span>&nbsp;<span class="string" id="2026810">&#39;-&#39;</span>&nbsp;<span class="op" id="2026814">||</span>&nbsp;<span class="ident" id="2026817">next</span>&nbsp;<span class="op" id="2026822">==</span>&nbsp;<span class="string" id="2026825">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="2026829">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026842">case</span>&nbsp;<span class="ident" id="2026847">token</span><span class="op" id="2026852">.</span><span class="ident" id="2026853">AND</span><span class="op" id="2026856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2026860">b</span>&nbsp;<span class="op" id="2026862">=</span>&nbsp;<span class="ident" id="2026864">next</span>&nbsp;<span class="op" id="2026869">==</span>&nbsp;<span class="string" id="2026872">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="2026876">||</span>&nbsp;<span class="ident" id="2026879">next</span>&nbsp;<span class="op" id="2026884">==</span>&nbsp;<span class="string" id="2026887">&#39;^&#39;</span>&nbsp;<span class="comment" id="2026891">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2026904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2026907">return</span><br>
<span class="lineno">825</span><span class="op" id="2026914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2026917">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="2026987">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="2027057">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="2027126">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="2027176">//</span><br>
<span class="lineno"></span><span class="comment" id="2027179">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="2027250">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="2027319">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="2027389">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2027459">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="2027501">//</span><br>
<span class="lineno"></span><span class="keyword" id="2027504">func</span>&nbsp;<span class="op" id="2027509">(</span><span class="ident" id="2027510">p</span>&nbsp;<span class="op" id="2027512">*</span><span class="ident" id="2027513">printer</span><span class="op" id="2027520">)</span>&nbsp;<span class="builtinfunc" id="2027522">print</span><span class="op" id="2027527">(</span><span class="ident" id="2027528">args</span>&nbsp;<span class="op" id="2027533">...</span><span class="keyword" id="2027536">interface</span><span class="op" id="2027545">{</span><span class="op" id="2027546">}</span><span class="op" id="2027547">)</span>&nbsp;<span class="op" id="2027549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027552">for</span>&nbsp;<span class="ident" id="2027556">_</span><span class="op" id="2027557">,</span>&nbsp;<span class="ident" id="2027559">arg</span>&nbsp;<span class="op" id="2027563">:=</span>&nbsp;<span class="keyword" id="2027566">range</span>&nbsp;<span class="ident" id="2027572">args</span>&nbsp;<span class="op" id="2027577">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2027581">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027620">var</span>&nbsp;<span class="ident" id="2027624">data</span>&nbsp;<span class="builtintype" id="2027629">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027638">var</span>&nbsp;<span class="ident" id="2027642">isLit</span>&nbsp;<span class="builtintype" id="2027648">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027655">var</span>&nbsp;<span class="ident" id="2027659">impliedSemi</span>&nbsp;<span class="builtintype" id="2027671">bool</span>&nbsp;<span class="comment" id="2027676">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2027721">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027764">switch</span>&nbsp;<span class="ident" id="2027771">p</span><span class="op" id="2027772">.</span><span class="ident" id="2027773">lastTok</span>&nbsp;<span class="op" id="2027781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027785">case</span>&nbsp;<span class="ident" id="2027790">token</span><span class="op" id="2027795">.</span><span class="ident" id="2027796">ILLEGAL</span><span class="op" id="2027803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2027808">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027834">case</span>&nbsp;<span class="ident" id="2027839">token</span><span class="op" id="2027844">.</span><span class="ident" id="2027845">LPAREN</span><span class="op" id="2027851">,</span>&nbsp;<span class="ident" id="2027853">token</span><span class="op" id="2027858">.</span><span class="ident" id="2027859">LBRACK</span><span class="op" id="2027865">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027870">p</span><span class="op" id="2027871">.</span><span class="ident" id="2027872">prevOpen</span>&nbsp;<span class="op" id="2027881">=</span>&nbsp;<span class="ident" id="2027883">p</span><span class="op" id="2027884">.</span><span class="ident" id="2027885">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027895">default</span><span class="op" id="2027902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2027907">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2027953">p</span><span class="op" id="2027954">.</span><span class="ident" id="2027955">prevOpen</span>&nbsp;<span class="op" id="2027964">=</span>&nbsp;<span class="ident" id="2027966">token</span><span class="op" id="2027971">.</span><span class="ident" id="2027972">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2027982">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2027987">switch</span>&nbsp;<span class="ident" id="2027994">x</span>&nbsp;<span class="op" id="2027996">:=</span>&nbsp;<span class="ident" id="2027999">arg</span><span class="op" id="2028002">.</span><span class="op" id="2028003">(</span><span class="keyword" id="2028004">type</span><span class="op" id="2028008">)</span>&nbsp;<span class="op" id="2028010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028014">case</span>&nbsp;<span class="ident" id="2028019">pmode</span><span class="op" id="2028024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2028029">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028055">p</span><span class="op" id="2028056">.</span><span class="ident" id="2028057">mode</span>&nbsp;<span class="op" id="2028062">^=</span>&nbsp;<span class="ident" id="2028065">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028070">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028082">case</span>&nbsp;<span class="ident" id="2028087">whiteSpace</span><span class="op" id="2028097">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028102">if</span>&nbsp;<span class="ident" id="2028105">x</span>&nbsp;<span class="op" id="2028107">==</span>&nbsp;<span class="ident" id="2028110">ignore</span>&nbsp;<span class="op" id="2028117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2028123">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2028169">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2028217">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028237">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2028249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028254">i</span>&nbsp;<span class="op" id="2028256">:=</span>&nbsp;<span class="builtinfunc" id="2028259">len</span><span class="op" id="2028262">(</span><span class="ident" id="2028263">p</span><span class="op" id="2028264">.</span><span class="ident" id="2028265">wsbuf</span><span class="op" id="2028270">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028275">if</span>&nbsp;<span class="ident" id="2028278">i</span>&nbsp;<span class="op" id="2028280">==</span>&nbsp;<span class="builtinfunc" id="2028283">cap</span><span class="op" id="2028286">(</span><span class="ident" id="2028287">p</span><span class="op" id="2028288">.</span><span class="ident" id="2028289">wsbuf</span><span class="op" id="2028294">)</span>&nbsp;<span class="op" id="2028296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2028302">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2028360">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2028418">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028467">p</span><span class="op" id="2028468">.</span><span class="ident" id="2028469">writeWhitespace</span><span class="op" id="2028484">(</span><span class="ident" id="2028485">i</span><span class="op" id="2028486">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028492">i</span>&nbsp;<span class="op" id="2028494">=</span>&nbsp;<span class="num" id="2028496">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2028501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028506">p</span><span class="op" id="2028507">.</span><span class="ident" id="2028508">wsbuf</span>&nbsp;<span class="op" id="2028514">=</span>&nbsp;<span class="ident" id="2028516">p</span><span class="op" id="2028517">.</span><span class="ident" id="2028518">wsbuf</span><span class="op" id="2028523">[</span><span class="num" id="2028524">0</span>&nbsp;<span class="op" id="2028526">:</span>&nbsp;<span class="ident" id="2028528">i</span><span class="op" id="2028529">+</span><span class="num" id="2028530">1</span><span class="op" id="2028531">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028536">p</span><span class="op" id="2028537">.</span><span class="ident" id="2028538">wsbuf</span><span class="op" id="2028543">[</span><span class="ident" id="2028544">i</span><span class="op" id="2028545">]</span>&nbsp;<span class="op" id="2028547">=</span>&nbsp;<span class="ident" id="2028549">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028554">if</span>&nbsp;<span class="ident" id="2028557">x</span>&nbsp;<span class="op" id="2028559">==</span>&nbsp;<span class="ident" id="2028562">newline</span>&nbsp;<span class="op" id="2028570">||</span>&nbsp;<span class="ident" id="2028573">x</span>&nbsp;<span class="op" id="2028575">==</span>&nbsp;<span class="ident" id="2028578">formfeed</span>&nbsp;<span class="op" id="2028587">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2028593">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2028650">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2028708">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2028767">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028787">p</span><span class="op" id="2028788">.</span><span class="ident" id="2028789">impliedSemi</span>&nbsp;<span class="op" id="2028801">=</span>&nbsp;<span class="builtintype" id="2028803">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2028812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028817">p</span><span class="op" id="2028818">.</span><span class="ident" id="2028819">lastTok</span>&nbsp;<span class="op" id="2028827">=</span>&nbsp;<span class="ident" id="2028829">token</span><span class="op" id="2028834">.</span><span class="ident" id="2028835">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028846">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028858">case</span>&nbsp;<span class="op" id="2028863">*</span><span class="ident" id="2028864">ast</span><span class="op" id="2028867">.</span><span class="ident" id="2028868">Ident</span><span class="op" id="2028873">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028878">data</span>&nbsp;<span class="op" id="2028883">=</span>&nbsp;<span class="ident" id="2028885">x</span><span class="op" id="2028886">.</span><span class="ident" id="2028887">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028895">impliedSemi</span>&nbsp;<span class="op" id="2028907">=</span>&nbsp;<span class="builtintype" id="2028909">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028917">p</span><span class="op" id="2028918">.</span><span class="ident" id="2028919">lastTok</span>&nbsp;<span class="op" id="2028927">=</span>&nbsp;<span class="ident" id="2028929">token</span><span class="op" id="2028934">.</span><span class="ident" id="2028935">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2028944">case</span>&nbsp;<span class="op" id="2028949">*</span><span class="ident" id="2028950">ast</span><span class="op" id="2028953">.</span><span class="ident" id="2028954">BasicLit</span><span class="op" id="2028962">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028967">data</span>&nbsp;<span class="op" id="2028972">=</span>&nbsp;<span class="ident" id="2028974">x</span><span class="op" id="2028975">.</span><span class="ident" id="2028976">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2028985">isLit</span>&nbsp;<span class="op" id="2028991">=</span>&nbsp;<span class="builtintype" id="2028993">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029001">impliedSemi</span>&nbsp;<span class="op" id="2029013">=</span>&nbsp;<span class="builtintype" id="2029015">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029023">p</span><span class="op" id="2029024">.</span><span class="ident" id="2029025">lastTok</span>&nbsp;<span class="op" id="2029033">=</span>&nbsp;<span class="ident" id="2029035">x</span><span class="op" id="2029036">.</span><span class="ident" id="2029037">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2029045">case</span>&nbsp;<span class="ident" id="2029050">token</span><span class="op" id="2029055">.</span><span class="ident" id="2029056">Token</span><span class="op" id="2029061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029066">s</span>&nbsp;<span class="op" id="2029068">:=</span>&nbsp;<span class="ident" id="2029071">x</span><span class="op" id="2029072">.</span><span class="ident" id="2029073">String</span><span class="op" id="2029079">(</span><span class="op" id="2029080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2029085">if</span>&nbsp;<span class="ident" id="2029088">mayCombine</span><span class="op" id="2029098">(</span><span class="ident" id="2029099">p</span><span class="op" id="2029100">.</span><span class="ident" id="2029101">lastTok</span><span class="op" id="2029108">,</span>&nbsp;<span class="ident" id="2029110">s</span><span class="op" id="2029111">[</span><span class="num" id="2029112">0</span><span class="op" id="2029113">]</span><span class="op" id="2029114">)</span>&nbsp;<span class="op" id="2029116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2029122">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2029172">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2029223">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2029272">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2029324">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2029376">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2029420">if</span>&nbsp;<span class="builtinfunc" id="2029423">len</span><span class="op" id="2029426">(</span><span class="ident" id="2029427">p</span><span class="op" id="2029428">.</span><span class="ident" id="2029429">wsbuf</span><span class="op" id="2029434">)</span>&nbsp;<span class="op" id="2029436">!=</span>&nbsp;<span class="num" id="2029439">0</span>&nbsp;<span class="op" id="2029441">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029448">p</span><span class="op" id="2029449">.</span><span class="ident" id="2029450">internalError</span><span class="op" id="2029463">(</span><span class="string" id="2029464">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="2029493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2029499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029505">p</span><span class="op" id="2029506">.</span><span class="ident" id="2029507">wsbuf</span>&nbsp;<span class="op" id="2029513">=</span>&nbsp;<span class="ident" id="2029515">p</span><span class="op" id="2029516">.</span><span class="ident" id="2029517">wsbuf</span><span class="op" id="2029522">[</span><span class="num" id="2029523">0</span><span class="op" id="2029524">:</span><span class="num" id="2029525">1</span><span class="op" id="2029526">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029532">p</span><span class="op" id="2029533">.</span><span class="ident" id="2029534">wsbuf</span><span class="op" id="2029539">[</span><span class="num" id="2029540">0</span><span class="op" id="2029541">]</span>&nbsp;<span class="op" id="2029543">=</span>&nbsp;<span class="string" id="2029545">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2029552">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029557">data</span>&nbsp;<span class="op" id="2029562">=</span>&nbsp;<span class="ident" id="2029564">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2029569">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2029629">switch</span>&nbsp;<span class="ident" id="2029636">x</span>&nbsp;<span class="op" id="2029638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2029643">case</span>&nbsp;<span class="ident" id="2029648">token</span><span class="op" id="2029653">.</span><span class="ident" id="2029654">BREAK</span><span class="op" id="2029659">,</span>&nbsp;<span class="ident" id="2029661">token</span><span class="op" id="2029666">.</span><span class="ident" id="2029667">CONTINUE</span><span class="op" id="2029675">,</span>&nbsp;<span class="ident" id="2029677">token</span><span class="op" id="2029682">.</span><span class="ident" id="2029683">FALLTHROUGH</span><span class="op" id="2029694">,</span>&nbsp;<span class="ident" id="2029696">token</span><span class="op" id="2029701">.</span><span class="ident" id="2029702">RETURN</span><span class="op" id="2029708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029714">token</span><span class="op" id="2029719">.</span><span class="ident" id="2029720">INC</span><span class="op" id="2029723">,</span>&nbsp;<span class="ident" id="2029725">token</span><span class="op" id="2029730">.</span><span class="ident" id="2029731">DEC</span><span class="op" id="2029734">,</span>&nbsp;<span class="ident" id="2029736">token</span><span class="op" id="2029741">.</span><span class="ident" id="2029742">RPAREN</span><span class="op" id="2029748">,</span>&nbsp;<span class="ident" id="2029750">token</span><span class="op" id="2029755">.</span><span class="ident" id="2029756">RBRACK</span><span class="op" id="2029762">,</span>&nbsp;<span class="ident" id="2029764">token</span><span class="op" id="2029769">.</span><span class="ident" id="2029770">RBRACE</span><span class="op" id="2029776">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029782">impliedSemi</span>&nbsp;<span class="op" id="2029794">=</span>&nbsp;<span class="builtintype" id="2029796">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2029804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029809">p</span><span class="op" id="2029810">.</span><span class="ident" id="2029811">lastTok</span>&nbsp;<span class="op" id="2029819">=</span>&nbsp;<span class="ident" id="2029821">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2029826">case</span>&nbsp;<span class="ident" id="2029831">token</span><span class="op" id="2029836">.</span><span class="ident" id="2029837">Pos</span><span class="op" id="2029840">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2029845">if</span>&nbsp;<span class="ident" id="2029848">x</span><span class="op" id="2029849">.</span><span class="ident" id="2029850">IsValid</span><span class="op" id="2029857">(</span><span class="op" id="2029858">)</span>&nbsp;<span class="op" id="2029860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029866">p</span><span class="op" id="2029867">.</span><span class="ident" id="2029868">pos</span>&nbsp;<span class="op" id="2029872">=</span>&nbsp;<span class="ident" id="2029874">p</span><span class="op" id="2029875">.</span><span class="ident" id="2029876">posFor</span><span class="op" id="2029882">(</span><span class="ident" id="2029883">x</span><span class="op" id="2029884">)</span>&nbsp;<span class="comment" id="2029886">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2029923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2029928">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2029940">case</span>&nbsp;<span class="builtintype" id="2029945">string</span><span class="op" id="2029951">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2029956">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2029998">data</span>&nbsp;<span class="op" id="2030003">=</span>&nbsp;<span class="ident" id="2030005">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030010">isLit</span>&nbsp;<span class="op" id="2030016">=</span>&nbsp;<span class="builtintype" id="2030018">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030026">impliedSemi</span>&nbsp;<span class="op" id="2030038">=</span>&nbsp;<span class="builtintype" id="2030040">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030048">p</span><span class="op" id="2030049">.</span><span class="ident" id="2030050">lastTok</span>&nbsp;<span class="op" id="2030058">=</span>&nbsp;<span class="ident" id="2030060">token</span><span class="op" id="2030065">.</span><span class="ident" id="2030066">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2030076">default</span><span class="op" id="2030083">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030088">fmt</span><span class="op" id="2030091">.</span><span class="ident" id="2030092">Fprintf</span><span class="op" id="2030099">(</span><span class="ident" id="2030100">os</span><span class="op" id="2030102">.</span><span class="ident" id="2030103">Stderr</span><span class="op" id="2030109">,</span>&nbsp;<span class="string" id="2030111">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="2030150">,</span>&nbsp;<span class="ident" id="2030152">arg</span><span class="op" id="2030155">,</span>&nbsp;<span class="ident" id="2030157">arg</span><span class="op" id="2030160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2030165">panic</span><span class="op" id="2030170">(</span><span class="string" id="2030171">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="2030188">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2030192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2030196">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030213">next</span>&nbsp;<span class="op" id="2030218">:=</span>&nbsp;<span class="ident" id="2030221">p</span><span class="op" id="2030222">.</span><span class="ident" id="2030223">pos</span>&nbsp;<span class="comment" id="2030227">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030273">wroteNewline</span><span class="op" id="2030285">,</span>&nbsp;<span class="ident" id="2030287">droppedFF</span>&nbsp;<span class="op" id="2030297">:=</span>&nbsp;<span class="ident" id="2030300">p</span><span class="op" id="2030301">.</span><span class="ident" id="2030302">flush</span><span class="op" id="2030307">(</span><span class="ident" id="2030308">next</span><span class="op" id="2030312">,</span>&nbsp;<span class="ident" id="2030314">p</span><span class="op" id="2030315">.</span><span class="ident" id="2030316">lastTok</span><span class="op" id="2030323">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2030328">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2030389">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2030449">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2030514">if</span>&nbsp;<span class="op" id="2030517">!</span><span class="ident" id="2030518">p</span><span class="op" id="2030519">.</span><span class="ident" id="2030520">impliedSemi</span>&nbsp;<span class="op" id="2030532">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030537">n</span>&nbsp;<span class="op" id="2030539">:=</span>&nbsp;<span class="ident" id="2030542">nlimit</span><span class="op" id="2030548">(</span><span class="ident" id="2030549">next</span><span class="op" id="2030553">.</span><span class="ident" id="2030554">Line</span>&nbsp;<span class="op" id="2030559">-</span>&nbsp;<span class="ident" id="2030561">p</span><span class="op" id="2030562">.</span><span class="ident" id="2030563">pos</span><span class="op" id="2030566">.</span><span class="ident" id="2030567">Line</span><span class="op" id="2030571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2030576">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2030631">if</span>&nbsp;<span class="ident" id="2030634">wroteNewline</span>&nbsp;<span class="op" id="2030647">&amp;&amp;</span>&nbsp;<span class="ident" id="2030650">n</span>&nbsp;<span class="op" id="2030652">==</span>&nbsp;<span class="ident" id="2030655">maxNewlines</span>&nbsp;<span class="op" id="2030667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030673">n</span>&nbsp;<span class="op" id="2030675">=</span>&nbsp;<span class="ident" id="2030677">maxNewlines</span>&nbsp;<span class="op" id="2030689">-</span>&nbsp;<span class="num" id="2030691">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2030696">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2030701">if</span>&nbsp;<span class="ident" id="2030704">n</span>&nbsp;<span class="op" id="2030706">&gt;</span>&nbsp;<span class="num" id="2030708">0</span>&nbsp;<span class="op" id="2030710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030716">ch</span>&nbsp;<span class="op" id="2030719">:=</span>&nbsp;<span class="builtintype" id="2030722">byte</span><span class="op" id="2030726">(</span><span class="string" id="2030727">&#39;\n&#39;</span><span class="op" id="2030731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2030737">if</span>&nbsp;<span class="ident" id="2030740">droppedFF</span>&nbsp;<span class="op" id="2030750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030757">ch</span>&nbsp;<span class="op" id="2030760">=</span>&nbsp;<span class="string" id="2030762">&#39;\f&#39;</span>&nbsp;<span class="comment" id="2030767">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2030815">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030821">p</span><span class="op" id="2030822">.</span><span class="ident" id="2030823">writeByte</span><span class="op" id="2030832">(</span><span class="ident" id="2030833">ch</span><span class="op" id="2030835">,</span>&nbsp;<span class="ident" id="2030837">n</span><span class="op" id="2030838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030844">impliedSemi</span>&nbsp;<span class="op" id="2030856">=</span>&nbsp;<span class="builtintype" id="2030858">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2030867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2030871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2030876">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2030945">if</span>&nbsp;<span class="ident" id="2030948">p</span><span class="op" id="2030949">.</span><span class="ident" id="2030950">linePtr</span>&nbsp;<span class="op" id="2030958">!=</span>&nbsp;<span class="ident" id="2030961">nil</span>&nbsp;<span class="op" id="2030965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2030970">*</span><span class="ident" id="2030971">p</span><span class="op" id="2030972">.</span><span class="ident" id="2030973">linePtr</span>&nbsp;<span class="op" id="2030981">=</span>&nbsp;<span class="ident" id="2030983">p</span><span class="op" id="2030984">.</span><span class="ident" id="2030985">out</span><span class="op" id="2030988">.</span><span class="ident" id="2030989">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2030997">p</span><span class="op" id="2030998">.</span><span class="ident" id="2030999">linePtr</span>&nbsp;<span class="op" id="2031007">=</span>&nbsp;<span class="ident" id="2031009">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2031015">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2031020">p</span><span class="op" id="2031021">.</span><span class="ident" id="2031022">writeString</span><span class="op" id="2031033">(</span><span class="ident" id="2031034">next</span><span class="op" id="2031038">,</span>&nbsp;<span class="ident" id="2031040">data</span><span class="op" id="2031044">,</span>&nbsp;<span class="ident" id="2031046">isLit</span><span class="op" id="2031051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2031055">p</span><span class="op" id="2031056">.</span><span class="ident" id="2031057">impliedSemi</span>&nbsp;<span class="op" id="2031069">=</span>&nbsp;<span class="ident" id="2031071">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2031084">}</span><br>
<span class="lineno"></span><span class="op" id="2031086">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="2031089">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="2031161">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="2031234">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="2031311">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="2031322">//</span><br>
<span class="lineno"></span><span class="keyword" id="2031325">func</span>&nbsp;<span class="op" id="2031330">(</span><span class="ident" id="2031331">p</span>&nbsp;<span class="op" id="2031333">*</span><span class="ident" id="2031334">printer</span><span class="op" id="2031341">)</span>&nbsp;<span class="ident" id="2031343">flush</span><span class="op" id="2031348">(</span><span class="ident" id="2031349">next</span>&nbsp;<span class="ident" id="2031354">token</span><span class="op" id="2031359">.</span><span class="ident" id="2031360">Position</span><span class="op" id="2031368">,</span>&nbsp;<span class="ident" id="2031370">tok</span>&nbsp;<span class="ident" id="2031374">token</span><span class="op" id="2031379">.</span><span class="ident" id="2031380">Token</span><span class="op" id="2031385">)</span>&nbsp;<span class="op" id="2031387">(</span><span class="ident" id="2031388">wroteNewline</span><span class="op" id="2031400">,</span>&nbsp;<span class="ident" id="2031402">droppedFF</span>&nbsp;<span class="builtintype" id="2031412">bool</span><span class="op" id="2031416">)</span>&nbsp;<span class="op" id="2031418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031421">if</span>&nbsp;<span class="ident" id="2031424">p</span><span class="op" id="2031425">.</span><span class="ident" id="2031426">commentBefore</span><span class="op" id="2031439">(</span><span class="ident" id="2031440">next</span><span class="op" id="2031444">)</span>&nbsp;<span class="op" id="2031446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2031450">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2031516">wroteNewline</span><span class="op" id="2031528">,</span>&nbsp;<span class="ident" id="2031530">droppedFF</span>&nbsp;<span class="op" id="2031540">=</span>&nbsp;<span class="ident" id="2031542">p</span><span class="op" id="2031543">.</span><span class="ident" id="2031544">intersperseComments</span><span class="op" id="2031563">(</span><span class="ident" id="2031564">next</span><span class="op" id="2031568">,</span>&nbsp;<span class="ident" id="2031570">tok</span><span class="op" id="2031573">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2031576">}</span>&nbsp;<span class="keyword" id="2031578">else</span>&nbsp;<span class="op" id="2031583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2031587">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2031633">p</span><span class="op" id="2031634">.</span><span class="ident" id="2031635">writeWhitespace</span><span class="op" id="2031650">(</span><span class="builtinfunc" id="2031651">len</span><span class="op" id="2031654">(</span><span class="ident" id="2031655">p</span><span class="op" id="2031656">.</span><span class="ident" id="2031657">wsbuf</span><span class="op" id="2031662">)</span><span class="op" id="2031663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2031666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031669">return</span><br>
<span class="lineno">990</span><span class="op" id="2031676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2031679">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2031746">func</span>&nbsp;<span class="ident" id="2031751">getDoc</span><span class="op" id="2031757">(</span><span class="ident" id="2031758">n</span>&nbsp;<span class="ident" id="2031760">ast</span><span class="op" id="2031763">.</span><span class="ident" id="2031764">Node</span><span class="op" id="2031768">)</span>&nbsp;<span class="op" id="2031770">*</span><span class="ident" id="2031771">ast</span><span class="op" id="2031774">.</span><span class="ident" id="2031775">CommentGroup</span>&nbsp;<span class="op" id="2031788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031791">switch</span>&nbsp;<span class="ident" id="2031798">n</span>&nbsp;<span class="op" id="2031800">:=</span>&nbsp;<span class="ident" id="2031803">n</span><span class="op" id="2031804">.</span><span class="op" id="2031805">(</span><span class="keyword" id="2031806">type</span><span class="op" id="2031810">)</span>&nbsp;<span class="op" id="2031812">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031815">case</span>&nbsp;<span class="op" id="2031820">*</span><span class="ident" id="2031821">ast</span><span class="op" id="2031824">.</span><span class="ident" id="2031825">Field</span><span class="op" id="2031830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031834">return</span>&nbsp;<span class="ident" id="2031841">n</span><span class="op" id="2031842">.</span><span class="ident" id="2031843">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031848">case</span>&nbsp;<span class="op" id="2031853">*</span><span class="ident" id="2031854">ast</span><span class="op" id="2031857">.</span><span class="ident" id="2031858">ImportSpec</span><span class="op" id="2031868">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031872">return</span>&nbsp;<span class="ident" id="2031879">n</span><span class="op" id="2031880">.</span><span class="ident" id="2031881">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031886">case</span>&nbsp;<span class="op" id="2031891">*</span><span class="ident" id="2031892">ast</span><span class="op" id="2031895">.</span><span class="ident" id="2031896">ValueSpec</span><span class="op" id="2031905">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031909">return</span>&nbsp;<span class="ident" id="2031916">n</span><span class="op" id="2031917">.</span><span class="ident" id="2031918">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031923">case</span>&nbsp;<span class="op" id="2031928">*</span><span class="ident" id="2031929">ast</span><span class="op" id="2031932">.</span><span class="ident" id="2031933">TypeSpec</span><span class="op" id="2031941">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031945">return</span>&nbsp;<span class="ident" id="2031952">n</span><span class="op" id="2031953">.</span><span class="ident" id="2031954">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031959">case</span>&nbsp;<span class="op" id="2031964">*</span><span class="ident" id="2031965">ast</span><span class="op" id="2031968">.</span><span class="ident" id="2031969">GenDecl</span><span class="op" id="2031976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031980">return</span>&nbsp;<span class="ident" id="2031987">n</span><span class="op" id="2031988">.</span><span class="ident" id="2031989">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2031994">case</span>&nbsp;<span class="op" id="2031999">*</span><span class="ident" id="2032000">ast</span><span class="op" id="2032003">.</span><span class="ident" id="2032004">FuncDecl</span><span class="op" id="2032012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032016">return</span>&nbsp;<span class="ident" id="2032023">n</span><span class="op" id="2032024">.</span><span class="ident" id="2032025">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032030">case</span>&nbsp;<span class="op" id="2032035">*</span><span class="ident" id="2032036">ast</span><span class="op" id="2032039">.</span><span class="ident" id="2032040">File</span><span class="op" id="2032044">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032048">return</span>&nbsp;<span class="ident" id="2032055">n</span><span class="op" id="2032056">.</span><span class="ident" id="2032057">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2032062">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032065">return</span>&nbsp;<span class="ident" id="2032072">nil</span><br>
<span class="lineno"></span><span class="op" id="2032076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2032079">func</span>&nbsp;<span class="op" id="2032084">(</span><span class="ident" id="2032085">p</span>&nbsp;<span class="op" id="2032087">*</span><span class="ident" id="2032088">printer</span><span class="op" id="2032095">)</span>&nbsp;<span class="ident" id="2032097">printNode</span><span class="op" id="2032106">(</span><span class="ident" id="2032107">node</span>&nbsp;<span class="keyword" id="2032112">interface</span><span class="op" id="2032121">{</span><span class="op" id="2032122">}</span><span class="op" id="2032123">)</span>&nbsp;<span class="builtintype" id="2032125">error</span>&nbsp;<span class="op" id="2032131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032134">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032168">var</span>&nbsp;<span class="ident" id="2032172">comments</span>&nbsp;<span class="op" id="2032181">[</span><span class="op" id="2032182">]</span><span class="op" id="2032183">*</span><span class="ident" id="2032184">ast</span><span class="op" id="2032187">.</span><span class="ident" id="2032188">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032202">if</span>&nbsp;<span class="ident" id="2032205">cnode</span><span class="op" id="2032210">,</span>&nbsp;<span class="ident" id="2032212">ok</span>&nbsp;<span class="op" id="2032215">:=</span>&nbsp;<span class="ident" id="2032218">node</span><span class="op" id="2032222">.</span><span class="op" id="2032223">(</span><span class="op" id="2032224">*</span><span class="ident" id="2032225">CommentedNode</span><span class="op" id="2032238">)</span><span class="op" id="2032239">;</span>&nbsp;<span class="ident" id="2032241">ok</span>&nbsp;<span class="op" id="2032244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032248">node</span>&nbsp;<span class="op" id="2032253">=</span>&nbsp;<span class="ident" id="2032255">cnode</span><span class="op" id="2032260">.</span><span class="ident" id="2032261">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032268">comments</span>&nbsp;<span class="op" id="2032277">=</span>&nbsp;<span class="ident" id="2032279">cnode</span><span class="op" id="2032284">.</span><span class="ident" id="2032285">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2032295">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032299">if</span>&nbsp;<span class="ident" id="2032302">comments</span>&nbsp;<span class="op" id="2032311">!=</span>&nbsp;<span class="ident" id="2032314">nil</span>&nbsp;<span class="op" id="2032318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032322">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032384">n</span><span class="op" id="2032385">,</span>&nbsp;<span class="ident" id="2032387">ok</span>&nbsp;<span class="op" id="2032390">:=</span>&nbsp;<span class="ident" id="2032393">node</span><span class="op" id="2032397">.</span><span class="op" id="2032398">(</span><span class="ident" id="2032399">ast</span><span class="op" id="2032402">.</span><span class="ident" id="2032403">Node</span><span class="op" id="2032407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032411">if</span>&nbsp;<span class="op" id="2032414">!</span><span class="ident" id="2032415">ok</span>&nbsp;<span class="op" id="2032418">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032423">goto</span>&nbsp;<span class="ident" id="2032428">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2032442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032446">beg</span>&nbsp;<span class="op" id="2032450">:=</span>&nbsp;<span class="ident" id="2032453">n</span><span class="op" id="2032454">.</span><span class="ident" id="2032455">Pos</span><span class="op" id="2032458">(</span><span class="op" id="2032459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032463">end</span>&nbsp;<span class="op" id="2032467">:=</span>&nbsp;<span class="ident" id="2032470">n</span><span class="op" id="2032471">.</span><span class="ident" id="2032472">End</span><span class="op" id="2032475">(</span><span class="op" id="2032476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032480">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032527">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032571">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032617">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032668">if</span>&nbsp;<span class="ident" id="2032671">doc</span>&nbsp;<span class="op" id="2032675">:=</span>&nbsp;<span class="ident" id="2032678">getDoc</span><span class="op" id="2032684">(</span><span class="ident" id="2032685">n</span><span class="op" id="2032686">)</span><span class="op" id="2032687">;</span>&nbsp;<span class="ident" id="2032689">doc</span>&nbsp;<span class="op" id="2032693">!=</span>&nbsp;<span class="ident" id="2032696">nil</span>&nbsp;<span class="op" id="2032700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032705">beg</span>&nbsp;<span class="op" id="2032709">=</span>&nbsp;<span class="ident" id="2032711">doc</span><span class="op" id="2032714">.</span><span class="ident" id="2032715">Pos</span><span class="op" id="2032718">(</span><span class="op" id="2032719">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2032723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032727">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032776">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032803">i</span>&nbsp;<span class="op" id="2032805">:=</span>&nbsp;<span class="num" id="2032808">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032812">for</span>&nbsp;<span class="ident" id="2032816">i</span>&nbsp;<span class="op" id="2032818">&lt;</span>&nbsp;<span class="builtinfunc" id="2032820">len</span><span class="op" id="2032823">(</span><span class="ident" id="2032824">comments</span><span class="op" id="2032832">)</span>&nbsp;<span class="op" id="2032834">&amp;&amp;</span>&nbsp;<span class="ident" id="2032837">comments</span><span class="op" id="2032845">[</span><span class="ident" id="2032846">i</span><span class="op" id="2032847">]</span><span class="op" id="2032848">.</span><span class="ident" id="2032849">End</span><span class="op" id="2032852">(</span><span class="op" id="2032853">)</span>&nbsp;<span class="op" id="2032855">&lt;</span>&nbsp;<span class="ident" id="2032857">beg</span>&nbsp;<span class="op" id="2032861">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032866">i</span><span class="op" id="2032867">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2032872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032876">j</span>&nbsp;<span class="op" id="2032878">:=</span>&nbsp;<span class="ident" id="2032881">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032885">for</span>&nbsp;<span class="ident" id="2032889">j</span>&nbsp;<span class="op" id="2032891">&lt;</span>&nbsp;<span class="builtinfunc" id="2032893">len</span><span class="op" id="2032896">(</span><span class="ident" id="2032897">comments</span><span class="op" id="2032905">)</span>&nbsp;<span class="op" id="2032907">&amp;&amp;</span>&nbsp;<span class="ident" id="2032910">comments</span><span class="op" id="2032918">[</span><span class="ident" id="2032919">j</span><span class="op" id="2032920">]</span><span class="op" id="2032921">.</span><span class="ident" id="2032922">Pos</span><span class="op" id="2032925">(</span><span class="op" id="2032926">)</span>&nbsp;<span class="op" id="2032928">&lt;</span>&nbsp;<span class="ident" id="2032930">end</span>&nbsp;<span class="op" id="2032934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032939">j</span><span class="op" id="2032940">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2032945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2032949">if</span>&nbsp;<span class="ident" id="2032952">i</span>&nbsp;<span class="op" id="2032954">&lt;</span>&nbsp;<span class="ident" id="2032956">j</span>&nbsp;<span class="op" id="2032958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032963">p</span><span class="op" id="2032964">.</span><span class="ident" id="2032965">comments</span>&nbsp;<span class="op" id="2032974">=</span>&nbsp;<span class="ident" id="2032976">comments</span><span class="op" id="2032984">[</span><span class="ident" id="2032985">i</span><span class="op" id="2032986">:</span><span class="ident" id="2032987">j</span><span class="op" id="2032988">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2032992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2032995">}</span>&nbsp;<span class="keyword" id="2032997">else</span>&nbsp;<span class="keyword" id="2033002">if</span>&nbsp;<span class="ident" id="2033005">n</span><span class="op" id="2033006">,</span>&nbsp;<span class="ident" id="2033008">ok</span>&nbsp;<span class="op" id="2033011">:=</span>&nbsp;<span class="ident" id="2033014">node</span><span class="op" id="2033018">.</span><span class="op" id="2033019">(</span><span class="op" id="2033020">*</span><span class="ident" id="2033021">ast</span><span class="op" id="2033024">.</span><span class="ident" id="2033025">File</span><span class="op" id="2033029">)</span><span class="op" id="2033030">;</span>&nbsp;<span class="ident" id="2033032">ok</span>&nbsp;<span class="op" id="2033035">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2033039">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033074">p</span><span class="op" id="2033075">.</span><span class="ident" id="2033076">comments</span>&nbsp;<span class="op" id="2033085">=</span>&nbsp;<span class="ident" id="2033087">n</span><span class="op" id="2033088">.</span><span class="ident" id="2033089">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2033099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2033103">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033151">p</span><span class="op" id="2033152">.</span><span class="ident" id="2033153">useNodeComments</span>&nbsp;<span class="op" id="2033169">=</span>&nbsp;<span class="ident" id="2033171">p</span><span class="op" id="2033172">.</span><span class="ident" id="2033173">comments</span>&nbsp;<span class="op" id="2033182">==</span>&nbsp;<span class="ident" id="2033185">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2033191">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033222">p</span><span class="op" id="2033223">.</span><span class="ident" id="2033224">nextComment</span><span class="op" id="2033235">(</span><span class="op" id="2033236">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2033240">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033256">switch</span>&nbsp;<span class="ident" id="2033263">n</span>&nbsp;<span class="op" id="2033265">:=</span>&nbsp;<span class="ident" id="2033268">node</span><span class="op" id="2033272">.</span><span class="op" id="2033273">(</span><span class="keyword" id="2033274">type</span><span class="op" id="2033278">)</span>&nbsp;<span class="op" id="2033280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033283">case</span>&nbsp;<span class="ident" id="2033288">ast</span><span class="op" id="2033291">.</span><span class="ident" id="2033292">Expr</span><span class="op" id="2033296">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033300">p</span><span class="op" id="2033301">.</span><span class="ident" id="2033302">expr</span><span class="op" id="2033306">(</span><span class="ident" id="2033307">n</span><span class="op" id="2033308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033311">case</span>&nbsp;<span class="ident" id="2033316">ast</span><span class="op" id="2033319">.</span><span class="ident" id="2033320">Stmt</span><span class="op" id="2033324">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2033328">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2033391">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033450">if</span>&nbsp;<span class="ident" id="2033453">_</span><span class="op" id="2033454">,</span>&nbsp;<span class="ident" id="2033456">ok</span>&nbsp;<span class="op" id="2033459">:=</span>&nbsp;<span class="ident" id="2033462">n</span><span class="op" id="2033463">.</span><span class="op" id="2033464">(</span><span class="op" id="2033465">*</span><span class="ident" id="2033466">ast</span><span class="op" id="2033469">.</span><span class="ident" id="2033470">LabeledStmt</span><span class="op" id="2033481">)</span><span class="op" id="2033482">;</span>&nbsp;<span class="ident" id="2033484">ok</span>&nbsp;<span class="op" id="2033487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033492">p</span><span class="op" id="2033493">.</span><span class="ident" id="2033494">indent</span>&nbsp;<span class="op" id="2033501">=</span>&nbsp;<span class="num" id="2033503">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2033507">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033511">p</span><span class="op" id="2033512">.</span><span class="ident" id="2033513">stmt</span><span class="op" id="2033517">(</span><span class="ident" id="2033518">n</span><span class="op" id="2033519">,</span>&nbsp;<span class="builtintype" id="2033521">false</span><span class="op" id="2033526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033529">case</span>&nbsp;<span class="ident" id="2033534">ast</span><span class="op" id="2033537">.</span><span class="ident" id="2033538">Decl</span><span class="op" id="2033542">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033546">p</span><span class="op" id="2033547">.</span><span class="ident" id="2033548">decl</span><span class="op" id="2033552">(</span><span class="ident" id="2033553">n</span><span class="op" id="2033554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033557">case</span>&nbsp;<span class="ident" id="2033562">ast</span><span class="op" id="2033565">.</span><span class="ident" id="2033566">Spec</span><span class="op" id="2033570">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033574">p</span><span class="op" id="2033575">.</span><span class="ident" id="2033576">spec</span><span class="op" id="2033580">(</span><span class="ident" id="2033581">n</span><span class="op" id="2033582">,</span>&nbsp;<span class="num" id="2033584">1</span><span class="op" id="2033585">,</span>&nbsp;<span class="builtintype" id="2033587">false</span><span class="op" id="2033592">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033595">case</span>&nbsp;<span class="op" id="2033600">[</span><span class="op" id="2033601">]</span><span class="ident" id="2033602">ast</span><span class="op" id="2033605">.</span><span class="ident" id="2033606">Stmt</span><span class="op" id="2033610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2033614">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2033677">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033736">for</span>&nbsp;<span class="ident" id="2033740">_</span><span class="op" id="2033741">,</span>&nbsp;<span class="ident" id="2033743">s</span>&nbsp;<span class="op" id="2033745">:=</span>&nbsp;<span class="keyword" id="2033748">range</span>&nbsp;<span class="ident" id="2033754">n</span>&nbsp;<span class="op" id="2033756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033761">if</span>&nbsp;<span class="ident" id="2033764">_</span><span class="op" id="2033765">,</span>&nbsp;<span class="ident" id="2033767">ok</span>&nbsp;<span class="op" id="2033770">:=</span>&nbsp;<span class="ident" id="2033773">s</span><span class="op" id="2033774">.</span><span class="op" id="2033775">(</span><span class="op" id="2033776">*</span><span class="ident" id="2033777">ast</span><span class="op" id="2033780">.</span><span class="ident" id="2033781">LabeledStmt</span><span class="op" id="2033792">)</span><span class="op" id="2033793">;</span>&nbsp;<span class="ident" id="2033795">ok</span>&nbsp;<span class="op" id="2033798">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033804">p</span><span class="op" id="2033805">.</span><span class="ident" id="2033806">indent</span>&nbsp;<span class="op" id="2033813">=</span>&nbsp;<span class="num" id="2033815">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2033820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2033824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033828">p</span><span class="op" id="2033829">.</span><span class="ident" id="2033830">stmtList</span><span class="op" id="2033838">(</span><span class="ident" id="2033839">n</span><span class="op" id="2033840">,</span>&nbsp;<span class="num" id="2033842">0</span><span class="op" id="2033843">,</span>&nbsp;<span class="builtintype" id="2033845">false</span><span class="op" id="2033850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033853">case</span>&nbsp;<span class="op" id="2033858">[</span><span class="op" id="2033859">]</span><span class="ident" id="2033860">ast</span><span class="op" id="2033863">.</span><span class="ident" id="2033864">Decl</span><span class="op" id="2033868">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033872">p</span><span class="op" id="2033873">.</span><span class="ident" id="2033874">declList</span><span class="op" id="2033882">(</span><span class="ident" id="2033883">n</span><span class="op" id="2033884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033887">case</span>&nbsp;<span class="op" id="2033892">*</span><span class="ident" id="2033893">ast</span><span class="op" id="2033896">.</span><span class="ident" id="2033897">File</span><span class="op" id="2033901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033905">p</span><span class="op" id="2033906">.</span><span class="ident" id="2033907">file</span><span class="op" id="2033911">(</span><span class="ident" id="2033912">n</span><span class="op" id="2033913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033916">default</span><span class="op" id="2033923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033927">goto</span>&nbsp;<span class="ident" id="2033932">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2033945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033949">return</span>&nbsp;<span class="ident" id="2033956">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="2033961">unsupported</span><span class="op" id="2033972">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033975">return</span>&nbsp;<span class="ident" id="2033982">fmt</span><span class="op" id="2033985">.</span><span class="ident" id="2033986">Errorf</span><span class="op" id="2033992">(</span><span class="string" id="2033993">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="2034031">,</span>&nbsp;<span class="ident" id="2034033">node</span><span class="op" id="2034037">)</span><br>
<span class="lineno"></span><span class="op" id="2034039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2034042">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2034122">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="2034134">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="2034201">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="2034270">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="2034339">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="2034408">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="2034430">//</span><br>
<span class="lineno"></span><span class="keyword" id="2034433">type</span>&nbsp;<span class="ident" id="2034438">trimmer</span>&nbsp;<span class="keyword" id="2034446">struct</span>&nbsp;<span class="op" id="2034453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034456">output</span>&nbsp;<span class="ident" id="2034463">io</span><span class="op" id="2034465">.</span><span class="ident" id="2034466">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034474">state</span>&nbsp;&nbsp;<span class="builtintype" id="2034481">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034486">space</span>&nbsp;&nbsp;<span class="op" id="2034493">[</span><span class="op" id="2034494">]</span><span class="builtintype" id="2034495">byte</span><br>
<span class="lineno"></span><span class="op" id="2034500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2034503">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="2034549">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="2034594">const</span>&nbsp;<span class="op" id="2034600">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034603">inSpace</span>&nbsp;&nbsp;<span class="op" id="2034612">=</span>&nbsp;<span class="ident" id="2034614">iota</span>&nbsp;<span class="comment" id="2034619">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034636">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2034652">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034699">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2034715">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="2034730">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="2034733">func</span>&nbsp;<span class="op" id="2034738">(</span><span class="ident" id="2034739">p</span>&nbsp;<span class="op" id="2034741">*</span><span class="ident" id="2034742">trimmer</span><span class="op" id="2034749">)</span>&nbsp;<span class="ident" id="2034751">resetSpace</span><span class="op" id="2034761">(</span><span class="op" id="2034762">)</span>&nbsp;<span class="op" id="2034764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034767">p</span><span class="op" id="2034768">.</span><span class="ident" id="2034769">state</span>&nbsp;<span class="op" id="2034775">=</span>&nbsp;<span class="ident" id="2034777">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034786">p</span><span class="op" id="2034787">.</span><span class="ident" id="2034788">space</span>&nbsp;<span class="op" id="2034794">=</span>&nbsp;<span class="ident" id="2034796">p</span><span class="op" id="2034797">.</span><span class="ident" id="2034798">space</span><span class="op" id="2034803">[</span><span class="num" id="2034804">0</span><span class="op" id="2034805">:</span><span class="num" id="2034806">0</span><span class="op" id="2034807">]</span><br>
<span class="lineno"></span><span class="op" id="2034809">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="2034812">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2034882">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="2034952">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="2035020">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="2035087">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2035119">var</span>&nbsp;<span class="ident" id="2035123">aNewline</span>&nbsp;<span class="op" id="2035132">=</span>&nbsp;<span class="op" id="2035134">[</span><span class="op" id="2035135">]</span><span class="builtintype" id="2035136">byte</span><span class="op" id="2035140">(</span><span class="string" id="2035141">&#34;\n&#34;</span><span class="op" id="2035145">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2035148">func</span>&nbsp;<span class="op" id="2035153">(</span><span class="ident" id="2035154">p</span>&nbsp;<span class="op" id="2035156">*</span><span class="ident" id="2035157">trimmer</span><span class="op" id="2035164">)</span>&nbsp;<span class="ident" id="2035166">Write</span><span class="op" id="2035171">(</span><span class="ident" id="2035172">data</span>&nbsp;<span class="op" id="2035177">[</span><span class="op" id="2035178">]</span><span class="builtintype" id="2035179">byte</span><span class="op" id="2035183">)</span>&nbsp;<span class="op" id="2035185">(</span><span class="ident" id="2035186">n</span>&nbsp;<span class="builtintype" id="2035188">int</span><span class="op" id="2035191">,</span>&nbsp;<span class="ident" id="2035193">err</span>&nbsp;<span class="builtintype" id="2035197">error</span><span class="op" id="2035202">)</span>&nbsp;<span class="op" id="2035204">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035207">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035223">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035247">//&nbsp;&nbsp;&nbsp;&nbspp.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035272">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035305">//&nbsp;&nbsp;&nbsp;&nbspdata[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035332">m</span>&nbsp;<span class="op" id="2035334">:=</span>&nbsp;<span class="num" id="2035337">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035340">var</span>&nbsp;<span class="ident" id="2035344">b</span>&nbsp;<span class="builtintype" id="2035346">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035352">for</span>&nbsp;<span class="ident" id="2035356">n</span><span class="op" id="2035357">,</span>&nbsp;<span class="ident" id="2035359">b</span>&nbsp;<span class="op" id="2035361">=</span>&nbsp;<span class="keyword" id="2035363">range</span>&nbsp;<span class="ident" id="2035369">data</span>&nbsp;<span class="op" id="2035374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035378">if</span>&nbsp;<span class="ident" id="2035381">b</span>&nbsp;<span class="op" id="2035383">==</span>&nbsp;<span class="string" id="2035386">&#39;\v&#39;</span>&nbsp;<span class="op" id="2035391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035396">b</span>&nbsp;<span class="op" id="2035398">=</span>&nbsp;<span class="string" id="2035400">&#39;\t&#39;</span>&nbsp;<span class="comment" id="2035405">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035430">switch</span>&nbsp;<span class="ident" id="2035437">p</span><span class="op" id="2035438">.</span><span class="ident" id="2035439">state</span>&nbsp;<span class="op" id="2035445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035449">case</span>&nbsp;<span class="ident" id="2035454">inSpace</span><span class="op" id="2035461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035466">switch</span>&nbsp;<span class="ident" id="2035473">b</span>&nbsp;<span class="op" id="2035475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035480">case</span>&nbsp;<span class="string" id="2035485">&#39;\t&#39;</span><span class="op" id="2035489">,</span>&nbsp;<span class="string" id="2035491">&#39;&nbsp;&#39;</span><span class="op" id="2035494">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035500">p</span><span class="op" id="2035501">.</span><span class="ident" id="2035502">space</span>&nbsp;<span class="op" id="2035508">=</span>&nbsp;<span class="builtinfunc" id="2035510">append</span><span class="op" id="2035516">(</span><span class="ident" id="2035517">p</span><span class="op" id="2035518">.</span><span class="ident" id="2035519">space</span><span class="op" id="2035524">,</span>&nbsp;<span class="ident" id="2035526">b</span><span class="op" id="2035527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035532">case</span>&nbsp;<span class="string" id="2035537">&#39;\n&#39;</span><span class="op" id="2035541">,</span>&nbsp;<span class="string" id="2035543">&#39;\f&#39;</span><span class="op" id="2035547">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035553">p</span><span class="op" id="2035554">.</span><span class="ident" id="2035555">resetSpace</span><span class="op" id="2035565">(</span><span class="op" id="2035566">)</span>&nbsp;<span class="comment" id="2035568">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035598">_</span><span class="op" id="2035599">,</span>&nbsp;<span class="ident" id="2035601">err</span>&nbsp;<span class="op" id="2035605">=</span>&nbsp;<span class="ident" id="2035607">p</span><span class="op" id="2035608">.</span><span class="ident" id="2035609">output</span><span class="op" id="2035615">.</span><span class="ident" id="2035616">Write</span><span class="op" id="2035621">(</span><span class="ident" id="2035622">aNewline</span><span class="op" id="2035630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035635">case</span>&nbsp;<span class="ident" id="2035640">tabwriter</span><span class="op" id="2035649">.</span><span class="ident" id="2035650">Escape</span><span class="op" id="2035656">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035662">_</span><span class="op" id="2035663">,</span>&nbsp;<span class="ident" id="2035665">err</span>&nbsp;<span class="op" id="2035669">=</span>&nbsp;<span class="ident" id="2035671">p</span><span class="op" id="2035672">.</span><span class="ident" id="2035673">output</span><span class="op" id="2035679">.</span><span class="ident" id="2035680">Write</span><span class="op" id="2035685">(</span><span class="ident" id="2035686">p</span><span class="op" id="2035687">.</span><span class="ident" id="2035688">space</span><span class="op" id="2035693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035699">p</span><span class="op" id="2035700">.</span><span class="ident" id="2035701">state</span>&nbsp;<span class="op" id="2035707">=</span>&nbsp;<span class="ident" id="2035709">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035722">m</span>&nbsp;<span class="op" id="2035724">=</span>&nbsp;<span class="ident" id="2035726">n</span>&nbsp;<span class="op" id="2035728">+</span>&nbsp;<span class="num" id="2035730">1</span>&nbsp;<span class="comment" id="2035732">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035764">default</span><span class="op" id="2035771">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035777">_</span><span class="op" id="2035778">,</span>&nbsp;<span class="ident" id="2035780">err</span>&nbsp;<span class="op" id="2035784">=</span>&nbsp;<span class="ident" id="2035786">p</span><span class="op" id="2035787">.</span><span class="ident" id="2035788">output</span><span class="op" id="2035794">.</span><span class="ident" id="2035795">Write</span><span class="op" id="2035800">(</span><span class="ident" id="2035801">p</span><span class="op" id="2035802">.</span><span class="ident" id="2035803">space</span><span class="op" id="2035808">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035814">p</span><span class="op" id="2035815">.</span><span class="ident" id="2035816">state</span>&nbsp;<span class="op" id="2035822">=</span>&nbsp;<span class="ident" id="2035824">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035835">m</span>&nbsp;<span class="op" id="2035837">=</span>&nbsp;<span class="ident" id="2035839">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035848">case</span>&nbsp;<span class="ident" id="2035853">inEscape</span><span class="op" id="2035861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035866">if</span>&nbsp;<span class="ident" id="2035869">b</span>&nbsp;<span class="op" id="2035871">==</span>&nbsp;<span class="ident" id="2035874">tabwriter</span><span class="op" id="2035883">.</span><span class="ident" id="2035884">Escape</span>&nbsp;<span class="op" id="2035891">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035897">_</span><span class="op" id="2035898">,</span>&nbsp;<span class="ident" id="2035900">err</span>&nbsp;<span class="op" id="2035904">=</span>&nbsp;<span class="ident" id="2035906">p</span><span class="op" id="2035907">.</span><span class="ident" id="2035908">output</span><span class="op" id="2035914">.</span><span class="ident" id="2035915">Write</span><span class="op" id="2035920">(</span><span class="ident" id="2035921">data</span><span class="op" id="2035925">[</span><span class="ident" id="2035926">m</span><span class="op" id="2035927">:</span><span class="ident" id="2035928">n</span><span class="op" id="2035929">]</span><span class="op" id="2035930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035936">p</span><span class="op" id="2035937">.</span><span class="ident" id="2035938">resetSpace</span><span class="op" id="2035948">(</span><span class="op" id="2035949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035958">case</span>&nbsp;<span class="ident" id="2035963">inText</span><span class="op" id="2035969">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035974">switch</span>&nbsp;<span class="ident" id="2035981">b</span>&nbsp;<span class="op" id="2035983">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035988">case</span>&nbsp;<span class="string" id="2035993">&#39;\t&#39;</span><span class="op" id="2035997">,</span>&nbsp;<span class="string" id="2035999">&#39;&nbsp;&#39;</span><span class="op" id="2036002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036008">_</span><span class="op" id="2036009">,</span>&nbsp;<span class="ident" id="2036011">err</span>&nbsp;<span class="op" id="2036015">=</span>&nbsp;<span class="ident" id="2036017">p</span><span class="op" id="2036018">.</span><span class="ident" id="2036019">output</span><span class="op" id="2036025">.</span><span class="ident" id="2036026">Write</span><span class="op" id="2036031">(</span><span class="ident" id="2036032">data</span><span class="op" id="2036036">[</span><span class="ident" id="2036037">m</span><span class="op" id="2036038">:</span><span class="ident" id="2036039">n</span><span class="op" id="2036040">]</span><span class="op" id="2036041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036047">p</span><span class="op" id="2036048">.</span><span class="ident" id="2036049">resetSpace</span><span class="op" id="2036059">(</span><span class="op" id="2036060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036066">p</span><span class="op" id="2036067">.</span><span class="ident" id="2036068">space</span>&nbsp;<span class="op" id="2036074">=</span>&nbsp;<span class="builtinfunc" id="2036076">append</span><span class="op" id="2036082">(</span><span class="ident" id="2036083">p</span><span class="op" id="2036084">.</span><span class="ident" id="2036085">space</span><span class="op" id="2036090">,</span>&nbsp;<span class="ident" id="2036092">b</span><span class="op" id="2036093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036098">case</span>&nbsp;<span class="string" id="2036103">&#39;\n&#39;</span><span class="op" id="2036107">,</span>&nbsp;<span class="string" id="2036109">&#39;\f&#39;</span><span class="op" id="2036113">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036119">_</span><span class="op" id="2036120">,</span>&nbsp;<span class="ident" id="2036122">err</span>&nbsp;<span class="op" id="2036126">=</span>&nbsp;<span class="ident" id="2036128">p</span><span class="op" id="2036129">.</span><span class="ident" id="2036130">output</span><span class="op" id="2036136">.</span><span class="ident" id="2036137">Write</span><span class="op" id="2036142">(</span><span class="ident" id="2036143">data</span><span class="op" id="2036147">[</span><span class="ident" id="2036148">m</span><span class="op" id="2036149">:</span><span class="ident" id="2036150">n</span><span class="op" id="2036151">]</span><span class="op" id="2036152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036158">p</span><span class="op" id="2036159">.</span><span class="ident" id="2036160">resetSpace</span><span class="op" id="2036170">(</span><span class="op" id="2036171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036177">_</span><span class="op" id="2036178">,</span>&nbsp;<span class="ident" id="2036180">err</span>&nbsp;<span class="op" id="2036184">=</span>&nbsp;<span class="ident" id="2036186">p</span><span class="op" id="2036187">.</span><span class="ident" id="2036188">output</span><span class="op" id="2036194">.</span><span class="ident" id="2036195">Write</span><span class="op" id="2036200">(</span><span class="ident" id="2036201">aNewline</span><span class="op" id="2036209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036214">case</span>&nbsp;<span class="ident" id="2036219">tabwriter</span><span class="op" id="2036228">.</span><span class="ident" id="2036229">Escape</span><span class="op" id="2036235">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036241">_</span><span class="op" id="2036242">,</span>&nbsp;<span class="ident" id="2036244">err</span>&nbsp;<span class="op" id="2036248">=</span>&nbsp;<span class="ident" id="2036250">p</span><span class="op" id="2036251">.</span><span class="ident" id="2036252">output</span><span class="op" id="2036258">.</span><span class="ident" id="2036259">Write</span><span class="op" id="2036264">(</span><span class="ident" id="2036265">data</span><span class="op" id="2036269">[</span><span class="ident" id="2036270">m</span><span class="op" id="2036271">:</span><span class="ident" id="2036272">n</span><span class="op" id="2036273">]</span><span class="op" id="2036274">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036280">p</span><span class="op" id="2036281">.</span><span class="ident" id="2036282">state</span>&nbsp;<span class="op" id="2036288">=</span>&nbsp;<span class="ident" id="2036290">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036303">m</span>&nbsp;<span class="op" id="2036305">=</span>&nbsp;<span class="ident" id="2036307">n</span>&nbsp;<span class="op" id="2036309">+</span>&nbsp;<span class="num" id="2036311">1</span>&nbsp;<span class="comment" id="2036313">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036349">default</span><span class="op" id="2036356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2036361">panic</span><span class="op" id="2036366">(</span><span class="string" id="2036367">&#34;unreachable&#34;</span><span class="op" id="2036380">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036388">if</span>&nbsp;<span class="ident" id="2036391">err</span>&nbsp;<span class="op" id="2036395">!=</span>&nbsp;<span class="ident" id="2036398">nil</span>&nbsp;<span class="op" id="2036402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036407">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036419">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036422">n</span>&nbsp;<span class="op" id="2036424">=</span>&nbsp;<span class="builtinfunc" id="2036426">len</span><span class="op" id="2036429">(</span><span class="ident" id="2036430">data</span><span class="op" id="2036434">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036438">switch</span>&nbsp;<span class="ident" id="2036445">p</span><span class="op" id="2036446">.</span><span class="ident" id="2036447">state</span>&nbsp;<span class="op" id="2036453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036456">case</span>&nbsp;<span class="ident" id="2036461">inEscape</span><span class="op" id="2036469">,</span>&nbsp;<span class="ident" id="2036471">inText</span><span class="op" id="2036477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036481">_</span><span class="op" id="2036482">,</span>&nbsp;<span class="ident" id="2036484">err</span>&nbsp;<span class="op" id="2036488">=</span>&nbsp;<span class="ident" id="2036490">p</span><span class="op" id="2036491">.</span><span class="ident" id="2036492">output</span><span class="op" id="2036498">.</span><span class="ident" id="2036499">Write</span><span class="op" id="2036504">(</span><span class="ident" id="2036505">data</span><span class="op" id="2036509">[</span><span class="ident" id="2036510">m</span><span class="op" id="2036511">:</span><span class="ident" id="2036512">n</span><span class="op" id="2036513">]</span><span class="op" id="2036514">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036518">p</span><span class="op" id="2036519">.</span><span class="ident" id="2036520">resetSpace</span><span class="op" id="2036530">(</span><span class="op" id="2036531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036538">return</span><br>
<span class="lineno"></span><span class="op" id="2036545">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="2036548">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2036628">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2036649">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="2036714">type</span>&nbsp;<span class="ident" id="2036719">Mode</span>&nbsp;<span class="builtintype" id="2036724">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2036730">const</span>&nbsp;<span class="op" id="2036736">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036739">RawFormat</span>&nbsp;<span class="ident" id="2036749">Mode</span>&nbsp;<span class="op" id="2036754">=</span>&nbsp;<span class="num" id="2036756">1</span>&nbsp;<span class="op" id="2036758">&lt;&lt;</span>&nbsp;<span class="ident" id="2036761">iota</span>&nbsp;<span class="comment" id="2036766">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036823">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2036850">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036904">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2036931">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036976">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2037003">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="2037065">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2037068">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="2037116">type</span>&nbsp;<span class="ident" id="2037121">Config</span>&nbsp;<span class="keyword" id="2037128">struct</span>&nbsp;<span class="op" id="2037135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037138">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2037147">Mode</span>&nbsp;<span class="comment" id="2037152">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037167">Tabwidth</span>&nbsp;<span class="builtintype" id="2037176">int</span>&nbsp;&nbsp;<span class="comment" id="2037181">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037196">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2037205">int</span>&nbsp;&nbsp;<span class="comment" id="2037210">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="2037269">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="2037272">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="2037361">func</span>&nbsp;<span class="op" id="2037366">(</span><span class="ident" id="2037367">cfg</span>&nbsp;<span class="op" id="2037371">*</span><span class="ident" id="2037372">Config</span><span class="op" id="2037378">)</span>&nbsp;<span class="ident" id="2037380">fprint</span><span class="op" id="2037386">(</span><span class="ident" id="2037387">output</span>&nbsp;<span class="ident" id="2037394">io</span><span class="op" id="2037396">.</span><span class="ident" id="2037397">Writer</span><span class="op" id="2037403">,</span>&nbsp;<span class="ident" id="2037405">fset</span>&nbsp;<span class="op" id="2037410">*</span><span class="ident" id="2037411">token</span><span class="op" id="2037416">.</span><span class="ident" id="2037417">FileSet</span><span class="op" id="2037424">,</span>&nbsp;<span class="ident" id="2037426">node</span>&nbsp;<span class="keyword" id="2037431">interface</span><span class="op" id="2037440">{</span><span class="op" id="2037441">}</span><span class="op" id="2037442">,</span>&nbsp;<span class="ident" id="2037444">nodeSizes</span>&nbsp;<span class="keyword" id="2037454">map</span><span class="op" id="2037457">[</span><span class="ident" id="2037458">ast</span><span class="op" id="2037461">.</span><span class="ident" id="2037462">Node</span><span class="op" id="2037466">]</span><span class="builtintype" id="2037467">int</span><span class="op" id="2037470">)</span>&nbsp;<span class="op" id="2037472">(</span><span class="ident" id="2037473">err</span>&nbsp;<span class="builtintype" id="2037477">error</span><span class="op" id="2037482">)</span>&nbsp;<span class="op" id="2037484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2037487">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037502">var</span>&nbsp;<span class="ident" id="2037506">p</span>&nbsp;<span class="ident" id="2037508">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037517">p</span><span class="op" id="2037518">.</span><span class="ident" id="2037519">init</span><span class="op" id="2037523">(</span><span class="ident" id="2037524">cfg</span><span class="op" id="2037527">,</span>&nbsp;<span class="ident" id="2037529">fset</span><span class="op" id="2037533">,</span>&nbsp;<span class="ident" id="2037535">nodeSizes</span><span class="op" id="2037544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037547">if</span>&nbsp;<span class="ident" id="2037550">err</span>&nbsp;<span class="op" id="2037554">=</span>&nbsp;<span class="ident" id="2037556">p</span><span class="op" id="2037557">.</span><span class="ident" id="2037558">printNode</span><span class="op" id="2037567">(</span><span class="ident" id="2037568">node</span><span class="op" id="2037572">)</span><span class="op" id="2037573">;</span>&nbsp;<span class="ident" id="2037575">err</span>&nbsp;<span class="op" id="2037579">!=</span>&nbsp;<span class="ident" id="2037582">nil</span>&nbsp;<span class="op" id="2037586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037590">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2037598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2037601">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037632">p</span><span class="op" id="2037633">.</span><span class="ident" id="2037634">impliedSemi</span>&nbsp;<span class="op" id="2037646">=</span>&nbsp;<span class="builtintype" id="2037648">false</span>&nbsp;<span class="comment" id="2037654">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037682">p</span><span class="op" id="2037683">.</span><span class="ident" id="2037684">flush</span><span class="op" id="2037689">(</span><span class="ident" id="2037690">token</span><span class="op" id="2037695">.</span><span class="ident" id="2037696">Position</span><span class="op" id="2037704">{</span><span class="ident" id="2037705">Offset</span><span class="op" id="2037711">:</span>&nbsp;<span class="ident" id="2037713">infinity</span><span class="op" id="2037721">,</span>&nbsp;<span class="ident" id="2037723">Line</span><span class="op" id="2037727">:</span>&nbsp;<span class="ident" id="2037729">infinity</span><span class="op" id="2037737">}</span><span class="op" id="2037738">,</span>&nbsp;<span class="ident" id="2037740">token</span><span class="op" id="2037745">.</span><span class="ident" id="2037746">EOF</span><span class="op" id="2037749">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2037753">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2037824">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2037896">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2037961">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038028">output</span>&nbsp;<span class="op" id="2038035">=</span>&nbsp;<span class="op" id="2038037">&amp;</span><span class="ident" id="2038038">trimmer</span><span class="op" id="2038045">{</span><span class="ident" id="2038046">output</span><span class="op" id="2038052">:</span>&nbsp;<span class="ident" id="2038054">output</span><span class="op" id="2038060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2038064">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038117">if</span>&nbsp;<span class="ident" id="2038120">cfg</span><span class="op" id="2038123">.</span><span class="ident" id="2038124">Mode</span><span class="op" id="2038128">&amp;</span><span class="ident" id="2038129">RawFormat</span>&nbsp;<span class="op" id="2038139">==</span>&nbsp;<span class="num" id="2038142">0</span>&nbsp;<span class="op" id="2038144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038148">minwidth</span>&nbsp;<span class="op" id="2038157">:=</span>&nbsp;<span class="ident" id="2038160">cfg</span><span class="op" id="2038163">.</span><span class="ident" id="2038164">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038176">padchar</span>&nbsp;<span class="op" id="2038184">:=</span>&nbsp;<span class="builtintype" id="2038187">byte</span><span class="op" id="2038191">(</span><span class="string" id="2038192">&#39;\t&#39;</span><span class="op" id="2038196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038200">if</span>&nbsp;<span class="ident" id="2038203">cfg</span><span class="op" id="2038206">.</span><span class="ident" id="2038207">Mode</span><span class="op" id="2038211">&amp;</span><span class="ident" id="2038212">UseSpaces</span>&nbsp;<span class="op" id="2038222">!=</span>&nbsp;<span class="num" id="2038225">0</span>&nbsp;<span class="op" id="2038227">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038232">padchar</span>&nbsp;<span class="op" id="2038240">=</span>&nbsp;<span class="string" id="2038242">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038253">twmode</span>&nbsp;<span class="op" id="2038260">:=</span>&nbsp;<span class="ident" id="2038263">tabwriter</span><span class="op" id="2038272">.</span><span class="ident" id="2038273">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038295">if</span>&nbsp;<span class="ident" id="2038298">cfg</span><span class="op" id="2038301">.</span><span class="ident" id="2038302">Mode</span><span class="op" id="2038306">&amp;</span><span class="ident" id="2038307">TabIndent</span>&nbsp;<span class="op" id="2038317">!=</span>&nbsp;<span class="num" id="2038320">0</span>&nbsp;<span class="op" id="2038322">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038327">minwidth</span>&nbsp;<span class="op" id="2038336">=</span>&nbsp;<span class="num" id="2038338">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038343">twmode</span>&nbsp;<span class="op" id="2038350">|=</span>&nbsp;<span class="ident" id="2038353">tabwriter</span><span class="op" id="2038362">.</span><span class="ident" id="2038363">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038380">output</span>&nbsp;<span class="op" id="2038387">=</span>&nbsp;<span class="ident" id="2038389">tabwriter</span><span class="op" id="2038398">.</span><span class="ident" id="2038399">NewWriter</span><span class="op" id="2038408">(</span><span class="ident" id="2038409">output</span><span class="op" id="2038415">,</span>&nbsp;<span class="ident" id="2038417">minwidth</span><span class="op" id="2038425">,</span>&nbsp;<span class="ident" id="2038427">cfg</span><span class="op" id="2038430">.</span><span class="ident" id="2038431">Tabwidth</span><span class="op" id="2038439">,</span>&nbsp;<span class="num" id="2038441">1</span><span class="op" id="2038442">,</span>&nbsp;<span class="ident" id="2038444">padchar</span><span class="op" id="2038451">,</span>&nbsp;<span class="ident" id="2038453">twmode</span><span class="op" id="2038459">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2038466">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038523">if</span>&nbsp;<span class="ident" id="2038526">_</span><span class="op" id="2038527">,</span>&nbsp;<span class="ident" id="2038529">err</span>&nbsp;<span class="op" id="2038533">=</span>&nbsp;<span class="ident" id="2038535">output</span><span class="op" id="2038541">.</span><span class="ident" id="2038542">Write</span><span class="op" id="2038547">(</span><span class="ident" id="2038548">p</span><span class="op" id="2038549">.</span><span class="ident" id="2038550">output</span><span class="op" id="2038556">)</span><span class="op" id="2038557">;</span>&nbsp;<span class="ident" id="2038559">err</span>&nbsp;<span class="op" id="2038563">!=</span>&nbsp;<span class="ident" id="2038566">nil</span>&nbsp;<span class="op" id="2038570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038574">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2038586">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038614">if</span>&nbsp;<span class="ident" id="2038617">tw</span><span class="op" id="2038619">,</span>&nbsp;<span class="ident" id="2038621">_</span>&nbsp;<span class="op" id="2038623">:=</span>&nbsp;<span class="ident" id="2038626">output</span><span class="op" id="2038632">.</span><span class="op" id="2038633">(</span><span class="op" id="2038634">*</span><span class="ident" id="2038635">tabwriter</span><span class="op" id="2038644">.</span><span class="ident" id="2038645">Writer</span><span class="op" id="2038651">)</span><span class="op" id="2038652">;</span>&nbsp;<span class="ident" id="2038654">tw</span>&nbsp;<span class="op" id="2038657">!=</span>&nbsp;<span class="ident" id="2038660">nil</span>&nbsp;<span class="op" id="2038664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038668">err</span>&nbsp;<span class="op" id="2038672">=</span>&nbsp;<span class="ident" id="2038674">tw</span><span class="op" id="2038676">.</span><span class="ident" id="2038677">Flush</span><span class="op" id="2038682">(</span><span class="op" id="2038683">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038690">return</span><br>
<span class="lineno"></span><span class="op" id="2038697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="2038700">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="2038767">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="2038833">//</span><br>
<span class="lineno"></span><span class="keyword" id="2038836">type</span>&nbsp;<span class="ident" id="2038841">CommentedNode</span>&nbsp;<span class="keyword" id="2038855">struct</span>&nbsp;<span class="op" id="2038862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038865">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2038874">interface</span><span class="op" id="2038883">{</span><span class="op" id="2038884">}</span>&nbsp;<span class="comment" id="2038886">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038946">Comments</span>&nbsp;<span class="op" id="2038955">[</span><span class="op" id="2038956">]</span><span class="op" id="2038957">*</span><span class="ident" id="2038958">ast</span><span class="op" id="2038961">.</span><span class="ident" id="2038962">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="2038975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2038978">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="2039057">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="2039127">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="2039203">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="2039277">//</span><br>
<span class="lineno"></span><span class="keyword" id="2039280">func</span>&nbsp;<span class="op" id="2039285">(</span><span class="ident" id="2039286">cfg</span>&nbsp;<span class="op" id="2039290">*</span><span class="ident" id="2039291">Config</span><span class="op" id="2039297">)</span>&nbsp;<span class="ident" id="2039299">Fprint</span><span class="op" id="2039305">(</span><span class="ident" id="2039306">output</span>&nbsp;<span class="ident" id="2039313">io</span><span class="op" id="2039315">.</span><span class="ident" id="2039316">Writer</span><span class="op" id="2039322">,</span>&nbsp;<span class="ident" id="2039324">fset</span>&nbsp;<span class="op" id="2039329">*</span><span class="ident" id="2039330">token</span><span class="op" id="2039335">.</span><span class="ident" id="2039336">FileSet</span><span class="op" id="2039343">,</span>&nbsp;<span class="ident" id="2039345">node</span>&nbsp;<span class="keyword" id="2039350">interface</span><span class="op" id="2039359">{</span><span class="op" id="2039360">}</span><span class="op" id="2039361">)</span>&nbsp;<span class="builtintype" id="2039363">error</span>&nbsp;<span class="op" id="2039369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039372">return</span>&nbsp;<span class="ident" id="2039379">cfg</span><span class="op" id="2039382">.</span><span class="ident" id="2039383">fprint</span><span class="op" id="2039389">(</span><span class="ident" id="2039390">output</span><span class="op" id="2039396">,</span>&nbsp;<span class="ident" id="2039398">fset</span><span class="op" id="2039402">,</span>&nbsp;<span class="ident" id="2039404">node</span><span class="op" id="2039408">,</span>&nbsp;<span class="builtinfunc" id="2039410">make</span><span class="op" id="2039414">(</span><span class="keyword" id="2039415">map</span><span class="op" id="2039418">[</span><span class="ident" id="2039419">ast</span><span class="op" id="2039422">.</span><span class="ident" id="2039423">Node</span><span class="op" id="2039427">]</span><span class="builtintype" id="2039428">int</span><span class="op" id="2039431">)</span><span class="op" id="2039432">)</span><br>
<span class="lineno">1285</span><span class="op" id="2039434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2039437">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="2039486">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="2039535">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="2039538">func</span>&nbsp;<span class="ident" id="2039543">Fprint</span><span class="op" id="2039549">(</span><span class="ident" id="2039550">output</span>&nbsp;<span class="ident" id="2039557">io</span><span class="op" id="2039559">.</span><span class="ident" id="2039560">Writer</span><span class="op" id="2039566">,</span>&nbsp;<span class="ident" id="2039568">fset</span>&nbsp;<span class="op" id="2039573">*</span><span class="ident" id="2039574">token</span><span class="op" id="2039579">.</span><span class="ident" id="2039580">FileSet</span><span class="op" id="2039587">,</span>&nbsp;<span class="ident" id="2039589">node</span>&nbsp;<span class="keyword" id="2039594">interface</span><span class="op" id="2039603">{</span><span class="op" id="2039604">}</span><span class="op" id="2039605">)</span>&nbsp;<span class="builtintype" id="2039607">error</span>&nbsp;<span class="op" id="2039613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039616">return</span>&nbsp;<span class="op" id="2039623">(</span><span class="op" id="2039624">&amp;</span><span class="ident" id="2039625">Config</span><span class="op" id="2039631">{</span><span class="ident" id="2039632">Tabwidth</span><span class="op" id="2039640">:</span>&nbsp;<span class="num" id="2039642">8</span><span class="op" id="2039643">}</span><span class="op" id="2039644">)</span><span class="op" id="2039645">.</span><span class="ident" id="2039646">Fprint</span><span class="op" id="2039652">(</span><span class="ident" id="2039653">output</span><span class="op" id="2039659">,</span>&nbsp;<span class="ident" id="2039661">fset</span><span class="op" id="2039665">,</span>&nbsp;<span class="ident" id="2039667">node</span><span class="op" id="2039671">)</span><br>
<span class="lineno"></span><span class="op" id="2039673">}</span>
</div>
</body>
</html>
