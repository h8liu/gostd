<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6182393">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6182448">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6182502">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6182553">package</span>&nbsp;<span class="ident" id="6182561">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6182567">import</span>&nbsp;<span class="op" id="6182574">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6182577">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6182586">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6182596">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6182605">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6182620">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6182625">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6182628">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="6182672">func</span>&nbsp;<span class="ident" id="6182677">min</span><span class="op" id="6182680">(</span><span class="ident" id="6182681">x</span><span class="op" id="6182682">,</span>&nbsp;<span class="ident" id="6182684">y</span>&nbsp;<span class="builtintype" id="6182686">int</span><span class="op" id="6182689">)</span>&nbsp;<span class="builtintype" id="6182691">int</span>&nbsp;<span class="op" id="6182695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182698">if</span>&nbsp;<span class="ident" id="6182701">x</span>&nbsp;<span class="op" id="6182703">&lt;</span>&nbsp;<span class="ident" id="6182705">y</span>&nbsp;<span class="op" id="6182707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182711">return</span>&nbsp;<span class="ident" id="6182718">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6182721">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182724">return</span>&nbsp;<span class="ident" id="6182731">y</span><br>
<span class="lineno"></span><span class="op" id="6182733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6182736">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="6182815">func</span>&nbsp;<span class="ident" id="6182820">div</span><span class="op" id="6182823">(</span><span class="ident" id="6182824">a</span><span class="op" id="6182825">,</span>&nbsp;<span class="ident" id="6182827">b</span>&nbsp;<span class="builtintype" id="6182829">int32</span><span class="op" id="6182834">)</span>&nbsp;<span class="builtintype" id="6182836">int32</span>&nbsp;<span class="op" id="6182842">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182845">if</span>&nbsp;<span class="ident" id="6182848">a</span>&nbsp;<span class="op" id="6182850">&gt;=</span>&nbsp;<span class="num" id="6182853">0</span>&nbsp;<span class="op" id="6182855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182859">return</span>&nbsp;<span class="op" id="6182866">(</span><span class="ident" id="6182867">a</span>&nbsp;<span class="op" id="6182869">+</span>&nbsp;<span class="op" id="6182871">(</span><span class="ident" id="6182872">b</span>&nbsp;<span class="op" id="6182874">&gt;&gt;</span>&nbsp;<span class="num" id="6182877">1</span><span class="op" id="6182878">)</span><span class="op" id="6182879">)</span>&nbsp;<span class="op" id="6182881">/</span>&nbsp;<span class="ident" id="6182883">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6182886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182889">return</span>&nbsp;<span class="op" id="6182896">-</span><span class="op" id="6182897">(</span><span class="op" id="6182898">(</span><span class="op" id="6182899">-</span><span class="ident" id="6182900">a</span>&nbsp;<span class="op" id="6182902">+</span>&nbsp;<span class="op" id="6182904">(</span><span class="ident" id="6182905">b</span>&nbsp;<span class="op" id="6182907">&gt;&gt;</span>&nbsp;<span class="num" id="6182910">1</span><span class="op" id="6182911">)</span><span class="op" id="6182912">)</span>&nbsp;<span class="op" id="6182914">/</span>&nbsp;<span class="ident" id="6182916">b</span><span class="op" id="6182917">)</span><br>
<span class="lineno"></span><span class="op" id="6182919">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="6182922">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="6182987">var</span>&nbsp;<span class="ident" id="6182991">bitCount</span>&nbsp;<span class="op" id="6183000">=</span>&nbsp;<span class="op" id="6183002">[</span><span class="num" id="6183003">256</span><span class="op" id="6183006">]</span><span class="builtintype" id="6183007">byte</span><span class="op" id="6183011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183014">0</span><span class="op" id="6183015">,</span>&nbsp;<span class="num" id="6183017">1</span><span class="op" id="6183018">,</span>&nbsp;<span class="num" id="6183020">2</span><span class="op" id="6183021">,</span>&nbsp;<span class="num" id="6183023">2</span><span class="op" id="6183024">,</span>&nbsp;<span class="num" id="6183026">3</span><span class="op" id="6183027">,</span>&nbsp;<span class="num" id="6183029">3</span><span class="op" id="6183030">,</span>&nbsp;<span class="num" id="6183032">3</span><span class="op" id="6183033">,</span>&nbsp;<span class="num" id="6183035">3</span><span class="op" id="6183036">,</span>&nbsp;<span class="num" id="6183038">4</span><span class="op" id="6183039">,</span>&nbsp;<span class="num" id="6183041">4</span><span class="op" id="6183042">,</span>&nbsp;<span class="num" id="6183044">4</span><span class="op" id="6183045">,</span>&nbsp;<span class="num" id="6183047">4</span><span class="op" id="6183048">,</span>&nbsp;<span class="num" id="6183050">4</span><span class="op" id="6183051">,</span>&nbsp;<span class="num" id="6183053">4</span><span class="op" id="6183054">,</span>&nbsp;<span class="num" id="6183056">4</span><span class="op" id="6183057">,</span>&nbsp;<span class="num" id="6183059">4</span><span class="op" id="6183060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183063">5</span><span class="op" id="6183064">,</span>&nbsp;<span class="num" id="6183066">5</span><span class="op" id="6183067">,</span>&nbsp;<span class="num" id="6183069">5</span><span class="op" id="6183070">,</span>&nbsp;<span class="num" id="6183072">5</span><span class="op" id="6183073">,</span>&nbsp;<span class="num" id="6183075">5</span><span class="op" id="6183076">,</span>&nbsp;<span class="num" id="6183078">5</span><span class="op" id="6183079">,</span>&nbsp;<span class="num" id="6183081">5</span><span class="op" id="6183082">,</span>&nbsp;<span class="num" id="6183084">5</span><span class="op" id="6183085">,</span>&nbsp;<span class="num" id="6183087">5</span><span class="op" id="6183088">,</span>&nbsp;<span class="num" id="6183090">5</span><span class="op" id="6183091">,</span>&nbsp;<span class="num" id="6183093">5</span><span class="op" id="6183094">,</span>&nbsp;<span class="num" id="6183096">5</span><span class="op" id="6183097">,</span>&nbsp;<span class="num" id="6183099">5</span><span class="op" id="6183100">,</span>&nbsp;<span class="num" id="6183102">5</span><span class="op" id="6183103">,</span>&nbsp;<span class="num" id="6183105">5</span><span class="op" id="6183106">,</span>&nbsp;<span class="num" id="6183108">5</span><span class="op" id="6183109">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183112">6</span><span class="op" id="6183113">,</span>&nbsp;<span class="num" id="6183115">6</span><span class="op" id="6183116">,</span>&nbsp;<span class="num" id="6183118">6</span><span class="op" id="6183119">,</span>&nbsp;<span class="num" id="6183121">6</span><span class="op" id="6183122">,</span>&nbsp;<span class="num" id="6183124">6</span><span class="op" id="6183125">,</span>&nbsp;<span class="num" id="6183127">6</span><span class="op" id="6183128">,</span>&nbsp;<span class="num" id="6183130">6</span><span class="op" id="6183131">,</span>&nbsp;<span class="num" id="6183133">6</span><span class="op" id="6183134">,</span>&nbsp;<span class="num" id="6183136">6</span><span class="op" id="6183137">,</span>&nbsp;<span class="num" id="6183139">6</span><span class="op" id="6183140">,</span>&nbsp;<span class="num" id="6183142">6</span><span class="op" id="6183143">,</span>&nbsp;<span class="num" id="6183145">6</span><span class="op" id="6183146">,</span>&nbsp;<span class="num" id="6183148">6</span><span class="op" id="6183149">,</span>&nbsp;<span class="num" id="6183151">6</span><span class="op" id="6183152">,</span>&nbsp;<span class="num" id="6183154">6</span><span class="op" id="6183155">,</span>&nbsp;<span class="num" id="6183157">6</span><span class="op" id="6183158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183161">6</span><span class="op" id="6183162">,</span>&nbsp;<span class="num" id="6183164">6</span><span class="op" id="6183165">,</span>&nbsp;<span class="num" id="6183167">6</span><span class="op" id="6183168">,</span>&nbsp;<span class="num" id="6183170">6</span><span class="op" id="6183171">,</span>&nbsp;<span class="num" id="6183173">6</span><span class="op" id="6183174">,</span>&nbsp;<span class="num" id="6183176">6</span><span class="op" id="6183177">,</span>&nbsp;<span class="num" id="6183179">6</span><span class="op" id="6183180">,</span>&nbsp;<span class="num" id="6183182">6</span><span class="op" id="6183183">,</span>&nbsp;<span class="num" id="6183185">6</span><span class="op" id="6183186">,</span>&nbsp;<span class="num" id="6183188">6</span><span class="op" id="6183189">,</span>&nbsp;<span class="num" id="6183191">6</span><span class="op" id="6183192">,</span>&nbsp;<span class="num" id="6183194">6</span><span class="op" id="6183195">,</span>&nbsp;<span class="num" id="6183197">6</span><span class="op" id="6183198">,</span>&nbsp;<span class="num" id="6183200">6</span><span class="op" id="6183201">,</span>&nbsp;<span class="num" id="6183203">6</span><span class="op" id="6183204">,</span>&nbsp;<span class="num" id="6183206">6</span><span class="op" id="6183207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183210">7</span><span class="op" id="6183211">,</span>&nbsp;<span class="num" id="6183213">7</span><span class="op" id="6183214">,</span>&nbsp;<span class="num" id="6183216">7</span><span class="op" id="6183217">,</span>&nbsp;<span class="num" id="6183219">7</span><span class="op" id="6183220">,</span>&nbsp;<span class="num" id="6183222">7</span><span class="op" id="6183223">,</span>&nbsp;<span class="num" id="6183225">7</span><span class="op" id="6183226">,</span>&nbsp;<span class="num" id="6183228">7</span><span class="op" id="6183229">,</span>&nbsp;<span class="num" id="6183231">7</span><span class="op" id="6183232">,</span>&nbsp;<span class="num" id="6183234">7</span><span class="op" id="6183235">,</span>&nbsp;<span class="num" id="6183237">7</span><span class="op" id="6183238">,</span>&nbsp;<span class="num" id="6183240">7</span><span class="op" id="6183241">,</span>&nbsp;<span class="num" id="6183243">7</span><span class="op" id="6183244">,</span>&nbsp;<span class="num" id="6183246">7</span><span class="op" id="6183247">,</span>&nbsp;<span class="num" id="6183249">7</span><span class="op" id="6183250">,</span>&nbsp;<span class="num" id="6183252">7</span><span class="op" id="6183253">,</span>&nbsp;<span class="num" id="6183255">7</span><span class="op" id="6183256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183259">7</span><span class="op" id="6183260">,</span>&nbsp;<span class="num" id="6183262">7</span><span class="op" id="6183263">,</span>&nbsp;<span class="num" id="6183265">7</span><span class="op" id="6183266">,</span>&nbsp;<span class="num" id="6183268">7</span><span class="op" id="6183269">,</span>&nbsp;<span class="num" id="6183271">7</span><span class="op" id="6183272">,</span>&nbsp;<span class="num" id="6183274">7</span><span class="op" id="6183275">,</span>&nbsp;<span class="num" id="6183277">7</span><span class="op" id="6183278">,</span>&nbsp;<span class="num" id="6183280">7</span><span class="op" id="6183281">,</span>&nbsp;<span class="num" id="6183283">7</span><span class="op" id="6183284">,</span>&nbsp;<span class="num" id="6183286">7</span><span class="op" id="6183287">,</span>&nbsp;<span class="num" id="6183289">7</span><span class="op" id="6183290">,</span>&nbsp;<span class="num" id="6183292">7</span><span class="op" id="6183293">,</span>&nbsp;<span class="num" id="6183295">7</span><span class="op" id="6183296">,</span>&nbsp;<span class="num" id="6183298">7</span><span class="op" id="6183299">,</span>&nbsp;<span class="num" id="6183301">7</span><span class="op" id="6183302">,</span>&nbsp;<span class="num" id="6183304">7</span><span class="op" id="6183305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183308">7</span><span class="op" id="6183309">,</span>&nbsp;<span class="num" id="6183311">7</span><span class="op" id="6183312">,</span>&nbsp;<span class="num" id="6183314">7</span><span class="op" id="6183315">,</span>&nbsp;<span class="num" id="6183317">7</span><span class="op" id="6183318">,</span>&nbsp;<span class="num" id="6183320">7</span><span class="op" id="6183321">,</span>&nbsp;<span class="num" id="6183323">7</span><span class="op" id="6183324">,</span>&nbsp;<span class="num" id="6183326">7</span><span class="op" id="6183327">,</span>&nbsp;<span class="num" id="6183329">7</span><span class="op" id="6183330">,</span>&nbsp;<span class="num" id="6183332">7</span><span class="op" id="6183333">,</span>&nbsp;<span class="num" id="6183335">7</span><span class="op" id="6183336">,</span>&nbsp;<span class="num" id="6183338">7</span><span class="op" id="6183339">,</span>&nbsp;<span class="num" id="6183341">7</span><span class="op" id="6183342">,</span>&nbsp;<span class="num" id="6183344">7</span><span class="op" id="6183345">,</span>&nbsp;<span class="num" id="6183347">7</span><span class="op" id="6183348">,</span>&nbsp;<span class="num" id="6183350">7</span><span class="op" id="6183351">,</span>&nbsp;<span class="num" id="6183353">7</span><span class="op" id="6183354">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183357">7</span><span class="op" id="6183358">,</span>&nbsp;<span class="num" id="6183360">7</span><span class="op" id="6183361">,</span>&nbsp;<span class="num" id="6183363">7</span><span class="op" id="6183364">,</span>&nbsp;<span class="num" id="6183366">7</span><span class="op" id="6183367">,</span>&nbsp;<span class="num" id="6183369">7</span><span class="op" id="6183370">,</span>&nbsp;<span class="num" id="6183372">7</span><span class="op" id="6183373">,</span>&nbsp;<span class="num" id="6183375">7</span><span class="op" id="6183376">,</span>&nbsp;<span class="num" id="6183378">7</span><span class="op" id="6183379">,</span>&nbsp;<span class="num" id="6183381">7</span><span class="op" id="6183382">,</span>&nbsp;<span class="num" id="6183384">7</span><span class="op" id="6183385">,</span>&nbsp;<span class="num" id="6183387">7</span><span class="op" id="6183388">,</span>&nbsp;<span class="num" id="6183390">7</span><span class="op" id="6183391">,</span>&nbsp;<span class="num" id="6183393">7</span><span class="op" id="6183394">,</span>&nbsp;<span class="num" id="6183396">7</span><span class="op" id="6183397">,</span>&nbsp;<span class="num" id="6183399">7</span><span class="op" id="6183400">,</span>&nbsp;<span class="num" id="6183402">7</span><span class="op" id="6183403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183406">8</span><span class="op" id="6183407">,</span>&nbsp;<span class="num" id="6183409">8</span><span class="op" id="6183410">,</span>&nbsp;<span class="num" id="6183412">8</span><span class="op" id="6183413">,</span>&nbsp;<span class="num" id="6183415">8</span><span class="op" id="6183416">,</span>&nbsp;<span class="num" id="6183418">8</span><span class="op" id="6183419">,</span>&nbsp;<span class="num" id="6183421">8</span><span class="op" id="6183422">,</span>&nbsp;<span class="num" id="6183424">8</span><span class="op" id="6183425">,</span>&nbsp;<span class="num" id="6183427">8</span><span class="op" id="6183428">,</span>&nbsp;<span class="num" id="6183430">8</span><span class="op" id="6183431">,</span>&nbsp;<span class="num" id="6183433">8</span><span class="op" id="6183434">,</span>&nbsp;<span class="num" id="6183436">8</span><span class="op" id="6183437">,</span>&nbsp;<span class="num" id="6183439">8</span><span class="op" id="6183440">,</span>&nbsp;<span class="num" id="6183442">8</span><span class="op" id="6183443">,</span>&nbsp;<span class="num" id="6183445">8</span><span class="op" id="6183446">,</span>&nbsp;<span class="num" id="6183448">8</span><span class="op" id="6183449">,</span>&nbsp;<span class="num" id="6183451">8</span><span class="op" id="6183452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183455">8</span><span class="op" id="6183456">,</span>&nbsp;<span class="num" id="6183458">8</span><span class="op" id="6183459">,</span>&nbsp;<span class="num" id="6183461">8</span><span class="op" id="6183462">,</span>&nbsp;<span class="num" id="6183464">8</span><span class="op" id="6183465">,</span>&nbsp;<span class="num" id="6183467">8</span><span class="op" id="6183468">,</span>&nbsp;<span class="num" id="6183470">8</span><span class="op" id="6183471">,</span>&nbsp;<span class="num" id="6183473">8</span><span class="op" id="6183474">,</span>&nbsp;<span class="num" id="6183476">8</span><span class="op" id="6183477">,</span>&nbsp;<span class="num" id="6183479">8</span><span class="op" id="6183480">,</span>&nbsp;<span class="num" id="6183482">8</span><span class="op" id="6183483">,</span>&nbsp;<span class="num" id="6183485">8</span><span class="op" id="6183486">,</span>&nbsp;<span class="num" id="6183488">8</span><span class="op" id="6183489">,</span>&nbsp;<span class="num" id="6183491">8</span><span class="op" id="6183492">,</span>&nbsp;<span class="num" id="6183494">8</span><span class="op" id="6183495">,</span>&nbsp;<span class="num" id="6183497">8</span><span class="op" id="6183498">,</span>&nbsp;<span class="num" id="6183500">8</span><span class="op" id="6183501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183504">8</span><span class="op" id="6183505">,</span>&nbsp;<span class="num" id="6183507">8</span><span class="op" id="6183508">,</span>&nbsp;<span class="num" id="6183510">8</span><span class="op" id="6183511">,</span>&nbsp;<span class="num" id="6183513">8</span><span class="op" id="6183514">,</span>&nbsp;<span class="num" id="6183516">8</span><span class="op" id="6183517">,</span>&nbsp;<span class="num" id="6183519">8</span><span class="op" id="6183520">,</span>&nbsp;<span class="num" id="6183522">8</span><span class="op" id="6183523">,</span>&nbsp;<span class="num" id="6183525">8</span><span class="op" id="6183526">,</span>&nbsp;<span class="num" id="6183528">8</span><span class="op" id="6183529">,</span>&nbsp;<span class="num" id="6183531">8</span><span class="op" id="6183532">,</span>&nbsp;<span class="num" id="6183534">8</span><span class="op" id="6183535">,</span>&nbsp;<span class="num" id="6183537">8</span><span class="op" id="6183538">,</span>&nbsp;<span class="num" id="6183540">8</span><span class="op" id="6183541">,</span>&nbsp;<span class="num" id="6183543">8</span><span class="op" id="6183544">,</span>&nbsp;<span class="num" id="6183546">8</span><span class="op" id="6183547">,</span>&nbsp;<span class="num" id="6183549">8</span><span class="op" id="6183550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183553">8</span><span class="op" id="6183554">,</span>&nbsp;<span class="num" id="6183556">8</span><span class="op" id="6183557">,</span>&nbsp;<span class="num" id="6183559">8</span><span class="op" id="6183560">,</span>&nbsp;<span class="num" id="6183562">8</span><span class="op" id="6183563">,</span>&nbsp;<span class="num" id="6183565">8</span><span class="op" id="6183566">,</span>&nbsp;<span class="num" id="6183568">8</span><span class="op" id="6183569">,</span>&nbsp;<span class="num" id="6183571">8</span><span class="op" id="6183572">,</span>&nbsp;<span class="num" id="6183574">8</span><span class="op" id="6183575">,</span>&nbsp;<span class="num" id="6183577">8</span><span class="op" id="6183578">,</span>&nbsp;<span class="num" id="6183580">8</span><span class="op" id="6183581">,</span>&nbsp;<span class="num" id="6183583">8</span><span class="op" id="6183584">,</span>&nbsp;<span class="num" id="6183586">8</span><span class="op" id="6183587">,</span>&nbsp;<span class="num" id="6183589">8</span><span class="op" id="6183590">,</span>&nbsp;<span class="num" id="6183592">8</span><span class="op" id="6183593">,</span>&nbsp;<span class="num" id="6183595">8</span><span class="op" id="6183596">,</span>&nbsp;<span class="num" id="6183598">8</span><span class="op" id="6183599">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183602">8</span><span class="op" id="6183603">,</span>&nbsp;<span class="num" id="6183605">8</span><span class="op" id="6183606">,</span>&nbsp;<span class="num" id="6183608">8</span><span class="op" id="6183609">,</span>&nbsp;<span class="num" id="6183611">8</span><span class="op" id="6183612">,</span>&nbsp;<span class="num" id="6183614">8</span><span class="op" id="6183615">,</span>&nbsp;<span class="num" id="6183617">8</span><span class="op" id="6183618">,</span>&nbsp;<span class="num" id="6183620">8</span><span class="op" id="6183621">,</span>&nbsp;<span class="num" id="6183623">8</span><span class="op" id="6183624">,</span>&nbsp;<span class="num" id="6183626">8</span><span class="op" id="6183627">,</span>&nbsp;<span class="num" id="6183629">8</span><span class="op" id="6183630">,</span>&nbsp;<span class="num" id="6183632">8</span><span class="op" id="6183633">,</span>&nbsp;<span class="num" id="6183635">8</span><span class="op" id="6183636">,</span>&nbsp;<span class="num" id="6183638">8</span><span class="op" id="6183639">,</span>&nbsp;<span class="num" id="6183641">8</span><span class="op" id="6183642">,</span>&nbsp;<span class="num" id="6183644">8</span><span class="op" id="6183645">,</span>&nbsp;<span class="num" id="6183647">8</span><span class="op" id="6183648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183651">8</span><span class="op" id="6183652">,</span>&nbsp;<span class="num" id="6183654">8</span><span class="op" id="6183655">,</span>&nbsp;<span class="num" id="6183657">8</span><span class="op" id="6183658">,</span>&nbsp;<span class="num" id="6183660">8</span><span class="op" id="6183661">,</span>&nbsp;<span class="num" id="6183663">8</span><span class="op" id="6183664">,</span>&nbsp;<span class="num" id="6183666">8</span><span class="op" id="6183667">,</span>&nbsp;<span class="num" id="6183669">8</span><span class="op" id="6183670">,</span>&nbsp;<span class="num" id="6183672">8</span><span class="op" id="6183673">,</span>&nbsp;<span class="num" id="6183675">8</span><span class="op" id="6183676">,</span>&nbsp;<span class="num" id="6183678">8</span><span class="op" id="6183679">,</span>&nbsp;<span class="num" id="6183681">8</span><span class="op" id="6183682">,</span>&nbsp;<span class="num" id="6183684">8</span><span class="op" id="6183685">,</span>&nbsp;<span class="num" id="6183687">8</span><span class="op" id="6183688">,</span>&nbsp;<span class="num" id="6183690">8</span><span class="op" id="6183691">,</span>&nbsp;<span class="num" id="6183693">8</span><span class="op" id="6183694">,</span>&nbsp;<span class="num" id="6183696">8</span><span class="op" id="6183697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183700">8</span><span class="op" id="6183701">,</span>&nbsp;<span class="num" id="6183703">8</span><span class="op" id="6183704">,</span>&nbsp;<span class="num" id="6183706">8</span><span class="op" id="6183707">,</span>&nbsp;<span class="num" id="6183709">8</span><span class="op" id="6183710">,</span>&nbsp;<span class="num" id="6183712">8</span><span class="op" id="6183713">,</span>&nbsp;<span class="num" id="6183715">8</span><span class="op" id="6183716">,</span>&nbsp;<span class="num" id="6183718">8</span><span class="op" id="6183719">,</span>&nbsp;<span class="num" id="6183721">8</span><span class="op" id="6183722">,</span>&nbsp;<span class="num" id="6183724">8</span><span class="op" id="6183725">,</span>&nbsp;<span class="num" id="6183727">8</span><span class="op" id="6183728">,</span>&nbsp;<span class="num" id="6183730">8</span><span class="op" id="6183731">,</span>&nbsp;<span class="num" id="6183733">8</span><span class="op" id="6183734">,</span>&nbsp;<span class="num" id="6183736">8</span><span class="op" id="6183737">,</span>&nbsp;<span class="num" id="6183739">8</span><span class="op" id="6183740">,</span>&nbsp;<span class="num" id="6183742">8</span><span class="op" id="6183743">,</span>&nbsp;<span class="num" id="6183745">8</span><span class="op" id="6183746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6183749">8</span><span class="op" id="6183750">,</span>&nbsp;<span class="num" id="6183752">8</span><span class="op" id="6183753">,</span>&nbsp;<span class="num" id="6183755">8</span><span class="op" id="6183756">,</span>&nbsp;<span class="num" id="6183758">8</span><span class="op" id="6183759">,</span>&nbsp;<span class="num" id="6183761">8</span><span class="op" id="6183762">,</span>&nbsp;<span class="num" id="6183764">8</span><span class="op" id="6183765">,</span>&nbsp;<span class="num" id="6183767">8</span><span class="op" id="6183768">,</span>&nbsp;<span class="num" id="6183770">8</span><span class="op" id="6183771">,</span>&nbsp;<span class="num" id="6183773">8</span><span class="op" id="6183774">,</span>&nbsp;<span class="num" id="6183776">8</span><span class="op" id="6183777">,</span>&nbsp;<span class="num" id="6183779">8</span><span class="op" id="6183780">,</span>&nbsp;<span class="num" id="6183782">8</span><span class="op" id="6183783">,</span>&nbsp;<span class="num" id="6183785">8</span><span class="op" id="6183786">,</span>&nbsp;<span class="num" id="6183788">8</span><span class="op" id="6183789">,</span>&nbsp;<span class="num" id="6183791">8</span><span class="op" id="6183792">,</span>&nbsp;<span class="num" id="6183794">8</span><span class="op" id="6183795">,</span><br>
<span class="lineno"></span><span class="op" id="6183797">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6183800">type</span>&nbsp;<span class="ident" id="6183805">quantIndex</span>&nbsp;<span class="builtintype" id="6183816">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6183821">const</span>&nbsp;<span class="op" id="6183827">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6183830">quantIndexLuminance</span>&nbsp;<span class="ident" id="6183850">quantIndex</span>&nbsp;<span class="op" id="6183861">=</span>&nbsp;<span class="ident" id="6183863">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6183869">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6183892">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="6183904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6183907">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="6183984">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6184060">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6184136">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="6184154">var</span>&nbsp;<span class="ident" id="6184158">unscaledQuant</span>&nbsp;<span class="op" id="6184172">=</span>&nbsp;<span class="op" id="6184174">[</span><span class="ident" id="6184175">nQuantIndex</span><span class="op" id="6184186">]</span><span class="op" id="6184187">[</span><span class="ident" id="6184188">blockSize</span><span class="op" id="6184197">]</span><span class="builtintype" id="6184198">byte</span><span class="op" id="6184202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6184205">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6184220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184224">16</span><span class="op" id="6184226">,</span>&nbsp;<span class="num" id="6184228">11</span><span class="op" id="6184230">,</span>&nbsp;<span class="num" id="6184232">12</span><span class="op" id="6184234">,</span>&nbsp;<span class="num" id="6184236">14</span><span class="op" id="6184238">,</span>&nbsp;<span class="num" id="6184240">12</span><span class="op" id="6184242">,</span>&nbsp;<span class="num" id="6184244">10</span><span class="op" id="6184246">,</span>&nbsp;<span class="num" id="6184248">16</span><span class="op" id="6184250">,</span>&nbsp;<span class="num" id="6184252">14</span><span class="op" id="6184254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184258">13</span><span class="op" id="6184260">,</span>&nbsp;<span class="num" id="6184262">14</span><span class="op" id="6184264">,</span>&nbsp;<span class="num" id="6184266">18</span><span class="op" id="6184268">,</span>&nbsp;<span class="num" id="6184270">17</span><span class="op" id="6184272">,</span>&nbsp;<span class="num" id="6184274">16</span><span class="op" id="6184276">,</span>&nbsp;<span class="num" id="6184278">19</span><span class="op" id="6184280">,</span>&nbsp;<span class="num" id="6184282">24</span><span class="op" id="6184284">,</span>&nbsp;<span class="num" id="6184286">40</span><span class="op" id="6184288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184292">26</span><span class="op" id="6184294">,</span>&nbsp;<span class="num" id="6184296">24</span><span class="op" id="6184298">,</span>&nbsp;<span class="num" id="6184300">22</span><span class="op" id="6184302">,</span>&nbsp;<span class="num" id="6184304">22</span><span class="op" id="6184306">,</span>&nbsp;<span class="num" id="6184308">24</span><span class="op" id="6184310">,</span>&nbsp;<span class="num" id="6184312">49</span><span class="op" id="6184314">,</span>&nbsp;<span class="num" id="6184316">35</span><span class="op" id="6184318">,</span>&nbsp;<span class="num" id="6184320">37</span><span class="op" id="6184322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184326">29</span><span class="op" id="6184328">,</span>&nbsp;<span class="num" id="6184330">40</span><span class="op" id="6184332">,</span>&nbsp;<span class="num" id="6184334">58</span><span class="op" id="6184336">,</span>&nbsp;<span class="num" id="6184338">51</span><span class="op" id="6184340">,</span>&nbsp;<span class="num" id="6184342">61</span><span class="op" id="6184344">,</span>&nbsp;<span class="num" id="6184346">60</span><span class="op" id="6184348">,</span>&nbsp;<span class="num" id="6184350">57</span><span class="op" id="6184352">,</span>&nbsp;<span class="num" id="6184354">51</span><span class="op" id="6184356">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184360">56</span><span class="op" id="6184362">,</span>&nbsp;<span class="num" id="6184364">55</span><span class="op" id="6184366">,</span>&nbsp;<span class="num" id="6184368">64</span><span class="op" id="6184370">,</span>&nbsp;<span class="num" id="6184372">72</span><span class="op" id="6184374">,</span>&nbsp;<span class="num" id="6184376">92</span><span class="op" id="6184378">,</span>&nbsp;<span class="num" id="6184380">78</span><span class="op" id="6184382">,</span>&nbsp;<span class="num" id="6184384">64</span><span class="op" id="6184386">,</span>&nbsp;<span class="num" id="6184388">68</span><span class="op" id="6184390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184394">87</span><span class="op" id="6184396">,</span>&nbsp;<span class="num" id="6184398">69</span><span class="op" id="6184400">,</span>&nbsp;<span class="num" id="6184402">55</span><span class="op" id="6184404">,</span>&nbsp;<span class="num" id="6184406">56</span><span class="op" id="6184408">,</span>&nbsp;<span class="num" id="6184410">80</span><span class="op" id="6184412">,</span>&nbsp;<span class="num" id="6184414">109</span><span class="op" id="6184417">,</span>&nbsp;<span class="num" id="6184419">81</span><span class="op" id="6184421">,</span>&nbsp;<span class="num" id="6184423">87</span><span class="op" id="6184425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184429">95</span><span class="op" id="6184431">,</span>&nbsp;<span class="num" id="6184433">98</span><span class="op" id="6184435">,</span>&nbsp;<span class="num" id="6184437">103</span><span class="op" id="6184440">,</span>&nbsp;<span class="num" id="6184442">104</span><span class="op" id="6184445">,</span>&nbsp;<span class="num" id="6184447">103</span><span class="op" id="6184450">,</span>&nbsp;<span class="num" id="6184452">62</span><span class="op" id="6184454">,</span>&nbsp;<span class="num" id="6184456">77</span><span class="op" id="6184458">,</span>&nbsp;<span class="num" id="6184460">113</span><span class="op" id="6184463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184467">121</span><span class="op" id="6184470">,</span>&nbsp;<span class="num" id="6184472">112</span><span class="op" id="6184475">,</span>&nbsp;<span class="num" id="6184477">100</span><span class="op" id="6184480">,</span>&nbsp;<span class="num" id="6184482">120</span><span class="op" id="6184485">,</span>&nbsp;<span class="num" id="6184487">92</span><span class="op" id="6184489">,</span>&nbsp;<span class="num" id="6184491">101</span><span class="op" id="6184494">,</span>&nbsp;<span class="num" id="6184496">103</span><span class="op" id="6184499">,</span>&nbsp;<span class="num" id="6184501">99</span><span class="op" id="6184503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6184506">}</span><span class="op" id="6184507">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6184510">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6184527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184531">17</span><span class="op" id="6184533">,</span>&nbsp;<span class="num" id="6184535">18</span><span class="op" id="6184537">,</span>&nbsp;<span class="num" id="6184539">18</span><span class="op" id="6184541">,</span>&nbsp;<span class="num" id="6184543">24</span><span class="op" id="6184545">,</span>&nbsp;<span class="num" id="6184547">21</span><span class="op" id="6184549">,</span>&nbsp;<span class="num" id="6184551">24</span><span class="op" id="6184553">,</span>&nbsp;<span class="num" id="6184555">47</span><span class="op" id="6184557">,</span>&nbsp;<span class="num" id="6184559">26</span><span class="op" id="6184561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184565">26</span><span class="op" id="6184567">,</span>&nbsp;<span class="num" id="6184569">47</span><span class="op" id="6184571">,</span>&nbsp;<span class="num" id="6184573">99</span><span class="op" id="6184575">,</span>&nbsp;<span class="num" id="6184577">66</span><span class="op" id="6184579">,</span>&nbsp;<span class="num" id="6184581">56</span><span class="op" id="6184583">,</span>&nbsp;<span class="num" id="6184585">66</span><span class="op" id="6184587">,</span>&nbsp;<span class="num" id="6184589">99</span><span class="op" id="6184591">,</span>&nbsp;<span class="num" id="6184593">99</span><span class="op" id="6184595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184599">99</span><span class="op" id="6184601">,</span>&nbsp;<span class="num" id="6184603">99</span><span class="op" id="6184605">,</span>&nbsp;<span class="num" id="6184607">99</span><span class="op" id="6184609">,</span>&nbsp;<span class="num" id="6184611">99</span><span class="op" id="6184613">,</span>&nbsp;<span class="num" id="6184615">99</span><span class="op" id="6184617">,</span>&nbsp;<span class="num" id="6184619">99</span><span class="op" id="6184621">,</span>&nbsp;<span class="num" id="6184623">99</span><span class="op" id="6184625">,</span>&nbsp;<span class="num" id="6184627">99</span><span class="op" id="6184629">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184633">99</span><span class="op" id="6184635">,</span>&nbsp;<span class="num" id="6184637">99</span><span class="op" id="6184639">,</span>&nbsp;<span class="num" id="6184641">99</span><span class="op" id="6184643">,</span>&nbsp;<span class="num" id="6184645">99</span><span class="op" id="6184647">,</span>&nbsp;<span class="num" id="6184649">99</span><span class="op" id="6184651">,</span>&nbsp;<span class="num" id="6184653">99</span><span class="op" id="6184655">,</span>&nbsp;<span class="num" id="6184657">99</span><span class="op" id="6184659">,</span>&nbsp;<span class="num" id="6184661">99</span><span class="op" id="6184663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184667">99</span><span class="op" id="6184669">,</span>&nbsp;<span class="num" id="6184671">99</span><span class="op" id="6184673">,</span>&nbsp;<span class="num" id="6184675">99</span><span class="op" id="6184677">,</span>&nbsp;<span class="num" id="6184679">99</span><span class="op" id="6184681">,</span>&nbsp;<span class="num" id="6184683">99</span><span class="op" id="6184685">,</span>&nbsp;<span class="num" id="6184687">99</span><span class="op" id="6184689">,</span>&nbsp;<span class="num" id="6184691">99</span><span class="op" id="6184693">,</span>&nbsp;<span class="num" id="6184695">99</span><span class="op" id="6184697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184701">99</span><span class="op" id="6184703">,</span>&nbsp;<span class="num" id="6184705">99</span><span class="op" id="6184707">,</span>&nbsp;<span class="num" id="6184709">99</span><span class="op" id="6184711">,</span>&nbsp;<span class="num" id="6184713">99</span><span class="op" id="6184715">,</span>&nbsp;<span class="num" id="6184717">99</span><span class="op" id="6184719">,</span>&nbsp;<span class="num" id="6184721">99</span><span class="op" id="6184723">,</span>&nbsp;<span class="num" id="6184725">99</span><span class="op" id="6184727">,</span>&nbsp;<span class="num" id="6184729">99</span><span class="op" id="6184731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184735">99</span><span class="op" id="6184737">,</span>&nbsp;<span class="num" id="6184739">99</span><span class="op" id="6184741">,</span>&nbsp;<span class="num" id="6184743">99</span><span class="op" id="6184745">,</span>&nbsp;<span class="num" id="6184747">99</span><span class="op" id="6184749">,</span>&nbsp;<span class="num" id="6184751">99</span><span class="op" id="6184753">,</span>&nbsp;<span class="num" id="6184755">99</span><span class="op" id="6184757">,</span>&nbsp;<span class="num" id="6184759">99</span><span class="op" id="6184761">,</span>&nbsp;<span class="num" id="6184763">99</span><span class="op" id="6184765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6184769">99</span><span class="op" id="6184771">,</span>&nbsp;<span class="num" id="6184773">99</span><span class="op" id="6184775">,</span>&nbsp;<span class="num" id="6184777">99</span><span class="op" id="6184779">,</span>&nbsp;<span class="num" id="6184781">99</span><span class="op" id="6184783">,</span>&nbsp;<span class="num" id="6184785">99</span><span class="op" id="6184787">,</span>&nbsp;<span class="num" id="6184789">99</span><span class="op" id="6184791">,</span>&nbsp;<span class="num" id="6184793">99</span><span class="op" id="6184795">,</span>&nbsp;<span class="num" id="6184797">99</span><span class="op" id="6184799">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6184802">}</span><span class="op" id="6184803">,</span><br>
<span class="lineno"></span><span class="op" id="6184805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6184808">type</span>&nbsp;<span class="ident" id="6184813">huffIndex</span>&nbsp;<span class="builtintype" id="6184823">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6184828">const</span>&nbsp;<span class="op" id="6184834">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6184837">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="6184858">huffIndex</span>&nbsp;<span class="op" id="6184868">=</span>&nbsp;<span class="ident" id="6184870">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6184876">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6184898">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6184922">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6184946">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="6184957">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6184960">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="6185005">type</span>&nbsp;<span class="ident" id="6185010">huffmanSpec</span>&nbsp;<span class="keyword" id="6185022">struct</span>&nbsp;<span class="op" id="6185029">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6185032">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6185086">count</span>&nbsp;<span class="op" id="6185092">[</span><span class="num" id="6185093">16</span><span class="op" id="6185095">]</span><span class="builtintype" id="6185096">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6185102">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6185158">value</span>&nbsp;<span class="op" id="6185164">[</span><span class="op" id="6185165">]</span><span class="builtintype" id="6185166">byte</span><br>
<span class="lineno"></span><span class="op" id="6185171">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6185174">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="6185232">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="6185295">var</span>&nbsp;<span class="ident" id="6185299">theHuffmanSpec</span>&nbsp;<span class="op" id="6185314">=</span>&nbsp;<span class="op" id="6185316">[</span><span class="ident" id="6185317">nHuffIndex</span><span class="op" id="6185327">]</span><span class="ident" id="6185328">huffmanSpec</span><span class="op" id="6185339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6185342">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6185360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6185364">[</span><span class="num" id="6185365">16</span><span class="op" id="6185367">]</span><span class="builtintype" id="6185368">byte</span><span class="op" id="6185372">{</span><span class="num" id="6185373">0</span><span class="op" id="6185374">,</span>&nbsp;<span class="num" id="6185376">1</span><span class="op" id="6185377">,</span>&nbsp;<span class="num" id="6185379">5</span><span class="op" id="6185380">,</span>&nbsp;<span class="num" id="6185382">1</span><span class="op" id="6185383">,</span>&nbsp;<span class="num" id="6185385">1</span><span class="op" id="6185386">,</span>&nbsp;<span class="num" id="6185388">1</span><span class="op" id="6185389">,</span>&nbsp;<span class="num" id="6185391">1</span><span class="op" id="6185392">,</span>&nbsp;<span class="num" id="6185394">1</span><span class="op" id="6185395">,</span>&nbsp;<span class="num" id="6185397">1</span><span class="op" id="6185398">,</span>&nbsp;<span class="num" id="6185400">0</span><span class="op" id="6185401">,</span>&nbsp;<span class="num" id="6185403">0</span><span class="op" id="6185404">,</span>&nbsp;<span class="num" id="6185406">0</span><span class="op" id="6185407">,</span>&nbsp;<span class="num" id="6185409">0</span><span class="op" id="6185410">,</span>&nbsp;<span class="num" id="6185412">0</span><span class="op" id="6185413">,</span>&nbsp;<span class="num" id="6185415">0</span><span class="op" id="6185416">,</span>&nbsp;<span class="num" id="6185418">0</span><span class="op" id="6185419">}</span><span class="op" id="6185420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6185424">[</span><span class="op" id="6185425">]</span><span class="builtintype" id="6185426">byte</span><span class="op" id="6185430">{</span><span class="num" id="6185431">0</span><span class="op" id="6185432">,</span>&nbsp;<span class="num" id="6185434">1</span><span class="op" id="6185435">,</span>&nbsp;<span class="num" id="6185437">2</span><span class="op" id="6185438">,</span>&nbsp;<span class="num" id="6185440">3</span><span class="op" id="6185441">,</span>&nbsp;<span class="num" id="6185443">4</span><span class="op" id="6185444">,</span>&nbsp;<span class="num" id="6185446">5</span><span class="op" id="6185447">,</span>&nbsp;<span class="num" id="6185449">6</span><span class="op" id="6185450">,</span>&nbsp;<span class="num" id="6185452">7</span><span class="op" id="6185453">,</span>&nbsp;<span class="num" id="6185455">8</span><span class="op" id="6185456">,</span>&nbsp;<span class="num" id="6185458">9</span><span class="op" id="6185459">,</span>&nbsp;<span class="num" id="6185461">10</span><span class="op" id="6185463">,</span>&nbsp;<span class="num" id="6185465">11</span><span class="op" id="6185467">}</span><span class="op" id="6185468">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6185471">}</span><span class="op" id="6185472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6185475">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6185493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6185497">[</span><span class="num" id="6185498">16</span><span class="op" id="6185500">]</span><span class="builtintype" id="6185501">byte</span><span class="op" id="6185505">{</span><span class="num" id="6185506">0</span><span class="op" id="6185507">,</span>&nbsp;<span class="num" id="6185509">2</span><span class="op" id="6185510">,</span>&nbsp;<span class="num" id="6185512">1</span><span class="op" id="6185513">,</span>&nbsp;<span class="num" id="6185515">3</span><span class="op" id="6185516">,</span>&nbsp;<span class="num" id="6185518">3</span><span class="op" id="6185519">,</span>&nbsp;<span class="num" id="6185521">2</span><span class="op" id="6185522">,</span>&nbsp;<span class="num" id="6185524">4</span><span class="op" id="6185525">,</span>&nbsp;<span class="num" id="6185527">3</span><span class="op" id="6185528">,</span>&nbsp;<span class="num" id="6185530">5</span><span class="op" id="6185531">,</span>&nbsp;<span class="num" id="6185533">5</span><span class="op" id="6185534">,</span>&nbsp;<span class="num" id="6185536">4</span><span class="op" id="6185537">,</span>&nbsp;<span class="num" id="6185539">4</span><span class="op" id="6185540">,</span>&nbsp;<span class="num" id="6185542">0</span><span class="op" id="6185543">,</span>&nbsp;<span class="num" id="6185545">0</span><span class="op" id="6185546">,</span>&nbsp;<span class="num" id="6185548">1</span><span class="op" id="6185549">,</span>&nbsp;<span class="num" id="6185551">125</span><span class="op" id="6185554">}</span><span class="op" id="6185555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6185559">[</span><span class="op" id="6185560">]</span><span class="builtintype" id="6185561">byte</span><span class="op" id="6185565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6185570">0x01</span><span class="op" id="6185574">,</span>&nbsp;<span class="num" id="6185576">0x02</span><span class="op" id="6185580">,</span>&nbsp;<span class="num" id="6185582">0x03</span><span class="op" id="6185586">,</span>&nbsp;<span class="num" id="6185588">0x00</span><span class="op" id="6185592">,</span>&nbsp;<span class="num" id="6185594">0x04</span><span class="op" id="6185598">,</span>&nbsp;<span class="num" id="6185600">0x11</span><span class="op" id="6185604">,</span>&nbsp;<span class="num" id="6185606">0x05</span><span class="op" id="6185610">,</span>&nbsp;<span class="num" id="6185612">0x12</span><span class="op" id="6185616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6185621">0x21</span><span class="op" id="6185625">,</span>&nbsp;<span class="num" id="6185627">0x31</span><span class="op" id="6185631">,</span>&nbsp;<span class="num" id="6185633">0x41</span><span class="op" id="6185637">,</span>&nbsp;<span class="num" id="6185639">0x06</span><span class="op" id="6185643">,</span>&nbsp;<span class="num" id="6185645">0x13</span><span class="op" id="6185649">,</span>&nbsp;<span class="num" id="6185651">0x51</span><span class="op" id="6185655">,</span>&nbsp;<span class="num" id="6185657">0x61</span><span class="op" id="6185661">,</span>&nbsp;<span class="num" id="6185663">0x07</span><span class="op" id="6185667">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6185672">0x22</span><span class="op" id="6185676">,</span>&nbsp;<span class="num" id="6185678">0x71</span><span class="op" id="6185682">,</span>&nbsp;<span class="num" id="6185684">0x14</span><span class="op" id="6185688">,</span>&nbsp;<span class="num" id="6185690">0x32</span><span class="op" id="6185694">,</span>&nbsp;<span class="num" id="6185696">0x81</span><span class="op" id="6185700">,</span>&nbsp;<span class="num" id="6185702">0x91</span><span class="op" id="6185706">,</span>&nbsp;<span class="num" id="6185708">0xa1</span><span class="op" id="6185712">,</span>&nbsp;<span class="num" id="6185714">0x08</span><span class="op" id="6185718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6185723">0x23</span><span class="op" id="6185727">,</span>&nbsp;<span class="num" id="6185729">0x42</span><span class="op" id="6185733">,</span>&nbsp;<span class="num" id="6185735">0xb1</span><span class="op" id="6185739">,</span>&nbsp;<span class="num" id="6185741">0xc1</span><span class="op" id="6185745">,</span>&nbsp;<span class="num" id="6185747">0x15</span><span class="op" id="6185751">,</span>&nbsp;<span class="num" id="6185753">0x52</span><span class="op" id="6185757">,</span>&nbsp;<span class="num" id="6185759">0xd1</span><span class="op" id="6185763">,</span>&nbsp;<span class="num" id="6185765">0xf0</span><span class="op" id="6185769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6185774">0x24</span><span class="op" id="6185778">,</span>&nbsp;<span class="num" id="6185780">0x33</span><span class="op" id="6185784">,</span>&nbsp;<span class="num" id="6185786">0x62</span><span class="op" id="6185790">,</span>&nbsp;<span class="num" id="6185792">0x72</span><span class="op" id="6185796">,</span>&nbsp;<span class="num" id="6185798">0x82</span><span class="op" id="6185802">,</span>&nbsp;<span class="num" id="6185804">0x09</span><span class="op" id="6185808">,</span>&nbsp;<span class="num" id="6185810">0x0a</span><span class="op" id="6185814">,</span>&nbsp;<span class="num" id="6185816">0x16</span><span class="op" id="6185820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6185825">0x17</span><span class="op" id="6185829">,</span>&nbsp;<span class="num" id="6185831">0x18</span><span class="op" id="6185835">,</span>&nbsp;<span class="num" id="6185837">0x19</span><span class="op" id="6185841">,</span>&nbsp;<span class="num" id="6185843">0x1a</span><span class="op" id="6185847">,</span>&nbsp;<span class="num" id="6185849">0x25</span><span class="op" id="6185853">,</span>&nbsp;<span class="num" id="6185855">0x26</span><span class="op" id="6185859">,</span>&nbsp;<span class="num" id="6185861">0x27</span><span class="op" id="6185865">,</span>&nbsp;<span class="num" id="6185867">0x28</span><span class="op" id="6185871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6185876">0x29</span><span class="op" id="6185880">,</span>&nbsp;<span class="num" id="6185882">0x2a</span><span class="op" id="6185886">,</span>&nbsp;<span class="num" id="6185888">0x34</span><span class="op" id="6185892">,</span>&nbsp;<span class="num" id="6185894">0x35</span><span class="op" id="6185898">,</span>&nbsp;<span class="num" id="6185900">0x36</span><span class="op" id="6185904">,</span>&nbsp;<span class="num" id="6185906">0x37</span><span class="op" id="6185910">,</span>&nbsp;<span class="num" id="6185912">0x38</span><span class="op" id="6185916">,</span>&nbsp;<span class="num" id="6185918">0x39</span><span class="op" id="6185922">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6185927">0x3a</span><span class="op" id="6185931">,</span>&nbsp;<span class="num" id="6185933">0x43</span><span class="op" id="6185937">,</span>&nbsp;<span class="num" id="6185939">0x44</span><span class="op" id="6185943">,</span>&nbsp;<span class="num" id="6185945">0x45</span><span class="op" id="6185949">,</span>&nbsp;<span class="num" id="6185951">0x46</span><span class="op" id="6185955">,</span>&nbsp;<span class="num" id="6185957">0x47</span><span class="op" id="6185961">,</span>&nbsp;<span class="num" id="6185963">0x48</span><span class="op" id="6185967">,</span>&nbsp;<span class="num" id="6185969">0x49</span><span class="op" id="6185973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6185978">0x4a</span><span class="op" id="6185982">,</span>&nbsp;<span class="num" id="6185984">0x53</span><span class="op" id="6185988">,</span>&nbsp;<span class="num" id="6185990">0x54</span><span class="op" id="6185994">,</span>&nbsp;<span class="num" id="6185996">0x55</span><span class="op" id="6186000">,</span>&nbsp;<span class="num" id="6186002">0x56</span><span class="op" id="6186006">,</span>&nbsp;<span class="num" id="6186008">0x57</span><span class="op" id="6186012">,</span>&nbsp;<span class="num" id="6186014">0x58</span><span class="op" id="6186018">,</span>&nbsp;<span class="num" id="6186020">0x59</span><span class="op" id="6186024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186029">0x5a</span><span class="op" id="6186033">,</span>&nbsp;<span class="num" id="6186035">0x63</span><span class="op" id="6186039">,</span>&nbsp;<span class="num" id="6186041">0x64</span><span class="op" id="6186045">,</span>&nbsp;<span class="num" id="6186047">0x65</span><span class="op" id="6186051">,</span>&nbsp;<span class="num" id="6186053">0x66</span><span class="op" id="6186057">,</span>&nbsp;<span class="num" id="6186059">0x67</span><span class="op" id="6186063">,</span>&nbsp;<span class="num" id="6186065">0x68</span><span class="op" id="6186069">,</span>&nbsp;<span class="num" id="6186071">0x69</span><span class="op" id="6186075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186080">0x6a</span><span class="op" id="6186084">,</span>&nbsp;<span class="num" id="6186086">0x73</span><span class="op" id="6186090">,</span>&nbsp;<span class="num" id="6186092">0x74</span><span class="op" id="6186096">,</span>&nbsp;<span class="num" id="6186098">0x75</span><span class="op" id="6186102">,</span>&nbsp;<span class="num" id="6186104">0x76</span><span class="op" id="6186108">,</span>&nbsp;<span class="num" id="6186110">0x77</span><span class="op" id="6186114">,</span>&nbsp;<span class="num" id="6186116">0x78</span><span class="op" id="6186120">,</span>&nbsp;<span class="num" id="6186122">0x79</span><span class="op" id="6186126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186131">0x7a</span><span class="op" id="6186135">,</span>&nbsp;<span class="num" id="6186137">0x83</span><span class="op" id="6186141">,</span>&nbsp;<span class="num" id="6186143">0x84</span><span class="op" id="6186147">,</span>&nbsp;<span class="num" id="6186149">0x85</span><span class="op" id="6186153">,</span>&nbsp;<span class="num" id="6186155">0x86</span><span class="op" id="6186159">,</span>&nbsp;<span class="num" id="6186161">0x87</span><span class="op" id="6186165">,</span>&nbsp;<span class="num" id="6186167">0x88</span><span class="op" id="6186171">,</span>&nbsp;<span class="num" id="6186173">0x89</span><span class="op" id="6186177">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186182">0x8a</span><span class="op" id="6186186">,</span>&nbsp;<span class="num" id="6186188">0x92</span><span class="op" id="6186192">,</span>&nbsp;<span class="num" id="6186194">0x93</span><span class="op" id="6186198">,</span>&nbsp;<span class="num" id="6186200">0x94</span><span class="op" id="6186204">,</span>&nbsp;<span class="num" id="6186206">0x95</span><span class="op" id="6186210">,</span>&nbsp;<span class="num" id="6186212">0x96</span><span class="op" id="6186216">,</span>&nbsp;<span class="num" id="6186218">0x97</span><span class="op" id="6186222">,</span>&nbsp;<span class="num" id="6186224">0x98</span><span class="op" id="6186228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186233">0x99</span><span class="op" id="6186237">,</span>&nbsp;<span class="num" id="6186239">0x9a</span><span class="op" id="6186243">,</span>&nbsp;<span class="num" id="6186245">0xa2</span><span class="op" id="6186249">,</span>&nbsp;<span class="num" id="6186251">0xa3</span><span class="op" id="6186255">,</span>&nbsp;<span class="num" id="6186257">0xa4</span><span class="op" id="6186261">,</span>&nbsp;<span class="num" id="6186263">0xa5</span><span class="op" id="6186267">,</span>&nbsp;<span class="num" id="6186269">0xa6</span><span class="op" id="6186273">,</span>&nbsp;<span class="num" id="6186275">0xa7</span><span class="op" id="6186279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186284">0xa8</span><span class="op" id="6186288">,</span>&nbsp;<span class="num" id="6186290">0xa9</span><span class="op" id="6186294">,</span>&nbsp;<span class="num" id="6186296">0xaa</span><span class="op" id="6186300">,</span>&nbsp;<span class="num" id="6186302">0xb2</span><span class="op" id="6186306">,</span>&nbsp;<span class="num" id="6186308">0xb3</span><span class="op" id="6186312">,</span>&nbsp;<span class="num" id="6186314">0xb4</span><span class="op" id="6186318">,</span>&nbsp;<span class="num" id="6186320">0xb5</span><span class="op" id="6186324">,</span>&nbsp;<span class="num" id="6186326">0xb6</span><span class="op" id="6186330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186335">0xb7</span><span class="op" id="6186339">,</span>&nbsp;<span class="num" id="6186341">0xb8</span><span class="op" id="6186345">,</span>&nbsp;<span class="num" id="6186347">0xb9</span><span class="op" id="6186351">,</span>&nbsp;<span class="num" id="6186353">0xba</span><span class="op" id="6186357">,</span>&nbsp;<span class="num" id="6186359">0xc2</span><span class="op" id="6186363">,</span>&nbsp;<span class="num" id="6186365">0xc3</span><span class="op" id="6186369">,</span>&nbsp;<span class="num" id="6186371">0xc4</span><span class="op" id="6186375">,</span>&nbsp;<span class="num" id="6186377">0xc5</span><span class="op" id="6186381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186386">0xc6</span><span class="op" id="6186390">,</span>&nbsp;<span class="num" id="6186392">0xc7</span><span class="op" id="6186396">,</span>&nbsp;<span class="num" id="6186398">0xc8</span><span class="op" id="6186402">,</span>&nbsp;<span class="num" id="6186404">0xc9</span><span class="op" id="6186408">,</span>&nbsp;<span class="num" id="6186410">0xca</span><span class="op" id="6186414">,</span>&nbsp;<span class="num" id="6186416">0xd2</span><span class="op" id="6186420">,</span>&nbsp;<span class="num" id="6186422">0xd3</span><span class="op" id="6186426">,</span>&nbsp;<span class="num" id="6186428">0xd4</span><span class="op" id="6186432">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186437">0xd5</span><span class="op" id="6186441">,</span>&nbsp;<span class="num" id="6186443">0xd6</span><span class="op" id="6186447">,</span>&nbsp;<span class="num" id="6186449">0xd7</span><span class="op" id="6186453">,</span>&nbsp;<span class="num" id="6186455">0xd8</span><span class="op" id="6186459">,</span>&nbsp;<span class="num" id="6186461">0xd9</span><span class="op" id="6186465">,</span>&nbsp;<span class="num" id="6186467">0xda</span><span class="op" id="6186471">,</span>&nbsp;<span class="num" id="6186473">0xe1</span><span class="op" id="6186477">,</span>&nbsp;<span class="num" id="6186479">0xe2</span><span class="op" id="6186483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186488">0xe3</span><span class="op" id="6186492">,</span>&nbsp;<span class="num" id="6186494">0xe4</span><span class="op" id="6186498">,</span>&nbsp;<span class="num" id="6186500">0xe5</span><span class="op" id="6186504">,</span>&nbsp;<span class="num" id="6186506">0xe6</span><span class="op" id="6186510">,</span>&nbsp;<span class="num" id="6186512">0xe7</span><span class="op" id="6186516">,</span>&nbsp;<span class="num" id="6186518">0xe8</span><span class="op" id="6186522">,</span>&nbsp;<span class="num" id="6186524">0xe9</span><span class="op" id="6186528">,</span>&nbsp;<span class="num" id="6186530">0xea</span><span class="op" id="6186534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186539">0xf1</span><span class="op" id="6186543">,</span>&nbsp;<span class="num" id="6186545">0xf2</span><span class="op" id="6186549">,</span>&nbsp;<span class="num" id="6186551">0xf3</span><span class="op" id="6186555">,</span>&nbsp;<span class="num" id="6186557">0xf4</span><span class="op" id="6186561">,</span>&nbsp;<span class="num" id="6186563">0xf5</span><span class="op" id="6186567">,</span>&nbsp;<span class="num" id="6186569">0xf6</span><span class="op" id="6186573">,</span>&nbsp;<span class="num" id="6186575">0xf7</span><span class="op" id="6186579">,</span>&nbsp;<span class="num" id="6186581">0xf8</span><span class="op" id="6186585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186590">0xf9</span><span class="op" id="6186594">,</span>&nbsp;<span class="num" id="6186596">0xfa</span><span class="op" id="6186600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6186604">}</span><span class="op" id="6186605">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6186608">}</span><span class="op" id="6186609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6186612">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6186632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6186636">[</span><span class="num" id="6186637">16</span><span class="op" id="6186639">]</span><span class="builtintype" id="6186640">byte</span><span class="op" id="6186644">{</span><span class="num" id="6186645">0</span><span class="op" id="6186646">,</span>&nbsp;<span class="num" id="6186648">3</span><span class="op" id="6186649">,</span>&nbsp;<span class="num" id="6186651">1</span><span class="op" id="6186652">,</span>&nbsp;<span class="num" id="6186654">1</span><span class="op" id="6186655">,</span>&nbsp;<span class="num" id="6186657">1</span><span class="op" id="6186658">,</span>&nbsp;<span class="num" id="6186660">1</span><span class="op" id="6186661">,</span>&nbsp;<span class="num" id="6186663">1</span><span class="op" id="6186664">,</span>&nbsp;<span class="num" id="6186666">1</span><span class="op" id="6186667">,</span>&nbsp;<span class="num" id="6186669">1</span><span class="op" id="6186670">,</span>&nbsp;<span class="num" id="6186672">1</span><span class="op" id="6186673">,</span>&nbsp;<span class="num" id="6186675">1</span><span class="op" id="6186676">,</span>&nbsp;<span class="num" id="6186678">0</span><span class="op" id="6186679">,</span>&nbsp;<span class="num" id="6186681">0</span><span class="op" id="6186682">,</span>&nbsp;<span class="num" id="6186684">0</span><span class="op" id="6186685">,</span>&nbsp;<span class="num" id="6186687">0</span><span class="op" id="6186688">,</span>&nbsp;<span class="num" id="6186690">0</span><span class="op" id="6186691">}</span><span class="op" id="6186692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6186696">[</span><span class="op" id="6186697">]</span><span class="builtintype" id="6186698">byte</span><span class="op" id="6186702">{</span><span class="num" id="6186703">0</span><span class="op" id="6186704">,</span>&nbsp;<span class="num" id="6186706">1</span><span class="op" id="6186707">,</span>&nbsp;<span class="num" id="6186709">2</span><span class="op" id="6186710">,</span>&nbsp;<span class="num" id="6186712">3</span><span class="op" id="6186713">,</span>&nbsp;<span class="num" id="6186715">4</span><span class="op" id="6186716">,</span>&nbsp;<span class="num" id="6186718">5</span><span class="op" id="6186719">,</span>&nbsp;<span class="num" id="6186721">6</span><span class="op" id="6186722">,</span>&nbsp;<span class="num" id="6186724">7</span><span class="op" id="6186725">,</span>&nbsp;<span class="num" id="6186727">8</span><span class="op" id="6186728">,</span>&nbsp;<span class="num" id="6186730">9</span><span class="op" id="6186731">,</span>&nbsp;<span class="num" id="6186733">10</span><span class="op" id="6186735">,</span>&nbsp;<span class="num" id="6186737">11</span><span class="op" id="6186739">}</span><span class="op" id="6186740">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6186743">}</span><span class="op" id="6186744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6186747">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6186767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6186771">[</span><span class="num" id="6186772">16</span><span class="op" id="6186774">]</span><span class="builtintype" id="6186775">byte</span><span class="op" id="6186779">{</span><span class="num" id="6186780">0</span><span class="op" id="6186781">,</span>&nbsp;<span class="num" id="6186783">2</span><span class="op" id="6186784">,</span>&nbsp;<span class="num" id="6186786">1</span><span class="op" id="6186787">,</span>&nbsp;<span class="num" id="6186789">2</span><span class="op" id="6186790">,</span>&nbsp;<span class="num" id="6186792">4</span><span class="op" id="6186793">,</span>&nbsp;<span class="num" id="6186795">4</span><span class="op" id="6186796">,</span>&nbsp;<span class="num" id="6186798">3</span><span class="op" id="6186799">,</span>&nbsp;<span class="num" id="6186801">4</span><span class="op" id="6186802">,</span>&nbsp;<span class="num" id="6186804">7</span><span class="op" id="6186805">,</span>&nbsp;<span class="num" id="6186807">5</span><span class="op" id="6186808">,</span>&nbsp;<span class="num" id="6186810">4</span><span class="op" id="6186811">,</span>&nbsp;<span class="num" id="6186813">4</span><span class="op" id="6186814">,</span>&nbsp;<span class="num" id="6186816">0</span><span class="op" id="6186817">,</span>&nbsp;<span class="num" id="6186819">1</span><span class="op" id="6186820">,</span>&nbsp;<span class="num" id="6186822">2</span><span class="op" id="6186823">,</span>&nbsp;<span class="num" id="6186825">119</span><span class="op" id="6186828">}</span><span class="op" id="6186829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6186833">[</span><span class="op" id="6186834">]</span><span class="builtintype" id="6186835">byte</span><span class="op" id="6186839">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186844">0x00</span><span class="op" id="6186848">,</span>&nbsp;<span class="num" id="6186850">0x01</span><span class="op" id="6186854">,</span>&nbsp;<span class="num" id="6186856">0x02</span><span class="op" id="6186860">,</span>&nbsp;<span class="num" id="6186862">0x03</span><span class="op" id="6186866">,</span>&nbsp;<span class="num" id="6186868">0x11</span><span class="op" id="6186872">,</span>&nbsp;<span class="num" id="6186874">0x04</span><span class="op" id="6186878">,</span>&nbsp;<span class="num" id="6186880">0x05</span><span class="op" id="6186884">,</span>&nbsp;<span class="num" id="6186886">0x21</span><span class="op" id="6186890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186895">0x31</span><span class="op" id="6186899">,</span>&nbsp;<span class="num" id="6186901">0x06</span><span class="op" id="6186905">,</span>&nbsp;<span class="num" id="6186907">0x12</span><span class="op" id="6186911">,</span>&nbsp;<span class="num" id="6186913">0x41</span><span class="op" id="6186917">,</span>&nbsp;<span class="num" id="6186919">0x51</span><span class="op" id="6186923">,</span>&nbsp;<span class="num" id="6186925">0x07</span><span class="op" id="6186929">,</span>&nbsp;<span class="num" id="6186931">0x61</span><span class="op" id="6186935">,</span>&nbsp;<span class="num" id="6186937">0x71</span><span class="op" id="6186941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186946">0x13</span><span class="op" id="6186950">,</span>&nbsp;<span class="num" id="6186952">0x22</span><span class="op" id="6186956">,</span>&nbsp;<span class="num" id="6186958">0x32</span><span class="op" id="6186962">,</span>&nbsp;<span class="num" id="6186964">0x81</span><span class="op" id="6186968">,</span>&nbsp;<span class="num" id="6186970">0x08</span><span class="op" id="6186974">,</span>&nbsp;<span class="num" id="6186976">0x14</span><span class="op" id="6186980">,</span>&nbsp;<span class="num" id="6186982">0x42</span><span class="op" id="6186986">,</span>&nbsp;<span class="num" id="6186988">0x91</span><span class="op" id="6186992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6186997">0xa1</span><span class="op" id="6187001">,</span>&nbsp;<span class="num" id="6187003">0xb1</span><span class="op" id="6187007">,</span>&nbsp;<span class="num" id="6187009">0xc1</span><span class="op" id="6187013">,</span>&nbsp;<span class="num" id="6187015">0x09</span><span class="op" id="6187019">,</span>&nbsp;<span class="num" id="6187021">0x23</span><span class="op" id="6187025">,</span>&nbsp;<span class="num" id="6187027">0x33</span><span class="op" id="6187031">,</span>&nbsp;<span class="num" id="6187033">0x52</span><span class="op" id="6187037">,</span>&nbsp;<span class="num" id="6187039">0xf0</span><span class="op" id="6187043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187048">0x15</span><span class="op" id="6187052">,</span>&nbsp;<span class="num" id="6187054">0x62</span><span class="op" id="6187058">,</span>&nbsp;<span class="num" id="6187060">0x72</span><span class="op" id="6187064">,</span>&nbsp;<span class="num" id="6187066">0xd1</span><span class="op" id="6187070">,</span>&nbsp;<span class="num" id="6187072">0x0a</span><span class="op" id="6187076">,</span>&nbsp;<span class="num" id="6187078">0x16</span><span class="op" id="6187082">,</span>&nbsp;<span class="num" id="6187084">0x24</span><span class="op" id="6187088">,</span>&nbsp;<span class="num" id="6187090">0x34</span><span class="op" id="6187094">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187099">0xe1</span><span class="op" id="6187103">,</span>&nbsp;<span class="num" id="6187105">0x25</span><span class="op" id="6187109">,</span>&nbsp;<span class="num" id="6187111">0xf1</span><span class="op" id="6187115">,</span>&nbsp;<span class="num" id="6187117">0x17</span><span class="op" id="6187121">,</span>&nbsp;<span class="num" id="6187123">0x18</span><span class="op" id="6187127">,</span>&nbsp;<span class="num" id="6187129">0x19</span><span class="op" id="6187133">,</span>&nbsp;<span class="num" id="6187135">0x1a</span><span class="op" id="6187139">,</span>&nbsp;<span class="num" id="6187141">0x26</span><span class="op" id="6187145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187150">0x27</span><span class="op" id="6187154">,</span>&nbsp;<span class="num" id="6187156">0x28</span><span class="op" id="6187160">,</span>&nbsp;<span class="num" id="6187162">0x29</span><span class="op" id="6187166">,</span>&nbsp;<span class="num" id="6187168">0x2a</span><span class="op" id="6187172">,</span>&nbsp;<span class="num" id="6187174">0x35</span><span class="op" id="6187178">,</span>&nbsp;<span class="num" id="6187180">0x36</span><span class="op" id="6187184">,</span>&nbsp;<span class="num" id="6187186">0x37</span><span class="op" id="6187190">,</span>&nbsp;<span class="num" id="6187192">0x38</span><span class="op" id="6187196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187201">0x39</span><span class="op" id="6187205">,</span>&nbsp;<span class="num" id="6187207">0x3a</span><span class="op" id="6187211">,</span>&nbsp;<span class="num" id="6187213">0x43</span><span class="op" id="6187217">,</span>&nbsp;<span class="num" id="6187219">0x44</span><span class="op" id="6187223">,</span>&nbsp;<span class="num" id="6187225">0x45</span><span class="op" id="6187229">,</span>&nbsp;<span class="num" id="6187231">0x46</span><span class="op" id="6187235">,</span>&nbsp;<span class="num" id="6187237">0x47</span><span class="op" id="6187241">,</span>&nbsp;<span class="num" id="6187243">0x48</span><span class="op" id="6187247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187252">0x49</span><span class="op" id="6187256">,</span>&nbsp;<span class="num" id="6187258">0x4a</span><span class="op" id="6187262">,</span>&nbsp;<span class="num" id="6187264">0x53</span><span class="op" id="6187268">,</span>&nbsp;<span class="num" id="6187270">0x54</span><span class="op" id="6187274">,</span>&nbsp;<span class="num" id="6187276">0x55</span><span class="op" id="6187280">,</span>&nbsp;<span class="num" id="6187282">0x56</span><span class="op" id="6187286">,</span>&nbsp;<span class="num" id="6187288">0x57</span><span class="op" id="6187292">,</span>&nbsp;<span class="num" id="6187294">0x58</span><span class="op" id="6187298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187303">0x59</span><span class="op" id="6187307">,</span>&nbsp;<span class="num" id="6187309">0x5a</span><span class="op" id="6187313">,</span>&nbsp;<span class="num" id="6187315">0x63</span><span class="op" id="6187319">,</span>&nbsp;<span class="num" id="6187321">0x64</span><span class="op" id="6187325">,</span>&nbsp;<span class="num" id="6187327">0x65</span><span class="op" id="6187331">,</span>&nbsp;<span class="num" id="6187333">0x66</span><span class="op" id="6187337">,</span>&nbsp;<span class="num" id="6187339">0x67</span><span class="op" id="6187343">,</span>&nbsp;<span class="num" id="6187345">0x68</span><span class="op" id="6187349">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187354">0x69</span><span class="op" id="6187358">,</span>&nbsp;<span class="num" id="6187360">0x6a</span><span class="op" id="6187364">,</span>&nbsp;<span class="num" id="6187366">0x73</span><span class="op" id="6187370">,</span>&nbsp;<span class="num" id="6187372">0x74</span><span class="op" id="6187376">,</span>&nbsp;<span class="num" id="6187378">0x75</span><span class="op" id="6187382">,</span>&nbsp;<span class="num" id="6187384">0x76</span><span class="op" id="6187388">,</span>&nbsp;<span class="num" id="6187390">0x77</span><span class="op" id="6187394">,</span>&nbsp;<span class="num" id="6187396">0x78</span><span class="op" id="6187400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187405">0x79</span><span class="op" id="6187409">,</span>&nbsp;<span class="num" id="6187411">0x7a</span><span class="op" id="6187415">,</span>&nbsp;<span class="num" id="6187417">0x82</span><span class="op" id="6187421">,</span>&nbsp;<span class="num" id="6187423">0x83</span><span class="op" id="6187427">,</span>&nbsp;<span class="num" id="6187429">0x84</span><span class="op" id="6187433">,</span>&nbsp;<span class="num" id="6187435">0x85</span><span class="op" id="6187439">,</span>&nbsp;<span class="num" id="6187441">0x86</span><span class="op" id="6187445">,</span>&nbsp;<span class="num" id="6187447">0x87</span><span class="op" id="6187451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187456">0x88</span><span class="op" id="6187460">,</span>&nbsp;<span class="num" id="6187462">0x89</span><span class="op" id="6187466">,</span>&nbsp;<span class="num" id="6187468">0x8a</span><span class="op" id="6187472">,</span>&nbsp;<span class="num" id="6187474">0x92</span><span class="op" id="6187478">,</span>&nbsp;<span class="num" id="6187480">0x93</span><span class="op" id="6187484">,</span>&nbsp;<span class="num" id="6187486">0x94</span><span class="op" id="6187490">,</span>&nbsp;<span class="num" id="6187492">0x95</span><span class="op" id="6187496">,</span>&nbsp;<span class="num" id="6187498">0x96</span><span class="op" id="6187502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187507">0x97</span><span class="op" id="6187511">,</span>&nbsp;<span class="num" id="6187513">0x98</span><span class="op" id="6187517">,</span>&nbsp;<span class="num" id="6187519">0x99</span><span class="op" id="6187523">,</span>&nbsp;<span class="num" id="6187525">0x9a</span><span class="op" id="6187529">,</span>&nbsp;<span class="num" id="6187531">0xa2</span><span class="op" id="6187535">,</span>&nbsp;<span class="num" id="6187537">0xa3</span><span class="op" id="6187541">,</span>&nbsp;<span class="num" id="6187543">0xa4</span><span class="op" id="6187547">,</span>&nbsp;<span class="num" id="6187549">0xa5</span><span class="op" id="6187553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187558">0xa6</span><span class="op" id="6187562">,</span>&nbsp;<span class="num" id="6187564">0xa7</span><span class="op" id="6187568">,</span>&nbsp;<span class="num" id="6187570">0xa8</span><span class="op" id="6187574">,</span>&nbsp;<span class="num" id="6187576">0xa9</span><span class="op" id="6187580">,</span>&nbsp;<span class="num" id="6187582">0xaa</span><span class="op" id="6187586">,</span>&nbsp;<span class="num" id="6187588">0xb2</span><span class="op" id="6187592">,</span>&nbsp;<span class="num" id="6187594">0xb3</span><span class="op" id="6187598">,</span>&nbsp;<span class="num" id="6187600">0xb4</span><span class="op" id="6187604">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187609">0xb5</span><span class="op" id="6187613">,</span>&nbsp;<span class="num" id="6187615">0xb6</span><span class="op" id="6187619">,</span>&nbsp;<span class="num" id="6187621">0xb7</span><span class="op" id="6187625">,</span>&nbsp;<span class="num" id="6187627">0xb8</span><span class="op" id="6187631">,</span>&nbsp;<span class="num" id="6187633">0xb9</span><span class="op" id="6187637">,</span>&nbsp;<span class="num" id="6187639">0xba</span><span class="op" id="6187643">,</span>&nbsp;<span class="num" id="6187645">0xc2</span><span class="op" id="6187649">,</span>&nbsp;<span class="num" id="6187651">0xc3</span><span class="op" id="6187655">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187660">0xc4</span><span class="op" id="6187664">,</span>&nbsp;<span class="num" id="6187666">0xc5</span><span class="op" id="6187670">,</span>&nbsp;<span class="num" id="6187672">0xc6</span><span class="op" id="6187676">,</span>&nbsp;<span class="num" id="6187678">0xc7</span><span class="op" id="6187682">,</span>&nbsp;<span class="num" id="6187684">0xc8</span><span class="op" id="6187688">,</span>&nbsp;<span class="num" id="6187690">0xc9</span><span class="op" id="6187694">,</span>&nbsp;<span class="num" id="6187696">0xca</span><span class="op" id="6187700">,</span>&nbsp;<span class="num" id="6187702">0xd2</span><span class="op" id="6187706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187711">0xd3</span><span class="op" id="6187715">,</span>&nbsp;<span class="num" id="6187717">0xd4</span><span class="op" id="6187721">,</span>&nbsp;<span class="num" id="6187723">0xd5</span><span class="op" id="6187727">,</span>&nbsp;<span class="num" id="6187729">0xd6</span><span class="op" id="6187733">,</span>&nbsp;<span class="num" id="6187735">0xd7</span><span class="op" id="6187739">,</span>&nbsp;<span class="num" id="6187741">0xd8</span><span class="op" id="6187745">,</span>&nbsp;<span class="num" id="6187747">0xd9</span><span class="op" id="6187751">,</span>&nbsp;<span class="num" id="6187753">0xda</span><span class="op" id="6187757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187762">0xe2</span><span class="op" id="6187766">,</span>&nbsp;<span class="num" id="6187768">0xe3</span><span class="op" id="6187772">,</span>&nbsp;<span class="num" id="6187774">0xe4</span><span class="op" id="6187778">,</span>&nbsp;<span class="num" id="6187780">0xe5</span><span class="op" id="6187784">,</span>&nbsp;<span class="num" id="6187786">0xe6</span><span class="op" id="6187790">,</span>&nbsp;<span class="num" id="6187792">0xe7</span><span class="op" id="6187796">,</span>&nbsp;<span class="num" id="6187798">0xe8</span><span class="op" id="6187802">,</span>&nbsp;<span class="num" id="6187804">0xe9</span><span class="op" id="6187808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187813">0xea</span><span class="op" id="6187817">,</span>&nbsp;<span class="num" id="6187819">0xf2</span><span class="op" id="6187823">,</span>&nbsp;<span class="num" id="6187825">0xf3</span><span class="op" id="6187829">,</span>&nbsp;<span class="num" id="6187831">0xf4</span><span class="op" id="6187835">,</span>&nbsp;<span class="num" id="6187837">0xf5</span><span class="op" id="6187841">,</span>&nbsp;<span class="num" id="6187843">0xf6</span><span class="op" id="6187847">,</span>&nbsp;<span class="num" id="6187849">0xf7</span><span class="op" id="6187853">,</span>&nbsp;<span class="num" id="6187855">0xf8</span><span class="op" id="6187859">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6187864">0xf9</span><span class="op" id="6187868">,</span>&nbsp;<span class="num" id="6187870">0xfa</span><span class="op" id="6187874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6187878">}</span><span class="op" id="6187879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6187882">}</span><span class="op" id="6187883">,</span><br>
<span class="lineno"></span><span class="op" id="6187885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6187888">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="6187963">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6188040">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="6188118">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="6188159">type</span>&nbsp;<span class="ident" id="6188164">huffmanLUT</span>&nbsp;<span class="op" id="6188175">[</span><span class="op" id="6188176">]</span><span class="builtintype" id="6188177">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="6188185">func</span>&nbsp;<span class="op" id="6188190">(</span><span class="ident" id="6188191">h</span>&nbsp;<span class="op" id="6188193">*</span><span class="ident" id="6188194">huffmanLUT</span><span class="op" id="6188204">)</span>&nbsp;<span class="ident" id="6188206">init</span><span class="op" id="6188210">(</span><span class="ident" id="6188211">s</span>&nbsp;<span class="ident" id="6188213">huffmanSpec</span><span class="op" id="6188224">)</span>&nbsp;<span class="op" id="6188226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6188229">maxValue</span>&nbsp;<span class="op" id="6188238">:=</span>&nbsp;<span class="num" id="6188241">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6188244">for</span>&nbsp;<span class="ident" id="6188248">_</span><span class="op" id="6188249">,</span>&nbsp;<span class="ident" id="6188251">v</span>&nbsp;<span class="op" id="6188253">:=</span>&nbsp;<span class="keyword" id="6188256">range</span>&nbsp;<span class="ident" id="6188262">s</span><span class="op" id="6188263">.</span><span class="ident" id="6188264">value</span>&nbsp;<span class="op" id="6188270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6188274">if</span>&nbsp;<span class="builtintype" id="6188277">int</span><span class="op" id="6188280">(</span><span class="ident" id="6188281">v</span><span class="op" id="6188282">)</span>&nbsp;<span class="op" id="6188284">&gt;</span>&nbsp;<span class="ident" id="6188286">maxValue</span>&nbsp;<span class="op" id="6188295">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6188300">maxValue</span>&nbsp;<span class="op" id="6188309">=</span>&nbsp;<span class="builtintype" id="6188311">int</span><span class="op" id="6188314">(</span><span class="ident" id="6188315">v</span><span class="op" id="6188316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6188320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6188323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6188326">*</span><span class="ident" id="6188327">h</span>&nbsp;<span class="op" id="6188329">=</span>&nbsp;<span class="builtinfunc" id="6188331">make</span><span class="op" id="6188335">(</span><span class="op" id="6188336">[</span><span class="op" id="6188337">]</span><span class="builtintype" id="6188338">uint32</span><span class="op" id="6188344">,</span>&nbsp;<span class="ident" id="6188346">maxValue</span><span class="op" id="6188354">+</span><span class="num" id="6188355">1</span><span class="op" id="6188356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6188359">code</span><span class="op" id="6188363">,</span>&nbsp;<span class="ident" id="6188365">k</span>&nbsp;<span class="op" id="6188367">:=</span>&nbsp;<span class="builtintype" id="6188370">uint32</span><span class="op" id="6188376">(</span><span class="num" id="6188377">0</span><span class="op" id="6188378">)</span><span class="op" id="6188379">,</span>&nbsp;<span class="num" id="6188381">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6188384">for</span>&nbsp;<span class="ident" id="6188388">i</span>&nbsp;<span class="op" id="6188390">:=</span>&nbsp;<span class="num" id="6188393">0</span><span class="op" id="6188394">;</span>&nbsp;<span class="ident" id="6188396">i</span>&nbsp;<span class="op" id="6188398">&lt;</span>&nbsp;<span class="builtinfunc" id="6188400">len</span><span class="op" id="6188403">(</span><span class="ident" id="6188404">s</span><span class="op" id="6188405">.</span><span class="ident" id="6188406">count</span><span class="op" id="6188411">)</span><span class="op" id="6188412">;</span>&nbsp;<span class="ident" id="6188414">i</span><span class="op" id="6188415">++</span>&nbsp;<span class="op" id="6188418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6188422">nBits</span>&nbsp;<span class="op" id="6188428">:=</span>&nbsp;<span class="builtintype" id="6188431">uint32</span><span class="op" id="6188437">(</span><span class="ident" id="6188438">i</span><span class="op" id="6188439">+</span><span class="num" id="6188440">1</span><span class="op" id="6188441">)</span>&nbsp;<span class="op" id="6188443">&lt;&lt;</span>&nbsp;<span class="num" id="6188446">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6188451">for</span>&nbsp;<span class="ident" id="6188455">j</span>&nbsp;<span class="op" id="6188457">:=</span>&nbsp;<span class="builtintype" id="6188460">uint8</span><span class="op" id="6188465">(</span><span class="num" id="6188466">0</span><span class="op" id="6188467">)</span><span class="op" id="6188468">;</span>&nbsp;<span class="ident" id="6188470">j</span>&nbsp;<span class="op" id="6188472">&lt;</span>&nbsp;<span class="ident" id="6188474">s</span><span class="op" id="6188475">.</span><span class="ident" id="6188476">count</span><span class="op" id="6188481">[</span><span class="ident" id="6188482">i</span><span class="op" id="6188483">]</span><span class="op" id="6188484">;</span>&nbsp;<span class="ident" id="6188486">j</span><span class="op" id="6188487">++</span>&nbsp;<span class="op" id="6188490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6188495">(</span><span class="op" id="6188496">*</span><span class="ident" id="6188497">h</span><span class="op" id="6188498">)</span><span class="op" id="6188499">[</span><span class="ident" id="6188500">s</span><span class="op" id="6188501">.</span><span class="ident" id="6188502">value</span><span class="op" id="6188507">[</span><span class="ident" id="6188508">k</span><span class="op" id="6188509">]</span><span class="op" id="6188510">]</span>&nbsp;<span class="op" id="6188512">=</span>&nbsp;<span class="ident" id="6188514">nBits</span>&nbsp;<span class="op" id="6188520">|</span>&nbsp;<span class="ident" id="6188522">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6188530">code</span><span class="op" id="6188534">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6188540">k</span><span class="op" id="6188541">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6188546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6188550">code</span>&nbsp;<span class="op" id="6188555">&lt;&lt;=</span>&nbsp;<span class="num" id="6188559">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6188562">}</span><br>
<span class="lineno"></span><span class="op" id="6188564">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="6188567">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="6188632">var</span>&nbsp;<span class="ident" id="6188636">theHuffmanLUT</span>&nbsp;<span class="op" id="6188650">[</span><span class="num" id="6188651">4</span><span class="op" id="6188652">]</span><span class="ident" id="6188653">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6188665">func</span>&nbsp;<span class="ident" id="6188670">init</span><span class="op" id="6188674">(</span><span class="op" id="6188675">)</span>&nbsp;<span class="op" id="6188677">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6188680">for</span>&nbsp;<span class="ident" id="6188684">i</span><span class="op" id="6188685">,</span>&nbsp;<span class="ident" id="6188687">s</span>&nbsp;<span class="op" id="6188689">:=</span>&nbsp;<span class="keyword" id="6188692">range</span>&nbsp;<span class="ident" id="6188698">theHuffmanSpec</span>&nbsp;<span class="op" id="6188713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6188717">theHuffmanLUT</span><span class="op" id="6188730">[</span><span class="ident" id="6188731">i</span><span class="op" id="6188732">]</span><span class="op" id="6188733">.</span><span class="ident" id="6188734">init</span><span class="op" id="6188738">(</span><span class="ident" id="6188739">s</span><span class="op" id="6188740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6188743">}</span><br>
<span class="lineno"></span><span class="op" id="6188745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="6188748">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6188780">type</span>&nbsp;<span class="ident" id="6188785">writer</span>&nbsp;<span class="keyword" id="6188792">interface</span>&nbsp;<span class="op" id="6188802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6188805">Flush</span><span class="op" id="6188810">(</span><span class="op" id="6188811">)</span>&nbsp;<span class="builtintype" id="6188813">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6188820">io</span><span class="op" id="6188822">.</span><span class="ident" id="6188823">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6188831">io</span><span class="op" id="6188833">.</span><span class="ident" id="6188834">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="6188845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6188848">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6188896">type</span>&nbsp;<span class="ident" id="6188901">encoder</span>&nbsp;<span class="keyword" id="6188909">struct</span>&nbsp;<span class="op" id="6188916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6188919">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6188994">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189065">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6189069">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189077">err</span>&nbsp;<span class="builtintype" id="6189081">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6189088">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189117">buf</span>&nbsp;<span class="op" id="6189121">[</span><span class="num" id="6189122">16</span><span class="op" id="6189124">]</span><span class="builtintype" id="6189125">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6189131">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189186">bits</span><span class="op" id="6189190">,</span>&nbsp;<span class="ident" id="6189192">nBits</span>&nbsp;<span class="builtintype" id="6189198">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6189206">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189269">quant</span>&nbsp;<span class="op" id="6189275">[</span><span class="ident" id="6189276">nQuantIndex</span><span class="op" id="6189287">]</span><span class="op" id="6189288">[</span><span class="ident" id="6189289">blockSize</span><span class="op" id="6189298">]</span><span class="builtintype" id="6189299">byte</span><br>
<span class="lineno"></span><span class="op" id="6189304">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="6189307">func</span>&nbsp;<span class="op" id="6189312">(</span><span class="ident" id="6189313">e</span>&nbsp;<span class="op" id="6189315">*</span><span class="ident" id="6189316">encoder</span><span class="op" id="6189323">)</span>&nbsp;<span class="ident" id="6189325">flush</span><span class="op" id="6189330">(</span><span class="op" id="6189331">)</span>&nbsp;<span class="op" id="6189333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6189336">if</span>&nbsp;<span class="ident" id="6189339">e</span><span class="op" id="6189340">.</span><span class="ident" id="6189341">err</span>&nbsp;<span class="op" id="6189345">!=</span>&nbsp;<span class="ident" id="6189348">nil</span>&nbsp;<span class="op" id="6189352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6189356">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6189364">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189367">e</span><span class="op" id="6189368">.</span><span class="ident" id="6189369">err</span>&nbsp;<span class="op" id="6189373">=</span>&nbsp;<span class="ident" id="6189375">e</span><span class="op" id="6189376">.</span><span class="ident" id="6189377">w</span><span class="op" id="6189378">.</span><span class="ident" id="6189379">Flush</span><span class="op" id="6189384">(</span><span class="op" id="6189385">)</span><br>
<span class="lineno"></span><span class="op" id="6189387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6189390">func</span>&nbsp;<span class="op" id="6189395">(</span><span class="ident" id="6189396">e</span>&nbsp;<span class="op" id="6189398">*</span><span class="ident" id="6189399">encoder</span><span class="op" id="6189406">)</span>&nbsp;<span class="ident" id="6189408">write</span><span class="op" id="6189413">(</span><span class="ident" id="6189414">p</span>&nbsp;<span class="op" id="6189416">[</span><span class="op" id="6189417">]</span><span class="builtintype" id="6189418">byte</span><span class="op" id="6189422">)</span>&nbsp;<span class="op" id="6189424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6189427">if</span>&nbsp;<span class="ident" id="6189430">e</span><span class="op" id="6189431">.</span><span class="ident" id="6189432">err</span>&nbsp;<span class="op" id="6189436">!=</span>&nbsp;<span class="ident" id="6189439">nil</span>&nbsp;<span class="op" id="6189443">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6189447">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6189455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189458">_</span><span class="op" id="6189459">,</span>&nbsp;<span class="ident" id="6189461">e</span><span class="op" id="6189462">.</span><span class="ident" id="6189463">err</span>&nbsp;<span class="op" id="6189467">=</span>&nbsp;<span class="ident" id="6189469">e</span><span class="op" id="6189470">.</span><span class="ident" id="6189471">w</span><span class="op" id="6189472">.</span><span class="ident" id="6189473">Write</span><span class="op" id="6189478">(</span><span class="ident" id="6189479">p</span><span class="op" id="6189480">)</span><br>
<span class="lineno"></span><span class="op" id="6189482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="6189485">func</span>&nbsp;<span class="op" id="6189490">(</span><span class="ident" id="6189491">e</span>&nbsp;<span class="op" id="6189493">*</span><span class="ident" id="6189494">encoder</span><span class="op" id="6189501">)</span>&nbsp;<span class="ident" id="6189503">writeByte</span><span class="op" id="6189512">(</span><span class="ident" id="6189513">b</span>&nbsp;<span class="builtintype" id="6189515">byte</span><span class="op" id="6189519">)</span>&nbsp;<span class="op" id="6189521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6189524">if</span>&nbsp;<span class="ident" id="6189527">e</span><span class="op" id="6189528">.</span><span class="ident" id="6189529">err</span>&nbsp;<span class="op" id="6189533">!=</span>&nbsp;<span class="ident" id="6189536">nil</span>&nbsp;<span class="op" id="6189540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6189544">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6189552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189555">e</span><span class="op" id="6189556">.</span><span class="ident" id="6189557">err</span>&nbsp;<span class="op" id="6189561">=</span>&nbsp;<span class="ident" id="6189563">e</span><span class="op" id="6189564">.</span><span class="ident" id="6189565">w</span><span class="op" id="6189566">.</span><span class="ident" id="6189567">WriteByte</span><span class="op" id="6189576">(</span><span class="ident" id="6189577">b</span><span class="op" id="6189578">)</span><br>
<span class="lineno">250</span><span class="op" id="6189580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6189583">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="6189657">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="6189712">func</span>&nbsp;<span class="op" id="6189717">(</span><span class="ident" id="6189718">e</span>&nbsp;<span class="op" id="6189720">*</span><span class="ident" id="6189721">encoder</span><span class="op" id="6189728">)</span>&nbsp;<span class="ident" id="6189730">emit</span><span class="op" id="6189734">(</span><span class="ident" id="6189735">bits</span><span class="op" id="6189739">,</span>&nbsp;<span class="ident" id="6189741">nBits</span>&nbsp;<span class="builtintype" id="6189747">uint32</span><span class="op" id="6189753">)</span>&nbsp;<span class="op" id="6189755">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189758">nBits</span>&nbsp;<span class="op" id="6189764">+=</span>&nbsp;<span class="ident" id="6189767">e</span><span class="op" id="6189768">.</span><span class="ident" id="6189769">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189776">bits</span>&nbsp;<span class="op" id="6189781">&lt;&lt;=</span>&nbsp;<span class="num" id="6189785">32</span>&nbsp;<span class="op" id="6189788">-</span>&nbsp;<span class="ident" id="6189790">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189797">bits</span>&nbsp;<span class="op" id="6189802">|=</span>&nbsp;<span class="ident" id="6189805">e</span><span class="op" id="6189806">.</span><span class="ident" id="6189807">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6189813">for</span>&nbsp;<span class="ident" id="6189817">nBits</span>&nbsp;<span class="op" id="6189823">&gt;=</span>&nbsp;<span class="num" id="6189826">8</span>&nbsp;<span class="op" id="6189828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189832">b</span>&nbsp;<span class="op" id="6189834">:=</span>&nbsp;<span class="builtintype" id="6189837">uint8</span><span class="op" id="6189842">(</span><span class="ident" id="6189843">bits</span>&nbsp;<span class="op" id="6189848">&gt;&gt;</span>&nbsp;<span class="num" id="6189851">24</span><span class="op" id="6189853">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189857">e</span><span class="op" id="6189858">.</span><span class="ident" id="6189859">writeByte</span><span class="op" id="6189868">(</span><span class="ident" id="6189869">b</span><span class="op" id="6189870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6189874">if</span>&nbsp;<span class="ident" id="6189877">b</span>&nbsp;<span class="op" id="6189879">==</span>&nbsp;<span class="num" id="6189882">0xff</span>&nbsp;<span class="op" id="6189887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189892">e</span><span class="op" id="6189893">.</span><span class="ident" id="6189894">writeByte</span><span class="op" id="6189903">(</span><span class="num" id="6189904">0x00</span><span class="op" id="6189908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6189912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189916">bits</span>&nbsp;<span class="op" id="6189921">&lt;&lt;=</span>&nbsp;<span class="num" id="6189925">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189929">nBits</span>&nbsp;<span class="op" id="6189935">-=</span>&nbsp;<span class="num" id="6189938">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6189941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6189944">e</span><span class="op" id="6189945">.</span><span class="ident" id="6189946">bits</span><span class="op" id="6189950">,</span>&nbsp;<span class="ident" id="6189952">e</span><span class="op" id="6189953">.</span><span class="ident" id="6189954">nBits</span>&nbsp;<span class="op" id="6189960">=</span>&nbsp;<span class="ident" id="6189962">bits</span><span class="op" id="6189966">,</span>&nbsp;<span class="ident" id="6189968">nBits</span><br>
<span class="lineno"></span><span class="op" id="6189974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="6189977">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6190043">func</span>&nbsp;<span class="op" id="6190048">(</span><span class="ident" id="6190049">e</span>&nbsp;<span class="op" id="6190051">*</span><span class="ident" id="6190052">encoder</span><span class="op" id="6190059">)</span>&nbsp;<span class="ident" id="6190061">emitHuff</span><span class="op" id="6190069">(</span><span class="ident" id="6190070">h</span>&nbsp;<span class="ident" id="6190072">huffIndex</span><span class="op" id="6190081">,</span>&nbsp;<span class="ident" id="6190083">value</span>&nbsp;<span class="builtintype" id="6190089">int32</span><span class="op" id="6190094">)</span>&nbsp;<span class="op" id="6190096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190099">x</span>&nbsp;<span class="op" id="6190101">:=</span>&nbsp;<span class="ident" id="6190104">theHuffmanLUT</span><span class="op" id="6190117">[</span><span class="ident" id="6190118">h</span><span class="op" id="6190119">]</span><span class="op" id="6190120">[</span><span class="ident" id="6190121">value</span><span class="op" id="6190126">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190129">e</span><span class="op" id="6190130">.</span><span class="ident" id="6190131">emit</span><span class="op" id="6190135">(</span><span class="ident" id="6190136">x</span><span class="op" id="6190137">&amp;</span><span class="op" id="6190138">(</span><span class="num" id="6190139">1</span><span class="op" id="6190140">&lt;&lt;</span><span class="num" id="6190142">24</span><span class="op" id="6190144">-</span><span class="num" id="6190145">1</span><span class="op" id="6190146">)</span><span class="op" id="6190147">,</span>&nbsp;<span class="ident" id="6190149">x</span><span class="op" id="6190150">&gt;&gt;</span><span class="num" id="6190152">24</span><span class="op" id="6190154">)</span><br>
<span class="lineno"></span><span class="op" id="6190156">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="6190159">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6190238">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6190258">func</span>&nbsp;<span class="op" id="6190263">(</span><span class="ident" id="6190264">e</span>&nbsp;<span class="op" id="6190266">*</span><span class="ident" id="6190267">encoder</span><span class="op" id="6190274">)</span>&nbsp;<span class="ident" id="6190276">emitHuffRLE</span><span class="op" id="6190287">(</span><span class="ident" id="6190288">h</span>&nbsp;<span class="ident" id="6190290">huffIndex</span><span class="op" id="6190299">,</span>&nbsp;<span class="ident" id="6190301">runLength</span><span class="op" id="6190310">,</span>&nbsp;<span class="ident" id="6190312">value</span>&nbsp;<span class="builtintype" id="6190318">int32</span><span class="op" id="6190323">)</span>&nbsp;<span class="op" id="6190325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190328">a</span><span class="op" id="6190329">,</span>&nbsp;<span class="ident" id="6190331">b</span>&nbsp;<span class="op" id="6190333">:=</span>&nbsp;<span class="ident" id="6190336">value</span><span class="op" id="6190341">,</span>&nbsp;<span class="ident" id="6190343">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6190350">if</span>&nbsp;<span class="ident" id="6190353">a</span>&nbsp;<span class="op" id="6190355">&lt;</span>&nbsp;<span class="num" id="6190357">0</span>&nbsp;<span class="op" id="6190359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190363">a</span><span class="op" id="6190364">,</span>&nbsp;<span class="ident" id="6190366">b</span>&nbsp;<span class="op" id="6190368">=</span>&nbsp;<span class="op" id="6190370">-</span><span class="ident" id="6190371">value</span><span class="op" id="6190376">,</span>&nbsp;<span class="ident" id="6190378">value</span><span class="op" id="6190383">-</span><span class="num" id="6190384">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6190387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6190390">var</span>&nbsp;<span class="ident" id="6190394">nBits</span>&nbsp;<span class="builtintype" id="6190400">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6190408">if</span>&nbsp;<span class="ident" id="6190411">a</span>&nbsp;<span class="op" id="6190413">&lt;</span>&nbsp;<span class="num" id="6190415">0x100</span>&nbsp;<span class="op" id="6190421">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190425">nBits</span>&nbsp;<span class="op" id="6190431">=</span>&nbsp;<span class="builtintype" id="6190433">uint32</span><span class="op" id="6190439">(</span><span class="ident" id="6190440">bitCount</span><span class="op" id="6190448">[</span><span class="ident" id="6190449">a</span><span class="op" id="6190450">]</span><span class="op" id="6190451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6190454">}</span>&nbsp;<span class="keyword" id="6190456">else</span>&nbsp;<span class="op" id="6190461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190465">nBits</span>&nbsp;<span class="op" id="6190471">=</span>&nbsp;<span class="num" id="6190473">8</span>&nbsp;<span class="op" id="6190475">+</span>&nbsp;<span class="builtintype" id="6190477">uint32</span><span class="op" id="6190483">(</span><span class="ident" id="6190484">bitCount</span><span class="op" id="6190492">[</span><span class="ident" id="6190493">a</span><span class="op" id="6190494">&gt;&gt;</span><span class="num" id="6190496">8</span><span class="op" id="6190497">]</span><span class="op" id="6190498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6190501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190504">e</span><span class="op" id="6190505">.</span><span class="ident" id="6190506">emitHuff</span><span class="op" id="6190514">(</span><span class="ident" id="6190515">h</span><span class="op" id="6190516">,</span>&nbsp;<span class="ident" id="6190518">runLength</span><span class="op" id="6190527">&lt;&lt;</span><span class="num" id="6190529">4</span><span class="op" id="6190530">|</span><span class="builtintype" id="6190531">int32</span><span class="op" id="6190536">(</span><span class="ident" id="6190537">nBits</span><span class="op" id="6190542">)</span><span class="op" id="6190543">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6190546">if</span>&nbsp;<span class="ident" id="6190549">nBits</span>&nbsp;<span class="op" id="6190555">&gt;</span>&nbsp;<span class="num" id="6190557">0</span>&nbsp;<span class="op" id="6190559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190563">e</span><span class="op" id="6190564">.</span><span class="ident" id="6190565">emit</span><span class="op" id="6190569">(</span><span class="builtintype" id="6190570">uint32</span><span class="op" id="6190576">(</span><span class="ident" id="6190577">b</span><span class="op" id="6190578">)</span><span class="op" id="6190579">&amp;</span><span class="op" id="6190580">(</span><span class="num" id="6190581">1</span><span class="op" id="6190582">&lt;&lt;</span><span class="ident" id="6190584">nBits</span><span class="op" id="6190589">-</span><span class="num" id="6190590">1</span><span class="op" id="6190591">)</span><span class="op" id="6190592">,</span>&nbsp;<span class="ident" id="6190594">nBits</span><span class="op" id="6190599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6190602">}</span><br>
<span class="lineno"></span><span class="op" id="6190604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="6190607">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6190682">func</span>&nbsp;<span class="op" id="6190687">(</span><span class="ident" id="6190688">e</span>&nbsp;<span class="op" id="6190690">*</span><span class="ident" id="6190691">encoder</span><span class="op" id="6190698">)</span>&nbsp;<span class="ident" id="6190700">writeMarkerHeader</span><span class="op" id="6190717">(</span><span class="ident" id="6190718">marker</span>&nbsp;<span class="builtintype" id="6190725">uint8</span><span class="op" id="6190730">,</span>&nbsp;<span class="ident" id="6190732">markerlen</span>&nbsp;<span class="builtintype" id="6190742">int</span><span class="op" id="6190745">)</span>&nbsp;<span class="op" id="6190747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190750">e</span><span class="op" id="6190751">.</span><span class="ident" id="6190752">buf</span><span class="op" id="6190755">[</span><span class="num" id="6190756">0</span><span class="op" id="6190757">]</span>&nbsp;<span class="op" id="6190759">=</span>&nbsp;<span class="num" id="6190761">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190767">e</span><span class="op" id="6190768">.</span><span class="ident" id="6190769">buf</span><span class="op" id="6190772">[</span><span class="num" id="6190773">1</span><span class="op" id="6190774">]</span>&nbsp;<span class="op" id="6190776">=</span>&nbsp;<span class="ident" id="6190778">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190786">e</span><span class="op" id="6190787">.</span><span class="ident" id="6190788">buf</span><span class="op" id="6190791">[</span><span class="num" id="6190792">2</span><span class="op" id="6190793">]</span>&nbsp;<span class="op" id="6190795">=</span>&nbsp;<span class="builtintype" id="6190797">uint8</span><span class="op" id="6190802">(</span><span class="ident" id="6190803">markerlen</span>&nbsp;<span class="op" id="6190813">&gt;&gt;</span>&nbsp;<span class="num" id="6190816">8</span><span class="op" id="6190817">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190820">e</span><span class="op" id="6190821">.</span><span class="ident" id="6190822">buf</span><span class="op" id="6190825">[</span><span class="num" id="6190826">3</span><span class="op" id="6190827">]</span>&nbsp;<span class="op" id="6190829">=</span>&nbsp;<span class="builtintype" id="6190831">uint8</span><span class="op" id="6190836">(</span><span class="ident" id="6190837">markerlen</span>&nbsp;<span class="op" id="6190847">&amp;</span>&nbsp;<span class="num" id="6190849">0xff</span><span class="op" id="6190853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6190856">e</span><span class="op" id="6190857">.</span><span class="ident" id="6190858">write</span><span class="op" id="6190863">(</span><span class="ident" id="6190864">e</span><span class="op" id="6190865">.</span><span class="ident" id="6190866">buf</span><span class="op" id="6190869">[</span><span class="op" id="6190870">:</span><span class="num" id="6190871">4</span><span class="op" id="6190872">]</span><span class="op" id="6190873">)</span><br>
<span class="lineno"></span><span class="op" id="6190875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6190878">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="6190935">func</span>&nbsp;<span class="op" id="6190940">(</span><span class="ident" id="6190941">e</span>&nbsp;<span class="op" id="6190943">*</span><span class="ident" id="6190944">encoder</span><span class="op" id="6190951">)</span>&nbsp;<span class="ident" id="6190953">writeDQT</span><span class="op" id="6190961">(</span><span class="op" id="6190962">)</span>&nbsp;<span class="op" id="6190964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6190967">const</span>&nbsp;<span class="ident" id="6190973">markerlen</span>&nbsp;<span class="op" id="6190983">=</span>&nbsp;<span class="num" id="6190985">2</span>&nbsp;<span class="op" id="6190987">+</span>&nbsp;<span class="builtintype" id="6190989">int</span><span class="op" id="6190992">(</span><span class="ident" id="6190993">nQuantIndex</span><span class="op" id="6191004">)</span><span class="op" id="6191005">*</span><span class="op" id="6191006">(</span><span class="num" id="6191007">1</span><span class="op" id="6191008">+</span><span class="ident" id="6191009">blockSize</span><span class="op" id="6191018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191021">e</span><span class="op" id="6191022">.</span><span class="ident" id="6191023">writeMarkerHeader</span><span class="op" id="6191040">(</span><span class="ident" id="6191041">dqtMarker</span><span class="op" id="6191050">,</span>&nbsp;<span class="ident" id="6191052">markerlen</span><span class="op" id="6191061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6191064">for</span>&nbsp;<span class="ident" id="6191068">i</span>&nbsp;<span class="op" id="6191070">:=</span>&nbsp;<span class="keyword" id="6191073">range</span>&nbsp;<span class="ident" id="6191079">e</span><span class="op" id="6191080">.</span><span class="ident" id="6191081">quant</span>&nbsp;<span class="op" id="6191087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191091">e</span><span class="op" id="6191092">.</span><span class="ident" id="6191093">writeByte</span><span class="op" id="6191102">(</span><span class="builtintype" id="6191103">uint8</span><span class="op" id="6191108">(</span><span class="ident" id="6191109">i</span><span class="op" id="6191110">)</span><span class="op" id="6191111">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191115">e</span><span class="op" id="6191116">.</span><span class="ident" id="6191117">write</span><span class="op" id="6191122">(</span><span class="ident" id="6191123">e</span><span class="op" id="6191124">.</span><span class="ident" id="6191125">quant</span><span class="op" id="6191130">[</span><span class="ident" id="6191131">i</span><span class="op" id="6191132">]</span><span class="op" id="6191133">[</span><span class="op" id="6191134">:</span><span class="op" id="6191135">]</span><span class="op" id="6191136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6191139">}</span><br>
<span class="lineno"></span><span class="op" id="6191141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6191144">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="6191202">func</span>&nbsp;<span class="op" id="6191207">(</span><span class="ident" id="6191208">e</span>&nbsp;<span class="op" id="6191210">*</span><span class="ident" id="6191211">encoder</span><span class="op" id="6191218">)</span>&nbsp;<span class="ident" id="6191220">writeSOF0</span><span class="op" id="6191229">(</span><span class="ident" id="6191230">size</span>&nbsp;<span class="ident" id="6191235">image</span><span class="op" id="6191240">.</span><span class="ident" id="6191241">Point</span><span class="op" id="6191246">,</span>&nbsp;<span class="ident" id="6191248">nComponent</span>&nbsp;<span class="builtintype" id="6191259">int</span><span class="op" id="6191262">)</span>&nbsp;<span class="op" id="6191264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191267">markerlen</span>&nbsp;<span class="op" id="6191277">:=</span>&nbsp;<span class="num" id="6191280">8</span>&nbsp;<span class="op" id="6191282">+</span>&nbsp;<span class="num" id="6191284">3</span><span class="op" id="6191285">*</span><span class="ident" id="6191286">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191298">e</span><span class="op" id="6191299">.</span><span class="ident" id="6191300">writeMarkerHeader</span><span class="op" id="6191317">(</span><span class="ident" id="6191318">sof0Marker</span><span class="op" id="6191328">,</span>&nbsp;<span class="ident" id="6191330">markerlen</span><span class="op" id="6191339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191342">e</span><span class="op" id="6191343">.</span><span class="ident" id="6191344">buf</span><span class="op" id="6191347">[</span><span class="num" id="6191348">0</span><span class="op" id="6191349">]</span>&nbsp;<span class="op" id="6191351">=</span>&nbsp;<span class="num" id="6191353">8</span>&nbsp;<span class="comment" id="6191355">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191372">e</span><span class="op" id="6191373">.</span><span class="ident" id="6191374">buf</span><span class="op" id="6191377">[</span><span class="num" id="6191378">1</span><span class="op" id="6191379">]</span>&nbsp;<span class="op" id="6191381">=</span>&nbsp;<span class="builtintype" id="6191383">uint8</span><span class="op" id="6191388">(</span><span class="ident" id="6191389">size</span><span class="op" id="6191393">.</span><span class="ident" id="6191394">Y</span>&nbsp;<span class="op" id="6191396">&gt;&gt;</span>&nbsp;<span class="num" id="6191399">8</span><span class="op" id="6191400">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191403">e</span><span class="op" id="6191404">.</span><span class="ident" id="6191405">buf</span><span class="op" id="6191408">[</span><span class="num" id="6191409">2</span><span class="op" id="6191410">]</span>&nbsp;<span class="op" id="6191412">=</span>&nbsp;<span class="builtintype" id="6191414">uint8</span><span class="op" id="6191419">(</span><span class="ident" id="6191420">size</span><span class="op" id="6191424">.</span><span class="ident" id="6191425">Y</span>&nbsp;<span class="op" id="6191427">&amp;</span>&nbsp;<span class="num" id="6191429">0xff</span><span class="op" id="6191433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191436">e</span><span class="op" id="6191437">.</span><span class="ident" id="6191438">buf</span><span class="op" id="6191441">[</span><span class="num" id="6191442">3</span><span class="op" id="6191443">]</span>&nbsp;<span class="op" id="6191445">=</span>&nbsp;<span class="builtintype" id="6191447">uint8</span><span class="op" id="6191452">(</span><span class="ident" id="6191453">size</span><span class="op" id="6191457">.</span><span class="ident" id="6191458">X</span>&nbsp;<span class="op" id="6191460">&gt;&gt;</span>&nbsp;<span class="num" id="6191463">8</span><span class="op" id="6191464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191467">e</span><span class="op" id="6191468">.</span><span class="ident" id="6191469">buf</span><span class="op" id="6191472">[</span><span class="num" id="6191473">4</span><span class="op" id="6191474">]</span>&nbsp;<span class="op" id="6191476">=</span>&nbsp;<span class="builtintype" id="6191478">uint8</span><span class="op" id="6191483">(</span><span class="ident" id="6191484">size</span><span class="op" id="6191488">.</span><span class="ident" id="6191489">X</span>&nbsp;<span class="op" id="6191491">&amp;</span>&nbsp;<span class="num" id="6191493">0xff</span><span class="op" id="6191497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191500">e</span><span class="op" id="6191501">.</span><span class="ident" id="6191502">buf</span><span class="op" id="6191505">[</span><span class="num" id="6191506">5</span><span class="op" id="6191507">]</span>&nbsp;<span class="op" id="6191509">=</span>&nbsp;<span class="builtintype" id="6191511">uint8</span><span class="op" id="6191516">(</span><span class="ident" id="6191517">nComponent</span><span class="op" id="6191527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6191530">if</span>&nbsp;<span class="ident" id="6191533">nComponent</span>&nbsp;<span class="op" id="6191544">==</span>&nbsp;<span class="num" id="6191547">1</span>&nbsp;<span class="op" id="6191549">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191553">e</span><span class="op" id="6191554">.</span><span class="ident" id="6191555">buf</span><span class="op" id="6191558">[</span><span class="num" id="6191559">6</span><span class="op" id="6191560">]</span>&nbsp;<span class="op" id="6191562">=</span>&nbsp;<span class="num" id="6191564">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6191568">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191609">e</span><span class="op" id="6191610">.</span><span class="ident" id="6191611">buf</span><span class="op" id="6191614">[</span><span class="num" id="6191615">7</span><span class="op" id="6191616">]</span>&nbsp;<span class="op" id="6191618">=</span>&nbsp;<span class="num" id="6191620">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191627">e</span><span class="op" id="6191628">.</span><span class="ident" id="6191629">buf</span><span class="op" id="6191632">[</span><span class="num" id="6191633">8</span><span class="op" id="6191634">]</span>&nbsp;<span class="op" id="6191636">=</span>&nbsp;<span class="num" id="6191638">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6191644">}</span>&nbsp;<span class="keyword" id="6191646">else</span>&nbsp;<span class="op" id="6191651">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6191655">for</span>&nbsp;<span class="ident" id="6191659">i</span>&nbsp;<span class="op" id="6191661">:=</span>&nbsp;<span class="num" id="6191664">0</span><span class="op" id="6191665">;</span>&nbsp;<span class="ident" id="6191667">i</span>&nbsp;<span class="op" id="6191669">&lt;</span>&nbsp;<span class="ident" id="6191671">nComponent</span><span class="op" id="6191681">;</span>&nbsp;<span class="ident" id="6191683">i</span><span class="op" id="6191684">++</span>&nbsp;<span class="op" id="6191687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191692">e</span><span class="op" id="6191693">.</span><span class="ident" id="6191694">buf</span><span class="op" id="6191697">[</span><span class="num" id="6191698">3</span><span class="op" id="6191699">*</span><span class="ident" id="6191700">i</span><span class="op" id="6191701">+</span><span class="num" id="6191702">6</span><span class="op" id="6191703">]</span>&nbsp;<span class="op" id="6191705">=</span>&nbsp;<span class="builtintype" id="6191707">uint8</span><span class="op" id="6191712">(</span><span class="ident" id="6191713">i</span>&nbsp;<span class="op" id="6191715">+</span>&nbsp;<span class="num" id="6191717">1</span><span class="op" id="6191718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6191723">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191762">e</span><span class="op" id="6191763">.</span><span class="ident" id="6191764">buf</span><span class="op" id="6191767">[</span><span class="num" id="6191768">3</span><span class="op" id="6191769">*</span><span class="ident" id="6191770">i</span><span class="op" id="6191771">+</span><span class="num" id="6191772">7</span><span class="op" id="6191773">]</span>&nbsp;<span class="op" id="6191775">=</span>&nbsp;<span class="string" id="6191777">&#34;\x22\x11\x11&#34;</span><span class="op" id="6191791">[</span><span class="ident" id="6191792">i</span><span class="op" id="6191793">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191798">e</span><span class="op" id="6191799">.</span><span class="ident" id="6191800">buf</span><span class="op" id="6191803">[</span><span class="num" id="6191804">3</span><span class="op" id="6191805">*</span><span class="ident" id="6191806">i</span><span class="op" id="6191807">+</span><span class="num" id="6191808">8</span><span class="op" id="6191809">]</span>&nbsp;<span class="op" id="6191811">=</span>&nbsp;<span class="string" id="6191813">&#34;\x00\x01\x01&#34;</span><span class="op" id="6191827">[</span><span class="ident" id="6191828">i</span><span class="op" id="6191829">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6191833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6191836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191839">e</span><span class="op" id="6191840">.</span><span class="ident" id="6191841">write</span><span class="op" id="6191846">(</span><span class="ident" id="6191847">e</span><span class="op" id="6191848">.</span><span class="ident" id="6191849">buf</span><span class="op" id="6191852">[</span><span class="op" id="6191853">:</span><span class="num" id="6191854">3</span><span class="op" id="6191855">*</span><span class="op" id="6191856">(</span><span class="ident" id="6191857">nComponent</span><span class="op" id="6191867">-</span><span class="num" id="6191868">1</span><span class="op" id="6191869">)</span><span class="op" id="6191870">+</span><span class="num" id="6191871">9</span><span class="op" id="6191872">]</span><span class="op" id="6191873">)</span><br>
<span class="lineno"></span><span class="op" id="6191875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="6191878">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="6191930">func</span>&nbsp;<span class="op" id="6191935">(</span><span class="ident" id="6191936">e</span>&nbsp;<span class="op" id="6191938">*</span><span class="ident" id="6191939">encoder</span><span class="op" id="6191946">)</span>&nbsp;<span class="ident" id="6191948">writeDHT</span><span class="op" id="6191956">(</span><span class="ident" id="6191957">nComponent</span>&nbsp;<span class="builtintype" id="6191968">int</span><span class="op" id="6191971">)</span>&nbsp;<span class="op" id="6191973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191976">markerlen</span>&nbsp;<span class="op" id="6191986">:=</span>&nbsp;<span class="num" id="6191989">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191992">specs</span>&nbsp;<span class="op" id="6191998">:=</span>&nbsp;<span class="ident" id="6192001">theHuffmanSpec</span><span class="op" id="6192015">[</span><span class="op" id="6192016">:</span><span class="op" id="6192017">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6192020">if</span>&nbsp;<span class="ident" id="6192023">nComponent</span>&nbsp;<span class="op" id="6192034">==</span>&nbsp;<span class="num" id="6192037">1</span>&nbsp;<span class="op" id="6192039">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6192043">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192077">specs</span>&nbsp;<span class="op" id="6192083">=</span>&nbsp;<span class="ident" id="6192085">specs</span><span class="op" id="6192090">[</span><span class="op" id="6192091">:</span><span class="num" id="6192092">2</span><span class="op" id="6192093">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6192096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6192099">for</span>&nbsp;<span class="ident" id="6192103">_</span><span class="op" id="6192104">,</span>&nbsp;<span class="ident" id="6192106">s</span>&nbsp;<span class="op" id="6192108">:=</span>&nbsp;<span class="keyword" id="6192111">range</span>&nbsp;<span class="ident" id="6192117">specs</span>&nbsp;<span class="op" id="6192123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192127">markerlen</span>&nbsp;<span class="op" id="6192137">+=</span>&nbsp;<span class="num" id="6192140">1</span>&nbsp;<span class="op" id="6192142">+</span>&nbsp;<span class="num" id="6192144">16</span>&nbsp;<span class="op" id="6192147">+</span>&nbsp;<span class="builtinfunc" id="6192149">len</span><span class="op" id="6192152">(</span><span class="ident" id="6192153">s</span><span class="op" id="6192154">.</span><span class="ident" id="6192155">value</span><span class="op" id="6192160">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6192163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192166">e</span><span class="op" id="6192167">.</span><span class="ident" id="6192168">writeMarkerHeader</span><span class="op" id="6192185">(</span><span class="ident" id="6192186">dhtMarker</span><span class="op" id="6192195">,</span>&nbsp;<span class="ident" id="6192197">markerlen</span><span class="op" id="6192206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6192209">for</span>&nbsp;<span class="ident" id="6192213">i</span><span class="op" id="6192214">,</span>&nbsp;<span class="ident" id="6192216">s</span>&nbsp;<span class="op" id="6192218">:=</span>&nbsp;<span class="keyword" id="6192221">range</span>&nbsp;<span class="ident" id="6192227">specs</span>&nbsp;<span class="op" id="6192233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192237">e</span><span class="op" id="6192238">.</span><span class="ident" id="6192239">writeByte</span><span class="op" id="6192248">(</span><span class="string" id="6192249">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="6192267">[</span><span class="ident" id="6192268">i</span><span class="op" id="6192269">]</span><span class="op" id="6192270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192274">e</span><span class="op" id="6192275">.</span><span class="ident" id="6192276">write</span><span class="op" id="6192281">(</span><span class="ident" id="6192282">s</span><span class="op" id="6192283">.</span><span class="ident" id="6192284">count</span><span class="op" id="6192289">[</span><span class="op" id="6192290">:</span><span class="op" id="6192291">]</span><span class="op" id="6192292">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192296">e</span><span class="op" id="6192297">.</span><span class="ident" id="6192298">write</span><span class="op" id="6192303">(</span><span class="ident" id="6192304">s</span><span class="op" id="6192305">.</span><span class="ident" id="6192306">value</span><span class="op" id="6192311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6192314">}</span><br>
<span class="lineno"></span><span class="op" id="6192316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6192319">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="6192398">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6192477">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="6192509">func</span>&nbsp;<span class="op" id="6192514">(</span><span class="ident" id="6192515">e</span>&nbsp;<span class="op" id="6192517">*</span><span class="ident" id="6192518">encoder</span><span class="op" id="6192525">)</span>&nbsp;<span class="ident" id="6192527">writeBlock</span><span class="op" id="6192537">(</span><span class="ident" id="6192538">b</span>&nbsp;<span class="op" id="6192540">*</span><span class="ident" id="6192541">block</span><span class="op" id="6192546">,</span>&nbsp;<span class="ident" id="6192548">q</span>&nbsp;<span class="ident" id="6192550">quantIndex</span><span class="op" id="6192560">,</span>&nbsp;<span class="ident" id="6192562">prevDC</span>&nbsp;<span class="builtintype" id="6192569">int32</span><span class="op" id="6192574">)</span>&nbsp;<span class="builtintype" id="6192576">int32</span>&nbsp;<span class="op" id="6192582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192585">fdct</span><span class="op" id="6192589">(</span><span class="ident" id="6192590">b</span><span class="op" id="6192591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6192594">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192617">dc</span>&nbsp;<span class="op" id="6192620">:=</span>&nbsp;<span class="ident" id="6192623">div</span><span class="op" id="6192626">(</span><span class="ident" id="6192627">b</span><span class="op" id="6192628">[</span><span class="num" id="6192629">0</span><span class="op" id="6192630">]</span><span class="op" id="6192631">,</span>&nbsp;<span class="num" id="6192633">8</span><span class="op" id="6192634">*</span><span class="builtintype" id="6192635">int32</span><span class="op" id="6192640">(</span><span class="ident" id="6192641">e</span><span class="op" id="6192642">.</span><span class="ident" id="6192643">quant</span><span class="op" id="6192648">[</span><span class="ident" id="6192649">q</span><span class="op" id="6192650">]</span><span class="op" id="6192651">[</span><span class="num" id="6192652">0</span><span class="op" id="6192653">]</span><span class="op" id="6192654">)</span><span class="op" id="6192655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192658">e</span><span class="op" id="6192659">.</span><span class="ident" id="6192660">emitHuffRLE</span><span class="op" id="6192671">(</span><span class="ident" id="6192672">huffIndex</span><span class="op" id="6192681">(</span><span class="num" id="6192682">2</span><span class="op" id="6192683">*</span><span class="ident" id="6192684">q</span><span class="op" id="6192685">+</span><span class="num" id="6192686">0</span><span class="op" id="6192687">)</span><span class="op" id="6192688">,</span>&nbsp;<span class="num" id="6192690">0</span><span class="op" id="6192691">,</span>&nbsp;<span class="ident" id="6192693">dc</span><span class="op" id="6192695">-</span><span class="ident" id="6192696">prevDC</span><span class="op" id="6192702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6192705">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192733">h</span><span class="op" id="6192734">,</span>&nbsp;<span class="ident" id="6192736">runLength</span>&nbsp;<span class="op" id="6192746">:=</span>&nbsp;<span class="ident" id="6192749">huffIndex</span><span class="op" id="6192758">(</span><span class="num" id="6192759">2</span><span class="op" id="6192760">*</span><span class="ident" id="6192761">q</span><span class="op" id="6192762">+</span><span class="num" id="6192763">1</span><span class="op" id="6192764">)</span><span class="op" id="6192765">,</span>&nbsp;<span class="builtintype" id="6192767">int32</span><span class="op" id="6192772">(</span><span class="num" id="6192773">0</span><span class="op" id="6192774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6192777">for</span>&nbsp;<span class="ident" id="6192781">zig</span>&nbsp;<span class="op" id="6192785">:=</span>&nbsp;<span class="num" id="6192788">1</span><span class="op" id="6192789">;</span>&nbsp;<span class="ident" id="6192791">zig</span>&nbsp;<span class="op" id="6192795">&lt;</span>&nbsp;<span class="ident" id="6192797">blockSize</span><span class="op" id="6192806">;</span>&nbsp;<span class="ident" id="6192808">zig</span><span class="op" id="6192811">++</span>&nbsp;<span class="op" id="6192814">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192818">ac</span>&nbsp;<span class="op" id="6192821">:=</span>&nbsp;<span class="ident" id="6192824">div</span><span class="op" id="6192827">(</span><span class="ident" id="6192828">b</span><span class="op" id="6192829">[</span><span class="ident" id="6192830">unzig</span><span class="op" id="6192835">[</span><span class="ident" id="6192836">zig</span><span class="op" id="6192839">]</span><span class="op" id="6192840">]</span><span class="op" id="6192841">,</span>&nbsp;<span class="num" id="6192843">8</span><span class="op" id="6192844">*</span><span class="builtintype" id="6192845">int32</span><span class="op" id="6192850">(</span><span class="ident" id="6192851">e</span><span class="op" id="6192852">.</span><span class="ident" id="6192853">quant</span><span class="op" id="6192858">[</span><span class="ident" id="6192859">q</span><span class="op" id="6192860">]</span><span class="op" id="6192861">[</span><span class="ident" id="6192862">zig</span><span class="op" id="6192865">]</span><span class="op" id="6192866">)</span><span class="op" id="6192867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6192871">if</span>&nbsp;<span class="ident" id="6192874">ac</span>&nbsp;<span class="op" id="6192877">==</span>&nbsp;<span class="num" id="6192880">0</span>&nbsp;<span class="op" id="6192882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192887">runLength</span><span class="op" id="6192896">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6192901">}</span>&nbsp;<span class="keyword" id="6192903">else</span>&nbsp;<span class="op" id="6192908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6192913">for</span>&nbsp;<span class="ident" id="6192917">runLength</span>&nbsp;<span class="op" id="6192927">&gt;</span>&nbsp;<span class="num" id="6192929">15</span>&nbsp;<span class="op" id="6192932">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192938">e</span><span class="op" id="6192939">.</span><span class="ident" id="6192940">emitHuff</span><span class="op" id="6192948">(</span><span class="ident" id="6192949">h</span><span class="op" id="6192950">,</span>&nbsp;<span class="num" id="6192952">0xf0</span><span class="op" id="6192956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192962">runLength</span>&nbsp;<span class="op" id="6192972">-=</span>&nbsp;<span class="num" id="6192975">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6192981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6192986">e</span><span class="op" id="6192987">.</span><span class="ident" id="6192988">emitHuffRLE</span><span class="op" id="6192999">(</span><span class="ident" id="6193000">h</span><span class="op" id="6193001">,</span>&nbsp;<span class="ident" id="6193003">runLength</span><span class="op" id="6193012">,</span>&nbsp;<span class="ident" id="6193014">ac</span><span class="op" id="6193016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193021">runLength</span>&nbsp;<span class="op" id="6193031">=</span>&nbsp;<span class="num" id="6193033">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6193037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6193040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6193043">if</span>&nbsp;<span class="ident" id="6193046">runLength</span>&nbsp;<span class="op" id="6193056">&gt;</span>&nbsp;<span class="num" id="6193058">0</span>&nbsp;<span class="op" id="6193060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193064">e</span><span class="op" id="6193065">.</span><span class="ident" id="6193066">emitHuff</span><span class="op" id="6193074">(</span><span class="ident" id="6193075">h</span><span class="op" id="6193076">,</span>&nbsp;<span class="num" id="6193078">0x00</span><span class="op" id="6193082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6193085">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6193088">return</span>&nbsp;<span class="ident" id="6193095">dc</span><br>
<span class="lineno"></span><span class="op" id="6193098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6193101">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6193175">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="6193192">func</span>&nbsp;<span class="ident" id="6193197">toYCbCr</span><span class="op" id="6193204">(</span><span class="ident" id="6193205">m</span>&nbsp;<span class="ident" id="6193207">image</span><span class="op" id="6193212">.</span><span class="ident" id="6193213">Image</span><span class="op" id="6193218">,</span>&nbsp;<span class="ident" id="6193220">p</span>&nbsp;<span class="ident" id="6193222">image</span><span class="op" id="6193227">.</span><span class="ident" id="6193228">Point</span><span class="op" id="6193233">,</span>&nbsp;<span class="ident" id="6193235">yBlock</span><span class="op" id="6193241">,</span>&nbsp;<span class="ident" id="6193243">cbBlock</span><span class="op" id="6193250">,</span>&nbsp;<span class="ident" id="6193252">crBlock</span>&nbsp;<span class="op" id="6193260">*</span><span class="ident" id="6193261">block</span><span class="op" id="6193266">)</span>&nbsp;<span class="op" id="6193268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193271">b</span>&nbsp;<span class="op" id="6193273">:=</span>&nbsp;<span class="ident" id="6193276">m</span><span class="op" id="6193277">.</span><span class="ident" id="6193278">Bounds</span><span class="op" id="6193284">(</span><span class="op" id="6193285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193288">xmax</span>&nbsp;<span class="op" id="6193293">:=</span>&nbsp;<span class="ident" id="6193296">b</span><span class="op" id="6193297">.</span><span class="ident" id="6193298">Max</span><span class="op" id="6193301">.</span><span class="ident" id="6193302">X</span>&nbsp;<span class="op" id="6193304">-</span>&nbsp;<span class="num" id="6193306">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193309">ymax</span>&nbsp;<span class="op" id="6193314">:=</span>&nbsp;<span class="ident" id="6193317">b</span><span class="op" id="6193318">.</span><span class="ident" id="6193319">Max</span><span class="op" id="6193322">.</span><span class="ident" id="6193323">Y</span>&nbsp;<span class="op" id="6193325">-</span>&nbsp;<span class="num" id="6193327">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6193330">for</span>&nbsp;<span class="ident" id="6193334">j</span>&nbsp;<span class="op" id="6193336">:=</span>&nbsp;<span class="num" id="6193339">0</span><span class="op" id="6193340">;</span>&nbsp;<span class="ident" id="6193342">j</span>&nbsp;<span class="op" id="6193344">&lt;</span>&nbsp;<span class="num" id="6193346">8</span><span class="op" id="6193347">;</span>&nbsp;<span class="ident" id="6193349">j</span><span class="op" id="6193350">++</span>&nbsp;<span class="op" id="6193353">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6193357">for</span>&nbsp;<span class="ident" id="6193361">i</span>&nbsp;<span class="op" id="6193363">:=</span>&nbsp;<span class="num" id="6193366">0</span><span class="op" id="6193367">;</span>&nbsp;<span class="ident" id="6193369">i</span>&nbsp;<span class="op" id="6193371">&lt;</span>&nbsp;<span class="num" id="6193373">8</span><span class="op" id="6193374">;</span>&nbsp;<span class="ident" id="6193376">i</span><span class="op" id="6193377">++</span>&nbsp;<span class="op" id="6193380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193385">r</span><span class="op" id="6193386">,</span>&nbsp;<span class="ident" id="6193388">g</span><span class="op" id="6193389">,</span>&nbsp;<span class="ident" id="6193391">b</span><span class="op" id="6193392">,</span>&nbsp;<span class="ident" id="6193394">_</span>&nbsp;<span class="op" id="6193396">:=</span>&nbsp;<span class="ident" id="6193399">m</span><span class="op" id="6193400">.</span><span class="ident" id="6193401">At</span><span class="op" id="6193403">(</span><span class="ident" id="6193404">min</span><span class="op" id="6193407">(</span><span class="ident" id="6193408">p</span><span class="op" id="6193409">.</span><span class="ident" id="6193410">X</span><span class="op" id="6193411">+</span><span class="ident" id="6193412">i</span><span class="op" id="6193413">,</span>&nbsp;<span class="ident" id="6193415">xmax</span><span class="op" id="6193419">)</span><span class="op" id="6193420">,</span>&nbsp;<span class="ident" id="6193422">min</span><span class="op" id="6193425">(</span><span class="ident" id="6193426">p</span><span class="op" id="6193427">.</span><span class="ident" id="6193428">Y</span><span class="op" id="6193429">+</span><span class="ident" id="6193430">j</span><span class="op" id="6193431">,</span>&nbsp;<span class="ident" id="6193433">ymax</span><span class="op" id="6193437">)</span><span class="op" id="6193438">)</span><span class="op" id="6193439">.</span><span class="ident" id="6193440">RGBA</span><span class="op" id="6193444">(</span><span class="op" id="6193445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193450">yy</span><span class="op" id="6193452">,</span>&nbsp;<span class="ident" id="6193454">cb</span><span class="op" id="6193456">,</span>&nbsp;<span class="ident" id="6193458">cr</span>&nbsp;<span class="op" id="6193461">:=</span>&nbsp;<span class="ident" id="6193464">color</span><span class="op" id="6193469">.</span><span class="ident" id="6193470">RGBToYCbCr</span><span class="op" id="6193480">(</span><span class="builtintype" id="6193481">uint8</span><span class="op" id="6193486">(</span><span class="ident" id="6193487">r</span><span class="op" id="6193488">&gt;&gt;</span><span class="num" id="6193490">8</span><span class="op" id="6193491">)</span><span class="op" id="6193492">,</span>&nbsp;<span class="builtintype" id="6193494">uint8</span><span class="op" id="6193499">(</span><span class="ident" id="6193500">g</span><span class="op" id="6193501">&gt;&gt;</span><span class="num" id="6193503">8</span><span class="op" id="6193504">)</span><span class="op" id="6193505">,</span>&nbsp;<span class="builtintype" id="6193507">uint8</span><span class="op" id="6193512">(</span><span class="ident" id="6193513">b</span><span class="op" id="6193514">&gt;&gt;</span><span class="num" id="6193516">8</span><span class="op" id="6193517">)</span><span class="op" id="6193518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193523">yBlock</span><span class="op" id="6193529">[</span><span class="num" id="6193530">8</span><span class="op" id="6193531">*</span><span class="ident" id="6193532">j</span><span class="op" id="6193533">+</span><span class="ident" id="6193534">i</span><span class="op" id="6193535">]</span>&nbsp;<span class="op" id="6193537">=</span>&nbsp;<span class="builtintype" id="6193539">int32</span><span class="op" id="6193544">(</span><span class="ident" id="6193545">yy</span><span class="op" id="6193547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193552">cbBlock</span><span class="op" id="6193559">[</span><span class="num" id="6193560">8</span><span class="op" id="6193561">*</span><span class="ident" id="6193562">j</span><span class="op" id="6193563">+</span><span class="ident" id="6193564">i</span><span class="op" id="6193565">]</span>&nbsp;<span class="op" id="6193567">=</span>&nbsp;<span class="builtintype" id="6193569">int32</span><span class="op" id="6193574">(</span><span class="ident" id="6193575">cb</span><span class="op" id="6193577">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193582">crBlock</span><span class="op" id="6193589">[</span><span class="num" id="6193590">8</span><span class="op" id="6193591">*</span><span class="ident" id="6193592">j</span><span class="op" id="6193593">+</span><span class="ident" id="6193594">i</span><span class="op" id="6193595">]</span>&nbsp;<span class="op" id="6193597">=</span>&nbsp;<span class="builtintype" id="6193599">int32</span><span class="op" id="6193604">(</span><span class="ident" id="6193605">cr</span><span class="op" id="6193607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6193611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6193614">}</span><br>
<span class="lineno"></span><span class="op" id="6193616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="6193619">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="6193695">func</span>&nbsp;<span class="ident" id="6193700">grayToY</span><span class="op" id="6193707">(</span><span class="ident" id="6193708">m</span>&nbsp;<span class="op" id="6193710">*</span><span class="ident" id="6193711">image</span><span class="op" id="6193716">.</span><span class="ident" id="6193717">Gray</span><span class="op" id="6193721">,</span>&nbsp;<span class="ident" id="6193723">p</span>&nbsp;<span class="ident" id="6193725">image</span><span class="op" id="6193730">.</span><span class="ident" id="6193731">Point</span><span class="op" id="6193736">,</span>&nbsp;<span class="ident" id="6193738">yBlock</span>&nbsp;<span class="op" id="6193745">*</span><span class="ident" id="6193746">block</span><span class="op" id="6193751">)</span>&nbsp;<span class="op" id="6193753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193756">b</span>&nbsp;<span class="op" id="6193758">:=</span>&nbsp;<span class="ident" id="6193761">m</span><span class="op" id="6193762">.</span><span class="ident" id="6193763">Bounds</span><span class="op" id="6193769">(</span><span class="op" id="6193770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193773">xmax</span>&nbsp;<span class="op" id="6193778">:=</span>&nbsp;<span class="ident" id="6193781">b</span><span class="op" id="6193782">.</span><span class="ident" id="6193783">Max</span><span class="op" id="6193786">.</span><span class="ident" id="6193787">X</span>&nbsp;<span class="op" id="6193789">-</span>&nbsp;<span class="num" id="6193791">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193794">ymax</span>&nbsp;<span class="op" id="6193799">:=</span>&nbsp;<span class="ident" id="6193802">b</span><span class="op" id="6193803">.</span><span class="ident" id="6193804">Max</span><span class="op" id="6193807">.</span><span class="ident" id="6193808">Y</span>&nbsp;<span class="op" id="6193810">-</span>&nbsp;<span class="num" id="6193812">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193815">pix</span>&nbsp;<span class="op" id="6193819">:=</span>&nbsp;<span class="ident" id="6193822">m</span><span class="op" id="6193823">.</span><span class="ident" id="6193824">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6193829">for</span>&nbsp;<span class="ident" id="6193833">j</span>&nbsp;<span class="op" id="6193835">:=</span>&nbsp;<span class="num" id="6193838">0</span><span class="op" id="6193839">;</span>&nbsp;<span class="ident" id="6193841">j</span>&nbsp;<span class="op" id="6193843">&lt;</span>&nbsp;<span class="num" id="6193845">8</span><span class="op" id="6193846">;</span>&nbsp;<span class="ident" id="6193848">j</span><span class="op" id="6193849">++</span>&nbsp;<span class="op" id="6193852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6193856">for</span>&nbsp;<span class="ident" id="6193860">i</span>&nbsp;<span class="op" id="6193862">:=</span>&nbsp;<span class="num" id="6193865">0</span><span class="op" id="6193866">;</span>&nbsp;<span class="ident" id="6193868">i</span>&nbsp;<span class="op" id="6193870">&lt;</span>&nbsp;<span class="num" id="6193872">8</span><span class="op" id="6193873">;</span>&nbsp;<span class="ident" id="6193875">i</span><span class="op" id="6193876">++</span>&nbsp;<span class="op" id="6193879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193884">idx</span>&nbsp;<span class="op" id="6193888">:=</span>&nbsp;<span class="ident" id="6193891">m</span><span class="op" id="6193892">.</span><span class="ident" id="6193893">PixOffset</span><span class="op" id="6193902">(</span><span class="ident" id="6193903">min</span><span class="op" id="6193906">(</span><span class="ident" id="6193907">p</span><span class="op" id="6193908">.</span><span class="ident" id="6193909">X</span><span class="op" id="6193910">+</span><span class="ident" id="6193911">i</span><span class="op" id="6193912">,</span>&nbsp;<span class="ident" id="6193914">xmax</span><span class="op" id="6193918">)</span><span class="op" id="6193919">,</span>&nbsp;<span class="ident" id="6193921">min</span><span class="op" id="6193924">(</span><span class="ident" id="6193925">p</span><span class="op" id="6193926">.</span><span class="ident" id="6193927">Y</span><span class="op" id="6193928">+</span><span class="ident" id="6193929">j</span><span class="op" id="6193930">,</span>&nbsp;<span class="ident" id="6193932">ymax</span><span class="op" id="6193936">)</span><span class="op" id="6193937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193942">yBlock</span><span class="op" id="6193948">[</span><span class="num" id="6193949">8</span><span class="op" id="6193950">*</span><span class="ident" id="6193951">j</span><span class="op" id="6193952">+</span><span class="ident" id="6193953">i</span><span class="op" id="6193954">]</span>&nbsp;<span class="op" id="6193956">=</span>&nbsp;<span class="builtintype" id="6193958">int32</span><span class="op" id="6193963">(</span><span class="ident" id="6193964">pix</span><span class="op" id="6193967">[</span><span class="ident" id="6193968">idx</span><span class="op" id="6193971">]</span><span class="op" id="6193972">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6193976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6193979">}</span><br>
<span class="lineno"></span><span class="op" id="6193981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6193984">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="6194058">func</span>&nbsp;<span class="ident" id="6194063">rgbaToYCbCr</span><span class="op" id="6194074">(</span><span class="ident" id="6194075">m</span>&nbsp;<span class="op" id="6194077">*</span><span class="ident" id="6194078">image</span><span class="op" id="6194083">.</span><span class="ident" id="6194084">RGBA</span><span class="op" id="6194088">,</span>&nbsp;<span class="ident" id="6194090">p</span>&nbsp;<span class="ident" id="6194092">image</span><span class="op" id="6194097">.</span><span class="ident" id="6194098">Point</span><span class="op" id="6194103">,</span>&nbsp;<span class="ident" id="6194105">yBlock</span><span class="op" id="6194111">,</span>&nbsp;<span class="ident" id="6194113">cbBlock</span><span class="op" id="6194120">,</span>&nbsp;<span class="ident" id="6194122">crBlock</span>&nbsp;<span class="op" id="6194130">*</span><span class="ident" id="6194131">block</span><span class="op" id="6194136">)</span>&nbsp;<span class="op" id="6194138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194141">b</span>&nbsp;<span class="op" id="6194143">:=</span>&nbsp;<span class="ident" id="6194146">m</span><span class="op" id="6194147">.</span><span class="ident" id="6194148">Bounds</span><span class="op" id="6194154">(</span><span class="op" id="6194155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194158">xmax</span>&nbsp;<span class="op" id="6194163">:=</span>&nbsp;<span class="ident" id="6194166">b</span><span class="op" id="6194167">.</span><span class="ident" id="6194168">Max</span><span class="op" id="6194171">.</span><span class="ident" id="6194172">X</span>&nbsp;<span class="op" id="6194174">-</span>&nbsp;<span class="num" id="6194176">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194179">ymax</span>&nbsp;<span class="op" id="6194184">:=</span>&nbsp;<span class="ident" id="6194187">b</span><span class="op" id="6194188">.</span><span class="ident" id="6194189">Max</span><span class="op" id="6194192">.</span><span class="ident" id="6194193">Y</span>&nbsp;<span class="op" id="6194195">-</span>&nbsp;<span class="num" id="6194197">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6194200">for</span>&nbsp;<span class="ident" id="6194204">j</span>&nbsp;<span class="op" id="6194206">:=</span>&nbsp;<span class="num" id="6194209">0</span><span class="op" id="6194210">;</span>&nbsp;<span class="ident" id="6194212">j</span>&nbsp;<span class="op" id="6194214">&lt;</span>&nbsp;<span class="num" id="6194216">8</span><span class="op" id="6194217">;</span>&nbsp;<span class="ident" id="6194219">j</span><span class="op" id="6194220">++</span>&nbsp;<span class="op" id="6194223">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194227">sj</span>&nbsp;<span class="op" id="6194230">:=</span>&nbsp;<span class="ident" id="6194233">p</span><span class="op" id="6194234">.</span><span class="ident" id="6194235">Y</span>&nbsp;<span class="op" id="6194237">+</span>&nbsp;<span class="ident" id="6194239">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6194243">if</span>&nbsp;<span class="ident" id="6194246">sj</span>&nbsp;<span class="op" id="6194249">&gt;</span>&nbsp;<span class="ident" id="6194251">ymax</span>&nbsp;<span class="op" id="6194256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194261">sj</span>&nbsp;<span class="op" id="6194264">=</span>&nbsp;<span class="ident" id="6194266">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6194273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194277">offset</span>&nbsp;<span class="op" id="6194284">:=</span>&nbsp;<span class="op" id="6194287">(</span><span class="ident" id="6194288">sj</span><span class="op" id="6194290">-</span><span class="ident" id="6194291">b</span><span class="op" id="6194292">.</span><span class="ident" id="6194293">Min</span><span class="op" id="6194296">.</span><span class="ident" id="6194297">Y</span><span class="op" id="6194298">)</span><span class="op" id="6194299">*</span><span class="ident" id="6194300">m</span><span class="op" id="6194301">.</span><span class="ident" id="6194302">Stride</span>&nbsp;<span class="op" id="6194309">-</span>&nbsp;<span class="ident" id="6194311">b</span><span class="op" id="6194312">.</span><span class="ident" id="6194313">Min</span><span class="op" id="6194316">.</span><span class="ident" id="6194317">X</span><span class="op" id="6194318">*</span><span class="num" id="6194319">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6194323">for</span>&nbsp;<span class="ident" id="6194327">i</span>&nbsp;<span class="op" id="6194329">:=</span>&nbsp;<span class="num" id="6194332">0</span><span class="op" id="6194333">;</span>&nbsp;<span class="ident" id="6194335">i</span>&nbsp;<span class="op" id="6194337">&lt;</span>&nbsp;<span class="num" id="6194339">8</span><span class="op" id="6194340">;</span>&nbsp;<span class="ident" id="6194342">i</span><span class="op" id="6194343">++</span>&nbsp;<span class="op" id="6194346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194351">sx</span>&nbsp;<span class="op" id="6194354">:=</span>&nbsp;<span class="ident" id="6194357">p</span><span class="op" id="6194358">.</span><span class="ident" id="6194359">X</span>&nbsp;<span class="op" id="6194361">+</span>&nbsp;<span class="ident" id="6194363">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6194368">if</span>&nbsp;<span class="ident" id="6194371">sx</span>&nbsp;<span class="op" id="6194374">&gt;</span>&nbsp;<span class="ident" id="6194376">xmax</span>&nbsp;<span class="op" id="6194381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194387">sx</span>&nbsp;<span class="op" id="6194390">=</span>&nbsp;<span class="ident" id="6194392">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6194400">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194405">pix</span>&nbsp;<span class="op" id="6194409">:=</span>&nbsp;<span class="ident" id="6194412">m</span><span class="op" id="6194413">.</span><span class="ident" id="6194414">Pix</span><span class="op" id="6194417">[</span><span class="ident" id="6194418">offset</span><span class="op" id="6194424">+</span><span class="ident" id="6194425">sx</span><span class="op" id="6194427">*</span><span class="num" id="6194428">4</span><span class="op" id="6194429">:</span><span class="op" id="6194430">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194435">yy</span><span class="op" id="6194437">,</span>&nbsp;<span class="ident" id="6194439">cb</span><span class="op" id="6194441">,</span>&nbsp;<span class="ident" id="6194443">cr</span>&nbsp;<span class="op" id="6194446">:=</span>&nbsp;<span class="ident" id="6194449">color</span><span class="op" id="6194454">.</span><span class="ident" id="6194455">RGBToYCbCr</span><span class="op" id="6194465">(</span><span class="ident" id="6194466">pix</span><span class="op" id="6194469">[</span><span class="num" id="6194470">0</span><span class="op" id="6194471">]</span><span class="op" id="6194472">,</span>&nbsp;<span class="ident" id="6194474">pix</span><span class="op" id="6194477">[</span><span class="num" id="6194478">1</span><span class="op" id="6194479">]</span><span class="op" id="6194480">,</span>&nbsp;<span class="ident" id="6194482">pix</span><span class="op" id="6194485">[</span><span class="num" id="6194486">2</span><span class="op" id="6194487">]</span><span class="op" id="6194488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194493">yBlock</span><span class="op" id="6194499">[</span><span class="num" id="6194500">8</span><span class="op" id="6194501">*</span><span class="ident" id="6194502">j</span><span class="op" id="6194503">+</span><span class="ident" id="6194504">i</span><span class="op" id="6194505">]</span>&nbsp;<span class="op" id="6194507">=</span>&nbsp;<span class="builtintype" id="6194509">int32</span><span class="op" id="6194514">(</span><span class="ident" id="6194515">yy</span><span class="op" id="6194517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194522">cbBlock</span><span class="op" id="6194529">[</span><span class="num" id="6194530">8</span><span class="op" id="6194531">*</span><span class="ident" id="6194532">j</span><span class="op" id="6194533">+</span><span class="ident" id="6194534">i</span><span class="op" id="6194535">]</span>&nbsp;<span class="op" id="6194537">=</span>&nbsp;<span class="builtintype" id="6194539">int32</span><span class="op" id="6194544">(</span><span class="ident" id="6194545">cb</span><span class="op" id="6194547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194552">crBlock</span><span class="op" id="6194559">[</span><span class="num" id="6194560">8</span><span class="op" id="6194561">*</span><span class="ident" id="6194562">j</span><span class="op" id="6194563">+</span><span class="ident" id="6194564">i</span><span class="op" id="6194565">]</span>&nbsp;<span class="op" id="6194567">=</span>&nbsp;<span class="builtintype" id="6194569">int32</span><span class="op" id="6194574">(</span><span class="ident" id="6194575">cr</span><span class="op" id="6194577">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6194581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6194584">}</span><br>
<span class="lineno"></span><span class="op" id="6194586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6194589">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="6194665">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="6194679">func</span>&nbsp;<span class="ident" id="6194684">scale</span><span class="op" id="6194689">(</span><span class="ident" id="6194690">dst</span>&nbsp;<span class="op" id="6194694">*</span><span class="ident" id="6194695">block</span><span class="op" id="6194700">,</span>&nbsp;<span class="ident" id="6194702">src</span>&nbsp;<span class="op" id="6194706">*</span><span class="op" id="6194707">[</span><span class="num" id="6194708">4</span><span class="op" id="6194709">]</span><span class="ident" id="6194710">block</span><span class="op" id="6194715">)</span>&nbsp;<span class="op" id="6194717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6194720">for</span>&nbsp;<span class="ident" id="6194724">i</span>&nbsp;<span class="op" id="6194726">:=</span>&nbsp;<span class="num" id="6194729">0</span><span class="op" id="6194730">;</span>&nbsp;<span class="ident" id="6194732">i</span>&nbsp;<span class="op" id="6194734">&lt;</span>&nbsp;<span class="num" id="6194736">4</span><span class="op" id="6194737">;</span>&nbsp;<span class="ident" id="6194739">i</span><span class="op" id="6194740">++</span>&nbsp;<span class="op" id="6194743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194747">dstOff</span>&nbsp;<span class="op" id="6194754">:=</span>&nbsp;<span class="op" id="6194757">(</span><span class="ident" id="6194758">i</span><span class="op" id="6194759">&amp;</span><span class="num" id="6194760">2</span><span class="op" id="6194761">)</span><span class="op" id="6194762">&lt;&lt;</span><span class="num" id="6194764">4</span>&nbsp;<span class="op" id="6194766">|</span>&nbsp;<span class="op" id="6194768">(</span><span class="ident" id="6194769">i</span><span class="op" id="6194770">&amp;</span><span class="num" id="6194771">1</span><span class="op" id="6194772">)</span><span class="op" id="6194773">&lt;&lt;</span><span class="num" id="6194775">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6194779">for</span>&nbsp;<span class="ident" id="6194783">y</span>&nbsp;<span class="op" id="6194785">:=</span>&nbsp;<span class="num" id="6194788">0</span><span class="op" id="6194789">;</span>&nbsp;<span class="ident" id="6194791">y</span>&nbsp;<span class="op" id="6194793">&lt;</span>&nbsp;<span class="num" id="6194795">4</span><span class="op" id="6194796">;</span>&nbsp;<span class="ident" id="6194798">y</span><span class="op" id="6194799">++</span>&nbsp;<span class="op" id="6194802">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6194807">for</span>&nbsp;<span class="ident" id="6194811">x</span>&nbsp;<span class="op" id="6194813">:=</span>&nbsp;<span class="num" id="6194816">0</span><span class="op" id="6194817">;</span>&nbsp;<span class="ident" id="6194819">x</span>&nbsp;<span class="op" id="6194821">&lt;</span>&nbsp;<span class="num" id="6194823">4</span><span class="op" id="6194824">;</span>&nbsp;<span class="ident" id="6194826">x</span><span class="op" id="6194827">++</span>&nbsp;<span class="op" id="6194830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194836">j</span>&nbsp;<span class="op" id="6194838">:=</span>&nbsp;<span class="num" id="6194841">16</span><span class="op" id="6194843">*</span><span class="ident" id="6194844">y</span>&nbsp;<span class="op" id="6194846">+</span>&nbsp;<span class="num" id="6194848">2</span><span class="op" id="6194849">*</span><span class="ident" id="6194850">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194856">sum</span>&nbsp;<span class="op" id="6194860">:=</span>&nbsp;<span class="ident" id="6194863">src</span><span class="op" id="6194866">[</span><span class="ident" id="6194867">i</span><span class="op" id="6194868">]</span><span class="op" id="6194869">[</span><span class="ident" id="6194870">j</span><span class="op" id="6194871">]</span>&nbsp;<span class="op" id="6194873">+</span>&nbsp;<span class="ident" id="6194875">src</span><span class="op" id="6194878">[</span><span class="ident" id="6194879">i</span><span class="op" id="6194880">]</span><span class="op" id="6194881">[</span><span class="ident" id="6194882">j</span><span class="op" id="6194883">+</span><span class="num" id="6194884">1</span><span class="op" id="6194885">]</span>&nbsp;<span class="op" id="6194887">+</span>&nbsp;<span class="ident" id="6194889">src</span><span class="op" id="6194892">[</span><span class="ident" id="6194893">i</span><span class="op" id="6194894">]</span><span class="op" id="6194895">[</span><span class="ident" id="6194896">j</span><span class="op" id="6194897">+</span><span class="num" id="6194898">8</span><span class="op" id="6194899">]</span>&nbsp;<span class="op" id="6194901">+</span>&nbsp;<span class="ident" id="6194903">src</span><span class="op" id="6194906">[</span><span class="ident" id="6194907">i</span><span class="op" id="6194908">]</span><span class="op" id="6194909">[</span><span class="ident" id="6194910">j</span><span class="op" id="6194911">+</span><span class="num" id="6194912">9</span><span class="op" id="6194913">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6194919">dst</span><span class="op" id="6194922">[</span><span class="num" id="6194923">8</span><span class="op" id="6194924">*</span><span class="ident" id="6194925">y</span><span class="op" id="6194926">+</span><span class="ident" id="6194927">x</span><span class="op" id="6194928">+</span><span class="ident" id="6194929">dstOff</span><span class="op" id="6194935">]</span>&nbsp;<span class="op" id="6194937">=</span>&nbsp;<span class="op" id="6194939">(</span><span class="ident" id="6194940">sum</span>&nbsp;<span class="op" id="6194944">+</span>&nbsp;<span class="num" id="6194946">2</span><span class="op" id="6194947">)</span>&nbsp;<span class="op" id="6194949">&gt;&gt;</span>&nbsp;<span class="num" id="6194952">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6194957">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6194961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6194964">}</span><br>
<span class="lineno"></span><span class="op" id="6194966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6194969">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="6195033">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6195068">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6195106">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6195166">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6195237">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="6195312">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="6195355">var</span>&nbsp;<span class="ident" id="6195359">sosHeaderY</span>&nbsp;<span class="op" id="6195370">=</span>&nbsp;<span class="op" id="6195372">[</span><span class="op" id="6195373">]</span><span class="builtintype" id="6195374">byte</span><span class="op" id="6195378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6195381">0xff</span><span class="op" id="6195385">,</span>&nbsp;<span class="num" id="6195387">0xda</span><span class="op" id="6195391">,</span>&nbsp;<span class="num" id="6195393">0x00</span><span class="op" id="6195397">,</span>&nbsp;<span class="num" id="6195399">0x08</span><span class="op" id="6195403">,</span>&nbsp;<span class="num" id="6195405">0x01</span><span class="op" id="6195409">,</span>&nbsp;<span class="num" id="6195411">0x01</span><span class="op" id="6195415">,</span>&nbsp;<span class="num" id="6195417">0x00</span><span class="op" id="6195421">,</span>&nbsp;<span class="num" id="6195423">0x00</span><span class="op" id="6195427">,</span>&nbsp;<span class="num" id="6195429">0x3f</span><span class="op" id="6195433">,</span>&nbsp;<span class="num" id="6195435">0x00</span><span class="op" id="6195439">,</span><br>
<span class="lineno"></span><span class="op" id="6195441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="6195444">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="6195513">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6195548">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6195586">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6195646">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="6195706">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6195766">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6195837">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="6195912">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="6195955">var</span>&nbsp;<span class="ident" id="6195959">sosHeaderYCbCr</span>&nbsp;<span class="op" id="6195974">=</span>&nbsp;<span class="op" id="6195976">[</span><span class="op" id="6195977">]</span><span class="builtintype" id="6195978">byte</span><span class="op" id="6195982">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6195985">0xff</span><span class="op" id="6195989">,</span>&nbsp;<span class="num" id="6195991">0xda</span><span class="op" id="6195995">,</span>&nbsp;<span class="num" id="6195997">0x00</span><span class="op" id="6196001">,</span>&nbsp;<span class="num" id="6196003">0x0c</span><span class="op" id="6196007">,</span>&nbsp;<span class="num" id="6196009">0x03</span><span class="op" id="6196013">,</span>&nbsp;<span class="num" id="6196015">0x01</span><span class="op" id="6196019">,</span>&nbsp;<span class="num" id="6196021">0x00</span><span class="op" id="6196025">,</span>&nbsp;<span class="num" id="6196027">0x02</span><span class="op" id="6196031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6196034">0x11</span><span class="op" id="6196038">,</span>&nbsp;<span class="num" id="6196040">0x03</span><span class="op" id="6196044">,</span>&nbsp;<span class="num" id="6196046">0x11</span><span class="op" id="6196050">,</span>&nbsp;<span class="num" id="6196052">0x00</span><span class="op" id="6196056">,</span>&nbsp;<span class="num" id="6196058">0x3f</span><span class="op" id="6196062">,</span>&nbsp;<span class="num" id="6196064">0x00</span><span class="op" id="6196068">,</span><br>
<span class="lineno"></span><span class="op" id="6196070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6196073">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="6196116">func</span>&nbsp;<span class="op" id="6196121">(</span><span class="ident" id="6196122">e</span>&nbsp;<span class="op" id="6196124">*</span><span class="ident" id="6196125">encoder</span><span class="op" id="6196132">)</span>&nbsp;<span class="ident" id="6196134">writeSOS</span><span class="op" id="6196142">(</span><span class="ident" id="6196143">m</span>&nbsp;<span class="ident" id="6196145">image</span><span class="op" id="6196150">.</span><span class="ident" id="6196151">Image</span><span class="op" id="6196156">)</span>&nbsp;<span class="op" id="6196158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6196161">switch</span>&nbsp;<span class="ident" id="6196168">m</span><span class="op" id="6196169">.</span><span class="op" id="6196170">(</span><span class="keyword" id="6196171">type</span><span class="op" id="6196175">)</span>&nbsp;<span class="op" id="6196177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6196180">case</span>&nbsp;<span class="op" id="6196185">*</span><span class="ident" id="6196186">image</span><span class="op" id="6196191">.</span><span class="ident" id="6196192">Gray</span><span class="op" id="6196196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6196200">e</span><span class="op" id="6196201">.</span><span class="ident" id="6196202">write</span><span class="op" id="6196207">(</span><span class="ident" id="6196208">sosHeaderY</span><span class="op" id="6196218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6196221">default</span><span class="op" id="6196228">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6196232">e</span><span class="op" id="6196233">.</span><span class="ident" id="6196234">write</span><span class="op" id="6196239">(</span><span class="ident" id="6196240">sosHeaderYCbCr</span><span class="op" id="6196254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6196257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6196260">var</span>&nbsp;<span class="op" id="6196264">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6196268">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6196315">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6196367">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6196374">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6196382">cb</span><span class="op" id="6196384">,</span>&nbsp;<span class="ident" id="6196386">cr</span>&nbsp;<span class="op" id="6196389">[</span><span class="num" id="6196390">4</span><span class="op" id="6196391">]</span><span class="ident" id="6196392">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6196400">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6196438">prevDCY</span><span class="op" id="6196445">,</span>&nbsp;<span class="ident" id="6196447">prevDCCb</span><span class="op" id="6196455">,</span>&nbsp;<span class="ident" id="6196457">prevDCCr</span>&nbsp;<span class="builtintype" id="6196466">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6196473">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6196476">bounds</span>&nbsp;<span class="op" id="6196483">:=</span>&nbsp;<span class="ident" id="6196486">m</span><span class="op" id="6196487">.</span><span class="ident" id="6196488">Bounds</span><span class="op" id="6196494">(</span><span class="op" id="6196495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6196498">switch</span>&nbsp;<span class="ident" id="6196505">m</span>&nbsp;<span class="op" id="6196507">:=</span>&nbsp;<span class="ident" id="6196510">m</span><span class="op" id="6196511">.</span><span class="op" id="6196512">(</span><span class="keyword" id="6196513">type</span><span class="op" id="6196517">)</span>&nbsp;<span class="op" id="6196519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6196522">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6196584">case</span>&nbsp;<span class="op" id="6196589">*</span><span class="ident" id="6196590">image</span><span class="op" id="6196595">.</span><span class="ident" id="6196596">Gray</span><span class="op" id="6196600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6196604">for</span>&nbsp;<span class="ident" id="6196608">y</span>&nbsp;<span class="op" id="6196610">:=</span>&nbsp;<span class="ident" id="6196613">bounds</span><span class="op" id="6196619">.</span><span class="ident" id="6196620">Min</span><span class="op" id="6196623">.</span><span class="ident" id="6196624">Y</span><span class="op" id="6196625">;</span>&nbsp;<span class="ident" id="6196627">y</span>&nbsp;<span class="op" id="6196629">&lt;</span>&nbsp;<span class="ident" id="6196631">bounds</span><span class="op" id="6196637">.</span><span class="ident" id="6196638">Max</span><span class="op" id="6196641">.</span><span class="ident" id="6196642">Y</span><span class="op" id="6196643">;</span>&nbsp;<span class="ident" id="6196645">y</span>&nbsp;<span class="op" id="6196647">+=</span>&nbsp;<span class="num" id="6196650">8</span>&nbsp;<span class="op" id="6196652">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6196657">for</span>&nbsp;<span class="ident" id="6196661">x</span>&nbsp;<span class="op" id="6196663">:=</span>&nbsp;<span class="ident" id="6196666">bounds</span><span class="op" id="6196672">.</span><span class="ident" id="6196673">Min</span><span class="op" id="6196676">.</span><span class="ident" id="6196677">X</span><span class="op" id="6196678">;</span>&nbsp;<span class="ident" id="6196680">x</span>&nbsp;<span class="op" id="6196682">&lt;</span>&nbsp;<span class="ident" id="6196684">bounds</span><span class="op" id="6196690">.</span><span class="ident" id="6196691">Max</span><span class="op" id="6196694">.</span><span class="ident" id="6196695">X</span><span class="op" id="6196696">;</span>&nbsp;<span class="ident" id="6196698">x</span>&nbsp;<span class="op" id="6196700">+=</span>&nbsp;<span class="num" id="6196703">8</span>&nbsp;<span class="op" id="6196705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6196711">p</span>&nbsp;<span class="op" id="6196713">:=</span>&nbsp;<span class="ident" id="6196716">image</span><span class="op" id="6196721">.</span><span class="ident" id="6196722">Pt</span><span class="op" id="6196724">(</span><span class="ident" id="6196725">x</span><span class="op" id="6196726">,</span>&nbsp;<span class="ident" id="6196728">y</span><span class="op" id="6196729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6196735">grayToY</span><span class="op" id="6196742">(</span><span class="ident" id="6196743">m</span><span class="op" id="6196744">,</span>&nbsp;<span class="ident" id="6196746">p</span><span class="op" id="6196747">,</span>&nbsp;<span class="op" id="6196749">&amp;</span><span class="ident" id="6196750">b</span><span class="op" id="6196751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6196757">prevDCY</span>&nbsp;<span class="op" id="6196765">=</span>&nbsp;<span class="ident" id="6196767">e</span><span class="op" id="6196768">.</span><span class="ident" id="6196769">writeBlock</span><span class="op" id="6196779">(</span><span class="op" id="6196780">&amp;</span><span class="ident" id="6196781">b</span><span class="op" id="6196782">,</span>&nbsp;<span class="num" id="6196784">0</span><span class="op" id="6196785">,</span>&nbsp;<span class="ident" id="6196787">prevDCY</span><span class="op" id="6196794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6196799">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6196803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6196806">default</span><span class="op" id="6196813">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6196817">rgba</span><span class="op" id="6196821">,</span>&nbsp;<span class="ident" id="6196823">_</span>&nbsp;<span class="op" id="6196825">:=</span>&nbsp;<span class="ident" id="6196828">m</span><span class="op" id="6196829">.</span><span class="op" id="6196830">(</span><span class="op" id="6196831">*</span><span class="ident" id="6196832">image</span><span class="op" id="6196837">.</span><span class="ident" id="6196838">RGBA</span><span class="op" id="6196842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6196846">for</span>&nbsp;<span class="ident" id="6196850">y</span>&nbsp;<span class="op" id="6196852">:=</span>&nbsp;<span class="ident" id="6196855">bounds</span><span class="op" id="6196861">.</span><span class="ident" id="6196862">Min</span><span class="op" id="6196865">.</span><span class="ident" id="6196866">Y</span><span class="op" id="6196867">;</span>&nbsp;<span class="ident" id="6196869">y</span>&nbsp;<span class="op" id="6196871">&lt;</span>&nbsp;<span class="ident" id="6196873">bounds</span><span class="op" id="6196879">.</span><span class="ident" id="6196880">Max</span><span class="op" id="6196883">.</span><span class="ident" id="6196884">Y</span><span class="op" id="6196885">;</span>&nbsp;<span class="ident" id="6196887">y</span>&nbsp;<span class="op" id="6196889">+=</span>&nbsp;<span class="num" id="6196892">16</span>&nbsp;<span class="op" id="6196895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6196900">for</span>&nbsp;<span class="ident" id="6196904">x</span>&nbsp;<span class="op" id="6196906">:=</span>&nbsp;<span class="ident" id="6196909">bounds</span><span class="op" id="6196915">.</span><span class="ident" id="6196916">Min</span><span class="op" id="6196919">.</span><span class="ident" id="6196920">X</span><span class="op" id="6196921">;</span>&nbsp;<span class="ident" id="6196923">x</span>&nbsp;<span class="op" id="6196925">&lt;</span>&nbsp;<span class="ident" id="6196927">bounds</span><span class="op" id="6196933">.</span><span class="ident" id="6196934">Max</span><span class="op" id="6196937">.</span><span class="ident" id="6196938">X</span><span class="op" id="6196939">;</span>&nbsp;<span class="ident" id="6196941">x</span>&nbsp;<span class="op" id="6196943">+=</span>&nbsp;<span class="num" id="6196946">16</span>&nbsp;<span class="op" id="6196949">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6196955">for</span>&nbsp;<span class="ident" id="6196959">i</span>&nbsp;<span class="op" id="6196961">:=</span>&nbsp;<span class="num" id="6196964">0</span><span class="op" id="6196965">;</span>&nbsp;<span class="ident" id="6196967">i</span>&nbsp;<span class="op" id="6196969">&lt;</span>&nbsp;<span class="num" id="6196971">4</span><span class="op" id="6196972">;</span>&nbsp;<span class="ident" id="6196974">i</span><span class="op" id="6196975">++</span>&nbsp;<span class="op" id="6196978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6196985">xOff</span>&nbsp;<span class="op" id="6196990">:=</span>&nbsp;<span class="op" id="6196993">(</span><span class="ident" id="6196994">i</span>&nbsp;<span class="op" id="6196996">&amp;</span>&nbsp;<span class="num" id="6196998">1</span><span class="op" id="6196999">)</span>&nbsp;<span class="op" id="6197001">*</span>&nbsp;<span class="num" id="6197003">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6197010">yOff</span>&nbsp;<span class="op" id="6197015">:=</span>&nbsp;<span class="op" id="6197018">(</span><span class="ident" id="6197019">i</span>&nbsp;<span class="op" id="6197021">&amp;</span>&nbsp;<span class="num" id="6197023">2</span><span class="op" id="6197024">)</span>&nbsp;<span class="op" id="6197026">*</span>&nbsp;<span class="num" id="6197028">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6197035">p</span>&nbsp;<span class="op" id="6197037">:=</span>&nbsp;<span class="ident" id="6197040">image</span><span class="op" id="6197045">.</span><span class="ident" id="6197046">Pt</span><span class="op" id="6197048">(</span><span class="ident" id="6197049">x</span><span class="op" id="6197050">+</span><span class="ident" id="6197051">xOff</span><span class="op" id="6197055">,</span>&nbsp;<span class="ident" id="6197057">y</span><span class="op" id="6197058">+</span><span class="ident" id="6197059">yOff</span><span class="op" id="6197063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6197070">if</span>&nbsp;<span class="ident" id="6197073">rgba</span>&nbsp;<span class="op" id="6197078">!=</span>&nbsp;<span class="ident" id="6197081">nil</span>&nbsp;<span class="op" id="6197085">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6197093">rgbaToYCbCr</span><span class="op" id="6197104">(</span><span class="ident" id="6197105">rgba</span><span class="op" id="6197109">,</span>&nbsp;<span class="ident" id="6197111">p</span><span class="op" id="6197112">,</span>&nbsp;<span class="op" id="6197114">&amp;</span><span class="ident" id="6197115">b</span><span class="op" id="6197116">,</span>&nbsp;<span class="op" id="6197118">&amp;</span><span class="ident" id="6197119">cb</span><span class="op" id="6197121">[</span><span class="ident" id="6197122">i</span><span class="op" id="6197123">]</span><span class="op" id="6197124">,</span>&nbsp;<span class="op" id="6197126">&amp;</span><span class="ident" id="6197127">cr</span><span class="op" id="6197129">[</span><span class="ident" id="6197130">i</span><span class="op" id="6197131">]</span><span class="op" id="6197132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6197139">}</span>&nbsp;<span class="keyword" id="6197141">else</span>&nbsp;<span class="op" id="6197146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6197154">toYCbCr</span><span class="op" id="6197161">(</span><span class="ident" id="6197162">m</span><span class="op" id="6197163">,</span>&nbsp;<span class="ident" id="6197165">p</span><span class="op" id="6197166">,</span>&nbsp;<span class="op" id="6197168">&amp;</span><span class="ident" id="6197169">b</span><span class="op" id="6197170">,</span>&nbsp;<span class="op" id="6197172">&amp;</span><span class="ident" id="6197173">cb</span><span class="op" id="6197175">[</span><span class="ident" id="6197176">i</span><span class="op" id="6197177">]</span><span class="op" id="6197178">,</span>&nbsp;<span class="op" id="6197180">&amp;</span><span class="ident" id="6197181">cr</span><span class="op" id="6197183">[</span><span class="ident" id="6197184">i</span><span class="op" id="6197185">]</span><span class="op" id="6197186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6197193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6197200">prevDCY</span>&nbsp;<span class="op" id="6197208">=</span>&nbsp;<span class="ident" id="6197210">e</span><span class="op" id="6197211">.</span><span class="ident" id="6197212">writeBlock</span><span class="op" id="6197222">(</span><span class="op" id="6197223">&amp;</span><span class="ident" id="6197224">b</span><span class="op" id="6197225">,</span>&nbsp;<span class="num" id="6197227">0</span><span class="op" id="6197228">,</span>&nbsp;<span class="ident" id="6197230">prevDCY</span><span class="op" id="6197237">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6197243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6197249">scale</span><span class="op" id="6197254">(</span><span class="op" id="6197255">&amp;</span><span class="ident" id="6197256">b</span><span class="op" id="6197257">,</span>&nbsp;<span class="op" id="6197259">&amp;</span><span class="ident" id="6197260">cb</span><span class="op" id="6197262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6197268">prevDCCb</span>&nbsp;<span class="op" id="6197277">=</span>&nbsp;<span class="ident" id="6197279">e</span><span class="op" id="6197280">.</span><span class="ident" id="6197281">writeBlock</span><span class="op" id="6197291">(</span><span class="op" id="6197292">&amp;</span><span class="ident" id="6197293">b</span><span class="op" id="6197294">,</span>&nbsp;<span class="num" id="6197296">1</span><span class="op" id="6197297">,</span>&nbsp;<span class="ident" id="6197299">prevDCCb</span><span class="op" id="6197307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6197313">scale</span><span class="op" id="6197318">(</span><span class="op" id="6197319">&amp;</span><span class="ident" id="6197320">b</span><span class="op" id="6197321">,</span>&nbsp;<span class="op" id="6197323">&amp;</span><span class="ident" id="6197324">cr</span><span class="op" id="6197326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6197332">prevDCCr</span>&nbsp;<span class="op" id="6197341">=</span>&nbsp;<span class="ident" id="6197343">e</span><span class="op" id="6197344">.</span><span class="ident" id="6197345">writeBlock</span><span class="op" id="6197355">(</span><span class="op" id="6197356">&amp;</span><span class="ident" id="6197357">b</span><span class="op" id="6197358">,</span>&nbsp;<span class="num" id="6197360">1</span><span class="op" id="6197361">,</span>&nbsp;<span class="ident" id="6197363">prevDCCr</span><span class="op" id="6197371">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6197376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6197380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6197383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6197386">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6197418">e</span><span class="op" id="6197419">.</span><span class="ident" id="6197420">emit</span><span class="op" id="6197424">(</span><span class="num" id="6197425">0x7f</span><span class="op" id="6197429">,</span>&nbsp;<span class="num" id="6197431">7</span><span class="op" id="6197432">)</span><br>
<span class="lineno">535</span><span class="op" id="6197434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6197437">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="6197498">const</span>&nbsp;<span class="ident" id="6197504">DefaultQuality</span>&nbsp;<span class="op" id="6197519">=</span>&nbsp;<span class="num" id="6197521">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="6197525">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="6197565">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="6197626">type</span>&nbsp;<span class="ident" id="6197631">Options</span>&nbsp;<span class="keyword" id="6197639">struct</span>&nbsp;<span class="op" id="6197646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6197649">Quality</span>&nbsp;<span class="builtintype" id="6197657">int</span><br>
<span class="lineno"></span><span class="op" id="6197661">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="6197664">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6197743">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="6197812">func</span>&nbsp;<span class="ident" id="6197817">Encode</span><span class="op" id="6197823">(</span><span class="ident" id="6197824">w</span>&nbsp;<span class="ident" id="6197826">io</span><span class="op" id="6197828">.</span><span class="ident" id="6197829">Writer</span><span class="op" id="6197835">,</span>&nbsp;<span class="ident" id="6197837">m</span>&nbsp;<span class="ident" id="6197839">image</span><span class="op" id="6197844">.</span><span class="ident" id="6197845">Image</span><span class="op" id="6197850">,</span>&nbsp;<span class="ident" id="6197852">o</span>&nbsp;<span class="op" id="6197854">*</span><span class="ident" id="6197855">Options</span><span class="op" id="6197862">)</span>&nbsp;<span class="builtintype" id="6197864">error</span>&nbsp;<span class="op" id="6197870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6197873">b</span>&nbsp;<span class="op" id="6197875">:=</span>&nbsp;<span class="ident" id="6197878">m</span><span class="op" id="6197879">.</span><span class="ident" id="6197880">Bounds</span><span class="op" id="6197886">(</span><span class="op" id="6197887">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6197890">if</span>&nbsp;<span class="ident" id="6197893">b</span><span class="op" id="6197894">.</span><span class="ident" id="6197895">Dx</span><span class="op" id="6197897">(</span><span class="op" id="6197898">)</span>&nbsp;<span class="op" id="6197900">&gt;=</span>&nbsp;<span class="num" id="6197903">1</span><span class="op" id="6197904">&lt;&lt;</span><span class="num" id="6197906">16</span>&nbsp;<span class="op" id="6197909">||</span>&nbsp;<span class="ident" id="6197912">b</span><span class="op" id="6197913">.</span><span class="ident" id="6197914">Dy</span><span class="op" id="6197916">(</span><span class="op" id="6197917">)</span>&nbsp;<span class="op" id="6197919">&gt;=</span>&nbsp;<span class="num" id="6197922">1</span><span class="op" id="6197923">&lt;&lt;</span><span class="num" id="6197925">16</span>&nbsp;<span class="op" id="6197928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6197932">return</span>&nbsp;<span class="ident" id="6197939">errors</span><span class="op" id="6197945">.</span><span class="ident" id="6197946">New</span><span class="op" id="6197949">(</span><span class="string" id="6197950">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6197986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6197989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6197992">var</span>&nbsp;<span class="ident" id="6197996">e</span>&nbsp;<span class="ident" id="6197998">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6198007">if</span>&nbsp;<span class="ident" id="6198010">ww</span><span class="op" id="6198012">,</span>&nbsp;<span class="ident" id="6198014">ok</span>&nbsp;<span class="op" id="6198017">:=</span>&nbsp;<span class="ident" id="6198020">w</span><span class="op" id="6198021">.</span><span class="op" id="6198022">(</span><span class="ident" id="6198023">writer</span><span class="op" id="6198029">)</span><span class="op" id="6198030">;</span>&nbsp;<span class="ident" id="6198032">ok</span>&nbsp;<span class="op" id="6198035">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198039">e</span><span class="op" id="6198040">.</span><span class="ident" id="6198041">w</span>&nbsp;<span class="op" id="6198043">=</span>&nbsp;<span class="ident" id="6198045">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198049">}</span>&nbsp;<span class="keyword" id="6198051">else</span>&nbsp;<span class="op" id="6198056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198060">e</span><span class="op" id="6198061">.</span><span class="ident" id="6198062">w</span>&nbsp;<span class="op" id="6198064">=</span>&nbsp;<span class="ident" id="6198066">bufio</span><span class="op" id="6198071">.</span><span class="ident" id="6198072">NewWriter</span><span class="op" id="6198081">(</span><span class="ident" id="6198082">w</span><span class="op" id="6198083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6198089">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198119">quality</span>&nbsp;<span class="op" id="6198127">:=</span>&nbsp;<span class="ident" id="6198130">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6198146">if</span>&nbsp;<span class="ident" id="6198149">o</span>&nbsp;<span class="op" id="6198151">!=</span>&nbsp;<span class="ident" id="6198154">nil</span>&nbsp;<span class="op" id="6198158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198162">quality</span>&nbsp;<span class="op" id="6198170">=</span>&nbsp;<span class="ident" id="6198172">o</span><span class="op" id="6198173">.</span><span class="ident" id="6198174">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6198184">if</span>&nbsp;<span class="ident" id="6198187">quality</span>&nbsp;<span class="op" id="6198195">&lt;</span>&nbsp;<span class="num" id="6198197">1</span>&nbsp;<span class="op" id="6198199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198204">quality</span>&nbsp;<span class="op" id="6198212">=</span>&nbsp;<span class="num" id="6198214">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198218">}</span>&nbsp;<span class="keyword" id="6198220">else</span>&nbsp;<span class="keyword" id="6198225">if</span>&nbsp;<span class="ident" id="6198228">quality</span>&nbsp;<span class="op" id="6198236">&gt;</span>&nbsp;<span class="num" id="6198238">100</span>&nbsp;<span class="op" id="6198242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198247">quality</span>&nbsp;<span class="op" id="6198255">=</span>&nbsp;<span class="num" id="6198257">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6198269">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6198324">var</span>&nbsp;<span class="ident" id="6198328">scale</span>&nbsp;<span class="builtintype" id="6198334">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6198339">if</span>&nbsp;<span class="ident" id="6198342">quality</span>&nbsp;<span class="op" id="6198350">&lt;</span>&nbsp;<span class="num" id="6198352">50</span>&nbsp;<span class="op" id="6198355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198359">scale</span>&nbsp;<span class="op" id="6198365">=</span>&nbsp;<span class="num" id="6198367">5000</span>&nbsp;<span class="op" id="6198372">/</span>&nbsp;<span class="ident" id="6198374">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198383">}</span>&nbsp;<span class="keyword" id="6198385">else</span>&nbsp;<span class="op" id="6198390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198394">scale</span>&nbsp;<span class="op" id="6198400">=</span>&nbsp;<span class="num" id="6198402">200</span>&nbsp;<span class="op" id="6198406">-</span>&nbsp;<span class="ident" id="6198408">quality</span><span class="op" id="6198415">*</span><span class="num" id="6198416">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6198422">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6198462">for</span>&nbsp;<span class="ident" id="6198466">i</span>&nbsp;<span class="op" id="6198468">:=</span>&nbsp;<span class="keyword" id="6198471">range</span>&nbsp;<span class="ident" id="6198477">e</span><span class="op" id="6198478">.</span><span class="ident" id="6198479">quant</span>&nbsp;<span class="op" id="6198485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6198489">for</span>&nbsp;<span class="ident" id="6198493">j</span>&nbsp;<span class="op" id="6198495">:=</span>&nbsp;<span class="keyword" id="6198498">range</span>&nbsp;<span class="ident" id="6198504">e</span><span class="op" id="6198505">.</span><span class="ident" id="6198506">quant</span><span class="op" id="6198511">[</span><span class="ident" id="6198512">i</span><span class="op" id="6198513">]</span>&nbsp;<span class="op" id="6198515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198520">x</span>&nbsp;<span class="op" id="6198522">:=</span>&nbsp;<span class="builtintype" id="6198525">int</span><span class="op" id="6198528">(</span><span class="ident" id="6198529">unscaledQuant</span><span class="op" id="6198542">[</span><span class="ident" id="6198543">i</span><span class="op" id="6198544">]</span><span class="op" id="6198545">[</span><span class="ident" id="6198546">j</span><span class="op" id="6198547">]</span><span class="op" id="6198548">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198553">x</span>&nbsp;<span class="op" id="6198555">=</span>&nbsp;<span class="op" id="6198557">(</span><span class="ident" id="6198558">x</span><span class="op" id="6198559">*</span><span class="ident" id="6198560">scale</span>&nbsp;<span class="op" id="6198566">+</span>&nbsp;<span class="num" id="6198568">50</span><span class="op" id="6198570">)</span>&nbsp;<span class="op" id="6198572">/</span>&nbsp;<span class="num" id="6198574">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6198581">if</span>&nbsp;<span class="ident" id="6198584">x</span>&nbsp;<span class="op" id="6198586">&lt;</span>&nbsp;<span class="num" id="6198588">1</span>&nbsp;<span class="op" id="6198590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198596">x</span>&nbsp;<span class="op" id="6198598">=</span>&nbsp;<span class="num" id="6198600">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198605">}</span>&nbsp;<span class="keyword" id="6198607">else</span>&nbsp;<span class="keyword" id="6198612">if</span>&nbsp;<span class="ident" id="6198615">x</span>&nbsp;<span class="op" id="6198617">&gt;</span>&nbsp;<span class="num" id="6198619">255</span>&nbsp;<span class="op" id="6198623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198629">x</span>&nbsp;<span class="op" id="6198631">=</span>&nbsp;<span class="num" id="6198633">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198645">e</span><span class="op" id="6198646">.</span><span class="ident" id="6198647">quant</span><span class="op" id="6198652">[</span><span class="ident" id="6198653">i</span><span class="op" id="6198654">]</span><span class="op" id="6198655">[</span><span class="ident" id="6198656">j</span><span class="op" id="6198657">]</span>&nbsp;<span class="op" id="6198659">=</span>&nbsp;<span class="builtintype" id="6198661">uint8</span><span class="op" id="6198666">(</span><span class="ident" id="6198667">x</span><span class="op" id="6198668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6198678">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198738">nComponent</span>&nbsp;<span class="op" id="6198749">:=</span>&nbsp;<span class="num" id="6198752">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6198755">switch</span>&nbsp;<span class="ident" id="6198762">m</span><span class="op" id="6198763">.</span><span class="op" id="6198764">(</span><span class="keyword" id="6198765">type</span><span class="op" id="6198769">)</span>&nbsp;<span class="op" id="6198771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6198774">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6198836">case</span>&nbsp;<span class="op" id="6198841">*</span><span class="ident" id="6198842">image</span><span class="op" id="6198847">.</span><span class="ident" id="6198848">Gray</span><span class="op" id="6198852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198856">nComponent</span>&nbsp;<span class="op" id="6198867">=</span>&nbsp;<span class="num" id="6198869">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6198872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6198875">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198912">e</span><span class="op" id="6198913">.</span><span class="ident" id="6198914">buf</span><span class="op" id="6198917">[</span><span class="num" id="6198918">0</span><span class="op" id="6198919">]</span>&nbsp;<span class="op" id="6198921">=</span>&nbsp;<span class="num" id="6198923">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198929">e</span><span class="op" id="6198930">.</span><span class="ident" id="6198931">buf</span><span class="op" id="6198934">[</span><span class="num" id="6198935">1</span><span class="op" id="6198936">]</span>&nbsp;<span class="op" id="6198938">=</span>&nbsp;<span class="num" id="6198940">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6198946">e</span><span class="op" id="6198947">.</span><span class="ident" id="6198948">write</span><span class="op" id="6198953">(</span><span class="ident" id="6198954">e</span><span class="op" id="6198955">.</span><span class="ident" id="6198956">buf</span><span class="op" id="6198959">[</span><span class="op" id="6198960">:</span><span class="num" id="6198961">2</span><span class="op" id="6198962">]</span><span class="op" id="6198963">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6198966">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6199001">e</span><span class="op" id="6199002">.</span><span class="ident" id="6199003">writeDQT</span><span class="op" id="6199011">(</span><span class="op" id="6199012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6199015">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6199047">e</span><span class="op" id="6199048">.</span><span class="ident" id="6199049">writeSOF0</span><span class="op" id="6199058">(</span><span class="ident" id="6199059">b</span><span class="op" id="6199060">.</span><span class="ident" id="6199061">Size</span><span class="op" id="6199065">(</span><span class="op" id="6199066">)</span><span class="op" id="6199067">,</span>&nbsp;<span class="ident" id="6199069">nComponent</span><span class="op" id="6199079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6199082">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6199112">e</span><span class="op" id="6199113">.</span><span class="ident" id="6199114">writeDHT</span><span class="op" id="6199122">(</span><span class="ident" id="6199123">nComponent</span><span class="op" id="6199133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6199136">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6199162">e</span><span class="op" id="6199163">.</span><span class="ident" id="6199164">writeSOS</span><span class="op" id="6199172">(</span><span class="ident" id="6199173">m</span><span class="op" id="6199174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6199177">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6199212">e</span><span class="op" id="6199213">.</span><span class="ident" id="6199214">buf</span><span class="op" id="6199217">[</span><span class="num" id="6199218">0</span><span class="op" id="6199219">]</span>&nbsp;<span class="op" id="6199221">=</span>&nbsp;<span class="num" id="6199223">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6199229">e</span><span class="op" id="6199230">.</span><span class="ident" id="6199231">buf</span><span class="op" id="6199234">[</span><span class="num" id="6199235">1</span><span class="op" id="6199236">]</span>&nbsp;<span class="op" id="6199238">=</span>&nbsp;<span class="num" id="6199240">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6199246">e</span><span class="op" id="6199247">.</span><span class="ident" id="6199248">write</span><span class="op" id="6199253">(</span><span class="ident" id="6199254">e</span><span class="op" id="6199255">.</span><span class="ident" id="6199256">buf</span><span class="op" id="6199259">[</span><span class="op" id="6199260">:</span><span class="num" id="6199261">2</span><span class="op" id="6199262">]</span><span class="op" id="6199263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6199266">e</span><span class="op" id="6199267">.</span><span class="ident" id="6199268">flush</span><span class="op" id="6199273">(</span><span class="op" id="6199274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6199277">return</span>&nbsp;<span class="ident" id="6199284">e</span><span class="op" id="6199285">.</span><span class="ident" id="6199286">err</span><br>
<span class="lineno"></span><span class="op" id="6199290">}</span>
</div>
</body>
</html>
