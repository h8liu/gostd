<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3925892">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3925947">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3926001">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3926052">//&nbsp;OFB&nbsp;(Output&nbsp;Feedback)&nbsp;Mode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3926084">package</span>&nbsp;<span class="ident" id="3926092">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3926100">type</span>&nbsp;<span class="ident" id="3926105">ofb</span>&nbsp;<span class="keyword" id="3926109">struct</span>&nbsp;<span class="op" id="3926116">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926119">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3926127">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926134">cipher</span>&nbsp;&nbsp;<span class="op" id="3926142">[</span><span class="op" id="3926143">]</span><span class="builtintype" id="3926144">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926150">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3926158">[</span><span class="op" id="3926159">]</span><span class="builtintype" id="3926160">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926166">outUsed</span>&nbsp;<span class="builtintype" id="3926174">int</span><br>
<span class="lineno"></span><span class="op" id="3926178">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3926181">//&nbsp;NewOFB&nbsp;returns&nbsp;a&nbsp;Stream&nbsp;that&nbsp;encrypts&nbsp;or&nbsp;decrypts&nbsp;using&nbsp;the&nbsp;block&nbsp;cipher&nbsp;b</span><br>
<span class="lineno"></span><span class="comment" id="3926259">//&nbsp;in&nbsp;output&nbsp;feedback&nbsp;mode.&nbsp;The&nbsp;initialization&nbsp;vector&nbsp;iv&#39;s&nbsp;length&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span><span class="comment" id="3926339">//&nbsp;to&nbsp;b&#39;s&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3926361">func</span>&nbsp;<span class="ident" id="3926366">NewOFB</span><span class="op" id="3926372">(</span><span class="ident" id="3926373">b</span>&nbsp;<span class="ident" id="3926375">Block</span><span class="op" id="3926380">,</span>&nbsp;<span class="ident" id="3926382">iv</span>&nbsp;<span class="op" id="3926385">[</span><span class="op" id="3926386">]</span><span class="builtintype" id="3926387">byte</span><span class="op" id="3926391">)</span>&nbsp;<span class="ident" id="3926393">Stream</span>&nbsp;<span class="op" id="3926400">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926403">blockSize</span>&nbsp;<span class="op" id="3926413">:=</span>&nbsp;<span class="ident" id="3926416">b</span><span class="op" id="3926417">.</span><span class="ident" id="3926418">BlockSize</span><span class="op" id="3926427">(</span><span class="op" id="3926428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926431">if</span>&nbsp;<span class="builtinfunc" id="3926434">len</span><span class="op" id="3926437">(</span><span class="ident" id="3926438">iv</span><span class="op" id="3926440">)</span>&nbsp;<span class="op" id="3926442">!=</span>&nbsp;<span class="ident" id="3926445">blockSize</span>&nbsp;<span class="op" id="3926455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926459">return</span>&nbsp;<span class="ident" id="3926466">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926474">bufSize</span>&nbsp;<span class="op" id="3926482">:=</span>&nbsp;<span class="ident" id="3926485">streamBufferSize</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926503">if</span>&nbsp;<span class="ident" id="3926506">bufSize</span>&nbsp;<span class="op" id="3926514">&lt;</span>&nbsp;<span class="ident" id="3926516">blockSize</span>&nbsp;<span class="op" id="3926526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926530">bufSize</span>&nbsp;<span class="op" id="3926538">=</span>&nbsp;<span class="ident" id="3926540">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926554">x</span>&nbsp;<span class="op" id="3926556">:=</span>&nbsp;<span class="op" id="3926559">&amp;</span><span class="ident" id="3926560">ofb</span><span class="op" id="3926563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926567">b</span><span class="op" id="3926568">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3926576">b</span><span class="op" id="3926577">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926581">cipher</span><span class="op" id="3926587">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3926590">make</span><span class="op" id="3926594">(</span><span class="op" id="3926595">[</span><span class="op" id="3926596">]</span><span class="builtintype" id="3926597">byte</span><span class="op" id="3926601">,</span>&nbsp;<span class="ident" id="3926603">blockSize</span><span class="op" id="3926612">)</span><span class="op" id="3926613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926617">out</span><span class="op" id="3926620">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3926626">make</span><span class="op" id="3926630">(</span><span class="op" id="3926631">[</span><span class="op" id="3926632">]</span><span class="builtintype" id="3926633">byte</span><span class="op" id="3926637">,</span>&nbsp;<span class="num" id="3926639">0</span><span class="op" id="3926640">,</span>&nbsp;<span class="ident" id="3926642">bufSize</span><span class="op" id="3926649">)</span><span class="op" id="3926650">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926654">outUsed</span><span class="op" id="3926661">:</span>&nbsp;<span class="num" id="3926663">0</span><span class="op" id="3926664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3926671">copy</span><span class="op" id="3926675">(</span><span class="ident" id="3926676">x</span><span class="op" id="3926677">.</span><span class="ident" id="3926678">cipher</span><span class="op" id="3926684">,</span>&nbsp;<span class="ident" id="3926686">iv</span><span class="op" id="3926688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926691">return</span>&nbsp;<span class="ident" id="3926698">x</span><br>
<span class="lineno"></span><span class="op" id="3926700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3926703">func</span>&nbsp;<span class="op" id="3926708">(</span><span class="ident" id="3926709">x</span>&nbsp;<span class="op" id="3926711">*</span><span class="ident" id="3926712">ofb</span><span class="op" id="3926715">)</span>&nbsp;<span class="ident" id="3926717">refill</span><span class="op" id="3926723">(</span><span class="op" id="3926724">)</span>&nbsp;<span class="op" id="3926726">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926729">bs</span>&nbsp;<span class="op" id="3926732">:=</span>&nbsp;<span class="ident" id="3926735">x</span><span class="op" id="3926736">.</span><span class="ident" id="3926737">b</span><span class="op" id="3926738">.</span><span class="ident" id="3926739">BlockSize</span><span class="op" id="3926748">(</span><span class="op" id="3926749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926752">remain</span>&nbsp;<span class="op" id="3926759">:=</span>&nbsp;<span class="builtinfunc" id="3926762">len</span><span class="op" id="3926765">(</span><span class="ident" id="3926766">x</span><span class="op" id="3926767">.</span><span class="ident" id="3926768">out</span><span class="op" id="3926771">)</span>&nbsp;<span class="op" id="3926773">-</span>&nbsp;<span class="ident" id="3926775">x</span><span class="op" id="3926776">.</span><span class="ident" id="3926777">outUsed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926786">if</span>&nbsp;<span class="ident" id="3926789">remain</span>&nbsp;<span class="op" id="3926796">&gt;</span>&nbsp;<span class="ident" id="3926798">x</span><span class="op" id="3926799">.</span><span class="ident" id="3926800">outUsed</span>&nbsp;<span class="op" id="3926808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926812">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926820">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3926823">copy</span><span class="op" id="3926827">(</span><span class="ident" id="3926828">x</span><span class="op" id="3926829">.</span><span class="ident" id="3926830">out</span><span class="op" id="3926833">,</span>&nbsp;<span class="ident" id="3926835">x</span><span class="op" id="3926836">.</span><span class="ident" id="3926837">out</span><span class="op" id="3926840">[</span><span class="ident" id="3926841">x</span><span class="op" id="3926842">.</span><span class="ident" id="3926843">outUsed</span><span class="op" id="3926850">:</span><span class="op" id="3926851">]</span><span class="op" id="3926852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926855">x</span><span class="op" id="3926856">.</span><span class="ident" id="3926857">out</span>&nbsp;<span class="op" id="3926861">=</span>&nbsp;<span class="ident" id="3926863">x</span><span class="op" id="3926864">.</span><span class="ident" id="3926865">out</span><span class="op" id="3926868">[</span><span class="op" id="3926869">:</span><span class="builtinfunc" id="3926870">cap</span><span class="op" id="3926873">(</span><span class="ident" id="3926874">x</span><span class="op" id="3926875">.</span><span class="ident" id="3926876">out</span><span class="op" id="3926879">)</span><span class="op" id="3926880">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926883">for</span>&nbsp;<span class="ident" id="3926887">remain</span>&nbsp;<span class="op" id="3926894">&lt;</span>&nbsp;<span class="builtinfunc" id="3926896">len</span><span class="op" id="3926899">(</span><span class="ident" id="3926900">x</span><span class="op" id="3926901">.</span><span class="ident" id="3926902">out</span><span class="op" id="3926905">)</span><span class="op" id="3926906">-</span><span class="ident" id="3926907">bs</span>&nbsp;<span class="op" id="3926910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926914">x</span><span class="op" id="3926915">.</span><span class="ident" id="3926916">b</span><span class="op" id="3926917">.</span><span class="ident" id="3926918">Encrypt</span><span class="op" id="3926925">(</span><span class="ident" id="3926926">x</span><span class="op" id="3926927">.</span><span class="ident" id="3926928">cipher</span><span class="op" id="3926934">,</span>&nbsp;<span class="ident" id="3926936">x</span><span class="op" id="3926937">.</span><span class="ident" id="3926938">cipher</span><span class="op" id="3926944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3926948">copy</span><span class="op" id="3926952">(</span><span class="ident" id="3926953">x</span><span class="op" id="3926954">.</span><span class="ident" id="3926955">out</span><span class="op" id="3926958">[</span><span class="ident" id="3926959">remain</span><span class="op" id="3926965">:</span><span class="op" id="3926966">]</span><span class="op" id="3926967">,</span>&nbsp;<span class="ident" id="3926969">x</span><span class="op" id="3926970">.</span><span class="ident" id="3926971">cipher</span><span class="op" id="3926977">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926981">remain</span>&nbsp;<span class="op" id="3926988">+=</span>&nbsp;<span class="ident" id="3926991">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926998">x</span><span class="op" id="3926999">.</span><span class="ident" id="3927000">out</span>&nbsp;<span class="op" id="3927004">=</span>&nbsp;<span class="ident" id="3927006">x</span><span class="op" id="3927007">.</span><span class="ident" id="3927008">out</span><span class="op" id="3927011">[</span><span class="op" id="3927012">:</span><span class="ident" id="3927013">remain</span><span class="op" id="3927019">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927022">x</span><span class="op" id="3927023">.</span><span class="ident" id="3927024">outUsed</span>&nbsp;<span class="op" id="3927032">=</span>&nbsp;<span class="num" id="3927034">0</span><br>
<span class="lineno"></span><span class="op" id="3927036">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3927039">func</span>&nbsp;<span class="op" id="3927044">(</span><span class="ident" id="3927045">x</span>&nbsp;<span class="op" id="3927047">*</span><span class="ident" id="3927048">ofb</span><span class="op" id="3927051">)</span>&nbsp;<span class="ident" id="3927053">XORKeyStream</span><span class="op" id="3927065">(</span><span class="ident" id="3927066">dst</span><span class="op" id="3927069">,</span>&nbsp;<span class="ident" id="3927071">src</span>&nbsp;<span class="op" id="3927075">[</span><span class="op" id="3927076">]</span><span class="builtintype" id="3927077">byte</span><span class="op" id="3927081">)</span>&nbsp;<span class="op" id="3927083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927086">for</span>&nbsp;<span class="builtinfunc" id="3927090">len</span><span class="op" id="3927093">(</span><span class="ident" id="3927094">src</span><span class="op" id="3927097">)</span>&nbsp;<span class="op" id="3927099">&gt;</span>&nbsp;<span class="num" id="3927101">0</span>&nbsp;<span class="op" id="3927103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927107">if</span>&nbsp;<span class="ident" id="3927110">x</span><span class="op" id="3927111">.</span><span class="ident" id="3927112">outUsed</span>&nbsp;<span class="op" id="3927120">&gt;=</span>&nbsp;<span class="builtinfunc" id="3927123">len</span><span class="op" id="3927126">(</span><span class="ident" id="3927127">x</span><span class="op" id="3927128">.</span><span class="ident" id="3927129">out</span><span class="op" id="3927132">)</span><span class="op" id="3927133">-</span><span class="ident" id="3927134">x</span><span class="op" id="3927135">.</span><span class="ident" id="3927136">b</span><span class="op" id="3927137">.</span><span class="ident" id="3927138">BlockSize</span><span class="op" id="3927147">(</span><span class="op" id="3927148">)</span>&nbsp;<span class="op" id="3927150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927155">x</span><span class="op" id="3927156">.</span><span class="ident" id="3927157">refill</span><span class="op" id="3927163">(</span><span class="op" id="3927164">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927172">n</span>&nbsp;<span class="op" id="3927174">:=</span>&nbsp;<span class="ident" id="3927177">xorBytes</span><span class="op" id="3927185">(</span><span class="ident" id="3927186">dst</span><span class="op" id="3927189">,</span>&nbsp;<span class="ident" id="3927191">src</span><span class="op" id="3927194">,</span>&nbsp;<span class="ident" id="3927196">x</span><span class="op" id="3927197">.</span><span class="ident" id="3927198">out</span><span class="op" id="3927201">[</span><span class="ident" id="3927202">x</span><span class="op" id="3927203">.</span><span class="ident" id="3927204">outUsed</span><span class="op" id="3927211">:</span><span class="op" id="3927212">]</span><span class="op" id="3927213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927217">dst</span>&nbsp;<span class="op" id="3927221">=</span>&nbsp;<span class="ident" id="3927223">dst</span><span class="op" id="3927226">[</span><span class="ident" id="3927227">n</span><span class="op" id="3927228">:</span><span class="op" id="3927229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927233">src</span>&nbsp;<span class="op" id="3927237">=</span>&nbsp;<span class="ident" id="3927239">src</span><span class="op" id="3927242">[</span><span class="ident" id="3927243">n</span><span class="op" id="3927244">:</span><span class="op" id="3927245">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927249">x</span><span class="op" id="3927250">.</span><span class="ident" id="3927251">outUsed</span>&nbsp;<span class="op" id="3927259">+=</span>&nbsp;<span class="ident" id="3927262">n</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927265">}</span><br>
<span class="lineno"></span><span class="op" id="3927267">}</span>
</div>
</body>
</html>
