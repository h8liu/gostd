<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html" class="current">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3073940">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3073995">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3074049">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3074100">package</span>&nbsp;<span class="ident" id="3074108">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3074118">import</span>&nbsp;<span class="op" id="3074125">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3074128">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3074137">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3074144">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3074154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3074157">//&nbsp;urlFilter&nbsp;returns&nbsp;its&nbsp;input&nbsp;unless&nbsp;it&nbsp;contains&nbsp;an&nbsp;unsafe&nbsp;protocol&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="3074235">//&nbsp;case&nbsp;it&nbsp;defangs&nbsp;the&nbsp;entire&nbsp;URL.</span><br>
<span class="lineno">15</span><span class="keyword" id="3074270">func</span>&nbsp;<span class="ident" id="3074275">urlFilter</span><span class="op" id="3074284">(</span><span class="ident" id="3074285">args</span>&nbsp;<span class="op" id="3074290">...</span><span class="keyword" id="3074293">interface</span><span class="op" id="3074302">{</span><span class="op" id="3074303">}</span><span class="op" id="3074304">)</span>&nbsp;<span class="builtintype" id="3074306">string</span>&nbsp;<span class="op" id="3074313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3074316">s</span><span class="op" id="3074317">,</span>&nbsp;<span class="ident" id="3074319">t</span>&nbsp;<span class="op" id="3074321">:=</span>&nbsp;<span class="ident" id="3074324">stringify</span><span class="op" id="3074333">(</span><span class="ident" id="3074334">args</span><span class="op" id="3074338">...</span><span class="op" id="3074341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3074344">if</span>&nbsp;<span class="ident" id="3074347">t</span>&nbsp;<span class="op" id="3074349">==</span>&nbsp;<span class="ident" id="3074352">contentTypeURL</span>&nbsp;<span class="op" id="3074367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3074371">return</span>&nbsp;<span class="ident" id="3074378">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3074381">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3074384">if</span>&nbsp;<span class="ident" id="3074387">i</span>&nbsp;<span class="op" id="3074389">:=</span>&nbsp;<span class="ident" id="3074392">strings</span><span class="op" id="3074399">.</span><span class="ident" id="3074400">IndexRune</span><span class="op" id="3074409">(</span><span class="ident" id="3074410">s</span><span class="op" id="3074411">,</span>&nbsp;<span class="string" id="3074413">&#39;:&#39;</span><span class="op" id="3074416">)</span><span class="op" id="3074417">;</span>&nbsp;<span class="ident" id="3074419">i</span>&nbsp;<span class="op" id="3074421">&gt;=</span>&nbsp;<span class="num" id="3074424">0</span>&nbsp;<span class="op" id="3074426">&amp;&amp;</span>&nbsp;<span class="ident" id="3074429">strings</span><span class="op" id="3074436">.</span><span class="ident" id="3074437">IndexRune</span><span class="op" id="3074446">(</span><span class="ident" id="3074447">s</span><span class="op" id="3074448">[</span><span class="op" id="3074449">:</span><span class="ident" id="3074450">i</span><span class="op" id="3074451">]</span><span class="op" id="3074452">,</span>&nbsp;<span class="string" id="3074454">&#39;/&#39;</span><span class="op" id="3074457">)</span>&nbsp;<span class="op" id="3074459">&lt;</span>&nbsp;<span class="num" id="3074461">0</span>&nbsp;<span class="op" id="3074463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3074467">protocol</span>&nbsp;<span class="op" id="3074476">:=</span>&nbsp;<span class="ident" id="3074479">strings</span><span class="op" id="3074486">.</span><span class="ident" id="3074487">ToLower</span><span class="op" id="3074494">(</span><span class="ident" id="3074495">s</span><span class="op" id="3074496">[</span><span class="op" id="3074497">:</span><span class="ident" id="3074498">i</span><span class="op" id="3074499">]</span><span class="op" id="3074500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3074504">if</span>&nbsp;<span class="ident" id="3074507">protocol</span>&nbsp;<span class="op" id="3074516">!=</span>&nbsp;<span class="string" id="3074519">&#34;http&#34;</span>&nbsp;<span class="op" id="3074526">&amp;&amp;</span>&nbsp;<span class="ident" id="3074529">protocol</span>&nbsp;<span class="op" id="3074538">!=</span>&nbsp;<span class="string" id="3074541">&#34;https&#34;</span>&nbsp;<span class="op" id="3074549">&amp;&amp;</span>&nbsp;<span class="ident" id="3074552">protocol</span>&nbsp;<span class="op" id="3074561">!=</span>&nbsp;<span class="string" id="3074564">&#34;mailto&#34;</span>&nbsp;<span class="op" id="3074573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3074578">return</span>&nbsp;<span class="string" id="3074585">&#34;#&#34;</span>&nbsp;<span class="op" id="3074589">+</span>&nbsp;<span class="ident" id="3074591">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3074608">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3074611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3074614">return</span>&nbsp;<span class="ident" id="3074621">s</span><br>
<span class="lineno"></span><span class="op" id="3074623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3074626">//&nbsp;urlEscaper&nbsp;produces&nbsp;an&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno">30</span><span class="comment" id="3074696">//&nbsp;The&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;without&nbsp;further&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="keyword" id="3074773">func</span>&nbsp;<span class="ident" id="3074778">urlEscaper</span><span class="op" id="3074788">(</span><span class="ident" id="3074789">args</span>&nbsp;<span class="op" id="3074794">...</span><span class="keyword" id="3074797">interface</span><span class="op" id="3074806">{</span><span class="op" id="3074807">}</span><span class="op" id="3074808">)</span>&nbsp;<span class="builtintype" id="3074810">string</span>&nbsp;<span class="op" id="3074817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3074820">return</span>&nbsp;<span class="ident" id="3074827">urlProcessor</span><span class="op" id="3074839">(</span><span class="builtintype" id="3074840">false</span><span class="op" id="3074845">,</span>&nbsp;<span class="ident" id="3074847">args</span><span class="op" id="3074851">...</span><span class="op" id="3074854">)</span><br>
<span class="lineno"></span><span class="op" id="3074856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3074859">//&nbsp;urlEscaper&nbsp;normalizes&nbsp;URL&nbsp;content&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;quote-delimited</span><br>
<span class="lineno"></span><span class="comment" id="3074939">//&nbsp;string&nbsp;or&nbsp;parenthesis&nbsp;delimited&nbsp;url(...).</span><br>
<span class="lineno"></span><span class="comment" id="3074984">//&nbsp;The&nbsp;normalizer&nbsp;does&nbsp;not&nbsp;encode&nbsp;all&nbsp;HTML&nbsp;specials.&nbsp;Specifically,&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3075063">//&nbsp;encode&nbsp;&#39;&amp;&#39;&nbsp;so&nbsp;correct&nbsp;embedding&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;requires&nbsp;escaping&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3075140">//&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;&#39;&amp;amp;&#39;.</span><br>
<span class="lineno">40</span><span class="keyword" id="3075159">func</span>&nbsp;<span class="ident" id="3075164">urlNormalizer</span><span class="op" id="3075177">(</span><span class="ident" id="3075178">args</span>&nbsp;<span class="op" id="3075183">...</span><span class="keyword" id="3075186">interface</span><span class="op" id="3075195">{</span><span class="op" id="3075196">}</span><span class="op" id="3075197">)</span>&nbsp;<span class="builtintype" id="3075199">string</span>&nbsp;<span class="op" id="3075206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3075209">return</span>&nbsp;<span class="ident" id="3075216">urlProcessor</span><span class="op" id="3075228">(</span><span class="builtintype" id="3075229">true</span><span class="op" id="3075233">,</span>&nbsp;<span class="ident" id="3075235">args</span><span class="op" id="3075239">...</span><span class="op" id="3075242">)</span><br>
<span class="lineno"></span><span class="op" id="3075244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3075247">//&nbsp;urlProcessor&nbsp;normalizes&nbsp;(when&nbsp;norm&nbsp;is&nbsp;true)&nbsp;or&nbsp;escapes&nbsp;its&nbsp;input&nbsp;to&nbsp;produce</span><br>
<span class="lineno">45</span><span class="comment" id="3075326">//&nbsp;a&nbsp;valid&nbsp;hierarchical&nbsp;or&nbsp;opaque&nbsp;URL&nbsp;part.</span><br>
<span class="lineno"></span><span class="keyword" id="3075370">func</span>&nbsp;<span class="ident" id="3075375">urlProcessor</span><span class="op" id="3075387">(</span><span class="ident" id="3075388">norm</span>&nbsp;<span class="builtintype" id="3075393">bool</span><span class="op" id="3075397">,</span>&nbsp;<span class="ident" id="3075399">args</span>&nbsp;<span class="op" id="3075404">...</span><span class="keyword" id="3075407">interface</span><span class="op" id="3075416">{</span><span class="op" id="3075417">}</span><span class="op" id="3075418">)</span>&nbsp;<span class="builtintype" id="3075420">string</span>&nbsp;<span class="op" id="3075427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3075430">s</span><span class="op" id="3075431">,</span>&nbsp;<span class="ident" id="3075433">t</span>&nbsp;<span class="op" id="3075435">:=</span>&nbsp;<span class="ident" id="3075438">stringify</span><span class="op" id="3075447">(</span><span class="ident" id="3075448">args</span><span class="op" id="3075452">...</span><span class="op" id="3075455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3075458">if</span>&nbsp;<span class="ident" id="3075461">t</span>&nbsp;<span class="op" id="3075463">==</span>&nbsp;<span class="ident" id="3075466">contentTypeURL</span>&nbsp;<span class="op" id="3075481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3075485">norm</span>&nbsp;<span class="op" id="3075490">=</span>&nbsp;<span class="builtintype" id="3075492">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3075498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3075501">var</span>&nbsp;<span class="ident" id="3075505">b</span>&nbsp;<span class="ident" id="3075507">bytes</span><span class="op" id="3075512">.</span><span class="ident" id="3075513">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3075521">written</span>&nbsp;<span class="op" id="3075529">:=</span>&nbsp;<span class="num" id="3075532">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3075535">//&nbsp;The&nbsp;byte&nbsp;loop&nbsp;below&nbsp;assumes&nbsp;that&nbsp;all&nbsp;URLs&nbsp;use&nbsp;UTF-8&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3075598">//&nbsp;content-encoding.&nbsp;This&nbsp;is&nbsp;similar&nbsp;to&nbsp;the&nbsp;URI&nbsp;to&nbsp;IRI&nbsp;encoding&nbsp;scheme</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3075670">//&nbsp;defined&nbsp;in&nbsp;section&nbsp;3.1&nbsp;of&nbsp;&nbsp;RFC&nbsp;3987,&nbsp;and&nbsp;behaves&nbsp;the&nbsp;same&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3075739">//&nbsp;EcmaScript&nbsp;builtin&nbsp;encodeURIComponent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3075782">//&nbsp;It&nbsp;should&nbsp;not&nbsp;cause&nbsp;any&nbsp;misencoding&nbsp;of&nbsp;URLs&nbsp;in&nbsp;pages&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3075844">//&nbsp;Content-type:&nbsp;text/html;charset=UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3075887">for</span>&nbsp;<span class="ident" id="3075891">i</span><span class="op" id="3075892">,</span>&nbsp;<span class="ident" id="3075894">n</span>&nbsp;<span class="op" id="3075896">:=</span>&nbsp;<span class="num" id="3075899">0</span><span class="op" id="3075900">,</span>&nbsp;<span class="builtinfunc" id="3075902">len</span><span class="op" id="3075905">(</span><span class="ident" id="3075906">s</span><span class="op" id="3075907">)</span><span class="op" id="3075908">;</span>&nbsp;<span class="ident" id="3075910">i</span>&nbsp;<span class="op" id="3075912">&lt;</span>&nbsp;<span class="ident" id="3075914">n</span><span class="op" id="3075915">;</span>&nbsp;<span class="ident" id="3075917">i</span><span class="op" id="3075918">++</span>&nbsp;<span class="op" id="3075921">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3075925">c</span>&nbsp;<span class="op" id="3075927">:=</span>&nbsp;<span class="ident" id="3075930">s</span><span class="op" id="3075931">[</span><span class="ident" id="3075932">i</span><span class="op" id="3075933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3075937">switch</span>&nbsp;<span class="ident" id="3075944">c</span>&nbsp;<span class="op" id="3075946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3075950">//&nbsp;Single&nbsp;quote&nbsp;and&nbsp;parens&nbsp;are&nbsp;sub-delims&nbsp;in&nbsp;RFC&nbsp;3986,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3076014">//&nbsp;escape&nbsp;them&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3076071">//&nbsp;quoted&nbsp;attributes&nbsp;and&nbsp;unquoted&nbsp;CSS&nbsp;url(...)&nbsp;constructs.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3076132">//&nbsp;Single&nbsp;quotes&nbsp;are&nbsp;reserved&nbsp;in&nbsp;URLs,&nbsp;but&nbsp;are&nbsp;only&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3076194">//&nbsp;the&nbsp;obsolete&nbsp;&#34;mark&#34;&nbsp;rule&nbsp;in&nbsp;an&nbsp;appendix&nbsp;in&nbsp;RFC&nbsp;3986</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3076251">//&nbsp;so&nbsp;can&nbsp;be&nbsp;safely&nbsp;encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076282">case</span>&nbsp;<span class="string" id="3076287">&#39;!&#39;</span><span class="op" id="3076290">,</span>&nbsp;<span class="string" id="3076292">&#39;#&#39;</span><span class="op" id="3076295">,</span>&nbsp;<span class="string" id="3076297">&#39;$&#39;</span><span class="op" id="3076300">,</span>&nbsp;<span class="string" id="3076302">&#39;&amp;&#39;</span><span class="op" id="3076305">,</span>&nbsp;<span class="string" id="3076307">&#39;*&#39;</span><span class="op" id="3076310">,</span>&nbsp;<span class="string" id="3076312">&#39;+&#39;</span><span class="op" id="3076315">,</span>&nbsp;<span class="string" id="3076317">&#39;,&#39;</span><span class="op" id="3076320">,</span>&nbsp;<span class="string" id="3076322">&#39;/&#39;</span><span class="op" id="3076325">,</span>&nbsp;<span class="string" id="3076327">&#39;:&#39;</span><span class="op" id="3076330">,</span>&nbsp;<span class="string" id="3076332">&#39;;&#39;</span><span class="op" id="3076335">,</span>&nbsp;<span class="string" id="3076337">&#39;=&#39;</span><span class="op" id="3076340">,</span>&nbsp;<span class="string" id="3076342">&#39;?&#39;</span><span class="op" id="3076345">,</span>&nbsp;<span class="string" id="3076347">&#39;@&#39;</span><span class="op" id="3076350">,</span>&nbsp;<span class="string" id="3076352">&#39;[&#39;</span><span class="op" id="3076355">,</span>&nbsp;<span class="string" id="3076357">&#39;]&#39;</span><span class="op" id="3076360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076365">if</span>&nbsp;<span class="ident" id="3076368">norm</span>&nbsp;<span class="op" id="3076373">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076379">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3076391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3076395">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3076441">//&nbsp;&#34;For&nbsp;consistency,&nbsp;percent-encoded&nbsp;octets&nbsp;in&nbsp;the&nbsp;ranges&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3076504">//&nbsp;ALPHA&nbsp;(%41-%5A&nbsp;and&nbsp;%61-%7A),&nbsp;DIGIT&nbsp;(%30-%39),&nbsp;hyphen&nbsp;(%2D),</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3076569">//&nbsp;period&nbsp;(%2E),&nbsp;underscore&nbsp;(%5F),&nbsp;or&nbsp;tilde&nbsp;(%7E)&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3076635">//&nbsp;created&nbsp;by&nbsp;URI&nbsp;producers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076665">case</span>&nbsp;<span class="string" id="3076670">&#39;-&#39;</span><span class="op" id="3076673">,</span>&nbsp;<span class="string" id="3076675">&#39;.&#39;</span><span class="op" id="3076678">,</span>&nbsp;<span class="string" id="3076680">&#39;_&#39;</span><span class="op" id="3076683">,</span>&nbsp;<span class="string" id="3076685">&#39;~&#39;</span><span class="op" id="3076688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076693">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076704">case</span>&nbsp;<span class="string" id="3076709">&#39;%&#39;</span><span class="op" id="3076712">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3076717">//&nbsp;When&nbsp;normalizing&nbsp;do&nbsp;not&nbsp;re-encode&nbsp;valid&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076772">if</span>&nbsp;<span class="ident" id="3076775">norm</span>&nbsp;<span class="op" id="3076780">&amp;&amp;</span>&nbsp;<span class="ident" id="3076783">i</span><span class="op" id="3076784">+</span><span class="num" id="3076785">2</span>&nbsp;<span class="op" id="3076787">&lt;</span>&nbsp;<span class="builtinfunc" id="3076789">len</span><span class="op" id="3076792">(</span><span class="ident" id="3076793">s</span><span class="op" id="3076794">)</span>&nbsp;<span class="op" id="3076796">&amp;&amp;</span>&nbsp;<span class="ident" id="3076799">isHex</span><span class="op" id="3076804">(</span><span class="ident" id="3076805">s</span><span class="op" id="3076806">[</span><span class="ident" id="3076807">i</span><span class="op" id="3076808">+</span><span class="num" id="3076809">1</span><span class="op" id="3076810">]</span><span class="op" id="3076811">)</span>&nbsp;<span class="op" id="3076813">&amp;&amp;</span>&nbsp;<span class="ident" id="3076816">isHex</span><span class="op" id="3076821">(</span><span class="ident" id="3076822">s</span><span class="op" id="3076823">[</span><span class="ident" id="3076824">i</span><span class="op" id="3076825">+</span><span class="num" id="3076826">2</span><span class="op" id="3076827">]</span><span class="op" id="3076828">)</span>&nbsp;<span class="op" id="3076830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076836">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3076848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076852">default</span><span class="op" id="3076859">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3076864">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076911">if</span>&nbsp;<span class="string" id="3076914">&#39;a&#39;</span>&nbsp;<span class="op" id="3076918">&lt;=</span>&nbsp;<span class="ident" id="3076921">c</span>&nbsp;<span class="op" id="3076923">&amp;&amp;</span>&nbsp;<span class="ident" id="3076926">c</span>&nbsp;<span class="op" id="3076928">&lt;=</span>&nbsp;<span class="string" id="3076931">&#39;z&#39;</span>&nbsp;<span class="op" id="3076935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076941">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3076953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076958">if</span>&nbsp;<span class="string" id="3076961">&#39;A&#39;</span>&nbsp;<span class="op" id="3076965">&lt;=</span>&nbsp;<span class="ident" id="3076968">c</span>&nbsp;<span class="op" id="3076970">&amp;&amp;</span>&nbsp;<span class="ident" id="3076973">c</span>&nbsp;<span class="op" id="3076975">&lt;=</span>&nbsp;<span class="string" id="3076978">&#39;Z&#39;</span>&nbsp;<span class="op" id="3076982">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076988">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3077000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3077005">if</span>&nbsp;<span class="string" id="3077008">&#39;0&#39;</span>&nbsp;<span class="op" id="3077012">&lt;=</span>&nbsp;<span class="ident" id="3077015">c</span>&nbsp;<span class="op" id="3077017">&amp;&amp;</span>&nbsp;<span class="ident" id="3077020">c</span>&nbsp;<span class="op" id="3077022">&lt;=</span>&nbsp;<span class="string" id="3077025">&#39;9&#39;</span>&nbsp;<span class="op" id="3077029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3077035">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3077047">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3077051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3077055">b</span><span class="op" id="3077056">.</span><span class="ident" id="3077057">WriteString</span><span class="op" id="3077068">(</span><span class="ident" id="3077069">s</span><span class="op" id="3077070">[</span><span class="ident" id="3077071">written</span><span class="op" id="3077078">:</span><span class="ident" id="3077079">i</span><span class="op" id="3077080">]</span><span class="op" id="3077081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3077085">fmt</span><span class="op" id="3077088">.</span><span class="ident" id="3077089">Fprintf</span><span class="op" id="3077096">(</span><span class="op" id="3077097">&amp;</span><span class="ident" id="3077098">b</span><span class="op" id="3077099">,</span>&nbsp;<span class="string" id="3077101">&#34;%%%02x&#34;</span><span class="op" id="3077109">,</span>&nbsp;<span class="ident" id="3077111">c</span><span class="op" id="3077112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3077116">written</span>&nbsp;<span class="op" id="3077124">=</span>&nbsp;<span class="ident" id="3077126">i</span>&nbsp;<span class="op" id="3077128">+</span>&nbsp;<span class="num" id="3077130">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3077133">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3077136">if</span>&nbsp;<span class="ident" id="3077139">written</span>&nbsp;<span class="op" id="3077147">==</span>&nbsp;<span class="num" id="3077150">0</span>&nbsp;<span class="op" id="3077152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3077156">return</span>&nbsp;<span class="ident" id="3077163">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3077166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3077169">b</span><span class="op" id="3077170">.</span><span class="ident" id="3077171">WriteString</span><span class="op" id="3077182">(</span><span class="ident" id="3077183">s</span><span class="op" id="3077184">[</span><span class="ident" id="3077185">written</span><span class="op" id="3077192">:</span><span class="op" id="3077193">]</span><span class="op" id="3077194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3077197">return</span>&nbsp;<span class="ident" id="3077204">b</span><span class="op" id="3077205">.</span><span class="ident" id="3077206">String</span><span class="op" id="3077212">(</span><span class="op" id="3077213">)</span><br>
<span class="lineno">105</span><span class="op" id="3077215">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
